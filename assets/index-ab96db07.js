(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();const rXe="modulepreload",sXe=function(t,e){return new URL(t,e).href},Jfe={},ye=function(e,i,r){if(!i||i.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(i.map(n=>{if(n=sXe(n,r),n in Jfe)return;Jfe[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=s.length-1;u>=0;u--){const h=s[u];if(h.href===n&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":rXe,o||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),o)return new Promise((u,h)=>{c.addEventListener("load",u),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n})};function d(t,e,i,r){var s,n=arguments.length,o=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,i,o):s(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}function Sai(t,e){return function(i,r){e(i,r,t)}}function Tai(t,e,i,r){function s(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?n(u.value):s(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})}let mw;function ae(t){return typeof mw[t]=="function"?mw[t]=mw[t](globalThis):mw[t]}mw=globalThis.dojoConfig?.has||globalThis.esriConfig?.has?{...globalThis.dojoConfig?.has,...globalThis.esriConfig?.has}:{},ae.add=(t,e,i,r)=>((r||mw[t]===void 0)&&(mw[t]=e),i&&ae(t)),ae.cache=mw,ae.add("big-integer-warning-enabled",!0),ae.add("esri-deprecation-warnings",!0),ae.add("esri-tests-disable-screenshots",!1),ae.add("esri-tests-use-full-window",!1),ae.add("esri-tests-post-to-influx",!0),(()=>{ae.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(ae.add("host-browser",t),ae.add("host-node",typeof globalThis.process=="object"&&globalThis.process.versions?.node&&globalThis.process.versions.v8),ae.add("dom",t),ae("host-browser")){const e=navigator,i=e.userAgent,r=e.appVersion,s=parseFloat(r);if(ae.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),ae.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),ae.add("khtml",r.includes("Konqueror")?s:void 0),ae.add("edge",parseFloat(i.split("Edge/")[1])||void 0),ae.add("opr",parseFloat(i.split("OPR/")[1])||void 0),ae.add("webkit",!ae("wp")&&!ae("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),ae.add("chrome",!ae("edge")&&!ae("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),ae.add("android",!ae("wp")&&parseFloat(i.split("Android ")[1])||void 0),ae.add("safari",!r.includes("Safari")||ae("wp")||ae("chrome")||ae("android")||ae("edge")||ae("opr")?void 0:parseFloat(r.split("Version/")[1])),ae.add("mac",r.includes("Macintosh")),!ae("wp")&&/(iPhone|iPod|iPad)/.test(i)){const n=RegExp.$1.replace(/P/,"p"),o=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",a=parseFloat(o.replace(/_/,".").replaceAll("_",""));ae.add(n,a),ae.add("ios",a)}ae("webkit")||(!i.includes("Gecko")||ae("wp")||ae("khtml")||ae("edge")||ae.add("mozilla",s),ae("mozilla")&&ae.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&ae.add("esri-mobile",e),i&&ae.add("esri-iPhone",i),ae.add("esri-geolocation",!!navigator.geolocation)}ae.add("esri-wasm","WebAssembly"in globalThis),ae.add("esri-performance-mode-frames-between-render",20),ae.add("esri-force-performance-mode",!1),ae.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),ae.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),ae.add("esri-atomics","Atomics"in globalThis),ae.add("esri-workers","Worker"in globalThis),ae.add("web-feat:cache","caches"in globalThis),ae.add("esri-workers-arraybuffer-transfer",!ae("safari")||Number(ae("safari"))>=12),ae.add("workers-pool-size",8),ae.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ae.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ae.add("featurelayer-fast-triangulation-enabled",!0),ae.add("featurelayer-animation-enabled",!0),ae.add("featurelayer-snapshot-enabled",!0),ae.add("featurelayer-snapshot-point-min-threshold",8e4),ae.add("featurelayer-snapshot-point-max-threshold",4e5),ae.add("featurelayer-snapshot-point-coverage",.1),ae.add("featurelayer-query-max-depth",4),ae.add("featurelayer-query-pausing-enabled",!1),ae.add("featurelayer-advanced-symbols",!1),ae.add("featurelayer-pbf",!0),ae.add("featurelayer-pbf-statistics",!1),ae.add("feature-layers-workers",!0),ae.add("feature-polyline-generalization-factor",1),ae.add("mapview-transitions-duration",200),ae.add("mapview-essential-goto-duration",200),ae.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ae.add("mapserver-pbf-version-support",10.81),ae.add("mapservice-popup-identify-max-tolerance",20),ae("host-webworker")||ae("host-browser")&&(ae.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ae.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{ae.add("esri-image-decode",!0,!0,!0)}).catch(()=>{ae.add("esri-image-decode",!1,!0,!0)})}return!1}),ae.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();let H2=class rT{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*rT._m}getInt(){return this._seed=(rT._a*this._seed+rT._c)%rT._m,this._seed}getFloat(){return this.getInt()/(rT._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/rT._m*r}};H2._m=2147483647,H2._a=48271,H2._c=0;const iq=1.5,nXe=1/iq,oXe=.5;function rq(t,e){return e?t.filter((i,r,s)=>s.findIndex(e.bind(null,i))===r):Array.from(new Set(t))}function qw(t,e,i){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function ZMe(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function HQ(t,e,i){let r,s;return i?(r=e.filter(n=>!t.some(o=>i(o,n))),s=t.filter(n=>!e.some(o=>i(o,n)))):(r=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:r,removed:s}}function aXe(t){return t&&typeof t.length=="number"}function Eai(t,e){const i=t.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=e)r.push(t.slice(s,s+e));return r}function Cai(t,e,i){const r=t.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return i?e>=t[r-1]?-1:o===e?s:s-1:o===e?s:-1}let JMe=class{constructor(){this.last=0}};const QMe=new JMe;function qQ(t,e,i,r){r=r||QMe;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(t[o]===e)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(t[o]===e)return r.last=o,o;return-1}function QD(t,e,i,r){const s=i??t.length,n=qQ(t,e,s,r);if(n!==-1)return t[n]=t[s-1],i==null&&t.pop(),e}const Rf=new Set;function lXe(t,e,i=t.length,r=e.length,s,n){if(r===0||i===0)return i;Rf.clear();for(let a=0;a<r;++a)Rf.add(e[a]);s=s||QMe;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(Rf.has(t[a])&&(n?.push(t[a]),Rf.delete(t[a]),t[a]=t[i-1],--i,--a,Rf.size===0||i===0))return Rf.clear(),i;for(let a=0;a<o;++a)if(Rf.has(t[a])&&(n?.push(t[a]),Rf.delete(t[a]),t[a]=t[i-1],--i,--a,Rf.size===0||i===0))return Rf.clear(),i;return Rf.clear(),i}function cXe(t,e){let i=0;for(let r=0;r<t.length;++r){const s=t[r];e(s,r)&&(t[i]=s,i++)}t.length=i}function uXe(t){return t?(Qfe.seed=t,()=>Qfe.getFloat()):Math.random}function Aai(t,e){const i=uXe(e);for(let r=t.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=t[r];t[r]=t[s],t[s]=n}return t}const Qfe=new H2;function KMe(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function Rai(t,e){const i=new Map,r=t.length;for(let s=0;s<r;s++){const n=t[s],o=e(n,s,t),a=i.get(o);a?a.push(n):i.set(o,[n])}return i}function Rx(t,e){return t!=null}const hXe=[];function eAe(t){return 32+t.length}function nle(){return 16}function tAe(t){if(!t)return 0;let e=sAe;for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];switch(typeof r){case"string":e+=eAe(r);break;case"number":e+=nle();break;case"boolean":e+=4}}return e}function iAe(t){if(!t)return 0;if(Array.isArray(t))return dXe(t);let e=sAe;for(const i in t)t.hasOwnProperty(i)&&(e+=rAe(t[i]));return e}function dXe(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let i=nAe;for(let r=0;r<e;r++)i+=rAe(t[r]);return i}function rAe(t){switch(typeof t){case"object":return iAe(t);case"string":return eAe(t);case"number":return nle();case"boolean":return 4;default:return 8}}function pXe(t,e){return nAe+t.length*e}const sAe=32,nAe=16;function G3(t){return t instanceof ArrayBuffer}function ole(t){return t?.constructor?.name==="Int8Array"}function gw(t){return t?.constructor?.name==="Uint8Array"}function oAe(t){return t?.constructor?.name==="Uint8ClampedArray"}function ale(t){return t?.constructor?.name==="Int16Array"}function sq(t){return t?.constructor?.name==="Uint16Array"}function lle(t){return t?.constructor?.name==="Int32Array"}function cle(t){return t?.constructor?.name==="Uint32Array"}function yk(t){return t?.constructor?.name==="Float32Array"}function _k(t){return t?.constructor?.name==="Float64Array"}function f0(t){return!("buffer"in t)}function Ww(...t){return t.reduce((e,i)=>e+(i?f0(i)?pXe(i,nle()):i.byteLength+aAe:0),0)}const aAe=145,Gd=1024;function fXe(t){return _k(t)||yk(t)||lle(t)||ale(t)||ole(t)}function mXe(t){return _k(t)||yk(t)}function gXe(t){return _k(t)?179769e303:yk(t)?3402823e32:cle(t)?4294967295:sq(t)?65535:gw(t)||oAe(t)?255:lle(t)?2147483647:ale(t)?32767:ole(t)?127:256}function nq(t,e){let i;if(e)for(i in t)t.hasOwnProperty(i)&&(t[i]===void 0?delete t[i]:t[i]instanceof Object&&nq(t[i],!0));else for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function ee(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=uAe(t);if(e!=null)return e;if(L6(t))return t.clone();if(lAe(t))return t.map(ee);if(cAe(t))return t.clone();const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=ee(t[r]);return i}function WQ(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=uAe(t);if(e!=null)return e;if(lAe(t)){let i=!0;const r=t.map(s=>{const n=WQ(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if(L6(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!cAe(t)){const i=new(Object.getPrototypeOf(t)).constructor;for(const r of Object.getOwnPropertyNames(t)){const s=t[r],n=WQ(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function L6(t){return typeof t.clone=="function"}function lAe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function cAe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function Kfe(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function uAe(t){if(ole(t)||gw(t)||oAe(t)||ale(t)||sq(t)||lle(t)||cle(t)||yk(t)||_k(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,ee(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(ee(i));return e}return null}function ule(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof t?.getTime=="function"&&typeof e?.getTime=="function"&&t.getTime()===e.getTime()||!1}function hAe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&qw(t,e):t instanceof Set?e instanceof Set&&_Xe(t,e):t instanceof Map?e instanceof Map&&vXe(t,e):!!Kfe(t)&&Kfe(e)&&yXe(t,e))}function yXe(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function _Xe(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function vXe(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const s=e.get(i);if(s!==r||s===void 0&&!e.has(i))return!1}return!0}function hle(t,e,i=!1){return pAe(t,e,i)}function _v(t,e){if(e!=null)return e[t]||dAe(t.split("."),!1,e)}function ja(t,e,i){const r=t.split("."),s=r.pop(),n=dAe(r,!0,i);n&&s&&(n[s]=e)}function eme(t,e){if(t==null&&e==null)return!1;if(t==null||e==null)return!0;if(typeof t=="object"){if(Array.isArray(t)){const i=e;if(t.length!==i.length)return!0;for(let r=0;r<t.length;r++)if(eme(t[r],i[r]))return!0;return!1}if(Object.keys(t).length!==Object.keys(e).length)return!0;for(const i in t)if(eme(t[i],e[i]))return!0;return!1}return t!==e}function dAe(t,e,i){let r=i;for(const s of t){if(r==null)return;if(!(s in r)){if(!e)return;r[s]={}}r=r[s]}return r}function pAe(t,e,i){return e?Object.keys(e).reduce((r,s)=>{let n=r[s],o=e[s];return n===o?r:n===void 0?(r[s]=ee(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.concat())):o&&typeof o=="object"?r[s]=pAe(n,o,i):r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[s]=o),r)},t||{}):t}const gr={apiKey:void 0,applicationName:"",applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",respectPrefersReducedMotion:!0,routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],internalInterceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(hle(gr,globalThis.esriConfig,!0),delete gr.has),!gr.assetsPath){{const t="4.30";gr.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}gr.defaultAssetsPath=gr.assetsPath}const bXe=/\{([^}]+)\}/g;function tme(t){return t??""}function oq(t,e){return e?t.replaceAll(bXe,typeof e=="object"?(i,r)=>tme(_v(r,e)):(i,r)=>tme(e(r))):t}function Pai(t,e){return t.replaceAll(/([.$?*|{}()[\]\\/+\-^])/g,i=>e?.includes(i)?i:`\\${i}`)}function dle(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}let ime;function Oai(t){return ime??=new DOMParser,ime.parseFromString(t||"","text/html").body.innerText||""}function Iai(t,e){return new RegExp(`{${e}}`,"ig").test(t)}function wXe(t,...e){let i=t[0];for(let r=0;r<e.length;++r)i+=e[r]+t[r+1];return i}const rme={info:0,warn:1,error:2,none:3};let oe=class Jh{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Jh._loggers.set(this.module,this);const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=Jh.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){}static get test(){}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,Jh._loggers.get(e)||new Jh({module:e})}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!Jh._throttlingDisabled){const s=SXe(r),n=this._loggedMessages[e].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=Jh._tickCounter)return;this._loggedMessages[e].set(s,Jh._tickCounter),Jh._scheduleTickCounterIncrement()}for(const s of gr.log.interceptors)if(s(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;r!=null;){const s=r[e];if(s!=null)return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",xXe)}_matchLevel(e){const i=gr.log.level||"warn";return rme[this._parentWithMember("level",i)]<=rme[e]}static _scheduleTickCounterIncrement(){Jh._tickCounterScheduled||(Jh._tickCounterScheduled=!0,Promise.resolve().then(()=>{Jh._tickCounter++,Jh._tickCounterScheduled=!1}))}};function xXe(t,e,...i){console[t](`[${e}]`,...i)}function SXe(...t){return dle(JSON.stringify(t,(i,r)=>typeof r!="object"||Array.isArray(r)?r:"[Object]"))}oe._loggers=new Map,oe._tickCounter=0,oe._tickCounterScheduled=!1,oe._throttlingDisabled=!1;function TXe(t,e){return t.replaceAll(/\$\{([^\s:}]*)(?::([^\s:}]+))?\}/g,(i,r)=>r===""?"$":(_v(r,e)??"").toString())}let fAe=class{constructor(e,i,r=void 0){this.name=e,this.details=r,this.message=(i&&TXe(i,r))??""}toString(){return"["+this.name+"]: "+this.message}},j=class mAe extends fAe{constructor(e,i,r){super(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return ee(i)}catch{return"[object]"}}))}}catch(e){throw oe.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new mAe(e.name,e.message,e.details)}};j.prototype.type="error";const sme=new WeakMap;function EXe(t,e,i=!1){const r=`🛑 DEPRECATED - ${e}`;if(!i)return void t.warn(r);let s=sme.get(t);s||(s=new Set,sme.set(t,s)),s.has(e)||(s.add(e),t.warn(r))}function gAe(t,e,i={}){if(ae("esri-deprecation-warnings")){const{moduleName:r}=i;Yw(t,`Function: ${(r?r+"::":"")+e+"()"}`,i)}}function CXe(t,e,i={}){if(ae("esri-deprecation-warnings")){const{moduleName:r}=i;Yw(t,`Property: ${(r?r+"::":"")+e}`,i)}}function MXe(t,e,i={}){ae("esri-deprecation-warnings")&&Yw(t,`Multiple argument constructor: ${e}`,{warnOnce:!0,replacement:`new ${e}({ <your properties here> })`,...i})}function Yw(t,e,i={}){if(ae("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=e;r&&(a+=`
	🛠️ Replacement: ${r}`),s&&(a+=`
	⚙️ Version: ${s}`),n&&(a+=`
	🔗 See ${n} for more details.`),EXe(t,a,o)}}function Nai(t){const e=[];return function*(){yield*e;for(const i of t)e.push(i),yield i}}function AXe(t,e){for(const i of t)if(i!=null&&e(i))return i}function YQ(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let A0=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(YQ(e)){const r=this._getOrCreateGroup(i);for(const s of e)ome(s)&&r.push(s)}else ome(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(Z4(e))}remove(e){if(typeof e!="string"&&YQ(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(nme(this._getGroup(e)),this._groups.delete(Z4(e)),this):this}removeAll(){return this._groups.forEach(nme),this._groups.clear(),this}removeReference(e){return this._groups.delete(e),this}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(Z4(e),i),i}_getGroup(e){return this._groups.get(Z4(e))}};function Z4(t){return t||"_default_"}function nme(t){for(const e of t)e instanceof A0?e.removeAll():e.remove()}function ome(t){return t!=null&&(!!t.remove||t instanceof A0)}function aq(t,e){if(t==null)throw new Error(e??"value is None")}function Ge(t){return t?.destroy(),null}function jt(t){return t?.dispose(),null}function Zr(t){return t?.remove(),null}function qc(t){return t?.abort(),null}function yi(t){return t?.release(),null}function RXe(t,e,i){return t!=null&&e!=null?i!=null?i(t,e):t.equals(e):t===e}function ame(t,e){return t?.[e]}function PXe(t,e){let i;return t.some((r,s)=>(i=e(r,s),i!=null)),i??void 0}const yAe=Symbol("Accessor-beforeDestroy"),OXe={remove:()=>{}};function er(t){return t?{remove(){t&&(t(),t=void 0)}}:OXe}function IXe(t){t.forEach(e=>e?.remove())}function Xw(t){return er(()=>IXe(t))}function Dai(t){return er(()=>t()?.remove())}function _Ae(t){return er(t!=null?()=>t.destroy():void 0)}function oc(t){return t.__accessor__??null}function $Xe(t,e){return t?.metadata?.[e]!=null}function Wz(t,e,i){return i?D6(t,e,{policy:i,path:""}):D6(t,e,null)}function D6(t,e,i){return e?Object.keys(e).reduce((r,s)=>{const n=s;let o=null,a="merge";if(i&&(o=i.path?`${i.path}.${s}`:s,a=i.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(r[n]))return r[n]=e[n],r;if(r[n]===void 0)return r[n]=ee(e[n]),r;let l=r[n],c=e[n];if(l===c)return r;if(Array.isArray(c)||Array.isArray(r))l=l?Array.isArray(l)?r[n]=l.concat():r[n]=[l]:r[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(u=>{l.includes(u)||l.push(u)}));else if(c&&typeof c=="object")if(i){const u=i.path;i.path=o,r[n]=D6(l,c,i),i.path=u}else r[n]=D6(l,c,null);else r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[n]=c);return r},t||{}):t}function vAe(t){return Array.isArray(t)?t:t.split(".")}function lme(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function NXe(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...lme(i));return e}return lme(t)}function bAe(t,e,i,r){const s=NXe(e);if(s.length!==1){const n=s.map(o=>r(t,o,i));return Xw(n)}return r(t,s[0],i)}function wAe(t,e){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const r=oc(e);return $Xe(r,i)?r.get(i):e[i]}function xAe(t,e,i){if(t==null)return t;const r=wAe(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:xAe(r,e,i+1)}function vk(t,e,i=0){return typeof e!="string"||e.includes(".")?xAe(t,vAe(e),i):wAe(e,t)}function Jm(t,e){return vk(t,e)}function cme(t,e){return vk(e,t)!==void 0}var uh;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED",t[t.DESTROYED=3]="DESTROYED"})(uh||(uh={}));function bk(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=ee(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function lq(t,e){const i=bk(t);let r=i[e];return r||(r=i[e]={}),r}function LXe(t,e){return Wz(t,e,FXe)}const DXe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function FXe(t){return DXe.test(t)?"replace":"merge"}function kXe(t){return t?.release&&typeof t.release=="function"}function UXe(t){return t?.acquire&&typeof t.acquire=="function"}let Tl=class XQ{constructor(e,i,r,s=1,n=0){if(this._ctor=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let i;if(XQ.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):UXe(i)&&i.acquire(...e),i}release(e){e&&!XQ.test.disabled&&(this._releaseFunction?this._releaseFunction(e):kXe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};Tl.test={disabled:!1};let BXe=class{constructor(e,i){this._observers=e,this._observer=i}remove(){KMe(this._observers,this._observer)}},SAe=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return zXe;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,s=!1;const n=i.length;for(let o=0;o<n;++o){const a=i[o];if(a.destroyed)s=!0;else if(a===e){r=!0;break}}return r||(i.push(e),s&&this._removeDestroyedObservers()),new BXe(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let s=0;s<i;++s){for(;s+r<i&&e[s+r].destroyed;)++r;if(r>0){if(!(s+r<i))break;e[s]=e[s+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const zXe=er();var Wi;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(Wi||(Wi={}));const ZQ=Wi.USER+1;function yw(t){switch(t){case"defaults":return Wi.DEFAULTS;case"service":return Wi.SERVICE;case"portal-item":return Wi.PORTAL_ITEM;case"web-scene":return Wi.WEB_SCENE;case"web-map":return Wi.WEB_MAP;case"link-chart":return Wi.LINK_CHART;case"user":return Wi.USER;default:return null}}function F6(t){switch(t){case Wi.DEFAULTS:return"defaults";case Wi.SERVICE:return"service";case Wi.PORTAL_ITEM:return"portal-item";case Wi.WEB_SCENE:return"web-scene";case Wi.WEB_MAP:return"web-map";case Wi.LINK_CHART:return"link-chart";case Wi.USER:return"user"}}function VXe(t){return F6(t)}var As;(function(t){t[t.Dirty=1]="Dirty",t[t.Overridden=2]="Overridden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(As||(As={}));const k6={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},j3=[];let XL=k6;function Jt(t){XL.onObservableAccessed(t)}let Yz=!1,Xz=!1;function Fv(t,e,i){if(Yz)return ple(t,e,i);TAe(t);const r=e.call(i);return EAe(),r}function GXe(t,e){return Fv(k6,t,e)}function ple(t,e,i){const r=Yz;Yz=!0,TAe(t);let s=null;try{s=e.call(i)}catch(n){Xz&&oe.getLogger("esri.core.accessorSupport.tracking").error(n)}return EAe(),Yz=r,s}function TAe(t){XL=t,j3.push(t)}function EAe(){const t=j3.length;if(t>1){const e=j3.pop();XL=j3[t-2],e.onTrackingEnd()}else if(t===1){const e=j3.pop();XL=k6,e.onTrackingEnd()}else XL=k6}function CAe(t,e){if(e.flags&As.DepTrackingInitialized)return;const i=Xz;Xz=!1,e.flags&As.AutoTracked?ple(e,e.metadata.get,t):MAe(t,e),Xz=i}const jXe=[];function MAe(t,e){e.flags&As.ExplicitlyTracking||(e.flags|=As.ExplicitlyTracking,ple(e,()=>{const i=e.metadata.dependsOn||jXe;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=vAe(r);for(let n=0,o=t;n<s.length&&o!=null&&typeof o=="object";++n)o=ume(o,s[n],n!==s.length-1)}else ume(t,r,!1)}),e.flags&=~As.ExplicitlyTracking)}function ume(t,e,i){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=oc(t);if(s){const n=s.propertiesByName.get(r);n&&(Jt(n),CAe(t,n))}return i?t[r]:void 0}let hme=class extends SAe{constructor(e,i){super(),this.propertyName=e,this.metadata=i,this._accessed=null,this._handles=null,this.flags=0,this.flags=As.Dirty|(i.nonNullable?As.NonNullable:0)|(i.hasOwnProperty("value")?As.HasDefaultValue:0)|(i.get===void 0?As.DepTrackingInitialized:0)|(i.dependsOn===void 0?As.AutoTracked:0)}destroy(){this.flags&As.Dirty&&this.onCommitted(),super.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){Jt(this);const i=e.store,r=this.propertyName,s=this.flags,n=i.get(r);if(s&As.Computing||~s&As.Dirty&&i.has(r))return n;this.flags|=As.Computing;const o=e.host;let a;s&As.AutoTracked?a=Fv(this,this.metadata.get,o):(MAe(o,this),a=this.metadata.get.call(o)),i.set(r,a,Wi.COMPUTED);const l=i.get(r);return l===n?this.flags&=~As.Dirty:GXe(this.commit,this),this.flags&=~As.Computing,l}onObservableAccessed(e){e!==this&&(this._accessed??=new Set,this._accessed.add(e))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=As.DepTrackingInitialized,this._accessed!=null&&(this._handles??=[],this._accessed.forEach(e=>{this._handles.push(e.observe(this))}),this._accessed.clear())}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~As.Dirty,this.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let i=0;i<e.length;++i)e[i].remove();e.length=0}}onInvalidated(){~this.flags&As.Overridden&&(this.flags|=As.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}},HXe=class AAe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new AAe;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,ee(r))}),i}get(e){return this._values.get(e)}originOf(){return Wi.USER}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function J4(t,e,i){return t!==void 0}function dme(t,e,i,r){return t!==void 0&&(!(i==null&&t.flags&As.NonNullable)||(r.lifecycle,uh.INITIALIZING,!1))}let qXe=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=uh.INITIALIZING,this.store=new HXe,this._origin=Wi.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const s=new hme(r,i[r]);this.propertiesByName.set(r,s)}this.metadata=i}initialize(){this.lifecycle=uh.CONSTRUCTING}constructed(){this.lifecycle=uh.CONSTRUCTED}destroy(){this.lifecycle=uh.DESTROYED,this.propertiesByName.forEach(e=>e.destroy())}get initialized(){return this.lifecycle!==uh.INITIALIZING}get(e){const i=this.propertiesByName.get(e);if(i.metadata.get)return i.getComputed(this);Jt(i);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.propertiesByName.get(e);if(r!==void 0&&r.flags&As.HasDefaultValue)return"defaults"}return F6(i)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const i=this.propertiesByName.get(e);if(J4(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.propertiesByName.get(e);J4(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const s=this.propertiesByName.get(i);if(!J4(s))return"";const n=new Set,o=Fv({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>s.metadata.get?.call(e));let a=`${r}${e.declaredClass.split(".").pop()}.${i}: ${o}
`;if(n.size===0)return a;r+="  ";for(const l of n)l instanceof hme&&(a+=`${r}${l.propertyName}: undefined
`);return a}setAtOrigin(e,i,r){const s=this.propertiesByName.get(e);if(J4(s))return this._setAtOrigin(s,i,r)}isOverridden(e){const i=this.propertiesByName.get(e);return i!==void 0&&!!(i.flags&As.Overridden)}clearOverride(e){const i=this.propertiesByName.get(e);i&&i.flags&As.Overridden&&(i.flags&=~As.Overridden,i.notifyChange())}override(e,i){const r=this.propertiesByName.get(e);if(!dme(r,e,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(lW.release(n),!o)return;i=a}r.flags|=As.Overridden,this._internalSet(r,i)}set(e,i){const r=this.propertiesByName.get(e);if(!dme(r,e,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(lW.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=yw(e)}getDefaultOrigin(){return F6(this._origin)}notifyChange(e){const i=this.propertiesByName.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.propertiesByName.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.propertiesByName.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==uh.INITIALIZING?this._origin:Wi.DEFAULTS;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const s=this.store,n=e.propertyName;s.has(n,r)&&ule(i,s.get(n))&&~e.flags&As.Overridden&&r===s.originOf(n)||(e.invalidate(),s.set(n,i,r),e.commit(),CAe(this.host,e))}_cast(e,i){const r=lW.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},WXe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const lW=new Tl(WXe);function U6(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))U6(t,r,e[r]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(-1,1)[0];return void U6(Jm(t,s),n,i)}const r=t.__accessor__;r!=null&&YXe(e,r),t[e]=i}}function YXe(t,e){if(ae("esri-unknown-property-errors")&&!XXe(t,e))throw new j("set:unknown-property",ZXe(t,e))}function XXe(t,e){return e.metadata[t]!=null}function ZXe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let JXe;function QXe(){return JXe}var pme;(function(t){t[t.Ignore=0]="Ignore",t[t.Destroy=1]="Destroy",t[t.ThrowError=2]="ThrowError"})(pme||(pme={}));function KXe(t){t.length=0}let hh=class{constructor(e=50,i=50){this._pool=new Tl(Array,void 0,KXe,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return cW.acquire()}static release(e){return cW.release(e)}static prune(){cW.prune()}};const cW=new hh(100);let RAe=class extends Tl{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const Q4=[];function dO(t){Q4.push(t),Q4.length===1&&queueMicrotask(()=>{const e=Q4.slice();Q4.length=0;for(const i of e)i()})}let vv=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var JQ;(function(t){const e=(n,o,a,l)=>{let c=o,u=o;const h=a>>>1,p=n[c-1];for(;u<=h;){u=c<<1,u<a&&l(n[u-1],n[u])<0&&++u;const f=n[u-1];if(l(f,p)<=0)break;n[c-1]=f,c=u}n[c-1]=p},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let u=a>>>1;u>o;u--)e(n,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const h=n[o];n[o]=n[u],n[u]=h,e(n,c,u,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let u=a>>>1;u>o;u--)e(n,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const h=n[o];n[o]=n[u],n[u]=h,e(n,c,u,l),yield}}t.sort=r,t.iterableSort=s})(JQ||(JQ={}));const fme=JQ,eZe=1.5,tZe=1.1;let ci=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new JMe,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>mme(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];e(s)&&i.push(s)}return i}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,mme(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=qQ(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(qQ(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=lXe(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){fme.sort(this.data,0,this.length,e)}iterableSort(e){return fme.iterableSort(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){for(let r=0;r<this.length;++r){const s=this.data[r];if(e.call(i,s,r))return s}}filterInPlace(e,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(e,i){const{data:r,length:s}=this;for(let n=0;n<s;++n)e.call(i,r[n],n,r)}forEach(e,i){this.data.slice(0,this.length).forEach(e,i)}map(e,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=e.call(i,this.data[s],s,this.data);return r}reduce(e,i){let r=i;for(let s=0;s<this.length;++s)r=e(r,this.data[s],s,this.data);return r}has(e){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===e)return!0;return!1}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.data[e]}};function mme(t){t.data.length>eZe*t.length&&(t.data.length=Math.floor(t.length*tZe))}function iZe(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return er(()=>t.clearTimeout(r))}}}const wk=iZe(globalThis);function cq(t){return rZe(t)||PAe(t)}function rZe(t){return t!=null&&typeof t=="object"&&"on"in t&&typeof t.on=="function"}function PAe(t){return t!=null&&typeof t=="object"&&"addEventListener"in t&&typeof t.addEventListener=="function"}function Tv(t,e,i){if(!cq(t))throw new TypeError("target is not a Evented or EventTarget object");return PAe(t)?sZe(t,e,i):t.on(e,i)}function sZe(t,e,i,r){if(Array.isArray(e)){const s=e.slice();for(const n of s)t.addEventListener(n,i,r);return er(()=>{for(const n of s)t.removeEventListener(n,i,r)})}return t.addEventListener(e,i,r),er(()=>t.removeEventListener(e,i,r))}function OAe(t,e,i){if(!cq(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=Tv(t,e,s=>{r.remove(),i.call(t,s)});return r}function Yi(t="Aborted"){return new j("AbortError",t)}function zt(t,e="Aborted"){if(va(t))throw Yi(e)}function uq(t){return t instanceof AbortSignal?t:t?.signal}function va(t){const e=uq(t);return e!=null&&e.aborted}function pl(t){if(En(t))throw t}function gme(t){if(!En(t))throw t}function oo(t,e){const i=uq(t);if(i!=null){if(!i.aborted)return OAe(i,"abort",()=>e());e()}}function xk(t,e){const i=uq(t);if(i!=null)return zt(i),OAe(i,"abort",()=>e(Yi()))}function IAe(t,e){return uq(e)==null?t:new Promise((i,r)=>{let s=oo(e,()=>r(Yi()));const n=()=>{s=Zr(s)};t.then(n,n),t.then(i,r)})}function En(t){return t?.name==="AbortError"}async function KD(t){try{return await t}catch(e){if(!En(e))throw e;return}}async function qai(t,e=oe.getLogger("esri")){try{return await t}catch(i){En(i)||e.error(i)}}async function hq(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(o=>t[o]),s=await hq(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const e=t;return Promise.allSettled(e).then(i=>Array.from(e,(r,s)=>{const n=i[s];return n.status==="fulfilled"?{promise:r,value:n.value}:{promise:r,error:n.reason}}))}async function QQ(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function nZe(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function eF(t,e=void 0,i){const r=new AbortController;return oo(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);oo(r,()=>{o&&(clearTimeout(o),n(Yi()))})})}function oZe(t,e){const i=new AbortController,r=setTimeout(()=>i.abort(),e);return oo(t,()=>{i.abort(),clearTimeout(r)}),{...t,signal:i.signal}}function Lh(t){return t&&typeof t.then=="function"}function KQ(t){return Lh(t)?t:Promise.resolve(t)}function CI(t,e=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(Yi()),n=lo();const p=n.promise;if(o){const f=o;o=null,f.abort()}return p}if(s=n||lo(),n=null,e>0){const p=new AbortController;i=KQ(t(...l,p.signal));const f=i;eF(e).then(()=>{i===f&&(n?p.abort():o=p)})}else i=1,i=KQ(t(...l));const c=()=>{const p=r;r=s=i=o=null,p!=null&&a(...p)},u=i,h=s;return u.then(c,c),u.then(h.resolve,h.reject),h.promise};return a}function lo(){let t,e;const i=new Promise((s,n)=>{t=s,e=n}),r=s=>{t(s)};return r.resolve=s=>t(s),r.reject=s=>e(s),r.timeout=(s,n)=>wk.setTimeout(()=>r.reject(n),s),r.promise=i,r}function Wai(t,e){return t.then(e,e)}async function yme(t){await Promise.resolve(),zt(t)}function Yai(t){return t}function $Ae(t){return 1e3*t}function Xai(t){return t}function fle(t){return .001*t}let aZe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},lZe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},eK=0,tK=0;const x$={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},iK=["prepare","preRender","render","postRender","update","finish"],rK=[],wE=new ci;let cZe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};function uZe(){q2!=null&&(cancelAnimationFrame(q2),q2=requestAnimationFrame(mle))}const B6={frameTasks:wE,willDispatch:!1,clearFrameTasks:hZe,dispatch:LAe,executeFrameTasks:pZe,reschedule:uZe};function dC(t){const e=new lZe(t);return rK.push(e),B6.willDispatch||(B6.willDispatch=!0,dO(LAe)),e}function xE(t){const e=new aZe(t);return wE.push(e),q2==null&&(eK=performance.now(),q2=requestAnimationFrame(mle)),new cZe(e)}let q2=null;function hZe(t=!1){wE.forAll(e=>{e.removed=!0}),t&&NAe()}function dZe(t){tK=Math.max(0,t)}function mle(){const t=performance.now();q2=null,q2=wE.length>0?requestAnimationFrame(mle):null,B6.executeFrameTasks(t)}function pZe(t){const e=t-eK;eK=t;const i=tK>0?tK:1e3/60,r=Math.max(0,e-i);x$.time=t,x$.frameDuration=i-r;for(let s=0;s<iK.length;s++){const n=performance.now(),o=iK[s];wE.forAll(a=>{a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(x$.elapsedFrameTime=performance.now()-t,x$.deltaTime=a.ticks===0?0:e,a.phases[o]?.call(a,x$)))}),gZe[s].record(performance.now()-n)}NAe(),yZe.record(performance.now()-t)}const K4=new ci;function NAe(){wE.forAll(t=>{t.removed&&K4.push(t)}),wE.removeUnorderedMany(K4.data,K4.length),K4.clear()}function LAe(){for(;rK.length;){const t=rK.shift();t.isActive&&t.callback()}B6.willDispatch=!1}function fZe(t=1,e){const i=lo(),r=()=>{va(e)?i.reject(Yi()):t===0?i():(--t,dO(()=>r()))};return r(),i.promise}function mZe(t){return fZe(1,t)}async function Kai(){await mZe(),await new Promise(t=>requestAnimationFrame(t))}const gZe=iK.map(t=>new vv(t)),yZe=new vv("total");function Zz(t,e){for(const i of t.entries())if(e(i[0]))return!0;return!1}function z6(t,e){if(!e)return t;for(const i of e)i!=null&&t.add(i);return t}function _me(t,e){return e!=null&&t.add(e),t}function DAe(t,e){const i=new Set;return z6(i,t),z6(i,e),i}function _Ze(t,e){const i=new Set;for(const r of e)t.has(r)&&i.add(r);return i}function eli(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const i of t)if(!e.has(i))return!1;return!0}function tli(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function vZe(t,e){const i=new Set(t);for(const r of e)i.delete(r);return i}function bZe(t,e){return vZe(DAe(t,e),_Ze(t,e))}let wZe=0;const xZe=0;function Ld(){return++wZe}let dq=class{constructor(e){this._accessed=new Set,this._handles=[],this._observerObject=new SZe(e),vme.register(this,new WeakRef(this._observerObject),this)}destroy(){vme.unregister(this._observerObject),this._accessed.clear(),this._observerObject?.destroy(),this.clear()}onObservableAccessed(e){this._accessed.add(e)}onTrackingEnd(){const e=this._handles,i=this._observerObject;this._accessed.forEach(r=>{e.push(r.observe(i))}),this._accessed.clear()}clear(){const e=this._handles;for(let i=0;i<e.length;++i)e[i].remove();e.length=0}},SZe=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=TZe}};const vme=new FinalizationRegistry(t=>{t.deref()?.destroy()});function TZe(){}let bP=!1;const V6=[];function FAe(t,e){let i=new dq(n),r=null,s=!1;function n(){if(!i||s)return;if(bP)return void BAe(n);const a=r;i.clear(),bP=!0,s=!0,r=Fv(i,t),s=!1,bP=!1,e(r,a),zAe()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=Fv(i,t),s=!1,er(o)}function kAe(t,e){let i=new dq(s),r=null;function s(){e(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=Fv(i,t),r):null}return o(),er(n)}function UAe(t){let e=new dq(r),i=!1;function r(){e&&!i&&(bP?BAe(r):(e.clear(),bP=!0,i=!0,Fv(e,t),i=!1,bP=!1,zAe()))}function s(){e&&(e.destroy(),e=null)}return i=!0,Fv(e,t),i=!1,er(s)}function BAe(t){V6.includes(t)||V6.unshift(t)}function zAe(){for(;V6.length;)V6.pop()()}var ZL;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(ZL||(ZL={}));let tF=class{constructor(){this.uid=Ld(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,s,n){return this.pool.acquire(ZL.Untracked,e,i,r,s,n,ule)}static acquireTracked(e,i,r,s){return this.pool.acquire(ZL.Tracked,e,i,r,null,null,s)}notify(e,i){this.type===ZL.Untracked?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i,void 0,void 0)}acquire(e,i,r,s,n,o,a){this.uid=Ld(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Ld(),this.removed=!0}};tF.pool=new RAe(tF);const Jz=new hh,Ev=new Set;let G6;function j6(t){Ev.delete(t),Ev.add(t),G6||(G6=dC(MZe))}function EZe(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function CZe(t){for(const e of Ev.values())e.target===t&&(e.removed=!0)}function MZe(){let t=10;for(;G6&&t--;){G6=null;const e=AZe(),i=Jz.acquire();for(const r of e){const s=r.uid;EZe(r),s===r.uid&&r.removed&&i.push(r)}for(const r of Ev)r.removed&&(i.push(r),Ev.delete(r));for(const r of i)tF.pool.release(r);Jz.release(i),Jz.release(e),sK.forEach(r=>r())}}function AZe(){const t=Jz.acquire();t.length=Ev.size;let e=0;for(const i of Ev)t[e]=i,++e;return Ev.clear(),t}const sK=new Set;function VAe(t){return sK.add(t),er(()=>sK.delete(t))}function RZe(t,e,i){let r=bAe(t,e,i,(s,n,o)=>{let a,l,c=kAe(()=>vk(s,n),(u,h)=>{s.__accessor__?.lifecycle===uh.DESTROYED||a&&a.uid!==l?r.remove():(a||(a=tF.acquireUntracked(u,o,h,s,n),l=a.uid),j6(a))});return er(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,j6(a)),a=null),r=c=null})});return r}function PZe(t,e,i){const r=bAe(t,e,i,(s,n,o)=>{let a=!1;return FAe(()=>vk(s,n),(l,c)=>{s.__accessor__.lifecycle!==uh.DESTROYED?a||(a=!0,ule(c,l)||o.call(s,l,c,n,s),a=!1):r.remove()})});return r}function OZe(t,e,i,r=!1){return t.__accessor__&&t.__accessor__.lifecycle!==uh.DESTROYED?r?PZe(t,e,i):RZe(t,e,i):er()}function IZe(t,e,i){let r,s,n=kAe(t,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=tF.acquireTracked(o,e,a,i),s=r.uid),j6(r))});return er(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,j6(r)),r=null),n=null})}function $Ze(t,e,i){let r=!1;return FAe(t,(s,n)=>{r||(r=!0,i(n,s)||e(s,n),r=!1)})}function NZe(t,e,i=!1,r=hAe){return i?$Ze(t,e,r):IZe(t,e,r)}function bme(t){return Zz(Ev,e=>e.oldValue===t)}function Pd(t,e){for(const[i,r]of t)if(e(r,i))return!0;return!1}function nli(t,e){for(const[i,r]of t)if(e(r,i))return r;return null}function pq(t,e,i){const r=t.get(e);if(r!==void 0)return r;const s=i();return t.set(e,s),s}function oli(t){const e=new Map;return i=>(e.has(i)||e.set(i,t(i)),e.get(i))}const wP=()=>oe.getLogger("esri.core.accessorSupport.ensureTypes");function LZe(t){return t==null?t:new Date(t)}function DZe(t){return t==null?t:!!t}function Sk(t){return t==null?t:t.toString()}function Gp(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function gle(t){return t==null?t:Math.round(parseFloat(t))}function FZe(t){return null}function GAe(t){return t?.constructor&&t.constructor.__accessorMetadata__!==void 0}function H6(t,e){return e!=null&&t&&!(e instanceof t)}function jAe(t){return t&&"isCollection"in t}function wme(t){return t?.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function kZe(t,e){if(!e?.constructor||!jAe(e.constructor))return nK(t,e)?e:new t(e);const i=wme(t.prototype.itemType),r=wme(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(nK(t,e),e):new t(e):e}function nK(t,e){return!!GAe(e)&&(wP().error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+fq(t)+"'"),!0)}function SE(t,e){return e==null?e:jAe(t)?kZe(t,e):H6(t,e)?nK(t,e)?e:new t(e):e}function fq(t){return t?.prototype?.declaredClass||"unknown"}const UZe=new WeakMap;function BZe(t){switch(t){case Number:return Gp;case cr:return gle;case Boolean:return DZe;case String:return Sk;case Date:return LZe;case MI:return FZe;default:return pq(UZe,t,()=>SE.bind(null,t))}}function Tn(t,e){const i=BZe(t);return arguments.length===1?i:i(e)}function iF(t,e,i){return arguments.length===1?iF.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function zZe(t,e){return arguments.length===1?iF(i=>Tn(t,i)):iF(i=>Tn(t,i),e)}function HAe(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>HAe(t,e-1,r)):t(i)}function q6(t,e,i){if(arguments.length===2)return n=>q6(t,e,n);if(!i)return i;i=HAe(t,e,i);let r=e,s=i;for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function VZe(t,e,i){return arguments.length===2?q6(r=>Tn(t,r),e):q6(r=>Tn(t,r),e,i)}function qAe(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function oK(t,e){if(arguments.length===2)return oK(t).call(null,e);const i=new Set,r=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(i.has(a)||s.some(h=>c==="string"&&h===String||c==="number"&&h===Number))||c==="object"&&s.some(h=>!H6(a,h))?a:(u&&r.length?(n||(n=r.map(h=>typeof h=="string"?`'${h}'`:`${h}`).join(", ")),wP().error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(h=>fq(h)).join(", ")),wP().error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):wP().error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function ag(t,e){if(arguments.length===2)return ag(t).call(null,e);const i={},r=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];i[l]=Tn(c),r.push(fq(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!H6(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,u=i[c];if(!u)return wP().error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!H6(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!GAe(l)){const h={};for(const p in l)p!==t.key&&(h[p]=l[p]);return u(h)}return u(l)}}let cr=class{},MI=class{};const cli={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function GZe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function WAe(t){switch(t.type){case"native":return Tn(t.value);case"array":return iF(WAe(t.value));case"one-of":return jZe(t);default:return null}}function jZe(t){let e=null;return(i,r)=>lK(i,t)?i:(e==null&&(e=aK(t)),wP().error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function aK(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case cr:return"integer";case Date:return"date";case MI:return"null";default:return fq(t.value)}case"array":return`array of ${aK(t.value)}`;case"one-of":{const e=t.values.map(i=>aK(i));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function lK(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case cr:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string";case MI:return t===null}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!lK(i,e.value));case"one-of":return e.values.some(i=>lK(t,i))}}function m(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),s=lq(e,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in t&&oe.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=r.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let u;s.dependsOn=[l],s.get=function(){let h=Jm(this,l);if(typeof h=="function"){u||(u=l.split(".").slice(0,-1).join("."));const p=Jm(this,u);p&&(h=h.bind(p))}return h},s.readOnly||(s.set=c?function(h){this._override(i,h)}:function(h){U6(this,l,h)})}const o=t.type,a=t.types;s.cast||(o?s.cast=HZe(o):a&&(Array.isArray(a)?s.cast=iF(ag(a[0])):s.cast=ag(a))),LXe(s,t),t.range&&(s.cast=qZe(s.cast,t.range))}}function YAe(t,e,i){const r=lq(t,i);r.json||(r.json={});let s=r.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function HZe(t){let e=0,i=t;if(GZe(t))return WAe(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(qAe(r))return e===0?oK(r):q6(oK(r),e);if(e===1)return zZe(r);if(e>1)return VZe(r,e);const s=t;return s.from?s.from:Tn(s)}function qZe(t,e){return i=>{let r=+t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}function WZe(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const s=e[r];i[r].forEach(n=>{e[n]=s}),delete e[r]}}}let m0=class extends fAe{constructor(e,i,r){super(e,i,r)}};m0.prototype.type="warning";function XAe(t){return!!t&&t.prototype?.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const cK=()=>oe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function xme(t,e,i){t&&(!i&&!e.read||e.read?.reader||e.read?.enabled===!1||ZZe(t)&&ja("read.reader",AI(t),e))}function AI(t){const e=t.ndimArray??0;if(e>1)return XZe(t);if(e===1)return Sme(t);if("type"in t&&JAe(t.type)){const i=t.type.prototype?.itemType?.Type,r=Sme(typeof i=="function"?{type:i}:{types:i});return(s,n,o)=>{const a=r(s,n,o);return a&&new t.type(a)}}return yle(t)}function yle(t){return"type"in t?YZe(t.type):JZe(t.types)}function YZe(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void cK().error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,r),n}:t.fromJSON}function ZAe(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(s=>ZAe(t,s,i,r-1)):t(e,void 0,i)}function XZe(t){const e=yle(t),i=ZAe.bind(null,e),r=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=i(s,o,r);let a=r,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function Sme(t){const e=yle(t);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(i,void 0,s);return n!==void 0?[n]:void 0}}function JAe(t){if(!XAe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?_le(e.Type):QAe(e.Type))}function ZZe(t){return"types"in t?QAe(t.types):_le(t.type)}function _le(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||JAe(t))}function QAe(t){for(const e in t.typeMap)if(!_le(t.typeMap[e]))return!1;return!0}function JZe(t){let e=null;const i=t.errorContext??"type",r=t.validate;return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void cK().error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);e||(e=QZe(t));const l=t.key;if(typeof l!="string")return;const c=s[l],u=c?e[c]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!u){const p=`Type '${c||"unknown"}' is not supported`;return o?.messages&&s&&o.messages.push(new m0(`${i}:unsupported`,p,{definition:s,context:o})),void cK().error(p)}const h=new u;return h.read(s,o),r?r(h):h}}function QZe(t){const e={};for(const i in t.typeMap){const r=t.typeMap[i],s=bk(r.prototype);if(typeof t.key=="function")continue;const n=s[t.key];if(!n)continue;if(n.json?.type&&Array.isArray(n.json.type)&&n.json.type.length===1&&typeof n.json.type[0]=="string"){e[n.json.type[0]]=r;continue}const o=n.json?.write;if(!o?.writer){e[i]=r;continue}const a=o.target,l=typeof a=="string"?a:t.key,c={};o.writer(i,c,l),c[l]&&(e[c[l]]=r)}return e}function KZe(t){if(t.json||(t.json={}),Eme(t.json),Cme(t.json),Tme(t.json),t.json.origins)for(const e in t.json.origins)Eme(t.json.origins[e]),Cme(t.json.origins[e]),Tme(t.json.origins[e]);return!0}function Tme(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function Eme(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function Cme(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function Mme(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=t?.ndimArray??0;t&&(i===1||"type"in t&&XAe(t.type))?e.write.writer=iJe:i>1?e.write.writer=rJe(i):e.types?Array.isArray(e.types)?e.write.writer=tJe(e.types[0]):e.write.writer=eJe(e.types):e.write.writer=rF}function eJe(t){return(e,i,r,s)=>e?KAe(e,t,s)?rF(e,i,r,s):void 0:rF(e,i,r,s)}function KAe(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i?.messages){const r=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new j(`${r}:unsupported`,s,{definition:t,context:i})),oe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function tJe(t){return(e,i,r,s)=>!e||!Array.isArray(e)?rF(e,i,r,s):rF(e.filter(n=>KAe(n,t,s)),i,r,s)}function rF(t,e,i,r){ja(i,W6(t,r),e)}function W6(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?Y6(t):t}function Y6(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function iJe(t,e,i,r){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>W6(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[W6(t,r)],ja(i,s,e)}function eRe(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>eRe(r,e,i-1)):W6(t,e)}function rJe(t){return(e,i,r,s)=>{let n;if(e===null)n=null;else{n=eRe(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}ja(r,n,i)}}function sJe(t,e){return vle(t,"any",e?.origin)}function uK(t,e){return vle(t,"read",e?.origin)}function tRe(t,e){return vle(t,"write",e?.origin)}function vle(t,e,i){let r=t?.json;if(r?.origins&&i){let s;s=i==="link-chart"?r.origins[i]&&(e==="any"||e in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],s&&(e==="any"||e in s)&&(r=s)}return r}function nJe(t){const e=oJe(t);if(t.json.origins)for(const i in t.json.origins){const r=t.json.origins[i],s=r.types?aJe(r):e;xme(s,r,!1),r.types&&!r.write&&t.json.write?.enabled&&(r.write={...t.json.write}),Mme(s,r)}xme(e,t.json,!0),Mme(e,t.json)}function oJe(t){return t.json.types?hK(t.json):t.type?iRe(t):hK(t)}function aJe(t){return t.type?iRe(t):hK(t)}function iRe(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!qAe(i);)i=i[0],e++;return{type:i,ndimArray:e}}function hK(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function lJe(t){KZe(t)&&(WZe(t),nJe(t))}const uW=new Set,hW=new Set;function N(t){return e=>{t??="esri.core.Accessor",e.prototype.declaredClass=t,uJe(e);const i=[],r=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!uW.has(s.initialize)&&(uW.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!hW.has(s.destroy)&&(hW.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);uW.clear(),hW.clear();const n=class extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[yAe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<r.length;u++)r[u].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript()}}};n.__accessorMetadata__=bk(e.prototype),n.prototype.declaredClass=t;const o=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(n,"name",{value:o,configurable:!0}),n}}function cJe(t,e){return e.get==null?function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r===void 0)return;Jt(r);const s=i.store;return s.has(t)?s.get(t):r.metadata.value}:function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r!==void 0)return r.getComputed(i)}}function uJe(t){const e=t.prototype,i=bk(e),r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];lJe(n),r[s]={enumerable:!0,configurable:!0,get:cJe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this))return a.initialized&&n.readOnly?Ame("read-only",s):a.lifecycle===uh.CONSTRUCTED&&n.constructOnly?Ame("construct-only",s):void a.set(s,o)}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,r)}const Ame=(t,e)=>{oe.getLogger("esri.core.Accessor").error(`cannot assign to ${t} property '${e}'`)};var rRe,sRe;function hJe(t){if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return t.constructor?.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const cb=Symbol("Accessor-Handles"),dK=Symbol("Accessor-Initialized");let Fe=class nRe{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}bk(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let h;this.inherited=function(...p){if(n.prototype[a])return n.prototype[a].apply(this,p)};try{h=l.apply(this,c)}catch(p){throw this.inherited=u,p}return this.inherited=u,h}:e[a]}for(const a in i){const l=hJe(i[a]);m(l)(o.prototype,a)}return N(r)(o)}constructor(...e){if(this[rRe]=null,this[sRe]=!1,this.constructor===nRe)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const i=new qXe(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:i}),e.length>0&&(i.ctorArgs=this.normalizeCtorArgs?.apply(this,e)??e[0])}postscript(){const e=this.__accessor__,i=e.ctorArgs;e.initialize(),i&&(this.set(i),e.ctorArgs=null),e.constructed(),this.initialize(),this[dK]=!0}initialize(){}[yAe](){this[cb]=Ge(this[cb])}destroy(){this.destroyed||(CZe(this),this.__accessor__.destroy(),QXe()?.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[dK]}get destroyed(){return this.__accessor__?.lifecycle===uh.DESTROYED||!1}commitProperty(e){Jm(this,e)}get(e){return gAe(oe.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),Jm(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return U6(this,e,i),this}watch(e,i,r){return OZe(this,e,i,r)}addHandles(e,i){if(this.destroyed){const r=Array.isArray(e)?e:[e];for(const s of r)s.remove();return}(this[cb]??=new A0).add(e,i)}removeHandles(e){this[cb]?.remove(e)}removeAllHandles(){this[cb]?.removeAll()}removeHandlesReference(e){this[cb]?.removeReference(e)}hasHandles(e){return this[cb]?.has(e)===!0}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}};rRe=cb,sRe=dK;let dJe=class oRe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new oRe;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,ee(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||r?.origin===i?r?.value:void 0}originOf(e){return this._values.get(e)?.origin??Wi.USER}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>this._values.get(r)?.origin===e)}set(e,i,r){if((r=this._normalizeOrigin(r))===Wi.DEFAULTS){const s=this._values.get(e);if(s?.origin!=null&&s.origin>r)return}this._values.set(e,new pJe(i,r))}delete(e,i){(i=this._normalizeOrigin(i))!=null&&this._values.get(e)?.origin!==i||this._values.delete(e)}has(e,i){return(i=this._normalizeOrigin(i))!=null?this._values.get(e)?.origin===i:this._values.has(e)}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===Wi.DEFAULTS?e:Wi.USER}},pJe=class{constructor(e,i){this.value=e,this.origin=i}};function aRe(t,e,i){e.keys().forEach(s=>{i.set(s,e.get(s),Wi.DEFAULTS)});const r=t.metadata;Object.keys(r).forEach(s=>{t.internalGet(s)&&i.set(s,t.internalGet(s),Wi.DEFAULTS)})}function fJe(t,e,i){if(!t?.read||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.indexOf(e)===0&&cme(r,i))return!0}else for(const s of r)if(s===e||s.includes(".")&&s.indexOf(e)===0&&cme(s,i))return!0;return!1}function mJe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function gJe(t,e,i,r,s){let n=uK(e[i],s);mJe(n)&&(t[i]=!0);for(const o of Object.getOwnPropertyNames(e))n=uK(e[o],s),fJe(n,i,r)&&(t[o]=!0)}function yJe(t,e,i,r){const s=i.metadata,n=sJe(s[e],r),o=n?.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,r):o;a!==void 0&&i.set(e,a)}const lRe={origin:"service"};function cRe(t,e,i=lRe){if(!e||typeof e!="object")return;const r=oc(t),s=r.metadata,n={};for(const o of Object.getOwnPropertyNames(e))gJe(n,s,o,e,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=uK(s[o],i).read,l=a?.source;let c;c=l&&typeof l=="string"?vk(e,l):e[o],a?.reader&&(c=a.reader.call(t,c,e,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||yJe(t,o,r,i)}r.setDefaultOrigin("user")}function uRe(t,e,i,r=lRe){const s={...r,messages:[]};i(s),s.messages?.forEach(n=>{n.type!=="warning"||t.loaded?r?.messages&&r.messages.push(n):t.loadWarnings.push(n)})}function _Je(t,e,i,r,s){const n={};return e.write?.writer?.call(t,r,n,i,s),n}function hRe(t,e,i,r,s,n){if(!r?.write)return!1;const o=Jm(t,i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(t,o,i,n??void 0);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1||s.layerContainerTypes&&n?.layerContainerType&&!s.layerContainerTypes.includes(n.layerContainerType))return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new j("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return a&&n?.messages?n.messages.push(a):a&&!n&&oe.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(i)===Wi.DEFAULTS)&&vJe(t,i,n,r,o)||!s.ignoreOrigin&&n?.origin&&e.store.multipleOriginsSupported&&e.store.originOf(i)<yw(n.origin))}function vJe(t,e,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,i??void 0);return qw(o,s)}return!1}return n===s}function bJe(t,e,i,r){const s=oc(t),n=s.metadata,o=tRe(n[e],r);return!!o&&hRe(t,s,e,o,i,r)}function dRe(t,e,i){if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return Wz(e,t.toJSON(i));const r=oc(t),s=r.metadata;for(const n in s){const o=tRe(s[n],i);if(!hRe(t,r,n,o,void 0,i))continue;const a=Jm(t,n),l=_Je(t,o,o.write&&typeof o.write.target=="string"?o.write.target:n,a,i);Object.keys(l).length>0&&(e=Wz(e,l),i?.resources?.pendingOperations?.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>Wz(e,l,()=>"replace-arrays"))),i?.writtenProperties&&i.writtenProperties.push({target:t,propName:n,oldOrigin:VXe(r.store.originOf(n)),newOrigin:i.origin}))}return e}const Tk=t=>{let e=class extends t{constructor(...i){super(...i);const r=oc(this),s=r.store,n=new dJe;r.store=n,aRe(r,s,n)}read(i,r){cRe(this,i,r)}write(i,r){return dRe(this,i??{},r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return wJe.call(this,i,r)}};return e=d([N("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function wJe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}function X6(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}let we=class extends Tk(Fe){};we=d([N("esri.core.JSONSupport")],we);const xJe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,SJe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function Rme(t){const e=t?.match(xJe);if(!e)return null;const[,i,r,s]=e;if(!i)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:u}=SJe;if(r)if(n=i,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(i.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function pRe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function fRe(t){const e=atob(t),i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i.buffer}function TJe(t){const e=new Uint8Array(t);let i="";for(let r=0;r<e.length;r++)i+=String.fromCharCode(e[r]);return btoa(i)}const EJe=()=>oe.getLogger("esri.core.urlUtils"),RI=gr.request,Pme="esri/config: esriConfig.request.proxyUrl is not set.",mRe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,gRe=/^\s*http:/i,CJe=/^\s*https:/i,MJe=/^\s*file:/i,AJe=/:\d+$/,RJe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,PJe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),OJe=new RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$");let gh=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(PJe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(OJe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const eU={},IJe=new gh(gr.applicationUrl);let Uc=IJe;const $Je=NJe();let ble=$Je;const wle=()=>Uc,fli=()=>ble;function NJe(){const t=Uc.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${Uc.scheme}://${Uc.host}${Uc.port!=null?`:${Uc.port}`:""}`}${e}`}function ln(t){if(!t)return null;const e={path:null,query:null},i=new gh(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.substring(0,r),e.query=P2(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.substring(0,e.path.length-(i.fragment.length+1)))),e}function P2(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function TE(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(e(i,t[i]))).join("&"):Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=e?.[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>X6(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):X6(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function LJe(t=!1){let e,i=RI.proxyUrl;if(typeof t=="string"){e=BJe(t);const r=Ek(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw EJe().warn(Pme),new j("urlUtils:proxy-not-set",Pme);return e&&fK()&&(i=Mle(i)),ln(i)}function mli(t){const e=Ek(t);let i,r;if(e){const s=xle(e.proxyUrl);i=s.path,r=s.query?P2(s.query):null}if(i){const s=ln(t);t=i+"?"+s.path;const n=TE({...r,...s.query});n&&(t=`${t}?${n}`)}return t}const S$={path:"",query:""};function xle(t){const e=t.indexOf("?");return e!==-1?(S$.path=t.slice(0,e),S$.query=t.slice(e+1)):(S$.path=t,S$.query=null),S$}function yRe(t){return t=(t=J6(t=HJe(t=xle(t).path),!0)).toLowerCase()}function DJe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:yRe(t.urlPrefix)},i=RI.proxyRules,r=e.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,e),s}function Ek(t){const e=RI.proxyRules,i=yRe(t);for(let r=0;r<e.length;r++)if(i.indexOf(e[r].urlPrefix)===0)return e[r]}function FJe(t,e){if(!t||!e)return!1;t=Z6(t),e=Z6(e);const i=Rme(t),r=Rme(e);return i!=null&&r!=null?i.portalHostname===r.portalHostname:i==null&&r==null&&rh(t,e,!0)}function _Re(t,e){return t=Z6(t),e=Z6(e),J6(t)===J6(e)}function Z6(t){const e=(t=Dd(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function pK(t,e=RI.interceptors){const i=r=>r==null||r instanceof RegExp&&r.test(t)||typeof r=="string"&&t.startsWith(r);if(e){for(const r of e)if(Array.isArray(r.urls)){if(r.urls.some(i))return r}else if(i(r.urls))return r}return null}function rh(t,e,i=!1){if(!t||!e)return!1;const r=gK(t),s=gK(e);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function Sle(t){if(typeof t=="string"){if(!Fd(t))return!0;t=gK(t)}if(rh(t,Uc))return!0;const e=RI.trustedServers||[];for(let i=0;i<e.length;i++){const r=kJe(e[i]);for(let s=0;s<r.length;s++)if(rh(t,r[s]))return!0}return!1}function kJe(t){return eU[t]||(Cle(t)||g0(t)?eU[t]=[new gh(Bc(t))]:eU[t]=[new gh(`http://${t}`),new gh(`https://${t}`)]),eU[t]}function Bc(t,e=ble,i){return g0(t)?i?.preserveProtocolRelative?t:Uc.scheme==="http"&&Uc.authority===rf(t).slice(2)?`http:${t}`:`https:${t}`:Cle(t)?t:uf(t[0]==="/"?jJe(e):e,t)}function Tle(t,e=ble,i){if(t==null||!Fd(t))return t;const r=Dd(t),s=r.toLowerCase(),n=Dd(e).toLowerCase().replace(/\/+$/,""),o=i?Dd(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(h,p,f)=>(f=h.indexOf(p,f))===-1?h.length:f;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=r.slice(c);const u=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let h=0;h<u;h++)t=`../${t}`;else t=`./${t}`;return t}function Dd(t){return t=YJe(t=WJe(t=qJe(t=Bc(t=t.trim()))))}function uf(...t){const e=t.filter(Rx);if(!e?.length)return;const i=[];if(Fd(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),VJe(e[0])&&(i[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&i.push("");const r=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function rf(t,e=!1){if(t==null||pO(t)||R0(t))return null;let i=t.indexOf("://");if(i===-1&&g0(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=J6(t,!0)),t}function Fd(t){return g0(t)||Cle(t)}function pO(t){return t!=null&&t.slice(0,5)==="blob:"}function R0(t){return t!=null&&t.slice(0,5)==="data:"}function Ele(t){const e=Zw(t);return e?.isBase64?fRe(e.data):null}function dW(t){return TJe(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const UJe=/^data:(.*?)(;base64)?,(.*)$/;function Zw(t){const e=t.match(UJe);if(!e)return null;const[,i,r,s]=e;return{mediaType:i,isBase64:!!r,data:s}}function vRe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function gli(t){return(await fetch(t)).blob()}function yli(t){const e=Ele(t);if(!e)return null;const i=Zw(t);return new Blob([e],{type:i.mediaType})}function g0(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function Cle(t){return t!=null&&mRe.test(t)}function BJe(t){return t!=null&&CJe.test(t)||Uc.scheme==="https"&&g0(t)}function zJe(t){return t!=null&&gRe.test(t)||Uc.scheme==="http"&&g0(t)}function VJe(t){return t!=null&&MJe.test(t)}function Mle(t){return g0(t)?`https:${t}`:t.replace(gRe,"https:")}function GJe(){return Uc.scheme==="http"}function fK(){return Uc.scheme==="https"}function J6(t,e=!1){return g0(t)?t.slice(2):(t=t.replace(mRe,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function jJe(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function Ale(t){let e=0;if(Fd(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function _li(t,e){if(!t)return"";const i=ln(t).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!e?.length)return r;const s=new RegExp(`\\.(${e.join("|")})$`,"i");return r.replace(s,"")}function HJe(t){return t.endsWith("/")?t:`${t}/`}function bRe(t){return t.replace(/\/+$/,"")}function qJe(t){if(/^https?:\/\//i.test(t)){const e=xle(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function WJe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function YJe(t){const e=RI.httpsDomains;if(!zJe(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),AJe.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return GJe()&&r===Uc.authority&&!RJe.test(t)||(fK()&&r===Uc.authority||e&&e.some(s=>r===s||r.endsWith(`.${s}`))||fK()&&!Ek(t))&&(t=Mle(t)),t}function mK(t,e,i){if(!(e&&i&&t&&Fd(t)))return t;const r=t.indexOf("//"),s=t.indexOf("/",r+2),n=t.indexOf(":",r+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(r+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(o)}`}function gK(t){return typeof t=="string"?new gh(Bc(t)):(t.scheme||(t.scheme=Uc.scheme),t)}function wRe(t){return ZJe.test(t)}function xRe(t,e){const i=ln(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function SRe(t,e,i){const r=ln(t),s=r.query||{};return s[e]=String(i),`${r.path}?${TE(s)}`}function Qz(t,e){if(!e)return t;const i=ln(t),r=i.query||{};for(const[n,o]of Object.entries(e))o!=null&&(r[n]=o);const s=TE(r);return s?`${i.path}?${s}`:i.path}function XJe(t){if(t==null)return null;const e=t.match(TRe);return e?e[2]:null}function Ome(t){if(t==null)return null;const e=t.match(TRe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function vli(t){return typeof t=="string"?Zw(t)??{data:t}:new Promise((e,i)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(Zw(r.result)),r.onerror=s=>i(s)})}const TRe=/([^.]*)\.([^/]*)$/,ZJe=/(^data:image\/svg|\.svg$)/i,ERe="20240621",CRe="96d683427103aedd3960cf342647a8857de30ca3";Symbol.dispose??=Symbol("Symbol.dispose"),Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");const MRe="4.30";let Ar,mq=MRe;mq="4.30.0";function JJe(t){Ar=t}function bli(t){const e=Ar?.findCredential(t);return e?.token?SRe(t,"token",e.token):t}ae("host-webworker");const QJe=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function Rle(t){const e=rf(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!QJe.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function ARe(t,e,i=!1,r){return new Promise((s,n)=>{if(va(r))return void n(Ime());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const u=t;c(),s(u)},l=()=>{if(!t)return;const u=t;c(),u.src="",n(Ime())};const c=()=>{ae("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,r?.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e)};r?.addEventListener("abort",l),ae("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function Ime(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const RRe="Timeout exceeded";function KJe(){return new Error(RRe)}function wli(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===RRe}function eQe(t){gr.request.crossOriginNoCorsDomains||(gr.request.crossOriginNoCorsDomains={});const e=gr.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[rf(i)??""]=0:(e[rf("http://"+i)??""]=0,e[rf("https://"+i)??""]=0)}function tQe(t){const e=gr.request.crossOriginNoCorsDomains;if(e){let i=rf(t);if(i)return i=i.toLowerCase(),!rh(i,wle())&&e[i]<Date.now()-36e5}return!1}async function iQe(t){const e=gr.request.crossOriginNoCorsDomains,i=rf(t);e&&i&&(e[i.toLowerCase()]=Date.now());const r=ln(t);t=r.path,r.query?.f==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function qi(t,e){t instanceof URL&&(t=t.toString()),e?.query instanceof URLSearchParams&&(e.query=P2(e.query.toString().replaceAll("+"," ")));const i=R0(t),r=pO(t);r||i||(t=Dd(t));const s={url:t,requestOptions:{...e}},n=p=>({data:p,getAllHeaders:fO,getHeader:fO,httpStatus:200,requestOptions:s.requestOptions,url:s.url}),o=pK(t,Up.internalInterceptors);if(o){const p=await Nme(o,s);if(p!=null)return n(p)}let a=pK(t);if(a){const p=await Nme(a,s);if(p!=null)return n(p);a.after||a.error||(a=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(ae("host-webworker")||ae("host-node")))throw r0("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw r0("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw r0("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await aQe(),Q6)return Q6.execute(t,e);const l=new AbortController,c=oo(e,()=>l.abort()),u={controller:l,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:a,params:s,redoRequest:!1,useIdentity:Up.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},h=await hQe(u).finally(()=>c?.remove());return a?.after?.(h),h}let Q6;const Up=gr.request,PRe="FormData"in globalThis,rQe=new Set([499,498,403,401]),sQe=new Set(["COM_0056","COM_0057","SB_0008"]),nQe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],fO=()=>null,K6=Symbol();function oQe(t){const e=rf(t);e&&!qi._corsServers.includes(e)&&qi._corsServers.push(e)}function $me(t){const e=rf(t);return!e||e.endsWith(".arcgis.com")||qi._corsServers.includes(e)||Sle(e)}function r0(t,e,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getAllHeaders:fO,getHeader:fO,ssl:!1};if(e instanceof j)return e.details?(e.details=ee(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=n,e;if(e){const o=r&&(()=>Array.from(r.headers)),a=r&&(u=>r.headers.get(u)),l=r?.status,c=e.message;c&&(s=c),o&&a&&(n.getAllHeaders=o,n.getHeader=a),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||l||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=K6 in e?e[K6]:e}return En(e)?Yi():new j(t,s,n)}async function aQe(){ae("host-webworker")&&!Q6&&(Q6=await ye(()=>import("./request-bad5e89c.js"),[],import.meta.url))}async function yK(){Ar||await ye(()=>Promise.resolve().then(()=>EZt),void 0,import.meta.url)}async function lQe(t){const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,s=i.body;let n=null,o=null;if(PRe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:i.cacheBust?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:Up.priority,redirect:"follow",signal:r},(n||o)&&(t.fetchOptions.body=n||o),i.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||i.query?.token||n?.get("token")),!t.hasToken&&gr.apiKey&&Rle(e)&&(i.query||(i.query={}),i.query.token=gr.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!ORe(e)&&!va(r)){let a;i.authMode==="immediate"?(await yK(),a=await Ar.getCredential(e,{signal:r}),t.credential=a):i.authMode==="no-prompt"?(await yK(),a=await Ar.getCredential(e,{prompt:!1,signal:r}).catch(()=>{}),t.credential=a):Ar&&(a=Ar.findCredential(e)),a&&(t.credentialToken=a.token,t.useSSL=!!a.ssl)}}function ORe(t){return nQe.some(e=>e.test(t))}async function cQe(t){let e=t.params.url;const i=t.params.requestOptions,r=t.fetchOptions??{},s=pO(e)||R0(e),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:Up.timeout;let a=!1;if(!s){t.useSSL&&(e=Mle(e));let p={...i.query};t.credentialToken&&(p.token=t.credentialToken);let f=TE(p);ae("esri-url-encodes-apostrophe")&&(f=f.replaceAll("'","%27"));const g=e.length+1+f.length;let y;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||g>Up.maxUrlLength;const v=i.useProxy||!!Ek(e);if(v){const b=LJe(e);y=b.path,!a&&y.length+1+g>Up.maxUrlLength&&(a=!0),b.query&&(p={...b.query,...p})}if(r.method==="HEAD"&&(a||v)){if(a)throw g>Up.maxUrlLength?r0("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):r0("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw r0("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?e=Qz(e,p):(r.body=TE(p),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):e=Qz(e,p),v&&(t.useProxy=!0,e=`${y}?${e}`),p.token&&PRe&&r.body instanceof FormData&&!pRe(e)&&r.body.set("token",p.token),i.hasOwnProperty("withCredentials")?t.withCredentials=i.withCredentials:rh(e,wle())||(Sle(e)||Ar&&Ar.findServerInfo(e)?.webTierAuth)&&(t.withCredentials=!0),t.withCredentials&&(r.credentials="include",tQe(e)&&await iQe(a?Qz(e,p):e))}let l,c,u=0,h=!1;o>0&&(u=setTimeout(()=>{h=!0,t.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=e;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||uQe(i.headers)||!s&&!t.useProxy&&Up.proxyUrl&&!$me(e)){if(qi._beforeFetch&&await qi._beforeFetch(e,r),l=await fetch(e,r),qi._afterFetch&&await qi._afterFetch(l),t.useProxy||oQe(e),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=Lme(c,"application/xml");break;case"document":c=Lme(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const p=l.headers.get("Content-Type");if(p&&/application\/json|text\/plain/i.test(p)&&c[n==="blob"?"size":"byteLength"]<=750)try{const f=await new Response(c).json();f.error&&(c=f)}catch{}}n==="image"&&c instanceof Blob&&(c=await Dme(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await Dme(e,t)}catch(p){if(p.name==="AbortError")throw h?KJe():Yi("Request canceled");if(!(!l&&p instanceof TypeError&&Up.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||t.useProxy||$me(e))throw p;t.redoRequest=!0,DJe({proxyUrl:Up.proxyUrl,urlPrefix:rf(e)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function Nme(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(s){i=r0("request:interceptor",s,e)}if((r instanceof Error||r instanceof j)&&(i=r0("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function uQe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function Lme(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function hQe(t){let e,i;await lQe(t);try{do[e,i]=await cQe(t);while(!await dQe(t,e,i))}catch(n){const o=r0("request:server",n,t.params,e);throw o.details.ssl=t.useSSL,t.interceptor?.error&&t.interceptor.error(o),o}const r=t.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&i.user?.username&&!Sle(r)){const n=rf(r,!0);n&&Up.trustedServers.push(n)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&eQe(i.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&Ar){let o=Ar.findServerInfo(s.server)?.owningSystemUrl;if(o){o=o.replace(/\/?$/,"/sharing");const a=Ar.findCredential(o,s.userId);a&&Ar._getIdenticalSvcIdx(o,a)===-1&&a.resources.unshift(o)}}return{data:i,getAllHeaders:e?()=>Array.from(e.headers):fO,getHeader:e?n=>e.headers.get(n):fO,httpStatus:e?.status??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function dQe(t,e,i){if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n;if(i&&(i.error&&typeof i.error=="object"?s=i.error:i.status==="error"&&Array.isArray(i.messages)&&(s={...i},s[K6]=i,s.details=i.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[K6]=i,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o?.toUpperCase());const l=r.authMode;if(n===403&&(a===4||s.message?.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&rQe.has(n)&&!ORe(t.params.url)&&(n!==403||(!o||!sQe.has(o))&&(a==null||a===2&&t.credentialToken))){await yK();try{const c=await Ar.getCredential(t.params.url,{error:r0("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=c,t.credentialToken=c.token,t.useSSL=t.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=c}}if(s)throw s;return!0}function Dme(t,e,i=!1){const r=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Up.priority,s.src=t,ARe(s,t,i,r)}qi._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],qi._beforeFetch=void 0,qi._afterFetch=void 0;let Kz=class IRe{constructor(){this._emitter=new IRe.EventEmitter(this)}emit(e,i){return this._emitter.emit(e,i)}on(e,i){return this._emitter.on(e,i)}once(e,i){return this._emitter.once(e,i)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){let o=this._listenersMap?.get(s);if(!o)return!1;const a=this._target||this;let l=!1;for(const c of o.slice()){const u="deref"in c?c.deref():c;u?u?.call(a,n):l=!0}return l&&(o=o.filter(c=>!("deref"in c)||c.deref()!=null),this._listenersMap.set(s,o)),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return Xw(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??=new Map;const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),er(()=>{const a=this._listenersMap?.get(s),l=a?.indexOf(n)??-1;l>=0&&a.splice(l,1)})}once(s,n){const o=this.on(s,a=>{o.remove(),("deref"in n?n.deref():n)?.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap?.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=d([N("esri.core.Evented")],s),s};let i=class extends Fe{constructor(){super(...arguments),this._emitter=new Kz.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=d([N("esri.core.Evented.EventedAccessor")],i),t.EventedAccessor=i})(Kz||(Kz={}));const un=Kz;var Qr;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(Qr||(Qr={}));function Ple(t){return(e,i)=>{e[i]=t}}let Ck=class extends SAe{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var nv;let pQe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},fQe=class{constructor(e,i,r,s,n){this.target=e,this.added=i,this.removed=r,this.start=s,this.deleteCount=n}};const ep=new Tl(pQe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function Fme(t){t&&typeof t=="object"&&"destroy"in t&&typeof t.destroy=="function"&&t.destroy()}function pW(t){return t?t instanceof Q_?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function fW(t){if(t?.length)return t[0]}function mQe(t,e,i,r){const s=Math.min(t.length-i,e.length-r);let n=0;for(;n<s&&t[i+n]===e[r+n];)n++;return n}function $Re(t,e,i,r){e&&e.forEach((s,n,o)=>{t.push(s),$Re(t,i.call(r,s,n,o),i,r)})}const b1=new Set,w1=new Set,x1=new Set,mW=new Map;let gQe=0,Q_=nv=class extends un.EventedAccessor{static isCollection(t){return t!=null&&t instanceof nv}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new Ck,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:gQe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof nv?{items:t}:t:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return Jt(this._observable),this._items}set items(t){this._emitBeforeChanges(Qr.ADD)||(this._splice(0,this.length,pW(t)),this._emitAfterChanges(Qr.ADD))}hasEventListener(t){return!this.destroyed&&(t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t))}on(t,e){if(this.destroyed)return er();if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),er(()=>{r.removed=!0,i.splice(i.indexOf(r),1)})}return this._emitter.on(t,e)}once(t,e){const i="deref"in e?()=>e.deref():()=>e,r=this.on(t,s=>{i()?.call(null,s),r.remove()});return r}add(t,e){if(Jt(this._observable),this._emitBeforeChanges(Qr.ADD))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(Qr.ADD),this}addMany(t,e=this._items.length){if(Jt(this._observable),!t?.length)return this;if(this._emitBeforeChanges(Qr.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,pW(t)),this._emitAfterChanges(Qr.ADD),this}at(t){if(Jt(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Jt(this._observable),!this.length||this._emitBeforeChanges(Qr.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(Qr.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Jt(this._observable),this._createNewInstance({items:this._items.map(ee)})}concat(...t){Jt(this._observable);const e=t.map(pW);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Jt(this._observable),!this.length||this._emitBeforeChanges(Qr.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)t.call(e,i[s],s,i);this._emitAfterChanges(Qr.REMOVE)}destroyAll(){this.drain(Fme)}destroyMany(t){const e=this.removeMany(t);return e.forEach(Fme),e}every(t,e){return Jt(this._observable),this._items.every(t,e)}filter(t,e){let i;return Jt(this._observable),i=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:i})}find(t,e){return Jt(this._observable),this._items.find(t,e)}findIndex(t,e){return Jt(this._observable),this._items.findIndex(t,e)}flatten(t,e){Jt(this._observable);const i=[];return $Re(i,this,t,e),new nv(i)}forEach(t,e){return Jt(this._observable),this._items.forEach(t,e)}getItemAt(t){return Jt(this._observable),this._items[t]}getNextIndex(t){Jt(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Jt(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Jt(this._observable),this._items.indexOf(t,e)}join(t=","){return Jt(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Jt(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Jt(this._observable);const i=this._items.map(t,e);return new nv({items:i})}reorder(t,e=this.length-1){Jt(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(Qr.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(Qr.MOVE)}return t}}pop(){if(Jt(this._observable),!this.length||this._emitBeforeChanges(Qr.REMOVE))return;const t=fW(this._splice(this.length-1,1));return this._emitAfterChanges(Qr.REMOVE),t}push(...t){return Jt(this._observable),this._emitBeforeChanges(Qr.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(Qr.ADD)),this.length}reduce(t,e){Jt(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){Jt(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return Jt(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Jt(this._observable),t<0||t>=this.length||this._emitBeforeChanges(Qr.REMOVE))return;const e=fW(this._splice(t,1));return this._emitAfterChanges(Qr.REMOVE),e}removeMany(t){if(Jt(this._observable),!t?.length||this._emitBeforeChanges(Qr.REMOVE))return[];const e=t instanceof nv?t.toArray():t,i=this._items,r=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=i.indexOf(o);if(a>-1){const l=1+mQe(e,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(Qr.REMOVE),r}reverse(){if(Jt(this._observable),this._emitBeforeChanges(Qr.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(Qr.MOVE),this}shift(){if(Jt(this._observable),!this.length||this._emitBeforeChanges(Qr.REMOVE))return;const t=fW(this._splice(0,1));return this._emitAfterChanges(Qr.REMOVE),t}slice(t=0,e=this.length){return Jt(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Jt(this._observable),this._items.some(t,e)}sort(t){if(Jt(this._observable),!this.length||this._emitBeforeChanges(Qr.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(Qr.MOVE),this}splice(t,e,...i){Jt(this._observable);const r=(e?Qr.REMOVE:0)|(i.length?Qr.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(t,e,i)||[];return this._emitAfterChanges(r),s}toArray(){return Jt(this._observable),this._items.slice()}toJSON(){return Jt(this._observable),this.toArray()}toLocaleString(){return Jt(this._observable),this._items.toLocaleString()}toString(){return Jt(this._observable),this._items.toString()}unshift(...t){return Jt(this._observable),!t.length||this._emitBeforeChanges(Qr.ADD)||(this._splice(0,0,t),this._emitAfterChanges(Qr.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=dC(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const a=ep.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(t,0,n),t+=1,l-=1,c-=1);ep.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=ep.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);ep.release(a)}}if(i?.length){if(s){const u=[];for(const h of i){const p=s.ensureType(h);p==null&&h!=null||u.push(p)}i=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const u=ep.acquire();u.target=this,u.cancellable=!0;const h=ep.acquire();h.target=this,h.cancellable=!1;for(const p of i)a?(u.reset(p),this.emit("before-add",u),u.defaultPrevented||(c?r.push(p):r.splice(t++,0,p),this._set("length",r.length),l&&(h.reset(p),this.emit("after-add",h)))):(c?r.push(p):r.splice(t++,0,p),this._set("length",r.length),h.reset(p),this.emit("after-add",h));ep.release(h),ep.release(u)}else{if(c)for(const u of i)r.push(u);else r.splice(t,0,...i);this._set("length",r.length)}}if((i?.length||o?.length)&&this._notifyChangeEvent(i,o),this.hasEventListener("after-splice")){const a=new fQe(this,i,o,t,e);this.emit("after-splice",a)}return o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=ep.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,ep.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=ep.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),ep.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;b1.clear(),w1.clear(),x1.clear();for(const{added:l,removed:c}of i){if(l)if(x1.size===0&&w1.size===0)for(const u of l)b1.add(u);else for(const u of l)w1.has(u)?(x1.add(u),w1.delete(u)):x1.has(u)||b1.add(u);if(c)if(x1.size===0&&b1.size===0)for(const u of c)w1.add(u);else for(const u of c)b1.has(u)?b1.delete(u):(x1.delete(u),w1.add(u))}const r=hh.acquire();b1.forEach(l=>{r.push(l)});const s=hh.acquire();w1.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=hh.acquire();if(x1.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=e.listeners.length;for(let u=0;u<c;u++){const h=e.listeners[u];h.removed||h.callback.call(this,l)}}hh.release(r),hh.release(s),hh.release(a)}b1.clear(),w1.clear(),x1.clear()}};Q_.ofType=t=>{if(!t)return nv;if(mW.has(t))return mW.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const s=t.typeMap[r].prototype.declaredClass;e?e+=` | ${s}`:e=s}let i=class extends nv{};return d([Ple({Type:t,ensureType:typeof t=="function"?Tn(t):ag(t)})],i.prototype,"itemType",void 0),i=d([N(`esri.core.Collection<${e}>`)],i),mW.set(t,i),i},d([m()],Q_.prototype,"_updating",void 0),d([m()],Q_.prototype,"length",void 0),d([m()],Q_.prototype,"items",null),d([m({readOnly:!0})],Q_.prototype,"updating",null),Q_=nv=d([N("esri.core.Collection")],Q_);const ct=Q_;function y0(t,e,i=ct){return e||(e=new i),e===t||(e.removeAll(),yQe(t)?e.addMany(t):t&&e.add(t)),e}function Ole(t){return t}function yQe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}var qb;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(qb||(qb={}));let _Qe=class{constructor(){this._resolver=lo(),this._status=qb.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=qb.RESOLVED,this._cleanUp()},()=>{this._status=qb.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===qb.RESOLVED}isRejected(){return this._status===qb.REJECTED}isFulfilled(){return this._status!==qb.PENDING}abort(){this._resolver.reject(Yi())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=lo(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==r||En(s)||this._resolver.reject(s)}),e.resolve()}};const Mk=t=>{let e=class extends t{constructor(...i){super(...i),this._promiseProps=new _Qe,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return this._promiseProps.promise.then(()=>this).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=d([N("esri.core.Promise")],e),e};let ej=class extends Mk(Fe){};ej=d([N("esri.core.Promise")],ej);const vQe="not-loaded",bQe="loading",wQe="failed",kme="loaded",NRe=t=>{let e=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=xk(n,l);this.destroyed&&l(new j("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===vQe){this._set("loadStatus",bQe);const a=this._loadController=new AbortController;s({signal:a.signal})}return r(),o}})),this.when(()=>{this._set("loadStatus",kme),this._loadController=null},r=>{this._set("loadStatus",wQe),this._set("loadError",r),this._loadController=null})}destroy(){this._loadController&&(this._loadController=qc(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===kme}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new j("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return d([m({readOnly:!0})],e.prototype,"loaded",null),d([m({readOnly:!0})],e.prototype,"loadError",void 0),d([m({clonable:!1})],e.prototype,"loadStatus",void 0),d([m({type:[m0],readOnly:!0})],e.prototype,"loadWarnings",null),e=d([N("esri.core.Loadable")],e),e};let H3=class extends NRe(ej){};H3=d([N("esri.core.Loadable")],H3),function(t){function e(i){return!(!i||!i.load)}t.LoadableMixin=NRe,t.isLoadable=e}(H3||(H3={}));const lg=H3;function gq(t,e,i){return hq(t.map((r,s)=>e.apply(i,[r,s])))}async function xQe(t,e,i){return(await hq(t.map((r,s)=>e.apply(i,[r,s])))).map(r=>r.value)}function Ile(t){return{ok:!0,value:t}}function $le(t){return{ok:!1,error:t}}function SQe(t){return t!=null&&t.ok===!0?t.value:null}function TQe(t){return t!=null&&t.ok===!1?t.error:null}async function jd(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return Ile(await t)}catch(e){return $le(e)}}async function EQe(t){try{return Ile(await t)}catch(e){return pl(e),$le(e)}}function Ali(t){if(t.ok===!0)return t.value;throw t.error}function P0(t,e){return new ub(t,e)}let ub=class extends Fe{get value(){return SQe(this._result)}get error(){return TQe(this._result)}get finished(){return this._result!=null}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=qc(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(s=>{this._result=Ile(s),this._cleanup()},s=>{this._result=$le(s),this._cleanup()}),this._abortHandle=oo(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Zr(this._abortHandle),this._abortController=null}};d([m()],ub.prototype,"value",null),d([m()],ub.prototype,"error",null),d([m()],ub.prototype,"finished",null),d([m()],ub.prototype,"promise",void 0),d([m()],ub.prototype,"_result",void 0),ub=d([N("esri.core.asyncUtils.ReactiveTask")],ub);async function Nle(t,e){return await t.load(),CQe(t,e)}async function CQe(t,e){const i=[],r=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?r(...o):ct.isCollection(o)?o.forEach(a=>r(a)):lg.isLoadable(o)&&i.push(o))};e(r);let s=null;if(await xQe(i,async n=>{const o=await jd(MQe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function MQe(t){return"loadAll"in t&&typeof t.loadAll=="function"}function Ve(t,e,i){let r,s;return e===void 0?(s=t,r=[void 0]):typeof e!="string"?(s=t,r=[void 0],i=e):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=YAe(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}let ur=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=AQe(e),this.apiValues=Ume(this._apiToJSON),this.jsonValues=Ume(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&ja(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}};function AQe(t){const e={};for(const i in t)e[t[i]]=i;return e}function Ume(t){const e=[];for(const i in t)e.push(i);return e.sort(),e}function Yc(){return function(t,e){return new ur(t,{ignoreUnknown:!0,...e})}}let Lle=class{constructor(e,i,r,s){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const br=new Lle(6378137,1/298.257223563,3e5,.006694379990137799),Qm=new Lle(3396190,1/169.8944472236118,23e4),kv=new Lle(1737400,0,0);function RQe(t,e){return qi(kr(t),e)}function kr(t){if(!gr.assetsPath)throw oe.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new j("assets:path-not-set","config.assetsPath is not set");return uf(gr.assetsPath,t)}let gW,he=null;function LRe(){return!!he}function PQe(){return!!ae("esri-wasm")}function DRe(){return gW||(gW=ye(()=>import("./pe-wasm-14f846ae.js"),[],import.meta.url).then(t=>t.p).then(({default:t})=>t({locateFile:e=>kr(`esri/geometry/support/${e}`)})).then(t=>{kRe(t)}),gW)}var _K,$n,vK;(function(t){function e(n,o,a){he.ensureCache.prepare();const l=d2(a),c=a===l,u=he.ensureFloat64(l),h=he._pe_geog_to_proj(he.getPointer(n),o,u);return h&&nw(a,o,u,c),h}function i(n,o,a,l){switch(l){case $n.PE_TRANSFORM_P_TO_G:return r(n,o,a);case $n.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){he.ensureCache.prepare();const c=d2(a),u=a===c,h=he.ensureFloat64(c),p=he._pe_proj_to_geog_center(he.getPointer(n),o,h,l);return p&&nw(a,o,h,u),p}t.geogToProj=e,t.projGeog=i,t.projToGeog=r,t.projToGeogCenter=s})(_K||(_K={})),function(t){function e(){t.PE_BUFFER_MAX=he.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=he.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=he.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=he.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=he.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=he.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=he.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=he.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=he.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=he.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=he.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=he.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=he.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=he.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=he.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=he.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=he.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=he.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=he.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=he.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_STR_FMT_WKT=he.PeDefs.prototype.PE_STR_FMT_WKT,t.PE_STR_FMT_WKT2=he.PeDefs.prototype.PE_STR_FMT_WKT2,t.PE_PARM_X0=he.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=he.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=he.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=he.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=he.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=he.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=he.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=he.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=he.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=he.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}($n||($n={})),function(t){const e={},i={},r=f=>{if(f){const g=f.getType();switch(g){case $n.PE_TYPE_GEOGCS:f=he.castObject(f,he.PeGeogcs);break;case $n.PE_TYPE_PROJCS:f=he.castObject(f,he.PeProjcs);break;case $n.PE_TYPE_GEOGTRAN:f=he.castObject(f,he.PeGeogtran);break;default:g&$n.PE_TYPE_UNIT&&(f=he.castObject(f,he.PeUnit))}}return f};function s(){he.PeFactory.prototype.initialize(null)}function n(f){return o($n.PE_TYPE_COORDSYS,f)}function o(f,g){let y=null,v=e[f];if(v||(v={},e[f]=v),v.hasOwnProperty(String(g)))y=v[g];else{const b=he.PeFactory.prototype.factoryByType(f,g);he.compare(b,he.NULL)||(y=b,v[g]=y)}return y=r(y),y}function a(f,g){let y=null,v=i[f];if(v||(v={},i[f]=v),v.hasOwnProperty(g))y=v[g];else{const b=he.PeFactory.prototype.fromString(f,g);he.compare(b,he.NULL)||(y=b,v[g]=y)}return y=r(y),y}function l(f){return o($n.PE_TYPE_GEOGCS,f)}function c(f){return o($n.PE_TYPE_GEOGTRAN,f)}function u(f){return he.PeFactory.prototype.getCode(f)}function h(f){return o($n.PE_TYPE_PROJCS,f)}function p(f){return o($n.PE_TYPE_UNIT,f)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=u,t.projcs=h,t.unit=p}(vK||(vK={}));let FRe=null;var tj,bK,wK,xK,ij,SK,rj,sj,TK;function kRe(t){function e(n,o,a){n[o]=a(n[o])}he=t,$n.init(),tj.init(),ij.init(),rj.init(),sj.init(),FRe=class extends he.PeGCSExtent{destroy(){he.destroy(this)}};const i=[he.PeDatum,he.PeGeogcs,he.PeGeogtran,he.PeObject,he.PeParameter,he.PePrimem,he.PeProjcs,he.PeSpheroid,he.PeUnit];for(const n of i)e(n.prototype,"getName",o=>function(){return o.call(this,new Array($n.PE_NAME_MAX))});for(const n of[he.PeGeogtran,he.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array($n.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=he.getValue(l,"*");a[c]=u?he.wrapPointer(u,he.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(he.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return nw(a,o,n.call(this)),a}),e(he.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=he._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!he.compare(l,he.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=he.getPointer(l);for(let h=1;h<c;h++)a.push(he.wrapPointer(u+o*h,he.PeGTlistExtendedGTs))}}return a}});const r=he._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!he.compare(l,he.NULL)){a=[l];const c=l.getNump();if(c>1){const u=he.getPointer(l);for(let h=1;h<c;h++)a.push(he.wrapPointer(u+r*h,he.PeHorizon))}}return o.set(n,a),a};e(he.PeProjcs.prototype,"horizonGcsGenerate",s),e(he.PeProjcs.prototype,"horizonPcsGenerate",s),he.PeObject.prototype.toString=function(n=$n.PE_STR_OPTS_NONE){he.ensureCache.prepare();const o=he.getPointer(this),a=he.ensureInt8(new Array($n.PE_BUFFER_MAX));return he.UTF8ToString(he._pe_object_to_string_ext(o,n,a))}}function Z0(t){if(!t)return;const e=he.getClass(t);if(!e)return;const i=he.getCache(e);if(!i)return;const r=he.getPointer(t);r&&delete i[r]}function tU(t,e){const i=[],r=new Array(e);for(let s=0;s<t;s++)i.push(he.ensureInt8(r));return i}function d2(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(i=>{e.push(i[0],i[1])})):e=t,e}function nw(t,e,i,r=!1){if(r)for(let s=0;s<2*e;s++)t[s]=he.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=he.getValue(i,"double"),t[n][1]=he.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function i(){t.PE_GTLIST_OPTS_COMMON=he.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=he._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let u=null;const h=new he.PeInteger(c);try{const p=he.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,h);if((c=h.val)&&(u=[p],c>1)){const f=he.getPointer(p);for(let g=1;g<c;g++)u.push(he.wrapPointer(f+e*g,he.PeGTlistExtendedEntry))}}finally{he.destroy(h)}return u}t.init=i,t.getGTlist=r})(tj||(tj={})),function(t){function e(i){if(i?.length){for(const r of i)Z0(r),r.getEntries().forEach(s=>{Z0(s);const n=s.getGeogtran();Z0(n),n.getParameters().forEach(Z0),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{Z0(o);const a=o.getDatum();Z0(a),Z0(a.getSpheroid()),Z0(o.getPrimem()),Z0(o.getUnit())})});he.PeGTlistExtendedEntry.prototype.Delete(i[0])}}t.destroy=e}(bK||(bK={})),function(t){function e(i,r,s,n,o){he.ensureCache.prepare();const a=d2(s),l=s===a,c=he.ensureFloat64(a);let u=0;n&&(u=he.ensureFloat64(n));const h=he._pe_geog_to_geog(he.getPointer(i),r,c,u,o);return h&&nw(s,r,c,l),h}t.geogToGeog=e}(wK||(wK={})),function(t){const e=(c,u,h,p,f,g)=>{let y,v;switch(he.ensureCache.prepare(),c){case"dd":y=he._pe_geog_to_dd,v=$n.PE_DD_MAX;break;case"ddm":y=he._pe_geog_to_ddm,v=$n.PE_DDM_MAX;break;case"dms":y=he._pe_geog_to_dms,v=$n.PE_DMS_MAX}let b=0;u&&(b=he.getPointer(u));const w=d2(p),x=he.ensureFloat64(w),S=tU(h,v),E=y(b,h,x,f,he.ensureInt32(S));if(E)for(let C=0;C<h;C++)g[C]=he.UTF8ToString(S[C]);return E},i=(c,u,h,p,f)=>{let g;switch(he.ensureCache.prepare(),c){case"dd":g=he._pe_dd_to_geog;break;case"ddm":g=he._pe_ddm_to_geog;break;case"dms":g=he._pe_dms_to_geog}let y=0;u&&(y=he.getPointer(u));const v=p.map(S=>he.ensureString(S)),b=he.ensureInt32(v),w=he.ensureFloat64(new Array(2*h)),x=g(y,h,b,w);return x&&nw(f,h,w),x};function r(c,u,h,p,f){return e("dms",c,u,h,p,f)}function s(c,u,h,p){return i("dms",c,u,h,p)}function n(c,u,h,p,f){return e("ddm",c,u,h,p,f)}function o(c,u,h,p){return i("ddm",c,u,h,p)}function a(c,u,h,p,f){return e("dd",c,u,h,p,f)}function l(c,u,h,p){return i("dd",c,u,h,p)}t.geogToDms=r,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(xK||(xK={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=he.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=he.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=he.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=he.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=he.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,u){he.ensureCache.prepare();let h=0;s&&(h=he.getPointer(s));const p=d2(o),f=he.ensureFloat64(p),g=tU(n,$n.PE_MGRS_MAX),y=he.ensureInt32(g),v=he._pe_geog_to_mgrs_extended(h,n,f,a,l,c,y);if(v)for(let b=0;b<n;b++)u[b]=he.UTF8ToString(g[b]);return v}function r(s,n,o,a,l){he.ensureCache.prepare();let c=0;s&&(c=he.getPointer(s));const u=o.map(g=>he.ensureString(g)),h=he.ensureInt32(u),p=he.ensureFloat64(new Array(2*n)),f=he._pe_mgrs_to_geog_extended(c,n,h,a,p);return f&&nw(l,n,p),f}t.init=e,t.geogToMgrsExtended=i,t.mgrsToGeogExtended=r}(ij||(ij={})),function(t){function e(r,s,n,o,a,l,c){he.ensureCache.prepare();let u=0;r&&(u=he.getPointer(r));const h=d2(n),p=he.ensureFloat64(h),f=tU(s,$n.PE_MGRS_MAX),g=he.ensureInt32(f),y=he._pe_geog_to_usng(u,s,p,o,a,l,g);if(y)for(let v=0;v<s;v++)c[v]=he.UTF8ToString(f[v]);return y}function i(r,s,n,o){he.ensureCache.prepare();let a=0;r&&(a=he.getPointer(r));const l=n.map(p=>he.ensureString(p)),c=he.ensureInt32(l),u=he.ensureFloat64(new Array(2*s)),h=he._pe_usng_to_geog(a,s,c,u);return h&&nw(o,s,u),h}t.geogToUsng=e,t.usngToGeog=i}(SK||(SK={})),function(t){function e(){t.PE_UTM_OPTS_NONE=he.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=he.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=he.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){he.ensureCache.prepare();let c=0;s&&(c=he.getPointer(s));const u=d2(o),h=he.ensureFloat64(u),p=tU(n,$n.PE_UTM_MAX),f=he.ensureInt32(p),g=he._pe_geog_to_utm(c,n,h,a,f);if(g)for(let y=0;y<n;y++)l[y]=he.UTF8ToString(p[y]);return g}function r(s,n,o,a,l){he.ensureCache.prepare();let c=0;s&&(c=he.getPointer(s));const u=o.map(g=>he.ensureString(g)),h=he.ensureInt32(u),p=he.ensureFloat64(new Array(2*n)),f=he._pe_utm_to_geog(c,n,h,a,p);return f&&nw(l,n,p),f}t.init=e,t.geogToUtm=i,t.utmToGeog=r}(rj||(rj={})),function(t){const e=new Map;function i(){t.PE_PCSINFO_OPTION_NONE=he.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=he.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=he.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=he.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=he.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=i,t.generate=r}(sj||(sj={})),function(t){function e(){return he.PeVersion.prototype.version_string()}t.versionString=e}(TK||(TK={}));const OQe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return _K},get PeDefs(){return $n},get PeFactory(){return vK},get PeGCSExtent(){return FRe},get PeGTTransformations(){return wK},get PeGTlistExtended(){return tj},get PeGTlistExtendedEntry(){return bK},get PeNotationDms(){return xK},get PeNotationMgrs(){return ij},get PeNotationUsng(){return SK},get PeNotationUtm(){return rj},get PePCSInfo(){return sj},get PeVersion(){return TK},_init:kRe,get _pe(){return he},isLoaded:LRe,isSupported:PQe,load:DRe},Symbol.toStringTag,{value:"Module"}));var yh;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(yh||(yh={}));let _;const U={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,10477:0,10481:2,10516:2,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(_=2e3;_<=2045;_++)U[_]=0;for(_=2056;_<=2065;_++)U[_]=0;for(_=2067;_<=2135;_++)U[_]=0;for(_=2137;_<=2154;_++)U[_]=0;for(_=2161;_<=2170;_++)U[_]=0;for(_=2172;_<=2193;_++)U[_]=0;for(_=2195;_<=2198;_++)U[_]=0;for(_=2200;_<=2203;_++)U[_]=0;for(_=2205;_<=2217;_++)U[_]=0;for(_=2222;_<=2224;_++)U[_]=1;for(_=2225;_<=2250;_++)U[_]=2;for(_=2251;_<=2253;_++)U[_]=1;for(_=2257;_<=2264;_++)U[_]=2;for(_=2274;_<=2279;_++)U[_]=2;for(_=2280;_<=2282;_++)U[_]=1;for(_=2283;_<=2289;_++)U[_]=2;for(_=2290;_<=2292;_++)U[_]=0;for(_=2308;_<=2313;_++)U[_]=0;for(_=2315;_<=2491;_++)U[_]=0;for(_=2494;_<=2866;_++)U[_]=0;for(_=2867;_<=2869;_++)U[_]=1;for(_=2870;_<=2888;_++)U[_]=2;for(_=2891;_<=2895;_++)U[_]=2;for(_=2896;_<=2898;_++)U[_]=1;for(_=2902;_<=2908;_++)U[_]=2;for(_=2915;_<=2920;_++)U[_]=2;for(_=2921;_<=2923;_++)U[_]=1;for(_=2924;_<=2930;_++)U[_]=2;for(_=2931;_<=2962;_++)U[_]=0;for(_=2964;_<=2968;_++)U[_]=2;for(_=2969;_<=2973;_++)U[_]=0;for(_=2975;_<=2991;_++)U[_]=0;for(_=2995;_<=3051;_++)U[_]=0;for(_=3054;_<=3079;_++)U[_]=0;for(_=3081;_<=3088;_++)U[_]=0;for(_=3092;_<=3101;_++)U[_]=0;for(_=3106;_<=3138;_++)U[_]=0;for(_=3146;_<=3151;_++)U[_]=0;for(_=3153;_<=3166;_++)U[_]=0;for(_=3168;_<=3172;_++)U[_]=0;for(_=3174;_<=3203;_++)U[_]=0;for(_=3294;_<=3358;_++)U[_]=0;for(_=3367;_<=3403;_++)U[_]=0;for(_=3408;_<=3416;_++)U[_]=0;for(_=3417;_<=3438;_++)U[_]=2;for(_=3441;_<=3446;_++)U[_]=2;for(_=3447;_<=3450;_++)U[_]=0;for(_=3451;_<=3459;_++)U[_]=2;for(_=3460;_<=3478;_++)U[_]=0;for(_=3554;_<=3559;_++)U[_]=0;for(_=3560;_<=3570;_++)U[_]=2;for(_=3571;_<=3581;_++)U[_]=0;for(_=3594;_<=3597;_++)U[_]=0;for(_=3601;_<=3604;_++)U[_]=0;for(_=3637;_<=3639;_++)U[_]=0;for(_=3665;_<=3667;_++)U[_]=0;for(_=3693;_<=3695;_++)U[_]=0;for(_=3701;_<=3727;_++)U[_]=0;for(_=3728;_<=3739;_++)U[_]=2;for(_=3740;_<=3751;_++)U[_]=0;for(_=3753;_<=3760;_++)U[_]=2;for(_=3761;_<=3773;_++)U[_]=0;for(_=3775;_<=3777;_++)U[_]=0;for(_=3779;_<=3781;_++)U[_]=0;for(_=3783;_<=3785;_++)U[_]=0;for(_=3788;_<=3791;_++)U[_]=0;for(_=3797;_<=3802;_++)U[_]=0;for(_=3814;_<=3816;_++)U[_]=0;for(_=3825;_<=3829;_++)U[_]=0;for(_=3832;_<=3841;_++)U[_]=0;for(_=3844;_<=3852;_++)U[_]=0;for(_=3873;_<=3885;_++)U[_]=0;for(_=3890;_<=3893;_++)U[_]=0;for(_=3907;_<=3912;_++)U[_]=0;for(_=3942;_<=3950;_++)U[_]=0;for(_=3968;_<=3970;_++)U[_]=0;for(_=3973;_<=3976;_++)U[_]=0;for(_=3986;_<=3989;_++)U[_]=0;for(_=3994;_<=3997;_++)U[_]=0;for(_=4048;_<=4051;_++)U[_]=0;for(_=4056;_<=4063;_++)U[_]=0;for(_=4093;_<=4096;_++)U[_]=0;for(_=4390;_<=4398;_++)U[_]=0;for(_=4399;_<=4413;_++)U[_]=2;for(_=4418;_<=4433;_++)U[_]=2;for(_=4455;_<=4457;_++)U[_]=2;for(_=4484;_<=4489;_++)U[_]=0;for(_=4491;_<=4554;_++)U[_]=0;for(_=4568;_<=4589;_++)U[_]=0;for(_=4652;_<=4656;_++)U[_]=0;for(_=4766;_<=4800;_++)U[_]=0;for(_=5014;_<=5016;_++)U[_]=0;for(_=5069;_<=5072;_++)U[_]=0;for(_=5105;_<=5130;_++)U[_]=0;for(_=5167;_<=5188;_++)U[_]=0;for(_=5253;_<=5259;_++)U[_]=0;for(_=5269;_<=5275;_++)U[_]=0;for(_=5292;_<=5311;_++)U[_]=0;for(_=5329;_<=5331;_++)U[_]=0;for(_=5343;_<=5349;_++)U[_]=0;for(_=5355;_<=5357;_++)U[_]=0;for(_=5387;_<=5389;_++)U[_]=0;for(_=5459;_<=5463;_++)U[_]=0;for(_=5479;_<=5482;_++)U[_]=0;for(_=5518;_<=5520;_++)U[_]=0;for(_=5530;_<=5539;_++)U[_]=0;for(_=5550;_<=5552;_++)U[_]=0;for(_=5562;_<=5583;_++)U[_]=0;for(_=5623;_<=5625;_++)U[_]=2;for(_=5631;_<=5639;_++)U[_]=0;for(_=5649;_<=5653;_++)U[_]=0;for(_=5663;_<=5680;_++)U[_]=0;for(_=5682;_<=5685;_++)U[_]=0;for(_=5875;_<=5877;_++)U[_]=0;for(_=5896;_<=5899;_++)U[_]=0;for(_=5921;_<=5940;_++)U[_]=0;for(_=6050;_<=6125;_++)U[_]=0;for(_=6244;_<=6275;_++)U[_]=0;for(_=6328;_<=6348;_++)U[_]=0;for(_=6350;_<=6356;_++)U[_]=0;for(_=6366;_<=6372;_++)U[_]=0;for(_=6381;_<=6387;_++)U[_]=0;for(_=6393;_<=6404;_++)U[_]=0;for(_=6480;_<=6483;_++)U[_]=0;for(_=6511;_<=6514;_++)U[_]=0;for(_=6579;_<=6581;_++)U[_]=0;for(_=6619;_<=6624;_++)U[_]=0;for(_=6625;_<=6627;_++)U[_]=2;for(_=6628;_<=6632;_++)U[_]=0;for(_=6634;_<=6637;_++)U[_]=0;for(_=6669;_<=6692;_++)U[_]=0;for(_=6707;_<=6709;_++)U[_]=0;for(_=6720;_<=6723;_++)U[_]=0;for(_=6732;_<=6738;_++)U[_]=0;for(_=6931;_<=6933;_++)U[_]=0;for(_=6956;_<=6959;_++)U[_]=0;for(_=7005;_<=7007;_++)U[_]=0;for(_=7057;_<=7070;_++)U[_]=2;for(_=7074;_<=7082;_++)U[_]=0;for(_=7109;_<=7118;_++)U[_]=0;for(_=7119;_<=7127;_++)U[_]=1;for(_=7374;_<=7376;_++)U[_]=0;for(_=7528;_<=7586;_++)U[_]=0;for(_=7587;_<=7645;_++)U[_]=2;for(_=7692;_<=7696;_++)U[_]=0;for(_=7755;_<=7787;_++)U[_]=0;for(_=7791;_<=7795;_++)U[_]=0;for(_=7799;_<=7801;_++)U[_]=0;for(_=7803;_<=7805;_++)U[_]=0;for(_=7825;_<=7831;_++)U[_]=0;for(_=7845;_<=7859;_++)U[_]=0;for(_=8013;_<=8032;_++)U[_]=0;for(_=8065;_<=8068;_++)U[_]=1;for(_=8518;_<=8529;_++)U[_]=2;for(_=8533;_<=8536;_++)U[_]=2;for(_=8538;_<=8540;_++)U[_]=2;for(_=8677;_<=8679;_++)U[_]=0;for(_=8836;_<=8840;_++)U[_]=0;for(_=8857;_<=8859;_++)U[_]=0;for(_=8908;_<=8910;_++)U[_]=0;for(_=9154;_<=9159;_++)U[_]=0;for(_=9205;_<=9218;_++)U[_]=0;for(_=9271;_<=9273;_++)U[_]=0;for(_=9295;_<=9297;_++)U[_]=0;for(_=9356;_<=9360;_++)U[_]=0;for(_=9404;_<=9407;_++)U[_]=0;for(_=9476;_<=9482;_++)U[_]=0;for(_=9487;_<=9494;_++)U[_]=0;for(_=9697;_<=9699;_++)U[_]=0;for(_=9821;_<=9865;_++)U[_]=0;for(_=10285;_<=10291;_++)U[_]=0;for(_=10314;_<=10317;_++)U[_]=0;for(_=10448;_<=10465;_++)U[_]=0;for(_=10731;_<=10733;_++)U[_]=0;for(_=11114;_<=11118;_++)U[_]=0;for(_=20004;_<=20032;_++)U[_]=0;for(_=20047;_<=20049;_++)U[_]=0;for(_=20062;_<=20092;_++)U[_]=0;for(_=20135;_<=20138;_++)U[_]=0;for(_=20248;_<=20258;_++)U[_]=0;for(_=20348;_<=20358;_++)U[_]=0;for(_=20436;_<=20440;_++)U[_]=0;for(_=20822;_<=20824;_++)U[_]=0;for(_=20904;_<=20932;_++)U[_]=0;for(_=20934;_<=20936;_++)U[_]=0;for(_=21004;_<=21032;_++)U[_]=0;for(_=21035;_<=21037;_++)U[_]=0;for(_=21095;_<=21097;_++)U[_]=0;for(_=21148;_<=21150;_++)U[_]=0;for(_=21207;_<=21264;_++)U[_]=0;for(_=21307;_<=21364;_++)U[_]=0;for(_=21413;_<=21423;_++)U[_]=0;for(_=21453;_<=21463;_++)U[_]=0;for(_=21473;_<=21483;_++)U[_]=0;for(_=21780;_<=21782;_++)U[_]=0;for(_=21891;_<=21894;_++)U[_]=0;for(_=21896;_<=21899;_++)U[_]=0;for(_=22171;_<=22177;_++)U[_]=0;for(_=22181;_<=22187;_++)U[_]=0;for(_=22191;_<=22197;_++)U[_]=0;for(_=22207;_<=22222;_++)U[_]=0;for(_=22229;_<=22232;_++)U[_]=0;for(_=22234;_<=22236;_++)U[_]=0;for(_=22243;_<=22250;_++)U[_]=0;for(_=22262;_<=22265;_++)U[_]=0;for(_=22307;_<=22322;_++)U[_]=0;for(_=22348;_<=22357;_++)U[_]=0;for(_=22407;_<=22422;_++)U[_]=0;for(_=22462;_<=22465;_++)U[_]=0;for(_=22521;_<=22525;_++)U[_]=0;for(_=22607;_<=22622;_++)U[_]=0;for(_=22641;_<=22646;_++)U[_]=0;for(_=22648;_<=22657;_++)U[_]=0;for(_=22707;_<=22722;_++)U[_]=0;for(_=22762;_<=22765;_++)U[_]=0;for(_=22807;_<=22822;_++)U[_]=0;for(_=22991;_<=22994;_++)U[_]=0;for(_=23028;_<=23038;_++)U[_]=0;for(_=23301;_<=23333;_++)U[_]=2;for(_=23830;_<=23853;_++)U[_]=0;for(_=23866;_<=23872;_++)U[_]=0;for(_=23877;_<=23884;_++)U[_]=0;for(_=23886;_<=23894;_++)U[_]=0;for(_=23946;_<=23948;_++)U[_]=0;for(_=24311;_<=24313;_++)U[_]=0;for(_=24342;_<=24347;_++)U[_]=0;for(_=24370;_<=24374;_++)U[_]=10;for(_=24375;_<=24381;_++)U[_]=0;for(_=24718;_<=24721;_++)U[_]=0;for(_=24817;_<=24821;_++)U[_]=0;for(_=24877;_<=24882;_++)U[_]=0;for(_=24891;_<=24893;_++)U[_]=0;for(_=25391;_<=25395;_++)U[_]=0;for(_=25828;_<=25838;_++)U[_]=0;for(_=26191;_<=26195;_++)U[_]=0;for(_=26391;_<=26393;_++)U[_]=0;for(_=26701;_<=26722;_++)U[_]=0;for(_=26729;_<=26799;_++)U[_]=2;for(_=26801;_<=26803;_++)U[_]=2;for(_=26811;_<=26813;_++)U[_]=2;for(_=26847;_<=26870;_++)U[_]=2;for(_=26891;_<=26899;_++)U[_]=0;for(_=26901;_<=26923;_++)U[_]=0;for(_=26929;_<=26946;_++)U[_]=0;for(_=26948;_<=26998;_++)U[_]=0;for(_=27037;_<=27040;_++)U[_]=0;for(_=27205;_<=27232;_++)U[_]=0;for(_=27258;_<=27260;_++)U[_]=0;for(_=27391;_<=27398;_++)U[_]=0;for(_=27561;_<=27564;_++)U[_]=0;for(_=27571;_<=27574;_++)U[_]=0;for(_=27581;_<=27584;_++)U[_]=0;for(_=27591;_<=27594;_++)U[_]=0;for(_=27700;_<=27707;_++)U[_]=0;for(_=28191;_<=28193;_++)U[_]=0;for(_=28348;_<=28358;_++)U[_]=0;for(_=28402;_<=28432;_++)U[_]=0;for(_=28462;_<=28492;_++)U[_]=0;for(_=29118;_<=29122;_++)U[_]=0;for(_=29168;_<=29172;_++)U[_]=0;for(_=29177;_<=29185;_++)U[_]=0;for(_=29187;_<=29195;_++)U[_]=0;for(_=29900;_<=29903;_++)U[_]=0;for(_=30161;_<=30179;_++)U[_]=0;for(_=30491;_<=30494;_++)U[_]=0;for(_=30729;_<=30732;_++)U[_]=0;for(_=31251;_<=31259;_++)U[_]=0;for(_=31265;_<=31268;_++)U[_]=0;for(_=31275;_<=31279;_++)U[_]=0;for(_=31281;_<=31297;_++)U[_]=0;for(_=31461;_<=31469;_++)U[_]=0;for(_=31491;_<=31495;_++)U[_]=0;for(_=31917;_<=31922;_++)U[_]=0;for(_=31965;_<=32e3;_++)U[_]=0;for(_=32001;_<=32003;_++)U[_]=2;for(_=32005;_<=32031;_++)U[_]=2;for(_=32033;_<=32060;_++)U[_]=2;for(_=32064;_<=32067;_++)U[_]=2;for(_=32074;_<=32077;_++)U[_]=2;for(_=32081;_<=32086;_++)U[_]=0;for(_=32107;_<=32130;_++)U[_]=0;for(_=32133;_<=32159;_++)U[_]=0;for(_=32164;_<=32167;_++)U[_]=2;for(_=32180;_<=32199;_++)U[_]=0;for(_=32201;_<=32260;_++)U[_]=0;for(_=32301;_<=32360;_++)U[_]=0;for(_=32401;_<=32460;_++)U[_]=0;for(_=32501;_<=32560;_++)U[_]=0;for(_=32601;_<=32662;_++)U[_]=0;for(_=32664;_<=32667;_++)U[_]=2;for(_=32701;_<=32761;_++)U[_]=0;for(_=53001;_<=53004;_++)U[_]=0;for(_=53008;_<=53019;_++)U[_]=0;for(_=53021;_<=53032;_++)U[_]=0;for(_=53034;_<=53037;_++)U[_]=0;for(_=53042;_<=53046;_++)U[_]=0;for(_=53074;_<=53080;_++)U[_]=0;for(_=54001;_<=54004;_++)U[_]=0;for(_=54008;_<=54019;_++)U[_]=0;for(_=54021;_<=54032;_++)U[_]=0;for(_=54034;_<=54037;_++)U[_]=0;for(_=54042;_<=54046;_++)U[_]=0;for(_=54048;_<=54053;_++)U[_]=0;for(_=54074;_<=54080;_++)U[_]=0;for(_=54098;_<=54101;_++)U[_]=0;for(_=102001;_<=102040;_++)U[_]=0;for(_=102042;_<=102063;_++)U[_]=0;for(_=102065;_<=102067;_++)U[_]=0;for(_=102070;_<=102117;_++)U[_]=0;for(_=102122;_<=102216;_++)U[_]=0;for(_=102221;_<=102377;_++)U[_]=0;for(_=102382;_<=102388;_++)U[_]=0;for(_=102389;_<=102398;_++)U[_]=2;for(_=102399;_<=102444;_++)U[_]=0;for(_=102445;_<=102447;_++)U[_]=2;for(_=102448;_<=102458;_++)U[_]=0;for(_=102459;_<=102468;_++)U[_]=2;for(_=102469;_<=102499;_++)U[_]=0;for(_=102500;_<=102519;_++)U[_]=1;for(_=102520;_<=102524;_++)U[_]=0;for(_=102525;_<=102529;_++)U[_]=2;for(_=102530;_<=102588;_++)U[_]=0;for(_=102590;_<=102598;_++)U[_]=0;for(_=102601;_<=102603;_++)U[_]=0;for(_=102605;_<=102628;_++)U[_]=0;for(_=102629;_<=102646;_++)U[_]=2;for(_=102648;_<=102700;_++)U[_]=2;for(_=102701;_<=102703;_++)U[_]=0;for(_=102707;_<=102730;_++)U[_]=2;for(_=102733;_<=102758;_++)U[_]=2;for(_=102767;_<=102900;_++)U[_]=0;for(_=102901;_<=102933;_++)U[_]=2;for(_=102934;_<=102950;_++)U[_]=13;for(_=102951;_<=102963;_++)U[_]=0;for(_=102965;_<=102969;_++)U[_]=0;for(_=102971;_<=102973;_++)U[_]=0;for(_=102975;_<=102989;_++)U[_]=0;for(_=102990;_<=102992;_++)U[_]=1;for(_=102997;_<=103002;_++)U[_]=0;for(_=103003;_<=103008;_++)U[_]=2;for(_=103009;_<=103011;_++)U[_]=0;for(_=103012;_<=103014;_++)U[_]=2;for(_=103019;_<=103021;_++)U[_]=0;for(_=103022;_<=103024;_++)U[_]=2;for(_=103029;_<=103031;_++)U[_]=0;for(_=103032;_<=103034;_++)U[_]=2;for(_=103065;_<=103068;_++)U[_]=0;for(_=103074;_<=103076;_++)U[_]=0;for(_=103077;_<=103079;_++)U[_]=1;for(_=103080;_<=103082;_++)U[_]=0;for(_=103083;_<=103085;_++)U[_]=2;for(_=103090;_<=103093;_++)U[_]=0;for(_=103097;_<=103099;_++)U[_]=0;for(_=103100;_<=103102;_++)U[_]=2;for(_=103107;_<=103109;_++)U[_]=0;for(_=103110;_<=103112;_++)U[_]=2;for(_=103113;_<=103116;_++)U[_]=0;for(_=103117;_<=103120;_++)U[_]=2;for(_=103153;_<=103157;_++)U[_]=0;for(_=103158;_<=103162;_++)U[_]=2;for(_=103163;_<=103165;_++)U[_]=0;for(_=103166;_<=103168;_++)U[_]=1;for(_=103169;_<=103171;_++)U[_]=2;for(_=103186;_<=103188;_++)U[_]=0;for(_=103189;_<=103191;_++)U[_]=2;for(_=103192;_<=103195;_++)U[_]=0;for(_=103196;_<=103199;_++)U[_]=2;for(_=103200;_<=103224;_++)U[_]=0;for(_=103225;_<=103227;_++)U[_]=1;for(_=103232;_<=103237;_++)U[_]=0;for(_=103238;_<=103243;_++)U[_]=2;for(_=103244;_<=103246;_++)U[_]=0;for(_=103247;_<=103249;_++)U[_]=2;for(_=103254;_<=103256;_++)U[_]=0;for(_=103257;_<=103259;_++)U[_]=2;for(_=103264;_<=103266;_++)U[_]=0;for(_=103267;_<=103269;_++)U[_]=2;for(_=103300;_<=103375;_++)U[_]=0;for(_=103381;_<=103383;_++)U[_]=0;for(_=103384;_<=103386;_++)U[_]=1;for(_=103387;_<=103389;_++)U[_]=0;for(_=103390;_<=103392;_++)U[_]=2;for(_=103397;_<=103399;_++)U[_]=0;for(_=103400;_<=103471;_++)U[_]=2;for(_=103476;_<=103478;_++)U[_]=0;for(_=103479;_<=103481;_++)U[_]=2;for(_=103486;_<=103488;_++)U[_]=0;for(_=103489;_<=103491;_++)U[_]=2;for(_=103492;_<=103495;_++)U[_]=0;for(_=103496;_<=103499;_++)U[_]=2;for(_=103528;_<=103543;_++)U[_]=0;for(_=103544;_<=103548;_++)U[_]=2;for(_=103549;_<=103551;_++)U[_]=0;for(_=103552;_<=103554;_++)U[_]=1;for(_=103555;_<=103557;_++)U[_]=2;for(_=103558;_<=103560;_++)U[_]=0;for(_=103571;_<=103573;_++)U[_]=0;for(_=103574;_<=103576;_++)U[_]=2;for(_=103577;_<=103580;_++)U[_]=0;for(_=103581;_<=103583;_++)U[_]=2;for(_=103595;_<=103694;_++)U[_]=0;for(_=103696;_<=103699;_++)U[_]=0;for(_=103700;_<=103793;_++)U[_]=2;for(_=103794;_<=103890;_++)U[_]=0;for(_=103891;_<=103896;_++)U[_]=2;for(_=103900;_<=103971;_++)U[_]=2;for(_=103972;_<=103977;_++)U[_]=0;for(_=112e3;_<=112101;_++)U[_]=0;const URe=[102100,102113,3857,3785],IQe=[104905,104971],$Qe=[4326,...URe,...IQe],Bme='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',iU=[-20037508342788905e-9,20037508342788905e-9],rU=[-20037508342787e-6,20037508342787e-6],BRe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:iU,origin:rU,dx:1e-5},102100:{wkTemplate:Bme,valid:iU,origin:rU,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:iU,origin:rU,dx:1e-5},3857:{wkTemplate:Bme,valid:iU,origin:rU,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Bs(t,e){if(t===e)return!0;if(t==null||e==null)return!1;const i=t.wkid,r=e.wkid;if(i!=null||r!=null){if(i===r||cg(t)&&cg(e))return!0;const o=t.latestWkid;if(o!=null&&r===o)return!0;const a=e.latestWkid;return a!=null&&i===a}let s,n;return t.wkt2&&e.wkt2?(s=t.wkt2,n=e.wkt2):t.wkt&&e.wkt&&(s=t.wkt,n=e.wkt),!(!s||!n)&&s.toUpperCase()===n.toUpperCase()}function Cv(t){const e=t?.wkid;return e!=null&&e>=2e3&&BRe[e]||null}function zme(t){if(!t)return;const{wkid:e,vcsWkid:i}=t;if(e)return i?JSON.stringify({wkid:e,vcsWkid:i}):String(e);const r=t.wkt||t.wkt2;return JSON.stringify(r?i?{wkt:r,vcsWkid:i}:{wkt:r}:{})}function Ak(t){if(!Bm(t))return!1;const{wkid:e}=t;if(e)return U[e]==null;const i=t.wkt2||t.wkt;return!!i&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(i)}function EE(t){return!(pC(t)||fC(t))}function Uv(t){return t?.wkid===4326}function Ili(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function mO(t){return t?.wkid===yh.CGCS2000}function cg(t){const e=t?.wkid;return e!=null&&e>=2e3&&URe.includes(e)}function CE(t){return t?.wkid===32662}function gO(t){return t===yh.GCSMARS2000||t===yh.GCSMARS2000_SPHERE}function pC(t){return gO(t?.wkid)}function yO(t){return t===yh.GCSMOON2000}function fC(t){return yO(t?.wkid)}function NQe(t){const e=t?.wkid;return e!=null&&e>=2e3&&$Qe.includes(e)}function Bm(t){if(t==null)return!1;const e=t.wkid;return e!=null&&e>=2e3||t.wkt2!=null||t.wkt!=null}const zRe={wkid:4326,wkt:oq(BRe[4326].wkTemplate,{Central_Meridian:"0.0"})},VRe={wkid:102100,latestWkid:3857},LQe={wkid:32662};function Dle(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const GRe=Dle(br),yq=Dle(Qm),_q=Dle(kv),jRe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${br.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`},DQe=yq.wkt.toUpperCase(),FQe=_q.wkt.toUpperCase();function $r(t){if(t!=null&&Bm(t)){const e=t.wkid,i=t.wkt2??t.wkt;if(gO(e))return Qm;const r=i?.toUpperCase();if(i&&r===DQe)return Qm;if(yO(e)||r&&r===FQe)return kv}return br}function $li(t){return gO(t)?Qm:yO(t)?kv:br}function sF(t){return Bs(t,GRe)}function Jw(t){return sF(t)||Bs(t,yq)||Bs(t,_q)}const Fle=39.37,kQe=br.radius*Math.PI/200,HRe=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,W2=U,qRe=/UNIT\[([^\]]+)]/i,UQe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),BQe=Yc()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Ag=t=>t*t,S1=t=>t*t*t,nF={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Ag(.001)},"square-centimeters":{inBaseUnits:Ag(.01)},"square-decimeters":{inBaseUnits:Ag(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Ag(1e3)},"square-inches":{inBaseUnits:Ag(.0254)},"square-feet":{inBaseUnits:Ag(.3048)},"square-yards":{inBaseUnits:Ag(.9144)},"square-miles":{inBaseUnits:Ag(1609.344)},"square-us-feet":{inBaseUnits:Ag(1200/3937)},acres:{inBaseUnits:.0015625*Ag(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*S1(.001)},"cubic-centimeters":{inBaseUnits:1e3*S1(.01)},"cubic-decimeters":{inBaseUnits:1e3*S1(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*S1(1e3)},"cubic-inches":{inBaseUnits:1e3*S1(.0254)},"cubic-feet":{inBaseUnits:1e3*S1(.3048)},"cubic-yards":{inBaseUnits:1e3*S1(.9144)},"cubic-miles":{inBaseUnits:1e3*S1(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},zQe=(()=>{const t={};for(const e in nF)for(const i in nF[e].units)t[i]=e;return t})();function VQe(t,e,i){return t*nF[i].units[e].inBaseUnits}function GQe(t,e,i){return t/nF[i].units[e].inBaseUnits}const WRe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],jQe=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function ME(t){const e=zQe[t];if(!e)throw new Error("unknown type");return e}function Vme(t,e=null){return e=e||ME(t),nF[e].baseUnit===t}function ko(t,e,i){if(e===i)return t;const r=ME(e);if(r!==ME(i))throw new Error("incompatible units");const s=Vme(e,r)?t:VQe(t,e,r);return Vme(i,r)?s:GQe(s,i,r)}function HQe(t){switch(t){case"metric":return"meters";case"imperial":return"feet";default:return t}}function Nli(t){return HQe(t)}function Lli(t){switch(t){case"metric":return"square-meters";case"imperial":return"square-feet";default:return t}}function Dli(t,e,i){switch(i){case"metric":return qQe(t,e);case"imperial":return YQe(t,e);default:return i}}function Fli(t,e,i){switch(i){case"metric":return WQe(t,e);case"imperial":return XQe(t,e);default:return i}}function qQe(t,e){const i=ko(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function WQe(t,e){const i=ko(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function YQe(t,e){const i=ko(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function XQe(t,e){const i=ko(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function kli(t,e){const i=ko(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function Uli(t,e){const i=ko(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function ZQe(t,e,i){return ko(t,e,"meters")/(i*Math.PI/180)}function YRe(t){return BQe.fromJSON(t.toLowerCase())||null}function AE(t){if(t!=null&&!EE(t))return 1;const e=Xc(t);return e>1e5?1:e}function XRe(t){return Xc(t)>=$r(t).metersPerDegree?"meters":Rk(t)}function Xc(t,e=br.metersPerDegree){return JQe(t,!0)??e}function JQe(t,e=!1){const i=t?.wkid??null,r=t?.wkt2??t?.wkt??null;let s=null;if(i){if(gO(i))return Qm.metersPerDegree;if(yO(i))return kv.metersPerDegree;s=W2.values[W2[i]],!s&&e&&UQe.has(i)&&(s=kQe)}else r&&(ePe(r)?s=jme(HRe.exec(r),s):KRe(r)&&(s=jme(qRe.exec(r),s)));return s}function Gme(t){return Ak(t)?1:Xc(t)}function jme(t,e){return t?.[1]?ZRe(t[1]):e}function ZRe(t){return parseFloat(t.split(",")[1])}function Rk(t){const e=t?.wkid??null,i=t?.wkt2??t?.wkt??null;let r=null;if(e)r=W2.units[W2[e]];else if(i){const s=ePe(i)?HRe:KRe(i)?qRe:null;if(s){const n=s.exec(i);n?.[1]&&(r=KQe(n[1]))}}return r!=null?YRe(r):null}function JRe(t){const e=Rk(t);return e!=null&&WRe.includes(e)?e:null}function QRe(t){const e=XRe(t);return e!=null&&WRe.includes(e)?e:null}function Bli(t){const e=Rk(t);return e==null?null:jQe.get(e)}function KRe(t){return/^GEOCCS/i.test(t)}function ePe(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const QQe=1e-7;function KQe(t){let i=/[\\"']{1}([^\\"']+)/.exec(t)?.[1];if(!i||!W2.units.includes(i)){const r=ZRe(t);i=null;const s=W2.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<QQe){i=W2.units[n];break}}return i}function zli(t){const e=Rk(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const eKe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},tKe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},iKe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},rKe=Yc()(eKe),sKe=Yc()(tKe),Vli=Yc()(iKe);var Qg;let Jr=Qg=class extends we{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return Qg.WebMercator;if(t.wkid===4326)return Qg.WGS84}const e=new Qg;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return Uv(this)}get isWebMercator(){return cg(this)}get isGeographic(){return Ak(this)}get isWrappable(){return NQe(this)}get metersPerUnit(){return Xc(this)}get unit(){return Rk(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Qg.WGS84)return new Qg(zRe);if(this===Qg.WebMercator)return new Qg(VRe);const t=new Qg;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(t.wkt=this.wkt),this.wkt2!=null&&(t.wkt2=this.wkt2)),this.imageCoordinateSystem&&(t.imageCoordinateSystem=ee(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:i}=t.imageCoordinateSystem,{geodataXform:r}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||r?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):i?s.id===e&&s.referenceServiceName===i:s.id===e}return Bs(this,t)}toJSON(t){return this.write(void 0,t)}};Jr.GCS_NAD_1927=null,Jr.WGS84=null,Jr.WebMercator=null,Jr.PlateCarree=null,d([m({readOnly:!0})],Jr.prototype,"isWGS84",null),d([m({readOnly:!0})],Jr.prototype,"isWebMercator",null),d([m({readOnly:!0})],Jr.prototype,"isGeographic",null),d([m({readOnly:!0})],Jr.prototype,"isWrappable",null),d([m({type:cr,json:{write:!0}})],Jr.prototype,"latestWkid",void 0),d([m({readOnly:!0})],Jr.prototype,"metersPerUnit",null),d([m({readOnly:!0})],Jr.prototype,"unit",null),d([m({type:cr,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],Jr.prototype,"wkid",void 0),d([m({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],Jr.prototype,"wkt",void 0),d([Ve("wkt"),Ve("web-scene","wkt")],Jr.prototype,"writeWkt",null),d([m({type:String,json:{write:!1}})],Jr.prototype,"wkt2",void 0),d([m({type:cr,json:{write:!0}})],Jr.prototype,"vcsWkid",void 0),d([m({type:cr,json:{write:!0}})],Jr.prototype,"latestVcsWkid",void 0),d([m()],Jr.prototype,"imageCoordinateSystem",void 0),Jr=Qg=d([N("esri.geometry.SpatialReference")],Jr),Jr.prototype.toJSON.isDefaultToJSON=!0,Jr.GCS_NAD_1927=new Jr({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Jr.WGS84=new Jr(zRe),Jr.WebMercator=new Jr(VRe),Jr.PlateCarree=new Jr(LQe),Object.freeze&&(Object.freeze(Jr.GCS_NAD_1927),Object.freeze(Jr.WGS84),Object.freeze(Jr.WebMercator),Object.freeze(Jr.PlateCarree));const Je=Jr;function Le(t,e,i){let r,s;return e===void 0||Array.isArray(e)?(s=t,i=e,r=[void 0]):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=YAe(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}let Kg=class extends we{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Je.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof Je)return e;if(e!=null){const r=new Je;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};d([m()],Kg.prototype,"type",void 0),d([m({readOnly:!0})],Kg.prototype,"cache",null),d([m({readOnly:!0})],Kg.prototype,"extent",null),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Kg.prototype,"hasM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Kg.prototype,"hasZ",void 0),d([m({type:Je,json:{write:!0},value:Je.WGS84})],Kg.prototype,"spatialReference",void 0),d([Le("spatialReference")],Kg.prototype,"readSpatialReference",null),Kg=d([N("esri.geometry.Geometry")],Kg);const Px=Kg,nKe=Object.prototype.toString;function oKe(t){const e="__accessorMetadata__"in t?Tn(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return aKe.apply(this,i)}}function aKe(t,e,i,r){lq(t,e).cast=r}function lKe(t){return(e,i)=>{lq(e,t).cast=e[i]}}function vi(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&nKe.call(t[0])==="[object Function]"?oKe(t[0]):t.length===1&&typeof t[0]=="string"?lKe(t[0]):void 0}const cKe=57.29577951308232,uKe=.017453292519943;function Hme(t){return t*cKe}function qme(t){return t*uKe}function Wme(t){return t/br.radius}function nj(t){return Math.PI/2-2*Math.atan(Math.exp(-t/br.radius))}function EK(t){return t.wkid!=null||t.wkt!=null}const yW=[0,0];function oj(t,e,i,r,s){const n=t,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,yW,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,yW,r),[o.xmax,o.ymax]=e(n.xmax,n.ymax,yW,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let u=0;u<a.length;u++){const h=a[u];c=[],l.push(c);for(let p=0;p<h.length;p++)c.push(e(h[p][0],h[p][1],[0,0],r)),h[p].length>2&&c[p].push(h[p][2]),h[p].length>3&&c[p].push(h[p][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function eV(t,e){const i=t&&(EK(t)?t:t.spatialReference),r=e&&(EK(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!Bs(r,i)||cg(r)&&Uv(i)||cg(i)&&Uv(r))}function Pk(t,e){if(t==null)return null;const i=t.spatialReference,r=e&&(EK(e)?e:e.spatialReference);return eV(i,r)?Bs(i,r)?ee(t):cg(r)?oj(t,NR,Je.WebMercator,!1,ee(t)):Uv(r)?oj(t,vq,Je.WGS84,!1,ee(t)):null:null}function NR(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=qme(e);return i[0]=qme(t)*br.radius,i[1]=br.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function vq(t,e,i=[0,0],r=!1){const s=Hme(t/br.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=Hme(Math.PI/2-2*Math.atan(Math.exp(-e/br.radius))),i}function JL(t,e=!1,i=ee(t)){return oj(t,NR,Je.WebMercator,e,i)}function q3(t,e=!1,i=ee(t)){return oj(t,vq,Je.WGS84,e,i)}function hKe(t,e){const i=t.x-e.x,r=t.y-e.y,s=t.z!=null&&e.z!=null?t.z-e.z:0;return Math.sqrt(i*i+r*r+s*s)}function dKe(t){return tPe(t,iPe)?.[0]??null}function pKe(t){return tPe(t,iPe)?.[1]??null}function tPe({x:t,y:e,spatialReference:i},r=[0,0]){if(i){if(cg(i))return vq(t,e,r);if(Ak(i))return r[0]=t,r[1]=e,r}return null}const iPe=[0,0];var tV;const _W=[0,0];function Yme(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let hu=tV=class extends Px{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],i=n[2],r=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Je(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)oe.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)oe.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s?.isWebMercator){const a=NR(n.longitude,n.latitude,_W);t=a[0],e=a[1]}}}else Yme(i)?(s=i,i=null):Yme(r)&&(s=r,r=null);const o={x:t,y:e};return o.x==null&&o.y!=null?oe.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&oe.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){return pKe(this)}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",NR(i,t,_W)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){return dKe(this)}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",NR(t,e,_W)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new tV;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return tV.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:u}=t;if(!n.equals(u))if(n.isWebMercator&&u.isWGS84)[l,c]=NR(l,c),u=n;else{if(!n.isWGS84||!u.isWebMercator)return!1;[l,c]=vq(l,c),u=n}return e===l&&i===c&&r===o&&s===a&&n.wkid===u.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=Cv(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,s=2*r;let n;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s),this._set("x",e),this}distance(t){return hKe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],hu.prototype,"cache",null),d([m({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],hu.prototype,"hasM",null),d([m({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],hu.prototype,"hasZ",null),d([m({type:Number})],hu.prototype,"latitude",null),d([m({type:Number})],hu.prototype,"longitude",null),d([m({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),vi(t=>isNaN(t)?t:Gp(t))],hu.prototype,"x",void 0),d([Ve("x")],hu.prototype,"writeX",null),d([Le("x")],hu.prototype,"readX",null),d([m({type:Number,json:{write:!0}})],hu.prototype,"y",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],hu.prototype,"z",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],hu.prototype,"m",void 0),hu=tV=d([N("esri.geometry.Point")],hu),hu.prototype.toJSON.isDefaultToJSON=!0;const $t=hu,vW=[0,0];function kle(t,e){return e!=null&&Ic(t,e.x,e.y,e.z)}function jli(t,e){if(!e.points||e.points.length)return!1;for(const i of e.points)if(!_O(t,i))return!1;return!0}function fKe(t,e){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?Ic(t,i,r,s)&&Ic(t,i,o,s)&&Ic(t,n,o,s)&&Ic(t,n,r,s)&&Ic(t,i,r,a)&&Ic(t,i,o,a)&&Ic(t,n,o,a)&&Ic(t,n,r,a):Ic(t,i,r)&&Ic(t,i,o)&&Ic(t,n,o)&&Ic(t,n,r)}function _O(t,e){return Ic(t,e[0],e[1])}function mKe(t,e){return Ic(t,e[0],e[1],e[2])}function Ic(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function gKe(t,e){return vW[1]=e.y,vW[0]=e.x,yKe(t,vW)}function yKe(t,e){return rPe(t.rings,e)}function rPe(t,e){if(!t)return!1;if(_Ke(t))return Xme(!1,t,e);let i=!1;for(let r=0,s=t.length;r<s;r++)i=Xme(i,t[r],e);return i}function _Ke(t){return!Array.isArray(t[0][0])}function Xme(t,e,i){const[r,s]=i;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=e[a],[h,p]=e[o];(u<s&&p>=s||p<s&&u>=s)&&c+(s-u)/(p-u)*(h-c)<r&&(n=!n)}return n}function vKe(t,e){return kle(t,e)}function bKe(t,e){const i=t.hasZ&&e.hasZ;let r,s,n;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function wKe(t,e){const{points:i,hasZ:r}=e,s=r?mKe:_O;for(const n of i)if(s(t,n))return!0;return!1}const RE=[0,0],PE=[0,0],OE=[0,0],IE=[0,0],xKe=[RE,PE,OE,IE],sPe=[[OE,RE],[RE,PE],[PE,IE],[IE,OE]];function SKe(t,e){return TKe(t,e.rings)}function TKe(t,e){RE[0]=t.xmin,RE[1]=t.ymax,PE[0]=t.xmax,PE[1]=t.ymax,OE[0]=t.xmin,OE[1]=t.ymin,IE[0]=t.xmax,IE[1]=t.ymin;for(const i of xKe)if(rPe(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(_O(t,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(_O(t,n)||nPe(r,n,sPe))return!0;r=n}}return!1}function EKe(t,e){RE[0]=t.xmin,RE[1]=t.ymax,PE[0]=t.xmax,PE[1]=t.ymax,OE[0]=t.xmin,OE[1]=t.ymin,IE[0]=t.xmax,IE[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(_O(t,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(_O(t,o)||nPe(s,o,sPe))return!0;s=o}}return!1}const Qa=[0,0];function CKe(t){for(let e=0;e<t.length;e++){const i=t[e];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],u=t[a][l+1];if(aj(n,o,c,u,Qa)&&!(Qa[0]===n[0]&&Qa[1]===n[1]||Qa[0]===c[0]&&Qa[1]===c[1]||Qa[0]===o[0]&&Qa[1]===o[1]||Qa[0]===u[0]&&Qa[1]===u[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],u=i[l+1];if(aj(o,a,c,u,Qa)&&!(Qa[0]===o[0]&&Qa[1]===o[1]||Qa[0]===c[0]&&Qa[1]===c[1]||Qa[0]===a[0]&&Qa[1]===a[1]||Qa[0]===u[0]&&Qa[1]===u[1]))return!0}}}return!1}function nPe(t,e,i){for(let r=0;r<i.length;r++)if(aj(t,e,i[r][0],i[r][1]))return!0;return!1}function aj(t,e,i,r,s){const[n,o]=t,[a,l]=e,[c,u]=i,[h,p]=r,f=h-c,g=n-c,y=a-n,v=p-u,b=o-u,w=l-o,x=v*y-f*w;if(x===0)return!1;const S=(f*b-v*g)/x,E=(y*b-w*g)/x;return S>=0&&S<=1&&E>=0&&E<=1&&(s&&(s[0]=n+S*(a-n),s[1]=o+S*(l-o)),!0)}function MKe(t){switch(t){case"esriGeometryEnvelope":case"extent":return bKe;case"esriGeometryMultipoint":case"multipoint":return wKe;case"esriGeometryPoint":case"point":return vKe;case"esriGeometryPolygon":case"polygon":return SKe;case"esriGeometryPolyline":case"polyline":return EKe}}var pp;function AKe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function T1(t,e,i){return e==null?i:i==null?e:t(e,i)}let Ra=pp=class extends Px{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,s){return AKe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?Je.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:s??Je.WGS84}}static fromBounds(t,e){return new pp({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new pp({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new $t({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new pp;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&eV(e,i)&&(t=e.isWebMercator?JL(t):q3(t,!0)),t.type==="point"?kle(this,t):t.type==="extent"&&fKe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&eV(e,i)&&(t=e.isWebMercator?JL(t):q3(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!Bs(e,i)&&eV(e,i)&&(t=e.isWebMercator?JL(t):q3(t,!0)),MKe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=T1(Math.min,this.zmin,t.zmin),this.zmax=T1(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=T1(Math.min,this.mmin,t.mmin),this.mmax=T1(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=T1(Math.max,this.zmin,t.zmin),this.zmax=T1(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=T1(Math.max,this.mmin,t.mmin),this.mmax=T1(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=Cv(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?q3(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=bW(r.x,t).x),this.spatialReference=new Je(oq((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const s=i??Cv(r);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let h=0;h<c.length;h++)c[h].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let h=0;h<c.length;h++)c[h].push(u)}return c}),hasZ:o,hasM:a,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;t=t||Cv(o);const[h,p]=t.valid;u=bW(this.xmin,t);const f=u.x,g=u.frameId;u=bW(this.xmax,t);const y=u.x,v=u.frameId,b=f===y&&a>0;if(a>2*p){const w=new pp(l<c?f:y,s,p,n,o),x=new pp(h,s,l<c?y:f,n,o),S=new pp(0,s,p,n,o),E=new pp(h,s,0,n,o),C=[],R=[];w.contains(S)&&C.push(g),w.contains(E)&&R.push(g),x.contains(S)&&C.push(v),x.contains(E)&&R.push(v);for(let I=g+1;I<v;I++)C.push(I),R.push(I);e.push({extent:w,frameIds:[g]},{extent:x,frameIds:[v]},{extent:S,frameIds:C},{extent:E,frameIds:R})}else f>y||b?e.push({extent:new pp(f,s,p,n,o),frameIds:[g]},{extent:new pp(h,s,y,n,o),frameIds:[v]}):e.push({extent:new pp(f,s,y,n,o),frameIds:[g]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}};function bW(t,e){const[i,r]=e.valid,s=2*r;let n,o=0;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s,o=n):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s,o=-n),{x:t,frameId:o}}d([m({readOnly:!0})],Ra.prototype,"cache",null),d([m({readOnly:!0})],Ra.prototype,"center",null),d([m({readOnly:!0})],Ra.prototype,"extent",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Ra.prototype,"hasM",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Ra.prototype,"hasZ",null),d([m({readOnly:!0})],Ra.prototype,"height",null),d([m({readOnly:!0})],Ra.prototype,"width",null),d([m({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Ra.prototype,"xmin",void 0),d([m({type:Number,json:{write:!0}})],Ra.prototype,"ymin",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ra.prototype,"mmin",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ra.prototype,"zmin",void 0),d([m({type:Number,json:{write:!0}})],Ra.prototype,"xmax",void 0),d([m({type:Number,json:{write:!0}})],Ra.prototype,"ymax",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ra.prototype,"mmax",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ra.prototype,"zmax",void 0),Ra=pp=d([N("esri.geometry.Extent")],Ra),Ra.prototype.toJSON.isDefaultToJSON=!0;const lr=Ra;let QL;const RKe=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale;function oPe(){return RKe??globalThis.navigator?.language??"en"}function Eh(){return QL===void 0&&(QL=oPe()),QL}function PKe(t=Eh()){return/^([a-zA-Z]{2,3})(?:[_-]\w+)*$/.exec(t)?.[1].toLowerCase()}const iV=[];function aPe(t){return iV.push(t),er(()=>iV.splice(iV.indexOf(t),1))}const rV=[];function Ule(t){return rV.push(t),er(()=>rV.splice(rV.indexOf(t),1))}function OKe(){const t=oPe();QL!==t&&([...rV].forEach(e=>e(t)),QL=t,[...iV].forEach(e=>e(t)))}globalThis.addEventListener?.("languagechange",OKe);let sU;function IKe(t){return sU&&!sU.destroyed||(sU=t()),sU}var CK;const $Ke=new ur({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let fp=CK=class extends Fe{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new CK({categories:this.categories?ee(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let r="";if(this.extent){const o=Pk(this.extent,Je.WGS84);o!=null&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>$Ke.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};d([m()],fp.prototype,"categories",void 0),d([m()],fp.prototype,"disableExtraQuery",void 0),d([m({type:lr})],fp.prototype,"extent",void 0),d([m()],fp.prototype,"filter",void 0),d([m()],fp.prototype,"num",void 0),d([m()],fp.prototype,"query",void 0),d([m()],fp.prototype,"sortField",void 0),d([m()],fp.prototype,"sortOrder",null),d([m()],fp.prototype,"start",void 0),fp=CK=d([N("esri.portal.PortalQueryParams")],fp);const Fy=fp;var MK;let ra=MK=class extends we{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e&&this.portal?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){const t=this.portal?.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const i=e.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):i})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new j("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new MK({sourceJSON:t});return e.read(t),e}queryItems(t,e){let i=Tn(Fy,t);const r=this.portal;return parseFloat(r.currentVersion)>5?(i=i||new Fy,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",e)):(i=i?i.clone():new Fy,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,e))}_fetchCategorySchemaSet(t,e){const i=this.portal;return i.fetchSelf(i.authMode,!0,e).then(r=>{const s=r.contentCategorySetsGroupQuery;if(s){const n=new Fy({disableExtraQuery:!0,num:1,query:s});return i.queryGroups(n,e)}throw new j("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const s=r.results[0],n=new Fy({num:1,query:`typekeywords:"${t}"`});return s.queryItems(n,e)}throw new j("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",e).then(s=>{const n=s?.categorySchema;return n?.length?n:[]}):[])}};d([m()],ra.prototype,"access",void 0),d([m({type:Date})],ra.prototype,"created",void 0),d([m()],ra.prototype,"description",void 0),d([m()],ra.prototype,"id",void 0),d([m()],ra.prototype,"isInvitationOnly",void 0),d([m({type:Date})],ra.prototype,"modified",void 0),d([m()],ra.prototype,"owner",void 0),d([m()],ra.prototype,"portal",void 0),d([m()],ra.prototype,"snippet",void 0),d([m()],ra.prototype,"sortField",void 0),d([m()],ra.prototype,"sortOrder",void 0),d([m()],ra.prototype,"sourceJSON",void 0),d([m()],ra.prototype,"tags",void 0),d([m()],ra.prototype,"thumbnail",void 0),d([m({readOnly:!0})],ra.prototype,"thumbnailUrl",null),d([m()],ra.prototype,"title",void 0),d([m({readOnly:!0})],ra.prototype,"url",null),ra=MK=d([N("esri.portal.PortalGroup")],ra);const AK=ra;let sT=class extends Fe{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};d([m()],sT.prototype,"nextQueryParams",void 0),d([m()],sT.prototype,"queryParams",void 0),d([m()],sT.prototype,"results",void 0),d([m()],sT.prototype,"total",void 0),sT=d([N("esri.portal.PortalQueryResult")],sT);const NKe=sT;let T_=class extends we{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new j("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};d([m({type:Date})],T_.prototype,"created",void 0),d([m()],T_.prototype,"id",void 0),d([m()],T_.prototype,"portal",void 0),d([m()],T_.prototype,"title",void 0),d([m({readOnly:!0})],T_.prototype,"url",null),d([m()],T_.prototype,"username",void 0),T_=d([N("esri.portal.PortalFolder")],T_);const LKe=T_;var RK;let Ks=RK=class extends we{constructor(t){super(t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.portal?.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.portal?.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,i=t?.data,r=t?.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}async deleteItem(t,e=!1){let i=this.userContentUrl;t.ownerFolder&&(i+="/"+t.ownerFolder);const r=e?{permanentDelete:!0}:{};await this.portal.request(i+`/items/${t.id}/delete`,{method:"post",query:r}),t.id=null,t.portal=null}async deleteItems(t,e=!1){t=t.concat();const i=this.userContentUrl+"/deleteItems",r=[],s=t.map(n=>n.id);if(s.length){const n={method:"post",query:{items:s.join(","),permanentDelete:e}},o=await this.portal.request(i,n);for(const a of o.results){const l=t.find(h=>a.itemId===h.id),c=a.success;let u=null;c?(l.id=null,l.portal=null):a.error&&(u=new j("portal:delete-item-failed",a.error.message,a.error)),r.push({item:l,success:c,error:u})}}return r}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const s=LKe.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=AK.fromJSON(i);return r.portal=this.portal,r}):[],e})}async fetchItems(t){t??={};let e=this.userContentUrl??"";t.folder&&(e+="/"+t.folder.id);const{default:i}=await ye(()=>Promise.resolve().then(()=>uPe),void 0,import.meta.url),r={folders:!1,inRecycleBin:!!t.inRecycleBin||null,foldersContent:!(t.folder||!t.includeSubfolderItems)||null,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"},s=await this.portal.request(e,{query:r});let n;return s?.items?(n=s.items.map(o=>{const a=i.fromJSON(o);return a.portal=this.portal,a}),await Promise.all(n.map(o=>o.load())),{items:n,nextStart:s.nextStart,total:s.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new AK({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new j("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(t,e){const i=this.userContentUrl,r=e?{folderID:typeof e=="string"?e:e.id}:null;await this.portal.request(i+`/items/${t.id}/restore`,{method:"post",query:r})}toJSON(){throw new j("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new RK({sourceJSON:t});return e.read(t),e}};d([m()],Ks.prototype,"access",void 0),d([m({type:Date})],Ks.prototype,"created",void 0),d([m()],Ks.prototype,"culture",void 0),d([m()],Ks.prototype,"description",void 0),d([m()],Ks.prototype,"email",void 0),d([m()],Ks.prototype,"favGroupId",void 0),d([m()],Ks.prototype,"fullName",void 0),d([m({type:Date})],Ks.prototype,"modified",void 0),d([m()],Ks.prototype,"orgId",void 0),d([m()],Ks.prototype,"portal",void 0),d([m()],Ks.prototype,"preferredView",void 0),d([m()],Ks.prototype,"privileges",void 0),d([m()],Ks.prototype,"region",void 0),d([m()],Ks.prototype,"role",void 0),d([m()],Ks.prototype,"roleId",void 0),d([m()],Ks.prototype,"sourceJSON",void 0),d([m()],Ks.prototype,"thumbnail",void 0),d([m({readOnly:!0})],Ks.prototype,"thumbnailUrl",null),d([m()],Ks.prototype,"units",void 0),d([m({readOnly:!0})],Ks.prototype,"userContentUrl",null),d([m({readOnly:!0})],Ks.prototype,"url",null),d([m()],Ks.prototype,"username",void 0),d([m()],Ks.prototype,"userLicenseTypeId",void 0),d([m()],Ks.prototype,"userType",void 0),Ks=RK=d([N("esri.portal.PortalUser")],Ks);const Ble=Ks;var Qh;let nU;const Zme={PortalGroup:()=>Promise.resolve({default:AK}),PortalItem:()=>ye(()=>Promise.resolve().then(()=>uPe),void 0,import.meta.url),PortalUser:()=>Promise.resolve({default:Ble})};let Qe=Qh=class extends Tk(lg){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=gr.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){Jme.unregister(this),this.defaultBasemap=Ge(this.defaultBasemap),this.defaultDevBasemap=Ge(this.defaultDevBasemap),this.defaultVectorBasemap=Ge(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Zr(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)gr.request.trustedServers.includes(e)||gr.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=this.user?.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=Ble.fromJSON(t),e.portal=this),e}load(t){const e=ye(()=>Promise.resolve().then(()=>fet),void 0,import.meta.url).then(({default:i})=>{zt(t),nU=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{if(Ar){const r=Ar;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==Qh.AUTH_MODE_AUTO&&this.authMode!==Qh.AUTH_MODE_NO_PROMPT||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=r.on("credential-create",DKe(new WeakRef(this))),Jme.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await ye(()=>import("./ElevationLayer-3b6534ff.js"),["./ElevationLayer-3b6534ff.js","./ArcGISCachedService-443ab77a.js","./TileInfoTilemapCache-6cd897b7.js","./TilemapCache-59e5567d.js","./LercDecoder-daf762ae.js","./WorkerHandle-ce022e20.js"],import.meta.url)).default;return t?t.map(i=>new e({id:i.id,url:i.url})):[]}async fetchBasemaps(t,e){const i=await this._fetchBasemaps(t,e);if(e?.include3d===!0&&this.use3dBasemaps!==!1){const r=await this._fetchBasemaps3D(t,e);i.unshift(...r)}return i}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):va(t)?Promise.reject(Yi()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,i=new Fy({num:100,sortField:"title"});if(e?.length){const r=[];for(const s of e)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,t).then(s=>s.results)}return va(t)?Promise.reject(Yi()):Promise.resolve([])}fetchRegions(t){const e=this.user?.culture||this.culture||Eh();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){const e=this.user?.culture||this.culture||Eh();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return IKe(()=>new Qh)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,i){const r=this.restUrl+"/portals/self",s={authMode:t,query:{culture:Eh().toLowerCase()},withCredentials:!0,...i};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(r,s)}queryPortal(t,e,i,r){const s=Tn(Fy,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...r}).then(a=>{const l=s.clone();return l.start=a.nextStart,new NKe({nextQueryParams:l,queryParams:s,total:a.total,results:Qh._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(pl(l),a)));return i&&Zme[i]?Zme[i]().then(({default:o})=>(zt(r),n(o))):n()}signIn(){if(this.authMode===Qh.AUTH_MODE_ANONYMOUS||this.authMode===Qh.AUTH_MODE_NO_PROMPT&&!Ar)return Promise.reject(new j("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return Ar?Ar.getCredential(this.restUrl,{prompt:this.authMode!==Qh.AUTH_MODE_NO_PROMPT}).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential?.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,i){return this.request(t,e).then(r=>{const s=Qh._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}request(t,e={}){const i={f:"json",...e.query},{authMode:r=this.authMode===Qh.AUTH_MODE_ANONYMOUS||this.authMode===Qh.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return e.withCredentials&&(c.withCredentials=!0),qi(this._normalizeSSL(t),c).then(u=>u.data)}toJSON(){throw new j("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Qh({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new j("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const i=new Fy;i.query=t||(gr.apiKey&&Rle(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0;const r=await this.queryGroups(i,e);if(!r.total)return[];const s=r.results[0];i.num=100,i.query='type:"Web Map" -type:"Web Application"',i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(i,e);return n.total?n.results.filter(o=>o.type==="Web Map").map(o=>new nU({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const i=t||this.basemapGalleryGroupQuery3D;if(!i)return[];const r=new Fy({query:i,disableExtraQuery:!0}),s=await this.queryGroups(r,e);if(!s.total)return[];const n=s.results[0];r.num=100,r.query='type:"Web Scene"',r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc";const o=await n.queryItems(r,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new nU({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=nU.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,i,r){let s;if(i){const n=r!=null?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Qe.AUTH_MODE_ANONYMOUS="anonymous",Qe.AUTH_MODE_AUTO="auto",Qe.AUTH_MODE_IMMEDIATE="immediate",Qe.AUTH_MODE_NO_PROMPT="no-prompt",d([m()],Qe.prototype,"access",void 0),d([m()],Qe.prototype,"allSSL",void 0),d([m()],Qe.prototype,"authMode",void 0),d([m()],Qe.prototype,"authorizedCrossOriginDomains",void 0),d([Le("authorizedCrossOriginDomains")],Qe.prototype,"readAuthorizedCrossOriginDomains",null),d([m()],Qe.prototype,"basemapGalleryGroupQuery",void 0),d([m({json:{name:"3DBasemapGalleryGroupQuery"}})],Qe.prototype,"basemapGalleryGroupQuery3D",void 0),d([m()],Qe.prototype,"bingKey",void 0),d([m()],Qe.prototype,"canListApps",void 0),d([m()],Qe.prototype,"canListData",void 0),d([m()],Qe.prototype,"canListPreProvisionedItems",void 0),d([m()],Qe.prototype,"canProvisionDirectPurchase",void 0),d([m()],Qe.prototype,"canSearchPublic",void 0),d([m()],Qe.prototype,"canShareBingPublic",void 0),d([m()],Qe.prototype,"canSharePublic",void 0),d([m()],Qe.prototype,"canSignInArcGIS",void 0),d([m()],Qe.prototype,"canSignInIDP",void 0),d([m()],Qe.prototype,"colorSetsGroupQuery",void 0),d([m()],Qe.prototype,"commentsEnabled",void 0),d([m({type:Date})],Qe.prototype,"created",void 0),d([m()],Qe.prototype,"credential",void 0),d([m()],Qe.prototype,"culture",void 0),d([m()],Qe.prototype,"currentVersion",void 0),d([m()],Qe.prototype,"customBaseUrl",void 0),d([m()],Qe.prototype,"defaultBasemap",void 0),d([Le("defaultBasemap")],Qe.prototype,"readDefaultBasemap",null),d([m()],Qe.prototype,"defaultDevBasemap",void 0),d([Le("defaultDevBasemap")],Qe.prototype,"readDefaultDevBasemap",null),d([m({type:lr})],Qe.prototype,"defaultExtent",void 0),d([m()],Qe.prototype,"defaultVectorBasemap",void 0),d([Le("defaultVectorBasemap")],Qe.prototype,"readDefaultVectorBasemap",null),d([m()],Qe.prototype,"description",void 0),d([m()],Qe.prototype,"devBasemapGalleryGroupQuery",void 0),d([m()],Qe.prototype,"eueiEnabled",void 0),d([m({readOnly:!0})],Qe.prototype,"extraQuery",null),d([m()],Qe.prototype,"featuredGroups",void 0),d([m()],Qe.prototype,"featuredItemsGroupQuery",void 0),d([m()],Qe.prototype,"galleryTemplatesGroupQuery",void 0),d([m()],Qe.prototype,"layoutGroupQuery",void 0),d([m()],Qe.prototype,"livingAtlasGroupQuery",void 0),d([m()],Qe.prototype,"hasCategorySchema",void 0),d([m()],Qe.prototype,"helpBase",void 0),d([m()],Qe.prototype,"helperServices",void 0),d([m()],Qe.prototype,"helpMap",void 0),d([m()],Qe.prototype,"homePageFeaturedContent",void 0),d([m()],Qe.prototype,"homePageFeaturedContentCount",void 0),d([m()],Qe.prototype,"httpPort",void 0),d([m()],Qe.prototype,"httpsPort",void 0),d([m()],Qe.prototype,"id",void 0),d([m()],Qe.prototype,"ipCntryCode",void 0),d([m({readOnly:!0})],Qe.prototype,"isOrganization",null),d([m()],Qe.prototype,"isPortal",void 0),d([m()],Qe.prototype,"isReadOnly",void 0),d([m({readOnly:!0})],Qe.prototype,"itemPageUrl",null),d([m()],Qe.prototype,"layerTemplatesGroupQuery",void 0),d([m()],Qe.prototype,"maxTokenExpirationMinutes",void 0),d([m({type:Date})],Qe.prototype,"modified",void 0),d([m()],Qe.prototype,"name",void 0),d([m()],Qe.prototype,"portalHostname",void 0),d([m()],Qe.prototype,"portalMode",void 0),d([m()],Qe.prototype,"portalProperties",void 0),d([m()],Qe.prototype,"region",void 0),d([m()],Qe.prototype,"recycleBinEnabled",void 0),d([m({readOnly:!0})],Qe.prototype,"restUrl",null),d([m()],Qe.prototype,"rotatorPanels",void 0),d([m()],Qe.prototype,"showHomePageDescription",void 0),d([m()],Qe.prototype,"sourceJSON",void 0),d([m()],Qe.prototype,"staticImagesUrl",void 0),d([m({json:{name:"2DStylesGroupQuery"}})],Qe.prototype,"stylesGroupQuery2d",void 0),d([m({json:{name:"stylesGroupQuery"}})],Qe.prototype,"stylesGroupQuery3d",void 0),d([m()],Qe.prototype,"supportsHostedServices",void 0),d([m()],Qe.prototype,"symbolSetsGroupQuery",void 0),d([m()],Qe.prototype,"templatesGroupQuery",void 0),d([m()],Qe.prototype,"thumbnail",void 0),d([m({readOnly:!0})],Qe.prototype,"thumbnailUrl",null),d([m()],Qe.prototype,"units",void 0),d([m()],Qe.prototype,"url",void 0),d([m()],Qe.prototype,"urlKey",void 0),d([Le("urlKey")],Qe.prototype,"readUrlKey",null),d([m()],Qe.prototype,"user",void 0),d([Le("user")],Qe.prototype,"readUser",null),d([m()],Qe.prototype,"use3dBasemaps",void 0),d([m()],Qe.prototype,"useStandardizedQuery",void 0),d([m()],Qe.prototype,"useVectorBasemaps",void 0),d([m()],Qe.prototype,"vectorBasemapGalleryGroupQuery",void 0),Qe=Qh=d([N("esri.portal.Portal")],Qe);const Mo=Qe,Jme=new FinalizationRegistry(t=>{t.remove()});function DKe(t){const e=Ar;return()=>{const i=t.deref();i&&e.findCredential(i.restUrl)&&i.signIn().catch(()=>{})}}let E_=class extends Fe{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e?.portalItem&&e.path?{...e,path:Qme(e.path,e.portalItem)}:e}set path(e){e!=null&&Fd(e)?oe.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return Qme(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.cdnUrl;if(r==null)throw new j("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:i?.signal})}async update(e,i){const{addOrUpdateResources:r}=await ye(()=>Promise.resolve().then(()=>DR),void 0,import.meta.url);return await r(this.portalItem,[{resource:this,content:e,compress:i?.compress,access:i?.access}],"update",i),this}hasPath(){return this.path!=null}};function Qme(t,e){return t==null?t:(t=t.replace(/^\/+/,""),e!=null&&Fd(t)&&(t=Tle(t,e.itemUrl)),t?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}d([m()],E_.prototype,"portalItem",void 0),d([m({type:String,value:null})],E_.prototype,"path",null),d([vi("path")],E_.prototype,"_castPath",null),d([m({type:String,readOnly:!0})],E_.prototype,"url",null),d([m({type:String,readOnly:!0})],E_.prototype,"cdnUrl",null),d([m({type:String,readOnly:!0})],E_.prototype,"itemRelativeUrl",null),E_=d([N("esri.portal.PortalItemResource")],E_);const FKe=E_;let W3=class extends Fe{constructor(e){super(e),this.created=null,this.rating=null}};d([m()],W3.prototype,"created",void 0),d([m()],W3.prototype,"rating",void 0),W3=d([N("esri.portal.PortalRating")],W3);const wW=W3;function Qw(t,e){const i=e?.url?.path;if(t&&i&&(t=Bc(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const r=Tle(t,e.portalItem.itemUrl);r!=null&&kKe.test(r)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(r).path)}return(t=PK(t,e?.portal))&&wq.test(t)?zle(t):t}function $E(t,e,i=oF.YES){if((t=t&&wq.test(t)?cPe(t):t)==null)return t;!Fd(t)&&e?.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let r=Bc(t);if(e){const s=e.verifyItemRelativeUrls?.rootPath||e.url?.path;if(s){const n=PK(s,e.portal),o=PK(r,e.portal);r=Tle(o,n,n),r!=null&&r!==o&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=lPe(r,e?.portal),Fd(r)&&(r=Dd(r)),e?.resources&&e?.portalItem&&!Fd(r)&&!R0(r)&&i===oF.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function bq(t,e,i){return Qw(t,i)}function Bv(t,e,i,r){const s=$E(t,r);s!==void 0&&(e[i]=s)}const wq=/\/items\/([^/]+)\/resources\/(.*)/,kKe=/^\.\/resources\//;function UKe(t){return(t?.match(wq)??null)?.[1]??null}function BKe(t){const e=t?.match(wq)??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:o,extension:a}=Ome(i);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=Ome(i.slice(r+1));return{prefix:i.slice(0,r),filename:s,extension:n}}function lPe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?mK(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function PK(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=wle();return rh(r,`${r.scheme}://${i}`)?mK(t,e.portalHostname,i):mK(t,i,e.portalHostname)}function zle(t){if(!t)return t||null;let e=t;return e&&Ar&&!Ar.findCredential(e)&&(e=Ar._normalizeAGOLorgDomain(e),e=e.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),e=e.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),e=e.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),e}function cPe(t){if(!t)return t||null;let e=t;return e=e.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),e=e.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),e=e.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),e&&Ar&&!Ar.findCredential(e)&&(e=Ar._normalizeAGOLorgDomain(e)),e}var oF;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(oF||(oF={}));const Xli=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return oF},ensureMainOnlineDomain:lPe,fromCDNUrl:cPe,fromJSON:Qw,itemIdFromResourceUrl:UKe,prefixAndFilenameFromResourceUrl:BKe,read:bq,toCDNUrl:zle,toJSON:$E,write:Bv},Symbol.toStringTag,{value:"Module"}));var nT;const zKe=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),VKe=new Set(["KML","GeoJson","CSV"]);let Ri=nT=class extends Tk(lg){static from(t){return SE(nT,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Geocoding Service"?i="Locator":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t?.toLowerCase().includes("add in")?i=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="Raster function template"?i="Raster Function Template":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"?i="Insights Report":t==="Excalibur Imagery Project"?i="Excalibur Project":t==="3DTiles Service"?i="3D tiles layer":t==="3DTiles Package"&&(i="3D tiles package"),i}readExtent(t){return t&&t.length?new lr(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type?.toLowerCase()||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,u=!1,h=!1,p=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),u=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":u?"utilitynetwork":n?"featureshosted":"features"):t==="map service"||t==="wms"||t==="wmts"?(c=e.includes("Spatiotemporal"),h=e.includes("Relational"),s=c||h?"mapimages":n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages"):s=t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?e.includes("3DObject")?"3dobjecttileslayer":e.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?s="maps":t==="web scene"?s=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?s="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?s="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?s="mapsgray":t==="service definition"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?s="datafiles":t==="360 vr experience"?s="360vr":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?s="appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?s="addindesktop":t==="pdf"?s="pdf":t==="microsoft word"?s="word":t==="microsoft excel"?s="excel":t==="microsoft powerpoint"?s="ppt":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?s="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?s="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?s="layersgray":t==="analysis model"?s="analysismodel":t==="scene package"?s="scenepackage":t==="3dtiles package"?s="3dtileslayerpackage":t==="3dtiles service"?s="3dtileslayer":t==="mobile scene package"?s="mobilescenepackage":t==="tile package"||t==="compact tile package"?s="tilepackage":t==="task file"?s="taskfile":t==="report template"?s="report-template":t==="statistical data collection"?s="statisticaldatacollection":t==="insights workbook"?s="workbook":t==="insights model"?s="insightsmodel":t==="insights page"?s="insightspage":t==="insights theme"?s="insightstheme":t==="hub initiative"?s="hubinitiative":t==="hub page"?s="hubpage":t==="hub site application"?s="hubsite":t==="hub event"?s="hubevent":t==="hub project"?s="hubproject":t==="relational database connection"?s="relationaldatabaseconnection":t==="big data file share"?s="datastorecollection":t==="image collection"?s="imagecollection":t==="desktop style"?s="desktopstyle":t==="style"?s=e.includes("Dictionary")?"dictionarystyle":"style":t==="dashboard"?s="dashboard":t==="raster function template"?s="rasterprocessingtemplate":t==="vector tile package"?s="vectortilepackage":t==="ortho mapping project"?s="orthomappingproject":t==="ortho mapping template"?s="orthomappingtemplate":t==="solution"?s="solutions":t==="geopackage"?s="geopackage":t==="deep learning package"?s="deeplearningpackage":t==="real time analytic"?s="realtimeanalytics":t==="big data analytic"?s="bigdataanalytics":t==="feed"?s="feed":t==="excalibur imagery project"?s="excaliburimageryproject":t==="notebook"?s="notebook":t==="storymap"?s="storymap":t==="survey123 add in"?s="survey123addin":t==="mission"?s="mission":t==="mission report"?s="missionreport":t==="mission template"?s="missiontemplate":t==="quickcapture project"?s="quickcaptureproject":t==="pro report"?s="proreport":t==="pro report template"?s="proreporttemplate":t==="urban model"?s="urbanmodel":t==="web experience"?s="experiencebuilder":t==="web experience template"?s="webexperiencetemplate":t==="experience builder widget"?s="experiencebuilderwidget":t==="experience builder widget package"?s="experiencebuilderwidgetpackage":t==="workflow"?s="workflow":t==="kernel gateway connection"?s="kernelgatewayconnection":t==="insights script"?s="insightsscript":t==="hub initiative template"?s="hubinitiativetemplate":t==="storymap theme"?s="storymaptheme":t==="knowledge graph"?s="knowledgegraph":t==="knowledge graph layer"?s="knowledgegraphlayer":t==="knowledge studio project"?s="knowledgestudio":t==="native application"?s="nativeapp":t==="native application installer"?s="nativeappinstaller":t==="web link chart"?s="linkchart":t==="knowledge graph web investigation"?s="investigation":t==="ogcfeatureserver"?s="features":t==="pro project"?s="proproject":t==="insights workbook package"?s="insightsworkbookpackage":t==="apache parquet"?s="apacheparquet":t==="notebook code snippet library"?s="notebookcodesnippets":t==="suitability model"?s="suitabilitymodel":t==="esri classifier definition"?s="classifierdefinition":t==="esri classification schema"?s="classificationschema":t==="insights data engineering workbook"?s="dataengineeringworkbook":t==="insights data engineering model"?s="dataengineeringmodel":t==="deep learning studio project"?s="deeplearningproject":t==="discussion"?s="discussion":t==="allsource project"?s="allsourceproject":t==="api key"?s="apikey":t==="data pipeline"?s="datapipelines":t==="group layer"?(p=e.includes("Map"),s=p?"layergroup2d":"layergroup"):s=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":t==="csv"?"csv":t==="image"?"image":"maps",s?kr(i+s+r+".png"):null}get isLayer(){return this.type!=null&&zKe.has(this.type)}get itemCdnUrl(){return zle(this.itemUrl)}get itemPageUrl(){const t=this.portal?.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){const t=this.portal?.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){const t=this.itemUrl,e=this.thumbnail;return t&&e?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`)??null:null}get userItemUrl(){const t=this.portal?.restUrl;if(!t)return null;const e=this.owner||this.portal?.user?.username;return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=Mo.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof wW&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new wW({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:ee(this.applicationProxies),avgRating:this.avgRating,categories:ee(this.categories),created:ee(this.created),culture:this.culture,description:this.description,extent:ee(this.extent),groupCategories:ee(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ee(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ee(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ee(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ee(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new nT({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=t[i]?.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new wW(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},nT)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t?.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new j("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new j("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await e.signIn();const{copyResources:r,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:r==="all",folder:typeof s=="string"?s:s?.id,includeResources:!!r,tags:n?.join(","),title:o}},{itemId:l}=await e.request(`${i}/copy`,a);return new nT({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")R0(e)?r.query={data:e}:r.query={url:Bc(e)},i!=null&&(r.query.filename=i);else{const s=new FormData;i!=null?s.append("file",e,i):s.append("file",e),r.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new j("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:i}=await ye(()=>Promise.resolve().then(()=>DR),void 0,import.meta.url);return i(this,t,e)}async addResource(t,e,i){const{addOrUpdateResources:r}=await ye(()=>Promise.resolve().then(()=>DR),void 0,import.meta.url);return t.portalItem=this,await r(this,[{resource:t,content:e,compress:i?.compress,access:i?.access}],"add",i),t}async removeResource(t,e){const{removeResource:i}=await ye(()=>Promise.resolve().then(()=>DR),void 0,import.meta.url);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new j("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await ye(()=>Promise.resolve().then(()=>DR),void 0,import.meta.url);return e(this,t)}resourceFromPath(t){return new FKe({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:ee(this.categories),created:this.created?.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ee(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ee(this.typeKeywords),url:this.url};return nq(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new nT({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};d([m({type:["private","shared","org","public"]})],Ri.prototype,"access",void 0),d([m()],Ri.prototype,"accessInformation",void 0),d([m({type:String})],Ri.prototype,"apiKey",void 0),d([m({json:{read:{source:"appProxies"}}})],Ri.prototype,"applicationProxies",void 0),d([m()],Ri.prototype,"avgRating",void 0),d([m()],Ri.prototype,"categories",void 0),d([m({type:Date})],Ri.prototype,"created",void 0),d([m()],Ri.prototype,"culture",void 0),d([m()],Ri.prototype,"description",void 0),d([m({readOnly:!0})],Ri.prototype,"displayName",null),d([m({type:lr})],Ri.prototype,"extent",void 0),d([Le("extent")],Ri.prototype,"readExtent",null),d([m()],Ri.prototype,"groupCategories",void 0),d([m({readOnly:!0})],Ri.prototype,"iconUrl",null),d([m()],Ri.prototype,"id",void 0),d([m({readOnly:!0})],Ri.prototype,"isLayer",null),d([m({type:Boolean,readOnly:!0})],Ri.prototype,"isOrgItem",void 0),d([m()],Ri.prototype,"itemControl",void 0),d([m({readOnly:!0})],Ri.prototype,"itemPageUrl",null),d([m({readOnly:!0})],Ri.prototype,"itemUrl",null),d([m()],Ri.prototype,"licenseInfo",void 0),d([m({type:Date})],Ri.prototype,"modified",void 0),d([m()],Ri.prototype,"name",void 0),d([m()],Ri.prototype,"numComments",void 0),d([m()],Ri.prototype,"numRatings",void 0),d([m()],Ri.prototype,"numViews",void 0),d([m()],Ri.prototype,"owner",void 0),d([m()],Ri.prototype,"ownerFolder",void 0),d([m({type:Mo})],Ri.prototype,"portal",void 0),d([m()],Ri.prototype,"screenshots",void 0),d([m()],Ri.prototype,"size",void 0),d([m()],Ri.prototype,"snippet",void 0),d([m()],Ri.prototype,"sourceJSON",void 0),d([m({type:String})],Ri.prototype,"sourceUrl",void 0),d([m({type:String})],Ri.prototype,"spatialReference",void 0),d([m()],Ri.prototype,"tags",void 0),d([m()],Ri.prototype,"thumbnail",void 0),d([m({readOnly:!0})],Ri.prototype,"thumbnailUrl",null),d([m()],Ri.prototype,"title",void 0),d([m()],Ri.prototype,"type",void 0),d([m()],Ri.prototype,"typeKeywords",void 0),d([m({type:String,json:{read(t,e){if(VKe.has(e.type)){const i=this.portal?.restUrl;t||=i&&this.id?`${i}/content/items/${this.id}/data`:null}return t}}})],Ri.prototype,"url",void 0),d([m({readOnly:!0})],Ri.prototype,"userItemUrl",null),Ri=nT=d([N("esri.portal.PortalItem")],Ri);const Y2=Ri,uPe=Object.freeze(Object.defineProperty({__proto__:null,default:Y2},Symbol.toStringTag,{value:"Module"})),Kme=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,GKe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function ege(t){return t in GKe}const Y3=[],xP=new Map;function tge(t){for(const e of xP.keys())dPe(t.pattern,e)&&xP.delete(e)}function jKe(t){return Y3.includes(t)||(tge(t),Y3.unshift(t)),er(()=>{const e=Y3.indexOf(t);e>-1&&(Y3.splice(e,1),tge(t))})}async function hPe(t){const e=Eh();xP.has(t)||xP.set(t,qKe(t,e));const i=xP.get(t);return i&&await WKe.add(i),i}function HKe(t){if(!Kme.test(t))return null;const e=Kme.exec(t);if(e===null)return null;const[,i,r]=e,s=i+(r?"-"+r.toUpperCase():"");return ege(s)?s:ege(i)?i:null}async function qKe(t,e){const i=[];for(const r of Y3)if(dPe(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(s){i.push(s)}throw i.length?new j("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new j("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function dPe(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}Ule(()=>{xP.clear()});const WKe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=lo())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function YKe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,i=await hPe("esri/t9n/basemaps");return i[t]||i[e]}const OK={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return kr("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return kr("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return kr("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return kr("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return kr("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return kr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return kr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return kr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return kr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return kr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return kr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return kr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return kr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return kr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return kr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},XKe=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let hb=class extends Fe{constructor(e){super(e),this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const e=Eh().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const i=PKe(e);return i==="pt"?"pt-BR":i&&XKe.has(i)?i:"global"}};d([m()],hb.prototype,"id",void 0),d([m()],hb.prototype,"language",void 0),d([m()],hb.prototype,"places",void 0),d([m()],hb.prototype,"serviceUrl",void 0),d([m()],hb.prototype,"worldview",void 0),hb=d([N("esri.support.BasemapStyle")],hb);const ZKe=hb;function Jli(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function JKe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function oT(t){return t?.type==="subtype-sublayer"}function KL(t){const e=t?.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function vO(t){return t!=null&&"type"in t&&t.type==="group"}const Qli={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function pPe(t){const e=t?.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function QKe(t){return t==="IntegratedMeshLayer"||t==="IntegratedMesh3DTilesLayer"}function aF(t){return t==="integrated-mesh"||t==="integrated-mesh-3dtiles"}function ige(t){return t?.type==="voxel"}function rge(t){return t?.type==="imagery-tile"}function sV(t){return t?.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function xq(t){return t?.type==="feature"&&!t.url&&t.source?.type==="memory"}function Kli(t){return(t?.type==="feature"||t?.type==="subtype-group")&&t.source?.type==="feature-layer"}function KKe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function fPe(t,e){const i=Ar?.findServerInfo(t);if(i?.currentVersion!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const s=`${t.substring(0,r)}/rest/info`,n=e!=null?e.signal:null,{data:o}=await qi(s,{query:{f:"json"},responseType:"json",signal:n});return o?.owningSystemUrl||null}function eet(t){if(!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function tet(t){return eet(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function iet(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function ret(t){return!!iet(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const set=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),net=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function oet(t){return t.layerContainerType==="basemap"?set:t.layerContainerType==="operational-layers"?net:null}function aet(t,e){if(e.restrictedWebMapWriting){const i=oet(e);return i==null||i.has(t.type)&&!xq(t)}return!0}function cet(t,e){if(e)if(xq(t)){const i=_v("featureCollection.layers",e),r=i?.[0]?.layerDefinition;r&&sge(t,r)}else t.type!=="group"&&sge(t,e)}function sge(t,e){"maxScale"in t&&(e.maxScale=Y6(t.maxScale)??void 0),"minScale"in t&&(e.minScale=Y6(t.minScale)??void 0)}function uet(t,e){if(cet(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=Y6(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(xq(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function nge(t,e,i){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return i?.messages&&i.messages.push(new j("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(xq(t)&&!t.isTable)e=t.resourceInfo;else if(aet(t,i)){const r={};return t.write(r,i)?r:null}return e!=null&&uet(t,e=ee(e)),e}var X3;let het=0,Kh=X3=class extends Tk(lg){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+het++,this.baseLayers=new ct,this.referenceLayers=new ct;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&oe.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.addHandles([this.baseLayers.on("after-add",r=>e(r.item)),this.referenceLayers.on("after-add",r=>e(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{oe.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.toArray();for(const i of t)i.destroy();const e=this.referenceLayers.toArray();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=Ge(this.portalItem)}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",y0(t,this._get("baseLayers")))}_writeBaseLayers(t,e,i){const r=[];t&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=nge(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);n!=null&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=nge(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);n!=null&&(s.type!=="scene"&&(n.isReference=!0),r.push(n))})),e.baseMapLayers=r}set referenceLayers(t){this._set("referenceLayers",y0(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Nle(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>L6(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>L6(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new X3({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e?.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=ee(i);return r.url&&g0(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&g0(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:i,style:r}=this;zt(t);const s=[];if(e){const n=e.context?e.context.url:null;if(s.push(this._loadLayersFromJSON(e.data,n,t)),e.data.id&&!e.data.title){const o=e.data.id;s.push(YKe(o).then(a=>{a&&this.read({title:a},e.context)}))}}else i?s.push(this._loadFromItem(i,t)):r&&s.push(this._loadFromStylesService(r,t));await Promise.all(s)}async _loadLayersFromJSON(t,e,i){const r=this.resourceInfo?.context,s=this.portalItem?.portal||r?.portal||null,n=pet[r?.origin||""]??"web-map",{populateOperationalLayers:o}=await ye(()=>import("./layersCreator-f0e45f92.js"),["./layersCreator-f0e45f92.js","./portalLayers-47ed75dc.js","./associatedFeatureServiceUtils-82735909.js","./fetchService-fa9a0116.js"],import.meta.url),a=[];if(zt(i),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{...r,origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=p=>n==="web-scene"&&p.layerType==="ArcGISSceneServiceLayer"||p.isReference,u=o(this.baseLayers,t.baseMapLayers.filter(p=>!c(p)),l);a.push(u);const h=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(h)}await Promise.allSettled(a)}async _loadFromItem(t,e){const i=await t.load(e),r=await i.fetchData("json",e),s=ln(t.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:det[t.type||""]??"web-map",portal:t.portal||Mo.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||Mo.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}async _loadFromStylesService(t,e){const i=`${t.serviceUrl}/${t.id}`,r=(await qi(i,{query:{language:t.getLanguageParamValue(),places:t.places,worldview:t.worldview},signal:e?.signal})).data,s=ln(i);return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:"web-map",url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=OK[t];return e?e.itemId?new X3({portalItem:{id:e.itemId,portal:{url:"https://www.arcgis.com"}}}):X3.fromJSON(e,{origin:e.is3d?"web-scene":"web-map"}):null}};d([m({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:ct}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],Kh.prototype,"baseLayers",null),d([m({type:String,json:{origins:{"web-scene":{write:!0}}}})],Kh.prototype,"id",void 0),d([m({type:Y2})],Kh.prototype,"portalItem",void 0),d([m()],Kh.prototype,"referenceLayers",null),d([m({readOnly:!0})],Kh.prototype,"resourceInfo",void 0),d([m({type:Je})],Kh.prototype,"spatialReference",void 0),d([m({type:ZKe})],Kh.prototype,"style",void 0),d([m()],Kh.prototype,"thumbnailUrl",void 0),d([m({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Kh.prototype,"title",void 0),d([Ve("title")],Kh.prototype,"writeTitle",null),Kh=X3=d([N("esri.Basemap")],Kh);const det={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},pet={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},SP=Kh,fet=Object.freeze(Object.defineProperty({__proto__:null,default:SP},Symbol.toStringTag,{value:"Module"})),lj={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function mPe(t){return!!lj[t]||!!lj[t.toLowerCase()]}function Vle(t){return lj[t]??lj[t.toLowerCase()]}function met(t){return[...Vle(t)]}function xW(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function gPe(t,e,i,r=1){const s=(t%360+360)%360/360,n=i<=.5?i*(e+1):i+e-i*e,o=2*i-n;return[Math.round(255*xW(o,n,s+1/3)),Math.round(255*xW(o,n,s)),Math.round(255*xW(o,n,s-1/3)),r]}function get(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}function M(){return[0,0,0]}function Fn(t){return[t[0],t[1],t[2]]}function Be(t,e,i){return[t,e,i]}function Dc(t,e=M()){const i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function yet(t,e){return new Float64Array(t,e,3)}function Gle(){return M()}function yPe(){return Be(1,1,1)}function _Pe(){return Be(1,0,0)}function vPe(){return Be(0,1,0)}function jle(){return Be(0,0,1)}const co=Gle(),bv=yPe(),Hle=_Pe(),qle=vPe(),bO=jle();Object.freeze(Object.defineProperty({__proto__:null,ONES:bv,UNIT_X:Hle,UNIT_Y:qle,UNIT_Z:bO,ZEROS:co,clone:Fn,create:M,createView:yet,fromArray:Dc,fromValues:Be,ones:yPe,unitX:_Pe,unitY:vPe,unitZ:jle,zeros:Gle},Symbol.toStringTag,{value:"Module"}));let Wle=1e-6;function ba(){return Wle}function _et(t){Wle=t}const Ok=Math.random,vet=Math.PI/180,bet=180/Math.PI;function Sq(t){return t*vet}function wet(t){return t*bet}function xet(t,e){return Math.abs(t-e)<=Wle*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:Ok,equals:xet,getEpsilon:ba,setEpsilon:_et,toDegree:wet,toRadian:Sq},Symbol.toStringTag,{value:"Module"}));function De(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function ge(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ue(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function Te(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Me(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Tq(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function cj(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function Tet(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function bPe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function wO(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function wPe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function xPe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function SPe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function Eet(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ce(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function ao(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function jr(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}function Xo(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function Ql(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function Ha(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Cet(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Se(t,e){const i=e[0],r=e[1],s=e[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function xe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function yt(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];return t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o,t}function Br(t,e,i,r){const s=e[0],n=e[1],o=e[2];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t}function Met(t,e,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),u=o*(3-2*n);return t[0]=e[0]*a+i[0]*l+r[0]*c+s[0]*u,t[1]=e[1]*a+i[1]*l+r[1]*c+s[1]*u,t[2]=e[2]*a+i[2]*l+r[2]*c+s[2]*u,t}function Aet(t,e,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,u=3*n*a,h=3*l*o,p=l*n;return t[0]=e[0]*c+i[0]*u+r[0]*h+s[0]*p,t[1]=e[1]*c+i[1]*u+r[1]*h+s[1]*p,t[2]=e[2]*c+i[2]*u+r[2]*h+s[2]*p,t}function Ret(t,e){e=e||1;const i=Ok,r=2*i()*Math.PI,s=2*i()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=s*e,t}function nt(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12],t[1]=i[1]*r+i[5]*s+i[9]*n+i[13],t[2]=i[2]*r+i[6]*s+i[10]*n+i[14],t}function Ga(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=r*i[0]+s*i[3]+n*i[6],t[1]=r*i[1]+s*i[4]+n*i[7],t[2]=r*i[2]+s*i[5]+n*i[8],t}function oh(t,e,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=e[0],l=e[1],c=e[2],u=s*c-n*l,h=n*a-r*c,p=r*l-s*a,f=s*p-n*h,g=n*u-r*p,y=r*h-s*u,v=2*o;return t[0]=a+u*v+2*f,t[1]=l+h*v+2*g,t[2]=c+p*v+2*y,t}function Pet(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function Oet(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function Iet(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function TPe(t,e){Se(oge,t),Se(age,e);const i=xe(oge,age);return i>1?0:i<-1?Math.PI:Math.acos(i)}const oge=M(),age=M();function $et(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function ga(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function NE(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=ba();return Math.abs(i-n)<=l*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function Kv(t,e,i){const r=i[0]-e[0],s=i[1]-e[1],n=i[2]-e[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=r*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Vi=Me,Net=Tq,Let=cj,Rw=jr,lF=Xo,$c=De,uj=Ql,lge=Object.freeze(Object.defineProperty({__proto__:null,abs:wO,add:Te,angle:TPe,bezier:Aet,ceil:Tet,copy:ge,cross:yt,direction:Kv,dist:Rw,distance:jr,div:Let,divide:cj,dot:xe,equals:NE,exactEquals:ga,floor:bPe,hermite:Met,inverse:Cet,len:$c,length:De,lerp:Br,max:SPe,min:xPe,mul:Net,multiply:Tq,negate:Ha,normalize:Se,random:Ret,rotateX:Pet,rotateY:Oet,rotateZ:Iet,round:Eet,scale:ce,scaleAndAdd:ao,set:ue,sign:wPe,sqrDist:lF,sqrLen:uj,squaredDistance:Xo,squaredLength:Ql,str:$et,sub:Vi,subtract:Me,transformMat3:Ga,transformMat4:nt,transformQuat:oh},Symbol.toStringTag,{value:"Module"})),cge=new Float32Array(1);function EPe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function $e(t,e,i){return Math.min(Math.max(t,e),i)}function cF(t){return!(t&t-1)}function eci(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function tci(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Wt(t,e,i){return t+(e-t)*i}function ici(t,e,i,r,s){return Wt(r,s,(t-e)/(i-e))}function Gt(t){return t*Math.PI/180}function El(t){return 180*t/Math.PI}function IK(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Jo(t){return Math.acos($e(t,-1,1))}function ug(t){return Math.asin($e(t,-1,1))}function Pw(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}const hj=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function $K(t){return hj.setFloat64(0,t),hj.getBigInt64(0)}function Det(t){return hj.setBigInt64(0,t),hj.getFloat64(0)}const nV=BigInt("1000000"),Fet=CPe(1);function CPe(t){const e=$K(t=Math.abs(t)),i=Det(e<=nV?nV:e-nV);return Math.abs(t-i)}function rci(t,e,i=Fet){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(i!=null&&CPe(Math.min(Math.abs(t),Math.abs(e)))<i)return Math.abs(t-e)<=i;const r=$K(t),s=$K(e);return r<0!=s<0?!1:!((r<s?s-r:r-s)>nV)}function ket(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function Uet(t){return MPe(Math.max(-NK,Math.min(t,NK)))}function MPe(t){return cge[0]=t,cge[0]}function uF(t,e,i){const r=$e((i-t)/(e-t),0,1);return r*r*(3-2*r)}function uge(t,e){const i=De(t),r=ug(t[2]/i),s=Math.atan2(t[1]/i,t[0]/i);return ue(e,i,r,s),e}function dj(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(Pw(e,1)&&Pw(i,1)&&Pw(r,1))}function Bet(t,e){return(t%e+e)%e}const NK=MPe(34028234663852886e22);function oU(t){return $e(gle(t),0,255)}function aU(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}function lU(t,e){const i=t.toString(16).padStart(2,"0");return e?i.substring(0,1):i}let oV=class Pa{static blendColors(e,i,r,s=new Pa){return s.r=Math.round(e.r+(i.r-e.r)*r),s.g=Math.round(e.g+(i.g-e.g)*r),s.b=Math.round(e.b+(i.b-e.b)*r),s.a=e.a+(i.a-e.a)*r,s._sanitize()}static fromRgb(e,i){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),Pa.fromArray(a,i)}return Pa.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return Pa.fromArray(gPe(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(e,i=new Pa){if(e[0]!=="#"||isNaN(+`0x${e.substring(1)}`))return null;switch(e.length){case 4:case 5:{const r=parseInt(e.substring(1,2),16),s=parseInt(e.substring(2,3),16),n=parseInt(e.substring(3,4),16),o=e.length===5?15:parseInt(e.substring(4),16);return Pa.fromArray([r+16*r,s+16*s,n+16*n,(o+16*o)/255],i)}case 7:case 9:{const r=parseInt(e.substring(1,3),16),s=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16),o=e.length===7?255:parseInt(e.substring(7),16);return Pa.fromArray([r,s,n,o/255],i)}default:return null}}static fromArray(e,i=new Pa){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=mPe(e)?Vle(e):null;return r&&Pa.fromArray(r,i)||Pa.fromRgb(e,i)||Pa.fromHex(e,i)}static fromJSON(e){return e!=null?new Pa([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Pa.fromString(e,this):Array.isArray(e)?Pa.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Pa||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const i=e?.capitalize??!1,r=e?.digits??6,s=r===3||r===4,n=r===4||r===8,o=`#${lU(this.r,s)}${lU(this.g,s)}${lU(this.b,s)}${n?lU(Math.round(255*this.a),s):""}`;return i?o.toUpperCase():o}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Pa.AlphaMode.ALWAYS){const i=oU(this.r),r=oU(this.g),s=oU(this.b);return e===Pa.AlphaMode.ALWAYS||this.a!==1?[i,r,s,oU(255*this.a)]:[i,r,s]}clone(){return new Pa(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(aU(this.r,0,255)),this.g=Math.round(aU(this.g,0,255)),this.b=Math.round(aU(this.b,0,255)),this.a=aU(this.a,0,1),this}_set(e,i,r,s){this.r=e,this.g=i,this.b=r,this.a=s}};oV.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(oV||(oV={}));const Ke=oV;function sci(t){}function zet(t){return()=>t}function Nt(t,e={}){const i=t instanceof ur?t:new ur(t,e),r={type:e?.ignoreUnknown??1?i.apiValues:String,json:{type:i.jsonValues,read:!e?.readOnly&&{reader:i.read},write:{writer:i.write}}};return e?.readOnly!==void 0&&(r.readOnly=!!e.readOnly),e?.default!==void 0&&(r.json.default=e.default),e?.name!==void 0&&(r.json.name=e.name),e?.nonNullable!==void 0&&(r.nonNullable=e.nonNullable),m(r)}var LK;let aV=LK=class extends we{constructor(t){super(t),this.type="none"}clone(){return new LK({type:this.type})}};d([Nt({none:"none",stayAbove:"stay-above"})],aV.prototype,"type",void 0),aV=LK=d([N("esri.ground.NavigationConstraint")],aV);function Ik(t){const e=gle(100*(1-t));return Math.max(0,Math.min(e,100))}function xO(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var DK;let C_=DK=class extends Tk(lg){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new ct;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&oe.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{En(t)||oe.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)Ge(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",y0(t,this._get("layers")))}writeLayers(t,e,i,r){const s=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};zet(n)().write(o,r)&&s.push(o)}else r?.messages&&r.messages.push(new j("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Nle(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e?.signal});const{ElevationQuery:i}=await ye(()=>import("./ElevationQuery-93840c62.js"),[],import.meta.url);zt(e);const r=new i,s=this.layers.filter(hge).toArray();return r.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e?.signal});const{ElevationQuery:i}=await ye(()=>import("./ElevationQuery-93840c62.js"),[],import.meta.url);zt(e);const r=new i,s=this.layers.filter(hge).toArray();return r.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:ee(this.surfaceColor),navigationConstraint:ee(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new DK({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,i){const r=e?.origin||"web-scene",s=e?.portal||null,n=e?.url||null,{populateOperationalLayers:o}=await ye(()=>import("./layersCreator-f0e45f92.js"),["./layersCreator-f0e45f92.js","./portalLayers-47ed75dc.js","./associatedFeatureServiceUtils-82735909.js","./fetchService-fa9a0116.js"],import.meta.url);zt(i);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}await Promise.allSettled(a)}};function Vet(t){return t&&"createElevationSampler"in t}function hge(t){return t.type==="elevation"||Vet(t)}d([m({json:{read:!1}})],C_.prototype,"layers",null),d([Ve("layers")],C_.prototype,"writeLayers",null),d([m({readOnly:!0})],C_.prototype,"resourceInfo",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:cr,read:{reader:xO,source:"transparency"},write:{writer:(t,e)=>{e.transparency=Ik(t)},target:"transparency"}}})],C_.prototype,"opacity",void 0),d([m({type:Ke,json:{type:[cr],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],C_.prototype,"surfaceColor",void 0),d([m({type:aV,json:{write:!0}})],C_.prototype,"navigationConstraint",void 0),C_=DK=d([N("esri.Ground")],C_);const hF=C_;let MA=class extends ct{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(UAe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let i=0;for(const r of e)r!=null&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(e){return new ct(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction??(s=>!!s);for(const s of i)if(s){if(r(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};d([m()],MA.prototype,"getCollections",void 0),d([m()],MA.prototype,"getChildrenFunction",void 0),d([m()],MA.prototype,"itemFilterFunction",void 0),MA=d([N("esri.core.CollectionFlattener")],MA);const dF=MA;function _e(t,e,i={}){return Yle(t,e,i,APe)}function Du(t,e,i={}){return Yle(t,e,i,RPe)}function Yle(t,e,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(Zr(s),e(o,a))}:(o,a)=>{r(o)&&e(o,a)};if(s=NZe(t,n,i.sync,i.equals),i.initial){const o=t();n(o,o)}return s}function qa(t,e,i,r={}){let s=null,n=null,o=null;function a(){s&&n&&(n.remove(),r.onListenerRemove?.(s),s=null,n=null)}function l(u){r.once&&r.once&&Zr(o),i(u)}const c=_e(t,(u,h)=>{a(),cq(u)&&(s=u,n=Tv(u,e,l),r.onListenerAdd?.(u))},{sync:r.sync,initial:!0});return o=er(()=>{c.remove(),a()}),o}function SO(t,e){return Get(t,RPe,e)}function Get(t,e,i){if(va(i))return Promise.reject(Yi());const r=t();if(e?.(r))return Promise.resolve(r);let s=null;function n(){s=Zr(s)}return new Promise((o,a)=>{s=Xw([oo(i,()=>{n(),a(Yi())}),Yle(t,l=>{n(),o(l)},{sync:!1,once:!0},e??APe)])})}function APe(t){return!0}function RPe(t){return!!t}function jet(t,e){const i=new ct,r=qa(t,"after-splice",({added:s,start:n,deleteCount:o})=>{const a=i.splice(n,o);for(const l of a)l.remove();if(s?.length){const l=s.map(e);i.addMany(l,n)}},{sync:!0,onListenerRemove:()=>i.drain(s=>s.remove()),onListenerAdd:s=>i.addMany(s.items.map(e))});return i.addHandles(r),i}function oci(t,e){const i=new ct,r=jet(t,a=>P0(async l=>{const c=await e(a,l);if(va(l))throw c.remove(),Yi();return c})),s=()=>null,n=async a=>{const l=await a.promise,c=r.indexOf(a);c<0||i.splice(c,1,l)};i.addMany(r.items.map(s));for(const a of r)KD(n(a));const o=r.on("after-splice",({added:a,start:l,deleteCount:c})=>{const u=i.splice(l,c);for(const h of u)h?.remove();if(a?.length){i.addMany(a.map(s),l);for(const h of a)KD(n(h))}});return i.addHandles([_Ae(r),o]),i}const Mr={sync:!0},Ir={initial:!0},Sr={sync:!0,initial:!0},cU=new WeakMap;function PPe(t){return!t.destroyed&&(cU.has(t)||t.addHandles([_e(()=>{const e=t.parent;return!(!e||!("type"in e))&&(e.type==="catalog-dynamic-group"||PPe(e))},e=>cU.set(t,e),Sr),er(()=>cU.delete(t))]),cU.get(t))}function Het(t){return typeof t=="object"&&t!=null&&"loaded"in t&&t.loaded===!0&&"type"in t}function qet(t){return!(!Het(t)||!tet(t)?.operations?.supportsEditing||"editingEnabled"in t&&!ret(t)||PPe(t))}const Wet=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,Yet="screenUtils.toPt: input not recognized!",OPe=96;function Yn(t){return t?t/72*OPe:0}function Sa(t){return t?72*t/OPe:0}function Nr(t){if(typeof t=="string"){const e=t.match(Wet);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=r==="px"?Sa(i):i;return s?-n:n}return console.warn(Yet),null}return t}function hf(t=0,e=0){return{x:t,y:e}}function Hs(t=0,e=0){return[t,e]}function IPe(t=0,e=0){return[t,e]}function _l(t=0,e=0,i=0){return[t,e,i]}function aci(t){return t}function lci(t){return t}function cci(t){return t}function $m(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function Eq(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Xet(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Zet(t,e,i,r,s,n,o,a,l,c,u,h,p,f,g,y){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=i,v[3]=r,v[4]=s,v[5]=n,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=u,v[11]=h,v[12]=p,v[13]=f,v[14]=g,v[15]=y,v}function Jet(t,e){return new Float32Array(t,e,16)}const Qet=Eq();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Qet,clone:Xet,create:Eq,createView:Jet,fromValues:Zet},Symbol.toStringTag,{value:"Module"}));function Xn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function O0(t,e,i,r,s,n,o,a,l,c,u,h,p,f,g,y,v){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=h,t[11]=p,t[12]=f,t[13]=g,t[14]=y,t[15]=v,t}function df(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Rh(t,e){if(t===e){const i=e[1],r=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Ox(t,e){return Ao(t,e)||df(t),t}function Ao(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],y=e[13],v=e[14],b=e[15],w=i*a-r*o,x=i*l-s*o,S=i*c-n*o,E=r*l-s*a,C=r*c-n*a,R=s*c-n*l,I=u*y-h*g,F=u*v-p*g,D=u*b-f*g,z=h*v-p*y,B=h*b-f*y,Y=p*b-f*v;let W=w*Y-x*B+S*z+E*D-C*F+R*I;return W?(W=1/W,t[0]=(a*Y-l*B+c*z)*W,t[1]=(s*B-r*Y-n*z)*W,t[2]=(y*R-v*C+b*E)*W,t[3]=(p*C-h*R-f*E)*W,t[4]=(l*D-o*Y-c*F)*W,t[5]=(i*Y-s*D+n*F)*W,t[6]=(v*S-g*R-b*x)*W,t[7]=(u*R-p*S+f*x)*W,t[8]=(o*B-a*D+c*I)*W,t[9]=(r*D-i*B-n*I)*W,t[10]=(g*C-y*S+b*w)*W,t[11]=(h*S-u*C-f*w)*W,t[12]=(a*F-o*z-l*I)*W,t[13]=(i*z-r*F+s*I)*W,t[14]=(y*x-g*E-v*w)*W,t[15]=(u*E-h*x+p*w)*W,t):null}function Ket(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],y=e[13],v=e[14],b=e[15];return t[0]=a*(p*b-f*v)-h*(l*b-c*v)+y*(l*f-c*p),t[1]=-(r*(p*b-f*v)-h*(s*b-n*v)+y*(s*f-n*p)),t[2]=r*(l*b-c*v)-a*(s*b-n*v)+y*(s*c-n*l),t[3]=-(r*(l*f-c*p)-a*(s*f-n*p)+h*(s*c-n*l)),t[4]=-(o*(p*b-f*v)-u*(l*b-c*v)+g*(l*f-c*p)),t[5]=i*(p*b-f*v)-u*(s*b-n*v)+g*(s*f-n*p),t[6]=-(i*(l*b-c*v)-o*(s*b-n*v)+g*(s*c-n*l)),t[7]=i*(l*f-c*p)-o*(s*f-n*p)+u*(s*c-n*l),t[8]=o*(h*b-f*y)-u*(a*b-c*y)+g*(a*f-c*h),t[9]=-(i*(h*b-f*y)-u*(r*b-n*y)+g*(r*f-n*h)),t[10]=i*(a*b-c*y)-o*(r*b-n*y)+g*(r*c-n*a),t[11]=-(i*(a*f-c*h)-o*(r*f-n*h)+u*(r*c-n*a)),t[12]=-(o*(h*v-p*y)-u*(a*v-l*y)+g*(a*p-l*h)),t[13]=i*(h*v-p*y)-u*(r*v-s*y)+g*(r*p-s*h),t[14]=-(i*(a*v-l*y)-o*(r*v-s*y)+g*(r*l-s*a)),t[15]=i*(a*p-l*h)-o*(r*p-s*h)+u*(r*l-s*a),t}function ett(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],p=t[11],f=t[12],g=t[13],y=t[14],v=t[15];return(e*o-i*n)*(h*v-p*y)-(e*a-r*n)*(u*v-p*g)+(e*l-s*n)*(u*y-h*g)+(i*a-r*o)*(c*v-p*f)-(i*l-s*o)*(c*y-h*f)+(r*l-s*a)*(c*g-u*f)}function Or(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],f=e[10],g=e[11],y=e[12],v=e[13],b=e[14],w=e[15];let x=i[0],S=i[1],E=i[2],C=i[3];return t[0]=x*r+S*a+E*h+C*y,t[1]=x*s+S*l+E*p+C*v,t[2]=x*n+S*c+E*f+C*b,t[3]=x*o+S*u+E*g+C*w,x=i[4],S=i[5],E=i[6],C=i[7],t[4]=x*r+S*a+E*h+C*y,t[5]=x*s+S*l+E*p+C*v,t[6]=x*n+S*c+E*f+C*b,t[7]=x*o+S*u+E*g+C*w,x=i[8],S=i[9],E=i[10],C=i[11],t[8]=x*r+S*a+E*h+C*y,t[9]=x*s+S*l+E*p+C*v,t[10]=x*n+S*c+E*f+C*b,t[11]=x*o+S*u+E*g+C*w,x=i[12],S=i[13],E=i[14],C=i[15],t[12]=x*r+S*a+E*h+C*y,t[13]=x*s+S*l+E*p+C*v,t[14]=x*n+S*c+E*f+C*b,t[15]=x*o+S*u+E*g+C*w,t}function ac(t,e,i){const r=i[0],s=i[1],n=i[2];if(e===t)t[12]=e[0]*r+e[4]*s+e[8]*n+e[12],t[13]=e[1]*r+e[5]*s+e[9]*n+e[13],t[14]=e[2]*r+e[6]*s+e[10]*n+e[14],t[15]=e[3]*r+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],h=e[5],p=e[6],f=e[7],g=e[8],y=e[9],v=e[10],b=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=h,t[6]=p,t[7]=f,t[8]=g,t[9]=y,t[10]=v,t[11]=b,t[12]=o*r+u*s+g*n+e[12],t[13]=a*r+h*s+y*n+e[13],t[14]=l*r+p*s+v*n+e[14],t[15]=c*r+f*s+b*n+e[15]}return t}function $k(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function bh(t,e,i,r){let s,n,o,a,l,c,u,h,p,f,g,y,v,b,w,x,S,E,C,R,I,F,D,z,B=r[0],Y=r[1],W=r[2],J=Math.sqrt(B*B+Y*Y+W*W);return J<ba()?null:(J=1/J,B*=J,Y*=J,W*=J,s=Math.sin(i),n=Math.cos(i),o=1-n,a=e[0],l=e[1],c=e[2],u=e[3],h=e[4],p=e[5],f=e[6],g=e[7],y=e[8],v=e[9],b=e[10],w=e[11],x=B*B*o+n,S=Y*B*o+W*s,E=W*B*o-Y*s,C=B*Y*o-W*s,R=Y*Y*o+n,I=W*Y*o+B*s,F=B*W*o+Y*s,D=Y*W*o-B*s,z=W*W*o+n,t[0]=a*x+h*S+y*E,t[1]=l*x+p*S+v*E,t[2]=c*x+f*S+b*E,t[3]=u*x+g*S+w*E,t[4]=a*C+h*R+y*I,t[5]=l*C+p*R+v*I,t[6]=c*C+f*R+b*I,t[7]=u*C+g*R+w*I,t[8]=a*F+h*D+y*z,t[9]=l*F+p*D+v*z,t[10]=c*F+f*D+b*z,t[11]=u*F+g*D+w*z,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function TO(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*r,t[5]=o*s+u*r,t[6]=a*s+h*r,t[7]=l*s+p*r,t[8]=c*s-n*r,t[9]=u*s-o*r,t[10]=h*s-a*r,t[11]=p*s-l*r,t}function Cq(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*r,t[1]=o*s-u*r,t[2]=a*s-h*r,t[3]=l*s-p*r,t[8]=n*r+c*s,t[9]=o*r+u*s,t[10]=a*r+h*s,t[11]=l*r+p*s,t}function EO(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*r,t[1]=o*s+u*r,t[2]=a*s+h*r,t[3]=l*s+p*r,t[4]=c*s-n*r,t[5]=u*s-o*r,t[6]=h*s-a*r,t[7]=p*s-l*r,t}function mC(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function $Pe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ph(t,e,i){if(e===0)return df(t);let r,s,n,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<ba()?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*r,t[2]=l*o*n-a*r,t[3]=0,t[4]=o*a*n-l*r,t[5]=a*a*n+s,t[6]=l*a*n+o*r,t[7]=0,t[8]=o*l*n+a*r,t[9]=a*l*n-o*r,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function NPe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ttt(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function LPe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function DPe(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=r+r,l=s+s,c=n+n,u=r*a,h=r*l,p=r*c,f=s*l,g=s*c,y=n*c,v=o*a,b=o*l,w=o*c;return t[0]=1-(f+y),t[1]=h+w,t[2]=p-b,t[3]=0,t[4]=h-w,t[5]=1-(u+y),t[6]=g+v,t[7]=0,t[8]=p+b,t[9]=g-v,t[10]=1-(u+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function itt(t,e){const i=rtt,r=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=r*r+s*s+n*n+o*o;return h>0?(i[0]=2*(a*o+u*r+l*n-c*s)/h,i[1]=2*(l*o+u*s+c*r-a*n)/h,i[2]=2*(c*o+u*n+a*s-l*r)/h):(i[0]=2*(a*o+u*r+l*n-c*s),i[1]=2*(l*o+u*s+c*r-a*n),i[2]=2*(c*o+u*n+a*s-l*r)),DPe(t,e,i),t}const rtt=M();function pj(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function FPe(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(i*i+r*r+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function kPe(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function stt(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,u=o+o,h=s*l,p=s*c,f=s*u,g=n*c,y=n*u,v=o*u,b=a*l,w=a*c,x=a*u,S=r[0],E=r[1],C=r[2];return t[0]=(1-(g+v))*S,t[1]=(p+x)*S,t[2]=(f-w)*S,t[3]=0,t[4]=(p-x)*E,t[5]=(1-(h+v))*E,t[6]=(y+b)*E,t[7]=0,t[8]=(f+w)*C,t[9]=(y-b)*C,t[10]=(1-(h+g))*C,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function ntt(t,e,i,r,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,u=o+o,h=a+a,p=n*c,f=n*u,g=n*h,y=o*u,v=o*h,b=a*h,w=l*c,x=l*u,S=l*h,E=r[0],C=r[1],R=r[2],I=s[0],F=s[1],D=s[2],z=(1-(y+b))*E,B=(f+S)*E,Y=(g-x)*E,W=(f-S)*C,J=(1-(p+b))*C,me=(v+w)*C,L=(g+x)*R,k=(v-w)*R,H=(1-(p+y))*R;return t[0]=z,t[1]=B,t[2]=Y,t[3]=0,t[4]=W,t[5]=J,t[6]=me,t[7]=0,t[8]=L,t[9]=k,t[10]=H,t[11]=0,t[12]=i[0]+I-(z*I+W*F+L*D),t[13]=i[1]+F-(B*I+J*F+k*D),t[14]=i[2]+D-(Y*I+me*F+H*D),t[15]=1,t}function ott(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,u=r*o,h=r*a,p=s*o,f=s*a,g=s*l,y=n*o,v=n*a,b=n*l;return t[0]=1-h-g,t[1]=u+b,t[2]=p-v,t[3]=0,t[4]=u-b,t[5]=1-c-g,t[6]=f+y,t[7]=0,t[8]=p+v,t[9]=f-y,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function UPe(t,e,i,r,s,n,o){const a=1/(i-e),l=1/(s-r),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(s+r)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function att(t,e,i,r,s){const n=1/Math.tan(e/2);let o;return t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(r-s),t[10]=(s+r)*o,t[14]=2*s*r*o):(t[10]=-1,t[14]=-2*r),t}function ltt(t,e,i,r){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function BPe(t,e,i,r,s,n,o){const a=1/(e-i),l=1/(r-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(s+r)*l,t[14]=(o+n)*c,t[15]=1,t}function Mq(t,e,i,r){const s=e[0],n=e[1],o=e[2];let a=s-i[0],l=n-i[1],c=o-i[2];const u=ba();if(Math.abs(a)<u&&Math.abs(l)<u&&Math.abs(c)<u)return void df(t);let h=1/Math.sqrt(a*a+l*l+c*c);a*=h,l*=h,c*=h;const p=r[0],f=r[1],g=r[2];let y=f*c-g*l,v=g*a-p*c,b=p*l-f*a;h=Math.sqrt(y*y+v*v+b*b),h?(h=1/h,y*=h,v*=h,b*=h):(y=0,v=0,b=0);let w=l*b-c*v,x=c*y-a*b,S=a*v-l*y;h=Math.sqrt(w*w+x*x+S*S),h?(h=1/h,w*=h,x*=h,S*=h):(w=0,x=0,S=0),t[0]=y,t[1]=w,t[2]=a,t[3]=0,t[4]=v,t[5]=x,t[6]=l,t[7]=0,t[8]=b,t[9]=S,t[10]=c,t[11]=0,t[12]=-(y*s+v*n+b*o),t[13]=-(w*s+x*n+S*o),t[14]=-(a*s+l*n+c*o),t[15]=1}function zPe(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=r[0],l=r[1],c=r[2];let u=s-i[0],h=n-i[1],p=o-i[2],f=u*u+h*h+p*p;f>0&&(f=1/Math.sqrt(f),u*=f,h*=f,p*=f);let g=l*p-c*h,y=c*u-a*p,v=a*h-l*u;return f=g*g+y*y+v*v,f>0&&(f=1/Math.sqrt(f),g*=f,y*=f,v*=f),t[0]=g,t[1]=y,t[2]=v,t[3]=0,t[4]=h*v-p*y,t[5]=p*g-u*v,t[6]=u*y-h*g,t[7]=0,t[8]=u,t[9]=h,t[10]=p,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function ctt(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function utt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function htt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function VPe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function dtt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function ptt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function GPe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Aq(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],p=t[10],f=t[11],g=t[12],y=t[13],v=t[14],b=t[15],w=e[0],x=e[1],S=e[2],E=e[3],C=e[4],R=e[5],I=e[6],F=e[7],D=e[8],z=e[9],B=e[10],Y=e[11],W=e[12],J=e[13],me=e[14],L=e[15],k=ba();return Math.abs(i-w)<=k*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(r-x)<=k*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-S)<=k*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(n-E)<=k*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(o-C)<=k*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(a-R)<=k*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(l-I)<=k*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(c-F)<=k*Math.max(1,Math.abs(c),Math.abs(F))&&Math.abs(u-D)<=k*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(h-z)<=k*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(p-B)<=k*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(f-Y)<=k*Math.max(1,Math.abs(f),Math.abs(Y))&&Math.abs(g-W)<=k*Math.max(1,Math.abs(g),Math.abs(W))&&Math.abs(y-J)<=k*Math.max(1,Math.abs(y),Math.abs(J))&&Math.abs(v-me)<=k*Math.max(1,Math.abs(v),Math.abs(me))&&Math.abs(b-L)<=k*Math.max(1,Math.abs(b),Math.abs(L))}function Xle(t){const e=ba(),i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}function Rq(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const pF=Or,ftt=VPe;Object.freeze(Object.defineProperty({__proto__:null,add:htt,adjoint:Ket,copy:Xn,determinant:ett,equals:Aq,exactEquals:GPe,frob:utt,fromQuat:ott,fromQuat2:itt,fromRotation:Ph,fromRotationTranslation:DPe,fromRotationTranslationScale:stt,fromRotationTranslationScaleOrigin:ntt,fromScaling:$Pe,fromTranslation:mC,fromXRotation:NPe,fromYRotation:ttt,fromZRotation:LPe,frustum:UPe,getRotation:kPe,getScaling:FPe,getTranslation:pj,hasIdentityRotation:Rq,identity:df,invert:Ao,invertOrIdentity:Ox,isOrthoNormal:Xle,lookAt:Mq,mul:pF,multiply:Or,multiplyScalar:dtt,multiplyScalarAndAdd:ptt,ortho:BPe,perspective:att,perspectiveFromFieldOfView:ltt,rotate:bh,rotateX:TO,rotateY:Cq,rotateZ:EO,scale:$k,set:O0,str:ctt,sub:ftt,subtract:VPe,targetTo:zPe,translate:ac,transpose:Rh},Symbol.toStringTag,{value:"Module"}));const mtt=(t,e)=>{const i=O0(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Rh(i,i)},gtt=(t,e)=>{const i=O0(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Rh(i,i)},ytt=(t,e)=>{const i=1-e,r=O0(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Rh(r,r)},_tt=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),s=O0(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Rh(s,s)},vtt=(t,e)=>{const i=1-2*e,r=O0(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return Rh(r,r)},btt=(t,e)=>{const i=O0(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Rh(i,i)},wtt=(t,e)=>{const i=1-e,r=O0(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Rh(r,r)};let jPe=class HPe{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=ah(e.strength,i.strength,r),this.radius=ah(e.radius,i.radius,r),this.threshold=ah(e.threshold,i.threshold,r)}clone(){return new HPe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:eD(this.radius),strength:this.strength,threshold:this.threshold}}},qPe=class WPe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(ah(e.radius,i.radius,r))}clone(){return new WPe(this.radius)}toJSON(){return{type:"blur",radius:eD(this.radius)}}},FK=class YPe{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=ah(e.amount,i.amount,r),this._updateMatrix()}clone(){return new YPe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||Eq();switch(this.type){case"brightness":this._colorMatrix=mtt(e,this.amount);break;case"contrast":this._colorMatrix=gtt(e,this.amount);break;case"grayscale":this._colorMatrix=ytt(e,this.amount);break;case"invert":this._colorMatrix=vtt(e,this.amount);break;case"saturate":this._colorMatrix=btt(e,this.amount);break;case"sepia":this._colorMatrix=wtt(e,this.amount)}}},XPe=class ZPe{constructor(e,i,r,s){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=ah(e.offsetX,i.offsetX,r),this.offsetY=ah(e.offsetY,i.offsetY,r),this.blurRadius=ah(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(ah(e.color[0],i.color[0],r)),this.color[1]=Math.round(ah(e.color[1],i.color[1],r)),this.color[2]=Math.round(ah(e.color[2],i.color[2],r)),this.color[3]=ah(e.color[3],i.color[3],r)}clone(){return new ZPe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:eD(this.offsetX),yoffset:eD(this.offsetY),blurRadius:eD(this.blurRadius),color:e}}},JPe=class QPe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=ah(e.angle,i.angle,r),this._updateMatrix()}clone(){return new QPe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||Eq();this._colorMatrix=_tt(e,this.angle)}},KPe=class eOe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=ah(e.amount,i.amount,r)}clone(){return new eOe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function ah(t,e,i){return t+(e-t)*i}function eD(t){return Math.round(1e3*Sa(t))/1e3}function xtt(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new FK(t.type,0);case"saturate":case"brightness":case"contrast":return new FK(t.type,1);case"opacity":return new KPe(1);case"hue-rotate":return new JPe(0);case"blur":return new qPe(0);case"drop-shadow":return new XPe(0,0,0,[...Vle("transparent")]);case"bloom":return new jPe(0,0,1)}}function Stt(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,s)=>r.type===i[s].type)}function Ttt(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let s=r.length;s<i.length;s++)r.push(xtt(i[s]))}function Ett(t){const e=t[0];return!!e&&"type"in e}function Ctt(t,e){return JSON.stringify(t??null)===JSON.stringify(e??null)}const dge=()=>oe.getLogger("esri.support.basemapUtils");function Mtt(){return{}}function Att(t){for(const e in t){const i=t[e];Ge(i),delete t[e]}}function Zle(t,e){let i;if(typeof t=="string"){const r=t in OK,s=!r&&t.includes("/");if(!r&&!s){const n=Object.entries(OK).filter(([o,a])=>gr.apiKey&&!a.classic||!gr.apiKey&&(a.classic||a.is3d)).map(([o])=>`"${o}"`).sort().join(", ");return dge().warn(`Unable to find basemap definition for: ${t}. Try one of these: ${n}`),null}e&&(i=e[t]),i||(i=r?SP.fromId(t):new SP({style:{id:t}}),e&&(e[t]=i))}else i=Tn(SP,t);return i?.destroyed&&(dge().warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function uci(t,e){return t.basemap?.referenceLayers?.some(i=>i.uid===e)||t.basemap?.baseLayers?.some(i=>i.uid===e)}function Rtt(t,e=null){const i=Zle(t);if(!i)return null;const r=i.clone();return e&&(r.baseLayers=pge(r.baseLayers,e.baseLayers),r.referenceLayers=pge(r.referenceLayers,e.referenceLayers)),r}function pge(t,e){const i=new ct;return t.forEach(r=>{const s=e.find(n=>n.type!=="scene"&&Itt(gge(r),gge(n)))||r;i.includes(s)?i.push(r):i.push(s)}),i}function fge(t){return!!t?.baseLayers.concat(t.referenceLayers).some(Ptt)}function Ptt(t){if(mge(t.url))return!0;if(t.type==="vector-tile")for(const e in t.sourceNameToSource){const i=t.sourceNameToSource[e];if(mge(i?.sourceUrl))return!0}return!1}const Ott=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function mge(t){if(!t)return!1;const e=new gh(Bc(t));return!!e.authority&&Ott.test(e.authority)}function gge(t){return{type:t.type,effect:"effect"in t?t.effect:void 0,url:$tt("urlTemplate"in t&&t.urlTemplate||t.url||"styleUrl"in t&&t.styleUrl||""),minScale:"minScale"in t&&t.minScale!=null?t.minScale:0,maxScale:"maxScale"in t&&t.maxScale!=null?t.maxScale:0,opacity:t.opacity!=null?t.opacity:1,visible:t.visible==null||!!t.visible,sublayers:t.type!=="map-image"&&t.type!=="wms"||t.sublayers==null?void 0:t.sublayers?.map(e=>({id:e.id,visible:e.visible})),activeLayerId:t.type==="wmts"?t.activeLayer?.id:void 0}}function Itt(t,e){if(t.type!==e.type||t.url!==e.url||t.minScale!==e.minScale||t.maxScale!==e.maxScale||t.visible!==e.visible||t.opacity!==e.opacity||!Ctt(t.effect,e.effect))return!1;if(t.activeLayerId!=null||e.activeLayerId!=null)return t.activeLayerId===e.activeLayerId;if(t.sublayers!=null||e.sublayers!=null){if(t.sublayers==null||e.sublayers==null||t.sublayers.length!==e.sublayers.length)return!1;for(let i=0;i<t.sublayers.length;i++){const r=t.sublayers.at(i),s=e.sublayers.at(i);if(r?.id!==s?.id||r?.visible!==s?.visible)return!1}}return!0}function $tt(t){return t?Dd(t).replace(/^\s*https?:/i,"").toLowerCase():""}function Ntt(t){return new dF({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}function SW(t){for(const e of t.values())e?.destroy();t.clear()}const yge={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function Ltt(t){let e=null;if(typeof t=="string")if(t in yge){const i=yge[t];e=new hF({resourceInfo:{data:{layers:[i]}}})}else oe.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=Tn(hF,t);return e}function CO(t,e,i=!1){let{hasM:r,hasZ:s}=t;Array.isArray(e)?e.length!==4||r||s?e.length===3&&i&&!r?(s=!0,r=!1):e.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=r}var kK;function _ge(t){return(e,i)=>e==null?i:i==null?e:t(e,i)}function Dtt(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let db=kK=class extends Px{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const i={};Array.isArray(t)?(i.points=t,i.spatialReference=e):Dtt(t)?i.spatialReference=t:(t.points&&(i.points=t.points),t.spatialReference&&(i.spatialReference=t.spatialReference),t.hasZ&&(i.hasZ=t.hasZ),t.hasM&&(i.hasM=t.hasM));const r=i.points?.[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new lr,i=this.hasZ,r=this.hasM,s=i?3:2,n=t[0],o=_ge(Math.min),a=_ge(Math.max);let l,c,u,h,[p,f]=n,[g,y]=n;for(let v=0,b=t.length;v<b;v++){const w=t[v],[x,S]=w;if(p=o(p,x),f=o(f,S),g=a(g,x),y=a(y,S),i&&w.length>2){const E=w[2];l=o(l,E),u=a(u,E)}if(r&&w.length>s){const E=w[s];c=o(c,E),h=a(h,E)}}return e.xmin=p,e.ymin=f,e.xmax=g,e.ymax=y,e.spatialReference=this.spatialReference,i?(e.zmin=l,e.zmax=u):(e.zmin=void 0,e.zmax=void 0),r?(e.mmin=c,e.mmax=h):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=ee(this.points)}addPoint(t){return CO(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:ee(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new kK(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new $t(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new $t(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(CO(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};d([m({readOnly:!0})],db.prototype,"cache",null),d([m()],db.prototype,"extent",null),d([m({type:[[Number]],json:{write:{isRequired:!0}}})],db.prototype,"points",void 0),d([Ve("points")],db.prototype,"writePoints",null),db=kK=d([N("esri.geometry.Multipoint")],db),db.prototype.toJSON.isDefaultToJSON=!0;const PI=db;function Nk(t){const e=[];for(t.reset();t.nextPath();){const i=[];for(;t.nextPoint();)i.push([t.x,t.y]);e.push(i)}return t.reset(),e}function Ow(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}var Ls;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(Ls||(Ls={}));function Pq(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function tOe(t,e,i){const r=t[0]+i*(e[0]-t[0]),s=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,s,t[2]+i*(e[2]-t[2])]:[r,s]}function Ftt(t,e,i,r){const[s,n]=e,[o,a]=i,[l,c]=r,u=l-o,h=c-a,p=u*u+h*h,f=(s-o)*u+(n-a)*h,g=Math.min(1,Math.max(0,f/p));return t[0]=o+u*g,t[1]=a+h*g,t}function ktt(t,e,i,r,s,n){let o=i,a=r,l=s-o,c=n-a;if(l!==0||c!==0){const u=((t-o)*l+(e-a)*c)/(l*l+c*c);u>1?(o=s,a=n):u>0&&(o+=l*u,a+=c*u)}return l=t-o,c=e-a,l*l+c*c}function iOe(t,e){return tOe(t,e,.5)}function Jle(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=Pq(t[r],t[r+1]);return i}function rOe(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let s=0;s<i-1;++s){const n=Pq(t[s],t[s+1]);if(e-r<n){const o=(e-r)/n;return tOe(t[s],t[s+1],o)}r+=n}return t[i-1]}function Z3(t,e=Ls.X,i=Ls.Y){let r=0;const s=t.length;let n=t[0];for(let o=1;o<s;o++){const a=t[o];r+=(a[e]-n[e])*(a[i]+n[i]),n=a}if(!sOe(t)){const o=t[0];r+=(o[e]-n[e])*(o[i]+n[i])}return r>=0}function sOe(t){const e=t.length;return e<3||qw(t[0],t[e-1])}function Utt(t){if(!("rings"in t))return!1;let e=!1;for(const i of t.rings)sOe(i)||(i.push(i[0].slice()),e=!0);return e}function hci(t){return t.type!=="polygon"&&t.type!=="polyline"||Btt(t.type==="polygon"?t.rings:t.paths,t.spatialReference),t}function Btt(t,e){const i=Cv(e);if(!i)return;const r=i.valid[0],s=i.valid[1],n=s-r;for(const o of t){let a=1/0,l=-1/0;for(const u of o){const h=ztt(u[0],r,s);a=Math.min(a,h),l=Math.max(l,h),u[0]=h}const c=l-a;n-c<c&&o.forEach(u=>{u[0]<0&&(u[0]+=n)})}}function ztt(t,e,i){const r=i-e;return t<e?i-(e-t)%r:t>i?e+(t-e)%r:t}function dci(t,e){if(t===e)return!0;if(t.type!==e.type)return!1;if(t.type==="point"||t.type==="mesh"||t.type==="extent")return!0;if(t.type==="multipoint")return t.points.length===e.points.length;const[i,r]=t.type==="polyline"?[t.paths,e.paths]:[t.rings,e.rings];return i.length===r.length&&i.every((s,n)=>s.length===r[n].length)}function pci(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function nOe(t){return t?oOe(t.rings,t.hasZ??!1):null}function oOe(t,e){if(!t?.length)return null;const i=[],r=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=aOe(t[n],e,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||e&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=t[0]&&t[0].length?Gtt(t[0],e):null;if(!n)return null;i[0]=n[0],i[1]=n[1],e&&n.length>2&&(i[2]=n[2])}return i}function aOe(t,e,i){let r=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,u=t.length&&e?t[0][2]:0;for(let p=0;p<t.length;p++){const f=t[p],g=t[(p+1)%t.length],[y,v,b]=f,w=y-l,x=v-c,[S,E,C]=g,R=S-l,I=E-c,F=w*I-R*x;if(o+=F,r+=(w+R)*F,s+=(x+I)*F,e&&f.length>2&&g.length>2){const D=b-u,z=C-u,B=w*z-R*D;n+=(D+z)*B,a+=B}y<i[0]&&(i[0]=y),y>i[1]&&(i[1]=y),v<i[2]&&(i[2]=v),v>i[3]&&(i[3]=v),e&&(b<i[4]&&(i[4]=b),b>i[5]&&(i[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const h=[r/(6*o)+l,s/(6*o)+c,o];return e&&(i[4]===i[5]||a===0?(h[3]=(i[4]+i[5])/2,h[4]=0):(h[3]=n/(6*a)+u,h[4]=a)),h}function Vtt(t,e){let i=0,r=0,s=0;t.nextPoint();const n=t.pathSize?t.x:0,o=t.pathSize?t.y:0;for(let a=0;a<t.pathSize;a++){t.seekInPath(a);const l=[t.x,t.y];t.seekInPath((a+1)%t.pathSize);const c=[t.x,t.y],[u,h]=l,p=u-n,f=h-o,[g,y]=c,v=g-n,b=y-o,w=p*b-v*f;s+=w,i+=(p+v)*w,r+=(f+b)*w,u<e[0]&&(e[0]=u),u>e[1]&&(e[1]=u),h<e[2]&&(e[2]=h),h>e[3]&&(e[3]=h)}return s>0&&(s*=-1),s?(s*=.5,[i/(6*s)+n,r/(6*s)+o,s]):null}function Gtt(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const u=t[l],h=t[l+1];if(u&&h){i[0]=u[0],i[1]=u[1],r[0]=h[0],r[1]=h[1],e&&u.length>2&&h.length>2&&(i[2]=u[2],r[2]=h[2]);const p=Pq(i,r);if(p){s+=p;const f=iOe(u,h);n+=p*f[0],o+=p*f[1],e&&f.length>2&&(a+=p*f[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}function jtt(t){const{hasZ:e,totalSize:i}=t;if(i===0)return null;const r=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=aOe(Ow(t),t.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),s.length&&(r[0]=s[0][0],r[1]=s[0][1],e&&(r[2]=s[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||e&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){t.reset(),t.nextPath();const o=t.pathSize?Htt(t):null;if(!o)return null;r[0]=o[0],r[1]=o[1],e&&o.length>2&&(r[2]=o[2])}return r}function Htt(t){const{hasZ:e}=t,i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,u=t.z;for(;t.nextPoint();){const h=t.x,p=t.y,f=t.z;i[0]=l,i[1]=c,r[0]=h,r[1]=p,e&&(i[2]=u,r[2]=f);const g=Pq(i,r);if(g){s+=g;const y=iOe(i,r);n+=g*y[0],o+=g*y[1],e&&y.length>2&&(a+=g*y[2])}l=h,c=p,u=f}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const qtt=1e-6;function Wtt(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<qtt){const s=jtt(t);return s?[s[0],s[1]]:null}const i=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const r=[t.x,t.y];for(t.reset();t.nextPath();)Xtt(i,r,t);return i[0]*=1/e,i[1]*=1/e,i[0]+=r[0],i[1]+=r[1],i}const Ytt=1/3;function Xtt(t,e,i){if(!t||!i||i.pathSize<3)return null;i.nextPoint();const r=i.x,s=i.y;i.nextPoint();let n,o=i.x-r,a=i.y-s,l=0,c=0;for(;i.nextPoint();)l=i.x-r,c=i.y-s,n=.5*Ytt*(l*a-c*o),t[0]+=n*(o+l),t[1]+=n*(a+c),o=l,a=c;const u=i.getCurrentRingArea(),h=[r,s];return h[0]-=e[0],h[1]-=e[1],h[0]*=u,h[1]*=u,t[0]+=h[0],t[1]+=h[1],t}function li(t=Ktt){return[t[0],t[1],t[2],t[3]]}function fci(t){return[t[0],t[1],t[2],t[3]]}function zv(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function Oq(t,e,i,r,s=li()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function lOe(t,e=li()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function Iq(t,e){return new lr({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function Qle(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Iw(t,e,i){if(e!=null)if("length"in e)zK(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}else zv(i,t)}function TW(t,e,i=t){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<r;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function UK(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function Kl(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function Au(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function mci(t){return Kl(t)*Au(t)}function fj(t){return Kl(t)>0&&Au(t)>0}function Kle(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function cOe(t,e){return $q(t,e[0],e[1])}function vge(t,e){const i=e[3],r=.5*(t[0]+t[2]),s=Math.abs(e[0]-r),n=.5*(t[2]-t[0]);if(s>i+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,u=l-a;return c*c+u*u<=i*i}function gci(t,e,i){const r=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:u}=i,h=(v,b)=>(u-l)*v+(a-c)*b+(c*l-a*u)<0,p=h(r,o),f=h(n,o),g=h(n,s),y=h(r,s);return!(p===f&&f===g&&g===y&&y===p||a<r&&c<r||a>n&&c>n||l>o&&u>o||l<s&&u<s)}function yci(t,e){return $q(t,e.x,e.y)}function $q(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function Ztt(t,e,i){return e[0]>=t[0]-i&&e[1]>=t[1]-i&&e[0]<=t[2]+i&&e[1]<=t[3]+i}function Nq(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function bge(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function BK(t,e,i){if(e==null)return zv(i,t);const r=e[0],s=e[1],n=e[2],o=e[3];return i[0]=$e(t[0],r,n),i[1]=$e(t[1],s,o),i[2]=$e(t[2],r,n),i[3]=$e(t[3],s,o),i}function Jtt(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-i)-Kl(t)/2,0),n=Math.max(Math.abs(e[1]-r)-Au(t)/2,0);return Math.sqrt(s*s+n*n)}function mj(t,e,i,r=t){return r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function Hd(t){return t?zv(t,VK):li(VK)}function zK(t){return t!=null&&t.length===4}function Qtt(t){return!(Kl(t)!==0&&isFinite(t[0])||Au(t)!==0&&isFinite(t[1]))}function X2(t,e){return zK(t)&&zK(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const _ci=[-1/0,-1/0,1/0,1/0],VK=[1/0,1/0,-1/0,-1/0],Ktt=[0,0,0,0];function uOe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function hOe(t){return t.points!==void 0}function dOe(t){return t.x!==void 0&&t.y!==void 0}function pOe(t){return t.paths!==void 0}function fOe(t){return t.rings!==void 0}function mOe(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const _w=mOe(Math.min),vw=mOe(Math.max);function eit(t,e){return pOe(e)?MO(t,e.paths,!1,!1):fOe(e)?MO(t,e.rings,!1,!1):hOe(e)?ece(t,e.points,!1,!1,!1,!1):uOe(e)?yOe(t,e):(dOe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function Lq(t){let e,i,r,s;for(t.reset(),e=r=1/0,i=s=-1/0;t.nextPath();){const n=gOe(t);e=Math.min(n[0],e),r=Math.min(n[1],r),i=Math.max(n[2],i),s=Math.max(n[3],s)}return li([e,r,i,s])}function gOe(t){let e,i,r,s;for(e=r=1/0,i=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),r=Math.min(t.y,r),i=Math.max(t.x,i),s=Math.max(t.y,s);return li([e,r,i,s])}function vci(t,e){return pOe(e)?MO(t,e.paths,!0,!1):fOe(e)?MO(t,e.rings,!0,!1):hOe(e)?ece(t,e.points,!0,!1,!0,!1):uOe(e)?yOe(t,e,!0,!1,!0,!1):(dOe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function MO(t,e,i,r){const s=i?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,u]=e[0][0],[h,p]=e[0][0];for(let f=0;f<e.length;f++){const g=e[f];for(let y=0;y<g.length;y++){const v=g[y],[b,w]=v;if(c=_w(c,b),u=_w(u,w),h=vw(h,b),p=vw(p,w),i&&v.length>2){const x=v[2];n=_w(n,x),o=vw(o,x)}if(r&&v.length>s){const x=v[s];a=_w(n,x),l=vw(o,x)}}}return i?r?(t[0]=c,t[1]=u,t[2]=n,t[3]=a,t[4]=h,t[5]=p,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=u,t[2]=n,t[3]=h,t[4]=p,t[5]=o,t.length=6,t):r?(t[0]=c,t[1]=u,t[2]=a,t[3]=h,t[4]=p,t[5]=l,t.length=6,t):(t[0]=c,t[1]=u,t[2]=h,t[3]=p,t.length=4,t)}function yOe(t,e,i,r,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let u=e.zmin,h=e.zmax,p=e.mmin,f=e.mmax;return s?(u=u||0,h=h||0,n?(p=p||0,f=f||0,t[0]=o,t[1]=l,t[2]=u,t[3]=p,t[4]=a,t[5]=c,t[6]=h,t[7]=f,t):(t[0]=o,t[1]=l,t[2]=u,t[3]=a,t[4]=c,t[5]=h,t)):n?(p=p||0,f=f||0,t[0]=o,t[1]=l,t[2]=p,t[3]=a,t[4]=c,t[5]=f,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function ece(t,e,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!e.length||!e[0].length)return null;let c,u,h,p,[f,g]=e[0],[y,v]=e[0];for(let b=0;b<e.length;b++){const w=e[b],[x,S]=w;if(f=_w(f,x),g=_w(g,S),y=vw(y,x),v=vw(v,S),l&&w.length>2){const E=w[2];c=_w(c,E),u=vw(u,E)}if(a&&w.length>o){const E=w[o];h=_w(c,E),p=vw(u,E)}}return s?(c=c||0,u=u||0,n?(h=h||0,p=p||0,t[0]=f,t[1]=g,t[2]=c,t[3]=h,t[4]=y,t[5]=v,t[6]=u,t[7]=p,t):(t[0]=f,t[1]=g,t[2]=c,t[3]=y,t[4]=v,t[5]=u,t)):n?(h=h||0,p=p||0,t[0]=f,t[1]=g,t[2]=h,t[3]=y,t[4]=v,t[5]=p,t):(t[0]=f,t[1]=g,t[2]=y,t[3]=v,t)}function tit(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function iit(t){return t.points!==void 0}function rit(t){return t.x!==void 0&&t.y!==void 0}function sit(t){return t.paths!==void 0}function nit(t){return t.rings!==void 0}const tce=[];function _Oe(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function vOe(t,e,i,r,s,n){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:s,zmax:n}}function bOe(t,e,i,r,s,n){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:s,mmax:n}}function wOe(t,e,i,r,s,n,o,a){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function ice(t,e=!1,i=!1){return e?i?wOe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):vOe(t[0],t[1],t[2],t[3],t[4],t[5]):i?bOe(t[0],t[1],t[2],t[3],t[4],t[5]):_Oe(t[0],t[1],t[2],t[3])}function bci(t){return t?tit(t)?t:rit(t)?ait(t):nit(t)?xOe(t):sit(t)?SOe(t):iit(t)?oit(t):null:null}function oit(t){const{hasZ:e,hasM:i,points:r}=t;return ice(ece(tce,r,e??!1,i??!1),e,i)}function ait(t){const{x:e,y:i,z:r,m:s}=t,n=s!=null;return r!=null?n?wOe(e,i,r,s,e,i,r,s):vOe(e,i,r,e,i,r):n?bOe(e,i,s,e,i,s):_Oe(e,i,e,i)}function xOe(t){const{hasZ:e,hasM:i,rings:r}=t,s=MO(tce,r,e??!1,i??!1);return s?ice(s,e,i):null}function SOe(t){const{hasZ:e,hasM:i,paths:r}=t,s=MO(tce,r,e??!1,i??!1);return s?ice(s,e,i):null}var lV;function wge(t){return!Array.isArray(t[0])}let ey=lV=class extends Px{static fromExtent(t){const e=t.clone().normalize(),i=t.spatialReference;let r=!1,s=!1;for(const o of e)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new lV(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let i,r,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),i=t.hasZ,r=t.hasM):s=t,s=s||[],e=e||Je.WGS84,s.length&&s[0]?.[0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]?.[0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=nOe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new $t;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=xOe(this);if(!e)return null;const i=new lr(e);return i.spatialReference=t,i}get isSelfIntersecting(){return CKe(this.rings)}writeRings(t,e){e.rings=ee(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(wge(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new lV;return t.spatialReference=this.spatialReference,t.rings=ee(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;if(e!=null!=(i!=null)||e!=null&&i!=null&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([s,n,o,a],[l,c,u,h])=>s===l&&n===c&&(o==null&&u==null||o===u)&&(a==null&&h==null||a===h);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!qw(n,o,r))return!1}return!0}contains(t){if(!t)return!1;const e=Pk(t,this.spatialReference);return gKe(this,e??t)}isClockwise(t){const e=wge(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t;return Z3(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new $t(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new $t(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new $t(i[0],i[1],i[2],i[3],this.spatialReference):new $t(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(CO(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new $t(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new $t(s,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(CO(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],ey.prototype,"cache",null),d([m({readOnly:!0})],ey.prototype,"centroid",null),d([m({readOnly:!0})],ey.prototype,"extent",null),d([m({readOnly:!0})],ey.prototype,"isSelfIntersecting",null),d([m({type:[[[Number]]],json:{write:{isRequired:!0}}})],ey.prototype,"rings",void 0),d([Ve("rings")],ey.prototype,"writeRings",null),ey=lV=d([N("esri.geometry.Polygon")],ey),ey.prototype.toJSON.isDefaultToJSON=!0;const Ix=ey;var GK;function lit(t){return!Array.isArray(t[0])}let pb=GK=class extends Px{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let i,r,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),i=t.hasZ,r=t.hasM):s=t,s=s||[],e=e||Je.WGS84,s.length&&s[0]?.[0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]?.[0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=SOe(this);if(!e)return null;const i=new lr(e);return i.spatialReference=t,i}writePaths(t,e){e.paths=ee(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(lit(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new GK;return t.spatialReference=this.spatialReference,t.paths=ee(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new $t(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new $t(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new $t(i[0],i[1],i[2],i[3],this.spatialReference):new $t(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(CO(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new $t(s,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new $t(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(CO(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],pb.prototype,"cache",null),d([m({readOnly:!0})],pb.prototype,"extent",null),d([m({type:[[[Number]]],json:{write:{isRequired:!0}}})],pb.prototype,"paths",void 0),d([Ve("paths")],pb.prototype,"writePaths",null),pb=GK=d([N("esri.geometry.Polyline")],pb),pb.prototype.toJSON.isDefaultToJSON=!0;const Dq=pb,fF=Yc()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),xge=Yc()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Nm(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Z2(t){return t.points!==void 0}function AO(t){return t.x!==void 0&&t.y!==void 0}function Lm(t){return t.paths!==void 0}function zc(t){return t.rings!==void 0}function Vv(t){return t==null?null:t instanceof Px?t:AO(t)?$t.fromJSON(t):Lm(t)?Dq.fromJSON(t):zc(t)?Ix.fromJSON(t):Z2(t)?PI.fromJSON(t):Nm(t)?lr.fromJSON(t):null}function rce(t){return t?AO(t)?"esriGeometryPoint":Lm(t)?"esriGeometryPolyline":zc(t)?"esriGeometryPolygon":Nm(t)?"esriGeometryEnvelope":Z2(t)?"esriGeometryMultipoint":null:null}const cit={esriGeometryPoint:$t,esriGeometryPolyline:Dq,esriGeometryPolygon:Ix,esriGeometryEnvelope:lr,esriGeometryMultipoint:PI};function uit(t){return t&&cit[t]||null}const gC={base:Px,key:"type",typeMap:{extent:lr,multipoint:PI,point:$t,polyline:Dq,polygon:Ix}};ag(gC);const Sge=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Bishkek"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class yC extends Error{}class hit extends yC{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class dit extends yC{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class pit extends yC{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class LR extends yC{}class TOe extends yC{constructor(e){super(`Invalid unit ${e}`)}}class dh extends yC{}class E1 extends yC{constructor(){super("Zone is an abstract class")}}const bt="numeric",hg="short",kd="long",gj={year:bt,month:bt,day:bt},EOe={year:bt,month:hg,day:bt},fit={year:bt,month:hg,day:bt,weekday:hg},COe={year:bt,month:kd,day:bt},MOe={year:bt,month:kd,day:bt,weekday:kd},AOe={hour:bt,minute:bt},ROe={hour:bt,minute:bt,second:bt},POe={hour:bt,minute:bt,second:bt,timeZoneName:hg},OOe={hour:bt,minute:bt,second:bt,timeZoneName:kd},IOe={hour:bt,minute:bt,hourCycle:"h23"},$Oe={hour:bt,minute:bt,second:bt,hourCycle:"h23"},NOe={hour:bt,minute:bt,second:bt,hourCycle:"h23",timeZoneName:hg},LOe={hour:bt,minute:bt,second:bt,hourCycle:"h23",timeZoneName:kd},DOe={year:bt,month:bt,day:bt,hour:bt,minute:bt},FOe={year:bt,month:bt,day:bt,hour:bt,minute:bt,second:bt},kOe={year:bt,month:hg,day:bt,hour:bt,minute:bt},UOe={year:bt,month:hg,day:bt,hour:bt,minute:bt,second:bt},mit={year:bt,month:hg,day:bt,weekday:hg,hour:bt,minute:bt},BOe={year:bt,month:kd,day:bt,hour:bt,minute:bt,timeZoneName:hg},zOe={year:bt,month:kd,day:bt,hour:bt,minute:bt,second:bt,timeZoneName:hg},VOe={year:bt,month:kd,day:bt,weekday:kd,hour:bt,minute:bt,timeZoneName:kd},GOe={year:bt,month:kd,day:bt,weekday:kd,hour:bt,minute:bt,second:bt,timeZoneName:kd};class OI{get type(){throw new E1}get name(){throw new E1}get ianaName(){return this.name}get isUniversal(){throw new E1}offsetName(e,i){throw new E1}formatOffset(e,i){throw new E1}offset(e){throw new E1}equals(e){throw new E1}get isValid(){throw new E1}}let EW=null;class Fq extends OI{static get instance(){return EW===null&&(EW=new Fq),EW}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return QOe(e,i,r)}formatOffset(e,i){return tD(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let cV={};function git(t){return cV[t]||(cV[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),cV[t]}const yit={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function _it(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,u]=r;return[o,s,n,a,l,c,u]}function vit(t,e){const i=t.formatToParts(e),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=yit[n];n==="era"?r[a]=o:Bi(a)||(r[a]=parseInt(o,10))}return r}let uU={};class qd extends OI{static create(e){return uU[e]||(uU[e]=new qd(e)),uU[e]}static resetCache(){uU={},cV={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=qd.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return QOe(e,i,r,this.name)}formatOffset(e,i){return tD(this.offset(e),i)}offset(e){const i=new Date(e);if(isNaN(i))return NaN;const r=git(this.name);let[s,n,o,a,l,c,u]=r.formatToParts?vit(r,i):_it(r,i);a==="BC"&&(s=-Math.abs(s)+1);const p=Uq({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let f=+i;const g=f%1e3;return f-=g>=0?g:1e3+g,(p-f)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let Tge={};function bit(t,e={}){const i=JSON.stringify([t,e]);let r=Tge[i];return r||(r=new Intl.ListFormat(t,e),Tge[i]=r),r}let jK={};function HK(t,e={}){const i=JSON.stringify([t,e]);let r=jK[i];return r||(r=new Intl.DateTimeFormat(t,e),jK[i]=r),r}let qK={};function wit(t,e={}){const i=JSON.stringify([t,e]);let r=qK[i];return r||(r=new Intl.NumberFormat(t,e),qK[i]=r),r}let WK={};function xit(t,e={}){const{base:i,...r}=e,s=JSON.stringify([t,r]);let n=WK[s];return n||(n=new Intl.RelativeTimeFormat(t,e),WK[s]=n),n}let J3=null;function Sit(){return J3||(J3=new Intl.DateTimeFormat().resolvedOptions().locale,J3)}let Ege={};function Tit(t){let e=Ege[t];if(!e){const i=new Intl.Locale(t);e="getWeekInfo"in i?i.getWeekInfo():i.weekInfo,Ege[t]=e}return e}function Eit(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,s;try{r=HK(t).resolvedOptions(),s=t}catch{const l=t.substring(0,i);r=HK(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=r;return[s,n,o]}}function Cit(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function Mit(t){const e=[];for(let i=1;i<=12;i++){const r=Ti.utc(2009,i,1);e.push(t(r))}return e}function Ait(t){const e=[];for(let i=1;i<=7;i++){const r=Ti.utc(2016,11,13+i);e.push(t(r))}return e}function hU(t,e,i,r){const s=t.listingMode();return s==="error"?null:s==="en"?i(e):r(e)}function Rit(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class Pit{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:s,floor:n,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=wit(e,a)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):ace(e,3);return da(i,this.padTo)}}}class Oit{constructor(e,i,r){this.opts=r,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&qd.create(a).valid?(s=a,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=HK(i,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(i=>{if(i.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...i,value:r}}else return i}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class Iit{constructor(e,i,r){this.opts={style:"long",...r},!i&&ZOe()&&(this.rtf=xit(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):Qit(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}const $it={firstDay:1,minimalDays:4,weekend:[6,7]};class Gs{static fromOpts(e){return Gs.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,i,r,s,n=!1){const o=e||Uo.defaultLocale,a=o||(n?"en-US":Sit()),l=i||Uo.defaultNumberingSystem,c=r||Uo.defaultOutputCalendar,u=YK(s)||Uo.defaultWeekSettings;return new Gs(a,l,c,u,o)}static resetCache(){J3=null,jK={},qK={},WK={}}static fromObject({locale:e,numberingSystem:i,outputCalendar:r,weekSettings:s}={}){return Gs.create(e,i,r,s)}constructor(e,i,r,s,n){const[o,a,l]=Eit(e);this.locale=o,this.numberingSystem=i||a||null,this.outputCalendar=r||l||null,this.weekSettings=s,this.intl=Cit(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=Rit(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Gs.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,YK(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1){return hU(this,e,tIe,()=>{const r=i?{month:e,day:"numeric"}:{month:e},s=i?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=Mit(n=>this.extract(n,r,"month"))),this.monthsCache[s][e]})}weekdays(e,i=!1){return hU(this,e,sIe,()=>{const r=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=i?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=Ait(n=>this.extract(n,r,"weekday"))),this.weekdaysCache[s][e]})}meridiems(){return hU(this,void 0,()=>nIe,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Ti.utc(2016,11,13,9),Ti.utc(2016,11,13,19)].map(i=>this.extract(i,e,"dayperiod"))}return this.meridiemCache})}eras(e){return hU(this,e,oIe,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[Ti.utc(-40,1,1),Ti.utc(2017,1,1)].map(r=>this.extract(r,i,"era"))),this.eraCache[e]})}extract(e,i,r){const s=this.dtFormatter(e,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(e={}){return new Pit(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new Oit(e,this.intl,i)}relFormatter(e={}){return new Iit(this.intl,this.isEnglish(),e)}listFormatter(e={}){return bit(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:JOe()?Tit(this.locale):$it}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let CW=null;class tc extends OI{static get utcInstance(){return CW===null&&(CW=new tc(0)),CW}static instance(e){return e===0?tc.utcInstance:new tc(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new tc(Bq(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${tD(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${tD(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return tD(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class Nit extends OI{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function ow(t,e){if(Bi(t)||t===null)return e;if(t instanceof OI)return t;if(Fit(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?Fq.instance:i==="utc"||i==="gmt"?tc.utcInstance:tc.parseSpecifier(i)||qd.create(t)}else return J2(t)?tc.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new Nit(t)}let Cge=()=>Date.now(),Mge="system",Age=null,Rge=null,Pge=null,Oge=60,Ige,$ge=null;class Uo{static get now(){return Cge}static set now(e){Cge=e}static set defaultZone(e){Mge=e}static get defaultZone(){return ow(Mge,Fq.instance)}static get defaultLocale(){return Age}static set defaultLocale(e){Age=e}static get defaultNumberingSystem(){return Rge}static set defaultNumberingSystem(e){Rge=e}static get defaultOutputCalendar(){return Pge}static set defaultOutputCalendar(e){Pge=e}static get defaultWeekSettings(){return $ge}static set defaultWeekSettings(e){$ge=YK(e)}static get twoDigitCutoffYear(){return Oge}static set twoDigitCutoffYear(e){Oge=e%100}static get throwOnInvalid(){return Ige}static set throwOnInvalid(e){Ige=e}static resetCaches(){Gs.resetCache(),qd.resetCache()}}class zm{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const jOe=[0,31,59,90,120,151,181,212,243,273,304,334],HOe=[0,31,60,91,121,152,182,213,244,274,305,335];function Jp(t,e){return new zm("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function sce(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function qOe(t,e,i){return i+(Lk(t)?HOe:jOe)[e-1]}function WOe(t,e){const i=Lk(t)?HOe:jOe,r=i.findIndex(n=>n<e),s=e-i[r];return{month:r+1,day:s}}function nce(t,e){return(t-e+7)%7+1}function yj(t,e=4,i=1){const{year:r,month:s,day:n}=t,o=qOe(r,s,n),a=nce(sce(r,s,n),i);let l=Math.floor((o-a+14-e)/7),c;return l<1?(c=r-1,l=mF(c,e,i)):l>mF(r,e,i)?(c=r+1,l=1):c=r,{weekYear:c,weekNumber:l,weekday:a,...zq(t)}}function Nge(t,e=4,i=1){const{weekYear:r,weekNumber:s,weekday:n}=t,o=nce(sce(r,1,e),i),a=TP(r);let l=s*7+n-o-7+e,c;l<1?(c=r-1,l+=TP(c)):l>a?(c=r+1,l-=TP(r)):c=r;const{month:u,day:h}=WOe(c,l);return{year:c,month:u,day:h,...zq(t)}}function MW(t){const{year:e,month:i,day:r}=t,s=qOe(e,i,r);return{year:e,ordinal:s,...zq(t)}}function Lge(t){const{year:e,ordinal:i}=t,{month:r,day:s}=WOe(e,i);return{year:e,month:r,day:s,...zq(t)}}function Dge(t,e){if(!Bi(t.localWeekday)||!Bi(t.localWeekNumber)||!Bi(t.localWeekYear)){if(!Bi(t.weekday)||!Bi(t.weekNumber)||!Bi(t.weekYear))throw new LR("Cannot mix locale-based week fields with ISO-based week fields");return Bi(t.localWeekday)||(t.weekday=t.localWeekday),Bi(t.localWeekNumber)||(t.weekNumber=t.localWeekNumber),Bi(t.localWeekYear)||(t.weekYear=t.localWeekYear),delete t.localWeekday,delete t.localWeekNumber,delete t.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function Lit(t,e=4,i=1){const r=kq(t.weekYear),s=Qp(t.weekNumber,1,mF(t.weekYear,e,i)),n=Qp(t.weekday,1,7);return r?s?n?!1:Jp("weekday",t.weekday):Jp("week",t.weekNumber):Jp("weekYear",t.weekYear)}function Dit(t){const e=kq(t.year),i=Qp(t.ordinal,1,TP(t.year));return e?i?!1:Jp("ordinal",t.ordinal):Jp("year",t.year)}function YOe(t){const e=kq(t.year),i=Qp(t.month,1,12),r=Qp(t.day,1,_j(t.year,t.month));return e?i?r?!1:Jp("day",t.day):Jp("month",t.month):Jp("year",t.year)}function XOe(t){const{hour:e,minute:i,second:r,millisecond:s}=t,n=Qp(e,0,23)||e===24&&i===0&&r===0&&s===0,o=Qp(i,0,59),a=Qp(r,0,59),l=Qp(s,0,999);return n?o?a?l?!1:Jp("millisecond",s):Jp("second",r):Jp("minute",i):Jp("hour",e)}function Bi(t){return typeof t>"u"}function J2(t){return typeof t=="number"}function kq(t){return typeof t=="number"&&t%1===0}function Fit(t){return typeof t=="string"}function kit(t){return Object.prototype.toString.call(t)==="[object Date]"}function ZOe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function JOe(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function Uit(t){return Array.isArray(t)?t:[t]}function Fge(t,e,i){if(t.length!==0)return t.reduce((r,s)=>{const n=[e(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function Bit(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function RO(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function YK(t){if(t==null)return null;if(typeof t!="object")throw new dh("Week settings must be an object");if(!Qp(t.firstDay,1,7)||!Qp(t.minimalDays,1,7)||!Array.isArray(t.weekend)||t.weekend.some(e=>!Qp(e,1,7)))throw new dh("Invalid week settings");return{firstDay:t.firstDay,minimalDays:t.minimalDays,weekend:Array.from(t.weekend)}}function Qp(t,e,i){return kq(t)&&t>=e&&t<=i}function zit(t,e){return t-e*Math.floor(t/e)}function da(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function Wb(t){if(!(Bi(t)||t===null||t===""))return parseInt(t,10)}function cS(t){if(!(Bi(t)||t===null||t===""))return parseFloat(t)}function oce(t){if(!(Bi(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function ace(t,e,i=!1){const r=10**e;return(i?Math.trunc:Math.round)(t*r)/r}function Lk(t){return t%4===0&&(t%100!==0||t%400===0)}function TP(t){return Lk(t)?366:365}function _j(t,e){const i=zit(e-1,12)+1,r=t+(e-i)/12;return i===2?Lk(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function Uq(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function kge(t,e,i){return-nce(sce(t,1,e),i)+e-1}function mF(t,e=4,i=1){const r=kge(t,e,i),s=kge(t+1,e,i);return(TP(t)-r+s)/7}function XK(t){return t>99?t:t>Uo.twoDigitCutoffYear?1900+t:2e3+t}function QOe(t,e,i,r=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function Bq(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function KOe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new dh(`Invalid unit value ${t}`);return e}function vj(t,e){const i={};for(const r in t)if(RO(t,r)){const s=t[r];if(s==null)continue;i[e(r)]=KOe(s)}return i}function tD(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${da(i,2)}:${da(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${da(i,2)}${da(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function zq(t){return Bit(t,["hour","minute","second","millisecond"])}const Vit=["January","February","March","April","May","June","July","August","September","October","November","December"],eIe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Git=["J","F","M","A","M","J","J","A","S","O","N","D"];function tIe(t){switch(t){case"narrow":return[...Git];case"short":return[...eIe];case"long":return[...Vit];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const iIe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],rIe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],jit=["M","T","W","T","F","S","S"];function sIe(t){switch(t){case"narrow":return[...jit];case"short":return[...rIe];case"long":return[...iIe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const nIe=["AM","PM"],Hit=["Before Christ","Anno Domini"],qit=["BC","AD"],Wit=["B","A"];function oIe(t){switch(t){case"narrow":return[...Wit];case"short":return[...qit];case"long":return[...Hit];default:return null}}function Yit(t){return nIe[t.hour<12?0:1]}function Xit(t,e){return sIe(e)[t.weekday-1]}function Zit(t,e){return tIe(e)[t.month-1]}function Jit(t,e){return oIe(e)[t.year<0?0:1]}function Qit(t,e,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&n){const h=t==="days";switch(e){case 1:return h?"tomorrow":`next ${s[t][0]}`;case-1:return h?"yesterday":`last ${s[t][0]}`;case 0:return h?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],u=r?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}function Uge(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const Kit={D:gj,DD:EOe,DDD:COe,DDDD:MOe,t:AOe,tt:ROe,ttt:POe,tttt:OOe,T:IOe,TT:$Oe,TTT:NOe,TTTT:LOe,f:DOe,ff:kOe,fff:BOe,ffff:VOe,F:FOe,FF:UOe,FFF:zOe,FFFF:GOe};class Vc{static create(e,i={}){return new Vc(e,i)}static parseFormat(e){let i=null,r="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:/^\s+$/.test(r),val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),n}static macroTokenToFormatOpts(e){return Kit[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}dtFormatter(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i})}formatDateTime(e,i){return this.dtFormatter(e,i).format()}formatDateTimeParts(e,i){return this.dtFormatter(e,i).formatToParts()}formatInterval(e,i){return this.dtFormatter(e.start,i).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i){return this.dtFormatter(e,i).resolvedOptions()}num(e,i=0){if(this.opts.forceSimple)return da(e,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(f,g)=>this.loc.extract(e,f,g),o=f=>e.isOffsetFixed&&e.offset===0&&f.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,f.format):"",a=()=>r?Yit(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(f,g)=>r?Zit(e,f):n(g?{month:f}:{month:f,day:"numeric"},"month"),c=(f,g)=>r?Xit(e,f):n(g?{weekday:f}:{weekday:f,month:"long",day:"numeric"},"weekday"),u=f=>{const g=Vc.macroTokenToFormatOpts(f);return g?this.formatWithSystemDefault(e,g):f},h=f=>r?Jit(e,f):n({era:f},"era"),p=f=>{switch(f){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return h("short");case"GG":return h("long");case"GGGGG":return h("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(f)}};return Uge(Vc.parseFormat(i),p)}formatDurationFromString(e,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const u=r(c);return u?this.num(l.get(u),c.length):c},n=Vc.parseFormat(i),o=n.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=e.shiftTo(...o.map(r).filter(l=>l));return Uge(n,s(a))}}const aIe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function II(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function $I(...t){return e=>t.reduce(([i,r,s],n)=>{const[o,a,l]=n(e,s);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function NI(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const s=i.exec(t);if(s)return r(s)}return[null,null]}function lIe(...t){return(e,i)=>{const r={};let s;for(s=0;s<t.length;s++)r[t[s]]=Wb(e[i+s]);return[r,null,i+s]}}const cIe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,ert=`(?:${cIe.source}?(?:\\[(${aIe.source})\\])?)?`,lce=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,uIe=RegExp(`${lce.source}${ert}`),cce=RegExp(`(?:T${uIe.source})?`),trt=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,irt=/(\d{4})-?W(\d\d)(?:-?(\d))?/,rrt=/(\d{4})-?(\d{3})/,srt=lIe("weekYear","weekNumber","weekDay"),nrt=lIe("year","ordinal"),ort=/(\d{4})-(\d\d)-(\d\d)/,hIe=RegExp(`${lce.source} ?(?:${cIe.source}|(${aIe.source}))?`),art=RegExp(`(?: ${hIe.source})?`);function EP(t,e,i){const r=t[e];return Bi(r)?i:Wb(r)}function lrt(t,e){return[{year:EP(t,e),month:EP(t,e+1,1),day:EP(t,e+2,1)},null,e+3]}function LI(t,e){return[{hours:EP(t,e,0),minutes:EP(t,e+1,0),seconds:EP(t,e+2,0),milliseconds:oce(t[e+3])},null,e+4]}function Dk(t,e){const i=!t[e]&&!t[e+1],r=Bq(t[e+1],t[e+2]),s=i?null:tc.instance(r);return[{},s,e+3]}function Fk(t,e){const i=t[e]?qd.create(t[e]):null;return[{},i,e+1]}const crt=RegExp(`^T?${lce.source}$`),urt=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function hrt(t){const[e,i,r,s,n,o,a,l,c]=t,u=e[0]==="-",h=l&&l[0]==="-",p=(f,g=!1)=>f!==void 0&&(g||f&&u)?-f:f;return[{years:p(cS(i)),months:p(cS(r)),weeks:p(cS(s)),days:p(cS(n)),hours:p(cS(o)),minutes:p(cS(a)),seconds:p(cS(l),l==="-0"),milliseconds:p(oce(c),h)}]}const drt={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function uce(t,e,i,r,s,n,o){const a={year:e.length===2?XK(Wb(e)):Wb(e),month:eIe.indexOf(i)+1,day:Wb(r),hour:Wb(s),minute:Wb(n)};return o&&(a.second=Wb(o)),t&&(a.weekday=t.length>3?iIe.indexOf(t)+1:rIe.indexOf(t)+1),a}const prt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function frt(t){const[,e,i,r,s,n,o,a,l,c,u,h]=t,p=uce(e,s,r,i,n,o,a);let f;return l?f=drt[l]:c?f=0:f=Bq(u,h),[p,new tc(f)]}function mrt(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const grt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,yrt=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,_rt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Bge(t){const[,e,i,r,s,n,o,a]=t;return[uce(e,s,r,i,n,o,a),tc.utcInstance]}function vrt(t){const[,e,i,r,s,n,o,a]=t;return[uce(e,a,i,r,s,n,o),tc.utcInstance]}const brt=II(trt,cce),wrt=II(irt,cce),xrt=II(rrt,cce),Srt=II(uIe),dIe=$I(lrt,LI,Dk,Fk),Trt=$I(srt,LI,Dk,Fk),Ert=$I(nrt,LI,Dk,Fk),Crt=$I(LI,Dk,Fk);function Mrt(t){return NI(t,[brt,dIe],[wrt,Trt],[xrt,Ert],[Srt,Crt])}function Art(t){return NI(mrt(t),[prt,frt])}function Rrt(t){return NI(t,[grt,Bge],[yrt,Bge],[_rt,vrt])}function Prt(t){return NI(t,[urt,hrt])}const Ort=$I(LI);function Irt(t){return NI(t,[crt,Ort])}const $rt=II(ort,art),Nrt=II(hIe),Lrt=$I(LI,Dk,Fk);function Drt(t){return NI(t,[$rt,dIe],[Nrt,Lrt])}const zge="Invalid Duration",pIe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},Frt={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...pIe},tp=146097/400,ZC=146097/4800,krt={years:{quarters:4,months:12,weeks:tp/7,days:tp,hours:tp*24,minutes:tp*24*60,seconds:tp*24*60*60,milliseconds:tp*24*60*60*1e3},quarters:{months:3,weeks:tp/28,days:tp/4,hours:tp*24/4,minutes:tp*24*60/4,seconds:tp*24*60*60/4,milliseconds:tp*24*60*60*1e3/4},months:{weeks:ZC/7,days:ZC,hours:ZC*24,minutes:ZC*24*60,seconds:ZC*24*60*60,milliseconds:ZC*24*60*60*1e3},...pIe},O2=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Urt=O2.slice(0).reverse();function C1(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new rs(r)}function fIe(t,e){let i=e.milliseconds??0;for(const r of Urt.slice(1))e[r]&&(i+=e[r]*t[r].milliseconds);return i}function Vge(t,e){const i=fIe(t,e)<0?-1:1;O2.reduceRight((r,s)=>{if(Bi(e[s]))return r;if(r){const n=e[r]*i,o=t[s][r],a=Math.floor(n/o);e[s]+=a*i,e[r]-=a*o*i}return s},null),O2.reduce((r,s)=>{if(Bi(e[s]))return r;if(r){const n=e[r]%1;e[r]-=n,e[s]+=n*t[r][s]}return s},null)}function Brt(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class rs{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?krt:Frt;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||Gs.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return rs.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new dh(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new rs({values:vj(e,rs.normalizeUnit),loc:Gs.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(J2(e))return rs.fromMillis(e);if(rs.isDuration(e))return e;if(typeof e=="object")return rs.fromObject(e);throw new dh(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=Prt(e);return r?rs.fromObject(r,i):rs.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=Irt(e);return r?rs.fromObject(r,i):rs.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new dh("need to specify a reason the Duration is invalid");const r=e instanceof zm?e:new zm(e,i);if(Uo.throwOnInvalid)throw new pit(r);return new rs({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new TOe(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?Vc.create(this.loc,r).formatDurationFromString(this,e):zge}toHuman(e={}){if(!this.isValid)return zge;const i=O2.map(r=>{const s=this.values[r];return Bi(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(s)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=ace(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();return i<0||i>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},Ti.fromMillis(i,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?fIe(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=rs.fromDurationLike(e),r={};for(const s of O2)(RO(i.values,s)||RO(this.values,s))&&(r[s]=i.get(s)+this.get(s));return C1(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=rs.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=KOe(e(this.values[r],r));return C1(this,{values:i},!0)}get(e){return this[rs.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...vj(e,rs.normalizeUnit)};return C1(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:s,conversionAccuracy:r};return C1(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return Vge(this.matrix,e),C1(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=Brt(this.normalize().shiftToAll().toObject());return C1(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>rs.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of O2)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;J2(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3}else J2(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return Vge(this.matrix,i),C1(this,{values:i},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return C1(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of O2)if(!i(this.values[r],e.values[r]))return!1;return!0}}const JC="Invalid Interval";function zrt(t,e){return!t||!t.isValid?yo.invalid("missing or invalid start"):!e||!e.isValid?yo.invalid("missing or invalid end"):e<t?yo.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class yo{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new dh("need to specify a reason the Interval is invalid");const r=e instanceof zm?e:new zm(e,i);if(Uo.throwOnInvalid)throw new dit(r);return new yo({invalid:r})}static fromDateTimes(e,i){const r=E$(e),s=E$(i),n=zrt(r,s);return n??new yo({start:r,end:s})}static after(e,i){const r=rs.fromDurationLike(i),s=E$(e);return yo.fromDateTimes(s,s.plus(r))}static before(e,i){const r=rs.fromDurationLike(i),s=E$(e);return yo.fromDateTimes(s.minus(r),s)}static fromISO(e,i){const[r,s]=(e||"").split("/",2);if(r&&s){let n,o;try{n=Ti.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=Ti.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return yo.fromDateTimes(n,a);if(o){const c=rs.fromISO(s,i);if(c.isValid)return yo.after(n,c)}else if(l){const c=rs.fromISO(r,i);if(c.isValid)return yo.before(a,c)}}return yo.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",i){if(!this.isValid)return NaN;const r=this.start.startOf(e,i);let s;return i?.useLocaleWeeks?s=this.end.reconfigure({locale:r.locale}):s=this.end,s=s.startOf(e,i),Math.floor(s.diff(r,e).get(e))+(s.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?yo.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(E$).filter(o=>this.contains(o)).sort((o,a)=>o.toMillis()-a.toMillis()),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(yo.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(e){const i=rs.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(yo.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:yo.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return yo.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(yo.fromDateTimes(i,l.time)),i=null);return yo.merge(s)}difference(...e){return yo.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:JC}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=gj,i={}){return this.isValid?Vc.create(this.s.loc.clone(i),e).formatInterval(this):JC}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:JC}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:JC}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:JC}toFormat(e,{separator:i=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:JC}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):rs.invalid(this.invalidReason)}mapEndpoints(e){return yo.fromDateTimes(e(this.s),e(this.e))}}let dU=class{static hasDST(e=Uo.defaultZone){const i=Ti.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return qd.isValidZone(e)}static normalizeZone(e){return ow(e,Uo.defaultZone)}static getStartOfWeek({locale:e=null,locObj:i=null}={}){return(i||Gs.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:i=null}={}){return(i||Gs.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:i=null}={}){return(i||Gs.create(e)).getWeekendDays().slice()}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Gs.create(i,r,n)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Gs.create(i,r,n)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Gs.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Gs.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Gs.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return Gs.create(i,null,"gregory").eras(e)}static features(){return{relative:ZOe(),localeWeek:JOe()}}};function Gge(t,e){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(rs.fromMillis(r).as("days"))}function Vrt(t,e,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=Gge(l,c);return(u-u%7)/7}],["days",Gge]],s={},n=t;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s),t>e&&(a=t,s[l]--,t=n.plus(s))):t=a);return[t,s,a,o]}function Grt(t,e,i,r){let[s,n,o,a]=Vrt(t,e,i);const l=e-s,c=i.filter(h=>["hours","minutes","seconds","milliseconds"].indexOf(h)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const u=rs.fromObject(n,r);return c.length>0?rs.fromMillis(l,r).shiftTo(...c).plus(u):u}const hce={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},jge={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},jrt=hce.hanidec.replace(/[\[|\]]/g,"").split("");function Hrt(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(hce.hanidec)!==-1)e+=jrt.indexOf(t[i]);else for(const s in jge){const[n,o]=jge[s];r>=n&&r<=o&&(e+=r-n)}}return parseInt(e,10)}else return e}function Pf({numberingSystem:t},e=""){return new RegExp(`${hce[t||"latn"]}${e}`)}const qrt="missing Intl.DateTimeFormat.formatToParts support";function ys(t,e=i=>i){return{regex:t,deser:([i])=>e(Hrt(i))}}const Wrt=String.fromCharCode(160),mIe=`[ ${Wrt}]`,gIe=new RegExp(mIe,"g");function Yrt(t){return t.replace(/\./g,"\\.?").replace(gIe,mIe)}function Hge(t){return t.replace(/\./g,"").replace(gIe," ").toLowerCase()}function Of(t,e){return t===null?null:{regex:RegExp(t.map(Yrt).join("|")),deser:([i])=>t.findIndex(r=>Hge(i)===Hge(r))+e}}function qge(t,e){return{regex:t,deser:([,i,r])=>Bq(i,r),groups:e}}function pU(t){return{regex:t,deser:([e])=>e}}function Xrt(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Zrt(t,e){const i=Pf(e),r=Pf(e,"{2}"),s=Pf(e,"{3}"),n=Pf(e,"{4}"),o=Pf(e,"{6}"),a=Pf(e,"{1,2}"),l=Pf(e,"{1,3}"),c=Pf(e,"{1,6}"),u=Pf(e,"{1,9}"),h=Pf(e,"{2,4}"),p=Pf(e,"{4,6}"),f=v=>({regex:RegExp(Xrt(v.val)),deser:([b])=>b,literal:!0}),y=(v=>{if(t.literal)return f(v);switch(v.val){case"G":return Of(e.eras("short"),0);case"GG":return Of(e.eras("long"),0);case"y":return ys(c);case"yy":return ys(h,XK);case"yyyy":return ys(n);case"yyyyy":return ys(p);case"yyyyyy":return ys(o);case"M":return ys(a);case"MM":return ys(r);case"MMM":return Of(e.months("short",!0),1);case"MMMM":return Of(e.months("long",!0),1);case"L":return ys(a);case"LL":return ys(r);case"LLL":return Of(e.months("short",!1),1);case"LLLL":return Of(e.months("long",!1),1);case"d":return ys(a);case"dd":return ys(r);case"o":return ys(l);case"ooo":return ys(s);case"HH":return ys(r);case"H":return ys(a);case"hh":return ys(r);case"h":return ys(a);case"mm":return ys(r);case"m":return ys(a);case"q":return ys(a);case"qq":return ys(r);case"s":return ys(a);case"ss":return ys(r);case"S":return ys(l);case"SSS":return ys(s);case"u":return pU(u);case"uu":return pU(a);case"uuu":return ys(i);case"a":return Of(e.meridiems(),0);case"kkkk":return ys(n);case"kk":return ys(h,XK);case"W":return ys(a);case"WW":return ys(r);case"E":case"c":return ys(i);case"EEE":return Of(e.weekdays("short",!1),1);case"EEEE":return Of(e.weekdays("long",!1),1);case"ccc":return Of(e.weekdays("short",!0),1);case"cccc":return Of(e.weekdays("long",!0),1);case"Z":case"ZZ":return qge(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return qge(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return pU(/[a-z_+-/]{1,256}?/i);case" ":return pU(/[^\S\n\r]/);default:return f(v)}})(t)||{invalidReason:qrt};return y.token=t,y}const Jrt={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function Qrt(t,e,i){const{type:r,value:s}=t;if(r==="literal"){const l=/^\s+$/.test(s);return{literal:!l,val:l?" ":s}}const n=e[r];let o=r;r==="hour"&&(e.hour12!=null?o=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?o="hour12":o="hour24":o=i.hour12?"hour12":"hour24");let a=Jrt[o];if(typeof a=="object"&&(a=a[n]),a)return{literal:!1,val:a}}function Krt(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function est(t,e,i){const r=t.match(e);if(r){const s={};let n=1;for(const o in i)if(RO(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function tst(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Bi(t.z)||(i=qd.create(t.z)),Bi(t.Z)||(i||(i=new tc(t.Z)),r=t.Z),Bi(t.q)||(t.M=(t.q-1)*3+1),Bi(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Bi(t.u)||(t.S=oce(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),i,r]}let AW=null;function ist(){return AW||(AW=Ti.fromMillis(1555555555555)),AW}function rst(t,e){if(t.literal)return t;const i=Vc.macroTokenToFormatOpts(t.val),r=vIe(i,e);return r==null||r.includes(void 0)?t:r}function yIe(t,e){return Array.prototype.concat(...t.map(i=>rst(i,e)))}function _Ie(t,e,i){const r=yIe(Vc.parseFormat(i),t),s=r.map(o=>Zrt(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:r,invalidReason:n.invalidReason};{const[o,a]=Krt(s),l=RegExp(o,"i"),[c,u]=est(e,l,a),[h,p,f]=u?tst(u):[null,null,void 0];if(RO(u,"a")&&RO(u,"H"))throw new LR("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:l,rawMatches:c,matches:u,result:h,zone:p,specificOffset:f}}}function sst(t,e,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=_Ie(t,e,i);return[r,s,n,o]}function vIe(t,e){if(!t)return null;const r=Vc.create(e,t).dtFormatter(ist()),s=r.formatToParts(),n=r.resolvedOptions();return s.map(o=>Qrt(o,t,n))}const RW="Invalid DateTime",Wge=864e13;function fU(t){return new zm("unsupported zone",`the zone "${t.name}" is not supported`)}function PW(t){return t.weekData===null&&(t.weekData=yj(t.c)),t.weekData}function OW(t){return t.localWeekData===null&&(t.localWeekData=yj(t.c,t.loc.getMinDaysInFirstWeek(),t.loc.getStartOfWeek())),t.localWeekData}function uS(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new Ti({...i,...e,old:i})}function bIe(t,e,i){let r=t-e*60*1e3;const s=i.offset(r);if(e===s)return[r,e];r-=(s-e)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function mU(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function uV(t,e,i){return bIe(Uq(t),e,i)}function Yge(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:r,month:s,day:Math.min(t.c.day,_j(r,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=rs.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=Uq(n);let[l,c]=bIe(a,i,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function T$(t,e,i,r,s,n){const{setZone:o,zone:a}=i;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=Ti.fromObject(t,{...i,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return Ti.invalid(new zm("unparsable",`the input "${s}" can't be parsed as ${r}`))}function gU(t,e,i=!0){return t.isValid?Vc.create(Gs.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function IW(t,e){const i=t.c.year>9999||t.c.year<0;let r="";return i&&t.c.year>=0&&(r+="+"),r+=da(t.c.year,i?6:4),e?(r+="-",r+=da(t.c.month),r+="-",r+=da(t.c.day)):(r+=da(t.c.month),r+=da(t.c.day)),r}function Xge(t,e,i,r,s,n){let o=da(t.c.hour);return e?(o+=":",o+=da(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=":")):o+=da(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=da(t.c.second),(t.c.millisecond!==0||!r)&&(o+=".",o+=da(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=da(Math.trunc(-t.o/60)),o+=":",o+=da(Math.trunc(-t.o%60))):(o+="+",o+=da(Math.trunc(t.o/60)),o+=":",o+=da(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const wIe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},nst={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},ost={ordinal:1,hour:0,minute:0,second:0,millisecond:0},xIe=["year","month","day","hour","minute","second","millisecond"],ast=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],lst=["year","ordinal","hour","minute","second","millisecond"];function cst(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new TOe(t);return e}function Zge(t){switch(t.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return cst(t)}}function Jge(t,e){const i=ow(e.zone,Uo.defaultZone),r=Gs.fromObject(e),s=Uo.now();let n,o;if(Bi(t.year))n=s;else{for(const c of xIe)Bi(t[c])&&(t[c]=wIe[c]);const a=YOe(t)||XOe(t);if(a)return Ti.invalid(a);const l=i.offset(s);[n,o]=uV(t,l,i)}return new Ti({ts:n,zone:i,loc:r,o})}function Qge(t,e,i){const r=Bi(i.round)?!0:i.round,s=(o,a)=>(o=ace(o,r||i.calendary?0:2,!0),e.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,i.units[i.units.length-1])}function Kge(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}class Ti{constructor(e){const i=e.zone||Uo.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new zm("invalid input"):null)||(i.isValid?null:fU(i));this.ts=Bi(e.ts)?Uo.now():e.ts;let s=null,n=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[s,n]=[e.old.c,e.old.o];else{const a=i.offset(this.ts);s=mU(this.ts,a),r=Number.isNaN(s.year)?new zm("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=e.loc||Gs.create(),this.invalid=r,this.weekData=null,this.localWeekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new Ti({})}static local(){const[e,i]=Kge(arguments),[r,s,n,o,a,l,c]=i;return Jge({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,i]=Kge(arguments),[r,s,n,o,a,l,c]=i;return e.zone=tc.utcInstance,Jge({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,i={}){const r=kit(e)?e.valueOf():NaN;if(Number.isNaN(r))return Ti.invalid("invalid input");const s=ow(i.zone,Uo.defaultZone);return s.isValid?new Ti({ts:r,zone:s,loc:Gs.fromObject(i)}):Ti.invalid(fU(s))}static fromMillis(e,i={}){if(J2(e))return e<-Wge||e>Wge?Ti.invalid("Timestamp out of range"):new Ti({ts:e,zone:ow(i.zone,Uo.defaultZone),loc:Gs.fromObject(i)});throw new dh(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(J2(e))return new Ti({ts:e*1e3,zone:ow(i.zone,Uo.defaultZone),loc:Gs.fromObject(i)});throw new dh("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=ow(i.zone,Uo.defaultZone);if(!r.isValid)return Ti.invalid(fU(r));const s=Gs.fromObject(i),n=vj(e,Zge),{minDaysInFirstWeek:o,startOfWeek:a}=Dge(n,s),l=Uo.now(),c=Bi(i.specificOffset)?r.offset(l):i.specificOffset,u=!Bi(n.ordinal),h=!Bi(n.year),p=!Bi(n.month)||!Bi(n.day),f=h||p,g=n.weekYear||n.weekNumber;if((f||u)&&g)throw new LR("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(p&&u)throw new LR("Can't mix ordinal dates with month/day");const y=g||n.weekday&&!f;let v,b,w=mU(l,c);y?(v=ast,b=nst,w=yj(w,o,a)):u?(v=lst,b=ost,w=MW(w)):(v=xIe,b=wIe);let x=!1;for(const D of v){const z=n[D];Bi(z)?x?n[D]=b[D]:n[D]=w[D]:x=!0}const S=y?Lit(n,o,a):u?Dit(n):YOe(n),E=S||XOe(n);if(E)return Ti.invalid(E);const C=y?Nge(n,o,a):u?Lge(n):n,[R,I]=uV(C,c,r),F=new Ti({ts:R,zone:r,o:I,loc:s});return n.weekday&&f&&e.weekday!==F.weekday?Ti.invalid("mismatched weekday",`you can't specify both a weekday of ${n.weekday} and a date of ${F.toISO()}`):F}static fromISO(e,i={}){const[r,s]=Mrt(e);return T$(r,s,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,s]=Art(e);return T$(r,s,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,s]=Rrt(e);return T$(r,s,i,"HTTP",i)}static fromFormat(e,i,r={}){if(Bi(e)||Bi(i))throw new dh("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=Gs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,u]=sst(o,e,i);return u?Ti.invalid(u):T$(a,l,r,`format ${i}`,e,c)}static fromString(e,i,r={}){return Ti.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,s]=Drt(e);return T$(r,s,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new dh("need to specify a reason the DateTime is invalid");const r=e instanceof zm?e:new zm(e,i);if(Uo.throwOnInvalid)throw new hit(r);return new Ti({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=vIe(e,Gs.fromObject(i));return r?r.map(s=>s?s.val:null).join(""):null}static expandFormat(e,i={}){return yIe(Vc.parseFormat(e),Gs.fromObject(i)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?PW(this).weekYear:NaN}get weekNumber(){return this.isValid?PW(this).weekNumber:NaN}get weekday(){return this.isValid?PW(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?OW(this).weekday:NaN}get localWeekNumber(){return this.isValid?OW(this).weekNumber:NaN}get localWeekYear(){return this.isValid?OW(this).weekYear:NaN}get ordinal(){return this.isValid?MW(this.c).ordinal:NaN}get monthShort(){return this.isValid?dU.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?dU.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?dU.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?dU.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,i=6e4,r=Uq(this.c),s=this.zone.offset(r-e),n=this.zone.offset(r+e),o=this.zone.offset(r-s*i),a=this.zone.offset(r-n*i);if(o===a)return[this];const l=r-o*i,c=r-a*i,u=mU(l,o),h=mU(c,a);return u.hour===h.hour&&u.minute===h.minute&&u.second===h.second&&u.millisecond===h.millisecond?[uS(this,{ts:l}),uS(this,{ts:c})]:[this]}get isInLeapYear(){return Lk(this.year)}get daysInMonth(){return _j(this.year,this.month)}get daysInYear(){return this.isValid?TP(this.year):NaN}get weeksInWeekYear(){return this.isValid?mF(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?mF(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:s}=Vc.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(e=0,i={}){return this.setZone(tc.instance(e),i)}toLocal(){return this.setZone(Uo.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=ow(e,Uo.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(i||r){const n=e.offset(this.ts),o=this.toObject();[s]=uV(o,n,e)}return uS(this,{ts:s,zone:e})}else return Ti.invalid(fU(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return uS(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=vj(e,Zge),{minDaysInFirstWeek:r,startOfWeek:s}=Dge(i,this.loc),n=!Bi(i.weekYear)||!Bi(i.weekNumber)||!Bi(i.weekday),o=!Bi(i.ordinal),a=!Bi(i.year),l=!Bi(i.month)||!Bi(i.day),c=a||l,u=i.weekYear||i.weekNumber;if((c||o)&&u)throw new LR("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&o)throw new LR("Can't mix ordinal dates with month/day");let h;n?h=Nge({...yj(this.c,r,s),...i},r,s):Bi(i.ordinal)?(h={...this.toObject(),...i},Bi(i.day)&&(h.day=Math.min(_j(h.year,h.month),h.day))):h=Lge({...MW(this.c),...i});const[p,f]=uV(h,this.o,this.zone);return uS(this,{ts:p,o:f})}plus(e){if(!this.isValid)return this;const i=rs.fromDurationLike(e);return uS(this,Yge(this,i))}minus(e){if(!this.isValid)return this;const i=rs.fromDurationLike(e).negate();return uS(this,Yge(this,i))}startOf(e,{useLocaleWeeks:i=!1}={}){if(!this.isValid)return this;const r={},s=rs.normalizeUnit(e);switch(s){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(s==="weeks")if(i){const n=this.loc.getStartOfWeek(),{weekday:o}=this;o<n&&(r.weekNumber=this.weekNumber-1),r.weekday=n}else r.weekday=1;if(s==="quarters"){const n=Math.ceil(this.month/3);r.month=(n-1)*3+1}return this.set(r)}endOf(e,i){return this.isValid?this.plus({[e]:1}).startOf(e,i).minus(1):this}toFormat(e,i={}){return this.isValid?Vc.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):RW}toLocaleString(e=gj,i={}){return this.isValid?Vc.create(this.loc.clone(i),e).formatDateTime(this):RW}toLocaleParts(e={}){return this.isValid?Vc.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=IW(this,o);return a+="T",a+=Xge(this,o,i,r,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?IW(this,e==="extended"):null}toISOWeekDate(){return gU(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+Xge(this,o==="extended",i,e,r,n):null}toRFC2822(){return gU(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return gU(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?IW(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||e)&&(r&&(s+=" "),i?s+="z":e&&(s+="ZZ")),gU(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():RW}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return rs.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...r},n=Uit(i).map(rs.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=Grt(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",i={}){return this.diff(Ti.now(),e,i)}until(e){return this.isValid?yo.fromDateTimes(this,e):this}hasSame(e,i,r){if(!this.isValid)return!1;const s=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(i,r)<=s&&s<=n.endOf(i,r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||Ti.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),Qge(i,this.plus(r),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?Qge(e.base||Ti.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(Ti.isDateTime))throw new dh("min requires all arguments be DateTimes");return Fge(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(Ti.isDateTime))throw new dh("max requires all arguments be DateTimes");return Fge(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=Gs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return _Ie(o,e,i)}static fromStringExplain(e,i,r={}){return Ti.fromFormatExplain(e,i,r)}static get DATE_SHORT(){return gj}static get DATE_MED(){return EOe}static get DATE_MED_WITH_WEEKDAY(){return fit}static get DATE_FULL(){return COe}static get DATE_HUGE(){return MOe}static get TIME_SIMPLE(){return AOe}static get TIME_WITH_SECONDS(){return ROe}static get TIME_WITH_SHORT_OFFSET(){return POe}static get TIME_WITH_LONG_OFFSET(){return OOe}static get TIME_24_SIMPLE(){return IOe}static get TIME_24_WITH_SECONDS(){return $Oe}static get TIME_24_WITH_SHORT_OFFSET(){return NOe}static get TIME_24_WITH_LONG_OFFSET(){return LOe}static get DATETIME_SHORT(){return DOe}static get DATETIME_SHORT_WITH_SECONDS(){return FOe}static get DATETIME_MED(){return kOe}static get DATETIME_MED_WITH_SECONDS(){return UOe}static get DATETIME_MED_WITH_WEEKDAY(){return mit}static get DATETIME_FULL(){return BOe}static get DATETIME_FULL_WITH_SECONDS(){return zOe}static get DATETIME_HUGE(){return VOe}static get DATETIME_HUGE_WITH_SECONDS(){return GOe}}function E$(t){if(Ti.isDateTime(t))return t;if(t&&t.valueOf&&J2(t.valueOf()))return Ti.fromJSDate(t);if(t&&typeof t=="object")return Ti.fromObject(t);throw new dh(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const _0="system",LE="unknown",Kw="UTC",ust=Intl.DateTimeFormat().resolvedOptions().timeZone,hst="shortOffset";function dst(t){return"timeZoneIANA"in t}function pst(t){return t.startsWith("UTC")}function bj(t,e=!1){return{json:{read:{source:t,reader:(i,r)=>r[t]?hV(r[t]):null},write:!!e&&{allowNull:!0,writer(i,r){r[t]=i?fst(i):null}}}}}function hV(t,e=_0){return t?dst(t)?t.timeZoneIANA:mst(t,e):e}function fst(t){return{timeZoneIANA:t}}function mst(t,e=_0){if(!t||!Sge.has(t.timeZone))return e;const i=Sge.get(t.timeZone);return pst(t.timeZone)||t.respectsDaylightSaving?i:gst(i)}function gst(t){const e=Ti.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${tc.instance(-i).formatOffset(0,"narrow")}`}function xci(t,e,i,r,s){if(e&&s==="date")return{timeZone:Kw,timeZoneName:void 0};const n=r.timeStyle||r.hour,o=i===LE;return{timeZone:o?s==="timestamp-offset"?void 0:t??Kw:i,timeZoneName:o&&n?hst:void 0}}const yst={year:void 0,month:void 0,day:void 0,weekday:void 0},_st={hour:void 0,minute:void 0,second:void 0},SIe={timeZone:Kw},Rg={year:"numeric",month:"numeric",day:"numeric"},C$={year:"numeric",month:"long",day:"numeric"},M$={year:"numeric",month:"short",day:"numeric"},A$={year:"numeric",month:"long",weekday:"long",day:"numeric"},Yb={hour:"numeric",minute:"numeric"},aT={...Yb,second:"numeric"},TIe={hourCycle:"h23"},R$={...Yb,...TIe},P$={...aT,...TIe},EIe={"short-date":Rg,"short-date-short-time":{...Rg,...Yb},"short-date-short-time-24":{...Rg,...R$},"short-date-long-time":{...Rg,...aT},"short-date-long-time-24":{...Rg,...P$},"short-date-le":Rg,"short-date-le-short-time":{...Rg,...Yb},"short-date-le-short-time-24":{...Rg,...R$},"short-date-le-long-time":{...Rg,...aT},"short-date-le-long-time-24":{...Rg,...P$},"long-month-day-year":C$,"long-month-day-year-short-time":{...C$,...Yb},"long-month-day-year-short-time-24":{...C$,...R$},"long-month-day-year-long-time":{...C$,...aT},"long-month-day-year-long-time-24":{...C$,...P$},"day-short-month-year":M$,"day-short-month-year-short-time":{...M$,...Yb},"day-short-month-year-short-time-24":{...M$,...R$},"day-short-month-year-long-time":{...M$,...aT},"day-short-month-year-long-time-24":{...M$,...P$},"long-date":A$,"long-date-short-time":{...A$,...Yb},"long-date-short-time-24":{...A$,...R$},"long-date-long-time":{...A$,...aT},"long-date-long-time-24":{...A$,...P$},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Yb,"long-time":aT},vst=Yc()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),CIe={ar:"ar-u-nu-latn-ca-gregory"};let ZK=new WeakMap;const Vq=EIe["short-date-short-time"];function bst(t){let e=ZK.get(t);if(!e){const i=Eh(),r=CIe[i]||i,s=dce(t.timeZone??_0),n={...t,timeZone:s};e=new Intl.DateTimeFormat(r,n),ZK.set(t,e)}return e}function wst(t){return EIe[t]}function ex(t,e=Vq){return bst(e).format(t)}function Sci(t,e=Vq){return ex(new Date(t),{...e,...SIe,..._st})}function Tci(t,e=Vq){return ex(new Date(`1970-01-01T${t}Z`),{...e,...SIe,...yst})}function Eci(t,e=Vq){if(e.timeZone)return ex(new Date(t),e);const i=Ti.fromISO(t,{setZone:!0}),r=Eh(),s=CIe[r]??r,n=i.offset===0?Kw:e.timeZone,o={...e,timeZone:n};return i.toLocaleString(o,{locale:s})}function dce(t){switch(t){case _0:return ust;case LE:return Kw;default:return t}}Ule(()=>{ZK=new WeakMap});const eye={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function $W(t,e,i,r=_0){const s=new qd(dce(r)),n=Ti.fromJSDate(t,{zone:s}),o=i==="decades"||i==="centuries"?"year":AIe(i);return i==="decades"&&(e*=10),i==="centuries"&&(e*=100),n.plus({[o]:e}).toJSDate()}function Cci(t,e,i="milliseconds"){const r=t.getTime(),s=MIe(e,i,"milliseconds");return new Date(r+s)}function tye(t,e,i=_0){const r=new qd(dce(i)),s=Ti.fromJSDate(t,{zone:r});if(e==="decades"||e==="centuries"){const o=s.startOf("year"),{year:a}=o,l=a-a%(e==="decades"?10:100);return o.set({year:l}).toJSDate()}const n=AIe(e);return s.startOf(n).toJSDate()}function MIe(t,e,i){return t===0?0:t*eye[e]/eye[i]}function Mci(t,e){return t&&e?t.intersection(e):t||e}function AIe(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var mp;let pd=mp=class extends we{static get allTime(){return iye}static get empty(){return xst}static fromArray(t){return new mp({start:t[0]!=null?new Date(t[0]):t[0],end:t[1]!=null?new Date(t[1]):t[1]})}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?.getTime()??null}get isAllTime(){return this.equals(mp.allTime)}get isEmpty(){return this.equals(mp.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?.getTime()??null}clone(){return new mp({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=this.start?.getTime()??this.start,i=this.end?.getTime()??this.end,r=t.start?.getTime()??t.start,s=t.end?.getTime()??t.end;return e===r&&i===s}expandTo(t,e=_0){if(this.isEmpty||this.isAllTime)return this.clone();let i=this.start;i&&(i=tye(i,t,e));let r=this.end;if(r){const s=tye(r,t,e);r=r.getTime()===s.getTime()?s:$W(s,1,t,e)}return new mp({start:i,end:r})}intersection(t){if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return mp.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=this.start?.getTime()??-1/0,i=this.end?.getTime()??1/0,r=t.start?.getTime()??-1/0,s=t.end?.getTime()??1/0;let n,o;return r>=e&&r<=i?n=r:e>=r&&e<=s&&(n=e),i>=r&&i<=s?o=i:s>=e&&s<=i&&(o=s),n==null||o==null||isNaN(n)||isNaN(o)?mp.empty:new mp({start:n===-1/0?null:new Date(n),end:o===1/0?null:new Date(o)})}offset(t,e,i=_0){if(this.isEmpty||this.isAllTime)return this.clone();const r=new mp,{start:s,end:n}=this;return s!=null&&(r.start=$W(s,t,e,i)),n!=null&&(r.end=$W(n,t,e,i)),r}toArray(){return this.isEmpty?[void 0,void 0]:[this.start?.getTime()??null,this.end?.getTime()??null]}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return iye.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,i=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new mp({start:e,end:i})}};d([m({type:Date,json:{write:{allowNull:!0}}})],pd.prototype,"end",void 0),d([Le("end")],pd.prototype,"readEnd",null),d([Ve("end")],pd.prototype,"writeEnd",null),d([m({readOnly:!0,json:{read:!1}})],pd.prototype,"isAllTime",null),d([m({readOnly:!0,json:{read:!1}})],pd.prototype,"isEmpty",null),d([m({type:Date,json:{write:{allowNull:!0}}})],pd.prototype,"start",void 0),d([Le("start")],pd.prototype,"readStart",null),d([Ve("start")],pd.prototype,"writeStart",null),pd=mp=d([N("esri.TimeExtent")],pd);const iye=new pd,xst=new pd({start:void 0,end:void 0}),wl=pd;let RIe=0;const pce=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+RIe++})}};return e=d([N("esri.core.Identifiable")],e),e},Aci=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:RIe++})}};return e=d([N("esri.core.Identifiable.NumericIdentifiable")],e),e};let rye=class extends pce(class{}){};rye=d([N("esri.core.Identifiable")],rye);async function Sst(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:i}=await ye(()=>import("./portalLayers-47ed75dc.js").then(r=>r.p),["./portalLayers-47ed75dc.js","./associatedFeatureServiceUtils-82735909.js","./fetchService-fa9a0116.js"],import.meta.url);try{return await i(e)}catch(r){const s=e?.portalItem,n=s?.id||"unset",o=s?.portal?.url||gr.portalUrl;throw oe.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",r),r}}let Tst=0,No=class extends un.EventedMixin(pce(lg)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new lr(-180,-90,180,90,Je.WGS84),this.id=Date.now().toString(16)+"-layer-"+Tst++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Je.WGS84,this.title=null,this.type=null,this.url=null,this.visibilityTimeExtent=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await ye(()=>import("./arcgisLayers-aecfd859.js"),["./arcgisLayers-aecfd859.js","./associatedFeatureServiceUtils-82735909.js","./fetchService-fa9a0116.js"],import.meta.url)).fromUrl(i)}static fromPortalItem(e){return Sst(e)}initialize(){this.when().catch(e=>{En(e)||oe.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const e=this.parent;if(e){const i=this;"layers"in e&&e.layers.includes(i)?e.layers.remove(i):"tables"in e&&e.tables.includes(i)?e.tables.remove(i):"baseLayers"in e&&e.baseLayers.includes(i)?e.baseLayers.remove(i):"referenceLayers"in e&&e.referenceLayers.includes(i)&&e.referenceLayers.remove(i),this._set("parent",null)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return ln(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await qi(e,{query:{f:"json"},responseType:"json"})).data;throw new j("layer:no-attribution-data","Layer does not have attribution data")}};d([m({type:String})],No.prototype,"attributionDataUrl",void 0),d([m({type:lr})],No.prototype,"fullExtent",void 0),d([m({readOnly:!0})],No.prototype,"hasAttributionData",null),d([m({type:String,clonable:!1})],No.prototype,"id",void 0),d([m({type:Boolean,nonNullable:!0})],No.prototype,"legendEnabled",void 0),d([m({type:["show","hide","hide-children"]})],No.prototype,"listMode",void 0),d([m({type:Number,range:{min:0,max:1},nonNullable:!0})],No.prototype,"opacity",void 0),d([m({clonable:!1})],No.prototype,"parent",void 0),d([m({readOnly:!0})],No.prototype,"parsedUrl",null),d([m({type:Boolean,readOnly:!0})],No.prototype,"persistenceEnabled",void 0),d([m({type:Boolean})],No.prototype,"popupEnabled",void 0),d([m({type:Boolean})],No.prototype,"attributionVisible",void 0),d([m({type:Je})],No.prototype,"spatialReference",void 0),d([m({type:String})],No.prototype,"title",void 0),d([m({readOnly:!0,json:{read:!1}})],No.prototype,"type",void 0),d([m()],No.prototype,"url",void 0),d([m({type:wl})],No.prototype,"visibilityTimeExtent",void 0),d([m({type:Boolean,nonNullable:!0})],No.prototype,"visible",void 0),No=d([N("esri.layers.Layer")],No);const Gq=No;function JK(t,e,i){let r,s;if(t)for(let n=0,o=t.length;n<o;n++){if(r=t.at(n),r?.[e]===i)return r;if(r?.type==="group"&&(s=JK(r.layers,e,i),s))return s}}const Est=t=>{let e=class extends t{constructor(...i){super(...i),this.layers=new ct;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||oe.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>{if(o.item===this)return o.preventDefault(),void oe.getLogger(this).error("#add()","Cannot add layer to itself.");r(o.item)}),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const i=this.layers.toArray();for(const r of i)r.destroy();this.layers.destroy()}set layers(i){this._set("layers",y0(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof Gq){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else Lh(i)?i.then(n=>{this.destroyed||this.add(n,r)}):oe.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;let n=s.getNextIndex(r);i.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(i){return JK(this.layers,"id",i)}findLayerByUid(i){return JK(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return d([m()],e.prototype,"layers",null),e=d([N("esri.support.LayersMixin")],e),e};function QK(t,e,i){if(t)for(let r=0,s=t.length;r<s;r++){const n=t.at(r);if(n[e]===i)return n;if(n?.type==="group"){const o=QK(n.tables,e,i);if(o)return o}}}const Cst=t=>{let e=class extends t{constructor(...i){super(...i),this.tables=new ct,this.addHandles([this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&oe.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})])}destroy(){const i=this.tables.toArray();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",y0(i,this._get("tables")))}findTableById(i){return QK(this.tables,"id",i)}findTableByUid(i){return QK(this.tables,"uid",i)}};return d([m()],e.prototype,"tables",null),e=d([N("esri.support.TablesMixin")],e),e};let Jf=class extends Cst(Est(un.EventedMixin(Fe))){constructor(e){super(e),this.allLayers=new dF({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=Ntt(this),this.basemap=null,this.editableLayers=new dF({getCollections:()=>[this.allLayers],itemFilterFunction:qet}),this.ground=new hF,this._basemapCache=Mtt()}destroy(){Att(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=Ge(this.basemap),Ge(this.ground),this._set("ground",null)}castBasemap(e){return Zle(e,this._basemapCache)}castGround(e){return Ltt(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};d([m({readOnly:!0,dependsOn:[]})],Jf.prototype,"allLayers",void 0),d([m({readOnly:!0})],Jf.prototype,"allTables",void 0),d([m({type:SP,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Jf.prototype,"basemap",void 0),d([vi("basemap")],Jf.prototype,"castBasemap",null),d([m({readOnly:!0})],Jf.prototype,"editableLayers",void 0),d([m({type:hF,nonNullable:!0})],Jf.prototype,"ground",void 0),d([vi("ground")],Jf.prototype,"castGround",null),d([m()],Jf.prototype,"undoRedo",void 0),Jf=d([N("esri.Map")],Jf);const PIe=Jf,ms=t=>{let e=class extends t{clone(){const i=oc(this);aq(i,"unable to clone instance of non-accessor class");const r=i.metadata,s=i.store,n={},o=new Map;for(const l in r){const c=r[l],u=s?.originOf(l),h=c.clonable;if(c.readOnly||h===!1||u!==Wi.USER&&u!==Wi.DEFAULTS&&u!==Wi.WEB_MAP&&u!==Wi.WEB_SCENE)continue;const p=this[l];let f=null;f=typeof h=="function"?h(p):h==="reference"?p:WQ(p),p!=null&&f==null||(u===Wi.DEFAULTS?o.set(l,f):n[l]=f)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const l=oc(a)?.store;if(l)for(const[c,u]of o)l.set(c,u,Wi.DEFAULTS)}return a}};return e=d([N("esri.core.Clonable")],e),e};let DE=class extends ms(Fe){};DE=d([N("esri.core.Clonable")],DE);let lT=class extends DE{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],lT.prototype,"row",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],lT.prototype,"column",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],lT.prototype,"rows",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],lT.prototype,"columns",void 0),lT=d([N("esri.CameraLayout")],lT);const OIe=lT;let tx=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}normalize(e,i=0,r=!1){return sye(this.range,this.min,this.max,e,i,r)}clamp(e,i=0){return $e(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+KK(this.range,e-i,r)}minimalMonotonic(e,i,r){return sye(this.range,e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,s=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(s)?r:s}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function sye(t,e,i,r,s=0,n=!1){return(r-=s)<e?r+=KK(t,e-r):r>i&&(r-=KK(t,r-i)),n&&r===i&&(r=e),r+s}function KK(t,e,i=0){return Math.ceil((e-i)/t)*t+i}const Mst=new tx(0,2*Math.PI),ix=new tx(-Math.PI,Math.PI),fce=new tx(0,360);let ty=class extends ms(we){constructor(...e){super(...e),this.position=new $t([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new OIe}normalizeCtorArgs(e,i,r,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return i!=null&&(n.heading=i),r!=null&&(n.tilt=r),s!=null&&(n.fov=s),n}return e}writePosition(e,i,r,s){const n=e.clone();n.x=Gp(e.x||0),n.y=Gp(e.y||0),n.z=e.hasZ?Gp(e.z||0):e.z,i[r]=n.write({},s)}readPosition(e,i){const r=new $t;return r.read(e,i),r.x=Gp(r.x||0),r.y=Gp(r.y||0),r.z=r.hasZ?Gp(r.z||0):r.z,r}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};d([m({type:$t,json:{write:{isRequired:!0}}})],ty.prototype,"position",void 0),d([Ve("position")],ty.prototype,"writePosition",null),d([Le("position")],ty.prototype,"readPosition",null),d([m({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),vi(t=>fce.normalize(Gp(t)))],ty.prototype,"heading",void 0),d([m({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),vi(t=>$e(Gp(t),-180,180))],ty.prototype,"tilt",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],ty.prototype,"fov",void 0),d([m({type:OIe,nonNullable:!0,json:{read:!1,write:!1}})],ty.prototype,"layout",void 0),ty=d([N("esri.Camera")],ty);const Wd=ty;var eee;let fb=eee=class extends we{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new eee({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};d([m({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:NW}}}}})],fb.prototype,"rotation",void 0),d([vi("rotation")],fb.prototype,"castRotation",null),d([m({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:NW}}}}})],fb.prototype,"scale",void 0),d([m({types:gC,json:{read:Vv,write:!0,origins:{"web-scene":{read:Vv,write:{overridePolicy:NW}}}}})],fb.prototype,"targetGeometry",void 0),d([m({type:Wd,json:{write:!0}})],fb.prototype,"camera",void 0),fb=eee=d([N("esri.Viewpoint")],fb);const dg=fb;function NW(){return{enabled:!this.camera}}let Ast=class IIe{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(ZQ),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new IIe,r=this._originStores[Wi.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,ee(s),Wi.DEFAULTS)});for(let s=Wi.SERVICE;s<ZQ;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||i.set(a,ee(o),s)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=Wi.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const n=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),n!==i}return!1}delete(e,i=Wi.USER){const r=this._originStores[i];if(!r)return;const s=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],s=r?.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,i),n!==s}originOf(e){return this._propertyOriginMap.get(e)||Wi.DEFAULTS}forEach(e){this._values.forEach(e)}};const $Ie=t=>{let e=class extends t{constructor(...i){super(...i);const r=oc(this),s=r.store,n=new Ast;r.store=n,aRe(r,s,n)}read(i,r){cRe(this,i,r)}getAtOrigin(i,r){const s=LW(this),n=yw(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return F6(this.originIdOf(i))}originIdOf(i){return LW(this).originOf(i)}revert(i,r){const s=LW(this),n=yw(r),o=oc(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=d([N("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function LW(t){return oc(t).store}let nye=class extends $Ie(Fe){};nye=d([N("esri.core.ReadOnlyMultiOriginJSONSupport")],nye);const Rst=t=>{let e=class extends t{constructor(...i){super(...i)}clear(i,r="user"){return DW(this).delete(i,yw(r))}write(i,r){return dRe(this,i=i||{},r),i}setAtOrigin(i,r,s){oc(this).setAtOrigin(i,r,yw(s))}removeOrigin(i){const r=DW(this),s=yw(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),Wi.USER)}updateOrigin(i,r){const s=DW(this),n=yw(r),o=Jm(this,i);for(let a=n+1;a<ZQ;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return e=d([N("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function DW(t){return oc(t).store}const jq=t=>{let e=class extends Rst($Ie(t)){constructor(...i){super(...i)}};return e=d([N("esri.core.MultiOriginJSONSupport")],e),e};let tee=class extends jq(Fe){};tee=d([N("esri.core.MultiOriginJSONSupport")],tee);function Pst(t){return t&&"getAtOrigin"in t&&"originOf"in t}function oye(t){t?.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:i,newOrigin:r})=>{Pst(e)&&r&&e.originOf(i)!==r&&e.updateOrigin(i,r)})}var Q3;const wj=Yc()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),NIe=wj.jsonValues.slice();QD(NIe,"orthometric");const iD=Yc()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Qf=Q3=class extends we{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return wj.write(t,e,i)}readHeightModel(t,e,i){return wj.read(t)||(i?.messages&&i.messages.push(Ost(t,{context:i})),null)}readHeightUnit(t,e,i){return iD.read(t)||(i?.messages&&i.messages.push(aye(t,{context:i})),null)}readHeightUnitService(t,e,i){return YRe(t)||iD.read(t)||(i?.messages&&i.messages.push(aye(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new Q3({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=XRe(e);return new Q3({heightModel:t.heightModel,heightUnit:i??void 0,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new Q3;return e.read(t,{origin:"web-scene"}),e}};function aye(t,e){return new m0("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function Ost(t,e){return new m0("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}d([m({type:wj.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:NIe,default:"ellipsoidal"}}}})],Qf.prototype,"heightModel",void 0),d([Ve("web-scene","heightModel")],Qf.prototype,"writeHeightModel",null),d([Le(["web-scene","service"],"heightModel")],Qf.prototype,"readHeightModel",null),d([m({type:iD.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:iD.jsonValues,write:iD.write}}}})],Qf.prototype,"heightUnit",void 0),d([Le("web-scene","heightUnit")],Qf.prototype,"readHeightUnit",null),d([Le("service","heightUnit")],Qf.prototype,"readHeightUnitService",null),d([m({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Qf.prototype,"vertCRS",void 0),d([Le("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Qf.prototype,"readVertCRS",null),Qf=Q3=d([N("esri.geometry.HeightModelInfo")],Qf);const $x=Qf,kci=Math.PI/180,Uci=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,M1=br.radius,If=br.eccentricitySquared,Ist={a1:M1*If,a2:M1*If*M1*If,a3:M1*If*If/2,a4:M1*If*M1*If*2.5,a5:M1*If+M1*If*If/2,a6:1-If},Bci={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:br.radius,f:br.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:kv.radius,f:kv.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Qm.radius,f:Qm.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Qm.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var le;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.SPHERICAL_MARS_PCPF=6]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=7]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=8]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=9]="GCSMOON2000",t[t.LON_LAT=10]="LON_LAT",t[t.PLATE_CARREE=11]="PLATE_CARREE"})(le||(le={}));const K3={[le.WGS84]:{[le.CGCS2000]:rn,[le.GCSMARS2000]:null,[le.GCSMOON2000]:null,[le.LON_LAT]:rn,[le.SPHERICAL_ECEF]:AP,[le.SPHERICAL_MARS_PCPF]:null,[le.SPHERICAL_MOON_PCPF]:null,[le.UNKNOWN]:null,[le.WEB_MERCATOR]:Q2,[le.PLATE_CARREE]:K2,[le.WGS84]:rn,[le.WGS84_ECEF]:tE},[le.CGCS2000]:{[le.CGCS2000]:rn,[le.GCSMARS2000]:null,[le.GCSMOON2000]:null,[le.LON_LAT]:rn,[le.SPHERICAL_ECEF]:AP,[le.SPHERICAL_MARS_PCPF]:null,[le.SPHERICAL_MOON_PCPF]:null,[le.UNKNOWN]:null,[le.WEB_MERCATOR]:Q2,[le.PLATE_CARREE]:K2,[le.WGS84]:rn,[le.WGS84_ECEF]:tE},[le.GCSMARS2000]:{[le.CGCS2000]:null,[le.GCSMARS2000]:rn,[le.GCSMOON2000]:null,[le.LON_LAT]:rn,[le.SPHERICAL_ECEF]:null,[le.SPHERICAL_MARS_PCPF]:ree,[le.SPHERICAL_MOON_PCPF]:null,[le.UNKNOWN]:null,[le.WEB_MERCATOR]:null,[le.PLATE_CARREE]:null,[le.WGS84]:null,[le.WGS84_ECEF]:null},[le.GCSMOON2000]:{[le.CGCS2000]:null,[le.GCSMARS2000]:null,[le.GCSMOON2000]:rn,[le.LON_LAT]:rn,[le.SPHERICAL_ECEF]:null,[le.SPHERICAL_MARS_PCPF]:null,[le.SPHERICAL_MOON_PCPF]:iee,[le.UNKNOWN]:null,[le.WEB_MERCATOR]:null,[le.PLATE_CARREE]:null,[le.WGS84]:null,[le.WGS84_ECEF]:null},[le.WEB_MERCATOR]:{[le.CGCS2000]:CP,[le.GCSMARS2000]:null,[le.GCSMOON2000]:null,[le.LON_LAT]:CP,[le.SPHERICAL_ECEF]:LIe,[le.SPHERICAL_MARS_PCPF]:null,[le.SPHERICAL_MOON_PCPF]:null,[le.UNKNOWN]:null,[le.WEB_MERCATOR]:rn,[le.PLATE_CARREE]:FIe,[le.WGS84]:CP,[le.WGS84_ECEF]:DIe},[le.WGS84_ECEF]:{[le.CGCS2000]:iE,[le.GCSMARS2000]:null,[le.GCSMOON2000]:null,[le.LON_LAT]:iE,[le.SPHERICAL_ECEF]:BIe,[le.SPHERICAL_MARS_PCPF]:null,[le.SPHERICAL_MOON_PCPF]:null,[le.UNKNOWN]:null,[le.WEB_MERCATOR]:zIe,[le.PLATE_CARREE]:$st,[le.WGS84]:iE,[le.WGS84_ECEF]:rn},[le.SPHERICAL_ECEF]:{[le.CGCS2000]:eE,[le.GCSMARS2000]:null,[le.GCSMOON2000]:null,[le.LON_LAT]:eE,[le.SPHERICAL_ECEF]:rn,[le.SPHERICAL_MARS_PCPF]:null,[le.SPHERICAL_MOON_PCPF]:null,[le.UNKNOWN]:null,[le.WEB_MERCATOR]:kIe,[le.PLATE_CARREE]:Nst,[le.WGS84]:eE,[le.WGS84_ECEF]:UIe},[le.SPHERICAL_MARS_PCPF]:{[le.CGCS2000]:null,[le.GCSMARS2000]:nee,[le.GCSMOON2000]:null,[le.LON_LAT]:nee,[le.SPHERICAL_ECEF]:null,[le.SPHERICAL_MARS_PCPF]:rn,[le.SPHERICAL_MOON_PCPF]:null,[le.UNKNOWN]:null,[le.WEB_MERCATOR]:null,[le.PLATE_CARREE]:null,[le.WGS84]:null,[le.WGS84_ECEF]:null},[le.SPHERICAL_MOON_PCPF]:{[le.CGCS2000]:null,[le.GCSMARS2000]:null,[le.GCSMOON2000]:see,[le.LON_LAT]:see,[le.SPHERICAL_ECEF]:null,[le.SPHERICAL_MARS_PCPF]:null,[le.SPHERICAL_MOON_PCPF]:rn,[le.UNKNOWN]:null,[le.WEB_MERCATOR]:null,[le.PLATE_CARREE]:null,[le.WGS84]:null,[le.WGS84_ECEF]:null},[le.UNKNOWN]:{[le.CGCS2000]:null,[le.GCSMARS2000]:null,[le.GCSMOON2000]:null,[le.LON_LAT]:null,[le.SPHERICAL_ECEF]:null,[le.SPHERICAL_MARS_PCPF]:null,[le.SPHERICAL_MOON_PCPF]:null,[le.UNKNOWN]:rn,[le.WEB_MERCATOR]:null,[le.PLATE_CARREE]:null,[le.WGS84]:null,[le.WGS84_ECEF]:null},[le.LON_LAT]:{[le.CGCS2000]:rn,[le.GCSMARS2000]:rn,[le.GCSMOON2000]:rn,[le.LON_LAT]:rn,[le.SPHERICAL_ECEF]:AP,[le.SPHERICAL_MARS_PCPF]:ree,[le.SPHERICAL_MOON_PCPF]:iee,[le.UNKNOWN]:null,[le.WEB_MERCATOR]:Q2,[le.PLATE_CARREE]:K2,[le.WGS84]:rn,[le.WGS84_ECEF]:tE},[le.PLATE_CARREE]:{[le.CGCS2000]:MP,[le.GCSMARS2000]:null,[le.GCSMOON2000]:null,[le.LON_LAT]:MP,[le.SPHERICAL_ECEF]:Lst,[le.SPHERICAL_MARS_PCPF]:null,[le.SPHERICAL_MOON_PCPF]:null,[le.UNKNOWN]:null,[le.WEB_MERCATOR]:Dst,[le.PLATE_CARREE]:rn,[le.WGS84]:MP,[le.WGS84_ECEF]:Fst}};function rx(t,e,i=_ce()){return t==null||e==null?null:Ust(t,e,i).projector}function zci(t,e){switch(rx(t,e,Hq)){case rn:return"copy3";case AP:return"wgs84ToSphericalECEF";case Q2:return"wgs84ToWebMercator";case K2:return"wgs84ToPlateCarree";case tE:return"wgs84ToWGS84ECEF";case CP:return"webMercatorToWGS84";case LIe:return"webMercatorToSphericalECEF";case DIe:return"webMercatorToWGS84ECEF";case FIe:return"webMercatorToPlateCarree";case iE:return"wgs84ECEFToWGS84";case BIe:return"wgs84ECEFToSphericalECEF";case zIe:return"wgs84ECEFToWebMercator";case eE:return"sphericalECEFToWGS84";case kIe:return"sphericalECEFToWebMercator";case nee:return"sphericalMarsPCPFToMars2000";case see:return"sphericalMoonPCPFToMoon2000";case UIe:return"sphericalECEFToWGS84ECEF";case ree:return"mars2000ToSphericalPCPF";case iee:return"moon2000ToSphericalPCPF";default:return null}}function xj(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Xc(t,1)),sF(t)?e.spatialReferenceId=le.SPHERICAL_ECEF:Uv(t)?e.spatialReferenceId=le.WGS84:cg(t)?e.spatialReferenceId=le.WEB_MERCATOR:CE(t)?e.spatialReferenceId=le.PLATE_CARREE:t.wkt===jRe.wkt?e.spatialReferenceId=le.WGS84_ECEF:t.wkid===yh.CGCS2000?e.spatialReferenceId=le.CGCS2000:t.wkt===yq.wkt?e.spatialReferenceId=le.SPHERICAL_MARS_PCPF:t.wkt===_q.wkt?e.spatialReferenceId=le.SPHERICAL_MOON_PCPF:pC(t)?e.spatialReferenceId=le.GCSMARS2000:fC(t)?e.spatialReferenceId=le.GCSMOON2000:e.spatialReferenceId=le.UNKNOWN):le.UNKNOWN}function rn(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function CP(t,e,i,r){i[r]=OO*(t[e]/rE),i[r+1]=OO*(VIe-2*Math.atan(Math.exp(-t[e+1]/rE))),i[r+2]=t[e+2]}function LIe(t,e,i,r){const s=t[e]/rE,n=VIe-2*Math.atan(Math.exp(-t[e+1]/rE)),o=rE+t[e+2],a=Math.cos(n)*o;i[r]=Math.cos(s)*a,i[r+1]=Math.sin(s)*a,i[r+2]=Math.sin(n)*o}function DIe(t,e,i,r){CP(t,e,i,r),tE(i,r,i,r)}function mce(t,e,i,r,s){const n=.4999999*qq,o=$e(PO*t[e+1],-n,n),a=Math.sin(o);i[r++]=PO*t[e]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=t[e+2]}function Q2(t,e,i,r){mce(t,e,i,r,br)}function K2(t,e,i,r){i[r]=t[e]*lye,i[r+1]=t[e+1]*lye,i[r+2]=t[e+2]}function MP(t,e,i,r){i[r]=t[e]*cye,i[r+1]=t[e+1]*cye,i[r+2]=t[e+2]}function FIe(t,e,i,r){CP(t,e,i,r),K2(i,r,i,r)}function $st(t,e,i,r){iE(t,e,i,r),K2(i,r,i,r)}function Nst(t,e,i,r){eE(t,e,i,r),K2(i,r,i,r)}function Lst(t,e,i,r){MP(t,e,i,r),AP(i,r,i,r)}function Dst(t,e,i,r){MP(t,e,i,r),Q2(i,r,i,r)}function Fst(t,e,i,r){MP(t,e,i,r),tE(i,r,i,r)}function gce(t,e,i,r,s){const n=s+t[e+2],o=PO*t[e+1],a=PO*t[e],l=Math.cos(o)*n;i[r]=Math.cos(a)*l,i[r+1]=Math.sin(a)*l,i[r+2]=Math.sin(o)*n}function iee(t,e,i,r){gce(t,e,i,r,kv.radius)}function ree(t,e,i,r){gce(t,e,i,r,Qm.radius)}function AP(t,e,i,r){gce(t,e,i,r,br.radius)}function yce(t,e,i,r,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=ug(a/(l===0?1:l)),u=Math.atan2(o,n);i[r++]=OO*u,i[r++]=OO*c,i[r]=l-s}function see(t,e,i,r){yce(t,e,i,r,kv.radius)}function nee(t,e,i,r){yce(t,e,i,r,Qm.radius)}function eE(t,e,i,r){yce(t,e,i,r,br.radius)}function kIe(t,e,i,r){eE(t,e,i,r),Q2(i,r,i,r)}function UIe(t,e,i,r){eE(t,e,i,r),tE(i,r,i,r)}function kst(t,e,i,r,s){const n=PO*t[e],o=PO*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),u=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(u+a)*c*Math.cos(n),i[r++]=(u+a)*c*Math.sin(n),i[r++]=(u*(1-s.eccentricitySquared)+a)*l}function tE(t,e,i,r){kst(t,e,i,r,br)}function iE(t,e,i,r){const s=Ist,n=t[e],o=t[e+1],a=t[e+2];let l,c,u,h,p,f,g,y,v,b,w,x,S,E,C,R,I,F,D,z,B;l=Math.abs(a),c=n*n+o*o,u=Math.sqrt(c),h=c+a*a,p=Math.sqrt(h),z=Math.atan2(o,n),f=a*a/h,g=c/h,E=s.a2/p,C=s.a3-s.a4/p,g>.3?(y=l/p*(1+g*(s.a1+E+f*C)/p),D=Math.asin(y),b=y*y,v=Math.sqrt(1-b)):(v=u/p*(1-f*(s.a5-E-g*C)/p),D=Math.acos(v),b=1-v*v,y=Math.sqrt(b)),w=1-br.eccentricitySquared*b,x=br.radius/Math.sqrt(w),S=s.a6*x,E=u-x*v,C=l-S*y,I=v*E+y*C,R=v*C-y*E,F=R/(S/w+I),D+=F,B=I+R*F/2,a<0&&(D=-D),i[r++]=OO*z,i[r++]=OO*D,i[r]=B}function BIe(t,e,i,r){iE(t,e,i,r),AP(i,r,i,r)}function zIe(t,e,i,r){iE(t,e,i,r),Q2(i,r,i,r)}function Ust(t,e,i){if(t==null||e==null||i.source.spatialReference===t&&i.dest.spatialReference===e)return i;const r=xj(t,i.source),s=xj(e,i.dest);return r===le.UNKNOWN&&s===le.UNKNOWN?Bs(t,e)?i.projector=rn:i.projector=null:i.projector=K3[r][s],i}function _ce(){return{source:{spatialReference:null,spatialReferenceId:le.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:le.UNKNOWN,metersPerUnit:1},projector:rn}}const Bst={spatialReference:null,spatialReferenceId:le.UNKNOWN},zst={spatialReference:null,spatialReferenceId:le.UNKNOWN},Hq=_ce(),PO=Gt(1),OO=El(1),qq=Math.PI,VIe=.5*qq,rE=br.radius,lye=rE*qq/180,cye=180/(rE*qq);function Ts(t,e,i,r,s,n,o=1){const a=rx(e,s,Hq);if(a==null)return!1;if(a===rn){if(t===r&&i===n)return!0;const c=i+3*o;for(let u=i,h=n;u<c;u++,h++)r[h]=t[u];return!0}const l=i+3*o;for(let c=i,u=n;c<l;c+=3,u+=3)a(t,c,r,u);return!0}const Vci=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:Ts},Symbol.toStringTag,{value:"Module"}));function uye(t,e,i,r,s,n){return yU[0]=t,yU[1]=e,yU[2]=i,Ts(yU,r,0,s,n,0,1)}const yU=M();let _U=0,FW=class oee{static fromGE(e){const i=new oee;return i._wkt=e.wkt,i._wkid=e.wkid,i._isInverse=e.isInverse,i}constructor(e){this.uid=_U++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=_U++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=_U++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=_U++}getInverse(){const e=new oee;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},Sj=class eN{static cacheKey(e,i){return[e.wkid?.toString()??"-1",e.wkt?.toString()??"",e.wkt2?.toString()??"",i.wkid?.toString()??"-1",i.wkt?.toString()??"",i.wkt2?.toString()??""].join()}static fromGE(e){const i=new eN;let r="";for(const s of e.steps){const n=FW.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e?.steps)for(const i of e.steps)i instanceof FW?this.steps.push(i):this.steps.push(new FW({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const e=new eN;e.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const i of this.steps)e+=i.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,i,r){this._cachedProjection[eN.cacheKey(e,i)]=r}getCachedGeTransformation(e,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const s=this._cachedProjection[eN.cacheKey(e,i)];return s===void 0?null:s}};function GIe(t,e,i){if(e==null||i==null||i.vcsWkid||Bs(e,i)||Jw(e)||Jw(i))return null;const r=AE(e)/AE(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>Vst(s,r);case"polyline":case"esriGeometryPolyline":return s=>jst(s,r);case"polygon":case"esriGeometryPolygon":return s=>Gst(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>Hst(s,r);case"extent":case"esriGeometryEnvelope":return s=>qst(s,r);default:return null}}function Vst(t,e){t?.z!=null&&(t.z*=e)}function Gst(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function jst(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function Hst(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function qst(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let Km=null,sx=null,rD=null,dV={};const vce=new Ck;function DI(){return!!Km&&LRe()}function jIe(){return!!DI()||(Jt(vce),IO(),!1)}function AA(t,e){return!t||!e||Fu(t,e)||jIe()}function HIe(t,e){return!Fu(t,e)&&!DI()}function IO(t){return rD==null&&(rD=Promise.all([DRe(),ye(()=>import("./geometryEngineBase-2eacdee6.js"),[],import.meta.url).then(e=>e.g),ye(()=>import("./hydrated-33355f53.js"),[],import.meta.url)])),rD.then(([,e,{hydratedAdapter:i}])=>{zt(t),sx=i,Km=e.default,Km._enableProjection(OQe),vce.notify()})}function Nx(t,e,i=null,r=null){return Array.isArray(t)?t.length===0?[]:aee(sx,t,t[0].spatialReference,e,i,r):aee(sx,[t],t.spatialReference,e,i,r)[0]}function aee(t,e,i,r,s=null,n=null){if(i==null||r==null)return e;if(Fu(i,r,s))return e.map(o=>sD(o,i,r));if(s==null&&sF(i))return e.map(o=>sD(o,i,Je.WGS84)).map(o=>nx(o,r));if(s==null&&sF(r))return e.map(o=>nx(o,Je.WGS84)).map(o=>sD(o,Je.WGS84,r));if(s==null){const o=Sj.cacheKey(i,r);dV[o]!==void 0?s=dV[o]:((s=WIe(i,r,void 0))==null&&(s=new Sj),dV[o]=s)}if(Km==null||t==null)throw new Wq;return n!=null?Km._project(t,e,i,r,s,n):Km._project(t,e,i,r,s)}function Wst(t,e){const i=qIe([t],e);return i.pending!=null?{pending:i.pending,geometry:null}:i.geometries!=null?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function qIe(t,e){if(!DI()){for(const i of t)if(i!=null&&!Bs(i.spatialReference,e)&&Bm(i.spatialReference)&&Bm(e)&&!Fu(i.spatialReference,e))return Jt(vce),{pending:IO(),geometries:null}}return{pending:null,geometries:t.map(i=>i==null?null:Bs(i.spatialReference,e)?i:Bm(i.spatialReference)&&Bm(e)?nx(i,e):null)}}function WIe(t,e,i=null){if(t==null||e==null)return null;if(Km==null||sx==null)throw new Wq;const r=Km._getTransformation(sx,t,e,i,i?.spatialReference);return r!==null?Sj.fromGE(r):null}function Yst(t,e,i=null){if(Km==null||sx==null)throw new Wq;const r=Km._getTransformationBySuitability(sx,t,e,i,i?.spatialReference);if(r!==null){const s=[];for(const n of r)s.push(Sj.fromGE(n));return s}return[]}let Wq=class extends j{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function Xst(){Km=null,sx=null,rD=null,dV={}}const Zst={get loadPromise(){return rD}};function nx(t,e){try{const i=Nx(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=GIe(i.type,t.spatialReference,e);return r?.(i),i}catch(i){if(!(i instanceof Wq))throw i;return null}}async function ox(t,e,i){const r=t.spatialReference;return r!=null&&e!=null&&await kk(r,e,null,i),nx(t,e)}function Fu(t,e,i){return!i&&(!!Bs(t,e)||Bm(t)&&Bm(e)&&!!rx(t,e,Hq))}function Jst(t,e){if(Bs(t,e))return!0;if(!Bm(t)||!Bm(e))return!1;const i=Uv(t)||cg(t)||mO(t),r=Uv(e)||cg(e)||mO(e);return i&&r}async function kk(t,e,i,r){if(DI())return yme(r);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(s&&n&&!Fu(s,n,o))return IO(r)}else if(t&&e&&!Fu(t,e,i))return IO(r);return yme(r)}function sD(t,e,i){return t?"x"in t?XIe(t,e,new $t,i,0):"xmin"in t?KIe(t,e,new lr,i,0):"rings"in t?QIe(t,e,new Ix,i,0):"paths"in t?JIe(t,e,new Dq,i,0):"points"in t?ZIe(t,e,new PI,i,0):null:null}function YIe(t,e,i=e.spatialReference,r=0){return i!=null&&t.spatialReference!=null&&XIe(t,t.spatialReference,e,i,r)!=null}function XIe(t,e,i,r,s){Nc[0]=t.x,Nc[1]=t.y;const n=t.z;return Nc[2]=n!==void 0?n:s,Ts(Nc,e,0,Nc,r,0,1)?(i.x=Nc[0],i.y=Nc[1],i.spatialReference=r,n!==void 0||Jw(r)?(i.z=Nc[2],i.hasZ=!0):(i.z=void 0,i.hasZ=!1),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function Qst(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&ZIe(t,t.spatialReference,e,i,r)!=null}function ZIe(t,e,i,r,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,u=[];for(const p of n)u.push(p[0],p[1],o?p[2]:s);if(!Ts(u,e,0,u,r,0,c))return null;const h=o||Jw(r);for(let p=0;p<c;++p){const f=3*p,g=u[f],y=u[f+1];h&&a?l.push([g,y,u[f+2],n[p][3]]):h?l.push([g,y,u[f+2]]):a?l.push([g,y,n[p][2]]):l.push([g,y])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function Kst(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&JIe(t,t.spatialReference,e,i,r)!=null}function JIe(t,e,i,r,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];if(!e$e(n,o??!1,a??!1,e,l,r,s))return null;const c=o||Jw(r);return i.paths=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function ent(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&QIe(t,t.spatialReference,e,i,r)!=null}function QIe(t,e,i,r,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];if(!e$e(n,o??!1,a??!1,e,l,r,s))return null;const c=o||Jw(r);return i.rings=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function tnt(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&KIe(t,t.spatialReference,e,i,r)!=null}function KIe(t,e,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=t,h=c?t.zmin:s;if(!uye(n,o,h,e,Nc,r))return null;const p=c||Jw(r);i.xmin=Nc[0],i.ymin=Nc[1],p&&(i.zmin=Nc[2]);const f=c?t.zmax:s;return uye(a,l,f,e,Nc,r)?(i.xmax=Nc[0],i.ymax=Nc[1],p&&(i.zmax=Nc[2]),u&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null}function e$e(t,e,i,r,s,n,o=0){const a=new Array;for(const u of t)for(const h of u)a.push(h[0],h[1],e?h[2]:o);if(!Ts(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;const c=e||Jw(n);for(const u of t){const h=new Array;for(const p of u)c&&i?h.push([a[l++],a[l++],a[l++],p[3]]):c?h.push([a[l++],a[l++],a[l++]]):i?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}const Nc=M(),jci=Object.freeze(Object.defineProperty({__proto__:null,canProjectWithoutEngine:Fu,getTransformation:WIe,getTransformations:Yst,initializeProjection:kk,isEqualBaseGCS:Jst,isLoaded:DI,isLoadedOrLoad:jIe,isLoadedOrLoadFor:AA,load:IO,project:Nx,projectExtent:tnt,projectMany:aee,projectMultipoint:Qst,projectOrLoad:Wst,projectOrLoadMany:qIe,projectPoint:YIe,projectPolygon:ent,projectPolyline:Kst,projectWithZConversion:ox,projectWithoutEngine:sD,requiresLoad:HIe,test:Zst,tryProjectWithZConversion:nx,unload:Xst},Symbol.toStringTag,{value:"Module"})),t$e={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},i$e=Object.values(t$e),r$e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${i$e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),int=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${i$e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),rnt=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function Hci(t){return r$e.test(t)}function FI(t){if(t==null)return null;const e=ln(t),i=e?.path.match(r$e)||e?.path.match(int);if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:bce(a!==-1?s.slice(a+1):s),serverType:t$e[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function snt(t){const e=ln(t).path.match(rnt);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function bce(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function nnt(t,e){const i=[];if(t){const r=FI(t);r!=null&&r.title&&i.push(r.title)}if(e){const r=bce(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function s$e(t){let e=rf(t,!0);return!!e&&(e=e.toLowerCase(),e.endsWith(".arcgis.com")&&(e.startsWith("services")||e.startsWith("tiles")||e.startsWith("features")))}function ont(t,e){return t&&bRe(xRe(t,e))}function ant(t){let{url:e}=t;if(!e)return{url:e};e=xRe(e,t.logger);const i=ln(e),r=FI(i.path);let s;if(r!=null)r.sublayer!=null&&t.layer.layerId==null&&(s=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const n=snt(i.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:bRe(e),layerId:s}}function lnt(t,e,i,r,s){Bv(e,r,"url",s),r.url&&t.layerId!=null&&(r.url=uf(r.url,i,t.layerId.toString()))}function qci(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return i&&(r||s||n)}function cnt(t,e){if(!t)return null;if(!lee(t))return new j("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:t});const i=t.heightUnit,r=$x.deriveUnitFromSR(t,e).heightUnit;return i!==r?new j("webscene:incompatible-height-unit",`The vertical units of the scene (${i}) must match the horizontal units of the scene (${r})`,{verticalUnit:i,horizontalUnit:r}):null}function Wci(t,e,i){const r=n$e(t),s=e,n=unt(r,s,i);if(r){const o=$x.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new j("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new j("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!hnt(t)||n===sh.Unsupported)return new j("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case sh.Units:{const o=r?.heightUnit||"unknown",a=s?.heightUnit||"unknown",l=new j("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new j("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case sh.HeightModel:{const o=r?.heightModel||"unknown",a=s?.heightModel||"unknown",l=new j("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new j("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case sh.CRS:{const o=r?.vertCRS||"unknown",a=s?.vertCRS||"unknown",l=new j("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new j("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function unt(t,e,i){if(!lee(t)||!lee(e))return sh.Unsupported;if(t==null||e==null)return sh.Ok;if(!i&&t.heightUnit!==e.heightUnit)return sh.Units;if(t.heightModel!==e.heightModel)return sh.HeightModel;switch(t.heightModel){case"gravity-related-height":return sh.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?sh.Ok:sh.CRS;default:return sh.Unsupported}}var sh;function lee(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function hnt(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!l$e(t)}function n$e(t){if(t.type==="integrated-mesh-3dtiles")return null;const e=t.url?FI(t.url):void 0;return!(t.spatialReference?.vcsWkid==null&&e!=null&&e.serverType==="ImageServer")&&o$e(t)&&t.heightModelInfo?t.heightModelInfo:l$e(t)?$x.deriveUnitFromSR(pnt,t.spatialReference):null}function o$e(t){return"heightModelInfo"in t}function a$e(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function l$e(t){return a$e(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):c$e(t)}function dnt(t){return t.layers!=null||c$e(t)||a$e(t)||o$e(t)}function c$e(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(sh||(sh={}));const pnt=new $x({heightModel:"gravity-related-height"});function Yci(t,e){return{...u$e(t,e),readResourcePaths:[]}}function hye(t,e,i){const r=ln(t.itemUrl);return{...u$e(t,e),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:r?{rootPath:r.path,writtenUrls:[]}:null,resources:i?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function u$e(t,e){return{origin:e,url:ln(t.itemUrl),portal:t.portal||Mo.getDefault(),portalItem:t}}async function fnt(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return q3(t);const i=Je.WGS84;return await kk(e,i),Nx(t,i)}function mnt(t,e){if(!h$e(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function h$e(t,e){return!!t.typeKeywords?.includes(e)}function Xci(t){return h$e(t,cee.HOSTED_SERVICE)}function gnt(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}function dye(t,e,i){i?mnt(t,e):gnt(t,e)}async function Zci(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return fnt(i)}const cee={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function pye(t){const{portal:e,isOrgItem:i,itemControl:r}=t,s=e.user?.privileges;let n=!s||s.includes("features:user:edit"),o=!!i&&!!s?.includes("features:user:fullEdit");const a=r==="update"||r==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}let mb=class extends we{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};d([m({type:String,json:{write:!0}})],mb.prototype,"facilityIdField",void 0),d([m({type:String,json:{write:!0}})],mb.prototype,"layerId",void 0),d([m({type:String,json:{write:!0}})],mb.prototype,"nameField",void 0),d([m({type:String,json:{write:!0}})],mb.prototype,"siteIdField",void 0),d([m({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],mb.prototype,"sublayerId",void 0),mb=d([N("esri.layers.support.FacilityLayerInfo")],mb);const ynt=mb;let Kf=class extends we{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};d([m({type:String,json:{write:!0}})],Kf.prototype,"facilityIdField",void 0),d([m({type:String,json:{write:!0}})],Kf.prototype,"layerId",void 0),d([m({type:String,json:{write:!0}})],Kf.prototype,"levelIdField",void 0),d([m({type:String,json:{write:!0}})],Kf.prototype,"levelNumberField",void 0),d([m({type:String,json:{write:!0}})],Kf.prototype,"longNameField",void 0),d([m({type:String,json:{write:!0}})],Kf.prototype,"shortNameField",void 0),d([m({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Kf.prototype,"sublayerId",void 0),d([m({type:String,json:{write:!0}})],Kf.prototype,"verticalOrderField",void 0),Kf=d([N("esri.layers.support.LevelLayerInfo")],Kf);const _nt=Kf;let cT=class extends we{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};d([m({type:String,json:{write:!0}})],cT.prototype,"layerId",void 0),d([m({type:String,json:{write:!0}})],cT.prototype,"nameField",void 0),d([m({type:String,json:{write:!0}})],cT.prototype,"siteIdField",void 0),d([m({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],cT.prototype,"sublayerId",void 0),cT=d([N("esri.layers.support.SiteLayerInfo")],cT);const vnt=cT;let RA=class extends we{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};d([m({type:_nt,json:{write:!0}})],RA.prototype,"levelLayer",void 0),d([m({type:ynt,json:{write:!0}})],RA.prototype,"facilityLayer",void 0),d([m({type:vnt,json:{write:!0}})],RA.prototype,"siteLayer",void 0),RA=d([N("esri.support.MapFloorInfo")],RA);const bnt=RA,wnt=Symbol("WebScene"),xnt="webscene:failed-to-copy-embedded-resources",Snt="webscene:schema-validation";function Tnt(){return new j(xnt,"Copying of embedded resources is currently not supported")}function Ent(t){return new j(Snt,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:t})}var Xe;function fye(t){return t==="global"?Xe.Global:Xe.Local}function kW(t){return t===Xe.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Xe||(Xe={}));function gF(t,e){return t!=null&&(e==null||(e===Xe.Local?!t.isGeographic||t.isWGS84||t.wkid===yh.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===yh.CGCS2000||t.wkid===yh.GCSMARS2000||t.wkid===yh.GCSMARS2000_SPHERE||t.wkid===yh.GCSMOON2000))}var wh;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(wh||(wh={}));var uee;let iy=uee=class extends we{constructor(t){super(t),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new uee(ee({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};d([m({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],iy.prototype,"enabled",void 0),d([m({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],iy.prototype,"longNames",void 0),d([m({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],iy.prototype,"minimized",void 0),d([m({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],iy.prototype,"pinnedLevels",void 0),d([m({type:String,json:{read:{source:"site"},write:{target:"site"}}})],iy.prototype,"site",void 0),d([m({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],iy.prototype,"facility",void 0),d([m({type:String,json:{read:{source:"level"},write:{target:"level"}}})],iy.prototype,"level",void 0),iy=uee=d([N("esri.webdoc.widgets.FloorFilter")],iy);const Cnt=iy;var hee;const vU=new ur({slider:"slider",picker:"picker"});let PA=hee=class extends we{constructor(t){super(t),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new hee({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};d([m({type:vU.apiValues,nonNullable:!0,json:{type:vU.jsonValues,default:null,read:{reader:vU.read},write:{isRequired:!0,writer:vU.write}}})],PA.prototype,"interactionMode",void 0),d([m({type:cr,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const t=this.stopInterval!=null;return{enabled:!t,isRequired:!t}}}}})],PA.prototype,"numStops",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{isRequired:this.numStops==null}}}}})],PA.prototype,"stopInterval",void 0),PA=hee=d([N("esri.webdoc.widgets.Range")],PA);const Mnt=PA,wce=Yc()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let tN=class extends ms(we){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return MIe(this.value,this.unit,"milliseconds")}};d([Nt(wce,{nonNullable:!0})],tN.prototype,"unit",void 0),d([m({type:Number,json:{write:!0},nonNullable:!0})],tN.prototype,"value",void 0),tN=d([N("esri.TimeInterval")],tN);const $O=tN;var dee;let Oa=dee=class extends we{constructor(t){super(t),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(t){if(!t)return;const e=t[0]!=null?new Date(t[0]):null,i=t[1]!=null?new Date(t[1]):null;return new wl({start:e,end:i})}writeCurrentTimeExtent(t,e,i){t&&ja(i,[t.start!=null?t.start.getTime():null,t.end!=null?t.end.getTime():null],e)}readFullTimeExtent(t,e){const i=e.properties;if(!i)return;const r=i.endTime!=null?new Date(i.endTime):null,s=i.startTime!=null?new Date(i.startTime):null;return new wl({start:s,end:r})}writeFullTimeExtent(t,e){if(!t)return;const i=e.properties=e.properties||{},r=t.end,s=t.start;r&&(i.endTime=r!=null?r.getTime():null),s&&(i.startTime=s!=null?s.getTime():null)}readStopInterval(t,e,i){return t?$O.fromJSON({value:t.interval,unit:t.units},i):null}writeStopInterval(t,e,i,r){if(!t)return;const s=t.toJSON(r);ja("properties.timeStopInterval",{interval:s.value,units:s.unit},e)}readStops(t){return t?.length?t.map(e=>new Date(e)):null}writeStops(t,e,i){t?.length&&ja(i,t.map(r=>r.getTime()),e)}clone(){return new dee(ee({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};d([m({type:wl,json:{type:[[cr,MI]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],Oa.prototype,"currentTimeExtent",void 0),d([Le("currentTimeExtent")],Oa.prototype,"readCurrentTimeExtent",null),d([Ve("currentTimeExtent")],Oa.prototype,"writeCurrentTimeExtent",null),d([m({type:wl,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],Oa.prototype,"fullTimeExtent",void 0),d([Le("fullTimeExtent")],Oa.prototype,"readFullTimeExtent",null),d([Ve("fullTimeExtent")],Oa.prototype,"writeFullTimeExtent",null),d([m({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],Oa.prototype,"loop",void 0),d([m({type:cr,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){const t=!!this.stopInterval,e=!!this.stops?.length,i=!(t||e);return{enabled:i,isRequired:i}}}}})],Oa.prototype,"numStops",void 0),d([m({type:[1,2],nonNullable:!0,json:{type:cr,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],Oa.prototype,"numThumbs",void 0),d([m({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],Oa.prototype,"stopDelay",void 0),d([m({type:$O,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:wce.jsonValues.filter(t=>t!=="esriTimeUnitsUnknown")}},overridePolicy(){const t=this.numStops!=null,e=!!this.stops?.length;return{enabled:!e,isRequired:!(t||e)}}}}})],Oa.prototype,"stopInterval",void 0),d([Le("stopInterval")],Oa.prototype,"readStopInterval",null),d([Ve("stopInterval")],Oa.prototype,"writeStopInterval",null),d([m({type:[Date],json:{type:[cr],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:this.numStops==null&&!this.stopInterval}}}}})],Oa.prototype,"stops",void 0),d([Le("stops")],Oa.prototype,"readStops",null),d([Ve("stops")],Oa.prototype,"writeStops",null),Oa=dee=d([N("esri.webdoc.widgets.TimeSlider")],Oa);const Ant=Oa;var pee;let OA=pee=class extends we{constructor(t){super(t),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new pee(ee({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};d([m({type:Mnt,json:{write:!0}})],OA.prototype,"range",void 0),d([m({type:Ant,json:{write:!0}})],OA.prototype,"timeSlider",void 0),d([m({type:Cnt,json:{write:!0}})],OA.prototype,"floorFilter",void 0),OA=pee=d([N("esri.webdoc.Widgets")],OA);const Rnt=OA,Pnt="randomUUID"in crypto;function Yq(){if(Pnt)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function iui(){return`{${Yq().toUpperCase()}}`}function Ont(){return`{${Yq()}}`}async function Int(t,e={},i){await t.load(i);const r=uf(t.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="resource"}=e,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:t.apiKey},signal:i?.signal},c=await t.portal.request(r,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:u,size:h,resource:p})=>({created:new Date(u),size:h,resource:t.resourceFromPath(p)}))}}async function $nt(t,e,i,r){const s=new Map;for(const{resource:o,content:a,compress:l,access:c}of e){if(!o.hasPath())throw new j(`portal-item-resource-${i}:invalid-path`,"Resource does not have a valid path");const[u,h]=d$e(o.path),p=`${u}/${l??""}/${c??""}`;s.has(p)||s.set(p,{prefix:u,compress:l,access:c,files:[]}),s.get(p).files.push({fileName:h,content:a})}await t.load(r);const n=uf(t.userItemUrl,i==="add"?"addResources":"updateResources");for(const{prefix:o,compress:a,access:l,files:c}of s.values())for(let h=0;h<c.length;h+=25){const p=c.slice(h,h+25),f=new FormData;o&&o!=="."&&f.append("resourcesPrefix",o),a&&f.append("compress","true"),l&&f.append("access",l);let g=0;for(const{fileName:y,content:v}of p)f.append("file"+ ++g,v,y);f.append("f","json"),await t.portal.request(n,{method:"post",body:f,signal:r?.signal})}}async function Nnt(t,e,i){if(!e.hasPath())throw new j("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(i);const r=uf(t.userItemUrl,"removeResources");await t.portal.request(r,{method:"post",query:{resource:e.path},signal:i?.signal}),e.portalItem=null}async function Lnt(t,e){await t.load(e);const i=uf(t.userItemUrl,"removeResources");return t.portal.request(i,{method:"post",query:{deleteAll:!0},signal:e?.signal})}function d$e(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function xce(t){const[e,i]=Dnt(t),[r,s]=d$e(e);return[r,s,i]}function Dnt(t){const e=XJe(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function pV(t){return t.type==="blob"?t.blob:t.type==="json"?new Blob([t.jsonString],{type:"application/json"}):(await qi(t.url,{responseType:"blob"})).data}function Fnt(t,e){if(!t.hasPath())return null;const[i,,r]=xce(t.path);return t.portalItem.resourceFromPath(uf(i,e+r))}function p$e(t,e){if(!t.hasPath())return null;const[i,,r]=xce(t.path);return t.portalItem.resourceFromPath(uf(i,e+r))}const DR=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResources:$nt,contentToBlob:pV,fetchResources:Int,getSiblingOfSameType:Fnt,getSiblingOfSameTypeI:p$e,removeAllResources:Lnt,removeResource:Nnt,splitPrefixFileNameAndExtension:xce},Symbol.toStringTag,{value:"Module"}));async function knt(t,e,i){const r=await f$e(t,e,i);await m$e(r,e,i)}async function Unt(t,e,i,r,s){const n=await f$e(i,r,s);await t.update({data:e}),await m$e(n,r,s)}async function f$e(t,e,i){if(!e?.resources)return;const r=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const s=new Set(e.resources.toKeep.map(h=>h.resource.path)),n=new Set,o=[];s.forEach(h=>{r.delete(h),t.paths.push(h)});const a=[],l=[],c=[];for(const h of e.resources.toUpdate)if(r.delete(h.resource.path),s.has(h.resource.path)||n.has(h.resource.path)){const{resource:p,content:f,finish:g}=h,y=p$e(p,Yq());t.paths.push(y.path),a.push({resource:y,content:await pV(f),compress:h.compress}),g&&c.push(()=>g(y))}else{t.paths.push(h.resource.path),l.push({resource:h.resource,content:await pV(h.content),compress:h.compress});const p=h.finish;p&&c.push(()=>p(h.resource)),n.add(h.resource.path)}for(const h of e.resources.toAdd)if(t.paths.push(h.resource.path),r.has(h.resource.path))r.delete(h.resource.path);else{a.push({resource:h.resource,content:await pV(h.content),compress:h.compress});const p=h.finish;p&&c.push(()=>p(h.resource))}if(a.length||l.length){const{addOrUpdateResources:h}=await ye(()=>Promise.resolve().then(()=>DR),void 0,import.meta.url);await h(e.portalItem,a,"add",i),await h(e.portalItem,l,"update",i)}if(c.forEach(h=>h()),o.length===0)return r;const u=await nZe(o);if(zt(i),u.length>0)throw new j("save:resources","Failed to save one or more resources",{errors:u});return r}async function m$e(t,e,i){if(!t||!e.portalItem)return;const r=[];for(const s of t){const n=e.portalItem.resourceFromPath(s);r.push(n.portalItem.removeResource(n,i))}await hq(r)}function mye(t){if(gr.apiKey&&Rle(t.portal.url))throw new j("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${t.portal.url} when using an api key`)}async function rui(t){const e=[];for(const i of t.allLayers)if("beforeSave"in i&&typeof i.beforeSave=="function"){const r=i.beforeSave();r&&e.push(r)}await Promise.allSettled(e)}const Bnt=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function znt(t,e,i){let r=(t.messages??[]).filter(({type:s})=>s==="error").map(({name:s,message:n,details:o})=>new j(s,n,o));if(t.blockedRelativeUrls&&(r=r.concat(t.blockedRelativeUrls.map(s=>new j("url:unsupported",`Relative url '${s}' is not supported`)))),i){const{ignoreUnsupported:s,supplementalUnsupportedErrors:n=[],requiredPropertyChecksDisabled:o}=i;s&&(r=r.filter(({name:a})=>!(Bnt.has(a)||n.includes(a)))),o&&(r=r.filter(a=>a.name!=="web-document-write:property-required"))}if(r.length>0)throw new j(e.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}const Vnt={width:600,height:400},bU=1.5;function Gnt(t,e){e=e||Vnt;let{width:i,height:r}=e;const s=i/r;return s<bU?r=i/bU:s>bU&&(i=r*bU),i>t.width&&(r*=t.width/i,i=t.width),r>t.height&&(i*=t.height/r,r=t.height),{width:Math.round(i),height:Math.round(r)}}function gye(t){return{enabled:!!t?.length}}const Sce=new ur({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var fee;let IA=fee=class extends we{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new fee({exactMatch:this.exactMatch,type:this.type,name:this.name})}};d([m({type:Boolean,json:{write:!0}})],IA.prototype,"exactMatch",void 0),d([m({type:String,json:{write:!0}})],IA.prototype,"name",void 0),d([Nt(Sce)],IA.prototype,"type",void 0),IA=fee=d([N("esri.webdoc.applicationProperties.SearchLayerField")],IA);const jnt=IA;var mee;let $A=mee=class extends we{constructor(t){super(t),this.field=null,this.id=null,this.subLayer=null}clone(){return new mee(ee({field:this.field,id:this.id,subLayer:this.subLayer}))}};d([m({type:jnt,json:{write:{isRequired:!0}}})],$A.prototype,"field",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],$A.prototype,"id",void 0),d([m({type:cr,json:{write:!0}})],$A.prototype,"subLayer",void 0),$A=mee=d([N("esri.webdoc.applicationProperties.SearchLayer")],$A);const Hnt=$A;var gee;let NA=gee=class extends we{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new gee({exactMatch:this.exactMatch,type:this.type,name:this.name})}};d([m({type:Boolean,json:{write:!0}})],NA.prototype,"exactMatch",void 0),d([m({type:String,json:{write:!0}})],NA.prototype,"name",void 0),d([Nt(Sce)],NA.prototype,"type",void 0),NA=gee=d([N("esri.webdoc.applicationProperties.SearchTableField")],NA);const qnt=NA;var yee;let iN=yee=class extends we{constructor(t){super(t),this.field=null,this.id=null}clone(){return new yee(ee({field:this.field,id:this.id}))}};d([m({type:qnt,json:{write:{isRequired:!0}}})],iN.prototype,"field",void 0),d([m({type:String,json:{write:{isRequired:!0}}})],iN.prototype,"id",void 0),iN=yee=d([N("esri.webdoc.applicationProperties.SearchTable")],iN);const Wnt=iN;var _ee;const g$e=ct.ofType(Hnt),y$e=ct.ofType(Wnt);let ry=_ee=class extends we{constructor(t){super(t),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new g$e,this.tables=new y$e}readAddressSearchEnabled(t){return!t}writeAddressSearchEnabled(t,e,i){e[i]=!t}clone(){return new _ee(ee({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};d([m({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],ry.prototype,"addressSearchEnabled",void 0),d([Le("addressSearchEnabled")],ry.prototype,"readAddressSearchEnabled",null),d([Ve("addressSearchEnabled")],ry.prototype,"writeAddressSearchEnabled",null),d([m({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],ry.prototype,"enabled",void 0),d([m({type:String,json:{write:!0}})],ry.prototype,"hintText",void 0),d([m({type:g$e,json:{write:{overridePolicy:gye},origins:{"web-scene":{write:{isRequired:!0}}}}})],ry.prototype,"layers",void 0),d([m({type:y$e,json:{read:!0,write:{overridePolicy:gye}}})],ry.prototype,"tables",void 0),ry=_ee=d([N("esri.webdoc.applicationProperties.Search")],ry);const Ynt=ry;var vee;let fV=vee=class extends we{constructor(t){super(t),this.search=null}clone(){return new vee(ee({search:this.search}))}};d([m({type:Ynt,json:{write:!0}})],fV.prototype,"search",void 0),fV=vee=d([N("esri.webdoc.applicationProperties.Viewing")],fV);const Xnt=fV;var bee;let mV=bee=class extends we{constructor(t){super(t),this.viewing=null}clone(){return new bee({viewing:this.viewing?.clone()??null})}};d([m({type:Xnt,json:{write:!0}})],mV.prototype,"viewing",void 0),mV=bee=d([N("esri.webscene.ApplicationProperties")],mV);const Znt=mV;var wee;let rN=wee=class extends we{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new wee({cloudCover:this.cloudCover})}};d([Nt({sunny:"sunny"})],rN.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],rN.prototype,"cloudCover",void 0),rN=wee=d([N("esri.views.3d.environment.SunnyWeather")],rN);const Tj=rN;var xee;let sN=xee=class extends we{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new xee({cloudCover:this.cloudCover})}};d([Nt({cloudy:"cloudy"})],sN.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],sN.prototype,"cloudCover",void 0),sN=xee=d([N("esri.views.3d.environment.CloudyWeather")],sN);const Jnt=sN;var See;let nN=See=class extends we{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new See({fogStrength:this.fogStrength})}};d([Nt({foggy:"foggy"})],nN.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],nN.prototype,"fogStrength",void 0),nN=See=d([N("esri.views.3d.environment.FoggyWeather")],nN);const Qnt=nN;var Tee;let LA=Tee=class extends we{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Tee({cloudCover:this.cloudCover,precipitation:this.precipitation})}};d([Nt({rainy:"rainy"})],LA.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],LA.prototype,"cloudCover",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],LA.prototype,"precipitation",void 0),LA=Tee=d([N("esri.views.3d.environment.RainyWeather")],LA);const Knt=LA;var Eee;let uT=Eee=class extends we{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new Eee({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};d([Nt({snowy:"snowy"})],uT.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],uT.prototype,"cloudCover",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],uT.prototype,"precipitation",void 0),d([m({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],uT.prototype,"snowCover",void 0),uT=Eee=d([N("esri.views.3d.environment.SnowyWeather")],uT);const eot=uT,Tce={key:"type",base:Tj,typeMap:{sunny:Tj,cloudy:Jnt,rainy:Knt,snowy:eot,foggy:Qnt}},tot=Object.keys(Tce.typeMap);function iot(t,e){return!!tot.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const ov=1e4,rot=1e5;var Cee;let gp=Cee=class extends we{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,i){e[i]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,i){t&&(e[i]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new Cee(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};d([m({readOnly:!0,type:["sun"],json:{write:!0}})],gp.prototype,"type",void 0),d([m({type:Date,json:{type:Number,write:{target:"datetime"}}})],gp.prototype,"date",void 0),d([Le("date",["datetime"])],gp.prototype,"readDate",null),d([Ve("date")],gp.prototype,"writeDate",null),d([m({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],gp.prototype,"directShadowsEnabled",void 0),d([Le("directShadowsEnabled",["directShadows"])],gp.prototype,"readDirectShadowsEnabled",null),d([Ve("directShadowsEnabled")],gp.prototype,"writedirectShadowsEnabled",null),d([m({type:Number,json:{write:!0}})],gp.prototype,"displayUTCOffset",void 0),d([Ve("displayUTCOffset")],gp.prototype,"writeDisplayUTCOffset",null),gp=Cee=d([N("esri.webscene.SunLighting")],gp);const FE=gp;var Mee;let oN=Mee=class extends we{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new Mee(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};d([m({readOnly:!0,type:["virtual"],json:{write:!0}})],oN.prototype,"type",void 0),d([m({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],oN.prototype,"directShadowsEnabled",void 0),oN=Mee=d([N("esri.webscene.VirtualLighting")],oN);const Uk=oN,_$e={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:FE,virtual:Uk}};let gV=class extends we{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};d([m({readOnly:!0,json:{read:!1}})],gV.prototype,"type",void 0),gV=d([N("esri.webscene.background.Background")],gV);const v$e=gV;function sot(t,e){const i=e.transparency!=null?xO(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new Ke([r[0]||0,r[1]||0,r[2]||0,i]):null}function not(t,e){e.color=t.toJSON().slice(0,3);const i=Ik(t.a);i!==0&&(e.transparency=i)}const e1={type:Ke,json:{type:[cr],default:null,read:{source:["color","transparency"],reader:sot},write:{target:{color:{type:[cr]},transparency:{type:cr}},writer:not}}},v0={type:Number,cast:Nr,json:{write:!0}};var Aee;const oot={...e1,nonNullable:!0};let aN=Aee=class extends v$e{constructor(t){super(t),this.type="color",this.color=new Ke([0,0,0,1])}clone(){return new Aee(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};d([Nt({color:"color"},{readOnly:!0})],aN.prototype,"type",void 0),d([m(oot)],aN.prototype,"color",void 0),aN=Aee=d([N("esri.webscene.background.ColorBackground")],aN);const b$e=aN,yye={base:v$e,key:"type",typeMap:{color:b$e}};function aot(t){return(e,i,r)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,r),n}}}const lot={types:yye,json:{read:aot(yye),write:{overridePolicy:(t,e,i)=>({enabled:!i?.isPresentation})}}};var Ree;const _ye=(t,e,i)=>({enabled:!i?.isPresentation});let gb=Ree=class extends we{constructor(t){super(t),this.lighting=new FE,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){iot(t?.type,oe.getLogger(this))&&this._set("weather",t)}clone(){return new Ree(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?Uk.prototype.clone.call(this.lighting):FE.prototype.clone.call(this.lighting),background:ee(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};d([m({types:_$e,nonNullable:!0,json:{write:!0}})],gb.prototype,"lighting",void 0),d([m(lot)],gb.prototype,"background",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:_ye}}})],gb.prototype,"atmosphereEnabled",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:_ye}}})],gb.prototype,"starsEnabled",void 0),d([m({types:Tce,nonNullable:!0,json:{write:!0},value:new Tj})],gb.prototype,"weather",null),gb=Ree=d([N("esri.webscene.Environment")],gb);const NO=gb,w$e={type:wl,json:{read:{source:"timeExtent",reader:t=>t?Array.isArray(t)?wl.fromArray(t):wl.fromJSON(t):null},write:{writer:(t,e,i,r)=>{t&&(t.isEmpty?r?.messages&&r.messages.push(new j("invalid-timeExtent","TimeExtent cannot be empty")):e[i]=t.toArray())},target:{timeExtent:{type:[[cr,MI]]}}}}};var Pee;let yb=Pee=class extends we{constructor(t){super(t),this.environment=new NO,this.spatialReference=null,this.viewpoint=null,this.timeExtent=null}set viewingMode(t){this._set("viewingMode",t)}clone(){return new Pee({environment:this.environment.clone(),spatialReference:this.spatialReference?.clone()??null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?.clone()??null,timeExtent:this.timeExtent?.clone()??null})}};d([m({type:NO,json:{write:{isRequired:!0}}})],yb.prototype,"environment",void 0),d([m({type:Je})],yb.prototype,"spatialReference",void 0),d([m({type:["local","global"]})],yb.prototype,"viewingMode",null),d([m({type:dg,json:{write:{isRequired:!0}}})],yb.prototype,"viewpoint",void 0),d([m(w$e)],yb.prototype,"timeExtent",void 0),yb=Pee=d([N("esri.webscene.InitialViewProperties")],yb);const Ej=yb;let cot=class{constructor(e,i){this._observable=new Ck,this._value=e,this._equalityFunction=i}get value(){return Jt(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function s0(t,e=hAe){return new cot(t,e)}const Wa=Symbol("Yield");let uot=class{constructor(){this._tasks=new Array,this._runningTasks=s0(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(this.length===0)return Wa;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.push(new vye(s,n,e,i,r))).finally(()=>--this._runningTasks.value)}unshift(e,i,r){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.unshift(new vye(s,n,e,i,r))).finally(()=>--this._runningTasks.value)}_process(e){if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const r=va(i.signal);if(r&&!i.abortCallback)i.reject(Yi());else{const s=r?i.abortCallback?.(Yi()):i.callback(e);Lh(s)?s.then(i.resolve,i.reject):i.resolve(s)}}catch(r){i.reject(r)}return!0}cancelAll(){const e=Yi();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(e);i.resolve(r)}else i.reject(e);this._tasks.length=0}},vye=class{constructor(e,i,r,s=void 0,n=void 0){this.resolve=e,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}},lN=class extends Fe{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};d([m()],lN.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),d([m()],lN.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),lN=d([N("esri.views.support.debugFlags")],lN);const hot=new lN;var zi;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(zi||(zi={}));function dot(){return new Cj.Scheduler}var Ut;(function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"})(Ut||(Ut={}));const Py=0,bye=new Map([[Ut.RESOURCE_CONTROLLER_IMMEDIATE,Py],[Ut.RESOURCE_CONTROLLER,4],[Ut.SLIDE,Py],[Ut.STREAM_DATA_LOADER,Py],[Ut.ELEVATION_QUERY,Py],[Ut.TERRAIN_SURFACE,1],[Ut.SURFACE_GEOMETRY_UPDATES,1],[Ut.LOD_RENDERER,2],[Ut.GRAPHICS_CORE,2],[Ut.I3S_CONTROLLER,2],[Ut.POINT_CLOUD_LAYER,2],[Ut.FEATURE_TILE_FETCHER,2],[Ut.OVERLAY,4],[Ut.STAGE,4],[Ut.GRAPHICS_DECONFLICTOR,4],[Ut.FILTER_VISIBILITY,4],[Ut.SCALE_VISIBILITY,4],[Ut.FRUSTUM_VISIBILITY,4],[Ut.CLOUDS_GENERATOR,4],[Ut.POINT_OF_INTEREST_FREQUENT,6],[Ut.POINT_OF_INTEREST_INFREQUENT,30],[Ut.LABELER,8],[Ut.FEATURE_QUERY_ENGINE,8],[Ut.FEATURE_TILE_TREE,16],[Ut.FEATURE_TILE_TREE_ACTIVE,Py],[Ut.ELEVATION_ALIGNMENT,12],[Ut.ELEVATION_ALIGNMENT_SCENE,14],[Ut.TEXT_TEXTURE_ATLAS,12],[Ut.TEXTURE_UNLOAD,12],[Ut.LINE_OF_SIGHT_TOOL,16],[Ut.LINE_OF_SIGHT_TOOL_INTERACTIVE,Py],[Ut.SNAPPING,Py],[Ut.SHADOW_ACCUMULATOR,30]]);function wye(t){return bye.has(t)?bye.get(t):typeof t=="number"?t:1}const pot=6.5,xye=1,fot=30,mot=1e3/30,got=100,Sye=.9;var Cj,hS;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=s0(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new vv("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=zi.INTERACTING,this._tasks=new ci,this._runQueue=new ci,this._load=0,this._idleStateCallbacks=new ci,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=_e(()=>hot.SCHEDULER_LOG_SLOW_TASKS,n=>this._debug=n,Ir);for(const n of Object.keys(Ut))this.performanceInfo.tasks.set(Ut[n],new vv(Ut[n]))}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),Zr(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=new i(this,n,o);return this._tasks.push(a),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new vv(n)),a}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===zi.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===zi.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==zi.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){++this._frameNumber;let o=pot,a=n.frameDuration,l=xye;switch(this.state){case zi.IDLE:o=0,a=Math.max(got,n.frameDuration),l=fot;break;case zi.INTERACTING:a=Math.max(mot,n.frameDuration);case zi.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==zi.IDLE&&a<xye&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case zi.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case zi.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return hS.SCHEDULED;let o=hS.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=hS.READY:o!==hS.READY&&(o=hS.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*Sye+n*(1-Sye)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===Py&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Py&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===Wa&&(a.blockFrame=this._frameNumber)}catch(c){oe.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c),a.blockFrame=this._frameNumber}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,Ut.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(Ut))this._frameTaskTimes.set(Ut[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){}}t.Scheduler=e;class i{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a){this._scheduler=n,this.name=o,this.blockFrame=0,this.runtime=0,this._queue=new uot,this._handles=new A0,this._basePriority=wye(o),this.schedulePriority=this._basePriority,this._task=s0(a??this._queue),this._handles.add(Du(()=>this.task.running,l=>n.taskRunningChanged(l)))}remove(){this.processQueue(_h),this._scheduler.removeTask(this),this.schedule=LO.schedule,this.reschedule=LO.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){if(this.name===n)return;this.name=n;const o=wye(n);this._basePriority!==Py&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){return this._queue.runTask(n)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=zi.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=r})(Cj||(Cj={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(hS||(hS={}));const _h=(()=>{const t=new Cj.Budget;return t.enabled=!1,t})();let yot=class{remove(){}processQueue(){}schedule(e,i,r){try{if(va(i)){const s=Yi();return r?Promise.resolve(r(s)):Promise.reject(s)}return KQ(e(_h))}catch(s){return Promise.reject(s)}}reschedule(e,i,r){return this.schedule(e,i,r)}};const LO=new yot;function _ot(t){return!!t&&/^https:\/\/.*/i.test(t)}function vot(t){return!!t&&/data:([-\w]+\/[-+\w.]+)?(;?\w+=[-\w]+)*(;base64)?,.*/gu.test(t)}var Oee;let Dm=Oee=class extends we{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return _ot(this.url)}get isDataURI(){return vot(this.url)}clone(){return new Oee({url:this.url})}};d([m({type:String,json:{write:{isRequired:!0}}})],Dm.prototype,"url",void 0),d([m()],Dm.prototype,"isSecureUrl",null),d([m()],Dm.prototype,"isDataURI",null),Dm=Oee=d([N("esri.webdoc.support.SlideThumbnail")],Dm);var Iee;let yV=Iee=class extends we{constructor(){super(...arguments),this.text=""}clone(){return new Iee({text:this.text})}};d([m({type:String,json:{write:!0}})],yV.prototype,"text",void 0),yV=Iee=d([N("esri.webscene.support.Description")],yV);const _V=yV;var $ee;let FR=$ee=class extends we{constructor(){super(...arguments),this.lighting=new FE,this.weather=new Tj}clone(){return new $ee({lighting:ee(this.lighting),weather:ee(this.weather)})}};d([m({types:_$e,json:{write:!0}})],FR.prototype,"lighting",void 0),d([m({types:Tce,json:{write:!0}})],FR.prototype,"weather",void 0),FR=$ee=d([N("esri.webscene.Environment")],FR);var vV;let bV=vV=class extends we{constructor(){super(...arguments),this.opacity=null}clone(){return new vV({opacity:this.opacity})}cloneAndApplyTo(t){return this.opacity==null||((t=t?.clone()??new hF).opacity=this.opacity),t}static fromGround(t){return new vV({opacity:t.opacity})}};d([m({type:Number,json:{type:cr,read:{reader:xO,source:"transparency"},write:{writer:(t,e)=>{e.transparency=Ik(t)},target:"transparency"}}})],bV.prototype,"opacity",void 0),bV=vV=d([N("esri.webscene.support.SlideGround")],bV);const x$e=bV;var Nee;let kR=Nee=class extends we{constructor(t){super(t),this.id="",this.sublayerIds=null}clone(){return new Nee({id:this.id,sublayerIds:ee(this.sublayerIds)})}};d([m({type:String,json:{write:!0}})],kR.prototype,"id",void 0),d([m({type:[cr],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],kR.prototype,"sublayerIds",void 0),kR=Nee=d([N("esri.webscene.support.SlideVisibleLayer")],kR);var Lee;let wV=Lee=class extends we{constructor(){super(...arguments),this.text=""}clone(){return new Lee({text:this.text})}};d([m({type:String,json:{write:{isRequired:!0}}})],wV.prototype,"text",void 0),wV=Lee=d([N("esri.webscene.support.Title")],wV);const nD=wV;let bot=0;const Dee=ct.ofType(kR);let Ia=class extends we{constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+bot++,this.title=new nD,this.description=new _V,this.hidden=!1,this.thumbnail=new Dm,this.viewpoint=null,this.basemap=null,this.ground=null,this.environment=new FR,this.timeExtent=null,this.visibleLayers=new Dee}destroy(){this.visibleLayers.removeAll(),this.basemap=null,this.thumbnail=Ge(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null}castTitle(e){return typeof e=="string"?new nD({text:e}):Tn(nD,e)}castDescription(e){return typeof e=="string"?new _V({text:e}):Tn(_V,e)}castThumbnail(e){return typeof e=="string"?new Dm({url:e}):Tn(Dm,e)}castBasemap(e){return Zle(e)}set visibleLayers(e){this._set("visibleLayers",y0(e,this._get("visibleLayers"),Dee))}castVisibleLayers(e){return e&&typeof e.map=="function"?e.map(i=>{if(typeof i=="string")return{id:i};if(i instanceof Gq){const r=Tye(i);return{id:i.id,sublayerIds:r}}return i.id?{id:i.id,sublayerIds:"sublayerIds"in i?i.sublayerIds:void 0}:(oe.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),i)}):null}clone(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap?.clone()||null,ground:this.ground?.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null,hidden:this.hidden,timeExtent:this.timeExtent?.clone()??null})}async _updateVisibleLayersFrom(e){const i=[];await Promise.allSettled(this._getLayers(e.map).map(r=>e.whenLayerView(r).then(s=>{if(s.visible){const n=Tye(r);i.push(new kR({id:s.layer.id,sublayerIds:n}))}})).toArray()),this.visibleLayers.removeAll(),this.visibleLayers.addMany(i)}updateFrom(e,i){const r={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...i?.screenshot};return e.when(()=>(this.viewpoint=e.viewpoint.clone(),this.environment.lighting=e.environment.lighting.type==="virtual"?Uk.prototype.clone.apply(e.environment.lighting):FE.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.basemap=e.map.basemap&&e.map.basemap.clone()||null,this.ground=e.map.ground?x$e.fromGround(e.map.ground):null,this.timeExtent=e.timeExtent?.clone()??null,this._updateVisibleLayersFrom(e))).then(()=>e.takeScreenshot(r)).then(s=>(this.thumbnail=new Dm({url:s.dataUrl}),this))}async applyTo(e,i){this._applyToController!=null&&this._applyToController.abort();let r=new AbortController;this._applyToController=r;const s=xk(i,()=>r?.abort()),n=()=>{this._applyToController===r&&(this._applyToController=null),r=null,s?.remove()};try{await SO(()=>e.ready,r.signal)}catch(h){throw n(),h}if(r.signal.aborted)throw n(),Yi();const o=e.resourceController.scheduler.registerTask(Ut.SLIDE);let a=!1;const l={animate:!0,...i,signal:this._applyToController.signal},c=async()=>{await Promise.all([o.schedule(async()=>a=await this._setViewpointOfInterest(e,l)),o.schedule(()=>this._applyBasemap(e,l),l.signal)]),await this._loadLayersWithSublayerVisibility(e),await Promise.all([o.schedule(()=>this._applyLayerVisibility(e),l.signal),o.schedule(()=>this._applyGround(e),l.signal),o.schedule(()=>this._applyViewpoint(e,l),l.signal),o.schedule(()=>e.timeExtent=this.timeExtent?.clone()??null,l.signal)]),await o.schedule(()=>e.environment.weather=this.environment.weather.clone())},u=await jd(e.addUpdatingPromise(c()));if(a&&(e.contentCamera=null),o.remove(),n(),u.ok===!1)throw u.error;return this}async _applyBasemap(e,i){if(this.basemap){try{await this.basemap.load(i)}catch(r){if(En(r))throw r}e.map.basemap=Rtt(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_getLayers(e){const i=new ct;return this._collectLayers(e,i),this._collectLayers(e.ground,i),i}_collectLayers(e,i){e.layers.forEach(r=>{r.persistenceEnabled&&(i.add(r),"layers"in r&&this._collectLayers(r,i))})}async _loadLayersWithSublayerVisibility(e){this.visibleLayers&&await Promise.allSettled(this._getLayers(e.map).items.map(i=>this.visibleLayers.find(s=>s.id===i.id)?.sublayerIds?i.load():null))}_applyLayerVisibility(e){this.visibleLayers&&this._getLayers(e.map).forEach(i=>{const r=this.visibleLayers.find(o=>o.id===i.id);i.visible=r!=null;const s=r?.sublayerIds,n=S$e(i);s&&n&&n.forEach(o=>o.visible=s.includes(o.id))})}async _setViewpointOfInterest(e,i){if(e.state.fixedContentCamera||!this.viewpoint||i?.ignoreViewpoint||!i?.useDestinationCamera)return!1;const{toCameraAsync:r}=await ye(()=>Promise.resolve().then(()=>xwt),void 0,import.meta.url),s=await r(e,this.viewpoint);return e.contentCamera=s,s!=null}async _applyViewpoint(e,i){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!i.ignoreViewpoint){this.viewpoint.camera!=null&&(this.viewpoint.camera.fov=e.camera.fov);const r=this.environment.lighting;if(i.animate&&r.type==="sun"&&r.date)return this._animateToLighting(e,i);i.animate&&(e.environment.applyLighting(r.clone()),await e.goTo(this.viewpoint,i)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,i){let r=null;return e.environment.lighting.type!=="virtual"&&this.environment.lighting.type!=="virtual"&&(e.viewingMode==="global"&&(r=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||e.environment.lighting.type==="virtual"?(e.environment.applyLighting(this.environment.lighting.clone()),e.environment.lighting.type!=="virtual"&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,i).then(()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())}).catch(s=>{throw e.animation==null&&this._applyCachedCameraTrackingEnabled(e),s}).finally(()=>{Zr(r)})}_applyCachedCameraTrackingEnabled(e){e.environment.cachedCameraTrackingEnabled!=null&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,i,r){return e.setTime(i),e.setUTCHours(r/3600),e.setUTCMinutes(r%3600/60),e.setUTCSeconds(r%3600%60),e}_animateLightingWithCamera(e,i,r){const s=new Date(i.date.toString()),[n,o]=this._getTime(s),[a,l]=this._getTime(r.date),c=xot(o,l),u=e.renderCoordsHelper,h=M();u.toRenderCoords(e.camera.position,h);const p=M(),f=M();this.viewpoint.camera!=null&&u.toRenderCoords(this.viewpoint.camera.position,p);const g=new Date;return Du(()=>e.camera,y=>{u.toRenderCoords(y.position,f);const v=Xo(h,f),b=Xo(p,f);let w=0;v+b!==0&&(w=v/(v+b));const x=n+(a-n)*w,S=Sot(o,c*w);i.date=this._setTime(g,x,S)})}static createFrom(e,i){return new this().updateFrom(e,i)}};d([m({type:String,json:{write:{isRequired:!0}}})],Ia.prototype,"id",void 0),d([m({type:nD,json:{default:()=>new nD({text:""}),write:{isRequired:!0}}})],Ia.prototype,"title",void 0),d([vi("title")],Ia.prototype,"castTitle",null),d([m({type:_V,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.text)})}}})],Ia.prototype,"description",void 0),d([vi("description")],Ia.prototype,"castDescription",null),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!1}})],Ia.prototype,"hidden",void 0),d([m({type:Dm,json:{default:()=>new Dm({url:""}),write:{isRequired:!0}}})],Ia.prototype,"thumbnail",void 0),d([vi("thumbnail")],Ia.prototype,"castThumbnail",null),d([m({type:dg,nonNullable:!0,json:{write:{isRequired:!0}}})],Ia.prototype,"viewpoint",void 0),d([m({type:SP,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Ia.prototype,"basemap",void 0),d([vi("basemap")],Ia.prototype,"castBasemap",null),d([m({type:x$e,json:{write:!0}})],Ia.prototype,"ground",void 0),d([m({type:Dee,json:{write:{isRequired:!0}}})],Ia.prototype,"visibleLayers",null),d([vi("visibleLayers")],Ia.prototype,"castVisibleLayers",null),d([m({type:FR,json:{write:!0}})],Ia.prototype,"environment",void 0),d([m(w$e)],Ia.prototype,"timeExtent",void 0),Ia=d([N("esri.webscene.Slide")],Ia);const wot=Ia;function S$e(t){if(t.type==="building-scene"||t.type==="map-image")return t.allSublayers.toArray()}function Tye(t){const e=S$e(t);if(e)return e.filter(i=>i.visible).map(i=>i.id)}const Fee=86400,Eye=43200;function xot(t,e){let i=e-t;return i>Eye&&(i-=Fee),i<-Eye&&(i+=Fee),i}function Sot(t,e){return Bet(t+e,Fee)}const kee=ct.ofType(wot);let xV=class extends we{constructor(e){super(e),this.slides=new kee}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(i=>!!i.viewpoint)),this._set("slides",y0(e,this._get("slides"),kee))}clone(){return new this.constructor({slides:this.slides.clone()})}};d([m({type:kee,nonNullable:!0,json:{write:!0}}),vi(Ole)],xV.prototype,"slides",null),xV=d([N("esri.webscene.Presentation")],xV);const T$e=xV;var Uee;let DA=Uee=class extends we{constructor(t){super(t)}clone(){return new Uee({name:this.name,path:this.path,title:this.title})}};d([m({type:String,json:{write:!0}})],DA.prototype,"name",void 0),d([m({type:String,json:{write:!0}})],DA.prototype,"path",void 0),d([m({type:String,json:{write:!0}})],DA.prototype,"title",void 0),DA=Uee=d([N("esri.webscene.TransportationNetwork")],DA);const Tot=DA;let kI=class Bee{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}since(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new j(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new Bee(this.major,this.minor,this._context)}static parse(e,i=""){const[r,s]=e.split("."),n=/^\s*\d+\s*$/;if(!r?.match||!n.test(r))throw new j((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s?.match||!n.test(s))throw new j((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),a=parseInt(s,10);return new Bee(o,a,i)}},Mj=class extends kI{constructor(e,i){super(e,i,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}},Eot=null;function Cot(){return Eot}var E$e;const sE=new Mj(1,34),Mot=()=>{const e=[],i=sE.major;for(let r=8;r<=sE.minor;r++)e.push(`${i}.${r}`);return e},UW="Web Scene";let Hr=class extends lg.LoadableMixin(Mk(jq(PIe))){constructor(e){super(e),this[E$e]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new T$e,this.initialViewProperties=new Ej,this.portalItem=null,this.resourceInfo=null,this.widgets=null,this._debouncedSaveOperations=CI(async(i,r,s)=>{switch(i){case wh.SAVE:return this._saveImpl(r);case wh.SAVE_AS:return this._saveAsImpl(s,r)}}),this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{oe.getLogger(this).error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(i){return void this.addResolvingPromise(Promise.reject(i))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(qa(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=Ge(this.portalItem)}writeClippingArea(e,i){i.clippingArea||(i.clippingArea={}),i.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,i){return!!i.clippingArea&&!!i.clippingArea.clip}writeClippingEnabled(e,i){this.clippingArea&&(i.clippingArea||(i.clippingArea={}),i.clippingArea.clip=e)}writeLayers(e,i,r,s){i[r]=this._layersToJSON(e,"operational-layers",s)}readSourceVersion(e,i){const[r,s]=i.version.split(".");return new Mj(parseInt(r,10),parseInt(s,10))}writeSourceVersion(e,i,r){i[r]=`${sE.major}.${sE.minor}`}writeTables(e,i,r,s){const n=this._layersToJSON(e,"tables",s);n.length&&(i[r]=n)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl??null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,i){e&&this._isAuthoringAppSetByUser?i.authoringApp=e:i.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,i){e&&this._isAuthoringAppVersionSetByUser?i.authoringAppVersion=e:i.authoringAppVersion=MRe}writeGround(e,i,r,s){i[r]=e?e.write({},s):{transparency:0,layers:[]}}readInitialViewProperties(e,i){const r={};i.initialState?.environment&&(r.environment=NO.fromJSON(i.initialState.environment)),r.spatialReference=i.spatialReference?Je.fromJSON(i.spatialReference):Je.WebMercator,r.viewingMode=i.viewingMode??"global",i.initialState?.viewpoint&&(r.viewpoint=dg.fromJSON(i.initialState.viewpoint));const s=i.initialState?.timeExtent;return s!=null&&(r.timeExtent=wl.fromArray(s)),new Ej(r)}get spatialReference(){return this.initialViewProperties?.spatialReference??Je.WebMercator}get viewingMode(){return this.initialViewProperties?.viewingMode??"global"}load(e){const i=this.ground;return this.addResolvingPromise(this._loadFromSource().then(()=>{i&&i!==this.ground&&i.destroy()})),Promise.resolve(this)}loadAll(){return Nle(this,e=>{const i=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,i&&i.map(r=>r.basemap),this.tables)})}read(e,i){i={...i,origin:"web-scene"};const r=this._isAuthoringAppVersionSetByUser,s=this._isAuthoringAppSetByUser;if(uRe(this,e,n=>super.read(e,n),i),s||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion?.supportsVisibleElevationLayersInSlides){const n=e.baseMap.elevationLayers.map(c=>({id:c.id})),o=this.presentation.slides,a=(c,u)=>c.visibleLayers.some(h=>h.id===u),l=n.filter(c=>!o.some(u=>a(u,c.id)));o.forEach(c=>{c.visibleLayers.addMany(l)})}}_writeBasemapElevationLayers(e){const i=e.ground?.layers;!e.baseMap&&i?.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=ee(i))}_layersToJSON(e,i,r){const s={...r,layerContainerType:i};return e.map(n=>this._verifyWritableLayer(n,r)?n.write({},s):null).filter(n=>!!n).toArray()}_verifyWritableLayer(e,i){return!!e.persistenceEnabled&&("write"in e||(i?.messages&&i.messages.push(new j("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1))}write(e,i){if(this.loadStatus!=="loaded"){const n=new j("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw oe.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),n}this._runLayersIdGC();const r=!i?.messages;i={messages:[],...i,origin:"web-scene"};const s=super.write(e,i);if(r){const n=i.messages?.filter(o=>o.name==="web-document-write:property-required")??[];if(n.length){const o=new j("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:n});throw oe.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",n),o}}return this._writeBasemapElevationLayers(s),s}async save(e){return this._debouncedSaveOperations(wh.SAVE,e)}async _saveImpl(e){if(!this.portalItem)throw new j("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(mye(this.portalItem),this.portalItem?.type!==UW)throw new j("webscene:portal-item-wrong-type",`Portal item needs to have type "${UW}"`);const i=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls(hye(this.portalItem,"web-scene",!0)),s=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(s,r,e),this._updateTypeKeywords(this.portalItem),await Unt(this.portalItem,s,this._resourceReferences,r),oye(r),i&&await i,await this._saveThumbnail(),this.portalItem}async saveAs(e,i){return this._debouncedSaveOperations(wh.SAVE_AS,i,e)}async _saveAsImpl(e,i){let r=Y2.from(e);if(!r)throw new j("webscene:portal-item-required","saveAs requires a portal item to save to");mye(r),r.id&&(r=r.clone(),r.id=null);const s=r.portal||Mo.getDefault();await this._ensureLoadBeforeSave(),r.type=UW,r.portal=s;const n=this._enableVerifyItemRelativeUrls(hye(r,"web-scene",!0)),o=this.write({},n);await Promise.all(n.resources.pendingOperations),await this._verifySaveAs(o,n,i);const a=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl");if(this._updateTypeKeywords(r),await s.signIn(),!s.user)throw new j("webscene:user-not-signed-in","saveAs requires a user to be signed in to the portal");return await s.user.addItem({item:r,folder:i?.folder,data:o}),await knt(this._resourceReferences,n),this.portalItem=r,tee.prototype.read.call(this,{version:o.version,authoringApp:o.authoringApp,authoringAppVersion:o.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl?ln(r.itemUrl):void 0}),oye(n),a&&(this.thumbnailUrl=l?SRe(a,"w","8192"):a),n.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}async _verifySave(e,i,r,s=!1){if(!EE(this.spatialReference))throw new j("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently.");const{ignoreUnsupported:n,requiredPropertyChecksDisabled:o,strictSchemaValidationEnabled:a}=r||{};znt(i,{errorName:"webscene:save"},{ignoreUnsupported:n,supplementalUnsupportedErrors:["scenemodification:unsupported"],requiredPropertyChecksDisabled:o});const l=Cot();if(a&&l){const c=(await l()).validate(e);if(!c.length)return;const u=`webscene did not validate:
${c.join(`
`)}`;oe.getLogger(this).error(`${s?"saveAs":"save"}(): ${u}`);const h=c.map(p=>new j("webscene:schema-validation",p));throw Ent(h)}}_verifySaveAs(e,i,r){return this.canNotSaveAs(i)?Promise.reject(Tnt()):this._verifySave(e,i,r,!0)}verifySaveAs(e){const i=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write({},i);return this._verifySaveAs(r,i,e)}canNotSaveAs(e){return e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},e)),(e.verifyItemRelativeUrls?.writtenUrls?.length??0)>0}async updateFrom(e,i={}){const r=this._updateFrom(e,i);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFrom(e,i={}){if(await e.whenReady(),!i.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=NO.prototype.clone.apply(e.environment)),!i.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,this.initialViewProperties.timeExtent=e.timeExtent?.clone()??null,e.clippingArea!=null?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const r of e.allLayerViews){const s="visible";s in r&&s in r.layer&&r._isOverridden(s)&&(r.layer[s]=r[s])}if(!i.widgetsExcluded)for(const r of e.persistableViewModels)r.updateWebDocument(this);(i.thumbnailExcluded===!1||i.thumbnailExcluded==null&&!i.viewpointExcluded)&&await this._updateFromThumbnail(e,i.thumbnailSize??void 0)}async _updateFromThumbnail(e,i){const r=Gnt(e,i),s=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=s.dataUrl}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem?.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,i){const r=this._validateJSON(e);return this.read(r,i),this._loadFromJSON(r,i)}_extractOperationalLayers(e){const i=[];if(!this.sourceVersion?.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const n of e.baseMap.elevationLayers)i.push(n);const r=[],s=n=>(n.layers&&(n.layers=n.layers.filter(s)),n.layerType!=="ArcGISTiledElevationServiceLayer"||(this.sourceVersion?.supportsGround||r.push(n),!1));return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(s):[],operationalElevationLayers:r,basemapElevationLayers:i}}async _loadFromJSON(e,i){const r=new ct;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:s}=await ye(()=>import("./layersCreator-f0e45f92.js"),["./layersCreator-f0e45f92.js","./portalLayers-47ed75dc.js","./associatedFeatureServiceUtils-82735909.js","./fetchService-fa9a0116.js"],import.meta.url),{operationalLayers:n,operationalElevationLayers:o,basemapElevationLayers:a}=this._extractOperationalLayers(e),l=[],c={context:{...i,layerContainerType:"operational-layers"}};if(this.portalItem&&(c.context.portal=this.portalItem.portal||Mo.getDefault()),a.length>0){const u={...c,context:{...c.context,layerContainerType:"ground"}};u.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(s(this.ground.layers,a,u))}if(o.length>0){const u={...c,context:{...c.context,layerContainerType:"ground"}};u.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(s(r,o,u))}n&&n.length>0&&l.push(s(this.layers,n,c)),e.tables?.length&&l.push(s(this.tables,e.tables,{...c,context:{...c.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(l),await this._loadObjectsWithLayers(),this.ground.layers.addMany(r.filter(u=>u.type==="base-elevation"||u.type==="elevation"))}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],i=[...this.allLayers.items];for(const{basemap:r}of this.presentation.slides.items)r&&(i.push(...r.baseLayers.items),i.push(...r.referenceLayers.items));for(const r of i)if("beforeSave"in r&&typeof r.beforeSave=="function"){const s=r.beforeSave();s&&e.push(s)}await Promise.allSettled(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(i=>{i.basemap&&e.push(i.basemap.load())}),await Promise.allSettled(e)}async _loadFromItem(e){if(await e.load().catch(s=>{throw new j("webscene:load-portal-item","Failed to load portal item",{error:s})}),e.type!=="Web Scene")throw new j("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const i=await e.fetchData();this.resourceInfo=i;const r={origin:"web-scene",url:ln(e.itemUrl),portal:e.portal||Mo.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(i,r),this._resourceReferences={portalItem:e,paths:r.readResourcePaths??[]}}_validateSpatialReference(){const e=this.initialViewProperties,i=this._sceneSpatialReference;let r;if(e.viewingMode!=="local"){if(!gF(i,Xe.Global))return Promise.reject(new j("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||Fu(l,i)}else{if(!gF(i,Xe.Local))return Promise.reject(new j("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||l.equals(i)}const s=l=>l?.camera?.position.spatialReference??l?.targetGeometry?.spatialReference,n=e.viewpoint,o=s(n);if(o&&!r(o))return Promise.reject(new j("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:o,sceneSpatialReference:i,viewingMode:e.viewingMode}));const a=this.presentation.slides.find(l=>!r(s(l.viewpoint)));if(a){const l=s(a.viewpoint);return Promise.reject(new j("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:l,sceneSpatialReference:i,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,i=cnt(this.heightModelInfo,e);return i?Promise.reject(i):Promise.resolve()}_validateJSON(e){const i=Mj.parse(e.version||"","webscene");return sE.validate(i),e.version=`${i.major}.${i.minor}`,i.major===1&&i.minor<=2&&(e.spatialReference=Je.WebMercator.toJSON()),e}_updateTypeKeywords(e){dye(e,cee.LOCAL_SCENE,this.initialViewProperties.viewingMode==="local"),dye(e,cee.DEVELOPER_BASEMAP,fge(this.basemap)||this.presentation.slides.some(({basemap:i})=>!!i&&fge(i))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((i,r,s)=>s.indexOf(i)===r))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||Je.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem?.itemUrl?ln(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const i=this._verifyItemRelativeRootPath;return i&&(e.verifyItemRelativeUrls={rootPath:i,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties?.viewing?.search,i=s=>this.allLayers.some(n=>n.id===s&&n.persistenceEnabled);e?.layers&&(e.layers=e.layers.filter(s=>i(s.id)));const r=this.presentation&&this.presentation.slides;r&&r.forEach(s=>{s.visibleLayers&&(s.visibleLayers=s.visibleLayers.filter(n=>i(n.id)))})}static fromJSON(e){if(!e)throw new j("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};E$e=wnt,Hr.version=`${sE.major}.${sE.minor}`,d([m({type:Znt,json:{write:!0}})],Hr.prototype,"applicationProperties",void 0),d([m({type:lr,json:{read:{source:"clippingArea.geometry",reader:Vv},write:{target:"clippingArea.geometry"}}})],Hr.prototype,"clippingArea",void 0),d([Ve("clippingArea")],Hr.prototype,"writeClippingArea",null),d([m({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],Hr.prototype,"clippingEnabled",void 0),d([Le("clippingEnabled",["clippingArea"])],Hr.prototype,"readClippingEnabled",null),d([Ve("clippingEnabled")],Hr.prototype,"writeClippingEnabled",null),d([m({type:bnt,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],Hr.prototype,"floorInfo",void 0),d([m({type:$x,json:{write:!0}})],Hr.prototype,"heightModelInfo",void 0),d([m({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],Hr.prototype,"layers",void 0),d([Ve("layers")],Hr.prototype,"writeLayers",null),d([m({readOnly:!0,type:Mj,json:{type:Mot(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],Hr.prototype,"sourceVersion",void 0),d([Le("sourceVersion",["version"])],Hr.prototype,"readSourceVersion",null),d([Ve("sourceVersion")],Hr.prototype,"writeSourceVersion",null),d([m({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],Hr.prototype,"tables",void 0),d([Ve("tables")],Hr.prototype,"writeTables",null),d([m()],Hr.prototype,"thumbnailUrl",null),d([m({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Hr.prototype,"authoringApp",null),d([Ve("authoringApp")],Hr.prototype,"writeAuthoringApp",null),d([m({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Hr.prototype,"authoringAppVersion",null),d([Ve("authoringAppVersion")],Hr.prototype,"writeAuthoringAppVersion",null),d([m({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],Hr.prototype,"ground",void 0),d([Ve("ground")],Hr.prototype,"writeGround",null),d([m({type:ct.ofType(Tot),json:{write:!0}})],Hr.prototype,"transportationNetworks",void 0),d([m({type:T$e,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(t,e,i,r)=>{if(t.slides&&t.slides.length>0){const s={...r,isPresentation:!0};e.presentation=t.write({},s)}}}}})],Hr.prototype,"presentation",void 0),d([m({type:Ej,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new Ej({viewingMode:"global",spatialReference:Je.WebMercator})}})],Hr.prototype,"initialViewProperties",void 0),d([Le("initialViewProperties",["initialState.timeExtent","initialState.environment","initialState.viewpoint","spatialReference","viewingMode"])],Hr.prototype,"readInitialViewProperties",null),d([m({type:Je,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Hr.prototype,"spatialReference",null),d([m({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Hr.prototype,"viewingMode",null),d([m({type:Y2})],Hr.prototype,"portalItem",void 0),d([m()],Hr.prototype,"resourceInfo",void 0),d([m({type:Rnt,json:{write:!0}})],Hr.prototype,"widgets",void 0),Hr=d([N("esri.WebScene")],Hr);const Aot=Hr;function Xq(t){return typeof t=="string"?document.getElementById(t):t??null}function C$e(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function Cye(t,e){const i=e.parentNode;i&&i.insertBefore(t,e)}function Mye(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}let Aj=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._observable=new Ck,this._items=new Set}get length(){return Jt(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Jt(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const i=this.length;return this._items.forEach(r=>{e(r)||this._items.delete(r)}),i!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Jt(this._observable),yield*this._items}};const M$e=new FinalizationRegistry(t=>{t.close()});function Rot(t,e){M$e.register(t,e,e)}function Pot(t){M$e.unregister(t)}function A$e(t,e){return new Proxy({},{get:(i,r,s)=>(...n)=>{let o,a;const l=n[n.length-1];return Oot(l)&&(o=l.signal,a=l.transferList,n.pop()),t.apply(e?`${e}.${r.toString()}`:r.toString(),n,{transferList:a,signal:o})}})}function Oot(t){return typeof t=="object"&&!Array.isArray(t)&&t!=null&&("signal"in t||"transferList"in t||Object.keys(t).length===0)}const Iot={statsWorker:()=>ye(()=>import("./statsWorker-f2b63f16.js"),["./statsWorker-f2b63f16.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js"],import.meta.url),geometryEngineWorker:()=>ye(()=>import("./geometryEngineWorker-1a08746c.js"),["./geometryEngineWorker-1a08746c.js","./geometryEngineJSON-40e62ded.js","./geometryEngineBase-2eacdee6.js","./json-48e3ea08.js"],import.meta.url),CSVSourceWorker:()=>ye(()=>import("./CSVSourceWorker-9162e2a1.js"),["./CSVSourceWorker-9162e2a1.js","./date-430969b3.js","./json-48e3ea08.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./number-783b8778.js"],import.meta.url),EdgeProcessingWorker:()=>ye(()=>import("./EdgeProcessingWorker-ccaffffc.js"),["./EdgeProcessingWorker-ccaffffc.js","./workerHelper-9cb8f8e7.js"],import.meta.url),ElevationSamplerWorker:()=>ye(()=>import("./ElevationSamplerWorker-c2dc12b3.js"),["./ElevationSamplerWorker-c2dc12b3.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./vertexSpaceConversion-6cc95785.js"],import.meta.url),FeatureServiceSnappingSourceWorker:()=>ye(()=>import("./FeatureServiceSnappingSourceWorker-d93aedc8.js"),["./FeatureServiceSnappingSourceWorker-d93aedc8.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./symbologySnappingCandidates-d4c20b1f.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./query-f1663770.js"],import.meta.url),GeoJSONSourceWorker:()=>ye(()=>import("./GeoJSONSourceWorker-e62640fe.js"),["./GeoJSONSourceWorker-e62640fe.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./geojson-848e55a6.js","./date-430969b3.js","./sourceUtils-3d3d2d63.js"],import.meta.url),LercWorker:()=>ye(()=>import("./LercWorker-3a7ba279.js"),[],import.meta.url),MemorySourceWorker:()=>ye(()=>import("./MemorySourceWorker-e4070817.js"),["./MemorySourceWorker-e4070817.js","./objectIdUtils-967fafff.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./sourceUtils-3d3d2d63.js","./date-430969b3.js"],import.meta.url),PBFDecoderWorker:()=>ye(()=>import("./PBFDecoderWorker-4290359a.js"),["./PBFDecoderWorker-4290359a.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js"],import.meta.url),FeaturePipelineWorker:()=>ye(()=>import("./FeaturePipelineWorker-77b0f63a.js"),["./FeaturePipelineWorker-77b0f63a.js","./TurboLine-97700421.js","./constants-991354c8.js","./Rect-98da58d6.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./quickselect-6bdb87cc.js","./query-f1663770.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./ogcFeatureUtils-d8037de8.js","./geojson-848e55a6.js","./date-430969b3.js","./sourceUtils-3d3d2d63.js","./StreamFeatureManager-2982dbf6.js","./createConnection-5531d4b4.js"],import.meta.url),PointCloudWorker:()=>ye(()=>import("./PointCloudWorker-f2a799ba.js"),["./PointCloudWorker-f2a799ba.js","./PointCloudWorkerUtil-b34dda8a.js","./PointCloudUniqueValueRenderer-19e3c41a.js","./I3SBinaryReader-1b3cb0df.js"],import.meta.url),RasterWorker:()=>ye(()=>import("./RasterWorker-edb2082d.js"),["./RasterWorker-edb2082d.js","./dataUtils-ecf05d21.js","./PolynomialTransform-b739c5be.js","./rasterProjectionHelper-6da77e9e.js"],import.meta.url),SceneLayerSnappingSourceWorker:()=>ye(()=>import("./SceneLayerSnappingSourceWorker-595b8ded.js"),[],import.meta.url),SceneLayerWorker:()=>ye(()=>import("./SceneLayerWorker-f9ff4eca.js").then(t=>t.S),["./SceneLayerWorker-f9ff4eca.js","./I3SNode-a6acb4a5.js","./I3SUtil-c01a900c.js","./I3SBinaryReader-1b3cb0df.js"],import.meta.url),WFSSourceWorker:()=>ye(()=>import("./WFSSourceWorker-041eac19.js"),["./WFSSourceWorker-041eac19.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./geojson-848e55a6.js","./date-430969b3.js","./sourceUtils-3d3d2d63.js","./wfsUtils-54ce95cf.js","./xmlUtils-444cb4c0.js"],import.meta.url),WorkerTileHandler:()=>ye(()=>import("./WorkerTileHandler-1ebf479b.js"),["./WorkerTileHandler-1ebf479b.js","./Rect-98da58d6.js","./pbf-b4a86cc9.js","./TurboLine-97700421.js","./StyleRepository-aa454248.js"],import.meta.url),Lyr3DWorker:()=>ye(()=>import("./Lyr3DWorker-0a2ab4fd.js"),["./Lyr3DWorker-0a2ab4fd.js","./ILyr3DWasmPerSceneView-b1ab6e1f.js","./Lyr3DModule-8aa424b5.js"],import.meta.url)},R$e="worker:port-closed";var fl;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(fl||(fl={}));let $ot=0;function P$e(){return $ot++}function Not(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function yF(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function Ece(t,e,i,r){if(e.type===fl.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==fl.INVOKE&&e.type!==fl.RESPONSE)return void t.postMessage(e);let s;if(Not(i)?(s=Aye(i.transferList),e.data=i.result):(s=Aye(r),e.data=i),s){if(ae("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case fl.INVOKE:throw o;case fl.RESPONSE:return void Ece(t,{type:fl.RESPONSE,jobId:e.jobId,error:yF(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function _F(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Aye(t){if(!t?.length)return null;if(ae("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!Lot(i));return e.length?e:null}function Lot(t){return t instanceof ArrayBuffer||t?.constructor?.name==="ArrayBuffer"}async function mui(t){try{return await t}catch(e){const i=e?.name===R$e;if(!(En(e)||i))throw e;return}}const{CLOSE:Rye,ABORT:Pye,INVOKE:Oye,RESPONSE:O$,OPEN_PORT:Iye,ON:Dot}=fl,Fot=2;let kot=class{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===fl.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},ax=class FA{static connect(e,i){const r=new MessageChannel;let s;s=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new FA(r.port1,{channel:r,client:s,schedule:i});return typeof s=="object"&&"remoteClient"in s&&(s.remoteClient=n),FA.clients.set(n,s),r.port2}static loadWorker(e){const i=Iot[e];return i?i():Promise.resolve(null)}constructor(e,i,r){this._port=e,this._jobQueue=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new kot(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:Rye}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=r?.signal,n=r?.transferList;if(!this._port)return Promise.reject(new j(R$e,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const o=P$e();return new Promise((a,l)=>{if(va(s))return this._processWork(),void l(Yi());const c=oo(s,()=>{const h=this._outJobs.get(o);h&&(this._outJobs.delete(o),this._processWork(),Zr(h.abortHandle),this._post({type:Pye,jobId:o}),l(Yi()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:Oye,jobId:o,methodName:e,abortable:s!=null},i,n)})}createInvokeProxy(e){return A$e(this,e)}on(e,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:fl.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),er(()=>{r.port1.postMessage({type:fl.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:Iye,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=Fot)return;const e=this._jobQueue?.pop();if(!e)return;const{methodName:i,data:r,invokeOptions:s,resolver:n}=e;this.apply(i,r,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Zr(e.abortHandle),e.reject(Yi(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e,!0)):this._processMessage(e,!1)}_processMessage(e,i){const r=_F(e);if(r)switch(r.type){case O$:this._onResponseMessage(r);break;case Oye:i?this._onInvokeMessage(r):this._invokeQueue.push(r);break;case Pye:this._onAbortMessage(r);break;case Rye:this._onCloseMessage();break;case Iye:this._onOpenPortMessage(r);break;case Dot:this._onOnMessage(r)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&FA.clients.get(this)===e&&e.destroy(),FA.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s=[],abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[i];try{if(!u&&i&&i.includes(".")){const h=i.split(".");for(let p=0;p<h.length-1;p++)c=c[h[p]],u=c[h[p+1]]}if(typeof u!="function")throw new TypeError(`${i} is not a function`);s.push({client:this,signal:o?o.signal:null}),l=u.apply(c,s)}catch(h){return void this._post({type:O$,jobId:r,error:yF(h)})}Lh(l)?(a.set(r,{controller:o,promise:l}),l.then(h=>{a.has(r)&&(a.delete(r),this._post({type:O$,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),En(h)||this._post({type:O$,jobId:r,error:yF(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:O$,jobId:r},l)}_onOpenPortMessage(e){new FA(e.port,{client:this._client})}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,n=>{i.postMessage(n)}),s=Tv(e.port,"message",n=>{_F(n)?.type===fl.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);n.delete(i),this._processWork(),Zr(o.abortHandle),r?o.reject(j.fromJSON(JSON.parse(r))):o.resolve(s)}_post(e,i,r){return Ece(this._port,e,i,r)}};ax.kernelInfo={buildDate:ERe,fullVersion:mq,revision:CRe},ax.clients=new Map;let Uot=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new Aj}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,i){return new Promise((r,s)=>{let n=!0;const o=a=>{zt(i.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Lh(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new ax(c,i,this._ongoingJobsQueue),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new ax(l,i,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(e,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a?.invoke(e,i,r))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(Yi(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r?.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,Pot(this)}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=lo();this._ongoingJobsQueue.push({methodName:e,data:i,invokeOptions:r,resolver:s});for(let n=0;n<this._clientPromises.length;n++){const o=this._clients[n];o?o.jobAdded():this._clientPromises[n].then(a=>a?.jobAdded())}return s.promise}createInvokeProxy(e){return A$e(this,e)}on(e,i){return Promise.all(this._clientPromises).then(()=>Xw(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(i[s]=n.openPort()),--r==0&&e(i)})})}get test(){}};const Bot={async request(t,e){const i=t.options,r=i.responseType;i.signal=e?.signal,i.responseType=r==="native"||r==="native-request-init"?"native-request-init":r&&["blob","json","text"].includes(r)&&pK(t.url)?.after?r:"array-buffer";const s=await qi(t.url,i),n={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch(s.requestOptions?.responseType){case"native-request-init":return delete n.data.signal,n;case"blob":n.data=await n.data.arrayBuffer();break;case"json":n.data=new TextEncoder().encode(JSON.stringify(n.data)).buffer;break;case"text":n.data=new TextEncoder().encode(n.data).buffer}return{result:n,transferList:[n.data]}}},zot={ar:"ar-u-nu-latn"};let SV=new WeakMap,O$e={};function zee(t){const e=t||O$e;if(!SV.has(e)){const i=Eh(),r=zot[Eh()]||i;SV.set(e,new Intl.NumberFormat(r,t))}return SV.get(e)}function _ui(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function vF(t,e){return Object.is(t,-0)&&(t=0),zee(e).format(t)}function vui(t,e=Eh()){if(!t)return null;let i=$ye.get(e);if(!i){const r=zee().formatToParts(12345.6),s=[...zee({useGrouping:!1}).format(9876543210)].reverse(),n=new Map(s.map((h,p)=>[h,p])),o=new RegExp(`[${r.find(h=>h.type==="group")?.value}]`,"g"),a=new RegExp(`[${r.find(h=>h.type==="decimal")?.value}]`),l=new RegExp(`[${s.join("")}]`,"g"),c=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,u=/[-\u2212\u2013\u2014\u2015]/g;i=h=>{if((h=h.trim().replaceAll(o,"").replace(a,".").replace(l,f=>String(n.get(f))).replaceAll(c,"").replaceAll(u,"-"))==="")return null;const p=Number(h);return isNaN(p)?null:p},$ye.set(e,i)}return i(t)}Ule(()=>{SV=new WeakMap,O$e={}});const $ye=new Map,I$e=()=>oe.getLogger("esri.intl.substitute");function Vot(t,e,i={}){const{format:r={}}=i;return oq(t,s=>Got(s,e,r))}function Got(t,e,i){let r,s;const n=t.indexOf(":");if(n===-1?r=t.trim():(r=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!r)return"";const o=_v(r,e);if(o==null)return"";const a=(s?i?.[s]:null)??i?.[r];return a?jot(o,a):s?Hot(o,s):Cce(o)}function jot(t,e){switch(e.type){case"date":return ex(t,e.intlOptions);case"number":return vF(t,e.intlOptions);default:return I$e().warn("missing format descriptor for key {key}"),Cce(t)}}function Hot(t,e){switch(e.toLowerCase()){case"dateformat":return ex(t);case"numberformat":return vF(t);default:return I$e().warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?ex(t):/^numberformat/i.test(e)?vF(t):Cce(t)}}function Cce(t){switch(typeof t){case"string":return t;case"number":return vF(t);case"boolean":return""+t;default:return t instanceof Date?ex(t):""}}async function qot(t,e,i,r){const s=e.exec(i);if(!s)throw new j("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=HKe(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let u;try{u=await Nye(t(c))}catch(h){if(c===l)throw new j("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:h});try{u=await Nye(t(l))}catch(p){throw new j("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p})}}return u}async function Nye(t){if(Lye.fetchBundleAsset!=null)return Lye.fetchBundleAsset(t);const e=await qi(t,{responseType:"text"});return JSON.parse(e.data)}let Wot=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,i){return qot(this.getAssetUrl,this.matcher,e,i)}};function Yot(t){return new Wot(t)}const Lye={};jKe(Yot({pattern:"esri/",location:kr}));const Dye={};function Xot(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages?.concat()||[],paths:{...Dye.paths,...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=Dye.baseUrl),e}let Zot=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},TV=class{constructor(){this._dispatcher=new Zot,this._workerPostMessage({type:fl.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){dO(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){dO(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=_F(e);if(i&&i.type===fl.OPEN){const{modulePath:r,jobId:s}=i;let n=await ax.loadWorker(r);n||(n=await ye(()=>import(r),[],import.meta.url));const o=ax.connect(n);this._workerPostMessage({type:fl.OPENED,jobId:s,data:o})}}};const Vee=()=>oe.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:Jot}=fl,Qot='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let wU,xU;const Fye="Failed to create Worker. Fallback to execute module in main thread";async function Kot(){if(!ae("esri-workers"))return kye(new TV);if(!wU&&!xU)try{const e=Qot.split("{CONFIGURATION}").join(eat());wU=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){xU=e||{}}let t;if(wU)try{t=new Worker(wU,{name:"esri-worker-"+tat++})}catch{Vee().warn(Fye,xU),t=new TV}else Vee().warn(Fye,xU),t=new TV;return kye(t)}async function kye(t){return new Promise(e=>{function i(s){const n=_F(s);n&&n.type===Jot&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(s){s.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),Vee().warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new TV).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function eat(){let t;if(gr.default!=null){const s={...gr};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(gr));t.assetsPath=Bc(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?Bc(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Eh(),t.has={"esri-csp-restrictions":ae("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ae("esri-2d-update-debug"),"esri-2d-log-updating":ae("esri-2d-log-updating"),"featurelayer-pbf":ae("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":ae("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":ae("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ae("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ae("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":ae("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":ae("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":ae("featurelayer-snapshot-enabled"),"esri-atomics":ae("esri-atomics"),"esri-shared-array-buffer":ae("esri-shared-array-buffer"),"esri-tiles-debug":ae("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ae("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ae("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=Bc(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Bc(t.workers.workerPath):t.workers.workerPath=Bc(kr("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=gr.workers.loaderConfig,i=Xot({baseUrl:e?.baseUrl,locale:Eh(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e?.has},map:{...e?.map},paths:{...e?.paths},packages:e?.packages||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{buildDate:ERe,fullVersion:mq,revision:CRe}})}let tat=0;const{ABORT:Uye,INVOKE:iat,OPEN:rat,OPENED:sat,RESPONSE:I$}=fl;let nat=class $$e{static async create(e){const i=await Kot();return new $$e(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),oe.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,s=P$e();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:xk(r,()=>{this._outJobs.delete(s),this._post({type:Uye,jobId:s})})};this._outJobs.set(s,a),this._post({type:rat,jobId:s,modulePath:e})})}_onMessage(e){const i=_F(e);if(i)switch(i.type){case sat:this._onOpenedMessage(i);break;case I$:this._onResponseMessage(i);break;case Uye:this._onAbortMessage(i);break;case iat:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=Bot[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(u){return void this._post({type:I$,jobId:r,error:yF(u)})}Lh(c)?(a.set(r,{controller:o,promise:c}),c.then(u=>{a.has(r)&&(a.delete(r),this._post({type:I$,jobId:r},u))},u=>{a.has(r)&&(a.delete(r),u||(u={message:"Error encountered at method"+i}),En(u)||this._post({type:I$,jobId:r,error:yF(u||{message:`Error encountered at method ${i}`})}))})):this._post({type:I$,jobId:r},c)}_onOpenedMessage(e){const{jobId:i,data:r}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),Zr(s.abortHandle),s.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),Zr(n.abortHandle),r?n.reject(j.fromJSON(JSON.parse(r))):n.resolve(s))}_post(e,i,r){return Ece(this.worker,e,i,r)}};const Bye=ae("host-browser")?Math.min(navigator.hardwareConcurrency-1,ae("workers-pool-size")):0;let I2=ae("esri-mobile")?Math.min(Bye,3):Bye;I2||(I2=ae("safari")&&ae("mac")?7:2);let zye=0;const EV=[];function oat(){L$e()}async function SU(t,e){const i=new Uot,{registryTarget:r,...s}=e;return await i.open(t,s),r&&Rot(r,i),i}async function N$e(t,e={}){if(typeof t!="string")throw new j("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(ae("host-webworker")&&!ae("esri-workers")&&(i="local"),i==="local"){let r=await ax.loadWorker(t);r||(r=await ye(()=>import(t),[],import.meta.url)),zt(e.signal);const s=e.client||r;return SU([ax.connect(r,e.schedule)],{...e,client:s})}if(await L$e(),zt(e.signal),i==="dedicated"){const r=zye++%I2;return SU([await EV[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,I2);if(r<I2){const s=new Array(r);for(let n=0;n<r;++n){const o=zye++%I2;s[n]=EV[o].open(t,e)}return SU(s,e)}}return SU(EV.map(r=>r.open(t,e)),e)}let TU=null;async function L$e(){if(TU)return TU;new AbortController;const t=[];for(let e=0;e<I2;e++){const i=nat.create(e).then(r=>(EV[e]=r,r));t.push(i)}return TU=Promise.all(t),TU}function D$e(t,e){const i=oc(t),r=oc(e),s=i.store,n=r.store,o=r.metadata;for(const a in o){const l=o[a],c=s.originOf(a),u=n.originOf(a);if(!l.readOnly&&u!==Wi.DEFAULTS)if(c===Wi.DEFAULTS)t.set(a,n.get(a));else{const h=s.get(a),p=n.get(a);h&&p&&p instanceof Fe&&h instanceof Fe&&h instanceof p.constructor&&D$e(h,p)}}}let oD=class extends ct{constructor(e){super(e),this.addHandles([this.on("before-add",i=>{i.item==null&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(ct.ofType(this.itemType.Type))(e):new ct(e)}};function Gee(t,e){return{type:t,cast:Ole,set(i){const r=y0(i,this._get(e),t);r.owner=this,this._set(e,r)}}}d([m()],oD.prototype,"owner",null),oD=d([N("esri.core.support.OwningCollection")],oD);function Zq(t,e,i,r){return t!=null&&(Bs(e,r)?(zv(i,t),!0):(Bu[0]=t[0],Bu[1]=t[1],Bu[2]=0,!!Ts(Bu,e,0,Bu,r,0,1)&&(i[0]=Bu[0],i[1]=Bu[1],Bu[0]=t[2],Bu[1]=t[3],Bu[2]=0,!!Ts(Bu,e,0,Bu,r,0,1)&&(i[2]=Bu[0],i[3]=Bu[1],!0))))}const Bu=M();function lc(t,e,i,r){if(Fu(t.spatialReference,i)){EU[0]=t.x,EU[1]=t.y;const n=t.z;return EU[2]=n??r??0,Ts(EU,t.spatialReference,0,e,i,0,1)}const s=nx(t,i);return!!s&&(e[0]=s?.x,e[1]=s?.y,e[2]=s?.z??r??0,!0)}async function Rj(t,e,i,r,s){return await kk(t.spatialReference,i,null,s),lc(t,e,i,r)}const EU=M();let t1=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&dO(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Vye);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,Vye));e++)this._items.push(this._allocator())}};const Vye=1024;function Ne(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function DO(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function Mce(t,e,i,r,s,n,o,a,l,c,u,h,p,f,g,y){return[t,e,i,r,s,n,o,a,l,c,u,h,p,f,g,y]}function aat(t,e){return new Float64Array(t,e,16)}const us=Ne();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:us,clone:DO,create:Ne,createView:aat,fromValues:Mce},Symbol.toStringTag,{value:"Module"}));function ps(){return[1,0,0,0,1,0,0,0,1]}function F$e(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function aD(t,e,i,r,s,n,o,a,l){return[t,e,i,r,s,n,o,a,l]}function lat(t,e){return new Float64Array(t,e,9)}const _C=ps();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:_C,clone:F$e,create:ps,createView:lat,fromValues:aD},Symbol.toStringTag,{value:"Module"}));function Qd(){return[0,0,0,1]}function cat(t){return[t[0],t[1],t[2],t[3]]}function uat(t,e,i,r){return[t,e,i,r]}function hat(t,e){return new Float64Array(t,e,4)}const Ace=Qd();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Ace,clone:cat,create:Qd,createView:hat,fromValues:uat},Symbol.toStringTag,{value:"Module"}));function vt(){return[0,0]}function cN(t){return[t[0],t[1]]}function Ni(t,e){return[t,e]}function k$e(t,e=vt()){const i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function dat(t,e){return new Float64Array(t,e,2)}function U$e(){return vt()}function B$e(){return Ni(1,1)}function z$e(){return Ni(1,0)}function V$e(){return Ni(0,1)}const kE=U$e(),Jq=B$e(),G$e=z$e(),pat=V$e();Object.freeze(Object.defineProperty({__proto__:null,ONES:Jq,UNIT_X:G$e,UNIT_Y:pat,ZEROS:kE,clone:cN,create:vt,createView:dat,fromArray:k$e,fromValues:Ni,ones:B$e,unitX:z$e,unitY:V$e,zeros:U$e},Symbol.toStringTag,{value:"Module"}));function pi(){return[0,0,0,0]}function Bk(t){return[t[0],t[1],t[2],t[3]]}function ni(t,e,i,r){return[t,e,i,r]}function bF(t,e=pi()){const i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function fat(t,e){return new Float64Array(t,e,4)}function j$e(){return pi()}function H$e(){return ni(1,1,1,1)}function q$e(){return ni(1,0,0,0)}function W$e(){return ni(0,1,0,0)}function Y$e(){return ni(0,0,1,0)}function X$e(){return ni(0,0,0,1)}const Ud=j$e(),Xp=H$e(),mat=q$e(),gat=W$e(),yat=Y$e(),_at=X$e();Object.freeze(Object.defineProperty({__proto__:null,ONES:Xp,UNIT_W:_at,UNIT_X:mat,UNIT_Y:gat,UNIT_Z:yat,ZEROS:Ud,clone:Bk,create:pi,createView:fat,fromArray:bF,fromValues:ni,ones:H$e,unitW:X$e,unitX:q$e,unitY:W$e,unitZ:Y$e,zeros:j$e},Symbol.toStringTag,{value:"Module"}));let UI=class hT{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return this._itemsPtr===0&&dO(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new hT(vt)}static createVec3f64(){return new hT(M)}static createVec4f64(){return new hT(pi)}static createMat3f64(){return new hT(ps)}static createMat4f64(){return new hT(Ne)}static createQuatf64(){return new hT(Qd)}get test(){}};const Eui=UI.createVec2f64(),tt=UI.createVec3f64(),Rce=UI.createVec4f64();UI.createMat3f64();const Pce=UI.createMat4f64(),vat=UI.createQuatf64();function Eg(t){return t?{origin:Fn(t.origin),vector:Fn(t.vector)}:{origin:M(),vector:M()}}function bat(t,e){const i=xat.get();return i.origin=t,i.vector=e,i}function Cui(t,e=Eg()){return wat(t.origin,t.vector,e)}function wat(t,e,i=Eg()){return ge(i.origin,t),ge(i.vector,e),i}function nE(t,e,i=Eg()){return ge(i.origin,t),Me(i.vector,e,t),i}function Oce(t,e){const i=Me(tt.get(),e,t.origin),r=xe(t.vector,i),s=xe(t.vector,t.vector),n=$e(r/s,0,1),o=Me(tt.get(),ce(tt.get(),t.vector,n),i);return xe(o,o)}function Mui(t,e,i){return jee(t,e,0,1,i)}function Aui(t,e,i){return Te(i,t.origin,ce(i,t.vector,e))}function jee(t,e,i,r,s){const{vector:n,origin:o}=t,a=Me(tt.get(),e,o),l=xe(n,a)/Ql(n);return ce(s,n,$e(l,i,r)),Te(s,s,t.origin)}function Rui(t,e){if(J$e(t,bat(e.origin,e.direction),!1,Pj)){const{tA:i,pB:r,distance2:s}=Pj;if(i>=0&&i<=1)return s;if(i<0)return Xo(t.origin,r);if(i>1)return Xo(Te(tt.get(),t.origin,t.vector),r)}return null}function Z$e(t,e,i){return!!J$e(t,e,!0,Pj)&&(ge(i,Pj.pA),!0)}function J$e(t,e,i,r){const n=t.origin,o=Te(tt.get(),n,t.vector),a=e.origin,l=Te(tt.get(),a,e.vector),c=tt.get(),u=tt.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const h=tt.get();if(h[0]=o[0]-n[0],h[1]=o[1]-n[1],h[2]=o[2]-n[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],f=u[0]*h[0]+u[1]*h[1]+u[2]*h[2],g=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],y=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],v=(h[0]*h[0]+h[1]*h[1]+h[2]*h[2])*y-f*f;if(Math.abs(v)<1e-6)return!1;let b=(p*f-g*y)/v,w=(p+f*b)/y;i&&(b=$e(b,0,1),w=$e(w,0,1));const x=tt.get(),S=tt.get();return x[0]=n[0]+b*h[0],x[1]=n[1]+b*h[1],x[2]=n[2]+b*h[2],S[0]=a[0]+w*u[0],S[1]=a[1]+w*u[1],S[2]=a[2]+w*u[2],r.tA=b,r.tB=w,r.pA=x,r.pB=S,r.distance2=Xo(x,S),!0}const Pj={tA:0,tB:0,pA:M(),pB:M(),distance2:0},xat=new t1(()=>Eg());function Kp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Sat(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ds(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function Ice(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function Q$e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function K$e(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function e3e(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function Tat(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Eat(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Cat(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function Mat(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function Aat(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function UE(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Rat(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function t3e(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function Oj(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return i*i+r*r+s*s+n*n}function $ce(t){const e=t[0],i=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+i*i+r*r+s*s)}function Nce(t){const e=t[0],i=t[1],r=t[2],s=t[3];return e*e+i*i+r*r+s*s}function Pat(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Oat(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function i3e(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=s*o,t[3]=n*o),t}function r3e(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Qq(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t[3]=a+r*(i[3]-a),t}function Iat(t,e){const i=Ok;let r,s,n,o,a,l;e=e||1;do r=2*i()-1,s=2*i()-1,a=r*r+s*s;while(a>=1);do n=2*i()-1,o=2*i()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*r,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function xh(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,t[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,t[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,t[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,t}function $at(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2],c=i[3],u=c*r+a*n-l*s,h=c*s+l*r-o*n,p=c*n+o*s-a*r,f=-o*r-a*s-l*n;return t[0]=u*c+f*-o+h*-l-p*-a,t[1]=h*c+f*-a+p*-o-u*-l,t[2]=p*c+f*-l+u*-a-h*-o,t[3]=e[3],t}function Nat(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function RP(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function BE(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=ba();return Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}const Lat=Q$e,Dat=K$e,Fat=e3e,kat=t3e,Uat=Oj,Bat=$ce,zat=Nce,s3e=Object.freeze(Object.defineProperty({__proto__:null,add:Ice,ceil:Tat,copy:Kp,copyVec3:Sat,dist:kat,distance:t3e,div:Fat,divide:e3e,dot:r3e,equals:BE,exactEquals:RP,floor:Eat,inverse:Oat,len:Bat,length:$ce,lerp:Qq,max:Mat,min:Cat,mul:Dat,multiply:K$e,negate:Pat,normalize:i3e,random:Iat,round:Aat,scale:UE,scaleAndAdd:Rat,set:Ds,sqrDist:Uat,sqrLen:zat,squaredDistance:Oj,squaredLength:Nce,str:Nat,sub:Lat,subtract:Q$e,transformMat4:xh,transformQuat:$at},Symbol.toStringTag,{value:"Module"}));function Pui(t,e,i){const r=xe(t,e)/xe(t,t);return ce(i,t,r)}function $w(t,e){return xe(t,e)/De(t)}function Lce(t,e){const i=xe(t,e)/(De(t)*De(e));return-Jo(i)}function n3e(t,e,i){Se(CU,t),Se(BW,e);const r=xe(CU,BW),s=Jo(r),n=yt(CU,CU,BW);return xe(n,i)<0?2*Math.PI-s:s}const CU=M(),BW=M();function FO(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function Vat(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return ue(t,i,r,s),t}function Oui(t,e,i){i=i||t;const r=xe(t,e);ue(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),Se(i,i)}function Gat(t,e,i){Math.abs(t[0])>Math.abs(t[1])?ue(e,0,1,0):ue(e,1,0,0),yt(i,t,e),yt(e,i,t),Se(i,i),Se(e,e)}function MU(t,e,i,r,s,n){const o=t+(e-t)*s;return o+(i+(r-i)*s-o)*n}function jat(t,e,i,r=M()){const s=De(t),n=De(e),o=xe(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),u=l/n*Math.sin(i*a);return ce($2,t,c),ce(N2,e,u),Te(r,$2,N2)}return Br(r,t,e,i)}function Iui(t,e,i,r=M(),s=M()){const n=De(t),o=De(e),a=xe(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(i*l),h=Math.sin((1-i)*l),p=(1-i)*n+i*o;{const f=p/c,g=f/o*u;ce($2,t,f/n*h),ce(N2,e,g),Te(r,$2,N2)}{const f=1/n*(-Math.cos((1-i)*l)*l*p+h*(-n+o));ce($2,t,f);const g=1/o*(Math.cos(i*l)*l*p+u*(-n+o));ce(N2,e,g),Te(s,$2,N2),ce(s,s,1/c)}return s}return Br(r,t,e,i),Me(s,e,t),Se(s,s),s}function Ij(t,e,i){t=Se($2,t),e=Se(N2,e);const r=Jo(xe(t,e));if(i){const s=yt(Hat,t,e);if(xe(s,i)<0)return-r}return r}function CV(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const s=t[r-1][0],n=t[r][0],o=(n-i)/(n-s);return o*t[r-1][1]+(1-o)*t[r][1]}}function $ui(t,e,i,r){Me(Gye,e,t),Me(jye,i,t),yt(r,Gye,jye),Se(r,r),r[3]=-xe(t,r)}function Nui(t,e){if(ue(e,0,0,0),t.length>0){for(let i=0;i<t.length;++i)Te(e,e,t[i]);ce(e,e,1/t.length)}}const Gye=M(),jye=M(),Hat=M(),$2=M(),N2=M();function mr(t=uN){return[t[0],t[1],t[2],t[3]]}function qat(t=uN[0],e=uN[1],i=uN[2],r=uN[3]){return Dce(t,e,i,r,Rce.get())}function Kq(t,e){return Dce(e[0],e[1],e[2],e[3],t)}function Lui(t){return t}function Dce(t,e,i,r,s=mr()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function o3e(t,e,i){return ge(i,t),i[3]=e,i}function zk(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function Xl(t,e,i,r=mr()){const s=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=n*c-o*l,h=o*a-s*c,p=s*l-n*a,f=u*u+h*h+p*p,g=Math.abs(f-1)>1e-5&&f>1e-12?1/Math.sqrt(f):1;return r[0]=u*g,r[1]=h*g,r[2]=p*g,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function Fce(t,e,i,r=0,s=Math.floor(i*(1/3)),n=Math.floor(i*(2/3))){if(i<3)return!1;e($$,r);let o=s,a=!1;for(;o<i-1&&!a;)e(QC,o),o++,a=!ga($$,QC);if(!a)return!1;for(o=Math.max(o,n),a=!1;o<i&&!a;)e(p2,o),o++,Me(AU,$$,QC),Se(AU,AU),Me(RU,QC,p2),Se(RU,RU),a=!ga($$,p2)&&!ga(QC,p2)&&Math.abs(xe(AU,RU))<Yat;return a?(Xl($$,QC,p2,t),!0):(r!==0||s!==1||n!==2)&&Fce(t,e,i,0,1,2)}function Wat(t,e,i=!0){const r=e.length/3;return Fce(t,(s,n)=>ue(s,e[3*n+0],e[3*n+1],e[3*n+2]),i?r-1:r)}const Yat=.99619469809,$$=M(),QC=M(),p2=M(),AU=M(),RU=M();function Hee(t,e,i){return e!==t&&Kq(t,e),t[3]=-xe(t,i),t}function qee(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function wF(t,e,i,r){return yt(p2,e,t),zk(i,p2,r)}function Dui(t,e,i,r){return e9(t,e,Me(tt.get(),i,e),elt,r)}function vC(t,e,i){return e!=null&&e9(t,e.origin,e.direction,tlt,i)}function Xat(t,e,i){return e9(t,e.origin,e.vector,n0.NONE,i)}function Zat(t,e,i){return e9(t,e.origin,e.vector,n0.CLAMP,i)}function a3e(t,e){return Wr(t,e)>=0}function Jat(t,e){const i=xe(t,e.ray.direction),r=-Wr(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function Qat(t,e){const i=xe(t,e.ray.direction),r=-Wr(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function Kat(t,e,i){const r=ce(tt.get(),t,-t[3]),s=Wee(t,Me(tt.get(),e,r),tt.get());return Te(i,s,r),i}function Fui(t,e,i,r){const s=t,n=tt.get(),o=tt.get();Gat(s,n,o);const a=Me(tt.get(),i,e),l=$w(n,a),c=$w(o,a),u=$w(s,a);return ue(r,l,c,u)}function Wee(t,e,i){const r=ce(tt.get(),t,xe(t,e));return Me(i,e,r),i}function kui(t,e){return Math.abs(Wr(t,e))}function Wr(t,e){return xe(t,e)+t[3]}function e9(t,e,i,r,s){const n=xe(t,i);if(n===0)return!1;let o=-(xe(t,e)+t[3])/n;return r&n0.CLAMP&&(o=$e(o,0,1)),!(!(r&n0.INFINITE_MIN)&&o<0||!(r&n0.INFINITE_MAX)&&o>1)&&(Te(s,e,ce(s,i,o)),!0)}const uN=[0,0,1,0];var n0;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(n0||(n0={}));const elt=n0.INFINITE_MIN|n0.INFINITE_MAX,tlt=n0.INFINITE_MAX;function jo(t){return t?Hye(Fn(t.origin),Fn(t.direction)):Hye(M(),M())}function Hye(t,e){return{origin:t,direction:e}}function Uui(t,e){return qw(t.origin,e.origin)&&qw(t.direction,e.direction)}function Yd(t,e){const i=slt.get();return i.origin=t,i.direction=e,i}function $j(t,e=jo()){return c3e(t.origin,t.direction,e)}function l3e(t,e,i=jo()){return ge(i.origin,t),Me(i.direction,e,t),i}function c3e(t,e,i=jo()){return ge(i.origin,t),ge(i.direction,e),i}function ilt(t,e){const i=yt(tt.get(),Se(tt.get(),t.direction),Me(tt.get(),e,t.origin));return xe(i,i)}function rlt(t,e,i){const r=xe(t.direction,Me(i,e,t.origin));return Te(i,t.origin,ce(i,t.direction,r)),i}function Bui(t,e,i,r){const s=t.direction,n=e.direction,o=Vi(zW,e.origin,t.origin),a=xe(s,n),l=xe(n,o),c=xe(s,o),u=xe(s,s),h=xe(n,n),p=(a*l+c*h)/(u*h-a*a),f=(a*c-l*u)/(u*h-a*a);return Te(i,t.origin,ce(zW,s,p)),Te(r,e.origin,ce(zW,n,f)),[i,r]}const slt=new t1(()=>jo()),zW=M(),VW=()=>oe.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let nlt=class{constructor(){this.plane=mr(),this.origin=M(),this.basis1=M(),this.basis2=M()}};const u3e=nlt;function i1(t=w3e){return{plane:mr(t.plane),origin:Fn(t.origin),basis1:Fn(t.basis1),basis2:Fn(t.basis2)}}function olt(t,e,i){const r=_lt.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=qat(0,0,0,0),t9(r),r}function bC(t,e=i1()){return kce(t.origin,t.basis1,t.basis2,e)}function alt(t,e){ge(e.origin,t.origin),ge(e.basis1,t.basis1),ge(e.basis2,t.basis2),Kq(e.plane,t.plane)}function kce(t,e,i,r=i1()){return ge(r.origin,t),ge(r.basis1,e),ge(r.basis2,i),t9(r),glt(r,"fromValues()"),r}function t9(t){wF(t.basis2,t.basis1,t.origin,t.plane)}function h3e(t,e,i){t!==i&&bC(t,i);const r=ce(tt.get(),Gv(t),e);return Te(i.origin,i.origin,r),i.plane[3]-=e,i}function llt(t,e,i){return d3e(e,i),h3e(i,Vce(t,t.origin),i),i}function d3e(t,e=i1()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return ue(e.origin,t[0]+i,t[1]+r,0),ue(e.basis1,i,0,0),ue(e.basis2,0,r,0),Dce(0,0,1,0,e.plane),e}function Uce(t,e,i){return!!vC(t.plane,e,i)&&v3e(t,i)}function clt(t,e,i){if(Uce(t,e,i))return i;const r=p3e(t,e,tt.get());return Te(i,e.origin,ce(tt.get(),e.direction,jr(e.origin,r)/De(e.direction))),i}function p3e(t,e,i){const r=Nj.get();b3e(t,e,r,Nj.get());let s=Number.POSITIVE_INFINITY;for(const n of jce){const o=Gce(t,n,i9.get()),a=tt.get();if(Xat(r,o,a)){const l=Kv(tt.get(),e.origin,a),c=Math.abs(Jo(xe(e.direction,l)));c<s&&(s=c,ge(i,a))}}return s===Number.POSITIVE_INFINITY?f3e(t,e,i):i}function f3e(t,e,i){if(Uce(t,e,i))return i;const r=Nj.get(),s=Nj.get();b3e(t,e,r,s);let n=Number.POSITIVE_INFINITY;for(const o of jce){const a=Gce(t,o,i9.get()),l=tt.get();if(Zat(r,a,l)){const c=ilt(e,l);if(!a3e(s,l))continue;c<n&&(n=c,ge(i,l))}}return Bce(t,e.origin)<n&&m3e(t,e.origin,i),i}function m3e(t,e,i){const r=Kat(t.plane,e,tt.get()),s=jee(qye(t,t.basis1),r,-1,1,tt.get()),n=jee(qye(t,t.basis2),r,-1,1,tt.get());return Me(i,Te(tt.get(),s,n),t.origin),i}function g3e(t,e,i){const{origin:r,basis1:s,basis2:n}=t,o=Me(tt.get(),e,r),a=$w(s,o),l=$w(n,o),c=$w(Gv(t),o);return ue(i,a,l,c)}function Bce(t,e){const i=g3e(t,e,tt.get()),{basis1:r,basis2:s}=t,n=De(r),o=De(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function ult(t,e){return Math.sqrt(Bce(t,e))}function hlt(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of jce){const s=Gce(t,r,i9.get()),n=Oce(s,e);n>i&&(i=n)}return Math.sqrt(i)}function zce(t,e){return a3e(t.plane,e)&&v3e(t,e)}function dlt(t,e,i,r){return mlt(t,i,r)}function Vce(t,e){const i=-t.plane[3];return $w(Gv(t),e)-i}function plt(t,e,i,r){const s=Vce(t,e),n=ce(ylt,Gv(t),i-s);return Te(r,e,n),r}function y3e(t,e){return ga(t.basis1,e.basis1)&&ga(t.basis2,e.basis2)&&ga(t.origin,e.origin)}function _3e(t,e,i){return t!==i&&bC(t,i),Ao(KC,e),Rh(KC,KC),nt(i.basis1,t.basis1,KC),nt(i.basis2,t.basis2,KC),nt(i.plane,t.plane,KC),nt(i.origin,t.origin,e),Hee(i.plane,i.plane,i.origin),i}function flt(t,e,i,r){return t!==r&&bC(t,r),Ph(GW,e,i),nt(r.basis1,t.basis1,GW),nt(r.basis2,t.basis2,GW),t9(r),r}function Gv(t){return t.plane}function mlt(t,e,i){switch(e){case Ls.X:ge(i,t.basis1),Se(i,i);break;case Ls.Y:ge(i,t.basis2),Se(i,i);break;case Ls.Z:ge(i,Gv(t))}return i}function v3e(t,e){const i=Me(tt.get(),e,t.origin),r=Ql(t.basis1),s=Ql(t.basis2),n=xe(t.basis1,i),o=xe(t.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function qye(t,e){const i=i9.get();return ge(i.origin,t.origin),ge(i.vector,e),i}function Gce(t,e,i){const{basis1:r,basis2:s,origin:n}=t,o=ce(tt.get(),r,e.origin[0]),a=ce(tt.get(),s,e.origin[1]);Te(i.origin,o,a),Te(i.origin,i.origin,n);const l=ce(tt.get(),r,e.direction[0]),c=ce(tt.get(),s,e.direction[1]);return ce(i.vector,Te(l,l,c),2),i}function glt(t,e){Math.abs(xe(t.basis1,t.basis2)/(De(t.basis1)*De(t.basis2)))>1e-6&&VW().warn(e,"Provided basis vectors are not perpendicular"),Math.abs(xe(t.basis1,Gv(t)))>1e-6&&VW().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-xe(Gv(t),t.origin)-t.plane[3])>1e-6&&VW().warn(e,"Plane offset is not consistent with plane origin")}function b3e(t,e,i,r){const s=Gv(t);wF(s,e.direction,e.origin,i),wF(i,s,e.origin,r)}const w3e={plane:mr(),origin:Be(0,0,0),basis1:Be(1,0,0),basis2:Be(0,1,0)},Nj=new t1(mr),i9=new t1(Eg),ylt=M(),_lt=new t1(()=>i1()),jce=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],KC=Ne(),GW=Ne(),vlt=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:u3e,altitudeAt:Vce,axisAt:dlt,closestPoint:f3e,closestPointOnSilhouette:p3e,copy:bC,copyWithoutVerify:alt,create:i1,distance:ult,distance2:Bce,distanceToSilhouette:hlt,elevate:h3e,equals:y3e,extrusionContainsPoint:zce,fromAABoundingRect:d3e,fromValues:kce,intersectRay:Uce,intersectRayClosestSilhouette:clt,normal:Gv,projectPoint:m3e,projectPointLocal:g3e,rotate:flt,setAltitudeAt:plt,setExtent:llt,transform:_3e,up:w3e,updateUnboundedPlane:t9,wrap:olt},Symbol.toStringTag,{value:"Module"})),blt=new Je(GRe),UR=new Je(yq),BR=new Je(_q),wlt=new Je(jRe);function Xd(t){const e=Wye.get(t);if(e)return e;let i=blt;if(t)if(t===UR)i=UR;else if(t===BR)i=BR;else{const r=t.wkid,s=t.latestWkid;if(r!=null||s!=null)gO(r)||gO(s)?i=UR:(yO(r)||yO(s))&&(i=BR);else{const n=t.wkt2??t.wkt;if(n){const o=n.toUpperCase();o===xlt?i=UR:o===Slt&&(i=BR)}}}return Wye.set(t,i),i}const Wye=new Map,xlt=UR.wkt.toUpperCase(),Slt=BR.wkt.toUpperCase(),x3e=Bn();function Bn(){return pi()}const Tlt=BE,Elt=BE;function zE(t,e){return Kp(e,t)}function S3e(t,e){return ni(t[0],t[1],t[2],e)}function Clt(t){return t}function Mlt(t){t[0]=t[1]=t[2]=t[3]=0}function r9(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function Nw(t){return t[3]}function Alt(t){return t}function T3e(t,e,i,r){return ni(t,e,i,r)}function Rlt(t,e,i){return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=t[3]+e,i}function Plt(t,e,i){return t!==i&&zE(t,i),i}function Lx(t,e,i){if(e==null||!E3e(t,e,Lj))return!1;let{t0:r,t1:s}=Lj;if((r<0||s<r&&s>0)&&(r=s),r<0)return!1;if(i){const{origin:n,direction:o}=e;i[0]=n[0]+o[0]*r,i[1]=n[1]+o[1]*r,i[2]=n[2]+o[2]*r}return!0}function Olt(t,e,i){const r=l3e(e,i);if(!E3e(t,r,Lj))return[];const{origin:s,direction:n}=r,{t0:o,t1:a}=Lj,l=c=>{const u=M();return ao(u,s,n,c),Hce(t,u,u)};return Math.abs(o-a)<ba()?[l(o)]:[l(o),l(a)]}const Lj={t0:0,t1:0};function E3e(t,e,i){const{origin:r,direction:s}=e,n=Ilt;n[0]=r[0]-t[0],n[1]=r[1]-t[1],n[2]=r[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return i.t0=(-a-c)/(2*o),i.t1=(-a+c)/(2*o),!0}const Ilt=M();function Yee(t,e){return Lx(t,e,null)}function $lt(t,e,i){if(Lx(t,e,i))return i;const r=BI(t,e,tt.get());return Te(i,e.origin,ce(tt.get(),e.direction,jr(e.origin,r)/De(e.direction))),i}function BI(t,e,i){const r=tt.get(),s=Pce.get();yt(r,e.origin,e.direction);const n=Nw(t);yt(i,r,e.origin),ce(i,i,1/De(i)*n);const o=M3e(t,e.origin),a=Lce(e.origin,i);return Ph(s,a+o,r),nt(i,i,s),i}function Nlt(t,e,i){return Lx(t,e,i)?i:(rlt(e,t,i),Hce(t,i,i))}function Hce(t,e,i){const r=Me(tt.get(),e,t),s=ce(tt.get(),r,t[3]/De(r));return Te(i,s,t)}function C3e(t,e){const i=Me(tt.get(),e,t),r=Ql(i),s=t[3]*t[3];return Math.sqrt(Math.abs(r-s))}function M3e(t,e){const i=Me(tt.get(),e,t),r=De(i),s=Nw(t),n=s+Math.abs(s-r);return Jo(s/n)}const jW=M();function A3e(t,e,i,r){const s=Me(jW,e,t);switch(i){case Ls.X:{const n=uge(s,jW)[2];return ue(r,-Math.sin(n),Math.cos(n),0)}case Ls.Y:{const n=uge(s,jW),o=n[1],a=n[2],l=Math.sin(o);return ue(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Ls.Z:return Se(r,s);default:return}}function R3e(t,e){const i=Me(Xee,e,t);return De(i)-t[3]}function Llt(t,e,i,r){const s=R3e(t,e),n=A3e(t,e,Ls.Z,Xee),o=ce(Xee,n,i-s);return Te(r,e,o)}function Dlt(t,e){const i=Xo(t,e),r=Nw(t);return i<=r*r}function Flt(t,e,i=pi()){const r=jr(t,e),s=t[3],n=e[3];return r+n<s?(Kp(i,t),i):r+s<n?(Kp(i,e),i):(Br(i,t,e,(r+n-s)/(2*r)),i[3]=(r+s+n)/2,i)}const Xee=M(),s9=Bn(),klt=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:x3e,altitudeAt:R3e,angleToSilhouette:M3e,axisAt:A3e,clear:Mlt,closestPoint:Nlt,closestPointOnSilhouette:BI,containsPoint:Dlt,copy:zE,create:Bn,distanceToSilhouette:C3e,elevate:Rlt,equals:Elt,exactEquals:Tlt,fromCenterAndRadius:S3e,fromRadius:r9,fromValues:T3e,getCenter:Alt,getRadius:Nw,intersectLine:Olt,intersectRay:Lx,intersectRayClosestSilhouette:$lt,intersectsRay:Yee,projectPoint:Hce,setAltitudeAt:Llt,setExtent:Plt,tmpSphere:s9,union:Flt,wrap:Clt},Symbol.toStringTag,{value:"Module"}));function Ult(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function Blt(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function zlt(t){return{operations:t,value:t.create()}}function P3e(t,e,i=zlt(t)){return i.operations=t,t.copy(e,i.value),i}function Vlt(t){return P3e(klt,T3e(0,0,0,$r(t).radius))}const Yye=2**50;function Glt(){return P3e(vlt,kce([0,0,0],[Yye,0,0],[0,Yye,0]))}function jlt(t,e,i){return t.operations.axisAt(t.value,e,Ls.Z,i)}function Hlt(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function qlt(t,e,i){return t.operations.intersectRay(t.value,e,i)}function Wlt(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function Ylt(t,e){return t.operations.altitudeAt(t.value,e)}function O3e(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function Xlt(t,e,i,r){return e!==r&&Xn(r,e),ue(eM,r[12],r[13],r[14]),O3e(t,eM,i,eM),r[12]=eM[0],r[13]=eM[1],r[14]=eM[2],r}function HW(t,e,i){return t.operations.elevate(t.value,e,i.value)}const eM=M();function Xye(t,e,i,r,s){return s[0]=xe(t,e),s[1]=xe(t,i),s[2]=xe(t,r),s}function Zee(t,e,i,r,s){ge(i,t),ge(PU,e),Se(PU,PU),yt(r,PU,i),yt(s,r,i)}function Zlt(t,e){return t?Xd(e):e.isGeographic?Je.PlateCarree:e}const PU=M(),qce=96;function Vui(t,e){const i=e||t.extent,r=t.width,s=Xc(i?.spatialReference);return i&&r?i.width/r*s*Fle*qce:0}function Jlt(t,e){return t/(Xc(e)*Fle*qce)}function Qlt(t){return t/(Fle*qce)}function Gui(t,e,i){return Klt(t,e)&&ect(t,i)}function Klt(t,e){return e===0||Pw(t,e)||t<e}function ect(t,e){return e===0||Pw(t,e)||t>e}let kO=class extends oD{constructor(e){super(e),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(oe.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};kO=d([N("esri.support.AnalysesCollection")],kO);const MV={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},qW={xsmall:544,small:768,medium:992,large:1200};function tct(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function WW(t,e){return e?MV[t].valueToClassName[e].split(" "):[]}const ict=t=>{let e=class extends t{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=qW}initialize(){this.addHandles(_e(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Ir))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i!==this._get("breakpoints")){if(!tct(i)){const r=JSON.stringify(qW,null,2);console.warn("provided breakpoints are not valid, using defaults:"+r),i=qW}this._set("breakpoints",{...i})}}_updateClassNames(){if(!this.container)return;const i=hh.acquire(),r=hh.acquire();let s,n=!1;for(s in MV){const o=this[s],a=MV[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,WW(s,o).forEach(l=>r.push(l)),WW(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),hh.release(i),hh.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in MV)WW(r,this[r]).forEach(s=>i.classList.remove(s))}};return d([m()],e.prototype,"breakpoints",null),d([m()],e.prototype,"orientation",void 0),d([m()],e.prototype,"widthBreakpoint",void 0),d([m()],e.prototype,"heightBreakpoint",void 0),e=d([N("esri.views.BreakpointsOwner")],e),e};let Mv=class extends Fe{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,i,r={}){return this._installWatch(e,i,r,_e)}addWhen(e,i,r={}){return this._installWatch(e,i,r,Du)}addOnCollectionChange(e,i,{initial:r=!1,final:s=!1}={}){const n=++this._handleId;return this.addHandles([qa(e,"after-changes",this._createSyncUpdatingCallback(),Mr),qa(e,"change",i,{onListenerAdd:r?o=>i({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>i({added:[],removed:o.toArray()}):void 0})],n),er(()=>this.removeHandles(n))}addPromise(e){if(e==null)return e;const i=++this._handleId;this.addHandles(er(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(OU)||this._set("updating",!1))}),i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,i,r={},s){const n=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,i,r);return this.addHandles(o,n),er(()=>this.removeHandles(n))}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),s=_e(e,r,{sync:!0,equals:()=>!1});return this.addHandles(s,i),s}_createSyncUpdatingCallback(){return()=>{this.removeHandles(OU),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(dC(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(OU))}),OU)}}};d([m({readOnly:!0})],Mv.prototype,"updating",void 0),Mv=d([N("esri.core.support.UpdatingHandles")],Mv);const OU=-42;/*!
 * @esri/arcgis-html-sanitizer - v4.0.1 - Thu May 30 2024 10:12:55 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2024 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Dj=function(){return Dj=Object.assign||function(e){for(var i,r=1,s=arguments.length;r<s;r++){i=arguments[r];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},Dj.apply(this,arguments)},Jee={exports:{}},Jn={},Qee={exports:{}},wC={};function I3e(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function rct(t,e,i){}function sct(t,e,i){}var nct=/javascript\s*\:/img;function oct(t,e){return nct.test(e)?"":e}wC.whiteList=I3e();wC.getDefaultWhiteList=I3e;wC.onAttr=rct;wC.onIgnoreAttr=sct;wC.safeAttrValue=oct;var act={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},N$=act;function lct(t,e){t=N$.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,s=0,n=0,o="";function a(){if(!r){var u=N$.trim(t.slice(s,n)),h=u.indexOf(":");if(h!==-1){var p=N$.trim(u.slice(0,h)),f=N$.trim(u.slice(h+1));if(p){var g=e(s,o.length,p,f,u);g&&(o+=g+"; ")}}}s=n+1}for(;n<i;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return N$.trim(o)}var cct=lct,IU=wC,uct=cct;function Zye(t){return t==null}function hct(t){var e={};for(var i in t)e[i]=t[i];return e}function $3e(t){t=hct(t||{}),t.whiteList=t.whiteList||IU.whiteList,t.onAttr=t.onAttr||IU.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||IU.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||IU.safeAttrValue,this.options=t}$3e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=uct(t,function(l,c,u,h,p){var f=r[u],g=!1;if(f===!0?g=f:typeof f=="function"?g=f(h):f instanceof RegExp&&(g=f.test(h)),g!==!0&&(g=!1),h=o(u,h),!!h){var y={position:c,sourcePosition:l,source:p,isWhite:g};if(g){var v=s(u,h,y);return Zye(v)?u+":"+h:v}else{var v=n(u,h,y);if(!Zye(v))return v}}});return a};var dct=$3e;(function(t,e){var i=wC,r=dct;function s(o,a){var l=new r(a);return l.process(o)}e=t.exports=s,e.FilterCSS=r;for(var n in i)e[n]=i[n]})(Qee,Qee.exports);var Wce=Qee.exports,Yce={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},pct=Wce.FilterCSS,fct=Wce.getDefaultWhiteList,Fj=Yce;function N3e(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height","loading"],ins:["datetime"],kbd:[],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var L3e=new pct;function mct(t,e,i){}function gct(t,e,i){}function yct(t,e,i){}function _ct(t,e,i){}function D3e(t){return t.replace(bct,"&lt;").replace(wct,"&gt;")}function vct(t,e,i,r){if(i=V3e(i),e==="href"||e==="src"){if(i=Fj.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if($U.lastIndex=0,$U.test(i))return""}else if(e==="style"){if(Jye.lastIndex=0,Jye.test(i)||(Qye.lastIndex=0,Qye.test(i)&&($U.lastIndex=0,$U.test(i))))return"";r!==!1&&(r=r||L3e,i=r.process(i))}return i=G3e(i),i}var bct=/</g,wct=/>/g,xct=/"/g,Sct=/&quot;/g,Tct=/&#([a-zA-Z0-9]*);?/gim,Ect=/&colon;?/gim,Cct=/&newline;?/gim,$U=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,Jye=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Qye=/u\s*r\s*l\s*\(.*/gi;function F3e(t){return t.replace(xct,"&quot;")}function k3e(t){return t.replace(Sct,'"')}function U3e(t){return t.replace(Tct,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function B3e(t){return t.replace(Ect,":").replace(Cct," ")}function z3e(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return Fj.trim(e)}function V3e(t){return t=k3e(t),t=U3e(t),t=B3e(t),t=z3e(t),t}function G3e(t){return t=F3e(t),t=D3e(t),t}function Mct(){return""}function Act(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(o){return i?!0:Fj.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return s.push([n!==!1?n:l.position,u]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return Fj.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function Rct(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var s=t.indexOf("-->",r);if(s===-1)break;i=s+3}return e}function Pct(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}Jn.whiteList=N3e();Jn.getDefaultWhiteList=N3e;Jn.onTag=mct;Jn.onIgnoreTag=gct;Jn.onTagAttr=yct;Jn.onIgnoreTagAttr=_ct;Jn.safeAttrValue=vct;Jn.escapeHtml=D3e;Jn.escapeQuote=F3e;Jn.unescapeQuote=k3e;Jn.escapeHtmlEntities=U3e;Jn.escapeDangerHtml5Entities=B3e;Jn.clearNonPrintableCharacter=z3e;Jn.friendlyAttrValue=V3e;Jn.escapeAttrValue=G3e;Jn.onIgnoreTagStripAll=Mct;Jn.StripTagBody=Act;Jn.stripCommentTag=Rct;Jn.stripBlankChar=Pct;Jn.attributeWrapSign='"';Jn.cssFilter=L3e;Jn.getDefaultCSSWhiteList=fct;var n9={},Xb=Yce;function Oct(t){var e=Xb.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=Xb.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function Ict(t){return t.slice(0,2)==="</"}function $ct(t,e,i){var r="",s=0,n=!1,o=!1,a=0,l=t.length,c="",u="";e:for(a=0;a<l;a++){var h=t.charAt(a);if(n===!1){if(h==="<"){n=a;continue}}else if(o===!1){if(h==="<"){r+=i(t.slice(s,a)),n=a,s=a;continue}if(h===">"||a===l-1){r+=i(t.slice(s,n)),u=t.slice(n,a+1),c=Oct(u),r+=e(n,r.length,c,u,Ict(u)),s=a+1,n=!1;continue}if(h==='"'||h==="'")for(var p=1,f=t.charAt(a-p);f.trim()===""||f==="=";){if(f==="="){o=h;continue e}f=t.charAt(a-++p)}}else if(h===o){o=!1;continue}}return s<l&&(r+=i(t.substr(s))),r}var Nct=/[^a-zA-Z0-9\\_:.-]/gim;function Lct(t,e){var i=0,r=0,s=[],n=!1,o=t.length;function a(p,f){if(p=Xb.trim(p),p=p.replace(Nct,"").toLowerCase(),!(p.length<1)){var g=e(p,f||"");g&&s.push(g)}}for(var l=0;l<o;l++){var c=t.charAt(l),u,h;if(n===!1&&c==="="){n=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:Fct(t,l+1);continue}if(n!==!1&&l===r){if(h=t.indexOf(c,l+1),h===-1)break;u=Xb.trim(t.slice(r+1,h)),a(n,u),n=!1,l=h,i=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(h=Dct(t,l),h===-1){u=Xb.trim(t.slice(i,l)),a(u),n=!1,i=l+1;continue}else{l=h-1;continue}else if(h=kct(t,l-1),h===-1){u=Xb.trim(t.slice(i,l)),u=Kye(u),a(n,u),n=!1,i=l+1;continue}else continue}return i<t.length&&(n===!1?a(t.slice(i)):a(n,Kye(Xb.trim(t.slice(i))))),Xb.trim(s.join(" "))}function Dct(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function Fct(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function kct(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function Uct(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function Kye(t){return Uct(t)?t.substr(1,t.length-2):t}n9.parseTag=$ct;n9.parseAttr=Lct;var Bct=Wce.FilterCSS,Pp=Jn,j3e=n9,zct=j3e.parseTag,Vct=j3e.parseAttr,AV=Yce;function NU(t){return t==null}function Gct(t){var e=AV.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=AV.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=AV.trim(t.slice(0,-1))),{html:t,closing:i}}function jct(t){var e={};for(var i in t)e[i]=t[i];return e}function Hct(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function H3e(t){t=jct(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=Pp.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=Hct(t.whiteList||t.allowList):t.whiteList=Pp.whiteList,this.attributeWrapSign=t.singleQuotedAttributeValue===!0?"'":Pp.attributeWrapSign,t.onTag=t.onTag||Pp.onTag,t.onTagAttr=t.onTagAttr||Pp.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||Pp.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||Pp.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||Pp.safeAttrValue,t.escapeHtml=t.escapeHtml||Pp.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new Bct(t.css))}H3e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,u=e.attributeWrapSign,h=e.cssFilter;i.stripBlankChar&&(t=Pp.stripBlankChar(t)),i.allowCommentTag||(t=Pp.stripCommentTag(t));var p=!1;i.stripIgnoreTagBody&&(p=Pp.StripTagBody(i.stripIgnoreTagBody,n),n=p.onIgnoreTag);var f=zct(t,function(g,y,v,b,w){var x={sourcePosition:g,position:y,isClosing:w,isWhite:Object.prototype.hasOwnProperty.call(r,v)},S=s(v,b,x);if(!NU(S))return S;if(x.isWhite){if(x.isClosing)return"</"+v+">";var E=Gct(b),C=r[v],R=Vct(E.html,function(I,F){var D=AV.indexOf(C,I)!==-1,z=o(v,I,F,D);return NU(z)?D?(F=l(v,I,F,h),F?I+"="+u+F+u:I):(z=a(v,I,F,D),NU(z)?void 0:z):z});return b="<"+v,R&&(b+=" "+R),E.closing&&(b+=" /"),b+=">",b}else return S=n(v,b,x),NU(S)?c(b):S},c);return p&&(f=p.remove(f)),f};var qct=H3e;(function(t,e){var i=Jn,r=n9,s=qct;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in i)e[a]=i[a];for(var l in r)e[l]=r[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(Jee,Jee.exports);var tM=Jee.exports,Wct=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},Yct=function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],details:["style"],div:["align","style","aria-label","aria-hidden"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=Dj(Dj({},tM.getDefaultCSSWhiteList()),{flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,"line-height":!0,"justify-content":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):tM.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!i?s=e:e&&i?(s=Object.create(this.arcgisFilterOptions),s.css={whiteList:this.arcgisCSSWhiteList},Object.keys(e).forEach(function(n){if(n==="whiteList")s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]);else if(n==="css"){var o=e.css.whiteList;o!=null&&e.css instanceof Object&&Object.keys(o).forEach(function(a){return s.css.whiteList[a]=o[a]})}else s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList,s.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=s,this._xssFilter=new tM.FilterXSS(s)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?tM.escapeAttrValue(e):!n&&!s?tM.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,s):tM.safeAttrValue(e,i,r,s)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,s){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(Wct(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],u=r.validate(c,i);return u.isValid?a[l]=c:(s=!0,a[l]=u.sanitized),a},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const o9=new Map;function q3e(){o9.clear()}function Xct(t){return o9.get(t)}function Zct(t,e){o9.set(t,e)}function YW(t){o9.delete(t)}function Jct(...t){const e=hh.acquire();for(let r=0;r<t.length;r++){const s=t[r],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const i=e.join(" ");return hh.release(e),i}(()=>{const t=new Map,e=new ResizeObserver(r=>{q3e();for(const s of r)t.get(s.target)?.(s)}),i=(r,s,n)=>(t.set(r,s),e.observe(r,n),er(()=>{e.unobserve(r),t.delete(r)}));return(r,s,n)=>{let o=null;return Xw([_e(()=>typeof r=="function"?r():r,a=>{o?.remove(),a&&(o=i(a,s,n))},Sr),er(()=>o?.remove())])}})();function Qct(t){const e=t?.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function qui(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function Wui(t){const e="data-node-ref";this[t.getAttribute(e)]=t}const Kct=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],eut=Kct.reduce((t,e)=>(t[e]=[],t),{}),tut=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],W3e=new Yct({whiteList:eut,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(tut.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function iut(t){return t==="Enter"||t===" "}const Y3e="http://www.w3.org/",a9=`${Y3e}2000/svg`,X3e=`${Y3e}1999/xlink`;let e0e=[],Xce=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},Zce=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),Z3e=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},rut=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(Zce(t[r],e))return r}return-1},XW=(t,e,i,r)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(Zce(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},sut=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},Kee=[],ete=!1,J3e=t=>{(t.children||[]).forEach(J3e),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},t0e=()=>{ete=!1,Kee.forEach(J3e),Kee.length=0},i0e=t=>{Kee.push(t),ete||(ete=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(t0e,{timeout:16}):setTimeout(t0e,16))},r0e=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),i0e(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),i0e(t))},nut=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")ite(t,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let h=0;h<u;h++){let p=c[h];l[p]&&t.classList.add(p)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let h=0;h<u;h++){let p=c[h],f=l[p];f&&(Z3e(f),i.styleApplyer(t,p,f))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,t,e)),a==="oninput"&&function(){let u=l;l=function(h){u.apply(this,[h]),h.target["oninput-value"]=h.target.value}}()),t[a]=l):i.namespace===a9?a==="href"?t.setAttributeNS(X3e,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=W3e.sanitize(l):tte(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function tte(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let kj,out=(t,e,i)=>{if(e)for(let r of e)zR(r,t,void 0,i)},Q3e=(t,e,i)=>{out(t,e.children,i),e.text&&(t.textContent=e.text),nut(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},zR=(t,e,i,r)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),i!==void 0?e.insertBefore(s,i):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(n-1),h=o.slice(n,l);u==="."?s.classList.add(h):u==="#"?s.id=h:(h==="svg"&&(r=Xce(r,{namespace:a9})),r.namespace!==void 0?s=t.domNode=a.createElementNS(r.namespace,h):(s=t.domNode=t.domNode||a.createElement(h),h==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(s,i):s.parentNode!==e&&e.appendChild(s)),n=l+1}}Q3e(s,t,r)}},ite=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},aut=(t,e,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],u=e[l];if(l==="class")u!==c&&(ite(t,u,!1),ite(t,c,!0));else if(l==="classes"){let h=t.classList,p=Object.keys(c),f=p.length;for(let g=0;g<f;g++){let y=p[g],v=!!c[y];v!==!!u[y]&&(s=!0,v?h.add(y):h.remove(y))}}else if(l==="styles"){let h=Object.keys(c),p=h.length;for(let f=0;f<p;f++){let g=h[f],y=c[g];y!==u[g]&&(s=!0,y?(Z3e(y),r.styleApplyer(t,g,y)):r.styleApplyer(t,g,""))}}else if(c||typeof u!="string"||(c=""),l!=="value"||tte(t)){if(c!==u){let h=typeof c;h==="function"&&r.eventHandlerInterceptor||(r.namespace===a9?l==="href"?t.setAttributeNS(X3e,l,c):t.setAttribute(l,c):h==="string"?l==="innerHTML"?t[l]=W3e.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):tte(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}else{let h=t[l];h!==c&&(t["oninput-value"]?h===t["oninput-value"]:c!==u)&&(t[l]=c,t["oninput-value"]=void 0),c!==u&&(s=!0)}}return s},lut=(t,e,i,r,s)=>{if(i===r)return!1;r=r||e0e;let n,o=(i=i||e0e).length,a=r.length,l=0,c=0,u=!1;for(;c<a;){let h=l<o?i[l]:void 0,p=r[c];if(h!==void 0&&Zce(h,p))u=kj(h,p,s)||u,l++;else{let f=rut(i,p,l+1);if(f>=0){for(n=l;n<f;n++)r0e(i[n]),XW(i,n,t,"removed");u=kj(i[f],p,s)||u,l=f+1}else zR(p,e,l<o?i[l].domNode:void 0,s),sut(p),XW(r,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)r0e(i[n]),XW(i,n,t,"removed");return u};kj=(t,e,i)=>{let r=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(o,r),e.domNode=o,s=!0,s}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=Xce(i,{namespace:a9})),t.text!==e.text&&(n=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,n=lut(e,r,t.children,e.children,i)||n,n=aut(r,t.properties,e.properties,i)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),s};let L$=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,kj(r,i,e)},domNode:t.domNode});const cut={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let kA=t=>Xce(cut,t),bw={create:(t,e)=>(e=kA(e),zR(t,document.createElement("div"),void 0,e),L$(t,e)),append:(t,e,i)=>(i=kA(i),zR(e,t,void 0,i),L$(e,i)),insertBefore:(t,e,i)=>(i=kA(i),zR(e,t.parentNode,t,i),L$(e,i)),merge:(t,e,i)=>(i=kA(i),e.domNode=t,Q3e(t,e,i),L$(e,i)),replace:(t,e,i)=>(i=kA(i),zR(e,t.parentNode,t,i),t.parentNode.removeChild(t),L$(e,i))},K3e,uut=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};K3e=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let hut=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?K3e(i.children,s=>s.domNode===r):void 0}),i},dut=(t,e,i)=>{let r=function(s){i("domEvent",s);let n=e(),o=uut(s.currentTarget,n.domNode);o.reverse();let a,l=hut(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},s0e=t=>{let e,i,r=kA(t),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(h,p,f)=>{let g,y=()=>g;r.eventHandlerInterceptor=dut(e,y,s),g=h(p,f(),r),a.push(g),l.push(f)},u=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let h=0;h<a.length;h++){let p=l[h]();s("rendered",void 0),a[h].update(p),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:u,scheduleRender:()=>{i||o||(i=requestAnimationFrame(u))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(h,p)=>{c(bw.append,h,p)},insertBefore:(h,p)=>{c(bw.insertBefore,h,p)},merge:(h,p)=>{c(bw.merge,h,p)},replace:(h,p)=>{c(bw.replace,h,p)},detach:h=>{for(let p=0;p<l.length;p++)if(l[p]===h)return l.splice(p,1),a.splice(p,1)[0];throw new Error("renderFunction was not found")}},e},_b=class extends Fe{constructor(){super(...arguments),this.items=new ct,this._watchUpdatingTracking=new Mv,this._callbacks=new Map,this._projector=s0e(),this._hiddenProjector=s0e()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const s=()=>r.render();this._callbacks.set(r,s),this._projector.append(this.surface,s)}for(const r of i.removed){const s=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(s.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);r.append(i,n),r.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s?.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(r.detach(n);i.firstChild;)i.removeChild(i.firstChild);return o}overlaps(e,i){const r=this.computeBoundingRect(e),s=this.computeBoundingRect(i);return Math.max(r.left,s.left)<=Math.min(r.right,s.right)&&Math.max(r.top,s.top)<=Math.min(r.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,i){const r=!!i?.disableDecorations;if(!this.items.some(n=>n.visible&&!(r&&n.isDecoration)))return;const s=e.getContext("2d");s.save(),s.font=this._fontString(),this.items.forEach(n=>{r&&n.isDecoration||(s.save(),n.renderCanvas(s),s.restore())}),s.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};d([m({readOnly:!0})],_b.prototype,"surface",void 0),d([m({readOnly:!0})],_b.prototype,"items",void 0),d([m({readOnly:!0})],_b.prototype,"needsRender",null),d([m({readOnly:!0})],_b.prototype,"_watchUpdatingTracking",void 0),d([m({readOnly:!0})],_b.prototype,"updating",null),_b=d([N("esri.views.overlay.ViewOverlay")],_b);const n0e=_b,ZW=[0,0];function put(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return ZW[0]=i.left+(e?.pageXOffset??0),ZW[1]=i.top+(e?.pageYOffset??0),ZW}function o0e(t){t&&(C$e(t),t.parentNode&&t.parentNode.removeChild(t))}function fut(t){const e=document.createElement("div");return t.appendChild(e),e}const D$=16,LU=750,mut=512,gut=2,yut=t=>{let e=class extends t{constructor(...i){super(...i),this._freqInfo={freq:D$,time:LU},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([_e(()=>this.cursor,r=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",r)}),_e(()=>this.navigating,r=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",r.toString())})])}initialize(){this.addHandles([_e(()=>this.ui,(i,r)=>this._handleUIChange(i,r),Ir),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Ge(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),s=Xq(i);if(s||typeof i!="string"||oe.getLogger(this).error("#container",`element with id '${i}' not found`),r===s)return;if(this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(o0e(this.root),this._set("root",null)),this.userContent&&(Mye(this.userContent,r),o0e(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",Mye(s,n),s.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new n0e;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(_e(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=xE({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=Zr(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n?n[0]:0,r-=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n?n[0]:0,r+=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){this.removeHandles("ui"),r&&r!==i&&r.destroy(),i&&(i.view=this,this.addHandles(_e(()=>this.root,s=>{i.container=s?fut(s):null},Ir),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=D$,i.time=LU,this.addHandles([Tv(window,"resize",()=>{i.freq=D$,i.time=LU}),xE({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=D$,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?D$:Math.min(LU,n.freq*gut),!s&&n.freq>=mut&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=i&&put(i);return!!s&&(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return d([m()],e.prototype,"container",null),d([m({readOnly:!0})],e.prototype,"focused",null),d([m({readOnly:!0})],e.prototype,"height",void 0),d([m()],e.prototype,"messagesCommon",void 0),d([m({type:n0e})],e.prototype,"overlay",void 0),d([m({readOnly:!0})],e.prototype,"position",void 0),d([m({readOnly:!0})],e.prototype,"resizing",void 0),d([m({readOnly:!0})],e.prototype,"root",void 0),d([m({value:null,readOnly:!0})],e.prototype,"size",null),d([m({readOnly:!0})],e.prototype,"surface",void 0),d([m({readOnly:!0})],e.prototype,"suspended",void 0),d([m()],e.prototype,"ui",void 0),d([m({readOnly:!0})],e.prototype,"userContent",void 0),d([m({readOnly:!0})],e.prototype,"width",void 0),d([m()],e.prototype,"widthBreakpoint",void 0),e=d([N("esri.views.DOMContainer")],e),e};function Dx(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function Xui(t,e,i,r,s){t.x=e,t.y=i,t.z=r,t.hasZ=r!=null,t.spatialReference=s}function wa(t,e,i,r,s){return!(e==null||r==null||t.length<2)&&(F$.x=t[0],F$.y=t[1],F$.z=t[2],F$.spatialReference=e,lc(F$,i,r,s))}const F$=Dx(0,0,0,Je.WGS84);function Fx(t,e,i){return!!wa(t,e,DU,i.spatialReference)&&(i.x=DU[0],i.y=DU[1],i.z=DU[2],!0)}async function eNe(t,e,i,r){return await kk(e,i.spatialReference,null,r),Fx(t,e,i)}const DU=M();function _ut(t){return Bs(t,UR)||pC(t)?{wkid:yh.GCSMARS2000}:Bs(t,BR)||fC(t)?{wkid:yh.GCSMOON2000}:Je.WGS84}var bs,Ya;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL",t[t.TILES3D=8]="TILES3D"})(bs||(bs={}));let vut=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Ya.ALL,this.normalRequired=!0}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Ya||(Ya={}));let but=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.triangleNr=r}},wut=class extends but{constructor(e,i,r,s){super(e,i,r),this.center=s!=null?Fn(s):null}},tNe=class{constructor(e){this.layerUid=e}},Vk=class extends tNe{constructor(e,i){super(e),this.graphicUid=i}};function _f(t){return t?.dist!=null}function a0e(t){return(e,i,r)=>(Br(l0e,e,i,r),!zce(t,l0e))}function l9(t){return _f(t)&&t.intersector===bs.OBJECT&&!!t.target}function c9(t){return _f(t)&&t.intersector===bs.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const l0e=M();function vf(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function xut(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Jce(t,e,i,r,s,n,o,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function u9(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function xC(t,e){if(t===e){const i=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Gk(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,p=-u*n+a*l,f=c*n-o*l;let g=i*h+r*p+s*f;return g?(g=1/g,t[0]=h*g,t[1]=(-u*r+s*c)*g,t[2]=(a*r-s*o)*g,t[3]=p*g,t[4]=(u*i-s*l)*g,t[5]=(-a*i+s*n)*g,t[6]=f*g,t[7]=(-c*i+r*l)*g,t[8]=(o*i-r*n)*g,t):null}function Sut(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=s*c-r*u,t[2]=r*a-s*o,t[3]=a*l-n*u,t[4]=i*u-s*l,t[5]=s*n-i*a,t[6]=n*c-o*l,t[7]=r*l-i*c,t[8]=i*o-r*n,t}function Tut(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function UO(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=i[0],f=i[1],g=i[2],y=i[3],v=i[4],b=i[5],w=i[6],x=i[7],S=i[8];return t[0]=p*r+f*o+g*c,t[1]=p*s+f*a+g*u,t[2]=p*n+f*l+g*h,t[3]=y*r+v*o+b*c,t[4]=y*s+v*a+b*u,t[5]=y*n+v*l+b*h,t[6]=w*r+x*o+S*c,t[7]=w*s+x*a+S*u,t[8]=w*n+x*l+S*h,t}function BO(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=i[0],f=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=p*r+f*o+c,t[7]=p*s+f*a+u,t[8]=p*n+f*l+h,t}function h9(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=Math.sin(i),f=Math.cos(i);return t[0]=f*r+p*o,t[1]=f*s+p*a,t[2]=f*n+p*l,t[3]=f*o-p*r,t[4]=f*a-p*s,t[5]=f*l-p*n,t[6]=c,t[7]=u,t[8]=h,t}function jk(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function Eut(t,e,i){const r=i[0],s=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function Cut(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Mut(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Aut(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Rut(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function xF(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,u=r*o,h=r*a,p=s*o,f=s*a,g=s*l,y=n*o,v=n*a,b=n*l;return t[0]=1-h-g,t[3]=u-b,t[6]=p+v,t[1]=u+b,t[4]=1-c-g,t[7]=f-y,t[2]=p-v,t[5]=f+y,t[8]=1-c-h,t}function iNe(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10],h=u*o-a*c,p=-u*n+a*l,f=c*n-o*l,g=i*h+r*p+s*f;if(!g)return null;const y=1/g;return t[0]=h*y,t[1]=(-u*r+s*c)*y,t[2]=(a*r-s*o)*y,t[3]=p*y,t[4]=(u*i-s*l)*y,t[5]=(-a*i+s*n)*y,t[6]=f*y,t[7]=(-c*i+r*l)*y,t[8]=(o*i-r*n)*y,t}function lx(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],y=e[13],v=e[14],b=e[15],w=i*a-r*o,x=i*l-s*o,S=i*c-n*o,E=r*l-s*a,C=r*c-n*a,R=s*c-n*l,I=u*y-h*g,F=u*v-p*g,D=u*b-f*g,z=h*v-p*y,B=h*b-f*y,Y=p*b-f*v;let W=w*Y-x*B+S*z+E*D-C*F+R*I;return W?(W=1/W,t[0]=(a*Y-l*B+c*z)*W,t[1]=(l*D-o*Y-c*F)*W,t[2]=(o*B-a*D+c*I)*W,t[3]=(s*B-r*Y-n*z)*W,t[4]=(i*Y-s*D+n*F)*W,t[5]=(r*D-i*B-n*I)*W,t[6]=(y*R-v*C+b*E)*W,t[7]=(v*S-g*R-b*x)*W,t[8]=(g*C-y*S+b*w)*W,t):null}function Put(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Out(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Iut(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function $ut(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function rNe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function Nut(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function Lut(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function Dut(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Fut(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=e[0],p=e[1],f=e[2],g=e[3],y=e[4],v=e[5],b=e[6],w=e[7],x=e[8],S=ba();return Math.abs(i-h)<=S*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-p)<=S*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(s-f)<=S*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(n-g)<=S*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-y)<=S*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-b)<=S*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-w)<=S*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(u-x)<=S*Math.max(1,Math.abs(u),Math.abs(x))}function kut(t){const e=ba(),i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}const Uut=UO,But=rNe;Object.freeze(Object.defineProperty({__proto__:null,add:$ut,adjoint:Sut,copy:xut,determinant:Tut,equals:Fut,exactEquals:Dut,frob:Iut,fromMat2d:Rut,fromMat4:vf,fromQuat:xF,fromRotation:Mut,fromScaling:Aut,fromTranslation:Cut,identity:u9,invert:Gk,isOrthoNormal:kut,mul:Uut,multiply:UO,multiplyScalar:Nut,multiplyScalarAndAdd:Lut,normalFromMat4:lx,normalFromMat4Legacy:iNe,projection:Put,rotate:h9,scale:jk,scaleByVec2:Eut,set:Jce,str:Out,sub:But,subtract:rNe,translate:BO,transpose:xC},Symbol.toStringTag,{value:"Module"}));function zut(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Uj(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function d9(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>ba()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function p9(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*u+o*a+s*c-n*l,t[1]=s*u+o*l+n*a-r*c,t[2]=n*u+o*c+r*l-s*a,t[3]=o*u-r*a-s*l-n*c,t}function Vut(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-r*a,t}function Gut(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-n*a,t[1]=s*l+o*a,t[2]=n*l+r*a,t[3]=o*l-s*a,t}function jut(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=s*l-r*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function Hut(t,e){const i=e[0],r=e[1],s=e[2];return t[0]=i,t[1]=r,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),t}function RV(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,u,h,p,f=i[0],g=i[1],y=i[2],v=i[3];return c=s*f+n*g+o*y+a*v,c<0&&(c=-c,f=-f,g=-g,y=-y,v=-v),1-c>ba()?(l=Math.acos(c),u=Math.sin(l),h=Math.sin((1-r)*l)/u,p=Math.sin(r*l)/u):(h=1-r,p=r),t[0]=h*s+p*f,t[1]=h*n+p*g,t[2]=h*o+p*y,t[3]=h*a+p*v,t}function qut(t){const e=Ok,i=e(),r=e(),s=e(),n=Math.sqrt(1-i),o=Math.sqrt(i);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function Wut(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-s*a,t[3]=n*a,t}function Lw(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function sNe(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*r,r=.5/r,t[3]=(e[3*n+o]-e[3*o+n])*r,t[n]=(e[3*n+s]+e[3*s+n])*r,t[o]=(e[3*o+s]+e[3*s+o])*r}return t}function Yut(t,e,i,r){const s=.5*Math.PI/180;e*=s,i*=s,r*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),u=Math.cos(r);return t[0]=n*l*u-o*a*c,t[1]=o*a*u+n*l*c,t[2]=o*l*c-n*a*u,t[3]=o*l*u+n*a*c,t}function Xut(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const Zut=Kp,nNe=Ds,Jut=Ice,Qut=p9,Kut=UE,eht=r3e,tht=Qq,oNe=$ce,iht=oNe,aNe=Nce,rht=aNe,Qce=i3e,sht=RP,nht=BE;function oht(t,e,i){const r=xe(e,i);return r<-.999999?(yt(Pg,aht,e),$c(Pg)<1e-6&&yt(Pg,lht,e),Se(Pg,Pg),Uj(t,Pg,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(yt(Pg,e,i),t[0]=Pg[0],t[1]=Pg[1],t[2]=Pg[2],t[3]=1+r,Qce(t,t))}const Pg=M(),aht=Be(1,0,0),lht=Be(0,1,0);function cht(t,e,i,r,s,n){return RV(c0e,e,s,n),RV(u0e,i,r,n),RV(t,c0e,u0e,2*n*(1-n)),t}const c0e=Qd(),u0e=Qd();function uht(t,e,i,r){const s=hht;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],Qce(t,sNe(t,s))}const hht=ps();Object.freeze(Object.defineProperty({__proto__:null,add:Jut,calculateW:Hut,conjugate:Lw,copy:Zut,dot:eht,equals:nht,exactEquals:sht,fromEuler:Yut,fromMat3:sNe,getAxisAngle:d9,identity:zut,invert:Wut,len:iht,length:oNe,lerp:tht,mul:Qut,multiply:p9,normalize:Qce,random:qut,rotateX:Vut,rotateY:Gut,rotateZ:jut,rotationTo:oht,scale:Kut,set:nNe,setAxes:uht,setAxisAngle:Uj,slerp:RV,sqlerp:cht,sqrLen:rht,squaredLength:aNe,str:Xut},Symbol.toStringTag,{value:"Module"}));function lNe(t,e,i){const r=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function dht(t,e,i){return lNe(t,e,i),Rh(i,i),i}function Bd(t,e,i,r){if(t==null||r==null)return!1;const s=xj(t,Bst),n=xj(r,zst);if(s===n&&!h0e(n)&&(s!==le.UNKNOWN||Bs(t,r)))return mC(i,e),!0;if(h0e(n)){const o=K3[s][le.LON_LAT],a=K3[le.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,A1,0),a(A1,0,R1,0),lNe(FU*A1[0],FU*A1[1],i),i[12]=R1[0],i[13]=R1[1],i[14]=R1[2],!0)}if(!(n!==le.WEB_MERCATOR&&n!==le.PLATE_CARREE&&n!==le.WGS84&&n!==le.CGCS2000||s!==le.WGS84&&s!==le.SPHERICAL_ECEF&&s!==le.WEB_MERCATOR&&s!==le.CGCS2000)){const o=K3[s][le.LON_LAT],a=K3[le.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,A1,0),a(A1,0,R1,0),s===le.SPHERICAL_ECEF?dht(FU*A1[0],FU*A1[1],i):df(i),i[12]=R1[0],i[13]=R1[1],i[14]=R1[2],!0)}return!1}function h0e(t){return t===le.SPHERICAL_ECEF||t===le.SPHERICAL_MARS_PCPF||t===le.SPHERICAL_MOON_PCPF}const FU=Gt(1),A1=M(),R1=M();let Hk=class{constructor(e,i,r=i){this.data=e,this.size=i,this.stride=r}},dt=class extends Hk{constructor(e,i,r,s=!1,n=r){super(e,r,n),this.indices=i,this.exclusive=s}};const zO=1e-6,k$=M(),kU=M();function pht(t,e){const{data:i,size:r}=t,s=i.length/r;if(s<=0)return;const n=new Sht(t);ste(k$,n.minProj,n.maxProj),hN(k$,k$,.5),jp(kU,n.maxProj,n.minProj);const o=rte(kU),a=new Tht;a.quality=o,s<14&&(t=new Hk(new Float64Array(n.buffer,112,42),3));const l=M(),c=M(),u=M(),h=M(),p=M(),f=M(),g=M();switch(fht(n,t,g,l,c,u,h,p,f,a)){case 1:return void m0e(k$,kU,e);case 2:return void wht(t,h,e)}mht(t,g,l,c,u,h,p,f,a),cNe(t,a.b0,a.b1,a.b2,OP,IP);const y=M();jp(y,IP,OP),a.quality=rte(y),a.quality<o?uNe(a.b0,a.b1,a.b2,OP,IP,y,e):m0e(k$,kU,e)}function fht(t,e,i,r,s,n,o,a,l,c){return ght(t,r,s),nte(r,s)<zO?1:(jp(o,r,s),cl(o,o),yht(e,r,o,n)<zO?2:(jp(a,s,n),cl(a,a),jp(l,n,r),cl(l,l),Hp(i,a,o),cl(i,i),dT(e,i,o,a,l,c),0))}const U$=M(),B$=M(),ip=M(),rp=M(),sp=M(),P1=M(),O1=M(),I1=M();function mht(t,e,i,r,s,n,o,a,l){_ht(t,e,i,U$,B$),U$[0]!==void 0&&(jp(ip,U$,i),cl(ip,ip),jp(rp,U$,r),cl(rp,rp),jp(sp,U$,s),cl(sp,sp),Hp(P1,rp,n),cl(P1,P1),Hp(O1,sp,o),cl(O1,O1),Hp(I1,ip,a),cl(I1,I1),dT(t,P1,n,rp,ip,l),dT(t,O1,o,sp,rp,l),dT(t,I1,a,ip,sp,l)),B$[0]!==void 0&&(jp(ip,B$,i),cl(ip,ip),jp(rp,B$,r),cl(rp,rp),jp(sp,B$,s),cl(sp,sp),Hp(P1,rp,n),cl(P1,P1),Hp(O1,sp,o),cl(O1,O1),Hp(I1,ip,a),cl(I1,I1),dT(t,P1,n,rp,ip,l),dT(t,O1,o,sp,rp,l),dT(t,I1,a,ip,sp,l))}function ght(t,e,i){let r=nte(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=nte(t.maxVert[n],t.minVert[n]);o>r&&(r=o,s=n)}Od(e,t.minVert[s]),Od(i,t.maxVert[s])}const np=[0,0,0];function yht(t,e,i,r){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){np[0]=s[l]-e[0],np[1]=s[l+1]-e[1],np[2]=s[l+2]-e[2];const c=i[0]*np[0]+i[1]*np[1]+i[2]*np[2],u=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],h=np[0]*np[0]+np[1]*np[1]+np[2]*np[2]-c*c/u;h>o&&(o=h,a=l)}return Od(r,s,a),o}const Bo=vt();function _ht(t,e,i,r,s){bht(t,e,Bo,s,r);const n=dNe(i,e);Bo[1]-zO<=n&&(r[0]=void 0),Bo[0]+zO>=n&&(s[0]=void 0)}const d0e=M(),p0e=M(),f0e=M(),iM=M(),rM=M(),UU=M();function dT(t,e,i,r,s,n){if(hNe(e)<zO)return;Hp(d0e,i,e),Hp(p0e,r,e),Hp(f0e,s,e),PP(t,e,Bo),rM[1]=Bo[0],iM[1]=Bo[1],UU[1]=iM[1]-rM[1];const o=[i,r,s],a=[d0e,p0e,f0e];for(let l=0;l<3;++l){PP(t,o[l],Bo),rM[0]=Bo[0],iM[0]=Bo[1],PP(t,a[l],Bo),rM[2]=Bo[0],iM[2]=Bo[1],UU[0]=iM[0]-rM[0],UU[2]=iM[2]-rM[2];const c=rte(UU);c<n.quality&&(Od(n.b0,o[l]),Od(n.b1,e),Od(n.b2,a[l]),n.quality=c)}}const vht=M();function PP(t,e,i){const{data:r,size:s}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*e[0]+r[n+1]*e[1]+r[n+2]*e[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function bht(t,e,i,r,s){const{data:n,size:o}=t;Od(r,n),Od(s,r),i[0]=dNe(vht,e),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<i[0]&&(i[0]=l,Od(r,n,a)),l>i[1]&&(i[1]=l,Od(s,n,a))}}function m0e(t,e,i){i.center=t,i.halfSize=ce(e,e,.5),i.quaternion=Ace}const J0=M(),sM=M(),z$=M(),OP=M(),IP=M(),g0e=M();function wht(t,e,i){Od(J0,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?J0[0]=0:Math.abs(e[1])>Math.abs(e[2])?J0[1]=0:J0[2]=0,hNe(J0)<zO&&(J0[0]=J0[1]=J0[2]=1),Hp(sM,e,J0),cl(sM,sM),Hp(z$,e,sM),cl(z$,z$),cNe(t,e,sM,z$,OP,IP),jp(g0e,IP,OP),uNe(e,sM,z$,OP,IP,g0e,i)}function cNe(t,e,i,r,s,n){PP(t,e,Bo),s[0]=Bo[0],n[0]=Bo[1],PP(t,i,Bo),s[1]=Bo[0],n[1]=Bo[1],PP(t,r,Bo),s[2]=Bo[0],n[2]=Bo[1]}const dS=M(),V$=M(),BU=M(),Og=aD(1,0,0,0,1,0,0,0,1),xht=Qd();function uNe(t,e,i,r,s,n,o){Og[0]=t[0],Og[1]=t[1],Og[2]=t[2],Og[3]=e[0],Og[4]=e[1],Og[5]=e[2],Og[6]=i[0],Og[7]=i[1],Og[8]=i[2],o.quaternion=Eht(xht,Og),ste(dS,r,s),hN(dS,dS,.5),hN(V$,t,dS[0]),hN(BU,e,dS[1]),ste(V$,V$,BU),hN(BU,i,dS[2]),o.center=Te(V$,V$,BU),o.halfSize=ce(dS,n,.5)}const Fh=7;let Sht=class{constructor(e){this.minVert=new Array(Fh),this.maxVert=new Array(Fh);const i=64*Fh;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,Fh),r+=8*Fh,this.maxProj=new Float64Array(this.buffer,r,Fh),r+=8*Fh;for(let l=0;l<Fh;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Fh;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Fh;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Fh),n=new Array(Fh),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Fh;++l){let c=s[l];Od(this.minVert[l],o,c),c=n[l],Od(this.maxVert[l],o,c)}}},Tht=class{constructor(){this.b0=Be(1,0,0),this.b1=Be(0,1,0),this.b2=Be(0,0,1),this.quality=0}};function rte(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function ste(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function jp(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function hN(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function Od(t,e,i=0){t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2]}function Hp(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o}function cl(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function hNe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function nte(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function dNe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Eht(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*n+n]+1);t[r]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+r]+e[3*r+s])*o,t[n]=(e[3*n+r]+e[3*r+n])*o}return t}let pNe=class PV{constructor(e=co,i=Lht,r=Ace){this._data=[e[0],e[1],e[2],i[0],i[1],i[2],r[0],r[1],r[2],r[3]]}clone(){const e=new PV;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const i=new PV;return i._data=e.slice(),i}static fromJSON(e){return new PV(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return ue(tt.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,i,r){this._data[0]=e,this._data[1]=i,this._data[2]=r}get halfSize(){return ue(tt.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return nNe(vat.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const i=$s,r=this._data;i[0]=r[6],i[1]=r[7],i[2]=r[8],i[3]=r[9];for(let s=0;s<8;++s){const n=e[s];n[0]=(1&s?-1:1)*r[3],n[1]=(2&s?-1:1)*r[4],n[2]=(4&s?-1:1)*r[5],oh(n,n,i),n[0]+=r[0],n[1]+=r[1],n[2]+=r[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],i=this._data[4],r=this._data[5];return Math.sqrt(e*e+i*i+r*r)}intersectSphere(e){Mi[0]=this._data[0]-e[0],Mi[1]=this._data[1]-e[1],Mi[2]=this._data[2]-e[2];const i=this.getQuaternion(hv);return Lw($s,i),oh(Mi,Mi,$s),wO(Mi,Mi),Q0[0]=Math.min(Mi[0],this._data[3]),Q0[1]=Math.min(Mi[1],this._data[4]),Q0[2]=Math.min(Mi[2],this._data[5]),lF(Q0,Mi)<e[3]*e[3]}intersectSphereWithMBS(e,i=this.radius){const r=this._data;Mi[0]=r[0]-e[0],Mi[1]=r[1]-e[1],Mi[2]=r[2]-e[2];const s=e[3],n=s+i;return!(uj(Mi)>n*n)&&($s[0]=-r[6],$s[1]=-r[7],$s[2]=-r[8],$s[3]=r[9],oh(Mi,Mi,$s),wO(Mi,Mi),Q0[0]=Math.min(Mi[0],r[3]),Q0[1]=Math.min(Mi[1],r[4]),Q0[2]=Math.min(Mi[2],r[5]),lF(Q0,Mi)<s*s)}intersectPlane(e){const i=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius(e);return i>r?1:i<-r?-1:0}intersectRay(e,i,r=0){const s=this._data,n=$s;n[0]=-s[6],n[1]=-s[7],n[2]=-s[8],n[3]=s[9],Mi[0]=e[0]-s[0],Mi[1]=e[1]-s[1],Mi[2]=e[2]-s[2];const o=oh(Mi,Mi,$s),a=oh(Q0,i,$s);let l=-1/0,c=1/0;const u=this.getHalfSize($P);for(let h=0;h<3;h++){const p=o[h],f=a[h],g=u[h]+r;if(Math.abs(f)>1e-6){const y=(g-p)/f,v=(-g-p)/f;l=Math.max(l,Math.min(y,v)),c=Math.min(c,Math.max(y,v))}else if(p>g||p<-g)return!1}return l<=c}projectedArea(e,i,r,s){const n=this.getQuaternion(hv);Lw($s,n),Mi[0]=e[0]-this._data[0],Mi[1]=e[1]-this._data[1],Mi[2]=e[2]-this._data[2],oh(Mi,Mi,$s);const o=this.getHalfSize($P),a=Mi[0]<-o[0]?-1:Mi[0]>o[0]?1:0,l=Mi[1]<-o[1]?-1:Mi[1]>o[1]?1:0,c=Mi[2]<-o[2]?-1:Mi[2]>o[2]?1:0,u=Math.abs(a)+Math.abs(l)+Math.abs(c);if(u===0)return 1/0;const h=u===1?4:6,p=6*(a+3*l+9*c+13);xF(UA,n),jk(UA,UA,o);const f=this.getCenter(Fm);for(let v=0;v<h;v++){const b=Aht[p+v];ue(Mi,((1&b)<<1)-1,(2&b)-1,((4&b)>>1)-1),Ga(Mi,Mi,UA),Te(pS,f,Mi),pS[3]=1,xh(pS,pS,i);const w=1/Math.max(1e-6,pS[3]);$f[2*v]=pS[0]*w,$f[2*v+1]=pS[1]*w}const g=2*h-2;let y=$f[0]*($f[3]-$f[g+1])+$f[g]*($f[1]-$f[g-1]);for(let v=2;v<g;v+=2)y+=$f[v]*($f[v+3]-$f[v-1]);return Math.abs(y)*r*s*.125}projectedRadius(e){const i=this.getQuaternion(hv);return Lw($s,i),oh(Mi,e,$s),Math.abs(Mi[0]*this._data[3])+Math.abs(Mi[1]*this._data[4])+Math.abs(Mi[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(e)}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(e)}toAaBoundingBox(e){const i=this.getQuaternion(hv),r=xF(UA,i),s=this._data[3]*Math.abs(r[0])+this._data[4]*Math.abs(r[3])+this._data[5]*Math.abs(r[6]),n=this._data[3]*Math.abs(r[1])+this._data[4]*Math.abs(r[4])+this._data[5]*Math.abs(r[7]),o=this._data[3]*Math.abs(r[2])+this._data[4]*Math.abs(r[5])+this._data[5]*Math.abs(r[8]);e[0]=this._data[0]-s,e[1]=this._data[1]-n,e[2]=this._data[2]-o,e[3]=this._data[0]+s,e[4]=this._data[1]+n,e[5]=this._data[2]+o}transform(e,i,r,s=0,n=Xd(r),o=Xd(i),a=rx(i,o)){if(r===n)i.isGeographic?Iht(this,e,i,s,o):Oht(this,e,i,s,o,a);else if(i.isWGS84&&(r.isWebMercator||CE(r)))Rht(i,this,r,e,s);else if(i.isWebMercator&&CE(r))Pht(i,this,r,e,s);else{const l=this.getCenter(Fm);l[2]+=s,Ts(l,i,0,l,r,0,1),e.center=l,this!==e&&(e.quaternion=this.getQuaternion(hv),e.halfSize=this.getHalfSize($P))}}};const $s=Qd(),hv=Qd(),Cht=Qd(),Mi=M(),Q0=M(),pS=pi();function Mht(t,e=new pNe){return pht(t,e),e}const $f=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],Aht=(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function fNe(t,e,i,r,s){const n=t.getQuaternion(hv);s.quaternion=n,Lw($s,n);const o=t.getCenter(Fm),a=t.getHalfSize($P);if(r===Xe.Global){oh(cs,o,$s),wO(_m,cs),xPe(Uh,_m,a),Vi(Uh,_m,Uh);const l=De(Uh);Te(Uh,_m,a);const c=De(Uh);if(l<i)s.center=o,ue(cs,i,i,i),s.halfSize=Te(cs,a,cs);else{const u=c>0?1+e/c:1,h=l>0?1+i/l:1,p=(h+u)/2,f=(h-u)/2;ce(Uh,_m,f),s.halfSize=ao(Uh,Uh,a,p),ce(Uh,_m,p),ao(Uh,Uh,a,f),wPe(cs,cs),Tq(cs,Uh,cs);const g=t.getQuaternion(Cht);s.center=oh(cs,cs,g)}}else{s.center=ao(cs,o,bO,(i+e)/2);const l=oh(cs,bO,$s);wO(l,l),s.halfSize=ao(_m,a,l,(i-e)/2)}return s}function Rht(t,e,i,r,s){e.getCenter(Fm),Fm[2]+=s;const n=Xd(i);Ts(Fm,t,0,Fm,n,0,1),mNe(n,e,Fm,i,r)}function Pht(t,e,i,r,s){e.getCenter(Fm),Fm[2]+=s,mNe(t,e,Fm,i,r)}function mNe(t,e,i,r,s){const n=e.getQuaternion(hv),o=xF(UA,n),a=e.getHalfSize($P);for(let l=0;l<8;++l){for(let c=0;c<3;++c)ky[c]=a[c]*(l&1<<c?-1:1);for(let c=0;c<3;++c){let u=i[c];for(let h=0;h<3;++h)u+=ky[h]*o[3*h+c];OV[3*l+c]=u}}Ts(OV,t,0,OV,r,0,8),Mht($ht,s)}function Oht(t,e,i,r,s=Xd(i),n=rx(i,s)){t.getCorners(y0e),t.getCenter(ky),ky[2]+=r,Bd(i,ky,kh,s),e.setCenter(kh[12],kh[13],kh[14]);const o=2*Math.sqrt(1+kh[0]+kh[5]+kh[10]);$s[0]=(kh[6]-kh[9])/o,$s[1]=(kh[8]-kh[2])/o,$s[2]=(kh[1]-kh[4])/o,$s[3]=.25*o;const a=t.getQuaternion(hv);e.quaternion=p9($s,$s,a),Lw($s,$s),ue(_m,0,0,0);const l=e.getCenter(Nht);for(const c of y0e)c[2]+=r,n(c,0,c,0),Vi(cs,c,l),oh(cs,cs,$s),wO(cs,cs),SPe(_m,_m,cs);e.halfSize=_m}function Iht(t,e,i,r,s=Xd(i)){const n=$r(i),o=1+Math.max(0,r)/(n.radius+t.centerZ);t.getCenter(ky),ky[2]+=r,Ts(ky,i,0,ky,s,0,1),e.center=ky;const a=t.getQuaternion(hv);e.quaternion=a,Lw($s,a),ue(cs,0,0,1),oh(cs,cs,$s);const l=t.getHalfSize($P);ue(cs,l[0]*Math.abs(cs[0]),l[1]*Math.abs(cs[1]),l[2]*Math.abs(cs[2])),ce(cs,cs,n.inverseFlattening),Te(cs,l,cs),e.halfSize=ce(cs,cs,o)}const OV=new Array(24),$ht=new Hk(OV,3),ky=M(),Fm=M(),Nht=M(),$P=M(),UA=ps(),kh=Ne(),y0e=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],cs=M(),_m=M(),Uh=M(),Lht=Be(-1,-1,-1);let Dht=class{constructor(){this._transform=Ne(),this._transformInverse=new zU({value:this._transform},Ao,Ne),this._transformInverseTranspose=new zU(this._transformInverse,Rh,Ne),this._transformTranspose=new zU({value:this._transform},Rh,Ne),this._transformInverseRotation=new zU({value:this._transform},iNe,ps)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Xn(this._transform,e)}multiplyTransform(e){Or(this._transform,this._transform,e)}set(e){Xn(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},zU=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},Fht=class{constructor(e=0){this.offset=e,this.tmpVertex=M()}applyToVertex(e,i,r){const s=ue(Kce,e,i,r),n=Te(gNe,s,this.localOrigin),o=this.offset/De(n);return ao(this.tmpVertex,s,n,o),this.tmpVertex}applyToAabb(e){const i=zht,r=Vht,s=Ght;for(let l=0;l<3;++l)i[l]=e[0+l]+this.localOrigin[l],r[l]=e[3+l]+this.localOrigin[l],s[l]=i[l];const n=this.applyToVertex(i[0],i[1],i[2]);for(let l=0;l<3;++l)e[l]=n[l],e[l+3]=n[l];const o=l=>{const c=this.applyToVertex(l[0],l[1],l[2]);for(let u=0;u<3;++u)e[u]=Math.min(e[u],c[u]),e[u+3]=Math.max(e[u+3],c[u])};for(let l=1;l<8;++l){for(let c=0;c<3;++c)s[c]=l&1<<c?r[c]:i[c];o(s)}let a=0;for(let l=0;l<3;++l)i[l]*r[l]<0&&(a|=1<<l);if(a!==0&&a!==7){for(let l=0;l<8;++l)if(!(a&l)){for(let c=0;c<3;++c)s[c]=a&1<<c?0:l&1<<c?i[c]:r[c];o(s)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},kht=class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=M(),this._tmpMbs=Bn(),this._tmpObb=new pNe,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=De(e)}applyToVertex(e,i,r){const s=ue(Kce,e,i,r),n=ue(gNe,e,i,r+this.componentLocalOriginLength),o=this._totalOffset/De(n);return ao(this._tmpVertex,s,n,o),this._tmpVertex}applyToAabb(e){const i=this.componentLocalOriginLength,r=e[0],s=e[1],n=e[2]+i,o=e[3],a=e[4],l=e[5]+i,c=Math.abs(r),u=Math.abs(s),h=Math.abs(n),p=Math.abs(o),f=Math.abs(a),g=Math.abs(l),y=.5*(1+Math.sign(r*o))*Math.min(c,p),v=.5*(1+Math.sign(s*a))*Math.min(u,f),b=.5*(1+Math.sign(n*l))*Math.min(h,g),w=Math.max(c,p),x=Math.max(u,f),S=Math.max(h,g),E=Math.sqrt(y*y+v*v+b*b),C=Math.sign(c+r),R=Math.sign(u+s),I=Math.sign(h+n),F=Math.sign(p+o),D=Math.sign(f+a),z=Math.sign(g+l),B=this._totalOffset;if(E<B)return e[0]-=(1-C)*B,e[1]-=(1-R)*B,e[2]-=(1-I)*B,e[3]+=F*B,e[4]+=D*B,e[5]+=z*B,e;const Y=B/Math.sqrt(w*w+x*x+S*S),W=B/E,J=W-Y,me=-J;return e[0]+=r*(C*me+W),e[1]+=s*(R*me+W),e[2]+=n*(I*me+W),e[3]+=o*(F*J+Y),e[4]+=a*(D*J+Y),e[5]+=l*(z*J+Y),e}applyToMbs(e){const i=De(e),r=this._totalOffset/i;return ao(this._tmpMbs,e,e,r),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/i,this._tmpMbs}applyToObb(e){return fNe(e,this._totalOffset,this._totalOffset,Xe.Global,this._tmpObb),this._tmpObb}},Uht=class{constructor(e=0){this.offset=e,this.sphere=Bn(),this.tmpVertex=M()}applyToVertex(e,i,r){const s=this.objectTransform.transform,n=ue(Kce,e,i,r),o=nt(n,n,s),a=this.offset/De(o);ao(o,o,o,a);const l=this.objectTransform.inverse;return nt(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,i){const r=this.offset/De(e);ao(e,e,e,r);const s=this.offset/De(i);ao(i,i,i,s)}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=De(e),r=this.offset/i;return ao(this.sphere,e,e,r),this.sphere[3]=e[3]+e[3]*this.offset/i,this.sphere}};const _0e=new Uht;function ote(t){return t!=null?(_0e.offset=t,_0e):null}const v0e=new kht;function b0e(t){return t!=null?(v0e.offset=t,v0e):null}const w0e=new Fht;function Bht(t){return t!=null?(w0e.offset=t,w0e):null}const cx="terrain",Kce=M(),gNe=M(),zht=M(),Vht=M(),Ght=M(),VO=1e-5;let jht=class{constructor(e){this.options=new vut,this._results=new Hht,this.transform=new Dht,this.tolerance=VO,this.verticalOffset=null,this._ray=jo(),this._rayEnd=M(),this._rayBeginTransformed=M(),this._rayEndTransformed=M(),this.viewingMode=e??Xe.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay(l3e(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&$j(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Xe.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Te(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r??VO;const o=ote(this.verticalOffset);if(e&&e.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator?.();c!=null?(o!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(u=>a(u))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.effectiveTransformation,s=ote(this.verticalOffset);for(const n of i){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(r,n.transformation),nt(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),nt(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,h,p,f,g)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const y=p?this._results.hud:this._results,v=p?b=>{const w=new wut(e,a,h,g);b.set(bs.HUD,w,c,u,us,f)}:b=>b.set(bs.OBJECT,{object:e,geometryId:a,triangleNr:h},c,u,l,f);if((y.min.drapedLayerOrder==null||f>=y.min.drapedLayerOrder)&&(y.min.dist==null||c<y.min.dist)&&v(y.min),this.options.store!==Ya.MIN&&(y.max.drapedLayerOrder==null||f<y.max.drapedLayerOrder)&&(y.max.dist==null||c>y.max.dist)&&v(y.max),this.options.store===Ya.ALL)if(p){const b=new ate(this._ray);v(b),this._results.hud.all.push(b)}else{const b=new NP(this._ray);v(b),this._results.all.push(b)}}})}}sortResults(e=this._results.all){e.sort((i,r)=>i.dist!==r.dist?(i.dist??0)-(r.dist??0):i.drapedLayerOrder!==r.drapedLayerOrder?x0e(i.drapedLayerOrder,r.drapedLayerOrder):x0e(i.drapedLayerGraphicOrder,r.drapedLayerGraphicOrder))}};function x0e(t,e){return(e??-Number.MAX_VALUE)-(t??-Number.MAX_VALUE)}function pf(t){return new jht(t)}let Hht=class{constructor(){this.min=new NP(jo()),this.max=new NP(jo()),this.hud={min:new ate(jo()),max:new ate(jo()),all:new Array},this.ground=new NP(jo()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},NP=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(ce(VU,this.ray.direction,this.dist),De(VU)):null}getIntersectionPoint(e){return!!_f(this)&&(ce(VU,this.ray.direction,this.dist),Te(e,this.ray.origin,VU),!0)}getTransformedNormal(e){return ge(G$,this.normal),G$[3]=0,xh(G$,G$,this.transformation),ge(e,G$),Se(e,e)}constructor(e){this.intersector=bs.OBJECT,this.normal=M(),this.transformation=Ne(),this._ray=jo(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=bs.OBJECT,$j(e,this._ray)}set(e,i,r,s,n,o,a){this.intersector=e,this.dist=r,ge(this.normal,s??bO),Xn(this.transformation,n??us),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){$j(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ge(this.normal,e.normal),Xn(this.transformation,e.transformation)}},ate=class extends NP{constructor(){super(...arguments),this.intersector=bs.HUD}};function eue(t){return new NP(t)}const VU=M(),G$=pi();function yNe(t,e,i,r){return t.renderCoordsHelper.fromRenderCoords(e.eye,Bj,r)!=null&&cOe(i,Bj)}function f9(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function SC(t,e,i,r){const s=t.state.camera.clone();e&&i&&r&&(s.eye=e,s.center=i,s.up=r),qht(t,s.ray,$1)||ge($1,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(Xo(s.eye,$1)<o){const a=n.collision.enabled;ge(fS,s.viewForward),ce(fS,fS,o),a?s.eye=Me(Bj,$1,fS):Te($1,s.eye,fS);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),u=n.collision.elevationMargin;a&&c<u&&(Me(fS,$1,s.eye),s.eye=l.setAltitude(Bj,u,s.eye),Te($1,s.eye,fS))}return s.center=$1,s}function S0e(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=f9(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,i,t.renderDataExtent,r,Yht),o=n*n;return Xo(e,i)>o}function qht(t,e,i){let r=T0e[t.viewingMode];r||(r=pf(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,T0e[t.viewingMode]=r);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||S0e(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||S0e(t,e.origin,i))||!!s&&Wht(e,i,$r(t.spatialReference).radius)}function Wht(t,e,i){const r=xe(t.origin,t.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return ce(e,t.direction,s/De(t.direction)),Te(e,e,t.origin),!0}const T0e={},Bj=M(),$1=M(),fS=M(),Yht={near:0,far:0},Xht=M(),GU=M();function tue(){return{direction:M(),up:M()}}function _Ne(t,e,i,r,s){let n=Se(Xht,t),o=xe(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(xe(e,r)),o<.99?(ge(n,e),a&&ce(n,n,-1)):n=null);let l=0;if(n){ce(GU,r,xe(r,n)),Me(n,n,GU);const u=xe(n,s)/(De(n)*De(s));yt(GU,n,s),l=(xe(GU,r)>0?1:-1)*El(Jo(u))}const c=El(Jo(-xe(r,t)/De(t)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const vNe=Be(0,1,0),bNe=Be(0,0,1),j$=Ne(),K0=M(),e_=M();function wNe(t,e,i,r=tue()){const{direction:s,up:n}=r;return LPe(j$,-Gt(e)),TO(j$,j$,Gt(i)),nt(s,bNe,j$),ce(s,s,-1),nt(n,vNe,j$),r}function Zht(t,e,i,r){return _Ne(e,i,r,bNe,vNe)}function Jht(t,e,i,r){const s=wNe(t,i,r),n=M();return ce(n,s.direction,-e),Te(n,n,t),{up:s.up,eye:n,heading:i,tilt:r}}function Qht(t){return El(t)}function Kht(t){return Gt(t)}function xNe(t,e,i,r,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return lc(e,K0,n),lc(e,e_,n),K0[0]-=i/2,e_[0]+=i/2,K0[1]-=r/2,e_[1]+=r/2,wa(K0,n,K0,o),wa(e_,n,e_,o),s?(s.xmin=K0[0],s.ymin=K0[1],s.xmax=e_[0],s.ymax=e_[1],s.spatialReference=o):s=new lr(K0[0],K0[1],e_[0],e_[1],o),s}const edt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Zht,eyeForCenterWithHeadingTilt:Jht,eyeTiltToLookAtTilt:Kht,headingTiltToDirectionUp:wNe,lookAtTiltToEyeTilt:Qht,toExtent:xNe},Symbol.toStringTag,{value:"Module"}));function E0e(t,e,i){if(e.longitude==null||e.latitude==null||i.longitude==null||i.latitude==null)throw new Error("Invalid points: no lon/lat");return tdt(t,e.longitude,e.latitude,i.longitude,i.latitude)}function tdt(t,e,i,r,s){const n=Gt(i),o=Gt(s),a=n-o,l=Gt(e)-Gt(r),c=Math.sin(a/2),u=Math.sin(l/2),h=2*ug(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*u*u))*t;return Math.round(1e4*h)/1e4}function idt(t,e,i){const r=e.spatialReference,s=$r(r),n=new $t(e.x,t.y,r),o=new $t(i.x,t.y,r),a=new $t(t.x,e.y,r),l=new $t(t.x,i.y,r);return{lon:E0e(s.radius,n,o),lat:E0e(s.radius,a,l)}}function rdt(t,e,i){const r=e/i,s=Gt(t),n=Math.sin(r/2),o=Math.cos(s),a=2*ug(Math.sqrt(n*n/(o*o)));return El(a)}function sdt(t,e){let i=t/15;return e||(i=Math.round(i)),i}function C0e(t,e){const i=t?.[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=sdt(i,!0);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}const SNe=Be(0,0,1),TNe=Se(M(),Be(1,1,1)),ndt=new tx(-180,180),H$=Ne(),Zb=M(),nM=M();function ENe(t,e,i,r=tue()){yt(Zb,t,SNe),xe(Zb,Zb)===0&&yt(Zb,t,TNe),Ph(H$,-Gt(e),t),bh(H$,H$,-Gt(i),Zb);const{up:s,direction:n}=r;return yt(s,Zb,t),Se(s,s),nt(s,s,H$),Se(n,t),Ha(n,n),nt(n,n,H$),r}function odt(t,e,i,r){const s=Zb,n=nM;return Se(s,t),yt(nM,s,SNe),xe(nM,nM)===0&&yt(nM,s,TNe),yt(n,nM,s),_Ne(e,i,r,s,n)}function adt(t,e,i,r){const s={eye:M(),up:null,tilt:r,heading:i},n=Zb;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=Gt(i),l=Gt(r),c=Math.sin(a),u=Math.cos(a),h=Math.sin(l),p=Math.cos(l),f=De(n);let g;if(Math.abs(l)<1e-8)g=o+f;else{const me=f/h,L=ug(o/me),k=Math.PI-l-L;g=me*Math.sin(k)}const y=p*o,v=o*o*(h*h),b=u*u*v,w=g-y,x=w*w,S=b*(b+x-n[1]*n[1]);if(S<0)return ce(s.eye,n,g/f),s.tilt=0,jU(s,t);const E=Math.sqrt(S),C=n[1]*w,R=b+x;let I;if(I=u>0?-E+C:E+C,Math.abs(R)<1e-8)return f<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):ce(s.eye,n,g/f),s.tilt=0,JW(s.eye),jU(s,t);s.eye[1]=I/R;const F=c*c*v,D=h*o,z=u*D*s.eye[1],B=s.eye[1]*s.eye[1],Y=1-B,W=Math.sqrt(Y),J=b*B+F-2*z*W*w+Y*x;return Math.abs(J)<1e-8?(ce(s.eye,n,g/f),s.tilt=0,JW(s.eye),jU(s,t)):(s.eye[0]=(Y*(g*n[0]-y*n[0])-D*W*(n[0]*s.eye[1]*u+n[2]*c))/J,s.eye[2]=(Y*(g*n[2]-y*n[2])-D*W*(n[2]*s.eye[1]*u-n[0]*c))/J,ce(s.eye,s.eye,g),JW(s.eye),jU(s,t))}function JW(t){const e=t[1];t[1]=-t[2],t[2]=e}function jU(t,e){const i=ENe(e,t.heading,t.tilt);return t.up=i.up,t}function ldt(t,e,i){const r=De(e),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),n=ug(i/(s/Math.sin(t)));return El(t-n)}function cdt(t,e,i){const r=Gt(t),s=De(e);return ug(i/(s/Math.sin(r)))+r}function CNe(t,e,i,r,s){let n,o,a,l;const c=e.latitude,u=$r(t.spatialReference).radius,h=e.longitude,p=rdt(c,i,u)/2;n=h-p,o=h+p;const f=Gt(c),g=(1+Math.sin(f))/(1-Math.sin(f)),y=(g+1)*Math.tan(r/u/2),v=y*y;function b(x){const S=Math.PI/2;return(x=Mst.normalize(x,-S))>S&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(y+Math.sqrt(4*g+v))),l=a+r/u,a=b(a),l=b(l),l<a){const x=l;l=a,a=x}if(a=Math.max(El(a),-90),l=Math.min(El(l),90),o=ndt.monotonic(n,o),o-n>180){const x=(o-n-180)/2;n+=x,o-=x}const w=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:Je.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=w):s=new lr(n,a,o,l,w),t.spatialReference&&t.spatialReference.isWebMercator&&JL(s,!1,s),s}const udt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:odt,eyeForCenterWithHeadingTilt:adt,eyeTiltToLookAtTilt:cdt,headingTiltToDirectionUp:ENe,lookAtTiltToEyeTilt:ldt,toExtent:CNe},Symbol.toStringTag,{value:"Module"}));function zj(t){return t.type==="point"}let iue=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function MNe(t){return"array"in t}function Wy(t,e,i="ground"){if(zj(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(MNe(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,e.spatialReference??t.spatialReference,i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}const ANe=()=>oe.getLogger("esri.views.3d.support.cameraUtils"),RNe=39.37,PNe=96,lte=1,hdt=8,ddt=5,ONe=1,M0e=M(),pdt={heading:0,tilt:0},lD=M(),fdt=new tx(-20037508342788905e-9,20037508342788905e-9),mdt=new tx(-180,180);var vl;function kx(t){return t.spatialReference??Je.WGS84}function zI(t){return t.viewingMode==="global"?udt:edt}function gdt(t,e,i,r,s){return zI(t).headingTiltToDirectionUp(e,i,r,s)}function K_(t,e){if(e==null)return null;const i=t.renderSpatialReference,r=zI(t).headingTiltToDirectionUp,s=M();if(!lc(e.position,s,i))return null;const n=r(s,e.heading,e.tilt);ce(n.direction,n.direction,t.state.camera.distance),Te(n.direction,n.direction,s);const o=SC(t,s,n.direction,n.up);return o.fov=Gt(e.fov),o.row=e.layout.row,o.rows=e.layout.rows,o.column=e.layout.column,o.columns=e.layout.columns,o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(vl||(vl={}));const oM=M();function GO(t,e,i){const r=t.renderSpatialReference,s=g9(t,e.eye,e.viewForward,e.up,pdt);let n=kx(t);return wa(e.eye,r,oM,n)||(n=Je.WGS84,wa(e.eye,r,oM,n)),i==null?i=new Wd(new $t(oM,n),s.heading,s.tilt,El(e.fov)):(i.position.x=oM[0],i.position.y=oM[1],i.position.z=oM[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=El(e.fov)),i.layout.row=e.row,i.layout.rows=e.rows,i.layout.column=e.column,i.layout.columns=e.columns,i}function m9(t,e,i){const r=t.state.camera,s=r.width/2/r.pixelRatio;return t.renderCoordsHelper.viewingMode===Xe.Global&&i!=null&&(e*=Math.cos(Gt(i))),e/=t.renderCoordsHelper.unitInMeters,s/(PNe*RNe/e)/Math.tan(r.fovX/2)}function ux(t,e,i){const r=t.state.camera,s=e*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let o=PNe*RNe/(n/s);return t.renderCoordsHelper.viewingMode===Xe.Global&&i!=null&&(o/=Math.cos(Gt(i))),o*t.renderCoordsHelper.unitInMeters}async function INe(t,e,i,r,s,n){return $Ne(t,e,m9(t,i,e.latitude),r,s,n)}function ydt(t,e,i,r,s,n){return WNe(t,rue(t,r.heading,r.tilt,e,i,s),r.fov,n)}async function $Ne(t,e,i,r,s,n){const o=await LNe(t,r.heading,r.tilt,e,i,s,n);return zt(n),YNe(t,o,r.fov,n)}function g9(t,e,i,r,s){return zI(t).directionToHeadingTilt(e,i,r,s)}function NNe(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,lD,t.spatialReference)&&t.elevationProvider&&(Wy(t.elevationProvider,lD)??0)>lD[2]-ONe)}async function _dt(t,e,i){if(NNe(t,e))return!0;const{elevationProvider:r,spatialReference:s,renderCoordsHelper:n}=t;if(r==null||!n.fromRenderCoords(e,lD,s))return!1;const[o,a,l]=lD,c=await r.queryElevation(o,a,l,s,"ground",i)??0;return zt(i),c>l-ONe}async function vdt(t,e,i){const r=M();if(e==null)return ge(r,t.state.camera.center);if(e instanceof $t){const{renderSpatialReference:s,basemapTerrain:n,elevationProvider:o}=t,a=e.spatialReference;if(await Rj(e,r,s,0,{signal:i}),zt(i),e.z==null&&n!=null&&o!=null){const l=await o.queryElevation(e.x,e.y,e.z??0,a,"ground",i);zt(i),l!=null&&t.renderCoordsHelper.setAltitude(r,l)}return r}return ge(r,e)}function bdt(t,e){const i=M();if(e==null)return ge(i,t.state.camera.center);if(e instanceof $t){if(!lc(e,i,t.renderSpatialReference))return null;const{basemapTerrain:r,elevationProvider:s}=t;if(e.z==null&&r!=null&&s!=null){const n=Wy(s,e);n!=null&&t.renderCoordsHelper.setAltitude(i,n)}return i}return ge(i,e)}function rue(t,e,i,r,s,n){return DNe(t,e,i,r instanceof $t?r:null,bdt(t,r),s,n)}async function LNe(t,e,i,r,s,n,o){const a=r instanceof $t?r:null,l=await vdt(t,r,o);return zt(o),FNe(t,e,i,a,l,s,n,o)}function DNe(t,e,i,r,s,n,o){if(s==null||!r&&(r=new $t({spatialReference:kx(t)}),!Fx(s,t.renderSpatialReference,r)))return null;const a=kNe(t,e,i,s,n,o);if(UNe(t,i,o)&&NNe(t,a.eye)){const{tilt:l,mode:c}=BNe(t,i,s,n);return DNe(t,e,l,r,s,n,c)}return zNe(a,s)}async function FNe(t,e,i,r,s,n,o,a){r||(r=new $t({spatialReference:kx(t)}),await eNe(s,t.renderSpatialReference,r,{signal:a})||(r=null)),zt(a);const l=kNe(t,e,i,s,n,o);if(UNe(t,i,o)&&await _dt(t,l.eye,a)){zt(a);const{tilt:c,mode:u}=BNe(t,i,s,n);return FNe(t,e,c,r,s,n,u,a)}return zNe(l,s)}function kNe(t,e,i,r,s,n){const o=xdt(t,e,i,r,s=Math.max(s,t.state.constraints.minimumPoiDistance),n);return(0,zI(t).eyeForCenterWithHeadingTilt)(r,s,o.heading,o.tilt)}function UNe(t,e,i){const r=t.map.ground.navigationConstraint;return i===vl.ADJUST&&t.viewingMode==="global"&&e>0&&(r==null||r.type==="stay-above")}function BNe(t,e,i,r){const s=qNe(t,i,r,Tdt(t,r,e,i));return{tilt:s,mode:e-s<1?vl.LOCKED:vl.ADJUST}}function zNe(t,e){return{...t,center:Fn(e)}}function VNe(t,e){const{state:i,spatialReference:r}=t,s=e.spatialReference;return i.isGlobal&&gF(s,Xe.Global)||i.isLocal&&r.equals(s)}function GNe(t,e){let i,r,s;if(t.state.isGlobal){const u=new $t(e.xmin,e.ymin,e.spatialReference),h=new $t(e.xmax,e.ymax,e.spatialReference),p=e.spatialReference.isGeographic?mdt:fdt;i=new $t({x:p.center(u.x,h.x),y:(h.y+u.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const f=$r(e.spatialReference),g=idt(i,u,h);r=g.lon,s=g.lat,p.diff(u.x,h.x)>p.range/2&&(r+=f.halfCircumference),r=Math.min(r,f.halfCircumference),s=Math.min(s,f.halfCircumference)}else{const u=t.renderSpatialReference??e.spatialReference;u.equals(e.spatialReference)||(e=Nx(e,u)),r=e.xmax-e.xmin,s=e.ymax-e.ymin;const h=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;i=new $t({x:e.xmin+.5*r,y:e.ymin+.5*s,z:h,spatialReference:u})}const n=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,o=t.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:i,distance:Math.max(.5*r*a,.5*s*l,.5*n*c)/lte}}async function jNe(t,e,i,r,s,n){const o=VNe(t,e)?e:await ox(e,t.spatialReference,{signal:n});zt(n);const{center:a,distance:l}=GNe(t,o),c=await LNe(t,i,r,a,l,s,n);return zt(n),YNe(t,c,t.camera.fov,n)}function IV(t,e,i,r,s,n){let o;try{o=VNe(t,e)?e:Nx(e,t.spatialReference)}catch{return null}const{center:a,distance:l}=GNe(t,o),c=rue(t,i,r,a,l,s);return c==null?null:WNe(t,c,t.camera.fov,n)}function HNe(t,e,i){const r=t.renderSpatialReference,s=new $t({spatialReference:kx(t)});if(!Fx(i,r,s))return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=Rw(e.eye,i),l=2*a*n*lte,c=2*a*o*lte;return t.viewingMode==="global"?CNe(t,s,l,c):xNe(t,s,l,c)}function wdt(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>hdt)return!0;const s=e,n=t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return jr(s,n)/(Math.tan(.5*t.state.camera.fov)*r)>ddt}function xdt(t,e,i,r,s,n){let o=0;return n===vl.ADJUST&&wdt(t,r,s)?(e=0,o=Sdt(t,s,i,r)):o=sue(t,r,s,i),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:i=qNe(t,r,s,o)}}const Vj=.7;function Sdt(t,e,i,r){const s=sue(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-Vj)+n.max*Vj;return Math.min(s,o)}function Tdt(t,e,i,r){let s=sue(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-Vj)+s*Vj}function qNe(t,e,i,r){return zI(t).lookAtTiltToEyeTilt(r,e,i)}function sue(t,e,i,r){return zI(t).eyeTiltToLookAtTilt(r,e,i)}function WNe(t,e,i,r){if(e==null)return null;const s=t.renderSpatialReference,n=new $t({spatialReference:kx(t)});return Fx(e.eye,s,n)?(r??=new Wd,r.position=n,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r):null}async function YNe(t,e,i,r){const s=t.renderSpatialReference,n=new $t({spatialReference:kx(t)});return await eNe(e.eye,s,n,{signal:r}),zt(r),new Wd(n,e.heading,e.tilt,i)}function Edt(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.levelAtScale(e);ANe().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function XNe(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.scaleAtLevel(e);ANe().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function ZNe(t,e){const{renderSpatialReference:i}=t,r=_ut(i);let s=null;try{wa(e.center,i,M0e,r)&&(s=M0e[1])}catch{}return ux(t,e.distance,s)}const nue=()=>oe.getLogger("esri.layers.support.ElevationSampler");let JNe=class{queryElevation(e){return QNe(e.clone(),this)}on(){return er()}projectIfRequired(e,i){return KNe(e,i)}},Cdt=class extends JNe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){super(),this.tile=e,this.noDataValue=r;const s=e.tile.extent;this.extent=Iq(s,i.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=Xc(i.spatialReference),o=i.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return i!=null&&this.containsAt(i.x,i.y)}containsAt(e,i){return $q(this._aaExtent,e,i)}elevationAt(e,i){if(!this.containsAt(e,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return nue().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(e,i)??this.noDataValue}},yhi=class extends JNe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?e.map(o=>new Cdt(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=Iq(li(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,i){let r,s=!1;for(const n of this.samplers)if(n.containsAt(e,i)&&(s=!0,r=n.elevationAt(e,i),r!==n.noDataValue))return r;return r??(s||nue().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue)}};function QNe(t,e){const i=KNe(t,e.spatialReference);if(!i)return null;switch(t.type){case"point":Mdt(t,i,e);break;case"polyline":Adt(t,i,e);break;case"multipoint":Rdt(t,i,e)}return t}function KNe(t,e){if(t==null)return null;const i=t.spatialReference;if(i.equals(e))return t;const r=Pk(t,e);return r||nue().error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}function Mdt(t,e,i){t.z=i.elevationAt(e.x,e.y)}function Adt(t,e,i){Uy.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];Uy.x=c[0],Uy.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(Uy.x,Uy.y)}}t.hasZ=!0}function Rdt(t,e,i){Uy.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];Uy.x=o[0],Uy.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(Uy.x,Uy.y)}t.hasZ=!0}const Uy=new $t;var cte;let sy=cte=class extends we{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new cte({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],sy.prototype,"cols",void 0),d([m({type:cr,json:{write:!0}})],sy.prototype,"level",void 0),d([m({type:String,json:{write:!0}})],sy.prototype,"levelValue",void 0),d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],sy.prototype,"origin",void 0),d([m({type:Number,json:{write:!0}})],sy.prototype,"resolution",void 0),d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],sy.prototype,"rows",void 0),d([m({type:Number,json:{write:!0}})],sy.prototype,"scale",void 0),sy=cte=d([N("esri.layers.support.LOD")],sy);const Mm=sy;let Pdt=class{constructor(e,i,r,s,n=void 0){this.id=e,this.level=i,this.row=r,this.col=s,this.extent=n}};var vb;const A0e=new ur({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Fl=vb=class extends we{static create(t={}){const{resolutionFactor:e=1,scales:i,size:r=256,spatialReference:s=Je.WebMercator,numLODs:n=24}=t;if(!Bm(s)){const h=[];if(i)for(let p=0;p<i.length;p++){const f=i[p];h.push(new Mm({level:p,scale:f,resolution:f}))}else{let p=5e-4;for(let f=n-1;f>=0;f--)h.unshift(new Mm({level:f,scale:p,resolution:p})),p*=2}return new vb({dpi:96,lods:h,origin:new $t(0,0,s),size:[r,r],spatialReference:s})}const o=Cv(s),a=t.origin?new $t({x:t.origin.x,y:t.origin.y,spatialReference:s}):new $t(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(Xc(s)*39.37*l),u=[];if(i)for(let h=0;h<i.length;h++){const p=i[h],f=p*c;u.push(new Mm({level:h,scale:p,resolution:f}))}else{let h=Ak(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const p=Math.ceil(n/e);u.push(new Mm({level:0,scale:h,resolution:h*c}));for(let f=1;f<p;f++){const g=h/2**e,y=g*c;u.push(new Mm({level:f,scale:g,resolution:y})),h=g}}return new vb({dpi:l,lods:u,origin:a,size:[r,r],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const i=Cv(t);return t.isWrappable&&!!i&&Math.abs(i.origin[0]-e.x)<=i.dx}return!1}readOrigin(t,e){return $t.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,i=0;const r=[],s=this._levelToLOD={};t&&(e=-1/0,i=1/0,t.forEach(n=>{r.push(n.scale),e=n.scale>e?n.scale:e,i=n.scale<i?n.scale:i,s[n.level]=n})),this._set("scales",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const i=Math.floor(t),r=i+1;return e[i]/(e[i]/e[r])**(t-i)}scaleToZoom(t){const e=this.scales,i=e.length-1;let r=0;for(;r<i;r++){const s=e[r],n=e[r+1];if(s<=t)return r;if(n===t)return r+1;if(s>t&&n<t)return r+Math.log(s/t)/Math.log(s/n)}return r}tileAt(t,e,i,r){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=i;else if(Bs(e.spatialReference,this.spatialReference))n=e.x,o=e.y,r=i;else{const c=Pk(e,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r=new Pdt(null,0,0,0,li())),r.level=t,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(t,e=vb.ExtrapolateOptions.NONE){let i=this.lodAt(t.level);if(!i&&e===vb.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(i=o)}if(!i)return;const r=t.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=li()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const i=this.lodAt(e.level);if(i==null)return null;const{resolution:r}=i,s=r*this.size[0],n=r*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){return this._levelToLOD?.[t]??null}clone(){return vb.fromJSON(this.write({}))}getCompatibleForVTL(t){if(this.size[0]!==this.size[1]||this.size[0]===256&&t===512)return null;const e=(this.size[0]===512&&t===256?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===t&&e===0)return this;const i=[],r=this.lods.length-e;for(let s=0;s<r;s++){const n=s+e,{scale:o,resolution:a}=n>=0?this.lods[n]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};i.push(new Mm({level:s,scale:o,resolution:a}))}return new vb({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let i=0;i<t.length;i++){const r=t[i];this._upsampleLevels[r.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/r.resolution:0},e=r}}};d([m({type:Number,json:{write:!0}})],Fl.prototype,"compressionQuality",void 0),d([m({type:Number,json:{write:!0}})],Fl.prototype,"dpi",void 0),d([m({type:String,json:{read:A0e.read,write:A0e.write,origins:{"web-scene":{read:!1,write:!1}}}})],Fl.prototype,"format",void 0),d([m({readOnly:!0})],Fl.prototype,"isWrappable",null),d([m({type:$t,json:{write:!0}})],Fl.prototype,"origin",void 0),d([Le("origin")],Fl.prototype,"readOrigin",null),d([m({type:[Mm],value:null,json:{write:!0}})],Fl.prototype,"lods",null),d([m({readOnly:!0})],Fl.prototype,"scales",void 0),d([m({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Fl.prototype,"size",void 0),d([Le("size",["rows","cols"])],Fl.prototype,"readSize",null),d([Ve("size",{cols:{type:cr},rows:{type:cr}})],Fl.prototype,"writeSize",null),d([m({type:Je,json:{write:!0}})],Fl.prototype,"spatialReference",void 0),Fl=vb=d([N("esri.layers.support.TileInfo")],Fl),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Fl||(Fl={}));const $V=Fl,Odt=12;let ph=class Yu{constructor(e){const i=Yu.checkUnsupported(e);if(i!=null)throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=Ak(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,u)=>(u.level<c.minLod.level&&(c.minLod=u),c.max=Math.max(c.max,u.level),c),{minLod:r.lods[0],max:-1/0}),n=s.minLod,o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new Yu(this.toTileInfo())}toTileInfo(){return new $V({dpi:this.dpi,origin:new $t({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new Mm({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=Wme(e[0]),i[1]=nj(e[1]),i[2]=Wme(e[2]),i[3]=nj(e[3])):this._isGCS&&(i[0]=Gt(e[0]),i[1]=Gt(e[1]),i[2]=Gt(e[2]),i[3]=Gt(e[3]))}getExtentGeometry(e,i,r,s=new lr){return this.getExtent(e,i,r,Ig),s.spatialReference=this.spatialReference,s.xmin=Ig[0],s.ymin=Ig[1],s.xmax=Ig[2],s.ymax=Ig[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const{resolution:r,scale:s}=this.levels[this.levels.length-1],n=r/2*this.pixelSize;this.levels.push({resolution:r/2,scale:s/2,tileSize:[n,n]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e,i=1/0){if(Yu.checkUnsupported(e))return!1;const r=new Yu(e);if(!r.spatialReference.equals(this.spatialReference)||r.pixelSize!==this.pixelSize)return!1;const s=Math.min(this.levels.length-1,r.levels.length-1,i),n=this.levels[s].resolution;let o=.5*n;return!Pw(r.origin[0],this.origin[0],o)||!Pw(r.origin[1],this.origin[1],o)?!1:(o=.5*n/2**s/this.pixelSize*Odt,Pw(n,r.levels[s].resolution,o))}rootTilesInExtent(e,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;Yu.computeRowColExtent(e,n,this.origin,Ig);let o=Ig[1],a=Ig[3],l=Ig[0],c=Ig[2];const u=c-l,h=a-o;if(u*h>r){const p=Math.floor(Math.sqrt(r));h>p&&(o=o+Math.floor(.5*h)-Math.floor(.5*p),a=o+p),u>p&&(l=l+Math.floor(.5*u)-Math.floor(.5*p),c=l+p)}for(let p=o;p<a;p++)for(let f=l;f<c;f++)s.push([0,p,f]);return i!=null&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,i,r,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-e[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-e[1]-n)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!ket(s.resolution,r/2**s.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new j("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?oue():e.lods.length<1?new j("tilingscheme:generic","Tiling scheme must have at least one level"):Yu.isPowerOfTwo(e)?Yu.hasGapInLevels(e)?new j("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Yu.tileSizeSupported(e)?Yu.hasOriginPerLODs(e)?new j("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new j("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new j("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],s=e[3]-e[1],n=Xc(i),o=1.2*Math.max(r,s),a=256,l=o/a,c=l*n*(96/.0254),u=new Yu(new $V({size:[a,a],origin:new $t({x:e[0]-.5*(o-r),y:e[3]+.5*(o-s)}),lods:[new Mm({level:0,resolution:l,scale:c})],spatialReference:i}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const i=new Yu(Yu.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const s=256/i,n=new Yu(new $V({size:[i,i],origin:new $t({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Mm({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(r),n}get test(){}};function oue(){return new j("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}ph.WebMercatorAuxiliarySphereTileInfo=new $V({size:[256,256],origin:new $t({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Je.WebMercator}),spatialReference:Je.WebMercator,lods:[new Mm({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),ph.WebMercatorAuxiliarySphere=ph.makeWebMercatorAuxiliarySphere(19);const Ig=li(),VR=64,dN=512,Idt=2.5,aue=Uet(NK/10),eLe=2,tLe=li();ph.WebMercatorAuxiliarySphere.getExtent(0,0,0,tLe);const $dt=li([-180,-90,180,90]),Ndt="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Ldt="Surface extent is too large for tile resolution at level 0.",vo=4;let bb=class extends un.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=aue}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e?.extent==null||e.spatialReference==null)return null;const i=Iq(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){return this.view.basemapTerrain?.spatialReference??Je.WGS84}elevationAt(e,i){if(this.extent==null||!Ic(this.extent,e,i)){const r=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return oe.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${r})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,i,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(e){return QNe(e.clone(),this)}};d([m({readOnly:!0})],bb.prototype,"demResolution",void 0),d([m({readOnly:!0})],bb.prototype,"extent",null),d([m({readOnly:!0})],bb.prototype,"noDataValue",void 0),d([m()],bb.prototype,"spatialReference",null),d([m({constructOnly:!0})],bb.prototype,"view",void 0),bb=d([N("esri.views.support.GroundViewElevationSampler")],bb);const Ddt=bb;let M_=class extends Fe{constructor(e){super(e),this.view=null,this.layerViews=new ct}initialize(){this.addHandles(Du(()=>this.view?.map?.ground,e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Ddt({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?HNe(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>_e(()=>e.updating,()=>this._updateUpdating(),Mr)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};d([m({readOnly:!0})],M_.prototype,"elevationSampler",null),d([m({readOnly:!0})],M_.prototype,"extent",null),d([m({type:Boolean,readOnly:!0})],M_.prototype,"updating",null),d([m({constructOnly:!0})],M_.prototype,"view",void 0),d([m({type:ct,readOnly:!0})],M_.prototype,"layerViews",void 0),d([m({readOnly:!0})],M_.prototype,"suspended",null),M_=d([N("esri.views.GroundView")],M_);const Fdt=M_;let jv=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const s=e[r],n=new RAe(s,void 0,void 0,2,2);this._properties[r]={pool:n,acquired:[]}}this._afterDispatchHandle=VAe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)bme(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const s of i.acquired)bme(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}};const kdt=ae("mac")?"Meta":"Control",Udt=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),Bdt=t=>Udt.has(t);let zdt=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}},Ja=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof e=="string"?new zdt(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const h=this._incoming[u.match.eventType];if(h){const p=h.indexOf(u);h.splice(p,1),o(),this._manager&&this._manager.updateDependencies()}},l=new Vdt(n,r,{onPause:a,onRemove:a,onResume:u=>{const h=this._incoming[u.match.eventType];h&&!h.includes(u)&&(h.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new Gdt(e,{onEmit:(r,s,n,o)=>{this._manager?.emit(r.eventType,s,n,o)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager?.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){this._manager?.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager?.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){const i=this._incoming[e.type];if(i){for(const r of i)if(r.match.matches(e)&&(r.callback?.(e),e.shouldStopPropagation()))break}}},Vdt=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},Gdt=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},jdt=class extends Ja{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{this._update(i.data)})}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:s}=e;i===this._value&&this._x===r&&this._y===s||(this._value=i,this._x=r,this._y=s,this._onChange(i,r,s))}},Hdt=class extends Ja{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=s0(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},yp=class extends Fe{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=kdt,this._latestPointerType="mouse",this._propertiesPool=new jv({latestPointerLocation:Ydt},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,i,r=Dw.INTERNAL){if(this._nameToGroup[e]||i.length===0)return;const s={name:e,handlers:i.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,u,h)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,h,u)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{r.removed=!0,r.uninstallCallback?.()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):oe.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers&&this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const s=this._handlers[r];s.priorityIndex=r,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const s=this._handlersPriority[r];s.priorityIndex=r;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)Bdt(a)||i.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==i||s.y!==r){const n=this._propertiesPool.get("latestPointerLocation");n.x=i,n.y=r,this._set("latestPointerLocation",n)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const n=i;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,s=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,r,s)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const s=()=>{if(!r){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,r=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=i.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=i.native;n("Alt",!(!o||!o.altKey)),n("Control",!(!o||!o.ctrlKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new jdt((e,i,r)=>this._setLatestPointer(e,i,r)),this._multiTouchHandler=new Hdt,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Dw.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Dw.INTERNAL)}_setPointerCapture(e,i,r,s){const n=e.name+"-"+i.priorityIndex,o=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,s){this._emitInputEvent(0,e,i,r,s)}_emitInputEvent(e,i,r,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new qdt(i,r,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new Aj,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:i,priorityIndex:r}=e.events.pop(),s=i.data?.eventId;if(!(s!=null&&this._stoppedPropagationEventIds.has(s)))for(e.currentHandler=this._handlersPriority[r];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!i.shouldStopPropagation()&&e.currentHandler.eventCallback?.(i),i.shouldStopPropagation()){s!=null&&this._stoppedPropagationEventIds.add(s);break}if(i.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:i,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const i=new Aj;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const s of i.handler.incomingEventMatches){if(r.eventType!==s.eventType)continue;const n=r.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===r.keyModifiers.length!=(n.length===s.keyModifiers.length))return r.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let s=0;for(;s<i.length&&this._compareHandlerPriority(r,i[s])>=0;)s++;i.splice(s,0,r)}return i}get debug(){const e=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{e(()=>{this._onEventReceived(i,r)})},disablePointerCapture:e}}};d([m({readOnly:!0})],yp.prototype,"hasPendingInputs",null),d([m({constructOnly:!0})],yp.prototype,"eventSource",void 0),d([m({constructOnly:!0})],yp.prototype,"recognizers",void 0),d([m()],yp.prototype,"_latestPointerType",void 0),d([m()],yp.prototype,"latestPointerType",null),d([m()],yp.prototype,"multiTouchActive",null),d([m({readOnly:!0})],yp.prototype,"latestPointerLocation",void 0),d([m()],yp.prototype,"_paused",void 0),d([m({readOnly:!0})],yp.prototype,"updating",null),yp=d([N("esri.views.input.InputManager")],yp);let qdt=class{constructor(e,i,r,s,n){this.type=e,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=Jb.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=Jb.STOPPED}shouldStopPropagation(){return!!(this._propagationState&Jb.STOPPED)}async(e){this._propagationState|=Jb.PAUSED;const i=(r,s)=>{this._propagationState&=~Jb.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&Jb.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var Jb;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(Jb||(Jb={}));const Dw={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let Wdt=class{};const Ydt=Wdt;function t_(t){return t!=null&&"open"in t&&"declaredClass"in t}function R0e(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const Xdt=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([_e(()=>[this.ui,this.popup],([i,r],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&t_(l)&&(l.view=null,R0e(l)&&a.remove(l,n))}i&&t_(r)&&(r.view=this,R0e(r)&&i.add(r,{key:n,position:o,internal:!0}))},Ir),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(t_(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),t_(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)}))},Dw.WIDGET)]),SO(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{ye(()=>import("./Popup-efcbd2ed.js"),["./Popup-efcbd2ed.js","./unitFormatUtils-97d022f1.js","./AttachmentInfo-d8dd81a7.js","./utils-6fba2c13.js","./executeQueryJSON-10f3e1e5.js","./query-f1663770.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./ReactiveSet-e908c60f.js"],import.meta.url)})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if(t_(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void oe.getLogger(this).error(new j("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){this._popupSetupTask?.abort(),t_(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,r){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(i,r),r)}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!t_(this.popup))return this._popupSetupTask=P0(async i=>{const{default:r}=await ye(()=>import("./Popup-efcbd2ed.js"),["./Popup-efcbd2ed.js","./unitFormatUtils-97d022f1.js","./AttachmentInfo-d8dd81a7.js","./utils-6fba2c13.js","./executeQueryJSON-10f3e1e5.js","./query-f1663770.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./ReactiveSet-e908c60f.js"],import.meta.url);if(zt(i),!this.popup||t_(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new r(s)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:i,hits:r},s){const n=[],o=[];let a=!1;const l=oZe(s,ae("popup-view-fetch-timeout")??Jdt),c=p=>{const f=new Zdt(p);return o.push(f),n.push(f.promise),f},u=p=>{const f=o.at(-1);return f&&f.layerView===p&&!a?f:c(p)};for(const p of r)"graphic"in p?(u(p.layerView).graphics.push(p.graphic),a=!1):(n.push(p.layerView.fetchPopupFeaturesAtLocation(p.mapPoint,l)),a=!0);o.map(p=>p.resolve(l));const h=QQ(n).then(p=>p.filter(f=>!!f).flat());return{pendingFeatures:n,allGraphicsPromise:h,location:i}}async _getPopupHits(i,r){const{hits:s,location:n}=await this.popupHitTest(i);zt(r);const o=[];for(const a of s)if("graphic"in a){if(this._isValidPopupGraphic(a.graphic,r)){const l=this._isValidPopupGraphicsLayerView(a.layerView)?a.layerView:void 0;o.push({graphic:a.graphic,layerView:l})}}else this._isValidPopupLocationLayerView(a.layerView)&&o.push({mapPoint:a.mapPoint,layerView:a.layerView});return{hits:o,location:n}}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(r?.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(i){return!i||(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesFromGraphics"in i}_isValidPopupLocationLayerView(i){return(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesAtLocation"in i}};return d([m({cast(i){return!i||t_(i)||typeof i=="object"&&(i.open=r=>(Yw(oe.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(r)),i.close=()=>(Yw(oe.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),i}})],e.prototype,"popup",void 0),d([m()],e.prototype,"popupEnabled",void 0),e=d([N("esri.views.PopupView")],e),e};let Zdt=class{constructor(e){this.layerView=e,this._resolver=lo(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:i,graphics:r,_resolver:s}=this;if(!i)return s.resolve(r),s.promise;let n;return i.fetchPopupFeaturesFromGraphics(r,e).catch(o=>(n=o,null)).then(o=>{o?s.resolve(o):s.reject(n)}),s.promise}};const Jdt=5e3;async function lue(t,e){const{WhereClause:i}=await ye(()=>import("./WhereClause-11cd8876.js").then(r=>r.W),["./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js"],import.meta.url);return i.create(t,e)}function Qdt(t,e){return t==="1=1"?e??t:e==="1=1"?t??e:t!=null&&t!==""?e!=null&&e!==""?`(${t}) AND (${e})`:t:e}function $hi(t){return typeof t=="number"}function cue(t){return typeof t=="string"||t instanceof String}const Kdt="yyyy-MM-dd",ept="TT";var cD;(function(t){t.HM="HH:mm",t.HMS="HH:mm:ss",t.HMS_MS="HH:mm:ss.SSS"})(cD||(cD={}));const tpt=[cD.HMS_MS,cD.HMS,cD.HM,ept];function P0e(t){if(!t||!cue(t))return null;const e=Ti.fromFormat(t,Kdt);return e.isValid?e:null}function O0e(t){return t&&cue(t)?PXe(tpt,e=>{const i=Ti.fromFormat(t,e);return i.isValid?i:null})??null:null}function I0e(t){if(!t||!cue(t))return null;const e=Ti.fromISO(t);return e.isValid?e:null}var jO;(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(jO||(jO={}));const ipt=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function rpt(t){return t!=null&&ipt.has(t.type)}function iLe(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function rLe(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function sLe(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function spt(t,e,i){const r=i??t?.domain;if(!r)return null;switch(r.type){case"range":{const{min:s,max:n}=nLe(t,i);if(s!=null&&+e<s||n!=null&&+e>n)return jO.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(r.codedValues==null||r.codedValues.every(s=>s==null||s.code!==e))return jO.INVALID_CODED_VALUE}return null}function nLe(t,e){const i=e??t?.domain;if(!i||i.type!=="range")return;const r="range"in i?i.range[0]:i.minValue,s="range"in i?i.range[1]:i.maxValue,n=rpt(t);return iLe(t)||sLe(t)||rLe(t)?{...npt(t,s,r),isInteger:n}:{min:r!=null&&typeof r=="number"?r:null,max:s!=null&&typeof s=="number"?s:null,rawMin:r,rawMax:s,isInteger:n}}function npt(t,e,i){return iLe(t)?{min:P0e(i)?.toMillis(),max:P0e(e)?.toMillis(),rawMin:i,rawMax:e}:sLe(t)?{min:O0e(i)?.toMillis(),max:O0e(e)?.toMillis(),rawMin:i,rawMax:e}:rLe(t)?{min:I0e(i)?.toMillis(),max:I0e(e)?.toMillis(),rawMin:i,rawMax:e}:{max:null,min:null}}const opt=()=>oe.getLogger("esri.support.arcadeOnDemand");let QW;function hx(){return QW||(QW=(async()=>{const t=await ye(()=>import("./arcadeUtils-6120bfa6.js").then(e=>e.aN),["./arcadeUtils-6120bfa6.js","./TimeOnly-0ea1f14a.js","./ImmutableArray-d5cad66d.js","./number-783b8778.js","./hash-6f442295.js"],import.meta.url);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),QW}const apt=(t,e,i)=>uue.create(t,e,i,null,["$feature","$view"],[]),oLe=(t,e,i)=>uue.create(t,e,i,null,["$feature","$view"],[]),lpt=(t,e,i,r)=>uue.create(t,e,i,r,["$feature","$view"],[]);let uue=class aLe{constructor(e,i,r,s,n,o,a){this.services=null,this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o?.fields;this.fields=l??[],this._syntaxTree=r,this._arcade=i,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await hx(),u=Je.fromJSON(i);let h;try{h=a.parseScript(e,o)}catch(I){return opt().error(new j("arcade-bad-expression","Failed to parse arcade script",{script:e,error:I})),null}const p=n.reduce((I,F)=>({...I,[F]:null}),{});let f=null;s!=null&&(f=new c(s),f.immutable=!0,p.$config=null);const g=a.scriptUsesGeometryEngine(h),y=g&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(h)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(h),w=b&&a.enableAsyncSupport(),x={vars:p,spatialReference:u,useAsync:!!w};await Promise.all([y,v,w]);const S=new Set;await a.loadDependentModules(S,h,null,b,g);const E=new c;E.immutable=!1,E.setField("scale",0);const C=a.compileScript(h,x),R=(I,F)=>{const D=I.$view?.timeZone;return"$view"in I&&I.$view&&(E.setField("scale",typeof I.$view=="object"&&"scale"in I.$view?I.$view.scale:void 0),I.$view=E),f&&(I.$config=f),C({vars:I,spatialReference:u,services:F,timeZone:D})};return new aLe(e,a,h,R,new l,r,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const cpt=/^([0-9_])/,upt=/[^a-z0-9_\u0080-\uffff]+/gi;function hpt(t){return t==null?null:t.trim().replaceAll(upt,"_").replace(cpt,"F$1")||null}const dpt=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],ppt=["field","normalizationField"];function Gj(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if($0e(dpt,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)$0e(ppt,r,e)}}function $0e(t,e,i){if(t)for(const r of t){const s=_v(r,e),n=s&&typeof s!="function"&&i.get(s);n&&ja(r,n.name,e)}}function hue(t,e){if(t!=null&&e?.fields?.length)if("startField"in t){const i=e.get(t.startField),r=e.get(t.endField);t.startField=i?.name??null,t.endField=r?.name??null}else{const i=e.get(t.startTimeField),r=e.get(t.endTimeField);t.startTimeField=i?.name??null,t.endTimeField=r?.name??null}}const KW=new Set;function due(t,e){return t&&e?(KW.clear(),VE(KW,t,e),Array.from(KW).sort()):[]}function VE(t,e,i){if(i)if(e?.fields?.length)if(i.includes("*"))for(const{name:r}of e.fields)t.add(r);else for(const r of i)Ou(t,e,r);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const r of i)r!=null&&t.add(r)}}function Ou(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function Nhi(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}async function Wc(t,e,i){if(!i)return;const{arcadeUtils:r}=await hx(),s=r.extractFieldNames(i,e?.fields?.map(n=>n.name));for(const n of s)Ou(t,e,n)}async function lLe(t,e,i){if(i&&i!=="1=1"){const r=await lue(i,e);if(!r.isStandardized)throw new j("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});VE(t,e,r.fieldNames)}}function fpt({displayField:t,fields:e}){return t||(e?.length?eY(e,"name-or-title")||eY(e,"unique-identifier")||eY(e,"type-or-category")||mpt(e):null)}function mpt(t){for(const e of t){if(!e?.name)continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function eY(t,e){for(const i of t)if(i?.valueType&&i.valueType===e)return i.name;return null}async function Lhi(t,e){if(!e)return;const i=e.elevationInfo?.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function gpt(t,e,i){i.onStatisticExpression?Wc(t,e,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function Dhi(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],s=i.popupTemplate;r.push(ypt(t,e,s)),i.fields&&r.push(...i.fields.map(async n=>gpt(t,e.fieldsIndex,n))),await Promise.all(r)}async function ypt(t,e,i){const r=[];i?.expressionInfos&&r.push(...i.expressionInfos.map(n=>Wc(t,e.fieldsIndex,n.expression)));const s=i?.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&r.push(Wc(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(r)}async function Fhi(t,e,i){e&&(e.timeInfo&&i?.timeExtent&&VE(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&VE(t,e.fieldsIndex,[e.floorInfo.floorField]),i?.where!=null&&await lLe(t,e.fieldsIndex,i.where))}async function khi(t,e,i){e&&i&&await Promise.all(i.map(r=>_pt(t,e,r)))}async function _pt(t,e,i){e&&i&&(i.valueExpression?await Wc(t,e.fieldsIndex,i.valueExpression):i.field&&Ou(t,e.fieldsIndex,i.field))}function Uhi(t){return t?due(t.fieldsIndex,cLe(t)):[]}function vpt(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?due(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const bpt=new Set(["oid","global-id","guid"]),wpt=new Set(["oid","global-id"]),xpt=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function Spt(t){const e=new Set;uLe(t).forEach(r=>e.add(r)),vpt(t).forEach(r=>e.add(r.toLowerCase()));const i=t&&"infoFor3D"in t?t.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach(r=>e.add(r.toLowerCase())),Object.values(i.transformFieldRoles).forEach(r=>e.add(r.toLowerCase()))),Array.from(e)}function cLe(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=e;return[i,r,s,n].filter(Boolean)}function uLe(t){return cLe(t).map(e=>e.toLowerCase())}function Tpt(t,e){return t.editable&&!bpt.has(t.type)&&!uLe(e).includes(t.name?.toLowerCase()??"")}function Ept(t,e){const i=t.name?.toLowerCase()??"";return!(e?.objectIdField!=null&&i===e.objectIdField.toLowerCase()||e?.globalIdField!=null&&i===e.globalIdField.toLowerCase()||Spt(e).includes(i)||wpt.has(t.type)||xpt.some(r=>r.test(i)))}async function Bhi(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i?.length&&await Promise.all(i.map(s=>Cpt(t,r,s)))}async function Cpt(t,e,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await Wc(t,e,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{Ou(t,e,o.slice(1,-1))})}await lLe(t,e,s)}function Mpt(t){const e=t.defaultValue;return e!==void 0&&pLe(t,e)?e:t.nullable?null:void 0}function zhi(t){const e=typeof t=="string"?{type:t}:t;return Upt(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function hLe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function Apt(t){return t===null||hLe(t)}function Rpt(t){return t===null||Number.isInteger(t)}function dLe(t){return t!=null&&typeof t=="string"}function Ppt(t){return t===null||dLe(t)}function Opt(){return!0}function pLe(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":i=t.nullable?Rpt:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?Apt:hLe;break;case"string":case"esriFieldTypeString":i=t.nullable?Ppt:dLe;break;default:i=Opt}return arguments.length===1?i:i(e)}const Ipt=["integer","small-integer","big-integer"],$pt=["single","double"],Npt=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],Lpt=["esriFieldTypeSingle","esriFieldTypeDouble"],Dpt=new Set([...Ipt,...Npt]),Fpt=new Set([...$pt,...Lpt]),kpt=DAe(Dpt,Fpt);function pue(t){return t!=null&&kpt.has(t.type)}function Upt(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function fLe(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function Vhi(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function Ghi(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function Bpt(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function N0e(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function L0e(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function jhi(t,e){return zpt(t,e)===null}var jj,Hj;function Hhi(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function zpt(t,e){return t==null||t.nullable&&e===null?null:pue(t)&&!Vpt(t.type,Number(e))?jj.OUT_OF_RANGE:pLe(t,e)?t.domain?spt(t,e):null:Hj.INVALID_TYPE}function Vpt(t,e){const i=typeof t=="string"?mLe(t):t;if(!i)return!1;const r=i.min,s=i.max;return i.isInteger?Number.isInteger(e)&&e>=r&&e<=s:e>=r&&e<=s}function mLe(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return Gpt;case"esriFieldTypeInteger":case"integer":return jpt;case"esriFieldTypeBigInteger":case"big-integer":return Hpt;case"esriFieldTypeSingle":case"single":return qpt;case"esriFieldTypeDouble":case"double":return Wpt}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(jj||(jj={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(Hj||(Hj={}));const Gpt={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},jpt={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},Hpt={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},qpt={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},Wpt={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function qhi(t,e,i){switch(t){case jO.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case jO.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case Hj.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case jj.OUT_OF_RANGE:{const{min:r,max:s}=mLe(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${s}`}}}function Whi(t,e){return!Ypt(t,e,null)}function Ypt(t,e,i){if(!e?.attributes||!t){if(i!=null)for(const n of t??[])i.add(n);return!0}const r=new Set(Object.keys(e.attributes));let s=!1;for(const n of t)if(!r.has(n)){if(s=!0,i==null)break;i.add(n)}return s}function Xpt(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}function gLe(t){const e=t?.match(/{[^}]+}/g);return e?e.map(i=>i.slice(1,-1).split(":")[0].trim()):[]}let NV=class extends we{constructor(e){super(e),this.type=null}};d([m({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],NV.prototype,"type",void 0),NV=d([N("esri.popup.content.Content")],NV);const Ux=NV;var ute;let pT=ute=class extends Ux{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new ute({description:this.description,displayType:this.displayType,title:this.title})}};d([m({type:String,json:{write:!0}})],pT.prototype,"description",void 0),d([m({type:["auto","preview","list"],json:{write:!0}})],pT.prototype,"displayType",void 0),d([m({type:String,json:{write:!0}})],pT.prototype,"title",void 0),d([m({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],pT.prototype,"type",void 0),pT=ute=d([N("esri.popup.content.AttachmentsContent")],pT);const SF=pT;var hte;let fT=hte=class extends Ux{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new hte({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ee(this.outFields):null})}};d([m()],fT.prototype,"creator",void 0),d([m()],fT.prototype,"destroyer",void 0),d([m()],fT.prototype,"outFields",void 0),d([m({type:["custom"],readOnly:!0})],fT.prototype,"type",void 0),fT=hte=d([N("esri.popup.content.CustomContent")],fT);const Zpt=fT;var dte;let BA=dte=class extends we{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new dte({title:this.title,expression:this.expression})}};d([m({type:String,json:{write:!0}})],BA.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],BA.prototype,"expression",void 0),d([m({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],BA.prototype,"returnType",void 0),BA=dte=d([N("esri.popup.ElementExpressionInfo")],BA);const Jpt=BA;var pte;let pN=pte=class extends Ux{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){return new pte({expressionInfo:this.expressionInfo?.clone()})}};d([m({type:Jpt,json:{write:!0}})],pN.prototype,"expressionInfo",void 0),d([m({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],pN.prototype,"type",void 0),pN=pte=d([N("esri.popup.content.ExpressionContent")],pN);const fue=pN;let zA=class extends ms(we){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};d([Nt(vst)],zA.prototype,"dateFormat",void 0),d([m({type:Boolean,json:{write:!0}})],zA.prototype,"digitSeparator",void 0),d([m({type:cr,json:{write:!0}})],zA.prototype,"places",void 0),zA=d([N("esri.popup.support.FieldInfoFormat")],zA);const LV=zA;var fte;let em=fte=class extends we{constructor(t){super(t),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new fte({fieldName:this.fieldName,format:this.format?.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};d([m({type:String,json:{write:!0}})],em.prototype,"fieldName",void 0),d([m({type:LV,json:{write:!0}})],em.prototype,"format",void 0),d([m({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],em.prototype,"isEditable",void 0),d([m({type:String,json:{write:!0}})],em.prototype,"label",void 0),d([Nt(new ur({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],em.prototype,"stringFieldOption",void 0),d([m({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],em.prototype,"statisticType",void 0),d([m({type:String,json:{write:!0}})],em.prototype,"tooltip",void 0),d([m({type:Boolean,json:{write:!0}})],em.prototype,"visible",void 0),em=fte=d([N("esri.popup.FieldInfo")],em);const mue=em;var mte;let A_=mte=class extends Ux{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(i=>i.toJSON())}clone(){return new mte(ee({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};d([m({type:Object,json:{write:!0}})],A_.prototype,"attributes",void 0),d([m({type:String,json:{write:!0}})],A_.prototype,"description",void 0),d([m({type:[mue]})],A_.prototype,"fieldInfos",void 0),d([Ve("fieldInfos")],A_.prototype,"writeFieldInfos",null),d([m({type:String,json:{write:!0}})],A_.prototype,"title",void 0),d([m({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],A_.prototype,"type",void 0),A_=mte=d([N("esri.popup.content.FieldsContent")],A_);const TF=A_;let mT=class extends we{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};d([m({type:String,json:{write:!0}})],mT.prototype,"altText",void 0),d([m({type:String,json:{write:!0}})],mT.prototype,"caption",void 0),d([m({type:String,json:{write:!0}})],mT.prototype,"title",void 0),d([m({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],mT.prototype,"type",void 0),mT=d([N("esri.popup.content.mixins.MediaInfo")],mT);const gue=mT;var gte;let gT=gte=class extends Fe{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new gte({color:this.color?.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};d([m()],gT.prototype,"color",void 0),d([m()],gT.prototype,"fieldName",void 0),d([m()],gT.prototype,"tooltip",void 0),d([m()],gT.prototype,"value",void 0),gT=gte=d([N("esri.popup.content.support.ChartMediaInfoValueSeries")],gT);const Qpt=gT;var yte;let wb=yte=class extends we{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new yte({colors:ee(this.colors),fields:ee(this.fields),normalizeField:this.normalizeField,series:ee(this.series),tooltipField:this.tooltipField})}};d([m({type:[Ke],json:{type:[[cr]],write:!0}})],wb.prototype,"colors",void 0),d([m({type:[String],json:{write:!0}})],wb.prototype,"fields",void 0),d([m({type:String,json:{write:!0}})],wb.prototype,"normalizeField",void 0),d([m({type:[Qpt],json:{read:!1}})],wb.prototype,"series",void 0),d([m({type:String,json:{write:!0}})],wb.prototype,"tooltipField",void 0),wb=yte=d([N("esri.popup.content.support.ChartMediaInfoValue")],wb);const Kpt=wb;let fN=class extends gue{constructor(e){super(e),this.type=null,this.value=void 0}};d([m({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],fN.prototype,"type",void 0),d([m({type:Kpt,json:{write:!0}})],fN.prototype,"value",void 0),fN=d([N("esri.popup.content.mixins.ChartMediaInfo")],fN);const y9=fN,_9=Yc()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var _te;let DV=_te=class extends y9{constructor(t){super(t),this.type="bar-chart"}clone(){return new _te({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};d([m({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:_9.write}})],DV.prototype,"type",void 0),DV=_te=d([N("esri.popup.content.BarChartMediaInfo")],DV);const yLe=DV;var vte;let FV=vte=class extends y9{constructor(t){super(t),this.type="column-chart"}clone(){return new vte({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};d([m({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:_9.write}})],FV.prototype,"type",void 0),FV=vte=d([N("esri.popup.content.ColumnChartMediaInfo")],FV);const _Le=FV;var bte;let mN=bte=class extends we{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new bte({linkURL:this.linkURL,sourceURL:this.sourceURL})}};d([m({type:String,json:{write:!0}})],mN.prototype,"linkURL",void 0),d([m({type:String,json:{write:!0}})],mN.prototype,"sourceURL",void 0),mN=bte=d([N("esri.popup.content.support.ImageMediaInfoValue")],mN);const eft=mN;var wte;let VA=wte=class extends gue{constructor(t){super(t),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){return new wte({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?.clone()})}};d([m({type:Number,json:{write:!0}})],VA.prototype,"refreshInterval",void 0),d([m({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],VA.prototype,"type",void 0),d([m({type:eft,json:{write:!0}})],VA.prototype,"value",void 0),VA=wte=d([N("esri.popup.content.ImageMediaInfo")],VA);const vLe=VA;var xte;let kV=xte=class extends y9{constructor(t){super(t),this.type="line-chart"}clone(){return new xte({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};d([m({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:_9.write}})],kV.prototype,"type",void 0),kV=xte=d([N("esri.popup.content.LineChartMediaInfo")],kV);const bLe=kV;var Ste;let UV=Ste=class extends y9{constructor(t){super(t),this.type="pie-chart"}clone(){return new Ste({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};d([m({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:_9.write}})],UV.prototype,"type",void 0),UV=Ste=d([N("esri.popup.content.PieChartMediaInfo")],UV);const wLe=UV,xLe={base:gue,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":yLe,"column-chart":_Le,"line-chart":bLe,"pie-chart":wLe,image:vLe}};var Tte;let tm=Tte=class extends Ux{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?vLe.fromJSON(e):e.type==="barchart"?yLe.fromJSON(e):e.type==="columnchart"?_Le.fromJSON(e):e.type==="linechart"?bLe.fromJSON(e):e.type==="piechart"?wLe.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new Tte(ee({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};d([m()],tm.prototype,"activeMediaInfoIndex",void 0),d([m({type:Object,json:{write:!0}})],tm.prototype,"attributes",void 0),d([m({type:String,json:{write:!0}})],tm.prototype,"description",void 0),d([m({types:[xLe]})],tm.prototype,"mediaInfos",void 0),d([Le("mediaInfos")],tm.prototype,"readMediaInfos",null),d([Ve("mediaInfos")],tm.prototype,"writeMediaInfos",null),d([m({type:String,json:{write:!0}})],tm.prototype,"title",void 0),d([m({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],tm.prototype,"type",void 0),tm=Tte=d([N("esri.popup.content.MediaContent")],tm);const qj=tm;var Ete;let gN=Ete=class extends we{constructor(t){super(t),this.field=null,this.order=null}clone(){return new Ete({field:this.field,order:this.order})}};d([m({type:String,json:{write:!0}})],gN.prototype,"field",void 0),d([m({type:["asc","desc"],json:{write:!0}})],gN.prototype,"order",void 0),gN=Ete=d([N("esri.popup.support.RelatedRecordsInfoFieldOrder")],gN);const yue=gN;let ny=class extends ms(Ux){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};d([m({type:String,json:{write:!0}})],ny.prototype,"description",void 0),d([m({type:Number,json:{type:cr,write:!0}})],ny.prototype,"displayCount",void 0),d([m({type:["list"],json:{write:!0}})],ny.prototype,"displayType",void 0),d([m({type:[yue],json:{write:!0}})],ny.prototype,"orderByFields",void 0),d([m({type:Number,json:{type:cr,write:!0}})],ny.prototype,"relationshipId",void 0),d([m({type:String,json:{write:!0}})],ny.prototype,"title",void 0),d([m({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],ny.prototype,"type",void 0),ny=d([N("esri.popup.content.RelationshipContent")],ny);const Wj=ny;var Cte;let yN=Cte=class extends Ux{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new Cte({text:this.text})}};d([m({type:String,json:{write:!0}})],yN.prototype,"text",void 0),d([m({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],yN.prototype,"type",void 0),yN=Cte=d([N("esri.popup.content.TextContent")],yN);const Yj=yN,tft={base:null,key:"type",typeMap:{attachment:SF,media:qj,text:Yj,expression:fue,field:TF,relationship:Wj}};var Mte;let yT=Mte=class extends we{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new Mte({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};d([m({type:String,json:{write:!0}})],yT.prototype,"name",void 0),d([m({type:String,json:{write:!0}})],yT.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],yT.prototype,"expression",void 0),d([m({type:["string","number"],json:{write:!0}})],yT.prototype,"returnType",void 0),yT=Mte=d([N("esri.popup.ExpressionInfo")],yT);const ift=yT;var Ate;let _N=Ate=class extends we{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new Ate({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};d([m({type:Boolean,json:{write:!0}})],_N.prototype,"returnTopmostRaster",void 0),d([m({type:Boolean,json:{write:!0}})],_N.prototype,"showNoDataRecords",void 0),_N=Ate=d([N("esri.popup.LayerOptions")],_N);const rft=_N;var Rte;let vN=Rte=class extends we{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new Rte({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ee(this.orderByFields):null})}};d([m({type:Boolean,json:{write:!0}})],vN.prototype,"showRelatedRecords",void 0),d([m({type:[yue],json:{write:!0}})],vN.prototype,"orderByFields",void 0),vN=Rte=d([N("esri.popup.RelatedRecordsInfo")],vN);const sft=vN;var Pte;let _p=Pte=class extends pce(Fe){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new Pte({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};d([m()],_p.prototype,"active",void 0),d([m()],_p.prototype,"className",void 0),d([m()],_p.prototype,"disabled",void 0),d([m()],_p.prototype,"icon",void 0),d([m()],_p.prototype,"id",void 0),d([m()],_p.prototype,"indicator",void 0),d([m()],_p.prototype,"title",void 0),d([m()],_p.prototype,"type",void 0),d([m()],_p.prototype,"visible",void 0),_p=Pte=d([N("esri.support.actions.ActionBase")],_p);const _ue=_p;var Ote;let BV=Ote=class extends _ue{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new Ote({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};d([m()],BV.prototype,"image",void 0),BV=Ote=d([N("esri.support.actions.ActionButton")],BV);const nft=BV;var Ite;let bN=Ite=class extends _ue{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new Ite({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};d([m()],bN.prototype,"image",void 0),d([m()],bN.prototype,"value",void 0),bN=Ite=d([N("esri.support.actions.ActionToggle")],bN);const oft=bN,q$="relationships/",D0e="expression/",aft=ct.ofType({key:"type",defaultKeyValue:"button",base:_ue,typeMap:{button:nft,toggle:oft}}),lft={base:Ux,key:"type",typeMap:{media:qj,custom:Zpt,text:Yj,attachments:SF,fields:TF,expression:fue,relationship:Wj}},cft=new Set(["attachments","fields","media","text","expression","relationship"]);let $a=class extends ms(we){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>ag(lft,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Lh(e)?e:(oe.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeContent(e,i,r,s){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(n=>cft.has(n.type)).map(n=>n?.toJSON(s)),i.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(i):n.type==="media"?this._writeMediaContent(n,i):n.type==="text"?this._writeTextContent(n,i):n.type==="relationship"&&this._writeRelationshipContent(n,i)})):i.description=e}writeFieldInfos(e,i,r,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>c.fieldInfos?.length);i.fieldInfos=e.filter(Boolean).map(c=>{const u=c.toJSON(s);return l&&(u.visible=!1),u})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,i)}writeLayerOptions(e,i,r,s){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,[...r,...this._getContentExpressionInfos(this.content,r)]),VE(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const i=new Set;return await this.collectRequiredFields(i,e),[...i].sort()}_writeFieldsContent(e,i){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=ee(e.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(s=>{const n=i.fieldInfos.find(o=>o.fieldName?.toLowerCase()===s.fieldName?.toLowerCase());n?n.visible=!0:i.fieldInfos.push(s)}):i.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){const r=e.orderByFields?.map(n=>this._toFieldOrderJSON(n,e.relationshipId))||[],s=[...i.relatedRecordsInfo?.orderByFields||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...s?.length&&{orderByFields:s}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=ee(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const s={description:!1,mediaInfos:!1};return r.map(n=>n.type==="media"?(n.mediaInfos||!i||s.mediaInfos||(n.mediaInfos=i,s.mediaInfos=!0),qj.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),Yj.fromJSON(n)):n.type==="attachments"?SF.fromJSON(n):n.type==="fields"?TF.fromJSON(n):n.type==="expression"?fue.fromJSON(n):n.type==="relationship"?Wj.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!i?.startsWith(q$))return null;const s=i.replace(q$,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?Wj.fromJSON({relationshipId:n,orderByFields:[{field:o,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:s}=e;return{field:`${q$}${i}/${s}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new Yj({text:e})):n.push(new TF),Array.isArray(i)&&i.length&&n.push(qj.fromJSON({mediaInfos:i})),r&&n.push(SF.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&a?.length&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const i=e?.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return i==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:i,title:r,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:u}=n,h=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(c),...this._extractFieldNames(u),...o??[]];return a&&h.push(a),l&&h.push(l),h}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r){r&&await Promise.all(r.map(s=>Wc(e,i,s.expression)))}_getFieldInfoFields(e){return e?e.filter(({fieldName:i,visible:r})=>!(r!==void 0&&!r||!i||i.startsWith(q$)||i.startsWith(D0e))).map(i=>i.fieldName):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){return gLe(e).filter(i=>!(i.indexOf(q$)===0||i.indexOf(D0e)===0))}};d([m({type:aft})],$a.prototype,"actions",void 0),d([m()],$a.prototype,"content",void 0),d([vi("content")],$a.prototype,"castContent",null),d([Le("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],$a.prototype,"readContent",null),d([Ve("content",{popupElements:{type:ct.ofType(tft)},showAttachments:{type:Boolean},mediaInfos:{type:ct.ofType(xLe)},description:{type:String},relatedRecordsInfo:{type:sft}})],$a.prototype,"writeContent",null),d([m({type:[ift],json:{write:!0}})],$a.prototype,"expressionInfos",void 0),d([m({type:[mue]})],$a.prototype,"fieldInfos",void 0),d([Ve("fieldInfos")],$a.prototype,"writeFieldInfos",null),d([m({type:rft})],$a.prototype,"layerOptions",void 0),d([Ve("layerOptions")],$a.prototype,"writeLayerOptions",null),d([m({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],$a.prototype,"lastEditInfoEnabled",void 0),d([m()],$a.prototype,"outFields",void 0),d([m()],$a.prototype,"overwriteActions",void 0),d([m()],$a.prototype,"returnGeometry",void 0),d([m({json:{type:String}})],$a.prototype,"title",void 0),d([Ve("title")],$a.prototype,"writeTitle",null),$a=d([N("esri.PopupTemplate")],$a);const VI=$a,F0e=new ur({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let uft=0,GA=class extends we{constructor(e){super(e),this.id="sym"+uft++,this.type=null,this.color=new Ke([0,0,0,1])}readColor(e){return e?.[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};d([m({type:F0e.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:F0e.write}}})],GA.prototype,"type",void 0),d([m({type:Ke,json:{write:{allowNull:!0}}})],GA.prototype,"color",void 0),d([Le("color")],GA.prototype,"readColor",null),GA=d([N("esri.symbols.Symbol")],GA);const pc=GA;var $te;let xb=$te=class extends pc{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){if(this.data?.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(s=>{const n=s.valueExpressionInfo;return n?Wc(t,e,n.expression):null});await Promise.all(r)}}}clone(){return new $te({data:ee(this.data)})}hash(){return dle(JSON.stringify(this.data)).toString()}};d([m({json:{write:!1}})],xb.prototype,"color",void 0),d([m({json:{write:!0}})],xb.prototype,"data",void 0),d([Le("data",["symbol"])],xb.prototype,"readData",null),d([Ve("data",{})],xb.prototype,"writeData",null),d([Nt({CIMSymbolReference:"cim"},{readOnly:!0})],xb.prototype,"type",void 0),xb=$te=d([N("esri.symbols.CIMSymbol")],xb);const Bx=xb;let jA=class extends we{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,i,r){e||(i[r]=e)}};d([m({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],jA.prototype,"enabled",void 0),d([Ve("enabled")],jA.prototype,"writeEnabled",null),d([m({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],jA.prototype,"type",void 0),jA=d([N("esri.symbols.Symbol3DLayer")],jA);const I0=jA;let _T=class extends we{constructor(e){super(e),this.color=new Ke([0,0,0,1]),this.extensionLength=0,this.size=Sa(1)}clone(){}cloneProperties(){return{color:ee(this.color),size:this.size,extensionLength:this.extensionLength}}};d([m({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],_T.prototype,"type",void 0),d([m(e1)],_T.prototype,"color",void 0),d([m({...v0,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],_T.prototype,"extensionLength",void 0),d([m(v0)],_T.prototype,"size",void 0),_T=d([N("esri.symbols.edges.Edges3D")],_T);const vue=_T;var Nte;let zV=Nte=class extends vue{constructor(t){super(t),this.type="sketch"}clone(){return new Nte(this.cloneProperties())}};d([Nt({sketch:"sketch"},{readOnly:!0})],zV.prototype,"type",void 0),zV=Nte=d([N("esri.symbols.edges.SketchEdges3D")],zV);const hft=zV;var Lte;let VV=Lte=class extends vue{constructor(t){super(t),this.type="solid"}clone(){return new Lte(this.cloneProperties())}};d([Nt({solid:"solid"},{readOnly:!0})],VV.prototype,"type",void 0),VV=Lte=d([N("esri.symbols.edges.SolidEdges3D")],VV);const SLe=VV,TLe={types:{key:"type",base:vue,typeMap:{solid:SLe,sketch:hft}},json:{write:!0}};var Dte;let zd=Dte=class extends we{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new Dte(t)}};d([m(e1)],zd.prototype,"color",void 0),zd=Dte=d([N("esri.symbols.support.Symbol3DMaterial")],zd);var Fte;let Sb=Fte=class extends I0{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new Fte({edges:this.edges?.clone(),enabled:this.enabled,material:this.material?.clone(),castShadows:this.castShadows,size:this.size})}};d([Nt({Extrude:"extrude"},{readOnly:!0})],Sb.prototype,"type",void 0),d([m({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Sb.prototype,"size",void 0),d([m({type:zd,json:{write:!0}})],Sb.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Sb.prototype,"castShadows",void 0),d([m(TLe)],Sb.prototype,"edges",void 0),Sb=Fte=d([N("esri.symbols.ExtrudeSymbol3DLayer")],Sb);const ELe=Sb;let wN=class extends pc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};d([Nt({esriSLS:"simple-line"},{readOnly:!0})],wN.prototype,"type",void 0),d([m({type:Number,cast:Nr,json:{write:!0}})],wN.prototype,"width",void 0),wN=d([N("esri.symbols.LineSymbol")],wN);const dft=wN,pft=["begin","end","begin-end"],CLe=["arrow","circle","square","diamond","cross","x"];var kte;let oy=kte=class extends we{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=r?.origin==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t?.[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){r?.origin==="web-map"||(e[i]=t)}clone(){return new kte({color:ee(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};d([m({type:["begin","end","begin-end"],json:{write:!0}})],oy.prototype,"placement",void 0),d([Nt({"line-marker":"line-marker"},{readOnly:!0}),m({json:{origins:{"web-map":{write:!1}}}})],oy.prototype,"type",void 0),d([m({type:CLe})],oy.prototype,"style",void 0),d([Ve("style")],oy.prototype,"writeStyle",null),d([m({type:Ke,value:null,json:{write:{allowNull:!0}}})],oy.prototype,"color",null),d([Le("color")],oy.prototype,"readColor",null),d([Ve("color")],oy.prototype,"writeColor",null),oy=kte=d([N("esri.symbols.LineSymbolMarker")],oy);const fft=oy;var Ute;const tY=new ur({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let R_=Ute=class extends dft{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),i!=null&&(o.width=Nr(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=Nr(n)),o}clone(){return new Ute({color:ee(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};d([Nt({esriSLS:"simple-line"},{readOnly:!0})],R_.prototype,"type",void 0),d([m({type:tY.apiValues,json:{read:tY.read,write:tY.write}})],R_.prototype,"style",void 0),d([m({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],R_.prototype,"cap",void 0),d([m({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],R_.prototype,"join",void 0),d([m({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":fft}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],R_.prototype,"marker",void 0),d([m({type:Number,json:{read:!1,write:!1}})],R_.prototype,"miterLimit",void 0),R_=Ute=d([N("esri.symbols.SimpleLineSymbol")],R_);const Kd=R_;let xN=class extends pc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline?.hash()}`}};d([m({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Kd}},json:{default:null,write:!0}})],xN.prototype,"outline",void 0),d([m({type:["simple-fill","picture-fill"],readOnly:!0})],xN.prototype,"type",void 0),xN=d([N("esri.symbols.FillSymbol")],xN);const MLe=xN;let GV=class extends we{constructor(e){super(e)}clone(){throw new Error("Subclasses of LinePattern3D should implement their own clone method.")}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],GV.prototype,"type",void 0),GV=d([N("esri.symbols.patterns.LinePattern3D")],GV);const ALe=GV,mft=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var Bte;const gft=Yc()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let SN=Bte=class extends ALe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new Bte(t)}};d([m({type:["style"]})],SN.prototype,"type",void 0),d([Nt(gft),m({type:mft})],SN.prototype,"style",void 0),SN=Bte=d([N("esri.symbols.patterns.LineStylePattern3D")],SN);const bue=SN;let jV=class extends we{constructor(e){super(e),this.type="style"}clone(){throw new Error("Subclasses of Pattern3D should implement their own clone method.")}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],jV.prototype,"type",void 0),jV=d([N("esri.symbols.patterns.Pattern3D")],jV);const RLe=jV,yft=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var zte;let TN=zte=class extends RLe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){return new zte({style:this.style})}};d([m({type:["style"]})],TN.prototype,"type",void 0),d([m({type:yft,json:{read:!0,write:!0}})],TN.prototype,"style",void 0),TN=zte=d([N("esri.symbols.patterns.StylePattern3D")],TN);const PLe=TN,_ft={types:{key:"type",base:RLe,typeMap:{style:PLe}},json:{write:!0}},OLe={types:{key:"type",base:ALe,typeMap:{style:bue}},json:{write:!0}},uD=new Ke("white");new Ke("black");const vft=new Ke([255,255,255,0]);function bft(t){return t.r===0&&t.g===0&&t.b===0}var Vte;let hD=Vte=class extends zd{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new Vte(t)}};d([Nt({multiply:"multiply",replace:"replace",tint:"tint"})],hD.prototype,"colorMixMode",void 0),hD=Vte=d([N("esri.symbols.support.Symbol3DFillMaterial")],hD);function Oo(t=DLe){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function GE(t,e,i,r,s,n,o=Oo()){return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function adi(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new lr(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function HO(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function wft(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function pg(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function Id(t,e,i=0,r=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<r;u++)s=Math.min(s,e[i+3*u]),n=Math.min(n,e[i+3*u+1]),o=Math.min(o,e[i+3*u+2]),a=Math.max(a,e[i+3*u]),l=Math.max(l,e[i+3*u+1]),c=Math.max(c,e[i+3*u+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function iY(t,e,i){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(i)for(let u=0;u<r;u++){const h=e[u];s=Math.min(s,h[0]),n=Math.min(n,h[1]),o=Math.min(o,h[2]),a=Math.max(a,h[0]),l=Math.max(l,h[1]),c=Math.max(c,h[2])}else for(let u=0;u<r;u++){const h=e[u];s=Math.min(s,h[0]),n=Math.min(n,h[1]),a=Math.max(a,h[0]),l=Math.max(l,h[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function xft(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function TC(t){return t[0]>=t[3]?0:t[3]-t[0]}function EC(t){return t[1]>=t[4]?0:t[4]-t[1]}function zx(t){return t[2]>=t[5]?0:t[5]-t[2]}function ILe(t){const e=TC(t),i=zx(t),r=EC(t);return Math.sqrt(e*e+i*i+r*r)}function Vm(t,e=[0,0,0]){return e[0]=t[0]+TC(t)/2,e[1]=t[1]+EC(t)/2,e[2]=t[2]+zx(t)/2,e}function HV(t,e=[0,0,0]){return e[0]=TC(t),e[1]=EC(t),e[2]=zx(t),e}function wue(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function ldi(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function Sft(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function Gm(t,e){return e==null||Sft(t,e)}function $Le(t,e,i,r,s=t){return s[0]=t[0]+e,s[1]=t[1]+i,s[2]=t[2]+r,s[3]=t[3]+e,s[4]=t[4]+i,s[5]=t[5]+r,s}function cdi(t,e,i=t){const r=t[0]+TC(t)/2,s=t[1]+EC(t)/2,n=t[2]+zx(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=s+(t[1]-s)*e,i[2]=n+(t[2]-n)*e,i[3]=r+(t[3]-r)*e,i[4]=s+(t[4]-s)*e,i[5]=n+(t[5]-n)*e,i}function udi(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function NLe(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function LLe(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function v9(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function hs(t){return t?v9(t,k0e):Oo(k0e)}function xue(t,e){return e||(e=li()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function hdi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function Tft(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function Gte(t){return t.length===6}function Sue(t){return TC(t)===0&&EC(t)===0&&zx(t)===0}function ddi(t,e,i){if(t==null||e==null)return t===e;if(!Gte(t)||!Gte(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Eft(t,e,i,r,s,n){return GE(t,e,i,r,s,n,Cft)}const pdi=[-1/0,-1/0,-1/0,1/0,1/0,1/0],k0e=[1/0,1/0,1/0,-1/0,-1/0,-1/0],DLe=[0,0,0,0,0,0],Cft=Oo();function rY(t,{isPrimitive:e,width:i,depth:r,height:s}){const n=e?10:1;if(i==null&&s==null&&r==null)return[n*t[0],n*t[1],n*t[2]];const o=Be(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const Mft=GE(-.5,-.5,-.5,.5,.5,.5),Aft=GE(-.5,-.5,0,.5,.5,1),Rft=GE(-.5,-.5,0,.5,.5,.5);function Pft(t){switch(t){case"sphere":case"cube":case"diamond":return Mft;case"cylinder":case"cone":case"inverted-cone":return Aft;case"tetrahedron":return Rft;default:return}}const Tue=["butt","square","round"],Oft=[...Tue,"none"],FLe=["miter","bevel","round"];var jte;let vT=jte=class extends we{constructor(t){super(t),this.color=new Ke([0,0,0,1]),this.size=Sa(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new jte(t)}};d([m(e1)],vT.prototype,"color",void 0),d([m(v0)],vT.prototype,"size",void 0),d([m(OLe)],vT.prototype,"pattern",void 0),d([m({type:Tue,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],vT.prototype,"patternCap",void 0),vT=jte=d([N("esri.symbols.support.Symbol3DOutline")],vT);var qV;let P_=qV=class extends I0{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new qV(t)}static fromSimpleFillSymbol(t){const e=t.outline&&t.outline.style&&t.outline.style!=="solid"?new bue({style:t.outline.style}):null,i={size:t.outline?.width??0,color:(t.outline?.color??uD).clone(),pattern:e};return e&&t.outline?.cap&&(i.patternCap=t.outline.cap),new qV({material:new hD({color:(t.color??vft).clone()}),pattern:t.style&&t.style!=="solid"?new PLe({style:t.style}):null,outline:i})}};d([Nt({Fill:"fill"},{readOnly:!0})],P_.prototype,"type",void 0),d([m({type:hD,json:{write:!0}})],P_.prototype,"material",void 0),d([m(_ft)],P_.prototype,"pattern",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],P_.prototype,"castShadows",void 0),d([m({type:vT,json:{write:!0}})],P_.prototype,"outline",void 0),d([m(TLe)],P_.prototype,"edges",void 0),P_=qV=d([N("esri.symbols.FillSymbol3DLayer")],P_);const CC=P_,Ift=["none","underline","line-through"],$ft=["normal","italic","oblique"],Nft=["normal","lighter","bold","bolder"],kLe={type:Number,cast:t=>{const e=Gp(t);return e===0?1:$e(e,.1,4)},nonNullable:!0},Lft=["left","right","center"],Dft=["baseline","top","middle","bottom"],ULe={type:Lft,nonNullable:!0},BLe={type:Dft,nonNullable:!0},Fft=8;var Hte;let O_=Hte=class extends we{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return Nr(t)}clone(){return new Hte({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};d([m({type:Ift,json:{default:"none",write:!0}})],O_.prototype,"decoration",void 0),d([m({type:String,json:{write:!0}})],O_.prototype,"family",void 0),d([m({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],O_.prototype,"size",void 0),d([vi("size")],O_.prototype,"castSize",null),d([m({type:$ft,json:{default:"normal",write:!0}})],O_.prototype,"style",void 0),d([m({type:Nft,json:{default:"normal",write:!0}})],O_.prototype,"weight",void 0),O_=Hte=d([N("esri.symbols.Font")],O_);const qk=O_;var qte;const kft=Yc()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let bT=qte=class extends we{constructor(t){super(t)}readHref(t,e,i){return t?Qw(t,i):e.dataURI}writeHref(t,e,i,r){t&&(R0(t)?e.dataURI=t:(e.href=$E(t,r),Fd(e.href)&&(e.href=Dd(e.href))))}clone(){return new qte({href:this.href,primitive:this.primitive})}};d([m({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],bT.prototype,"href",void 0),d([Le("href")],bT.prototype,"readHref",null),d([Ve("href",{href:{type:String},dataURI:{type:String}})],bT.prototype,"writeHref",null),d([Nt(kft)],bT.prototype,"primitive",void 0),bT=qte=d([N("esri.symbols.support.IconSymbol3DLayerResource")],bT);const Uft="circle";var Wte;let L2=Wte=class extends Fe{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new Wte({x:this.x,y:this.y})}};d([m({type:Number})],L2.prototype,"x",void 0),d([m({type:Number})],L2.prototype,"y",void 0),L2=Wte=d([N("esri.symbols.support.Symbol3DAnchorPosition2D")],L2);var Yte;let EN=Yte=class extends we{constructor(t){super(t),this.color=new Ke([0,0,0,1]),this.size=Sa(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new Yte(t)}};d([m(e1)],EN.prototype,"color",void 0),d([m(v0)],EN.prototype,"size",void 0),EN=Yte=d([N("esri.symbols.support.Symbol3DIconOutline")],EN);var HA;const zLe="esri.symbols.IconSymbol3DLayer";let ay=HA=class extends I0{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new HA({anchor:this.anchor,anchorPosition:ee(this.anchorPosition),enabled:this.enabled,material:ee(this.material),outline:ee(this.outline),resource:ee(this.resource),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||uD,i=U0e(t),r=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||uD).clone()}:null;return new HA({size:t.size,resource:{primitive:zft(t.style)},material:{color:e},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(t){const e=!t.color||bft(t.color)?uD:t.color,i=U0e(t);return new HA({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(t){return new HA({resource:{href:vRe({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};d([m({type:zd,json:{write:!0}})],ay.prototype,"material",void 0),d([m({type:bT,json:{write:!0}})],ay.prototype,"resource",void 0),d([Nt({Icon:"icon"},{readOnly:!0})],ay.prototype,"type",void 0),d([m(v0)],ay.prototype,"size",void 0),d([Nt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),m({json:{default:"center"}})],ay.prototype,"anchor",void 0),d([m({type:L2,json:{type:[Number],read:{reader:t=>new L2({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],ay.prototype,"anchorPosition",void 0),d([m({type:EN,json:{write:!0}})],ay.prototype,"outline",void 0),ay=HA=d([N(zLe)],ay);const ww=ay;function U0e(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=B0e(t.xoffset),s=B0e(t.yoffset);return(r||s)&&e&&i?{x:-r/e,y:s/i}:null}function B0e(t){return isFinite(t)?t:0}const Bft={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function zft(t){return Bft[t]||(oe.getLogger(zLe).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}let wT=class extends ms(we){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],wT.prototype,"type",void 0),d([m({type:pft,json:{default:"begin-end",write:!0}})],wT.prototype,"placement",void 0),d([m({type:CLe,json:{default:"arrow",write:!0}})],wT.prototype,"style",void 0),d([m({type:Ke,json:{type:[cr],default:null,write:!0}})],wT.prototype,"color",void 0),wT=d([N("esri.symbols.LineStyleMarker3D")],wT);const Xte=wT;var WV;let ly=WV=class extends I0{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Sa(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new WV(t)}static fromSimpleLineSymbol(t){const e={enabled:!0,size:t.width??Sa(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style?new bue({style:t.style}):null,material:new zd({color:(t.color||uD).clone()}),marker:t.marker?new Xte({placement:t.marker.placement,style:t.marker.style,color:t.marker.color?.clone()??null}):null};return new WV(e)}};d([m({type:zd,json:{write:!0}})],ly.prototype,"material",void 0),d([Nt({Line:"line"},{readOnly:!0})],ly.prototype,"type",void 0),d([m({type:FLe,json:{write:!0,default:"miter"}})],ly.prototype,"join",void 0),d([m({type:Tue,json:{write:!0,default:"butt"}})],ly.prototype,"cap",void 0),d([m(v0)],ly.prototype,"size",void 0),d([m(OLe)],ly.prototype,"pattern",void 0),d([m({types:{key:"type",base:Xte,typeMap:{style:Xte}},json:{write:!0}})],ly.prototype,"marker",void 0),ly=WV=d([N("esri.symbols.LineSymbol3DLayer")],ly);const GI=ly;var Zte;const Vft=Yc()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let CN=Zte=class extends we{clone(){return new Zte({href:this.href,primitive:this.primitive})}};d([m({type:String,json:{read:bq,write:Bv}})],CN.prototype,"href",void 0),d([Nt(Vft)],CN.prototype,"primitive",void 0),CN=Zte=d([N("esri.symbols.support.ObjectSymbol3DLayerResource")],CN);const VLe="sphere";var Jte;let f2=Jte=class extends Fe{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new Jte({x:this.x,y:this.y,z:this.z})}};d([m({type:Number})],f2.prototype,"x",void 0),d([m({type:Number})],f2.prototype,"y",void 0),d([m({type:Number})],f2.prototype,"z",void 0),f2=Jte=d([N("esri.symbols.support.Symbol3DAnchorPosition3D")],f2);var Qte;let Ec=Qte=class extends I0{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new Qte({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition?.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material?.clone()??null,castShadows:this.castShadows,resource:this.resource?.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};d([m({type:zd,json:{write:!0}})],Ec.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ec.prototype,"castShadows",void 0),d([m({type:CN,json:{write:!0}})],Ec.prototype,"resource",void 0),d([Nt({Object:"object"},{readOnly:!0})],Ec.prototype,"type",void 0),d([m({type:Number,json:{write:!0}})],Ec.prototype,"width",void 0),d([m({type:Number,json:{write:!0}})],Ec.prototype,"height",void 0),d([m({type:Number,json:{write:!0}})],Ec.prototype,"depth",void 0),d([Nt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),m({json:{default:"origin"}})],Ec.prototype,"anchor",void 0),d([m({type:f2,json:{type:[Number],read:{reader:t=>new f2({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Ec.prototype,"anchorPosition",void 0),d([m({type:Number,json:{write:!0}})],Ec.prototype,"heading",void 0),d([m({type:Number,json:{write:!0}})],Ec.prototype,"tilt",void 0),d([m({type:Number,json:{write:!0}})],Ec.prototype,"roll",void 0),d([m({readOnly:!0})],Ec.prototype,"isPrimitive",null),Ec=Qte=d([N("esri.symbols.ObjectSymbol3DLayer")],Ec);const Eue=Ec;var Kte;let du=Kte=class extends I0{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new Kte({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};d([m({type:zd,json:{write:!0}})],du.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],du.prototype,"castShadows",void 0),d([Nt({Path:"path"},{readOnly:!0})],du.prototype,"type",void 0),d([m({type:["circle","quad"],json:{write:!0,default:"circle"}})],du.prototype,"profile",void 0),d([m({type:FLe,json:{write:!0,default:"miter"}})],du.prototype,"join",void 0),d([m({type:Oft,json:{write:!0,default:"butt"}})],du.prototype,"cap",void 0),d([m({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],du.prototype,"width",void 0),d([Le("width",["width","size","height"])],du.prototype,"readWidth",null),d([m({type:Number,json:{write:!0}})],du.prototype,"height",void 0),d([Le("height",["height","size","width"])],du.prototype,"readHeight",null),d([m({type:["center","bottom","top"],json:{write:!0,default:"center"}})],du.prototype,"anchor",void 0),d([m({type:["heading","all"],json:{write:!0,default:"all"}})],du.prototype,"profileRotation",void 0),du=Kte=d([N("esri.symbols.PathSymbol3DLayer")],du);const Cue=du;var eie;let GR=eie=class extends we{constructor(){super(...arguments),this.color=new Ke([0,0,0,1]),this.size=0}clone(){const t={color:ee(this.color),size:this.size};return new eie(t)}};d([m(e1)],GR.prototype,"color",void 0),d([m(v0)],GR.prototype,"size",void 0),GR=eie=d([N("esri.symbols.support.Symbol3DHalo")],GR);let dD=class extends ms(we){constructor(e){super(e),this.color=null}};d([m(e1)],dD.prototype,"color",void 0),dD=d([N("esri.symbols.support.Symbol3DTextBackground")],dD);var YV;let Xu=YV=class extends I0{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,i,r){const s={...r,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){return this._userSize!=null?this._userSize:this.font?.size!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new YV({enabled:this.enabled,font:this.font&&ee(this.font),halo:this.halo&&ee(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ee(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new YV({font:t.font!=null?t.font.clone():new qk,halo:Gft(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new zd({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new dD({color:t.backgroundColor.clone()}):null})}};function Gft(t,e){return t&&e!=null&&e>0?new GR({color:ee(t),size:e}):null}d([m({type:qk,json:{write:!0}})],Xu.prototype,"font",null),d([Ve("font")],Xu.prototype,"writeFont",null),d([m({type:GR,json:{write:!0}})],Xu.prototype,"halo",void 0),d([m({...ULe,json:{default:"center",write:!0}})],Xu.prototype,"horizontalAlignment",void 0),d([m({...kLe,json:{default:1,write:!0}})],Xu.prototype,"lineHeight",void 0),d([m({type:zd,json:{write:!0}})],Xu.prototype,"material",void 0),d([m({type:dD,json:{write:!0}})],Xu.prototype,"background",void 0),d([m(v0)],Xu.prototype,"size",null),d([m({type:String,json:{write:!0}})],Xu.prototype,"text",void 0),d([Nt({Text:"text"},{readOnly:!0})],Xu.prototype,"type",void 0),d([m({...BLe,json:{default:"baseline",write:!0}})],Xu.prototype,"verticalAlignment",void 0),Xu=YV=d([N("esri.symbols.TextSymbol3DLayer")],Xu);const MC=Xu;var tie;let Tb=tie=class extends I0{constructor(t){super(t),this.color=iie.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new tie({color:ee(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};d([m({type:Ke,nonNullable:!0,json:{type:[cr],write:(t,e,i)=>e[i]=t.toArray(Ke.AlphaMode.UNLESS_OPAQUE),default:()=>iie.clone(),defaultEquals:t=>t.toCss(!0)===iie.toCss(!0)}})],Tb.prototype,"color",void 0),d([Nt({Water:"water"},{readOnly:!0})],Tb.prototype,"type",void 0),d([m({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Tb.prototype,"waterbodySize",void 0),d([m({type:Number,json:{write:!0,default:null}})],Tb.prototype,"waveDirection",void 0),d([m({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Tb.prototype,"waveStrength",void 0),Tb=tie=d([N("esri.symbols.WaterSymbol3DLayer")],Tb);const GLe=Tb,iie=new Ke([0,119,190]);var rie;let xT=rie=class extends Fe{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new rie({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};d([m({type:String})],xT.prototype,"name",void 0),d([m({type:String})],xT.prototype,"styleUrl",void 0),d([m({type:String})],xT.prototype,"styleName",void 0),d([m({type:Mo})],xT.prototype,"portal",void 0),xT=rie=d([N("esri.symbols.support.StyleOrigin")],xT);const EF=xT;var sie;let oE=sie=class extends Fe{constructor(){super(...arguments),this.url=""}clone(){return new sie({url:this.url})}};d([m({type:String})],oE.prototype,"url",void 0),oE=sie=d([N("esri.symbols.support.Thumbnail")],oE);const jLe={icon:ww,object:Eue,line:GI,path:Cue,fill:CC,extrude:ELe,text:MC,water:GLe},jft=ct.ofType({base:I0,key:"type",typeMap:jLe,errorContext:"symbol-layer"});let cy=class extends pc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,r=i?.type,s=r||ct;this._set("symbolLayers",new s)}get color(){return null}set color(e){this.constructed&&oe.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){y0(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const s=Qw(e.styleUrl,r);return new EF({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new EF({portal:r?.portal||Mo.getDefault(),styleName:e.styleName,name:e.name});r?.messages&&r.messages.push(new m0("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,s){if(e.styleUrl&&e.name){let n=$E(e.styleUrl,s);Fd(n)&&(n=Dd(n)),i.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&s?.portal&&!_Re(e.portal.restUrl,s.portal.restUrl)?s?.messages&&s.messages.push(new m0("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof I0||e&&jLe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};d([m({json:{read:!1,write:!1}})],cy.prototype,"color",null),d([m({type:jft,nonNullable:!0,json:{write:!0}}),vi(Ole)],cy.prototype,"symbolLayers",null),d([m({type:EF})],cy.prototype,"styleOrigin",void 0),d([Le("styleOrigin")],cy.prototype,"readStyleOrigin",null),d([Ve("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],cy.prototype,"writeStyleOrigin",null),d([m({type:oE,json:{read:!1}})],cy.prototype,"thumbnail",void 0),d([m({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],cy.prototype,"type",void 0),cy=d([N("esri.symbols.Symbol3D")],cy);const jI=cy;let MN=class extends we{constructor(e){super(e),this.visible=!0}clone(){throw new Error("Subclasses of Callout3D should implement their own clone method.")}};d([m({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],MN.prototype,"type",void 0),d([m({readOnly:!0})],MN.prototype,"visible",void 0),MN=d([N("esri.symbols.callouts.Callout3D")],MN);const HLe=MN;var nie;let XV=nie=class extends we{constructor(t){super(t),this.color=new Ke("white")}clone(){return new nie({color:ee(this.color)})}};d([m(e1)],XV.prototype,"color",void 0),XV=nie=d([N("esri.symbols.callouts.LineCallout3DBorder")],XV);const Hft=XV;var oie;let Eb=oie=class extends HLe{constructor(t){super(t),this.type="line",this.color=new Ke([0,0,0,1]),this.size=Sa(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new oie({color:ee(this.color),size:this.size,border:ee(this.border)})}};d([Nt({line:"line"})],Eb.prototype,"type",void 0),d([m(e1)],Eb.prototype,"color",void 0),d([m(v0)],Eb.prototype,"size",void 0),d([m({type:Hft,json:{write:!0}})],Eb.prototype,"border",void 0),d([m({readOnly:!0})],Eb.prototype,"visible",null),Eb=oie=d([N("esri.symbols.callouts.LineCallout3D")],Eb);const qLe=Eb;function Mue(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function WLe(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!Mue(t)}function Aue(t){return t.type==="point-3d"||t.type==="label-3d"}function YLe(t){return t.horizontalAlignment==="center"}const XLe={types:{key:"type",base:HLe,typeMap:{line:qLe}},json:{write:!0}};var aie;let qA=aie=class extends we{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new aie({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};d([m(v0)],qA.prototype,"screenLength",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0,default:0}})],qA.prototype,"minWorldLength",void 0),d([m({type:Number,json:{write:!0}})],qA.prototype,"maxWorldLength",void 0),qA=aie=d([N("esri.symbols.support.Symbol3DVerticalOffset")],qA);const Rue=qA;var ZV;const ZLe=ct.ofType({base:null,key:"type",typeMap:{text:MC}});let Cb=ZV=class extends jI{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new ZLe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return WLe(this)}hasVisibleVerticalOffset(){return Mue(this)}clone(){return new ZV({styleOrigin:ee(this.styleOrigin),symbolLayers:ee(this.symbolLayers),thumbnail:ee(this.thumbnail),callout:ee(this.callout),verticalOffset:ee(this.verticalOffset)})}static fromTextSymbol(t){return new ZV({symbolLayers:new ct([MC.fromTextSymbol(t)])})}};d([m({type:Rue,json:{write:!0}})],Cb.prototype,"verticalOffset",void 0),d([m(XLe)],Cb.prototype,"callout",void 0),d([m({json:{read:!1,write:!1}})],Cb.prototype,"styleOrigin",void 0),d([m({type:ZLe})],Cb.prototype,"symbolLayers",void 0),d([Nt({LabelSymbol3D:"label-3d"},{readOnly:!0})],Cb.prototype,"type",void 0),Cb=ZV=d([N("esri.symbols.LabelSymbol3D")],Cb);const b9=Cb;var JV;const JLe=ct.ofType({base:null,key:"type",typeMap:{line:GI,path:Cue}}),qft=ct.ofType({base:null,key:"type",typeMap:{line:GI,path:Cue}});let AN=JV=class extends jI{constructor(t){super(t),this.symbolLayers=new JLe,this.type="line-3d"}clone(){return new JV({styleOrigin:ee(this.styleOrigin),symbolLayers:ee(this.symbolLayers),thumbnail:ee(this.thumbnail)})}static fromSimpleLineSymbol(t){return new JV({symbolLayers:new ct([GI.fromSimpleLineSymbol(t)])})}};d([m({type:JLe,json:{type:qft}})],AN.prototype,"symbolLayers",void 0),d([Nt({LineSymbol3D:"line-3d"},{readOnly:!0})],AN.prototype,"type",void 0),AN=JV=d([N("esri.symbols.LineSymbol3D")],AN);const AC=AN;let Mb=class extends pc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};d([m({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Mb.prototype,"angle",void 0),d([m({type:["simple-marker","picture-marker"],readOnly:!0})],Mb.prototype,"type",void 0),d([m({type:Number,cast:Nr,json:{write:!0}})],Mb.prototype,"xoffset",void 0),d([m({type:Number,cast:Nr,json:{write:!0}})],Mb.prototype,"yoffset",void 0),d([m({type:Number,cast:t=>t==="auto"?t:Nr(t),json:{write:!0}})],Mb.prototype,"size",void 0),Mb=d([N("esri.symbols.MarkerSymbol")],Mb);const QLe=Mb;var QV;const KLe=ct.ofType({base:null,key:"type",typeMap:{fill:CC}});let RN=QV=class extends jI{constructor(t){super(t),this.symbolLayers=new KLe,this.type="mesh-3d"}clone(){return new QV({styleOrigin:ee(this.styleOrigin),symbolLayers:ee(this.symbolLayers),thumbnail:ee(this.thumbnail)})}static fromSimpleFillSymbol(t){return new QV({symbolLayers:new ct([CC.fromSimpleFillSymbol(t)])})}};d([m({type:KLe})],RN.prototype,"symbolLayers",void 0),d([Nt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],RN.prototype,"type",void 0),RN=QV=d([N("esri.symbols.MeshSymbol3D")],RN);const Wk=RN;function Wft(t,e,i){return e.imageData?vRe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):eDe(e.url,i)}function eDe(t,e){if(!Fd(t)){const i=Xft(e);if(i)return uf(i,"images",t)}return Qw(t,e)}function Yft(t,e,i,r){if(R0(t)){const s=Zw(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,i&&i.imageData===e.imageData&&i.url&&Bv(i.url,e,"url",r)}else Bv(t,e,"url",r)}const tDe={json:{read:{source:["imageData","url"],reader:Wft},write:{writer(t,e,i,r){Yft(t,e,this.source,r)}}}},iDe={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=eDe(e.url,i)),r}}}};function Xft(t){if(!t)return null;const{origin:e,layer:i}=t;if(e!=="service"&&e!=="portal-item")return null;const r=i?.type;return r==="feature"||r==="stream"?i.parsedUrl?.path:r==="map-image"||r==="tile"?t.url?.path:null}var lie;let vp=lie=class extends MLe{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),i!=null&&(s.width=Nr(i)),r!=null&&(s.height=Nr(r)),s}clone(){const t=new lie({color:ee(this.color),height:this.height,outline:ee(this.outline),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",ee(this.source)),t}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};d([Nt({esriPFS:"picture-fill"},{readOnly:!0})],vp.prototype,"type",void 0),d([m(tDe)],vp.prototype,"url",void 0),d([m({type:Number,json:{write:!0}})],vp.prototype,"xscale",void 0),d([m({type:Number,json:{write:!0}})],vp.prototype,"yscale",void 0),d([m({type:Number,cast:Nr,json:{write:!0}})],vp.prototype,"width",void 0),d([m({type:Number,cast:Nr,json:{write:!0}})],vp.prototype,"height",void 0),d([m({type:Number,cast:Nr,json:{write:!0}})],vp.prototype,"xoffset",void 0),d([m({type:Number,cast:Nr,json:{write:!0}})],vp.prototype,"yoffset",void 0),d([m(iDe)],vp.prototype,"source",void 0),vp=lie=d([N("esri.symbols.PictureFillSymbol")],vp);const Pue=vp;var cie;let im=cie=class extends QLe{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=Nr(e)),i!=null&&(r.height=Nr(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new cie({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",ee(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};d([m({json:{write:!1}})],im.prototype,"color",void 0),d([Nt({esriPMS:"picture-marker"},{readOnly:!0})],im.prototype,"type",void 0),d([m(tDe)],im.prototype,"url",void 0),d([m(iDe)],im.prototype,"source",void 0),d([m({type:Number,cast:Nr,json:{write:!0}})],im.prototype,"height",void 0),d([Le("height",["height","size"])],im.prototype,"readHeight",null),d([m({type:Number,cast:Nr,json:{write:!0}})],im.prototype,"width",void 0),d([m({json:{write:!1}})],im.prototype,"size",void 0),im=cie=d([N("esri.symbols.PictureMarkerSymbol")],im);const Yk=im;var ST;const rDe=ct.ofType({base:null,key:"type",typeMap:{icon:ww,object:Eue,text:MC}});let TT=ST=class extends jI{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new rDe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return WLe(this)}hasVisibleVerticalOffset(){return Mue(this)}clone(){return new ST({verticalOffset:ee(this.verticalOffset),callout:ee(this.callout),styleOrigin:ee(this.styleOrigin),symbolLayers:ee(this.symbolLayers),thumbnail:ee(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new ST({symbolLayers:new ct([ww.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new ST({symbolLayers:new ct([ww.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){if(t.data?.symbol?.type!=="CIMPointSymbol")return null;const i=t.data.symbol;return new ST(i?.callout?{symbolLayers:new ct([ww.fromCIMSymbol(t)]),callout:new qLe({size:.5,color:new Ke([0,0,0])}),verticalOffset:new Rue({screenLength:40})}:{symbolLayers:new ct([ww.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new ST({symbolLayers:new ct([MC.fromTextSymbol(t)])})}};d([m({type:Rue,json:{write:!0}})],TT.prototype,"verticalOffset",void 0),d([m(XLe)],TT.prototype,"callout",void 0),d([m({type:rDe,json:{origins:{"web-scene":{write:!0}}}})],TT.prototype,"symbolLayers",void 0),d([Nt({PointSymbol3D:"point-3d"},{readOnly:!0})],TT.prototype,"type",void 0),TT=ST=d([N("esri.symbols.PointSymbol3D")],TT);const Yy=TT;var PN;const sDe=ct.ofType({base:null,key:"type",typeMap:{extrude:ELe,fill:CC,icon:ww,line:GI,object:Eue,text:MC,water:GLe}});let ON=PN=class extends jI{constructor(t){super(t),this.symbolLayers=new sDe,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&Yw(oe.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&Yw(oe.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(qa(()=>this.symbolLayers,"after-add",({item:e})=>t(e),Mr))}clone(){return new PN({styleOrigin:ee(this.styleOrigin),symbolLayers:ee(this.symbolLayers),thumbnail:ee(this.thumbnail)})}static fromJSON(t){const e=new PN;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const i=e.symbolLayers.at(0),r=e.symbolLayers.at(1);!r.enabled||t.symbolLayers?.[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:r.material!=null?r.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new PN({symbolLayers:new ct([CC.fromSimpleFillSymbol(t)])})}};d([m({type:sDe,json:{write:!0}})],ON.prototype,"symbolLayers",void 0),d([Nt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],ON.prototype,"type",void 0),ON=PN=d([N("esri.symbols.PolygonSymbol3D")],ON);const Vx=ON;var uie;const sY=new ur({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let ET=uie=class extends MLe{constructor(...t){super(...t),this.color=new Ke([0,0,0,.25]),this.outline=new Kd,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new uie({color:ee(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};d([m()],ET.prototype,"color",void 0),d([m()],ET.prototype,"outline",void 0),d([Nt({esriSFS:"simple-fill"},{readOnly:!0})],ET.prototype,"type",void 0),d([m({type:sY.apiValues,json:{read:sY.read,write:sY.write}})],ET.prototype,"style",void 0),ET=uie=d([N("esri.symbols.SimpleFillSymbol")],ET);const Gx=ET;var hie;const nY=new ur({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let uy=hie=class extends QLe{constructor(...t){super(...t),this.color=new Ke([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Kd}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=Nr(e)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new hie({angle:this.angle,color:ee(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};d([m()],uy.prototype,"color",void 0),d([Ve("color")],uy.prototype,"writeColor",null),d([Nt({esriSMS:"simple-marker"},{readOnly:!0})],uy.prototype,"type",void 0),d([m()],uy.prototype,"size",void 0),d([m({type:nY.apiValues,json:{read:nY.read,write:nY.write}})],uy.prototype,"style",void 0),d([m({type:String,json:{write:!0}})],uy.prototype,"path",null),d([m({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Kd}},json:{default:null,write:!0}})],uy.prototype,"outline",void 0),uy=hie=d([N("esri.symbols.SimpleMarkerSymbol")],uy);const $0=uy;var die;let An=die=class extends pc{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new qk,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return Nr(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new die({angle:this.angle,backgroundColor:ee(this.backgroundColor),borderLineColor:ee(this.borderLineColor),borderLineSize:this.borderLineSize,color:ee(this.color),font:this.font&&this.font.clone(),haloColor:ee(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};d([m({type:Ke,json:{write:!0}})],An.prototype,"backgroundColor",void 0),d([m({type:Ke,json:{write:!0}})],An.prototype,"borderLineColor",void 0),d([m({type:Number,json:{write:!0},cast:Nr})],An.prototype,"borderLineSize",void 0),d([m({type:qk,json:{write:!0}})],An.prototype,"font",void 0),d([m({...ULe,json:{write:!0}})],An.prototype,"horizontalAlignment",void 0),d([m({type:Boolean,json:{write:!0}})],An.prototype,"kerning",void 0),d([m({type:Ke,json:{write:!0}})],An.prototype,"haloColor",void 0),d([m({type:Number,cast:Nr,json:{write:!0}})],An.prototype,"haloSize",void 0),d([m({type:Boolean,json:{write:!0}})],An.prototype,"rightToLeft",void 0),d([m({type:Boolean,json:{write:!0}})],An.prototype,"rotated",void 0),d([m({type:String,json:{write:!0}})],An.prototype,"text",void 0),d([Nt({esriTS:"text"},{readOnly:!0})],An.prototype,"type",void 0),d([m({...BLe,json:{write:!0}})],An.prototype,"verticalAlignment",void 0),d([m({type:Number,cast:Nr,json:{write:!0}})],An.prototype,"xoffset",void 0),d([m({type:Number,cast:Nr,json:{write:!0}})],An.prototype,"yoffset",void 0),d([m({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],An.prototype,"angle",void 0),d([m({type:Number,json:{write:!0}})],An.prototype,"width",void 0),d([m({type:Number})],An.prototype,"lineWidth",void 0),d([Ve("lineWidth")],An.prototype,"writeLineWidth",null),d([vi("lineWidth")],An.prototype,"castLineWidth",null),d([m(kLe)],An.prototype,"lineHeight",void 0),d([Ve("lineHeight")],An.prototype,"writeLineHeight",null),An=die=d([N("esri.symbols.TextSymbol")],An);const HI=An;var pie;let rm=pie=class extends pc{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:Mo.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e?.portal,super.read(t,e)}clone(){return new pie({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const i=e!=null?e.cache:null,r=i?this._fetchCacheKey:null;if(i!=null){const a=r&&i.get(r);if(a)return a.clone()}const{resolveWebStyleSymbol:s}=await ye(()=>Promise.resolve().then(()=>gLt),void 0,import.meta.url);zt(e);const n=s(this,{portal:this.portal},t,e);n.catch(a=>{oe.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(i?.set(r,o.clone()),o):null}};d([m({json:{write:!1}})],rm.prototype,"color",void 0),d([m({type:String,json:{write:!0}})],rm.prototype,"styleName",void 0),d([m({type:Mo,json:{write:!1}})],rm.prototype,"portal",void 0),d([m({type:String,json:{read:bq,write:Bv}})],rm.prototype,"styleUrl",void 0),d([m({type:oE,json:{read:!1}})],rm.prototype,"thumbnail",void 0),d([m({type:String,json:{write:!0}})],rm.prototype,"name",void 0),d([Nt({styleSymbolReference:"web-style"},{readOnly:!0})],rm.prototype,"type",void 0),d([m()],rm.prototype,"_fetchCacheKey",null),rm=pie=d([N("esri.symbols.WebStyleSymbol")],rm);const RC=rm;function w9(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function jE(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const aE={base:pc,key:"type",typeMap:{"simple-fill":Gx,"picture-fill":Pue,"picture-marker":Yk,"simple-line":Kd,"simple-marker":$0,text:HI,"label-3d":b9,"line-3d":AC,"mesh-3d":Wk,"point-3d":Yy,"polygon-3d":Vx,"web-style":RC,cim:Bx},errorContext:"symbol"},vdi={base:pc,key:"type",typeMap:{"picture-marker":Yk,"simple-marker":$0,"point-3d":Yy,cim:Bx},errorContext:"symbol"},bdi={base:pc,key:"type",typeMap:{"simple-line":Kd,"line-3d":AC,cim:Bx},errorContext:"symbol"},wdi={base:pc,key:"type",typeMap:{"simple-fill":Gx,"picture-fill":Pue,"polygon-3d":Vx,cim:Bx},errorContext:"symbol"},Zft={base:pc,key:"type",typeMap:{"picture-marker":Yk,"simple-marker":$0,text:HI,"web-style":RC,cim:Bx},errorContext:"symbol"},Jft=AI({types:aE}),nDe={base:pc,key:"type",typeMap:{"simple-fill":Gx,"picture-fill":Pue,"picture-marker":Yk,"simple-line":Kd,"simple-marker":$0,text:HI,"line-3d":AC,"mesh-3d":Wk,"point-3d":Yy,"polygon-3d":Vx,"web-style":RC,cim:Bx},errorContext:"symbol"},Qft={base:pc,key:"type",typeMap:{text:HI,"label-3d":b9},errorContext:"symbol"},z0e={base:pc,key:"type",typeMap:{"line-3d":AC,"mesh-3d":Wk,"point-3d":Yy,"polygon-3d":Vx,"web-style":RC,cim:Bx},errorContext:"symbol"},Kft={base:pc,key:"type",typeMap:{"label-3d":b9},errorContext:"symbol"},oDe=ag(aE);var fie;function emt(t){if(!t)return null;const e={};for(const i in t){const r=Vv(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function tmt(t){if(t==null)return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}let pu=fie=class extends ms(we){constructor(t){super(t),this.isAggregate=!1,this.layer=null,this.origin=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Ld(),configurable:!0}),Object.defineProperty(this,"_lastMeshTransform",{value:{},configurable:!0,writable:!0,enumerable:!1}),arguments.length>1&&MXe(oe.getLogger(this),"Graphic",{version:"4.30"})}initialize(){this._watchMeshGeometryChanges()}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),t?.type!=="mesh"&&this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new fie({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;const e=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const i of[e,this.sourceLayer,this.layer])if(i){if("popupTemplate"in i&&i.popupTemplate)return i.popupTemplate;if(t&&"defaultPopupTemplate"in i&&i.defaultPopupTemplate!=null)return i.defaultPopupTemplate}return null}getAttribute(t){return this.attributes?.[t]}setAttribute(t,e){if(this.attributes){const i=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",i,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:tmt(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:X6(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:this.popupTemplate?.toJSON()??null}}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if(e?.type==="mesh"){const i={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",i,i,t.action)}}_notifyLayer(t,e,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:t,oldValue:e,newValue:i};t==="origin-transform"&&(s.action=r),t==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}_watchMeshGeometryChanges(){this.addHandles([Du(()=>this.geometry?.type==="mesh"&&this.geometry.vertexSpace.origin?{localMatrix:this.geometry.transform?.localMatrix,origin:this.geometry.vertexSpace.origin}:void 0,({localMatrix:t,origin:e})=>{this._lastMeshTransform.localMatrix===t&&this._lastMeshTransform.origin===e||(this._lastMeshTransform.localMatrix=t,this._lastMeshTransform.origin=e,this.notifyMeshTransformChanged())}),Du(()=>this.geometry?.type==="mesh"?{vertexAttributes:this.geometry.vertexAttributes}:void 0,()=>{const t=this.geometry;t?.type==="mesh"&&t.vertexSpace.origin?(this._lastMeshTransform.localMatrix=t.transform?.localMatrix,this._lastMeshTransform.origin=t.vertexSpace.origin):(this._lastMeshTransform.localMatrix=void 0,this._lastMeshTransform.origin=void 0),this._notifyLayer("geometry",this.geometry,this.geometry)},{equals:(t,e)=>t===e,sync:!0})])}};d([m({value:null,json:{read:emt}})],pu.prototype,"aggregateGeometries",null),d([m({value:null})],pu.prototype,"attributes",null),d([m({value:null,types:gC,json:{read:Vv}})],pu.prototype,"geometry",null),d([m({type:Boolean})],pu.prototype,"isAggregate",void 0),d([m({clonable:"reference"})],pu.prototype,"layer",void 0),d([m({clonable:"reference"})],pu.prototype,"origin",void 0),d([m({type:VI})],pu.prototype,"popupTemplate",void 0),d([m({clonable:"reference"})],pu.prototype,"sourceLayer",void 0),d([m({value:null,types:aE})],pu.prototype,"symbol",null),d([m({type:Boolean,value:!0})],pu.prototype,"visible",null),pu=fie=d([N("esri.Graphic")],pu),function(t){t.generateUID=Ld}(pu||(pu={}));const fg=pu;let pD=class extends oD{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};d([Ple({Type:fg,ensureType:Tn(fg)})],pD.prototype,"itemType",void 0),pD=d([N("esri.support.GraphicsCollection")],pD);let Ab=class extends Fe{constructor(e){super(e),this.view=null,this.baseLayerViews=new ct,this.referenceLayerViews=new ct,this._loadingHandle=_e(()=>this.view?.map?.basemap,i=>{i&&i.load().catch(()=>{})},Ir)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){if(this.view?.suspended)return!1;const e=this.view?.map?.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(i=>i.updating)||this.referenceLayerViews.some(i=>i.updating))}};d([m({constructOnly:!0})],Ab.prototype,"view",void 0),d([m({readOnly:!0})],Ab.prototype,"baseLayerViews",void 0),d([m({readOnly:!0})],Ab.prototype,"referenceLayerViews",void 0),d([m({readOnly:!0})],Ab.prototype,"suspended",null),d([m({type:Boolean,readOnly:!0})],Ab.prototype,"updating",null),Ab=d([N("esri.views.BasemapView")],Ab);function imt(t){return"tryRecycleWith"in t}function rmt(t){return t!=null&&typeof t=="object"&&"layerViews"in t}let smt=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=lo(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,oo(this._controller.signal,()=>{const s=new j("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!imt(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==i)continue;const o=this.layerView.tryRecycleWith(n,{signal:r});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(zt(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>oo(this._controller.signal,()=>u(Yi())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:r}=this;this._map=r.map;try{let s,n;if(await i.load({signal:e}),i.prefetchResources&&await i.prefetchResources({signal:e}),omt(i))s=await i.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new j("layer:view-not-supported","No layerview implementation was found");const l=await this.layerViewImporter.importLayerView(i);zt(e),s="default"in l?new l.default({layer:i,view:r}):new l({layer:i,view:r})}const o=()=>{n=Zr(n),s.destroyed||s.destroy(),s.layer=null,s.parent=null,s.view=null,this.done=!0};n=oo(e,o),zt(e);try{await s.when()}catch(l){throw o(),l}if(!this._map?.allLayers?.includes(i))return o(),void this._deferred.reject(new j("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=s,i.emit("layerview-create",{view:r,layerView:s}),r.emit("layerview-create",{layer:i,layerView:s}),this.done=!0,this._deferred.resolve(s)}catch(s){i.emit("layerview-create-error",{view:r,error:s}),r.emit("layerview-create-error",{layer:i,error:s}),this.done=!0,this._deferred.reject(new j("layerview:create-error","layerview creation failed",{layer:i,error:s}))}}},bp=class extends Fe{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Mv,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const i=this.view.map?.allLayers;if(i)for(const r of i)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=lo(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(dC(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,s=[],n=this.view.ready,o=l=>{if(l!=null){for(const c of l)if(c){r.add(c);const u=this._layerLayerViewInfoMap.get(c);u&&n?u.start():u||this._recyclingInfoMap.has(c)||s.push(c),"layers"in c&&c.layers&&o(c.layers)}}};for(const l of this._rootCollectionNames)o(Jm(this,l));for(const[l,c]of this._layerLayerViewInfoMap)if(!r.has(l)){this._layerLayerViewInfoMap.delete(c.layer);const u=c.tryRecycle(s);u?(this.notifyChange("updating"),this._recyclingInfoMap.set(c.layer,c),u.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),this._layerLayerViewInfoMap.set(c.layer,c),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy(),this._reschedule()})):c.destroy()}for(const[l,c]of this._recyclingInfoMap)r.has(l)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy());for(const l of s)this._createLayerView(l);this._refreshCollections();const a=[i?.ground?.layers,i?.basemap?.baseLayers,i?.basemap?.referenceLayers,i?.layers].filter(l=>!!l);r.forEach(l=>"layers"in l&&a.push(l.layers)),this.addHandles(a.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([qa(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),_e(()=>{const e=this.view,i=e?.map;return[i?.basemap,i?.ground,i?.layers,e?.ready]},()=>this._reschedule(),Sr)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),SW(this._recyclingInfoMap),SW(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Yi()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Pd(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||(SW(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new j("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}isCreatingLayerViewsForLayer(e,i){this.commitProperty("updatingRemaining");const r=this._layerLayerViewInfoMap.get(e);if(!r?.done)return!0;const s=r.layerView;return!(!s||!i||s.parent===i)||!!(r.done&&s&&"layers"in e&&e.layers?.length)&&e.layers.some(n=>this.isCreatingLayerViewsForLayer(n,s))}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(Jm(this,e),Jm(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void(i&&i.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!o?.layerView)continue;const a=o.layerView;a.layer=n,a.parent=r,i.at(s)!==a&&i.splice(s,0,a),"layers"in n&&rmt(a)&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<i.length&&i.splice(s,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new smt(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(En(r)||r.name==="cancelled:layerview-create")||oe.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};d([m()],bp.prototype,"_workPromise",void 0),d([m({readOnly:!0})],bp.prototype,"_watchUpdatingTracking",void 0),d([m({readOnly:!0})],bp.prototype,"_layersToLayerViews",null),d([m({readOnly:!0})],bp.prototype,"_rootCollectionNames",null),d([m()],bp.prototype,"layerViewImporter",void 0),d([m()],bp.prototype,"supportsGround",void 0),d([m({readOnly:!0})],bp.prototype,"updating",null),d([m({readOnly:!0})],bp.prototype,"updatingRemaining",null),d([m({constructOnly:!0})],bp.prototype,"view",void 0),bp=d([N("esri.views.LayerViewManager")],bp);const nmt=bp;function omt(t){return"createLayerView"in t&&t.createLayerView!=null}let ed=class extends Fe{constructor(e){super(e),this.factor=1.5,this.offset=hf(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};d([m({type:Number})],ed.prototype,"factor",void 0),d([m({nonNullable:!0})],ed.prototype,"offset",void 0),d([m()],ed.prototype,"position",void 0),d([m({type:Number,range:{min:0}})],ed.prototype,"size",void 0),d([m()],ed.prototype,"maskUrl",void 0),d([m()],ed.prototype,"maskEnabled",void 0),d([m()],ed.prototype,"overlayUrl",void 0),d([m()],ed.prototype,"overlayEnabled",void 0),d([m({readOnly:!0})],ed.prototype,"version",null),d([m({type:Boolean})],ed.prototype,"visible",void 0),ed=d([N("esri.views.Magnifier")],ed);const aDe=ed;let KV=class{constructor(e){this._observable=new Ck,this._map=new Map(e)}get size(){return Jt(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const i=this._map.delete(e);return i&&this._observable.notify(),i}entries(){return Jt(this._observable),this._map.entries()}forEach(e,i){Jt(this._observable),this._map.forEach((r,s)=>e.call(i,r,s,this),i)}get(e){return Jt(this._observable),this._map.get(e)}has(e){return Jt(this._observable),this._map.has(e)}keys(){return Jt(this._observable),this._map.keys()}set(e,i){return this._map.set(e,i),this._observable.notify(),this}values(){return Jt(this._observable),this._map.values()}[Symbol.iterator](){return Jt(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}};var mie;let IN=mie=class extends we{constructor(t){super(t),this.name=null,this.code=null}clone(){return new mie({name:this.name,code:this.code})}};d([m({type:String,json:{write:!0}})],IN.prototype,"name",void 0),d([m({type:[String,Number],json:{write:!0}})],IN.prototype,"code",void 0),IN=mie=d([N("esri.layers.support.CodedValue")],IN);const amt=new ur({inherited:"inherited",codedValue:"coded-value",range:"range"});let $N=class extends we{constructor(e){super(e),this.name=null,this.type=null}};d([m({type:String,json:{write:!0}})],$N.prototype,"name",void 0),d([Nt(amt)],$N.prototype,"type",void 0),$N=d([N("esri.layers.support.Domain")],$N);const x9=$N;var gie;let NN=gie=class extends x9{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const i=String(t);this.codedValues.some(r=>(String(r.code)===i&&(e=r.name),!!e))}return e}clone(){return new gie({codedValues:ee(this.codedValues),name:this.name})}};d([m({type:[IN],json:{write:!0}})],NN.prototype,"codedValues",void 0),d([Nt({codedValue:"coded-value"})],NN.prototype,"type",void 0),NN=gie=d([N("esri.layers.support.CodedValueDomain")],NN);const lDe=NN;var yie;let eG=yie=class extends x9{constructor(t){super(t),this.type="inherited"}clone(){return new yie}};d([Nt({inherited:"inherited"})],eG.prototype,"type",void 0),eG=yie=d([N("esri.layers.support.InheritedDomain")],eG);const cDe=eG;var _ie;let WA=_ie=class extends x9{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new _ie({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};d([m({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]}}}})],WA.prototype,"maxValue",void 0),d([m({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[0]},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]}}}})],WA.prototype,"minValue",void 0),d([Nt({range:"range"})],WA.prototype,"type",void 0),WA=_ie=d([N("esri.layers.support.RangeDomain")],WA);const uDe=WA,hDe={key:"type",base:x9,typeMap:{range:uDe,"coded-value":lDe,inherited:cDe}};function S9(t){if(!t?.type)return null;switch(t.type){case"range":return uDe.fromJSON(t);case"codedValue":return lDe.fromJSON(t);case"inherited":return cDe.fromJSON(t)}return null}var vie;const lmt=new ur({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Cc=vie=class extends we{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?.value??null}readValueType(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?lmt.fromJSON(i.fieldValueType):null}clone(){return new vie({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain?.clone()??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};d([m({type:String,json:{write:!0}})],Cc.prototype,"alias",void 0),d([m({type:[String,Number],json:{write:{allowNull:!0}}})],Cc.prototype,"defaultValue",void 0),d([m()],Cc.prototype,"description",void 0),d([Le("description")],Cc.prototype,"readDescription",null),d([m({types:hDe,json:{read:{reader:S9},write:!0}})],Cc.prototype,"domain",void 0),d([m({type:Boolean,json:{write:!0}})],Cc.prototype,"editable",void 0),d([m({type:cr,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],Cc.prototype,"length",void 0),d([m({type:String,json:{write:!0}})],Cc.prototype,"name",void 0),d([m({type:Boolean,json:{write:!0}})],Cc.prototype,"nullable",void 0),d([Nt(Sce)],Cc.prototype,"type",void 0),d([m()],Cc.prototype,"valueType",void 0),d([Le("valueType",["description"])],Cc.prototype,"readValueType",null),d([m({type:Boolean,json:{read:!1}})],Cc.prototype,"visible",void 0),Cc=vie=d([N("esri.layers.support.Field")],Cc);const Xk=Cc;var bie;let YA=bie=class extends we{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new bie({mapLayerId:t,gdbVersion:e})}};d([Nt({mapLayer:"map-layer"})],YA.prototype,"type",void 0),d([m({type:cr,json:{write:!0}})],YA.prototype,"mapLayerId",void 0),d([m({type:String,json:{write:!0}})],YA.prototype,"gdbVersion",void 0),YA=bie=d([N("esri.layers.support.source.MapLayerSource")],YA);var wie;let I_=wie=class extends we{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:i,spatialReference:r?.clone()??void 0,geometryType:s};return new wie(n)}};d([Nt({queryTable:"query-table"})],I_.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],I_.prototype,"workspaceId",void 0),d([m({type:String,json:{write:!0}})],I_.prototype,"query",void 0),d([m({type:String,json:{write:!0}})],I_.prototype,"oidFields",void 0),d([m({type:Je,json:{write:!0}})],I_.prototype,"spatialReference",void 0),d([Nt(fF)],I_.prototype,"geometryType",void 0),I_=wie=d([N("esri.layers.support.source.QueryTableDataSource")],I_);var xie;let XA=xie=class extends we{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new xie({workspaceId:t,dataSourceName:e})}};d([Nt({raster:"raster"})],XA.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],XA.prototype,"dataSourceName",void 0),d([m({type:String,json:{write:!0}})],XA.prototype,"workspaceId",void 0),XA=xie=d([N("esri.layers.support.source.RasterDataSource")],XA);var Sie;let CT=Sie=class extends we{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:i}=this;return new Sie({workspaceId:t,gdbVersion:e,dataSourceName:i})}};d([Nt({table:"table"})],CT.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],CT.prototype,"workspaceId",void 0),d([m({type:String,json:{write:!0}})],CT.prototype,"gdbVersion",void 0),d([m({type:String,json:{write:!0}})],CT.prototype,"dataSourceName",void 0),CT=Sie=d([N("esri.layers.support.source.TableDataSource")],CT);var Tie,Eie;const cmt=Yc()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let td=Tie=class extends we{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,i){return V0e()(t,e,i)}castLeftTableSource(t){return ag(Cie(),t)}readRightTableSource(t,e,i){return V0e()(t,e,i)}castRightTableSource(t){return ag(Cie(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:i?.clone()??void 0,rightTableSource:r?.clone()??void 0,joinType:s};return new Tie(n)}};d([Nt({joinTable:"join-table"})],td.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],td.prototype,"leftTableKey",void 0),d([m({type:String,json:{write:!0}})],td.prototype,"rightTableKey",void 0),d([m({json:{write:!0}})],td.prototype,"leftTableSource",void 0),d([Le("leftTableSource")],td.prototype,"readLeftTableSource",null),d([vi("leftTableSource")],td.prototype,"castLeftTableSource",null),d([m({json:{write:!0}})],td.prototype,"rightTableSource",void 0),d([Le("rightTableSource")],td.prototype,"readRightTableSource",null),d([vi("rightTableSource")],td.prototype,"castRightTableSource",null),d([Nt(cmt)],td.prototype,"joinType",void 0),td=Tie=d([N("esri.layers.support.source.JoinTableDataSource")],td);let oY=null;function V0e(){return oY||(oY=AI({types:Cie()})),oY}let aY=null;function Cie(){return aY||(aY={key:"type",base:null,typeMap:{"data-layer":vm,"map-layer":YA}}),aY}const umt={key:"type",base:null,typeMap:{"join-table":td,"query-table":I_,raster:XA,table:CT}};let vm=Eie=class extends we{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new Eie({fields:t,dataSource:e})}};d([Nt({dataLayer:"data-layer"})],vm.prototype,"type",void 0),d([m({type:[Xk],json:{write:!0}})],vm.prototype,"fields",void 0),d([m({types:umt,json:{write:!0}})],vm.prototype,"dataSource",void 0),vm=Eie=d([N("esri.layers.support.source.DataLayerSource")],vm),vm.from=Tn(vm);let MT=class extends ms(we){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};d([m({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],MT.prototype,"onFields",void 0),d([m({type:String,json:{write:!0}})],MT.prototype,"operator",void 0),d([m({type:String,json:{write:!0}})],MT.prototype,"searchTerm",void 0),d([m({type:String,json:{write:!0}})],MT.prototype,"searchType",void 0),MT=d([N("esri.rest.support.FullTextSearch")],MT);const hmt=MT;var Mie;const G0e=new ur({upperLeft:"upper-left",lowerLeft:"lower-left"});let AT=Mie=class extends we{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new Mie(ee({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};d([m({type:lr,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],AT.prototype,"extent",void 0),d([m({type:["view","edit"],json:{write:!0}})],AT.prototype,"mode",void 0),d([m({type:String,json:{read:G0e.read,write:G0e.write}})],AT.prototype,"originPosition",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],AT.prototype,"tolerance",void 0),AT=Mie=d([N("esri.rest.support.QuantizationParameters")],AT);const dmt=AT,pmt=new ur({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var Aie;const j0e=new ur({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let sm=Aie=class extends we{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=ee(t))}clone(){return new Aie({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:ee(this.statisticParameters)})}};d([m({type:Number,json:{write:!0}})],sm.prototype,"maxPointCount",void 0),d([m({type:Number,json:{write:!0}})],sm.prototype,"maxRecordCount",void 0),d([m({type:Number,json:{write:!0}})],sm.prototype,"maxVertexCount",void 0),d([m({type:String,json:{write:!0}})],sm.prototype,"onStatisticField",void 0),d([m({type:String,json:{write:!0}})],sm.prototype,"outStatisticFieldName",void 0),d([m({type:String,json:{read:{source:"statisticType",reader:j0e.read},write:{target:"statisticType",writer:j0e.write}}})],sm.prototype,"statisticType",void 0),d([m({type:Object})],sm.prototype,"statisticParameters",void 0),d([Ve("statisticParameters")],sm.prototype,"writeStatisticParameters",null),sm=Aie=d([N("esri.rest.support.StatisticDefinition")],sm);const fmt=sm;var tG;const mmt=new ur({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let ei=tG=class extends we{static from(t){return SE(tG,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const i={};for(const r in t){const s=t[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}e.parameterValues=i}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new tG(ee({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};ei.MAX_MAX_RECORD_COUNT_FACTOR=5,d([m({json:{write:!0}})],ei.prototype,"aggregateIds",void 0),d([m({type:Boolean,json:{write:!0}})],ei.prototype,"cacheHint",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],ei.prototype,"compactGeometryEnabled",void 0),d([m({json:{write:!0}})],ei.prototype,"datumTransformation",void 0),d([vi("datumTransformation")],ei.prototype,"castDatumTransformation",null),d([m({type:Boolean,json:{default:!1,write:!0}})],ei.prototype,"defaultSpatialReferenceEnabled",void 0),d([m({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],ei.prototype,"distance",void 0),d([m({type:vm,json:{write:!0}})],ei.prototype,"dynamicDataSource",void 0),d([m({type:String,json:{write:!0}})],ei.prototype,"formatOf3DObjects",void 0),d([m({type:[hmt],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],ei.prototype,"fullText",void 0),d([m({type:String,json:{write:!0}})],ei.prototype,"gdbVersion",void 0),d([m({types:gC,json:{read:Vv,write:!0}})],ei.prototype,"geometry",void 0),d([m({type:Number,json:{write:!0}})],ei.prototype,"geometryPrecision",void 0),d([m({type:[String],json:{write:!0}})],ei.prototype,"groupByFieldsForStatistics",void 0),d([m({type:String,json:{write:!0}})],ei.prototype,"having",void 0),d([m({type:Date})],ei.prototype,"historicMoment",void 0),d([Ve("historicMoment")],ei.prototype,"writeHistoricMoment",null),d([m({type:Number,json:{write:!0}})],ei.prototype,"maxAllowableOffset",void 0),d([m({type:Number,cast:t=>t<1?1:t>ei.MAX_MAX_RECORD_COUNT_FACTOR?ei.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],ei.prototype,"maxRecordCountFactor",void 0),d([m({type:["xyFootprint"],json:{write:!0}})],ei.prototype,"multipatchOption",void 0),d([m({type:Number,json:{read:{source:"resultRecordCount"}}})],ei.prototype,"num",void 0),d([m({json:{write:!0}})],ei.prototype,"objectIds",void 0),d([m({type:[String],json:{write:!0}})],ei.prototype,"orderByFields",void 0),d([m({type:[String],json:{write:!0}})],ei.prototype,"outFields",void 0),d([m({type:Je,json:{name:"outSR",write:!0}})],ei.prototype,"outSpatialReference",void 0),d([m({type:[fmt],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],ei.prototype,"outStatistics",void 0),d([m({json:{write:!0}})],ei.prototype,"parameterValues",void 0),d([Ve("parameterValues")],ei.prototype,"writeParameterValues",null),d([m({type:$t,json:{write:!0}})],ei.prototype,"pixelSize",void 0),d([m({type:dmt,json:{write:!0}})],ei.prototype,"quantizationParameters",void 0),d([m({type:[Object],json:{write:!0}})],ei.prototype,"rangeValues",void 0),d([m({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],ei.prototype,"relationParameter",void 0),d([m({type:String,json:{write:!0}})],ei.prototype,"resultType",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],ei.prototype,"returnCentroid",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],ei.prototype,"returnDistinctValues",void 0),d([m({type:Boolean,json:{default:!0,write:!0}})],ei.prototype,"returnExceededLimitFeatures",void 0),d([m({type:Boolean,json:{write:!0}})],ei.prototype,"returnGeometry",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],ei.prototype,"returnQueryGeometry",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],ei.prototype,"returnM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ei.prototype,"returnZ",void 0),d([m({type:Je,json:{write:!0}})],ei.prototype,"sourceSpatialReference",void 0),d([Nt(pmt,{ignoreUnknown:!1,name:"spatialRel"})],ei.prototype,"spatialRelationship",void 0),d([m({type:Number,json:{read:{source:"resultOffset"}}})],ei.prototype,"start",void 0),d([Ve("start"),Ve("num")],ei.prototype,"writeStart",null),d([m({type:String,json:{write:!0}})],ei.prototype,"sqlFormat",void 0),d([m({type:String,json:{write:!0}})],ei.prototype,"text",void 0),d([m({type:wl,json:{write:!0}})],ei.prototype,"timeExtent",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],ei.prototype,"timeReferenceUnknownClient",void 0),d([Nt(mmt,{ignoreUnknown:!1}),m({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],ei.prototype,"units",void 0),d([m({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],ei.prototype,"where",void 0),d([Ve("where")],ei.prototype,"writeWhere",null),ei=tG=d([N("esri.rest.support.Query")],ei);const Sh=ei;function HU(t){return!!(t!=null&&typeof t=="object"&&"createQuery"in t&&t.createQuery&&"on"in t&&t.on)}let $_=class extends un.EventedAccessor{constructor(e){super(e),this._selectionMap=new KV,this._sources=new ct,this._trashCan=[],this._layerEditHandles=new ct,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([_e(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),qa(()=>this.sources,"change",i=>{const r=this._selectionMap;for(const s of i.removed)r.delete(s);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new ct;this.view.when().then(()=>{this.view.map&&(this.view.map.allLayers.flatten(i=>"sublayers"in i&&i.sublayers?i.sublayers:null).forEach(i=>{(HU(i)&&!JKe(i)||oT(i))&&e.add(i)}),this.sources=e)})}destroy(){this._layerEditHandles.drain(Zr)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[i,r]=e;return{layer:i,selection:[...r.selection]}})}get count(){let e=0;for(const i of this._selectionMap.values())e+=i.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){y0(e,this._sources)}async getSelectedFeatures(e,i={},r="layerView"){const{view:s,selections:n}=this,o=(e!==void 0?n.filter(a=>e.includes(a.layer)):n).filter(a=>a.selection.length>0).map(async a=>{const{layer:l,selection:c}=a,u=oT(l)?l.parent:l;if(u==null||!q0e(u))return null;if(r==="layer")return W0e(u,c,i);if(H0e(u))return null;const h=await s.whenLayerView(u).catch(()=>null);return h?W0e(h,c,i):null});return(await Promise.all(o)).filter(a=>a!=null)}updateSelection(e){const i=new Map;for(const[n,o]of this._selectionMap)i.set(n,[...o.selection]);let r=!1;const s=e.current.concat(e.added);for(const n of s){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(HU(o)||oT(o))&&a!==null){const l=pq(i,o,()=>[]);l.includes(a)||(l.push(a),r=!0)}}for(const n of e.removed){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(HU(o)||oT(o))&&a!==null){const l=i.get(o),c=l?.indexOf(a);c!==void 0&&c>=0&&(l?.splice(c,1),r=!0)}}if(r){const{_selectionMap:n,_trashCan:o}=this,a=[];for(const[l,c]of i){const u=n.get(l);u!==void 0&&o.push(u),n.set(l,{selection:c}),a.push({layer:l,selection:c,...HQ(u!==void 0?u.selection:[],c)})}this._onSelectionChange(a)}}setSelection(e,i){this._setSelection(e,i)}getSelection(e){return this._selectionMap.get(e)?.selection}appendToSelection(e,i){const r=this._selectionMap.get(e),s=r!==void 0?[...r.selection]:[];for(const n of i)s.includes(n)||s.push(n);this._setSelection(e,s)}removeFromSelection(e,i){const r=this._selectionMap.get(e);if(!r)return;const s=[];for(const n of r.selection)i.includes(n)||s.push(n);this._setSelection(e,s)}toggleInSelection(e,i){const r=this._selectionMap.get(e);if(!r||r.selection.length===0)return void this._setSelection(e,i);const s=new Set(r.selection),n=new Set(i),o=bZe(s,n);this._setSelection(e,Array.from(o))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const i=[];for(const[r,s]of this._selectionMap.entries())i.push({layer:r,added:[],removed:[...s.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(i)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;)this._trashCan.pop()?.highlightHandle?.remove();const{sources:e,view:i,_selectionMap:r,showHighlight:s}=this,n=this._vizTaskId;for(const o of e){const a=r.get(o),l=oT(o)?o.parent:o;if(l!=null&&q0e(l)){if(H0e(l))continue;i.whenLayerView(l).then(c=>{a?.highlightHandle?.remove(),a!=null&&s&&n===this._vizTaskId&&"highlight"in c&&typeof c.highlight=="function"&&a.selection.length>0&&(a.highlightHandle=c.highlight(a.selection,"selection"))}).catch(()=>{a?.highlightHandle?.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(Zr);for(const e of this.sources){const i=oT(e)?e.parent:e;if(i!=null&&HU(i)){const r=i.on("edits",s=>{this._handleEditChanges(s,e)});this._layerEditHandles.push(r)}}}_handleEditChanges(e,i){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(i)){const r=e.deletedFeatures.filter(s=>s.error==null).map(s=>s.objectId).filter(Rx);this.removeFromSelection(i,r)}}_setSelection(e,i){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const r=this._selectionMap.get(e);if(r===void 0||!ymt(r,{selection:i})){r!==void 0&&this._trashCan.push(r),this._selectionMap.set(e,{selection:[...i]});const s={layer:e,selection:[...i],...HQ(r!==void 0?r.selection:[],i)};this._onSelectionChange([s])}}};d([m({readOnly:!0,nonNullable:!0})],$_.prototype,"selections",null),d([m({readOnly:!0,nonNullable:!0})],$_.prototype,"count",null),d([m({constructOnly:!0,nonNullable:!0})],$_.prototype,"view",void 0),d([m({readOnly:!0,nonNullable:!0})],$_.prototype,"hasSelection",null),d([m()],$_.prototype,"showHighlight",void 0),d([m()],$_.prototype,"sources",null),$_=d([N("esri.views.SelectionManager")],$_);const H0e=t=>oT(t)?t.parent?.isTable===!0:t.isTable,gmt=t=>t.layer!==void 0,q0e=t=>t?.when!==void 0,ymt=(t,e)=>{if(t==null&&e==null)return!0;if(t!=null&&e==null||t==null&&e!=null)return!1;if(t!=null&&e!=null&&t.selection!=null&&e.selection!=null){const i=[...t.selection],r=[...e.selection];if(i.length!==r.length)return!1;i.sort(),r.sort();for(let s=0;s<i.length;s++)if(i[s]!==r[s])return!1}return!0},W0e=async(t,e,i={})=>{let r;if(gmt(t)){const s=t;r=s===void 0?null:await s.queryFeatures(new Sh({...i,objectIds:e})).then(n=>({data:n,layer:t.layer}))}else{const s=t;r=s===void 0?null:await s.queryFeatures(new Sh({...i,objectIds:e})).then(n=>({data:n,layer:s}))}return r},_mt=$_;let LN=class extends ms(Fe){constructor(e){super(e),this.accentColor=new Ke([255,127,0]),this.textColor=new Ke([255,255,255])}};d([m({type:Ke,nonNullable:!0})],LN.prototype,"accentColor",void 0),d([m({type:Ke,nonNullable:!0})],LN.prototype,"textColor",void 0),LN=d([N("esri.views.Theme")],LN);const Rie=LN;var Y0e;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(Y0e||(Y0e={}));const dDe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],pDe={};function fDe(t){return!!pDe[t]}function vmt(t){for(const e of t)if(!fDe(e))return!1;return!0}dDe.forEach(t=>{pDe[t]=!0});let bmt=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},s)=>this.inputManager?.installHandlers(s,[i],r))}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>this.inputManager?.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,s){const n=Array.isArray(e)?e:e.split(",");if(!vmt(n))return n.some(fDe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s??Dw.DEFAULT;const l=this._createUniqueGroupName(),c=new wmt(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const u of n){const h=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,h+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),er(()=>this._removeHandler(l,n))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const s=this._handlerCounts.get(r);s===void 0||(s===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,s-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},wmt=class extends Ja{constructor(e,i,r,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(Tmt(e,o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(Emt(e,o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(Cmt(e,o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(Mmt(e,o)));break;case"hold":this.registerIncoming("hold",r,o=>s(Amt(e,o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(Rmt(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(Pmt(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(W$(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(W$(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(W$(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(Omt(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(Imt(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(W$(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(W$(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s($mt(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(xmt(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(Smt(o))})}}_wrapDrag(e){const i=e.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:u,timestamp:h}=e,p={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:p,pointerType:o,button:a,buttons:c,radius:i.radius,angle:El(i.angle),native:l,timestamp:h,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}};function xmt(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function Smt(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function Tmt(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:u,screenPoint:hf(n,o),mapPoint:Zk(t,n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}function Emt(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:u,mapPoint:Zk(t,n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}function Cmt(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:h}=e;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:Zk(t,n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}function Mmt(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:h}=e;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:Zk(t,n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}function Amt(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:Zk(t,n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}function Zk(t,e,i){return t.toMap(hf(e,i),{exclude:[]})}function Rmt(t){const{key:e,repeat:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-down",key:e,repeat:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}function Pmt(t){const{key:e,native:i}=t.data,{cancelable:r,timestamp:s}=t;return{type:"key-up",key:e,native:i,timestamp:s,cancelable:r,stopPropagation:()=>t.stopPropagation(),async:n=>t.async(n),preventDefault:()=>t.preventDefault()}}function W$(t,e){const{x:i,y:r,button:s,buttons:n,native:o,eventId:a}=t.data,l=o.pointerId,c=o.pointerType,{cancelable:u,timestamp:h}=t;return{type:e,x:i,y:r,pointerId:l,pointerType:c,button:s,buttons:n,native:o,timestamp:h,eventId:a,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}function Omt(t){const{x:e,y:i,buttons:r,native:s,eventId:n}=t.data.currentEvent,{button:o}=t.data.startEvent,a=t.data.startEvent.native.pointerId,l=t.data.startEvent.native.pointerType,c=t.data.action,u={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:h,timestamp:p}=t;return{type:"pointer-drag",x:e,y:i,pointerId:a,pointerType:l,button:o,buttons:r,action:c,origin:u,native:s,timestamp:p,eventId:n,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}function Imt(t){const{cancelable:e,data:i,timestamp:r}=t,{x:s,y:n,deltaY:o,native:a}=i;return{type:"mouse-wheel",x:s,y:n,deltaY:o,native:a,timestamp:r,cancelable:e,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}function $mt(t){const{action:e,state:i,device:r}=t.data,{cancelable:s,timestamp:n}=t,{buttons:o,axes:a}=i;return{type:"gamepad",device:r,timestamp:n,action:e,buttons:o,axes:a,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}var CF,X0e,Z0e;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(CF||(CF={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(X0e||(X0e={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(Z0e||(Z0e={}));function Nmt(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return oe.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function Pie(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(CF.USER)&&t.getEditableFlag(CF.MANAGER)}function hy(t){return hf(t.x,t.y)}function Ndi(t){return Hs(t.x,t.y)}function mDe(t,e){const i=(t instanceof HTMLElement?t:t.surface)?.getBoundingClientRect();return i?hf(e.clientX-i.left,e.clientY-i.top):hf(0,0)}function J0e(t,e){return e instanceof Event?mDe(t,e):hy(e)}function Q0e(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let Lmt=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":e_e(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!t_e(e))break;const s=hy(e),n=aM(s,e.pointerType,i.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._releaseManipulatorBeforeDragging(o,e,i),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!t_e(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=s?.manipulator,o=s?.tool;if(n==null||o==null)break;const a=hy(e);a.x=$e(a.x,0,i.view.width),a.y=$e(a.y,0,i.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const s=hy(e),n=aM(s,e.pointerType,i.forEachTool);if(Dmt(e)||i.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:h})=>{h.selected&&(h.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r}),lY(o,r);break}case"click":{const s=hy(e),n=aM(s,e.pointerType,i.forEachTool),o=n?.manipulator;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),r();break}case"double-click":{const s=hy(e),n=aM(s,e.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),lY(o,r);break}case"immediate-double-click":{const s=hy(e),n=aM(s,e.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),lY(o,r);break}}this._onFocusChange(i.forEachTool)}_releaseManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:hy(i)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorRelease(r.setActiveTool)}_handlePointerEnd(e,i){const r=this._grabbedManipulators.get(e.pointerId)?.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:hy(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=K0e(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=K0e(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:s})=>{i.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{r.add(s)}),e(s=>{s.hasGrabbedManipulators=i.has(s),s.hasHoveredManipulators=r.has(s);const n=this._grabbedManipulators.values(),o=AXe(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:r},s=!0,n){const o=(a,l)=>a===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorRelease(r),this._onFocusChange(i)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(hf(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!e_e(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(hy(e),e.pointerId,e.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(e,i,r,s){let n=aM(e,r,s);const o=this._hoveredManipulators.get(i)?.manipulator;n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(i,n)):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function K0e(t){let e=null;return Pd(t,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(e=i.grabCursor,!0):!!i.cursor&&(e=i.cursor,!0))),e}function aM(t,e,i){let r=null;return i(s=>{if(s.manipulators==null||!Pie(s))return!1;const n=s.manipulators.intersect(t,e);return n!=null&&(r={tool:s,manipulator:n},!0)}),r}function e_e(t){return t==="mouse"}function t_e(t){return t.pointerType!=="mouse"||t.button===0}function Dmt(t){return!!t.native.shiftKey}function lY(t,e){t?.consumesClicks&&e()}const i_e="attached",cY="tools",Fmt=1e3;let dy=class extends Fe{constructor(e){super(e),this._updatingHandles=new Mv,this._clock=wk,this._manipulatorState=new Lmt,this.tools=new ct,this.cursor=null,this._interacting=!1,this._interactingTimeout=Fmt,this._interactingTimeoutHandle=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.addHandles([this.view.on(dDe,e=>{this._handleInputEvent(e)},Dw.TOOL),...Nmt(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void oe.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const s=Pie(r);this.activeTool!=null&&s||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=Zr(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){this.view.type==="3d"?this.addHandles([_e(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider?.on("elevation-change",e=>this._forEachManipulator(i=>i.onElevationChange(e)))],i_e):this.addHandles(_e(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(i_e),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))})}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(s=>{!i&&s.visible&&s.handleInputEvent(r)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(cY),this._forEachTool(e=>{if(e instanceof Fe){const i=_e(()=>[e.cursor,e.visible,e.editable],()=>{Pie(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(i,cY)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],cY)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(CF.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(i=>!(i.cursor==null||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){}};d([m({constructOnly:!0,nonNullable:!0})],dy.prototype,"view",void 0),d([m({value:null})],dy.prototype,"activeTool",null),d([m({readOnly:!0,type:ct})],dy.prototype,"tools",void 0),d([m({readOnly:!0})],dy.prototype,"cursor",void 0),d([m({readOnly:!0})],dy.prototype,"updating",null),d([m()],dy.prototype,"_interacting",void 0),d([m({readOnly:!0})],dy.prototype,"interacting",null),dy=d([N("esri.views.ToolViewManager")],dy);let ZA=class extends Fe{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":kmt.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Umt[this.deviceType]}};d([m({nonNullable:!0,readOnly:!0})],ZA.prototype,"nativeIndex",void 0),d([m({type:String,readOnly:!0})],ZA.prototype,"deviceType",null),d([m({type:Number,readOnly:!0})],ZA.prototype,"axisThreshold",null),ZA=d([N("esri.views.input.gamepad.GamepadInputDevice")],ZA);const Oue=ZA,kmt=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Umt={standard:.15,spacemouse:.025,unknown:0};let DN=class extends Fe{constructor(...e){super(...e),this.devices=new ct,this.enabledFocusMode="document"}};d([m({type:ct.ofType(Oue),readOnly:!0})],DN.prototype,"devices",void 0),d([m({type:["document","view","none"]})],DN.prototype,"enabledFocusMode",void 0),DN=d([N("esri.views.input.gamepad.GamepadSettings")],DN);const Bmt=DN;let iG=class extends Fe{constructor(){super(...arguments),this.gamepad=new Bmt}};d([m({readOnly:!0})],iG.prototype,"gamepad",void 0),iG=d([N("esri.views.input.Input")],iG);const zmt=iG,Vmt=()=>gr.respectPrefersReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;let Rb=class extends Fe{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};d([m({type:Boolean,nonNullable:!0})],Rb.prototype,"enabled",void 0),d([m({type:Oue})],Rb.prototype,"device",void 0),d([m({type:["pan","zoom"],nonNullable:!0})],Rb.prototype,"mode",void 0),d([m({type:["forward-down","forward-up"],nonNullable:!0})],Rb.prototype,"tiltDirection",void 0),d([m({type:Number,nonNullable:!0})],Rb.prototype,"velocityFactor",void 0),Rb=d([N("esri.views.navigation.gamepad.GamepadSettings")],Rb);const gDe=Rb;let RT=class extends Fe{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new gDe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!Vmt()}};d([m({type:Boolean})],RT.prototype,"browserTouchPanEnabled",void 0),d([m({type:gDe,nonNullable:!0})],RT.prototype,"gamepad",void 0),d([m({type:Boolean})],RT.prototype,"momentumEnabled",void 0),d([m({type:Boolean})],RT.prototype,"mouseWheelZoomEnabled",void 0),RT=d([N("esri.views.navigation.Navigation")],RT);const yDe=RT;let Oie,uY=null;async function Gmt(t){uY||(uY=ye(()=>Promise.resolve().then(()=>A4t),void 0,import.meta.url).then(e=>Oie=e)),await uY,zt(t)}async function _De(t,e,i,r){if(!t)return null;const s=t.spatialReference;return DI()||Fu(s,e)?Nx(t,e):Oie?Oie.projectGeometry(t,e,i,r):(await Promise.race([Gmt(r),IO(r)]),_De(t,e,i,r))}let Os=class extends Fe{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=qc(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){const e=this.map?.(),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),i}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;let r=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(r,o);a!=null&&(r=a)}if(r!=null&&r.length===1)break}if(i&&(r==null||r.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(r);return{spatialReference:s?.spatialReference??null,viewingMode:s?.viewingMode??null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:i}=this._collectLayers([{parent:this.map?.()?.basemap,layers:this.map?.()?.basemap?.baseLayers},{layers:this.map?.()?.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const r=e[0].tileInfo;return{tileInfo:r?.spatialReference.equals(this.spatialReference)?r:null,updating:!1}}return{updating:i}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;for(const r of e)if(dnt(r)){const s=n$e(r);if(s)return{heightModelInfo:s,vcsWkid:r.spatialReference?.vcsWkid,latestVcsWkid:r.spatialReference?.latestVcsWkid,updating:!1}}return{updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,i=e.updating,r=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)r.push({extent:l,layer:s})}return{candidates:r,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),s=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=qc(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:s.clone(),task:P0(async n=>{try{const o=await _De(r.extent,s,"portalItem"in r.layer?r.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(va(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const r=new Array;for(const s of e)for(const n of i){if(!s.spatialReference.equals(n.spatialReference))continue;const o=Hmt(s.viewingMode,n.viewingMode);if(o!==!1){r.push({spatialReference:s.spatialReference,viewingMode:o});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==Xe.Local)&&(e=e.filter(({viewingMode:r})=>r!==Xe.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const s of i){const n=this.getSpatialReferenceSupport(s,e);if(n!=null){const o=n.constraints??[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||r.push({spatialReference:a,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e){if(this._loadMaybe(this.map?.())!=="loaded")return{layers:[],updating:!0};const i=new jmt;for(const r of e)if(this._collectCollection(r,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":i.updating||i.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{En(i)||console.log(i)}),"loading"):e.loadStatus:"loaded"}};d([m()],Os.prototype,"required",void 0),d([m({constructOnly:!0})],Os.prototype,"map",void 0),d([m({constructOnly:!0})],Os.prototype,"getSpatialReferenceSupport",void 0),d([m()],Os.prototype,"defaultSpatialReference",void 0),d([m()],Os.prototype,"userSpatialReference",void 0),d([m()],Os.prototype,"sourcePreloadCount",void 0),d([m()],Os.prototype,"priorityCollection",void 0),d([m()],Os.prototype,"requiresExtentInSpatialReference",void 0),d([m()],Os.prototype,"suspended",void 0),d([m({readOnly:!0})],Os.prototype,"ready",null),d([m({readOnly:!0})],Os.prototype,"heightModelInfoReady",null),d([m({readOnly:!0})],Os.prototype,"spatialReference",null),d([m({readOnly:!0})],Os.prototype,"extent",null),d([m({readOnly:!0})],Os.prototype,"heightModelInfo",null),d([m({readOnly:!0})],Os.prototype,"vcsWkid",null),d([m({readOnly:!0})],Os.prototype,"latestVcsWkid",null),d([m({readOnly:!0})],Os.prototype,"viewingMode",null),d([m({readOnly:!0})],Os.prototype,"tileInfo",null),d([m({readOnly:!0})],Os.prototype,"mapCollections",null),d([m({readOnly:!0})],Os.prototype,"_allLayers",null),d([m({readOnly:!0})],Os.prototype,"_spatialReferenceTask",null),d([m({readOnly:!0})],Os.prototype,"_tileInfoTask",null),d([m({readOnly:!0})],Os.prototype,"_heightModelInfoTask",null),d([m({readOnly:!0})],Os.prototype,"_extentCandidatesTask",null),d([m()],Os.prototype,"_extentTask",null),d([m()],Os.prototype,"_projectExtentTask",void 0),Os=d([N("esri.views.support.DefaultsFromMap")],Os);let jmt=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};function Hmt(t,e){return t!=null?e!=null?t===e&&t:t:e}var FN;let qt=FN=class extends un.EventedMixin(Mk(Fe)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new A0,this.updatingHandles=new Mv,this.allLayerViews=new dF({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:Wmt}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new pD,this.analyses=new kO,this.typeSpecificPreconditionsReady=!0,this.layerViews=new ct,this.magnifier=new aDe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new zmt,this.navigation=new yDe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new bmt(this),this.persistableViewModels=new ct,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(_e(()=>this.preconditionsReady,e=>{const i=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,FN.views.add(this)):(this._lockedSpatialReference=null,FN.views.remove(this)),this.notifyChange("spatialReference"),!e&&i)this.toolViewManager?.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown();else if(e&&!i){try{this._startup()}catch(r){return void queueMicrotask(()=>{this.fatalError=new j("startup-error",null,r)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},Mr))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,SO(()=>this.ready)))),this.basemapView=new Ab({view:this}),this.layerViewManager=new nmt({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new dy({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new _mt({view:this}),this.addHandles([_e(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},Sr),_e(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},Mr),_e(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},Sr)])}_setupSpatialReferenceLogger(){let t=null;this.addHandles([_e(()=>this.defaultsFromMap?.ready,e=>{const i=this.map?.allLayers.length>0;if(e&&!this.spatialReference&&i){if(t!=null)return;const r=er(()=>t=qc(t));t=P0(async s=>{try{await eF(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{t=null}oe.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(r,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){this.destroyed||(FN.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Ge(this.graphics),this.analyses=Ge(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Ge(this.analysisViewManager),this.toolViewManager=Ge(this.toolViewManager),this.layerViewManager=Ge(this.layerViewManager),this.selectionManager=Ge(this.selectionManager),this.basemapView=Ge(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach(t=>t.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=Ge(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return oe.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Os({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(t,e)=>this.getSpatialReferenceSupport(t,e),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||lg.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t?.destroyed&&(oe.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),lg.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get spatialReference(){const t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(t&&this.defaultsFromMap?.required?.heightModelInfo){const e=t.clone();return e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,e}return t}set spatialReference(t){const e=!Bs(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??_0}set timeZone(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(r=>r.toLowerCase()));this._userTimeZone=t,t===_0||t===LE||e.has(t.toLowerCase())||i.has(t.toLowerCase())||oe.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){return this.toolViewManager?.cursor??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new Rie}whenLayerView(t){return this.layerViewManager?.whenLayerView(t)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}getDefaultTimeZone(){return null}importLayerView(t){throw new j("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport(t)!=null}when(t,e){return this.isResolved()&&!this.ready&&oe.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(Du(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};qt.views=new ct,d([m()],qt.prototype,"_userSpatialReference",void 0),d([m()],qt.prototype,"activeTool",null),d([m({readOnly:!0})],qt.prototype,"allLayerViews",void 0),d([m()],qt.prototype,"groundView",void 0),d([m()],qt.prototype,"animation",null),d([m()],qt.prototype,"basemapView",void 0),d([m()],qt.prototype,"center",null),d([m({readOnly:!0})],qt.prototype,"_defaultsFromMapSettings",null),d([m()],qt.prototype,"defaultsFromMap",null),d([m()],qt.prototype,"fatalError",void 0),d([m({type:lr})],qt.prototype,"extent",null),d([m(Gee(pD,"graphics"))],qt.prototype,"graphics",void 0),d([m(Gee(kO,"analyses"))],qt.prototype,"analyses",void 0),d([m({readOnly:!0,type:$x})],qt.prototype,"heightModelInfo",null),d([m({readOnly:!0})],qt.prototype,"interacting",null),d([m({readOnly:!0})],qt.prototype,"navigating",null),d([m({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],qt.prototype,"preconditionsReady",null),d([m({readOnly:!0})],qt.prototype,"typeSpecificPreconditionsReady",void 0),d([m({type:ct,readOnly:!0})],qt.prototype,"layerViews",void 0),d([m()],qt.prototype,"resolution",null),d([m({type:aDe})],qt.prototype,"magnifier",void 0),d([m({value:null,type:PIe})],qt.prototype,"map",null),d([m()],qt.prototype,"padding",void 0),d([m({readOnly:!0})],qt.prototype,"ready",void 0),d([m({type:Je})],qt.prototype,"spatialReference",null),d([m()],qt.prototype,"spatialReferenceWarningDelay",void 0),d([m()],qt.prototype,"stationary",null),d([m({readOnly:!0})],qt.prototype,"supportsGround",void 0),d([m({type:wl})],qt.prototype,"timeExtent",void 0),d([m({type:String,nonNullable:!0})],qt.prototype,"timeZone",null),d([m()],qt.prototype,"tools",null),d([m()],qt.prototype,"toolViewManager",void 0),d([m({readOnly:!0})],qt.prototype,"type",void 0),d([m({type:Number})],qt.prototype,"scale",void 0),d([m({readOnly:!0})],qt.prototype,"updating",void 0),d([m({readOnly:!0})],qt.prototype,"initialExtentRequired",void 0),d([m({readOnly:!0})],qt.prototype,"initialExtent",null),d([m()],qt.prototype,"cursor",null),d([m({readOnly:!0})],qt.prototype,"input",void 0),d([m({type:yDe,nonNullable:!0})],qt.prototype,"navigation",void 0),d([m()],qt.prototype,"layerViewManager",void 0),d([m()],qt.prototype,"analysisViewManager",void 0),d([m()],qt.prototype,"selectionManager",void 0),d([m()],qt.prototype,"width",void 0),d([m()],qt.prototype,"height",void 0),d([m({readOnly:!0})],qt.prototype,"resizing",void 0),d([m({value:null,readOnly:!0})],qt.prototype,"size",null),d([m({readOnly:!0})],qt.prototype,"suspended",void 0),d([m({readOnly:!0})],qt.prototype,"viewEvents",void 0),d([m({readOnly:!0})],qt.prototype,"persistableViewModels",void 0),d([m()],qt.prototype,"_isValid",void 0),d([m()],qt.prototype,"_readyCycleForced",void 0),d([m()],qt.prototype,"_lockedSpatialReference",void 0),d([m()],qt.prototype,"_userTimeZone",void 0),d([m()],qt.prototype,"_lockedTimeZone",void 0),d([m({type:Rie})],qt.prototype,"theme",void 0),d([m({readOnly:!0,type:Rie})],qt.prototype,"effectiveTheme",null),qt=FN=d([N("esri.views.View")],qt);const qmt=qt;function Wmt(t){return t.layerViews}let Pb=class extends ej{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=lo(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new j("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,i){i||(i=Lh(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};d([m({readOnly:!0})],Pb.prototype,"done",null),d([m({readOnly:!0,type:String})],Pb.prototype,"state",void 0),d([m()],Pb.prototype,"target",void 0),Pb=d([N("esri.views.ViewAnimation")],Pb),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Pb||(Pb={}));const qO=Pb,Y$=()=>ye(()=>import("./TileLayerView3D-d2501d0e.js"),["./TileLayerView3D-d2501d0e.js","./LayerView3D-2ec8e4f7.js","./TiledLayerView3D-4f84aab1.js","./fetchTile-ec8a02ea.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js","./MapServiceLayerViewHelper-2ae1d5c7.js","./floorFilterUtils-73949d2d.js","./drapedUtils-382a838f.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./sublayerUtils-3862e7fb.js","./popupUtils-5d416a17.js"],import.meta.url),r_e=()=>ye(()=>import("./ElevationLayerView3D-82a16d09.js"),["./ElevationLayerView3D-82a16d09.js","./LercDecoder-daf762ae.js","./WorkerHandle-ce022e20.js","./LayerView3D-2ec8e4f7.js","./TiledLayerView3D-4f84aab1.js","./LayerView-ba0f2b5f.js"],import.meta.url),s_e={"base-dynamic":()=>ye(()=>import("./BaseDynamicLayerView3D-15c16271.js"),["./BaseDynamicLayerView3D-15c16271.js","./DynamicLayerView3D-5a23ab5a.js","./LayerView3D-2ec8e4f7.js","./projectExtentUtils-8de2a3e3.js","./ImageMaterial-a207fb63.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js"],import.meta.url),"base-elevation":r_e,"base-tile":Y$,"bing-maps":Y$,"building-scene":()=>ye(()=>import("./BuildingSceneLayerView3D-f1a6de16.js"),["./BuildingSceneLayerView3D-f1a6de16.js","./BuildingGroupSublayer-c788096c.js","./BuildingComponentSublayer-7bc9461e.js","./capabilities-c607cf72.js","./I3SIndexInfo-a950e410.js","./I3SLayerDefinitions-84fb5d7d.js","./I3SUtil-c01a900c.js","./I3SBinaryReader-1b3cb0df.js","./popupUtils-5d416a17.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./I3SMeshView3D-3ac2f924.js","./Transform-bd0956fc.js","./RenderTexture-9dec843b.js","./I3SOverrides-65e52ae4.js","./I3SNode-a6acb4a5.js","./ReactiveSet-e908c60f.js","./meshFeatureSet-7f3ad483.js","./Mesh-8f965193.js","./MeshTransform-aee14b25.js","./vertexSpaceConversion-6cc95785.js","./External-882ffaa7.js","./infoFor3D-a657d595.js","./FeatureLayerView3D-6941216f.js","./FeatureLayerViewBase3D-220c8345.js","./Graphics3DGraphicsPipeline-2a2c31c1.js","./timeSupport-f551a50b.js","./projectExtentUtils-8de2a3e3.js","./dehydratedFeatureComparison-a1edeb0b.js","./queryForSymbologySnapping-66104d6b.js","./hash-6f442295.js","./Graphics3DObjectStates-867041f5.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./floorFilterUtils-73949d2d.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./LayerView3D-2ec8e4f7.js","./query-f1663770.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./WorkerHandle-ce022e20.js","./EventedSet-40d1e127.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js","./SceneModification-16e5a268.js","./persistable-af6fed38.js","./resourceExtension-6143fef8.js","./SceneLayerWorker-f9ff4eca.js","./makeScheduleFunction-e2d1207a.js","./I3SQueryFeatureStore-c86422c6.js","./TemporalSceneLayerView-c4674d00.js"],import.meta.url),catalog:()=>ye(()=>import("./CatalogLayerView3D-41830fed.js"),["./CatalogLayerView3D-41830fed.js","./LayerView3D-2ec8e4f7.js","./LayerView-ba0f2b5f.js"],import.meta.url),"catalog-dynamic-group":()=>ye(()=>import("./CatalogDynamicGroupLayerView3D-913b33fc.js"),["./CatalogDynamicGroupLayerView3D-913b33fc.js","./LayerView3D-2ec8e4f7.js","./LayerView-ba0f2b5f.js"],import.meta.url),"catalog-footprint":()=>ye(()=>import("./CatalogFootprintLayerView3D-72320573.js"),["./CatalogFootprintLayerView3D-72320573.js","./FeatureLayerViewBase3D-220c8345.js","./Graphics3DGraphicsPipeline-2a2c31c1.js","./timeSupport-f551a50b.js","./projectExtentUtils-8de2a3e3.js","./dehydratedFeatureComparison-a1edeb0b.js","./queryForSymbologySnapping-66104d6b.js","./hash-6f442295.js","./Graphics3DObjectStates-867041f5.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./popupUtils-5d416a17.js","./floorFilterUtils-73949d2d.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./LayerView3D-2ec8e4f7.js","./query-f1663770.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./WorkerHandle-ce022e20.js","./EventedSet-40d1e127.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js"],import.meta.url),csv:()=>ye(()=>import("./CSVLayerView3D-eaa0692f.js"),["./CSVLayerView3D-eaa0692f.js","./FeatureLayerViewBase3D-220c8345.js","./Graphics3DGraphicsPipeline-2a2c31c1.js","./timeSupport-f551a50b.js","./projectExtentUtils-8de2a3e3.js","./dehydratedFeatureComparison-a1edeb0b.js","./queryForSymbologySnapping-66104d6b.js","./hash-6f442295.js","./Graphics3DObjectStates-867041f5.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./popupUtils-5d416a17.js","./floorFilterUtils-73949d2d.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./LayerView3D-2ec8e4f7.js","./query-f1663770.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./WorkerHandle-ce022e20.js","./EventedSet-40d1e127.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js"],import.meta.url),dimension:()=>ye(()=>import("./DimensionLayerView3D-95aaa853.js"),["./DimensionLayerView3D-95aaa853.js","./LayerView3D-2ec8e4f7.js","./LayerView-ba0f2b5f.js"],import.meta.url),elevation:r_e,feature:()=>ye(()=>import("./FeatureLayerView3D-6941216f.js"),["./FeatureLayerView3D-6941216f.js","./FeatureLayerViewBase3D-220c8345.js","./Graphics3DGraphicsPipeline-2a2c31c1.js","./timeSupport-f551a50b.js","./projectExtentUtils-8de2a3e3.js","./dehydratedFeatureComparison-a1edeb0b.js","./queryForSymbologySnapping-66104d6b.js","./hash-6f442295.js","./Graphics3DObjectStates-867041f5.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./popupUtils-5d416a17.js","./floorFilterUtils-73949d2d.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./LayerView3D-2ec8e4f7.js","./query-f1663770.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./WorkerHandle-ce022e20.js","./EventedSet-40d1e127.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js"],import.meta.url),geojson:()=>ye(()=>import("./GeoJSONLayerView3D-3513ec2c.js"),["./GeoJSONLayerView3D-3513ec2c.js","./FeatureLayerViewBase3D-220c8345.js","./Graphics3DGraphicsPipeline-2a2c31c1.js","./timeSupport-f551a50b.js","./projectExtentUtils-8de2a3e3.js","./dehydratedFeatureComparison-a1edeb0b.js","./queryForSymbologySnapping-66104d6b.js","./hash-6f442295.js","./Graphics3DObjectStates-867041f5.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./popupUtils-5d416a17.js","./floorFilterUtils-73949d2d.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./LayerView3D-2ec8e4f7.js","./query-f1663770.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./WorkerHandle-ce022e20.js","./EventedSet-40d1e127.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js"],import.meta.url),graphics:()=>ye(()=>import("./GraphicsLayerView3D-3ac9b31e.js"),["./GraphicsLayerView3D-3ac9b31e.js","./LayerView3D-2ec8e4f7.js","./queryForSymbologySnapping-66104d6b.js","./GraphicsProcessor-cee10e46.js","./Graphics3DObjectStates-867041f5.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./popupUtils-5d416a17.js","./projectExtentUtils-8de2a3e3.js","./LayerView-ba0f2b5f.js"],import.meta.url),group:()=>ye(()=>import("./GroupLayerView-0d690983.js"),["./GroupLayerView-0d690983.js","./LayerView-ba0f2b5f.js"],import.meta.url),imagery:()=>ye(()=>import("./ImageryLayerView3D-95e0f326.js"),["./ImageryLayerView3D-95e0f326.js","./DynamicLayerView3D-5a23ab5a.js","./LayerView3D-2ec8e4f7.js","./projectExtentUtils-8de2a3e3.js","./ImageMaterial-a207fb63.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js","./timeSupport-f551a50b.js","./popupUtils-5d416a17.js"],import.meta.url),"integrated-mesh":()=>ye(()=>import("./IntegratedMeshLayerView3D-93043850.js"),["./IntegratedMeshLayerView3D-93043850.js","./I3SMeshView3D-3ac2f924.js","./Transform-bd0956fc.js","./RenderTexture-9dec843b.js","./I3SOverrides-65e52ae4.js","./I3SNode-a6acb4a5.js","./I3SUtil-c01a900c.js","./I3SBinaryReader-1b3cb0df.js","./ReactiveSet-e908c60f.js","./meshFeatureSet-7f3ad483.js","./Mesh-8f965193.js","./MeshTransform-aee14b25.js","./vertexSpaceConversion-6cc95785.js","./External-882ffaa7.js","./infoFor3D-a657d595.js","./FeatureLayerView3D-6941216f.js","./FeatureLayerViewBase3D-220c8345.js","./Graphics3DGraphicsPipeline-2a2c31c1.js","./timeSupport-f551a50b.js","./projectExtentUtils-8de2a3e3.js","./dehydratedFeatureComparison-a1edeb0b.js","./queryForSymbologySnapping-66104d6b.js","./hash-6f442295.js","./Graphics3DObjectStates-867041f5.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./popupUtils-5d416a17.js","./floorFilterUtils-73949d2d.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./LayerView3D-2ec8e4f7.js","./query-f1663770.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./WorkerHandle-ce022e20.js","./EventedSet-40d1e127.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js","./SceneModification-16e5a268.js","./persistable-af6fed38.js","./resourceExtension-6143fef8.js","./SceneLayerWorker-f9ff4eca.js","./makeScheduleFunction-e2d1207a.js"],import.meta.url),"integrated-mesh-3dtiles":()=>ye(()=>import("./IntegratedMesh3DTilesLayerView3D-abf475ef.js"),["./IntegratedMesh3DTilesLayerView3D-abf475ef.js","./Transform-bd0956fc.js","./RenderTexture-9dec843b.js","./ILyr3DWasmPerSceneView-b1ab6e1f.js","./LayerView3D-2ec8e4f7.js","./LayerView-ba0f2b5f.js"],import.meta.url),"line-of-sight":()=>ye(()=>import("./LineOfSightLayerView3D-fe197954.js"),["./LineOfSightLayerView3D-fe197954.js","./LayerView3D-2ec8e4f7.js","./LayerView-ba0f2b5f.js"],import.meta.url),"map-image":()=>ye(()=>import("./MapImageLayerView3D-0cbbe00e.js"),["./MapImageLayerView3D-0cbbe00e.js","./DynamicLayerView3D-5a23ab5a.js","./LayerView3D-2ec8e4f7.js","./projectExtentUtils-8de2a3e3.js","./ImageMaterial-a207fb63.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js","./ExportImageParameters-7b0ab4ed.js","./floorFilterUtils-73949d2d.js","./sublayerUtils-3862e7fb.js","./timeSupport-f551a50b.js","./MapServiceLayerViewHelper-2ae1d5c7.js","./drapedUtils-382a838f.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./popupUtils-5d416a17.js"],import.meta.url),media:()=>ye(()=>import("./MediaLayerView3D-0e6e035d.js").then(t=>t.M),["./MediaLayerView3D-0e6e035d.js","./MediaElementView-8ba2ad15.js","./normalizeUtilsSync-597f881a.js","./normalizeUtilsCommon-6ab3a73c.js","./LayerView3D-2ec8e4f7.js","./keybindings-65d19bf6.js","./SnappingManagerPool-45ad664b.js","./geodesicLengthMeasurementUtils-b0b02496.js","./geometryEngine-ebfb00c5.js","./geometryEngineBase-2eacdee6.js","./hydrated-33355f53.js","./geometry2dUtils-bc57a82d.js","./floorFilterUtils-73949d2d.js","./ImageMaterial-a207fb63.js","./LayerView-ba0f2b5f.js"],import.meta.url),"ogc-feature":()=>ye(()=>import("./OGCFeatureLayerView3D-03a3abbb.js"),["./OGCFeatureLayerView3D-03a3abbb.js","./FeatureLayerViewBase3D-220c8345.js","./Graphics3DGraphicsPipeline-2a2c31c1.js","./timeSupport-f551a50b.js","./projectExtentUtils-8de2a3e3.js","./dehydratedFeatureComparison-a1edeb0b.js","./queryForSymbologySnapping-66104d6b.js","./hash-6f442295.js","./Graphics3DObjectStates-867041f5.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./popupUtils-5d416a17.js","./floorFilterUtils-73949d2d.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./LayerView3D-2ec8e4f7.js","./query-f1663770.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./WorkerHandle-ce022e20.js","./EventedSet-40d1e127.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js"],import.meta.url),"open-street-map":Y$,"oriented-imagery":()=>ye(()=>import("./FeatureLayerView3D-6941216f.js"),["./FeatureLayerView3D-6941216f.js","./FeatureLayerViewBase3D-220c8345.js","./Graphics3DGraphicsPipeline-2a2c31c1.js","./timeSupport-f551a50b.js","./projectExtentUtils-8de2a3e3.js","./dehydratedFeatureComparison-a1edeb0b.js","./queryForSymbologySnapping-66104d6b.js","./hash-6f442295.js","./Graphics3DObjectStates-867041f5.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./popupUtils-5d416a17.js","./floorFilterUtils-73949d2d.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./LayerView3D-2ec8e4f7.js","./query-f1663770.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./WorkerHandle-ce022e20.js","./EventedSet-40d1e127.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js"],import.meta.url),"point-cloud":()=>ye(()=>import("./PointCloudLayerView3D-9df3b055.js").then(t=>t.a),["./PointCloudLayerView3D-9df3b055.js","./LayerView3D-2ec8e4f7.js","./WorkerHandle-ce022e20.js","./I3SUtil-c01a900c.js","./I3SBinaryReader-1b3cb0df.js","./PointCloudWorkerUtil-b34dda8a.js","./PointCloudUniqueValueRenderer-19e3c41a.js","./PopupSceneLayerView-7fd99f72.js","./popupUtils-5d416a17.js","./LayerView-ba0f2b5f.js"],import.meta.url),voxel:()=>ye(()=>import("./VoxelLayerView3D-5f78b92d.js"),["./VoxelLayerView3D-5f78b92d.js","./LayerView3D-2ec8e4f7.js","./PopupSceneLayerView-7fd99f72.js","./popupUtils-5d416a17.js","./LayerView-ba0f2b5f.js"],import.meta.url),route:()=>ye(()=>import("./RouteLayerView3D-782aeb7b.js"),["./RouteLayerView3D-782aeb7b.js","./Stop-d22a4323.js","./LayerView3D-2ec8e4f7.js","./GraphicsProcessor-cee10e46.js","./Graphics3DObjectStates-867041f5.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./popupUtils-5d416a17.js","./projectExtentUtils-8de2a3e3.js","./EventedSet-40d1e127.js","./LayerView-ba0f2b5f.js"],import.meta.url),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?ye(()=>import("./SceneLayerView3D-13527d73.js"),["./SceneLayerView3D-13527d73.js","./ReactiveSet-e908c60f.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./floorFilterUtils-73949d2d.js","./I3SMeshView3D-3ac2f924.js","./Transform-bd0956fc.js","./RenderTexture-9dec843b.js","./I3SOverrides-65e52ae4.js","./I3SNode-a6acb4a5.js","./I3SUtil-c01a900c.js","./I3SBinaryReader-1b3cb0df.js","./meshFeatureSet-7f3ad483.js","./Mesh-8f965193.js","./MeshTransform-aee14b25.js","./vertexSpaceConversion-6cc95785.js","./External-882ffaa7.js","./infoFor3D-a657d595.js","./FeatureLayerView3D-6941216f.js","./FeatureLayerViewBase3D-220c8345.js","./Graphics3DGraphicsPipeline-2a2c31c1.js","./timeSupport-f551a50b.js","./projectExtentUtils-8de2a3e3.js","./dehydratedFeatureComparison-a1edeb0b.js","./queryForSymbologySnapping-66104d6b.js","./hash-6f442295.js","./Graphics3DObjectStates-867041f5.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./popupUtils-5d416a17.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./LayerView3D-2ec8e4f7.js","./query-f1663770.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./WorkerHandle-ce022e20.js","./EventedSet-40d1e127.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js","./SceneModification-16e5a268.js","./persistable-af6fed38.js","./resourceExtension-6143fef8.js","./SceneLayerWorker-f9ff4eca.js","./makeScheduleFunction-e2d1207a.js","./SceneLayerView-bf000e26.js","./TemporalSceneLayerView-c4674d00.js","./I3SQueryFeatureStore-c86422c6.js","./PopupSceneLayerView-7fd99f72.js"],import.meta.url):ye(()=>import("./SceneLayerGraphicsView3D-888cdf0c.js"),["./SceneLayerGraphicsView3D-888cdf0c.js","./I3SOverrides-65e52ae4.js","./RenderTexture-9dec843b.js","./I3SNode-a6acb4a5.js","./I3SUtil-c01a900c.js","./I3SBinaryReader-1b3cb0df.js","./ReactiveSet-e908c60f.js","./meshFeatureSet-7f3ad483.js","./Mesh-8f965193.js","./MeshTransform-aee14b25.js","./vertexSpaceConversion-6cc95785.js","./External-882ffaa7.js","./infoFor3D-a657d595.js","./FeatureLayerView3D-6941216f.js","./FeatureLayerViewBase3D-220c8345.js","./Graphics3DGraphicsPipeline-2a2c31c1.js","./timeSupport-f551a50b.js","./projectExtentUtils-8de2a3e3.js","./dehydratedFeatureComparison-a1edeb0b.js","./queryForSymbologySnapping-66104d6b.js","./hash-6f442295.js","./Graphics3DObjectStates-867041f5.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./popupUtils-5d416a17.js","./floorFilterUtils-73949d2d.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./LayerView3D-2ec8e4f7.js","./query-f1663770.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./WorkerHandle-ce022e20.js","./EventedSet-40d1e127.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js","./SceneLayerView-bf000e26.js","./TemporalSceneLayerView-c4674d00.js","./PopupSceneLayerView-7fd99f72.js"],import.meta.url),stream:()=>ye(()=>import("./StreamLayerView3D-d3eea283.js"),["./StreamLayerView3D-d3eea283.js","./StreamFeatureManager-2982dbf6.js","./createConnection-5531d4b4.js","./query-f1663770.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./EventedSet-40d1e127.js","./Graphics3DGraphicsPipeline-2a2c31c1.js","./timeSupport-f551a50b.js","./projectExtentUtils-8de2a3e3.js","./dehydratedFeatureComparison-a1edeb0b.js","./queryForSymbologySnapping-66104d6b.js","./hash-6f442295.js","./Graphics3DObjectStates-867041f5.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./popupUtils-5d416a17.js","./floorFilterUtils-73949d2d.js","./QueryEngine-e4c55ed5.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./LayerView3D-2ec8e4f7.js","./LayerView-ba0f2b5f.js"],import.meta.url),tile:Y$,"imagery-tile":()=>ye(()=>import("./ImageryTileLayerView3D-85efd1a3.js"),["./ImageryTileLayerView3D-85efd1a3.js","./rasterProjectionHelper-6da77e9e.js","./LayerView3D-2ec8e4f7.js","./TiledLayerView3D-4f84aab1.js","./timeSupport-f551a50b.js","./popupUtils-5d416a17.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js","./drapedUtils-382a838f.js"],import.meta.url),"vector-tile":()=>ye(()=>import("./VectorTileLayerView3D-e3593d00.js"),["./VectorTileLayerView3D-e3593d00.js","./Rect-98da58d6.js","./pbf-b4a86cc9.js","./constants-991354c8.js","./vec4f32-0d1b2306.js","./StyleRepository-aa454248.js","./LayerView3D-2ec8e4f7.js","./TiledLayerView3D-4f84aab1.js","./LayerView-ba0f2b5f.js"],import.meta.url),wcs:()=>ye(()=>import("./ImageryTileLayerView3D-85efd1a3.js"),["./ImageryTileLayerView3D-85efd1a3.js","./rasterProjectionHelper-6da77e9e.js","./LayerView3D-2ec8e4f7.js","./TiledLayerView3D-4f84aab1.js","./timeSupport-f551a50b.js","./popupUtils-5d416a17.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js","./drapedUtils-382a838f.js"],import.meta.url),"web-tile":Y$,wfs:()=>ye(()=>import("./WFSLayerView3D-4cd6b608.js"),["./WFSLayerView3D-4cd6b608.js","./FeatureLayerViewBase3D-220c8345.js","./Graphics3DGraphicsPipeline-2a2c31c1.js","./timeSupport-f551a50b.js","./projectExtentUtils-8de2a3e3.js","./dehydratedFeatureComparison-a1edeb0b.js","./queryForSymbologySnapping-66104d6b.js","./hash-6f442295.js","./Graphics3DObjectStates-867041f5.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./popupUtils-5d416a17.js","./floorFilterUtils-73949d2d.js","./QueryEngine-e4c55ed5.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./WhereClause-11cd8876.js","./TimeOnly-0ea1f14a.js","./json-48e3ea08.js","./utils-b5d3e760.js","./utils-6fba2c13.js","./utils-3bd43217.js","./ClassBreaksDefinition-78fccd7d.js","./FeatureStore-536287ab.js","./BoundsStore-e64d6a6f.js","./LayerView3D-2ec8e4f7.js","./query-f1663770.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./WorkerHandle-ce022e20.js","./EventedSet-40d1e127.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js"],import.meta.url),wms:()=>ye(()=>import("./WMSLayerView3D-8965406a.js"),["./WMSLayerView3D-8965406a.js","./DynamicLayerView3D-5a23ab5a.js","./LayerView3D-2ec8e4f7.js","./projectExtentUtils-8de2a3e3.js","./ImageMaterial-a207fb63.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js","./ExportWMSImageParameters-e1459120.js","./timeSupport-f551a50b.js"],import.meta.url),wmts:()=>ye(()=>import("./WMTSLayerView3D-797920c3.js"),["./WMTSLayerView3D-797920c3.js","./LayerView3D-2ec8e4f7.js","./TiledLayerView3D-4f84aab1.js","./fetchTile-ec8a02ea.js","./LayerView-ba0f2b5f.js","./RefreshableLayerView-5122c702.js"],import.meta.url),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function Ymt(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new j(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const n_e={hasLayerViewModule:t=>s_e[t.type]!=null,importLayerView:t=>{const e=s_e[t.type];if(e==null)throw Ymt(t);return e(t)}},o_e="analyses-owner-handles";var jR,m2;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(jR||(jR={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(m2||(m2={}));let PT=class extends Fe{constructor(e){super(e),this._allAnalysisViews=new ct,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=a_e(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null},viewshed:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Yi("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Yi()),this._attachedToViewResolver=a_e()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(i==null||i.state.list===m2.REMOVED)throw new j("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),o_e)}_disconnectOwners(){this.removeHandles(o_e),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const i=e.on("after-add",s=>this._addAnalysis(s.item)),r=e.on("after-remove",s=>this._removeAnalysis(s.item));return er(()=>{i.remove(),r.remove();for(const s of e)this._removeAnalysis(s)})}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:jR.PENDING,list:m2.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=P0(s=>this._createAnalysisViewPromise(r,s))}else i.state.list=m2.ADDED}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=m2.REMOVED,this._scheduleUpdate()):oe.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=dC(()=>this._update()))}_update(){this._scheduledUpdateHandle=Zr(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===m2.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case jR.PENDING:e.createAnalysisViewTask=qc(e.createAnalysisViewTask);break;case jR.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Ge(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,i){const r=e.analysis,s=r.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(va(i))throw this._creatingViewCount-=1,Yi("AnalysisView creation aborted");const o=new n.module.default({analysis:r,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(va(i))throw this._creatingViewCount-=1,o.destroy(),Yi("AnalysisView creation aborted");return e.view=o,e.state.view=jR.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return ye(()=>import("./AreaMeasurementAnalysisView3D-5a2c304e.js").then(i=>i.A),["./AreaMeasurementAnalysisView3D-5a2c304e.js","./interfaces-0db192a9.js","./TextOverlayItem-1bc2b327.js","./unitFormatUtils-97d022f1.js","./AnalysisView3D-7e79c478.js","./euclideanAreaMeasurementUtils-744f224f.js","./geometryEngine-ebfb00c5.js","./geometryEngineBase-2eacdee6.js","./hydrated-33355f53.js","./geodesicLengthMeasurementUtils-b0b02496.js","./projectionUtils-4625ae99.js","./EditGeometryOperations-cd9be2c8.js","./geometry2dUtils-bc57a82d.js","./Segment-67d40ba6.js","./LineVisualElement-f0fcad77.js"],import.meta.url);case"dimension":return ye(()=>import("./DimensionAnalysisView3D-7af69aa9.js"),["./DimensionAnalysisView3D-7af69aa9.js","./AnalysisView3D-7e79c478.js","./LengthDimension-b5709ecc.js","./TextOverlayItem-1bc2b327.js","./unitFormatUtils-97d022f1.js","./Segment-67d40ba6.js","./LineVisualElement-f0fcad77.js","./geodesicLengthMeasurementUtils-b0b02496.js","./geometryEngine-ebfb00c5.js","./geometryEngineBase-2eacdee6.js","./hydrated-33355f53.js","./SnappingOperation-a94839c4.js","./ExtendedLineVisualElement-79fc3aab.js","./vec4f32-0d1b2306.js","./EngineVisualElement-02def4a8.js","./LaserlineVisualElement-4a70baec.js","./PointVisualElement-965c29db.js","./RightAngleQuadVisualElement-8e830bef.js","./SnappingManagerPool-45ad664b.js","./geometry2dUtils-bc57a82d.js","./floorFilterUtils-73949d2d.js","./keybindings-65d19bf6.js","./PointSnappingHint-6e3082e3.js","./InteractiveToolBase-49db0252.js","./EditGeometryOperations-cd9be2c8.js","./dehydratedFeatureComparison-a1edeb0b.js","./dragEventPipeline3D-fac7f7a6.js","./ImageMaterial-a207fb63.js","./memoize-3e55df82.js","./Factory-bd7ae389.js","./analysisViewUtils-6a12b552.js","./ToolIntersector-8c0f1c04.js","./projectionUtils-4625ae99.js"],import.meta.url);case"direct-line-measurement":return ye(()=>import("./DirectLineMeasurementAnalysisView3D-f4d15a3f.js").then(i=>i.D),["./DirectLineMeasurementAnalysisView3D-f4d15a3f.js","./interfaces-0db192a9.js","./TextOverlayItem-1bc2b327.js","./unitFormatUtils-97d022f1.js","./AnalysisView3D-7e79c478.js","./projectionUtils-4625ae99.js","./geodesicLengthMeasurementUtils-b0b02496.js","./geometryEngine-ebfb00c5.js","./geometryEngineBase-2eacdee6.js","./hydrated-33355f53.js","./Segment-67d40ba6.js","./LineVisualElement-f0fcad77.js","./RightAngleQuadVisualElement-8e830bef.js","./EngineVisualElement-02def4a8.js"],import.meta.url);case"line-of-sight":return ye(()=>import("./LineOfSightAnalysisView3D-d9f012ac.js"),["./LineOfSightAnalysisView3D-d9f012ac.js","./AnalysisView3D-7e79c478.js","./LineOfSightAnalysisTarget-10dcada5.js","./persistable-af6fed38.js","./resourceExtension-6143fef8.js","./projectionUtils-4625ae99.js","./InteractiveToolBase-49db0252.js","./EditGeometryOperations-cd9be2c8.js","./geometry2dUtils-bc57a82d.js","./manipulatorUtils-0e3dc187.js","./LaserlineVisualElement-4a70baec.js","./LineVisualElement-f0fcad77.js","./analysisViewUtils-6a12b552.js","./PointVisualElement-965c29db.js"],import.meta.url);case"slice":return ye(()=>import("./SliceAnalysisView3D-54cbd9a2.js"),["./SliceAnalysisView3D-54cbd9a2.js","./AnalysisView3D-7e79c478.js","./ShiftManipulator-169d895c.js","./sliceToolConfig-6eb1e762.js","./InteractiveToolBase-49db0252.js","./EditGeometryOperations-cd9be2c8.js","./geometry2dUtils-bc57a82d.js","./ImageMaterial-a207fb63.js","./persistable-af6fed38.js","./resourceExtension-6143fef8.js","./projectionUtils-4625ae99.js","./LineVisualElement-f0fcad77.js","./BuildingComponentSublayer-7bc9461e.js","./capabilities-c607cf72.js","./I3SIndexInfo-a950e410.js","./I3SLayerDefinitions-84fb5d7d.js","./I3SUtil-c01a900c.js","./I3SBinaryReader-1b3cb0df.js","./popupUtils-5d416a17.js","./Factory-bd7ae389.js","./dragEventPipeline3D-fac7f7a6.js","./analysisViewUtils-6a12b552.js","./ToolIntersector-8c0f1c04.js"],import.meta.url);case"viewshed":return ye(()=>import("./ViewshedAnalysisView3D-1dd88c16.js"),["./ViewshedAnalysisView3D-1dd88c16.js","./AnalysisView3D-7e79c478.js","./geometryEngine-ebfb00c5.js","./geometryEngineBase-2eacdee6.js","./hydrated-33355f53.js","./InteractiveToolBase-49db0252.js","./EditGeometryOperations-cd9be2c8.js","./geometry2dUtils-bc57a82d.js","./dragEventPipeline3D-fac7f7a6.js","./LineVisualElement-f0fcad77.js","./sliceToolConfig-6eb1e762.js","./MoveManipulation-5eacaa7c.js","./ExtendedLineVisualElement-79fc3aab.js","./vec4f32-0d1b2306.js","./EngineVisualElement-02def4a8.js","./LaserlineVisualElement-4a70baec.js","./analysisViewUtils-6a12b552.js","./keybindings-65d19bf6.js","./ToolIntersector-8c0f1c04.js"],import.meta.url)}}};function a_e(){const t=lo();return t.promise.catch(()=>{}),t}d([m()],PT.prototype,"updating",null),d([m({constructOnly:!0})],PT.prototype,"view",void 0),d([m()],PT.prototype,"_allAnalysisViews",void 0),d([m()],PT.prototype,"_creatingViewCount",void 0),PT=d([N("esri.views.3d.analysis.AnalysisViewManager3D")],PT);const Xmt=PT;let N_=class extends Fe{constructor(e){super(e),this.collision=new kN,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Xe.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Xe.Local?this._set("altitude",e):oe.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?$e(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return $e(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Xe.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=hY)=>(r.min=ul.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?CV([[4e3,ul.max],[1e4,Gt(88)],[6e6,Gt(88)]]):()=>ul.max;return(i,r=hY)=>(r.min=ul.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?CV([[4e3,ul.max],[5e4,Gt(88)],[6e6,Gt(88)],[2e7,ul.min]]):CV([[3e5,ul.max],[3e6,Gt(88)],[6e6,Gt(88)],[2e7,ul.min]]);return(i,r=hY)=>(r.min=ul.min,r.max=e(i),r)}};function Zmt(t){return{min:-2e5,max:4*t.radius}}d([m()],N_.prototype,"altitude",null),d([m({readOnly:!0})],N_.prototype,"collision",void 0),d([m()],N_.prototype,"distance",void 0),d([m({readOnly:!0})],N_.prototype,"minimumPoiDistance",void 0),d([m()],N_.prototype,"tilt",void 0),d([m({constructOnly:!0})],N_.prototype,"mode",void 0),N_=d([N("esri.views.3d.state.Constraints")],N_);const l_e=Zmt(br),ul={min:Gt(.5),max:Gt(179.5)},hY={min:0,max:0};let kN=class extends Fe{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};d([m({type:Boolean})],kN.prototype,"enabled",void 0),d([m({type:Number})],kN.prototype,"elevationMargin",void 0),kN=d([N("esri.views.3d.state.Constraints.CollisionConstraint")],kN);let HR=class extends DE{constructor(){super(...arguments),this.min=l_e.min,this.max=l_e.max}};d([m({type:Number})],HR.prototype,"min",void 0),d([m({type:Number})],HR.prototype,"max",void 0),HR=d([N("esri.views.3d.constraints.AltitudeConstraint")],HR);let ev=class extends DE{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};d([m({type:Number,value:1e-8})],ev.prototype,"near",null),d([vi("near")],ev.prototype,"castNear",null),d([m({type:Number,value:1e-8})],ev.prototype,"far",null),d([vi("far")],ev.prototype,"castFar",null),d([m({type:["auto","manual"]})],ev.prototype,"mode",void 0),ev=d([N("esri.views.3d.constraints.ClipDistanceConstraint")],ev);const Iie={min:El(ul.min),max:El(ul.max)};let g2=class extends DE{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return $e(e,Iie.min,Iie.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};d([m({type:["auto","manual"]})],g2.prototype,"mode",void 0),d([m({type:Number,value:Iie.max})],g2.prototype,"max",null),d([vi("max")],g2.prototype,"castMax",null),g2=d([N("esri.views.3d.constraints.TiltConstraint")],g2);let y2=class extends DE{constructor(){super(...arguments),this.tilt=new g2,this.altitude=new HR,this.clipDistance=new ev}};d([m({type:g2})],y2.prototype,"tilt",void 0),d([m({type:HR})],y2.prototype,"altitude",void 0),d([m({type:ev})],y2.prototype,"clipDistance",void 0),y2=d([N("esri.views.3d.constraints.Constraints")],y2);var JA;let Ob=JA=class extends un.EventedMixin(FE){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new JA(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const i=JA.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=JA.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(qU.target=this,qU.timezoneOffset=s,this.emit("timezone-will-change",qU),qU.target=null),t!=null)return isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new JA({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([m({type:Boolean})],Ob.prototype,"cameraTrackingEnabled",void 0),d([m({type:Date})],Ob.prototype,"defaultDate",null),d([m({type:Date})],Ob.prototype,"date",null),Ob=JA=d([N("esri.views.3d.environment.SunLighting")],Ob),function(t){function e({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}t.calculateTimezoneOffset=e}(Ob||(Ob={}));const qU={target:null,timezoneOffset:0},OT=Ob;var rG;let sG=rG=class extends un.EventedMixin(Uk){constructor(t){super(t),this.cameraTrackingEnabled=!0}clone(){return new rG({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new rG(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([m({type:Boolean})],sG.prototype,"cameraTrackingEnabled",void 0),sG=rG=d([N("esri.views.3d.environment.VirtualLighting")],sG);const UN=sG,Jmt={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:OT,virtual:UN}};var $ie;let fD=$ie=class extends Fe{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new $ie({quality:this.quality})}};d([m({type:["low","high"],value:"low"})],fD.prototype,"quality",null),fD=$ie=d([N("esri.views.3d.environment.SceneViewAtmosphere")],fD);var BN;let QA=BN=class extends NO{constructor(t){super(t),this.atmosphere=new fD,this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}destroy(){this.atmosphere.destroy()}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new BN({...e,lighting:e.lighting?e.lighting.type==="virtual"?UN.fromWebsceneLighting(e.lighting):OT.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const e=this._convertLighting(t);return e!==t&&this.addHandles(_Ae(e)),e}_convertLighting(t){return t?t instanceof OT||t instanceof UN?t:t instanceof FE?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new OT({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):t instanceof Uk?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new UN({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):ag(Jmt,t):new OT}clone(){return new BN({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ee(this.background)})}cloneWithWebsceneEnvironment(t){return new BN({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ee(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):OT.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):UN.fromWebsceneLighting(t.lighting);default:return t.lighting,OT.fromWebsceneLighting(t.lighting)}}};d([m({type:fD,json:{read:!1},nonNullable:!0})],QA.prototype,"atmosphere",void 0),d([m({nonNullable:!0})],QA.prototype,"lighting",void 0),d([vi("lighting")],QA.prototype,"castLighting",null),QA=BN=d([N("esri.views.3d.environment.SceneViewEnvironment")],QA);const KA=QA;function Qmt(t,e){return{type:ME(e),value:t,unit:e}}function Qdi(t){return{value:t}}function Av(t,e){return{type:ME(e),value:t,unit:e}}function Kmt(t,e){return{type:ME(e),value:t,unit:e}}function T9(t,e,i="arithmetic"){return{type:ME(e),value:t,unit:e,rotationType:i}}function egt(t,e){const i=tgt(t,e);return t.type==="angle"?T9(i,e,t.rotationType):Qmt(i,e)}function tgt(t,e){return ko(t.value,t.unit,e)}function Kdi(t,e){return t==null?e:e==null||t.value>ko(e.value,e.unit,t.unit)?t:e}function epi(t,e){return t==null?null:{...t,value:t.value*e}}function tpi(t,e,i){if(e===i)return t;switch(i){case"arithmetic":case"geographic":return 90-t}}const ipi=Av(0,"meters"),rpi=Kmt(0,"square-meters");T9(0,"radians");const spi=T9(0,"degrees"),npi=T9(0,"degrees","geographic");var Vl;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(Vl||(Vl={}));function vDe(t){return"r"in t&&"g"in t&&"b"in t}function bDe(t){return"h"in t&&"s"in t&&"v"in t}function wDe(t){return"l"in t&&"a"in t&&"b"in t}function xDe(t){return"l"in t&&"c"in t&&"h"in t}function igt(t){return"x"in t&&"y"in t&&"z"in t}const rgt=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],sgt=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function SDe(t,e){const i=[];let r,s;if(t[0].length!==e.length)throw new Error("dimensions do not match");const n=t.length,o=t[0].length;let a=0;for(r=0;r<n;r++){for(a=0,s=0;s<o;s++)a+=t[r][s]*e[s];i.push(a)}return i}function TDe(t){const e=[t.r/255,t.g/255,t.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=SDe(rgt,e);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function Iue(t){const e=SDe(sgt,[t.x/100,t.y/100,t.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function EDe(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function CDe(t){const e=t.l,i=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function ngt(t){const e=t.l,i=t.a,r=t.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:e,c:s,h:n}}function ogt(t){const e=t.l,i=t.c,r=t.h;return{l:e,a:i*Math.cos(r),b:i*Math.sin(r)}}function agt(t){return EDe(TDe(t))}function lgt(t){return Iue(CDe(t))}function cgt(t){return ngt(EDe(TDe(t)))}function ugt(t){return Iue(CDe(ogt(t)))}function hgt(t){const e=t.r,i=t.g,r=t.b,s=Math.max(e,i,r),n=s-Math.min(e,i,r);let o=s,a=n===0?0:s===e?(i-r)/n%6:s===i?(r-e)/n+2:(e-i)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function dgt(t){const e=(t.h+360)%360/60,i=t.s/100,r=t.v/100*255,s=r*i,n=s*(1-Math.abs(e%2-1));let o;switch(Math.floor(e)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-s),o.g=Math.round(o.g+r-s),o.b=Math.round(o.b+r-s),o}function Jk(t){return vDe(t)?t:xDe(t)?ugt(t):wDe(t)?lgt(t):igt(t)?Iue(t):bDe(t)?dgt(t):t}function pgt(t){return bDe(t)?t:hgt(Jk(t))}function fgt(t){return wDe(t)?t:agt(Jk(t))}function opi(t){return xDe(t)?t:cgt(Jk(t))}function mgt(t){let{r:e,g:i,b:r,a:s}=t;return s<1&&(e=Math.round(s*e+255*(1-s)),i=Math.round(s*i+255*(1-s)),r=Math.round(s*r+255*(1-s))),new Ke({r:e,g:i,b:r})}function ggt(t,e){const{r:i,g:r,b:s}=e?.ignoreAlpha?t:mgt(t);return .2126*i+.7152*r+.0722*s}var Nie;function api(t,e=Nie.High){return ggt(t,{ignoreAlpha:!0})>e?new Ke([0,0,0,t.a]):new Ke([255,255,255,t.a])}function lpi(t,e){const i=fgt(t);i.l*=1-e;const r=Jk(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function cpi(t,e){const i=t.clone();return i.a*=e,i}function upi(t,e){const i=pgt(t);i.s*=e;const r=Jk(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function MF(t){return Ke.toUnitRGBA(t)}function hpi(t,e){return t===e||t!=null&&e!=null&&BE(t,e)}function dpi(t){return ni(t[0],t[1],t[2],t.length>3?t[3]:1)}function ppi(t,e){const i=Ke.toUnitRGBA(t);return i[3]*=e,i}(function(t){t[t.Low=160]="Low",t[t.High=225]="High"})(Nie||(Nie={}));function Cl(t,e){return t[0]=e[0],t[1]=e[1],t}function Gi(t,e,i){return t[0]=e,t[1]=i,t}function bm(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function By(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function MDe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function ADe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function ygt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function _gt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function vgt(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function bgt(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function wgt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Ed(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function xgt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function dx(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function Xj(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function $ue(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function RDe(t){const e=t[0],i=t[1];return e*e+i*i}function PDe(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Sgt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function AF(t,e){const i=e[0],r=e[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function bo(t,e){return t[0]*e[0]+t[1]*e[1]}function Tgt(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function qp(t,e,i,r){const s=e[0],n=e[1];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t}function Egt(t,e){e=e||1;const i=2*Ok()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function ODe(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t}function Cgt(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s+i[4],t[1]=i[1]*r+i[3]*s+i[5],t}function Mgt(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[3]*s+i[6],t[1]=i[1]*r+i[4]*s+i[7],t}function Agt(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[4]*s+i[12],t[1]=i[1]*r+i[5]*s+i[13],t}function Rgt(t,e,i,r){const s=e[0]-i[0],n=e[1]-i[1],o=Math.sin(r),a=Math.cos(r);return t[0]=s*a-n*o+i[0],t[1]=s*o+n*a+i[1],t}function Pgt(t,e){const i=t[0],r=t[1],s=e[0],n=e[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function Ogt(t){return"vec2("+t[0]+", "+t[1]+")"}function IDe(t,e){return t[0]===e[0]&&t[1]===e[1]}function $De(t,e){const i=t[0],r=t[1],s=e[0],n=e[1],o=ba();return Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))}function Igt(t,e,i,r,s){let n=e[0]-i[0],o=e[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const $gt=$ue,Ngt=By,Lgt=MDe,Dgt=ADe,NDe=dx,Fgt=Xj,kgt=RDe;Object.freeze(Object.defineProperty({__proto__:null,add:bm,angle:Pgt,ceil:ygt,copy:Cl,cross:Tgt,dist:NDe,distance:dx,div:Dgt,divide:ADe,dot:bo,equals:$De,exactEquals:IDe,floor:_gt,inverse:Sgt,len:$gt,length:$ue,lerp:qp,max:bgt,min:vgt,mul:Lgt,multiply:MDe,negate:PDe,normalize:AF,projectAndScale:Igt,random:Egt,rotate:Rgt,round:wgt,scale:Ed,scaleAndAdd:xgt,set:Gi,sqrDist:Fgt,sqrLen:kgt,squaredDistance:Xj,squaredLength:RDe,str:Ogt,sub:Ngt,subtract:By,transformMat2:ODe,transformMat2d:Cgt,transformMat3:Mgt,transformMat4:Agt},Symbol.toStringTag,{value:"Module"}));function Nue(t){return $e((t-1e5)/(1e6-1e5),0,1)}const Lie=1e4,Ugt=.085,Qb=1e5;let Bgt=class{};const is=Bgt;function T(t,...e){let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i}(function(t){function e(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}t.int=e,t.float=i})(T||(T={}));var O;function zgt(t){return t===O.POSITION}(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",t.LENGTH="length",t.PREVPOSITION="prevPosition",t.NEXTPOSITION="nextPosition",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMAL2COMPRESSED="normal2Compressed",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(O||(O={}));var ks;function jm(t,e){switch(e.textureCoordinateType){case ks.Default:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case ks.Compressed:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(T`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case ks.Atlas:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(O.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case ks.None:return void t.vertex.code.add(T`void forwardTextureCoordinates() {}`);case ks.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(ks||(ks={}));function Cg(t){t.code.add(T`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}var ar;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(ar||(ar={}));let hn=class{constructor(e,i,r,s,n=null){if(this.name=e,this.type=i,this.arraySize=n,this.bind={[ar.Pass]:null,[ar.Draw]:null},s)switch(r){case ar.Pass:this.bind[ar.Pass]=s;break;case ar.Draw:this.bind[ar.Draw]=s}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},os=class extends hn{constructor(e,i){super(e,"vec2",ar.Pass,(r,s,n)=>r.setUniform2fv(e,i(s,n)))}};function Lue(t){t.include(Cg),t.code.add(T`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
return linearDepthFromRGBA(texelFetch(depthTexture, iuv, 0), nearFar);
}`)}function N0(t){t.uniforms.add(new os("zProjectionMap",(e,i)=>Vgt(i.camera))),t.code.add(T`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),t.code.add(T`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),t.code.add(T`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}function Vgt(t){const e=t.projectionMatrix;return Gi(Ggt,e[14],e[10])}const Ggt=vt();function E9(t){t.fragment.code.add(T`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}let Qt=class extends hn{constructor(e,i){super(e,"vec3",ar.Pass,(r,s,n)=>r.setUniform3fv(e,i(s,n)))}};function r1(t){t.uniforms.add(new Qt("mainLightDirection",(e,i)=>i.lighting.mainLight.direction))}function L0(t){t.uniforms.add(new Qt("mainLightIntensity",(e,i)=>i.lighting.mainLight.intensity))}function Zj(t){r1(t.fragment),L0(t.fragment),t.fragment.code.add(T`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let Ki=class extends hn{constructor(e,i){super(e,"vec4",ar.Pass,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}},et=class extends hn{constructor(e,i){super(e,"float",ar.Pass,(r,s,n)=>r.setUniform1f(e,i(s,n)))}},Ps=class extends hn{constructor(e,i){super(e,"mat4",ar.Pass,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};const gc=pi();let jgt=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function Tt(t,e){if(!t){e=e||"Assertion";const i=new Error(e).stack;throw new jgt(`${e} at ${i}`)}}function lM(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function LDe(t,e,i,r){let s,n=(i[0]-t[0])/e[0],o=(r[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],u=(r[2]-t[2])/e[2];return c>u&&(s=c,c=u,u=s),!(n>u||c>o)&&(u<o&&(o=u),!(o<0))}function WU(t,e,i,r,s,n=vt()){const o=(r[s]-i[s])*(e[0]-t[0])-(r[0]-i[0])*(e[s]-t[s]),a=(r[0]-i[0])*(t[s]-i[s])-(r[s]-i[s])*(t[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function c_e(t,e,i,r,s){gc[0]=t[0],gc[1]=t[1],gc[2]=t[2],gc[3]=1,xh(gc,gc,e),s.length>2&&(s[2]=-gc[2]),xh(gc,gc,i),Tt(gc[3]!==0),s[0]=gc[0]/gc[3],s[1]=gc[1]/gc[3],s[2]=gc[2]/gc[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function Hgt(t,e){return Math.log(t)/Math.log(e)}function qgt(t,e,i,r){t[12]=e,t[13]=i,t[14]=r}function DDe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const Wgt=()=>oe.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let FDe=class{constructor(){this._includedModules=new Map}include(e,i){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,i),e(this.builder,i))}},tr=class extends FDe{constructor(){super(...arguments),this.vertex=new u_e,this.fragment=new u_e,this.attributes=new Zgt,this.varyings=new Jgt,this.extensions=new Die,this.constants=new kDe,this.outputs=new kie}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const i=this.extensions.generateSource(e),r=this.attributes.generateSource(e),s=this.varyings.generateSource(e),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?Kgt:Qgt,c=this.constants.generateSource().concat(n.constants.generateSource()),u=this.outputs.generateSource(e);return`#version 300 es
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${u.join(`
`)}

${a.join(`
`)}`}generateBindPass(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[ar.Pass];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[ar.Pass];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return(n,o)=>{for(let a=0;a<s;++a)r[a](e,n,o)}}generateBindDraw(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[ar.Draw];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[ar.Draw];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return(n,o,a)=>{for(let l=0;l<s;++l)r[l](e,n,o,a)}}},Ygt=class{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const i of e)this._add(i);return this._stage}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new j(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else Wgt().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},Xgt=class{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}},u_e=class extends FDe{constructor(){super(...arguments),this.uniforms=new Ygt(this),this.code=new Xgt(this),this.constants=new kDe}get builder(){return this}},Zgt=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`in ${i[1]} ${i[0]};`)}},Jgt=class{constructor(){this._entries=new Map}add(e,i){this._entries.has(e)&&Tt(this._entries.get(e)===i),this._entries.set(e,i)}generateSource(e){const i=new Array;return this._entries.forEach((r,s)=>i.push(e==="vertex"?`out ${r} ${s};`:`in ${r} ${s};`)),i}},Die=class Fie{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?Fie.ALLOWLIST_VERTEX:Fie.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}};Die.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],Die.ALLOWLIST_VERTEX=[];let kie=class Uie{constructor(){this._entries=new Map}add(e,i,r=0){const s=this._entries.get(r);s?Tt(s.name===e&&s.type===i,`Fragment shader output location ${r} occupied`):this._entries.set(r,{name:e,type:i})}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:Uie.DEFAULT_NAME,type:Uie.DEFAULT_TYPE});const i=new Array;return this._entries.forEach((r,s)=>i.push(`layout(location = ${s}) out ${r.type} ${r.name};`)),i}};kie.DEFAULT_TYPE="vec4",kie.DEFAULT_NAME="fragColor";let kDe=class po{constructor(){this._entries=new Set}add(e,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=po._numberToFloatStr(r);break;case"int":s=po._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${po._numberToFloatStr(r[0])},                            ${po._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${po._numberToFloatStr(r[0])},                            ${po._numberToFloatStr(r[1])},                            ${po._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${po._numberToFloatStr(r[0])},                            ${po._numberToFloatStr(r[1])},                            ${po._numberToFloatStr(r[2])},                            ${po._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${po._numberToIntStr(r[0])},                             ${po._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${po._numberToIntStr(r[0])},                             ${po._numberToIntStr(r[1])},                             ${po._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${po._numberToIntStr(r[0])},                             ${po._numberToIntStr(r[1])},                             ${po._numberToIntStr(r[2])},                             ${po._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>po._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const Qgt=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,Kgt=`precision highp float;
precision highp sampler2D;`;let Et=class extends hn{constructor(e,i){super(e,"sampler2D",ar.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}};const mD=Be(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),dY=3,pY=Be(dY*parseFloat(65e-8.toFixed(6)),dY*parseFloat(1881e-9.toFixed(6)),dY*parseFloat(85e-9.toFixed(6))),eyt=3996e-9,tyt=Be(parseFloat(Number(mD[0]+pY[0]).toFixed(6)),parseFloat(Number(mD[1]+pY[1]).toFixed(6)),parseFloat(Number(mD[2]+pY[2]).toFixed(6)));function iyt(t){const e=new tr;e.attributes.add(O.POSITION,"vec2"),e.include(jm,{textureCoordinateType:ks.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=e;return i.uniforms.add(new Ps("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Ps("inverseViewMatrix",(s,n)=>Ox(ryt,n.camera.viewMatrix))),i.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Qt("backgroundColor",s=>s.backgroundColor),new os("radii",s=>s.radii),new Qt("cameraPosition",(s,n)=>n.camera.eye),new Ki("heightParameters",s=>s.heightParameters),new et("innerFadeDistance",s=>s.innerFadeDistance),new et("altitudeFade",s=>s.altitudeFade),new Et("depthTexture",s=>s.depthTexture),new et("hazeStrength",s=>s.hazeStrength)),r.constants.add("betaRayleigh","vec3",mD),r.constants.add("betaCombined","vec3",tyt),r.constants.add("betaMie","float",eyt),r.constants.add("scaleHeight","float",Ugt*Qb),r1(r),e.include(E9),t.haze&&r.include(N0),r.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(T`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(T`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(T`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?T`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":T`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":T`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?T`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:T`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":T`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?T`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?T`
          float depthSample = texture(depthTexture, vuv0).r;
          if (depthSample != 1.0) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?T`cameraSpaceRay *= -textureBilinear(vuv0);`:T`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:T`${t.reduced?"":T`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?T`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != 1.0){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:T`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":T`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const ryt=Ne(),syt=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:mD,build:iyt},Symbol.toStringTag,{value:"Module"}));let ir=class{constructor(e,i){this._module=e,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var ss,Li,ke,Hv,Dt,Hm,WO,At,Lr,Us,_i,Di,on,Xt,Ct,cc,dl,wr,Sd,Hl;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(ss||(ss={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Li||(Li={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(ke||(ke={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Hv||(Hv={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(Dt||(Dt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Hm||(Hm={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(WO||(WO={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=5131]="HALF_FLOAT"}(At||(At={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Lr||(Lr={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(Us||(Us={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(_i||(_i={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Di||(Di={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(on||(on={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Xt||(Xt={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Ct||(Ct={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(cc||(cc={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(dl||(dl={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(wr||(wr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Sd||(Sd={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Hl||(Hl={}));const fY=33984;var Nn,So,zo;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.TransformFeedback=7]="TransformFeedback",t[t.Sync=8]="Sync",t[t.UNCOUNTED=9]="UNCOUNTED",t[t.LinesOfCode=9]="LinesOfCode",t[t.Uniform=10]="Uniform",t[t.COUNT=11]="COUNT"})(Nn||(Nn={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(So||(So={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK"}(zo||(zo={}));const YO=33306;var vn,h_e,d_e,p_e,Jj,Bie,f_e;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(vn||(vn={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(h_e||(h_e={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(d_e||(d_e={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(p_e||(p_e={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(Jj||(Jj={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(Bie||(Bie={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(f_e||(f_e={}));let hr=class{constructor(e,i,r){this.release=r,this.initializeConfiguration(e,i),this._configuration=i.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}destroy(){this._program=jt(this._program),this._pipeline=this._configuration=null}reload(e){jt(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return Li.TRIANGLES}getPipeline(e,i,r){return this._pipeline}initializeConfiguration(e,i){}};const Fi=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.UV0,2],[O.COLOR,3],[O.COLORFEATUREATTRIBUTE,3],[O.SIZE,4],[O.TANGENT,4],[O.CENTEROFFSETANDDISTANCE,5],[O.SYMBOLCOLOR,5],[O.FEATUREATTRIBUTE,6],[O.INSTANCEFEATUREATTRIBUTE,6],[O.INSTANCECOLOR,7],[O.OBJECTANDLAYERIDCOLOR,7],[O.INSTANCEOBJECTANDLAYERIDCOLOR,7],[O.INSTANCEMODEL,8],[O.INSTANCEMODELNORMAL,12],[O.INSTANCEMODELORIGINHI,11],[O.INSTANCEMODELORIGINLO,15]]),nyt=()=>oe.getLogger("esri.views.webgl.checkWebGLError");function oyt(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const Qj=!!ae("enable-feature:webgl-debug");function wm(){return Qj}function zie(){return Qj}function zy(t){if(wm()){const e=t.getError();if(e){const i=oyt(t,e),r=new Error().stack;nyt().error(new j("webgl-error","WebGL error occurred",{message:i,stack:r}))}}}let dr=class{constructor(e,i,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new ci({deallocator:null}),this._glProgram=e.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBindPass(this),this.bindDraw=i.generateBindDraw(this),this._fragmentUniforms=wm()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i){this._glProgram.setUniform1f(e,i)}setUniform2fv(e,i){this._glProgram.setUniform2fv(e,i)}setUniform3fv(e,i){this._glProgram.setUniform3fv(e,i)}setUniform4fv(e,i){this._glProgram.setUniform4fv(e,i)}setUniformMatrix3fv(e,i){this._glProgram.setUniformMatrix3fv(e,i)}setUniformMatrix4fv(e,i){this._glProgram.setUniformMatrix4fv(e,i)}setUniform1fv(e,i){this._glProgram.setUniform1fv(e,i)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,i){if(i?.glName==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let r=this._textures.get(e);return r==null?(r=this._allocTextureUnit(i),this._textures.set(e,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,i)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(i,e.unit)}),this._fragmentUniforms?.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var ns,HE,vr,px,Iu,qv,Yr,Gc,Rv;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(ns||(ns={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(HE||(HE={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(vr||(vr={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(px||(px={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Iu||(Iu={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(qv||(qv={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Yr||(Yr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(Gc||(Gc={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(Rv||(Rv={}));function Zd(t,e,i=Hv.ADD,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function Za(t,e,i,r,s=Hv.ADD,n=Hv.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const Due={face:Hm.BACK,mode:WO.CCW},UDe={face:Hm.FRONT,mode:WO.CCW},C9=t=>t===ns.Back?Due:t===ns.Front?UDe:null,Oh={zNear:0,zFar:1},fi={r:!0,g:!0,b:!0,a:!0};function ayt(t){return gyt.intern(t)}function lyt(t){return yyt.intern(t)}function cyt(t){return _yt.intern(t)}function uyt(t){return vyt.intern(t)}function hyt(t){return byt.intern(t)}function dyt(t){return wyt.intern(t)}function pyt(t){return xyt.intern(t)}function fyt(t){return Syt.intern(t)}function myt(t){return Tyt.intern(t)}function ti(t){return Eyt.intern(t)}let D0=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function F0(t){return"["+t.join(",")+"]"}const gyt=new D0(BDe,t=>({__tag:"Blending",...t}));function BDe(t){return t?F0([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const yyt=new D0(zDe,t=>({__tag:"Culling",...t}));function zDe(t){return t?F0([t.face,t.mode]):null}const _yt=new D0(VDe,t=>({__tag:"PolygonOffset",...t}));function VDe(t){return t?F0([t.factor,t.units]):null}const vyt=new D0(GDe,t=>({__tag:"DepthTest",...t}));function GDe(t){return t?F0([t.func]):null}const byt=new D0(jDe,t=>({__tag:"StencilTest",...t}));function jDe(t){return t?F0([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const wyt=new D0(HDe,t=>({__tag:"DepthWrite",...t}));function HDe(t){return t?F0([t.zNear,t.zFar]):null}const xyt=new D0(qDe,t=>({__tag:"ColorWrite",...t}));function qDe(t){return t?F0([t.r,t.g,t.b,t.a]):null}const Syt=new D0(WDe,t=>({__tag:"StencilWrite",...t}));function WDe(t){return t?F0([t.mask]):null}const Tyt=new D0(YDe,t=>({__tag:"DrawBuffers",...t}));function YDe(t){return t?F0(t.buffers):null}const Eyt=new D0(Cyt,t=>({blending:ayt(t.blending),culling:lyt(t.culling),polygonOffset:cyt(t.polygonOffset),depthTest:uyt(t.depthTest),stencilTest:hyt(t.stencilTest),depthWrite:dyt(t.depthWrite),colorWrite:pyt(t.colorWrite),stencilWrite:fyt(t.stencilWrite),drawBuffers:myt(t.drawBuffers)}));function Cyt(t){return t?F0([BDe(t.blending),zDe(t.culling),VDe(t.polygonOffset),GDe(t.depthTest),jDe(t.stencilTest),HDe(t.depthWrite),qDe(t.colorWrite),WDe(t.stencilWrite),YDe(t.drawBuffers)]):null}let Myt=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,i,r,s){return(r||e!==i)&&(s(e),this._pipelineInvalid=!0),e}},Ayt=class extends is{constructor(){super(...arguments),this.heightParameters=pi(),this.radii=vt(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=vt(),this.backgroundColor=M()}},zN=class XDe extends hr{initializeProgram(e){return new dr(e.rctx,XDe.shader.get().build(this.configuration),Fi)}initializePipeline(){return this.configuration.reduced?ti({blending:Zd(ke.ONE,ke.ZERO),depthTest:{func:Lr.ALWAYS},colorWrite:fi}):this.configuration.haze?ti({blending:Za(ke.ONE,ke.ZERO,ke.ONE_MINUS_SRC_COLOR,ke.ONE),colorWrite:fi}):ti({blending:Zd(ke.SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),depthTest:{func:Lr.LEQUAL},colorWrite:fi})}};zN.shader=new ir(syt,()=>ye(()=>import("./ChapmanAtmosphere.glsl-a5aec60a.js"),[],import.meta.url));let Zc=class extends is{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,i={key:this.key};for(const r of e)i[r]=this[r];return i}};function V(t={}){return(e,i)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(i),t.constValue!=null)Object.defineProperty(e,i,{get:()=>t.constValue});else{const r=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,i,{get(){return this[r]},set(u){if(this[r]!==u&&(this[r]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+i+" must be boolean or number, got "+typeof u)}})}}}let ZDe=class extends Zc{constructor(){super(...arguments),this.haze=!1}};d([V()],ZDe.prototype,"haze",void 0);let JDe=class extends ZDe{constructor(){super(...arguments),this.reduced=!1}};d([V()],JDe.prototype,"reduced",void 0);var xs,pa;(function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"})(xs||(xs={})),function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(pa||(pa={}));let mg=class{constructor(e,i,r,s,n,o=!1,a=0){this.name=e,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new mg(O.POSITION,3,At.FLOAT,0,12);const Fue=[new mg(O.POSITION,2,At.FLOAT,0,8)],Qk=[new mg(O.POSITION,2,At.FLOAT,0,16),new mg(O.UV0,2,At.FLOAT,8,16)];function Ryt(t){switch(t){case At.BYTE:case At.UNSIGNED_BYTE:return 1;case At.SHORT:case At.UNSIGNED_SHORT:case At.HALF_FLOAT:return 2;case At.FLOAT:case At.INT:case At.UNSIGNED_INT:return 4}}function QDe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function Pv(t,e){return t.vertexBuffers[e].usedMemory/Pyt(t.layout[e])}function Pyt(t){return t[0].stride}function kue(t,e,i,r,s=0){const n=t.gl;t.bindBuffer(i);for(const o of r){const a=e.get(o.name);if(a===void 0){console.warn(`There is no location for vertex attribute '${o.name}' defined.`);continue}const l=s*o.stride;if(o.count<=4)n.vertexAttribPointer(a,o.count,o.type,o.normalized,o.stride,o.offset+l),n.enableVertexAttribArray(a),o.divisor>0&&t.gl.vertexAttribDivisor(a,o.divisor);else if(o.count===9)for(let c=0;c<3;c++)n.vertexAttribPointer(a+c,3,o.type,o.normalized,o.stride,o.offset+12*c+l),n.enableVertexAttribArray(a+c),o.divisor>0&&t.gl.vertexAttribDivisor(a+c,o.divisor);else if(o.count===16)for(let c=0;c<4;c++)n.vertexAttribPointer(a+c,4,o.type,o.normalized,o.stride,o.offset+16*c+l),n.enableVertexAttribArray(a+c),o.divisor>0&&t.gl?.vertexAttribDivisor(a+c,o.divisor);else console.error("Unsupported vertex attribute element count: "+o.count);if(wm()){const c=QDe(t),u=Ryt(o.type),h=o.offset,p=Math.round(u/h)!==u/h?`. Offset not a multiple of stride. DataType requires ${u} bytes, but descriptor has an offset of ${h}`:"";c&&console.error(`Unable to bind vertex attribute "${o.name}" with baseInstanceOffset ${l}${p}:`,c,o)}}}function KDe(t,e,i,r){const s=t.gl;t.bindBuffer(i);for(const n of r){const o=e.get(n.name);if(n.count<=4)s.disableVertexAttribArray(o),n.divisor&&n.divisor>0&&t.gl?.vertexAttribDivisor(o,0);else if(n.count===9)for(let a=0;a<3;a++)s.disableVertexAttribArray(o+a),n.divisor&&n.divisor>0&&t.gl?.vertexAttribDivisor(o+a,0);else if(n.count===16)for(let a=0;a<4;a++)s.disableVertexAttribArray(o+a),n.divisor&&n.divisor>0&&t.gl?.vertexAttribDivisor(o+a,0);else console.error("Unsupported vertex attribute element count: "+n.count)}t.unbindBuffer(Dt.ARRAY_BUFFER)}function Uue(t){switch(t){case Xt.ALPHA:case Xt.LUMINANCE:case Xt.RED:case Xt.RED_INTEGER:case Ct.R8:case Ct.R8I:case Ct.R8UI:case Ct.R8_SNORM:case dl.STENCIL_INDEX8:return 1;case Xt.LUMINANCE_ALPHA:case Xt.RG:case Xt.RG_INTEGER:case Ct.RGBA4:case Ct.R16F:case Ct.R16I:case Ct.R16UI:case Ct.RG8:case Ct.RG8I:case Ct.RG8UI:case Ct.RG8_SNORM:case Ct.RGB565:case Ct.RGB5_A1:case dl.DEPTH_COMPONENT16:return 2;case Xt.DEPTH_COMPONENT:case Xt.RGB:case Xt.RGB_INTEGER:case Ct.RGB8:case Ct.RGB8I:case Ct.RGB8UI:case Ct.RGB8_SNORM:case Ct.SRGB8:case dl.DEPTH_COMPONENT24:return 3;case Xt.DEPTH_STENCIL:case Xt.DEPTH24_STENCIL8:case Xt.RGBA:case Xt.RGBA_INTEGER:case Ct.RGBA8:case Ct.R32F:case Ct.R11F_G11F_B10F:case Ct.RG16F:case Ct.R32I:case Ct.R32UI:case Ct.RG16I:case Ct.RG16UI:case Ct.RGBA8I:case Ct.RGBA8UI:case Ct.RGBA8_SNORM:case Ct.SRGB8_ALPHA8:case Ct.RGB9_E5:case Ct.RGB10_A2UI:case Ct.RGB10_A2:case dl.DEPTH_STENCIL:case dl.DEPTH_COMPONENT32F:case dl.DEPTH24_STENCIL8:return 4;case dl.DEPTH32F_STENCIL8:return 5;case Ct.RGB16F:case Ct.RGB16I:case Ct.RGB16UI:return 6;case Ct.RG32F:case Ct.RG32I:case Ct.RG32UI:case Ct.RGBA16F:case Ct.RGBA16I:case Ct.RGBA16UI:return 8;case Ct.RGB32F:case Ct.RGB32I:case Ct.RGB32UI:return 12;case Ct.RGBA32F:case Ct.RGBA32I:case Ct.RGBA32UI:return 16;case vn.COMPRESSED_RGB_S3TC_DXT1_EXT:case vn.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case vn.COMPRESSED_RGBA_S3TC_DXT3_EXT:case vn.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case vn.COMPRESSED_R11_EAC:case vn.COMPRESSED_SIGNED_R11_EAC:case vn.COMPRESSED_RGB8_ETC2:case vn.COMPRESSED_SRGB8_ETC2:case vn.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case vn.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case vn.COMPRESSED_RG11_EAC:case vn.COMPRESSED_SIGNED_RG11_EAC:case vn.COMPRESSED_RGBA8_ETC2_EAC:case vn.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const YU=()=>oe.getLogger("esri.views.webgl.VertexArrayObject");let gg=class{constructor(e,i,r,s,n=null){this._context=e,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,i)=>e+this._buffers[i].usedMemory,this._indexBuffer!=null?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*aAe}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const e in this._buffers)this._buffers[e]?.dispose(),delete this._buffers[e];this._indexBuffer=jt(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&YU().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(Nn.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,i=e.createVertexArray();e.bindVertexArray(i),this._bindLayout(),e.bindVertexArray(null),this._glName=i,this._context.instanceCounter.increment(Nn.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:i,_indexBuffer:r}=this;e||YU().error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||YU().error("Vertex buffer is uninitialized!");const a=i[n];a||YU().error("Vertex element descriptor is empty!"),kue(this._context,this._locations,o,a)}r!=null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}},k0=class extends gg{};const m_e=()=>oe.getLogger("esri.views.webgl.BufferObject");let Vr=class IT{static createIndex(e,i,r){return new IT(e,Dt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(e,i,r){return new IT(e,Dt.ARRAY_BUFFER,i,r)}static createUniform(e,i,r){return new IT(e,Dt.UNIFORM_BUFFER,i,r)}static createPixelPack(e,i=wr.STREAM_READ,r){const s=new IT(e,Dt.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(e,i=wr.STREAM_DRAW,r){return new IT(e,Dt.PIXEL_UNPACK_BUFFER,i,r)}static createTransformFeedback(e,i=wr.STATIC_DRAW,r){const s=new IT(e,Dt.TRANSFORM_FEEDBACK_BUFFER,i);return s.setSize(r),s}constructor(e,i,r,s){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Nn.BufferObject,this),this._glName=this._context.gl.createBuffer(),zy(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===Dt.ELEMENT_ARRAY_BUFFER?this._indexType===At.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Dt.ELEMENT_ARRAY_BUFFER||this.bufferType===Dt.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Nn.BufferObject,this),this._context=null):this._glName&&m_e().warn("Leaked WebGL buffer object")}setSize(e,i=null){if(this.bufferType===Dt.ELEMENT_ARRAY_BUFFER&&i!=null)switch(this._indexType=i,i){case At.UNSIGNED_SHORT:e*=2;break;case At.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===Dt.ELEMENT_ARRAY_BUFFER&&(sq(e)&&(i/=2,this._indexType=At.UNSIGNED_SHORT),cle(e)&&(i/=4,this._indexType=At.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;i!=null?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,e,this.usage),zy(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,s){if(!e)return;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,s-r),zy(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,i=0,r,s){if(r<0||s<0)return;const n=Oyt(e)?e.BYTES_PER_ELEMENT:1;if(n*((r??0)+(s??0))>e.byteLength)return;i+n*(s??0)>this.usedMemory&&m_e().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===Dt.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,Dt.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(Dt.TRANSFORM_FEEDBACK_BUFFER,i,e,r,s),this._context.unbindBuffer(Dt.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,Dt.COPY_READ_BUFFER),o.getBufferSubData(Dt.COPY_READ_BUFFER,i,e,r,s),this._context.unbindBuffer(Dt.COPY_READ_BUFFER))}async getSubDataAsync(e,i=0,r,s){await this._context.clientWaitAsync(),this.getSubData(e,i,r,s)}};function Oyt(t){return aXe(t)}var Wv;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(Wv||(Wv={}));let fs=class{constructor(e=0,i=e){this.width=e,this.height=i,this.target=on.TEXTURE_2D,this.pixelFormat=Xt.RGBA,this.dataType=cc.UNSIGNED_BYTE,this.samplingMode=_i.LINEAR,this.wrapMode=Di.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function Iyt(t){return t.width<=0||t.height<=0?0:Math.round(t.width*t.height*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:Uue(t.internalFormat)))}let $yt=class eFe extends fs{constructor(e,i){switch(super(),this.context=e,Object.assign(this,i),this.internalFormat){case Ct.R16F:case Ct.R16I:case Ct.R16UI:case Ct.R32F:case Ct.R32I:case Ct.R32UI:case Ct.R8_SNORM:case Ct.R8:case Ct.R8I:case Ct.R8UI:this.pixelFormat=Xt.RED}}static validate(e,i){return new eFe(e,i)}};const g_e=4;let Gr=class wp{constructor(e,i=null,r=null){if(this.type=Wv.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=i;else{const s=$yt.validate(e,i);if(!s)throw new j("Texture descriptor invalid");this._descriptor=s}this._descriptor.target===on.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return Iyt(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(Nn.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new j("Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===on.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let i=on.TEXTURE_CUBE_MAP_POSITIVE_X;i<=on.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(e,i)}setData(e){this._setData(e)}_setData(e,i){if(!this._descriptor.context?.gl)return;const r=this._descriptor.context.gl;zy(r),this._glName||(this._glName=r.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(Nn.Texture,this)),e===void 0&&(e=null);const s=this._descriptor,n=i??s.target,o=X$(n);e===null&&(s.width=s.width||g_e,s.height=s.height||g_e,o&&(s.depth=s.depth??1));const a=this._descriptor.context.bindTexture(this,wp.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(wp.TEXTURE_UNIT_FOR_UPDATES),XU(s),this._configurePixelStorage(),zy(r);const l=this._deriveInternalFormat();if(v_e(e)){let c="width"in e?e.width:e.codedWidth,u="height"in e?e.height:e.codedHeight;const h=1;e instanceof HTMLVideoElement&&(c=e.videoWidth,u=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,c,u,h),this._texImage(n,0,l,c,u,h,e),zy(r),s.hasMipmap&&this.generateMipmap(),s.width||(s.width=c),s.height||(s.height=u),o&&!s.depth&&(s.depth=h)}else{const{width:c,height:u,depth:h}=s;if(c==null||u==null)throw new j("Width and height must be specified!");if(o&&h==null)throw new j("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,c,u,h),nG(e)){const p=e.levels,f=b_e(n,c,u,h),g=Math.min(f-1,p.length-1);r.texParameteri(s.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,g);const y=l;if(!Dyt(y))throw new j("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((v,b,w,x)=>{const S=p[Math.min(v,p.length-1)];this._compressedTexImage(n,v,y,b,w,x,S)},g)}else this._texImage(n,0,l,c,u,h,e),zy(r),s.hasMipmap&&this.generateMipmap()}y_e(r,this._descriptor),__e(r,this._descriptor),Nyt(this._descriptor.context,this._descriptor),zy(r),this._descriptor.context.bindTexture(a,wp.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,i,r,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor,c=this._deriveInternalFormat(),{context:u,pixelFormat:h,dataType:p,target:f,isImmutable:g}=l;if(g&&!this._wasImmutablyAllocated)throw new j("Cannot update immutable texture before allocation!");const y=u.bindTexture(this,wp.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||r<0||i+s>l.width||r+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=u;a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,a),v_e(o)?v.texSubImage2D(f,e,i,r,s,n,h,p,o):nG(o)?v.compressedTexSubImage2D(f,e,i,r,s,n,c,o.levels[e]):v.texSubImage2D(f,e,i,r,s,n,h,p,o),a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,0),u.bindTexture(y,wp.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,u=this._deriveInternalFormat(),{context:h,pixelFormat:p,dataType:f,isImmutable:g,target:y}=c;if(g&&!this._wasImmutablyAllocated)throw new j("Cannot update immutable texture before allocation!");X$(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=h.bindTexture(this,wp.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(wp.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||i+n>c.width||r+o>c.height||s+a>c.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:b}=h;if(nG(l))l=l.levels[e],b.compressedTexSubImage3D(y,e,i,r,s,n,o,a,u,l);else{const w=l;b.texSubImage3D(y,e,i,r,s,n,o,a,p,f,w)}h.bindTexture(v,wp.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new j("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,XU(e)}e.samplingMode===_i.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=_i.LINEAR_MIPMAP_NEAREST):e.samplingMode===_i.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=_i.NEAREST_MIPMAP_NEAREST);const i=this._descriptor.context.bindTexture(this,wp.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(wp.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,wp.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new j("Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,XU(e)}e.samplingMode===_i.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=_i.LINEAR):e.samplingMode===_i.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=_i.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,XU(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor,i=e.context.gl;this._samplingModeDirty&&(y_e(i,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(__e(i,e),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===Xt.DEPTH_STENCIL&&(this._descriptor.internalFormat=Xt.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case cc.FLOAT:switch(this._descriptor.pixelFormat){case Xt.RGBA:return this._descriptor.internalFormat=Ct.RGBA32F;case Xt.RGB:return this._descriptor.internalFormat=Ct.RGB32F;default:throw new j("Unable to derive format")}case cc.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case Xt.RGBA:return this._descriptor.internalFormat=Ct.RGBA8;case Xt.RGB:return this._descriptor.internalFormat=Ct.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===Xt.DEPTH_STENCIL?Xt.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,i,r,s,n,o){const{gl:a}=this._descriptor.context;if(!Lyt(i))throw new j("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?b_e(e,s,n,o):1;if(X$(e)){if(o==null)throw new j("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,i,s,n,o)}else a.texStorage2D(e,l,i,s,n);this._wasImmutablyAllocated=!0}_texImage(e,i,r,s,n,o,a){const l=this._descriptor.context.gl,c=X$(e),{isImmutable:u,pixelFormat:h,dataType:p}=this._descriptor;if(u){if(a!=null){const f=a;if(c){if(o==null)throw new j("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,i,0,0,0,s,n,o,h,p,f)}else l.texSubImage2D(e,i,0,0,s,n,h,p,f)}}else{const f=a;if(c){if(o==null)throw new j("Missing depth dimension for 3D texture upload");l.texImage3D(e,i,r,s,n,o,0,h,p,f)}else l.texImage2D(e,i,r,s,n,0,h,p,f)}}_compressedTexImage(e,i,r,s,n,o,a){const l=this._descriptor.context.gl,c=X$(e);if(this._descriptor.isImmutable){if(a!=null)if(c){if(o==null)throw new j("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,i,0,0,0,s,n,o,r,a)}else l.compressedTexSubImage2D(e,i,0,0,s,n,r,a)}else if(c){if(o==null)throw new j("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,i,r,s,n,o,0,a)}else l.compressedTexImage2D(e,i,r,s,n,0,a)}_forEachMipmapLevel(e,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===on.TEXTURE_3D;if(r==null||s==null||l&&n==null)throw new j("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}};function XU(t){(t.width!=null&&t.width<0||t.height!=null&&t.height<0||t.depth!=null&&t.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function y_e(t,e){let i=e.samplingMode,r=e.samplingMode;i===_i.LINEAR_MIPMAP_NEAREST||i===_i.LINEAR_MIPMAP_LINEAR?(i=_i.LINEAR,e.hasMipmap||(r=_i.LINEAR)):i!==_i.NEAREST_MIPMAP_NEAREST&&i!==_i.NEAREST_MIPMAP_LINEAR||(i=_i.NEAREST,e.hasMipmap||(r=_i.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,r)}function __e(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function Nyt(t,e){const i=t.capabilities.textureFilterAnisotropic;i&&t.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function Lyt(t){return t in Ct}function Dyt(t){return t in vn}function nG(t){return t!=null&&"type"in t&&t.type==="compressed"}function Fyt(t){return t!=null&&"byteLength"in t}function v_e(t){return t!=null&&!nG(t)&&!Fyt(t)}function X$(t){return t===on.TEXTURE_3D||t===on.TEXTURE_2D_ARRAY}function b_e(t,e,i,r=1){let s=Math.max(e,i);return t===on.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}Gr.TEXTURE_UNIT_FOR_UPDATES=0;function U0(t,e=Fue,i=Fi,r=-1,s=1){let n=null;return e===Qk?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new k0(t,i,{geometry:e},{geometry:Vr.createVertex(t,wr.STATIC_DRAW,n)})}const kyt=4;function tFe(t){const e=new fs(kyt);return e.samplingMode=_i.NEAREST,new Gr(t,e)}const Kj=16;function Fw(t){return Math.ceil(t/Kj)*Kj}function iFe(t){return Math.floor(t/Kj)*Kj}function Uyt(t,e){let n=t.width*t.height;if(n<4096)return t instanceof ImageData?rFe(t):t;let o=t.width,a=t.height;do o=Math.ceil(o/2),a=Math.ceil(a/2),n=o*a;while(n>1048576||e!=null&&(o>e||a>e));return Bue(t,o,a)}function Byt(t,e){const i=Math.max(t.width,t.height);if(i<=e)return t;const r=e/i;return Bue(t,Math.round(t.width*r),Math.round(t.height*r))}function Bue(t,e,i){if(t instanceof ImageData)return Bue(rFe(t),e,i);const r=document.createElement("canvas");return r.width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,r.width,r.height),r}function rFe(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");if(i==null)throw new j("Failed to create 2d context from HTMLCanvasElement");return i.putImageData(t,0,0),e}function Rl(t,e=!0){t.attributes.add(O.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(T`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?T`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let sFe=class extends is{};function zyt(t){const e=new tr;e.include(Rl),e.fragment.uniforms.add(new Et("colorTexture",r=>r.color),new Et("depthTexture",r=>r.depth));const i=t.haze;return e.fragment.code.add(T`
    void main() {
      float depthSample = texture(depthTexture, uv).r;
      if (depthSample ${i?T`== 1.0`:T`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `),e}const Vyt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:sFe,build:zyt},Symbol.toStringTag,{value:"Module"}));let Vie=class nFe extends hr{initializeProgram(e){return new dr(e.rctx,nFe.shader.get().build(this.configuration),Fi)}initializePipeline(){return this.configuration.haze?ti({blending:Za(ke.ONE,ke.ZERO,ke.ONE_MINUS_SRC_COLOR,ke.ONE),depthTest:{func:Lr.ALWAYS},colorWrite:fi}):ti({blending:Zd(ke.SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),depthTest:{func:Lr.ALWAYS},colorWrite:fi})}};Vie.shader=new ir(Vyt,()=>ye(()=>import("./AtmosphereCompositing.glsl-61497dca.js"),[],import.meta.url));let Gyt=class{constructor(e,i){this._view=e,this._context=i,this.type=Vl.Realistic,this._handles=new A0,this._compositingPassParameters=new sFe,this._passParameters=new Ayt,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=br.radius,this._fadeHaze=0,this._updateRadius(br.radius);const r=this._context.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([_e(()=>this._view?.basemapTerrain?.rootTileElevationBounds,()=>this._view?.basemapTerrain?this._updateRootTileElevationBounds():null),_e(()=>this._view?.basemapTerrain?.visibleElevationBounds,()=>this._view?.basemapTerrain?this._updateVisibleElevationBounds():null),_e(()=>this._view?.environment.background,n=>{const o=n instanceof b$e?MF(n.color):Ud;ue(this._passParameters.backgroundColor,o[0]*o[3],o[1]*o[3],o[2]*o[3])},Sr)]);const s=new JDe;s.haze=!1,this._atmosphereTechnique=this._context.techniques.acquire(zN,s),this._compositingTechnique=this._context.techniques.acquire(Vie,s),s.haze=!0,this._atmosphereHazeTechnique=this._context.techniques.acquire(zN,s),this._compositingHazeTechnique=this._context.techniques.acquire(Vie,s),s.reduced=!0,s.haze=!1,this._atmosphereReducedTechnique=this._context.techniques.acquire(zN,s),s.haze=!0,this._atmosphereHazeReducedTechnique=this._context.techniques.acquire(zN,s),this._vao=U0(r,Qk)}destroy(){this._handles.destroy(),this._compositingTechnique.release(),this._compositingHazeTechnique.release(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,i){this._render(e,i?this._atmosphereTechnique:this._atmosphereReducedTechnique,i,!1)}renderHaze(e,i,r){this._fadeHaze=i,this._render(e,r?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,r,!0)}_render(e,i,r,s){const n=e.bindParameters.mainDepth;if(!n)return;this._update(e.bindParameters.camera),this._passParameters.depthTexture=n;const o=e.rctx.bindTechnique(i,e.bindParameters,this._passParameters),a=e.offscreenRenderingHelper;if(r)a.renderDepthDetached(()=>this._renderCommon(o,e));else{const l=e.rctx.getViewport(),c=De(e.bindParameters.camera.eye)-br.radius;let u;if(c<Qb){const y=Math.min(1,Math.max(0,c/Qb));u=s?Wt(.4,.5,y):Wt(.2,.3,y)}else{const y=Math.min(1,Math.max(0,(c-Qb)/(15*Qb)));u=s?Wt(.5,1,y):Wt(.3,.6,y)}const h=Fw(Math.round(u*e.bindParameters.camera.fullViewport[2])),p=Fw(Math.round(u*e.bindParameters.camera.fullViewport[3]));e.rctx.setViewport(0,0,h,p);const f=a.renderToCachedFBO(null,s?"chapman haze":"chapman",()=>this._renderCommon(o,e),[0,0,0,1],xs.RGBA,null,h,p);e.rctx.setViewport(l.x,l.y,l.width,l.height),this._compositingPassParameters.color=f.getTexture(),this._compositingPassParameters.depth=n;const g=s?this._compositingHazeTechnique:this._compositingTechnique;e.rctx.bindTechnique(g,e.bindParameters,this._compositingPassParameters),a.renderDepthDetached(()=>e.rctx.screen.draw()),f.release()}}_renderCommon(e,i){this._vao!=null&&(i.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.rctx.drawArrays(Li.TRIANGLE_STRIP,0,4))}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=br.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=jyt(br.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,Gi(this._passParameters.radii,e,e+Qb),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-Lie)*Lie)}_update(e){if(!e)return;const i=Ql(e.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]*this._passParameters.radii[1],n=$e((r-this._passParameters.radii[0])/Qb,0,1);Ds(this._passParameters.heightParameters,r,i,s,n),this._passParameters.altitudeFade=Nue(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Wt(Wt(.6,1,uF(9500,10500,r-br.radius)),1,this._fadeHaze)}};function jyt(t){return t*Math.cos(Math.PI/16/16)}function zue(t){t.fragment.code.add(T`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function Vue(t,e){switch(t.include(jm,e),e.textureCoordinateType){case ks.Default:case ks.Compressed:return void t.fragment.code.add(T`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case ks.Atlas:return t.include(zue),void t.fragment.code.add(T`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case ks.None:case ks.COUNT:return}}let Vd=class extends hn{constructor(e,i){super(e,"vec3",ar.Draw,(r,s,n,o)=>r.setUniform3fv(e,i(s,n,o)))}},o0=class extends hn{constructor(e,i){super(e,"sampler2D",ar.Draw,(r,s,n)=>r.bindTexture(e,i(s,n)))}},jx=class{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){this._techniques.release(this._technique)}get technique(){return this._technique}get _stippleTextures(){return this._techniques.constructionContext.stippleTextures}get _markerTextures(){return this._techniques.constructionContext.markerTextures}ensureTechnique(e,i){return this._technique=this._techniques.releaseAndAcquire(e,this._material.getConfiguration(this._output,i),this._technique),this._technique}ensureResources(e){return px.LOADED}},Gue=class extends jx{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this._textureId=e.textureId,this._acquire(e.textureId,i=>this._texture=i),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=yi(this._texture),this._textureNormal=yi(this._textureNormal),this._textureEmissive=yi(this._textureEmissive),this._textureOcclusion=yi(this._textureOcclusion),this._textureMetallicRoughness=yi(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?px.LOADED:px.LOADING}get textureBindParameters(){return new oFe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=yi(this._texture),this._textureId=e,this._acquire(this._textureId,i=>this._texture=i))}_acquire(e,i){if(e==null)return void i(null);const r=this._textures.acquire(e);if(Lh(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return yi(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}},oFe=class extends is{constructor(e=null,i=null,r=null,s=null,n=null,o,a){super(),this.texture=e,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=s,this.textureMetallicRoughness=n,this.scale=o,this.normalTextureTransformMatrix=a}};var Ot;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Simplified=5]="Simplified",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(Ot||(Ot={}));function jue(t,e){const i=t.fragment,r=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===Ot.Normal&&r&&t.include(Vue,e),e.pbrMode!==Ot.Schematic)if(e.pbrMode!==Ot.Disabled){if(e.pbrMode===Ot.Normal){i.code.add(T`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(i.uniforms.add(s===ar.Pass?new Et("texMetallicRoughness",n=>n.textureMetallicRoughness):new o0("texMetallicRoughness",n=>n.textureMetallicRoughness)),i.code.add(T`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(i.uniforms.add(s===ar.Pass?new Et("texEmission",n=>n.textureEmissive):new o0("texEmission",n=>n.textureEmissive)),i.code.add(T`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(i.uniforms.add(s===ar.Pass?new Et("texOcclusion",n=>n.textureOcclusion):new o0("texOcclusion",n=>n.textureOcclusion)),i.code.add(T`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(T`float getBakedOcclusion() { return 1.0; }`),s===ar.Pass?i.uniforms.add(new Qt("emissionFactor",n=>n.emissiveFactor),new Qt("mrrFactors",n=>n.mrrFactors)):i.uniforms.add(new Vd("emissionFactor",n=>n.emissiveFactor),new Vd("mrrFactors",n=>n.mrrFactors)),i.code.add(T`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?T`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?T`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?T`applyEmission(${e.hasEmissiveTextureTransform?T`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?T`applyOcclusion(${e.hasOcclusionTextureTransform?T`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else i.code.add(T`float getBakedOcclusion() { return 1.0; }`);else i.code.add(T`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function Hue(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new Qt("lightingAmbientSH0",(s,n)=>ue(w_e,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),i.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add(new Ki("lightingAmbientSH_R",(s,n)=>Ds(i_,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new Ki("lightingAmbientSH_G",(s,n)=>Ds(i_,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new Ki("lightingAmbientSH_B",(s,n)=>Ds(i_,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))),i.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add(new Qt("lightingAmbientSH0",(s,n)=>ue(w_e,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new Ki("lightingAmbientSH_R1",(s,n)=>Ds(i_,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new Ki("lightingAmbientSH_G1",(s,n)=>Ds(i_,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new Ki("lightingAmbientSH_B1",(s,n)=>Ds(i_,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new Ki("lightingAmbientSH_R2",(s,n)=>Ds(i_,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new Ki("lightingAmbientSH_G2",(s,n)=>Ds(i_,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new Ki("lightingAmbientSH_B2",(s,n)=>Ds(i_,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))),i.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==Ot.Normal&&e.pbrMode!==Ot.Schematic||i.code.add(T`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const w_e=M(),i_=pi();function Kk(t){t.vertex.code.add(T`const float PI = 3.141592653589793;`),t.fragment.code.add(T`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var Xy,qE;function Hyt(t){return t?.cubeMap!=null}function qyt(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FADING=1]="FADING",t[t.FINISHED=2]="FINISHED"})(Xy||(Xy={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(qE||(qE={}));function s1(t=Wyt){return[t[0],t[1],t[2],t[3]]}function mY(t,e,i=s1()){return ge(i,t),i[3]=e,i}function x_e(t,e,i=pi()){return yt(i,t,e),Se(i,i),i[3]=-TPe(t,e),i}function Zpi(t,e=s1()){const i=kPe(VN,t);return aFe(e,El(d9(e,i))),e}function S_e(t,e,i=s1()){return Uj(VN,t,T_e(t)),Uj(E_e,e,T_e(e)),p9(VN,E_e,VN),aFe(i,El(d9(i,VN)))}function Jpi(t,e,i,r=s1()){return mY(Hle,t,ZU),mY(qle,e,C_e),mY(bO,i,M_e),S_e(ZU,C_e,ZU),S_e(ZU,M_e,r),r}function Qpi(t){return t}function Kpi(t){return t[3]}function T_e(t){return Gt(t[3])}function aFe(t,e){return t[3]=e,t}const Wyt=[0,0,1,0],VN=Qd(),E_e=Qd();s1();const ZU=s1(),C_e=s1(),M_e=s1();let Yyt=class{constructor(){this.readChannels=qE.RG,this.renderingStage=Xy.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=M(),this.parallax=new A_e,this.parallaxNew=new A_e,this.pointOnGround=M(),this.fadeMode=ls.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const i=this.parallax,r=De(e.eye);if(i.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(r*r-br.radius*br.radius,0))/r,x_e(R_e,i.anchorPointClouds,cM),bh(i.transform,us,cM[3],cM),this.fadeMode===ls.CROSS_FADE){const s=this.parallaxNew;x_e(R_e,s.anchorPointClouds,cM),bh(s.transform,us,cM[3],cM)}}updateFading(e,i,r,s){this.isFading&&this._advanceFading(r,s),this._evaluateFading(e,i,r)}_evaluateFading(e,i,r){const s=e.relativeElevation,n=this._calculateDistanceToAnchorPoint(e);if((s>1.7*ov||s<-ov||n>Kyt)&&this.opacity>0)this._setFade(ls.HIDE,r);else if(!this.isFading){if((s>ov||s<-.35*ov||n>Qyt)&&this.opacity>0)this._setFade(ls.FADE_OUT,r);else if(s<=ov&&s>=-.35*ov&&i===zi.IDLE&&qyt(this.data)){if(this.opacity===0)return void this._setFade(ls.FADE_IN,r);(n>Jyt||this.renderingStage===Xy.FADING)&&this._setFade(ls.CROSS_FADE,r)}}}_advanceFading(e,i){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,i)}_advanceFadingFactorAndOpacity(e,i){if(this.fadeFactor<1)return this.fadeFactor=i?$e((e-this.startTime)/(Zyt*i),0,1):1,this.fadeMode===ls.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===ls.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===ls.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===ls.FADE_OUT&&(this.opacity=0),this.fadeMode===ls.FADE_IN&&(this.opacity=1),this.fadeMode===ls.CROSS_FADE&&(this.opacity=1),this.fadeMode=ls.NONE}_switchReadChannels(){const e=this.fadeMode===ls.CROSS_FADE&&this.fadeFactor===1,i=this.fadeMode===ls.FADE_IN&&this.fadeFactor===0;this.renderingStage===Xy.FADING&&(e||i)&&(this.readChannels=1-this.readChannels,this.renderingStage=Xy.FINISHED)}_calculateDistanceToAnchorPoint(e){return Se(this.pointOnGround,e.eye),ce(this.pointOnGround,this.pointOnGround,br.radius),De(Me(Xyt,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===ls.CROSS_FADE&&(this.fadeFactor===0&&ge(this.parallaxNew.anchorPointClouds,this.pointOnGround),this.fadeFactor===1&&ge(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===ls.FADE_IN&&this.fadeFactor===0&&ge(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,i){switch(e){case ls.HIDE:this.opacity=0;break;case ls.FADE_OUT:this.opacity=1;break;case ls.FADE_IN:this.opacity=0;break;case ls.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=i}get isFading(){return this.fadeMode===ls.FADE_OUT||this.fadeMode===ls.FADE_IN||this.fadeMode===ls.CROSS_FADE}};var ls;(function(t){t[t.NONE=0]="NONE",t[t.HIDE=1]="HIDE",t[t.FADE_OUT=2]="FADE_OUT",t[t.FADE_IN=3]="FADE_IN",t[t.CROSS_FADE=4]="CROSS_FADE"})(ls||(ls={}));let A_e=class{constructor(){this.anchorPointClouds=M(),this.radiusCurvatureCorrectionFactor=0,this.transform=Ne()}};const R_e=Be(0,0,1),cM=s1(),Xyt=M(),Zyt=1.25,Jyt=34e3,Qyt=64e3,Kyt=2e5;let a0=class extends hn{constructor(e,i){super(e,"bool",ar.Pass,(r,s,n)=>r.setUniform1b(e,i(s,n)))}},e0t=class extends hn{constructor(e,i){super(e,"samplerCube",ar.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function lFe(t){const e=t.fragment;e.uniforms.add(new Ps("rotationMatrixClouds",(i,r)=>r.cloudsFade.parallax.transform),new Ps("rotationMatrixCloudsCrossFade",(i,r)=>r.cloudsFade.parallaxNew.transform),new Qt("anchorPosition",(i,r)=>r.cloudsFade.parallax.anchorPointClouds),new Qt("anchorPositionCrossFade",(i,r)=>r.cloudsFade.parallaxNew.anchorPointClouds),new et("cloudsHeight",()=>rot),new et("radiusCurvatureCorrectionFactor",(i,r)=>r.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new et("totalFadeInOut",(i,r)=>1-r.cloudsFade.opacity),new et("crossFadeAnchorFactor",(i,r)=>$e(r.cloudsFade.fadeFactor,0,1)),new e0t("cubeMap",(i,r)=>r.cloudsFade.data?.cubeMap?.colorTexture??null),new a0("crossFade",(i,r)=>r.cloudsFade.fadeMode===ls.CROSS_FADE),new a0("readChannelsRG",(i,r)=>r.cloudsFade.readChannels===qE.RG),new a0("fadeTextureChannels",(i,r)=>r.cloudsFade.renderingStage===Xy.FADING)),e.constants.add("planetRadius","float",br.radius),e.code.add(T`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(T`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(T`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),r1(e),L0(e),e.code.add(T`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(T`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(T`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(T`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(T`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function B0(t){t.code.add(T`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function t0t(){const t=new tr,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add(O.POSITION,"vec2"),i.add("worldRay","vec3"),r.uniforms.add(new Ps("inverseProjectionMatrix",(n,o)=>o.camera.inverseProjectionMatrix),new Ps("inverseViewMatrix",(n,o)=>Ox(i0t,o.camera.viewMatrix))),r.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),s.include(B0),s.include(Cg),t.include(Hue,{pbrMode:Ot.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(Kk),t.include(E9),t.include(Zj),t.include(lFe),s.uniforms.add(new Qt("cameraPosition",(n,o)=>o.camera.eye)),s.code.add(T`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const i0t=Ne(),r0t=Object.freeze(Object.defineProperty({__proto__:null,build:t0t},Symbol.toStringTag,{value:"Module"}));let cFe=class uFe extends hr{constructor(e){super(e,new Zc,()=>this.destroy())}initializeProgram(e){return new dr(e.rctx,uFe.shader.get().build(),Fi)}initializePipeline(){return ti({blending:Za(ke.ONE,ke.ZERO,ke.SRC_ALPHA,ke.ONE),depthTest:{func:Lr.LEQUAL},colorWrite:fi})}};cFe.shader=new ir(r0t,()=>ye(()=>import("./CloudsComposition.glsl-11d32de3.js"),[],import.meta.url));let $T=class extends Fe{constructor(e){super(e),this._technique=new cFe(e),this._vao=U0(e.rctx)}destroy(){this._technique=yi(this._technique),this._vao=jt(this._vao)}render(e){if(!this._technique.compiled)return void this.requestRender();const i=e.bindParameters.cloudsFade;if(this._vao==null||i.data==null)return;const r=e.rctx.bindTechnique(this._technique,e.bindParameters,s0t);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Li.TRIANGLE_STRIP,0,4)}};d([m({constructOnly:!0})],$T.prototype,"rctx",void 0),d([m({constructOnly:!0})],$T.prototype,"viewingMode",void 0),d([m({constructOnly:!0})],$T.prototype,"planetRadius",void 0),d([m({constructOnly:!0})],$T.prototype,"requestRender",void 0),$T=d([N("esri.views.3d.environment.CloudsComposition")],$T);const s0t=new is;function fh(){return new Float32Array(3)}function Gie(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function qr(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function n0t(t,e){return new Float32Array(t,e,3)}function que(){return fh()}function hFe(){return qr(1,1,1)}function dFe(){return qr(1,0,0)}function pFe(){return qr(0,1,0)}function fFe(){return qr(0,0,1)}const o0t=que(),a0t=hFe(),l0t=dFe(),c0t=pFe(),u0t=fFe();Object.freeze(Object.defineProperty({__proto__:null,ONES:a0t,UNIT_X:l0t,UNIT_Y:c0t,UNIT_Z:u0t,ZEROS:o0t,clone:Gie,create:fh,createView:n0t,fromValues:qr,ones:hFe,unitX:dFe,unitY:pFe,unitZ:fFe,zeros:que},Symbol.toStringTag,{value:"Module"}));var Ru;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(Ru||(Ru={}));let oG=class extends Zc{constructor(){super(...arguments),this.steps=Ru.SIXTEEN,this.writeTextureChannels=qE.RG}};d([V({count:Ru.COUNT})],oG.prototype,"steps",void 0),d([V({constValue:ae("esri-mobile")?1024:2048})],oG.prototype,"cubeMapSize",void 0),d([V()],oG.prototype,"writeTextureChannels",void 0);let GN=class{constructor(e,i,r,s,n,o,a,l,c=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const P_e=new GN([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Ru.SIXTEEN),Bl={sunny:P_e,cloudy:new GN([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Ru.TWOHUNDRED,.6),rainy:new GN([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Ru.TWOHUNDRED,.4),snowy:new GN([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Ru.HUNDRED,.65),foggy:new GN([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Ru.SIXTEEN),default:P_e},Bp=ae("esri-mobile")?64:128,h0t=Bp/128,gm=Math.ceil(Math.sqrt(Bp)),kw=(Bp+2)*gm,d0t=1e5,gY=128,p0t=kw/1560;let bf=class extends hn{constructor(e,i){super(e,"mat3",ar.Pass,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}},mFe=class extends is{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=Bl.default.raymarchingSteps,this.weatherTile=vt(),this.viewMatrix=ps()}};function f0t(t){const e=new tr;e.include(Rl,!1);const i=e.fragment;return i.uniforms.add(new et("cloudRadius",r=>r.cloudRadius),new et("power",r=>Wt(35,120,r.absorption)),new et("sigmaE",r=>1+r.absorption),new et("density",r=>Wt(0,.3,r.density)),new et("cloudSize",r=>Wt(0,.02,Math.max(.01,1-r.cloudSize))),new et("detailSize",r=>Wt(0,.2,Math.max(.01,1-r.detailSize))),new et("smoothness",r=>Wt(0,.5,1-r.smoothness)),new et("cloudHeight",r=>Wt(0,1500,r.cloudHeight)),new et("coverage",r=>r.coverage),new bf("view",r=>r.viewMatrix),new Et("cloudShapeTexture",r=>r.noiseTexture!=null?r.noiseTexture.textureAtlas:null),new os("cloudVariables",r=>Gi(m0t,r.coverage,r.absorption))),i.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),i.code.add(T`
    const int STEPS = ${t.steps===Ru.SIXTEEN?T`16`:t.steps===Ru.HUNDRED?T`100`:T`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(T`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${T.float(kw)};
      const float dataWidth = ${T.float(kw)};
      const float tileRows = ${T.float(gm)};
      const vec3 atlasDimensions = vec3(${T.float(Bp)}, ${T.float(Bp)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${T.float(h0t)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${T.float(p0t)} * p) / ${T.float(kw)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),i.code.add(T`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(T`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),i.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),i.code.add(T`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(T`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.code.add(T`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const m0t=vt(),g0t=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:mFe,build:f0t},Symbol.toStringTag,{value:"Module"}));let gFe=class yFe extends hr{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new dr(e.rctx,yFe.shader.get().build(this.configuration),Fi)}initializePipeline(){return ti({blending:Zd(ke.CONSTANT_COLOR,ke.ONE_MINUS_CONSTANT_COLOR,Hv.ADD,this.configuration.writeTextureChannels===qE.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Lr.LEQUAL},colorWrite:fi})}};gFe.shader=new ir(g0t,()=>ye(()=>import("./Clouds.glsl-c0e9499e.js"),[],import.meta.url));var Cd;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(Cd||(Cd={}));let jie=class extends Zc{constructor(){super(...arguments),this.mode=Cd.Full}};d([V({count:Cd.COUNT})],jie.prototype,"mode",void 0);let _Fe=class extends is{constructor(){super(...arguments),this.weatherTile=Ni(0,0)}};function y0t(t){const e=new tr;return e.include(Rl,!1),e.fragment.code.add(T`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===Cd.Full&&e.fragment.code.add(T`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${T.float(gm)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${T.float(8)});

      float worley0 = worley(p, ${T.float(2)} * 2.0);
      float worley1 = worley(p, ${T.float(2)} * 8.0);
      float worley2 = worley(p, ${T.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${T.float(2)});
      float worley1 = worley(p, ${T.float(2)} * 2.0);
      float worley2 = worley(p, ${T.float(2)} * 4.0);
      float worley3 = worley(p, ${T.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new os("weatherTile",i=>i.weatherTile)),e.fragment.code.add(T`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${T.float(gY)});

      // Get global coordinates of p
      p += weatherTile * ${T.float(gY)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${T.float(d0t)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(T`void main() {`),t.mode===Cd.Full&&e.fragment.code.add(T`
        float padWidth = 1.0;
        float paddedSize = ${T.float(Bp)} + 2.0 * padWidth;
        float tileCount = ${T.float(gm)} * ${T.float(gm)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${T.float(Bp)};
          }

          if (startPadY) {
            pixel.y += ${T.float(Bp)};
          }

          if (endPadX) {
            pixel.x -= ${T.float(Bp)};
          }

          if (endPadY) {
            pixel.y -= ${T.float(Bp)};
          }

          uv = vec2(pixel.xy / ${T.float(Bp)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${T.float(Bp)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${T.float(gm)} * ${T.float(gm)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${T.float(gm)} * ${T.float(gm)});
        p = p_;
        p.z /= (${T.float(gm)} * ${T.float(gm)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(T`
      vec2 mapUV = ${T.float(gY)} * (gl_FragCoord.xy / ${T.float(kw)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===Cd.Full?T`fragColor.ba = vec2(0.0, map);`:T`fragColor = vec4(map);`};
    }
  `),e}const _0t=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:_Fe,build:y0t},Symbol.toStringTag,{value:"Module"}));let Hie=class vFe extends hr{initializeProgram(e){return new dr(e.rctx,vFe.shader.get().build(this.configuration),Fi)}initializePipeline(){return ti({blending:this.configuration.mode===Cd.Full?Zd(ke.ONE,ke.ZERO):Za(ke.ZERO,ke.ONE,ke.ONE,ke.ZERO),depthTest:{func:Lr.ALWAYS},colorWrite:fi})}};Hie.shader=new ir(_0t,()=>ye(()=>import("./NoiseTextureAtlas.glsl-7addf852.js"),[],import.meta.url));let bFe=class{constructor(e,i,r=i){this.internalFormat=e,this.width=i,this.height=r,this.multisampled=!1,this.samples=1}};function v0t(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*Uue(t.internalFormat)}let wFe=class{constructor(e,i){this._context=e,this._descriptor=i,this.type=Wv.RenderBuffer,this._context.instanceCounter.increment(Nn.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;a?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n):r.renderbufferStorage(r.RENDERBUFFER,o,s,n),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}get usedMemory(){return v0t(this._descriptor)}resize(e,i){const r=this._descriptor;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Nn.Renderbuffer,this),this._context=null)}};const b0t=()=>oe.getLogger("esri.views.webgl.FramebufferObject");let z0=class jN{constructor(e,i,r=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(Nn.FramebufferObject,this);const s=aG(i)?i:new Gr(this._context,i);if(this._colorAttachments.set(So.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(So.COLOR_ATTACHMENT0),r!=null)if(x0t(r))this._depthStencilTexture=aG(r)?r:new Gr(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=w0t(r)?r:new wFe(this._context,r);this._depthStencilBuffer=n,this._validateRenderBufferDescriptor(n.descriptor)}}dispose(){if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((i,r)=>this.detachColorTexture(r)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(Nn.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(So.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(So.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(So.COLOR_ATTACHMENT0)?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce((e,[i,r])=>e+r.usedMemory,this.depthStencil?.usedMemory??0)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&aG(i)?i:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,i=So.COLOR_ATTACHMENT0){if(!e)return;this._validateColorAttachmentPoint(i);const r=e.descriptor;this._validateTextureDescriptor(r),this.detachColorTexture(i)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e)}detachColorTexture(e=So.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);if(i){if(this._initialized){const r=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(r)}return this._colorAttachments.delete(e),i}}setColorTextureTarget(e,i=So.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);r&&this._framebufferTexture2D(r.glName,i,e)}attachDepthStencil(e){if(e)switch(e.type){case Wv.Texture:return this._attachDepthStencilTexture(e);case Wv.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(e==null)return;const i=e.descriptor;i.pixelFormat!==Xt.DEPTH_STENCIL&&i.pixelFormat!==Xt.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==cc.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,YO)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,YO),this._context.bindFramebuffer(i)}return this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const i=e.descriptor;if(this._validateRenderBufferDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._getGLAttachmentPoint(i);r.framebufferRenderbuffer(Hl.FRAMEBUFFER,s,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const r=this._context.gl,s=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(Hl.FRAMEBUFFER,s,r.RENDERBUFFER,null),this._context.bindFramebuffer(i)}return this._depthStencilBuffer=null,e}copyToTexture(e,i,r,s,n,o,a){(e<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==on.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(l?.width==null||l?.height==null||e+r>this.width||i+s>this.height||n+r>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,u=c.bindTexture(a,Gr.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Gr.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(on.TEXTURE_2D,0,n,o,e,i,r,s),c.bindTexture(u,Gr.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,s,n,o,a)}async readPixelsAsync(e,i,r,s,n,o,a){const{gl:l}=this._context,c=Vr.createPixelPack(this._context,wr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,i,r,s,n,o,0),this._context.unbindBuffer(Dt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,i){if(this.width===e&&this.height===i)return;const r={width:e,height:i};D2(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(s=>s.resize(r.width,r.height)),this._depthStencilTexture?.resize(r.width,r.height),this._initialized&&(D2(r,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=Hl.FRAMEBUFFER){const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=i.createFramebuffer();if(i.bindFramebuffer(e,r),this._colorAttachments.forEach((s,n)=>this._framebufferTexture2D(s.glName,n,O_e(s),e)),this._depthStencilBuffer){const s=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);i.framebufferRenderbuffer(e,s,i.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,O_e(this._depthStencilTexture),e);wm()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,i=So.COLOR_ATTACHMENT0,r=on.TEXTURE_2D,s=Hl.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(Hl.FRAMEBUFFER,i,e.RENDERBUFFER,null)}this._depthStencilBuffer=jt(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=jt(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==on.TEXTURE_2D&&e.target!==on.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),D2(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){D2(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case dl.DEPTH_COMPONENT16:case dl.DEPTH_COMPONENT24:case dl.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case dl.DEPTH24_STENCIL8:case dl.DEPTH32F_STENCIL8:case dl.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case dl.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(jN._MAX_COLOR_ATTACHMENTS===-1){const{gl:r}=this._context;jN._MAX_COLOR_ATTACHMENTS=r.getParameter(r.MAX_COLOR_ATTACHMENTS)}const i=e-So.COLOR_ATTACHMENT0;i+1>jN._MAX_COLOR_ATTACHMENTS&&oe.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${jN._MAX_COLOR_ATTACHMENTS} color attachments`)}};function aG(t){return t!=null&&"type"in t&&t.type===Wv.Texture}function w0t(t){return t!=null&&"type"in t&&t.type===Wv.RenderBuffer}function x0t(t){return aG(t)||t!=null&&"pixelFormat"in t}function D2(t,e){const i=Math.max(t.width,t.height);if(i>e){b0t().warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function O_e(t){return t.descriptor.target===on.TEXTURE_CUBE_MAP?on.TEXTURE_CUBE_MAP_POSITIVE_X:on.TEXTURE_2D}z0._MAX_COLOR_ATTACHMENTS=-1;let HN=class extends Fe{constructor(e){super(e),this._needsRender=!0,this._passParameters=new _Fe,this._fbo=new z0(e.context.renderContext.rctx,new fs(kw)),this._vao=U0(e.context.renderContext.rctx)}get _techniques(){return this.context.techniques}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(Cd.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(Cd.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(Cl(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=yi(this._fullTechniqueCached),this._weatherMapTechniqueCached=yi(this._weatherMapTechniqueCached),this._fbo=jt(this._fbo),this._vao=jt(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new jie;e.mode=Cd.Full,this._fullTechniqueCached=this._techniques.acquire(Hie,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new jie;e.mode=Cd.WeatherMap,this._weatherMapTechniqueCached=this._techniques.acquire(Hie,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._fbo==null)return null;const i=e===Cd.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,s=r.getViewport();r.setViewport(0,0,kw,kw),r.bindFramebuffer(this._fbo);const n=r.bindTechnique(i,null,this._passParameters);return r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._fbo.colorTexture}};d([m({constructOnly:!0})],HN.prototype,"context",void 0),d([m({readOnly:!0})],HN.prototype,"_techniques",null),HN=d([N("esri.views.3d.environment.NoiseTextureAtlas")],HN);function M9(t){return t?{ray:jo(t.ray),c0:t.c0,c1:t.c1}:{ray:jo(),c0:0,c1:Number.MAX_VALUE}}function S0t(t,e=M9()){return $j(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function T0t(t,e,i=M9()){const r=De(t.vector);return c3e(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function ffi(t,e){return xFe(t,t.c0,e)}function mfi(t,e){return xFe(t,t.c1,e)}function xFe(t,e,i){return Te(i,t.ray.origin,ce(i,t.ray.direction,e))}new t1(()=>M9());function RF(t){return t?[mr(t[0]),mr(t[1]),mr(t[2]),mr(t[3]),mr(t[4]),mr(t[5])]:[mr(),mr(),mr(),mr(),mr(),mr()]}function SFe(){return[M(),M(),M(),M(),M(),M(),M(),M()]}function e8(t,e){for(let i=0;i<qI;i++)Kq(t[i],e[i]);return t}function TFe(t,e,i,r=P0t){const s=Or(Pce.get(),e,t);Ao(s,s);for(let n=0;n<A0t;++n){const o=xh(Rce.get(),R0t[n],s);ue(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}EFe(i,r)}function EFe(t,e){Xl(e[St.FAR_BOTTOM_LEFT],e[St.NEAR_BOTTOM_LEFT],e[St.NEAR_TOP_LEFT],t[zr.LEFT]),Xl(e[St.NEAR_BOTTOM_RIGHT],e[St.FAR_BOTTOM_RIGHT],e[St.FAR_TOP_RIGHT],t[zr.RIGHT]),Xl(e[St.FAR_BOTTOM_LEFT],e[St.FAR_BOTTOM_RIGHT],e[St.NEAR_BOTTOM_RIGHT],t[zr.BOTTOM]),Xl(e[St.NEAR_TOP_LEFT],e[St.NEAR_TOP_RIGHT],e[St.FAR_TOP_RIGHT],t[zr.TOP]),Xl(e[St.NEAR_BOTTOM_LEFT],e[St.NEAR_BOTTOM_RIGHT],e[St.NEAR_TOP_RIGHT],t[zr.NEAR]),Xl(e[St.FAR_BOTTOM_RIGHT],e[St.FAR_BOTTOM_LEFT],e[St.FAR_TOP_LEFT],t[zr.FAR])}function xw(t,e){for(let i=0;i<qI;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function E0t(t,e){return MFe(t,S0t(e,AFe.get()))}function gfi(t,e){for(let i=0;i<qI;i++){const r=t[i];if(!Qat(r,e))return!1}return!0}function C0t(t,e,i){return MFe(t,T0t(e,i,AFe.get()))}function CFe(t,e){for(let i=0;i<qI;i++)if(Wr(t[i],e)>0)return!1;return!0}function MFe(t,e){for(let i=0;i<qI;i++)if(!Jat(t[i],e))return!1;return!0}var zr,St;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(zr||(zr={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(St||(St={}));const M0t={bottom:[St.FAR_BOTTOM_RIGHT,St.NEAR_BOTTOM_RIGHT,St.NEAR_BOTTOM_LEFT,St.FAR_BOTTOM_LEFT],near:[St.NEAR_BOTTOM_LEFT,St.NEAR_BOTTOM_RIGHT,St.NEAR_TOP_RIGHT,St.NEAR_TOP_LEFT],far:[St.FAR_BOTTOM_RIGHT,St.FAR_BOTTOM_LEFT,St.FAR_TOP_LEFT,St.FAR_TOP_RIGHT],right:[St.NEAR_BOTTOM_RIGHT,St.FAR_BOTTOM_RIGHT,St.FAR_TOP_RIGHT,St.NEAR_TOP_RIGHT],left:[St.FAR_BOTTOM_LEFT,St.NEAR_BOTTOM_LEFT,St.NEAR_TOP_LEFT,St.FAR_TOP_LEFT],top:[St.FAR_TOP_LEFT,St.NEAR_TOP_LEFT,St.NEAR_TOP_RIGHT,St.FAR_TOP_RIGHT]},qI=6,A0t=8,R0t=[ni(-1,-1,-1,1),ni(1,-1,-1,1),ni(1,1,-1,1),ni(-1,1,-1,1),ni(-1,-1,1,1),ni(1,-1,1,1),ni(1,1,1,1),ni(-1,1,1,1)],AFe=new t1(M9),P0t=SFe();function O0t(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function I0t(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function $0t(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function N0t(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}let qie=class{constructor(){this.adds=new ci,this.removes=new ci,this.updates=new ci({allocator:e=>e||new L0t,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},L0t=class{},D0t=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Am,Si;function RFe(t){const e=new Map,i=r=>{let s=e.get(r);return s||(s=new D0t,e.set(r,s)),s};return t.removes.forAll(r=>{yY(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{yY(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{yY(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function yY(t){return t.geometry.indexCount>=1}(function(t){t[t.Default=0]="Default",t[t.Screenshot=1]="Screenshot",t[t.ObjectAndLayerID=2]="ObjectAndLayerID"})(Am||(Am={})),function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"}(Si||(Si={}));var Wie;let xi=Wie=class extends Fe{constructor(t){super(t),this._ray=jo(),this._viewport=ni(0,0,1,1),this._padding=ni(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Ni(1,1e3),this._viewDirty=!0,this._viewMatrix=Ne(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Ne(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Ne(),this._frustumDirty=!0,this._frustum=RF(),this._fullViewport=pi(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=M(),this._up=M(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return Me(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Xn(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),ue(M(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),ue(M(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),ue(M(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=UE(pi(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&BE(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=UE(pi(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&BE(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[Si.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[Si.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[Si.RIGHT]+this._padding[Si.LEFT]}set fullWidth(t){this.width=t-(this._padding[Si.RIGHT]+this._padding[Si.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Si.TOP]+this._padding[Si.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Si.TOP]+this._padding[Si.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Si.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Si.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){RP(this._padding,t)||(this._viewport[0]+=t[Si.LEFT]-this._padding[Si.LEFT],this._viewport[1]+=t[Si.BOTTOM]-this._padding[Si.BOTTOM],this._viewport[2]-=t[Si.RIGHT]+t[Si.LEFT]-(this._padding[Si.RIGHT]+this._padding[Si.LEFT]),this._viewport[3]-=t[Si.TOP]+t[Si.BOTTOM]-(this._padding[Si.TOP]+this._padding[Si.BOTTOM]),Kp(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Or(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return Ao(Ne(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||Ne()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return $0t(this._fov,this.width,this.height)}set fovX(t){this._fov=O0t(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return N0t(this._fov,this.width,this.height)}set fovY(t){this._fov=I0t(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return jr(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Ao(this._viewInverseTransposeMatrix,this.viewMatrix),Rh(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}get _projectionMatrixInternal(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,s=i/this.rows,n=r/this.columns,o=-r/2+this.column*n,a=o+n,l=-i/2+this.row*s,c=l+s,u=UPe(Ne(),o*(1+2*this._padding[Si.LEFT]/t),a*(1+2*this._padding[Si.RIGHT]/t),l*(1+2*this._padding[Si.BOTTOM]/e),c*(1+2*this._padding[Si.TOP]/e),this.near,this.far),h=this._get("projectionMatrix");return h&&Aq(h,u)?h:u}copyFrom(t){ge(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,Kp(this._viewport,t.viewport),this.notifyChange("_viewport"),Kp(this._padding,t.padding),this.notifyChange("_padding"),Cl(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(Xn(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(e8(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Xn(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Kp(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new Wie().copyFrom(this)}equals(t){return ga(this.eye,t.eye)&&ga(this.center,t.center)&&ga(this.up,t.up)&&RP(this._viewport,t.viewport)&&RP(this._padding,t.padding)&&IDe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||Oj(t.screenPadding,this.screenPadding)>=e||Oj(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;Vi(Ol,t.eye,t.center),Vi(_Y,this.eye,this.center);const i=xe(Ol,_Y),r=uj(Ol),s=uj(_Y),n=5e-4;return i*i>=(1-1e-10)*r*s&&lF(t.eye,this.eye)<Math.max(r,s)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs($w(this.viewForward,Me(Ol,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Hs()){return t[0]=(this.padding[Si.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[Si.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[Si.LEFT]+this.width*e,t[1]=this.padding[Si.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==Zi&&ge(Zi,t),Zi[3]=1,xh(Zi,Zi,this.projectionMatrix);const i=Math.abs(Zi[3]);ce(Zi,Zi,1/i);const r=this.fullViewport;e[0]=Wt(0,r[0]+r[2],.5+.5*Zi[0]),e[1]=Wt(0,r[1]+r[3],.5+.5*Zi[1]),e[2]=.5*(Zi[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;Zi[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],Zi[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],Zi[2]=(2*t[2]-1)*t[3],Zi[3]=t[3],this.inverseProjectionMatrix!=null&&(xh(Zi,Zi,this.inverseProjectionMatrix),e[0]=Zi[0],e[1]=Zi[1],e[2]=Zi[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,vY),this.renderToScreen(vY,e),e}projectToRenderScreen(t,e){if(Zi[0]=t[0],Zi[1]=t[1],Zi[2]=t[2],Zi[3]=1,xh(Zi,Zi,this.viewProjectionMatrix),Zi[3]===0)return null;const i=Zi;ce(i,i,1/Math.abs(Zi[3]));const r=this.fullViewport,s=Wt(0,r[0]+r[2],.5+.5*i[0]),n=Wt(0,r[1]+r[3],.5+.5*i[1]);return"x"in e?(e.x=s,e.y=n):(e[0]=s,e[1]=n,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,vY),e)}unprojectFromRenderScreen(t,e){if(Or(JU,this.projectionMatrix,this.viewMatrix),!Ao(JU,JU))return null;const i=this.fullViewport;return Zi[0]=2*(t[0]-i[0])/i[2]-1,Zi[1]=2*(t[1]-i[1])/i[3]-1,Zi[2]=2*t[2]-1,Zi[3]=1,xh(Zi,Zi,JU),Zi[3]===0?null:(e[0]=Zi[0]/Zi[3],e[1]=Zi[1]/Zi[3],e[2]=Zi[2]/Zi[3],e)}constrainWindowSize(t,e,i,r){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-i/2,0),a=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-i/2,0),c=-Math.min(this.fullHeight-n-r/2,0),u=i-l- -Math.min(this.fullWidth-s-i/2,0),h=r-c- -Math.min(n-r/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(h)]}computeUp(t){t===Xe.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){Me(Ol,this.center,this.eye);const t=De(this.center);t<1?(ue(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(xe(Ol,this.center))>.9999*De(Ol)*t||(yt(this._up,Ol,this.center),yt(this._up,this._up,Ol),Se(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){Kv(Ol,this.eye,this.center),Math.abs(Ol[2])<=.9999&&(ce(Ol,Ol,Ol[2]),ue(this._up,-Ol[0],-Ol[1],1-Ol[2]),Se(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?ga(t,e)||(ge(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):oe.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(TFe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Mq(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};d([m()],xi.prototype,"_viewport",void 0),d([m()],xi.prototype,"_padding",void 0),d([m()],xi.prototype,"_fov",void 0),d([m()],xi.prototype,"_nearFar",void 0),d([m()],xi.prototype,"_viewDirty",void 0),d([m()],xi.prototype,"_viewMatrix",void 0),d([m()],xi.prototype,"_pixelRatio",void 0),d([m()],xi.prototype,"pixelRatio",null),d([m()],xi.prototype,"row",void 0),d([m()],xi.prototype,"column",void 0),d([m()],xi.prototype,"_rows",void 0),d([m()],xi.prototype,"rows",null),d([m()],xi.prototype,"_columns",void 0),d([m()],xi.prototype,"columns",null),d([m()],xi.prototype,"eye",null),d([m()],xi.prototype,"center",null),d([m()],xi.prototype,"_center",void 0),d([m()],xi.prototype,"up",null),d([m()],xi.prototype,"_up",void 0),d([m()],xi.prototype,"viewMatrix",null),d([m({readOnly:!0})],xi.prototype,"viewForward",null),d([m({readOnly:!0})],xi.prototype,"viewUp",null),d([m({readOnly:!0})],xi.prototype,"viewRight",null),d([m({readOnly:!0})],xi.prototype,"nearFar",null),d([m()],xi.prototype,"near",null),d([m()],xi.prototype,"far",null),d([m()],xi.prototype,"viewport",null),d([m({readOnly:!0})],xi.prototype,"screenViewport",null),d([m({readOnly:!0})],xi.prototype,"screenPadding",null),d([m()],xi.prototype,"x",null),d([m()],xi.prototype,"y",null),d([m()],xi.prototype,"width",null),d([m()],xi.prototype,"height",null),d([m()],xi.prototype,"fullWidth",null),d([m()],xi.prototype,"fullHeight",null),d([m({readOnly:!0})],xi.prototype,"_aspect",null),d([m()],xi.prototype,"padding",null),d([m({readOnly:!0})],xi.prototype,"projectionMatrix",null),d([m({readOnly:!0})],xi.prototype,"inverseProjectionMatrix",null),d([m()],xi.prototype,"fov",null),d([m()],xi.prototype,"fovX",null),d([m()],xi.prototype,"fovY",null),d([m()],xi.prototype,"viewInverseTransposeMatrix",null),d([m({readOnly:!0})],xi.prototype,"_projectionMatrixInternal",null),d([m()],xi.prototype,"relativeElevation",void 0),xi=Wie=d([N("esri.views.3d.webgl.RenderCamera")],xi);const Kr=xi,Zi=pi(),JU=Ne(),Ol=M(),_Y=M(),vY=_l();var Su;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(Su||(Su={}));function F0t(t){t.include(N0),t.uniforms.add(new Et("geometryDepthTexture",(e,i)=>i.multipassGeometry.depth?.attachment)),t.code.add(T`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}let k0t=class{};function V0(t,e){if(!e.multipassEnabled)return;t.fragment.include(N0),t.fragment.uniforms.add(new Et("terrainDepthTexture",(r,s)=>s.multipassTerrain.depth?.attachment));const i=e.occlusionPass;t.fragment.code.add(T`
   ${i?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${i?T`return fragmentDepth < linearDepth && depth < 1.0;`:T`
          if(fragmentDepth ${e.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}let U0t=class{constructor(){this.cullAboveGround=!1}};var Ce;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH",t[t.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH",t[t.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",t[t.OPAQUE_ENVIRONMENT=12]="OPAQUE_ENVIRONMENT",t[t.TRANSPARENT_ENVIRONMENT=13]="TRANSPARENT_ENVIRONMENT",t[t.LASERLINES=14]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=15]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=16]="HUD_MATERIAL",t[t.LABEL_MATERIAL=17]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=18]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=19]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=20]="DRAPED_MATERIAL",t[t.DRAPED_WATER=21]="DRAPED_WATER",t[t.VIEWSHED=22]="VIEWSHED",t[t.VOXEL=23]="VOXEL",t[t.MAX_SLOTS=24]="MAX_SLOTS"})(Ce||(Ce={}));var mt;(function(t){t[t.ColorAlpha=0]="ColorAlpha",t[t.FrontFace=1]="FrontFace",t[t.NONE=2]="NONE",t[t.COUNT=3]="COUNT"})(mt||(mt={}));let Wue=class{constructor(e=M()){this.intensity=e}},PFe=class{constructor(e=M(),i=Be(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},t8=class{constructor(e=M(),i=Be(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}},OFe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function B0t(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function bY(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function LP(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function IFe(t){return(t+1)*(t+1)}function z0t(t){return $e(Math.floor(Math.sqrt(t)-1),0,2)}function $Fe(t,e,i){const r=t[0],s=t[1],n=t[2],o=i||[];return o.length=IFe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function V0t(t,e){const i=IFe(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function G0t(t,e){const i=z0t(e.r.length);for(const r of t)Ha(Yie,r.direction),$Fe(Yie,i,dv),B0t(dv,lG),bY(dv,r.intensity[0],uM),LP(e.r,uM),bY(dv,r.intensity[1],uM),LP(e.g,uM),bY(dv,r.intensity[2],uM),LP(e.b,uM);return e}function j0t(t,e){$Fe(Yie,0,dv);for(const i of t)e.r[0]+=dv[0]*lG[0]*i.intensity[0]*4*Math.PI,e.g[0]+=dv[0]*lG[0]*i.intensity[1]*4*Math.PI,e.b[0]+=dv[0]*lG[0]*i.intensity[2]*4*Math.PI;return e}function H0t(t,e,i,r){V0t(e,r),ue(i.intensity,0,0,0);let s=!1;const n=q0t,o=W0t,a=Y0t;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof t8&&!s?(ge(i.direction,l.direction),ge(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof t8||l instanceof PFe?n.push(l):l instanceof Wue?o.push(l):l instanceof OFe&&a.push(l);G0t(n,r),j0t(o,r);for(const l of a)LP(r.r,l.r),LP(r.g,l.g),LP(r.b,l.b)}const q0t=[],W0t=[],Y0t=[],dv=[0],uM=[0],Yie=M(),lG=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let I_e=class{constructor(){this.color=M(),this.intensity=1}},X0t=class{constructor(){this.direction=M(),this.ambient=new I_e,this.diffuse=new I_e}};const NFe=.4;let wY=class{constructor(){this._shOrder=2,this._legacy=new X0t,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new OFe,this._mainLight=new t8(M(),Be(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){H0t(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ge(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,ce(this._legacy.diffuse.color,this._mainLight.intensity,i),ge(QU,this._legacy.diffuse.color),ce(QU,QU,NFe*this.globalFactor),Te(this._legacy.ambient.color,this._legacy.ambient.color,QU)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),ge(this._mainLight.direction,e.mainLight.direction),ge(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(Br(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=Wt(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=Wt(e.mainLight.specularStrength,i.mainLight.specularStrength,r),ge(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=Wt(e.globalFactor,i.globalFactor,r),this.noonFactor=Wt(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=Wt(e.sh.r[s],i.sh.r[s],r),this._sphericalHarmonics.g[s]=Wt(e.sh.g[s],i.sh.g[s],r),this._sphericalHarmonics.b[s]=Wt(e.sh.b[s],i.sh.b[s],r);else for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=i.sh.r[s],this._sphericalHarmonics.g[s]=i.sh.g[s],this._sphericalHarmonics.b[s]=i.sh.b[s]}};const QU=M();let A9=class{constructor(e,i){this.shadowMap=e,this.slicePlane=i,this.slot=Ce.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=mt.NONE,this.alignPixelEnabled=!1,this.decorations=Gc.ON,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new Kr,this._inverseViewport=vt(),this.oldLighting=new wY,this.newLighting=new wY,this._fadedLighting=new wY,this._lighting=this.newLighting,this.ssr=new Z0t,this.multipassEnabled=!1,this.multipassTerrain=new U0t,this.multipassGeometry=new k0t,this.hudRenderStyle=Su.Occluded,this.cloudsFade=new Yyt,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:i,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(i,r,e),this._lighting=this._fadedLighting)}},Z0t=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=Ne()}},fu=class extends Fe{constructor(e){super(e),this._techniques=new Array,this._techniqueConfiguration=new oG,this._bindParameters=new A9(null,null),this._passParameters=new mFe,this._weatherTile=vt(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Wt(Bl.default.coverage[0],Bl.default.coverage[1],.5),this.density=Wt(Bl.default.density[0],Bl.default.density[1],.5),this.absorption=Wt(Bl.default.absorption[0],Bl.default.absorption[1],.5),this.cloudSize=Wt(Bl.default.cloudSize[0],Bl.default.cloudSize[1],.5),this.detailSize=Wt(Bl.default.detailSize[0],Bl.default.detailSize[1],.5),this.smoothness=Wt(Bl.default.smoothness[0],Bl.default.smoothness[1],.5),this.cloudHeight=Wt(Bl.default.cloudHeight[0],Bl.default.cloudHeight[1],.5),this.raymarchingSteps=Bl.default.raymarchingSteps,this._viewMatrix=Ne(),this._dirty=!1,this.running=!1,this._vao=U0(e.context.renderContext.rctx)}_getTechnique(e){const i=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=i===qE.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=i,this._techniqueConfiguration.steps=e,this._techniques[r]=new gFe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,i=this.view.camera.position.longitude;if(e==null||i==null)return;Gi(this._weatherTile,(e+90)/180,(i+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let s=0,n=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),$De(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=$r(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this.addHandles([this.view.resourceController.scheduler.registerTask(Ut.CLOUDS_GENERATOR,this),_e(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Ir)])}destroy(){this._techniques.forEach(e=>yi(e)),this._frameBufferCube=jt(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Ge(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Ru.SIXTEEN:return 1;case Ru.HUNDRED:return 4;case Ru.COUNT:case Ru.TWOHUNDRED:return 8}}get usedMemory(){return(this._frameBufferCube?.usedMemory??0)+(this._passParameters.noiseTexture?.textureAtlas?.usedMemory??0)}_ensureNoiseTexture(){return this._passParameters.noiseTexture??=new HN({context:this.context}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile),this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const i=new fs(e);i.target=on.TEXTURE_CUBE_MAP,i.wrapMode=Di.CLAMP_TO_EDGE,this._frameBufferCube=new z0(this.context.renderContext.rctx,i)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=jt(this._frameBufferCube)}applyPreset(e,i){const r=e.median,s=n=>{const o=Wt(n[0],n[1],r);return i<.5?Wt(n[0],o,2*i):Wt(o,n[1],2*(i-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),Cl(this._passParameters.weatherTile,this._weatherTile));const i=this._getTechnique(this._passParameters.raymarchingSteps);if(!i.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===ls.CROSS_FADE||!this._ensureNoiseTexture())return Wa;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Xy.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=J0t[this._faceIndex],s=Q0t[this._faceIndex];zPe(this._viewMatrix,K0t,r,s),vf(this._passParameters.viewMatrix,this._viewMatrix);const n=this.context.renderContext.rctx,o=n.bindTechnique(i,this._bindParameters,this._passParameters);n.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao);const a=n.getViewport(),l=i.configuration.cubeMapSize,c=l/this._tilesPerFace,u=this._tileIndex*c;n.setViewport(0,u,l,c);const h=this._ensureFrameBufferCube(l);n.bindFramebuffer(h);const p=on.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return h.setColorTextureTarget(p),n.gl.drawArrays(n.gl.TRIANGLE_STRIP,0,4),n.gl.flush(),n.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Xy.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),Wa}};d([m({constructOnly:!0})],fu.prototype,"context",void 0),d([m({constructOnly:!0})],fu.prototype,"view",void 0),d([m({constructOnly:!0})],fu.prototype,"requestRender",void 0),d([m()],fu.prototype,"coverage",void 0),d([m()],fu.prototype,"density",void 0),d([m()],fu.prototype,"absorption",void 0),d([m()],fu.prototype,"cloudSize",void 0),d([m()],fu.prototype,"detailSize",void 0),d([m()],fu.prototype,"smoothness",void 0),d([m()],fu.prototype,"cloudHeight",void 0),d([m()],fu.prototype,"raymarchingSteps",void 0),d([m()],fu.prototype,"running",void 0),fu=d([N("esri.views.3d.environment.CloudsGenerator")],fu);const J0t=[qr(1,0,0),qr(-1,0,0),qr(0,1,0),qr(0,-1,0),qr(0,0,1)],Q0t=[qr(0,1,0),qr(0,1,0),qr(0,0,-1),qr(0,0,1),qr(0,1,0)],K0t=que();let LFe=class extends is{constructor(){super(...arguments),this.fogColor=M(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function e_t(){const t=new tr;t.attributes.add(O.POSITION,"vec2"),t.include(jm,{textureCoordinateType:ks.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:i}=t;return e.uniforms.add(new Ps("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new Ps("inverseViewMatrix",(r,s)=>Ox(t_t,s.camera.viewMatrix))),e.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new et("atmosphereC",r=>r.atmosphereC),new Qt("cameraPosition",(r,s)=>s.camera.eye),new os("nearFar",(r,s)=>s.camera.nearFar),new Et("depthTexture",r=>r.depthTexture),new et("fogStrength",r=>r.fogStrength),new et("fogAmount",r=>r.fogAmount),new Qt("fogColor",r=>r.fogColor)),t.include(E9),i.include(Lue),i.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(T`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(T`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const t_t=Ne(),i_t=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:LFe,build:e_t},Symbol.toStringTag,{value:"Module"}));let DFe=class FFe extends hr{constructor(e){super(e,new Zc,()=>this.destroy())}initializeProgram(e){return new dr(e.rctx,FFe.shader.get().build(),Fi)}initializePipeline(){return ti({blending:Za(ke.SRC_ALPHA,ke.ZERO,ke.ONE_MINUS_SRC_ALPHA,ke.ONE),colorWrite:fi})}};DFe.shader=new ir(i_t,()=>ye(()=>import("./Fog.glsl-2c1e8913.js"),[],import.meta.url));const r_t=.95,s_t=1;let NT=class extends Fe{constructor(e){super(e),this._passParameters=new LFe;const i=e.context.renderContext.rctx;this._vao=U0(i,Qk),this._technique=new DFe(e);const r=$r(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+Qb}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,i){if(this._update(e,i),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(r,e.bindParameters,this._passParameters);this._renderFog(n,e)})}_renderFog(e,i){const r=i.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Li.TRIANGLE_STRIP,0,4)}_update(e,i){const r=e.bindParameters.camera;Se($_e,r.eye);const s=Math.max(0,xe($_e,e.bindParameters.lighting.mainLight.direction)),n=i.color;ce(N_e,n,.1),Br(this._passParameters.fogColor,N_e,n,s);const o=De(r.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-uF(r_t*ov,s_t*ov,Math.abs(o-this._planetRadius)))*i.amount,this._passParameters.fogStrength=i.strength}};d([m({constructOnly:!0})],NT.prototype,"context",void 0),d([m({constructOnly:!0})],NT.prototype,"view",void 0),d([m({constructOnly:!0})],NT.prototype,"rctx",void 0),d([m({constructOnly:!0})],NT.prototype,"viewingMode",void 0),NT=d([N("esri.views.3d.environment.Fog")],NT);let n_t=class{constructor(){this.color=M(),this.strength=0,this.amount=0}};const $_e=M(),N_e=M();var G;function o_t(t){return DP(t)||t===G.Depth||t===G.Normal||t===G.ObjectAndLayerIdColor}function DP(t){return t===G.Shadow||t===G.ShadowHighlight||t===G.ShadowExcludeHighlight||t===G.ViewshedShadow}function gD(t){return Xie(t)||t===G.Normal}function lE(t){return t===G.Highlight||t===G.ObjectAndLayerIdColor}function kFe(t){return t===G.Color||lE(t)}function Ov(t){return t===G.Color}function xY(t){return Ov(t)||t===G.ObjectAndLayerIdColor}function a_t(t){return Ov(t)||t===G.Highlight}function L_e(t){return a_t(t)||Uw(t)}function cG(t){return Ov(t)||lE(t)}function Xie(t){return cG(t)||Uw(t)}function Uw(t){return t===G.Depth}(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.ViewshedShadow=6]="ViewshedShadow",t[t.Highlight=7]="Highlight",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(G||(G={}));function Yue({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(T`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(T`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let UFe=class extends hn{constructor(e,i){super(e,"mat4",ar.Draw,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};function yg(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",co):t.uniforms.add(new Vd("cameraPosition",(i,r)=>ue(BFe,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Pu(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new Ps("proj",(r,s)=>s.camera.projectionMatrix),new UFe("view",(r,s)=>ac(D_e,s.camera.viewMatrix,r.origin)),new Vd("localOrigin",r=>r.origin));const i=r=>ue(BFe,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new Ps("proj",(r,s)=>s.camera.projectionMatrix),new Ps("view",(r,s)=>ac(D_e,s.camera.viewMatrix,i(s))),new Qt("localOrigin",(r,s)=>i(s)))}const D_e=Ne(),BFe=M();function XO(t){t.uniforms.add(new Ps("viewNormal",(e,i)=>i.camera.viewInverseTransposeMatrix))}function WI(t){t.uniforms.add(new et("pixelRatio",(e,i)=>i.camera.pixelRatio/i.overlayStretch))}function Zie(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function l_t(t,e){const i=t.length;for(let r=0;r<i;++r)qR[0]=t[r],e[r]=qR[0];return e}function c_t(t,e){const i=t.length;for(let r=0;r<i;++r)qR[0]=t[r],qR[1]=t[r]-qR[0],e[r]=qR[1];return e}const qR=new Float32Array(2);let Jie=class extends Zc{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};d([V()],Jie.prototype,"instancedDoublePrecision",void 0),d([V()],Jie.prototype,"hasModelTransformation",void 0);const F_e=ps();function zFe(t,e){const i=e.hasModelTransformation,r=e.instancedDoublePrecision;i&&(t.vertex.uniforms.add(new Ps("model",n=>n.modelTransformation??us)),t.vertex.uniforms.add(new bf("normalLocalOriginFromModel",n=>(lx(F_e,n.modelTransformation??us),F_e)))),e.instanced&&r&&(t.attributes.add(O.INSTANCEMODELORIGINHI,"vec3"),t.attributes.add(O.INSTANCEMODELORIGINLO,"vec3"),t.attributes.add(O.INSTANCEMODEL,"mat3"),t.attributes.add(O.INSTANCEMODELNORMAL,"mat3"));const s=t.vertex;r&&(s.include(Yue,e),s.uniforms.add(new Vd("viewOriginHi",(n,o)=>l_t(ue(KU,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),KU)),new Vd("viewOriginLo",(n,o)=>c_t(ue(KU,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),KU)))),s.code.add(T`
    vec3 getVertexInLocalOriginSpace() {
      return ${i?r?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":r?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${r?T`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),s.code.add(T`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${i?r?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":r?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),e.output===G.Normal&&(XO(s),s.code.add(T`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${i?r?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":r?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),e.hasVertexTangents&&s.code.add(T`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${i?r?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":r?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const KU=M();let $u=class extends Jie{};d([V({constValue:!0})],$u.prototype,"hasSliceHighlight",void 0),d([V({constValue:!1})],$u.prototype,"hasSliceInVertexProgram",void 0),d([V({constValue:ar.Pass})],$u.prototype,"pbrTextureBindType",void 0);var b0;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(b0||(b0={}));let Xue=class extends $u{constructor(){super(...arguments),this.geometry=b0.Cone}};d([V({count:b0.COUNT})],Xue.prototype,"geometry",void 0);function e4(t){t.attributes.add(O.POSITION,"vec3"),t.vertex.code.add(T`vec3 positionModel() { return position; }`)}let i8=class extends hn{constructor(e,i){super(e,"mat3",ar.Draw,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}};function FP(t,e){t.include(e4);const i=t.vertex;i.include(Yue,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),i.uniforms.add(new Qt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new Qt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new bf("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new Ps("transformProjFromView",r=>r.transformProjFromView),new i8("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Vd("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Vd("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)),i.code.add(T`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(T`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?T`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:T`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Qt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(T`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(T`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let u_t=class extends is{constructor(){super(...arguments),this.transformWorldFromViewTH=M(),this.transformWorldFromViewTL=M(),this.transformViewFromCameraRelativeRS=ps(),this.transformProjFromView=Ne()}},h_t=class extends is{constructor(){super(...arguments),this.transformWorldFromModelRS=ps(),this.transformWorldFromModelTH=M(),this.transformWorldFromModelTL=M()}};function Qie(t){t.varyings.add("linearDepth","float")}function R9(t){t.vertex.uniforms.add(new os("nearFar",(e,i)=>i.camera.nearFar))}function VFe(t){t.vertex.code.add(T`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function YI(t,e){const{vertex:i}=t;switch(e.output){case G.Color:if(e.receiveShadows)return Qie(t),void i.code.add(T`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ViewshedShadow:return t.include(FP,e),Qie(t),R9(t),VFe(t),void i.code.add(T`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(T`void forwardLinearDepth() {}`)}function ec(t){VFe(t),t.vertex.code.add(T`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(T`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let Zue=class extends is{constructor(){super(...arguments),this.texV=vt(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new GFe}},GFe=class{constructor(){this.center=M(),this.v1=M(),this.v2=M()}};function d_t(t){const e=new tr,{vertex:i,fragment:r}=e;if(r1(i),t.geometry===b0.Underground)e.attributes.add(O.POSITION,"vec2"),e.varyings.add("color","vec4"),i.uniforms.add(new Qt("cameraPosition",(s,n)=>n.camera.eye),new et("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),i.code.add(T`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(T`void main() {
fragColor = color;
}`);else{e.include(ec,t),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===b0.Cylinder;i.uniforms.add(new Ps("proj",(a,l)=>l.camera.projectionMatrix),new Ps("view",(a,l)=>l.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),i.uniforms.add(new Qt("silCircleCenter",a=>a.silhouette.center)),i.uniforms.add(new Qt("silCircleV1",a=>a.silhouette.v1)),i.uniforms.add(new Qt("silCircleV2",a=>a.silhouette.v2)),i.uniforms.add(new os("texV",a=>a.texV)),i.uniforms.add(new et("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;i.code.add(T`
		void main(void) {
      ${s?T`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:T`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${T.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${T.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new Et("tex",a=>a.texture)),s||r.uniforms.add(new et("altitudeFade",a=>a.altitudeFade)),r.code.add(T`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?T`fragColor = atmosphereColor;`:T`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const p_t=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:GFe,SimpleAtmospherePassParameters:Zue,build:d_t},Symbol.toStringTag,{value:"Module"}));let r8=class jFe extends hr{initializeProgram(e){return new dr(e.rctx,jFe.shader.get().build(this.configuration),Fi)}initializePipeline(){return this.configuration.geometry===b0.Cylinder?ti({blending:Za(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),culling:Due,depthTest:{func:Lr.LEQUAL},colorWrite:fi}):ti({blending:Za(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),depthTest:{func:Lr.LEQUAL},colorWrite:fi})}};r8.shader=new ir(p_t,()=>ye(()=>import("./SimpleAtmosphere.glsl-78dd1057.js"),[],import.meta.url));const f_t=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Dh(t,e=0){const i=t.stride;return Array.from(t.fields.keys()).map(r=>{const s=t.fields.get(r),n=s.constructor.ElementCount,o=m_t(s.constructor.ElementType),a=s.offset,l=s.optional?.glNormalized??!1;return new mg(r,n,o,a,i,l,e)})}function m_t(t){const e=g_t[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const g_t={u8:At.UNSIGNED_BYTE,u16:At.UNSIGNED_SHORT,u32:At.UNSIGNED_INT,i8:At.BYTE,i16:At.SHORT,i32:At.INT,f32:At.FLOAT};let Jue=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};Jue.ElementCount=9;let Que=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};Que.ElementCount=16;let n1=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}};n1.ElementCount=1;let o1=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,Gi(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};o1.ElementCount=2;let a1=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,ue(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=s}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};a1.ElementCount=3;let l1=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,Ds(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};l1.ElementCount=4;let P9=class HFe extends n1{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}static fromTypedArray(e,i){return new HFe(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};P9.ElementType="f32";let PC=class Kie extends o1{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(Kie,e,i)}static fromTypedArray(e,i){return new Kie(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};PC.ElementType="f32";let Zo=class ere extends a1{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(ere,e,i)}static fromTypedArray(e,i){return new ere(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Zo.ElementType="f32";let _g=class tre extends l1{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(tre,e,i)}static fromTypedArray(e,i){return new tre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};_g.ElementType="f32";let fx=class ire extends Jue{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(ire,e,i)}static fromTypedArray(e,i){return new ire(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};fx.ElementType="f32";let Kue=class rre extends Jue{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(rre,e,i)}static fromTypedArray(e,i){return new rre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Kue.ElementType="f64";let ehe=class sre extends Que{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(sre,e,i)}static fromTypedArray(e,i){return new sre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ehe.ElementType="f32";let PF=class nre extends Que{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(nre,e,i)}static fromTypedArray(e,i){return new nre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};PF.ElementType="f64";let the=class ore extends n1{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(ore,e,i)}static fromTypedArray(e,i){return new ore(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};the.ElementType="f64";let ihe=class are extends o1{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(are,e,i)}static fromTypedArray(e,i){return new are(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ihe.ElementType="f64";let ff=class lre extends a1{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(lre,e,i)}static fromTypedArray(e,i){return new lre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ff.ElementType="f64";let O9=class cre extends l1{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(cre,e,i)}static fromTypedArray(e,i){return new cre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};O9.ElementType="f64";let ZO=class ure extends n1{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(ure,e,i)}static fromTypedArray(e,i){return new ure(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ZO.ElementType="u8";let I9=class hre extends o1{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(hre,e,i)}static fromTypedArray(e,i){return new hre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};I9.ElementType="u8";let $9=class dre extends a1{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(dre,e,i)}static fromTypedArray(e,i){return new dre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};$9.ElementType="u8";let uc=class pre extends l1{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(pre,e,i)}static fromTypedArray(e,i){return new pre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};uc.ElementType="u8";let N9=class fre extends n1{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(fre,e,i)}static fromTypedArray(e,i){return new fre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};N9.ElementType="u16";let rhe=class mre extends o1{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(mre,e,i)}static fromTypedArray(e,i){return new mre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};rhe.ElementType="u16";let L9=class gre extends a1{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(gre,e,i)}static fromTypedArray(e,i){return new gre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};L9.ElementType="u16";let t4=class yre extends l1{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(yre,e,i)}static fromTypedArray(e,i){return new yre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};t4.ElementType="u16";let D9=class _re extends n1{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(_re,e,i)}static fromTypedArray(e,i){return new _re(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};D9.ElementType="u32";let she=class vre extends o1{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(vre,e,i)}static fromTypedArray(e,i){return new vre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};she.ElementType="u32";let qFe=class bre extends a1{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(bre,e,i)}static fromTypedArray(e,i){return new bre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};qFe.ElementType="u32";let WFe=class wre extends l1{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(wre,e,i)}static fromTypedArray(e,i){return new wre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};WFe.ElementType="u32";let nhe=class xre extends n1{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(xre,e,i)}static fromTypedArray(e,i){return new xre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};nhe.ElementType="i8";let F9=class Sre extends o1{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(Sre,e,i)}static fromTypedArray(e,i){return new Sre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};F9.ElementType="i8";let YFe=class Tre extends a1{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(Tre,e,i)}static fromTypedArray(e,i){return new Tre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};YFe.ElementType="i8";let XFe=class Ere extends l1{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(Ere,e,i)}static fromTypedArray(e,i){return new Ere(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};XFe.ElementType="i8";let ZFe=class Cre extends n1{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(Cre,e,i)}static fromTypedArray(e,i){return new Cre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ZFe.ElementType="i16";let i4=class Mre extends o1{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(Mre,e,i)}static fromTypedArray(e,i){return new Mre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};i4.ElementType="i16";let JFe=class Are extends a1{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(Are,e,i)}static fromTypedArray(e,i){return new Are(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};JFe.ElementType="i16";let QFe=class Rre extends l1{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(Rre,e,i)}static fromTypedArray(e,i){return new Rre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};QFe.ElementType="i16";let KFe=class Pre extends n1{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(Pre,e,i)}static fromTypedArray(e,i){return new Pre(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};KFe.ElementType="i32";let eke=class Ore extends o1{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(Ore,e,i)}static fromTypedArray(e,i){return new Ore(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};eke.ElementType="i32";let tke=class Ire extends a1{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(Ire,e,i)}static fromTypedArray(e,i){return new Ire(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};tke.ElementType="i32";let ike=class $re extends l1{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer($re,e,i)}static fromTypedArray(e,i){return new $re(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ike.ElementType="i32";function k_e(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let U_e=class rke{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fields.keys()){const s=e.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new rke(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i=0,r=0,s=e.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}return this}get usedMemory(){return this.byteLength}dispose(){}},y_t=class ske{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(i=>this._fields.set(i[0],{...i[1],constructor:v_t(i[1].constructor)})))}freeze(){return this}vec2f(e,i){return this._appendField(e,PC,i),this}vec2f64(e,i){return this._appendField(e,ihe,i),this}vec3f(e,i){return this._appendField(e,Zo,i),this}vec3f64(e,i){return this._appendField(e,ff,i),this}vec4f(e,i){return this._appendField(e,_g,i),this}vec4f64(e,i){return this._appendField(e,O9,i),this}mat3f(e,i){return this._appendField(e,fx,i),this}mat3f64(e,i){return this._appendField(e,Kue,i),this}mat4f(e,i){return this._appendField(e,ehe,i),this}mat4f64(e,i){return this._appendField(e,PF,i),this}vec4u8(e,i){return this._appendField(e,uc,i),this}f32(e,i){return this._appendField(e,P9,i),this}f64(e,i){return this._appendField(e,the,i),this}u8(e,i){return this._appendField(e,ZO,i),this}u16(e,i){return this._appendField(e,N9,i),this}i8(e,i){return this._appendField(e,nhe,i),this}vec2i8(e,i){return this._appendField(e,F9,i),this}vec2i16(e,i){return this._appendField(e,i4,i),this}vec2u8(e,i){return this._appendField(e,I9,i),this}vec4u16(e,i){return this._appendField(e,t4,i),this}u32(e,i){return this._appendField(e,D9,i),this}_appendField(e,i,r){if(this._fields.has(e))return void Tt(!1,`${e} already added to vertex buffer layout`);const s=i.ElementCount*k_e(i.ElementType),n=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:i,offset:n,optional:r})}createBuffer(e){return new U_e(this,e)}createView(e){return new U_e(this,e)}clone(){const e=new ske;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((i,r)=>e._fields.set(r,i)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(i=>e=Math.max(e,k_e(i.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function Xs(){return new y_t}let Zfi=class{constructor(e){this.fields=new Array,e.fields.forEach((i,r)=>{const s={...i,constructor:nke(i.constructor)};this.fields.push([r,s])}),this.stride=e.stride}};const __t=[P9,PC,Zo,_g,fx,ehe,the,ihe,ff,O9,Kue,PF,ZO,I9,$9,uc,N9,rhe,L9,t4,D9,she,qFe,WFe,nhe,F9,YFe,XFe,ZFe,i4,JFe,QFe,KFe,eke,tke,ike];function nke(t){return`${t.ElementType}_${t.ElementCount}`}function v_t(t){return oke.get(t)}const oke=new Map;__t.forEach(t=>oke.set(nke(t),t));function qo(t,e=!1){return t<=Gd?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function ake(t){return(f0(t)?t.length:t.byteLength/8)<=Gd?Array.from(t):new Float64Array(t)}function sf(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function b_t(t,e){for(let i=0;i<e.length;++i)t[i]=e[i];return t}function Qfi(t){return Array.isArray(t)?new Float64Array(t):t}function qs(t,e=!1){return t<=Gd?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function Kfi(t){return f0(t)?t.length<Gd?t:new Float32Array(t):t.length<Gd?Array.from(t):t}function B_e(t){return(f0(t)?t.length:t.byteLength/8)<=Gd?Array.from(t):new Float32Array(t)}function s8(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function l0(t){if(f0(t)){if(t.length<Gd)return t}else if(t.length<Gd)return Array.from(t);let e=!0,i=!0;return t.some((r,s)=>(e=e&&r===0,i=i&&r===s,!e&&!i)),e?Hx(t.length):i?OC(t.length):f0(t)||t.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?w_t(t):t}function w_t(t){let e=!0;for(const i of t){if(i>=65536)return f0(t)?new Uint32Array(t):t;i>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function n8(t){return t<=Gd?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function x_t(t){return t<=Gd?new Array(t):new Uint32Array(t)}let hM=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const lke=[0],SY=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function OC(t){if(t===1)return lke;if(t<Gd)return Array.from(new Uint16Array(SY.buffer,0,t));if(t<SY.length)return new Uint16Array(SY.buffer,0,t);if(t>hM.length){const e=Math.max(2*hM.length,t);hM=new Uint32Array(e);for(let i=0;i<hM.length;i++)hM[i]=i}return new Uint32Array(hM.buffer,0,t)}let e5=new Uint8Array(65536);function Hx(t){if(t===1)return lke;if(t<Gd)return new Array(t).fill(0);if(t>e5.length){const e=Math.max(2*e5.length,t);e5=new Uint8Array(e)}return new Uint8Array(e5.buffer,0,t)}var Nre;(function(t){function e(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function i(o,a){const l=o[a],c=o[a+1],u=o[a+2],h=1/Math.sqrt(l*l+c*c+u*u);o[a]*=h,o[a+1]*=h,o[a+2]*=h}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,u,h=a){(u=u||o)[h]=o[a]+l[c],u[h+1]=o[a+1]+l[c+1],u[h+2]=o[a+2]+l[c+2]}function n(o,a,l,c,u,h=a){(u=u||o)[h]=o[a]-l[c],u[h+1]=o[a+1]-l[c+1],u[h+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=i,t.scale=r,t.add=s,t.subtract=n})(Nre||(Nre={}));var an;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(an||(an={}));function S_t(t){if(t.length<Gd)return Array.from(t);if(f0(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return sq(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let cke=class uke{constructor(e,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.position=r,this._children=void 0,Tt(e.length>=1),Tt(r.size===3||r.size===4);const{data:s,size:n,indices:o}=r;Tt(o.length%this._numIndexPerPrimitive==0),Tt(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=n*o[this._numIndexPerPrimitive*e[0]];mS.clear(),mS.push(l);const c=Be(s[l],s[l+1],s[l+2]),u=Fn(c);for(let f=0;f<a;++f){const g=this._numIndexPerPrimitive*e[f];for(let y=0;y<this._numIndexPerPrimitive;++y){l=n*o[g+y],mS.push(l);let v=s[l];c[0]=Math.min(v,c[0]),u[0]=Math.max(v,u[0]),v=s[l+1],c[1]=Math.min(v,c[1]),u[1]=Math.max(v,u[1]),v=s[l+2],c[2]=Math.min(v,c[2]),u[2]=Math.max(v,u[2])}}this.bbMin=c,this.bbMax=u;const h=Br(M(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let p=this.radius*this.radius;for(let f=0;f<mS.length;++f){l=mS.at(f);const g=s[l]-h[0],y=s[l+1]-h[1],v=s[l+2]-h[2],b=g*g+y*y+v*v;if(b<=p)continue;const w=Math.sqrt(b),x=.5*(w-this.radius);this.radius=this.radius+x,p=this.radius*this.radius;const S=x/w;h[0]+=g*S,h[1]+=y*S,h[2]+=v*S}this.center=h,mS.clear()}getChildren(){if(this._children||Xo(this.bbMin,this.bbMax)<=1)return this._children;const e=Br(M(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let u=0;u<8;++u)s[u]=0;const{data:n,size:o,indices:a}=this.position;for(let u=0;u<i;++u){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[u];let f=o*a[p],g=n[f],y=n[f+1],v=n[f+2];for(let b=1;b<this._numIndexPerPrimitive;++b){f=o*a[p+b];const w=n[f],x=n[f+1],S=n[f+2];w<g&&(g=w),x<y&&(y=x),S<v&&(v=S)}g<e[0]&&(h|=1),y<e[1]&&(h|=2),v<e[2]&&(h|=4),r[u]=h,++s[h]}let l=0;for(let u=0;u<8;++u)s[u]>0&&++l;if(l<2)return;const c=new Array(8);for(let u=0;u<8;++u)c[u]=s[u]>0?new Uint32Array(s[u]):void 0;for(let u=0;u<8;++u)s[u]=0;for(let u=0;u<i;++u){const h=r[u];c[h][s[h]++]=this.primitiveIndices[u]}this._children=new Array;for(let u=0;u<8;++u)c[u]!==void 0&&this._children.push(new uke(c[u],this._numIndexPerPrimitive,this.position));return this._children}static prune(){mS.prune()}};const mS=new ci({deallocator:null});let r4=class{constructor(){this.id=Ld()}};function T_t(t){return t?{p0:Fn(t.p0),p1:Fn(t.p1),p2:Fn(t.p2)}:{p0:M(),p1:M(),p2:M()}}function E_t(t,e,i){const r=e[0]-t[0],s=e[1]-t[1],n=i[0]-t[0],o=i[1]-t[1];return .5*Math.abs(r*o-s*n)}function C_t(t,e,i){return Me(TY,e,t),Me(z_e,i,t),.5*De(yt(TY,TY,z_e))}new t1(Eg);new t1(()=>T_t());const TY=M(),z_e=M();function M_t(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;ue(e,0,0,0),ue($p,0,0,0);let n=0,o=0;for(let a=0;a<s.length-2;a+=3){const l=s[a]*i,c=s[a+1]*i,u=s[a+2]*i;ue(ha,r[l],r[l+1],r[l+2]),ue(pv,r[c],r[c+1],r[c+2]),ue(t5,r[u],r[u+1],r[u+2]);const h=C_t(ha,pv,t5);h?(Te(ha,ha,pv),Te(ha,ha,t5),ce(ha,ha,1/3*h),Te(e,e,ha),n+=h):(Te($p,$p,ha),Te($p,$p,pv),Te($p,$p,t5),o+=3)}return(o!==0||n!==0)&&(n!==0?(ce(e,e,1/n),!0):o!==0&&(ce(e,$p,1/o),!0))}function A_t(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;ue(e,0,0,0);let n=-1,o=0;for(let a=0;a<s.length;a++){const l=s[a]*i;n!==l&&(e[0]+=r[l],e[1]+=r[l+1],e[2]+=r[l+2],o++),n=l}return o>1&&ce(e,e,1/o),o>0}function R_t(t,e,i){if(!t)return!1;ue(i,0,0,0),ue($p,0,0,0);let r=0,s=0;const{size:n,data:o,indices:a}=t,l=a.length-1,c=l+(e?2:0);for(let u=0;u<c;u+=2){const h=u<l?u+1:0,p=a[u<l?u:l]*n,f=a[h]*n;ha[0]=o[p],ha[1]=o[p+1],ha[2]=o[p+2],pv[0]=o[f],pv[1]=o[f+1],pv[2]=o[f+2],ce(ha,Te(ha,ha,pv),.5);const g=Rw(ha,pv);g>0?(Te(i,i,ce(ha,ha,g)),r+=g):r===0&&(Te($p,$p,ha),s++)}return r!==0?(ce(i,i,1/r),!0):s!==0&&(ce(i,$p,1/s),!0)}const ha=M(),pv=M(),t5=M(),$p=M();let o8=class{constructor(e){this.channel=e,this.id=Ld()}};function Lre(t,e){return t==null&&(t=[]),t.push(e),t}function Dre(t,e){if(t==null)return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function P_t(t,e,i,r,s){i5[0]=t.get(e,0),i5[1]=t.get(e,1),i5[2]=t.get(e,2),Zie(i5,gS,3),i.set(s,0,gS[0]),r.set(s,0,gS[1]),i.set(s,1,gS[2]),r.set(s,1,gS[3]),i.set(s,2,gS[4]),r.set(s,2,gS[5])}const i5=M(),gS=new Float32Array(6);let Zn=class hke extends r4{constructor(e,i,r=null,s=an.Mesh,n=null,o=-1){super(),this.material=e,this.mapPositions=r,this.type=s,this.objectAndLayerIdColor=n,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of i)this._attributes.set(a,{...l,indices:l0(l.indices)}),a===O.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(e={}){const i=new hke(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((r,s)=>{r.exclusive=!1,i._attributes.set(s,r)}),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(e){let i=this._attributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:S_t(i.data)},this._attributes.set(e,i)),i}setAttributeData(e,i){const r=this._attributes.get(e);r&&this._attributes.set(e,{...r,exclusive:!0,data:i})}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===an.Mesh?this._computeAttachmentOriginTriangles(e):this.type===an.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&nt(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.attributes.get(O.POSITION);return M_t(i,e)}_computeAttachmentOriginLines(e){const i=this.attributes.get(O.POSITION);return R_t(i,O_t(this.material.parameters,i),e)}_computeAttachmentOriginPoints(e){const i=this.attributes.get(O.POSITION);return A_t(i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(O.POSITION);if(!e||e.indices.length===0)return null;const i=this.type===an.Mesh?3:1;Tt(e.indices.length%i==0,"Indexing error: "+e.indices.length+" not divisible by "+i);const r=OC(e.indices.length/i);return new cke(r,i,e)}get transformation(){return this._transformation??us}set transformation(e){this._transformation=e&&e!==us?DO(e):null}addHighlight(){const e=new o8(qv.Highlight);return this.highlights=Lre(this.highlights,e),e}removeHighlight(e){this.highlights=Dre(this.highlights,e)}};function O_t(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const dM=Nre,EY=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],I_t=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],$_t=[0,0,1,0,1,1,0,1],N_t=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],dke=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)dke[6*t+e]=t;const LT=new Array(36);for(let t=0;t<6;t++)LT[6*t]=0,LT[6*t+1]=1,LT[6*t+2]=2,LT[6*t+3]=2,LT[6*t+4]=3,LT[6*t+5]=0;function L_t(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=EY[r][0]*e[0],i[3*r+1]=EY[r][1]*e[1],i[3*r+2]=EY[r][2]*e[2];return new Zn(t,[[O.POSITION,new dt(i,N_t,3,!0)],[O.NORMAL,new dt(I_t,dke,3)],[O.UV0,new dt($_t,LT,2)]])}const CY=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],D_t=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],F_t=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],k_t=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function U_t(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=CY[r][0]*e[0],i[3*r+1]=CY[r][1]*e[1],i[3*r+2]=CY[r][2]*e[2];return new Zn(t,[[O.POSITION,new dt(i,F_t,3,!0)],[O.NORMAL,new dt(D_t,k_t,3)]])}const uG=qr(-.5,0,-.5),hG=qr(.5,0,-.5),dG=qr(0,0,.5),pG=qr(0,.5,0),pM=fh(),fM=fh(),kP=fh(),UP=fh(),BP=fh();Me(pM,uG,pG),Me(fM,uG,hG),yt(kP,pM,fM),Se(kP,kP),Me(pM,hG,pG),Me(fM,hG,dG),yt(UP,pM,fM),Se(UP,UP),Me(pM,dG,pG),Me(fM,dG,uG),yt(BP,pM,fM),Se(BP,BP);const MY=[uG,hG,dG,pG],B_t=[0,-1,0,kP[0],kP[1],kP[2],UP[0],UP[1],UP[2],BP[0],BP[1],BP[2]],z_t=[0,1,2,3,1,0,3,2,1,3,0,2],V_t=[0,0,0,1,1,1,2,2,2,3,3,3];function G_t(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=MY[r][0]*e[0],i[3*r+1]=MY[r][1]*e[1],i[3*r+2]=MY[r][2]*e[2];return new Zn(t,[[O.POSITION,new dt(i,z_t,3,!0)],[O.NORMAL,new dt(B_t,V_t,3)]])}function imi(t,e,i,r,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),u=Math.max(2,Math.floor(r)),h=(c+1)*(u+1),p=qs(3*h),f=qs(3*h),g=qs(2*h),y=[];let v=0;for(let x=0;x<=u;x++){const S=[],E=x/u,C=a+E*l,R=Math.cos(C);for(let I=0;I<=c;I++){const F=I/c,D=n+F*o,z=Math.cos(D)*R,B=Math.sin(C),Y=-Math.sin(D)*R;p[3*v]=z*e,p[3*v+1]=B*e,p[3*v+2]=Y*e,f[3*v]=z,f[3*v+1]=B,f[3*v+2]=Y,g[2*v]=F,g[2*v+1]=E,S.push(v),++v}y.push(S)}const b=new Array;for(let x=0;x<u;x++)for(let S=0;S<c;S++){const E=y[x][S],C=y[x][S+1],R=y[x+1][S+1],I=y[x+1][S];x===0?(b.push(E),b.push(R),b.push(I)):x===u-1?(b.push(E),b.push(C),b.push(R)):(b.push(E),b.push(C),b.push(R),b.push(R),b.push(I),b.push(E))}const w=[[O.POSITION,new dt(p,b,3,!0)],[O.NORMAL,new dt(f,b,3,!0)]];return s.uv&&w.push([O.UV0,new dt(g,b,2,!0)]),s.offset&&(w[0][0]=O.OFFSET,w.push([O.POSITION,new dt(Float64Array.from(s.offset),Hx(b.length),3,!0)])),new Zn(t,w)}function j_t(t,e,i,r){const s=pke(e,i,r);return new Zn(t,s)}function pke(t,e,i){const r=t;let s,n;if(i)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const c=r*(1+Math.sqrt(5))/2;s=[-r,c,0,r,c,0,-r,-c,0,r,-c,0,0,-r,c,0,r,c,0,-r,-c,0,r,-c,c,0,-r,c,0,r,-c,0,-r,-c,0,r],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<s.length;c+=3)dM.scale(s,c,t/dM.length(s,c));let o={};function a(c,u){c>u&&([c,u]=[u,c]);const h=c.toString()+"."+u.toString();if(o[h])return o[h];let p=s.length;return s.length+=3,dM.add(s,3*c,s,3*u,s,p),dM.scale(s,p,t/dM.length(s,p)),p/=3,o[h]=p,p}for(let c=0;c<e;c++){const u=n.length,h=new Array(4*u);for(let p=0;p<u;p+=3){const f=n[p],g=n[p+1],y=n[p+2],v=a(f,g),b=a(g,y),w=a(y,f),x=4*p;h[x]=f,h[x+1]=v,h[x+2]=w,h[x+3]=g,h[x+4]=b,h[x+5]=v,h[x+6]=y,h[x+7]=w,h[x+8]=b,h[x+9]=v,h[x+10]=b,h[x+11]=w}n=h,o={}}const l=B_e(s);for(let c=0;c<l.length;c+=3)dM.normalize(l,c);return[[O.POSITION,new dt(B_e(s),n,3,!0)],[O.NORMAL,new dt(l,n,3,!0)]]}function Fre(t,e,i,r,s,n,o,a,l=null){const c=i?Fn(i):M(),u=e?Fn(e):Be(0,0,1);o??=vt();const h=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],p=s!=null&&s.length===2?s:[1,1],f=Hx(1),g=[[O.POSITION,new dt(c,f,3,!0)],[O.NORMAL,new dt(u,f,3,!0)],[O.UV0,new dt(o,f,o.length)],[O.COLOR,new dt(h,f,4,!0)],[O.SIZE,new dt(p,f,2)]];if(n!=null&&(n=[n[0],n[1],n[2],n[3]],g.push([O.CENTEROFFSETANDDISTANCE,new dt(n,f,4)])),a){const y=[a[0],a[1],a[2],a[3]];g.push([O.FEATUREATTRIBUTE,new dt(y,f,4)])}return new Zn(t,g,null,an.Point,l)}const H_t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function rmi(t,e=H_t){const i=new Array(12);for(let c=0;c<4;c++)for(let u=0;u<3;u++)i[3*c+u]=e[c][u];const r=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[O.POSITION,new dt(i,r,3,!0)],[O.NORMAL,new dt(s,n,3,!0)],[O.UV0,new dt(o,r,2,!0)],[O.COLOR,new dt(a,n,4,!0)]];return new Zn(t,l)}function V_e(t,e,i,r,s,n=!0,o=!0){let a=0;const l=i,c=e;let u=qr(0,a,0),h=qr(0,a+c,0),p=qr(0,-1,0),f=qr(0,1,0);s&&(a=c,h=qr(0,0,0),u=qr(0,a,0),p=qr(0,1,0),f=qr(0,-1,0));const g=[h,u],y=[p,f],v=r+2,b=Math.sqrt(c*c+l*l);if(s)for(let R=r-1;R>=0;R--){const I=R*(2*Math.PI/r),F=qr(Math.cos(I)*l,a,Math.sin(I)*l);g.push(F);const D=qr(c*Math.cos(I)/b,-l/b,c*Math.sin(I)/b);y.push(D)}else for(let R=0;R<r;R++){const I=R*(2*Math.PI/r),F=qr(Math.cos(I)*l,a,Math.sin(I)*l);g.push(F);const D=qr(c*Math.cos(I)/b,l/b,c*Math.sin(I)/b);y.push(D)}const w=new Array,x=new Array;if(n){for(let R=3;R<g.length;R++)w.push(1),w.push(R-1),w.push(R),x.push(0),x.push(0),x.push(0);w.push(g.length-1),w.push(2),w.push(1),x.push(0),x.push(0),x.push(0)}if(o){for(let R=3;R<g.length;R++)w.push(R),w.push(R-1),w.push(0),x.push(R),x.push(R-1),x.push(1);w.push(0),w.push(2),w.push(g.length-1),x.push(1),x.push(2),x.push(y.length-1)}const S=qs(3*v);for(let R=0;R<v;R++)S[3*R]=g[R][0],S[3*R+1]=g[R][1],S[3*R+2]=g[R][2];const E=qs(3*v);for(let R=0;R<v;R++)E[3*R]=y[R][0],E[3*R+1]=y[R][1],E[3*R+2]=y[R][2];const C=[[O.POSITION,new dt(S,w,3,!0)],[O.NORMAL,new dt(E,x,3,!0)]];return new Zn(t,C)}function q_t(t,e,i,r,s,n,o){const a=s?Gie(s):qr(1,0,0),l=n?Gie(n):qr(0,0,0);o??=!0;const c=fh();Se(c,a);const u=fh();ce(u,c,Math.abs(e));const h=fh();ce(h,u,-.5),Te(h,h,l);const p=qr(0,1,0);Math.abs(1-xe(c,p))<.2&&ue(p,0,0,1);const f=fh();yt(f,c,p),Se(f,f),yt(p,f,c);const g=2*r+(o?2:0),y=r+(o?2:0),v=qs(3*g),b=qs(3*y),w=qs(2*g),x=new Array(3*r*(o?4:2)),S=new Array(3*r*(o?4:2));o&&(v[3*(g-2)]=h[0],v[3*(g-2)+1]=h[1],v[3*(g-2)+2]=h[2],w[2*(g-2)]=0,w[2*(g-2)+1]=0,v[3*(g-1)]=v[3*(g-2)]+u[0],v[3*(g-1)+1]=v[3*(g-2)+1]+u[1],v[3*(g-1)+2]=v[3*(g-2)+2]+u[2],w[2*(g-1)]=1,w[2*(g-1)+1]=1,b[3*(y-2)]=-c[0],b[3*(y-2)+1]=-c[1],b[3*(y-2)+2]=-c[2],b[3*(y-1)]=c[0],b[3*(y-1)+1]=c[1],b[3*(y-1)+2]=c[2]);const E=(D,z,B)=>{x[D]=z,S[D]=B};let C=0;const R=fh(),I=fh();for(let D=0;D<r;D++){const z=D*(2*Math.PI/r);ce(R,p,Math.sin(z)),ce(I,f,Math.cos(z)),Te(R,R,I),b[3*D]=R[0],b[3*D+1]=R[1],b[3*D+2]=R[2],ce(R,R,i),Te(R,R,h),v[3*D]=R[0],v[3*D+1]=R[1],v[3*D+2]=R[2],w[2*D]=D/r,w[2*D+1]=0,v[3*(D+r)]=v[3*D]+u[0],v[3*(D+r)+1]=v[3*D+1]+u[1],v[3*(D+r)+2]=v[3*D+2]+u[2],w[2*(D+r)]=D/r,w[2*D+1]=1;const B=(D+1)%r;E(C++,D,D),E(C++,D+r,D),E(C++,B,B),E(C++,B,B),E(C++,D+r,D),E(C++,B+r,B)}if(o){for(let D=0;D<r;D++){const z=(D+1)%r;E(C++,g-2,y-2),E(C++,D,y-2),E(C++,z,y-2)}for(let D=0;D<r;D++){const z=(D+1)%r;E(C++,D+r,y-1),E(C++,g-1,y-1),E(C++,z+r,y-1)}}const F=[[O.POSITION,new dt(v,x,3,!0)],[O.NORMAL,new dt(b,S,3,!0)],[O.UV0,new dt(w,x,2,!0)]];return new Zn(t,F)}function smi(t,e,i,r,s,n){r=r||10,s=s==null||s,Tt(e.length>1);const o=[[0,0,0]],a=[],l=[];for(let c=0;c<r;c++){a.push([0,-c-1,-(c+1)%r-1]);const u=c/r*2*Math.PI;l.push([Math.cos(u)*i,Math.sin(u)*i])}return W_t(t,l,e,o,a,s,n)}function W_t(t,e,i,r,s,n,o=qr(0,0,0)){const a=e.length,l=qs(i.length*a*3+(6*r.length||0)),c=qs(i.length*a*3+(r?6:0)),u=new Array,h=new Array;let p=0,f=0;const g=M(),y=M(),v=M(),b=M(),w=M(),x=M(),S=M(),E=M(),C=M(),R=M(),I=M(),F=M(),D=M(),z=mr();ue(C,0,1,0),Me(y,i[1],i[0]),Se(y,y),n?(Te(E,i[0],o),Se(v,E)):ue(v,0,0,1),a8(y,v,C,C,w,v,G_e),ge(b,v),ge(F,w);for(let k=0;k<r.length;k++)ce(x,w,r[k][0]),ce(E,v,r[k][2]),Te(x,x,E),Te(x,x,i[0]),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2];c[f++]=-y[0],c[f++]=-y[1],c[f++]=-y[2];for(let k=0;k<s.length;k++)u.push(s[k][0]>0?s[k][0]:-s[k][0]-1+r.length),u.push(s[k][1]>0?s[k][1]:-s[k][1]-1+r.length),u.push(s[k][2]>0?s[k][2]:-s[k][2]-1+r.length),h.push(0),h.push(0),h.push(0);let B=r.length;const Y=r.length-1;for(let k=0;k<i.length;k++){let H=!1;k>0&&(ge(g,y),k<i.length-1?(Me(y,i[k+1],i[k]),Se(y,y)):H=!0,Te(R,g,y),Se(R,R),Te(I,i[k-1],b),zk(i[k],R,z),vC(z,Yd(I,g),E)?(Me(E,E,i[k]),Se(v,E),yt(w,R,v),Se(w,w)):a8(R,b,F,C,w,v,G_e),ge(b,v),ge(F,w)),n&&(Te(E,i[k],o),Se(D,E));for(let q=0;q<a;q++)if(ce(x,w,e[q][0]),ce(E,v,e[q][1]),Te(x,x,E),Se(S,x),c[f++]=S[0],c[f++]=S[1],c[f++]=S[2],Te(x,x,i[k]),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2],!H){const Q=(q+1)%a;u.push(B+q),u.push(B+a+q),u.push(B+Q),u.push(B+Q),u.push(B+a+q),u.push(B+a+Q);for(let K=0;K<6;K++){const re=u.length-6;h.push(u[re+K]-Y)}}B+=a}const W=i[i.length-1];for(let k=0;k<r.length;k++)ce(x,w,r[k][0]),ce(E,v,r[k][1]),Te(x,x,E),Te(x,x,W),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2];const J=f/3;c[f++]=y[0],c[f++]=y[1],c[f++]=y[2];const me=B-a;for(let k=0;k<s.length;k++)u.push(s[k][0]>=0?B+s[k][0]:-s[k][0]-1+me),u.push(s[k][2]>=0?B+s[k][2]:-s[k][2]-1+me),u.push(s[k][1]>=0?B+s[k][1]:-s[k][1]-1+me),h.push(J),h.push(J),h.push(J);const L=[[O.POSITION,new dt(l,u,3,!0)],[O.NORMAL,new dt(c,h,3,!0)]];return new Zn(t,L)}function nmi(t,e,i,r){Tt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Tt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),Tt(i==null||i.length===e.length,"createPolylineGeometry: need same number of points and normals"),Tt(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const s=qo(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let c=0;c<e.length;c++){for(let u=0;u<3;u++)s[o++]=e[c][u];c>0&&(n[a++]=c-1,n[a++]=c)}const l=[[O.POSITION,new dt(s,n,3,!0)]];if(i){const c=qs(3*i.length);let u=0;for(let h=0;h<e.length;h++)for(let p=0;p<3;p++)c[u++]=i[h][p];l.push([O.NORMAL,new dt(c,n,3,!0)])}return r&&l.push([O.COLOR,new dt(r,OC(r.length/4),4)]),new Zn(t,l,null,an.Line)}function omi(t,e,i,r,s,n=0){const o=new Array(18),a=[[-i,n,s/2],[r,n,s/2],[0,e+n,s/2],[-i,n,-s/2],[r,n,-s/2],[0,e+n,-s/2]],l=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let c=0;c<6;c++)o[3*c]=a[c][0],o[3*c+1]=a[c][1],o[3*c+2]=a[c][2];return new Zn(t,[[O.POSITION,new dt(o,l,3,!0)]])}function ami(t,e){const i=t.getMutableAttribute(O.POSITION).data;for(let r=0;r<i.length;r+=3){const s=i[r],n=i[r+1],o=i[r+2];ue(mM,s,n,o),nt(mM,mM,e),i[r]=mM[0],i[r+1]=mM[1],i[r+2]=mM[2]}}function Y_t(t,e=t){const i=t.attributes,r=i.get(O.POSITION).data,s=i.get(O.NORMAL).data;if(s){const n=e.getMutableAttribute(O.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(r){const n=e.getMutableAttribute(O.POSITION).data;for(let o=0;o<r.length;o+=3){const a=r[o+1];n[o+1]=-r[o+2],n[o+2]=a}}}function AY(t,e,i,r,s){return!(Math.abs(xe(e,t))>s)&&(yt(i,t,e),Se(i,i),yt(r,i,t),Se(r,r),!0)}function a8(t,e,i,r,s,n,o){return AY(t,e,s,n,o)||AY(t,i,s,n,o)||AY(t,r,s,n,o)}const G_e=.99619469809,mM=M();let X_t=class{constructor(e,i){this.type=Vl.Local,this._configuration=new Xue,this._passParameters=new Zue,this._configuration.geometry=b0.Cylinder,this._technique=i.techniques.acquire(r8,this._configuration);const r=i.renderContext.rctx;this._vao=Z_t(r),this._vaoCount=Pv(this._vao,"geometry");const s=new fs;s.wrapMode=Di.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Gr(r,s,f_t)}destroy(){this._passParameters.texture=jt(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const i=e.rctx,r=i.bindTechnique(this._technique,e.bindParameters,this._passParameters);J_t(j_e,e.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",j_e),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Li.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}};function Z_t(t){const e=pke(1,2,!1),{data:i,indices:r}=e[0][1],s=H_e.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o%3==0?o+2:o%3==2?o-2:o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new k0(t,Fi,{geometry:Dh(H_e)},{geometry:Vr.createVertex(t,wr.STATIC_DRAW,s.buffer)})}function J_t(t,e){Xn(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const j_e=Ne(),H_e=Xs().vec3f(O.POSITION),Q_t=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),r5=128,q_e=-Lie,W_e=0,RY=50,K_t=()=>1-511/512,evt=CV([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let tvt=class{constructor(e,i){this.view=e,this.type=Vl.Mars,this._passParameters=new Zue,this._vaoCount=0,this._texV1=1;const r=$r(e.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+q_e)/this._planetRadius,this._middleRimFactor=(this._planetRadius+W_e)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=W_e/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniques=i.techniques;const s=i.renderContext.rctx;this._cameraChangeHandle=_e(()=>this.view.state?.camera,()=>i.requestRender(),Sr),this._vao=this._createRibbon(s),this._vaoCount=Pv(this._vao,"geometry"),this._fadeVao=U0(s),this._fadeVaoCount=Pv(this._fadeVao,"geometry");const n=new fs;n.wrapMode=Di.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Gr(s,n,Q_t);const o=new Xue;o.geometry=b0.Cone,this._coneTechnique=this._techniques.acquire(r8,o),o.geometry=b0.Underground,this._undergroundTechnique=this._techniques.acquire(r8,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=jt(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const i=e.bindParameters.camera;this._update(i);const r=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,e.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Li.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,e.bindParameters,this._passParameters),r.bindVAO(this._fadeVao),r.drawArrays(Li.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const i=M(),r=this._planetRadius,s=De(e.eye),n=s-r;if(n<0){const f=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=f}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(RY,n),a=r+q_e;this._passParameters.innerScale=ivt(r+o,r,a)-1,this._passParameters.altitudeFade=Nue(n),ce(i,e.eye,(r+RY)/s),Y_e(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),c=K_t(),u=evt(n);let h=this._texV0+c*this._texVScale,p=this._texV0+l*u*this._texVScale;if(n>RY){Y_e(e.eye,e.center,e.up,r,this._passParameters.silhouette);const f=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),g=$e((f-1.5)/(l-1.5),0,1);h=this._texV0+g*c*this._texVScale,p=this._texV0+Wt(this._texV1,l*u,g)*this._texVScale}Gi(this._passParameters.texV,h,p)}_createRibbon(e){const i=qs(3+3*r5*3),r=new Uint32Array(3*r5*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<r5;o++){const a=9*o+3;i[a]=o,i[a+1]=this._innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this._middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this._outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===r5-1?1:l+3,u=15*o;r[u]=l,r[u+1]=l+1,r[u+2]=c+1,r[u+3]=c+1,r[u+4]=c,r[u+5]=l,r[u+6]=l+1,r[u+7]=l+2,r[u+8]=c+2,r[u+9]=c+2,r[u+10]=c+1,r[u+11]=l+1,r[u+12]=l,r[u+13]=c,r[u+14]=0}const s=X_e.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new k0(e,Fi,{geometry:Dh(X_e)},{geometry:Vr.createVertex(e,wr.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,i,r,s){return Te(gM,s.center,s.v2),ce(s5,gM,this._outerRimFactor),Mq(PY,i,gM,r),c_e(gM,PY,e.projectionMatrix,e.viewport,gM),c_e(s5,PY,e.projectionMatrix,e.viewport,s5),jr(gM,s5)/e.height}};function Y_e(t,e,i,r,s){const n=De(t),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.v1,c=s.v2;return ce(s.center,t,a/n),yt(l,t,e),Ql(l)<1&&yt(l,t,i),ce(l,l,o/De(l)),yt(c,l,t),ce(c,c,o/De(c)),o}const PY=Ne(),gM=M(),s5=M();function ivt(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}const X_e=Xs().vec3f(O.POSITION);var Yv;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(Yv||(Yv={}));let kre=class extends Zc{constructor(){super(...arguments),this.type=Yv.Rain}};d([V({count:Yv.COUNT})],kre.prototype,"type",void 0);function rvt(t){const e=new tr;return e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Qt("cameraPosition",(i,r)=>r.camera.eye)),e.vertex.uniforms.add(new Qt("offset",(i,r)=>svt(i,r))),e.vertex.uniforms.add(new et("width",i=>i.width)),e.vertex.uniforms.add(new Ps("proj",(i,r)=>r.camera.projectionMatrix)),e.vertex.uniforms.add(new Ps("view",(i,r)=>r.camera.viewMatrix)),e.vertex.uniforms.add(new et("time",i=>i.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(T`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===Yv.Rain?T`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:T`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new et("opacity",i=>i.opacity),new Qt("particleColor",(i,r)=>nvt(r,t))),e.fragment.code.add(T`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===Yv.Rain?T`d = 0.35 * smoothstep(0.5, 0.0, d);`:T`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function svt(t,e){const i=e.camera.eye,r=.5*t.width,s=1/t.width,n=bPe(Ure,ue(Ure,(i[0]+r)*s,(i[1]+r)*s,(i[2]+r)*s));return Vi(n,i,ce(n,n,t.width))}function nvt(t,e){const i=e.type===Yv.Rain?avt:ovt,r=ce(Ure,i,lvt),s=t.camera.eye;Se(Z_e,s);const n=Math.max(0,xe(Z_e,t.lighting.mainLight.direction));return Br(r,r,i,n)}const Ure=M(),Z_e=M(),ovt=Be(1,1,1),avt=Be(.85,.85,.85),lvt=.7,cvt=Object.freeze(Object.defineProperty({__proto__:null,build:rvt},Symbol.toStringTag,{value:"Module"}));let uvt=class extends is{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},Bre=class fke extends hr{initializeProgram(e){return new dr(e.rctx,fke.shader.get().build(this.configuration),l8)}initializePipeline(){return ti({blending:Za(ke.ONE,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),depthTest:{func:Lr.LEQUAL},colorWrite:fi})}};Bre.shader=new ir(cvt,()=>ye(()=>import("./Precipitation.glsl-6102aa0e.js"),[],import.meta.url));const l8=new Map([[O.POSITION,0],[O.INSTANCEFEATUREATTRIBUTE,1]]);let mke=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:i}){return i!=null?this._time!==i&&(this._time=i,!0):(this._time=this._time+e,e!==0)}},hvt=class{constructor(e,i){this.deltaTime=e,this.fixedTime=i}},qN=class extends Fe{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new uvt,this._animation=new mke,this._passParameters.time=0,this._passParameters.radius=$r(e.view.spatialReference).radius,this._techniques=e.context.techniques}destroy(){this._numParticles=0,this._snowTechniqueCached=yi(this._snowTechniqueCached),this._rainTechniqueCached=yi(this._rainTechniqueCached),this._vao=jt(this._vao),this._instanceIdBuffer=jt(this._instanceIdBuffer)}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new kre;e.type=Yv.Rain,this._rainTechniqueCached=this._techniques.acquire(Bre,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new kre;e.type=Yv.Snow,this._snowTechniqueCached=this._techniques.acquire(Bre,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,i,r){const s=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),s==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=e.bindParameters.cloudsFade.opacity),this._passParameters.opacity<=0))return;const o=.35;i=i<.5?Wt(0,o,2*i):Wt(o,1,2*(i-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*fle(this._animation.time)%1e5;const a=n.bindTechnique(s,e.bindParameters,this._passParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),kue(n,l8,this._instanceIdBuffer,J_e,0),n.drawArraysInstanced(Li.TRIANGLES,0,3,this._numParticles*i),KDe(n,l8,this._instanceIdBuffer,J_e)}_ensureResources(e){this._vao==null&&(this._vao=dvt(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const i=[];for(let r=0;r<this._numParticles;r++)i.push(r);return Vr.createVertex(e,wr.STATIC_DRAW,new Float32Array(i))}};function dvt(t){const e=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new k0(t,l8,{geometry:Dh(pvt)},{geometry:Vr.createVertex(t,wr.STATIC_DRAW,e)})}d([m({constructOnly:!0})],qN.prototype,"context",void 0),d([m({constructOnly:!0})],qN.prototype,"view",void 0),qN=d([N("esri.views.3d.environment.Precipitation")],qN);const pvt=Xs().vec3f(O.POSITION),J_e=Dh(Xs().f32(O.INSTANCEFEATUREATTRIBUTE),1);function fvt(){const t=new tr;return t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.COLOR,"vec4"),t.attributes.add(O.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new Ps("transform",(e,i)=>mvt(e,i)),new Ki("viewport",(e,i)=>i.camera.fullViewport),new et("pixelRatio",(e,i)=>i.camera.pixelRatio)),t.vertex.code.add(T`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(T`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function mvt(t,e){return Xn(N1,e.camera.projectionMatrix),N1[10]=24e-8-1,N1[11]=-1,N1[14]=(24e-8-2)*e.camera.near,Or(N1,N1,e.camera.viewMatrix),Or(N1,N1,t.modelMatrix)}const N1=Ne(),gvt=Object.freeze(Object.defineProperty({__proto__:null,build:fvt},Symbol.toStringTag,{value:"Module"}));let yvt=class extends is{constructor(){super(...arguments),this.modelMatrix=Ne()}},gke=class yke extends hr{constructor(e){super(e,new Zc,()=>this.destroy())}initializeProgram(e){return new dr(e.rctx,yke.shader.get().build(),Fi)}initializePipeline(){return ti({blending:Za(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),depthTest:{func:Lr.LEQUAL},colorWrite:fi})}};gke.shader=new ir(gvt,()=>ye(()=>import("./Stars.glsl-4a5c7d59.js"),[],import.meta.url));let Ib=class extends Fe{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._passParameters=new yvt,this._updatingTracking=new Mv}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=qc(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=yi(this._technique),this._vao=jt(this._vao),yS=null}render(e){const{rctx:i}=e;if(this._ensureResources(i),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const r=i.bindTechnique(this._technique,e.bindParameters,this._passParameters);i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Li.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||yS==null)return;this._technique=new gke({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=yS.byteLength/_ke;const i=new Float32Array(yS,0,2*this._numPoints),r=new Uint8Array(yS,2*this._numPoints*4,this._numPoints);this._vao=_vt(e,i,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),Ir)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*vvt(e),s=Xn(this._passParameters.modelMatrix,Evt);EO(s,s,-r*Math.PI),Or(s,Tvt,s),EO(s,s,-i*Math.PI),this.requestRender()}_createLoadDataTask(){if(yS!=null)return null;const e=P0(async i=>{const{data:r}=await RQe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});bvt(r),yS=r});return e.promise.catch(i=>{En(i)||oe.getLogger(this).error(i)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}};function _vt(t,e,i,r){const s=Q_e.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){const c=e[2*l],u=e[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(u)),n.set(l,1,-Math.sin(c)*Math.sin(u)),n.set(l,2,-Math.cos(u));const h=xvt(i[l]),p=wvt(Svt[h[1]]);o.set(l,0,255*p[0]),o.set(l,1,255*p[1]),o.set(l,2,255*p[2]),o.set(l,3,255),a.set(l,h[0])}return new k0(t,Fi,{geometry:Dh(Q_e)},{geometry:Vr.createVertex(t,wr.STATIC_DRAW,s.buffer)})}function vvt(t){const e=t,i=new Date(t.getFullYear(),0,1,11,58,56);return(+e-+i)/(+new Date(t.getFullYear()+1,0,1,11,58,55)-+i)}function bvt(t){if(!t)throw new j("stars:no-data-received","Failed to create stars because star catalogue is missing");const e=t.byteLength/_ke;if(e%1!=0||e>5e4||e<5e3)throw new j("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}function wvt(t){return[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]}function xvt(t){return t>=192?[2.9,t-192]:t>=160?[2.5,t-160]:t>=128?[2,t-128]:t>=96?[1.5,t-96]:t>=64?[1,t-64]:t>=32?[.7,t-32]:[.4,t]}d([m({constructOnly:!0})],Ib.prototype,"view",void 0),d([m({constructOnly:!0})],Ib.prototype,"requestRender",void 0),d([m({readOnly:!0})],Ib.prototype,"updating",null),d([m()],Ib.prototype,"_loadDataTask",void 0),d([m()],Ib.prototype,"_updatingTracking",void 0),Ib=d([N("esri.views.3d.environment.Stars")],Ib);const Svt=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],Tvt=Mce(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),Evt=Mce(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),_ke=9,Q_e=Xs().vec3f(O.POSITION).vec4u8(O.COLOR).f32(O.SIZE);let yS=null;const k9={required:[]},ohe={required:[G.Depth]};let U9=class extends Fe{consumes(){return k9}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(e){return!1}},ahe=class extends U9{},vke=class extends U9{constructor(){super(...arguments),this.drapedPriority=0}},Cvt=class extends U9{},Mvt=class extends U9{};function zre(t){return"prepareTechnique"in t}function K_e(t){return"prepareTechniques"in t}var zP;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(zP||(zP={}));let tl=class extends ahe{constructor(e){super(e),this.produces=new Map([[Ce.OPAQUE_ENVIRONMENT,()=>!(this._atmosphere===null&&this._stars===null)],[Ce.TRANSPARENT_ENVIRONMENT,()=>this._atmosphere!==null]]),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new OY,this._newWeatherParameters=new OY,this._fadedWeatherParameters=new OY,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),this.view?._stage!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:Vl.None}consumes(){return this._atmosphereType===Vl.Realistic?ohe:k9}updateAnimation(e){return this._precipitation!=null&&this._precipitation.update(e)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return De(this.view.state.camera.eye)-$r(this.view.spatialReference).radius<=ov}get usedMemory(){return this._clouds?.usedMemory??0}get _stars(){const e=this.view,i=e.environment?.starsEnabled??!1,r=this._get("_stars");return i&&this._context!=null?r??new Ib({view:e,requestRender:()=>this._setNeedsRender()}):(Ge(r),null)}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Ge(e),null;const i=this.view,r=this._context;return e!=null&&e.context===r?e:(Ge(e),new qN({context:r,view:i}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Ge(e),null;if(e!=null)return e;const i=this.view,r=this._context;return Ge(e),new fu({context:r,view:i,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Ge(e),null;const i=this.view.state.viewingMode,r=this._context.renderContext.rctx,s=$r(this.view.spatialReference).radius;return e!=null&&e.viewingMode===i&&e.planetRadius===s?e:(Ge(e),new $T({rctx:r,viewingMode:i,planetRadius:s,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Ge(e),null;if(e!=null)return e;const i=this.view,r=this._context,s=this._context.renderContext.rctx,n=this.view.state.viewingMode;return new NT({context:r,view:i,rctx:s,viewingMode:n})}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e;const i=()=>this._setNeedsRender();this.addHandles([_e(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),Sr),_e(()=>this._stars,i),_e(()=>this._precipitation,i),_e(()=>this._clouds,()=>this._updateWeather(),Ir),_e(()=>this._fog,()=>this._updateFogHaze(),Ir),_e(()=>this.view.state.mode,()=>this._setNeedsRender(),Mr),_e(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Sr)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Ge(this._atmosphere),this._set("_stars",Ge(this._stars)),this._set("_precipitation",Ge(this._precipitation)),this._set("_clouds",Ge(this._clouds)),this._set("_cloudsComposition",Ge(this._cloudsComposition)),this._set("_fog",Ge(this._fog))}prepareRender(e){e.bindParameters.cloudsFade.data=Hyt(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&e.bindParameters.cloudsFade.data?.cubeMap!=null&&(this._updateWeatherFading(e.bindParameters,e.time),e.bindParameters.cloudsFade.renderingStage===Xy.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),e.bindParameters.cloudsFade.data=null))}renderNode(e){switch(e.bindParameters.slot){case Ce.OPAQUE_ENVIRONMENT:this._stars?.render(e),this.atmosphere!=null&&(this.atmosphere.render(e,this.view?._stage?.renderer?.fullResolutionAtmosphere),this._cloudsComposition&&e.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(e)),e.bindParameters.cloudsFade.isFading&&this._context&&e.bindParameters.cloudsFade.data?.cubeMap!=null&&this._context.requestRender());break;case Ce.TRANSPARENT_ENVIRONMENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(e,this._weatherParameters.hazeAmount,this.view?._stage?.renderer?.fullResolutionAtmosphere),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(e,this._weatherParameters.fog),this._precipitation)){const i=this.view.environment.weather;i.type!=="rainy"&&i.type!=="snowy"||this._precipitation.render(e,i.precipitation,i.type)}}}updateLightSources(e,i,r,s){if(this._context!=null){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=i,n.bindParameters.newLighting.globalFactor=r,n.bindParameters.newLighting.set(e),s===zP.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return e==null?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeatherFading(e,i){e.cloudsFade.updateFading(e.camera,this.view.state.mode,i,this.view.qualitySettings.fadeDuration),e.cloudsFade.updateParallax(e.camera),e.weatherFading&&(Avt(e),this._updateFogAtmoshpere(e))}_updateFogAtmoshpere(e){e.cloudsFade.fadeMode!==ls.CROSS_FADE&&e.cloudsFade.fadeMode!==ls.FADE_IN?this._fadeWeather(0):this._fadeWeather(e.cloudsFade.fadeFactor)}_fadeWeather(e){const{_newWeatherParameters:i,_oldWeatherParameters:r}=this;e>=1?this._weatherParameters=i:(this._fadedWeatherParameters.lerp(r,i,e),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const e=this._weatherUpdateParameters;e!=null&&this._clouds!=null&&(this._clouds.applyPreset(Bl[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const e=this._weatherUpdateParameters;if(this._fog==null||e==null||this._context==null)return;const i=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),e.type){case"foggy":this._newWeatherParameters.fog.strength=Wt(3e-5,.005,e.weatherAdjustment**3),ge(this._newWeatherParameters.fog.color,eve),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Wt(4e-6,2e-4,(e.effect??0)**3),ge(this._newWeatherParameters.fog.color,Rvt),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Wt(4e-6,2e-4,(e.effect??0)**3),ge(this._newWeatherParameters.fog.color,eve),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}i.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(e){const i=this._selectAtmosphereType(e);if(i!==Vl.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==i){this._atmosphere=Ge(this._atmosphere);const r=this._getAtmosphereClass(i);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=Ge(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(e){switch(e){case Vl.Realistic:return Gyt;case Vl.Local:return X_t;case Vl.Mars:return tvt;default:case Vl.None:return null}}_selectAtmosphereType(e){const{enabled:i,viewingMode:r}=e;return!i||fC(this.view.spatialReference)?Vl.None:r===Xe.Local?Vl.Local:this._context!=null&&EE(this.view.spatialReference)?Vl.Realistic:pC(this.view.spatialReference)?Vl.Mars:Vl.None}get test(){}};d([m({constructOnly:!0})],tl.prototype,"view",void 0),d([m({readOnly:!0})],tl.prototype,"atmosphere",null),d([m({readOnly:!0})],tl.prototype,"_atmosphereType",null),d([m({type:Boolean,readOnly:!0})],tl.prototype,"updating",null),d([m({readOnly:!0})],tl.prototype,"weatherVisible",null),d([m()],tl.prototype,"_context",void 0),d([m()],tl.prototype,"_atmosphere",void 0),d([m({readOnly:!0})],tl.prototype,"_stars",null),d([m({readOnly:!0})],tl.prototype,"_precipitation",null),d([m({readOnly:!0})],tl.prototype,"_clouds",null),d([m({readOnly:!0})],tl.prototype,"_cloudsComposition",null),d([m({readOnly:!0})],tl.prototype,"_fog",null),d([m({readOnly:!0})],tl.prototype,"weatherEnabled",null),d([m({readOnly:!0})],tl.prototype,"_precipitationEnabled",null),d([m({readOnly:!0})],tl.prototype,"_weatherUpdateParameters",null),tl=d([N("esri.views.3d.environment.EnvironmentRenderer")],tl);let OY=class{constructor(){this.fog=new n_t,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,ge(this.fog.color,e.fog.color)}lerp(e,i,r){this.fog.amount=Wt(e.fog.amount,i.fog.amount,r),this.hazeAmount=Wt(e.hazeAmount,i.hazeAmount,r),this.fog.strength=Wt(e.fog.strength,i.fog.strength,r),Br(this.fog.color,e.fog.color,i.fog.color,r)}};function Avt(t){t.cloudsFade.fadeMode!==ls.CROSS_FADE&&t.cloudsFade.fadeMode!==ls.FADE_IN?t.fadeLighting(0):t.fadeLighting(t.cloudsFade.fadeFactor)}const Rvt=Be(.5,.5,.5),eve=Be(1.5,1.5,1.5);var Tmi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function s4(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var tve,ive,rve,bke={exports:{}};tve=bke,ive=function(){var t=Math.PI,e=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,u=2451545,h={dec:0,ra:0};function p(L){return L.valueOf()/l-.5+c}function f(L){return new Date((L+.5-c)*l)}function g(L){return p(L)-u}var y=23.4397*a;function v(L,k){return n(e(L)*i(y)-r(k)*e(y),i(L))}function b(L,k){return s(e(k)*i(y)+i(k)*e(y)*e(L))}function w(L,k,H){return n(e(L),i(L)*e(k)-r(H)*i(k))}function x(L,k,H){return s(e(k)*e(H)+i(k)*i(H)*i(L))}function S(L,k){return a*(280.16+360.9856235*L)-k}function E(L){return a*(357.5291+.98560028*L)}function C(L){return a*(1.9148*e(L)+.02*e(2*L)+3e-4*e(3*L))}function R(L,k){return L+k+102.9372*a+t}function I(L,k){var H=E(L),q=R(H,C(H));return k||(k={dec:0,ra:0}),k.dec=b(q,0),k.ra=v(q,0),k}var F={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(L,k,H,q){var Q=a*-H,K=a*k,re=g(L),be=I(re,h),Re=S(re,Q)-be.ra;return q||(q={azimuth:0,altitude:0}),q.azimuth=w(Re,K,be.dec),q.altitude=x(Re,K,be.dec),q}},D=[[-.83,"sunrise","sunset"]];F.addTime=function(L,k,H){D.push([L,k,H])};var z=9e-4;function B(L,k){return Math.round(L-z-k/(2*t))}function Y(L,k,H){return z+(L+k)/(2*t)+H}function W(L,k,H){return u+L+.0053*e(k)-.0069*e(2*H)}function J(L,k,H){return o((e(L)-e(k)*e(H))/(i(k)*i(H)))}function me(L){var k=a*(134.963+13.064993*L),H=a*(93.272+13.22935*L),q=a*(218.316+13.176396*L)+6.289*a*e(k),Q=5.128*a*e(H),K=385001-20905*i(k);return{ra:v(q,Q),dec:b(q,Q),dist:K}}return F.getTimes=function(L,k,H){var q=a*-H,Q=a*k,K=B(g(L),q),re=Y(0,q,K),be=E(re),Re=C(be),je=R(be,Re),_t=b(je,0),ht=W(re,be,je);function ut(He){return W(Y(J(He,Q,_t),q,K),be,je)}function lt(He){var Lt=(e(He)-e(Q)*e(_t))/(i(Q)*i(_t));return Lt<-1?F.PolarException.MIDNIGHT_SUN:Lt>1?F.PolarException.POLAR_NIGHT:F.PolarException.NORMAL}var at,bi,gi,We,ii,Ye={solarNoon:f(ht),nadir:f(ht-.5),polarException:F.PolarException.NORMAL};for(at=0,bi=D.length;at<bi;at+=1)ii=ht-((We=ut((gi=D[at])[0]*a))-ht),Ye[gi[1]]=f(ii),Ye[gi[2]]=f(We);return Ye.polarException=lt(D[0][0]*a),Ye},F.getMoonPosition=function(L,k,H){var q=a*-H,Q=a*k,K=g(L),re=me(K),be=S(K,q)-re.ra,Re=x(be,Q,re.dec);return Re+=.017*a/r(Re+10.26*a/(Re+5.1*a)),{azimuth:w(be,Q,re.dec),altitude:Re,distance:re.dist}},F.getMoonFraction=function(L){var k=g(L),H=I(k),q=me(k),Q=149598e3,K=o(e(H.dec)*e(q.dec)+i(H.dec)*i(q.dec)*i(H.ra-q.ra)),re=n(Q*e(K),q.dist-Q*i(K));return(1+i(re))/2},F},(rve=ive())!==void 0&&(tve.exports=rve);const WE=s4(bke.exports),Fc={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let n5=class{constructor(e,i){this.direct=e,this.ambient=i}};function Pvt(t,e,i,r,s,n){ue(n.ambient.color,1,1,1),n.ambient.intensity=Fc.global.ambient,ue(n.direct.color,1,1,1),n.direct.intensity=Fc.global.direct;const o=e[2],a=$e((Math.abs(o)-Fc.local.altitude)/(Fc.global.altitude-Fc.local.altitude),0,1);let l;if(n.globalFactor=a,t!=null&&(l=WE.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=Fvt(t,l,r);else{const u=Ske(r);c={direct:{intensity:Fc.local.directAtNoon*u.direct,color:Be(1,1,1)},ambient:{intensity:Fc.local.ambientAtNoon*u.ambient,color:Be(1,1,1)},timeOfDay:"early afternoon"}}Br(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=Wt(c.ambient.intensity,n.ambient.intensity,a),Br(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=Wt(c.direct.intensity,n.direct.intensity,a),n.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,n.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}n.noonFactor=t!=null?Dvt(t,l):1,t!=null?Ovt(t,e,i,n.direct.directionToLightSource):wke(s,i,n.direct.directionToLightSource)}function wke(t,e,i){e===Xe.Global?Se(LY,t.eye):ue(LY,0,0,1),ce(DY,t.viewForward,-1);const r=Ij(DY,LY),s=Math.max(r-2*FY,0),n=.85*s/(s+1),o=Math.max(FY,r-FY-n);Ph(fve,-o,t.viewRight),nt(i,DY,fve),Te(i,i,ce(kvt,t.viewRight,Uvt)),Se(i,i)}function Ovt(t,e,i,r){const s=Lvt,n=df(Nvt);if(i===Xe.Global)WE.getPosition(t,0,0,s),ue(r,0,0,-1),TO(n,n,-s.azimuth),Cq(n,n,-s.altitude),nt(r,r,n);else{const o=Fc.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=$e(c,0,1),c<1?(WE.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),ue(r,0,-1,0),EO(n,n,-s.azimuth),TO(n,n,-s.altitude),nt(r,r,n)}}function Ivt(t,e){if(e===Xe.Global)return!0;const i=Fc.planarDirection;return Math.abs(t)<i.localAltitude}const $vt=Be(.5773502691896258,-.5773502691896258,.5773502691896258);let xke=class{constructor(){this.ambient={color:Be(1,1,1),intensity:.55},this.direct={color:Be(1,1,1),intensity:.55,directionToLightSource:Fn($vt)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const Nvt=Ne(),Lvt={azimuth:0,altitude:0};function Dvt(t,e){const i=t.valueOf();let r,s;e.polarException===WE.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=r+432e6):e.polarException===WE.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=r+(s-r)/2;return 1-$e(Math.abs(i-n)/432e5,0,1)}function Ske(t){switch(t){case"disabled":case"sunny":case"cloudy":return new n5(1,1);case"rainy":return new n5(.4,1.2);case"snowy":return new n5(.5,1.3);case"foggy":return new n5(.2,1.6)}}function sve(t,e){const i=(t[0]+t[1]+t[2])/3;t[0]+=(i-t[0])*e,t[1]+=(i-t[1])*e,t[2]+=(i-t[2])*e}const IY=Be(.01,.01,.01),Vre=Be(1,.6,.5),Gre=Be(1,.98,.98),nve=Be(1,1,1),$Y=Be(.8,.8,1),jre=Be(.8,.8,1),Hre=Be(.98,.98,1),ove=Be(1,1,1),NY=Ni(.01,Fc.local.ambientAtNight),qre=Ni(Fc.local.directAtTwilight,Fc.local.ambientAtTwilight),Wre=Ni(.9*Fc.local.directAtNoon,Fc.local.ambientAtNoon),ave=Ni(Fc.local.directAtNoon,Fc.local.ambientAtNoon),lve=Wre,cve=Gre,uve=Hre,hve=qre,dve=Vre,pve=jre;function Fvt(t,e,i){const r=t.valueOf();let s,n;e.polarException===WE.PolarException.MIDNIGHT_SUN?(s=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===WE.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,u=a+l,h=.06*o,p=s-h/2,f=s+h/2,g=n-h/2,y=n+h/2,v=vt(),b=M(),w=M();let x="";if(r<p||r>y)Cl(v,NY),ge(b,IY),ge(w,$Y),x="night";else if(r<f){const C=(r-p)/(f-p);qp(v,NY,qre,C),Br(b,IY,Vre,C),Br(w,$Y,jre,C),x="sun rising"}else if(r<c){const C=(r-f)/(c-f);qp(v,qre,Wre,C),Br(b,Vre,Gre,C),Br(w,jre,Hre,C),x="early morning"}else if(r<a){const C=(r-c)/(a-c);qp(v,Wre,ave,C),Br(b,Gre,nve,C),Br(w,Hre,ove,C),x="late morning"}else if(r<u){const C=(r-a)/(u-a);qp(v,ave,lve,C),Br(b,nve,cve,C),Br(w,ove,uve,C),x="early afternoon"}else if(r<g){const C=(r-u)/(g-u);qp(v,lve,hve,C),Br(b,cve,dve,C),Br(w,uve,pve,C),x="late afternoon"}else if(r<y){const C=(r-g)/(y-g);qp(v,hve,NY,C),Br(b,dve,IY,C),Br(w,pve,$Y,C),x="sun setting"}let S=0;switch(i){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(sve(b,S),sve(w,S));const E=Ske(i);return{direct:{intensity:v[0]*E.direct,color:b},ambient:{intensity:v[1]*E.ambient,color:w},timeOfDay:x}}const fve=Ne(),LY=M(),DY=M(),kvt=M(),FY=.25,Uvt=.2;function Tke(t){return EE(t)?Uv(t)||cg(t)||mO(t)||sF(t)?wlt:t:Xd(t)}var c0;function Mmi(t){return Bvt(t,c0.Horizontal)}function Bvt(t,e){const{hasZ:i,spatialReference:r}=t,s=Tke(r);let n=0;const o=JRe(s);if(o==null)return null;const a=e===c0.Direct?Eke:Cke;for(const l of t.paths){if(l.length<2)continue;const c=l.length-1;for(let u=0;u<c;++u){const h=l[u];ya[0]=h[0],ya[1]=h[1],ya[2]=i?h[2]:0;const p=l[u+1];_a[0]=p[0],_a[1]=p[1],_a[2]=i?p[2]:0;const f=a(ya,_a,r);if(f==null)return null;n+=f.value}}return Av(n,o)}function Ami(t,e){const{spatialReference:i}=t;return Bs(i,e.spatialReference)?(ya[0]=t.x,ya[1]=t.y,ya[2]=t.hasZ?t.z:0,_a[0]=e.x,_a[1]=e.y,_a[2]=e.hasZ?e.z:0,Gvt(ya,_a,i)):null}function zvt(t,e){const{spatialReference:i}=t;return Bs(i,e.spatialReference)?(ya[0]=t.x,ya[1]=t.y,ya[2]=t.hasZ?t.z:0,_a[0]=e.x,_a[1]=e.y,_a[2]=e.hasZ?e.z:0,Eke(ya,_a,i)):null}function Rmi(t,e){const{spatialReference:i}=t;return Bs(i,e.spatialReference)?(ya[0]=t.x,ya[1]=t.y,ya[2]=t.hasZ?t.z:0,_a[0]=e.x,_a[1]=e.y,_a[2]=e.hasZ?e.z:0,Cke(ya,_a,i)):null}function Pmi(t,e){const{spatialReference:i}=t;return Bs(i,e.spatialReference)?(ya[0]=t.x,ya[1]=t.y,ya[2]=t.hasZ?t.z:0,_a[0]=e.x,_a[1]=e.y,_a[2]=e.hasZ?e.z:0,jvt(ya,_a,i)):null}function Omi(t){return t!=null?Vvt(t.hasZ?t.z:0,t.spatialReference):null}function Vvt(t,e){const i=QRe(e);return i!=null?Av(t??0,i):null}function Gvt(t,e,i){const r=B9(t,e,i);return r!=null?{direct:Av(r.direct,r.unit),horizontal:Av(r.horizontal,r.unit),vertical:Av(r.vertical,r.unit)}:null}function Eke(t,e,i){const r=B9(t,e,i,c0.Direct);return r!=null?Av(r.direct,r.unit):null}function Cke(t,e,i){const r=B9(t,e,i,c0.Horizontal);return r!=null?Av(r.horizontal,r.unit):null}function jvt(t,e,i){const r=B9(t,e,i,c0.Vertical);return r!=null?Av(r.verticalSigned,r.unit):null}function B9(t,e,i,r){const s=Tke(i),n=JRe(s);if(n==null)return null;const o=e[2]-t[2];if(r===c0.Vertical)return{verticalSigned:o,unit:n};if(!wa(t,i,kY,s)||!wa(e,i,o5,s))return null;if(r===c0.Direct)return{direct:jr(o5,kY),unit:n};if(ue(a5,t[0],t[1],e[2]),!wa(a5,i,a5,s))return null;const a=jr(a5,o5);return r===c0.Horizontal?{horizontal:a,unit:n}:{direct:jr(o5,kY),horizontal:a,vertical:Math.abs(o),unit:n}}(function(t){t[t.Direct=0]="Direct",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"})(c0||(c0={}));const ya=M(),_a=M(),kY=M(),o5=M(),a5=M();let nm=class extends un.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandlesKey="viewHandles",this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new t8,this._ambientLight=new Wue,this._moonLight=new PFe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePositionGeographic=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===Xe.Global&&EE(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionGeographic(){return this._referencePositionGeographic}connectView(e){if(this._renderer)return;this._renderer=new tl({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this.addHandles([_e(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Mr),_e(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Mr),_e(()=>e.stationary,()=>this._interactingStationaryHandler()),_e(()=>e.environment.lighting.directShadowsEnabled,i,Mr),_e(()=>e.qualitySettings.ambientOcclusion,i,Mr),_e(()=>e.qualitySettings.reflections,i,Mr),_e(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Mr),_e(()=>e.environment.weather.type,()=>this._updateLighting(null,zP.Faded),Mr),_e(()=>this.weatherEnabled,()=>this._updateLighting(null,zP.Faded),Mr),_e(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Sr),_e(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),Sr),_e(()=>e.state.camera,r,Sr),_e(()=>this.disableQueries,r)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=Ge(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;i?.type!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if(i?.type!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!Fu(r,Je.WGS84)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),this._referencePositionGeographic!=null){const s=C0e(this._referencePositionGeographic,mve);s!=null&&(i.autoUpdate(null,s),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,i){const r=EE(this._view.spatialReference);if(r&&!Fu(this._view.spatialReference,Je.WGS84))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return this._referencePositionGeographic??=M(),r?lc(s,this._referencePositionGeographic,Je.WGS84):ue(this._referencePositionGeographic,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionGeographic"),this._autoUpdateTimezone(this._referencePositionGeographic,i)||this._updateLighting(i),!0}_cameraHandlerServerSide(e){const i=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(i))&&this._requestReferencePositionUpdate(i,!0),this._view.mapCoordsHelper&&this._referencePositionGeographic&&(this._referencePositionGeographic[2]=(i.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,i=zP.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const s=this._referencePositionGeographic,n=s?Hvt:qvt,o=this.weatherVisible?r.environment.weather.type:"disabled";s!=null?Pvt(e,s,r.state.viewingMode,o,r.state.camera,n):r.environment.lighting.type==="virtual"&&wke(r.state.camera,r.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;ce(a.intensity,l.color,l.intensity*Math.PI),ge(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;ce(c.intensity,n.ambient.color,n.ambient.intensity);const u=this._moonLight;Br(u.intensity,Yvt,Xvt,n.globalFactor);const h=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));ce(u.intensity,u.intensity,h),ge(u.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,u],n.noonFactor,n.globalFactor,i),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=Wvt;r.setTime((i||this._view.environment.lighting.date).getTime());const s=C0e(e,mve);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=r.getUTCHours()-(s.hours-n.hours),a=r.getUTCMinutes()-(s.minutes-n.minutes),l=r.getUTCSeconds()-(s.seconds-n.seconds);return r.setUTCHours(o),r.setUTCMinutes(a),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const i=this._referencePositionGeographic==null||Ivt(this._referencePositionGeographic[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePositionGeographic=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,i=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!i,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=eF(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const n=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=eF(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const i=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(i[0])&&!isNaN(i[1])){const r=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePositionGeographic?ue(this._referencePositionGeographic,i[0],i[1],r):this._referencePositionGeographic=Be(i[0],i[1],r),this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePositionGeographic)||this._updateLighting(),this.notifyChange("referencePositionGeographic")}_exceedsReferencePosDistThreshold(e){const i=this._referencePosMapCoords;if(i==null)return!0;const r=zvt(i,e);return r==null?!0:egt(r,"meters").value>this._referencePointUpdateDistThreshold}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){}};d([m({type:Boolean,readOnly:!0})],nm.prototype,"updating",null),d([m()],nm.prototype,"disableQueries",void 0),d([m()],nm.prototype,"_disableWeather",void 0),d([m()],nm.prototype,"weatherEnabled",null),d([m()],nm.prototype,"weatherVisible",null),d([m()],nm.prototype,"referencePositionGeographic",null),d([m()],nm.prototype,"_renderer",void 0),d([m()],nm.prototype,"_referencePositionGeographic",void 0),nm=d([N("esri.views.3d.environment.SceneViewEnvironmentManager")],nm);const Hvt=new xke,qvt=new xke,Wvt=new Date,mve={hours:0,minutes:0,seconds:0},Yvt=Be(.22,.22,.33),Xvt=Be(.22,.22,.22);var Ss;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Ss||(Ss={}));var Ei;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(Ei||(Ei={}));var w0;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(w0||(w0={}));let wf=class{constructor(e=Ss.ALL,i=Ei.NONE,r=0,s=null,n=null,o=w0.TUMBLE){this.selection=e,this.interactionType=i,this.interactionFactor=r,this.interactionStartCamera=s,this.interactionDirection=n,this.tiltMode=o}};function OF(t,e){return!!(t&e)}function c8(t,e,i,r,s,n){t!==0&&(i?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):r!=null?(n.min-=Math.max(0,(e-n.min)*(1-r)),n.max+=Math.max(0,(e-n.max)*(1-r))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const IC=new wf(Ss.NONE);function Mke(t,e,i,r){return e=e||t.viewForward,ge(r,e),ce(r,r,Math.sign(xe(e,i))),r}function Zvt(t,e,i,r){return t1t(t,e,i,Kvt(r,e,i,!0))}function Jvt(t,e,i,r){const s=xe(i,Me(t,r,e));return Te(t,e,ce(t,i,s))}const Qvt={dir:M(),len:0,clip:vt()};function Kvt(t,e,i,r){const s=Qvt;return t?(i&&r&&(s.len=jr(e,i)),ge(s.dir,t)):r?(s.len=jr(e,i),Me(s.dir,i,e),ce(s.dir,s.dir,1/s.len)):(Me(s.dir,i,e),Se(s.dir,s.dir)),s}function e1t(t,e,i){const r=xe(t,i.dir),s=-Wr(t,e);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function t1t(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!e1t(t[s],e,r))return!1;return!0}function i1t(t,e,i=IC){const r=lhe(t,e,i);if(r===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+r,o=Mke(e,i.interactionDirection,n1t(t,e,Math.sign(r),c1t),l1t),a=ge(u1t,e.viewForward),l=s.intersectInfiniteManifold(Yd(e.eye,o),n,UY);return e.eye=l??s.setAltitude(UY,n,e.eye),e.center=Jvt(UY,e.eye,a,e.center),!0}function lhe(t,e,i=IC){if(!r1t(t,i)||!t.state.constraints.altitude)return 0;const r=o1t(t.state.constraints.altitude,a1t);s1t(t,i,r);const s=t.renderCoordsHelper.getAltitude(e.eye),n=$e(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function r1t(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==Ei.TUMBLE||!OF(e.selection,Ss.TILT))}function s1t(t,e,i){const r=e.interactionType;if(r===Ei.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===Ei.TUMBLE||r===Ei.ZOOM,c=lhe(t,o),u=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,c8(c,u,l,a,.05*u,i)}function n1t(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),ce(r,r,i),r}function o1t(t,e){return e.min=t.min,e.max=t.max,e}const a1t={min:0,max:0},l1t=M(),c1t=M(),u1t=M(),UY=M();function che(t,e,i=IC){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;l5.min=0,l5.max=r,d1t(t,i,l5);const s=uhe(t,e),n=l5.max-s;return n>=-1e-6?0:n}function h1t(t,e,i=IC){const r=che(t,e,i);if(r===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=uhe(t,e)+r,o=ge(f1t,e.eye),a=Mke(e,i.interactionDirection,p1t(e,s.renderLocation,y1t),g1t);if(!Lx(S3e(s.renderLocation,n),Yd(e.eye,a),c5))return!1;e.eye=c5;const l=Me(m1t,e.eye,o);e.center=Te(c5,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),u=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,c5);return u!=null&&(e.center=u),!0}function d1t(t,e,i){const r=e.interactionType;if(r===Ei.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===Ei.ZOOM||r===Ei.PAN,c=che(t,o),u=c===0?0:uhe(t,o);i.min=s,i.max=n,c8(c,u,l,a,.05*u,i)}function uhe(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?jr(e.eye,i.renderLocation):0}function p1t(t,e,i){return Kv(i,t.eye,e)}const l5={min:0,max:0},f1t=M(),m1t=M(),g1t=M(),y1t=M(),c5=M();function XI(t,e,i=ef.EYE){const r=t.state.constraints;if(!r.collision.enabled)return!1;const s=f9(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=De(e.eye);if(Me(u5,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(_1t,o,e.eye),i===ef.EYE_AND_CENTER)e.center=Te(u5,e.eye,u5);else if(i===ef.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=ce(u5,e.center,l)}return!0}var ef;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(ef||(ef={}));const u5=M(),_1t=M();function mx(t,e,i){t.worldUpAtPosition(e,gve),Me(BY,i,e);const r=De(BY);return r===0?0:Jo(xe(BY,gve)/r)}const gve=M(),BY=M();function Ake(t,e,i,r=!0){Z$.eyeCenterDistance=0,Z$.requiresTwoSteps=!1;const s=hhe(t,e,i,IC,Z$);if(s===0)return!1;switch(Ph(h5,-s,e.viewRight),i.tiltMode){case w0.LOOK_AROUND:nt(L1,e.viewForward,h5),ce(L1,L1,Z$.eyeCenterDistance),e.center=Te(aw,e.eye,L1);break;case w0.TUMBLE:Me(L1,e.center,e.eye),nt(L1,L1,h5),e.eye=Me(aw,e.center,L1);break;default:i.tiltMode}return e.up=nt(aw,e.up,h5),!Z$.requiresTwoSteps||!r||Ake(t,e,i,!1)}function hhe(t,e,i,r=IC,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,A1t);return M1t(t,i,o),r.interactionType===Ei.TUMBLE&&OF(r.selection,Ss.ALTITUDE)&&Rke(t,r.interactionStartCamera,o),i.tiltMode===w0.LOOK_AROUND||r.tiltMode===w0.LOOK_AROUND?b1t(t,e,o,s):v1t(t,e,o)}function v1t(t,e,i){const r=mx(t.renderCoordsHelper,e.center,e.eye),s=r-$e(r,i.min,i.max);return IF(s)?s:0}function b1t(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return x1t(t,e,i,r);case"local":return w1t(t,e,i,r)}}function w1t(t,e,i,r){const s=mx(t.renderCoordsHelper,e.center,e.eye),n=$e(s,i.min,i.max),o=s-n;if(!IF(o))return 0;if(r){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return o}function x1t(t,e,i,r){const s=S1t(t,e,R1t),n=$e(s.tiltAtCenter,i.min,i.max);if(!IF(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=T1t(s),a=E1t(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=C1t(s,o)),r&&(r.eyeCenterDistance=Yre(s,o)),a}function S1t(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+$r(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,r,aw);return i.eyeCenterDistance=e.distance,i.centerIsOnSurface=!1,n!=null?(i.eyeCenterDistance=jr(e.eye,n),i.tiltAtCenter=mx(t.renderCoordsHelper,n,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=mx(t.renderCoordsHelper,e.center,e.eye):(BI(r9(s9,s),e.ray,aw),i.eyeCenterDistance=jr(e.eye,aw),i.tiltAtCenter=Jo(-xe(e.viewForward,Se(aw,aw)))),i.radius=s,i.eyeRadius=De(e.eye),i.constraints=t.state.constraints,i}function IF(t){return Math.abs(t)>1e-9}function T1t(t){const{constraints:e,eyeCenterDistance:i,tiltAtCenter:r}=t;let s=r,n=e.clampTilt(i,r);const o=Yre(t,n);if(e.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&IF(n-s);){const l=(s+n)/2,c=Yre(t,l);IF(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function Yre(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const i=Math.PI-$e(e,0,Math.PI),r=ug(t.radius/t.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*t.eyeRadius}return n*t.eyeRadius}function E1t(t,e){const i=ug(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=ug(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function C1t(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function M1t(t,e,i){if(e.interactionType===Ei.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=e;if(!r)return;const{min:n,max:o}=i,a=hhe(t,r,IC,e),l=a===0?0:mx(t.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,e.interactionType===Ei.TUMBLE?(OF(e.selection,Ss.ALTITUDE)&&Rke(t,r,i),c8(a,l,!0,s,yve,i)):c8(a,l,!1,s,yve,i)}function Rke(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const s=Ql(e.center),n=Math.sqrt(s),o=e.distance,a=$r(t.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,u=(l*l-o*o-s)/(-2*n*o),h=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-Jo(h),i.max)),i.max=Math.min(i.max,Math.PI-Jo(u))}const L1=M(),h5=Ne(),aw=M(),yve=Gt(5),A1t={min:0,max:0},R1t={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},Z$={eyeCenterDistance:0,requiresTwoSteps:!1},P1t=t=>t,z9=t=>t*t,dhe=t=>1-z9(1-t),O1t=t=>t<.5?z9(2*t)/2:(dhe(2*(t-.5))+1)/2,phe=t=>t*t*t,Pke=t=>1-phe(1-t),Oke=t=>t<.5?phe(2*t)/2:(Pke(2*(t-.5))+1)/2,fhe=t=>t*t*t*t,Ike=t=>1-fhe(1-t),I1t=t=>t<.5?fhe(2*t)/2:(Ike(2*(t-.5))+1)/2,mhe=t=>t*t*t*t*t,$ke=t=>1-mhe(1-t),$1t=t=>t<.5?mhe(2*t)/2:($ke(2*(t-.5))+1)/2,ghe=t=>1-Math.cos(t*Math.PI/2),Nke=t=>1-ghe(1-t),N1t=t=>t<.5?ghe(2*t)/2:(Nke(2*(t-.5))+1)/2,yhe=t=>2**(10*(t-1)),n4=t=>1-yhe(1-t),L1t=t=>t<.5?yhe(2*t)/2:(n4(2*(t-.5))+1)/2,_he=t=>-(Math.sqrt(1-t*t)-1),Lke=t=>1-_he(1-t),D1t=t=>t<.5?_he(2*t)/2:(Lke(2*(t-.5))+1)/2;function xf(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function Sf(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const F1t=Sf(xf(1),1),k1t=Sf(xf(1),0),Xre=Sf(xf(1),.5),U1t=Sf(xf(2),1),B1t=Sf(xf(2),0),z1t=Sf(xf(2),.5),V1t=Sf(xf(3),1),G1t=Sf(xf(3),0),j1t=Sf(xf(3),.5),H1t=Sf(xf(4),1),q1t=Sf(xf(4),0),W1t=Sf(xf(4),.5),Y1t={linear:P1t,"in-quad":z9,"out-quad":dhe,"in-out-quad":O1t,"in-coast-quad":F1t,"out-coast-quad":k1t,"in-out-coast-quad":Xre,"in-cubic":phe,"out-cubic":Pke,"in-out-cubic":Oke,"in-coast-cubic":U1t,"out-coast-cubic":B1t,"in-out-coast-cubic":z1t,"in-quart":fhe,"out-quart":Ike,"in-out-quart":I1t,"in-coast-quart":V1t,"out-coast-quart":G1t,"in-out-coast-quart":j1t,"in-quint":mhe,"out-quint":$ke,"in-out-quint":$1t,"in-coast-quint":H1t,"out-coast-quint":q1t,"in-out-coast-quint":W1t,"in-sine":ghe,"out-sine":Nke,"in-out-sine":N1t,"in-expo":yhe,"out-expo":n4,"in-out-expo":L1t,"in-circ":_he,"out-circ":Lke,"in-out-circ":D1t};function Ln(t,e,i=Q1t,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<K1t;a++){let l=0;for(const c of J1t)if(OF(i.selection,c.type)){const u=Math.abs(c.error(t,r,i));c.apply(t,r,i)&&(s=!0,l+=u)}if(l===0)break}const n=OF(i.selection,Ss.COLLISION),o=X1t(i.interactionType,t);return n&&XI(t,r,o)&&(s=!0),s&&r.computeUp(t.state.viewingMode),s}function X1t(t,e){switch(t){case Ei.PAN:return ef.EYE_AND_CENTER;case Ei.ASCEND:return e.state.isGlobal?ef.EYE_AND_CENTER_SCALE:ef.EYE_AND_CENTER;default:return ef.EYE}}function Rm(t){const e=Math.min(1,t/150);return Oke(e)}function Z1t(t,e,i){return hhe(t,e,i)*e.distance}const J1t=[{type:Ss.TILT,error:Z1t,apply:Ake},{type:Ss.ALTITUDE,error:lhe,apply:i1t},{type:Ss.DISTANCE,error:che,apply:h1t}],Q1t=new wf,K1t=5;let _ve=class{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(e){this.viewingMode=e,this.center=M(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=Fn(vve),this._fov=55,this._size=1}pixelsPerPanAtZoom(e){return this._size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this._size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/e}compareTo(e,i){if(this.viewingMode===Xe.Global){const n=(De(this.center)+De(e.center))/2;i.pan=Ij(this.center,e.center)*n}else i.pan=jr(this.center,e.center);let r=Math.abs(e._yaw-this._yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(e._pitch-this._pitch);i.rotate=Math.max(r,s),i.fov=e.fov-this.fov,i.sourceZoom=this._distance,i.targetZoom=e._distance}interpolate(e,i,r){this.viewingMode===Xe.Global?jat(e.center,i.center,r.pan,this.center):Br(this.center,e.center,i.center,r.pan),this._distance=isFinite(i.distance)?Wt(e.distance,i.distance+r.zoomOffset,r.zoom):e.distance,this._pitch=Wt(e.pitch,i.pitch,r.rotate);let s=e._yaw;const n=i._yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this._yaw=Wt(s,n,r.rotate),this._fov=Wt(e.fov,i.fov,r.fov)}copyFrom(e){ge(this.center,e.center),this._pitch=e.pitch,this._yaw=e.yaw,this._distance=e.distance,ge(this.direction,e.direction),this._size=e.size,this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,bve);ge(this.center,e.center),Me(Ka,e.center,e.eye),Ga(Ka,Ka,i),Ga(F1,e.up,i),this._distance=De(Ka),this._distance!==0&&(Ka[0]/=this._distance,Ka[1]/=this._distance,Ka[2]/=this._distance),this._pitch=this._eyeUpToPitch(Ka),this._yaw=ebt(Ka,F1),this._size=Math.sqrt(e.width*e.width+e.height*e.height),this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,bve);xC(i,i),this._axisAngleVec3(fG,this._pitch-Math.PI/2,vve,Ka),this._axisAngleVec3(_2,this._yaw,Ka,Ka),this._axisAngleVec3(fG,this._pitch-Math.PI/2,_2,F1),this._axisAngleVec3(_2,this._yaw,F1,F1),ce(Ka,Ka,this._distance),Ga(Ka,Ka,i),Ga(F1,F1,i),e.center=this.center,e.eye=Me(Ka,this.center,Ka),e.up=F1,e.fov=this._fov}_axisAngleVec3(e,i,r,s){const n=Math.cos(i),o=Math.sin(i);return ce(Bh,r,n),yt(ih,e,r),ce(ih,ih,o),ce(D1,e,(1-n)*xe(e,r)),Te(s,Te(s,Bh,ih),D1)}_lookAtOrientation(e,i=ps()){return this._upAtLookAt(e,D1),yt(Bh,this.direction,D1),Se(Bh,Bh),Bh[0]===0&&Bh[1]===0&&Bh[2]===0&&ge(Bh,fG),yt(ih,D1,Bh),Se(ih,ih),i[0]=Bh[0],i[1]=ih[0],i[2]=D1[0],i[3]=Bh[1],i[4]=ih[1],i[5]=D1[1],i[6]=Bh[2],i[7]=ih[2],i[8]=D1[2],i}_upAtLookAt(e,i){return this.viewingMode===Xe.Local?ge(i,_2):Se(i,e)}_eyeUpToPitch(e){return Math.PI-Ij(_2,e)}};function ebt(t,e){const i=tbt;return Math.abs(e[2])<.5?(ge(i,e),t[2]>0&&ce(i,i,-1)):ge(i,t),yt(ih,i,_2),Se(ih,ih),Ij(fG,ih,_2)}const Bh=M(),ih=M(),D1=M(),Ka=M(),F1=M(),tbt=M(),_2=bO,vve=qle,fG=Hle,bve=ps();let ibt=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};const u8={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let rbt=class Dke{constructor(e){this._createCamera=e,this.compared=new ibt,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:u8.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new Dke(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:u8.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>ba()}get hasFov(){return Math.abs(this.compared.fov)>ba()}get hasRotate(){return this.compared.rotate>ba()}},sbt=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}},nbt=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,s=0;const n=this.definition,o=this.segments.reduce((a,l)=>a||l.definition.hasZoom,!1);for(let a=0;a<this.segments.length;a++){const l=this.segments[a],c=l.definition;if(e<=l.time||a===this.segments.length-1){if(this.segmentInterpolateComponentsAt(l,l.time===0?0:e/l.time,i),n.hasPan&&!isNaN(i.pan)&&isFinite(n.compared.pan)?i.pan=(r+c.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate&&!isNaN(i.rotate)&&isFinite(n.compared.rotate)?i.rotate=(s+c.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1,o&&!isNaN(i.zoom)&&isFinite(c.compared.targetZoom)){const{sourceZoom:u,targetZoom:h}=c.compared,p=i.zoom*(h-u)+u,f=this.segments[0].definition.compared.sourceZoom,g=this.segments[this.segments.length-1].definition.compared.targetZoom,y=Math.abs(h-f)>Math.abs(u-f)?h:u;i.zoomOffset=y-g,i.zoom=(p-f)/(y-f)}else i.zoom=1;return i}e-=l.time,r+=c.compared.pan,s+=c.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r)}},zY=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const n=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=this.rotateTime??this.zoomTime??this.panTime??this.fovTime??0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:null}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:null}get fovTime(){return this.definition.hasFov?Math.abs(this.definition.compared.fov)/obt:null}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsFov(e){if(e===0)return this.definition.segmentStart;if(e===1)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:i,segmentEnd:r}=this.definition;return i+e*(r-i)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),i.zoom=this._interpolateComponentsZoom(e),i.pan=this._interpolateComponentsPan(e),i.rotate=this._interpolateComponentsRotate(e),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(e)}};const obt=Gt(90);function abt(t,e,i){const r=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function lbt(t,e,i){const r=1/e,s=Math.log(t.compared.sourceZoom*r),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function cbt(t,e,i){const r=e-t.compared.sourceZoom,s=1/r,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function ubt(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function hbt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function dbt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function pbt(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function fbt(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function mbt(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function gbt(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function ybt(t,e,i){const r=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*s*n*a+t.halfWindowSize*r*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function _bt(t,e,i){const r=e-t.compared.targetZoom,s=1/r,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function vbt(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function bbt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function wbt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function xbt(t){const e=t.compared.sourceZoom-t.compared.targetZoom;if(e===0)return t.compared.pan*t.halfWindowSize/(t.desiredPixelFlow*t.halfWindowPanAtZoom(t.compared.sourceZoom));const i=Math.LN2*t.compared.pan,r=e,s=t.halfWindowPanAtZoom(r),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*s);return t.compared.sourceZoom<=t.compared.targetZoom?n*(i-s):n*(i+s)}function Sbt(t,e){let i=Tbt(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?ubt:abt,a=s?hbt:lbt,l=s?dbt:cbt,c=n?vbt:gbt,u=n?bbt:ybt,h=n?wbt:_bt,p=S=>o(t,S,r)+pbt(t,S,r)+c(t,S,r),f=S=>a(t,S,r)+fbt(t,S,r)+u(t,S,r),g=S=>l(t,S,r)+mbt(t,S,r)+h(t,S,r);let y=p(i);const v=xbt(t);let b;const w=e.maximumIterations||20,x=e.maximumDistance!=null?e.maximumDistance:1/0;for(b=0;b<w;b++){const S=e.desiredSlope??1e-6;let E=f(i);Math.abs(E)>S&&(E+=S);const C=E/g(i);if(isNaN(C)||i>=x&&C<0){if(!isFinite(x))return null;i=x,y=p(i);break}if(i-=C,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const R=p(i);if(Math.abs(R-y)/y<=.005)break;y=R}return y>v*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function Tbt(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let Ebt=class extends nbt{constructor(e,i){super(),this._preallocSegments=[new zY,new zY,new zY],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const r=i?.apex?Sbt(e,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r?this._updateWithApex(r,i?.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=dhe(r.zoom):e===this._descensionSegment&&(r.zoom=z9(r.zoom))}_updateWithApex(e,i){const[r,s,n]=this._preallocSegments,o=i?.ascensionFactor??.5,a=Math.min(1-o,i?.ascensionFactor!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.definition.segmentEnd=o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.definition.segmentStart=r.definition.segmentEnd,s.definition.segmentEnd=r.definition.segmentEnd+l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.definition.segmentStart=o+l,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const Cbt=new sbt;let Mbt=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=0,this._easing=Xre,this.definition=new rbt(e),this.path=new Ebt}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings($Ae(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing??(this._time>=1e3?Xre:n4)}cameraAt(e,i){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,Cbt);i.interpolate(this.definition.source,this.definition.target,r)}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1,s=i.minDuration??u8.minDuration/r,n=i.maxDuration??u8.maxDuration/r;return e=i.duration!=null?i.duration:Math.min(Math.max(e/r,s),n)}},Abt=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new Mbt(()=>new _ve(e)),this._current=new _ve(e)}update(e,i,r){const{source:s,target:n}=this._animation.definition,o=Me(Rbt,i.center,e.center),a=De(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ge(s.direction,o),ge(n.direction,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){return this._animation.cameraAt(e,this._current),i=i||new Kr,this._current.copyToRenderCamera(i),i}step(e,i){return this.finished||(this.currentTime=this.currentTime+$Ae(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};const Rbt=M();var Ns;(function(t){t[t.Ready=0]="Ready",t[t.Rejected=1]="Rejected",t[t.Running=2]="Running",t[t.Stopped=3]="Stopped",t[t.Finished=4]="Finished"})(Ns||(Ns={}));let av=class extends Fe{constructor(e){super(e),this.state=Ns.Ready}get active(){return this.state===Ns.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Ns.Stopped,!0)}finishController(){this.state=Ns.Finished}get steppingFinished(){return!1}};d([m({constructOnly:!0})],av.prototype,"view",void 0),d([m({readOnly:!0})],av.prototype,"active",null),d([m()],av.prototype,"state",void 0),d([m({readOnly:!0})],av.prototype,"isInteractive",null),av=d([N("esri.views.3d.state.controllers.CameraController")],av);let $F=class extends av{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Yi()),this._asyncResult=null),this.state===Ns.Finished||this.state===Ns.Stopped?(aq(e),this.state===Ns.Finished?e.resolve():e.reject(Yi())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Ns.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==Ns.Ready&&this.state!==Ns.Running||(this.viewAnimation.state===qO.State.FINISHED?this.finish():this.viewAnimation.state===qO.State.STOPPED&&(this.state=Ns.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===Ns.Finished?this.viewAnimation.finish():this.state===Ns.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Ns.Finished?this._asyncResult.resolve():this._asyncResult.reject(Yi()))}finish(){this.finishController()}};$F=d([N("esri.views.3d.state.controllers.AnimationController")],$F);let wv=class extends $F{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new Abt(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new qO}get isInteractive(){return this.mode==="interaction"}begin(e,i){this._hasTarget=!0;const r=this.animationSettings(i);d5.copyFrom(this.view.state.camera);const s=pf(this.view.state.viewingMode);this.intersectionHelper.intersectRay(d5.ray,s,wve)&&(d5.center=wve),this.animation.update(d5,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,i){this._hasTarget&&this.animation.step(e,i)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?Y1t[e.easing]:e.easing}}};d([m({constructOnly:!0})],wv.prototype,"mode",void 0),d([m({readOnly:!0})],wv.prototype,"isInteractive",null),wv=d([N("esri.views.3d.state.controllers.PointToPointAnimationController")],wv);const d5=new Kr,wve=M();function V9(t=Obt){return[t[0],t[1],t[2],t[3]]}function NF(t,e){return Pbt(t[0],t[1],t[2],e,Rce.get())}function Pbt(t,e,i,r,s=V9()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function vhe(t,e,i){return yt(i,t,e),Se(i,i),i[3]=Lce(t,e),i}const Obt=[0,0,1,0];function Hmi(t,e,i=jo()){return bhe(t,$m(e),i),Se(i.direction,i.direction),i}function bhe(t,e,i){return Ibt(t,t.screenToRender(e,tt.get()),i)}function Ibt(t,e,i){const r=Cl(tt.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const s=Cl(tt.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,tt.get());return n==null?null:(Me(i.direction,n,i.origin),i)}function ZI(t,e,i){return whe(t,t.screenToRender(e,tt.get()),i)}function whe(t,e,i){ge(i.origin,t.eye);const r=ue(tt.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(r,tt.get());return s==null?null:(Me(i.direction,s,i.origin),i)}function xhe(t,e,i,r){const s=ZI(e,i,$bt);return Lx(t,s,r)}const $bt=jo();var JO;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(JO||(JO={}));const Fke=30,h8=[1,3e8],G9=80,kke=8,Uke=200,Bke=1508e5,zke=5,Vke=50,Nbt=5,Lbt=10,VY=90,$C={exclude:new Set([cx])};function cE(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function Zre(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function gx(t,e,i){const r=Ph(Pce.get(),i[3],i);r==null||GPe(r,us)||(Me(Ur,t.eye,e),nt(Ur,Ur,r),t.eye=Te(Ur,Ur,e),Me(Ur,t.center,e),nt(Ur,Ur,r),t.center=Te(Ur,Ur,e),t.up=nt(Ur,t.up,r))}function Dbt(t,e,i,r){return vC(t,bhe(e,i,Ehe),r)}function Jre(t,e,i,r){return vC(t,ZI(e,i,Ehe),r)}function She(t,e,i,r){const s=tt.get();let n=1-i;Me(s,e,t.eye);const o=De(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(ce(s,s,n),t.eye=Te(Ur,t.eye,s),t.center=Br(Ur,t.center,e,n))}function Gke(t,e,i){e.getScreenCenter(xve),xhe(t,e,xve,Ur)&&(e.center=Ur);const r=e.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=ce(tt.get(),e.viewForward,s);e.eye=Me(Ur,e.center,n)}const xve=Hs();function GY(t,e){ue(e,0,0,0);for(const i of t)Te(e,e,i);ce(e,e,1/t.length)}function mG(t,e,i,r){return Math.sin(t/De(e))*(i+r.radius)}function Sve(t,e,i,r){return mG(Math.PI/2,e,i,r)+(t-Math.PI/2)}var gl;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(gl||(gl={}));const Tve={Elevation:3e4,Angle:Gt(16)},p5={Pole:.95,Angle:Gt(18),Tilt:45},jke=Gt(80);function Hke(t,e,i,r,s,n){const o=M(),a=Bn();let l=!0,c=!0;return t.intersectScreen(i,o,n)?a[3]=De(o):(c=!1,e.aboveGround&&s!==JO.Ellipsoid?a[3]=Math.max(De(e.center),.9*r.radius):a[3]=De(e.eye)-e.relativeElevation,s===JO.Silhouette?LF(a,e,i,o):l=xhe(a,e,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function o4(t,e,i,r){const s=t.relativeElevation;if(s>Tve.Elevation&&r==="global")return gl.Horizontal;ZI(t,e,HY);const n=Math.sign(s),o=i.worldUpAtPosition(t.eye,Ur);return-n*xe(o,HY.direction)<Math.sin(Tve.Angle)*De(HY.direction)?gl.Vertical:gl.Horizontal}function qke(t,e,i){Me(jY,i,e),t.eye=Me(Ur,t.eye,jY),t.center=Me(Ur,t.center,jY)}const jY=M();function LF(t,e,i,r){const s=ZI(e,i,Ehe);return s!=null&&(BI(t,s,f5),Lx(t,s,r)?!(Xo(f5,s.origin)<Xo(r,s.origin))||(ge(r,f5),!1):(Me(yM,e.eye,e.center),Se(yM,yM),o3e(yM,-xe(Se(yM,yM),f5),Eve),vC(Eve,s,r),!1))}const f5=M(),yM=M(),Eve=mr();function Wke(t,e,i,r,s,n){let o=0;if(yt(f8,t,e),Me(_5,t,e),De(t)<=s||!r.aboveGround){yt(i,_5,r.eye);const a=xe(t,e)/(De(t)*De(e));if(a<.9999)o=Jo(a);else{const c=De(yt(M(),t,e))/(De(t)*De(e));o=ug(c)}const l=Math.cos($e(ix.normalize(Gt(n)),0,jke));o=-o-Math.max(0,De(e)-s)/(l*s)}else Me(Cve,r.eye,r.center),yt(i,_5,Cve),o=-De(_5)/s;return Se(i,i),ce(i,i,De(f8)),o}const Cve=M();function Mve(t,e,i,r){let s,n;const o=Math.cos($e(ix.normalize(Gt(r)),0,jke));return s=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):Jo(e/i),n=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):Jo(t/i),(n-s)*i}function Fbt(t,e,i,r,s,n,o,a,l,c){const u=Mve(t[2],e[2],n[3],a),h=l?Mve(t[0],e[0],n[3],180):e[0]-t[0],p=Math.sin(o)*h-Math.cos(o)*u,f=Math.cos(o)*h+Math.sin(o)*u;Se(Ur,s);const g=l?p/Math.sqrt(Math.abs(n[3]**2-xe(i,Ur)**2)):p/n[3],y=f/Math.sqrt(Math.abs(n[3]**2-xe(i,r)**2));Gi(c,g,y)}function Yke(t,e,i,r,s,n,o,a,l,c){yt(f8,t,e),Zee(n.up,n.eye,m5,g5,y5),Zee([0,0,1],n.eye,Iv,Bw,Qke),ge(i,Bw),ge(r,Iv),Se(i,i),ce(i,i,De(f8)),Xye(t,Se(g5,g5),Se(y5,y5),Se(m5,m5),Ave),Xye(e,g5,y5,m5,Rve),Fbt(Ave,Rve,t,Iv,Bw,o,a,l,c,s)}function kbt(t,e,i,r,s,n,o){Ph(d8,s,r),Ph(p8,o,n),Or(WR,d8,p8),Me(e,t,i),nt(e,e,WR),Te(e,e,i)}function Xke(t,e,i,r,s,n){Ph(d8,r,i),Ph(p8,n,s),Or(WR,d8,p8),Me(Ur,t.eye,e),nt(Ur,Ur,WR),t.eye=Te(Ur,Ur,e),Me(Ur,t.center,e),nt(Ur,Ur,WR),t.center=Te(Ur,Ur,e),Me(Ur,t.up,e),nt(Ur,Ur,WR),t.up=Te(Ur,Ur,e)}function The(t,e,i,r,s,n){return(Math.abs(r)>Math.PI-p5.Angle||Math.abs(r)<p5.Angle)&&(Math.abs(t[2])<i*p5.Pole||Math.abs(e)>i)&&n.aboveGround&&s<p5.Tilt}function Zke(t,e,i,r,s,n){if(n)vhe(i,r,Pve),gx(e,t,Pve);else{const o=Wke(i,r,Ove,e,t[3],s);gx(e,t,NF(Ove,o))}}function Jke(t,e,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,u;ge(_S,r),v5.copyFrom(e);for(let h=0;h<a&&Xo(i,_S)>l&&(c=Xo(i,_S),Yke(i,_S,Bw,Iv,J$,v5,t,s,n,o),Xke(v5,t,Iv,J$[1],Bw,J$[0]),kbt(_S,_S,t,Iv,J$[1],Bw,J$[0]),u=Xo(i,_S),u<c||h===0);h++)e.copyFrom(v5)}function Ubt(t,e,i,r,s,n,o){The(i,xe(e.up,i),t[3],-ix.normalize(Gt(s)),n,e)?Jke(t,e,i,r,-ix.normalize(Gt(s)),n,o):Zke(t,e,i,r,n,o)}function Bbt(t,e,i,r,s,n){const{eye:o}=t;Zee([0,0,1],o,Iv,Bw,Qke);const a=e.translation[0]*i.pan,l=s.mode==="zoom"?0:e.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-xe(t.center,Iv)**2/De(t.center)**2)),.5),u=(Math.sin(n)*l+Math.cos(n)*a)/c,h=-Math.cos(n)*l+Math.sin(n)*a;switch(bh(r.pan.matrix,r.pan.matrix,u,Iv),r.pan.enabled=!0,s.mode){case"pan":bh(r.pan.matrix,r.pan.matrix,h,Bw),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function zbt(t,e,i,r,s){const{eye:n,viewRight:o}=t,a=yt(tt.get(),o,n),l=e.translation[0]*i.pan;switch(l!==0&&(bh(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*i.pan;c!==0&&(bh(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function Vbt(t,e,i,r,s,n,o,a,l){The(t.center,xe(t.up,t.center),De(t.center),-ix.normalize(Gt(n)),o,e)?Bbt(e,i,r,a,l,-ix.normalize(Gt(s))):zbt(e,i,r,a,l)}const Iv=M(),Bw=M(),Qke=M(),m5=M(),g5=M(),y5=M(),Ave=M(),Rve=M(),J$=vt(),Pve=V9(),d8=Ne(),p8=Ne(),WR=Ne(),_S=M(),Ur=M(),_5=M(),v5=new Kr,f8=M(),Ove=M(),Ehe={origin:M(),direction:M()},HY={origin:M(),direction:M()},Ive=.6,qY=4,Gbt=60;let m8=class extends wv{constructor(){super(...arguments),this._zoomLocation=M(),this._tmpCamera=new Kr,this._tmpViewDir=M(),this._tmpRayDir={origin:M(),direction:M()},this._targetOnSphere=M(),this._tmpCenter=M(),this._beginCamera=new Kr,this._constraintOptions=new wf(Ss.ALL_EXCEPT_COLLISION,Ei.ZOOM,null,this._beginCamera),this._sphere=Bn()}initialize(){this._intersector=pf(this.view.state.viewingMode)}zoomStep(e,i){if(!this.active)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera);let s=!1,n=!1;this.intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?$C:{})&&(s=e>0,n=!0),this._tmpCamera.copyFrom(r.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ge(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,i,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:n4}}_updateCamera(e,i,r,s,n){const o=o4(e,s,this.view.renderCoordsHelper,this.view.viewingMode),a=Math.abs(this.view.camera.position.z);Se(w5,e.eye),ce(w5,w5,-1),ZI(e,s,this._tmpRayDir),Se(this._tmpRayDir.direction,this._tmpRayDir.direction);const l=$e(Math.min(kke,1/Math.abs(xe(w5,this._tmpRayDir.direction)))*a,Uke,Bke);if(o===gl.Horizontal){let c=Ive**i;this._sphere[3]=De(r),Me(this._tmpViewDir,e.center,e.eye);const u=Math.min(De(this._tmpViewDir),l);let h=u*c;if(c<=1&&h<qY&&(h=qY,c=h/u),Math.abs(u-h)<1e-6)return;const p=De(e.center);if(this._sphere[3]!==p){const f=this._sphere[3]+c*(p-this._sphere[3]);e.center=ce(b5,e.center,f/p)}ce(this._tmpViewDir,this._tmpViewDir,-c),e.eye=Te(b5,e.center,this._tmpViewDir),Ln(this.view,e,this._constraintOptions),Xo(r,e.center)>1e-12&&xhe(this._sphere,e,s,this._targetOnSphere)&&Ubt(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=Ive**Math.abs(i);const u=i>0?1:-1;Me(this._tmpViewDir,r,e.eye);const h=De(this._tmpViewDir),p=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,Gbt);let f=p??l;f=n&&i>0?Math.min(f,h):f,ce(this._tmpRayDir.direction,this._tmpRayDir.direction,f),Te(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let g=f*c;const y=Math.max(qY,1.01*e.nearFar[0]);if(i>0&&g<y&&(g=y,c=g/f),Math.abs(f-g)<1e-6)return;ce(this._tmpRayDir.direction,this._tmpRayDir.direction,u*(1-c)),e.eye=Te(b5,e.eye,this._tmpRayDir.direction),e.center=Te(b5,e.center,this._tmpRayDir.direction)}XI(this.view,e)}};m8=d([N("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],m8);const b5=M(),w5=M();let gG,yG=null;const VP=new Map;async function Wmi(t){yG==null&&(gG==null&&(gG=ye(()=>import("./VoxelWasmPerSceneView-237570bb.js"),[],import.meta.url)),yG=await gG);const e=t.view;let i=VP.get(e);return i||(i=new yG.default({view:e}),VP.set(e,i)),i.addVoxelLayer(t)}function DF(t){return VP.get(t)}function Ymi(t){const e=t.view,i=VP.get(e);i&&i.removeVoxelLayer(t)<1&&(VP.delete(e),VP.size===0&&(gG=null,yG=null))}const jbt=.6,Hbt=4,qbt=60;let g8=class extends wv{constructor(){super(...arguments),this._zoomLocation=M(),this._tmpCamera=new Kr,this._tmpRayDir=M(),this._tmpCenter=M(),this._beginCamera=new Kr,this._constraintOptions=new wf(Ss.ALL,Ei.ZOOM,null,this._beginCamera)}zoomStep(e,i){if(!this.active)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(r.camera);const s=pf(this.view.state.viewingMode);let n=!1;e>0?(n=this.intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.map.ground.opacity===0?$C:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ge(this._zoomLocation,this._tmpCamera.center);const o=jbt**e;let a=this.view._stage.renderView.getMinimalDepthForArea(DF(this.view),i[0],i[1],this.view.state.camera,qbt);Me(x5,this._tmpCamera.eye,this._zoomLocation),Se(x5,x5);const l=$e(Math.min(kke,1/Math.abs(xe(Wbt,x5)))*Math.abs(this.view.camera.position.z),Uke,Bke);if(a=a??l,a){const c=M();Me(c,this._zoomLocation,this._tmpCamera.eye),(a<De(c)||!n)&&(Se(c,c),Te(this._zoomLocation,this._tmpCamera.eye,ce(c,c,a)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:n4}}_updateCamera(e,i,r){Me(this._tmpRayDir,r,e.eye);const s=De(this._tmpRayDir);let n=s*i;const o=i<=1,a=Math.max(Hbt,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,i=n/s),Math.abs(s-n)<1e-6||(ce(this._tmpRayDir,this._tmpRayDir,i),e.eye=Me($ve,r,this._tmpRayDir),e.center=Br($ve,e.center,r,1-i),Ln(this.view,e,this._constraintOptions)))}};g8=d([N("esri.views.3d.state.controllers.ZoomStepControllerLocal")],g8);const $ve=M(),Wbt=Be(0,0,1),x5=M();function Ybt(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function Che(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let Xbt=class extends Ja{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(Ybt(i,"primary")){const r=this._view.state.isGlobal?new m8({view:this._view,mode:"animation"}):new g8({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Hs(i.x,i.y)),e.stopPropagation()}}};function Zbt(t,e,i){return t===Xe.Global?new Qbt(i):new Jbt(e,i)}let Jbt=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=$r(i),this._unitInMeters=Xc(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,s,n){n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=this._elevationProvider?.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(r=r??new lr({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},h=Math.max(u.x,u.y,u.z);Me(vS,i,e),_M[0]=vS[0]>0?r.xmax:r.xmin,_M[1]=vS[1]>0?r.ymax:r.ymin,_M[2]=vS[2]>0?h/2:-h/2,Me(_M,_M,e),Se(vS,vS);const p=1.1*xe(_M,vS)*this._unitInMeters,f=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),y=g*twt*this._unitInMeters,v=g*iwt*this._unitInMeters,b=$e((o-v)/(y-v),0,1)**3,w=Math.min(Wt(f,p,b),f)*Math.max(Math.log(Math.abs(l)),1);return Kke(Math.min(w,Math.max(34064e4,h))/this._unitInMeters,Kbt,this._unitInMeters,n)}},Qbt=class{constructor(e){this._referenceEllipsoid=$r(e)}compute(e,i,r,s,n){n||(n={near:0,far:0});const o=De(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),u=Math.max(c,Math.abs(a)),h=Math.sqrt(u*(u+2*l)),p=o+this._referenceEllipsoid.radius;return Kke(1.2*Wt(h,p,Nue(u)),$e(2e4-(Math.log(u)-7.983)/9.011*19900,100,2e4),1,n)}};function Kke(t,e,i,r){const s=ewt/i;return t/e>s?(r.far=t,r.near=r.far/e):(r.near=s,r.far=r.near*e),r}const Kbt=2e4,ewt=2,twt=.001,iwt=1e-4,_M=M(),vS=M();let _G=class extends Fe{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const i=this.view.state.camera;e.spatialReference!=null&&yNe(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>XI(this.view,e,ef.EYE_AND_CENTER))}};d([m({constructOnly:!0})],_G.prototype,"view",void 0),_G=d([N("esri.views.3d.state.SurfaceCollisionConstraint")],_G);let WN=class extends Fe{constructor(e){super(e),this.nearFarHeuristic=Zbt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([_e(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),_e(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),_e(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Mr),_e(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),Mr),_e(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),Mr),_e(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),Mr),_e(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),Mr),_e(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),Mr)]),this.view.state.isLocal&&this.addHandles(_e(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Ir)),this._updateNearFar(),this.view.state.viewingMode!==Xe.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new _G({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints?.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>Nve(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const i=this.view.constraints&&this.view.constraints.clipDistance;(i?i.mode:"auto")==="manual"?Nve(e,i):this._updateCameraNearFarAuto(e,i)}_updateCameraNearFarAuto(e,i){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,f9(this.view,e.eye),e),i&&i.autoUpdate(e.near,e.far)}_updateCollision(){const e=this.view.map?.ground?.navigationConstraint?.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;if(i!==r.enabled){r.enabled=i,i&&this._reapplyConstraints(Ss.COLLISION);const s=this.view.constraints&&this.view.constraints.tilt;s&&s.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Xe.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(Gt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(El(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,s=3*i/Math.atan(r.camera.fov/2);s!==r.constraints.distance&&(r.constraints.distance=s)}_reapplyConstraints(e=Ss.ALL){this.view.state.updateCamera(i=>Ln(this.view,i,new wf(e,Ei.NONE,null)))}};function Nve(t,e){e&&(t.near=e.near,t.far=e.far)}d([m({constructOnly:!0})],WN.prototype,"view",void 0),d([m({readOnly:!0})],WN.prototype,"surfaceCollisionConstraint",void 0),WN=d([N("esri.views.3d.state.ConstraintsManager")],WN);let Sw=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=RF(),this._points=SFe(),this.lines=new Array(12),this._origin=M(),this._direction=M(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:M(),endpoint:null}}update(e){TFe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ge(this._origin,e.eye),ge(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)ge(this._points[i],e[i]);EFe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return xw(this.frustum,e)}intersectsRay(e){return E0t(this.frustum,e)}intersectsLineSegment(e,i){return C0t(this.frustum,e,i)}intersectsPoint(e){return CFe(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;WY(this.lines[i],e[i],e[r]),WY(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),WY(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}};function WY(t,e,i){t.origin=e,t.endpoint=i,Kv(t.direction,e,i)}Sw.planePointIndices=M0t,Sw.nearFarLineIndices=[[St.NEAR_BOTTOM_LEFT,St.FAR_BOTTOM_LEFT],[St.NEAR_BOTTOM_RIGHT,St.FAR_BOTTOM_RIGHT],[St.NEAR_TOP_RIGHT,St.FAR_TOP_RIGHT],[St.NEAR_TOP_LEFT,St.FAR_TOP_LEFT]];let yD=class extends av{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Ns.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||yNe(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),XI(this.view,e,ef.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Ns.Stopped)})}};d([m({constructOnly:!0})],yD.prototype,"desiredCamera",null),yD=d([N("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],yD);const rwt=.66;function e4e(t){return 360-fce.normalize(t)}function j9(t){return fce.normalize(360-t)}function t4e(t,e,i){const r=e.camera;if(r!=null)return swt(r,kx(t));const{targetGeometry:s}=e;if(s==null)return null;const{camera:n,mode:o}=r4e(t,e.rotation,i);if(s.type==="point")return owt(t,e,s,n,o);const a=s.extent;return a==null?null:IV(t,a,n.heading,n.tilt,o)}async function i4e(t,e,i,r){const s=e.camera;if(s!=null)return nwt(s,kx(t),r);const{targetGeometry:n}=e;if(n==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=r4e(t,e.rotation,i);if(n.type==="point")return awt(t,e,n,o,a,r);const l=n.extent;if(l==null)throw new Error("Target geometry has no extent!");return jNe(t,l,o.heading,o.tilt,a,r)}function swt(t,e){const i=t.position;let r;try{r=nx(i,e)}catch{return null}if(!r)return null;const s=t.clone();return s.position=r.clone(),s}async function nwt(t,e,i){const r=t.position,s=await ox(r,e,{signal:i});zt(i);const n=t.clone();return n.position=s.clone(),n}function r4e(t,e,i){const r=GO(t,t.state.camera);let s=vl.ADJUST;return e!=null&&(r.heading=e4e(e),s=vl.LOCKED),i!=null&&(r.tilt=i),{camera:r,mode:s}}function owt(t,e,i,r,s){const n=t.spatialReference;let o;try{o=nx(i.clone(),n)}catch{return null}if(!o)return null;const a=e.scale!=null?m9(t,e.scale,o.latitude):t.state.camera.distance;return ydt(t,o,a,r,s)}async function awt(t,e,i,r,s,n){const o=t.spatialReference,a=await ox(i.clone(),o,{signal:n});zt(n);const l=e.scale!=null?m9(t,e.scale,a.latitude):t.state.camera.distance;return $Ne(t,a,l,r,s,n)}function s4e(t,e,i=null){return i==null&&(i=new dg),Ahe(t,null,e.clone(),i)}async function n4e(t,e,i){const r=ywt(t,e);if(!r)throw new j("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new Wd({fov:t.camera.fov}),n=new dg({camera:s});if(r.target instanceof dg)return bS(await uwt(t,r.target,r,i,n));if(r.target instanceof Wd)return bS(await a4e(t,r.target,i,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof lr){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return bS(o||c?await Qre(t,r,r.target.center,s,i,n):await fwt(t,r,r.target,s,i,n))}const a=new vwt,l=o?lwt(t,r):void 0;if(await o4e(t,r.target,l,a,i),isFinite(a.boundingBox[0])){let c;if(Vm(a.boundingBox,xn),md.x=xn[0],md.y=xn[1],md.z=xn[2],md.spatialReference=t.spatialReference,isFinite(md.z)&&a.hasZ?c=Sue(a.boundingBox):(md.z=void 0,c=Qtt(xue(a.boundingBox,bwt))),o||c)return bS(await Qre(t,r,md,s,i,n));const u=_wt(t,a.screenSpaceObjects);return bS(await gwt(t,r,md,a.boundingBox,u,s,i,n))}return r.position?bS(await dwt(t,r,s,n,i)):bS(await pwt(t,r,s,i,n))}function Mhe(t,e){return e.scale==null&&e.zoom!=null?XNe(t,e.zoom):e.scale}function lwt(t,e){const i=Mhe(t,e);return i?Qlt(i):void 0}function H9(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=e4e(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function Ahe(t,e,i,r){const s=t.spatialReference||Je.WGS84;if(e??=K_(t,i),e==null)return r;const n=new $t({spatialReference:s});if(!Fx(e.center,t.renderSpatialReference,n))return r;r.targetGeometry=n;const{latitude:o}=n;return r.scale=o!=null?ux(t,e.distance,o):ZNe(t,e),r.rotation=j9(i.heading),r.camera=i,r}async function y8(t,e,i,r){const s=()=>new j("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw s();e.type==="mesh"&&(e=e.extent);const n=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let h;switch(e.type){case"point":h=e;break;case"multipoint":case"polyline":h=e.extent?.center;break;case"extent":h=e.center;break;case"polygon":h=e.centroid}h!=null&&n&&t.elevationProvider?(h=await ox(h,n,{signal:r}),xn[2]=Wy(t.elevationProvider,h)??0):xn[2]=0}const o=wwt[e.type],a=new Array;if(o(e,e.hasZ?h=>{a.push([h[0],h[1],h[2]])}:h=>{a.push([h[0],h[1]])},xn),a.length===0)throw s();const l=e.spatialReference,c=t.spatialReference,u=await ox(new PI({spatialReference:l,hasZ:e.hasZ,hasM:!1,points:a}),c,{signal:r});if(e.hasZ&&(i.hasZ=!0),e.hasZ)for(const[h,p,f]of u.points)xn[0]=h,xn[1]=p,xn[2]=f,pg(i.boundingBox,xn);else for(const[h,p]of u.points)xn[0]=h,xn[1]=p,pg(i.boundingBox,xn)}async function cwt(t,e,i,r,s){const n=await jd(t.whenViewForGraphic(e));if(n.ok===!1||n.value==null||!("whenGraphicBounds"in n.value))return void await y8(t,e.geometry,r,s);const o=n.value,a=await jd(o.whenGraphicBounds(e,{minDemResolution:i}));if(a.ok===!1||!a.value)return void await y8(t,e.geometry,r,s);const{screenSpaceObjects:l,boundingBox:c}=a.value;HO(r.boundingBox,c),l&&l.forEach(u=>{r.screenSpaceObjects.push(u)}),isFinite(c[2])&&(r.hasZ=!0)}async function o4e(t,e,i,r,s){if(Array.isArray(e)&&e.length===2){const n=e[0],o=e[1];if(typeof n=="number"&&typeof o=="number")return md.x=n,md.y=o,md.z=void 0,md.spatialReference=t.spatialReference?.isGeographic?t.spatialReference:Je.WGS84,void await y8(t,md,r,s)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(n=>o4e(t,n,i,r,s))):e instanceof Px?await y8(t,e,r,s):e instanceof fg&&await cwt(t,e,i,r,s)}async function uwt(t,e,i,r,s){if(e.camera)return a4e(t,e.camera,r,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=j9(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=Mhe(t,i);return n!=null&&(s.scale=n),s.camera=await i4e(t,s,i.tilt,r),s}async function a4e(t,e,i,r){const s=t.spatialReference,n=await ox(e.position,s,{signal:i}),o=e.clone();return o.position=n,Ahe(t,null,o,r)}async function hwt(t,e,i,r,s,n,o){const a=t.renderSpatialReference;return await Rj(e,YY,a,0,{signal:o}),await Rj(i,T5,a,0,{signal:o}),n.targetGeometry=new $t(e),s.position=new $t(i),Me(_8,YY,T5),g9(t,T5,_8,r.up,s),n.scale=ux(t,jr(T5,YY),n.targetGeometry.latitude),n.rotation=j9(s.heading),n.camera=s,n}async function Qre(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=SC(t);if(e.position)return hwt(t,n.targetGeometry,e.position,o,r,n,s);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=ce(xn,o.viewForward,-l);o.eye=Te(xn,o.center,c),n.scale=ux(t,l,i.latitude)}GO(t,o,r);const a=H9(r,e)?vl.LOCKED:vl.ADJUST;if(!e.zoomFactor){const l=Mhe(t,e);l==null?(await Rj(i,xn,t.renderSpatialReference,0,{signal:s}),CFe(o.frustum,xn)?n.scale=ux(t,jr(o.eye,xn),i.latitude):n.scale=ZNe(t,o)):n.scale=l,n.camera=await INe(t,n.targetGeometry,n.scale,r,a,s)}return n}async function dwt(t,e,i,r,s){const n=SC(t);ge(_8,n.viewForward),g9(t,n.eye,_8,n.up,XY);const o=t.spatialReference,{position:a}=e;if(a){const l=await ox(a,o,{signal:s});i.position=l}else i.position=new $t;return i.heading=e.heading!=null?e.heading:XY.heading,i.tilt=e.tilt!=null?e.tilt:XY.tilt,Ahe(t,null,i,r)}async function pwt(t,e,i,r,s){if(e.heading!=null||e.rotation!=null||e.scale!=null||e.tilt!=null||e.zoom!=null||e.zoomFactor!=null){const n=SC(t),{spatialReference:o,renderSpatialReference:a}=t,l=new $t({spatialReference:o});return Fx(n.center,a,l)?Qre(t,e,l,i,r,s):s}return s.scale=t.scale,s.camera=t.camera.clone(),H9(s.camera,e),s}async function fwt(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=SC(t);GO(t,o,r);const a=H9(r,e)?vl.LOCKED:vl.ADJUST;return n.camera=await jNe(t,i,r.heading,r.tilt,a,s),n}function mwt(t,e,i,r,s){let n=0;i.z!=null?n=i.z:t.basemapTerrain&&t.elevationProvider&&(n=Wy(t.elevationProvider,i)),ue(xn,i.x,i.y,n),Bd(t.spatialReference,xn,Lve,t.renderSpatialReference),vf(S5,Lve),xC(S5,S5),hs(Q$);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const y=o[g];let v=r[y[2]];isFinite(v)||(v=n),ue(xn,r[y[0]],r[y[1]],v),wa(xn,t.spatialReference,xn,t.renderSpatialReference),pg(Q$,Ga(xn,xn,S5))}const a=TC(Q$),l=zx(Q$),c=EC(Q$),u=1/Math.tan(e.fovX/2),h=1/Math.tan(e.fovY/2),p=.5*Math.sqrt(a*a+c*c)*Math.max(h,u)+.5*l,f=.5*l*h+.5*Math.max(a,c);return Math.max(p,f)/s}async function gwt(t,e,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=SC(t),c=mwt(t,l,i,r,s);GO(t,l,n);const u=H9(n,e)?vl.LOCKED:vl.ADJUST;return a.scale=ux(t,c,a.targetGeometry.latitude),a.camera=await INe(t,a.targetGeometry,a.scale,n,u,o),a}function ywt(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};return"declaredClass"in e||Array.isArray(e)?i.target=e:(Object.assign(i,e),!i.target&&"center"in e&&e.center&&(i.target=e.center)),i}function bS(t){return t?.camera!=null&&(t.rotation=j9(t.camera.heading)),t}function _wt(t,e){const i=rwt;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(t.width,t.height)*2}class vwt{constructor(){this.hasZ=!1,this.boundingBox=hs(),this.screenSpaceObjects=new Array}}const xn=M(),Lve=Ne(),S5=ps(),Q$=Oo(),bwt=li(),_8=M(),T5=M(),YY=M(),XY={heading:0,tilt:0},md=new $t,wwt={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},multipoint(t,e,i){const r=t.points,s=t.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(ue(i,t.xmin,t.ymin,t.zmin)),e(ue(i,t.xmax,t.ymin,t.zmin)),e(ue(i,t.xmin,t.ymax,t.zmin)),e(ue(i,t.xmax,t.ymax,t.zmin)),e(ue(i,t.xmin,t.ymin,t.zmax)),e(ue(i,t.xmax,t.ymin,t.zmax)),e(ue(i,t.xmin,t.ymax,t.zmax)),e(ue(i,t.xmax,t.ymax,t.zmax))):(e(ue(i,t.xmin,t.ymin,i[2])),e(ue(i,t.xmax,t.ymin,i[2])),e(ue(i,t.xmin,t.ymax,i[2])),e(ue(i,t.xmax,t.ymax,i[2])))}},xwt=Object.freeze(Object.defineProperty({__proto__:null,create:n4e,fromCamera:s4e,toCameraAsync:i4e,toCameraSync:t4e},Symbol.toStringTag,{value:"Module"}));let Swt=class{constructor(e,i,r){this._target=e,this._options=i,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this._options.signal!=null&&oo(this._options.signal,()=>{this.abort()}),this._abortController=o,this._waitForReady()})}_resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}_reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this._reject(Yi())}async _waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await SO(()=>this.view.ready,this._abortController.signal)}catch(e){return this._reject(e)}this._createViewPoint()}async _createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this._options.animate?this._getAnimationController():null;try{const e=await n4e(this.view,this._target,this._abortController.signal);if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(i==null)return;if(this._options.animate){if(this._animationController==null)return;this._startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this._resolve()}catch(e){this._reject(e)}}}_getCameraFromViewpoint(e){const i=!!(this._target instanceof dg&&this._target.camera||this._target instanceof Wd),r=e.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){const n=r.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference?.wkid;return this._reject(new j("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:r})),null}const s=K_(this.view,r);return s==null?(this._reject(new j("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:i}}_startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(r==null)return void this._reject(new j("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.active||i.viewAnimation==null||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;e.isFullySpecified?(s=new yD({view:this.view,desiredCamera:e.camera}),XI(this.view,e.camera,ef.EYE_AND_CENTER)):Ln(this.view,e.camera),i.begin(e.camera,this._options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof wv&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):i.viewAnimation!=null&&i.viewAnimation.target===e.viewpoint&&i.state===Ns.Finished&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(i.state){case Ns.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._resolve()}break;case Ns.Ready:case Ns.Rejected:case Ns.Running:case Ns.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return r instanceof wv&&(r.updateStateFromViewAnimation(),r.active&&(e=r,i=e.viewAnimation)),e!=null||(e=new wv({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e))?e:(i?.stop(),this._reject(new j("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},yx=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,i){return this._outer.get(e)?.get(i)}set(e,i,r){const s=this._outer.get(e);s?s.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((i,r)=>e(i,r))}};var bn;function Dve(t=!ae("disable-feature:high-quality-idle"),e=null){const i=new yx;return t?(i.set(zi.IDLE,bn.Antialiasing,e!=="low"),i.set(zi.IDLE,bn.HighResolutionAtmosphere,e!=="low"),i.set(zi.IDLE,bn.HighQualityTransparency,!0),i.set(zi.IDLE,bn.SSAO,!0),i.set(zi.IDLE,bn.WaterReflection,!0),i.set(zi.IDLE,bn.PhysicalPixelRendering,!0)):(i.set(zi.ANIMATING,bn.HighResolutionShadows,!0),i.set(zi.ANIMATING,bn.HighResolutionViewshed,!0),i.set(zi.INTERACTING,bn.HighResolutionShadows,!0),i.set(zi.INTERACTING,bn.HighResolutionViewshed,!0)),i.set(zi.IDLE,bn.HighResolutionShadows,!0),i.set(zi.IDLE,bn.HighResolutionViewshed,!0),i.set(zi.IDLE,bn.HighResolutionVoxel,!0),i}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.HighResolutionViewshed=7]="HighResolutionViewshed",t[t.PhysicalPixelRendering=8]="PhysicalPixelRendering"})(bn||(bn={}));let Rn=class extends Fe{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=Fve,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(i){this.viewStateManager._idleTimeout=i?Fve:0}},this._propertiesPool=new jv({frustum:Sw},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new Twt}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([qa(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),_e(()=>this.view.state?.camera,(e,i)=>this._cameraChangedHandler(e,i),Mr)]),Du(()=>this.view.state?.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([xE({prepare:()=>this._prepareFrame()}),_e(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(C5)}),qa(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Ge(this._propertiesPool)}get camera(){const e=this._get("camera");if(!this.ready)return e;const i=GO(this.view,this.view.state.camera,ZY);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider?.enableCache(!0),this.setStateCamera(K_(this.view,e),{applyConstraints:!1})||oe.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider?.enableCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=GO(this.view,this.view.state.contentCamera,ZY);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=K_(this.view,e);i!=null?(this._updateElevation(i),this.view.state.contentCamera=i):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(JY),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,s=Dc(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([_e(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(JY),this.test.contentCameraResetState.clear())}),_e(()=>this.zoom,o=>{o!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-i)/2),Math.abs(o-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),_e(()=>this.view.state.camera,o=>{const a=Xo(s,o.center);this.test.contentCameraResetState.set("camera.center",a/r),a>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],JY),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():oe.getLogger(this).error("#center=","Invalid center",e):oe.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):oe.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=HNe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return i??this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||oe.getLogger(this).error("#extent=","Invalid extent",e):oe.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):oe.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){const e=this.view.map;return e&&"initialViewProperties"in e?e.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return ux(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||oe.getLogger(this).error("#scale=","Invalid scale",e)}get terrainScale(){if(!this.ready)return this._get("scale");const e=this.view,i=e.basemapTerrain.tilingScheme,r=e.pointsOfInterest.cameraOnSurface.scale;if(!i||!r)return this._get("scale");const s=e.state.contentCamera;let n=g9(e,s.eye,s.viewForward,s.up).tilt;n>90&&(n=180-n);const o=2*(n/90)**2,a=i.levelAtScale(r)-o;return a<0?this._get("scale"):i.scaleAtLevel(a)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,s=this._get("padding"),n=Math.round(i[Si.TOP]/r),o=Math.round(i[Si.RIGHT]/r),a=Math.round(i[Si.BOTTOM]/r),l=Math.round(i[Si.LEFT]/r);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,E5),this.view.state.updateCamera(i=>i.padding=E5))}_paddingToArray(e,i,r){e?Ds(r,e.top||0,e.right||0,e.bottom||0,e.left||0):Ds(r,0,0,0,0);for(let s=0;s<4;s++)r[s]=Math.round(r[s]*i)}get screenCenter(){const e=this.padding;return hf((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?s4e(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||oe.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const i=e.camera!=null?e.camera.position:e.targetGeometry,r=i!=null&&i.spatialReference;oe.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}else oe.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?Edt(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||oe.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),i=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*i),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*i);const r=this.view._stage.renderView.renderingContext?.parameters.maxTextureSize;return r&&D2(this._tmpCanvasSize,r),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:i,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(bn.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const e=this.view?._stage?.renderer;return e&&(e.isFeatureEnabled(bn.PhysicalPixelRendering,zi.IDLE)||e.isFeatureEnabled(bn.PhysicalPixelRendering,zi.INTERACTING)||e.isFeatureEnabled(bn.PhysicalPixelRendering,zi.ANIMATING))}preinit(e){return!(this._isOverridden("center")&&!AA(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!AA(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!AA(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||AA(this.viewpoint.targetGeometry?.spatialReference,e)&&AA(this.viewpoint.camera?.position?.spatialReference,e))}init(){this._constraintsManager=new WN({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this._initialViewpoint||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===Xe.Local&&this.addHandles(Du(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(C5),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),C5)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(C5),this._constraintsManager=Ge(this._constraintsManager))}async goTo(e,i){return i={animate:!0,...i},this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new Swt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(SC(this.view),{applyConstraints:!1})}step(e){const i=this.view.state,r=i?.cameraController;r&&(i.updateCamera(s=>r.stepController(e,s)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:s}of Cwt){const n=e.has(r),o=this._isOverridden(r);!n&&o&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(n||o)&&s.forEach(a=>e.add(a))}return i}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof Wd)return void this.setStateCamera(K_(this.view,e),{applyConstraints:!1});if(e instanceof dg){if(e.targetGeometry instanceof lr){const n=IV(this.view,e.targetGeometry,0,.5,vl.LOCKED);return void(n!=null&&this.setStateCamera(K_(this.view,n),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,r)}const i=IV(this.view,e,0,.5,vl.LOCKED);i!=null&&this.setStateCamera(K_(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&Ewt.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof dg?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Wd?this.isCompatible(e.position):e.spatialReference&&!HIe(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=Mwt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=k1){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=rue(this.view,s,n,e,i,vl.ADJUST);return o==null?null:(r.copyFrom(this.view.state.camera),r.eye=o.eye,r.center=o.center,r.up=o.up,r)}_centerToCamera(e){const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),s=IV(this.view,e,i,r,vl.ADJUST,ZY);return s?K_(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.renderLocation,s=i.location.latitude,n=m9(this.view,e,s);return this._centerPointAtDistanceToCamera(r,n)}_zoomToCamera(e){return this._scaleToCamera(XNe(this.view,e))}_viewpointToCamera(e){return K_(this.view,t4e(this.view,e))}setStateCamera(e,i){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up,r.fov=e.fov):r.copyFrom(e),i.applyConstraints&&Ln(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new yD({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i}=this.view;if(!e||!i)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._computeCanvasSize();if(r.width!==0&&r.height!==0&&(i.width===r.width&&i.height===r.height||(i.width=r.width,i.height=r.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===r.width&&s.fullHeight===r.height&&s.pixelRatio===r.pixelRatio||(k1.copyFrom(s),k1.pixelRatio!==r.pixelRatio&&(this._paddingToArray(this.padding,r.pixelRatio,E5),k1.padding=E5),k1.fullWidth=r.width,k1.fullHeight=r.height,k1.pixelRatio=r.pixelRatio,this.view.state.camera=k1),this._updateViewState()}}_updateElevation(e){const i=this.view.basemapTerrain?.spatialReference,r=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,s=i?f9(this.view,e.eye):0;e.relativeElevation=r-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=zi.ANIMATING:this.view.interacting?this.view.state.mode=zi.INTERACTING:(this.view.state.mode===zi.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=zi.INTERACTING:this.view.state.mode=zi.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};d([m({type:Wd,dependsOn:["view.state.camera","ready"]})],Rn.prototype,"camera",null),d([m({type:Wd,dependsOn:["view.state.contentCamera","ready"]})],Rn.prototype,"contentCamera",null),d([m({type:$t})],Rn.prototype,"center",null),d([m({type:lr})],Rn.prototype,"extent",null),d([m({readOnly:!0})],Rn.prototype,"frustum",null),d([m()],Rn.prototype,"_constraintsManager",void 0),d([m({readOnly:!0})],Rn.prototype,"constraintsManager",null),d([m()],Rn.prototype,"_initialViewpoint",null),d([m({readOnly:!0})],Rn.prototype,"hasInitialView",null),d([m({readOnly:!0,type:Boolean})],Rn.prototype,"ready",void 0),d([m({type:Number})],Rn.prototype,"scale",null),d([m({type:Number})],Rn.prototype,"terrainScale",null),d([m()],Rn.prototype,"padding",null),d([m({readOnly:!0})],Rn.prototype,"screenCenter",null),d([m({constructOnly:!0})],Rn.prototype,"view",void 0),d([m({type:dg})],Rn.prototype,"viewpoint",null),d([m({type:Number})],Rn.prototype,"zoom",null),d([m({readOnly:!0})],Rn.prototype,"_rasterPixelRatio",null),d([m({readOnly:!0})],Rn.prototype,"_usePhysicalPixelRendering",null),d([m({readOnly:!0})],Rn.prototype,"_usePhysicalPixelRenderingAny",null),d([m()],Rn.prototype,"_windowDevicePixelRatio",void 0),d([m()],Rn.prototype,"_devicePixelRatioOverride",void 0),Rn=d([N("esri.views.3d.state.ViewStateManager")],Rn);let Twt=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const Ewt=new Set(["camera","viewpoint","extent","scale","center","zoom"]),Cwt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Mwt={heading:0,tilt:0},ZY=new Wd,k1=new Kr,E5=pi(),C5="pending-initial-view",JY="content-camera-reset",Fve=300,kve=100;let Zy=class extends av{constructor(){super(...arguments),this.startCamera=new Kr,this.currentCamera=new Kr,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<kve}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=Ns.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),kve),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};d([m({readOnly:!0})],Zy.prototype,"isInteractive",null),d([m()],Zy.prototype,"_lastInteraction",void 0),Zy=d([N("esri.views.3d.state.controllers.InteractiveController")],Zy);var nh;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(nh||(nh={}));let _D=class extends Zy{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=nh.CENTER,this._rotScale=0,this._lastPoint=vt(),this._tmpWorldUp=M(),this._tmpViewDir=M(),this._tmpRotCurPoint=vt(),this._tmpTransf=Ne(),this._tmpAxis=M(),this._tmpPivotPoint=M(),this._pivotPos=M(),this._constraintOptions=new wf(Ss.ALL,Ei.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===nh.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case nh.EYE:ge(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Ei.LOOK_AROUND,this._constraintOptions.tiltMode=w0.LOOK_AROUND,this._constraintOptions.selection=Ss.NONE;break;case nh.CENTER:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?$C:{});i||ge(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Ei.TUMBLE,this._constraintOptions.tiltMode=w0.TUMBLE,this._constraintOptions.selection=Ss.ALL&~Ss.DISTANCE;break}}cE(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,s=M();Me(s,this._pivotPos,r.eye);const n=De(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Uve);let a=Math.max(Math.min(Nbt,1/Math.abs(xe(Uve,r.viewForward)))*o,Lbt);i&&(a=Math.min(n,a));const l=Hs(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),c=o4(this.startCamera,l,this.view.renderCoordsHelper,this.view.viewingMode);let u=this.view._stage.renderView.getMinimalDepthForArea(DF(this.view),r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*VY,VY),h=this.view._stage.renderView.getMinimalDepthForArea(DF(this.view),e[0],e[1],r,VY);u==null&&h==null||(u=u??h??0,h=h==null||c===gl.Horizontal?u:h,a=u>h?h:u,a=i?Math.min(a,n):a),Se(s,s),ge(this._pivotPos,Te(this._tmpPivotPoint,r.eye,ce(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case nh.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case nh.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Ln(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,i,r,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),cE(e,i,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;Me(this._tmpViewDir,r,s);const a=De(this._tmpViewDir),l=Jo(xe(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===nh.EYE){n*=-.5;const c=.5*Math.PI-l,u=.5*Math.PI*.99;n=c-Math.max(-u,Math.min(u,c+n))}return n=$e(n+l,ul.min,ul.max)-l,yt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===nh.CENTER&&(o=-o),Ph(this._tmpTransf,o,this._tmpWorldUp),bh(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),nt(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=nt(QY,e.up,this._tmpTransf),Te(QY,s,this._tmpViewDir),Cl(this._lastPoint,this._tmpRotCurPoint),QY}};d([m()],_D.prototype,"pivot",void 0),_D=d([N("esri.views.3d.state.controllers.RotateController")],_D);const QY=M(),Uve=M();let KY=class extends Ja{constructor(e,i,r,s){super(!0),this._view=e,this.pointerAction=i,this._pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!Che(e.data,this.pointerAction))return;const r=Hs(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new _D({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},Kre=class extends Zy{constructor(){super(...arguments),this._pickPoint=M(),this._tmpP0=vt(),this._panAxisAngle=V9(),this._tmpRayDir=M(),this._tmpRayDirPick=M(),this._targetOnSphere=M(),this._navMode=gl.Horizontal,this._tmpRay={origin:M(),direction:M()},this.dragBeginPoint=Hs(),this._normalizedAnchorPoint=vt(),this._constraintOptions=new wf(Ss.ALL_EXCEPT_COLLISION,Ei.ZOOM,0,this.startCamera),this._sphere=Bn(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Cl(this.dragBeginPoint,e),cE(this.startCamera,e,this._normalizedAnchorPoint);const i=$r(this.view.spatialReference),r=Hke(this._intersectionHelper,this.startCamera,e,i,JO.Ellipsoid,this.view.map.ground.opacity===0?$C:{});if(this._navMode=o4(this.startCamera,e,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===gl.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let s;ZI(this.startCamera,e,this._tmpRay),Se(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&(Me(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=De(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Bve);let o=$e(Math.min(Fke,1/Math.abs(xe(Bve,this._tmpRay.direction)))*n,h8[0],h8[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,G9);o=a??o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,ce(this._tmpRay.direction,this._tmpRay.direction,o),Te(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===gl.Horizontal){Me(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=De(this._tmpRayDir);cE(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;if(this._hasPickPoint&&s<i){const o=1-(1-s/i)*(1-this._sphere[3]/De(this.currentCamera.center));this.currentCamera.center=ce(M5,this.currentCamera.center,o)}ce(this._tmpRayDir,this._tmpRayDir,-s/i),this.currentCamera.eye=Te(M5,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Rm(dx(this.dragBeginPoint,e)),Ln(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(LF(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),vhe(this._pickPoint,this._targetOnSphere,this._panAxisAngle),gx(this.currentCamera,this._sphere,this._panAxisAngle))}else{const i=De(this._tmpRay.direction);cE(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;ce(this._tmpRayDir,this._tmpRay.direction,1-s/i),this.currentCamera.eye=Te(M5,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=Te(M5,this.currentCamera.center,this._tmpRayDir)}XI(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};Kre=d([N("esri.views.3d.state.controllers.ZoomControllerGlobal")],Kre);const M5=M(),Bve=M();let ese=class extends Zy{constructor(){super(...arguments),this._tmpP=M(),this._tmpDir=M(),this._tmpN=M(),this._tmpP0=vt(),this._tmpPoi=M(),this._tmpRayDir=M(),this.dragBeginPoint=Hs(),this._normalizedAnchorPoint=vt(),this._constraintOptions=new wf(Ss.ALL,Ei.ZOOM,0,this.startCamera,M()),this._plane=mr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Cl(this.dragBeginPoint,e),cE(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?$C:{});Me(this._tmpDir,this._tmpP,this.startCamera.eye);const r=De(this._tmpDir);Se(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=$e(Math.min(Fke,1/Math.abs(xe(Awt,this._tmpDir)))*s,h8[0],h8[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(DF(this.view),e[0],e[1],this.view.state.camera,G9);n=o??n,n=i?Math.min(n,r):n,ce(this._tmpDir,this._tmpDir,n),Te(this._tmpP,this.startCamera.eye,this._tmpDir),Me(this._tmpN,this.startCamera.eye,this.startCamera.center),Se(this._tmpN,this._tmpN),this._tmpN[1]<0&&Ha(this._tmpN,this._tmpN),zk(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.active)return;Dbt(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ge(this._tmpPoi,this.currentCamera.center),cE(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Cl(this._normalizedAnchorPoint,this._tmpP0),Me(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=De(this._tmpRayDir);let s=r*(1-i);this._constraintOptions.interactionDirection&&(ge(this._constraintOptions.interactionDirection,this._tmpRayDir),ce(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const n=this.view.state.constraints.minimumPoiDistance;i>=0&&s<n&&(s=n,i=-(s-r)/r),Math.abs(r-s)<1e-6||(ce(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=Te(wS,this.currentCamera.eye,this._tmpRayDir),Br(wS,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?wS[2]=Math.max(this.startCamera.center[2],wS[2]):wS[2]=Math.min(this.startCamera.center[2],wS[2]),this.currentCamera.center=wS,this._constraintOptions.interactionFactor=Rm(dx(this.dragBeginPoint,e)),Ln(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};ese=d([N("esri.views.3d.state.controllers.ZoomControllerLocal")],ese);const wS=M(),Awt=Be(0,0,1);let Rwt=class extends Ja{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!Che(e.data,this.pointerAction))return;const r=Hs(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new Kre({view:this._view}):this._cameraController=new ese({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function Nf(t){let e=t*t;return t<0&&(e*=-1),e}function zve(t,e,i){const r=i,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=Nf(s.axes[0]),r.translation[1]=Nf(s.axes[1]),r.translation[2]=Nf(s.buttons[7])-Nf(s.buttons[6]),r.heading=Nf(s.axes[2]),r.tilt=Nf(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*Nf(s.axes[0]),r.translation[1]=1.2*Nf(s.axes[1]),r.translation[2]=2*-Nf(s.axes[2]),r.heading=1.2*Nf(s.axes[5]),r.tilt=1.2*Nf(s.axes[3])),r.tilt*=o,ce(r.translation,r.translation,a),r}function Vve(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function eX(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let F2=class extends Zy{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Kr,this._headingStart=0,this._constraintOptions=new wf(Ss.ALL,Ei.NONE,0,new Kr,null,w0.LOOK_AROUND)}handleEventGamepad(e){const i=zve(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||eX(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,Vve(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const i=Vve(this._keysButtonState,this._transformation);eX(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,xS),this._applyDisabledMovementTypes(xS),this._applyPan(xS.pan),this._applyRotate(xS.rotate),this._applyZoom(xS.zoom),this._applyAscend(xS.ascend),this._constraintOptions.interactionType=Ei.NONE,this._constraintOptions.selection=Ss.COLLISION,Ln(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;Me(eu,i.center,i.eye),nt(eu,eu,e.matrix),i.center=Te(eu,eu,i.eye),i.up=nt(eu,i.up,e.matrix),this._constraintOptions.interactionType=Ei.LOOK_AROUND,this._constraintOptions.selection=Ss.ALL_EXCEPT_COLLISION,Ln(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=nt(eu,i.eye,e.matrix),i.center=nt(eu,i.center,e.matrix),this.view.state.isGlobal&&(i.up=nt(eu,i.up,e.matrix)),this._constraintOptions.interactionType=Ei.PAN,this._constraintOptions.selection=Ss.ALL,Ln(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=Te(eu,this.currentCamera.eye,ce(tt.get(),i,e)),ge(K$,i),Ha(K$,K$),this._constraintOptions.interactionDirection=K$,this._constraintOptions.interactionType=Ei.ZOOM,this._constraintOptions.selection=Ss.ALL_EXCEPT_COLLISION,Ln(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,tt.get());if(this._constraintOptions.interactionDirection=ge(K$,i),this.view.state.isGlobal){const r=De(this.currentCamera.eye),s=(r+e)/r;this.currentCamera.eye=ce(eu,this.currentCamera.eye,s),this.currentCamera.center=ce(eu,this.currentCamera.center,s)}else{const r=ce(tt.get(),i,e);this.currentCamera.eye=Te(eu,this.currentCamera.eye,r),this.currentCamera.center=Te(eu,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=Ei.ASCEND,this._constraintOptions.selection=Ss.COLLISION,Ln(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Ss.ALL_EXCEPT_COLLISION,Ln(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){Dwt(r);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,i,r):this._calculateControlTransformationGlobal(s,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,eu)}_calculateControlTransformationLocal(e,i,r){const{viewRight:s,viewForward:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=ue(tt.get(),n[0],n[1],0);Se(l,l);const c=o.translation[0]*e.pan;if(c!==0){const y=ce(tt.get(),s,c);ac(r.pan.matrix,r.pan.matrix,y),r.pan.enabled=!0}switch(a.mode){case"pan":{const y=-o.translation[1]*e.pan;if(y!==0){const v=ce(tt.get(),l,y);ac(r.pan.matrix,r.pan.matrix,v),r.pan.enabled=!0}r.zoom=o.zoom*e.zoom;break}case"zoom":r.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const u=o.translation[2]*e.ascend;r.ascend=u;const h=-o.heading*e.rotate;h!==0&&(bh(r.rotate.matrix,r.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,tt.get())),r.rotate.enabled=!0);const p=o.tilt*e.rotate,f=mx(this.view.renderCoordsHelper,i.center,i.eye),g=$e(f+p,ul.min,ul.max)-f;g&&(bh(r.rotate.matrix,r.rotate.matrix,g,s),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:s,viewRight:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=yt(tt.get(),n,s);Se(l,l),Ha(l,l),Vbt(this.startCamera,i,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(xS.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=o.translation[2]*e.ascend;r.ascend=u;const h=-o.heading*e.rotate;h!==0&&(bh(r.rotate.matrix,r.rotate.matrix,h,this._tmpCamera.eye),r.rotate.enabled=!0);const p=o.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(p,i.ray,c);f!==0&&(bh(r.rotate.matrix,r.rotate.matrix,f,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const s=$r(this.view.spatialReference),n=mG(ul.min,i.origin,r,s);let o=0,a=0;const l=tt.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const c=mx(this.view.renderCoordsHelper,l,i.origin);o=mG(c,i.origin,r,s),a=mG(ul.max,i.origin,r,s)}else{BI(r9(s9,r+s.radius),i,l);const c=Math.PI+Lce(i.direction,l);o=Sve(c,i.origin,r,s),a=Sve(ul.max,i.origin,r,s)}return $e(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=i+Math.abs(n-i);return s.setAltitude(r,o,e),o}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:s}=this.view.state,{direction:n}=gdt(this.view,i,0,l4e,Lwt),o=r.intersectManifoldClosestSilhouette(Yd(i,n),e,tt.get()),a=jr(i,o),l=r.intersectManifoldClosestSilhouette(Yd(i,Kv(tt.get(),i,s.center)),e,tt.get()),c=jr(i,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:s,isGlobal:n}=r,o=i.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,tt.get());if(n){const a=Me(tt.get(),e,o),l=De(a);ce(a,a,1/l);const c=Se(tt.get(),e),u=Jo(xe(c,a));return l*Math.sin(Math.min(Owt,u))}{const a=ge(tt.get(),e);return i.setAltitude(a,this._filteredSurfaceElevation),jr(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:Iwt}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+$r(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=tt.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,i,o),l=this._clampedDistanceToSurface(i,o),c=s.width/2,u=Gve*s.width,h=Gve*s.width,p=l*Math.tan(.5*s.fovX)/c,f=p/r,g=p/this._computeHeadingRotateRadius(o),y=a-i;return{pan:(n?f:p)*u*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(u*e/c)*y-y),zoom:2**(u*e/c)*l-l,rotate:$e(g*h,$wt,Nwt)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&df(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&df(e.rotate.matrix))}static activatesFor(e,i){const r=zve(i,e.navigation.gamepad,Pwt);return!(i.action==="end"||eX(r))}};d([m({constructOnly:!0})],F2.prototype,"gamepadDevice",void 0),d([m({constructOnly:!0})],F2.prototype,"disableMovements",void 0),F2=d([N("esri.views.3d.state.controllers.GamepadKeyboardController")],F2);const Pwt={translation:[0,0,0],heading:0,tilt:0,zoom:0},l4e=80,Owt=Gt(l4e),Gve=.75,Iwt=5,$wt=Gt(30),Nwt=Gt(80),xS={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ne()},rotate:{enabled:!1,matrix:Ne()}},eu=M(),K$=M(),Lwt=tue();function Dwt(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,df(t.pan.matrix),t.rotate.enabled=!1,df(t.rotate.matrix)}let Fwt=class extends Ja{constructor(e){super(!0),this._view=e,this._watchHandles=new A0,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([_e(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Ir),_e(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=this._cameraControllerGamepad?.active;if(r||F2.activatesFor(this._view,e.data)){if(!r){const s=new F2({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};function kwt(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),er(()=>document.removeEventListener("visibilitychange",e))}var Qu;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(Qu||(Qu={}));let Uwt=class extends Ja{constructor(e,i){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Xe.Local},this._keyToNumber={[i.left]:Qu.LEFT,[i.right]:Qu.RIGHT,[i.forward]:Qu.FORWARD,[i.backward]:Qu.BACKWARD,[i.up]:Qu.UP,[i.down]:Qu.DOWN,[i.headingLeft]:Qu.HEADINGLEFT,[i.headingRight]:Qu.HEADINGRIGHT,[i.tiltUp]:Qu.TILTUP,[i.tiltDown]:Qu.TILTDOWN,[i.zoomIn]:Qu.ZOOMIN,[i.zoomOut]:Qu.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=kwt(r=>r?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new F2({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(i),e.stopPropagation()))}_handleStop(){this._cameraControllerKeyboard?.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&this._cameraControllerKeyboard?.active&&(this._cameraControllerKeyboard.deactivateDirection(i),e.stopPropagation())}},Bwt=class extends Ja{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const i=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new m8({view:this._view,mode:"interaction"}):new g8({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*i.deltaY,Hs(i.x,i.y)),e.preventDefault(),e.stopPropagation()}},v8=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},YE=class extends $F{constructor(){super(...arguments),this._beginCamera=new Kr,this._elapsedTimeSec=0,this.constraintOptions=new wf(Ss.ALL,Ei.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new qO}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,i),Ln(this.view,i,this.constraintOptions)}};YE=d([N("esri.views.3d.state.controllers.momentum.MomentumController")],YE);let vD=class extends YE{constructor(e){super(e),this.interactionType=Ei.PAN,this._tmpPan=M()}momentumStep(e,i){const r=this.momentum.value(e);ce(this._tmpPan,this.momentum.direction,r),i.eye=Me(jve,i.eye,this._tmpPan),i.center=Me(jve,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};d([m({constructOnly:!0})],vD.prototype,"momentum",void 0),vD=d([N("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],vD);const jve=M(),zwt=M(),A5=M();let vG=class extends YE{constructor(e){super(e),this.interactionType=Ei.PAN}momentumStep(e,i){const r=this.momentum.value1(e),s=this.momentum.value2(e);ge(A5,i.eye),Se(A5,A5),yt(this.momentum.axis2,A5,this.momentum.axis1),Xke(i,zwt,this.momentum.axis1,r,this.momentum.axis2,s)}};d([m({constructOnly:!0})],vG.prototype,"momentum",void 0),vG=d([N("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],vG);let v2=class extends YE{set center(e){this._set("center",Fn(e))}set axis(e){this._set("axis",Fn(e))}constructor(e){super(e),this.interactionType=Ei.TUMBLE}momentumStep(e,i){const r=this.momentum.value(e);gx(i,this.center,NF(this.axis,r))}};d([m({constructOnly:!0})],v2.prototype,"momentum",void 0),d([m({constructOnly:!0})],v2.prototype,"center",null),d([m({constructOnly:!0})],v2.prototype,"axis",null),v2=d([N("esri.views.3d.state.controllers.momentum.RotationMomentumController")],v2);let YR=class extends YE{set zoomCenter(e){this._set("zoomCenter",Fn(e))}constructor(e){super(e),this.interactionType=Ei.ZOOM,this.constraintOptions.interactionDirection=M()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;ge(r,i.eye);const s=this.momentum.valueDelta(0,e);She(i,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),Kv(r,i.eye,r)}};d([m({constructOnly:!0})],YR.prototype,"momentum",void 0),d([m({constructOnly:!0})],YR.prototype,"zoomCenter",null),YR=d([N("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],YR);let DT=class extends YE{set screenCenter(e){this._set("screenCenter",Hs(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Fn(e))}constructor(e){super(e),this.interactionType=Ei.ZOOM,this.radius=0,this._tmpSceneCenter=M(),this._tmpZoomAxisAngle=V9(),this._sphere=Bn()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);Gke(this._sphere,i,r),this.constraintOptions.interactionType=Ei.ZOOM,Ln(this.view,i,this.constraintOptions),LF(this._sphere,i,this.screenCenter,this._tmpSceneCenter),vhe(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),gx(i,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Ei.PAN}};d([m({constructOnly:!0})],DT.prototype,"momentum",void 0),d([m({constructOnly:!0})],DT.prototype,"screenCenter",null),d([m({constructOnly:!0})],DT.prototype,"sceneCenter",null),d([m({constructOnly:!0})],DT.prototype,"radius",void 0),DT=d([N("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],DT);let Pm=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},q9=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},Vwt=class extends q9{constructor(e,i,r,s,n){super(e,i,r),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},c4e=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new Pm(.6),this._screen=[new Pm(.4),new Pm(.4)],this._scene=[new Pm(.6),new Pm(.6),new Pm(.6)],this._tmpDirection=M()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=s==null||r==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){ue(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=De(this._tmpDirection);s>0&&ce(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new Vwt(e,i,r,n==null?0:s/n,this._tmpDirection)}},Hve=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const qve=1e-5;let Gwt=class extends q9{constructor(e,i,r,s,n,o=0,a){super(e,i,r),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},jwt=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=M(),this._tmpAxis2=M(),this._tmpAngles=vt(),this._time=new Pm(.3),this._screen=[new Pm(.4),new Pm(.4)],this._angle1=new Hve(.6),this._angle2=new Hve(.6),this._axis1=M(),this._axis2=M(),this._lastScene=M()}addMomentumDirectRotation(e,i,r,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=Wke(this._lastScene,i,this._tmpAxis2,s,n,o);this._angle2.update(0),Ql(this._tmpAxis2)<qve?a=0:Se(this._axis1,this._tmpAxis2),this._angle1.update(a),ge(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;Yke(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),Ql(this._tmpAxis2)<qve?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),Se(this._axis1,this._tmpAxis1),Se(this._axis2,this._tmpAxis2)),ge(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=r==null||s==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new Gwt(e,i,r,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},u4e=class{constructor(e=2.5,i=.01,r=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=s,this.enabled=!0,this.value=new Pm(.8),this.time=new Pm(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=$e(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new q9(e,i,r)}},h4e=class extends u4e{constructor(e=3,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){const r=this.value.lastValue;if(r!=null){let s=e-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=r+s}super.add(e,i)}},Hwt=class extends q9{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),s=super.value(e+i)-r;return Math.exp(s)}},d4e=class extends u4e{constructor(e=2.5,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new Hwt(e,i,r)}},tse=class extends Zy{constructor(){super(...arguments),this._smoothRotation=new v8(.05),this._rotationAxis=M(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=mr(),this._beginRadius=0,this._smoothScaling=new v8(.05),this._zoomCenterScreen=Hs(),this._zoomMomentumEstimator=new d4e,this._rotationMomentumEstimator=new h4e,this._panSphericalMomentumEstimator=new jwt,this._panPlanarMomentumEstimator=new c4e,this._adjustedSphere=Bn(),this._tmp3d=M(),this._tmpScreenPointArray=Hs(),this._beginScreenPoint=Hs(),this._beginScenePoint=M(),this._screenPickPoint=Hs(),this._scenePickPoint=M(),this._navMode=gl.Horizontal,this._sphere=Bn(),this._pointerCount=0,this._tmpInteractionDirection=M(),this._beginCamera=new Kr,this._constraintOptions=new wf(Ss.ALL,Ei.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-ix.normalize(Gt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),$m(e.center,this._screenPickPoint),Cl(this._beginScreenPoint,this._screenPickPoint);const i=$r(this.view.spatialReference),r=Hke(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,JO.Silhouette,this.view.map.ground.opacity===0?$C:{});r.scenePickPoint!=null&&(this._scenePickPoint=r.scenePickPoint,this._sphere=r.sphere,ge(this._beginScenePoint,this._scenePickPoint),this._navMode=o4(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===gl.Vertical&&this._preparePlanarPanMode(e,r.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._navMode===gl.Horizontal?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._navMode===gl.Horizontal?new DT({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new YR({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new v2({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._navMode===gl.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new vG({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new vD({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,i){const r=Ha(this._tmp3d,this.startCamera.viewForward);zk(this._scenePickPoint,r,this._panningPlane);const s=Hs(this._screenPickPoint[0],0),n=M(),o=De(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],LF(this._adjustedSphere,this.startCamera,s,n);const a=_l();this.startCamera.projectToRenderScreen(n,a);const l=M(),c=M(),u=M();Me(l,this._scenePickPoint,this.currentCamera.eye);const h=De(l);Se(l,l);const p=zke*Math.max(Math.abs(this.view.camera.position.z),Vke),f=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,G9);let g=f??p;g=i?Math.min(g,h):g,ge(u,Te(c,this.currentCamera.eye,ce(c,l,g))),this._panningPlane[3]=-xe(this._panningPlane,u),this.startCamera.center=Te(c,this.startCamera.eye,ce(c,this.startCamera.viewForward,g));const y=$m(e.center,this._tmpScreenPointArray);Jre(this._panningPlane,this.startCamera,y,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),Gke(this._sphere,this.currentCamera,this._smoothScaling.value),$m(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Ei.ZOOM,this._constraintOptions.interactionFactor=Rm(e.radius-this._beginRadius),Ln(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=$m(e.center,this._tmpScreenPointArray);LF(this._sphere,this.currentCamera,i,this._tmp3d),The(this._beginScenePoint,xe(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(Jke(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(Zke(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Ei.PAN,this._constraintOptions.interactionFactor=Rm(dx(this._screenPickPoint,i)),Ln(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){Se(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Ha(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+Zre(e.angle-i),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(r);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),gx(this.currentCamera,this._sphere,NF(this._rotationAxis,n)),this._constraintOptions.interactionType=Ei.TUMBLE,this._constraintOptions.interactionFactor=Rm(e.radius*r),Ln(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=$m(e.center,this._tmpScreenPointArray);Jre(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(qke(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Ei.PAN,this._constraintOptions.interactionFactor=Rm(dx(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Ln(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),She(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Ei.ZOOM,this._constraintOptions.interactionFactor=Rm(e.radius-this._beginRadius),Ln(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ge(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Ha(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=Zre(r);const s=i+r,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),gx(this.currentCamera,this._sphere,NF(this._rotationAxis,o)),this._constraintOptions.interactionType=Ei.TUMBLE,this._constraintOptions.interactionFactor=Rm(e.radius*o),Ln(this.view,this.currentCamera,this._constraintOptions)}};tse=d([N("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],tse);const Wve=Be(0,0,1);let ise=class extends Zy{constructor(){super(...arguments),this._rotationValueSmooth=new v8(.05),this._scalingValueSmooth=new v8(.05),this._planeHorizontal=mr(),this._planeVertical=mr(),this._rotationMomentumEstimator=new h4e,this._panMomentumEstimator=new c4e(300,12,.9),this._zoomMomentumEstimator=new d4e,this._beginRadius=0,this._beginCenter=M(),this._beginAngle=0,this._tmpPoints=[],this._navMode=gl.Horizontal,this._beginCenterScreen=Hs(),this._tmpCentroid3d=M(),this._tmpCentroid2d=Hs(),this._tmp2d=Hs(),this._pointerCount=0,this._beginCamera=new Kr,this._constraintOptions=new wf(Ss.ALL,Ei.NONE,0,this._beginCamera)}begin(e){if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),$m(e.center,this._beginCenterScreen),o3e(Wve,0,this._planeHorizontal);const r=M(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?$C:{}),n=M();Ha(n,this.startCamera.viewForward);const o=M();ge(o,Wve);const a=xe(n,o);this._navMode=o4(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);const l=Math.min(zke,1/Math.abs(xe(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),Vke);Hee(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||qee(this._planeHorizontal,this._planeHorizontal);const c=M(),u=M(),h=M();Me(c,r,this.currentCamera.eye);const p=De(c);if(Se(c,c),this._navMode===gl.Vertical){ce(o,o,a),Me(this._planeVertical,n,o),Se(this._planeVertical,this._planeVertical),Hee(this._planeVertical,this._planeVertical,r);const f=this.view._stage.renderView.getMinimalDepthForArea(DF(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,G9);let g=f??l;g=s?Math.min(g,p):g,ge(h,Te(u,this.currentCamera.eye,ce(u,c,g))),this._planeVertical[3]=-xe(this._planeVertical,h),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),GY(this._tmpPoints,this._beginCenter)}else{const f=s?p:l;ge(h,Te(u,this.currentCamera.eye,ce(u,c,f))),this._planeHorizontal[3]=-xe(this._planeHorizontal,h),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),GY(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._navMode===gl.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(i){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),She(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Ei.ZOOM,this._constraintOptions.interactionFactor=Rm(Math.abs(e.radius-this._beginRadius)),Ln(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),GY(this._tmpPoints,this._tmpCentroid3d),$m(e.center,this._tmpCentroid2d),qke(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Ei.PAN,this._constraintOptions.interactionFactor=Rm(dx(this._beginCenterScreen,this._tmpCentroid2d)),Ln(this.view,this.currentCamera,this._constraintOptions),i){const n=s,o=this._rotationValueSmooth.value,a=o+Zre(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(a);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp);const u=this._planeHorizontal;gx(this.currentCamera,n,NF(u,c)),this._constraintOptions.interactionType=Ei.TUMBLE,this._constraintOptions.interactionFactor=Rm(Math.abs(e.radius*c)),Ln(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new YR({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new v2({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new vD({view:this.view,momentum:s}):null}_computePlanePoints(e,i,r,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=M()),Jre(i,r,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};ise=d([N("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],ise);let Yve=class extends Ja{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!Che(e.data,this.pointerAction))return;const i=e.timestamp-this._lastEndTimestamp,r=40,s=this._momentum&&this._momentum.active&&i<r;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){if(this._controller?.active){this._lastEndTimestamp=e.timestamp;const r=this._controller.end(e.data);i&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new tse({view:this._view}):new ise({view:this._view})}},qwt=class extends Ja{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},p4e=class extends Ja{constructor(e,i){super(!0),this.key=e,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},Wwt=class extends p4e{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},Ywt=class extends p4e{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},Xwt=class extends Ja{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){const i=this._invert?-1:1,r=Hs(0,e.data.delta*i);switch(e.data.action){case"begin":this._cameraController?.end(),this._cameraController=new _D({view:this._view,pivot:nh.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController?.update(r);break;case"end":this._cameraController?.end(),this._cameraController=null}}};function Xve(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>Qwt(i,t.axisThreshold))}:{buttons:[],axes:[]}}function Zwt(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function Jwt(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function Qwt(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let Kwt=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,Xve(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(Zve(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new Oue(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=xE({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;Zve(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=Xve(n),l=r||Jwt(a);o&&(o.timestamp===s.timestamp||!o.active&&l||Zwt(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_emitGamepadEvent(e,i,r){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:o})}};function ext(t){if(!t||!t.connected)return!1;for(let e=0;e<t.axes.length;e++)if(isNaN(t.axes[e]))return!1;return!0}function Zve(t){const e=window.navigator.getGamepads();for(let i=0;i<e.length;i++){const r=e[i];ext(r)&&t(r)}}const Jve=ae("edge"),txt=ae("chrome"),ixt=ae("ff"),rxt=ae("safari"),Qve="esri-view-surface",vM={touchNone:`${Qve}--touch-none`,touchPan:`${Qve}--touch-pan`};let f4e=class m4e{constructor(e,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Kwt(e,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Ge(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(tX[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&tX[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(tX[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=e?.has("gamepad")??!1}setPointerCapture(e,i){i?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?vM.touchNone:vM.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?vM.touchPan:vM.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(vM.touchNone),this._element.classList.remove(vM.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=mDe(this._element,e);return m4e.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const{key:r}=i;r&&e==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_handleMouseWheel(e,i){let r=i.deltaY;switch(i.deltaMode){case 0:Jve&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}Jve?r*=.7:txt||rxt?r*=.6:ixt&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,o)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};f4e.test={disableSubpixelCoordinates:!1};const tX={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let sxt=class extends Ja{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};const Md={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function rse(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function nxt(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function oxt(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:hf()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[x,S]=t,[E,C]=[S.x-x.x,S.y-x.y];return e.radius=Math.sqrt(E*E+C*C)/2,e.center.x=(x.x+S.x)/2,e.center.y=(x.y+S.y)/2,e}let i=0,r=0;for(let x=0;x<t.length;x++)i+=t[x].x,r+=t[x].y;i/=t.length,r/=t.length;const s=t.map(x=>x.x-i),n=t.map(x=>x.y-r);let o=0,a=0,l=0,c=0,u=0,h=0,p=0;for(let x=0;x<s.length;x++){const S=s[x],E=n[x],C=S*S,R=E*E;o+=C,a+=R,l+=S*E,c+=C*S,u+=R*E,h+=S*R,p+=E*C}const f=.5*(c+h),g=.5*(u+p),y=o*a-l*l,v=(f*a-g*l)/y,b=(o*g-l*f)/y,w=hf(v+i,b+r);return{radius:Math.sqrt(v*v+b*b+(o+a)/t.length),center:w}}function bD(t){const{native:e}=t,{pointerId:i,button:r,pointerType:s}=e;return s==="mouse"?`${i}:${r}`:`${s}`}let axt=class extends Ja{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:s,pointers:lxt(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=R5(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,s);const n=bG(s,g4e(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=R5(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=R5(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=bG(r,i)-e,r.lastAngle=bG(r,i)-e})}_emitEvent(e,i,r){const s=R5(this._activePointerMap);this._drag.emit(this._createPayload(e,i,s,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,s=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function g4e(t){const e=[];return t.forEach(i=>{e.push(hf(i.event.x,i.event.y))}),oxt(e)}function R5(t){const e=g4e(t);let i=0;return t.forEach(r=>{let s=bG(r,e),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s;const o=s-r.initialAngle;i+=o}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function lxt(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function bG(t,e){const i=t.event,r=i.x-e.center.x,s=i.y-e.center.y;return Math.atan2(s,r)}var Kve;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(Kve||(Kve={}));let cxt=class extends Ja{constructor(e=Md.maximumDoubleClickDelay,i=Md.maximumDoubleClickDistance,r=Md.maximumDoubleTouchDelay,s=Md.maximumDoubleTouchDistance,n=wk){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=bD(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=bD(i),s=this._pointerState.get(r);if(s&&s.downButton===i.native.button){const n=s.immediateDoubleClick,o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;n?(n.timeoutHandle.remove(),rse(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(i))):rse(s,e.data)>o?this._removeState(i):this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=bD(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},uxt=class extends Ja{constructor(e=Md.maximumClickDelay,i=Md.movementUntilMouseDrag,r=Md.movementUntilPenDrag,s=Md.movementUntilTouchDrag,n=Md.holdDelay,o=wk){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Zr(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(P5("update",s,i),void 0,s.modifiers):nxt(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),s.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(P5("start",s,i)):this._pointerDrag.emit(P5("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(P5("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}};function P5(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}let hxt=class extends Ja{constructor(e=Md.maximumDoubleClickDelay,i=Md.maximumDoubleClickDistance,r=Md.maximumDoubleTouchDelay,s=Md.maximumDoubleTouchDistance,n=wk){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Zr(e.doubleClickTimer))}get hasPendingInputs(){return Pd(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=Zr(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,s=dxt(i);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;rse(o,i)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const i=bD(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,s=bD(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}};function dxt(t){const{pointerId:e,pointerType:i,button:r}=t.native;return i==="mouse"?`${e}:${r}`:`${i}`}let pxt=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){this._startEvent=e,this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},fxt=class extends Ja{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new pxt({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:y,y:v}of i.pointers.values())r=Math.max(r,y),s=Math.min(s,y),n=Math.max(n,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:y,y:v}of e.pointers.values())a=Math.max(a,y),l=Math.min(l,y),c=Math.max(c,v),u=Math.min(u,v);const h=r-s,p=n-o,f=a-l,g=c-u;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(f-h)<=this._maxDelta&&Math.abs(g-p)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}},om=class extends Fe{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Ge(this._inputManager)}connect(){const e=this.view;this._source=new f4e(this.view.surface,e.input);const i=[new cxt,new uxt,new hxt,new axt(this.view.navigation),new fxt],r=new yp({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new sxt],Dw.INTERNAL),this._modeDragPan=new Yve(e,"primary"),this._modeDragRotate=new KY(e,"secondary",nh.CENTER),this._modeDragZoom=new Rwt(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new qwt(e),new Xbt(e),new Fwt(e),new Uwt(e,s.pan),new Bwt(e),new Ywt(e,s.resetTilt),new Wwt(e,s.resetHeading),new KY(e,"primary",nh.EYE,[s.lookAround]),new KY(e,"secondary",nh.CENTER,[s.lookAround]),new Yve(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Xwt(e)],Dw.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this.addHandles(_e(()=>this.view.navigation?.browserTouchPanEnabled,n=>{this._source.browserTouchPanningEnabled=!n},Ir))}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}_updateMode(){const e=this.mode,i=this.primaryDragAction,r=sse.get(e)?.get(i);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){}};d([m()],om.prototype,"view",void 0),d([m({value:"pan"})],om.prototype,"primaryDragAction",null),d([m({value:"default"})],om.prototype,"mode",null),d([m({readOnly:!0})],om.prototype,"updating",null),d([m()],om.prototype,"latestPointerType",null),d([m()],om.prototype,"latestPointerLocation",null),d([m()],om.prototype,"multiTouchActive",null),d([m()],om.prototype,"_inputManager",void 0),om=d([N("esri.views.3d.input.SceneInputManager")],om);const sse=new Map,iX=new Map,rX=new Map;iX.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),iX.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),rX.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),rX.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),sse.set("default",iX),sse.set("pro",rX);const mxt=om;let Pn=class extends Fe{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};d([m()],Pn.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),d([m()],Pn.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),d([m()],Pn.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),d([m()],Pn.prototype,"DECONFLICTOR_SHOW_GRID",void 0),d([m()],Pn.prototype,"LABELS_SHOW_BORDER",void 0),d([m()],Pn.prototype,"TEXT_SHOW_BASELINE",void 0),d([m()],Pn.prototype,"TEXT_SHOW_BORDER",void 0),d([m()],Pn.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),d([m()],Pn.prototype,"OVERLAY_SHOW_CENTER",void 0),d([m()],Pn.prototype,"SHOW_POI",void 0),d([m()],Pn.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),d([m()],Pn.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),d([m()],Pn.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),d([m()],Pn.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),d([m()],Pn.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),d([m()],Pn.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),d([m()],Pn.prototype,"I3S_TREE_SHOW_TILES",void 0),d([m()],Pn.prototype,"I3S_SHOW_MODIFICATIONS",void 0),d([m()],Pn.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),d([m()],Pn.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),d([m()],Pn.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),d([m()],Pn.prototype,"LINE_WIREFRAMES",void 0),Pn=d([N("esri.views.3d.support.debugFlags")],Pn);const ts=new Pn;let gd,GP,nse=!1,ose=!1,ase=!1,lse=!1,wD=null;function gxt(t,e){if(!ose||!GP)return;y4e();const i=GP;let r=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];r+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,u=(n+1)*t.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),_4e(a,l,c,u,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30)}function yxt(t){ase=ts.DECONFLICTOR_SHOW_VISIBLE,lse=ts.DECONFLICTOR_SHOW_INVISIBLE,nse=ase||lse,ose=ts.DECONFLICTOR_SHOW_GRID,wD=null,nse||ose?wD=()=>_xt(t):gd&&(gd.parentElement.removeChild(gd),gd=null)}function y4e(){wD&&(wD(),wD=null)}function _xt(t){gd==null&&(gd=document.createElement("canvas"),gd.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(gd));const{state:e}=t,{camera:i,pixelRatio:r}=e,{width:s,height:n}=i,o=s*r,a=n*r;gd.setAttribute("width",`${o}px`),gd.setAttribute("height",`${a}px`),gd.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),GP=gd.getContext("2d"),GP.clearRect(0,0,s,n),GP.font="12px Arial"}function _4e(t,e,i,r,s){y4e();const n=gd.height,o=GP;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-i),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.closePath()}function vxt(t,e){nse&&(e&&ase||!e&&lse)&&_4e(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var yl,fa;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(yl||(yl={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(fa||(fa={}));function v4e(t,e){return new x4e(t,T4e,e)}function bxt(t,e){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=T4e;return new x4e(t,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:sX.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:sX.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:sX.minPixelSize},e)}function wxt(t){return Math.abs(t*t*t)}function b4e(t,e,i){const r=i.parameters;return nX.scale=Math.min(r.divisor/(e-r.offset),1),nX.factor=wxt(t),nX}function Rhe(t,e){return Wt(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function xxt(t,e,i){const r=b4e(t,e,i);return r.minScaleFactor=0,Rhe(1,r)}function e1e(t,e,i,r){r.scale=xxt(t,e,i),r.factor=0,r.minScaleFactor=i.minScaleFactor}function w4e(t,e,i=[0,0]){const r=Math.min(Math.max(e.scale,e.minScaleFactor),1);return i[0]=t[0]*r,i[1]=t[1]*r,i}function Sxt(t,e,i,r){return Rhe(t,b4e(e,i,r))}let x4e=class S4e{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,i,r,s=Txt(),n){this._viewingMode=e,this._description=i,this._ellipsoidRadius=r,this.parameters=s,this._fontHeight=n,this._viewingMode===Xe.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new S4e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,i,r){const{scaleStart:s,scaleFallOffRange:n}=this._description,{fovY:o,distance:a}=e,l=this._calculateCurvatureDependentParameters(e,i),c=this._coverageCompensation(e,i,l),{tiltAngle:u,scaleFallOffFactor:h}=l,p=Math.sin(u)*a,f=.5*Math.PI-u-o*(.5-s*c),g=p/Math.cos(f),y=f+o*n*c,v=(g-h*(p/Math.cos(y)))/(1-h);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=v,r.divisor=g-v,r}_calculateCurvatureDependentParametersLocal(e,i,r=t1e){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,i,r=t1e){const s=this._description.curvatureDependent,n=1+e.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=$e((o-a)/(l-a),0,1),[u,h]=[s.min,s.max];return r.tiltAngle=Wt(u.tiltAngle,h.tiltAngle,c),r.scaleFallOffFactor=Wt(u.scaleFallOffFactor,h.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(e,i,r){return(e.fovY-r.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*i,c=Math.sqrt(l),u=Math.sqrt(l-s);return(Math.acos(u/c)-Math.asin(i/(c/Math.sin(n)))+.5*o)/o}};const T4e={curvatureDependent:{min:{curvature:Gt(10),tiltAngle:Gt(12),scaleFallOffFactor:.5},max:{curvature:Gt(70),tiltAngle:Gt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},sX={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function Txt(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const nX={scale:0,factor:0,minScaleFactor:0},t1e={tiltAngle:0,scaleFallOffFactor:0};function Ext(t){return t instanceof Float32Array&&t.length>=16}function Cxt(t){return Array.isArray(t)&&t.length>=16}function Mxt(t){return Ext(t)||Cxt(t)}const QO={unknown:1,inches:ko(1,"meters","inches"),feet:ko(1,"meters","feet"),"us-feet":ko(1,"meters","us-feet"),yards:ko(1,"meters","yards"),miles:ko(1,"meters","miles"),"nautical-miles":ko(1,"meters","nautical-miles"),millimeters:ko(1,"meters","millimeters"),centimeters:ko(1,"meters","centimeters"),decimeters:ko(1,"meters","decimeters"),meters:ko(1,"meters","meters"),kilometers:ko(1,"meters","kilometers"),"decimal-degrees":1/ZQe(1,"meters",br.radius)};var Zl,i1e;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(Zl||(Zl={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(i1e||(i1e={}));let Phe=class{constructor(e){this.field=e}},Axt=class extends Phe{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[Zl.Undefined,Zl.Undefined,Zl.Undefined]}},Rxt=class extends Phe{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},Pxt=class extends Phe{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},Oxt=class{};function e3(t){return t!=null}function bM(t){return typeof t=="number"}function W9(t){return typeof t=="string"}function Ixt(t){return t==null||W9(t)}function Wo(t,e){t&&t.push(e)}function $xt(t,e,i,r=Ne()){const s=t||0,n=e||0,o=i||0;return s!==0&&EO(r,r,-s/180*Math.PI),n!==0&&TO(r,r,n/180*Math.PI),o!==0&&Cq(r,r,o/180*Math.PI),r}function U1(t,e,i,r,s){const n=t.minSize,o=t.maxSize;if(t.useSymbolValue){const a=r.symbolSize[i];return e.minSize[i]=a,e.maxSize[i]=a,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Zl.DefinedSize,!0}if(e3(t.field))return e3(t.stops)?t.stops.length===2&&bM(t.stops[0].size)&&bM(t.stops[1].size)?(r1e(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=Zl.DefinedSize,!0):(Wo(s,"Could not convert size info: stops only supported with 2 elements"),!1):bM(n)&&bM(o)&&e3(t.minDataValue)&&e3(t.maxDataValue)?(r1e(n,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=Zl.DefinedSize,!0):t.valueUnit==="unknown"?(Wo(s,"Could not convert size info: proportional size not supported"),!1):QO[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/QO[t.valueUnit],e.type[i]=Zl.DefinedSize,!0):(Wo(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!e3(t.field)){if(t.stops?.[0]&&bM(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Zl.DefinedSize,!0;if(bM(n))return e.minSize[i]=n,e.maxSize[i]=n,e.offset[i]=n,e.factor[i]=0,e.type[i]=Zl.DefinedSize,!0}return Wo(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function r1e(t,e,i,r,s,n){const o=Math.abs(r-i)>0?(e-t)/(r-i):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-i*o,s.factor[n]=o}function Nxt(t,e,i,r){if(t.normalizationField||t.valueRepresentation)return Wo(r,"Could not convert size info: unsupported property"),null;if(!Ixt(t.field))return Wo(r,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return Wo(r,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new Axt(t.field);let s;switch(t.axis){case"width":return s=U1(t,e.size,0,i,r),s?e:null;case"height":return s=U1(t,e.size,2,i,r),s?e:null;case"depth":return s=U1(t,e.size,1,i,r),s?e:null;case"width-and-depth":return s=U1(t,e.size,0,i,r),s&&U1(t,e.size,1,i,r),s?e:null;case null:case void 0:case"all":return s=U1(t,e.size,0,i,r),s=s&&U1(t,e.size,1,i,r),s=s&&U1(t,e.size,2,i,r),s?e:null;default:return Wo(r,`Could not convert size info: unknown axis "${t.axis}""`),null}}function Lxt(t,e,i){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===Zl.DefinedSize&&(n*=e.modelSize[s],t.type[s]=Zl.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let r;if(t.type[0]!==Zl.Undefined)r=0;else if(t.type[1]!==Zl.Undefined)r=1;else{if(t.type[2]===Zl.Undefined)return Wo(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)t.type[s]===Zl.Undefined&&(t.minSize[s]=t.minSize[r],t.maxSize[s]=t.maxSize[r],t.offset[s]=t.offset[r],t.factor[s]=t.factor[r],t.type[s]=t.type[r]);return!0}function s1e(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function Dxt(t,e,i){if(t.normalizationField)return Wo(i,"Could not convert color info: unsupported property"),null;if(W9(t.field)){if(!t.stops)return Wo(i,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return Wo(i,"Could not convert color info: too many color stops"),null;e.color=new Rxt(t.field);const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.color.values[s]=n.value,s1e(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return Wo(i,"Could not convert color info: no field and no colors/stops"),null;{const r=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,s1e(e.color.colors,s,r)}}return e}function Fxt(t,e,i){if(t.normalizationField)return Wo(i,"Could not convert opacity info: unsupported property"),null;if(W9(t.field)){if(!t.stops)return Wo(i,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return Wo(i,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new Pxt(t.field);const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return Wo(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=r}}return e}function oX(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function kxt(t,e,i){if(!W9(t.field))return Wo(i,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return Wo(i,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return oX(t,e.rotation,0),e;case"roll":return oX(t,e.rotation,1),e;case null:case void 0:case"heading":return oX(t,e.rotation,2),e;default:return Wo(i,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let a4=class{constructor(e,i=[1,1,1],r=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=i,this.symbolSize=r,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}};function E4e(t,e,i){if(!t)return null;const r=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return Wo(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return e.supports.size?Nxt(n,s,e,i):s;case"color":return e.supports.color?Dxt(n,s,i):s;case"opacity":return e.supports.opacity?Fxt(n,s,i):null;case"rotation":return e.supports.rotation?kxt(n,s,i):s;default:return null}},new Oxt);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r?.size&&!Lxt(r.size,e,i)?null:r:null}let Uxt=class{constructor(e,i,r){this.visualVariables=e,this.materialParameters=i,this.requiresShaderTransformation=r}};function KO(t,e){if(!t||ts.TESTS_DISABLE_FAST_UPDATES)return null;const i=E4e(t.visualVariables,e);return i?new Uxt(i,M4e(i,e),!!i.size):null}function eI(t,e,i){if(!e||!t)return!1;const r=t.visualVariables,s=E4e(e.visualVariables,i);return!!s&&!!(O5(r.size,s.size,"size")&&O5(r.color,s.color,"color")&&O5(r.rotation,s.rotation,"rotation")&&O5(r.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=M4e(s,i),t.requiresShaderTransformation=!!s.size,!0)}function O5(t,e,i){if(!!t!=!!e||t&&t.field!==e?.field)return!1;if(t&&i==="rotation"){const r=t,s=e;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}let C4e=class extends is{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}};function M4e(t,e){const i=new C4e(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,df(xD),$xt(e.rotation[2],e.rotation[0],e.rotation[1],xD),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||ps(),vf(i.vvSymbolRotationMatrix,xD)),i}function Bxt(t,e,i){if(!t.vvSize)return i;Xn(B1,i);const r=t.vvSymbolRotationMatrix;O0(xD,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),Or(B1,B1,xD);for(let s=0;s<3;++s){const n=t.vvSize.offset[s]+e[0]*t.vvSize.factor[s];n1e[s]=$e(n,t.vvSize.minSize[s],t.vvSize.maxSize[s])}return $k(B1,B1,n1e),ac(B1,B1,t.vvSymbolAnchor),B1}function Ohe(t,e,i){if(!e.vvSize)return ue(t,1,1,1),t;for(let r=0;r<3;++r){const s=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=$e(s,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return t}function eg(t,e){const i=t==null?0:e.attributes[t];return typeof i=="number"&&isFinite(i)?i:0}const B1=Ne(),n1e=M(),xD=Ne();function Ihe(t){t.vertex.code.add(T`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(T`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(T`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(T`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(T`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(T`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function zxt(t){t.uniforms.add(new Qt("screenSizePerspective",e=>A4e(e.screenSizePerspective)))}function Y9(t){t.uniforms.add(new Qt("screenSizePerspectiveAlignment",e=>A4e(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function A4e(t){return ue(Vxt,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const Vxt=M();function R4e(t,e){const i=t.vertex;e.hasVerticalOffset?(P4e(i),e.hasScreenSizePerspective&&(t.include(Ihe),Y9(i),yg(t.vertex,e)),i.code.add(T`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?T`vec3 worldNormal = normalize(worldPos + localOrigin);`:T`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?T`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:T`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(T`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const Gxt=pi();function P4e(t){t.uniforms.add(new Ki("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return Ds(Gxt,n*a,o,r,s)}))}const O4e=.5;function I4e(t,e){t.include(Ihe),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.NORMAL,"vec3"),t.attributes.add(O.CENTEROFFSETANDDISTANCE,"vec4");const i=t.vertex;Pu(i,e),yg(i,e),i.uniforms.add(new Ki("viewport",(r,s)=>s.camera.fullViewport),new et("polygonOffset",r=>r.shaderPolygonOffset),new et("cameraGroundRelative",(r,s)=>s.camera.aboveGround?1:-1)),e.hasVerticalOffset&&P4e(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(T`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(T`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.multipassEnabled?T.float(0):T`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||XO(i),e.draped||(i.uniforms.add(new et("perDistancePixelRatio",(r,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),i.code.add(T`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${T.float(O4e)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&WI(i),e.hasScreenSizePerspective&&Y9(i),i.code.add(T`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?T`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":T`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}function $4e(t,e,i,r,s){let n=(i.screenLength||0)*t.pixelRatio;s!=null&&(n=Sxt(n,r,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return $e(o*e,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function N4e(t,e){const i=e?N4e(e):{};for(const r in t){let s=t[r];s?.forEach&&(s=Hxt(s)),s==null&&r in i||(i[r]=s)}return i}function jxt(t,e){let i=!1;for(const r in e){const s=e[r];s!==void 0&&(Array.isArray(s)?t[r]===null?(t[r]=s.slice(),i=!0):ZMe(t[r],s)&&(i=!0):t[r]!==s&&(i=!0,t[r]=s))}return i}function Hxt(t){const e=[];return t.forEach(i=>e.push(i)),e}const L4e={multiply:1,ignore:2,replace:3,tint:4};let qx=class extends r4{constructor(e,i){super(),this.type=an.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=Fi,this._pp0=Be(0,0,1),this._pp1=Be(0,0,0),this._parameters=N4e(e,i),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){jxt(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bindParameters.decorations===Gc.ON)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository?.materialChanged(this)}queryRenderOccludedState(e){return this.isVisible()&&this.parameters.renderOccluded===e}intersectDraped(e,i,r,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,i,r,this._pp0,this._pp1,n)}},D4e=class extends hvt{constructor(e,i,r){super(i,r),this.camera=e}};var pr;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(pr||(pr={}));let $he=class extends is{constructor(){super(...arguments),this.renderOccluded=pr.Occlude,this.isDecoration=!1}},F4e=class{constructor(){this.factor=new o1e,this.factorAlignment=new o1e}},o1e=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function dyi(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let c=0;c<l;++c)o[i]=s[n[c]],i+=a;else for(let c=0;c<l;++c){const u=s[n[c]];for(let h=0;h<r;h++)o[i]=u,i+=a}}function a1e(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length;i*=o;for(let l=0;l<a;++l){const c=2*s[l];n[i]=r[c],n[i+1]=r[c+1],i+=o}}function k4e(t,e,i,r){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r==null||r===1)for(let c=0;c<l;++c){const u=3*n[c];o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],i+=a}else for(let c=0;c<l;++c){const u=3*n[c];for(let h=0;h<r;++h)o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],i+=a}}function tI(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let c=0;c<l;++c){const u=4*n[c];o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],o[i+3]=s[u+3],i+=a}else for(let c=0;c<l;++c){const u=4*n[c];for(let h=0;h<r;++h)o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],o[i+3]=s[u+3],i+=a}}function l1e(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<i;++n)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=s}function Nhe(t,e,i,r,s=1){if(!e)return void k4e(t,i,r,s);const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length,u=e[0],h=e[1],p=e[2],f=e[4],g=e[5],y=e[6],v=e[8],b=e[9],w=e[10],x=e[12],S=e[13],E=e[14];r*=l;let C=0,R=0,I=0;const F=Rq(e)?D=>{C=n[D]+x,R=n[D+1]+S,I=n[D+2]+E}:D=>{const z=n[D],B=n[D+1],Y=n[D+2];C=u*z+f*B+v*Y+x,R=h*z+g*B+b*Y+S,I=p*z+y*B+w*Y+E};if(s===1)for(let D=0;D<c;++D)F(3*o[D]),a[r]=C,a[r+1]=R,a[r+2]=I,r+=l;else for(let D=0;D<c;++D){F(3*o[D]);for(let z=0;z<s;++z)a[r]=C,a[r+1]=R,a[r+2]=I,r+=l}}function Lhe(t,e,i,r,s=1){if(!e)return void k4e(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,u=o.length,h=a[0],p=a[1],f=a[2],g=a[4],y=a[5],v=a[6],b=a[8],w=a[9],x=a[10],S=!Xle(a),E=1e-6,C=1-E;r*=c;let R=0,I=0,F=0;const D=Rq(a)?z=>{R=n[z],I=n[z+1],F=n[z+2]}:z=>{const B=n[z],Y=n[z+1],W=n[z+2];R=h*B+g*Y+b*W,I=p*B+y*Y+w*W,F=f*B+v*Y+x*W};if(s===1)if(S)for(let z=0;z<u;++z){D(3*o[z]);const B=R*R+I*I+F*F;if(B<C&&B>E){const Y=1/Math.sqrt(B);l[r]=R*Y,l[r+1]=I*Y,l[r+2]=F*Y}else l[r]=R,l[r+1]=I,l[r+2]=F;r+=c}else for(let z=0;z<u;++z)D(3*o[z]),l[r]=R,l[r+1]=I,l[r+2]=F,r+=c;else for(let z=0;z<u;++z){if(D(3*o[z]),S){const B=R*R+I*I+F*F;if(B<C&&B>E){const Y=1/Math.sqrt(B);R*=Y,I*=Y,F*=Y}}for(let B=0;B<s;++B)l[r]=R,l[r+1]=I,l[r+2]=F,r+=c}}function qxt(t,e,i,r,s=1){if(!e)return void tI(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,u=o.length,h=a[0],p=a[1],f=a[2],g=a[4],y=a[5],v=a[6],b=a[8],w=a[9],x=a[10],S=!Xle(a),E=1e-6,C=1-E;if(r*=c,s===1)for(let R=0;R<u;++R){const I=4*o[R],F=n[I],D=n[I+1],z=n[I+2],B=n[I+3];let Y=h*F+g*D+b*z,W=p*F+y*D+w*z,J=f*F+v*D+x*z;if(S){const me=Y*Y+W*W+J*J;if(me<C&&me>E){const L=1/Math.sqrt(me);Y*=L,W*=L,J*=L}}l[r]=Y,l[r+1]=W,l[r+2]=J,l[r+3]=B,r+=c}else for(let R=0;R<u;++R){const I=4*o[R],F=n[I],D=n[I+1],z=n[I+2],B=n[I+3];let Y=h*F+g*D+b*z,W=p*F+y*D+w*z,J=f*F+v*D+x*z;if(S){const me=Y*Y+W*W+J*J;if(me<C&&me>E){const L=1/Math.sqrt(me);Y*=L,W*=L,J*=L}}for(let me=0;me<s;++me)l[r]=Y,l[r+1]=W,l[r+2]=J,l[r+3]=B,r+=c}}function U4e(t,e,i,r,s=1){const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length;if(r*=l,e!==n.length||e!==4)if(s!==1)if(e!==4)for(let u=0;u<c;++u){const h=3*o[u];for(let p=0;p<s;++p)a[r]=n[h],a[r+1]=n[h+1],a[r+2]=n[h+2],a[r+3]=255,r+=l}else for(let u=0;u<c;++u){const h=4*o[u];for(let p=0;p<s;++p)a[r]=n[h],a[r+1]=n[h+1],a[r+2]=n[h+2],a[r+3]=n[h+3],r+=l}else{if(e===4){for(let u=0;u<c;++u){const h=4*o[u];a[r]=n[h],a[r+1]=n[h+1],a[r+2]=n[h+2],a[r+3]=n[h+3],r+=l}return}for(let u=0;u<c;++u){const h=3*o[u];a[r]=n[h],a[r+1]=n[h+1],a[r+2]=n[h+2],a[r+3]=255,r+=l}}else{a[r]=n[0],a[r+1]=n[1],a[r+2]=n[2],a[r+3]=n[3];const u=new Uint32Array(i.typedBuffer.buffer,i.start),h=l/4,p=u[r/=4];r+=h;const f=c*s;for(let g=1;g<f;++g)u[r]=p,r+=h}}function Wxt(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length,l=r[0];i*=o;for(let c=0;c<a;++c)n[i]=l,i+=o}function B4e(t,e,i,r,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(r*=o,s===1)for(let a=0;a<i;++a)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<s;++l)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o}function z4e(t,e,i,r,s,n){for(const o of e.fields.keys()){const a=t.attributes.get(o),l=a?.indices;if(a&&l)Yxt(o,a,i,r,s,n);else if(o===O.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const c=t.attributes.get(O.POSITION)?.indices;if(c){const u=c.length,h=s.getField(o,uc);B4e(t.objectAndLayerIdColor,h,u,n)}}}}function Yxt(t,e,i,r,s,n){switch(t){case O.POSITION:{Tt(e.size===3);const o=s.getField(t,Zo);Tt(!!o,`No buffer view for ${t}`),o&&Nhe(e,i,o,n);break}case O.NORMAL:{Tt(e.size===3);const o=s.getField(t,Zo);Tt(!!o,`No buffer view for ${t}`),o&&Lhe(e,r,o,n);break}case O.NORMALCOMPRESSED:{Tt(e.size===2);const o=s.getField(t,i4);Tt(!!o,`No buffer view for ${t}`),o&&a1e(e,o,n);break}case O.UV0:{Tt(e.size===2);const o=s.getField(t,PC);Tt(!!o,`No buffer view for ${t}`),o&&a1e(e,o,n);break}case O.COLOR:case O.SYMBOLCOLOR:{const o=s.getField(t,uc);Tt(!!o,`No buffer view for ${t}`),Tt(e.size===3||e.size===4),!o||e.size!==3&&e.size!==4||U4e(e,e.size,o,n);break}case O.COLORFEATUREATTRIBUTE:{const o=s.getField(t,P9);Tt(!!o,`No buffer view for ${t}`),Tt(e.size===1),o&&e.size===1&&Wxt(e,o,n);break}case O.TANGENT:{Tt(e.size===4);const o=s.getField(t,_g);Tt(!!o,`No buffer view for ${t}`),o&&qxt(e,i,o,n);break}case O.PROFILERIGHT:case O.PROFILEUP:case O.PROFILEVERTEXANDNORMAL:case O.FEATUREVALUE:{Tt(e.size===4);const o=s.getField(t,_g);Tt(!!o,`No buffer view for ${t}`),o&&tI(e,o,n)}}}let pyi=class extends is{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function Xxt(t,e){V4e(t,e,new Qt("slicePlaneOrigin",(i,r)=>q4e(e,i,r)),new Qt("slicePlaneBasis1",(i,r)=>b8(e,i,r,r.slicePlane?.basis1)),new Qt("slicePlaneBasis2",(i,r)=>b8(e,i,r,r.slicePlane?.basis2)))}function Wn(t,e){V4e(t,e,new Vd("slicePlaneOrigin",(i,r)=>q4e(e,i,r)),new Vd("slicePlaneBasis1",(i,r)=>b8(e,i,r,r.slicePlane?.basis1)),new Vd("slicePlaneBasis2",(i,r)=>b8(e,i,r,r.slicePlane?.basis2)))}function V4e(t,e,...i){if(!e.hasSlicePlane){const o=T`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...i),t.fragment.uniforms.add(...i);const r=T`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=T`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?T`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:T`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(r),t.fragment.code.add(r),t.fragment.code.add(n)}function G4e(t,e,i){return t.instancedDoublePrecision?ue(Zxt,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function j4e(t,e){return t!=null?Me(w8,e.origin,t):e.origin}function H4e(t,e,i){return t.hasSliceTranslatedView?e!=null?ac(Jxt,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function q4e(t,e,i){if(i.slicePlane==null)return co;const r=G4e(t,e,i),s=j4e(r,i.slicePlane),n=H4e(t,r,i);return n!=null?nt(w8,s,n):s}function b8(t,e,i,r){if(r==null||i.slicePlane==null)return co;const s=G4e(t,e,i),n=j4e(s,i.slicePlane),o=H4e(t,s,i);return o!=null?(Te(t3,r,n),nt(w8,n,o),nt(t3,t3,o),Me(t3,t3,w8)):r}const Zxt=M(),w8=M(),t3=M(),Jxt=Ne();function NC(t,e){const i=e.output===G.ObjectAndLayerIdColor,r=e.objectAndLayerIdColorInstanced;i&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),r?t.attributes.add(O.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(O.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(T`
     void forwardObjectAndLayerIdColor() {
      ${i?r?T`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:T`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:T``} }`),t.fragment.code.add(T`
      void outputObjectAndLayerIdColor() {
        ${i?T`fragColor = objectAndLayerIdColorVarying;`:T``} }`)}function X9(t){t.uniforms.add(new a0("alignPixelEnabled",(e,i)=>i.alignPixelEnabled)),t.code.add(T`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(T`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function Qxt(t,e){const{vertex:i,fragment:r}=t;i.include(X9),e.multipassEnabled&&t.varyings.add("depth","float"),i.code.add(T`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.include(V0,e),r.code.add(T`
  void main() {
    fragColor = vec4(1);
    ${e.multipassEnabled?T`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}function W4e(t){t.vertex.uniforms.add(new et("renderTransparentlyOccludedHUD",(e,i)=>i.hudRenderStyle===Su.Occluded?1:i.hudRenderStyle===Su.NotOccluded?0:.75),new Ki("viewport",(e,i)=>i.camera.fullViewport),new Et("hudVisibilityTexture",(e,i)=>i.hudVisibility?.getTexture())),t.vertex.include(X9),t.vertex.code.add(T`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}const Y4e=ni(1,1,0,1),Dhe=ni(1,0,1,1);function Wx(t){t.fragment.uniforms.add(new Et("depthTexture",(e,i)=>i.mainDepth)),t.fragment.constants.add("occludedHighlightFlag","vec4",Y4e).add("unoccludedHighlightFlag","vec4",Dhe),t.fragment.code.add(T`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let X4e=class extends hn{constructor(e,i,r){super(e,"vec4",ar.Pass,(s,n,o)=>s.setUniform4fv(e,i(n,o)),r)}},jc=class extends hn{constructor(e,i,r){super(e,"float",ar.Pass,(s,n,o)=>s.setUniform1fv(e,i(n,o)),r)}},l4=class extends C4e{constructor(){super(...arguments),this.renderOccluded=pr.Occlude,this.isDecoration=!1}};const jP=8;function $v(t,e){const{vertex:i,attributes:r}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&r.add(O.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(i.uniforms.add(new Qt("vvSizeMinSize",s=>s.vvSize.minSize)),i.uniforms.add(new Qt("vvSizeMaxSize",s=>s.vvSize.maxSize)),i.uniforms.add(new Qt("vvSizeOffset",s=>s.vvSize.offset)),i.uniforms.add(new Qt("vvSizeFactor",s=>s.vvSize.factor)),i.uniforms.add(new bf("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),i.uniforms.add(new Qt("vvSymbolAnchor",s=>s.vvSymbolAnchor)),i.code.add(T`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(T`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?T`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(T`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(i.constants.add("vvColorNumber","int",jP),i.uniforms.add(new jc("vvColorValues",s=>s.vvColor.values,jP),new X4e("vvColorColors",s=>s.vvColor.colors,jP)),i.code.add(T`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?T`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):i.code.add(T`vec4 vvColor() { return vec4(1.0); }`)}const x8=.1,Ba=.001;function Kxt(t){const e=new tr,i=t.signedDistanceFieldEnabled;if(e.include(I4e,t),e.include(Wn,t),t.occlusionPass)return e.include(Qxt,t),e;const{vertex:r,fragment:s}=e;e.include(Ihe),s.include(Cg),s.include(B0),e.include($v,t),e.include(NC,t),e.include(W4e),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),e.varyings.add("voccluded","float"),r.uniforms.add(new Ki("viewport",(c,u)=>u.camera.fullViewport),new os("screenOffset",(c,u)=>Gi(Z4e,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new os("anchorPosition",c=>S8(c)),new Ki("materialColor",c=>c.color)),WI(r),i&&(r.uniforms.add(new Ki("outlineColor",c=>c.outlineColor)),s.uniforms.add(new Ki("outlineColor",c=>c1e(c)?c.outlineColor:Ud),new et("outlineSize",c=>c1e(c)?c.outlineSize:0))),t.pixelSnappingEnabled&&r.include(X9),t.hasScreenSizePerspective&&(zxt(r),Y9(r)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.COLOR,"vec4"),e.attributes.add(O.SIZE,"vec2"),e.attributes.add(O.FEATUREATTRIBUTE,"vec4"),r.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?T`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:T`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const n=T`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?i?T`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:T`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:T`posProj += quadOffset;`;r.code.add(T`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===G.ObjectAndLayerIdColor?T`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${T.float(Ba)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${T.float(Ba)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?T`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new Et("tex",c=>c.texture));const a=t.debugDrawLabelBorder?T`(isBorder > 0.0 ? 0.0 : ${T.float(x8)})`:T.float(x8),l=T`
    ${t.debugDrawLabelBorder?T`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${t.sampleSignedDistanceFieldTexelCenter?T`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:T`
      vec2 samplePos = vtc;
      `}

    ${i?T`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${T.float(Ba)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:T`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?T`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(t.output){case G.Color:t.transparencyPassType===mt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),s.code.add(T`
        void main() {
          ${l}
          ${t.transparencyPassType===mt.FrontFace?"fragColor.rgb /= fragColor.a;":""}
          ${t.transparencyPassType===mt.ColorAlpha?"fragAlpha = fragColor.a;":""}
        }`);break;case G.ObjectAndLayerIdColor:s.code.add(T`
        void main() {
          ${l}
          outputObjectAndLayerIdColor();
        }`);break;case G.Highlight:s.constants.add("occludedHighlightFlag","vec4",Y4e),s.constants.add("unoccludedHighlightFlag","vec4",Dhe),s.code.add(T`
        void main() {
          ${l}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return e}function c1e(t){return t.outlineColor[3]>0&&t.outlineSize>0}function S8(t,e=Z4e){return t.textureIsSignedDistanceField?eSt(t.anchorPosition,t.distanceFieldBoundingBox,e):Cl(e,t.anchorPosition),e}function eSt(t,e,i){e!=null?Gi(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):Gi(i,0,0)}const Z4e=vt(),tSt=Object.freeze(Object.defineProperty({__proto__:null,build:Kxt,calculateAnchorPosForRendering:S8},Symbol.toStringTag,{value:"Module"})),Ch=Za(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),iSt=Za(ke.ONE,ke.ZERO,ke.ONE,ke.ONE_MINUS_SRC_ALPHA);function c1(t){return t===mt.FrontFace?null:iSt}function Z9(t){return t===mt.FrontFace?Oh:null}const J9=5e5,Q9={factor:-1,units:-2};function K9(t){return t?Q9:null}function Yx(t,e=Lr.LESS){return t===mt.NONE||t===mt.FrontFace?e:Lr.LEQUAL}function u1(t){return t===mt.ColorAlpha?{buffers:[So.COLOR_ATTACHMENT0,So.COLOR_ATTACHMENT1]}:null}let J4e=class Q4e extends hr{initializeConfiguration(e,i){i.spherical=e.viewingMode===Xe.Global}initializeProgram(e){return new dr(e.rctx,Q4e.shader.get().build(this.configuration),Fi)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===mt.NONE,s=e===mt.FrontFace,n=this.configuration.hasPolygonOffset?rSt:null,o=i.draped?null:(r||s)&&i.output!==G.Highlight&&(i.depthEnabled||i.occlusionPass)?Oh:null;return ti({blending:i.output===G.Color||i.output===G.Highlight?r?sSt:c1(e):null,depthTest:i.draped?null:{func:Lr.LEQUAL},depthWrite:o,drawBuffers:u1(e),colorWrite:fi,polygonOffset:n})}get primitiveType(){return this.configuration.occlusionPass?Li.POINTS:Li.TRIANGLES}};J4e.shader=new ir(tSt,()=>ye(()=>import("./HUDMaterial.glsl-f2b59a0c.js"),[],import.meta.url));const rSt={factor:0,units:-4},sSt=Zd(ke.ONE,ke.ONE_MINUS_SRC_ALPHA);let Vn=class extends $u{constructor(){super(...arguments),this.output=G.Color,this.transparencyPassType=mt.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};d([V({count:G.COUNT})],Vn.prototype,"output",void 0),d([V({count:mt.COUNT})],Vn.prototype,"transparencyPassType",void 0),d([V()],Vn.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([V()],Vn.prototype,"spherical",void 0),d([V()],Vn.prototype,"occlusionTestEnabled",void 0),d([V()],Vn.prototype,"signedDistanceFieldEnabled",void 0),d([V()],Vn.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),d([V()],Vn.prototype,"vvSize",void 0),d([V()],Vn.prototype,"vvColor",void 0),d([V()],Vn.prototype,"hasVerticalOffset",void 0),d([V()],Vn.prototype,"hasScreenSizePerspective",void 0),d([V()],Vn.prototype,"debugDrawLabelBorder",void 0),d([V()],Vn.prototype,"hasSlicePlane",void 0),d([V()],Vn.prototype,"hasPolygonOffset",void 0),d([V()],Vn.prototype,"depthEnabled",void 0),d([V()],Vn.prototype,"pixelSnappingEnabled",void 0),d([V()],Vn.prototype,"draped",void 0),d([V()],Vn.prototype,"multipassEnabled",void 0),d([V()],Vn.prototype,"cullAboveGround",void 0),d([V()],Vn.prototype,"occlusionPass",void 0),d([V()],Vn.prototype,"objectAndLayerIdColorInstanced",void 0),d([V({constValue:!0})],Vn.prototype,"hasSliceInVertexProgram",void 0),d([V({constValue:!1})],Vn.prototype,"hasVvInstancing",void 0);let iI=class extends qx{constructor(e){super(e,new mSt),this._configuration=new Vn,this.produces=new Map([[Ce.HUD_MATERIAL,i=>cG(i)&&!this.parameters.drawInSecondSlot],[Ce.LABEL_MATERIAL,i=>cG(i)&&this.parameters.drawInSecondSlot],[Ce.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[Ce.DRAPED_MATERIAL,i=>cG(i)]])}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===Ce.OCCLUSION_PIXELS&&this.parameters.occlusionTest,e===G.Color&&(this._configuration.debugDrawLabelBorder=!!ts.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(e,i,r,s,n,o){if(!(r.options.selectionMode&&r.options.hud&&e.visible&&r.point))return;const a=this.parameters,l=r.point,c=r.camera;let{scaleX:u,scaleY:h}=this._getScreenScale(e);u*=c.pixelRatio,h*=c.pixelRatio,vf(lX,i),e.attributes.has(O.FEATUREATTRIBUTE)&&aSt(lX);const p=e.attributes.get(O.POSITION),f=e.attributes.get(O.SIZE),g=e.attributes.get(O.NORMAL),y=e.attributes.get(O.CENTEROFFSETANDDISTANCE);Tt(p.size>=3);const v=S8(a),b=this.parameters.centerOffsetUnits==="screen";for(let w=0;w<p.data.length/p.size;w++){const x=w*p.size;ue(Il,p.data[x],p.data[x+1],p.data[x+2]),nt(Il,Il,i);const S=w*f.size;z1[0]=f.data[S]*u,z1[1]=f.data[S+1]*h,nt(Il,Il,c.viewMatrix);const E=w*y.size;if(ue(zh,y.data[E],y.data[E+1],y.data[E+2]),!b&&(Il[0]+=zh[0],Il[1]+=zh[1],zh[2]!==0)){const R=zh[2];Se(zh,Il),Me(Il,Il,ce(zh,zh,R))}const C=w*g.size;if(ue(i3,g.data[C],g.data[C+1],g.data[C+2]),u1e(i3,lX,c,cX),this._applyVerticalOffsetTransformationView(Il,cX,c,aX),c.applyProjection(Il,yc),yc[0]>-1){b&&(zh[0]||zh[1])&&(yc[0]+=zh[0]*c.pixelRatio,zh[1]!==0&&(yc[1]+=Rhe(zh[1],aX.factorAlignment)*c.pixelRatio),c.unapplyProjection(yc,Il)),yc[0]+=this.parameters.screenOffset[0]*c.pixelRatio,yc[1]+=this.parameters.screenOffset[1]*c.pixelRatio,yc[0]=Math.floor(yc[0]),yc[1]=Math.floor(yc[1]),w4e(z1,aX.factor,z1);const R=dSt*c.pixelRatio;let I=0;if(a.textureIsSignedDistanceField&&(I=a.outlineSize*c.pixelRatio/2),h1e(l,yc[0],yc[1],z1,R,I,a,v)){const F=r.ray;if(nt(d1e,Il,Ao(cSt,c.viewMatrix)),yc[0]=l[0],yc[1]=l[1],c.unprojectFromRenderScreen(yc,Il)){const D=M();ge(D,F.direction);const z=1/De(D);ce(D,D,z),o(jr(F.origin,Il)*z,D,-1,!0,1,d1e)}}}}}intersectDraped(e,i,r,s,n,o){const a=e.attributes.get(O.POSITION),l=e.attributes.get(O.SIZE),c=this.parameters,u=S8(c);let{scaleX:h,scaleY:p}=this._getScreenScale(e);h*=e.screenToWorldRatio,p*=e.screenToWorldRatio;const f=pSt*e.screenToWorldRatio;for(let g=0;g<a.data.length/a.size;g++){const y=g*a.size,v=a.data[y],b=a.data[y+1],w=g*l.size;z1[0]=l.data[w]*h,z1[1]=l.data[w+1]*p;let x=0;c.textureIsSignedDistanceField&&(x=c.outlineSize*e.screenToWorldRatio/2),h1e(s,v,b,z1,f,x,c,u)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new ySt(this)}_updateScaleInfo(e,i,r){const s=this.parameters;s.screenSizePerspective!=null?e1e(r,i,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),s.screenSizePerspectiveAlignment!=null?e1e(r,i,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,i,r,s,n,o,a){const l=u1e(i,r,n,cX);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,i,r,s,n){return this._applyCenterOffsetNDC(e,i,r,s),n!=null&&ge(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(e,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ge(n,e);const c=$e(Math.abs(i.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/s.viewport[2];return ce(n,e,l>0?u:1/u),n}_applyVerticalGroundOffsetView(e,i,r,s){const n=De(e),o=r.aboveGround?1:-1,a=r.computeRenderPixelSizeAtDist(n)*O4e,l=ce(Il,i.normal,o*a);return Te(s,e,l),s}_applyVerticalOffsetTransformationView(e,i,r,s){const n=this.parameters;if(!n.verticalOffset?.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=De(e);this._updateScaleInfo(s,c,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=De(e),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=$4e(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),ce(i.normal,i.normal,l),Te(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==e&&ge(r,e),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(Se(i3,r),Te(r,r,ce(i3,i3,i[2])))),r}_applyCenterOffsetNDC(e,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&ge(s,e),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,i,r,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&ge(s,e),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}createGLMaterial(e){return new nSt(e)}calculateRelativeScreenBounds(e,i,r=li()){return oSt(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e){const i=e.attributes.get(O.FEATUREATTRIBUTE);if(i==null)return{scaleX:1,scaleY:1};const r=bF(i.data,hSt),[s,n]=Ohe(uSt,this.parameters,r);return{scaleX:s,scaleY:n}}},nSt=class extends Gue{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(J4e,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function oSt(t,e,i,r){r[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*i,r[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*i}function u1e(t,e,i,r){return Mxt(e)&&(e=vf(lSt,e)),Ga(r.normal,t,e),nt(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=xe(K4e,fSt),r}function aSt(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=1/Math.sqrt(e*e+i*i+r*r),h=1/Math.sqrt(s*s+n*n+o*o),p=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*u,t[1]=i*u,t[2]=r*u,t[3]=s*h,t[4]=n*h,t[5]=o*h,t[6]=a*p,t[7]=l*p,t[8]=c*p,t}function h1e(t,e,i,r,s,n,o,a){let l=e-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,u=i-s-(a[1]>0?r[1]*a[1]:0),h=u+r[1]+2*s;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&p!=null&&(l+=r[0]*p[0],u+=r[1]*p[1],c-=r[0]*(1-p[2]),h-=r[1]*(1-p[3]),l-=n,c+=n,u-=n,h+=n),t[0]>l&&t[0]<c&&t[1]>u&&t[1]<h}const aX=new F4e,Il=M(),i3=M(),yc=pi(),K4e=M(),d1e=M(),lX=ps(),lSt=ps(),cSt=Ne(),zh=M(),uSt=M(),hSt=pi(),cX={normal:K4e,cosAngle:0},dSt=1,pSt=2,z1=[0,0],fSt=Be(0,0,1);class mSt extends oFe{constructor(){super(...arguments),this.renderOccluded=pr.Occlude,this.isDecoration=!1,this.color=ni(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Ni(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=ni(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1}}const eUe=Xs().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4u8(O.COLOR).vec2f(O.SIZE).vec4f(O.CENTEROFFSETANDDISTANCE).vec4f(O.FEATUREATTRIBUTE),gSt=eUe.clone().vec4u8(O.OBJECTANDLAYERIDCOLOR);let ySt=class{constructor(e){this._material=e,this.vertexBufferLayout=ae("enable-feature:objectAndLayerId-rendering")?gSt:eUe}elementCount(e){return 6*e.attributes.get(O.POSITION).indices.length}write(e,i,r,s,n){Nhe(r.attributes.get(O.POSITION),e,s.position,n,6),Lhe(r.attributes.get(O.NORMAL),i,s.normal,n,6);const o=r.attributes.get(O.UV0).data;let a,l,c,u;if(o==null||o.length<4){const b=this._material.parameters;a=0,l=0,c=b.texCoordScale[0],u=b.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let h=r.attributes.get(O.POSITION).indices.length,p=n;const f=s.uv0;for(let b=0;b<h;++b)f.set(p,0,a),f.set(p,1,l),p++,f.set(p,0,c),f.set(p,1,l),p++,f.set(p,0,c),f.set(p,1,u),p++,f.set(p,0,c),f.set(p,1,u),p++,f.set(p,0,a),f.set(p,1,u),p++,f.set(p,0,a),f.set(p,1,l),p++;U4e(r.attributes.get(O.COLOR),4,s.color,n,6);const{data:g,indices:y}=r.attributes.get(O.SIZE);h=y.length;const v=s.size;p=n;for(let b=0;b<h;++b){const w=g[2*y[b]],x=g[2*y[b]+1];for(let S=0;S<6;++S)v.set(p,0,w),v.set(p,1,x),p++}if(r.attributes.get(O.CENTEROFFSETANDDISTANCE)?tI(r.attributes.get(O.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,n,6):l1e(s.centerOffsetAndDistance,n,6*h),r.attributes.get(O.FEATUREATTRIBUTE)?tI(r.attributes.get(O.FEATUREATTRIBUTE),s.featureAttribute,n,6):l1e(s.featureAttribute,n,6*h),r.objectAndLayerIdColor!=null){const b=r.attributes.get(O.POSITION)?.indices;if(b){const w=b.length,x=s.getField(O.OBJECTANDLAYERIDCOLOR,uc);B4e(r.objectAndLayerIdColor,x,w,n,6)}}}};const $g=M(),wM=pi(),r3=pi(),uX=M(),_St=Ne(),vSt=Bn(),hX=jo(),bSt=M(),wSt=li();class xSt{constructor(){this.aabr=li(),this.distance=0,this.culled=!1,this.visible=!1}}class SSt{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this.info={}}}var th;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(th||(th={}));class TSt{constructor(){this.camera=new Kr,this.slicePlane=i1(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),bC(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let XR=class extends Fe{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._viewState=new TSt,this._state=th.Idle,this._active=new Map,this._visible=new Map,this._iterators=new ASt,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==th.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/th.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case th.Idle:this._startUpdate(),t.madeProgress();case th.Process:if(this._state=th.Process,!this._processActiveGraphics(t))return;case th.Sort:if(this._state=th.Sort,!this._sortVisibleGraphics(t))return;case th.Deconflict:if(this._state=th.Deconflict,!this._deconflictVisibleGraphics(t))return;default:gxt(this,this._visible),this._state=th.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;return(e?.geometries.length??0)!==1?!1:e?.geometries[0]?.material instanceof iI}_startUpdate(){yxt(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._viewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new xSt,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),ESt(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=Ox(_St,this._viewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._viewState.camera.relativeElevation>0?vSt:null;let s=0;for(r!=null&&(nt(r,co,this._viewState.camera.viewMatrix),r[3]=$r(this.view.spatialReference).radius,s=C3e(r,co));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o?.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const i=e.next();if(t.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===fa.LABEL;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled){this._setGraphicVisibility(s,!1);continue}const o=s.graphics3DGraphic,a=!i||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),vxt(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=p1e(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=p1e(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=CSt(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,i,r){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(fa.GRAPHIC,yl.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);Hd(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=ISt,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,$g)||i!=null&&OSt(a,i,r)))return void(n.culled=!0);this._expandBoundingRect(n,l,c,a)}a==null?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,i){const r=this._viewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;nt($g,a,r.viewMatrix);const l=n.attributes,c=l.get(O.NORMAL).data,u=l.get(O.CENTEROFFSETANDDISTANCE).data;o.applyShaderOffsetsView($g,c,s.transformation,u,r,i.scaleInfo,$g),Ds(wM,$g[0],$g[1],$g[2],1),xh(r3,wM,r.projectionMatrix),ce(i.positionNDC,r3,1/r3[3]),o.applyShaderOffsetsNDC(i.positionNDC,u,r,i.positionNDC,uX),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(uX[2]),i.distance=uX[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),Ds(r3,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),xh(wM,r3,e),UE(wM,wM,1/wM[3]),ue(i.positionView,$g[0],$g[1],$g[2])}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&zce(this._viewState.slicePlane,e)}_expandBoundingRect(t,e,i,{positionNDC:r,scaleInfo:s}){const n=this._viewState.camera,o=e.getScreenSize(RSt);w4e(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=mj(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,wSt),Wt(0,n.fullWidth,.5+.5*r[0]),Wt(0,n.fullHeight,.5+.5*r[1])),l=this.marginFactor;if(l!==0){const c=l*Math.min(Kl(a),Au(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}Iw(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,i=t.info[this.visibilityGroup];let r=!0;for(let s=Math.floor(i.aabr[0]/this._accBinsSizeX);s<=Math.floor(i.aabr[2]/this._accBinsSizeX);s++)if(!(s<0||s>=this._accBinsNumX))for(let n=Math.floor(i.aabr[1]/this._accBinsSizeY);n<=Math.floor(i.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;r=!1;const o=this._accBins[s][n];for(let a=0;a<o.length;a++){const l=o.data[a],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,Nq(c.aabr,i.aabr)))return!0}}return r}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)r.push(new ci)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],i=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const i=t.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(this.visibilityGroup,yl.DECONFLICTION,e),this.visibilityGroup===fa.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function ESt(t,e){const i=t.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(e,yl.DECONFLICTION,!0)}function*p1e(t){if(Map.prototype.entries){const e=t.entries();for(let i=e.next();!i.done;i=e.next())yield i.value[1]}else yield*t.values()}function*CSt(t,e,i){e.clear(),t.forEach((s,n)=>{const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(i,yl.DECONFLICTION);const a=s.info?.[i];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const r=e.iterableSort((s,n)=>s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?s.visible?-1:1:s.id-n.id);for(let s=r.next();!s.done;s=r.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}d([m({constructOnly:!0})],XR.prototype,"view",void 0),d([m({type:Boolean,readOnly:!0})],XR.prototype,"updating",null),XR=d([N("esri.views.3d.layers.graphics.Deconflictor")],XR);class MSt{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class ASt{constructor(e=null,i=null,r=null){this.active=e,this.visible=i,this.sort=r,this.sortArray=new ci({allocator:s=>s||new MSt})}}const RSt=vt();class PSt{constructor(){this.positionView=M(),this.positionNDC=M(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new F4e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}function OSt(t,e,i){return ge(hX.direction,t.positionView),ue(hX.origin,0,0,0),!!Lx(e,hX,bSt)&&t.distanceWithoutPolygonOffset>i}const ISt=new PSt,$St=2e3;let wG=class extends XR{constructor(e){super(e),this.visibilityGroup=fa.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return Wa;const i=performance.now();if(e.state!==zi.IDLE&&i-this._lastDeconfliction<$St)return Wa;super.runTask(e),this.state===th.Idle&&(this._lastDeconfliction=i)}enabledChanged(e,i){this.modifyGraphics(i,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};d([m({constructOnly:!0})],wG.prototype,"parent",void 0),wG=d([N("esri.views.3d.layers.graphics.LabelDeconflictor")],wG);let cse=class extends XR{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=fa.GRAPHIC,this._marginFactor=-.1,this.test={overrideMarginFactor:e=>{this._marginFactor=e,this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([_e(()=>this.view?.state?.camera,()=>{this._updateViewState(),this.setDirty()}),_e(()=>this.view?.map?.ground?.opacity,(e,i)=>{e!==1&&i!==1||this.setDirty()}),_e(()=>this.view?.slicePlane,()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Ir)]),this._frameTask=this.view.resourceController.scheduler.registerTask(Ut.GRAPHICS_DECONFLICTOR,this),this._labels=new wG({view:this.view,parent:this})}destroy(){this._labels=Ge(this._labels),this._frameTask=Zr(this._frameTask)}get marginFactor(){return this._marginFactor}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&_3e(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){Pd(this._contexts,(e,i)=>i.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labels.enabledChanged(e,i),featureReductionChange:()=>this.enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const s=r.graphic.uid,n=new SSt(r,e.symbolCreationContext.slicePlaneEnabled);i.set(s,n),dX(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n);const o=!this._graphicSupportsDeconfliction(r)||!dX(e);r.setVisibilityFlag(fa.GRAPHIC,yl.DECONFLICTION,o)}_removeGraphic(e,i){const r=i.graphic.uid,s=e.get(r);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(r),this.setDirty())}enabledChanged(e,i){const r=dX(e);r||NSt(e),this.modifyGraphics(i,r)}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(s=>s.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!i?.length)return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function dX(t){const e=t.layer;return!(!e?.featureReduction||e.featureReduction.type!=="selection")}function NSt(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.setVisibilityFlag(fa.GRAPHIC,yl.DECONFLICTION,!0))}cse=d([N("esri.views.3d.layers.graphics.GraphicsDeconflictor")],cse);function tUe(t){return"declaredClass"in t}function f1e(t){return"declaredClass"in t}function LSt(t){return"declaredClass"in t}function DSt(t,e){return t?LSt(t)?t:new fg({layer:e,sourceLayer:e,visible:t.visible,symbol:ee(t.symbol),attributes:ee(t.attributes),geometry:iUe(t.geometry)}):null}function iUe(t){return t==null?null:tUe(t)?t:Vv(FSt(t))}function FSt(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t.spatialReference,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};switch(t.type){case"point":{const{x:o,y:a,z:l,m:c}=t;return{x:o,y:a,z:l,m:c,spatialReference:n}}case"polygon":{const{rings:o,hasZ:a,hasM:l}=t;return{rings:m1e(o),hasZ:a,hasM:l,spatialReference:n}}case"polyline":{const{paths:o,hasZ:a,hasM:l}=t;return{paths:m1e(o),hasZ:a,hasM:l,spatialReference:n}}case"extent":{const{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:h,mmin:p,mmax:f,hasZ:g,hasM:y}=t;return{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:h,mmin:p,mmax:f,hasZ:g,hasM:y,spatialReference:n}}case"multipoint":{const{points:o,hasZ:a,hasM:l}=t;return{points:sUe(o)?rUe(o):o,hasZ:a,hasM:l,spatialReference:n}}default:return}}function m1e(t){return kSt(t)?t.map(e=>rUe(e)):t}function rUe(t){return t.map(e=>Array.from(e))}function kSt(t){for(const e of t)if(e.length!==0)return sUe(e);return!1}function sUe(t){return t.length>0&&(yk(t[0])||_k(t[0]))}function USt(t,e){if(!t)return null;let i;if(f1e(t)){if(e==null)return t.clone();if(f1e(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=Dx(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function Tyi(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};return Je.fromJSON(n)}const Fhe="__begin__",khe="__end__",BSt=new RegExp(Fhe,"ig"),zSt=new RegExp(khe,"ig"),g1e=new RegExp("^"+Fhe,"i"),y1e=new RegExp(khe+"$","i"),T8='"',VSt=T8+" + ",GSt=" + "+T8;function jSt(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function HSt(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function e7(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=jSt(t.labelExpression),e.type="conventional"),e}function qSt(t){const e=e7(t);if(!e)return null;switch(e.type){case"conventional":return use(e.expression);case"arcade":return e.expression}return null}function WSt(t){const e=e7(t);if(!e)return null;switch(e.type){case"conventional":return XSt(e.expression);case"arcade":return Uhe(e.expression)}return null}function use(t){let e;return t?(e=oq(t,i=>Fhe+'$feature["'+i+'"]'+khe),e=g1e.test(e)?e.replace(g1e,""):T8+e,e=y1e.test(e)?e.replace(y1e,""):e+T8,e=e.replaceAll(BSt,VSt).replaceAll(zSt,GSt)):e='""',e}const YSt=/^\s*\{([^}]+)\}\s*$/i;function XSt(t){return t?.match(YSt)?.[1].trim()||null}const ZSt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,JSt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,QSt=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function Uhe(t){if(!t)return null;let e=ZSt.exec(t)||JSt.exec(t);return e?e[1]||e[3]:(e=QSt.exec(t),e?e[2]:null)}const pX=()=>oe.getLogger("esri.layers.support.labelFormatUtils"),fX={type:"simple",evaluate:()=>null},KSt={getAttribute:(t,e)=>t.field(e)};async function eTt(t,e,i){if(!t||!t.symbol||!e)return fX;const r=t.where,s=e7(t);let n;if(s.type==="arcade"){const o=await apt(s.expression,i,e);if(o==null)return fX;n={type:"arcade",evaluate(a,l){try{const c="attributes"in a?o.repurposeFeature(a):a;c.contextTimeZone=l??null;const u=o.evaluate({$view:{timeZone:l},$feature:c},o.services);if(u!=null)return u.toString()}catch(c){pX().error(new j("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:a,expression:s}))}return null},needsHydrationToEvaluate:()=>Uhe(s.expression)==null}}else n={type:"simple",evaluate:o=>s.expression.replaceAll(/{[^}]*}/g,a=>{const l=a.slice(1,-1),c=e.get(l);if(!c)return a;let u=null;return"attributes"in o?o&&o.attributes&&(u=o.attributes[c.name]):u=o.field(c.name),u==null?"":tTt(u,c)})};if(r){let o;try{o=await lue(r,e)}catch(l){return pX().error(new j("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:l})),fX}const a=n.evaluate;n.evaluate=(l,c)=>{const u="attributes"in l?void 0:KSt;try{if(o.testFeature(l,u))return a(l,c)}catch(h){pX().error(new j("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:l,error:h}))}return null}}return n}function tTt(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=t;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const{max:s,min:n}=nLe(e),o=+t;if(n!=null&&s!=null&&n<=o&&o<=s)return i.name}}let r=t;return fLe(e)?r=ex(r,wst("short-date")):pue(e)&&(r=vF(+r)),r||""}function nUe(t,e,i,r,s,n,o,a,l,c,u){const h=lTt[u.mode];let p,f,g=0;if(Ts(t,e,i,r,l.spatialReference,s,a))return h.requiresAlignment(u)?(g=h.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,u),p=n,f=o):(p=r,f=s),Ts(p,l.spatialReference,f,n,c.spatialReference,o,a)?g:void 0}function _x(t,e,i,r,s){const n=(zj(t)?t.z:MNe(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const o=Wy(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=Wy(e,t,"ground")??0,a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=Wy(e,t,"scene")??0,a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=Wy(e,t,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function iTt(t,e,i,r){return _x(t,e,i,r,ZR),ZR.z}function c4(t,e,i){return e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?e==null||i==null?t.definedChanged:cn.UPDATE:t.onTheGroundChanged}function mf(t){return t==="relative-to-ground"||t==="relative-to-scene"}function vx(t){return t!=="absolute-height"}function oUe(t,e,i,r,s){_x(e,i,s,r,ZR),aUe(t,ZR.verticalDistanceToGround);const n=ZR.sampledElevation,o=Xn(cTt,t.transformation);return I5[0]=e.x,I5[1]=e.y,I5[2]=ZR.z,Bd(e.spatialReference,I5,o,r.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function aUe(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute(O.CENTEROFFSETANDDISTANCE);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[i],O.CENTEROFFSETANDDISTANCE))}}function rTt(t,e,i,r,s,n){let o=0;const a=n.spatialReference;e*=3,r*=3;for(let l=0;l<s;++l){const c=t[e],u=t[e+1],h=t[e+2],p=n.getElevation(c,u,h,a,"ground")??0;o+=p,i[r]=c,i[r+1]=u,i[r+2]=p,e+=3,r+=3}return o/s}function sTt(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=n.spatialReference;e*=3,r*=3;for(let p=0;p<s;++p){const f=t[e],g=t[e+1],y=t[e+2],v=n.getElevation(f,g,y,h,"ground")??0;l+=v,i[r]=f,i[r+1]=g,i[r+2]=u==null?y+v+c:v+c,e+=3,r+=3}return l/s}function nTt(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=n.spatialReference;e*=3,r*=3;for(let p=0;p<s;++p){const f=t[e],g=t[e+1],y=t[e+2],v=n.getElevation(f,g,y,h,"scene")??0;l+=v,i[r]=f,i[r+1]=g,i[r+2]=u==null?y+v+c:v+c,e+=3,r+=3}return l/s}function oTt(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function aTt(t,e,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,r*=3;for(let u=0;u<s;++u){const h=t[e],p=t[e+1],f=t[e+2];i[r]=h,i[r+1]=p,i[r+2]=c==null?f+l:l,e+=3,r+=3}return 0}let u4=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var cn;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(cn||(cn={}));const lTt={"absolute-height":{applyElevationAlignmentBuffer:aTt,requiresAlignment:oTt},"on-the-ground":{applyElevationAlignmentBuffer:rTt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:sTt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:nTt,requiresAlignment:()=>!0}},cTt=Ne(),ZR=new u4,I5=M();function Bhe(t){return t.mapPositions!=null}function lUe(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!Bhe(l))continue;const{update:c,averageGeometrySampledElevation:u}=uUe(l,e,i,r,s);a+=u,c&&n.geometryVertexAttributeUpdated(l,O.POSITION)}return a/o.length}function uE(t,e,i,r,s,n){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(r(a,Cu),aUe(o,Cu.verticalDistanceToGround),l=Cu.sampledElevation):(r(a,Cu),e.mode!=="absolute-height"&&(l=Cu.sampledElevation));const c=Xn(uTt,n??o.transformation),u=ue(cUe,c[12],c[13],c[14]);ts.TESTS_DISABLE_OPTIMIZATIONS?(Eu[0]=a.x,Eu[1]=a.y,Eu[2]=Cu.z,Bd(a.spatialReference,Eu,c,s.spatialReference)&&(n?Xn(n,c):o.transformation=c)):s.setAltitudeOfTransformation(Cu.z,c);const h=zhe/s.unitInMeters;return(Math.abs(c[12]-u[0])>=h||Math.abs(c[13]-u[1])>=h||Math.abs(c[14]-u[2])>=h)&&(n?Xn(n,c):o.transformation=c),l}const uTt=Ne();function hTt(t,e,i,r,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=e.centerPointInElevationSR;r(o,Cu);const a=e.mode!=="absolute-height"?Cu.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,u=pTt;l.getGlobalTransform(c,u);const h=ue(cUe,u[12],u[13],u[14]);ts.TESTS_DISABLE_OPTIMIZATIONS?(Eu[0]=o.x,Eu[1]=o.y,Eu[2]=Cu.z,Bd(o.spatialReference,Eu,u,s.spatialReference)&&l.setGlobalTransform(c,u)):s.setAltitudeOfTransformation(Cu.z,u);const p=zhe/s.unitInMeters;return(ts.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-h[0])>=p||Math.abs(u[13]-h[1])>=p||Math.abs(u[14]-h[2])>=p)&&l.setGlobalTransform(c,u),a}function dTt(t,e,i,r,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const h of o){if(!Bhe(h))continue;const p=h.attributes.get(O.POSITION);if(p!==l){const{update:f,averageGeometrySampledElevation:g}=uUe(h,e,i,r,s);c=g,l=p,u=f}u&&n.geometryVertexAttributeUpdated(h,O.POSITION),a+=c}return a/o.length}const zhe=.01,Eu=M(),op=M(),xM=M(),pTt=Ne(),cUe=M(),Cu=new u4;function uUe(t,e,i,r,s){let n=!1;const o=t.transformation,a=e.requiresSampledElevationInfo;op[0]=o[12],op[1]=o[13],op[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(O.POSITION),c=l.data,u=l.size,h=c.length/u,p=new iue(t.mapPositions,i);let f=0,g=0;for(let y=0;y<h;y++){if(xM[0]=c[f],xM[1]=c[f+1],xM[2]=c[f+2],r(p,Cu),a&&(g+=Cu.sampledElevation),ts.TESTS_DISABLE_OPTIMIZATIONS)c[f]=p.array[p.offset],c[f+1]=p.array[p.offset+1],c[f+2]=Cu.z,Ts(c,i,f,c,s.spatialReference,f,1),c[f]-=op[0],c[f+1]-=op[1],c[f+2]-=op[2],n=!0;else{Eu[0]=c[f]+op[0],Eu[1]=c[f+1]+op[1],Eu[2]=c[f+2]+op[2],s.setAltitude(Eu,Cu.z),c[f]=Eu[0]-op[0],c[f+1]=Eu[1]-op[1],c[f+2]=Eu[2]-op[2];const v=zhe/s.unitInMeters;(Math.abs(xM[0]-c[f])>=v||Math.abs(xM[1]-c[f+1])>=v||Math.abs(xM[2]-c[f+2])>=v)&&(n=!0)}f+=u,p.offset+=3}return g/=h,{update:n,averageGeometrySampledElevation:g}}function fTt(t){return!!t&&QO[t]!=null}function hUe(t){return 1/(QO[t]||1)}function mTt(){const t=Object.keys(QO);return t.sort(),t}const gTt=mTt(),yTt=()=>oe.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function _Tt(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function Cyi(t){const e=t?.expression;if(typeof e=="string"){const i=fUe(e);if(i!=null)return{cachedResult:i}}return null}async function Myi(t,e,i,r){const s=t?.expression;if(typeof s!="string")return null;const n=fUe(s);if(n!=null)return{cachedResult:n};const o=await hx();zt(i);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(r?.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function dUe(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function t7(t,e){if(t!=null&&!pUe(t)){if(!e||!t.arcade)return void yTt().errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=iUe(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function vTt(t){if(t!=null){if(pUe(t))return t.cachedResult;const e=t.arcade;let i=e?.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function Ayi(t,e=!1){let i=t?.featureExpressionInfo;const r=i?.expression;return e||r==="0"||(i=null),i??null}const bTt={cachedResult:0};function pUe(t){return t.cachedResult!=null}function fUe(t){return t==="0"?0:null}let E8=class mUe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=hUe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=vTt(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=fTt(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,i,r){if(e==null)return void(this._featureExpressionInfoContext=null);const s=e?.arcade;s&&i!=null&&r!=null?(this._featureExpressionInfoContext=_Tt(e),t7(this._featureExpressionInfoContext,dUe(s.modules,i,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const i=new mUe;return e!=null&&i.setFromElevationInfo(e),i}},wTt=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}};function Vhe(t,e){if(t.type==="point")return V1(t,e,!1);if(tUe(t))switch(t.type){case"extent":return V1(t.center,e,!1);case"polygon":return V1(t.centroid,e,!1);case"polyline":return V1(_1e(t),e,!0);case"mesh":return V1(t.origin,e,!1)}else switch(t.type){case"extent":return V1(xTt(t),e,!0);case"polygon":return V1(STt(t),e,!0);case"polyline":return V1(_1e(t),e,!0)}}function _1e(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=rOe(e,Jle(e)/2);return Dx(i[0],i[1],i[2],t.spatialReference)}function xTt(t){return Dx(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function STt(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=oOe(t.rings,!!t.hasZ);return Dx(i[0],i[1],i[2],t.spatialReference)}function V1(t,e,i){const r=i?t:USt(t);return e&&t?YIe(t,r,e)?r:null:r}function Pyi(t,e,i,r=0){if(t){e||(e=li());const s=t;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),Ds(e,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),e}return null}function SD(t,e,i=null){const r=Bk(Xp);return t!=null&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),e!=null?r[3]=e:t!=null&&t.length>3&&(r[3]=t[3]),i&&(r[0]*=i,r[1]*=i,r[2]*=i,r[3]*=i),r}function Oyi(t,e,i,r,s,n=[0,0,0,0]){for(let o=0;o<3;++o)n[o]=t?.[o]!=null?t[o]:i?.[o]!=null?i[o]:s[o];return n[3]=e??r??s[3],n}function v1e(t=bv,e,i,r=1){const s=new Array(3);if(e==null||i==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const u=l!=null,h=a===0&&!n&&!u,p=i[a];l==="symbol-value"||h?c=p!==0?e[a]/p:1:u&&l!=="proportional"&&isFinite(l)&&(c=p!==0?l/p:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return Dc(s)}function TTt(t){return t.isPrimitive!=null}function i7(t){return hse(TTt(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function hse(t){const e=i=>i==null||i>=0;return Array.isArray(t)?t.every(e):e(t)}function ETt(t,e,i,r=Ne()){return t&&EO(r,r,-t/180*Math.PI),e&&TO(r,r,e/180*Math.PI),i&&Cq(r,r,i/180*Math.PI),r}function Ghe(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=Xc(e),s=TC(t)*r,n=EC(t)*r,o=zx(t)*(e.isGeographic?1:r);return s===0&&n===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(s,n,o)}var Td;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(Td||(Td={}));let CTt=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterials=i,this.properties=r}},G0=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const i=e.stage;i.addMany(this._uniqueMaterials),i.addMany(this._uniqueGeometries),i.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),e.renderer.edgeView?.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;if(s==null)return;const o=b1e(s.baseMaterial);let a=!1;for(const l of s.edgeMaterials)l.objectTransparency!==o&&(l.objectTransparency=o,a=!0);a&&this.resetEdgeObject(i),n.stage.renderer.withEdgeView(l=>{l.updateAllComponentOpacities(r,[e])})}slicePlaneEnabledChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;s!=null&&n.stage.renderer.withEdgeView(o=>{o.updateAllComponentMaterials(r,s.edgeMaterials,{hasSlicePlane:e},!i),s.properties.hasSlicePlane=e})}setVisibility(e){const{_edgeState:i,stageObject:r,_stageLayer:s}=this;s!=null&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(s.add(r),this._addedToStage=!0),i!=null&&s.stage.renderer.withEdgeView(n=>{n.hasObject(r)?n.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(i,n,!1)}))}get visible(){return this._visible}alignWithElevation(e,i,r,s){if(this.elevationAligner==null)return;r!=null&&t7(this.elevationContext.featureExpressionInfoContext,r);const n=(o,a)=>_x(o,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,i),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,i,r){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,i),this.resetEdgeObject(r)}getCenterObjectSpace(e=M()){return ge(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=Oo()){const i=this.stageObject.boundingVolumeObjectSpace;return NLe(e,i.min),LLe(e,i.max),e}computeAttachmentOrigin(e){const i=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(r_)&&(nt(r_,r_,i),Te(e.render.origin,e.render.origin,r_),e.render.num++)}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=MTt,l=Sue(o)?1:a.length;for(let u=0;u<l;u++){const h=a[u];G1[0]=o[h[0]],G1[1]=o[h[1]],G1[2]=o[h[2]],nt(G1,G1,this.stageObject.transformation),SS[3*u]=G1[0],SS[3*u+1]=G1[1],SS[3*u+2]=G1[2]}if(!e(SS,0,l))return null;hs(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let h=0;h<3;h++)o[h]=Math.min(o[h],SS[u+h]),o[h+3]=Math.max(o[h+3],SS[u+h]);c&&r.push({location:SS.slice(u,u+3),screenSpaceBoundingRect:c})}if(i?.service&&this.elevationContext.mode!=="absolute-height"){Vm(o,r_);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let h=0;if(i.useViewElevation)h=i.service.getElevation(r_[0],r_[1],u)??0;else try{const p=Ghe(o,i.service.spatialReference,i);h=await i.service.queryElevation(r_[0],r_[1],s,p,u)??0}catch{}$Le(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,i){e===qv.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),e===qv.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:i,stageObject:r,_stageLayer:s,_visible:n}=this;i!=null&&s.stage.renderer.withEdgeView(o=>{n?this._addOrUpdateEdgeObject(i,o,e):o.removeObject(r)})}_addOrUpdateEdgeObject(e,i,r){const s=b1e(e.baseMaterial);for(const n of e.edgeMaterials)n.objectTransparency=s;i.addOrUpdateObject3D(this.stageObject,e.edgeMaterials,e.properties,!r).then(()=>this._stageLayer?.sync())}};function b1e(t){return t.isVisible()?t.parameters.transparent?Td.TRANSPARENT:Td.OPAQUE:Td.INVISIBLE}const SS=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],G1=M(),r_=M(),MTt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let gUe=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=e??0}};const yUe=3,dse=3,_Ue=10;let vUe=class{constructor(e,i=null){this.geometry=e,this.textures=i}},bUe=class{constructor(e,i,r){this.components=e,this.minScreenSpaceRadius=i,this.pivotOffset=r;const s=this.geometries;this.numVertices=s.reduce((n,o)=>n+o.attributes.get(O.POSITION).indices.length,0)}get geometries(){return rq(this.components.map(e=>e.geometry))}},wUe=class{constructor(e){this.levels=e,this.levels.sort((i,r)=>i.minScreenSpaceRadius===r.minScreenSpaceRadius?i.numVertices-r.numVertices:i.minScreenSpaceRadius-r.minScreenSpaceRadius)}};function $5(t){const e=[];return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),rq(e)}function w1e(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>{r.textures!=null&&e.push(...r.textures)})),rq(e)}function x1e(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry))),rq(e)}function ATt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function xUe(t,e){const i=(r,s,n=!1)=>new wUe(r.map(o=>{const a=s(o.tesselation);return n&&Y_t(a),new bUe([new vUe(a)],o.minScreenSpaceRadius)}));switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>j_t(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>L_t(e,1));case"cone":return i(mX,r=>V_e(e,1,.5,r,!1),!0);case"inverted-cone":return i(mX,r=>V_e(e,1,.5,r,!0),!0);case"cylinder":return i(mX,r=>q_t(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>G_t(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>U_t(e,1),!0);default:return}}const mX=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let zp=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new SUe}},jhe=class extends zp{constructor(e){super(e),this.estimated=!0}},RTt=class extends zp{constructor(e,i){super(i),this.numComplexities=e}},PTt=class extends jhe{constructor(e,i){super(i),this.numComplexities=e}},SUe=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function OTt(t){return t.type==="fill"}function ITt(t){return t.type==="extrude"}function Hhe(t,e,i=0){const r=$e(t,0,LTt);for(let s=0;s<4;s++)e[i+s]=Math.floor(256*DTt(r*$Tt[s]))}function qhe(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*NTt[r];return i}const $Tt=[1,256,65536,16777216],NTt=[1/256,1/65536,1/16777216,1/4294967296],LTt=qhe(new Uint8ClampedArray([255,255,255,255]));function DTt(t){return t-Math.floor(t)}var Eo;function FTt(t){switch(t){case"multiply":default:return Eo.Multiply;case"ignore":return Eo.Ignore;case"replace":return Eo.Replace;case"tint":return Eo.Tint}}function TUe(t,e,i){if(t==null||e===Eo.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=$e(Math.round(t[3]*C8),0,C8),s=r===0||e===Eo.Tint?0:e===Eo.Replace?kTt:UTt;i[0]=$e(Math.round(t[0]*SM),0,SM),i[1]=$e(Math.round(t[1]*SM),0,SM),i[2]=$e(Math.round(t[2]*SM),0,SM),i[3]=r+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Eo||(Eo={}));const SM=255,C8=85,kTt=C8,UTt=2*C8;function EUe(t){t.vertex.code.add(T`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${T.int(Eo.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${T.int(Eo.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${T.int(Eo.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${T.int(Eo.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let M8=class extends hn{constructor(e,i){super(e,"vec4",ar.Draw,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}},BTt=class extends hn{constructor(e,i){super(e,"int",ar.Draw,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};var u0;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(u0||(u0={}));const Whe=429496.7296;function zTt(t,e){Hhe(t/Whe*.5+.5,e)}function VTt(t,e){switch(e.componentData){case u0.Varying:return GTt(t,e);case u0.Uniform:return jTt(t,e);case u0.COUNT:return;default:e.componentData}}function GTt(t,e){const{vertex:i,fragment:r}=t;i.include(Cg),i.uniforms.add(new o0("componentColorTex",n=>n.componentParameters.texture.texture)),t.attributes.add(O.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===G.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(EUe),i.constants.add("elevationScale","float",2*Whe),i.constants.add("stride","float",ae("enable-feature:objectAndLayerId-rendering")?3:2),i.code.add(T`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),i.code.add(T`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?T`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:T`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(T`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?T`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function jTt(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new M8("externalColor",n=>n.componentParameters.externalColor)),r.uniforms.add(new BTt("externalColorMixMode",n=>n.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),i.code.add(T`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const s=e.output===G.ObjectAndLayerIdColor;r.code.add(T`
  void readExternalColor(out vec4 color, out int colorMixMode) {
    color = vExternalColor;
    colorMixMode = externalColorMixMode;
  }

  void outputObjectAndLayerIdColor() {
    ${s?T`fragColor = vec4(0,0,0,0);`:""}
 }
`)}function JI(t,e){switch(e.normalType){case yr.Compressed:t.attributes.add(O.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(T`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case yr.Attribute:t.attributes.add(O.NORMAL,"vec3"),t.vertex.code.add(T`vec3 normalModel() {
return normal;
}`);break;case yr.ScreenDerivative:t.fragment.code.add(T`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case yr.COUNT:case yr.Ground:}}var yr;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(yr||(yr={}));function Hyi(t,e){const i=t.vertex;i.include(Cg),t.include(JI,e),i.uniforms.add(new et("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(T`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new o0("componentDataTex",r=>r.componentDataTexture)),t.attributes.add(O.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("verticalOffsetScale","float",2*Whe),i.code.add(T`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
      vec3 normal = normalModel();
      vec3 normal2 = ${e.silhouette?T`decompressNormal(normal2Compressed)`:T`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?i.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new i8("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(O.NORMAL2COMPRESSED,"vec2"),i.code.add(T`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):i.code.add(T`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),e.legacy?i.code.add(T`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(Yue,e),i.uniforms.add(new bf("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new i8("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Vd("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new Vd("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Qt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Qt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)),i.code.add(T`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?T`normalize(transformWorldFromModelTL + rotatedModelPosition);`:T`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new Ps("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),i.code.add(T`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(T`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function qyi(t){return t===rI.Sketch||t===rI.Mixed}var rI,S1e;(function(t){t[t.Solid=0]="Solid",t[t.Sketch=1]="Sketch",t[t.Mixed=2]="Mixed",t[t.COUNT=3]="COUNT"})(rI||(rI={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(S1e||(S1e={}));function HTt(t){return t&&t.enabled&&(ITt(t)||OTt(t))&&t.edges!=null}function qTt(t){return t&&t.enabled&&t.edges||null}function CUe(t,e){return WTt(qTt(t),e)}function WTt(t,e){if(t==null)return null;const i=t.color!=null?bF(Ke.toUnitRGBA(t.color)):ni(0,0,0,0),r=Yn(t.size),s=Yn(t.extensionLength);switch(t.type){case"solid":return YTt({color:i,size:r,extensionLength:s,...e});case"sketch":return XTt({color:i,size:r,extensionLength:s,...e});default:return}}function YTt(t){return{...ZTt,...t,type:rI.Solid}}function XTt(t){return{...JTt,...t,type:rI.Sketch}}const ZTt={color:ni(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Td.OPAQUE,hasSlicePlane:!1},JTt={color:ni(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Td.OPAQUE,hasSlicePlane:!1};function MUe(t,e){const i=t.fragment;switch(i.code.add(T`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case Ws.None:i.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Ws.View:i.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Ws.WindingOrder:i.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case Ws.COUNT:}}var Ws;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(Ws||(Ws={}));let h4=class{constructor(e=!1,i=!0){this.isVerticalRay=e,this.normalRequired=i}};const N5=Oo();function AUe(t,e,i,r,s,n){if(!t.visible)return;const o=Vi($Ue,r,i),a=(c,u,h)=>{n(c,h,u,!1)},l=new h4(!1,e.options.normalRequired);if(t.boundingInfo){Tt(t.type===an.Mesh);const c=e.tolerance;RUe(t.boundingInfo,i,o,c,s,l,a)}else{const c=t.attributes.get(O.POSITION),u=c.indices;IUe(i,o,0,u.length/3,u,c.data,c.stride,s,l,a)}}const QTt=M();function RUe(t,e,i,r,s,n,o){if(t==null)return;const a=o2t(i,QTt);if(NLe(N5,t.bbMin),LLe(N5,t.bbMax),s?.applyToAabb(N5),Xhe(N5,e,a,r)){const{primitiveIndices:l,position:c}=t,u=l?l.length:c.indices.length/3;if(u>a2t){const h=t.getChildren();if(h!==void 0){for(const p of h)RUe(p,e,i,r,s,n,o);return}}e2t(e,i,0,u,c.indices,c.data,c.stride,l,s,n,o)}}const k2=M();function PUe(t,e,i,r,s,n,o,a,l){const{data:c,stride:u}=n;IUe(t,Vi($Ue,e,t),i,r,s,c,u,o,a,l)}function OUe(t,e,i,r,s,n,o,a,l,c=null,u=0){const h=t[0],p=t[1],f=t[2],g=e[0],y=e[1],v=e[2];for(let b=i;b<r;++b){const w=u+(c?c[b]:b),x=3*w,S=o*s[x],E=n[S],C=n[S+1],R=n[S+2],I=o*s[x+1],F=n[I],D=n[I+1],z=n[I+2],B=o*s[x+2],Y=F-E,W=D-C,J=z-R,me=n[B]-E,L=n[B+1]-C,k=n[B+2]-R,H=y*k-L*v,q=v*me-k*g,Q=g*L-me*y,K=Y*H+W*q+J*Q;if(Math.abs(K)<=Jhe)continue;const re=h-E,be=p-C,Re=f-R,je=re*H+be*q+Re*Q;if(K>0){if(je<0||je>K)continue}else if(je>0||je<K)continue;const _t=be*J-W*Re,ht=Re*Y-J*re,ut=re*W-Y*be,lt=g*_t+y*ht+v*ut;if(K>0){if(lt<0||je+lt>K)continue}else if(lt>0||je+lt<K)continue;const at=(me*_t+L*ht+k*ut)/K;at>=0&&l(at,w,a?Yhe(Y,W,J,me,L,k,k2):null)}}function KTt(t,e,i,r,s,n,o,a,l,c,u,h=null,p=0){const f=t[0],g=t[1],y=t[2],v=e[0],b=e[1],w=e[2];for(let x=i;x<r;++x){const S=p+(h?h[x]:x),E=3*S,C=o*s[E],R=n[C],I=n[C+1],F=n[C+2],D=o*s[E+1],z=n[D],B=n[D+1],Y=n[D+2],W=o*s[E+2],J=n[W],me=n[W+1],L=n[W+2],k=F-l,H=a/Math.sqrt(R*R+I*I+k*k),q=R+R*H,Q=I+I*H,K=F+k*H,re=Y-l,be=a/Math.sqrt(z*z+B*B+re*re),Re=z+z*be,je=B+B*be,_t=Y+re*be,ht=L-l,ut=a/Math.sqrt(J*J+me*me+ht*ht),lt=Re-q,at=je-Q,bi=_t-K,gi=J+J*ut-q,We=me+me*ut-Q,ii=L+ht*ut-K,Ye=b*ii-We*w,He=w*gi-ii*v,Lt=v*We-gi*b,kt=lt*Ye+at*He+bi*Lt;if(Math.abs(kt)<=Jhe)continue;const Kt=f-q,wt=g-Q,rt=y-K,st=Kt*Ye+wt*He+rt*Lt;if(kt>0){if(st<0||st>kt)continue}else if(st>0||st<kt)continue;const Ht=wt*bi-at*rt,ui=rt*lt-bi*Kt,Er=Kt*at-lt*wt,Oi=v*Ht+b*ui+w*Er;if(kt>0){if(Oi<0||st+Oi>kt)continue}else if(Oi>0||st+Oi<kt)continue;const ki=(gi*Ht+We*ui+ii*Er)/kt;ki>=0&&u(ki,S,c?Yhe(lt,at,bi,gi,We,ii,k2):null)}}function e2t(t,e,i,r,s,n,o,a,l,c,u){const h=t[0],p=t[1],f=t[2],g=e[0],y=e[1],v=e[2],{normalRequired:b}=c;for(let w=i;w<r;++w){const x=a[w],S=3*x,E=o*s[S];let C=n[E],R=n[E+1],I=n[E+2];const F=o*s[S+1];let D=n[F],z=n[F+1],B=n[F+2];const Y=o*s[S+2];let W=n[Y],J=n[Y+1],me=n[Y+2];l!=null&&([C,R,I]=l.applyToVertex(C,R,I,w),[D,z,B]=l.applyToVertex(D,z,B,w),[W,J,me]=l.applyToVertex(W,J,me,w));const L=D-C,k=z-R,H=B-I,q=W-C,Q=J-R,K=me-I,re=y*K-Q*v,be=v*q-K*g,Re=g*Q-q*y,je=L*re+k*be+H*Re;if(Math.abs(je)<=Jhe)continue;const _t=h-C,ht=p-R,ut=f-I,lt=_t*re+ht*be+ut*Re;if(je>0){if(lt<0||lt>je)continue}else if(lt>0||lt<je)continue;const at=ht*H-k*ut,bi=ut*L-H*_t,gi=_t*k-L*ht,We=g*at+y*bi+v*gi;if(je>0){if(We<0||lt+We>je)continue}else if(We>0||lt+We<je)continue;const ii=(q*at+Q*bi+K*gi)/je;ii>=0&&u(ii,x,b?Yhe(L,k,H,q,Q,K,k2):null)}}function IUe(t,e,i,r,s,n,o,a,l,c){const u=e,h=l2t,p=Math.abs(u[0]),f=Math.abs(u[1]),g=Math.abs(u[2]),y=p>=f?p>=g?0:2:f>=g?1:2,v=y,b=u[v]<0?2:1,w=(y+b)%3,x=(y+(3-b))%3,S=u[w]/u[v],E=u[x]/u[v],C=1/u[v],R=t2t,I=i2t,F=r2t,{normalRequired:D}=l;for(let z=i;z<r;++z){const B=3*z,Y=o*s[B];ue(h[0],n[Y+0],n[Y+1],n[Y+2]);const W=o*s[B+1];ue(h[1],n[W+0],n[W+1],n[W+2]);const J=o*s[B+2];ue(h[2],n[J+0],n[J+1],n[J+2]),a&&(ge(h[0],a.applyToVertex(h[0][0],h[0][1],h[0][2],z)),ge(h[1],a.applyToVertex(h[1][0],h[1][1],h[1][2],z)),ge(h[2],a.applyToVertex(h[2][0],h[2][1],h[2][2],z))),Vi(R,h[0],t),Vi(I,h[1],t),Vi(F,h[2],t);const me=R[w]-S*R[v],L=R[x]-E*R[v],k=I[w]-S*I[v],H=I[x]-E*I[v],q=F[w]-S*F[v],Q=F[x]-E*F[v],K=q*H-Q*k,re=me*Q-L*q,be=k*L-H*me;if((K<0||re<0||be<0)&&(K>0||re>0||be>0))continue;const Re=K+re+be;if(Re===0)continue;const je=K*(C*R[v])+re*(C*I[v])+be*(C*F[v]);if(je*Math.sign(Re)<0)continue;const _t=je/Re;_t>=0&&c(_t,z,D?s2t(h):null)}}const t2t=M(),i2t=M(),r2t=M();function Yhe(t,e,i,r,s,n,o){return ue(A8,t,e,i),ue(R8,r,s,n),yt(o,A8,R8),Se(o,o),o}function s2t(t){return Vi(A8,t[1],t[0]),Vi(R8,t[2],t[0]),yt(k2,A8,R8),Se(k2,k2),k2}const A8=M(),R8=M();function n2t(t,e,i){return ue(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function o2t(t,e){return ue(e,1/t[0],1/t[1],1/t[2])}function Xhe(t,e,i,r){return Zhe(t,e,i,r,1/0)}function Zhe(t,e,i,r,s){const n=(t[0]-r-e[0])*i[0],o=(t[3]+r-e[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-r-e[1])*i[1],u=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const h=(t[2]-r-e[2])*i[2],p=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(h,p)),!(l<0)&&(a=Math.max(a,Math.min(h,p)),!(a>l)&&a<s)}const a2t=1e3,Jhe=1e-7,$Ue=M(),l2t=[M(),M(),M()];let QI=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get(O.POSITION).indices.length}write(e,i,r,s,n){z4e(r,this.vertexBufferLayout,e,i,s,n)}};function r7(t,e){switch(e.normalType){case yr.Attribute:case yr.Compressed:t.include(JI,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new i8("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new bf("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),t.vertex.code.add(T`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case yr.Ground:t.include(FP,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(T`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?T`normalize(vPositionWorldCameraRelative);`:T`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case yr.ScreenDerivative:t.vertex.code.add(T`void forwardNormal() {}`);break;default:e.normalType;case yr.COUNT:}}let NUe=class extends u_t{constructor(){super(...arguments),this.transformNormalViewFromGlobal=ps()}},LUe=class extends h_t{constructor(){super(...arguments),this.transformNormalGlobalFromModel=ps(),this.toMapSpace=pi()}};const Qhe={func:Lr.LESS},P8={func:Lr.ALWAYS},x0={mask:255},DUe={mask:0},c2t=t=>({function:{func:Lr.NOTEQUAL,ref:t,mask:t},operation:{fail:Us.KEEP,zFail:Us.KEEP,zPass:Us.KEEP}}),u2t=t=>({function:{func:Lr.ALWAYS,ref:t,mask:t},operation:{fail:Us.KEEP,zFail:Us.KEEP,zPass:Us.REPLACE}}),Xx={function:{func:Lr.ALWAYS,ref:Iu.OutlineVisualElementMask,mask:Iu.OutlineVisualElementMask},operation:{fail:Us.KEEP,zFail:Us.KEEP,zPass:Us.ZERO}},bx={function:{func:Lr.ALWAYS,ref:Iu.OutlineVisualElementMask,mask:Iu.OutlineVisualElementMask},operation:{fail:Us.KEEP,zFail:Us.KEEP,zPass:Us.REPLACE}},FUe={function:{func:Lr.EQUAL,ref:Iu.OutlineVisualElementMask,mask:Iu.OutlineVisualElementMask},operation:{fail:Us.KEEP,zFail:Us.KEEP,zPass:Us.KEEP}},kUe={function:{func:Lr.NOTEQUAL,ref:Iu.OutlineVisualElementMask,mask:Iu.OutlineVisualElementMask},operation:{fail:Us.KEEP,zFail:Us.KEEP,zPass:Us.KEEP}};function UUe({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||ga(n,co))&&o==null&&(r==null||r===1)&&(i==null||i===1)}function Jyi({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||ga(n,co))&&o==null&&(r==null||r===1)&&(i==null||i===1||i===0)}const s7=[1,1,.5],Khe=[0,.6,.2],h2t=[0,1,.2];function BUe(t){t.vertex.code.add(T`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let KI=class extends hn{constructor(e,i){super(e,"int",ar.Pass,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};function zUe(t,e){e.hasSymbolColors?(t.include(EUe),t.attributes.add(O.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(T`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new KI("colorMixMode",i=>L4e[i.colorMixMode])),t.vertex.code.add(T`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function LC(t,e){e.hasVertexColors?(t.attributes.add(O.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(T`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(T`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(T`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function ede(t){t.code.add(T`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function n7(t,e){switch(e.output){case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ViewshedShadow:t.fragment.include(ede),t.fragment.code.add(T`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`)}}function d2t(t){t.fragment.code.add(T`
    #define discardOrAdjustAlpha(color) { if (color.a < ${T.float(Ba)}) { discard; } }
  `)}let VUe=class extends hn{constructor(e,i){super(e,"float",ar.Draw,(r,s,n)=>r.setUniform1f(e,i(s,n)))}};function JR(t,e){GUe(t,e,new et("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function p2t(t,e){GUe(t,e,new VUe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function GUe(t,e,i){const r=t.fragment;switch(e.alphaDiscardMode!==Yr.Mask&&e.alphaDiscardMode!==Yr.MaskBlend||r.uniforms.add(i),e.alphaDiscardMode){case Yr.Blend:return t.include(d2t);case Yr.Opaque:r.code.add(T`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Yr.Mask:r.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Yr.MaskBlend:t.fragment.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function jUe(t,e){const{vertex:i,fragment:r}=t,s=e.hasColorTexture&&e.alphaDiscardMode!==Yr.Opaque;switch(e.output){case G.Depth:Pu(i,e),t.include(ec,e),t.include(Wn,e),t.include(jm,e),s&&r.uniforms.add(new Et("tex",n=>n.texture)),i.code.add(T`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(JR,e),r.code.add(T`
          void main(void) {
            discardBySlice(vpos);
            ${s?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
          }
        `);break;case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ViewshedShadow:case G.ObjectAndLayerIdColor:Pu(i,e),t.include(ec,e),t.include(jm,e),t.include($v,e),t.include(n7,e),t.include(Wn,e),t.include(NC,e),R9(t),t.varyings.add("depth","float"),s&&r.uniforms.add(new Et("tex",n=>n.texture)),i.code.add(T`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`),t.include(JR,e),r.code.add(T`
          void main(void) {
            discardBySlice(vpos);
            ${s?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===G.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:T`outputDepth(depth);`}
          }
        `);break;case G.Normal:{Pu(i,e),t.include(ec,e),t.include(JI,e),t.include(r7,e),t.include(jm,e),t.include($v,e),s&&r.uniforms.add(new Et("tex",o=>o.texture)),e.normalType===yr.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const n=e.normalType===yr.Attribute||e.normalType===yr.Compressed;i.code.add(T`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${n?T`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:T`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(Wn,e),t.include(JR,e),r.code.add(T`
          void main() {
            discardBySlice(vpos);
            ${s?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===yr.ScreenDerivative?T`vec3 normal = screenDerivativeNormal(vPositionView);`:T`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case G.Highlight:Pu(i,e),t.include(ec,e),t.include(jm,e),t.include($v,e),s&&r.uniforms.add(new Et("tex",n=>n.texture)),i.code.add(T`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(Wn,e),t.include(JR,e),t.include(Wx,e),r.code.add(T`
          void main() {
            discardBySlice(vpos);
            ${s?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function HUe(t,e){const i=t.fragment;e.hasVertexTangents?(t.attributes.add(O.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===Ws.WindingOrder?i.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):i.code.add(T`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==ks.None&&(t.include(Vue,e),i.uniforms.add(e.pbrTextureBindType===ar.Pass?new Et("normalTexture",r=>r.textureNormal):new o0("normalTexture",r=>r.textureNormal)),e.hasNormalTextureTransform&&(i.uniforms.add(new os("scale",r=>r.scale??Jq)),i.uniforms.add(new bf("normalTextureTransformMatrix",r=>r.normalTextureTransformMatrix??_C))),i.code.add(T`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),e.hasNormalTextureTransform&&i.code.add(T`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),i.code.add(T`return tangentSpace * rawNormal;
}`))}let eR=class extends Fe{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces="composite-color",this._context=null,this._dirty=!0}initialize(){this.addHandles([_e(()=>this.view.ready,e=>{e&&this.view._stage?.renderer.addRenderNode(this)},Ir)])}destroy(){this.view._stage?.renderer?.removeRenderNode(this)}render(){throw new j("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}acquireOutputFramebuffer(){const e=this._frameBuffer?.getTexture()?.descriptor,i=this.view._stage.renderer.fboCache.acquire(e?.width??640,e?.height??480,this.produces);return i.fbo?.initializeAndBind(),i}bindRenderTarget(){return this._frameBuffer?.fbo?.initializeAndBind(),this._frameBuffer}requestRender(e){e===vr.UPDATE&&this.view._stage?.renderView.requestRender(e),this._dirty=!0}resetWebGLState(){this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(this._frameBuffer?.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this._context.bindParameters}get renderingContext(){return this.view._stage.renderView.renderingContext}updateAnimation(){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e,i){this._context=i,this._frameBuffer=e.find(({name:r})=>r===this.produces);try{return this.render(e)}finally{this._frameBuffer=null}}};d([m({constructOnly:!0})],eR.prototype,"view",void 0),d([m({constructOnly:!0})],eR.prototype,"consumes",void 0),d([m()],eR.prototype,"produces",void 0),eR=d([N("esri.views.3d.webgl.RenderNode")],eR);const e$=eR,qUe=3e5,O8=5e5;let WUe=class extends hn{constructor(e,i){super(e,"vec2",ar.Draw,(r,s,n,o)=>r.setUniform2fv(e,i(s,n,o)))}};const gX=4;function f2t(){const t=new tr,e=t.fragment;t.include(Rl);const i=(gX+1)/2,r=1/(2*i*i);return e.include(N0),e.uniforms.add(new Et("depthMap",s=>s.depthTexture),new o0("tex",s=>s.colorTexture),new WUe("blurSize",s=>s.blurSize),new et("projScale",(s,n)=>{const o=jr(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale})),e.code.add(T`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${T.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.code.add(T`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${T.int(gX)}; r <= ${T.int(gX)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `),t}const m2t=Object.freeze(Object.defineProperty({__proto__:null,build:f2t},Symbol.toStringTag,{value:"Module"}));let YUe=class XUe extends hr{initializeProgram(e){return new dr(e.rctx,XUe.shader.get().build(),Fi)}initializePipeline(){return ti({colorWrite:fi})}};YUe.shader=new ir(m2t,()=>ye(()=>import("./SSAOBlur.glsl-b9b5795b.js"),[],import.meta.url));const g2t="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let y2t=class extends is{constructor(){super(...arguments),this.projScale=1}},_2t=class extends y2t{constructor(){super(...arguments),this.intensity=1}},v2t=class extends is{},b2t=class extends v2t{constructor(){super(...arguments),this.blurSize=vt()}};function d4(t){t.fragment.uniforms.add(new Ki("projInfo",(e,i)=>w2t(i.camera))),t.fragment.uniforms.add(new os("zScale",(e,i)=>x2t(i.camera))),t.fragment.code.add(T`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function w2t(t){const e=t.projectionMatrix;return e[11]===0?Ds(T1e,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):Ds(T1e,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const T1e=pi();function x2t(t){return t.projectionMatrix[11]===0?Gi(E1e,0,1):Gi(E1e,1,0)}const E1e=vt(),C1e=16;function S2t(){const t=new tr,e=t.fragment;return t.include(Rl),t.include(d4),e.include(N0),e.uniforms.add(new et("radius",(i,r)=>tde(r.camera))).code.add(T`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(T`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new Et("normalMap",i=>i.normalTexture),new Et("depthMap",i=>i.depthTexture),new et("projScale",i=>i.projScale),new Et("rnm",i=>i.noiseTexture),new os("rnmScale",(i,r)=>Gi(M1e,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new et("intensity",i=>i.intensity),new os("screenSize",(i,r)=>Gi(M1e,r.camera.fullWidth,r.camera.fullHeight))),t.outputs.add("fragOcclusion","float"),e.code.add(T`
    void main(void) {
      float depth = depthFromTexture(depthMap, uv);

      // Early out if depth is out of range, such as in the sky
      if (depth >= 1.0 || depth <= 0.0) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      float currentPixelDepth = linearizeDepth(depth);
      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${T.int(C1e)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${T.int(C1e)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `),t}function tde(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const M1e=vt(),T2t=Object.freeze(Object.defineProperty({__proto__:null,build:S2t,getRadius:tde},Symbol.toStringTag,{value:"Module"}));let ZUe=class JUe extends hr{initializeProgram(e){return new dr(e.rctx,JUe.shader.get().build(),Fi)}initializePipeline(){return ti({colorWrite:fi})}};ZUe.shader=new ir(T2t,()=>ye(()=>import("./SSAO.glsl-c9556744.js"),[],import.meta.url));const YN=2;let FT=class extends e${constructor(e){super(e),this.consumes={required:["normals"]},this.produces="ssao",this.isEnabled=()=>!1,this._enableTime=0,this._passParameters=new _2t,this._drawParameters=new b2t}initialize(){const e=Uint8Array.from(atob(g2t),r=>r.charCodeAt(0)),i=new fs;i.wrapMode=Di.CLAMP_TO_EDGE,i.pixelFormat=Xt.RGB,i.wrapMode=Di.REPEAT,i.hasMipmap=!0,i.width=32,i.height=32,this._passParameters.noiseTexture=new Gr(this.renderingContext,i,e),this._ssaoTechnique=this.techniques.acquire(ZUe),this._blurTechnique=this.techniques.acquire(YUe),this.addHandles(_e(()=>this.isEnabled(),()=>this._enableTime=0))}destroy(){this._passParameters.noiseTexture=jt(this._passParameters.noiseTexture),this._blurTechnique.release(),this._ssaoTechnique.release()}render(e){const i=this.bindParameters,r=e.find(({name:E})=>E==="normals"),s=r?.getTexture(),n=r?.getTexture(YO),o=this.fboCache,a=i.camera,l=a.fullViewport[2],c=a.fullViewport[3],u=Math.round(l/YN),h=Math.round(c/YN);if(!this._ssaoTechnique.compiled||!this._blurTechnique.compiled)return this._enableTime=performance.now(),this.requestRender(),o.acquire(u,h,"ssao",xs.RED);this._enableTime===0&&(this._enableTime=performance.now());const p=this.renderingContext,f=this.view.qualitySettings.fadeDuration,g=a.relativeElevation,y=$e((O8-g)/(O8-qUe),0,1),v=f>0?Math.min(f,performance.now()-this._enableTime)/f:1,b=v*y;this._passParameters.normalTexture=s,this._passParameters.depthTexture=n,this._passParameters.projScale=1/a.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*E2t/tde(a)**6*b;const w=o.acquire(l,c,"ssao input",xs.RG);p.unbindTexture(w.fbo.colorTexture),p.bindFramebuffer(w.fbo),p.setViewport(0,0,l,c),p.bindTechnique(this._ssaoTechnique,i,this._passParameters,this._drawParameters),p.screen.draw();const x=o.acquire(u,h,"ssao blur",xs.RED);p.unbindTexture(x.fbo.colorTexture),p.bindFramebuffer(x.fbo),this._drawParameters.colorTexture=w.getTexture(),Gi(this._drawParameters.blurSize,0,YN/c),p.bindTechnique(this._blurTechnique,i,this._passParameters,this._drawParameters),p.setViewport(0,0,u,h),p.screen.draw(),w.release();const S=o.acquire(u,h,"ssao",xs.RED);return p.unbindTexture(S.fbo.colorTexture),p.bindFramebuffer(S.fbo),p.setViewport(0,0,l,c),p.setClearColor(1,1,1,0),p.clear(ss.COLOR_BUFFER_BIT),this._drawParameters.colorTexture=x.getTexture(),Gi(this._drawParameters.blurSize,YN/l,0),p.bindTechnique(this._blurTechnique,i,this._passParameters,this._drawParameters),p.setViewport(0,0,u,h),p.screen.draw(),p.setViewport4fv(a.fullViewport),x.release(),v<1&&this.requestRender(vr.UPDATE),S}};d([m()],FT.prototype,"consumes",void 0),d([m()],FT.prototype,"produces",void 0),d([m({constructOnly:!0})],FT.prototype,"techniques",void 0),d([m({constructOnly:!0})],FT.prototype,"isEnabled",void 0),FT=d([N("esri.views.3d.webgl-engine.effects.ssao.SSAO")],FT);const E2t=.5;function p4(t,e){const i=t.fragment;e.receiveAmbientOcclusion?(i.uniforms.add(new Et("ssaoTex",(r,s)=>s.ssao?.getTexture())),i.constants.add("blurSizePixelsInverse","float",1/YN),i.code.add(T`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):i.code.add(T`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function C2t(t){const e=t.fragment.code;e.add(T`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(T`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(T`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function ide(t,e){const i=t.fragment.code;t.include(Kk),e.pbrMode!==Ot.Normal&&e.pbrMode!==Ot.Schematic&&e.pbrMode!==Ot.Simplified&&e.pbrMode!==Ot.TerrainWithWater||(i.add(T`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(T`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==Ot.Normal&&e.pbrMode!==Ot.Schematic||(t.include(C2t),i.add(T`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(T`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(T`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(T`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function M2t(t,e){const i=t.fragment.code;t.include(Kk),i.add(T`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(T`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(T`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(T`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(T`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function f4(t){t.constants.add("ambientBoostFactor","float",NFe)}function t$(t){t.uniforms.add(new et("lightingGlobalFactor",(e,i)=>i.lighting.globalFactor))}function XE(t,e){const i=t.fragment;switch(t.include(p4,e),e.pbrMode!==Ot.Disabled&&t.include(ide,e),t.include(Hue,e),t.include(Kk),i.code.add(T`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===Ot.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),f4(i),t$(i),r1(i),i.code.add(T`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?T`normalize(vPosWorld)`:T`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),L0(i),i.code.add(T`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case Ot.Disabled:case Ot.WaterOnIntegratedMesh:case Ot.Water:t.include(Zj),i.code.add(T`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case Ot.Normal:case Ot.Schematic:i.code.add(T`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(T`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new a0("hasFillLights",(r,s)=>s.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(T`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add(new et("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new et("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)),i.code.add(T`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(T`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode!==Ot.Schematic||e.hasColorTexture?T`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:T`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case Ot.Simplified:case Ot.TerrainWithWater:t.include(Zj),i.code.add(T`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case Ot.COUNT:}}let A2t=class extends hn{constructor(e,i,r){super(e,"mat4",ar.Draw,(s,n,o,a)=>s.setUniformMatrix4fv(e,i(n,o,a)),r)}},pse=class extends hn{constructor(e,i,r){super(e,"mat4",ar.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,i(n,o)),r)}},R2t=class extends is{constructor(){super(...arguments),this.modelTransformation=us}},rde=class extends R2t{constructor(){super(...arguments),this.origin=M()}};function m4(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new pse("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),QUe(t))}function sI(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new A2t("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),QUe(t))}function QUe(t){const e=t.fragment;e.include(ede),e.uniforms.add(new Et("shadowMap",(i,r)=>r.shadowMap.depthTexture),new KI("numCascades",(i,r)=>r.shadowMap.numCascades),new Ki("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances)),e.code.add(T`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}function P2t(t,e){e.hasColorTextureTransform?(t.vertex.uniforms.add(new bf("colorTextureTransformMatrix",i=>i.colorTextureTransformMatrix??_C)),t.varyings.add("colorUV","vec2"),t.vertex.code.add(T`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardColorUV(){}`)}function O2t(t,e){e.hasNormalTextureTransform&&e.textureCoordinateType!==ks.None?(t.vertex.uniforms.add(new bf("normalTextureTransformMatrix",i=>i.normalTextureTransformMatrix??_C)),t.varyings.add("normalUV","vec2"),t.vertex.code.add(T`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardNormalUV(){}`)}function I2t(t,e){e.hasEmissionTextureTransform&&e.textureCoordinateType!==ks.None?(t.vertex.uniforms.add(new bf("emissiveTextureTransformMatrix",i=>i.emissiveTextureTransformMatrix??_C)),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(T`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardEmissiveUV(){}`)}function $2t(t,e){e.hasOcclusionTextureTransform&&e.textureCoordinateType!==ks.None?(t.vertex.uniforms.add(new bf("occlusionTextureTransformMatrix",i=>i.occlusionTextureTransformMatrix??_C)),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(T`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardOcclusionUV(){}`)}function N2t(t,e){e.hasMetallicRoughnessTextureTransform&&e.textureCoordinateType!==ks.None?(t.vertex.uniforms.add(new bf("metallicRoughnessTextureTransformMatrix",i=>i.metallicRoughnessTextureTransformMatrix??_C)),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(T`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardMetallicRoughnessUV(){}`)}function sde(t){t.include(B0),t.code.add(T`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${T.int(Eo.Multiply)}) {
        return allMixed;
      }
      if (mode == ${T.int(Eo.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(Eo.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${T.int(Eo.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(Eo.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function L2t(t){const e=new tr,{vertex:i,fragment:r,varyings:s}=e;if(Pu(i,t),e.include(e4),s.add("vpos","vec3"),e.include($v,t),e.include(zFe,t),e.include(R4e,t),e.include(P2t,t),t.output===G.Color){e.include(O2t,t),e.include(I2t,t),e.include($2t,t),e.include(N2t,t),yg(i,t),e.include(JI,t),e.include(ec,t);const n=t.normalType===yr.Attribute||t.normalType===yr.Compressed;n&&t.offsetBackfaces&&e.include(BUe),e.include(HUe,t),e.include(r7,t),t.instancedColor&&e.attributes.add(O.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),e.include(jm,t),e.include(YI,t),e.include(zUe,t),e.include(LC,t),i.uniforms.add(new Ki("externalColor",o=>o.externalColor)),s.add("vcolorExt","vec4"),t.multipassEnabled&&s.add("depth","float"),i.code.add(T`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${T.float(Ba)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${n?T`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${n&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        forwardColorUV();
        forwardNormalUV();
        forwardEmissiveUV();
        forwardOcclusionUV();
        forwardMetallicRoughnessUV();
      }
    `),e.include(Wn,t),e.include(XE,t),e.include(p4,t),e.include(JR,t),e.include(t.instancedDoublePrecision?m4:sI,t),e.include(V0,t),yg(r,t),r.uniforms.add(i.uniforms.get("localOrigin"),new Qt("ambient",o=>o.ambient),new Qt("diffuse",o=>o.diffuse),new et("opacity",o=>o.opacity),new et("layerOpacity",o=>o.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new Et("tex",o=>o.texture)),e.include(jue,t),e.include(ide,t),r.include(sde),e.include(MUe,t),f4(r),t$(r),L0(r),t.transparencyPassType===mt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===yr.ScreenDerivative?T`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:T`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===Ot.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?T`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?T`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?T`normalUV`:"vuv0"});`:T`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?T`normalize(posWorld);`:T`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?T`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===Ot.Normal||t.pbrMode===Ot.Schematic?T`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?T`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:T`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===mt.ColorAlpha?T`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
      }
    `)}return e.include(jUe,t),e}const D2t=Object.freeze(Object.defineProperty({__proto__:null,build:L2t},Symbol.toStringTag,{value:"Module"}));let F2t=class extends NUe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Dc(s7),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=ns.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Be(0,0,0),this.instancedDoublePrecision=!1,this.normalType=yr.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Be(.2,.2,.2),this.diffuse=Be(.8,.8,.8),this.externalColor=ni(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=M(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=HE.Less,this.textureAlphaMode=Yr.Blend,this.textureAlphaCutoff=x8,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=pr.Occlude,this.isDecoration=!1}},k2t=class extends LUe{constructor(){super(...arguments),this.origin=M(),this.slicePlaneLocalOrigin=this.origin}},nde=class KUe extends hr{initializeConfiguration(e,i){i.spherical=e.viewingMode===Xe.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,i.textureCoordinateType=i.hasColorTexture||i.hasMetallicRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?ks.Default:ks.None,i.objectAndLayerIdColorInstanced=i.instanced}initializeProgram(e){return this._initializeProgram(e,KUe.shader)}_initializeProgram(e,i){return new dr(e.rctx,i.get().build(this.configuration),Fi)}_makePipeline(e,i){const r=this.configuration,s=e===mt.NONE,n=e===mt.FrontFace;return ti({blending:r.output===G.Color&&r.transparent?s?Ch:c1(e):null,culling:B2t(r)?C9(r.cullFace):null,depthTest:{func:Yx(e,U2t(r.customDepthTest))},depthWrite:(s||n)&&r.writeDepth?Oh:null,drawBuffers:r.output===G.Depth?{buffers:[zo.NONE]}:u1(e),colorWrite:fi,stencilWrite:r.hasOccludees?x0:null,stencilTest:r.hasOccludees?i?bx:Xx:null,polygonOffset:s||n?null:K9(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function U2t(t){return t===HE.Lequal?Lr.LEQUAL:Lr.LESS}function B2t(t){return t.cullFace!==ns.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}nde.shader=new ir(D2t,()=>ye(()=>import("./DefaultMaterial.glsl-2a952a46.js"),[],import.meta.url));let oi=class extends $u{constructor(){super(...arguments),this.output=G.Color,this.alphaDiscardMode=Yr.Opaque,this.doubleSidedMode=Ws.None,this.pbrMode=Ot.Disabled,this.cullFace=ns.None,this.transparencyPassType=mt.NONE,this.normalType=yr.Attribute,this.textureCoordinateType=ks.None,this.customDepthTest=HE.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};d([V({count:G.COUNT})],oi.prototype,"output",void 0),d([V({count:Yr.COUNT})],oi.prototype,"alphaDiscardMode",void 0),d([V({count:Ws.COUNT})],oi.prototype,"doubleSidedMode",void 0),d([V({count:Ot.COUNT})],oi.prototype,"pbrMode",void 0),d([V({count:ns.COUNT})],oi.prototype,"cullFace",void 0),d([V({count:mt.COUNT})],oi.prototype,"transparencyPassType",void 0),d([V({count:yr.COUNT})],oi.prototype,"normalType",void 0),d([V({count:ks.COUNT})],oi.prototype,"textureCoordinateType",void 0),d([V({count:HE.COUNT})],oi.prototype,"customDepthTest",void 0),d([V()],oi.prototype,"spherical",void 0),d([V()],oi.prototype,"hasVertexColors",void 0),d([V()],oi.prototype,"hasSymbolColors",void 0),d([V()],oi.prototype,"hasVerticalOffset",void 0),d([V()],oi.prototype,"hasSlicePlane",void 0),d([V()],oi.prototype,"hasSliceHighlight",void 0),d([V()],oi.prototype,"hasColorTexture",void 0),d([V()],oi.prototype,"hasMetallicRoughnessTexture",void 0),d([V()],oi.prototype,"hasEmissionTexture",void 0),d([V()],oi.prototype,"hasOcclusionTexture",void 0),d([V()],oi.prototype,"hasNormalTexture",void 0),d([V()],oi.prototype,"hasScreenSizePerspective",void 0),d([V()],oi.prototype,"hasVertexTangents",void 0),d([V()],oi.prototype,"hasOccludees",void 0),d([V()],oi.prototype,"multipassEnabled",void 0),d([V()],oi.prototype,"hasModelTransformation",void 0),d([V()],oi.prototype,"offsetBackfaces",void 0),d([V()],oi.prototype,"vvSize",void 0),d([V()],oi.prototype,"vvColor",void 0),d([V()],oi.prototype,"receiveShadows",void 0),d([V()],oi.prototype,"receiveAmbientOcclusion",void 0),d([V()],oi.prototype,"textureAlphaPremultiplied",void 0),d([V()],oi.prototype,"instanced",void 0),d([V()],oi.prototype,"instancedColor",void 0),d([V()],oi.prototype,"objectAndLayerIdColorInstanced",void 0),d([V()],oi.prototype,"instancedDoublePrecision",void 0),d([V()],oi.prototype,"doublePrecisionRequiresObfuscation",void 0),d([V()],oi.prototype,"writeDepth",void 0),d([V()],oi.prototype,"transparent",void 0),d([V()],oi.prototype,"enableOffset",void 0),d([V()],oi.prototype,"cullAboveGround",void 0),d([V()],oi.prototype,"snowCover",void 0),d([V()],oi.prototype,"hasColorTextureTransform",void 0),d([V()],oi.prototype,"hasEmissionTextureTransform",void 0),d([V()],oi.prototype,"hasNormalTextureTransform",void 0),d([V()],oi.prototype,"hasOcclusionTextureTransform",void 0),d([V()],oi.prototype,"hasMetallicRoughnessTextureTransform",void 0),d([V({constValue:!1})],oi.prototype,"occlusionPass",void 0),d([V({constValue:!0})],oi.prototype,"hasVvInstancing",void 0),d([V({constValue:!1})],oi.prototype,"useCustomDTRExponentForWater",void 0),d([V({constValue:!1})],oi.prototype,"supportsTextureAtlas",void 0),d([V({constValue:!0})],oi.prototype,"useFillLights",void 0);function z2t(t){const e=new tr,{vertex:i,fragment:r,varyings:s}=e;return Pu(i,t),e.include(e4),s.add("vpos","vec3"),e.include($v,t),e.include(zFe,t),e.include(R4e,t),t.output===G.Color&&(yg(e.vertex,t),e.include(JI,t),e.include(ec,t),t.offsetBackfaces&&e.include(BUe),t.instancedColor&&e.attributes.add(O.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.multipassEnabled&&s.add("depth","float"),e.include(jm,t),e.include(YI,t),e.include(zUe,t),e.include(LC,t),i.uniforms.add(new Ki("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),i.code.add(T`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${T.float(Ba)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.multipassEnabled?T`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===G.Color&&(e.include(Wn,t),e.include(XE,t),e.include(p4,t),e.include(JR,t),e.include(t.instancedDoublePrecision?m4:sI,t),e.include(V0,t),yg(e.fragment,t),r1(r),f4(r),t$(r),r.uniforms.add(i.uniforms.get("localOrigin"),i.uniforms.get("view"),new Qt("ambient",n=>n.ambient),new Qt("diffuse",n=>n.diffuse),new et("opacity",n=>n.opacity),new et("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new Et("tex",n=>n.texture)),e.include(jue,t),e.include(ide,t),r.include(sde),t.transparencyPassType===mt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),L0(r),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?T`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===Ot.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?T`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?T`albedo = mix(albedo, vec3(1), 0.9);`:T``}
        ${T`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===Ot.Normal||t.pbrMode===Ot.Schematic?t.spherical?T`vec3 normalGround = normalize(vpos + localOrigin);`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:T``}
        ${t.pbrMode===Ot.Normal||t.pbrMode===Ot.Schematic?T`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?T`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:T`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===mt.ColorAlpha?T`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `)),e.include(jUe,t),e}const V2t=Object.freeze(Object.defineProperty({__proto__:null,build:z2t},Symbol.toStringTag,{value:"Module"}));let e5e=class t5e extends nde{initializeConfiguration(e,i){super.initializeConfiguration(e,i),i.hasMetallicRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=yr.Attribute,i.doubleSidedMode=Ws.WindingOrder,i.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,t5e.shader)}};e5e.shader=new ir(V2t,()=>ye(()=>import("./RealisticTree.glsl-7f0c0e58.js"),[],import.meta.url));let vg=class extends qx{constructor(e){super(e,H2t),this.supportsEdges=!0,this.produces=new Map([[Ce.OPAQUE_MATERIAL,i=>(gD(i)||DP(i))&&!this.parameters.transparent],[Ce.TRANSPARENT_MATERIAL,i=>(gD(i)||DP(i))&&this.parameters.transparent&&this.parameters.writeDepth],[Ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>(gD(i)||DP(i))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._configuration=new oi,this._vertexBufferLayout=q2t(this.parameters)}isVisibleForOutput(e){return e!==G.Shadow&&e!==G.ShadowExcludeHighlight&&e!==G.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:i,hasVertexColors:r,hasSymbolColors:s,vvColor:n}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=i||n||s;return r&&c?o||a:r?o?l:a:c?o||a:o?l:a}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?ns.None:this.parameters.cullFace,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e===G.Color&&(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=Ws.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Ws.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Ws.WindingOrder:Ws.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=this.parameters.receiveAmbientOcclusion&&i.ssao!=null,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Ot.Schematic:Ot.Normal:Ot.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<J9,this._configuration.snowCover=this.hasSnowCover(i),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,i,r,s,n,o){if(this.parameters.verticalOffset!=null){const a=r.camera;ue(_X,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case Xe.Global:l=Se(A1e,_X);break;case Xe.Local:l=ge(A1e,X2t)}let c=0;const u=Me(Z2t,_X,a.eye),h=De(u),p=ce(u,u,1/h);let f=null;this.parameters.screenSizePerspective&&(f=xe(l,p)),c+=$4e(a,h,this.parameters.verticalOffset,f??0,this.parameters.screenSizePerspective),ce(l,l,c),Ga(yX,l,r.transform.inverseRotation),s=Me(W2t,s,yX),n=Me(Y2t,n,yX)}AUe(e,r,s,n,ote(r.verticalOffset),o)}createGLMaterial(e){return new G2t(e)}createBufferWriter(){return new QI(this._vertexBufferLayout)}},G2t=class extends Gue{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===G.Color&&(this._updateShadowState(e),this._updateOccludeeState(e));const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return ue(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?e5e:nde,e)}},j2t=class extends F2t{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const H2t=new j2t;function q2t(t){const e=Xs().vec3f(O.POSITION);return t.normalType===yr.Compressed?e.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(O.NORMAL),t.hasVertexTangents&&e.vec4f(O.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(O.UV0),t.hasVertexColors&&e.vec4u8(O.COLOR),t.hasSymbolColors&&e.vec4u8(O.SYMBOLCOLOR),ae("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}const W2t=M(),Y2t=M(),X2t=Be(0,0,1),A1e=M(),yX=M(),_X=M(),Z2t=M(),i5e=new jhe({});function y0i(t){return t.type==="web-style"?i5e:ode(t.symbolLayers.toArray().map(e=>r5e(t,e)))}function ode(t){let e=0,i=0,r=0,s=!1,n=0;const o=new SUe;for(const a of t)a!=null&&(e+=a.verticesPerFeature,i+=a.verticesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,s=s||a.estimated,++n);return s?new PTt(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o}):new RTt(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o})}function _0i(t){const e=ode(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const vX={};function r5e(t,e){const i=s5e(t,e),r=HTt(e)?2:0;switch(e.type){case"extrude":return new zp({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:i});case"fill":if(t.type==="mesh-3d")return new zp({drawCallsPerFeature:r,memory:i});if(e.outline!=null&&e.outline.size>0)return new zp({verticesPerFeature:-12,verticesPerCoordinate:9,memory:i});case"water":return new zp({verticesPerFeature:-6,verticesPerCoordinate:3,memory:i});case"line":return new zp({verticesPerFeature:-6,verticesPerCoordinate:6,memory:i});case"object":return e.resource?.href?new jhe({verticesPerFeature:100,memory:i}):{...J2t(e.resource?.primitive??VLe),memory:i};case"path":{let s=0,n=0;switch(e.profile){case"circle":s=_Ue;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join){case"round":n=yUe;break;case"miter":case"bevel":n=1;break;default:return}const o=2*s,a=s*n*2,l=a+o;let c=-2*a-o;switch(e.cap){case"none":break;case"butt":case"square":c+=2*(s-1);break;case"round":c+=2*(s*(dse-1)*2+s);break;default:return}return new zp({verticesPerFeature:c,verticesPerCoordinate:l,memory:i})}case"text":case"icon":return new zp({verticesPerFeature:6,memory:i});default:return}}function s5e(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?tu.EXTRUDE_EDGES:tu.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?tu.FILL_OUTLINE:tu.FILL;case"water":return tu.FILL;case"line":return e.join==="round"?tu.LINE_ROUND:tu.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return tu.PATH_ROUND_CIRCLE;case"quad":return tu.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return tu.PATH_MITER_CIRCLE;case"quad":return tu.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?tu.OBJECT_POINT:tu.OBJECT_POLYGON;case"icon":case"text":return i?tu.ICON_POINT:tu.ICON_POLYGON;default:return}}function J2t(t){const e=vX[t];if(e)return e;const i=n5e(xUe(t,new vg({})).levels);return vX[t]=new zp({verticesPerFeature:i}),vX[t]}function n5e(t){return t.reduce((e,i,r)=>e+i.numVertices*(1/10**r),0)/t.reduce((e,i,r)=>e+1/10**r,0)}const tu={ICON_POINT:{bytesPerFeature:2379.8272296852992,bytesPerFeatureLabel:852.246235,resourceBytes:0,draped:{bytesPerFeature:1868.2382921559424,bytesPerFeatureLabel:839.205415}},ICON_POLYGON:{bytesPerFeature:2957.8429876524656,bytesPerFeatureLabel:862.5307816666666,resourceBytes:0,draped:{bytesPerFeature:2579.7767085451133,bytesPerFeatureLabel:856.9298550000001}},OBJECT_POINT:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999,resourceBytes:0,draped:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999}},OBJECT_POLYGON:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998,resourceBytes:0,draped:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998}},LINE_MITER:{bytesPerFeature:3081.208408220661,bytesPerFeatureLabel:858.6749016666668,resourceBytes:0,draped:{bytesPerFeature:2682.57863388475,bytesPerFeatureLabel:844.6118016666666}},LINE_ROUND:{bytesPerFeature:3209.3236242927915,bytesPerFeatureLabel:858.1810416666667,resourceBytes:0,draped:{bytesPerFeature:2687.6256038096126,bytesPerFeatureLabel:849.578535}},PATH_MITER_CIRCLE:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415,resourceBytes:0,draped:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415}},PATH_ROUND_CIRCLE:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001,resourceBytes:0,draped:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001}},PATH_MITER_QUAD:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355,resourceBytes:0,draped:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355}},PATH_ROUND_QUAD:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955,resourceBytes:0,draped:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955}},FILL:{bytesPerFeature:3147.43349219103,bytesPerFeatureLabel:850.7598550000001,resourceBytes:0,draped:{bytesPerFeature:2673.7898488975106,bytesPerFeatureLabel:846.6459950000002}},FILL_OUTLINE:{bytesPerFeature:4565.099993465867,bytesPerFeatureLabel:855.334515,resourceBytes:0,draped:{bytesPerFeature:3904.46969705314,bytesPerFeatureLabel:844.7081016666667}},EXTRUDE:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333,resourceBytes:0,draped:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333}},EXTRUDE_EDGES:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335,resourceBytes:0,draped:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335}}};var Dn;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(Dn||(Dn={}));let ade=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=wd.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===wd.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===wd.FAILED?(i&&i(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=wd.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=wd.FAILED,!En(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=qc(this._abortController):this._loadStatus===wd.LOADING&&(this._loadStatus=wd.FAILED),this._loader=null}};var wd;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(wd||(wd={}));const j1=()=>oe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let j0=class extends ade{constructor(e,i,r,s){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this._materials=[],this.usedMemory=0,this.logger=j1(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new E8,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=R1e(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const i=this._drivenProperties,r=R1e(e);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,i,r,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;n?!this._logGeometryValidationWarnings(i,r,s)&&o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&j1().warnOncePerTick(`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):j1().warnOncePerTick(`${a} (failed to project geometry to view spatial reference)`)}_logGeometryValidationWarnings(e,i,r){const s=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(j1().warnOncePerTick(`${s} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(j1().warnOncePerTick(`${s} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(i!=null&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const s=e;if(!isFinite(s.x)||!isFinite(s.y))return j1().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":Utt(e)&&j1().warnOncePerTick("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return Q2t}_defaultElevationInfoZ(){return K2t}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,i=new E8){const r=e.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?bTt:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,e,this._context.layer),i}prepareSymbolLayerPatch(e){}updateGeometry(e,i){return!1}updateTransform(e,i,r,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=P1e){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?r*=e.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,i=P1e){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return SD(null,r);const s=e!=null?Ke.toUnitRGB(e):bv;return SD(s,r)}_getVertexOpacityAndColor(e,i=null){const r=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=SD(r,s);return i&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return r5e(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==cn.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,i,r){let s=cn.UPDATE;return e.forEach(n=>{const o=i(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=cn.RECREATE}),s}applyRendererDiff(e,i){return Dn.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const i=this._fastUpdates.visualVariables,r=i.size?eg(i.size.field,e):0,s=i.color?eg(i.color.field,e):0,n=i.opacity?eg(i.opacity.field,e):0;return ni(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&j1().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null});return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function R1e(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(i=>{switch(i.type){case"color":if(e.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const Q2t={mode:"on-the-ground",offset:0,unit:"meters"},K2t={mode:"absolute-height",offset:0,unit:"meters"},P1e={hasIntrinsicColor:!1};let Zx=class extends r4{get geometries(){return this._geometries}get transformation(){return this._transformation??us}set transformation(e){this._transformation=Xn(this._transformation??Ne(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?Xn(this._shaderTransformation??Ne(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=an.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new o5e),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Tt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];i&&(this._emit("geometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,i,r=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:i,sync:r}),zgt(i)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new o8(qv.MaskOccludee);for(const i of this._geometries)i.occludees=Lre(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=Dre(i.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new o8(qv.Highlight);for(const i of this._geometries)i.highlights=Lre(i.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const i of this._geometries)i.highlights=Dre(i.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,i){return Or(i,this.transformation,e.transformation)}getCombinedShaderTransformation(e,i=Ne()){return Or(i,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new O1e,this._validateBoundingVolume(this._bvWorldSpace,TD.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new O1e,this._validateBoundingVolume(this._bvObjectSpace,TD.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,i){const r=i===TD.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&eEt(n,e,r?s.transformation:this.getCombinedShaderTransformation(s))}Br(e.bounds,e.min,e.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=r?s.transformation:this.getCombinedShaderTransformation(s),a=FO(o);nt(I1e,n.center,o);const l=jr(I1e,e.bounds),c=n.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,i){this._parentLayer&&this._parentLayer.events.emit(e,i)}get test(){}},o5e=class{constructor(){this.min=Be(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Be(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},O1e=class extends o5e{constructor(){super(...arguments),this.bounds=Bn()}};function eEt(t,e,i){const r=t.bbMin,s=t.bbMax;if(Rq(i)){const n=ue(tEt,i[12],i[13],i[14]);Te(Vh,r,n),Te(Lf,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Vh[o]),e.max[o]=Math.max(e.max[o],Lf[o])}else if(nt(Vh,r,i),ga(r,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Vh[n]),e.max[n]=Math.max(e.max[n],Vh[n]);else{nt(Lf,s,i);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Vh[n],Lf[n]),e.max[n]=Math.max(e.max[n],Vh[n],Lf[n]);for(let n=0;n<3;++n){ge(Vh,r),ge(Lf,s),Vh[n]=s[n],Lf[n]=r[n],nt(Vh,Vh,i),nt(Lf,Lf,i);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Vh[o],Lf[o]),e.max[o]=Math.max(e.max[o],Vh[o],Lf[o])}}}const tEt=M(),Vh=M(),Lf=M(),I1e=M();var TD;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(TD||(TD={}));function lde(t,e,i,r,s){if(l5e(t,e))return null;i.localOrigin=cde(t,e);const n=new Zx({geometries:[i],castShadow:!1,layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:n,sampledElevation:oUe(n,e,t.elevationProvider,t.renderCoordsHelper,r)}}function a5e(t,e,i,r){return l5e(e,i)?null:oUe(t,i,e.elevationProvider,e.renderCoordsHelper,r)}function l5e(t,e){const i=t.clippingExtent;return!!i&&(lc(e,Tw,t.elevationProvider.spatialReference),!wue(i,Tw))}function ZE(t,e,i){const r=t.elevationContext,s=i.spatialReference;lc(e,Tw,s),r.centerPointInElevationSR=Dx(Tw[0],Tw[1],e.hasZ?Tw[2]:0,s??null)}function hE(t){switch(t.type){case"point":return t;case"polygon":case"extent":return Vhe(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=rOe(e,Jle(e)/2);return Dx(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.origin}return null}function cde(t,e){return lc(e,Tw,t.renderCoordsHelper.spatialReference),t.localOriginFactory.getOrigin(Tw)}const Tw=M();function c5e(){return new Float32Array(2)}function iEt(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function Iy(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function rEt(t,e){return new Float32Array(t,e,2)}function u5e(){return c5e()}function h5e(){return Iy(1,1)}function d5e(){return Iy(1,0)}function p5e(){return Iy(0,1)}const f5e=u5e(),m5e=h5e(),sEt=d5e(),nEt=p5e();Object.freeze(Object.defineProperty({__proto__:null,ONES:m5e,UNIT_X:sEt,UNIT_Y:nEt,ZEROS:f5e,clone:iEt,create:c5e,createView:rEt,fromValues:Iy,ones:h5e,unitX:d5e,unitY:p5e,zeros:u5e},Symbol.toStringTag,{value:"Module"}));function oEt(t){const e=new tr,{vertex:i,fragment:r}=e;return i.include(X9),e.include(I4e,t),e.include(Wn,t),e.attributes.add(O.UV0,"vec2"),i.uniforms.add(new Ki("viewport",(s,n)=>n.camera.fullViewport),new et("lineSize",(s,n)=>s.size>0?Math.max(1,s.size)*n.camera.pixelRatio:0),new os("pixelToNDC",(s,n)=>Gi(N1e,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new et("borderSize",(s,n)=>s.borderColor!=null?n.camera.pixelRatio:0),new os("screenOffset",(s,n)=>Gi(N1e,s.horizontalScreenOffset*n.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.multipassEnabled&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(W4e),t.hasScreenSizePerspective&&Y9(i),i.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?T`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?T`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:T`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.multipassEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?T`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:T`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?T`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:T`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add(new Ki("uColor",s=>$1e(s.color)),new Ki("borderColor",s=>$1e(s.borderColor))),t.multipassEnabled&&(r.include(F0t,t),r.uniforms.add(new os("inverseViewport",(s,n)=>n.inverseViewport))),r.code.add(T`
    void main() {
      ${t.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?T`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:T`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function $1e(t){return t??Ud}const N1e=vt(),aEt=Object.freeze(Object.defineProperty({__proto__:null,build:oEt},Symbol.toStringTag,{value:"Module"}));let g5e=class y5e extends hr{initializeConfiguration(e,i){i.spherical=e.viewingMode===Xe.Global}initializeProgram(e){return new dr(e.rctx,y5e.shader.get().build(this.configuration),Fi)}setPipelineState(e){const i=e?Lr.ALWAYS:Lr.LESS;return this.configuration.depthHudEnabled?ti({depthTest:{func:i},depthWrite:Oh}):ti({blending:Za(ke.ONE,ke.SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:fi})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}};g5e.shader=new ir(aEt,()=>ye(()=>import("./LineCallout.glsl-4ea7337a.js"),[],import.meta.url));let xp=class extends $u{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.multipassEnabled=!1}};d([V()],xp.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([V()],xp.prototype,"spherical",void 0),d([V()],xp.prototype,"occlusionTestEnabled",void 0),d([V()],xp.prototype,"hasVerticalOffset",void 0),d([V()],xp.prototype,"hasScreenSizePerspective",void 0),d([V()],xp.prototype,"depthHudEnabled",void 0),d([V()],xp.prototype,"depthHudAlignStartEnabled",void 0),d([V()],xp.prototype,"hasSlicePlane",void 0),d([V()],xp.prototype,"multipassEnabled",void 0),d([V({constValue:!0})],xp.prototype,"hasSliceInVertexProgram",void 0),d([V({constValue:!1})],xp.prototype,"draped",void 0);let L5=class fse extends qx{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new _5e),this.produces=new Map([[Ce.LINE_CALLOUTS,i=>i===G.Color],[Ce.LINE_CALLOUTS_HUD_DEPTH,i=>i===G.Color]]),this._configuration=new xp,this._uniqueMaterialIdentifier=fse.uniqueMaterialIdentifier(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,i){const r=i?.slot!==Ce.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration}intersect(){}createGLMaterial(e){return new lEt(e)}createBufferWriter(){return new uEt}validateParameters(e){const i=fse.uniqueMaterialIdentifier(e);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier({renderOccluded:e,isDecoration:i,horizontalScreenOffset:r,color:s,size:n,occlusionTest:o,shaderPolygonOffset:a,depthHUDAlignStart:l,centerOffsetUnits:c,hasSlicePlane:u,screenSizePerspective:h,verticalOffset:p,borderColor:f}){return wXe`${e}:${i}:${r}:[${s}]:${n}:${o}:${a}:${l}:${c}:${u}:${h!=null}:{${p.screenLength}:${p.minWorldLength}:${p.maxWorldLength}}:[${f}]`}},lEt=class extends jx{beginSlot(e){return this.ensureTechnique(g5e,e)}},_5e=class extends $he{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const cEt=Xs().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4f(O.CENTEROFFSETANDDISTANCE),L1e=[Iy(0,0),Iy(1,0),Iy(0,1),Iy(1,0),Iy(1,1),Iy(0,1)];let uEt=class{constructor(){this.vertexBufferLayout=cEt}elementCount(e){return 6*e.attributes.get(O.POSITION).indices.length}write(e,i,r,s,n){Nhe(r.attributes.get(O.POSITION),e,s.position,n,6),Lhe(r.attributes.get(O.NORMAL),i,s.normal,n,6),tI(r.attributes.get(O.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,n,6);for(let o=0;o<L1e.length;++o)s.uv0.setVec(n+o,L1e[o])}},v5e=class b5e extends j0{constructor(e,i){super(e,null,i,pEt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new L5(this._materialParameters),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.horizontalScreenOffset=e.horizontalScreenOffset??0,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){const e=new _5e,i=this.symbol,r=i.callout;if(e.color=r.color!=null?Ke.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=Yn(r.size||0),i.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=i.verticalOffset;e.verticalOffset={screenLength:Yn(o),minWorldLength:a||0,maxWorldLength:l??1/0}}e.borderColor=r.border?.color!=null?Ke.toUnitRGBA(r.border.color):null;const s=i.symbolLayers.at(0).type==="object",n=i.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return dEt}createGraphics3DGraphic(e){const i=e.renderingInfo,r=e.graphic,s=this.setGraphicElevationContext(r,new E8,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!YLe(l)))return null;const a=Vhe(r.geometry);return a==null?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=c4(b5e.elevationModeChangeTypes,r,s);return n!==cn.UPDATE||e.forEach(o=>{const a=i(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}updateGraphicElevationContext(e,i){this.setGraphicElevationContext(e,i.elevationContext,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=mf(i.elevationContext.mode)}computeComplexity(){return new zp({verticesPerFeature:6})}_getOrCreateMaterial(e){const i=this._perInstanceMaterialParameters(e),r=L5.uniqueMaterialIdentifier(i);if(r===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let s=e.materialCollection.get(r);return s==null&&(s=new L5(i),e.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new L5(i),isUnique:!0}}_createAs3DShape(e,i,r,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(r),l=new Zn(a.material,hEt(r),null,an.Point,o),c=lde(this._context,e,l,i,s);if(c==null)return null;const u=new G0(this,c.object,[l],a.isUnique?[a.material]:null,null,uE,i);return u.metadata=new gUe(r.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=mf(i.mode),ZE(u,e,this._context.elevationProvider),u}};function hEt(t){const{translation:e,centerOffset:i}=t,r=new dt(e?[e[0],e[1],e[2]]:[0,0,0],bX,3,!0),s=new dt(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],bX,4,!0);return[[O.POSITION,r],[O.NORMAL,new dt([0,0,1],bX,3,!0)],[O.CENTEROFFSETANDDISTANCE,s]]}v5e.elevationModeChangeTypes={definedChanged:cn.UPDATE,staysOnTheGround:cn.UPDATE,onTheGroundChanged:cn.RECREATE};const bX=[0],dEt={mode:"relative-to-ground",offset:0},pEt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let fEt=class{constructor(e,i,r=M(),s=pi(),n=0,o="world",a=0,l=null){this.renderer=e,this.symbol=i,this.translation=r,this.centerOffset=s,this.horizontalScreenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},mEt=class extends wTt{};const D1e=()=>oe.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function gEt(t,e){if(!Aue(t))return D1e().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=yEt[t.callout.type];return i?new i(t,e):(D1e().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const yEt={line:v5e};function P0i(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance,1,1]:[1,1,1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax,t.extent.zmin??0,t.extent.mmin??0]:[0,0,0,0]}:null}function _Et(t){return t.originPosition==="lowerLeft"&&t.scale.length===4&&t.translate.length===4}function g4(t){if(_Et(t))return t;const{originPosition:e,scale:i,translate:r}=t,s=i[0]??1,n=i[1]??1;return{originPosition:"lowerLeft",scale:[s,e==="lowerLeft"?n:-n,i[2]??1,i[3]??1],translate:[r[0]??0,r[1]??0,r[2]??0,r[3]??0]}}function vEt({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function bEt({scale:t,translate:e},i){return Math.round((i-e[1])/t[1])}function wEt({scale:t,translate:e},i){return Math.round(((i??0)-e[2])/t[2])}function xEt({scale:t,translate:e},i){return i?Math.round((i-e[3])/t[3]):0}function y4({scale:t,translate:e},i){return i*t[0]+e[0]}function _4({scale:t,translate:e},i){return i*t[1]+e[1]}function FF({scale:t,translate:e},i){return(i??0)*t[2]+e[2]}function kF({scale:t,translate:e},i){return i?i*t[3]+e[3]:0}function ude(t,e){return t&&e?CEt:t&&!e?TEt:!t&&e?EEt:SEt}const SEt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=y4(t,r[0]),n=_4(t,r[1]);i[0]=[s,n];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[h,p]=e[u];s+=l*h,n+=c*p,i[u]=[s,n]}return i},TEt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=y4(t,r[0]),n=_4(t,r[1]);i[0]=[s,n,FF(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[h,p,f]=e[u];s+=l*h,n+=c*p,i[u]=[s,n,FF(t,f)]}return i},EEt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=y4(t,r[0]),n=_4(t,r[1]);i[0]=[s,n,kF(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[h,p,f]=e[u];s+=l*h,n+=c*p,i[u]=[s,n,kF(t,f)]}return i},CEt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=y4(t,r[0]),n=_4(t,r[1]);i[0]=[s,n,FF(t,r[2]),kF(t,r[3])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[h,p,f,g]=e[u];s+=l*h,n+=c*p,i[u]=[s,n,FF(t,f),kF(t,g)]}return i};function w5e(t,e,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=e(t,i[s]);return r}function O0i(t,e,i){const r=g4(t);return e.x=vEt(r,i.x),e.y=bEt(r,i.y),i.z!=null&&(e.z=wEt(r,i.z)),i.m!=null&&(e.m=xEt(r,i.m)),e}function x5e(t,e,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(i!=null){const n=g4(t);e.points=ude(r,s)(n,i.points),e.hasZ=r,e.hasM=s}return e}function S5e(t,e,i,r=i?.z!=null,s=i?.m!=null){if(i==null)return e;const n=g4(t);return e.x=y4(n,i.x),e.y=_4(n,i.y),r&&(e.z=FF(n,i.z)),s&&(e.m=kF(n,i.m)),e}function T5e(t,e,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(i!=null){const n=g4(t);e.rings=w5e(n,ude(r,s),i.rings),e.hasZ=r,e.hasM=s}return e}function E5e(t,e,i,r=i?.hasZ??!1,s=i?.hasM??!1){if(i!=null){const n=g4(t);e.paths=w5e(n,ude(r,s),i.paths),e.hasZ=r,e.hasM=s}return e}let I0i=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function N0i(t){return t.geometry!=null}let L0i=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function F0i(t,e){const i=fF.fromJSON(t.geometryType),r=Je.fromJSON(t.spatialReference),s=t.transform,n=t.objectIdFieldName,o=e?.maxStringAttributeLength,a=e?.maxStringAttributeFields;let l;const c=t.features.map(u=>{const h=MEt(u,i,r,t.objectIdFieldName),p=h.geometry;if(IEt(h.attributes,a,o,f=>{l??=[];const g=OEt(h,n);g!=null&&l.push({objectId:g,attribute:f})}),p!=null&&s)switch(p.type){case"point":h.geometry=S5e(s,p,p);break;case"multipoint":h.geometry=x5e(s,p,p);break;case"polygon":h.geometry=T5e(s,p,p);break;case"polyline":h.geometry=E5e(s,p,p);break;case"extent":case"mesh":h.geometry=p}return h});return{geometryType:i,features:c,spatialReference:r,fields:t.fields?.map(u=>Xk.fromJSON(u))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null,missingAttributes:l}}function MEt(t,e,i,r){return{uid:Ld(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:AEt(t.geometry,e,i),visible:!0}}function AEt(t,e,i){if(t==null)return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function REt(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)i+=n.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32*(s.length+1);break}case"multipoint":{const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.points.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=Ww(t.vertexAttributes.position,t.vertexAttributes.normal,t.vertexAttributes.uv,t.vertexAttributes.tangent)}return e}function k0i(t){let e=32;return e+=tAe(t.attributes),e+=3,e+=8+REt(t.geometry),e}function U0i(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function B0i(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function z0i(t,e){switch(hs(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)iY(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)iY(e,t.rings[i],!!t.hasZ);break;case"multipoint":iY(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function PEt(t,e){switch(Hd(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)TW(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)TW(e,t.rings[i]);break;case"multipoint":TW(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function OEt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function IEt(t,e,i,r){if(e?.size&&i!=null&&t)for(const s in t){if(!e.has(s))continue;const n=t[s];typeof n=="string"&&n.length>i&&(r(s),t[s]="")}}const wX=2;let Ih=class tR{constructor(e=[],i=[],r=!1){this.lengths=e??[],this.coords=i??[],this.hasIndeterminateRingOrder=r}static fromJSON(e){return new tR(e.lengths,e.coords,e.hasIndeterminateRingOrder)}static fromRect(e){const[i,r,s,n]=e,o=s-i,a=n-r;return new tR([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)e(this.coords[wX*(n+i)],this.coords[wX*(n+i)+1]);i+=s}}deltaDecode(){const e=this.clone(),{coords:i,lengths:r}=e;let s=0;for(const n of r){for(let o=1;o<n;o++)i[2*(s+o)]+=i[2*(s+o)-2],i[2*(s+o)+1]+=i[2*(s+o)-1];s+=n}return e}clone(e){if(this.lengths.length===0)return new tR([],[this.coords[0],this.coords[1]]);const i=(this.lengths.length===0?1:this.lengths.reduce((s,n)=>s+n))*wX,r=this.coords.slice(0,i);return e?(e.set(r),new tR(this.lengths,e,this.hasIndeterminateRingOrder)):new tR(Array.from(this.lengths),Array.from(r),this.hasIndeterminateRingOrder)}},nI=class xG{constructor(e=null,i={},r,s){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(e,i){const r=e.geometry?Ih.fromJSON(e.geometry):null,s=e.centroid?Ih.fromJSON(e.centroid):null,n=e.attributes[i];return new xG(r,e.attributes,s,n)}weakClone(){const e=new xG(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){const e=this.geometry?.clone(),i=new xG(e,{...this.attributes},this.centroid?.clone(),this.objectId);return i.displayId=this.displayId,i.geohashX=this.geohashX,i.geohashY=this.geohashY,i}};function V0i(t){return!!t.geometry?.coords?.length}let $Et=class C5e{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new C5e;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};function hc(t,e){return t?e?4:3:e?3:2}const v4=()=>oe.getLogger("esri.layers.graphics.featureConversionUtils"),M5e={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},NEt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n},F1e=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2]},LEt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+3]},DEt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2],t[i+3]=e[r+3]};function hde(t,e,i,r){if(t){if(i)return e&&r?DEt:F1e;if(e&&r)return LEt}else if(e&&r)return F1e;return NEt}function xX({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function SX({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function TX({scale:t,translate:e},i,r){return i*t[r]+e[r]}function G0i(t,e,i){return t?e?i?fde(t):dde(t):i?pde(t):o7(t):null}function o7(t){const e=t.coords;return{x:e[0],y:e[1]}}function A5e(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function dde(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function FEt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function pde(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function kEt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function fde(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function UEt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function BEt(t,e,i,r){let s=o7;i&&r?s=fde:i?s=dde:r&&(s=pde);for(const n of e){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;t.push({attributes:a,geometry:l})}return t}function mde(t,e){return t&&e?UEt:t?FEt:e?kEt:A5e}function zEt(t,e,i,r,s){const n=mde(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?n(new Ih,o):null;t.push(new nI(l,a,null,s?a[s]:void 0))}return t}function VEt(t,e,i=mde(e.z!=null,e.m!=null)){return i(t,e)}function GEt(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?R5e(s,i,r):null});return t}function R5e(t,e,i){if(t==null)return null;const r=hc(e,i),s=[];for(let n=0;n<t.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(t.coords[n+a]);s.push(o)}return e?i?{points:s,hasZ:e,hasM:i}:{points:s,hasZ:e}:i?{points:s,hasM:i}:{points:s}}function jEt(t,e,i,r,s){const n=hc(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?P5e(new Ih,o,n):null;t.push(new nI(l,a,null,s?a[s]:void 0))}return t}function P5e(t,e,i=hc(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let s=0;for(const n of e.points)for(let o=0;o<i;o++)r[s++]=n[o];return t}function HEt(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?O5e(s,i,r):null});return t}function O5e(t,e,i){if(!t)return null;const r=hc(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const h=[];for(let p=0;p<r;p++)h.push(s[a++]);c.push(h)}o.push(c)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function qEt(t,e,i,r,s){const n=hc(i,r);for(const{geometry:o,attributes:a,centroid:l}of e){const c=o!=null?I5e(new Ih,o,n):null,u=l!=null?VEt(new Ih,l):null;t.push(new nI(c,a,u,s?a[s]:void 0))}return t}function I5e(t,e,i=hc(e.hasZ,e.hasM)){const{lengths:r,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return t}function WEt(t,e,i,r){for(const{geometry:s,attributes:n,centroid:o}of e){const a=s!=null?$5e(s,i,r):null;if(o!=null){const l=o7(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function $5e(t,e,i){if(!t)return null;const r=hc(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const h=[];for(let p=0;p<r;p++)h.push(s[a++]);c.push(h)}o.push(c)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function YEt(t,e,i,r,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=n!=null?N5e(new Ih,n,i,r):null,c=s?a[s]:void 0;o!=null?t.push(new nI(l,a,A5e(new Ih,o),c)):t.push(new nI(l,a,null,c))}return t}function N5e(t,e,i=e.hasZ,r=e.hasM){return XEt(t,e.rings,i,r)}function XEt(t,e,i,r){const s=hc(i,r),{lengths:n,coords:o}=t;let a=0;Nv(t);for(const l of e){for(const c of l)for(let u=0;u<s;u++)o[a++]=c[u];n.push(l.length)}return t}const HP=[],ED=[];function j0i(t,e,i,r,s){HP[0]=t;const[n]=L5e(ED,HP,e,i,r,s);return bg(HP),bg(ED),n}function L5e(t,e,i,r,s,n){if(bg(t),!i){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new nI(null,o.attributes,null,a))}return t}switch(i){case"esriGeometryPoint":return zEt(t,e,r,s,n);case"esriGeometryMultipoint":return jEt(t,e,r,s,n);case"esriGeometryPolyline":return qEt(t,e,r,s,n);case"esriGeometryPolygon":return YEt(t,e,r,s,n);default:v4().error("convertToFeatureSet:unknown-geometry",new j(`Unable to parse unknown geometry type '${i}'`)),bg(t)}return t}function H0i(t,e,i,r){ED[0]=t,D5e(HP,ED,e,i,r);const s=HP[0];return bg(HP),bg(ED),s}function ZEt(t,e,i){if(t==null)return null;const r=new Ih;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),AO(t)?mde(e??t.z!=null,i??t.m!=null)(r,t):zc(t)?N5e(r,t,e,i):Lm(t)?I5e(r,t,hc(e,i)):Z2(t)?P5e(r,t,hc(e,i)):void v4().error("convertFromGeometry:unknown-geometry",new j(`Unable to parse unknown geometry type '${t}'`))}function JEt(t,e,i,r){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=o7;return i&&r?n=fde:i?n=dde:r&&(n=pde),n(s)}case"esriGeometryMultipoint":return R5e(s,i,r);case"esriGeometryPolyline":return O5e(s,i,r);case"esriGeometryPolygon":return $5e(s,i,r);default:return v4().error("convertToGeometry:unknown-geometry",new j(`Unable to parse unknown geometry type '${e}'`)),null}}function QEt(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function D5e(t,e,i,r,s){if(bg(t),i==null)return QEt(t,e);switch(i){case"esriGeometryPoint":return BEt(t,e,r,s);case"esriGeometryMultipoint":return GEt(t,e,r,s);case"esriGeometryPolyline":return HEt(t,e,r,s);case"esriGeometryPolygon":return WEt(t,e,r,s);default:v4().error("convertToFeatureSet:unknown-geometry",new j(`Unable to parse unknown geometry type '${i}'`))}return t}function q0i(t){const{objectIdFieldName:e,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:p}=t,f={features:D5e([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:u,queryGeometry:JEt(h,p,!1,!1)};return r&&(f.transform=r),c&&(f.exceededTransferLimit=c),n&&(f.hasM=n),o&&(f.hasZ=o),f}function W0i(t,e){const i=new $Et,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:h}=t;return h&&(i.fields=h),i.geometryType=l??null,i.objectIdFieldName=o??e??null,i.spatialReference=a??null,i.objectIdFieldName?(n&&L5e(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),u&&(i.transform=u),i):(v4().error(new j("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function Y0i(t){const{transform:e,features:i,hasM:r,hasZ:s}=t;if(!e)return t;for(const n of i)n.geometry!=null&&U1e(n.geometry,n.geometry,r,s,e),n.centroid!=null&&U1e(n.centroid,n.centroid,r,s,e);return t.transform=null,t}function X0i(t,e){const{geometryType:i,features:r,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new Ih,k1e(l.geometry,a.geometry,s,n,i,t),a.centroid&&(l.centroid=new Ih,k1e(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),r[o]=l}return e.transform=t,e}function k1e(t,e,i,r,s,n,o=i,a=r){if(Nv(t),!e?.coords.length)return null;const l=M5e[s],{coords:c,lengths:u}=e,h=hc(i,r),p=hc(i&&o,r&&a),f=hde(i,r,o,a);if(!u.length)return f(t.coords,c,0,0,xX(n,c[0]),SX(n,c[1])),Nv(t,h,0),t;let g,y,v,b,w=0,x=0,S=x;for(const E of u){if(E<l)continue;let C=0;x=S,v=g=xX(n,c[w]),b=y=SX(n,c[w+1]),f(t.coords,c,x,w,v,b),C++,w+=h,x+=p;for(let R=1;R<E;R++,w+=h)v=xX(n,c[w]),b=SX(n,c[w+1]),v===g&&b===y||(f(t.coords,c,x,w,v-g,b-y),x+=p,C++,g=v,y=b);C>=l&&(t.lengths.push(C),S=x)}return bg(t.coords,S),t.coords.length?t:null}function Z0i(t,e,i,r,s,n,o=i,a=r){if(Nv(t),!e?.coords.length)return null;const l=M5e[s],{coords:c,lengths:u}=e,h=hc(i,r),p=hc(i&&o,r&&a),f=hde(i,r,o,a);if(!u.length)return f(t.coords,c,0,0,c[0],c[1]),Nv(t,h,0),t;let g=0;const y=n*n;for(const v of u){if(v<l){g+=v*h;continue}const b=t.coords.length/p,w=g,x=g+(v-1)*h;f(t.coords,c,t.coords.length,w,c[w],c[w+1]),mse(t.coords,c,h,y,f,w,x),f(t.coords,c,t.coords.length,x,c[x],c[x+1]);const S=t.coords.length/p-b;S>=l?t.lengths.push(S):bg(t.coords,b*p),g+=v*h}return t.coords.length?t:null}function KEt(t,e,i,r){const s=t[e],n=t[e+1],o=t[i],a=t[i+1],l=t[r],c=t[r+1];let u=o,h=a,p=l-u,f=c-h;if(p!==0||f!==0){const g=((s-u)*p+(n-h)*f)/(p*p+f*f);g>1?(u=l,h=c):g>0&&(u+=p*g,h+=f*g)}return p=s-u,f=n-h,p*p+f*f}function mse(t,e,i,r,s,n,o){let a,l=r,c=0;for(let u=n+i;u<o;u+=i)a=KEt(e,u,n,o),a>l&&(c=u,l=a);l>r&&(c-n>i&&mse(t,e,i,r,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>i&&mse(t,e,i,r,s,c,o))}function J0i(t,e,i,r){if(!e?.coords?.length)return null;const s=hc(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let u=0;u<c.length;u+=s){const h=c[u],p=c[u+1];n=Math.min(n,h),a=Math.max(a,h),o=Math.min(o,p),l=Math.max(l,p)}}return Gte(t)?Tft(t,n,o,a,l):Oq(n,o,a,l,t),t}function U1e(t,e,i,r,s){const{coords:n,lengths:o}=e,a=hc(i,r);if(!n.length)return t!==e&&Nv(t),t;aq(s);const{originPosition:l,scale:c,translate:u}=s,h=tCt;h.originPosition=l;const p=h.scale;p[0]=c[0]??1,p[1]=-(c[1]??1),p[2]=c[2]??1,p[3]=c[3]??1;const f=h.translate;if(f[0]=u[0]??0,f[1]=u[1]??0,f[2]=u[2]??0,f[3]=u[3]??0,!o.length){for(let y=0;y<a;++y)t.coords[y]=TX(h,n[y],y);return t!==e&&Nv(t,a,0),t}let g=0;for(let y=0;y<o.length;y++){const v=o[y];t.lengths[y]=v;for(let x=0;x<a;++x)t.coords[g+x]=TX(h,n[g+x],x);let b=t.coords[g],w=t.coords[g+1];g+=a;for(let x=1;x<v;x++,g+=a){b+=n[g]*p[0],w+=n[g+1]*p[1],t.coords[g]=b,t.coords[g+1]=w;for(let S=2;S<a;++S)t.coords[g+S]=TX(h,n[g+S],S)}}return t!==e&&Nv(t,n.length,o.length),t}function Q0i(t,e,i,r,s,n){if(Nv(t),t.lengths.push(...e.lengths),i===s&&r===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=hc(i,r),a=hde(i,r,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function eCt(t,e,i,r){let s=0,n=t[r*e],o=t[r*(e+1)];for(let a=1;a<i;a++){const l=n+t[r*(e+a)],c=o+t[r*(e+a)+1],u=(l-n)*(c+o);n=l,o=c,s+=u}return .5*s}function K0i(t,e){const{coords:i,lengths:r}=t;let s=0,n=0;for(let o=0;o<r.length;o++){const a=r[o];n+=eCt(i,s,a,e),s+=a}return Math.abs(n)}function Nv(t,e=0,i=0){bg(t.lengths,i),bg(t.coords,e)}function bg(t,e=0){t.length!==e&&(t.length=e)}const tCt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},B1e=new Tl(Array,t=>v9(t,DLe),null,10,5),iCt=li();let rCt=class{get labelLayers(){return this._labelLayers||hXe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e?.isElevationSource)}constructor(e,i,r,s,n){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._visibleFlags=yl.ALL_LABEL,this.deconflictionPriority=0,++i.referenced,this._featureExpressionFeature=n?dUe(n,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,i){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(i),e.setVisibility(this.isVisible(fa.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=fa.GRAPHIC,i){const r=i?this._visibleFlags|i|fa.LABEL*i:this._visibleFlags;return e===fa.GRAPHIC?(r&yl.ALL_GRAPHIC)===yl.ALL_GRAPHIC:(r&yl.ALL_LABEL)===yl.ALL_LABEL}setVisibilityFlag(e,i,r){const s=this.isVisible(e);r?this._visibleFlags|=e*i:this._visibleFlags&=~(e*i);const n=this.isVisible(e);if(s===n)return!1;if(e===fa.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(fa.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,i){return!!(this._visibleFlags&e*i)}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(i==null)return!1;this._extent=li(),PEt(i,this._extent);const r=i.spatialReference;if(!Bs(r,e)&&!Zq(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,i,r){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Ix.fromExtent(s.type==="mesh"?s.extent:s)),ZEt(s,i,r)}get usedMemory(){let e=tAe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>e+=i.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:M(),num:0},draped:{origin:vt(),num:0}};for(const i of this.layers)i?.computeAttachmentOrigin(e);return e.render.num>1&&ce(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Ed(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?hs(n.boundingBox):n.boundingBox=hs(),n.requiresDrapedElevation=!1,await gq(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?i:e,l=B1e.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&HO(n.boundingBox,l),B1e.release(l)}),xft(n.boundingBox)||UK(xue(n.boundingBox,iCt))?n:null}needsElevationUpdates(){for(const e of this.layers)if(e!=null&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;return this._labelLayers?.some(e=>e?.needsElevationUpdates??!1)??!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(e,i))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}_forEachGraphicList(e,i){e?.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}},t_i=class{constructor(e,i){this.scheduler=e,this.schedule=i,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},sCt=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var z1e,V1e,G1e,F5e={exports:{}};z1e=F5e,V1e=function(){function t(L,k,H){H=H||2;var q,Q,K,re,be,Re,je,_t=k&&k.length,ht=_t?k[0]*H:L.length,ut=e(L,0,ht,H,!0),lt=[];if(!ut||ut.next===ut.prev)return lt;if(_t&&(ut=l(L,k,ut,H)),L.length>80*H){q=K=L[0],Q=re=L[1];for(var at=H;at<ht;at+=H)(be=L[at])<q&&(q=be),(Re=L[at+1])<Q&&(Q=Re),be>K&&(K=be),Re>re&&(re=Re);je=(je=Math.max(K-q,re-Q))!==0?1/je:0}return r(ut,lt,H,q,Q,je),lt}function e(L,k,H,q,Q){var K,re;if(Q===me(L,k,H,q)>0)for(K=k;K<H;K+=q)re=Y(K,L[K],L[K+1],re);else for(K=H-q;K>=k;K-=q)re=Y(K,L[K],L[K+1],re);if(re&&E(re,re.next)){var be=re.next;W(re),re=be}return re}function i(L,k){if(!L)return L;k||(k=L);var H,q=L;do if(H=!1,q.steiner||!E(q,q.next)&&S(q.prev,q,q.next)!==0)q=q.next;else{var Q=q.prev;if(W(q),(q=k=Q)===q.next)break;H=!0}while(H||q!==k);return k}function r(L,k,H,q,Q,K,re){if(L){!re&&K&&g(L,q,Q,K);for(var be,Re,je=L;L.prev!==L.next;)if(be=L.prev,Re=L.next,K?n(L,q,Q,K):s(L))k.push(be.i/H),k.push(L.i/H),k.push(Re.i/H),W(L),L=Re.next,je=Re.next;else if((L=Re)===je){re?re===1?r(L=o(i(L),k,H),k,H,q,Q,K,2):re===2&&a(L,k,H,q,Q,K):r(i(L),k,H,q,Q,K,1);break}}}function s(L){var k=L.prev,H=L,q=L.next;if(S(k,H,q)>=0)return!1;for(var Q=L.next.next;Q!==L.prev;){if(w(k.x,k.y,H.x,H.y,q.x,q.y,Q.x,Q.y)&&S(Q.prev,Q,Q.next)>=0)return!1;Q=Q.next}return!0}function n(L,k,H,q){var Q=L.prev,K=L,re=L.next;if(S(Q,K,re)>=0)return!1;for(var be=Q.x<K.x?Q.x<re.x?Q.x:re.x:K.x<re.x?K.x:re.x,Re=Q.y<K.y?Q.y<re.y?Q.y:re.y:K.y<re.y?K.y:re.y,je=Q.x>K.x?Q.x>re.x?Q.x:re.x:K.x>re.x?K.x:re.x,_t=Q.y>K.y?Q.y>re.y?Q.y:re.y:K.y>re.y?K.y:re.y,ht=v(be,Re,k,H,q),ut=v(je,_t,k,H,q),lt=L.prevZ,at=L.nextZ;lt&&lt.z>=ht&&at&&at.z<=ut;){if(lt!==L.prev&&lt!==L.next&&w(Q.x,Q.y,K.x,K.y,re.x,re.y,lt.x,lt.y)&&S(lt.prev,lt,lt.next)>=0||(lt=lt.prevZ,at!==L.prev&&at!==L.next&&w(Q.x,Q.y,K.x,K.y,re.x,re.y,at.x,at.y)&&S(at.prev,at,at.next)>=0))return!1;at=at.nextZ}for(;lt&&lt.z>=ht;){if(lt!==L.prev&&lt!==L.next&&w(Q.x,Q.y,K.x,K.y,re.x,re.y,lt.x,lt.y)&&S(lt.prev,lt,lt.next)>=0)return!1;lt=lt.prevZ}for(;at&&at.z<=ut;){if(at!==L.prev&&at!==L.next&&w(Q.x,Q.y,K.x,K.y,re.x,re.y,at.x,at.y)&&S(at.prev,at,at.next)>=0)return!1;at=at.nextZ}return!0}function o(L,k,H){var q=L;do{var Q=q.prev,K=q.next.next;!E(Q,K)&&C(Q,q,q.next,K)&&D(Q,K)&&D(K,Q)&&(k.push(Q.i/H),k.push(q.i/H),k.push(K.i/H),W(q),W(q.next),q=L=K),q=q.next}while(q!==L);return i(q)}function a(L,k,H,q,Q,K){var re=L;do{for(var be=re.next.next;be!==re.prev;){if(re.i!==be.i&&x(re,be)){var Re=B(re,be);return re=i(re,re.next),Re=i(Re,Re.next),r(re,k,H,q,Q,K),void r(Re,k,H,q,Q,K)}be=be.next}re=re.next}while(re!==L)}function l(L,k,H,q){var Q,K,re,be=[];for(Q=0,K=k.length;Q<K;Q++)(re=e(L,k[Q]*q,Q<K-1?k[Q+1]*q:L.length,q,!1))===re.next&&(re.steiner=!0),be.push(b(re));for(be.sort(c),Q=0;Q<be.length;Q++)H=i(H=h(be[Q],H),H.next);return H}function c(L,k){return L.x-k.x}function u(L){if(L.next.prev===L)return L;let k=L;for(;;){const H=k.next;if(H.prev===k||H===k||H===L)break;k=H}return k}function h(L,k){var H=p(L,k);if(!H)return k;var q=B(H,L),Q=i(H,H.next);let K=u(q);return i(K,K.next),Q=u(Q),u(k===H?Q:k)}function p(L,k){var H,q=k,Q=L.x,K=L.y,re=-1/0;do{if(K<=q.y&&K>=q.next.y&&q.next.y!==q.y){var be=q.x+(K-q.y)*(q.next.x-q.x)/(q.next.y-q.y);if(be<=Q&&be>re){if(re=be,be===Q){if(K===q.y)return q;if(K===q.next.y)return q.next}H=q.x<q.next.x?q:q.next}}q=q.next}while(q!==k);if(!H)return null;if(Q===re)return H;var Re,je=H,_t=H.x,ht=H.y,ut=1/0;q=H;do Q>=q.x&&q.x>=_t&&Q!==q.x&&w(K<ht?Q:re,K,_t,ht,K<ht?re:Q,K,q.x,q.y)&&(Re=Math.abs(K-q.y)/(Q-q.x),D(q,L)&&(Re<ut||Re===ut&&(q.x>H.x||q.x===H.x&&f(H,q)))&&(H=q,ut=Re)),q=q.next;while(q!==je);return H}function f(L,k){return S(L.prev,L,k.prev)<0&&S(k.next,L,L.next)<0}function g(L,k,H,q){var Q=L;do Q.z===null&&(Q.z=v(Q.x,Q.y,k,H,q)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==L);Q.prevZ.nextZ=null,Q.prevZ=null,y(Q)}function y(L){var k,H,q,Q,K,re,be,Re,je=1;do{for(H=L,L=null,K=null,re=0;H;){for(re++,q=H,be=0,k=0;k<je&&(be++,q=q.nextZ);k++);for(Re=je;be>0||Re>0&&q;)be!==0&&(Re===0||!q||H.z<=q.z)?(Q=H,H=H.nextZ,be--):(Q=q,q=q.nextZ,Re--),K?K.nextZ=Q:L=Q,Q.prevZ=K,K=Q;H=q}K.nextZ=null,je*=2}while(re>1);return L}function v(L,k,H,q,Q){return(L=1431655765&((L=858993459&((L=252645135&((L=16711935&((L=32767*(L-H)*Q)|L<<8))|L<<4))|L<<2))|L<<1))|(k=1431655765&((k=858993459&((k=252645135&((k=16711935&((k=32767*(k-q)*Q)|k<<8))|k<<4))|k<<2))|k<<1))<<1}function b(L){var k=L,H=L;do(k.x<H.x||k.x===H.x&&k.y<H.y)&&(H=k),k=k.next;while(k!==L);return H}function w(L,k,H,q,Q,K,re,be){return(Q-re)*(k-be)-(L-re)*(K-be)>=0&&(L-re)*(q-be)-(H-re)*(k-be)>=0&&(H-re)*(K-be)-(Q-re)*(q-be)>=0}function x(L,k){return L.next.i!==k.i&&L.prev.i!==k.i&&!F(L,k)&&(D(L,k)&&D(k,L)&&z(L,k)&&(S(L.prev,L,k.prev)||S(L,k.prev,k))||E(L,k)&&S(L.prev,L,L.next)>0&&S(k.prev,k,k.next)>0)}function S(L,k,H){return(k.y-L.y)*(H.x-k.x)-(k.x-L.x)*(H.y-k.y)}function E(L,k){return L.x===k.x&&L.y===k.y}function C(L,k,H,q){var Q=I(S(L,k,H)),K=I(S(L,k,q)),re=I(S(H,q,L)),be=I(S(H,q,k));return Q!==K&&re!==be||!(Q!==0||!R(L,H,k))||!(K!==0||!R(L,q,k))||!(re!==0||!R(H,L,q))||!(be!==0||!R(H,k,q))}function R(L,k,H){return k.x<=Math.max(L.x,H.x)&&k.x>=Math.min(L.x,H.x)&&k.y<=Math.max(L.y,H.y)&&k.y>=Math.min(L.y,H.y)}function I(L){return L>0?1:L<0?-1:0}function F(L,k){var H=L;do{if(H.i!==L.i&&H.next.i!==L.i&&H.i!==k.i&&H.next.i!==k.i&&C(H,H.next,L,k))return!0;H=H.next}while(H!==L);return!1}function D(L,k){return S(L.prev,L,L.next)<0?S(L,k,L.next)>=0&&S(L,L.prev,k)>=0:S(L,k,L.prev)<0||S(L,L.next,k)<0}function z(L,k){var H=L,q=!1,Q=(L.x+k.x)/2,K=(L.y+k.y)/2;do H.y>K!=H.next.y>K&&H.next.y!==H.y&&Q<(H.next.x-H.x)*(K-H.y)/(H.next.y-H.y)+H.x&&(q=!q),H=H.next;while(H!==L);return q}function B(L,k){var H=new J(L.i,L.x,L.y),q=new J(k.i,k.x,k.y),Q=L.next,K=k.prev;return L.next=k,k.prev=L,H.next=Q,Q.prev=H,q.next=H,H.prev=q,K.next=q,q.prev=K,q}function Y(L,k,H,q){var Q=new J(L,k,H);return q?(Q.next=q.next,Q.prev=q,q.next.prev=Q,q.next=Q):(Q.prev=Q,Q.next=Q),Q}function W(L){L.next.prev=L.prev,L.prev.next=L.next,L.prevZ&&(L.prevZ.nextZ=L.nextZ),L.nextZ&&(L.nextZ.prevZ=L.prevZ)}function J(L,k,H){this.i=L,this.x=k,this.y=H,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function me(L,k,H,q){for(var Q=0,K=k,re=H-q;K<H;K+=q)Q+=(L[re]-L[K])*(L[K+1]+L[re+1]),re=K;return Q}return t.deviation=function(L,k,H,q){var Q=k&&k.length,K=Q?k[0]*H:L.length,re=Math.abs(me(L,0,K,H));if(Q)for(var be=0,Re=k.length;be<Re;be++){var je=k[be]*H,_t=be<Re-1?k[be+1]*H:L.length;re-=Math.abs(me(L,je,_t,H))}var ht=0;for(be=0;be<q.length;be+=3){var ut=q[be]*H,lt=q[be+1]*H,at=q[be+2]*H;ht+=Math.abs((L[ut]-L[at])*(L[lt+1]-L[ut+1])-(L[ut]-L[lt])*(L[at+1]-L[ut+1]))}return re===0&&ht===0?0:Math.abs((ht-re)/re)},t.flatten=function(L){for(var k=L[0][0].length,H={vertices:[],holes:[],dimensions:k},q=0,Q=0;Q<L.length;Q++){for(var K=0;K<L[Q].length;K++)for(var re=0;re<k;re++)H.vertices.push(L[Q][K][re]);Q>0&&(q+=L[Q-1].length,H.holes.push(q))}return H},t},(G1e=V1e())!==void 0&&(z1e.exports=G1e);const oI=s4(F5e.exports);function nCt(t,e,i){wx(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function wx(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return t;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[4],u=i[5],h=i[6],p=i[8],f=i[9],g=i[10],y=i[12],v=i[13],b=i[14];let w=0,x=0;for(let S=0;S<n;S++){const E=e[w],C=e[w+1],R=e[w+2];t[x]=o*E+c*C+p*R+y,t[x+1]=a*E+u*C+f*R+v,t[x+2]=l*E+h*C+g*R+b,w+=s,x+=r}return t}function k5e(t,e,i){a7(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function a7(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],h=i[5],p=i[6],f=i[7],g=i[8];let y=0,v=0;for(let b=0;b<n;b++){const w=e[y],x=e[y+1],S=e[y+2];t[v]=o*w+c*x+p*S,t[v+1]=a*w+u*x+f*S,t[v+2]=l*w+h*x+g*S,y+=s,v+=r}}function oCt(t,e,i){I8(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function I8(t,e,i,r=3,s=r){const n=Math.min(t.length/r,e.length/s);let o=0,a=0;for(let l=0;l<n;l++)t[a]=i*e[o],t[a+1]=i*e[o+1],t[a+2]=i*e[o+2],o+=s,a+=r;return t}function aCt(t,e,i,r=3,s=r){const n=t.length/r;if(n!==Math.ceil(e.length/s))return t;let o=0,a=0;for(let l=0;l<n;l++)t[a]=e[o]+i[0],t[a+1]=e[o+1]+i[1],t[a+2]=e[o+2]+i[2],o+=s,a+=r;return t}function lCt(t,e){aI(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function aI(t,e,i=3,r=i){const s=Math.min(t.length/i,e.length/r);let n=0,o=0;for(let a=0;a<s;a++){const l=e[n],c=e[n+1],u=e[n+2],h=l*l+c*c+u*u;if(h>0){const p=1/Math.sqrt(h);t[o]=p*l,t[o+1]=p*c,t[o+2]=p*u}n+=r,o+=i}}function cCt(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let u=0;u<r;u++)s[c]=o[l]>>i,s[c+1]=o[l+1]>>i,s[c+2]=o[l+2]>>i,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,normalize:aI,normalizeView:lCt,scale:I8,scaleView:oCt,shiftRight:cCt,transformMat3:a7,transformMat3View:k5e,transformMat4:wx,transformMat4View:nCt,translate:aCt},Symbol.toStringTag,{value:"Module"}));function uCt(t,e,i){return{objectId:t,target:e,distance:i,type:"vertex"}}function j1e(t,e,i,r,s,n=!1){return{objectId:t,target:e,distance:i,type:"edge",start:r,end:s,draped:n}}var Lv,ka;function QR(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function UF(t){return t!=null&&!isNaN(t)&&isFinite(t)}function U5e(t){return t.valueExpression?Lv.Expression:t.field&&typeof t.field=="string"?Lv.Field:Lv.Unknown}function hCt(t,e){const i=e||U5e(t),r=t.valueUnit||"unknown";return i===Lv.Unknown?ka.Constant:t.stops?ka.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?ka.ClampedLinear:r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?ka.Proportional:ka.Additive:ka.Identity:ka.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(Lv||(Lv={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(ka||(ka={}));const B5e=()=>oe.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),l7=t=>B5e().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${t}`),c7=()=>B5e().error("Use of arcade expressions requires an arcade context"),H1e=new fg,SG=Math.PI,z5e=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function V5e(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void l7("ColorVariable");const s=typeof e=="number",n=s?null:e,o=n?.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:u}=r.cache;let h=r.cache.compiledFunc;if(!l&&!u){const g=r.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(u){if(i?.arcade==null)return void c7();const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(g),b=y.createExecContext(n,v,i.timeZone);if(!h){const w=y.createSyntaxTree(r.valueExpression);h=y.createFunction(w),r.cache.compiledFunc=h}a=y.executeFunction(h,b)}else o&&(a=o[l]);const p=r.normalizationField,f=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||s||!isNaN(f)&&f!==0)){isNaN(f)||s||(a/=f);const g=yde(a,c);if(g){const y=g[0],v=g[1],b=y===v?r.stops[y].color:Ke.blendColors(r.stops[y].color,r.stops[v].color,g[2],i?.color);return new Ke(b)}}}function G5e(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void l7("OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n?.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:u}=r.cache;let h=r.cache.compiledFunc;if(!l&&!u){const g=r.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(u){if(i?.arcade==null)return void c7();const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(g),b=y.createExecContext(n,v,i.timeZone);if(!h){const w=y.createSyntaxTree(r.valueExpression);h=y.createFunction(w),r.cache.compiledFunc=h}a=y.executeFunction(h,b)}else o&&(a=o[l]);const p=r.normalizationField,f=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||s||!isNaN(f)&&f!==0)){isNaN(f)||s||(a/=f);const g=yde(a,c);if(g){const y=g[0],v=g[1];if(y===v)return r.stops[y].opacity;{const b=r.stops[y].opacity;return b+(r.stops[v].opacity-b)*g[2]}}}}function j5e(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(f=>f.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void l7("RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a?.attributes,c=r.field,{hasExpression:u}=r.cache;let h=r.cache.compiledFunc,p=0;if(!c&&!u)return p;if(u){if(i?.arcade==null)return void c7();const f={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},g=i.arcade.arcadeUtils,y=g.getViewInfo(f),v=g.createExecContext(a,y,i.timeZone);if(!h){const b=g.createSyntaxTree(r.valueExpression);h=g.createFunction(b),r.cache.compiledFunc=h}p=g.executeFunction(h,v)}else l&&(p=l[c]||0);return p=typeof p!="number"||isNaN(p)?null:n+o*p,p}function dCt(t,e,i){const r=typeof e=="number",s=r?null:e,n=s?.attributes;let o=r?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const u=i?.scale,h=i?.view;o=u==null||h==="3d"?pCt(t):u}else if(!r)switch(t.inputValueType){case Lv.Expression:{if(i?.arcade==null)return void c7();const u={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},h=i.arcade.arcadeUtils,p=h.getViewInfo(u),f=h.createExecContext(s,p,i.timeZone);if(!l){const g=h.createSyntaxTree(t.valueExpression);l=h.createFunction(g),t.cache.compiledFunc=l}o=h.executeFunction(l,f);break}case Lv.Field:n&&(o=n[t.field]);break;case Lv.Unknown:o=null}if(!UF(o))return null;if(r||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return UF(c)&&c!==0?o/c:null}function pCt(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function u7(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void l7("SizeVariable");const s=q5e(dCt(r,e,i),r,e,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function Mh(t,e,i){return t==null?null:QR(t)?u7(t,e,i):UF(t)?t:null}function H5e(t,e,i){return UF(i)&&t>i?i:UF(e)&&t<e?e:t}function fCt(t,e,i,r){return t+((Mh(e.minSize,i,r)||e.minDataValue)??0)}function mCt(t,e,i){const r=t.stops;let s=r?.length&&r[0].size;return s==null&&(s=t.minSize),Mh(s,e,i)}function gCt(t,e,i,r){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=Mh(e.minSize,i,r),o=Mh(e.maxSize,i,r),a=r?.shape;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?SG*(n/2)**2:n*n,u=c+s*((l?SG*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/SG):Math.sqrt(u)}return n+s*(o-n)}function yCt(t,e,i,r){const s=r?.shape,n=t/e.minDataValue,o=Mh(e.minSize,i,r),a=Mh(e.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,H5e(l,o,a)}function _Ct(t,e,i,r,s){const[n,o,a]=yde(t,s);if(n===o)return Mh(e.stops?.[n].size,i,r);{const l=Mh(e.stops?.[n].size,i,r);return l+(Mh(e.stops?.[o].size,i,r)-l)*a}}function vCt(t,e,i,r){const s=(r?.resolution??1)*QO[e.valueUnit],n=Mh(e.minSize,i,r),o=Mh(e.maxSize,i,r),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/SG)/s:a==="radius"||a==="distance"?2*t/s:t/s,H5e(l,n,o)}function q5e(t,e,i,r,s){switch(e.transformationType){case ka.Additive:return fCt(t,e,i,r);case ka.Constant:return mCt(e,i,r);case ka.ClampedLinear:return gCt(t,e,i,r);case ka.Proportional:return yCt(t,e,i,r);case ka.Stops:return _Ct(t,e,i,r,s);case ka.RealWorldSize:return vCt(t,e,i,r);case ka.Identity:return t;case ka.Unknown:return null}}function bCt(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const s={scale:e,view:i};let n=Mh(t.minSize,H1e,s),o=Mh(t.maxSize,H1e,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function gde(t,e,i){if(!t.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=V5e(l,e,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=G5e(l,e,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=j5e(l,e,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=u7(l,e,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function yde(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((s,n)=>t<s?(r=n,!0):(i=n,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function wCt(t,e,i){const r=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":u7(s,e,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}const s_i=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:wCt,getColor:V5e,getOpacity:G5e,getRotationAngle:j5e,getSize:u7,getSizeForValue:q5e,getSizeFromNumberOrVariable:Mh,getSizeRangeAtScale:bCt,getVisualVariableValues:gde,viewScaleRE:z5e},Symbol.toStringTag,{value:"Module"}));function h7(t,e){if(!t||t.symbol)return null;const i=e?.renderer;return t&&i!=null&&i.getObservationRenderer?i.getObservationRenderer(t):i}function xCt(t,e){if(t.symbol!=null)return t.symbol;const i=h7(t,e);return i!=null&&i.type!=="dot-density"?i.getSymbol(t,e):null}function n_i(t,e){const i=h7(t,e),r=xCt(t,e);if(r==null)return null;const s={renderer:i,symbol:r};if(i==null||!("visualVariables"in i)||!i.visualVariables)return s;const n=gde(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function SCt(t,e){if(t.symbol!=null)return t.symbol;const i=h7(t,e);return i!=null?i.getSymbolAsync(t,e):null}async function o_i(t,e){const i=h7(t,e),r=await SCt(t,e);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=gde(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=Ke.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function TCt(t,e=0){const i=t[e];return typeof i=="number"&&isFinite(i)?i:null}function ECt(t){for(let e=0;e<3;e++){const i=t[e];if(typeof i=="number")return isFinite(i)?i:0}return 0}function W5e(t,e,i){const r=CCt(q1e,t,e,i)?q1e:[0,0,1];return Math.abs(r[2])>Math.cos(Gt(80))?Ls.Z:Math.abs(r[1])>Math.abs(r[0])?Ls.Y:Ls.X}function CCt(t,e,i,r){const s=(o=>!Array.isArray(o[0]))(e)?(o,a)=>e[3*o+a]:(o,a)=>e[o][a],n=r?Xc(r)/AE(r):1;return Fce(t,(o,a)=>ue(o,s(a,0)*n,s(a,1)*n,s(a,2)),i)}const q1e=mr();function MCt(t,e,i){const r=(e.length>0?e[0]:t.length/3)-1,s=W5e(t,r,i);if(s!==Ls.Z){t=t.slice();for(let n=0;n<t.length;n+=3)t[n+s]=t[n+2]}return oI(t,e,3)}function W1e(t){const e=[[O.POSITION,new dt(t.attributeData.position,t.indices,3,!0)]],i=Hx(t.indices.length);return t.attributeData.colorFeature!=null?e.push([O.COLORFEATUREATTRIBUTE,new dt([t.attributeData.colorFeature],i,1,!0)]):t.attributeData.color&&e.push([O.COLOR,new dt(t.attributeData.color,i,4,!0)]),t.attributeData.uvMapSpace&&e.push([O.UVMAPSPACE,new dt(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([O.BOUNDINGRECT,new dt(t.attributeData.boundingRect,t.indices,9,!0)]),new Zn(t.material,e,t.mapPositions,an.Mesh,t.attributeData.objectAndLayerIdColor)}function Y1e(t,e=null){const i=[[O.POSITION,new dt(t.attributeData.position,t.indices,3,!0)],[O.UV0,new dt(t.attributeData.uv0,t.indices,2,!0)]];return new Zn(t.material,i,t.mapPositions,an.Mesh,e)}function BF(t){switch(t.type){case"extent":if(t instanceof lr)return Ix.fromExtent(t);break;case"polygon":return t}return null}let d7=class{constructor(e,i,r){this.renderData=e,this.layerUid=i,this.graphicUid=r,this.outGeometries=new Array}};function gse(t,e,i){const r=Array.isArray(t),s=r?t.length/e:t.byteLength/(4*e),n=r?t:new Uint32Array(t,0,s*e),o=i?.minReduction??0,a=i?.originalIndices||null,l=a?a.length:0,c=i?.componentOffsets||null;let u=0;if(c)for(let C=0;C<c.length-1;C++){const R=c[C+1]-c[C];R>u&&(u=R)}else u=s;const h=Math.floor(1.1*u)+1;(Ng==null||Ng.length<2*h)&&(Ng=new Uint32Array(EPe(2*h)));for(let C=0;C<2*h;C++)Ng[C]=0;let p=0;const f=!!c&&!!a,g=f?l:s;let y=n8(s);const v=new Uint32Array(l),b=1.96;let w=o!==0?Math.ceil(4*b*b/(o*o)*o*(1-o)):g,x=1,S=c?c[1]:g;for(let C=0;C<g;C++){if(C===w){const B=1-p/C;if(B+b*Math.sqrt(B*(1-B)/C)<o)return null;w*=2}if(C===S){for(let B=0;B<2*h;B++)Ng[B]=0;if(a)for(let B=c[x-1];B<c[x];B++)v[B]=y[a[B]];S=c[++x]}const R=f?a[C]:C,I=R*e,F=PCt(n,I,e);let D=F%h,z=p;for(;Ng[2*D+1]!==0;){if(Ng[2*D]===F){const B=Ng[2*D+1]-1;if(ACt(n,I,B*e,e)){z=y[B];break}}D++,D>=h&&(D-=h)}z===p&&(Ng[2*D]=F,Ng[2*D+1]=R+1,p++),y[R]=z}if(o!==0&&1-p/s<o)return null;if(f){for(let C=c[x-1];C<v.length;C++)v[C]=y[a[C]];y=l0(v)}const E=r?new Array(p):new Uint32Array(p*e);p=0;for(let C=0;C<g;C++)y[C]===p&&(RCt(n,(f?a[C]:C)*e,E,p*e,e),p++);if(a&&!f){const C=new Uint32Array(l);for(let R=0;R<C.length;R++)C[R]=y[a[R]];y=l0(C)}return{buffer:Array.isArray(E)?E:E.buffer,indices:y,uniqueCount:p}}function ACt(t,e,i,r){for(let s=0;s<r;s++)if(t[e+s]!==t[i+s])return!1;return!0}function RCt(t,e,i,r,s){for(let n=0;n<s;n++)i[r+n]=t[e+n]}function PCt(t,e,i){let r=0;for(let s=0;s<i;s++)r=t[e+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let Ng=null;function l_i(t){const e=b4(t.rings,t.hasZ,S0.CCW_IS_HOLE,t.spatialReference),i=new Array;let r=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,u=sf(e.position,3*c,3*l),h=a.holeIndices.map(f=>f-c),p=l0(oI(u,h,3));i.push({position:u,faces:p}),r+=u.length,s+=p.length}const n=OCt(i,r,s),o=Array.isArray(n.position)?gse(n.position,3,{originalIndices:n.faces}):gse(n.position.buffer,6,{originalIndices:n.faces});return n.position=ake(new Float64Array(o.buffer)),n.faces=o.indices,n}function OCt(t,e,i){if(t.length===1)return t[0];const r=qo(e),s=new Array(i);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:r,faces:l0(s)}}function b4(t,e,i,r){const s=t.length,n=new Array(s),o=new Array(s),a=new Array(s);let l=0;for(let g=0;g<s;++g)l+=t[g].length;let c=0,u=0,h=0;const p=qo(3*l);let f=0;for(let g=s-1;g>=0;g--){const y=t[g],v=i===S0.CCW_IS_HOLE&&ICt(y,e,r);if(v&&s!==1)n[c++]=y;else{let b=y.length;for(let x=0;x<c;++x)b+=n[x].length;const w={index:f,pathLengths:new Array(c+1),count:b,holeIndices:new Array(c)};w.pathLengths[0]=y.length,y.length>0&&(a[h++]={index:f,count:y.length}),f=v?D5(y,y.length-1,-1,p,f,y.length,e):D5(y,0,1,p,f,y.length,e);for(let x=0;x<c;++x){const S=n[x];w.holeIndices[x]=f,w.pathLengths[x+1]=S.length,S.length>0&&(a[h++]={index:f,count:S.length}),f=D5(S,0,1,p,f,S.length,e)}c=0,w.count>0&&(o[u++]=w)}}for(let g=0;g<c;++g){const y=n[g];y.length>0&&(a[h++]={index:f,count:y.length}),f=D5(y,0,1,p,f,y.length,e)}return o.length=u,a.length=h,{position:p,polygons:o,outlines:a}}function D5(t,e,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];r[s++]=l[0],r[s++]=l[1],r[s++]=o?l[2]:0,e+=i}return s/3}function ICt(t,e,i){if(!e)return!Z3(t);const r=t.length-1;switch(W5e(t,r,i)){case Ls.X:return!Z3(t,Ls.Y,Ls.Z);case Ls.Y:return!Z3(t,Ls.X,Ls.Z);case Ls.Z:return!Z3(t,Ls.X,Ls.Y)}}var S0;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(S0||(S0={}));var CD,$8,yse;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(CD||(CD={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}($8||($8={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(yse||(yse={}));var io,Wp,MD,qn;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(io||(io={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Wp||(Wp={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(MD||(MD={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(qn||(qn={}));let $Ct=class{constructor(e,i){this.vec3=e,this.id=i}};function N8(t,e,i,r){return new $Ct(Be(t,e,i),r)}let X1e=class{constructor(){this._extent=li(),this.resolution=0,this.renderLocalOrigin=N8(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new NCt}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];mj(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];mj(this._extent,-e.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,zv(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}},NCt=class{constructor(){this.extents=[li(),li(),li()],this.numViews=0}};var vs;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(vs||(vs={}));let LCt=class{constructor(e,i,r){this._fbos=e,this._format=i,this._name=r}get valid(){return this._handle?.getTexture()!=null}dispose(){this._handle=yi(this._handle)}get texture(){return this._handle?.getTexture()}bind(e,i,r){this._handle&&this._handle.fbo?.width===i&&this._handle.fbo?.height===r||(this._handle?.release(),this._handle=this._fbos.acquire(i,r,this._name,this._format)),e.unbindTexture(this._handle?.fbo?.colorTexture),e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}},TM=class{constructor(e,i,r,s,n=xs.RGBA_MIPMAP){this.output=r,this.content=s,this.fbo=new LCt(e,n,i)}get valid(){return this.fbo.valid}},DCt=class{constructor(e){this.targets=[new TM(e,"overlay color",G.Color,vs.Color),new TM(e,"overlay IM color",G.Color,vs.ColorNoRasterImage),new TM(e,"overlay highlight",G.Highlight,vs.Highlight,xs.RGBA4),new TM(e,"overlay water",G.Normal,vs.WaterNormal),new TM(e,"overlay occluded",G.Color,vs.Occluded)],ae("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new TM(e,"overlay oid",G.ObjectAndLayerIdColor,vs.ObjectAndLayerIdColor))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,i,r)=>i.valid?e|=1<<r:e,0)}},p7=class extends NUe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=M(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var kc;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight",t[t.ViewshedShadowMap=3]="ViewshedShadowMap"})(kc||(kc={}));let FCt=class extends p7{constructor(){super(...arguments),this.identifier=kc.Material,this.output=G.Color,this.transparent=!1}},kCt=class extends p7{constructor(){super(...arguments),this.identifier=kc.ShadowMap}},UCt=class extends p7{constructor(){super(...arguments),this.identifier=kc.Highlight}},BCt=class extends p7{constructor(){super(...arguments),this.identifier=kc.ViewshedShadowMap}};function zCt(t){t.fragment.code.add(T`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function VCt(t){t.fragment.code.add(T`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function GCt(t,e){const i=t.fragment;i.include(N0),i.uniforms.add(new os("nearFar",(r,s)=>s.camera.nearFar)),i.uniforms.add(new Et("depthMap",(r,s)=>s.depth?.attachment)),i.uniforms.add(new Ps("proj",(r,s)=>s.camera.projectionMatrix)),i.uniforms.add(new et("invResolutionHeight",(r,s)=>1/s.camera.height)),i.uniforms.add(new Ps("reprojectionMatrix",(r,s)=>s.ssr.reprojectionMatrix)),i.code.add(T`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function Y5e(t,e){t.include(M2t,e),t.include(E9),t.include(VCt),e.hasCloudsReflections&&t.include(lFe,e),e.hasScreenSpaceReflections&&t.include(GCt,e);const i=t.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",qUe).add("ssrHeightFadeEnd","float",O8).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(T`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new et("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new et("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)),i.code.add(T`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&i.code.add(T`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(i.uniforms.add(new Ps("view",(r,s)=>s.camera.viewMatrix),new Et("lastFrameColorTexture",(r,s)=>s.ssr.lastFrameColor?.getTexture()),new et("fadeFactorSSR",(r,s)=>s.ssr.fadeFactor)),i.code.add(T`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):i.code.add(T`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?i.code.add(T`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(T`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(T`return waterRenderedColor;
}`)}var Jy;function jCt(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new M8("overlayTexOffset",(s,n)=>HCt(s,n)),new M8("overlayTexScale",(s,n)=>qCt(s,n))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new Et("ovColorTex",(s,n)=>Z5e(s,n))),X5e(t,e)}function s3(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new Z1e("overlayTexOffset"),new Z1e("overlayTexScale")),r.uniforms.add(new et("overlayOpacity",s=>s.overlayOpacity),new Et("ovColorTex",(s,n)=>n.overlay?.getTexture(s.overlayContent))),X5e(t,e)}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(Jy||(Jy={}));let Z1e=class extends hn{constructor(e){super(e,"vec4")}};function X5e(t,e){e.pbrMode!==Ot.Water&&e.pbrMode!==Ot.WaterOnIntegratedMesh&&e.pbrMode!==Ot.TerrainWithWater||t.include(Y5e,e);const{vertex:i,fragment:r}=t;t.varyings.add("vtcOverlay","vec4"),i.code.add(T`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(T`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(T`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),r.code.add(T`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==Ot.Water&&e.pbrMode!==Ot.WaterOnIntegratedMesh&&e.pbrMode!==Ot.TerrainWithWater||(r1(r),L0(r),r.code.add(T`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function Z5e(t,e){return t.identifier===kc.Material&&t.output===G.Color?e.overlay?.getTexture(vs.ColorNoRasterImage):t.identifier===kc.Material&&t.output===G.ObjectAndLayerIdColor?e.overlay?.getTexture(vs.ObjectAndLayerIdColor):t.identifier===kc.Highlight?e.overlay?.getTexture(vs.Highlight):null}function HCt(t,e){const i=e.overlay?.overlays[io.INNER]?.extent;fj(i)&&(Vy[0]=t.toMapSpace[0]/Kl(i)-i[0]/Kl(i),Vy[1]=t.toMapSpace[1]/Au(i)-i[1]/Au(i));const r=e.overlay?.overlays[io.OUTER]?.extent;return fj(r)&&(Vy[2]=t.toMapSpace[0]/Kl(r)-r[0]/Kl(r),Vy[3]=t.toMapSpace[1]/Au(r)-r[1]/Au(r)),Vy}function qCt(t,e){const i=e.overlay?.overlays[io.INNER]?.extent;fj(i)&&(Vy[0]=t.toMapSpace[2]/Kl(i),Vy[1]=t.toMapSpace[3]/Au(i));const r=e.overlay?.overlays[io.OUTER]?.extent;return fj(r)&&(Vy[2]=t.toMapSpace[2]/Kl(r),Vy[3]=t.toMapSpace[3]/Au(r)),Vy}const Vy=pi();let J5e=class extends is{constructor(){super(...arguments),this.color=Be(1,1,1)}};function WCt(){const t=new tr;return t.include(Rl),t.fragment.uniforms.add(new Et("tex",e=>e.texture),new Qt("uColor",e=>e.color)),t.fragment.code.add(T`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);
}`),t}const YCt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:J5e,build:WCt},Symbol.toStringTag,{value:"Module"}));let Q5e=class{constructor(e){this._context=e,this._perConstructorInstances=new yx,this._frameCounter=0,this._keepAliveFrameCount=J1e}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,i=ZCt){const r=i.key;let s=this._perConstructorInstances.get(e,r);if(s==null){const n=new e(this._context,i,()=>this.release(n));s=new XCt(n),this._perConstructorInstances.set(e,r,s)}return++s.refCount,s.technique}releaseAndAcquire(e,i,r){if(r!=null){if(i.key===r.key)return r;this.release(r)}return this.acquire(e,i)}release(e){if(e==null||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(e.constructor,e.key);i!=null&&(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==J1e&&this._perConstructorInstances.forEach((e,i)=>{e.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(i,r))}),await Promise.all(e)}},XCt=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const J1e=-1,ZCt=new Zc;let K5e=class{constructor(e,i,r,s){this._textures=e,this._techniques=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new yx}dispose(){this._textures.destroy()}acquire(e,i,r){if(this._ownMaterial(e),!e.produces.get(i)?.(r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(n==null){const o=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:r});n=new JCt(o),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);r!=null&&(r.unref(),r.referenced||(jt(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&oe.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},JCt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,Tt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const QCt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let L8=class _se{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new ua,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),ua.clearPool(),vse[0]=null,kT.prune(),UT.prune()}add(e,i=e.length){this._objectCount+=i,this._grow(e,i);const r=ua.acquire();for(let s=0;s<i;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}ua.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=ua.acquire();for(const s of e){const n=i??zE(this.objectToBoundingSphere(s),aMt);XN(n[3])?(r.init(this._root),KCt(s,n,r)):this._degenerateObjects.delete(s)}ua.release(r),this._shrink()}update(e,i){if(!XN(i[3])&&this._isDegenerate(e))return;const r=oMt(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const s=Yd(e,i);TS(this._root,n=>{if(!tMt(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,s){const n=Yd(e,i);TS(this._root,o=>{if(!iMt(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(e){TS(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=EX(e,i),u=h=>{if(--n,!s(h))return;const p=this.objectToBoundingSphere(h);if(!xw(r,p))return;const f=Kb(e,i,p),g=f-p[3],y=f+p[3];g<o&&(o=g,a=y,l=h)};return Q1e(this._root,h=>{if(n<=0||!xw(r,h.bounds)||(ce(ap,c,h.halfSize),Te(ap,ap,h.bounds),Kb(e,i,ap)>a))return!1;const p=h.node;return p.terminals.forAll(f=>u(f)),p.residents!==null&&p.residents.forAll(f=>u(f)),!0},e,i),l}forEachInDepthRange(e,i,r,s,n,o,a){let l=-1/0,c=1/0;const u={setRange:y=>{r===_se.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,y.near),c=Math.min(c,y.far)):(l=Math.max(l,-y.far),c=Math.min(c,-y.near))}};u.setRange(s);const h=Kb(i,r,e),p=EX(i,r),f=EX(i,-r),g=y=>{if(!a(y))return;const v=this.objectToBoundingSphere(y),b=v,w=Kb(i,r,b)-h,x=w-v[3],S=w+v[3];x>c||S<l||!xw(o,v)||n(y,u)};Q1e(this._root,y=>{if(!xw(o,y.bounds)||(ce(ap,p,y.halfSize),Te(ap,ap,y.bounds),Kb(i,r,ap)-h>c)||(ce(ap,f,y.halfSize),Te(ap,ap,y.bounds),Kb(i,r,ap)-h<l))return!1;const v=y.node;return v.terminals.forAll(b=>g(b)),v.residents!==null&&v.residents.forAll(b=>g(b)),!0},i,r)}forEachNode(e){TS(this._root,i=>e(i.node,i.bounds,i.halfSize,i.depth))}forEachNeighbor(e,i){const r=Nw(i),s=i,n=l=>{const c=this.objectToBoundingSphere(l),u=Nw(c),h=r+u;return!(Xo(c,s)-h*h<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};TS(this._root,l=>{const c=Nw(l.bounds),u=r+c;if(Xo(l.bounds,s)-u*u>0)return!1;const h=l.node;return h.terminals.forAll(a),o&&h.residents!==null&&h.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsObject(e,i){const r=this.objectToBoundingSphere(i);return!(r[3]>0)||Yee(r,e)}_intersectsObjectWithOffset(e,i,r){const s=this.objectToBoundingSphere(i);return!(s[3]>0)||Yee(r.applyToBoundingSphere(s),e)}_add(e,i){i.advanceTo(this.objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const s=ua.acquire().init(e);this._add(i.at(r),s),ua.release(s)}}_grow(e,i){if(i!==0&&(K1e(e,i,r=>this.objectToBoundingSphere(r),s_),XN(s_[3])&&!this._fitsInsideTree(s_)))if(eBe(this._root.node))zE(s_,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(s_);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(s_,r):this._growRootAsSubNode(r),ua.release(r)}}_rebuildTree(e,i){ge(MX,i.bounds),MX[3]=i.halfSize,K1e([e,MX],2,s=>s,AX);const r=ua.acquire().init(this._root);this._root.initFrom(null,AX,AX[3]),this._root.increaseHalfSize(1.25),TS(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),ua.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return TS(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(r[l]-i),u=r[l]+i-(n[l]+o),h=Math.max(0,Math.ceil(c/(2*o))),p=Math.max(0,Math.ceil(u/(2*o)))+1,f=2**Math.ceil(Math.log(h+p)*Math.LOG2E);s=Math.max(s,f),F5[l].min=h,F5[l].max=p}for(let l=0;l<3;l++){let c=F5[l].min,u=F5[l].max;const h=(s-(c+u))/2;c+=Math.ceil(h),u+=Math.floor(h);const p=n[l]-o-c*o*2;CX[l]=p+(u+c)*o}const a=s*o;return CX[3]=a*iBe,ua.acquire().initFrom(null,CX,a,0)}_growRootAsSubNode(e){const i=this._root.node;ge(s_,this._root.bounds),s_[3]=this._root.halfSize,this._root.init(e),e.advanceTo(s_,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&e==null;)r=s++,e=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(e){return!XN(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:i,_objectCount:r}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:i,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){const i=e.children.map(n=>n?this._nodeToJSON(n):null),r=e.residents?.map(n=>this.objectToBoundingSphere(n)),s=e.terminals?.map(n=>this.objectToBoundingSphere(n));return{children:i,residents:r,terminals:s}}static fromJSON(e){const i=new _se(r=>r,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return i._objectCount=e.objectCount,i._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),i}},ua=class iR{constructor(){this.bounds=Bn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,s=this.depth){return this.node=e??iR.createEmptyNode(),i&&zE(i,this.bounds),this.halfSize=r,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*iBe}advance(e){let i=this.node.children[e];i||(i=iR.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=tBe[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new ci({shrink:!0}),residents:new ci({shrink:!0})}}static acquire(){return iR._pool.acquire()}static release(e){iR._pool.release(e)}static clearPool(){iR._pool.prune()}};function TS(t,e){let i=ua.acquire().init(t);const r=[i];for(;r.length!==0;){if(i=r.pop(),e(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&r.push(ua.acquire().init(i).advance(s));ua.release(i)}}function Q1e(t,e,i,r=L8.DepthOrder.FRONT_TO_BACK){let s=ua.acquire().init(t);const n=[s];for(nMt(i,r,tbe);n.length!==0;){if(s=n.pop(),e(s)&&!s.isLeaf())for(let o=7;o>=0;--o){const a=tbe[o];s.node.children[a]&&n.push(ua.acquire().init(s).advance(a))}ua.release(s)}}function KCt(t,e,i){kT.clear();const r=i.advanceTo(e,(s,n)=>{kT.push(s.node),kT.push(n)})?i.node.terminals:i.node.residents;if(r.removeUnordered(t),r.length===0)for(let s=kT.length-2;s>=0&&eMt(kT.data[s],kT.data[s+1]);s-=2);}function eMt(t,e){return e>=0&&(t.children[e]=null),!!eBe(t)&&(t.residents===null&&(t.residents=new ci({shrink:!0})),!0)}function tMt(t,e){return D8(e.bounds,2*-e.halfSize,yd),D8(e.bounds,2*e.halfSize,_d),LDe(t.origin,t.direction,yd,_d)}function iMt(t,e,i){return D8(e.bounds,2*-e.halfSize,yd),D8(e.bounds,2*e.halfSize,_d),i.applyToMinMax(yd,_d),LDe(t.origin,t.direction,yd,_d)}function eBe(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let e=0;e<t.children.length;e++)if(t.children[e])return!1;return!0}function rMt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function sMt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function D8(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function K1e(t,e,i,r){if(e===1){const s=i(t[0]);zE(s,r)}else{yd[0]=1/0,yd[1]=1/0,yd[2]=1/0,_d[0]=-1/0,_d[1]=-1/0,_d[2]=-1/0;for(let s=0;s<e;s++){const n=i(t[s]);XN(n[3])&&(rMt(yd,n),sMt(_d,n))}Br(r,yd,_d,.5),r[3]=Math.max(_d[0]-yd[0],_d[1]-yd[1],_d[2]-yd[2])/2}}function nMt(t,e,i){if(!UT.length)for(let r=0;r<8;++r)UT.push({index:0,distance:0});for(let r=0;r<8;++r){const s=tBe[r];UT.data[r].index=r,UT.data[r].distance=Kb(t,e,s)}UT.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=UT.data[r].index}function EX(t,e){let i,r=1/0;for(let s=0;s<8;++s){const n=Kb(t,e,ebe[s]);n<r&&(r=n,i=ebe[s])}return i}function Kb(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function XN(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}ua._pool=new Tl(ua),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(L8||(L8={}));const tBe=[Be(-1,-1,-1),Be(1,-1,-1),Be(-1,1,-1),Be(1,1,-1),Be(-1,-1,1),Be(1,-1,1),Be(-1,1,1),Be(1,1,1)],ebe=[Be(-1,-1,-1),Be(-1,-1,1),Be(-1,1,-1),Be(-1,1,1),Be(1,-1,-1),Be(1,-1,1),Be(1,1,-1),Be(1,1,1)],iBe=Math.sqrt(3),vse=[null];function oMt(t){return vse[0]=t,vse}const CX=Bn(),ap=M(),yd=M(),_d=M(),kT=new ci,aMt=Bn(),s_=Bn(),MX=Bn(),AX=Bn(),F5=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],UT=new ci,tbe=[0,0,0,0,0,0,0,0],qm=L8;var zw;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(zw||(zw={}));let rBe=class extends r4{get objects(){return this._objects}constructor(e,i,r=""){super(),this.stage=e,this.apiLayerUid=r,this.type=an.Layer,this.events=new un,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new ci,this._objectsAdded=new ci,this._handles=new A0,this.apiLayerUid=r,this.visible=i?.visible??!0,this.pickable=i?.pickable??!0,this.updatePolicy=i?.updatePolicy??zw.ASYNC,this._disableOctree=i?.disableOctree??!1,e.add(this);for(const s of QCt)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const i of e)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const i=new Array;if(this._objects.removeUnorderedMany(e,e.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),this._octree!=null){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){this.updatePolicy!==zw.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,i)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new qm(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=Ge(this._octree),this._objectsAdded.clear()}};function F8(t){return t!=null&&t.type===an.Layer}var Nu,JE;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(Nu||(Nu={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(JE||(JE={}));let sa=class extends $u{constructor(){super(...arguments),this.output=G.Color,this.transparencyPassType=mt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Nu.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=JE.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===Nu.Draped}};d([V({count:G.COUNT})],sa.prototype,"output",void 0),d([V({count:mt.COUNT})],sa.prototype,"transparencyPassType",void 0),d([V()],sa.prototype,"occluder",void 0),d([V()],sa.prototype,"hasSlicePlane",void 0),d([V()],sa.prototype,"writeDepth",void 0),d([V({count:Nu.COUNT})],sa.prototype,"space",void 0),d([V()],sa.prototype,"hideOnShortSegments",void 0),d([V()],sa.prototype,"hasCap",void 0),d([V({count:JE.COUNT})],sa.prototype,"anchor",void 0),d([V()],sa.prototype,"hasTip",void 0),d([V()],sa.prototype,"vvSize",void 0),d([V()],sa.prototype,"vvColor",void 0),d([V()],sa.prototype,"vvOpacity",void 0),d([V()],sa.prototype,"hasOccludees",void 0),d([V()],sa.prototype,"multipassEnabled",void 0),d([V()],sa.prototype,"cullAboveGround",void 0),d([V({constValue:!1})],sa.prototype,"occlusionPass",void 0),d([V({constValue:!0})],sa.prototype,"hasVvInstancing",void 0),d([V({constValue:!0})],sa.prototype,"hasSliceTranslatedView",void 0);const ibe=8;function sBe(t,e){const i=t.vertex;i.uniforms.add(new et("intrinsicWidth",r=>r.width)),e.vvSize?(t.attributes.add(O.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new Qt("vvSizeMinSize",r=>r.vvSize.minSize),new Qt("vvSizeMaxSize",r=>r.vvSize.maxSize),new Qt("vvSizeOffset",r=>r.vvSize.offset),new Qt("vvSizeFactor",r=>r.vvSize.factor)),i.code.add(T`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(O.SIZE,"float"),i.code.add(T`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(O.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new jc("vvOpacityValues",r=>r.vvOpacity.values,ibe),new jc("vvOpacityOpacities",r=>r.vvOpacity.opacityValues,ibe)),i.code.add(T`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(T`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include($v,e),t.attributes.add(O.COLORFEATUREATTRIBUTE,"float"),i.code.add(T`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(O.COLOR,"vec4"),i.code.add(T`vec4 getColor(){
return applyOpacity(color);
}`))}let nBe=class{constructor(e,i,r){this._createTexture=e,this._parametersKey=i,this._repository=new Map,this._orphanCache=r.newCache(`procedural-texture-repository:${Ld()}`,s=>s.dispose())}destroy(){for(const[e,{texture:i}]of this._repository)i.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,i=null){const r=this._acquire(e);return this.release(i),r}release(e){if(e==null)return;const i=this._parametersKey(e),r=this._repository.get(i);if(r&&(r.refCount--,r.refCount===0)){this._repository.delete(i);const{texture:s}=r,n=s.usedMemory;this._orphanCache.put(i,s,n)}}_acquire(e){if(e==null)return null;const i=this._parametersKey(e),r=this._repository.get(i);if(r)return r.refCount++,r.texture;const s=this._orphanCache.pop(i)??this._createTexture(e),n=new lMt(s);return this._repository.set(i,n),s}},lMt=class{constructor(e){this.texture=e,this.refCount=1}};function cMt(t,e){return new nBe(i=>{const{encodedData:r,textureSize:s}=uMt(i),n=new fs;return n.internalFormat=Xt.RGBA,n.width=s,n.height=1,n.wrapMode=Di.REPEAT,new Gr(t,n,r)},i=>`${i.pattern.join(",")}-r${i.pixelRatio}`,e)}function uMt(t){const e=_de(t),i=1/t.pixelRatio,r=oBe(t),s=aBe(t),n=(Math.floor(.5*(s-1))+.5)*i,o=[];let a=1;for(const p of e){for(let f=0;f<p;f++){const g=a*(Math.min(f,p-1-f)+.5)*i/n*.5+.5;o.push(g)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=new Uint8Array(4*r);let h=0;for(const p of c)Hhe(p,u,h),h+=4;return{encodedData:u,textureSize:r}}function _de(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function oBe(t){if(t==null)return 1;const e=_de(t);return Math.floor(e.reduce((i,r)=>i+r))}function aBe(t){return _de(t).reduce((e,i)=>Math.max(e,i))}function hMt(t){return t==null?Ud:t.length===4?t:Ds(dMt,t[0],t[1],t[2],1)}const dMt=pi();function pMt(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?fMt(t,e):mMt(t)}function fMt(t,e){const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:s}=t;s.include(Cg),e.draped||(yg(r,e),r.uniforms.add(new et("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(T`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),r.code.add(T`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${yMt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(T`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(T`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),WI(r),r.code.add(T`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),s.uniforms.add(new Et("stipplePatternTexture",n=>n.stippleTexture),new et("stipplePatternSDFNormalizer",n=>gMt(n.stipplePattern)),new et("stipplePatternPixelSizeInv",n=>1/lBe(n))),s.code.add(T`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),e.stippleOffColorEnabled?(s.uniforms.add(new Ki("stippleOffColor",n=>hMt(n.stippleOffColor))),s.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function mMt(t){t.fragment.code.add(T`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function gMt(t){return t?(Math.floor(.5*(aBe(t)-1))+.5)/t.pixelRatio:1}function lBe(t){const e=t.stipplePattern;return e?oBe(t.stipplePattern)/e.pixelRatio:1}const yMt=T.float(.4);async function Xv(t,e){const{data:i}=await qi(t,{responseType:"image",...e});return i}function _Mt(){return rbe??=(async()=>{const t=await ye(()=>import("./basis_transcoder-88947256.js"),[],import.meta.url),e=await t.default({locateFile:i=>kr(`esri/libs/basisu/${i}`)});return e.initializeBasis(),e})(),rbe}let rbe;var b2;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(b2||(b2={}));let tg=null,k5=null;async function cBe(){return k5==null&&(k5=_Mt(),tg=await k5),k5}function vMt(t,e){if(tg==null)return t.byteLength;const i=new tg.BasisFile(new Uint8Array(t)),r=hBe(i)?uBe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function bMt(t,e){if(tg==null)return t.byteLength;const i=new tg.KTX2File(new Uint8Array(t)),r=dBe(i)?uBe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function uBe(t,e,i,r,s){const n=Uue(e?vn.COMPRESSED_RGBA8_ETC2_EAC:vn.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*n*o)}function hBe(t){return t.getNumImages()>=1&&!t.isUASTC()}function dBe(t){return t.getFaces()>=1&&t.isETC1S()}async function wMt(t,e,i){tg==null&&(tg=await cBe());const r=new tg.BasisFile(new Uint8Array(i));if(!hBe(r))return null;r.startTranscoding();const s=pBe(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function xMt(t,e,i){tg==null&&(tg=await cBe());const r=new tg.KTX2File(new Uint8Array(i));if(!dBe(r))return null;r.startTranscoding();const s=pBe(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function pBe(t,e,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,h]=l?r?[b2.ETC2_RGBA,vn.COMPRESSED_RGBA8_ETC2_EAC]:[b2.ETC1_RGB,vn.COMPRESSED_RGB8_ETC2]:c?r?[b2.BC3_RGBA,vn.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[b2.BC1_RGB,vn.COMPRESSED_RGB_S3TC_DXT1_EXT]:[b2.RGBA32,Xt.RGBA],p=e.hasMipmap?i:Math.min(1,i),f=[];for(let g=0;g<p;g++)f.push(new Uint8Array(o(g,u))),a(g,u,f[g]);return e.internalFormat=h,e.hasMipmap=f.length>1,e.samplingMode=e.hasMipmap?_i.LINEAR_MIPMAP_LINEAR:_i.LINEAR,e.width=s,e.height=n,new Gr(t,e,{type:"compressed",levels:f})}const U5=()=>oe.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),SMt=542327876,TMt=131072,EMt=4;function vde(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function CMt(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const MMt=vde("DXT1"),AMt=vde("DXT3"),RMt=vde("DXT5"),PMt=31,OMt=0,IMt=1,$Mt=2,NMt=3,LMt=4,DMt=7,FMt=20,kMt=21;function UMt(t,e,i){const r=BMt(i,e.hasMipmap??!1);if(r==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=r;return e.samplingMode=s.levels.length>1?_i.LINEAR_MIPMAP_LINEAR:_i.LINEAR,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new Gr(t,e,s)}function BMt(t,e){const i=new Int32Array(t,0,PMt);if(i[OMt]!==SMt)return U5().error("Invalid magic number in DDS header"),null;if(!(i[FMt]&EMt))return U5().error("Unsupported format, must contain a FourCC code"),null;const r=i[kMt];let s,n;switch(r){case MMt:s=8,n=vn.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case AMt:s=16,n=vn.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case RMt:s=16,n=vn.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return U5().error("Unsupported FourCC code:",CMt(r)),null}let o=1,a=i[LMt],l=i[NMt];(3&a||3&l)&&(U5().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let h,p;i[$Mt]&TMt&&e!==!1&&(o=Math.max(1,i[DMt]));let f=i[IMt]+4;const g=[];for(let y=0;y<o;++y)p=(a+3>>2)*(l+3>>2)*s,h=new Uint8Array(t,f,p),g.push(h),f+=p,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:n,width:c,height:u}}let xx=class extends r4{get parameters(){return this._parameters}constructor(e,i){super(),this._data=e,this.type=an.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new un,this._parameters={...VMt,...i},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=i=>this._frameUpdate(e,i),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(pO(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const i=!e.paused;if(e.src=e.src,i&&e.autoplay){const r=()=>{e.removeEventListener("canplay",r),e.play()};e.addEventListener("canplay",r)}}}_startPreloadImageElement(e){R0(e.src)||pO(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const i=new fs;return i.wrapMode=this._parameters.wrap??Di.REPEAT,i.flipped=!this._parameters.noUnpackFlip,i.samplingMode=this._parameters.mipmap?_i.LINEAR_MIPMAP_LINEAR:_i.LINEAR,i.hasMipmap=!!this._parameters.mipmap,i.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,i.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),i}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.usedMemory||zMt(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const i=this._data;return i==null?(this._glTexture=new Gr(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof i=="string"?this._loadFromURL(e,i):i instanceof Image?this._loadFromImageElement(e,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i):(G3(i)||gw(i))&&this._parameters.encoding===Rv.DDS_ENCODING?this._loadFromDDSData(e,i):(G3(i)||gw(i))&&this._parameters.encoding===Rv.KTX2_ENCODING?this._loadFromKTX2(e,i):(G3(i)||gw(i))&&this._parameters.encoding===Rv.BASIS_ENCODING?this._loadFromBasis(e,i):gw(i)?this._loadFromPixelData(e,i):G3(i)?this._loadFromPixelData(e,new Uint8Array(i)):null)}_frameUpdate(e,i){return this._glTexture==null||e.readyState<AD.HAVE_CURRENT_DATA||i===e.currentTime?i:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,i){return this._glTexture=UMt(e,this._createDescriptor(e),i),this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>xMt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>wMt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){Tt(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=this._parameters.components===1?Xt.LUMINANCE:this._parameters.components===3?Xt.RGB:Xt.RGBA,r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new Gr(e,r,i),this._glTexture}_loadFromURL(e,i){return this._loadAsync(async r=>{const s=await Xv(i,{signal:r});return zt(r),this._loadFromImage(e,s)})}_loadFromImageElement(e,i){return i.complete?this._loadFromImage(e,i):this._loadAsync(async r=>{const s=await ARe(i,i.src,!1,r);return zt(r),this._loadFromImage(e,s)})}_loadFromVideoElement(e,i){return i.readyState>=AD.HAVE_CURRENT_DATA?this._loadFromImage(e,i):this._loadFromVideoElementAsync(e,i)}_loadFromVideoElementAsync(e,i){return this._loadAsync(r=>new Promise((s,n)=>{const o=()=>{i.removeEventListener("loadeddata",a),i.removeEventListener("error",l),Zr(c)},a=()=>{i.readyState>=AD.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(e,i)))},l=u=>{o(),n(u||new j("Failed to load video"))};i.addEventListener("loadeddata",a),i.addEventListener("error",l);const c=oo(r,()=>l(Yi()))}))}_loadFromImage(e,i){let r=i;if(!(r instanceof HTMLVideoElement)){const{maxTextureSize:o}=e.parameters;r=this._parameters.downsampleUncompressed?Uyt(r,o):Byt(r,o)}const s=fBe(r);this._parameters.width=s.width,this._parameters.height=s.height;const n=this._createDescriptor(e);return n.pixelFormat=this._parameters.components===3?Xt.RGB:Xt.RGBA,n.width=s.width,n.height=s.height,this._glTexture=new Gr(e,n,r),this._glTexture}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}unload(){if(this._glTexture=jt(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function zMt(t,e){if(t==null)return 0;if(G3(t)||gw(t))return e.encoding===Rv.KTX2_ENCODING?bMt(t,!!e.mipmap):e.encoding===Rv.BASIS_ENCODING?vMt(t,!!e.mipmap):t.byteLength;const{width:i,height:r}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?fBe(t):e;return(e.mipmap?4/3:1)*i*r*(e.components||4)||0}function fBe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var AD;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(AD||(AD={}));const VMt={wrap:{s:Di.REPEAT,t:Di.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1},k8=128,bde=.5;function GMt(t){return t==="cross"||t==="x"}function jMt(t,e=k8,i=e*bde,r=0){const s=mBe(t,e,i,r);return new xx(s,{mipmap:!1,wrap:{s:Di.CLAMP_TO_EDGE,t:Di.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function mBe(t,e=k8,i=e*bde,r=0){switch(t){case"circle":default:return HMt(e,i);case"square":return qMt(e,i);case"cross":return YMt(e,i,r);case"x":return XMt(e,i,r);case"kite":return WMt(e,i);case"triangle":return ZMt(e,i);case"arrow":return JMt(e,i)}}function HMt(t,e){const i=t/2-.5;return w4(t,_Be(i,i,e/2))}function qMt(t,e){return gBe(t,e,!1)}function WMt(t,e){return gBe(t,e,!0)}function YMt(t,e,i=0){return yBe(t,e,!1,i)}function XMt(t,e,i=0){return yBe(t,e,!0,i)}function ZMt(t,e){return w4(t,vBe(t/2,e,e/2))}function JMt(t,e){const i=e,r=e/2,s=t/2,n=.8*i,o=_Be(s,(t-e)/2-n,Math.sqrt(n*n+r*r)),a=vBe(s,i,r);return w4(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function gBe(t,e,i){return i&&(e/=Math.SQRT2),w4(t,(r,s)=>{let n=r-.5*t+.25,o=.5*t-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function yBe(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const s=.5*e;return w4(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(i){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function _Be(t,e,i){return(r,s)=>{const n=r-t,o=s-e;return Math.sqrt(n*n+o*o)-i}}function vBe(t,e,i){const r=Math.sqrt(e*e+i*i);return(s,n)=>{const o=Math.abs(s-t)-i,a=n-t+e/2+.75,l=(e*o+i*a)/r,c=-a;return Math.max(l,c)}}function w4(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let s=0;s<t;s++){const n=s+t*r;let o=e(s,r);o=o/t+.5,Hhe(o,i,4*n)}return i}const dE=64,wde=dE/2,bBe=wde/5,QMt=dE/bBe,KMt=.25;function eAt(t,e){const i=mBe(t,dE,wde,bBe),r=new fs;return r.internalFormat=Xt.RGBA,r.width=dE,r.height=dE,r.wrapMode=Di.CLAMP_TO_EDGE,new Gr(e,r,i)}function wBe(t,e){const{vertex:i,constants:r}=t;r.add("markerSizePerLineWidth","float",QMt),WI(i),i.uniforms.get("markerScale")==null&&i.constants.add("markerScale","float",1),i.code.add(T`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===Nu.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new et("perRenderPixelRatio",(s,n)=>n.camera.perRenderPixelRatio)),i.code.add(T`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var nf;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(nf||(nf={}));let en=class extends $u{constructor(){super(...arguments),this.output=G.Color,this.capType=nf.BUTT,this.transparencyPassType=mt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};d([V({count:G.COUNT})],en.prototype,"output",void 0),d([V({count:nf.COUNT})],en.prototype,"capType",void 0),d([V({count:mt.COUNT})],en.prototype,"transparencyPassType",void 0),d([V()],en.prototype,"occluder",void 0),d([V()],en.prototype,"hasSlicePlane",void 0),d([V()],en.prototype,"hasPolygonOffset",void 0),d([V()],en.prototype,"writeDepth",void 0),d([V()],en.prototype,"draped",void 0),d([V()],en.prototype,"stippleEnabled",void 0),d([V()],en.prototype,"stippleOffColorEnabled",void 0),d([V()],en.prototype,"stipplePreferContinuous",void 0),d([V()],en.prototype,"roundJoins",void 0),d([V()],en.prototype,"applyMarkerOffset",void 0),d([V()],en.prototype,"vvSize",void 0),d([V()],en.prototype,"vvColor",void 0),d([V()],en.prototype,"vvOpacity",void 0),d([V()],en.prototype,"falloffEnabled",void 0),d([V()],en.prototype,"innerColorEnabled",void 0),d([V()],en.prototype,"hasOccludees",void 0),d([V()],en.prototype,"multipassEnabled",void 0),d([V()],en.prototype,"cullAboveGround",void 0),d([V()],en.prototype,"wireframe",void 0),d([V()],en.prototype,"objectAndLayerIdColorInstanced",void 0),d([V({constValue:!1})],en.prototype,"occlusionPass",void 0),d([V({constValue:!0})],en.prototype,"hasVvInstancing",void 0),d([V({constValue:!0})],en.prototype,"hasSliceTranslatedView",void 0);const U8=1;function tAt(t){const e=new tr,{attributes:i,varyings:r,constants:s,vertex:n,fragment:o}=e;e.include(Kk),e.include(sBe,t),e.include(pMt,t);const a=t.applyMarkerOffset&&!t.draped;a&&(n.uniforms.add(new et("markerScale",g=>g.markerScale)),e.include(wBe,{space:Nu.World,draped:!1})),e.include(NC,t),Pu(n,t),n.uniforms.add(new Ps("inverseProjectionMatrix",(g,y)=>y.camera.inverseProjectionMatrix),new os("nearFar",(g,y)=>y.camera.nearFar),new et("miterLimit",g=>g.join!=="miter"?0:g.miterLimit),new Ki("viewport",(g,y)=>y.camera.fullViewport)),n.constants.add("LARGE_HALF_FLOAT","float",65500),i.add(O.POSITION,"vec3"),i.add(O.PREVPOSITION,"vec3"),i.add(O.NEXTPOSITION,"vec3"),i.add(O.SUBDIVISIONFACTOR,"float"),i.add(O.UV0,"vec2"),r.add("vColor","vec4"),r.add("vpos","vec3"),r.add("vLineDistance","float"),r.add("vLineWidth","float");const l=t.multipassEnabled&&t.output===G.Color;l&&r.add("depth","float");const c=t.stippleEnabled;c&&r.add("vLineSizeInv","float"),s.add("aaWidth","float",t.stippleEnabled?0:1);const u=t.capType===nf.ROUND,h=t.stippleEnabled&&u,p=t.falloffEnabled||h;p&&r.add("vLineDistanceNorm","float"),u&&(r.add("vSegmentSDF","float"),r.add("vReverseSegmentSDF","float")),n.code.add(T`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),n.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(T`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${l?"depth = pos.z;":""}

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),WI(n),n.code.add(T`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${c?T`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),a&&n.code.add(T`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),n.code.add(T`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||u)&&n.code.add(T`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${u?T`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),n.code.add(T`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?n.code.add(T`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?T`min(1.0, subdivisionFactor * ${T.float((U8+2)/(U8+1))})`:T`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):n.code.add(T`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==nf.BUTT;return n.code.add(T`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?T`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),n.code.add(T`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${p?T`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),u&&n.code.add(T`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?n.uniforms.add(new et("worldToScreenRatio",(g,y)=>1/y.screenToPCSRatio)):n.code.add(T`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),n.code.add(T`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?n.code.add(T`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):n.code.add(T`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),n.uniforms.add(new et("stipplePatternPixelSize",g=>lBe(g))),n.code.add(T`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),n.code.add(T`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),l&&e.include(V0,t),e.include(Wn,t),o.include(B0),o.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${l?"terrainDepthTest(depth);":""}
  `),t.wireframe?o.code.add(T`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(u&&o.code.add(T`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${T.float(Ba)}) {
          discard;
        }
      `),h?o.code.add(T`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${T.float(Ba)}, stippleCoverage);
      `):o.code.add(T`float stippleAlpha = getStippleAlpha();`),t.output!==G.ObjectAndLayerIdColor&&o.code.add(T`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),o.uniforms.add(new Ki("intrinsicColor",g=>g.color)),o.code.add(T`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(o.uniforms.add(new Ki("innerColor",g=>g.innerColor??g.color),new et("innerWidth",(g,y)=>g.innerWidth*y.camera.pixelRatio)),o.code.add(T`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),o.code.add(T`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(o.uniforms.add(new et("falloff",g=>g.falloff)),o.code.add(T`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),t.stippleEnabled||o.code.add(T`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),t.transparencyPassType===mt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),o.code.add(T`
    ${t.output===G.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${T.float(Ba)}) {
      discard;
    }

    ${t.output===G.Color?T`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===G.Color&&t.transparencyPassType===mt.ColorAlpha?T`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${t.output===G.Highlight?T`fragColor = vec4(1.0);`:""}
    ${t.output===G.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const iAt=Object.freeze(Object.defineProperty({__proto__:null,build:tAt,ribbonlineNumRoundJoinSubdivisions:U8},Symbol.toStringTag,{value:"Module"})),xBe=new Map([[O.POSITION,0],[O.PREVPOSITION,1],[O.NEXTPOSITION,2],[O.SUBDIVISIONFACTOR,3],[O.UV0,4],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.OPACITYFEATUREATTRIBUTE,7],[O.OBJECTANDLAYERIDCOLOR,8]]);let SBe=class TBe extends hr{initializeProgram(e){return new dr(e.rctx,TBe.shader.get().build(this.configuration),xBe)}_makePipelineState(e,i){const r=this.configuration,s=e===mt.NONE,n=e===mt.FrontFace,o=o_t(r.output);return ti({blending:r.output===G.Color?s?Ch:c1(e):null,depthTest:{func:Yx(e)},depthWrite:s?r.writeDepth||o?Oh:null:Z9(e),drawBuffers:r.output===G.Depth?{buffers:[zo.NONE]}:u1(e),colorWrite:fi,stencilWrite:r.hasOccludees?x0:null,stencilTest:r.hasOccludees?i?bx:Xx:null,polygonOffset:s||n?r.hasPolygonOffset?sbe:null:Q9})}initializePipeline(){const e=this.configuration;if(e.occluder){const i=e.hasPolygonOffset?sbe:null;this._occluderPipelineTransparent=ti({blending:Ch,polygonOffset:i,depthTest:P8,depthWrite:null,colorWrite:fi,stencilWrite:null,stencilTest:kUe,drawBuffers:e.output===G.Depth?{buffers:[zo.NONE]}:null}),this._occluderPipelineOpaque=ti({blending:Ch,polygonOffset:i,depthTest:P8,depthWrite:null,colorWrite:fi,stencilWrite:DUe,stencilTest:FUe,drawBuffers:e.output===G.Depth?{buffers:[zo.NONE]}:null}),this._occluderPipelineMaskWrite=ti({blending:null,polygonOffset:i,depthTest:Qhe,depthWrite:null,colorWrite:null,stencilWrite:x0,stencilTest:bx,drawBuffers:e.output===G.Depth?{buffers:[zo.NONE]}:null})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Li.LINES:Li.TRIANGLE_STRIP}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};SBe.shader=new ir(iAt,()=>ye(()=>import("./RibbonLine.glsl-eff0ab5d.js"),[],import.meta.url));const sbe={factor:0,units:-4};var Ku;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Ku||(Ku={}));let KR=class extends qx{constructor(e){super(e,new sAt),this._configuration=new en,this.produces=new Map([[Ce.OPAQUE_MATERIAL,i=>i===G.Highlight||i===G.ObjectAndLayerIdColor||i===G.Color&&this.parameters.renderOccluded===pr.OccludeAndTransparentStencil],[Ce.OPAQUE_NO_SSAO_DEPTH,i=>Uw(i)],[Ce.OCCLUDER_MATERIAL,i=>Xie(i)&&this.parameters.renderOccluded===pr.OccludeAndTransparentStencil],[Ce.TRANSPARENT_OCCLUDER_MATERIAL,i=>Xie(i)&&this.parameters.renderOccluded===pr.OccludeAndTransparentStencil],[Ce.TRANSPARENT_MATERIAL,i=>i===G.Color&&this.parameters.writeDepth&&this.parameters.renderOccluded!==pr.OccludeAndTransparentStencil],[Ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>i===G.Color&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==pr.OccludeAndTransparentStencil],[Ce.DRAPED_MATERIAL,i=>kFe(i)]]),this._vertexAttributeLocations=xBe}getConfiguration(e,i){this._configuration.output=e,this._configuration.draped=i.slot===Ce.DRAPED_MATERIAL;const r=this.parameters.stipplePattern!=null&&e!==G.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&oAt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===pr.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,i,r,s,n,o){if(!r.options.selectionMode)return;const a=e.attributes.get(O.POSITION).data,l=e.attributes.get(O.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const y=e.attributes.get(O.SIZEFEATUREATTRIBUTE).data[0];c*=$e(this.parameters.vvSize.offset[0]+y*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=s[0],h=s[1],p=(c/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,g=0;for(let y=0;y<a.length-5;y+=3){const v=a[y],b=a[y+1],w=u-v,x=h-b,S=a[y+3]-v,E=a[y+4]-b,C=$e((S*w+E*x)/(S*S+E*E),0,1),R=S*C-w,I=E*C-x,F=R*R+I*I;F<f&&(f=F,g=y/3)}f<p*p&&n(o.dist,o.normal,g,!1)}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!DDe(i))return void oe.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes,l=a.get(O.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const w=a.get(O.SIZEFEATUREATTRIBUTE).data[0];c*=$e(this.parameters.vvSize.offset[0]+w*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(O.SIZE)&&(c*=a.get(O.SIZE).data[0]);const u=r.camera,h=aAt;Cl(h,r.point);const p=c*u.pixelRatio/2+4*u.pixelRatio;ue(n3[0],h[0]-p,h[1]+p,0),ue(n3[1],h[0]+p,h[1]+p,0),ue(n3[2],h[0]+p,h[1]-p,0),ue(n3[3],h[0]-p,h[1]-p,0);for(let w=0;w<4;w++)if(!u.unprojectFromRenderScreen(n3[w],n_[w]))return;Xl(u.eye,n_[0],n_[1],PX),Xl(u.eye,n_[1],n_[2],OX),Xl(u.eye,n_[2],n_[3],IX),Xl(u.eye,n_[3],n_[0],$X);let f=Number.MAX_VALUE,g=0;const y=EBe(this.parameters,a)?l.length-2:l.length-5;for(let w=0;w<y;w+=3){iu[0]=l[w]+i[12],iu[1]=l[w+1]+i[13],iu[2]=l[w+2]+i[14];const x=(w+3)%l.length;if(ru[0]=l[x]+i[12],ru[1]=l[x+1]+i[13],ru[2]=l[x+2]+i[14],Wr(PX,iu)<0&&Wr(PX,ru)<0||Wr(OX,iu)<0&&Wr(OX,ru)<0||Wr(IX,iu)<0&&Wr(IX,ru)<0||Wr($X,iu)<0&&Wr($X,ru)<0)continue;if(u.projectToRenderScreen(iu,CS),u.projectToRenderScreen(ru,MS),CS[2]<0&&MS[2]>0){Me(Lg,iu,ru);const E=u.frustum,C=-Wr(E[zr.NEAR],iu)/xe(Lg,E[zr.NEAR]);ce(Lg,Lg,C),Te(iu,iu,Lg),u.projectToRenderScreen(iu,CS)}else if(CS[2]>0&&MS[2]<0){Me(Lg,ru,iu);const E=u.frustum,C=-Wr(E[zr.NEAR],ru)/xe(Lg,E[zr.NEAR]);ce(Lg,Lg,C),Te(ru,ru,Lg),u.projectToRenderScreen(ru,MS)}else if(CS[2]<0&&MS[2]<0)continue;CS[2]=0,MS[2]=0;const S=Oce(nE(CS,MS,abe),h);S<f&&(f=S,ge(nbe,iu),ge(obe,ru),g=w/3)}const v=r.rayBegin,b=r.rayEnd;if(f<p*p){let w=Number.MAX_VALUE;if(Z$e(nE(nbe,obe,abe),nE(v,b,lAt),ES)){Me(ES,ES,v);const x=De(ES);ce(ES,ES,1/x),w=x/jr(v,b)}o(w,ES,g,!1)}}get _layout(){const e=Xs().vec3f(O.POSITION).vec3f(O.PREVPOSITION).vec3f(O.NEXTPOSITION).f32(O.SUBDIVISIONFACTOR).vec2f(O.UV0);return this.parameters.vvSize?e.f32(O.SIZEFEATUREATTRIBUTE):e.f32(O.SIZE),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4f(O.COLOR),this.parameters.vvOpacity&&e.f32(O.OPACITYFEATUREATTRIBUTE),ae("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new nAt(this._layout,this.parameters)}createGLMaterial(e){return new rAt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},rAt=class extends jx{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===G.Color&&this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(i,this._stipplePattern)}),this._stipplePattern=i),this.ensureTechnique(SBe,e)}},sAt=class extends l4{constructor(){super(...arguments),this.width=0,this.color=Xp,this.join="miter",this.cap=nf.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},nAt=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i,this.numJoinSubdivisions=0;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=U8+r}}_isClosed(e){return EBe(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.attributes.get(O.POSITION).indices.length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,i,r,s,n){const o=cAt,a=uAt,l=hAt,c=r.attributes.get(O.POSITION),u=c.indices,h=c.data.length/3,p=r.attributes.get(O.DISTANCETOSTART)?.data;u&&u.length!==2*(h-1)&&console.warn("RibbonLineMaterial does not support indices");const f=r.attributes.get(O.SIZEFEATUREATTRIBUTE)?.data[0]??r.attributes.get(O.SIZE)?.data[0]??1;let g=[1,1,1,1],y=0;const v=this.vertexBufferLayout.fields.has(O.COLORFEATUREATTRIBUTE);v?y=r.attributes.get(O.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(O.COLOR)&&(g=r.attributes.get(O.COLOR).data);const b=ae("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null,w=this.vertexBufferLayout.fields.has(O.OPACITYFEATUREATTRIBUTE),x=w?r.attributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]:0,S=new Float32Array(s.buffer),E=ae("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,C=this.vertexBufferLayout.stride/4;let R=n*C;const I=R;let F=0;const D=p?(me,L,k)=>F=p[k]:(me,L,k)=>F+=jr(me,L),z=ae("enable-feature:objectAndLayerId-rendering"),B=(me,L,k,H,q,Q,K)=>{if(S[R++]=L[0],S[R++]=L[1],S[R++]=L[2],S[R++]=me[0],S[R++]=me[1],S[R++]=me[2],S[R++]=k[0],S[R++]=k[1],S[R++]=k[2],S[R++]=H,S[R++]=K,S[R++]=q,S[R++]=f,v)S[R++]=y;else{const re=Math.min(4*Q,g.length-4);S[R++]=g[re],S[R++]=g[re+1],S[R++]=g[re+2],S[R++]=g[re+3]}w&&(S[R++]=x),z&&(b!=null&&(E[4*R]=b[0],E[4*R+1]=b[1],E[4*R+2]=b[2],E[4*R+3]=b[3]),R++)};R+=C,ue(a,c.data[0],c.data[1],c.data[2]),e&&nt(a,a,e);const Y=this._isClosed(r);if(Y){const me=c.data.length-3;ue(o,c.data[me],c.data[me+1],c.data[me+2]),e&&nt(o,o,e)}else ue(l,c.data[3],c.data[4],c.data[5]),e&&nt(l,l,e),B(a,a,l,1,Ku.LEFT_CAP_START,0,0),B(a,a,l,1,Ku.RIGHT_CAP_START,0,0),ge(o,a),ge(a,l);const W=Y?0:1,J=Y?h:h-1;for(let me=W;me<J;me++){const L=(me+1)%h*3;ue(l,c.data[L],c.data[L+1],c.data[L+2]),e&&nt(l,l,e),D(o,a,me),B(o,a,l,0,Ku.LEFT_JOIN_END,me,F),B(o,a,l,0,Ku.RIGHT_JOIN_END,me,F);const k=this.numJoinSubdivisions;for(let H=0;H<k;++H){const q=(H+1)/(k+1);B(o,a,l,q,Ku.LEFT_JOIN_END,me,F),B(o,a,l,q,Ku.RIGHT_JOIN_END,me,F)}B(o,a,l,1,Ku.LEFT_JOIN_START,me,F),B(o,a,l,1,Ku.RIGHT_JOIN_START,me,F),ge(o,a),ge(a,l)}Y?(ue(l,c.data[3],c.data[4],c.data[5]),e&&nt(l,l,e),F=D(o,a,J),B(o,a,l,0,Ku.LEFT_JOIN_END,W,F),B(o,a,l,0,Ku.RIGHT_JOIN_END,W,F)):(F=D(o,a,J),B(o,a,a,0,Ku.LEFT_CAP_END,J,F),B(o,a,a,0,Ku.RIGHT_CAP_END,J,F)),RX(S,I+C,S,I,C),R=RX(S,R-C,S,R,C),this._parameters.wireframe&&this._addWireframeVertices(s,I,R,C)}_addWireframeVertices(e,i,r,s){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=RX(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function RX(t,e,i,r,s){for(let n=0;n<s;n++)i[r++]=t[e++];return r}function EBe(t,e){return t.isClosed?e.get(O.POSITION).indices.length>2:!1}function oAt(t){return t.anchor===JE.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const iu=M(),ru=M(),Lg=M(),ES=M(),aAt=M(),CS=_l(),MS=_l(),nbe=M(),obe=M(),abe=Eg(),lAt=Eg(),cAt=M(),uAt=M(),hAt=M(),n3=[_l(),_l(),_l(),_l()],n_=[M(),M(),M(),M()],PX=mr(),OX=mr(),IX=mr(),$X=mr();let CBe=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+Ld(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const u=N8(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const r=this._gridSize,s=Math.round(e[0]/r),n=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(Me(Ma,e,i.vec3),Ma[0]=Math.abs(Ma[0]),Ma[1]=Math.abs(Ma[1]),Ma[2]=Math.abs(Ma[2]),Ma[0]<c&&Ma[1]<c&&Ma[2]<c){if(l){const u=Math.max(...Ma);if(Me(Ma,e,l.vec3),Ma[0]=Math.abs(Ma[0]),Ma[1]=Math.abs(Ma[1]),Ma[2]=Math.abs(Ma[2]),Math.max(...Ma)<u)return l}return i}return l||(l=N8(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e,i=ni(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new KR({width:2,color:i}),s.add(this._material);const f=new rBe(s,{pickable:!1}),g=new Zx({castShadow:!1});s.add(g),f.add(g),this._objects.set(n,g)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,h=.5*this._gridSize;for(let f=0;f<l;f++)c[3*f]=e[0]+(1&a[f]?h:-h),c[3*f+1]=e[1]+(2&a[f]?h:-h),c[3*f+2]=e[2]+(4&a[f]?h:-h),f>0&&u.push(f-1,f);Ts(c,this._originSR,0,c,r.renderSpatialReference,0,l);const p=new Zn(this._material,[[O.POSITION,new dt(c,u,3,!0)]],null,an.Line);s.add(p),o.addGeometry(p)}get test(){}};const Ma=M();let MBe=class{constructor(e,i,r=null){this.rctx=e,this.sliceHelper=r,this.lastFrameCamera=new Kr,this.output=G.Color,this.renderOccludedMask=B8,this.bindParameters=new A9(i,r!=null?r.plane:null),this.bindParameters.alignPixelEnabled=!0}},dAt=class extends MBe{constructor(e,i,r,s){super(e,r,s),this.offscreenRenderingHelper=i,this.sliceHelper=s,this.time=0}};const B8=pr.Occlude|pr.OccludeAndTransparent|pr.OccludeAndTransparentStencil;let ZN=class extends Kr{constructor(){super(...arguments),this._projectionMatrix=Ne()}get projectionMatrix(){return this._projectionMatrix}};d([m()],ZN.prototype,"_projectionMatrix",void 0),d([m({readOnly:!0})],ZN.prototype,"projectionMatrix",null),ZN=d([N("esri.views.3d.webgl-engine.lib.CascadeCamera")],ZN);var QE;(function(t){t[t.Highlight=0]="Highlight",t[t.ExcludeHighlight=1]="ExcludeHighlight"})(QE||(QE={}));let B5=class{constructor(){this.camera=new ZN,this.lightMat=Ne()}},pAt=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},xde=class{constructor(e,i){this._fbos=e,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new pAt,this._projectionView=Ne(),this._projectionViewInverse=Ne(),this._modelViewLight=Ne(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=pi(),this._cascades=[new B5,new B5,new B5,new B5],this._lastOrigin=null,this._maxTextureWidth=Math.min(ae("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return Ds(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=yi(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=$e(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)LX[e]=this._cascades[e];return LX.length=this._numCascades,LX}start(e,i,r,s,n){Tt(this.enabled);const{near:o,far:a}=vAt(r);this._computeCascadeDistances(o,a,s),this._textureHeight=this._computeTextureHeight(e,n,s),this._setupMatrices(e,i);const{viewMatrix:l,projectionMatrix:c}=e;for(let u=0;u<this._numCascades;++u)this._constructCascade(u,c,l,i);this._lastOrigin=null,this.clear()}finish(){Tt(this.enabled),this._handle?.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!ga(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||M(),ge(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){ac(pbe,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)fbe[16*i+r]=pbe[r]}}return fbe}moveSnapshot(e){Tt(this.enabled),this._handle?.detachDepth(),this._snapshots[e]?.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){const i=this._handle?.getTexture()?.descriptor;if(!this.enabled||!i)return;this._snapshots[e]?.release();const{width:r,height:s}=i,n=e===QE.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(r,s,n,xs.RGBA4);const o=this._fbos.rctx;this._bindFbo();const a=o.bindTexture(this._snapshots[e]?.getTexture(),Gr.TEXTURE_UNIT_FOR_UPDATES);o.gl.copyTexSubImage2D(on.TEXTURE_2D,0,0,0,0,0,r,s),o.bindTexture(a,Gr.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){return this.enabled?this._snapshots[e]?.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(ss.COLOR_BUFFER_BIT|ss.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,i,r){const s=Math.min(window.devicePixelRatio,i)/e.pixelRatio,n=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=Fw(Math.floor(Math.max(e.fullWidth,e.fullHeight)*s*n)),a=Math.min(this._maxTextureWidth,this._numCascades*o);return iFe(a/this._numCascades)}_ensureFbo(){this._handle?.fbo?.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",xs.RGBA4)),this._handle?.acquireDepth(pa.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=yi(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._handle?.fbo)}_constructCascade(e,i,r,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);Tt(l<c);for(let f=0;f<8;++f){Ds(lbe,f%4==0||f%4==3?-1:1,f%4==0||f%4==1?-1:1,f<4?l:c,1);const g=Np[f];xh(g,lbe,this._projectionViewInverse),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3]}Ha(NX,Np[0]),n.camera.viewMatrix=ac(fAt,this._modelViewLight,NX);for(let f=0;f<8;++f)nt(Np[f],Np[f],n.camera.viewMatrix);let u=Np[0][2],h=Np[0][2];for(let f=1;f<8;++f)u=Math.min(u,Np[f][2]),h=Math.max(h,Np[f][2]);u-=200,h+=200,n.camera.near=-h,n.camera.far=-u,_At(r,s,u,h,n.camera),Or(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const p=this._textureHeight;n.camera.viewport=[e*p,0,p,p]}_setupMatrices(e,i){Or(this._projectionView,e.projectionMatrix,e.viewMatrix),Ao(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===Xe.Global?e.eye:ue(NX,0,0,1);Mq(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_computeCascadeDistances(e,i,r){const s=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(Hgt(i/e,4)),s);const n=(i-e)/this._numCascades,o=(i/e)**(1/this._numCascades);let a=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=Wt(a,l,this.settings.splitSchemeLambda),a*=o,l+=n}get test(){}};const fAt=Ne(),lbe=pi(),Np=[];for(let t=0;t<8;++t)Np.push(pi());const cbe=vt(),ube=vt(),mAt=vt(),hbe=vt(),dbe=vt(),NX=M(),LX=[],pbe=Ne(),fbe=us.concat(us,us,us,us),Gh=vt(),EM=vt(),AS=[vt(),vt(),vt(),vt()],$o=vt(),DX=vt(),H1=vt(),o3=vt(),CM=vt(),MM=vt(),z5=vt();function gAt(t,e,i,r,s,n,o,a){Gi(Gh,0,0);for(let E=0;E<4;++E)bm(Gh,Gh,t[E]);Ed(Gh,Gh,.25),Gi(EM,0,0);for(let E=4;E<8;++E)bm(EM,EM,t[E]);Ed(EM,EM,.25),qp(AS[0],t[4],t[5],.5),qp(AS[1],t[5],t[6],.5),qp(AS[2],t[6],t[7],.5),qp(AS[3],t[7],t[4],.5);let l=0,c=Xj(AS[0],Gh);for(let E=1;E<4;++E){const C=Xj(AS[E],Gh);C<c&&(c=C,l=E)}By($o,AS[l],t[l+4]);const u=$o[0];let h,p;$o[0]=-$o[1],$o[1]=u,By(DX,EM,Gh),bo(DX,$o)<0&&PDe($o,$o),qp($o,$o,DX,i),AF($o,$o),h=p=bo(By(H1,t[0],Gh),$o);for(let E=1;E<8;++E){const C=bo(By(H1,t[E],Gh),$o);C<h?h=C:C>p&&(p=C)}Cl(r,Gh),Ed(H1,$o,h-e),bm(r,r,H1);let f=-1,g=1,y=0,v=0;for(let E=0;E<8;++E){By(o3,t[E],r),AF(o3,o3);const C=$o[0]*o3[1]-$o[1]*o3[0];C>0?C>f&&(f=C,y=E):C<g&&(g=C,v=E)}lM(f>0,"leftArea"),lM(g<0,"rightArea"),Ed(CM,$o,h),bm(CM,CM,Gh),Ed(MM,$o,p),bm(MM,MM,Gh),z5[0]=-$o[1],z5[1]=$o[0];const b=WU(r,t[v],MM,bm(H1,MM,z5),1,s),w=WU(r,t[y],MM,H1,1,n),x=WU(r,t[y],CM,bm(H1,CM,z5),1,o),S=WU(r,t[v],CM,H1,1,a);lM(b,"rayRay"),lM(w,"rayRay"),lM(x,"rayRay"),lM(S,"rayRay")}function Ji(t,e){return 3*e+t}const mbe=vt();function zu(t,e){return Gi(mbe,t[e],t[e+3]),mbe}const su=vt(),xt=ps();function yAt(t,e,i,r,s){By(su,i,r),Ed(su,su,.5),xt[0]=su[0],xt[1]=su[1],xt[2]=0,xt[3]=su[1],xt[4]=-su[0],xt[5]=0,xt[6]=su[0]*su[0]+su[1]*su[1],xt[7]=su[0]*su[1]-su[1]*su[0],xt[8]=1,xt[Ji(0,2)]=-bo(zu(xt,0),t),xt[Ji(1,2)]=-bo(zu(xt,1),t);let n=bo(zu(xt,0),i)+xt[Ji(0,2)],o=bo(zu(xt,1),i)+xt[Ji(1,2)],a=bo(zu(xt,0),r)+xt[Ji(0,2)],l=bo(zu(xt,1),r)+xt[Ji(1,2)];n=-(n+a)/(o+l),xt[Ji(0,0)]+=xt[Ji(1,0)]*n,xt[Ji(0,1)]+=xt[Ji(1,1)]*n,xt[Ji(0,2)]+=xt[Ji(1,2)]*n,n=1/(bo(zu(xt,0),i)+xt[Ji(0,2)]),o=1/(bo(zu(xt,1),i)+xt[Ji(1,2)]),xt[Ji(0,0)]*=n,xt[Ji(0,1)]*=n,xt[Ji(0,2)]*=n,xt[Ji(1,0)]*=o,xt[Ji(1,1)]*=o,xt[Ji(1,2)]*=o,xt[Ji(2,0)]=xt[Ji(1,0)],xt[Ji(2,1)]=xt[Ji(1,1)],xt[Ji(2,2)]=xt[Ji(1,2)],xt[Ji(1,2)]+=1,n=bo(zu(xt,1),e)+xt[Ji(1,2)],o=bo(zu(xt,2),e)+xt[Ji(2,2)],a=bo(zu(xt,1),i)+xt[Ji(1,2)],l=bo(zu(xt,2),i)+xt[Ji(2,2)],n=-.5*(n/o+a/l),xt[Ji(1,0)]+=xt[Ji(2,0)]*n,xt[Ji(1,1)]+=xt[Ji(2,1)]*n,xt[Ji(1,2)]+=xt[Ji(2,2)]*n,n=bo(zu(xt,1),e)+xt[Ji(1,2)],o=bo(zu(xt,2),e)+xt[Ji(2,2)],a=-o/n,xt[Ji(1,0)]*=a,xt[Ji(1,1)]*=a,xt[Ji(1,2)]*=a,s[0]=xt[0],s[1]=xt[1],s[2]=0,s[3]=xt[2],s[4]=xt[3],s[5]=xt[4],s[6]=0,s[7]=xt[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=xt[6],s[13]=xt[7],s[14]=0,s[15]=xt[8]}function _At(t,e,i,r,s){const n=1/Np[0][3],o=1/Np[4][3];Tt(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(Jo(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,gAt(Np,a,l,cbe,ube,mAt,hbe,dbe),yAt(cbe,ube,hbe,dbe,s.projectionMatrix),s.projectionMatrix[10]=2/(i-r),s.projectionMatrix[14]=-(i+r)/(i-r)}function vAt(t){let{near:e,far:i}=t;return e<2&&(e=2),i<2&&(i=2),e>=i&&(e=2,i=4),{near:e,far:i}}function bAt(t){return _f(t)&&t.intersector===bs.TERRAIN&&!!t.target}let wAt=class extends Vk{constructor(e,i,r){super(e,i),this.triangleNr=r}};function ABe(t){return _f(t)&&t.intersector===bs.OVERLAY&&!!t.target}var Is,To;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(Is||(Is={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(To||(To={}));let RBe=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}dispose(){this._map.forEach((e,i)=>{e!=null&&this._repository.release(this._material,i)})}load(e,i,r){if(!this._material.produces.get(i)?.(r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const n=this._map.get(r);if(n!=null){if(n.ensureResources(e)===px.LOADED)return n;this._repository.requestRender()}return null}},bse=class extends LUe{constructor(e=M()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},Sde=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function gbe(t){const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;){i=!1;for(let r=0;r<t.length;++r){const s=t.data[r],n=e.get(s.to);if(!n)return;s.to=n.to,e.delete(n.from),t.removeUnordered(n),i=!0}}}let ybe=class extends Sde{constructor(e,i,r){super(i,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},xAt=class{constructor(){this.first=0,this.count=0}},SAt=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new ci({allocator:e=>e||new Sde,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=V5(),this.drawCommandsHighlight=V5(),this.drawCommandsOccludees=V5(),this.drawCommandsShadowHighlightRest=V5()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=i,s.to=r,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const r=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao!=null&&this.holes.length===1&&s.to===Math.floor(this.vao.byteSize/e)?(r.first=0,void(r.count=s.from)):(r.first=1/0,r.count=0,this._instances.forEach(n=>{r.first=Math.min(r.first,n.from),r.count=Math.max(r.count,n.to)}),void(r.count-=r.first))}const i=Array.from(this._instances.values()).sort((r,s)=>r.from===s.from?r.to-s.to:r.from-s.from);for(const r of i)r.isVisible&&(_be(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),_be(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function TAt(t){return t.vao!=null}function V5(){return new ci({allocator:t=>t||new xAt,deallocator:t=>t})}function _be(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(EAt(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function EAt(t,e){return t.first+t.count>=e.from}let CAt=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}};const wse=-3,PBe=wse-1;var xm;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(xm||(xm={}));let MAt=class{constructor(e,i,r){this.name=e,this._storage=i,this.id=AAt+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),r&&(this._storage.registerRemoveFunc(this.id,r),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,i,r,s=0){this._storage.put(this,e,i,r,s)}pop(e){const i=this._storage.pop(this,e);return i===void 0?++this._miss:++this._hit,i}get(e){const i=this._storage.get(this,e);return i===void 0?++this._miss:++this._hit,i}peek(e){return this._storage.peek(this,e)}updateSize(e,i,r){this._storage.updateSize(this,e,i,r)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},OBe=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new ci,this._users=new ci}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,i){this._removeFuncs.push([e,i])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(i=>i[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,i){return this._db.get(e.id+i)?.size??0}put(e,i,r,s,n){i=e.id+i;const o=this._db.get(i);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(i),o.entry!==r&&this._notifyRemove(i,o.entry,o.size,xm.ALL)),s>this._maxSize)return void this._notifyRemove(i,r,s,xm.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return console.warn(`Refusing to cache entry with size ${s} for key ${i}`),void this._notifyRemove(i,r,0,xm.ALL);const a=1+Math.max(n,PBe)-wse;this._db.set(i,new RAt(r,s,a)),this._size+=s,e.size+=s,this._checkSize()}updateSize(e,i,r,s){i=e.id+i;const n=this._db.get(i);if(n&&n.entry===r){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const o=this._notifyRemove(i,r,s,xm.SOME);if(!(o!=null&&o>0))return void this._db.delete(i);s=o}n.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,i){i=e.id+i;const r=this._db.get(i);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(i),++this._hit,r.entry;++this._miss}get(e,i){i=e.id+i;const r=this._db.get(i);if(r!==void 0)return this._db.delete(i),r.lives=r.lifetime,this._db.set(i,r),++this._hit,r.entry;++this._miss}peek(e,i){const r=this._db.get(e.id+i);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const{id:u,name:h}=c;if(a.startsWith(u)){const p=i[h]||0;i[h]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>e[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(e["Priority "+(o+wse-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const i=e.id;this._db.forEach((r,s)=>{s.startsWith(i)&&(this._size-=r.size,this._db.delete(s),this._notifyRemove(s,r.entry,r.size,xm.ALL))}),e.size=0}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,e.size,xm.ALL)),this._users.forAll(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r,s){let n;return this._removeFuncs.some(o=>{if(e.startsWith(o[0])){const a=o[1](i,s,r);return typeof a=="number"&&(n=a),!0}return!1}),n}_checkSize(){this._users.forAll(e=>this._checkSizeLimits(e)),this._checkSizeLimits()}_checkSizeLimits(e){const i=e??this;if(i.maxSize<0||i.size<=i.maxSize)return;const r=e?.id;let s=!0;for(;s;){s=!1;for(const[n,o]of this._db)if(o.lifetime===0&&(!r||n.startsWith(r))){if(this._purgeItem(n,o,e),i.size<=.9*i.maxSize)return;s||=this._db.has(n)}}for(const[n,o]of this._db)if((!r||n.startsWith(r))&&(this._purgeItem(n,o,e),i.size<=.9*i.maxSize))return}_purgeItem(e,i,r=this._users.find(s=>e.startsWith(s.id))){if(this._db.delete(e),i.lives<=1){this._size-=i.size,r&&(r.size-=i.size);const s=this._notifyRemove(e,i.entry,i.size,xm.SOME);s!=null&&s>0&&(this._size+=s,r&&(r.size+=s),i.lives=i.lifetime,i.size=s,this._db.set(e,i))}else--i.lives,this._db.set(e,i)}},AAt=0,RAt=class{constructor(e,i,r){this.entry=e,this.size=i,this.lifetime=r,this.lives=r}},x4=class{constructor(e,i){this._cache=e(i,(r,s,n)=>{switch(s){case xm.ALL:return r.forEach(o=>o.dispose()),0;case xm.SOME:{const o=r.shift();return o&&(n-=Math.round(o.usedMemory),o.dispose()),n}}})}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const i=this._cache.peek(e);if(!i)return;const r=i.pop();if(i.length>0){if(r){const s=this._cache.getSize(e)-Math.round(r.usedMemory);this._cache.updateSize(e,i,s)}}else this._cache.pop(e);return r}put(e,i,r=PBe){const s=this._cache.peek(e);if(!s)return void this._cache.put(e,[i],i.usedMemory,r);s.push(i);const n=this._cache.getSize(e)+Math.round(i.usedMemory);this._cache.updateSize(e,s,n)}},PAt=class{constructor(e,i,r){this._rctx=e,this._locations=i,this._layout=r,this._cache=new x4(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const i=e.toString();let r=this._cache.pop(i);return r||(r=new k0(this._rctx,this._locations,{geometry:this._layout},{geometry:Vr.createVertex(this._rctx,wr.STATIC_DRAW)}),r.vertexBuffers.geometry.setSize(e),r)}deleteVao(e){if(e==null)return;const i=e.byteSize.toString();this._cache.put(i,e)}},RD=class extends vke{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._produces=new Map,this.drapedPriority=0}destroy(){this._glMaterials=jt(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=jt(this._vaoCache)}initialize(){this.material.produces.forEach((e,i)=>{this._produces.set(i,r=>!(this._dataByOrigin.size===0||!(r!==G.Highlight&&r!==G.ShadowHighlight||this._hasHighlights))&&e(r))})}get produces(){return this._produces}initializeRenderContext(e,i){const{rctx:r}=e.renderContext;this._glMaterials=new RBe(this.material,i??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new PAt(r,this.material.vertexAttributeLocations,Dh(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get materialReference(){return this.material}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.vao.usedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const i=this._bufferWriter;if(i===null)return;const r=i.vertexBufferLayout.stride/4;for(const s of e){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o?.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(To.GEOMETRY|To.TRANSFORMATION)){const c=H5(i.elementCount(l.geometry.geometry)*r),u=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*r,0,l.numElements*r)}s.updateType&(To.HIGHLIGHT|To.OCCLUDEE|To.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,i){const r=new yx;for(const s of e){const n=s.localOrigin;if(n==null)continue;let o=r.get(n.id,null);o==null&&(o=new vbe(n.vec3),r.set(n.id,null,o)),o.changes.push(s)}for(const s of i){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o?.findBuffer(s.id);if(a==null)continue;let l=r.get(n.id,a);l==null&&(l=new vbe(n.vec3),r.set(n.id,a,l)),l.changes.push(s)}return r}_addAndRemoveGeometries(e,i){if(this._bufferWriter===null||this._vaoCache===null)return;const{_bufferWriter:r,_dataByOrigin:s}=this,n=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,i);o.forEach((a,l)=>{const c=a.get(null),u=c!=null?c.changes:[];o.delete(l,null);let h=s.get(l);if(a.forEach((p,f)=>{if(o.delete(l,f),f==null)return void Tt(!1,"No VAO for removed geometries");if(f.instances.size===p.changes.length)return this._vaoCache.deleteVao(f.vao),QD(h.buffers,f),void(h.buffers.length===0&&u.length===0&&s.delete(l));const g=f.numElements,y=f.vao.byteSize/4,v=u.reduce((S,E)=>S+r.elementCount(E.geometry),0),b=p.changes.reduce((S,E)=>S+r.elementCount(E.geometry),0),w=Math.min((g+v-b)*n,j5),x=w>y;w>z8&&w<y/2?(p.changes.forEach(({id:S})=>f.deleteInstance(S)),f.instances.forEach(({geometry:S})=>u.push(S)),this._vaoCache.deleteVao(f.vao),QD(h.buffers,f)):x?this._applyAndRebuild(f,u,p):this._applyRemoves(f,p)}),u.length>0)for(h==null&&(h=new CAt(c.origin),s.set(l,h)),h.buffers.forEach(p=>this._applyAdds(p,u));u.length>0;)h.buffers.push(this._applyAndRebuild(new SAt,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.drawCommandsDirty&&(i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,Pd(i.instances,r=>(i.updateDrawState(r),i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees)),i.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||i.hasHighlights,this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(r!=null)for(const g of r.changes)e.deleteInstance(g.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(j5/o);let l=e.numElements;for(;i.length>0;){const g=i.pop(),y=s.elementCount(g.geometry);if(l+y>a&&l>0){i.push(g);break}l+=y;const v=new ybe(g,0,0);Tt(e.instances.get(g.id)==null),e.addInstance(g.id,v)}const c=l*o,u=H5(c),h=s.vertexBufferLayout.createView(u.buffer);let p=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((g,y)=>{this._writeGeometry(g.geometry,h,p);const v=p;p+=s.elementCount(g.geometry.geometry),e.updateInstance(y,v,p),e.updateDrawState(g)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(xbe(c)),e.vao.vertexBuffers.geometry.setSubData(u,0,0,p*o),e.holes.clear();const f=e.holes.pushNew();return f.from=p,f.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,i){if(i.changes.length===0||this._bufferWriter===null)return;for(const a of i.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const u=Dg.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const h=Dg.pushNew();h.from=c.from,h.to=c.to}gbe(Dg);const r=this._bufferWriter.vertexBufferLayout.stride/4,s=Dg.reduce((a,l)=>Math.max(a,l.numElements),0)*r,n=H5(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;Dg.forAll(a=>o.setSubData(n,a.from*r,0,a.numElements*r)),e.holes.pushArray(Dg.data,Dg.length),Dg.forAll((a,l)=>Dg.data[l]=null),Dg.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0||this._bufferWriter===null)return;if(!TAt(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=e.numElements,o=i.reduce((b,w)=>b+r.elementCount(w.geometry),0),a=Math.min((n+o)*s,j5),l=4*a;if(e.vao.byteSize<xbe(j5-z8)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,i,null);gbe(e.holes);const c=new Array;for(const b of i){const w=r.elementCount(b.geometry),x=OAt(e.holes,w);c.push(x)}const u=e.vao.vertexBuffers.geometry;let h=0,p=0,f=0;const g=H5(a),y=r.vertexBufferLayout.createView(g.buffer);i.forEach((b,w)=>{const x=c[w];if(x==null)return;if(f!==x){const C=f-p;C>0&&u.setSubData(g,p*s,0,C*s),p=x,h=0}const S=r.elementCount(b.geometry);this._writeGeometry(b,y,h),h+=S,f=x+S;const E=new ybe(b,x,x+S);Tt(e.instances.get(b.id)==null),e.addInstance(b.id,E),e.drawCommandsDirty=!0});const v=f-p;v>0&&u.setSubData(g,p*s,0,v*s),cXe(i,(b,w)=>c[w]==null)}_writeGeometry(e,i,r){if(this._bufferWriter===null)return;const s=e.localOrigin.vec3;qgt(bbe,-s[0],-s[1],-s[2]);const n=Or(IAt,bbe,e.transformation);Ao(G5,n),Rh(G5,G5),this._bufferWriter.write(n,G5,e.geometry,i,r)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:i,bindParameters:r}=e;if(!this.material.produces.get(r.slot)?.(i))return null;const n=i===G.Highlight||i===G.ShadowHighlight;if(n&&!this._hasHighlights)return null;const o=i===G.ShadowExcludeHighlight,a=!(n||o);for(const l of this._dataByOrigin.values())for(const c of l.buffers){if(n&&!c.hasHighlights)continue;const u=(n?c.drawCommandsHighlight:o&&c.needsMultipleCommands()?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,h=a&&c.drawCommandsOccludees||null;if(u?.length||h?.length){const p=this._glMaterials.load(e.rctx,r.slot,i),f=p!=null?p.beginSlot(r):null;if(f!=null)return f}}return null}renderNode(e,i){const{output:r,bindParameters:s}=e,n=r===G.Highlight||r===G.ShadowHighlight,o=r===G.ShadowExcludeHighlight,a=!(n||o),l=s.slot===Ce.OCCLUDER_MATERIAL,c=s.slot===Ce.TRANSPARENT_OCCLUDER_MATERIAL,u=e.rctx;u.runAppleAmdDriverHelper(),u.bindTechnique(i,s,this.material.parameters);for(const h of this._dataByOrigin.values())for(const p of h.buffers){if(n&&!p.hasHighlights)continue;const f=(n?p.drawCommandsHighlight:o&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,g=a&&p.drawCommandsOccludees||null;(f?.length||g?.length)&&(i.program.bindDraw(new bse(h.origin),s,this.material.parameters),i.ensureAttributeLocations(p.vao),u.bindVAO(p.vao),f?.length&&(u.setPipelineState(i.getPipeline(!1,l,c)),f.forAll(y=>u.drawArrays(i.primitiveType,y.first,y.count))),g?.length&&(u.setPipelineState(i.getPipeline(!0,l,c)),g.forAll(y=>u.drawArrays(i.primitiveType,y.first,y.count))))}}get test(){}};d([m({constructOnly:!0})],RD.prototype,"material",void 0),RD=d([N("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],RD);let vbe=class{constructor(e){this.origin=e,this.changes=new Array}};function OAt(t,e){let i;if(!t.some(s=>!(s.numElements<e)&&(i=s,!0)))return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const bbe=Ne(),IAt=Ne(),G5=Ne(),Dg=new ci({allocator:t=>t||new Sde,deallocator:null}),z8=65536,FX=4*z8,wbe=1024,IBe=16777216,j5=IBe/4;let kX=new Float32Array(z8);function H5(t){return kX.length<t&&(kX=new Float32Array(t)),kX}function xbe(t){const e=4*t;return e<=wbe?wbe:e<FX?EPe(e):Math.max(Math.min(Math.ceil(1.5*e/FX)*FX,IBe),e)}let ud=class extends Fe{constructor(e){super(e),this._pending=new $At,this._changes=new qie,this._materialRenderers=new Map,this._sortedMaterialRenderers=new ci,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.destroy()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return Pd(this._materialRenderers,e=>e.numGeometries!==0&&!e.queryRenderOccludedState(pr.Occlude))}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}getMaterialRenderer(e){return this._materialRenderers.get(e)}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=RFe(this._changes);let i=!1;return e.forEach((r,s)=>{let n=this.getMaterialRenderer(s);if(!n&&r.adds.length>0){const o=new RD({material:s});o.initializeRenderContext(this.rendererContext.pluginContext,this._materials),n=o,this._materialRenderers.set(s,n),i=!0}n&&(n.modify(r),n.numGeometries===0&&(this._materialRenderers.delete(s),n.destroy(),i=!0))}),this._changes.clear(),i&&this._updateSortedMaterialRenderers(),this._hasHighlights=Pd(this._materialRenderers,r=>{const s=r.produces.get(Ce.DRAPED_MATERIAL);return!!s&&s(G.Highlight)}),this._hasWater=Pd(this._materialRenderers,r=>{const s=r.produces.get(Ce.DRAPED_WATER);return!!s&&s(G.Normal)}),this.notifyChange("updating"),!0}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of r)this._pending.adds.add(n);s&&this.notifyChange("updating"),i===Is.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,i){const r=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===Is.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case To.TRANSFORMATION:case To.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case To.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedMaterialRenderers.forAll(r=>i=!!r.updateAnimation&&r.updateAnimation(e)||i),i}shouldRender(e){return this._sortedMaterialRenderers.some(i=>i.prepareTechnique(e))}render(e){this._sortedMaterialRenderers.forAll(i=>{const r=i.prepareTechnique(e);r!=null&&i.renderNode(e,r)})}intersect(e,i,r,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,r,i,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,r,i,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,r,i,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;for(const i of this._materialRenderers.values())i.drapedPriority=e++,this._sortedMaterialRenderers.push(i);this._sortedMaterialRenderers.sort((i,r)=>r.materialReference?.renderPriority===i.materialReference?.renderPriority?i.drapedPriority-r.drapedPriority:(r.materialReference?.renderPriority||0)-(i.materialReference?.renderPriority||0))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const i=this._changes.updates.data[e];this._pending.has(i.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,i,r,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],UX[0]=r[0]-s,UX[1]=r[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,UX,(l,c,u)=>{NAt(i,u,o,e.material.renderPriority,n,e.layerUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let i;for(const r of e){const s=r.graphicUid;s!=null&&s!==i&&(this.drapeSource.notifyGraphicGeometryChanged(s),i=s)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let i;for(const r of e){const s=r.graphicUid;s!=null&&s!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(s),i=s)}}_validateRenderGeometries(e){for(const i of e)this._validateRenderGeometry(i);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){}};d([m()],ud.prototype,"drapeSource",void 0),d([m()],ud.prototype,"updating",null),d([m()],ud.prototype,"rctx",null),d([m({constructOnly:!0})],ud.prototype,"rendererContext",void 0),d([m()],ud.prototype,"_materials",null),d([m()],ud.prototype,"_localOriginFactory",null),d([m({readOnly:!0})],ud.prototype,"isEmpty",null),d([m()],ud.prototype,"_materialRenderers",void 0),d([m()],ud.prototype,"_geometries",void 0),ud=d([N("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],ud);let $At=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function NAt(t,e,i,r,s,n,o){const a=new wAt(n,o,e),l=c=>{c.set(bs.OVERLAY,a,t.dist,t.normal,t.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==Ya.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===Ya.ALL){const c=eue(s.ray);l(c),s.results.all.push(c)}}const UX=vt();let Tde=class $Be extends hr{initializeProgram(e){return new dr(e.rctx,$Be.shader.get().build(),Fi)}initializePipeline(){return this.configuration.hasAlpha?ti({blending:Za(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),colorWrite:fi}):ti({colorWrite:fi})}};Tde.shader=new ir(YCt,()=>ye(()=>import("./TextureOnly.glsl-859b698d.js"),[],import.meta.url));let Ede=class extends Zc{constructor(){super(...arguments),this.hasAlpha=!1}};d([V()],Ede.prototype,"hasAlpha",void 0);let NBe=class extends is{constructor(){super(...arguments),this.overlayIndex=io.INNER,this.opacity=1}};function LAt(){const t=new tr;return t.include(Rl),t.fragment.uniforms.add(new Et("tex",e=>e.texture)),t.fragment.uniforms.add(new KI("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new et("opacity",e=>e.opacity)),t.fragment.code.add(T`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const DAt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:NBe,build:LAt},Symbol.toStringTag,{value:"Module"}));let LBe=class DBe extends hr{initializeProgram(e){return new dr(e.rctx,DBe.shader.get().build(),Fi)}initializePipeline(){return ti({blending:Zd(ke.ONE,ke.ONE_MINUS_SRC_ALPHA),colorWrite:fi})}};LBe.shader=new ir(DAt,()=>ye(()=>import("./OverlayCompositing.glsl-565bb7af.js"),[],import.meta.url));let Sp=class extends ahe{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new NBe,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new ci,this._passParameters=new J5e,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new Kr,this.worldToPCSRatio=1,this.events=new un,this.longitudeCyclical=null,this.produces=new Map([[Ce.DRAPED_MATERIAL,i=>i!==G.Highlight||this.hasHighlights],[Ce.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,i=this.view._stage.renderView,{waterTextures:r,stippleTextures:s,markerTextures:n}=i;this._techniques=new Q5e({rctx:this._rctx,viewingMode:Xe.Local,stippleTextures:s,markerTextures:n,waterTextures:r}),this._renderContext=new MBe(this._rctx,new xde(e,this.view.state.viewingMode),null),this.addHandles([_e(()=>r.updating,()=>this.events.emit("content-changed"),Sr),_e(()=>this.spatialReference,o=>this._localOriginFactory=new CBe(o),Sr),qa(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materials=new K5e(i.textures,this._techniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Ce.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=mt.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new Wue(Be(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(Ut.STAGE,this))}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=yi(this._debugTextureTechnique),this._passParameters.texture=jt(this._passParameters.texture),this._techniques=Ge(this._techniques),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||Pd(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMaterialRenderer(e){for(const i of this._renderers.values()){const r=i.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,ud)}createDrapeSourceRenderer(e,i,r){const s=this._renderers.get(e);s?.destroy();const n=new i({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(_e(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(e==null)return;const i=this._renderers.get(e);i!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),i.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&Zz(e,i=>i.drapeTargetType===yse.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=Zz(e,i=>i.drapeSourceType===CD.Features),this._hasDrapedRasterSource=Zz(e,i=>i.drapeSourceType===CD.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,i,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new DCt(this.view._stage.renderer.fboCache),this._overlays=[new X1e,new X1e]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=jt(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){if(e!=null)return e===vs.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(vs.Color):this._renderTargets?.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,i){let r=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||i(s))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=Pd(this._renderers,s=>s.hasHighlights),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(_h,e=>e.updatePolicy===zw.SYNC)}get isEmpty(){return!ts.OVERLAY_DRAW_DEBUG_TEXTURE&&!Pd(this._renderers,e=>!e.isEmpty)}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=V8;const i=this._sortedRenderers.some(({renderer:r})=>r.shouldRender(this._renderContext));return this._renderContext.renderOccludedMask=e,i}renders(e){return ts.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==vs.Occluded||this._sortedRenderers.some(({renderer:i})=>i.shouldRender(this._renderContext))}get mode(){return this.isEmpty?Jy.Disabled:this._renderTargets?.getTexture(vs.WaterNormal)?Jy.EnabledWithWater:this._renderTargets?.getTexture(vs.Color)?Jy.Enabled:Jy.Disabled}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const i of this._overlays)this.longitudeCyclical?i.setupGeometryViewsCyclical(this.longitudeCyclical):i.setupGeometryViewsDirect();for(const i of this._renderTargets.targets){if(i.content===vs.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(io.INNER,i,e),s=this._drawTarget(io.OUTER,i,e);(r||s)&&i.fbo.generateMipMap()}}}_drawTarget(e,i,r){const s=this._overlays[e],n=s.canvasGeometries;if(n.numViews===0)return!1;const{alignPixelEnabled:o,contentPixelRatio:a}=r;this._screenToWorldRatio=a*s.mapUnitsPerPixel/this._bindParameters.overlayStretch;const l=i.output;if(this.isEmpty||l===G.Highlight&&!this.hasHighlights||l===G.Normal&&!this.hasWater||!s.hasSomeSizedView())return!1;const c=this._rctx;if(this._camera.pixelRatio=s.pixelRatio*a,this._renderContext.output=l,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=l===G.Normal?Ce.DRAPED_WATER:Ce.DRAPED_MATERIAL,i.content===vs.Occluded&&(this._renderContext.renderOccludedMask=V8),!this.renders(i.content))return this._renderContext.renderOccludedMask=B8,!1;const u=s.resolution;this._rctx.setViewport(e===io.INNER?0:u,0,u,u);const h=2*s.resolution,p=s.resolution,f=i.fbo;if(f.bind(c,h,p),e===io.INNER&&(c.setClearColor(0,0,0,0),c.clear(ss.COLOR_BUFFER_BIT)),ts.OVERLAY_DRAW_DEBUG_TEXTURE&&i.content!==vs.Occluded)for(let g=0;g<n.numViews;g++)this._setViewParameters(n.extents[g],s),this._ensureDebugPatternResources(s.resolution,kAt[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll(({drapeSource:g,renderer:y})=>{if(i.content===vs.ColorNoRasterImage&&g.drapeSourceType===CD.RasterImage)return;const{fullOpacity:v}=g,b=v!=null&&v<1&&l===G.Color?this.bindTemporaryFramebuffer(h,p):null;for(let w=0;w<n.numViews;w++)this._setViewParameters(n.extents[w],s),y.render(this._renderContext);if(b){f.bind(c,h,p),this._overlayParameters.texture=b.getTexture(),this._overlayParameters.opacity=v,this._overlayParameters.overlayIndex=e;const w=this.pluginContext.techniques.acquire(LBe);this._rctx.bindTechnique(w,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),w.release(),b.release()}}),c.bindFramebuffer(null),this._renderContext.renderOccludedMask=B8,!0}bindTemporaryFramebuffer(e,i){const r=this.view._stage.renderer.fboCache,s=r.acquire(e,i,"overlay tmp");return r.rctx.unbindTexture(s.fbo?.colorTexture),r.rctx.bindFramebuffer(s.fbo),r.rctx.clear(ss.COLOR_BUFFER_BIT),s}async reloadShaders(){await this._techniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,s){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:o}of this._sortedRenderers)n=o.intersect?.(e,i,r,s,n)??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers,i=e.length;this._renderers.forEach((r,s)=>{const n=e.indexOf(s.layer),o=n>=0,a=s.renderGroup??(o?$8.MapLayer:$8.ViewLayer),l=i*a+(o?n:0);this._sortedRenderers.push(new FAt(s,r,l))}),this._sortedRenderers.sort((r,s)=>r.index-s.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],BPe(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),mC(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=Pd(this._renderers,i=>i.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_ensureDebugPatternResources(e,i){if(ue(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let s=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),u=Math.floor(a/10);c<2||u<2||10*c>e-20||10*u>e-20?(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=255):(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=1&c&&1&u?1&l^1&a?0:255:1&c^1&u?0:128)}const n=new fs(e);n.samplingMode=_i.NEAREST,this._passParameters.texture=new Gr(this._rctx,n,r);const o=new Ede;o.hasAlpha=!0,this._debugTextureTechnique=this._techniques.acquire(Tde,o)}get test(){}};d([m()],Sp.prototype,"hasHighlights",void 0),d([m()],Sp.prototype,"_sortedDrapeSourceRenderersDirty",void 0),d([m()],Sp.prototype,"_techniques",void 0),d([m({constructOnly:!0})],Sp.prototype,"view",void 0),d([m()],Sp.prototype,"worldToPCSRatio",void 0),d([m()],Sp.prototype,"spatialReference",void 0),d([m({type:Boolean,readOnly:!0})],Sp.prototype,"updating",null),d([m()],Sp.prototype,"isEmpty",null),d([m({readOnly:!0})],Sp.prototype,"rendersOccludedDraped",null),Sp=d([N("esri.views.3d.terrain.OverlayRenderer")],Sp);let FAt=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const kAt=[[1,.5,.5],[.5,.5,1]],Cde=-2,V8=pr.OccludeAndTransparent;function Mde(t,e,i,r){const s=b4(t.rings,!!t.hasZ&&r.mode!=="on-the-ground",S0.CCW_IS_HOLE,t.spatialReference),n=qo(s.position.length),o=nUe(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,i,r),a=o!=null;return new zAt(s.position,n,UBe(s.polygons,s.position,n),kBe(s.outlines,s.position,n),a,o)}function FBe(t,e){const i=b4(t.rings,!1,S0.CCW_IS_HOLE),r=Ts(i.position,t.spatialReference,0,i.position,e,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=Cde;return{position:i.position,polygons:UBe(i.polygons,i.position),outlines:kBe(i.outlines,i.position),projectionSuccess:r}}function kBe(t,e,i=null){return t.filter(({count:r})=>r>1).map(({index:r,count:s})=>{const n=3*r,o=3*s;return i!=null?new BBe(r,s,sf(e,n,o),sf(i,n,o)):new Ade(r,s,sf(e,n,o))})}function UBe(t,e,i=null){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,u=o.map(p=>p-s),h=i!=null?new UAt(s,n,sf(e,3*s,3*n),sf(i,l,c),u,a):new BAt(s,n,sf(e,3*s,3*n),u,a);r.push(h)}return r}let Ade=class{constructor(e,i,r){this.index=e,this.count=i,this.position=r}},BBe=class extends Ade{constructor(e,i,r,s){super(e,i,r),this.mapPositions=s}},UAt=class extends BBe{constructor(e,i,r,s,n,o){super(e,i,r,s),this.holeIndices=n,this.pathLengths=o}},BAt=class extends Ade{constructor(e,i,r,s,n){super(e,i,r),this.holeIndices=s,this.pathLengths=n}},zAt=class{constructor(e,i,r,s,n,o){this.position=e,this.mapPositions=i,this.polygons=r,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function gf(t,e,i,r,s,n=2){const o=1/(Math.abs(i)+Math.abs(r)+Math.abs(s)),a=i*o,l=r*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,u=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,h=e*n;t[h]=Sbe(c),t[h+1]=Sbe(u)}function VAt(t){const e=t.length/3,i=new Int16Array(2*e);let r=0;for(let s=0;s<e;++s)gf(i,s,t[r++],t[r++],t[r++]);return i}function mvi(t,e){const i=t.length/3,r=new Int16Array(2*i);let s=0;const n=M();for(let o=0;o<i;++o)n[0]=t[s++],n[1]=t[s++],n[2]=t[s++],Ga(n,n,e),gf(r,o,n[0],n[1],n[2]);return r}function GAt(t,e,i,r=2){const s=i*r,n=Tbe(e[s]),o=Tbe(e[s+1]),a=1-Math.abs(n)-Math.abs(o);t[2]=a,a<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=o),Se(t,t)}function Sbe(t){return $e(Math.round(32767*t),-32767,32767)}function Tbe(t){return $e(t/32767,-1,1)}const jAt=["polygon","extent"];let HAt=class extends j0{constructor(e,i,r,s){super(e,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=i7(this._getSymbolSize());if(a)throw new j("graphics3dextrudesymbollayer:invalid-size",a)}const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacityAndColor(e),r=Dc(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?ns.None:ns.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:yr.Compressed};this._materials[hd.Main]=new vg(o),this._materials[hd.Bottom]=new vg({...o,cullFace:ns.Back}),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,jAt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i);return this._createAs3DShape(i,e.renderingInfo,r,s,i.uid)}layerOpacityChanged(e,i){const r=this.symbolLayer?.material?.color,s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;this._materials[hd.Main]?.setParameters({opacity:s,transparent:n}),this._materials[hd.Bottom]?.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(a=>{const l=i(a);l?.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,vx)}slicePlaneEnabledChanged(e,i){return this._materials[hd.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[hd.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(r=>{const s=i(r);s?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return this._materials[hd.Main]?.setParameters(e),this._materials[hd.Bottom]?.setParameters(e),!0}_getExtrusionSize(e){let i;return i=e.size&&this._drivenProperties.size?TCt(e.size,2)??0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(e,i){return this._drivenPropertiesChanged(i)?Dn.RecreateSymbol:Dn.RecreateGraphics}async queryForSnapping(e,i,r,s){const n=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/AE(i),{objectId:o,target:a}=e,l=ee(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:u}=e,h=ee(c),p=ee(u);return h.z=(h.z??0)+n,p.z=(p.z??0)+n,[j1e(o,l,1/0,h,p)]}case"vertex":return[uCt(o,l,1/0),j1e(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,i,r,s,n){const o=BF(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(D=>D.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=Mde(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=Vhe(o);if(l==null)return null;const c=new Array,u=new Array,h=Oo(),p=Ne(),f=M(),g=this._context.renderCoordsHelper.viewingMode===Xe.Global;g||this._context.renderCoordsHelper.worldUpAtPosition(null,f),Bd(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const y=Ne();Ao(y,p);const v=ps();lx(v,y);const{polygons:b,mapPositions:w,position:x}=a,S=new Map,E=this._materials[hd.Main];for(const D of b){const z=D.count;if(this._context.clippingExtent&&(hs(h),Id(h,D.mapPositions),!Gm(h,this._context.clippingExtent)))continue;const B=oI(D.mapPositions,D.holeIndices,3);if(B.length===0)continue;const Y=B.length,W=6*z,J=n8(W+Y),me=n8(Y),L=qo(3*W),k=qo(3*W),H=qo(3*W),q=qo(W);qAt(x,w,B,D,L,H,k,q,J,me,this._getExtrusionSize(i),f,g),wx(L,L,y);const Q=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),K=new tRt(L,H,VAt(k),q),re=Ebe(E,J,J.length-me.length,K,r,Q),be=z,Re=z,je=2*D.count,_t=new iRt(be,Re,je,Y/3);zBe(re,_t,p),S.set(re,_t),c.push(re,Ebe(this._materials[hd.Bottom],me,0,K,r,Q)),u.push(K.heights)}if(c.length===0)return null;const C=new Zx({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});C.transformation=p;const R=CUe(this.symbolLayer,{opacity:this._getLayerOpacity()}),I=R!=null?{baseMaterial:this._materials[hd.Main],edgeMaterials:[R],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,F=new G0(this,C,c,null,null,(D,z,B,Y,W)=>XAt(D,z,B,Y,W,u,S),s,I);return F.alignedSampledElevation=a.sampledElevation,F.needsElevationUpdates=vx(s.mode),F}};function Ebe(t,e,i,r,s,n){const o=Hx(e.length),a=[[O.POSITION,new dt(r.positions,e,3,!0)],[O.NORMALCOMPRESSED,new dt(r.normals,e,2,!0)],[O.COLOR,new dt(s,o,4,!0)]];return new Zn(t,a,r.elevation,an.Mesh,n,i)}function qAt(t,e,i,r,s,n,o,a,l,c,u,h,p){{const f=i.length/3,g=2*r.count;WAt(t,e,r.index,r.count,i,0,f,s,n,o,a,l,c,g,u,h,p)}{let f=0,g=2*r.count,y=0;const v=r.pathLengths[0];Cbe(s,n,a,o,f,v,r.count,g,l,y,u),g+=4*v,y+=2*v,f+=v;for(let b=1;b<r.pathLengths.length;++b){const w=r.pathLengths[b];Cbe(s,n,a,o,f,w,r.count,g,l,y,u),g+=4*w,y+=2*w,f+=w}}}function WAt(t,e,i,r,s,n,o,a,l,c,u,h,p,f,g,y,v){ge(id,y);{const b=g>0?1:-1;let w=3*i,x=0,S=3*x,E=r,C=3*E;for(let R=0;R<r;++R){const I=t[w],F=t[w+1],D=t[w+2];v&&(id[0]=I,id[1]=F,id[2]=D,Se(id,id)),a[S+0]=I,a[S+1]=F,a[S+2]=D;const z=e[w+0],B=e[w+1],Y=e[w+2];l[S+0]=z,l[S+1]=B,l[S+2]=Y,c[S+0]=-b*id[0],c[S+1]=-b*id[1],c[S+2]=-b*id[2],u[x]=0,a[C+0]=I+g*id[0],a[C+1]=F+g*id[1],a[C+2]=D+g*id[2],l[C+0]=z,l[C+1]=B,l[C+2]=Y,u[E]=g,S+=3,C+=3,w+=3,x+=1,E+=1}}{let b=3*n,w=0,x=3*f;const S=g<0?Ibe:Obe,E=g<0?Obe:Ibe;for(let C=0;C<o;++C)p[w]=s[b+S[0]],p[w+1]=s[b+S[1]],p[w+2]=s[b+S[2]],h[x]=s[b+E[0]]+r,h[x+1]=s[b+E[1]]+r,h[x+2]=s[b+E[2]]+r,w+=3,x+=3,b+=3}}function q5(t,e,i,r,s,n,o){r[n]=r[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],i[n]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const a3=M();function Cbe(t,e,i,r,s,n,o,a,l,c,u){let h=s,p=s+1,f=s+o,g=s+o+1,y=a,v=a+1,b=a+2*n,w=a+2*n+1;u<0&&(h=s+o+1,g=s);let x=3*c;for(let S=0;S<n;++S)S===n-1&&(p=s,u>0?g=s+o:h=s+o),YAt(t,h,p,f,a3),q5(t,e,r,i,a3,y,h),q5(t,e,r,i,a3,v,p),q5(t,e,r,i,a3,b,f),q5(t,e,r,i,a3,w,g),l[x]=y,l[x+1]=b,l[x+2]=w,l[x+3]=y,l[x+4]=w,l[x+5]=v,x+=6,h++,p++,f++,g++,y+=2,v+=2,b+=2,w+=2}const BX=M(),Mbe=M(),Abe=M(),Rbe=M(),Pbe=M();function YAt(t,e,i,r,s){e*=3,i*=3,r*=3,ue(BX,t[e++],t[e++],t[e++]),ue(Mbe,t[i++],t[i++],t[i++]),ue(Abe,t[r++],t[r++],t[r++]),Me(Rbe,Mbe,BX),Me(Pbe,Abe,BX),yt(s,Pbe,Rbe),Se(s,s)}const AM=M();function XAt(t,e,i,r,s,n,o){const a=t.stageObject,l=a.geometries,c=l.length,u=e.mode!=="absolute-height";let h=0;const p=a.transformation,f=Ox(Ne(),p);for(let g=0;g<c;g+=2){const y=l[g];if(!Bhe(y))continue;const v=y.getMutableAttribute(O.POSITION).data,b=n[g/2],w=new iue(y.mapPositions),x=v.length/3;let S=!1,E=0;{let C=0;for(let R=0;R<x;R++){AM[0]=v[C],AM[1]=v[C+1],AM[2]=v[C+2],r(w,W5),u&&(E+=W5.sampledElevation),ts.TESTS_DISABLE_OPTIMIZATIONS?(ue(Pc,w.array[w.offset],w.array[w.offset+1],W5.z+b[C/3]),i!=null&&s.toRenderCoords(Pc,i,Pc),nt(Pc,Pc,f)):(ue(Pc,v[C],v[C+1],v[C+2]),nt(Pc,Pc,p),s.setAltitude(Pc,W5.z+b[C/3]),nt(Pc,Pc,f)),v[C]=Pc[0],v[C+1]=Pc[1],v[C+2]=Pc[2];const I=ZAt/s.unitInMeters;(Math.abs(AM[0]-v[C])>=I||Math.abs(AM[1]-v[C+1])>=I||Math.abs(AM[2]-v[C+2])>=I)&&(S=!0),w.offset+=3,C+=3}}if(S){const C=o.get(y);C&&zBe(y,C,p),a.geometryVertexAttributeUpdated(l[g],O.NORMALCOMPRESSED),y.invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[g],O.POSITION),l[g+1].invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[g+1],O.POSITION)}h+=E/x}return h/c}function zBe(t,e,i){const r=t.getMutableAttribute(O.POSITION),s=t.getMutableAttribute(O.NORMALCOMPRESSED).data,{topVertexStart:n,topVertexCount:o,topFaceStart:a,topFaceCount:l}=e,c=r.data,u=o,h=t.attributes.get(O.POSITION).indices,p=a+l,f=n+o,g=qo(3*u);for(let S=0;S<u;++S){const E=3*S;g[E+0]=0,g[E+1]=0,g[E+2]=0}const y=JAt,v=QAt,b=KAt,w=eRt,x=id;for(let S=a;S<p;++S){const E=3*S;for(let C=0;C<3;++C){const R=h[E+C];w[C]=R;const I=3*R;ue(Pc,c[I+0],c[I+1],c[I+2]),nt(y[C],Pc,i)}Vi(v,y[1],y[0]),Vi(b,y[2],y[0]),yt(x,v,b),Se(x,x);for(let C=0;C<3;++C){const R=3*(w[C]-n);g[R+0]+=x[0],g[R+1]+=x[1],g[R+2]+=x[2]}}for(let S=n;S<f;++S){const E=3*(S-n),C=g[E+0],R=g[E+1],I=g[E+2],F=Math.sqrt(C*C+R*R+I*I);gf(s,S,C/F,R/F,I/F)}}const Pc=M(),id=M(),W5=new u4,Obe=[0,2,1],Ibe=[0,1,2],ZAt=.01,JAt=[M(),M(),M()],QAt=M(),KAt=M(),eRt=[0,0,0];var hd;(function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"})(hd||(hd={}));let tRt=class{constructor(e,i,r,s){this.positions=e,this.elevation=i,this.normals=r,this.heights=s}},iRt=class{constructor(e,i,r,s){this.topVertexStart=e,this.topVertexCount=i,this.topFaceStart=r,this.topFaceCount=s}};const Y5=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["«","»"],["»","«"],["‹","›"],["›","‹"],["⁽","⁾"],["⁾","⁽"],["₍","₎"],["₎","₍"],["≤","≥"],["≥","≤"],["〈","〉"],["〉","〈"],["﹙","﹚"],["﹚","﹙"],["﹛","﹜"],["﹜","﹛"],["﹝","﹞"],["﹞","﹝"],["﹤","﹥"],["﹥","﹤"]],lI=["آ","أ","إ","ا"],rRt=["ﻵ","ﻷ","ﻹ","ﻻ"],sRt=["ﻶ","ﻸ","ﻺ","ﻼ"],G8=["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ی","ئ","ؤ"],nRt=["ﺍ","ﺏ","ﺕ","ﺙ","ﺝ","ﺡ","ﺥ","ﺩ","ﺫ","ﺭ","ﺯ","ﺱ","ﺵ","ﺹ","ﺽ","ﻁ","ﻅ","ﻉ","ﻍ","ﻑ","ﻕ","ﻙ","ﻝ","ﻡ","ﻥ","ﻩ","ﻭ","ﻱ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯼ","ﺉ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺉ","ﺅ"],oRt=["ﺎ","ﺐ","ﺖ","ﺚ","ﺞ","ﺢ","ﺦ","ﺪ","ﺬ","ﺮ","ﺰ","ﺲ","ﺶ","ﺺ","ﺾ","ﻂ","ﻆ","ﻊ","ﻎ","ﻒ","ﻖ","ﻚ","ﻞ","ﻢ","ﻦ","ﻪ","ﻮ","ﻲ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯽ","ﺊ","ﺆ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺊ","ﺆ"],aRt=["ﺎ","ﺒ","ﺘ","ﺜ","ﺠ","ﺤ","ﺨ","ﺪ","ﺬ","ﺮ","ﺰ","ﺴ","ﺸ","ﺼ","ﻀ","ﻄ","ﻈ","ﻌ","ﻐ","ﻔ","ﻘ","ﻜ","ﻠ","ﻤ","ﻨ","ﻬ","ﻮ","ﻴ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯿ","ﺌ","ﺆ","ﹱ","ﹲ","ﹴ","ﹷ","ﹹ","ﹻ","ﹽ","ﹿ","ﺀ","ﺌ","ﺆ"],lRt=["ﺍ","ﺑ","ﺗ","ﺛ","ﺟ","ﺣ","ﺧ","ﺩ","ﺫ","ﺭ","ﺯ","ﺳ","ﺷ","ﺻ","ﺿ","ﻃ","ﻇ","ﻋ","ﻏ","ﻓ","ﻗ","ﻛ","ﻟ","ﻣ","ﻧ","ﻫ","ﻭ","ﻳ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯾ","ﺋ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺋ","ﺅ"],$be=["ء","آ","أ","ؤ","إ","ا","ة","د","ذ","ر","ز","و","ى"],cRt=["ً","ً","ٌ","؟","ٍ","؟","َ","َ","ُ","ُ","ِ","ِ","ّ","ّ","ْ","ْ","ء","آ","آ","أ","أ","ؤ","ؤ","إ","إ","ئ","ئ","ئ","ئ","ا","ا","ب","ب","ب","ب","ة","ة","ت","ت","ت","ت","ث","ث","ث","ث","ج","ج","ج","ج","ح","ح","ح","ح","خ","خ","خ","خ","د","د","ذ","ذ","ر","ر","ز","ز","س","س","س","س","ش","ش","ش","ش","ص","ص","ص","ص","ض","ض","ض","ض","ط","ط","ط","ط","ظ","ظ","ظ","ظ","ع","ع","ع","ع","غ","غ","غ","غ","ف","ف","ف","ف","ق","ق","ق","ق","ك","ك","ك","ك","ل","ل","ل","ل","م","م","م","م","ن","ن","ن","ن","ه","ه","ه","ه","و","و","ى","ى","ي","ي","ي","ي","ﻵ","ﻶ","ﻷ","ﻸ","ﻹ","ﻺ","ﻻ","ﻼ","؟","؟","؟"],Nbe=["ء","ف"],uRt=["غ","ي"],hRt=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],dRt=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],$=0,Pe=1,Yt=2,_o=3,A=4,Oy=5,TG=6,P=7,Mc=8,nu=9,Df=10,si=11,se=12,pRt=13,fRt=14,mRt=15,gRt=16,yRt=17,Pt=18,_Rt=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],xy=100,vRt=[xy+0,$,$,$,$,xy+1,xy+2,xy+3,Pe,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,xy+4,A,A,A,$,A,$,A,$,A,A,A,$,$,A,A,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,A,A,$,$,A,A,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,$,xy+5,P,P,xy+6,xy+7],bRt=[[Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,TG,Oy,TG,Mc,Oy,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Oy,Oy,Oy,TG,Mc,A,A,si,si,si,A,A,A,A,A,Df,nu,Df,nu,nu,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,nu,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,Pt,Pt,Pt,Pt,Pt,Pt,Oy,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,Pt,nu,A,si,si,si,si,A,A,A,A,$,A,A,Pt,A,A,si,si,Yt,Yt,A,$,A,A,A,Yt,$,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,$,$,$,$,$,$,$,$],[$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,$,$,$,$,$,$,$,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,$,A,A,A,A,A,A,A,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,Pe,se,Pe,se,se,Pe,se,se,Pe,se,A,A,A,A,A,A,A,A,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,A,A,A,A,A,Pe,Pe,Pe,Pe,Pe,A,A,A,A,A,A,A,A,A,A,A],[_o,_o,_o,_o,A,A,A,A,P,si,si,P,nu,P,A,A,se,se,se,se,se,se,se,se,se,se,se,P,A,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,_o,_o,_o,_o,_o,_o,_o,_o,_o,_o,si,_o,_o,P,P,P,se,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,se,se,se,se,se,se,se,_o,A,se,se,se,se,se,se,P,P,se,se,A,se,se,se,se,P,P,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,P,P,P,P,P,P],[P,P,P,P,P,P,P,P,P,P,P,P,P,P,A,P,P,se,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,A,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,se,se,se,se,se,se,se,se,se,se,se,P,A,A,A,A,A,A,A,A,A,A,A,A,A,A,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,se,se,se,se,se,se,se,se,se,Pe,Pe,A,A,A,A,Pe,A,A,A,A,A],[Mc,Mc,Mc,Mc,Mc,Mc,Mc,Mc,Mc,Mc,Mc,Pt,Pt,Pt,$,Pe,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,Mc,Oy,pRt,fRt,mRt,gRt,yRt,nu,si,si,si,si,si,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,nu,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,Mc,Pt,Pt,Pt,Pt,Pt,A,A,A,A,A,Pt,Pt,Pt,Pt,Pt,Pt,Yt,$,A,A,Yt,Yt,Yt,Yt,Yt,Yt,Df,Df,A,A,A,$,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Df,Df,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,si,si,si,si,si,si,si,si,si,si,si,si,si,si,si,si,si,si,si,si,si,si,si,si,si,si,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A],[$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$,$,A,A,A,A,A,Pe,se,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Df,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,A,Pe,Pe,Pe,Pe,Pe,A,Pe,A,Pe,Pe,A,Pe,Pe,A,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,Pe,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P],[se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,se,se,se,se,se,se,se,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,nu,A,nu,A,A,nu,A,A,A,A,A,A,A,A,A,si,A,A,Df,Df,A,A,A,A,A,si,si,A,A,A,A,A,P,P,P,P,P,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,A,A,Pt],[A,A,A,si,si,si,A,A,A,A,A,Df,nu,Df,nu,nu,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,nu,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,$,$,$,$,$,$,A,A,$,$,$,$,$,$,A,A,$,$,$,$,$,$,A,A,$,$,$,A,A,A,si,si,A,A,A,si,si,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A]];let wRt=class{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(e,i,r){if(this.sourceToTarget=[],this.targetToSource=[],!e)return"";if(kRt(this.sourceToTarget,this.targetToSource,e.length),!this.checkParameters(i,r))return e;i=this.inputFormat,r=this.outputFormat;let s=e;const n=BRt,o=Fbe(i.charAt(1)),a=Fbe(r.charAt(1)),l=(i.charAt(0)==="I"?"L":i.charAt(0))+o,c=(r.charAt(0)==="I"?"L":r.charAt(0))+a,u=i.charAt(2)+r.charAt(2);n.defInFormat=l,n.defOutFormat=c,n.defSwap=u;const h=JN(e,l,c,u,n);let p=!1;return r.charAt(1)==="R"?p=!0:r.charAt(1)!=="C"&&r.charAt(1)!=="D"||(p=this.checkContextual(h)==="rtl"),this.sourceToTarget=Ad,this.targetToSource=URt(this.sourceToTarget),H8=this.targetToSource,s=i.charAt(3)===r.charAt(3)?h:r.charAt(3)==="S"?SRt(p,h):CRt(h,p,!0),this.sourceToTarget=Ad,this.targetToSource=H8,this.levels=f7,s}_inputFormatSetter(e){if(!kbe.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!kbe.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,i){return e?this._inputFormatSetter(e):e=this.inputFormat,i?this._outputFormatSetter(i):i=this.outputFormat,e!==i}checkContextual(e){let i=j8(e);if(i!=="ltr"&&i!=="rtl"){try{i=document.dir.toLowerCase()}catch{}i!=="ltr"&&i!=="rtl"&&(i="ltr")}return i}hasBidiChar(e){return GRt.test(e)}};function JN(t,e,i,r,s){const n=xRt(t,{inFormat:e,outFormat:i,swap:r},s);if(n.inFormat===n.outFormat)return t;e=n.inFormat,i=n.outFormat,r=n.swap;const o=e.substring(0,1),a=e.substring(1,4),l=i.substring(0,1),c=i.substring(1,4);if(s.inFormat=e,s.outFormat=i,s.swap=r,o==="L"&&i==="VLTR"){if(a==="LTR")return s.dir=RM,q1(t,s);if(a==="RTL")return s.dir=QN,q1(t,s)}if(o==="V"&&l==="V")return s.dir=a==="RTL"?QN:RM,zX(t,s);if(o==="L"&&i==="VRTL")return a==="LTR"?(s.dir=RM,t=q1(t,s)):(s.dir=QN,t=q1(t,s)),zX(t);if(e==="VLTR"&&i==="LLTR")return s.dir=RM,q1(t,s);if(o==="V"&&l==="L"&&a!==c)return t=zX(t),a==="RTL"?JN(t,"LLTR","VLTR",r,s):JN(t,"LRTL","VRTL",r,s);if(e==="VRTL"&&i==="LRTL")return JN(t,"LRTL","VRTL",r,s);if(o==="L"&&l==="L"){const u=s.swap;return s.swap=u.substr(0,1)+"N",a==="RTL"?(s.dir=QN,t=q1(t,s),s.swap="N"+u.substr(1,2),s.dir=RM,t=q1(t,s)):(s.dir=RM,t=q1(t,s),s.swap="N"+u.substr(1,2),t=JN(t,"VLTR","LRTL",s.swap,s)),t}return t}function xRt(t,e,i){if(e.inFormat===void 0&&(e.inFormat=i.defInFormat),e.outFormat===void 0&&(e.outFormat=i.defOutFormat),e.swap===void 0&&(e.swap=i.defSwap),e.inFormat===e.outFormat)return e;const r=e.inFormat.substring(0,1),s=e.outFormat.substring(0,1);let n,o=e.inFormat.substring(1,4),a=e.outFormat.substring(1,4);return o.charAt(0)==="C"&&(n=j8(t),o=n==="ltr"||n==="rtl"?n.toUpperCase():e.inFormat.charAt(2)==="L"?"LTR":"RTL",e.inFormat=r+o),a.charAt(0)==="C"&&(n=j8(t),n==="rtl"?a="RTL":n==="ltr"?(n=ERt(t),a=n.toUpperCase()):a=e.outFormat.charAt(2)==="L"?"LTR":"RTL",e.outFormat=s+a),e}function SRt(t,e,i){if(e.length===0)return"";t===void 0&&(t=!0);const r=(e=String(e)).split("");let s=0,n=1,o=r.length;t||(s=r.length-1,n=-1,o=1);const a=TRt(r,s,n,o);let l="";for(let c=0;c<r.length;c++)PRt(a,a.length,c)>-1?(jBe(H8,c,!t,-1),Ad.splice(c,1)):l+=r[c];return l}function TRt(t,e,i,r,s){let n=0;const o=[];let a=0;for(let l=e;l*i<r;l+=i)if(GBe(t[l])||zF(t[l])){if(t[l]==="ل"&&ORt(t,l+i,i,r)){t[l]=FRt(t[l+i],n===0?rRt:sRt),l+=i,DRt(t,l,i,r),o[a]=l,a++,n=0;continue}const c=t[l];n===1?t[l]=Lbe(t,l+i,i,r)?LRt(t[l]):VX(t[l],oRt):Lbe(t,l+i,i,r)===!0?t[l]=VX(t[l],lRt):t[l]=VX(t[l],nRt),zF(c)||(n=1),NRt(c)===!0&&(n=0)}else n=0;return o}function j8(t){const e=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(t);return e?e[0]<="z"?"ltr":"rtl":""}function ERt(t){const e=t.split("");return e.reverse(),j8(e.join(""))}function CRt(t,e,i){if(t.length===0)return"";e===void 0&&(e=!0);let r="";const s=(t=String(t)).split("");for(let n=0;n<t.length;n++){let o=!1;if(s[n]>="ﹰ"&&s[n]<"\uFEFF"){const a=t.charCodeAt(n);s[n]>="ﻵ"&&s[n]<="ﻼ"?(e?(n>0&&i&&s[n-1]===" "?r=r.substring(0,r.length-1)+"ل":(r+="ل",o=!0),r+=lI[(a-65269)/2]):(r+=lI[(a-65269)/2],r+="ل",n+1<t.length&&i&&s[n+1]===" "?n++:o=!0),o&&(jBe(H8,n,!0,1),Ad.splice(n,0,Ad[n]))):r+=cRt[a-65136]}else r+=s[n]}return r}function q1(t,e){const i=t.split(""),r=[];return VBe(i,r,e),ARt(i,r,e),Dbe(2,i,r,e),Dbe(1,i,r,e),f7=r,i.join("")}function VBe(t,e,i){const r=t.length,s=i.dir?dRt:hRt;let n=0,o=-1;const a=[],l=[];i.hiLevel=i.dir,i.lastArabic=!1,i.hasUbatAl=!1,i.hasUbatB=!1,i.hasUbatS=!1;for(let c=0;c<r;c++)a[c]=RRt(t[c]);for(let c=0;c<r;c++){const u=n,h=IRt(t,a,l,c,i);l[c]=h,n=s[u][h];const p=240&n;n&=15;const f=s[n][zRt];if(e[c]=f,p>0)if(p===16){for(let g=o;g<c;g++)e[g]=1;o=-1}else o=-1;if(s[n][VRt])o===-1&&(o=c);else if(o>-1){for(let g=o;g<c;g++)e[g]=f;o=-1}a[c]===Oy&&(e[c]=0),i.hiLevel|=f}i.hasUbatS&&MRt(a,e,r,i)}function MRt(t,e,i,r){for(let s=0;s<i;s++)if(t[s]===TG){e[s]=r.dir;for(let n=s-1;n>=0&&t[n]===Mc;n--)e[n]=r.dir}}function ARt(t,e,i){if(i.hiLevel!==0&&i.swap.substr(0,1)!==i.swap.substr(1,2))for(let r=0;r<t.length;r++)e[r]===1&&(t[r]=$Rt(t[r]))}function RRt(t){const e=t.charCodeAt(0),i=vRt[e>>8];return i<xy?i:bRt[i-xy][255&e]}function zX(t,e){const i=t.split("");if(e){const r=[];VBe(i,r,e),f7=r}return i.reverse(),Ad.reverse(),i.join("")}function PRt(t,e,i){for(let r=0;r<e;r++)if(t[r]===i)return r;return-1}function GBe(t){for(let e=0;e<Nbe.length;e++)if(t>=Nbe[e]&&t<=uRt[e])return!0;return!1}function Lbe(t,e,i,r){for(;e*i<r&&zF(t[e]);)e+=i;return!!(e*i<r&&GBe(t[e]))}function ORt(t,e,i,r){for(;e*i<r&&zF(t[e]);)e+=i;let s=" ";if(!(e*i<r))return!1;s=t[e];for(let n=0;n<lI.length;n++)if(lI[n]===s)return!0;return!1}function Dbe(t,e,i,r){if(r.hiLevel<t)return;if(t===1&&r.dir===QN&&!r.hasUbatB)return e.reverse(),void Ad.reverse();const s=e.length;let n,o,a,l,c,u=0;for(;u<s;){if(i[u]>=t){for(n=u+1;n<s&&i[n]>=t;)n++;for(o=u,a=n-1;o<a;o++,a--)l=e[o],e[o]=e[a],e[a]=l,c=Ad[o],Ad[o]=Ad[a],Ad[a]=c;u=n}u++}}function IRt(t,e,i,r,s){const n=e[r];return{UBAT_L:()=>(s.lastArabic=!1,$),UBAT_R:()=>(s.lastArabic=!1,Pe),UBAT_ON:()=>A,UBAT_AN:()=>_o,UBAT_EN:()=>s.lastArabic?_o:Yt,UBAT_AL:()=>(s.lastArabic=!0,s.hasUbatAl=!0,Pe),UBAT_WS:()=>A,UBAT_CS:()=>{let o,a;return r<1||r+1>=e.length||(o=i[r-1])!==Yt&&o!==_o||(a=e[r+1])!==Yt&&a!==_o?A:(s.lastArabic&&(a=_o),a===o?a:A)},UBAT_ES:()=>(r>0?i[r-1]:Oy)===Yt&&r+1<e.length&&e[r+1]===Yt?Yt:A,UBAT_ET:()=>{if(r>0&&i[r-1]===Yt)return Yt;if(s.lastArabic)return A;let o=r+1;const a=e.length;for(;o<a&&e[o]===si;)o++;return o<a&&e[o]===Yt?Yt:A},UBAT_NSM:()=>{if(s.inFormat==="VLTR"){const o=e.length;let a=r+1;for(;a<o&&e[a]===se;)a++;if(a<o){const l=t[r].charCodeAt(0),c=l>=1425&&l<=2303||l===64286,u=e[a];if(c&&(u===Pe||u===P))return Pe}}return r<1||e[r-1]===Oy?A:i[r-1]},UBAT_B:()=>(s.lastArabic=!0,s.hasUbatB=!0,s.dir),UBAT_S:()=>(s.hasUbatS=!0,A),UBAT_LRE:()=>(s.lastArabic=!1,A),UBAT_RLE:()=>(s.lastArabic=!1,A),UBAT_LRO:()=>(s.lastArabic=!1,A),UBAT_RLO:()=>(s.lastArabic=!1,A),UBAT_PDF:()=>(s.lastArabic=!1,A),UBAT_BN:()=>A}[_Rt[n]]()}function $Rt(t){let e,i=0,r=Y5.length-1;for(;i<=r;)if(e=Math.floor((i+r)/2),t<Y5[e][0])r=e-1;else{if(!(t>Y5[e][0]))return Y5[e][1];i=e+1}return t}function NRt(t){for(let e=0;e<$be.length;e++)if($be[e]===t)return!0;return!1}function LRt(t){for(let e=0;e<G8.length;e++)if(t===G8[e])return aRt[e];return t}function VX(t,e){for(let i=0;i<G8.length;i++)if(t===G8[i])return e[i];return t}function zF(t){return t>="ً"&&t<="ٕ"}function Fbe(t){return t==="L"?"LTR":t==="R"?"RTL":t==="C"?"CLR":t==="D"?"CRL":""}function DRt(t,e,i,r){for(;e*i<r&&zF(t[e]);)e+=i;return e*i<r&&(t[e]=" ",!0)}function FRt(t,e){for(let i=0;i<lI.length;i++)if(t===lI[i])return e[i];return t}function kRt(t,e,i){Ad=[],f7=[];for(let r=0;r<i;r++)t[r]=r,e[r]=r,Ad[r]=r}function URt(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[t[i]]=i;return e}function jBe(t,e,i,r){for(let s=0;s<t.length;s++)(t[s]>e||!i&&t[s]===e)&&(t[s]+=r)}let Ad=[],H8=[],f7=[];const BRt={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},zRt=5,VRt=6,RM=0,QN=1,kbe=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,GRt=/[\u0591-\u06ff\ufb1d-\ufefc]/,GX=new wRt;function jRt(t){if(t==null)return["",!1];if(!GX.hasBidiChar(t))return[t,!1];let e;return e=GX.checkContextual(t)==="rtl"?"IDNNN":"ICNNN",[GX.bidiTransform(t,e,"VLYSN"),!0]}let i$=class{constructor(){this.setIdentity()}getAngle(){return(this.rz==null||this.rz===0&&this.rzCos!==1&&this.rzSin!==0)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,i){this.tx=e,this.ty=i}setTranslateZ(e){this.tz=e}setRotateCS(e,i){this.rz=void 0,this.rzCos=e,this.rzSin=i}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}};const Rde="arial-unicode-ms",Ube="woff2",Bbe=new Map,HBe=new Set;let HRt=class{constructor(e,i){this.fontFace=e,this.promise=i}};async function qRt(t){const e=ZRt(t),i=XRt(t),r=Bbe.get(e);if(r)return r.promise;const s=new FontFace(t.family,`url('${gr.fontsUrl}/woff2/${i}.${Ube}') format('${Ube}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(s)&&s.status==="loading")return s.loaded;const o=s.load().then(()=>(n.add(s),s));return Bbe.set(e,new HRt(s,o)),HBe.add(s),o}function WRt(t){return HBe.has(t)}function YRt(t){if(!t)return Rde;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function XRt(t){const e=qBe(t)+WBe(t);return YRt(t.family)+(e.length>0?e:"-regular")}function ZRt(t){const e=qBe(t)+WBe(t);return(t.family||Rde)+(e.length>0?e:"-regular")}function qBe(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function WBe(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let Ro=class{static fromOptimized(e,i,r=!1,s=!1,n=1){return new xse().initialize(e,i,r,s,n)}static fromJSON(e,i=!1,r=!1){const[s,n]=zbe(e);return new Sse().initialize(s,n,i,r,1)}static fromOptimizedCIM(e,i,r=!1,s=!1,n=1){return new Vbe().initialize(e,i,r,s,n)}static fromJSONCIM(e,i=!1,r=!1,s=1){const[n,o]=zbe(e);return new Gbe().initialize(n,o,i,r,s)}static fromFeatureSetReader(e){const i=e.readGeometryForDisplay(),r=e.geometryType;return i&&r?this.fromOptimized(i,r):null}static fromFeatureSetReaderCIM(e){const i=e.readGeometryForDisplay(),r=e.geometryType;return i&&r?this.fromOptimizedCIM(i,r):null}static createEmptyOptimized(e,i=!1,r=!1,s=1){return new xse().initialize(new Ih,e,i,r,s)}static createEmptyJSON(e,i=!1,r=!1){return new Sse().initialize([],e,i,r,1)}static createEmptyOptimizedCIM(e,i=!1,r=!1,s=1){return new Vbe().initialize(new Ih,e,i,r,s)}static createEmptyJSONCIM(e,i=!1,r=!1,s=1){return new Gbe().initialize([],e,i,r,s)}asJSON(){const e=Nk(this);return this.geometryType==="esriGeometryEnvelope"?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:this.geometryType==="esriGeometryMultipoint"?{points:e.flat()}:this.geometryType==="esriGeometryPoint"?{x:e[0][0][0],y:e[0][0][1]}:this.geometryType==="esriGeometryPolygon"?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,i,r=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,i=this.y;const s=e,n=i;for(;this.nextPoint();)r+=(e-this.x)*(i+this.y),e=this.x,i=this.y;return r+=(e-s)*(i+n),-.5*r}invertY(){this.yFactor*=-1}},xse=class YBe extends Ro{constructor(){super(...arguments),this._end=-1}initialize(e,i,r,s,n){return this.hasZ=r,this.hasM=s,this.geometryType=i,this._stride=2+Number(r)+Number(s),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=n,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){const i=this._pathOffset+e*this._stride;return i>=0&&i<this._end&&(this._pointOffset=i,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1)&&(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,!0)}prevPath(){return!(this.pathIndex<=0)&&(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,!0)}pathLength(){const e=this._end,i=this._stride,r=this._geometry.coords;let s=0;for(let n=this._pathOffset+i;n<e;n+=i){const o=r[n-i],a=r[n-i+1],l=r[n]-o,c=r[n+1]-a;s+=Math.sqrt(l*l+c*c)}return s}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let i=0;i<this._stride;++i)this._geometry.coords.push(e[i]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,i){this._geometry.coords.push(e,i),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const i of e)for(let r=0;r<this._stride;++r)this._geometry.coords.push(i[r]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){const i=e.asOptimized();this._geometry.coords.push(...i.coords),this._geometry.lengths.push(...i.lengths)}asOptimized(){const e=this._geometry.clone();if(this.yFactor!==1)for(let i=1;i<e.coords.length;i+=this._stride)e.coords[i]*=this.yFactor;return this.geometryType==="esriGeometryPoint"&&(e.lengths.length=0),e}isClosed(){const e=this._geometry.coords,i=this._pathOffset,r=this._end-this._stride;for(let s=0;s<this._stride;s++)if(e[i+s]!==e[r+s])return!1;return!0}clone(){return new YBe().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((e,i)=>e+i)}get pathSize(){const{lengths:e}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>e.length-1?0:e[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){const e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}};function JRt(t){const e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e}function zbe(t){return zc(t)?[t.rings,"esriGeometryPolygon"]:Lm(t)?[t.paths,"esriGeometryPolyline"]:Z2(t)?[[t.points],"esriGeometryMultipoint"]:Nm(t)?[[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]],"esriGeometryEnvelope"]:AO(t)?[[[JRt(t)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}let Sse=class XBe extends Ro{initialize(e,i,r,s,n){return this._paths=e,this.geometryType=i,this.hasZ=r,this.hasM=s,this._pathIndex=this._pointIndex=-1,this.yFactor=n,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const e=this._currentPath.length,i=this._currentPath;let r=0;for(let s=1;s<e;s++){const n=i[s-1],o=i[s],a=n[0],l=n[1],c=o[0]-a,u=o[1]-l;r+=Math.sqrt(c*c+u*u)}return r}startPath(){this._paths.push([])}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,i){this._paths[this.totalSize-1].push([e,i])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){const i=Nk(e);for(const r of i)this.pushPath(r)}asOptimized(){const e=new Ih;if(this.geometryType==="esriGeometryPoint")e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const i of this._paths){for(const r of i)e.coords.push(r[0]),e.coords.push(r[1]*this.yFactor),this.hasZ&&e.coords.push(r[2]),this.hasM&&e.coords.push(r[this._mIndex]);e.lengths.push(i.length)}return e}isClosed(){const e=this._currentPath[0],i=this._currentPath[this._currentPath.length-1];for(let r=0;r<e.length;r++)if(e[r]!==i[r])return!1;return!0}clone(){return new XBe().initialize(ee(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(e=>e.length).reduce((e,i)=>e+i)}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}};const X5=4,Z5=1;let Vbe=class ZBe extends xse{initialize(e,i,r,s,n){return super.initialize(e,i,r,s,n),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map(o=>new Set)),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const e=new ZBe().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return e._controlPoints=this._controlPoints,e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}},Gbe=class JBe extends Sse{initialize(e,i,r,s,n){return super.initialize(e,i,r,s,n)}clone(){return new JBe().initialize(ee(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][X5]=Z5}getControlPoint(){return this._paths[this.pathIndex][this._pointIndex][X5]===Z5}setControlPointAt(e){this._paths[this.pathIndex][e][X5]=Z5}getControlPointAt(e){return this._paths[this.pathIndex][e][X5]===Z5}};const QRt=512;var Sm,ll;(function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"})(Sm||(Sm={}));let ql=class EG{constructor(e,i){this.x=e,this.y=i}clone(){return new EG(this.x,this.y)}equals(e,i){return e===this.x&&i===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,i){return this.x=e,this.y=i,this}normalize(){const e=this.x,i=this.y,r=Math.sqrt(e*e+i*i);return this.x/=r,this.y/=r,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,i){return this.x+=e,this.y+=i,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}assignSub(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}rotate(e,i){const r=this.x,s=this.y;return this.x=r*e-s*i,this.y=r*i+s*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,i=this.y;return Math.sqrt(e*e+i*i)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,i){const r=i.x-e.x,s=i.y-e.y;return Math.sqrt(r*r+s*s)}static add(e,i){return new EG(e.x+i.x,e.y+i.y)}static sub(e,i){return new EG(e.x-i.x,e.y-i.y)}},J5=class{constructor(e,i,r){this.ratio=e,this.x=i,this.y=r}},KRt=class{constructor(e,i,r,s=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=s,this._pixelMargin=n,this._tileSize=QRt*s,this._dz=e,this._yPos=i,this._xPos=r}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let i=this._pixelRatio*this._pixelMargin;i/=this._finalRatio;const r=e>>this._dz;i>r&&(i=r),this._margin=i,this._xmin=r*this._xPos-i,this._ymin=r*this._yPos-i,this._xmax=this._xmin+r+2*i,this._ymax=this._ymin+r+2*i}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,i){this._pushLine(),this._prevIsIn=this._isIn(e,i),this._moveTo(e,i,this._prevIsIn),this._prevPt=new ql(e,i),this._firstPt=new ql(e,i),this._dist=0}lineTo(e,i){const r=this._isIn(e,i),s=new ql(e,i),n=ql.distance(this._prevPt,s);let o,a,l,c,u,h,p,f;if(r)this._prevIsIn?this._lineTo(e,i,!0):(o=this._prevPt,a=s,l=this._intersect(a,o),this._start=this._dist+n*(1-this._r),this._lineTo(l.x,l.y,!0),this._lineTo(a.x,a.y,!0));else if(this._prevIsIn)a=this._prevPt,o=s,l=this._intersect(a,o),this._lineTo(l.x,l.y,!0),this._lineTo(o.x,o.y,!1);else{const g=this._prevPt,y=s;if(g.x<=this._xmin&&y.x<=this._xmin||g.x>=this._xmax&&y.x>=this._xmax||g.y<=this._ymin&&y.y<=this._ymin||g.y>=this._ymax&&y.y>=this._ymax)this._lineTo(y.x,y.y,!1);else{const v=[];if((g.x<this._xmin&&y.x>this._xmin||g.x>this._xmin&&y.x<this._xmin)&&(c=(this._xmin-g.x)/(y.x-g.x),f=g.y+c*(y.y-g.y),f<=this._ymin?h=!1:f>=this._ymax?h=!0:v.push(new J5(c,this._xmin,f))),(g.x<this._xmax&&y.x>this._xmax||g.x>this._xmax&&y.x<this._xmax)&&(c=(this._xmax-g.x)/(y.x-g.x),f=g.y+c*(y.y-g.y),f<=this._ymin?h=!1:f>=this._ymax?h=!0:v.push(new J5(c,this._xmax,f))),(g.y<this._ymin&&y.y>this._ymin||g.y>this._ymin&&y.y<this._ymin)&&(c=(this._ymin-g.y)/(y.y-g.y),p=g.x+c*(y.x-g.x),p<=this._xmin?u=!1:p>=this._xmax?u=!0:v.push(new J5(c,p,this._ymin))),(g.y<this._ymax&&y.y>this._ymax||g.y>this._ymax&&y.y<this._ymax)&&(c=(this._ymax-g.y)/(y.y-g.y),p=g.x+c*(y.x-g.x),p<=this._xmin?u=!1:p>=this._xmax?u=!0:v.push(new J5(c,p,this._ymax))),v.length===0)u?h?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):h?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(v.length>1&&v[0].ratio>v[1].ratio)this._start=this._dist+n*v[1].ratio,this._lineTo(v[1].x,v[1].y,!0),this._lineTo(v[0].x,v[0].y,!0);else{this._start=this._dist+n*v[0].ratio;for(let b=0;b<v.length;b++)this._lineTo(v[b].x,v[b].y,!0)}this._lineTo(y.x,y.y,!1)}}this._dist+=n,this._prevIsIn=r,this._prevPt=s}close(){if(this._line.length>2){const e=this._firstPt,i=this._prevPt;e.x===i.x&&e.y===i.y||this.lineTo(e.x,e.y);const r=this._line;let s=r.length;for(;s>=4&&(r[0].x===r[1].x&&r[0].x===r[s-2].x||r[0].y===r[1].y&&r[0].y===r[s-2].y);)r.pop(),r[0].x=r[s-2].x,r[0].y=r[s-2].y,--s}}result(e=!0){return this._pushLine(),this._lines.length===0?null:(this._type===Sm.Polygon&&e&&ePt.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==Sm.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,i=e.length;if(i===0)return null;const r=[];for(let s=0;s<i;s++)r.push({line:e[s],start:this._starts[s]||0});return r}_isIn(e,i){return e>=this._xmin&&e<=this._xmax&&i>=this._ymin&&i<=this._ymax}_intersect(e,i){let r,s,n;if(i.x>=this._xmin&&i.x<=this._xmax)s=i.y<=this._ymin?this._ymin:this._ymax,n=(s-e.y)/(i.y-e.y),r=e.x+n*(i.x-e.x);else if(i.y>=this._ymin&&i.y<=this._ymax)r=i.x<=this._xmin?this._xmin:this._xmax,n=(r-e.x)/(i.x-e.x),s=e.y+n*(i.y-e.y);else{s=i.y<=this._ymin?this._ymin:this._ymax,r=i.x<=this._xmin?this._xmin:this._xmax;const o=(r-e.x)/(i.x-e.x),a=(s-e.y)/(i.y-e.y);o<a?(n=o,s=e.y+o*(i.y-e.y)):(n=a,r=e.x+a*(i.x-e.x))}return this._r=n,new ql(r,s)}_pushLine(){this._line&&(this._type===Sm.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Sm.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Sm.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,i,r){this._type!==Sm.Polygon?r&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new ql(e,i))):(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new ql(e,i)),this._isH=!1,this._isV=!1)}_lineTo(e,i,r){let s,n;if(this._type!==Sm.Polygon)if(r){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(s=this._line[this._line.length-1],s.equals(e,i)))return;this._line.push(new ql(e,i))}else this._line&&this._line.length>0&&this._pushLine();else if(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){s=this._line[this._line.length-1];const o=s.x===e,a=s.y===i;if(o&&a)return;this._isH&&o||this._isV&&a?(s.x=e,s.y=i,n=this._line[this._line.length-2],n.x===e&&n.y===i?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(n=this._line[this._line.length-2],this._isH=n.x===e,this._isV=n.y===i)):(this._isH=n.x===e,this._isV=n.y===i)):(this._line.push(new ql(e,i)),this._isH=o,this._isV=a)}else this._line.push(new ql(e,i))}},Evi=class{setExtent(e){this._ratio=e===4096?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,i){this._line&&this._lines.push(this._line),this._line=[];const r=this._ratio;this._line.push(new ql(e*r,i*r))}lineTo(e,i){const r=this._ratio;this._line.push(new ql(e*r,i*r))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),this._lines.length===0?null:this._lines}};(function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"})(ll||(ll={}));let ePt=class $b{static simplify(e,i,r){if(!r)return;const s=-i,n=e+i,o=-i,a=e+i,l=[],c=[],u=r.length;for(let p=0;p<u;++p){const f=r[p];if(!f||f.length<2)continue;let g,y=f[0];const v=f.length;for(let b=1;b<v;++b)g=f[b],y.x===g.x&&(y.x<=s&&(y.y>g.y?(l.push(p),l.push(b),l.push(ll.sideLeft),l.push(-1)):(c.push(p),c.push(b),c.push(ll.sideLeft),c.push(-1))),y.x>=n&&(y.y<g.y?(l.push(p),l.push(b),l.push(ll.sideRight),l.push(-1)):(c.push(p),c.push(b),c.push(ll.sideRight),c.push(-1)))),y.y===g.y&&(y.y<=o&&(y.x<g.x?(l.push(p),l.push(b),l.push(ll.sideTop),l.push(-1)):(c.push(p),c.push(b),c.push(ll.sideTop),c.push(-1))),y.y>=a&&(y.x>g.x?(l.push(p),l.push(b),l.push(ll.sideBottom),l.push(-1)):(c.push(p),c.push(b),c.push(ll.sideBottom),c.push(-1)))),y=g}if(l.length===0||c.length===0)return;$b.fillParent(r,c,l),$b.fillParent(r,l,c);const h=[];$b.calcDeltas(h,c,l),$b.calcDeltas(h,l,c),$b.addDeltas(h,r)}static fillParent(e,i,r){const s=r.length,n=i.length;for(let o=0;o<n;o+=4){const a=i[o],l=i[o+1],c=i[o+2],u=e[a][l-1],h=e[a][l];let p=8092,f=-1;for(let g=0;g<s;g+=4){if(r[g+2]!==c)continue;const y=r[g],v=r[g+1],b=e[y][v-1],w=e[y][v];switch(c){case ll.sideLeft:case ll.sideRight:if(Q5(u.y,b.y,w.y)&&Q5(h.y,b.y,w.y)){const x=Math.abs(w.y-b.y);x<p&&(p=x,f=g)}break;case ll.sideTop:case ll.sideBottom:if(Q5(u.x,b.x,w.x)&&Q5(h.x,b.x,w.x)){const x=Math.abs(w.x-b.x);x<p&&(p=x,f=g)}}}i[o+3]=f}}static calcDeltas(e,i,r){const s=i.length;for(let n=0;n<s;n+=4){const o=[],a=$b.calcDelta(n,i,r,o);e.push(i[n]),e.push(i[n+1]),e.push(i[n+2]),e.push(a)}}static calcDelta(e,i,r,s){const n=i[e+3];if(n===-1)return 0;const o=s.length;return o>1&&s[o-2]===n?0:(s.push(n),$b.calcDelta(n,r,i,s)+1)}static addDeltas(e,i){const r=e.length;let s=0;for(let n=0;n<r;n+=4){const o=e[n+3];o>s&&(s=o)}for(let n=0;n<r;n+=4){const o=i[e[n]],a=e[n+1],l=s-e[n+3];switch(e[n+2]){case ll.sideLeft:o[a-1].x-=l,o[a].x-=l,a===1&&(o[o.length-1].x-=l),a===o.length-1&&(o[0].x-=l);break;case ll.sideRight:o[a-1].x+=l,o[a].x+=l,a===1&&(o[o.length-1].x+=l),a===o.length-1&&(o[0].x+=l);break;case ll.sideTop:o[a-1].y-=l,o[a].y-=l,a===1&&(o[o.length-1].y-=l),a===o.length-1&&(o[0].y-=l);break;case ll.sideBottom:o[a-1].y+=l,o[a].y+=l,a===1&&(o[o.length-1].y+=l),a===o.length-1&&(o[0].y+=l)}}}};const Q5=(t,e,i)=>t>=e&&t<=i||t>=i&&t<=e,tPt=512;let o_,iPt=class{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}};function m7(t,e){o_||(o_=new KRt(0,0,0,1));const i=t.geometryType==="esriGeometryPolygon",r=i?Sm.Polygon:Sm.LineString,s=i?3:2;let n,o;for(o_.reset(r),o_.setPixelMargin(e+1),o_.setExtent(tPt);t.nextPath();)if(!(t.pathSize<s)){for(t.nextPoint(),n=t.x,o=-t.y,o_.moveTo(n,o);t.nextPoint();)n=t.x,o=-t.y,o_.lineTo(n,o);i&&o_.close()}const a=o_.result(!1);if(a){const l=Ro.createEmptyOptimizedCIM(t.geometryType);for(const c of a){l.startPath();for(const u of c)l.pushXY(u.x,-u.y)}return l.reset(),l}return null}let rPt=class{applyColorSubstituition(e,i){if(!i)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:s}=e,n=this._rasterizationCanvas,o=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=s,o.drawImage(e,0,0,r,s));const a=o.getImageData(0,0,r,s).data;if(i){for(const c of i)if(c&&c.oldColor&&c.oldColor.length===4&&c.newColor&&c.newColor.length===4){const[u,h,p,f]=c.oldColor,[g,y,v,b]=c.newColor;if(u===g&&h===y&&p===v&&f===b)continue;for(let w=0;w<a.length;w+=4)u===a[w]&&h===a[w+1]&&p===a[w+2]&&f===a[w+3]&&(a[w]=g,a[w+1]=y,a[w+2]=v,a[w+3]=b)}}const l=new ImageData(a,r,s);return o.putImageData(l,0,0),n}tintImageData(e,i){if(!i||i.length<4)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:s}=e,n=this._rasterizationCanvas,o=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=s,o.drawImage(e,0,0,r,s));const a=o.getImageData(0,0,r,s),l=new Uint8Array(a.data),c=[i[0]/255,i[1]/255,i[2]/255,i[3]/255];for(let h=0;h<l.length;h+=4)l[h]*=c[0],l[h+1]*=c[1],l[h+2]*=c[2],l[h+3]*=c[3];const u=new ImageData(new Uint8ClampedArray(l.buffer),r,s);return o.putImageData(u,0,0),n}},QBe=class KN{static local(){return KN.instance===null&&(KN.instance=new KN),KN.instance}execute(e,i,r,s,n){return new sPt(e,i,r)}};QBe.instance=null;let sPt=class{constructor(e,i,r){this._inputGeometries=e,this._angleTolerance=i.angleTolerance!==void 0?i.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();for(;e;){if(e.geometryType==="esriGeometryPolygon")this._isClosed=!0;else if(e.geometryType==="esriGeometryPolyline")this._isClosed=!1;else{if(e.geometryType!=="esriGeometryEnvelope"){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const i=e.x,r=e.y;let s=i,n=r,o=e.pathSize,a=0,l=0,c=0,u=0,h=0,p=0;this._isClosed&&++o;for(let f=1;e.nextPoint()||f<o;++f){let g,y;this._isClosed&&f===o-1?(g=i,y=r):(g=e.x,y=e.y);const v=g-s,b=y-n,w=Math.sqrt(v*v+b*b);f>1&&w>0&&c>0&&(a*v+l*b)/w/c<=this._maxCosAngle&&e.setControlPointAt(f-1),f===1&&(u=v,h=b,p=w),w>0&&(s=g,n=y,a=v,l=b,c=w)}this._isClosed&&c>0&&p>0&&(a*u+l*h)/p/c<=this._maxCosAngle&&e.setControlPointAt(0)}}};function jX(t,e){t[4]=e}let S4=class{constructor(e,i=!0,r=!0,s=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!i&&e.geometryType==="esriGeometryPolygon"||!r&&e.geometryType==="esriGeometryPolyline"?null:e,this.geomUnitsPerPoint=s,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new i$}next(){if(!this.geometryCursor)return null;const e=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&e||(this.geometryCursor=null),e}processMultiPath(e){for(;this.iteratePath||e.pathIndex<e.totalSize-1;){this.iteratePath||e.nextPath(),this.iterateMultiPath=!0;const i=this.processPath(e);if(i)return i}return this.iterateMultiPath=!1,null}},g7=class{constructor(e,i,r,s=0){this.isClosed=!1,this._tileKey=null,this.inputGeometries=e,this.acceptPolygon=i,this.acceptPolyline=r,this.geomUnitsPerPoint=s,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&e.geometryType==="esriGeometryPolygon"||e.geometryType==="esriGeometryEnvelope",this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null;this._tileKey&&this.isClippingRequired(this.multiPathCursor)&&(this.multiPathCursor.reset(),this.multiPathCursor=m7(this.multiPathCursor,256))}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}isClippingRequired(e){return!1}};var Tse,Ese,jbe,Hbe,Qy,qbe,Cse,Mse,Ase,Wbe,Ybe,Xbe,Zbe,Jbe,Qbe,Rse,Pse,Kbe,ewe,qP,or,w2,twe,iwe,xv,rwe,swe,eP,Ose,nwe,owe,awe,lwe,cwe,uwe,tf,Gl,hwe,dwe,Ky,pwe,fwe,mwe,gwe,ym,PD,x2,tP,ywe,_we,vwe,bwe,wwe,xwe,Swe,q8,iP,Twe,Ise,Ewe,Cwe;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(Tse||(Tse={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(Ese||(Ese={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(jbe||(jbe={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(Hbe||(Hbe={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(Qy||(Qy={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(qbe||(qbe={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(Cse||(Cse={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(Mse||(Mse={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(Ase||(Ase={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(Wbe||(Wbe={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(Ybe||(Ybe={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(Xbe||(Xbe={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(Zbe||(Zbe={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(Jbe||(Jbe={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(Qbe||(Qbe={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(Rse||(Rse={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(Pse||(Pse={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(Kbe||(Kbe={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(ewe||(ewe={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(qP||(qP={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees",t.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks"}(or||(or={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(w2||(w2={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(twe||(twe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(iwe||(iwe={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(xv||(xv={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(rwe||(rwe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(swe||(swe={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(eP||(eP={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(Ose||(Ose={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(nwe||(nwe={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(owe||(owe={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(awe||(awe={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(lwe||(lwe={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(cwe||(cwe={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(uwe||(uwe={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(tf||(tf={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(Gl||(Gl={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(hwe||(hwe={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(dwe||(dwe={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(Ky||(Ky={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(pwe||(pwe={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(fwe||(fwe={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(mwe||(mwe={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(gwe||(gwe={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(ym||(ym={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(PD||(PD={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(x2||(x2={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(tP||(tP={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(ywe||(ywe={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(_we||(_we={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(vwe||(vwe={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(bwe||(bwe={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(wwe||(wwe={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(xwe||(xwe={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(Swe||(Swe={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(q8||(q8={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(iP||(iP={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(Twe||(Twe={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(Ise||(Ise={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(Ewe||(Ewe={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(Cwe||(Cwe={}));const VF=.03;let h1=class{constructor(e=0,i=!1){}isEmpty(e){if(!e.nextPoint())return!0;let i,r,s,n;for(i=e.x,r=e.y;e.nextPoint();i=r,r=n)if(s=e.x,n=e.y,s!==i||n!==r)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const i=Math.sqrt(e[0]*e[0]+e[1]*e[1]);i!==0&&(e[0]/=i,e[1]/=i)}getLength(e,i,r,s){const n=r-e,o=s-i;return Math.sqrt(n*n+o*o)}getSegLength(e){const[[i,r],[s,n]]=e;return this.getLength(i,r,s,n)}getCoord2D(e,i,r,s,n){return[e+(r-e)*n,i+(s-i)*n]}getSegCoord2D(e,i){const[[r,s],[n,o]]=e;return this.getCoord2D(r,s,n,o,i)}getAngle(e,i,r,s,n){const o=r-e,a=s-i;return Math.atan2(a,o)}getAngleCS(e,i,r,s,n){const o=r-e,a=s-i,l=Math.sqrt(o*o+a*a);return l>0?[o/l,a/l]:[1,0]}getSegAngleCS(e,i){const[[r,s],[n,o]]=e;return this.getAngleCS(r,s,n,o,i)}cut(e,i,r,s,n,o){return[n<=0?[e,i]:this.getCoord2D(e,i,r,s,n),o>=1?[r,s]:this.getCoord2D(e,i,r,s,o)]}getSubCurve(e,i,r){const s=Ro.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(s,e,i,r)?s:null}appendSubCurve(e,i,r,s){e.startPath(),i.seekPathStart();let n=0,o=!0;if(!i.nextPoint())return!1;let a=i.x,l=i.y;for(;i.nextPoint();){const c=this.getLength(a,l,i.x,i.y);if(c!==0){if(o){if(n+c>r){const u=(r-n)/c;let h=1,p=!1;n+c>=s&&(h=(s-n)/c,p=!0);const f=this.cut(a,l,i.x,i.y,u,h);if(f&&e.pushPoints(f),p)break;o=!1}}else{if(n+c>s){const u=this.cut(a,l,i.x,i.y,0,(s-n)/c);u&&e.pushPoint(u[1]);break}e.pushXY(i.x,i.y)}n+=c,a=i.x,l=i.y}else a=i.x,l=i.y}return!0}getCIMPointAlong(e,i){if(!e.nextPoint())return null;let r,s,n,o,a=0;for(r=e.x,s=e.y;e.nextPoint();r=n,s=o){n=e.x,o=e.y;const l=this.getLength(r,s,n,o);if(l!==0){if(a+l>i){const c=(i-a)/l;return this.getCoord2D(r,s,n,o,c)}a+=l}}return null}offset(e,i,r,s,n){if(!e||e.length<2)return null;let o=0,a=e[o++],l=o;for(;o<e.length;){const p=e[o];p[0]===a[0]&&p[1]===a[1]||(o!==l&&(e[l]=e[o]),a=e[l++]),o++}const c=e[0][0]===e[l-1][0]&&e[0][1]===e[l-1][1];if(c&&--l,l<(c?3:2))return null;const u=[];a=c?e[l-1]:null;let h=e[0];for(let p=0;p<l;p++){const f=p===l-1?c?e[0]:null:e[p+1];if(a)if(f){const g=[f[0]-h[0],f[1]-h[1]];this.normalize(g);const y=[h[0]-a[0],h[1]-a[1]];this.normalize(y);const v=y[0]*g[1]-y[1]*g[0],b=y[0]*g[0]+y[1]*g[1];if(v===0&&b===1){h=f;continue}if(v>=0==i<=0){if(b<1){const w=[g[0]-y[0],g[1]-y[1]];this.normalize(w);const x=Math.sqrt((1+b)/2);if(x>1/s){const S=-Math.abs(i)/x;u.push([h[0]-w[0]*S,h[1]-w[1]*S])}}}else switch(r){case xv.Mitered:{const w=Math.sqrt((1+b)/2);if(w>0&&1/w<s){const x=[g[0]-y[0],g[1]-y[1]];this.normalize(x);const S=Math.abs(i)/w;u.push([h[0]-x[0]*S,h[1]-x[1]*S]);break}}case xv.Bevelled:u.push([h[0]+y[1]*i,h[1]-y[0]*i]),u.push([h[0]+g[1]*i,h[1]-g[0]*i]);break;case xv.Rounded:if(b<1){u.push([h[0]+y[1]*i,h[1]-y[0]*i]);const w=Math.floor(2.5*(1-b));if(w>0){const x=1/w;let S=x;for(let E=1;E<w;E++,S+=x){const C=[y[1]*(1-S)+g[1]*S,-y[0]*(1-S)-g[0]*S];this.normalize(C),u.push([h[0]+C[0]*i,h[1]+C[1]*i])}}u.push([h[0]+g[1]*i,h[1]-g[0]*i])}break;case xv.Square:default:if(v<0)u.push([h[0]+(y[1]+y[0])*i,h[1]+(y[1]-y[0])*i]),u.push([h[0]+(g[1]-g[0])*i,h[1]-(g[0]+g[1])*i]);else{const w=Math.sqrt((1+Math.abs(b))/2),x=[g[0]-y[0],g[1]-y[1]];this.normalize(x);const S=i/w;u.push([h[0]-x[0]*S,h[1]-x[1]*S])}}}else{const g=[h[0]-a[0],h[1]-a[1]];this.normalize(g),u.push([h[0]+g[1]*i,h[1]-g[0]*i])}else{const g=[f[0]-h[0],f[1]-h[1]];this.normalize(g),u.push([h[0]+g[1]*i,h[1]-g[0]*i])}a=h,h=f}return u.length<(c?3:2)?null:(c&&u.push([u[0][0],u[0][1]]),u)}};const HX=1.7320508075688772,nPt=5,oPt=qP.OpenEnded;let KBe=class eL{static local(){return eL.instance===null&&(eL.instance=new eL),eL.instance}execute(e,i,r,s,n){return new aPt(e,i,r)}};KBe.instance=null;let aPt=class extends g7{constructor(e,i,r){super(e,!1,!0),this._curveHelper=new h1,this._width=(i.width!==void 0?i.width:nPt)*r,this._arrowType=i.geometricEffectArrowType!==void 0?i.geometricEffectArrowType:i.arrowType!==void 0?i.arrowType:oPt,this._offsetFlattenError=VF*r}processPath(e){const i=Ro.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case qP.OpenEnded:default:this._constructSimpleArrow(i,e,!0);break;case qP.Block:this._constructSimpleArrow(i,e,!1);break;case qP.Crossed:this._constructCrossedArrow(i,e)}return i}_constructSimpleArrow(e,i,r){const s=i.pathLength();let n=this._width;s<2*n&&(n=s/2);const o=this._curveHelper.getSubCurve(i,0,s-n);if(!o||!o.nextPath())return;o.seekPathStart();const a=n/2;if(this._curveHelper.isEmpty(o))return;const l=Ow(o),c=this._constructOffset(l,-a);if(!c)return;const u=this._constructOffset(l,a);if(!u)return;const h=this._constructArrowBasePoint(c,-a/2);if(!h)return;const p=this._constructArrowBasePoint(u,a/2);if(!p)return;i.seekInPath(i.pathSize-1);const f=[i.x,i.y];e.pushPath(u),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(p),e.nextPoint(),e.setControlPoint(),e.pushPoint(f),e.nextPoint(),e.setControlPoint(),e.pushPoint(h),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),r||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(u[0])),e.reset()}_constructCrossedArrow(e,i){const r=i.pathLength();let s=this._width;r<s*(1+HX+1)&&(s=r/(1+HX+1)),i.seekPathStart();const n=this._curveHelper.getSubCurve(i,0,r-s*(1+HX));if(!n)return;n.nextPath();const o=s/2;if(this._curveHelper.isEmpty(n))return;const a=Ow(n),l=this._constructOffset(a,o);if(!l)return;const c=this._constructOffset(a,-o);if(!c)return;const u=this._curveHelper.getSubCurve(i,0,r-s);if(!u||(u.nextPath(),this._curveHelper.isEmpty(u)))return;const h=Ow(u),p=this._constructOffset(h,o);if(!p)return;const f=this._constructOffset(h,-o);if(!f)return;const g=p[p.length-1],y=this._constructArrowBasePoint(p,o/2);if(!y)return;const v=f[f.length-1],b=this._constructArrowBasePoint(f,-o/2);if(!b)return;i.seekInPath(i.pathSize-1);const w=[i.x,i.y];e.pushPath(l),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(v),e.nextPoint(),e.setControlPoint(),e.pushPoint(b),e.nextPoint(),e.setControlPoint(),e.pushPoint(w),e.nextPoint(),e.setControlPoint(),e.pushPoint(y),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,i){return this._curveHelper.offset(e,i,xv.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(e,i){if(!e||e.length<2)return null;const r=e[e.length-2],s=e[e.length-1],n=[s[0]-r[0],s[1]-r[1]];return this._curveHelper.normalize(n),[s[0]+n[1]*i,s[1]-n[0]*i]}},eze=class tL{static local(){return tL.instance===null&&(tL.instance=new tL),tL.instance}execute(e,i,r,s,n,o){return new lPt(e,i,r,s,n,o)}};eze.instance=null;let lPt=class{constructor(e,i,r,s,n,o){this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._curveHelper=new h1,this._size=(i.size!==void 0?i.size:1)*r,this._maxInflateSize=o*r,this._offsetFlattenError=VF*r}next(){let e;for(;e=this._inputGeometries.next();){if(this._size===0)return e;if(e.geometryType==="esriGeometryEnvelope"){if(this._size>0){const n=Ro.createEmptyOptimizedCIM(e.geometryType),o=Nk(e)[0],a=this._curveHelper.offset(o,this._size,xv.Rounded,4,this._offsetFlattenError);if(a)return n.pushPath(a),n}else if(this._size<0){const n=e.asJSON();if(Math.min(n.xmax-n.xmin,n.ymax-n.ymin)+2*this._size>0)return Ro.fromJSONCIM({xmin:n.xmin-this._size,xmax:n.xmax+this._size,ymin:n.ymin-this._size,ymax:n.ymax+this._size})}}const i=this._geometryEngine;if(i==null)return null;const r=this._tileKey?m7(e,this._maxInflateSize):e;if(!r)continue;const s=i.buffer(Je.WebMercator,r.asJSON(),this._size,1);return s?Ro.fromJSONCIM(s):null}return null}},tze=class iL{static local(){return iL.instance===null&&(iL.instance=new iL),iL.instance}execute(e,i,r,s,n){return new cPt(e,i,r)}};tze.instance=null;let cPt=class{constructor(e,i,r){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=r,this._rule=i.rule??or.FullGeometry,this._defaultSize=this._defaultPointSize*r}next(){let e;for(;e=this._inputGeometries.next();){const i=this._processGeom(Nk(e));if(i?.length)return Ro.fromJSONCIM({paths:i})}return null}_clone(e){return[e[0],e[1]]}_mid(e,i){return[(e[0]+i[0])/2,(e[1]+i[1])/2]}_mix(e,i,r,s){return[e[0]*i+r[0]*s,e[1]*i+r[1]*s]}_add(e,i){return[e[0]+i[0],e[1]+i[1]]}_add2(e,i,r){return[e[0]+i,e[1]+r]}_sub(e,i){return[e[0]-i[0],e[1]-i[1]]}_dist(e,i){return Math.sqrt((e[0]-i[0])*(e[0]-i[0])+(e[1]-i[1])*(e[1]-i[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,i=1){const r=i/this._norm(e);e[0]*=r,e[1]*=r}_leftPerpendicular(e){const i=-e[1],r=e[0];e[0]=i,e[1]=r}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const i=e[1],r=-e[0];e[0]=i,e[1]=r}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,i){return e[0]*i[0]+e[1]*i[1]}_crossProduct(e,i){return e[0]*i[1]-e[1]*i[0]}_rotateDirect(e,i,r){const s=e[0]*i-e[1]*r,n=e[0]*r+e[1]*i;e[0]=s,e[1]=n}_makeCtrlPt(e){const i=[e[0],e[1]];return jX(i,1),i}_addAngledTicks(e,i,r,s){const n=this._sub(r,i);this._normalize(n);const o=this._crossProduct(n,this._sub(s,i));let a;a=o>0?this._rightPerp(n):this._leftPerp(n);const l=Math.abs(o)/2,c=[];c.push([i[0]+(a[0]-n[0])*l,i[1]+(a[1]-n[1])*l]),c.push(i),c.push(r),c.push([r[0]+(a[0]+n[0])*l,r[1]+(a[1]+n[1])*l]),e.push(c)}_addBezier2(e,i,r,s,n){if(n--==0)return void e.push(s);const o=this._mid(i,r),a=this._mid(r,s),l=this._mid(o,a);this._addBezier2(e,i,o,l,n),this._addBezier2(e,l,a,s,n)}_addBezier3(e,i,r,s,n,o){if(o--==0)return void e.push(n);const a=this._mid(i,r),l=this._mid(r,s),c=this._mid(s,n),u=this._mid(a,l),h=this._mid(l,c),p=this._mid(u,h);this._addBezier3(e,i,a,u,p,o),this._addBezier3(e,p,h,c,n,o)}_add90DegArc(e,i,r,s,n){const o=n??this._crossProduct(this._sub(r,i),this._sub(s,i))>0,a=this._mid(i,r),l=this._sub(a,i);o?this._leftPerpendicular(l):this._rightPerpendicular(l),a[0]+=l[0],a[1]+=l[1],this._addBezier3(e,i,this._mix(i,.33333,a,.66667),this._mix(r,.33333,a,.66667),r,4)}_addArrow(e,i,r){const s=i[0],n=i[1],o=i[i.length-1],a=this._sub(s,n),l=this._norm(a);this._normalize(a);const c=Math.abs(this._crossProduct(a,this._sub(o,n)));let u=this._dotProduct(a,this._sub(o,n));u<.05*l?u=.05*l:u>.95*l&&(u=.95*l);const h=.5*c,p=this._leftPerp(a),f=[n[0]+a[0]*u,n[1]+a[1]*u],g=i.length-1,y=[];y.push(r?[-p[0],-p[1]]:p);let v=[-a[0],-a[1]];for(let b=1;b<g-1;b++){const w=this._sub(i[b+1],i[b]);this._normalize(w);const x=this._dotProduct(w,v),S=this._crossProduct(w,v),E=Math.sqrt((1+x)/2),C=this._sub(w,v);this._normalize(C),C[0]/=E,C[1]/=E,y.push(S<0?[-C[0],-C[1]]:C),v=w}y.push(this._rightPerp(v));for(let b=y.length-1;b>0;b--)e.push([i[b][0]+y[b][0]*h,i[b][1]+y[b][1]*h]);e.push([f[0]+y[0][0]*h,f[1]+y[0][1]*h]),e.push([f[0]+y[0][0]*c,f[1]+y[0][1]*c]),e.push(s),e.push([f[0]-y[0][0]*c,f[1]-y[0][1]*c]),e.push([f[0]-y[0][0]*h,f[1]-y[0][1]*h]);for(let b=1;b<y.length;b++)e.push([i[b][0]-y[b][0]*h,i[b][1]-y[b][1]*h])}_cp2(e,i,r){return e.length>=2?e[1]:this._add2(e[0],i*this._defaultSize,r*this._defaultSize)}_cp3(e,i,r,s){if(e.length>=3)return e[2];const n=this._mix(e[0],1-r,i,r),o=this._sub(i,e[0]);return this._normalize(o),this._rightPerpendicular(o),[n[0]+o[0]*s*this._defaultSize,n[1]+o[1]*s*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const i=e[0],r=this._cp2(e,-4,0),s=this._sub(i,r);this._normalize(s);const n=this._rightPerp(s);return[i,r,[i[0]+(n[0]-s[0])*this._defaultSize,i[1]+(n[1]-s[1])*this._defaultSize]]}_arrowLastSeg(e){const i=e[0],r=this._cp2(e,-4,0);let s;if(e.length>=3)s=e[e.length-1];else{const n=this._sub(i,r);this._normalize(n);const o=this._rightPerp(n);s=[i[0]+(o[0]-n[0])*this._defaultSize,i[1]+(o[1]-n[1])*this._defaultSize]}return[r,s]}_processGeom(e){if(!e)return null;const i=[];for(const r of e){if(!r||r.length===0)continue;const s=r.length;let n=r[0];switch(this._rule){case or.PerpendicularFromFirstSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,4),l=[];l.push(a),l.push(this._mid(n,o)),i.push(l);break}case or.ReversedFirstSegment:{const o=this._cp2(r,0,-1);i.push([o,n]);break}case or.PerpendicularToSecondSegment:{if(r.length<3)return[];const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=[];l.push(this._mid(o,a)),l.push(n),i.push(l);break}case or.SecondSegmentWithTicks:{if(r.length<3)return[];const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=this._sub(a,o);let c;c=this._crossProduct(l,this._sub(n,o))>0?this._rightPerp(l):this._leftPerp(l);const u=[];u.push([o[0]+(c[0]-l[0])/3,o[1]+(c[1]-l[1])/3]),u.push(o),u.push(a),u.push([a[0]+(c[0]+l[0])/3,a[1]+(c[1]+l[1])/3]),i.push(u);break}case or.DoublePerpendicular:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,3),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const h=[];h.push(n),h.push([a[0]+c[0]*u,a[1]+c[1]*u]),i.push(h);const p=[];p.push([a[0]-c[0]*u,a[1]-c[1]*u]),p.push(o),i.push(p);break}case or.OppositeToFirstSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,3),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const h=[];h.push([a[0]+c[0]*u,a[1]+c[1]*u]),h.push([a[0]-c[0]*u,a[1]-c[1]*u]),i.push(h);break}case or.TriplePerpendicular:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,4),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const h=[];h.push([a[0]+c[0]*u*.8,a[1]+c[1]*u*.8]),h.push([l[0]+.8*(n[0]-l[0]),l[1]+.8*(n[1]-l[1])]),i.push(h),i.push([a,l]);const p=[];p.push([a[0]-c[0]*u*.8,a[1]-c[1]*u*.8]),p.push([l[0]+.8*(o[0]-l[0]),l[1]+.8*(o[1]-l[1])]),i.push(p);break}case or.HalfCircleFirstSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,4),l=this._mid(n,o);let c=this._sub(o,n);const u=Math.cos(Math.PI/18),h=Math.sin(Math.PI/18),p=Math.sqrt((1+u)/2),f=Math.sqrt((1-u)/2),g=[];let y;this._crossProduct(c,this._sub(a,n))>0?(g.push(n),c=this._sub(n,l),y=o):(g.push(o),c=this._sub(o,l),y=n),this._rotateDirect(c,p,f),c[0]/=p,c[1]/=p;for(let v=1;v<=18;v++)g.push(this._add(l,c)),this._rotateDirect(c,u,h);g.push(y),i.push(g);break}case or.HalfCircleSecondSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,1,-1);let l=this._sub(n,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,o))/2;this._leftPerpendicular(l);const u=[o[0]+l[0]*c,o[1]+l[1]*c];l=this._sub(o,u);const h=Math.cos(Math.PI/18);let p=Math.sin(Math.PI/18);c>0&&(p=-p);const f=[o];for(let g=1;g<=18;g++)this._rotateDirect(l,h,p),f.push(this._add(u,l));i.push(f);break}case or.HalfCircleExtended:{const o=this._cp2(r,0,-2),a=this._cp3(r,o,1,-1);let l;if(s>=4)l=r[3];else{const g=this._sub(n,o);l=this._add(a,g)}const c=this._dist(o,a)/2/.75,u=this._sub(o,n);this._normalize(u,c);const h=this._sub(a,l);this._normalize(h,c);const p=[l,a];i.push(p);const f=[this._clone(a)];this._addBezier3(f,a,this._add(a,h),this._add(o,u),o,4),f.push(n),i.push(f);break}case or.OpenCircle:{const o=this._cp2(r,-2,0),a=this._sub(o,n),l=Math.cos(Math.PI/18),c=-Math.sin(Math.PI/18),u=[o];for(let h=1;h<=33;h++)this._rotateDirect(a,l,c),u.push(this._add(n,a));i.push(u);break}case or.CoverageEdgesWithTicks:{const o=this._cp2(r,0,-1);let a,l;if(s>=3)a=r[2];else{const p=this._sub(o,n),f=this._leftPerp(p);a=[n[0]+f[0]-.25*p[0],n[1]+f[1]-.25*p[1]]}if(s>=4)l=r[3];else{const p=this._mid(n,o),f=this._sub(n,o);this._normalize(f),this._leftPerpendicular(f);const g=this._crossProduct(f,this._sub(a,p));this._rightPerpendicular(f),l=[a[0]+f[0]*g*2,a[1]+f[1]*g*2]}const c=this._sub(o,n);let u,h;u=this._crossProduct(c,this._sub(a,n))>0?this._rightPerp(c):this._leftPerp(c),h=[],h.push(a),h.push(n),h.push([n[0]+(u[0]-c[0])/3,n[1]+(u[1]-c[1])/3]),i.push(h),u=this._crossProduct(c,this._sub(l,o))>0?this._rightPerp(c):this._leftPerp(c),h=[],h.push([o[0]+(u[0]+c[0])/3,o[1]+(u[1]+c[1])/3]),h.push(o),h.push(l),i.push(h);break}case or.GapExtentWithDoubleTicks:{const o=this._cp2(r,0,2),a=this._cp3(r,o,0,1);let l;if(s>=4)l=r[3];else{const c=this._sub(o,n);l=this._add(a,c)}this._addAngledTicks(i,n,o,this._mid(a,l)),this._addAngledTicks(i,a,l,this._mid(n,o));break}case or.GapExtentMidline:{const o=this._cp2(r,2,0),a=this._cp3(r,o,0,1);let l;if(s>=4)l=r[3];else{const u=this._sub(o,n);l=this._add(a,u)}const c=[];c.push(this._mid(n,a)),c.push(this._mid(o,l)),i.push(c);break}case or.Chevron:{const o=this._cp2(r,-1,-1);let a;if(s>=3)a=r[2];else{const l=this._sub(o,n);this._leftPerpendicular(l),a=this._add(n,l)}i.push([o,this._makeCtrlPt(n),a]);break}case or.PerpendicularWithArc:{const o=this._cp2(r,0,-2),a=this._cp3(r,o,.5,-1),l=this._sub(o,n),c=this._norm(l);l[0]/=c,l[1]/=c;const u=this._crossProduct(l,this._sub(a,n));let h=this._dotProduct(l,this._sub(a,n));h<.05*c?h=.05*c:h>.95*c&&(h=.95*c);const p=[n[0]+l[0]*h,n[1]+l[1]*h];let f=this._leftPerp(l),g=[];if(g.push([p[0]-f[0]*u,p[1]-f[1]*u]),g.push([p[0]+f[0]*u,p[1]+f[1]*u]),i.push(g),s>=4){const w=r[3];let x=this._dotProduct(l,this._sub(w,n));x<.1*c?x=.1*c:x>.9*c&&(x=.9*c);const S=[n[0]+l[0]*x,n[1]+l[1]*x],E=this._crossProduct(l,this._sub(w,n)),C=[];C.push([S[0]-f[0]*E,S[1]-f[1]*E]),C.push([S[0]+f[0]*E,S[1]+f[1]*E]),i.push(C)}const y=[o[0]+f[0]*u,o[1]+f[1]*u];f=this._sub(o,y);const v=Math.cos(Math.PI/18);let b=Math.sin(Math.PI/18);u<0&&(b=-b),g=[n,o];for(let w=1;w<=9;w++)this._rotateDirect(f,v,b),g.push(this._add(y,f));i.push(g);break}case or.ClosedHalfCircle:{const o=this._cp2(r,2,0),a=this._mid(n,o),l=this._sub(o,a),c=Math.cos(Math.PI/18),u=Math.sin(Math.PI/18),h=[n,o];for(let p=1;p<=18;p++)this._rotateDirect(l,c,u),h.push(this._add(a,l));i.push(h);break}case or.TripleParallelExtended:{const o=this._cp2(r,0,-2),a=this._cp3(r,o,1,-2),l=this._mid(n,o),c=this._sub(a,o);this._normalize(c);const u=Math.abs(this._crossProduct(c,this._sub(l,o)))/2,h=this._dist(o,a),p=[o,n];p.push([n[0]+c[0]*h*.5,n[1]+c[1]*h*.5]),i.push(p);const f=[];f.push([l[0]-c[0]*u,l[1]-c[1]*u]),f.push([l[0]+c[0]*h*.375,l[1]+c[1]*h*.375]),jX(f[f.length-1],1),f.push([l[0]+c[0]*h*.75,l[1]+c[1]*h*.75]),i.push(f);const g=[o,a];i.push(g);break}case or.ParallelWithTicks:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(a,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l),this._addAngledTicks(i,n,o,a),this._addAngledTicks(i,this._mix(n,1,l,c),this._mix(o,1,l,c),this._mid(n,o));break}case or.Parallel:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._leftPerp(l),u=this._crossProduct(l,this._sub(a,n));let h=[n,o];i.push(h),h=[],h.push([n[0]+c[0]*u,n[1]+c[1]*u]),h.push([o[0]+c[0]*u,o[1]+c[1]*u]),i.push(h);break}case or.PerpendicularToFirstSegment:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._mid(n,o),c=this._sub(o,n);this._normalize(c);const u=this._crossProduct(c,this._sub(a,n));this._leftPerpendicular(c);const h=[];h.push([l[0]-c[0]*u*.25,l[1]-c[1]*u*.25]),h.push([l[0]+c[0]*u*1.25,l[1]+c[1]*u*1.25]),i.push(h);break}case or.ParallelOffset:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]-l[0]*c,n[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),i.push(u);const h=[];h.push([n[0]+l[0]*c,n[1]+l[1]*c]),h.push([o[0]+l[0]*c,o[1]+l[1]*c]),i.push(h);break}case or.OffsetOpposite:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]-l[0]*c,n[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),i.push(u);break}case or.OffsetSame:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]+l[0]*c,n[1]+l[1]*c]),u.push([o[0]+l[0]*c,o[1]+l[1]*c]),i.push(u);break}case or.CircleWithArc:{let o=this._cp2(r,3,0);const a=this._cp3(r,o,.5,-1);let l,c;if(s>=4)l=r[3],c=this._crossProduct(this._sub(l,o),this._sub(a,o))>0;else{l=o,c=this._crossProduct(this._sub(l,n),this._sub(a,n))>0;const g=24*this._geomUnitsPerPoint,y=this._sub(l,n);this._normalize(y,g);const v=Math.sqrt(2)/2;this._rotateDirect(y,v,c?v:-v),o=this._add(n,y)}const u=this._sub(o,n),h=Math.cos(Math.PI/18),p=Math.sin(Math.PI/18),f=[o];for(let g=1;g<=36;g++)this._rotateDirect(u,h,p),f.push(this._add(n,u));this._add90DegArc(f,o,l,a,c),jX(f[f.length-8],1),i.push(f);break}case or.DoubleJog:{let o,a=this._cp2(r,-3,1),l=this._cp3(r,a,-1,-.5);if(s>=4)o=r[3];else{const b=n;n=a,o=l;const w=this._dist(n,b),x=this._dist(o,b);let S=30*this._geomUnitsPerPoint;.5*w<S&&(S=.5*w),.5*x<S&&(S=.5*x),a=this._mix(n,S/w,b,(w-S)/w),l=this._mix(o,S/x,b,(x-S)/x)}const c=this._mid(n,a),u=this._mid(o,l),h=this._dist(n,a),p=this._dist(l,o);let f=Math.min(h,p)/8;f=Math.min(f,24*this._geomUnitsPerPoint);const g=Math.cos(Math.PI/4);let y=this._sub(n,a);this._normalize(y,f),this._crossProduct(y,this._sub(o,a))>0?this._rotateDirect(y,g,-g):this._rotateDirect(y,g,g);let v=[];v.push(a),v.push(this._add(c,y)),v.push(this._sub(c,y)),v.push(n),i.push(v),y=this._sub(o,l),this._normalize(y,f),this._crossProduct(y,this._sub(n,l))<0?this._rotateDirect(y,g,g):this._rotateDirect(y,g,-g),v=[],v.push(l),v.push(this._add(u,y)),v.push(this._sub(u,y)),v.push(o),i.push(v);break}case or.PerpendicularOffset:{const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(n,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c);i.push([u,n]);break}case or.LineExcludingLastSegment:{const o=this._arrowPath(r),a=[];let l=o.length-2;for(;l--;)a.push(o[l]);i.push(a);break}case or.MultivertexArrow:{const o=this._arrowPath(r),a=[];this._addArrow(a,o,!1),i.push(a);break}case or.CrossedArrow:{const o=this._arrowPath(r),a=[];this._addArrow(a,o,!0),i.push(a);break}case or.ChevronArrow:{const[o,a]=this._arrowLastSeg(r),l=10*this._geomUnitsPerPoint,c=this._sub(n,o),u=this._norm(c);this._normalize(c);const h=this._crossProduct(c,this._sub(a,o));let p=this._dotProduct(c,this._sub(a,o));p<.05*u?p=.05*u:p>.95*u-l&&(p=.95*u-l);const f=[o[0]+c[0]*p,o[1]+c[1]*p],g=this._leftPerp(c),y=[];y.push([f[0]+g[0]*h+c[0]*l,f[1]+g[1]*h+c[1]*l]),y.push(n),y.push([f[0]-g[0]*h+c[0]*l,f[1]-g[1]*h+c[1]*l]),i.push(y);break}case or.ChevronArrowOffset:{const[o,a]=this._arrowLastSeg(r),l=this._sub(n,o),c=this._norm(l);this._normalize(l);const u=this._crossProduct(l,this._sub(a,o));let h=this._dotProduct(l,this._sub(a,o));h<.05*c?h=.05*c:h>.95*c&&(h=.95*c);const p=[o[0]+l[0]*h,o[1]+l[1]*h];this._leftPerpendicular(l);const f=[];f.push([p[0]+l[0]*u*.5,p[1]+l[1]*u*.5]),f.push(this._mid(p,n)),f.push([p[0]-l[0]*u*.5,p[1]-l[1]*u*.5]),i.push(f);break}case or.PartialFirstSegment:{const[o,a]=this._arrowLastSeg(r),l=this._sub(n,o),c=this._norm(l);this._normalize(l);let u=this._dotProduct(l,this._sub(a,o));u<.05*c?u=.05*c:u>.95*c&&(u=.95*c);const h=[o[0]+l[0]*u,o[1]+l[1]*u];i.push([o,h]);break}case or.Arch:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,1),l=this._sub(n,o),c=this._mix(a,1,l,.55),u=this._mix(a,1,l,-.55),h=[n];this._addBezier2(h,n,c,a,4),this._addBezier2(h,a,u,o,4),i.push(h);break}case or.CurvedParallelTicks:{const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(n,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c),h=this._sub(this._mix(o,.75,a,.25),c),p=this._sub(this._mix(o,.25,a,.75),c),f=[o];this._addBezier2(f,o,h,u,3),this._addBezier2(f,u,p,a,3),i.push(f);for(let g=0;g<8;g++){const y=f[2*g+1],v=[this._clone(y)];v.push(this._add(y,[l[0]/4,l[1]/4])),i.push(v)}break}case or.Arc90Degrees:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,1),l=[o];this._add90DegArc(l,o,n,a),i.push(l);break}case or.TipWithPerpendicularAndTicks:{const[o,a]=this._arrowLastSeg(r),l=10*this._geomUnitsPerPoint,c=this._sub(n,o),u=this._norm(c);this._normalize(c);let h=this._crossProduct(c,this._sub(a,o)),p=this._dotProduct(c,this._sub(a,o));p<.05*u?p=.05*u:p>.95*u-l&&(p=.95*u-l);const f=this._leftPerp(c),g=[n[0]-c[0]*l,n[1]-c[1]*l],y=.5*Math.max(u-p-l,l);h=Math.abs(h);const v=[];v.push([g[0]+f[0]*(h+y)-c[0]*y,g[1]+f[1]*(h+y)-c[1]*y]),v.push([g[0]+f[0]*h,g[1]+f[1]*h]),v.push([g[0]-f[0]*h,g[1]-f[1]*h]),v.push([g[0]-f[0]*(h+y)-c[0]*y,g[1]-f[1]*(h+y)-c[1]*y]),i.push(v),i.push([g,n]);break}case or.FullGeometry:default:i.push(r)}}return i}},ize=class rL{static local(){return rL.instance===null&&(rL.instance=new rL),rL.instance}execute(e,i,r,s,n){return new uPt(e,i,r)}};ize.instance=null;let uPt=class extends g7{constructor(e,i,r){super(e,!0,!0),this._curveHelper=new h1,this._beginCut=(i.beginCut!==void 0?i.beginCut:1)*r,this._endCut=(i.endCut!==void 0?i.endCut:1)*r,this._middleCut=(i.middleCut!==void 0?i.middleCut:0)*r,this._invert=i.invert!==void 0&&i.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:i,_endCut:r,_middleCut:s}=this,n=e.pathLength(),o=Ro.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(i!==0||r!==0||s!==0)if(i+r+s>=n)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,i),this._curveHelper.appendSubCurve(o,e,.5*(n-s),.5*(n+s)),this._curveHelper.appendSubCurve(o,e,n-r,r)}else if(i===0&&r===0&&s===0)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else i+r+s<n&&(s===0?this._curveHelper.appendSubCurve(o,e,i,n-r):(this._curveHelper.appendSubCurve(o,e,i,.5*(n-s)),this._curveHelper.appendSubCurve(o,e,.5*(n+s),n-r)));return o.totalSize===0?null:o}};const Mwe=1e-7;let y7=class{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return this._values.length===0}size(){return this._values.length}init(e,i,r=!0){if(this._setEmpty(),!e||e.length===0)return!1;for(let s=0;s<e.length;s++){let n=Math.abs(e[s]);r&&n<Mwe&&(n=Mwe),this._values.push(n),this._length+=n}return i&&1&e.length&&(this._length*=2),this._length!==0&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const i=this._values?this._values.length:0;for(let r=0;r<i;++r)this._values[r]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}},tv=class{constructor(){this.pt=null,this.ca=0,this.sa=0}};var lw;(function(t){t[t.FAIL=0]="FAIL",t[t.END=1]="END",t[t.CONTINUE=2]="CONTINUE"})(lw||(lw={}));let K5=class{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return this.segment!==null}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}},_7=class extends h1{constructor(e=0,i=!1){super(e,i),this._tolerance=VF,this._currentPosition=new K5}updateTolerance(e){this._tolerance=VF*e}init(e,i,r=!0){return r?(this._patternLength=i.length(),this._partExtPtGap=i.extPtGap,this._partCtrlPtGap=i.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,i=lw.FAIL){const r=new K5;return!!this._nextPosition(e,r,null,i)&&(r.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[i,r]=this._getAngleCS(this._currentPosition);e.ca=i,e.sa=r}nextPointAndAngle(e,i,r=lw.FAIL){const s=new K5;if(!this._nextPosition(e,s,null,r))return!1;s.copyTo(this._currentPosition),i.pt=this._getPoint(s);const[n,o]=this._getAngleCS(s);return i.ca=n,i.sa=o,!0}nextCurve(e){if(e===0)return null;const i=Ro.createEmptyOptimizedCIM("esriGeometryPolyline");i.startPath(),i.nextPath();const r=new K5;return this._nextPosition(e,r,i,lw.END)?(r.copyTo(this._currentPosition),i):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,i,r,s){if(this._currentPosition.isPathEnd)return!1;let n=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(n/=this._currentPosition.segmentLength),this._currentPosition.copyTo(i);i.abscissa+e*this._partLengthRatio>i.segmentLength+this._tolerance;){if(r){if(r.pathSize===0)if(n===0){const a=i.segment[0];r.pushXY(a[0],a[1])}else r.pushPoint(this.getSegCoord2D(i.segment,n));const o=i.segment[1];r.pushXY(o[0],o[1])}if(n=0,e-=(i.segmentLength-i.abscissa)/this._partLengthRatio,this._partSegCount)i.segment=this._nextSegment(),i.segmentLength=this.getSegLength(i.segment),i.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return s!==lw.FAIL&&(i.segmentLength=this.getSegLength(i.segment),i.isPartEnd=!0,s===lw.END?(i.abscissa=i.segmentLength,i.isPathEnd=!0):i.abscissa=i.segmentLength+e,!0);this._currentPosition.copyTo(i)}}if(i.abscissa+=e*this._partLengthRatio,r){r.pathSize===0&&(n===0?r.pushPoint(i.segment[0]):r.pushPoint(this.getSegCoord2D(i.segment,n)));const o=i.abscissa/i.segmentLength;o===1?r.pushPoint(i.segment[1]):r.pushPoint(this.getSegCoord2D(i.segment,o))}return this._partSegCount||Math.abs(i.abscissa-i.segmentLength)<this._tolerance&&(i.isPathEnd=this._partIsLast,i.isPartEnd=!0),!0}_getPoint(e){const i=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,i)}_getAngleCS(e){const i=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,i)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const i=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(i);let r=i+this._partSegCount+1;if(r>=this._pathCursor.pathSize&&(r=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(r),this._patternLength>0){const s=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,n=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let o=Math.round((this._partLength-(s+n))/this._patternLength);o<=0&&(o=s+n>0?0:1),this._partLengthRatio=this._partLength/(s+n+o*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}};const WP={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0}};function hPt(t){return typeof t=="function"}function dPt(t,e,i,r){return hPt(t)?t(e,i,r):t}const pPt=` /-,
`;function Awe(t){let e=t.length;for(;e--;)if(!pPt.includes(t.charAt(e)))return!1;return!0}function fPt(t,e){const i=[];let r=0,s=-1;do if(s=t.indexOf("[",r),s>=r){if(s>r){const n=t.substr(r,s-r);i.push([n,null,Awe(n)])}if(r=s+1,s=t.indexOf("]",r),s>=r){if(s>r){const n=e[t.substr(r,s-r)];n&&i.push([null,n,!1])}r=s+1}}while(s!==-1);if(r<t.length-1){const n=t.substr(r);i.push([n,null,Awe(n)])}return i}function mPt(t,e,i,r){let s="",n=null;for(const o of e){const[a,l,c]=o;if(a)c?n=a:(n&&(s+=n,n=null),s+=a);else{let u=l;i!=null&&(u=aze(l,i));const h=t.attributes[u];h&&(n&&(s+=n,n=null),s+=h)}}return gPt(s,r)}function gPt(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function yPt(t){return t?[t[0],t[1],t[2],t[3]/255]:[0,0,0,0]}function _Pt(t){return t.data?.symbol??null}function vPt(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function bPt(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function rze(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const Hi=(t,e=0)=>t==null||isNaN(t)?e:t,wPt=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function xPt(){return ye(()=>import("./geometryEngineJSON-91b16940.js"),["./geometryEngineJSON-91b16940.js","./geometryEngineBase-2eacdee6.js","./geometryEngineJSON-40e62ded.js","./json-48e3ea08.js"],import.meta.url)}function SPt(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function TPt(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function sze(t){let e="normal",i="normal";if(t){const r=t.toLowerCase();r.includes("italic")?e="italic":r.includes("oblique")&&(e="oblique"),r.includes("bold")?i="bold":r.includes("light")&&(i="lighter")}return{style:e,weight:i}}function nze(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function OD(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=OD(e);if(i!=null)return i}break;case"CIMTextSymbol":return OD(t.symbol);case"CIMSolidFill":return t.color}return null}function $se(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const i of e){const r=$se(i);if(r!=null)return r}break}case"CIMTextSymbol":return $se(t.symbol);case"CIMSolidStroke":return t.color}}function Nse(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=Nse(e);if(i!==void 0)return i}break;case"CIMTextSymbol":return Nse(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function EPt(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function CPt(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function MPt(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const PM=t=>t.includes("data:image/svg+xml");function zvi(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function Pde(t){return t&&t.charAt(0).toLowerCase()+t.substring(1)}function Vvi(t,e,i,r,s,n){const{infos:o}=n;let a=1,l=0,c=0,u=0;for(const{offsetX:f,offsetY:g,rotation:y,size:v,frameHeight:b,rotateClockWise:w}of o)c=Owe(f,g,l,a,c),u=Pwe(f,g,l,a,u),b&&(a*=v/b),l=Iwe(y,w,l);const h=Owe(r,s,l,a,c),p=Pwe(r,s,l,a,u);return{size:t*a,rotation:Iwe(e,i,l),offsetX:h,offsetY:p}}function oze(t){return t?.dashTemplate&&typeof t.dashTemplate=="string"&&(t.dashTemplate=t.dashTemplate.split(" ").map(Number)),t}function Lse(t){if(t==null)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const e=t.symbolLayers;if(!e)return"Normal";for(const i of e)if(i.type==="CIMVectorMarker")return Lse(i)}break;case"CIMVectorMarker":{const e=t.markerGraphics;if(!e)return"Normal";for(const i of e)if(i.symbol)return Lse(i.symbol)}}return"Normal"}function aze(t,e){if(e!==null){const i=e.get(t);return i?i.name:t}return t}function APt(t){return t.map(e=>({...e,propertyName:Pde(e.propertyName)}))}function Rwe(t){const e={};for(const i in t){const r=t[i];e[Pde(i)]=r}return e}function Pwe(t,e,i,r,s){const n=i*Math.PI/180;if(n){const o=Math.cos(n);return(Math.sin(n)*t+o*e)*r+s}return e*r+s}function Owe(t,e,i,r,s){const n=i*Math.PI/180;return n?(Math.cos(n)*t-Math.sin(n)*e)*r+s:t*r+s}function Iwe(t,e,i){return e?i-t:i+t}const RPt=1e3,$we=1e-7;let lze=class sL{static local(){return sL.instance===null&&(sL.instance=new sL),sL.instance}execute(e,i,r,s,n){return new PPt(e,i,r,s)}};lze.instance=null;let PPt=class extends g7{constructor(e,i,r,s){super(e,!0,!0),this._firstCurve=null,this._walker=new _7,this._walker.updateTolerance(r),this._endings=i.lineDashEnding,this._customDashPos=-(i.offsetAlongLine??0)*r,this._offsetAtEnd=(i.customEndingOffset??0)*r,this._tileKey=s;let n=oze(i).dashTemplate;n==null&&(n=[]),n.length%2&&(n=[...n,...n]);let o=0;for(let a=0;a<n.length;a++){let l=Math.abs(n[a]);l<$we&&(l=$we),o+=l}this._patternLength=o,this._numOfDashesPerPattern=n.length/2,this._pattern=new y7,this._pattern.init(n,!0),this._pattern.scale(r)}processPath(e){if(this._pattern.length()===0){this.iteratePath=!1;const s=Ow(e);return Ro.fromJSONCIM({paths:[s]})}if(!this.iteratePath){let s=!0;switch(this._endings){case Gl.HalfPattern:case Gl.HalfGap:default:this._pattern.extPtGap=0;break;case Gl.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case Gl.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case Gl.NoConstraint:this.isClosed||(s=!1);break;case Gl.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const n=e.pathLength();if(this._pattern.isEmpty()||n<.1*this._pattern.length()){const o=Ow(e);return Ro.fromJSONCIM({paths:[o]})}if(!this._walker.init(e,this._pattern,s)){const o=Ow(e);return Ro.fromJSONCIM({paths:[o]})}}let i;if(this.iteratePath)i=this._pattern.nextValue();else{let s;switch(this._endings){case Gl.HalfPattern:default:s=.5*this._pattern.firstValue();break;case Gl.HalfGap:s=.5*-this._pattern.lastValue();break;case Gl.FullGap:s=-this._pattern.lastValue();break;case Gl.FullPattern:s=0;break;case Gl.NoConstraint:case Gl.Custom:s=-this._customDashPos}let n=s/this._pattern.length();n-=Math.floor(n),s=n*this._pattern.length(),this._pattern.reset(),i=this._pattern.nextValue();let o=!1;for(;s>=i;)s-=i,i=this._pattern.nextValue(),o=!o;i-=s,o?(this._walker.nextPosition(i),i=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(i),i=this._pattern.nextValue(),this._walker.nextPosition(i),i=this._pattern.nextValue())}let r=this._walker.nextCurve(i);if(r)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)r.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else i=this._pattern.nextValue(),!this._walker.nextPosition(i)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(r.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,r=this._firstCurve,this._firstCurve=null;return r?.reset(),r}isClippingRequired(e){const i=Nk(e);let r=0;for(const s of i)r+=Jle(s);return Math.round(this._numOfDashesPerPattern*(r/this._patternLength))>RPt}},cze=class nL{static local(){return nL.instance===null&&(nL.instance=new nL),nL.instance}execute(e,i,r,s,n,o){return new OPt(e,i,r,s,n,o)}};cze.instance=null;let OPt=class{constructor(e,i,r,s,n,o){switch(this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._maxInflateSize=o*r,this._width=(i.width!==void 0?i.width:2)*r,i.method){case w2.Mitered:case w2.Bevelled:case w2.Rounded:case w2.TrueBuffer:case w2.Square:}this._option=i.option}next(){let e;for(;e=this._inputGeometries.next();){if(e.geometryType==="esriGeometryEnvelope"&&this._width>0){const i=e.asJSON();return Math.min(i.xmax-i.xmin,i.ymax-i.ymin)-2*this._width<0?e:Ro.fromJSONCIM({paths:[[[i.xmin+this._width,i.ymin+this._width],[i.xmax-this._width,i.ymin+this._width],[i.xmax-this._width,i.ymax-this._width],[i.xmin+this._width,i.ymax-this._width],[i.xmin+this._width,i.ymin+this._width]],[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]})}if(e.geometryType==="esriGeometryPolygon"){if(this._width===0)return e.clone();const i=this._geometryEngine;if(i==null)return null;const r=this._tileKey?m7(e,this._maxInflateSize):e.clone();if(!r)continue;const s=i.buffer(Je.WebMercator,r.asJSON(),-this._width,1);if(s){for(const n of s.rings)if(n){r.startPath();for(const o of n.reverse())r.pushXY(o[0],r.yFactor*o[1])}}return r}}return null}},uze=class oL{static local(){return oL.instance===null&&(oL.instance=new oL),oL.instance}execute(e,i,r,s,n){return new IPt(e,i,r)}};uze.instance=null;let IPt=class extends g7{constructor(e,i,r){super(e,!1,!0),this._curveHelper=new h1,this._length=(i.length!==void 0?i.length:20)*r,this._angle=i.angle!==void 0?i.angle:225,this._position=i.position!==void 0?i.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const i=Ro.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const r=e.x,s=e.y;e.seekInPath(e.pathSize-1);const n=e.x,o=e.y,a=[n-r,o-s];this._curveHelper.normalize(a);const l=r+(n-r)*this._position/100,c=s+(o-s)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let h=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(h=-h),this._mirror=!this._mirror;const p=[l-this._length/2*u,c-this._length/2*h],f=[l+this._length/2*u,c+this._length/2*h];return i.pushPath([[r,s],p,f,[n,o]]),i}},hze=class aL{static local(){return aL.instance===null&&(aL.instance=new aL),aL.instance}execute(e,i,r,s,n){return new $Pt(e,i,r)}};hze.instance=null;let $Pt=class{constructor(e,i,r){this._inputGeometries=e,this._offsetX=i.offsetX!==void 0?i.offsetX*r:0,this._offsetY=i.offsetY!==void 0?i.offsetY*r:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,i,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+i,e.y=e.y+r;return e.reset(),e}};const NPt=10;let dze=class lL{static local(){return lL.instance===null&&(lL.instance=new lL),lL.instance}execute(e,i,r,s,n,o){return new LPt(e,i,r,s,n,o)}};dze.instance=null;let LPt=class{constructor(e,i,r,s,n,o){this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._curveHelper=new h1,this._offset=(i.offset??1)*r,this._method=i.method,this._maxInflateSize=Math.max(Math.abs(o*r),NPt),this._option=i.option,this._offsetFlattenError=VF*r}next(){let e;for(;e=this._inputGeometries.next();){if(this._offset===0)return e.clone();if(e.geometryType==="esriGeometryEnvelope"){if(this._method===xv.Rounded&&this._offset>0){const o=Ow(e),a=this._curveHelper.offset(o,-this._offset,this._method,4,this._offsetFlattenError);if(a){const l=Ro.createEmptyOptimizedCIM(e.geometryType);return l.pushPath(a),l}return null}const n=e.asJSON();if(Nm(n)&&Math.min(n.xmax-n.xmin,n.ymax-n.ymin)+2*this._offset>0)return Ro.fromJSONCIM({xmin:n.xmin-this._offset,xmax:n.xmax+this._offset,ymin:n.ymin-this._offset,ymax:n.ymax+this._offset})}const i=this._geometryEngine;if(i==null)continue;const r=this._tileKey?m7(e,this._maxInflateSize):e.clone();if(!r)continue;const s=i.offset(Je.WebMercator,r.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return s?Ro.fromJSONCIM(s):null}return null}},pze=class cL{static local(){return cL.instance===null&&(cL.instance=new cL),cL.instance}execute(e,i,r,s,n){return new DPt(e,i,r)}};pze.instance=null;let DPt=class{constructor(e,i,r){this._inputGeometries=e,this._reverse=i.reverse===void 0||i.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if(e.geometryType==="esriGeometryPolyline")return FPt(e.clone());e=this._inputGeometries.next()}return null}};function FPt(t){for(;t.nextPath();)for(let e=0;e<t.pathSize/2;e++){t.seekInPath(e);const i=t.x,r=t.y;t.seekInPath(t.pathSize-e-1);const s=t.x,n=t.y;t.x=i,t.y=r,t.seekInPath(e),t.x=s,t.y=n}return t.reset(),t}let fze=class uL{static local(){return uL.instance===null&&(uL.instance=new uL),uL.instance}execute(e,i,r,s,n){return new kPt(e,i,r)}};fze.instance=null;let kPt=class{constructor(e,i,r){this._inputGeometries=e,this._rotateAngle=i.angle!==void 0?i.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(this._rotateAngle===0||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const i=Lq(e),r=(i[2]+i[0])/2,s=(i[3]+i[1])/2;return e.reset(),this._rotate(e.clone(),r,s)}e=this._inputGeometries.next()}return null}_rotate(e,i,r){const s=Math.cos(this._rotateAngle),n=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const o=e.x-i,a=e.y-r;e.x=i+o*s-a*n,e.y=r+o*n+a*s}return e.reset(),e}},mze=class hL{static local(){return hL.instance===null&&(hL.instance=new hL),hL.instance}execute(e,i,r,s,n){return new UPt(e,i,r)}};mze.instance=null;let UPt=class{constructor(e,i,r){this._inputGeometries=e,this._xFactor=i.xScaleFactor!==void 0?i.xScaleFactor:1.15,this._yFactor=i.yScaleFactor!==void 0?i.yScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(this._xFactor===1&&this._yFactor===1||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const i=Lq(e),r=(i[2]+i[0])/2,s=(i[3]+i[1])/2;return e.reset(),this._scaleCursor(e.clone(),r,s)}}return null}_scaleCursor(e,i,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=i+(e.x-i)*this._xFactor,e.y=r+(e.y-r)*this._yFactor;return e.reset(),e}},gze=class dL{static local(){return dL.instance===null&&(dL.instance=new dL),dL.instance}execute(e,i,r,s,n){return new BPt(e,i,r)}};gze.instance=null;let BPt=class{constructor(e,i,r){this._inputGeometries=e,this._height=(i.amplitude!==void 0?i.amplitude:2)*r,this._period=(i.period!==void 0?i.period:3)*r,this._style=i.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new y7,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new _7,this._walker.updateTolerance(r)}next(){let e=this._inputGeometries.next();for(;e;){if(this._height===0||this._period===0)return e;const i=this._processGeom(e);if(i)return i;e=this._inputGeometries.next()}return null}_processGeom(e){const i=Ro.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){i.startPath();const r=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case eP.Sinus:default:this._constructCurve(i,r,!1);break;case eP.Square:this._constructSquare(i,r);break;case eP.Triangle:this._constructTriangle(i,r);break;case eP.Random:this._constructCurve(i,r,!0)}else for(;e.nextPoint();)i.pushXY(e.x,e.y)}return i}_constructCurve(e,i,r){let s=Math.round(i/this._period);s===0&&(s=1);const n=s*16+1,o=i/s,a=this._period/16,l=1/n,c=2*Math.PI*i/o,u=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),p=2*Math.PI*Math.random(),f=.75-Math.random()/2,g=.75-Math.random()/2,y=new tv;this._walker.curPointAndAngle(y),e.pushPoint(y.pt);let v=0;for(;;){if(!this._walker.nextPointAndAngle(a,y)){e.pushPoint(this._walker.getPathEnd());break}{const b=v;let w;if(v+=l,r){const x=this._height/2*(1+.3*Math.sin(f*c*b+u));w=x*Math.sin(c*b+h),w+=x*Math.sin(g*c*b+p),w/=2}else w=.5*this._height*Math.sin(.5*c*b);e.pushXY(y.pt[0]-w*y.sa,y.pt[1]+w*y.ca)}}}_constructSquare(e,i){Math.round(i/this._period);let r=!0;for(;;){let s=!1;if(this._walker.curPositionIsValid()){const n=new tv;this._walker.curPointAndAngle(n);const o=new tv;if(this._walker.nextPointAndAngle(this._period,o)){const a=new tv;this._walker.nextPointAndAngle(this._period,a)&&(r?(e.pushPoint(n.pt),r=!1):e.pushPoint(n.pt),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca),s=!0)}}if(!s){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,i){Math.round(i/this._period);let r=!0;for(;;){let s=!1;if(this._walker.curPositionIsValid()){const n=new tv;this._walker.curPointAndAngle(n);const o=new tv;if(this._walker.nextPointAndAngle(this._period/2,o)){const a=new tv;this._walker.nextPointAndAngle(this._period,a)&&(this._walker.nextPosition(this._period/2)&&(r?(e.pushPoint(n.pt),r=!1):e.pushPoint(n.pt),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca)),s=!0)}}if(!s){e.pushPoint(this._walker.getPathEnd());break}}}},yze=class pL{static local(){return pL.instance===null&&(pL.instance=new pL),pL.instance}execute(e,i,r,s,n){return new zPt(e,i,r)}};yze.instance=null;let zPt=class extends S4{constructor(e,i,r){super(e),this._geometryWalker=new _7,this._geometryWalker.updateTolerance(r),this._angleToLine=i.angleToLine??!0,this._offset=(i.offset?i.offset:0)*r,this._originalEndings=i.endings,this._offsetAtEnd=(i.customEndingOffset?i.customEndingOffset:0)*r,this._position=-(i.offsetAlongLine?i.offsetAlongLine:0)*r,this._pattern=new y7,this._pattern.init(i.placementTemplate,!1),this._pattern.scale(r),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let i;if(this.iteratePath)i=this._pattern.nextValue();else{this._originalEndings===ym.WithFullGap&&this.isClosed?this._endings=ym.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let s,n=!0;switch(this._endings){case ym.NoConstraint:s=-this._position,s=this._adjustPosition(s),n=!1;break;case ym.WithHalfGap:default:s=-this._pattern.lastValue()/2;break;case ym.WithFullGap:s=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case ym.WithMarkers:s=0;break;case ym.Custom:s=-this._position,s=this._adjustPosition(s),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,n))return null;this._pattern.reset();let o=0;for(;s>o;)s-=o,o=this._pattern.nextValue();o-=s,i=o,this.iteratePath=!0}const r=new tv;return this._geometryWalker.nextPointAndAngle(i,r)?this._endings===ym.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===ym.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca),this._angleToLine&&this.internalPlacement.setRotateCS(r.ca,r.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let i=e/this._pattern.length();return i-=Math.floor(i),i*this._pattern.length()}},_ze=class fL{static local(){return fL.instance===null&&(fL.instance=new fL),fL.instance}execute(e,i,r,s,n){return new VPt(e,i,r)}};_ze.instance=null;let VPt=class extends S4{constructor(e,i,r){super(e,!1,!0),this._curveHelper=new h1,this._placePerPart=i.placePerPart??!1,this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._type=i.extremityPlacement,this._position=i.offsetAlongLine!==void 0?i.offsetAlongLine*r:0,this._beginProcessed=!1}processMultiPath(e){return this._placePerPart?super.processMultiPath(e):this.processPath(e)}processPath(e){let i;switch(this._type){case Qy.Both:default:this._beginProcessed?(i=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(i=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case Qy.JustBegin:i=this._atExtremities(e,this._position,!0);break;case Qy.JustEnd:i=this._atExtremities(e,this._position,!1);case Qy.None:}return i}_atExtremities(e,i,r){if(this._placePerPart||(r?e.seekPath(0):e.seekPath(e.totalSize-1)),r||e.seekPathEnd(),r?e.nextPoint():e.prevPoint()){let s=0,[n,o]=[0,0],[a,l]=[e.x,e.y];for(;r?e.nextPoint():e.prevPoint();){n=a,o=l,a=e.x,l=e.y;const c=this._curveHelper.getLength(n,o,a,l);if(s+c>i){const u=(i-s)/c,[h,p]=this._curveHelper.getAngleCS(n,o,a,l,u),f=this._curveHelper.getCoord2D(n,o,a,l,u);return this.internalPlacement.setTranslate(f[0]-this._offset*p,f[1]+this._offset*h),this._angleToLine&&this.internalPlacement.setRotateCS(-h,-p),this.internalPlacement}s+=c}}return null}},vze=class mL{static local(){return mL.instance===null&&(mL.instance=new mL),mL.instance}execute(e,i,r,s,n){return new GPt(e,i,r)}};vze.instance=null;let GPt=class extends S4{constructor(e,i,r){super(e),this._walker=new _7,this._walker.updateTolerance(r),this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._beginGap=i.beginPosition!==void 0?i.beginPosition*r:0,this._endGap=i.endPosition!==void 0?i.endPosition*r:0,this._flipFirst=i.flipFirst===void 0||i.flipFirst,this._pattern=new y7,this._pattern.init(i.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let i;if(this.iteratePath){const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;i=l-this._prevPos,this._prevPos=l}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;i=l-this._prevPos,this._prevPos=l,this.iteratePath=!0}const r=new tv;if(!this._walker.nextPointAndAngle(i,r,lw.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca);const s=this._isFirst&&this._flipFirst;let n,o;return this._angleToLine?(n=r.ca,o=r.sa):(n=1,o=0),s&&(n=-n,o=-o),this.internalPlacement.setRotateCS(n,o),this._isFirst=!1,this._posCount--,this._posCount===0&&(this.iteratePath=!1),this.internalPlacement}};const W1=512,jPt=10,Fg=24,W8=1e-6;let bze=class gL{static local(){return gL.instance===null&&(gL.instance=new gL),gL.instance}execute(e,i,r,s,n){return new HPt(e,i,r,s,n)}};bze.instance=null;let HPt=class BT{constructor(e,i,r,s,n){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(i.stepX??16)*r,this._stepY=Math.abs(i.stepY??16)*r,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,this._stepX!==0&&this._stepY!==0){if(this._gridType=i.gridType??PD.Fixed,this._gridType===PD.Random){const o=i.seed??13,a=1;this._randomLCG=new H2(o*a),this._randomness=(i.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=i.gridAngle??0,this._shiftOddRows=i.shiftOddRows??!1,this._offsetX=(i.offsetX??0)*r,this._offsetY=(i.offsetY??0)*r,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,s!=null){const[o,a,l,c]=s.split("/"),u=parseFloat(o),h=parseFloat(a),p=parseFloat(l),f=parseFloat(c);this._graphicOriginX=-(f*2**u+p)*W1,this._graphicOriginY=h*W1,this._testInsidePolygon=!0}this._internalPlacement=new i$,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!BT._randValues){BT._randValues=[];for(let e=0;e<Fg;e++)for(let i=0;i<Fg;i++)BT._randValues.push(this._randomLCG.getFloat()),BT._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let i,r,s,n,o,a,l,c,u,h,p,f,g,y;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=c=g=p=Number.MAX_VALUE,u=h=y=f=-Number.MAX_VALUE;const v=this._cosAngle!==1;for(e.reset();e.nextPath();)for(;e.nextPoint();)a=e.x,o=e.y,i=a-this._graphicOriginX-this._offsetX,r=o-this._graphicOriginY-this._offsetY,v?(s=this._cosAngle*i-this._sinAngle*r,n=this._sinAngle*i+this._cosAngle*r):(s=i,n=r),l=Math.min(l,s),u=Math.max(u,s),c=Math.min(c,n),h=Math.max(h,n),p=Math.min(p,o),f=Math.max(f,o),g=Math.min(g,a),y=Math.max(y,a);p=p!==Number.MAX_VALUE?p:-W1-this._stepY,f=f!==-Number.MAX_VALUE?f:this._stepY,g=g!==Number.MAX_VALUE?g:-this._stepX,y=y!==-Number.MAX_VALUE?y:W1+this._stepX;const b=f-p,w=y-g;if(this._verticalSubdivision=b>=w,this._polygonMin=this._verticalSubdivision?p:g,this._testInsidePolygon){let x=0-this._graphicOriginX-this._offsetX-this._stepX,S=W1-this._graphicOriginX-this._offsetX+this._stepX,E=-W1-this._graphicOriginY-this._offsetY-this._stepY,C=0-this._graphicOriginY-this._offsetY+this._stepY;if(v){const R=[[x,E],[x,C],[S,E],[S,C]];x=E=Number.MAX_VALUE,S=C=-Number.MAX_VALUE;for(const I of R){const F=this._cosAngle*I[0]-this._sinAngle*I[1],D=this._sinAngle*I[0]+this._cosAngle*I[1];x=Math.min(x,F),S=Math.max(S,F),E=Math.min(E,D),C=Math.max(C,D)}}l=l!==Number.MAX_VALUE?Math.max(l,x):x,c=c!==Number.MAX_VALUE?Math.max(c,E):E,u=u!==-Number.MAX_VALUE?Math.min(u,S):S,h=h!==-Number.MAX_VALUE?Math.min(h,C):C}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(h/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,g,y,p,f)}_buildAccelerationMap(e,i,r,s,n){e.reset();const o=new Map,a=this._verticalSubdivision,l=a?n-s:r-i;let c=Math.ceil(l/jPt);if(c<=1)return;const u=Math.floor(l/c);let h,p,f,g,y,v,b,w,x,S,E;for(c++,this._delta=u,a?(x=-W1-2*this._stepY,S=2*this._stepY,E=s):(x=-2*this._stepX,S=W1+2*this._stepX,E=i);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(h=e.x,p=e.y;e.nextPoint();h=f,p=g){if(f=e.x,g=e.y,a){if(p===g||p<x&&g<x||p>S&&g>S)continue;y=Math.min(p,g),v=Math.max(p,g)}else{if(h===f||h<x&&f<x||h>S&&f>S)continue;y=Math.min(h,f),v=Math.max(h,f)}for(;y<v;)b=Math.floor((y-E)/u),Nwe(b,h,p,f,g,o),y+=u;w=Math.floor((v-E)/u),w>b&&Nwe(w,h,p,f,g,o)}this._accelerationMap=o}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const i=this._currentY*this._stepY+this._offsetY;let r,s;if(this._currentX++,this._gridType===PD.Random){const n=(this._currentX%Fg+Fg)%Fg,o=(this._currentY%Fg+Fg)%Fg;r=this._graphicOriginX+e+this._stepX*this._randomness*(.5-BT._randValues[o*Fg+n])*2/3,s=this._graphicOriginY+i+this._stepY*this._randomness*(.5-BT._randValues[o*Fg+n+1])*2/3}else r=this._graphicOriginX+this._cosAngle*e+this._sinAngle*i,s=this._graphicOriginY-this._sinAngle*e+this._cosAngle*i;if(!this._testInsidePolygon||this._isInsidePolygon(r,s,this._geometryCursor))return this._internalPlacement.setTranslate(r,s),this._internalPlacement}}_isInsidePolygon(e,i,r){if(this._accelerationMap==null)return qPt(e,i,r);e+=W8,i+=W8;const s=this._verticalSubdivision,n=s?i:e,o=Math.floor((n-this._polygonMin)/this._delta),a=this._accelerationMap.get(o);if(!a)return!1;let l,c,u,h=0;for(const p of a){if(l=p[0],c=p[1],s){if(l[1]>i==c[1]>i)continue;u=(c[0]-l[0])*(i-l[1])-(c[1]-l[1])*(e-l[0])}else{if(l[0]>e==c[0]>e)continue;u=(c[1]-l[1])*(e-l[0])-(c[0]-l[0])*(i-l[1])}u>0?h++:h--}return h!==0}};function qPt(t,e,i){let r,s,n,o,a=0;for(t+=W8,e+=W8,i.reset();i.nextPath();)if(i.nextPoint())for(r=i.x,s=i.y;i.nextPoint();r=n,s=o)n=i.x,o=i.y,s>e!=o>e&&((n-r)*(e-s)-(o-s)*(t-r)>0?a++:a--);return a!==0}function Nwe(t,e,i,r,s,n){let o=n.get(t);o||(o=[],n.set(t,o)),o.push([[e,i],[r,s]])}const WPt=.001;let wze=class yL{static local(){return yL.instance===null&&(yL.instance=new yL),yL.instance}execute(e,i,r,s,n){return new YPt(e,i,r)}};wze.instance=null;let YPt=class extends S4{constructor(e,i,r){super(e),this._curveHelper=new h1,this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._relativeTo=i.relativeTo,this._position=i.startPointOffset!==void 0?i.startPointOffset*r:0,this._epsilon=WPt*r}processPath(e){const i=this._position;if(this._relativeTo===x2.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[s,n]=[e.x,e.y],[o,a]=[0,0];for(;e.nextPoint();){o=e.x,a=e.y;const l=this._curveHelper.getLength(s,n,o,a);if(l<this._epsilon){s=o,n=a;continue}const c=.5+this._position/l,[u,h]=this._curveHelper.getAngleCS(s,n,o,a,c),p=this._curveHelper.getCoord2D(s,n,o,a,c);return this.internalPlacement.setTranslate(p[0]-this._offset*h,p[1]+this._offset*u),this._angleToLine&&this.internalPlacement.setRotateCS(u,h),this.internalPlacement}}return this.iteratePath=!1,null}const r=this._relativeTo===x2.LineEnd;return this.onLine(e,i,r)}onLine(e,i,r){let s,n=!1;switch(this._relativeTo){case x2.LineMiddle:default:e.seekPathStart(),s=e.pathLength()/2+i;break;case x2.LineBeginning:s=i;break;case x2.LineEnd:s=i,n=!0}r?e.seekPathEnd():e.seekPathStart();let o=0;if(r?e.prevPoint():e.nextPoint()){let[a,l]=[e.x,e.y],[c,u]=[0,0];for(;r?e.prevPoint():e.nextPoint();){c=e.x,u=e.y;const h=this._curveHelper.getLength(a,l,c,u);if(o+h>s){const p=(s-o)/h,[f,g]=this._curveHelper.getAngleCS(a,l,c,u,p),y=this._curveHelper.getCoord2D(a,l,c,u,p),v=n?-this._offset:this._offset;return this.internalPlacement.setTranslate(y[0]-v*g,y[1]+v*f),this._angleToLine&&(n?this.internalPlacement.setRotateCS(-f,-g):this.internalPlacement.setRotateCS(f,g)),this.internalPlacement}a=c,l=u,o+=h}}return null}};const XPt=1e-15;let xze=class _L{static local(){return _L.instance===null&&(_L.instance=new _L),_L.instance}execute(e,i,r,s,n){return new ZPt(e,i,r)}};xze.instance=null;let ZPt=class extends S4{constructor(e,i,r){super(e),this._curveHelper=new h1,this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._endPoints=i.placeOnEndPoints===void 0||i.placeOnEndPoints,this._controlPoints=i.placeOnControlPoints===void 0||i.placeOnControlPoints,this._regularVertices=i.placeOnRegularVertices===void 0||i.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const i=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(i[2]);let r=i[0],s=i[1];if(this._offset!==0){const n=Math.cos(i[2]),o=Math.sin(i[2]);r-=this._offset*o,s+=this._offset*n}return this.internalPlacement.setTranslate(r,s),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const i=e.isClosed();let r=0,s=!1,n=0,o=0;if(e.seekPathStart(),e.nextPoint()){let a=e.x,l=e.y,c=e.getControlPoint(),u=!0,h=e.nextPoint();for(;h;){const p=e.x,f=e.y,g=e.getControlPoint();(this._angleToLine||this._offset!==0)&&(n=this._curveHelper.getAngle(a,l,p,f,0)),u?(u=!1,i?(r=n,s=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([a,l,n])):c?this._controlPoints&&this._tags.push([a,l,eB(o,n)]):this._regularVertices&&this._tags.push([a,l,eB(o,n)]),(this._angleToLine||this._offset!==0)&&(o=this._curveHelper.getAngle(a,l,p,f,1)),h=e.nextPoint(),h||(i?g||s?this._controlPoints&&this._tags.push([p,f,eB(o,r)]):this._regularVertices&&this._tags.push([p,f,eB(o,r)]):(this._endPoints||this._controlPoints&&g)&&this._tags.push([p,f,o])),a=p,l=f,c=g}}this._tagIterator=0}};function eB(t,e){const i=Math.PI;for(;Math.abs(e-t)>i+2*XPt;)e-t>i?e-=2*i:e+=2*i;return(t+e)/2}const JPt=100*222045e-21;function QPt(t){if(t.totalSize===0)return null;const e=Lq(t);if(!e)return null;const i=4*(Math.abs(e[0])+Math.abs(e[2])+Math.abs(e[1])+Math.abs(e[3])+1)*JPt;let r=0,s=0;t.reset();for(let F=0;t.nextPath();F++){const D=t.getCurrentRingArea();D>s&&(s=D,r=F)}if(t.seekPath(r),t.pathSize===0)return null;t.seekPathStart();const n=gOe(t);if(Math.abs(s)<=2*i*i)return[(n[0]+n[2])/2,(n[1]+n[3])/2];t.seekPathStart();const o=Vtt(t,li());if(o===null)return null;if(t.totalPoints<4)return o;const a=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],l=[NaN,NaN,NaN,NaN],c=[NaN,NaN,NaN,NaN];let u=!1,h=l3(o,t,!0);h.distance===0&&(u=!0,a[0][0]=o[0],a[0][1]=o[1],h=l3(o,t,!1)),l[0]=h.distance,c[0]=0;const p=[NaN,NaN];let f=!1,g=.25,y=-1,v=NaN;do if(v=NaN,a[1]=qX(t,WX(n[0],n[2],g),i,e),isNaN(a[1][0])||isNaN(a[1][1])||(h=l3(a[1],t,!1),v=h.distance),!isNaN(v)&&v>i&&CG(a[1],t))f=!0,l[1]=v,c[1]=zT(a[1],o);else if(!isNaN(v)&&v>y&&(y=v,p[0]=a[1][0],p[1]=a[1][1]),g-=.01,g<.1){if(!(y>=0))break;f=!0,l[1]=y,a[1][0]=p[0],a[1][1]=p[1],c[1]=zT(a[1],o)}while(!f);f=!1,g=.5,y=-1;let b=.01,w=1;do if(v=NaN,a[2]=qX(t,WX(n[0],n[2],g),i,e),isNaN(a[2][0])||isNaN(a[2][1])||(h=l3(a[2],t,!1),v=h.distance),!isNaN(v)&&v>i&&CG(a[2],t))f=!0,l[2]=v,c[2]=zT(a[2],o);else if(!isNaN(v)&&v>y)y=v,p[0]=a[2][0],p[1]=a[2][1];else if(v>y&&(y=v,p[0]=a[2][0],p[1]=a[2][1]),g=.5+b*w,b+=.01,w*=-1,g<.3||g>.7){if(!(y>=0))break;f=!0,l[2]=y,a[2][0]=p[0],a[2][1]=p[1],c[2]=zT(a[2],o)}while(!f);f=!1,g=.75,y=-1;do if(v=NaN,a[3]=qX(t,WX(n[0],n[2],g),i,e),isNaN(a[3][0])||isNaN(a[3][1])||(h=l3(a[3],t,!1),v=h.distance),!isNaN(v)&&v>i&&CG(a[3],t))f=!0,l[3]=v,c[3]=zT(a[3],o);else if(v>y&&(y=v,p[0]=a[3][0],p[1]=a[3][1]),g+=.01,g>.9){if(!(y>=0))break;f=!0,l[3]=y,a[3][0]=p[0],a[3][1]=p[1],c[3]=zT(a[3],o)}while(!f);const x=[0,1,2,3],S=u?0:1;let E;for(let F=S;F<4;F++)for(let D=S;D<3;D++){const z=c[D],B=c[D+1];tOt(z,B)>0&&(E=x[D],x[D]=x[D+1],x[D+1]=E,c[D]=B,c[D+1]=z)}let C=S,R=0,I=0;for(let F=S;F<4;F++){switch(F){case 0:I=2*l[x[F]];break;case 1:I=1.66666666*l[x[F]];break;case 2:I=1.33333333*l[x[F]];break;case 3:I=l[x[F]]}I>R&&(R=I,C=x[F])}return a[C]}function CG(t,e){let i,r,s,n,o=0;for(e.reset();e.nextPath()&&e.nextPoint();)for(i=e.x,r=e.y;e.nextPoint();i=s,r=n)s=e.x,n=e.y,r>t[1]!=n>t[1]&&((s-i)*(t[1]-r)-(n-r)*(t[0]-i)>0?o++:o--);return o!==0}function l3(t,e,i){if(i&&CG(t,e))return{coord:t,distance:0};let r=1/0,s=0,n=0,o=[0,0],a=[0,0];const l=[0,0];for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(o[0]=e.x,o[1]=e.y;e.nextPoint();o=a){a=[e.x,e.y],Ftt(l,t,o,a);const c=zT(t,l);c<r&&(r=c,s=l[0],n=l[1])}return{coord:[s,n],distance:Math.sqrt(r)}}function qX(t,e,i,r){const s=[e,0];let n=1/0,o=1/0,a=!1,l=!1;const c=[[e,r[1]-1],[e,r[3]+1]],u=[0,0],h=[0,0],p=[0,0],f=[[0,0],[0,0]],g=li();for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(f[0][0]=t.x,f[0][1]=t.y;t.nextPoint();f[0][0]=f[1][0],f[0][1]=f[1][1]){if(f[1][0]=t.x,f[1][1]=t.y,KPt(g,f)===null||(h[0]=c[0][0],h[1]=c[0][1],p[0]=c[1][0],p[1]=c[1][1],eOt(g,h,p)===0)||!aj(c[0],c[1],f[0],f[1],u))continue;const y=u[1];n>o?y<n&&(n=y,a=!0):y<o&&(o=y,l=!0)}return a&&l?s[1]=(n+o)/2:s[0]=s[1]=NaN,s}function KPt(t,e){if(e.length<2)return null;t||(t=li());const[i,r]=e[0],[s,n]=e[1];return t[0]=Math.min(i,s),t[1]=Math.min(r,n),t[2]=Math.max(i,s),t[3]=Math.max(r,n),t}const tB=1,iB=4,Lwe=3,Dwe=12;function eOt(t,e,i){let r=kg(e,t),s=kg(i,t);const n=t[0],o=t[1],a=t[2],l=t[3];if(r&s)return 0;if(!(r|s))return 4;const c=(r?1:0)|(s?2:0);do{const u=i[0]-e[0],h=i[1]-e[1];if(u>h)r&Lwe?(r&tB?(e[1]+=h*(n-e[0])/u,e[0]=n):(e[1]+=h*(a-e[0])/u,e[0]=a),r=kg(e,t)):s&Lwe?(s&tB?(i[1]+=h*(n-i[0])/u,i[0]=n):(i[1]+=h*(a-i[0])/u,i[0]=a),s=kg(i,t)):r?(r&iB?(e[0]+=u*(o-e[1])/h,e[1]=o):(e[0]+=u*(l-e[1])/h,e[1]=l),r=kg(e,t)):(s&iB?(i[0]+=u*(o-i[1])/h,i[1]=o):(i[0]+=u*(l-i[1])/h,i[1]=l),s=kg(i,t));else if(r&Dwe?(r&iB?(e[0]+=u*(o-e[1])/h,e[1]=o):(e[0]+=u*(l-e[1])/h,e[1]=l),r=kg(e,t)):s&Dwe?(s&iB?(i[0]+=u*(o-i[1])/h,i[1]=o):(i[0]+=u*(l-i[1])/h,i[1]=l),s=kg(i,t)):r?(r&tB?(e[1]+=h*(n-e[0])/u,e[0]=n):(e[1]+=h*(a-e[0])/u,e[0]=a),r=kg(e,t)):(s&tB?(i[1]+=h*(n-i[0])/u,i[0]=n):(i[1]+=h*(a-i[0])/u,i[0]=a),s=kg(i,t)),r&s)return 0}while(r|s);return c}function kg(t,e){return(t[0]<e[0]?1:0)|(t[0]>e[2]?1:0)<<1|(t[1]<e[1]?1:0)<<2|(t[1]>e[3]?1:0)<<3}function WX(t,e,i){return t+(e-t)*i}function zT(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function tOt(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;const i=isNaN(t),r=isNaN(e);return i<r?-1:i>r?1:0}let Sze=class vL{static local(){return vL.instance===null&&(vL.instance=new vL),vL.instance}execute(e,i,r,s,n){return new iOt(e,i,r)}};Sze.instance=null;let iOt=class{constructor(e,i,r){this._geometryCursor=e,this._offsetX=i.offsetX!==void 0?i.offsetX*r:0,this._offsetY=i.offsetY!==void 0?i.offsetY*r:0,this._method=i.method!==void 0?i.method:tP.OnPolygon,this._internalPlacement=new i$}next(){const e=this._geometryCursor;return this._geometryCursor=null,e?this._polygonCenter(e):null}_polygonCenter(e){let i=!1;switch(this._method){case tP.CenterOfMass:{const r=Wtt(e);r&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),i=!0)}break;case tP.BoundingBoxCenter:{const r=Lq(e);r&&(this._internalPlacement.setTranslate((r[2]+r[0])/2+this._offsetX,(r[3]+r[1])/2+this._offsetY),i=!0)}break;case tP.OnPolygon:default:{const r=QPt(e);r!==null&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),i=!0)}}return i?this._internalPlacement:null}};function rOt(t){if(!t)return null;switch(t.type){case"CIMGeometricEffectAddControlPoints":return QBe.local();case"CIMGeometricEffectArrow":return KBe.local();case"CIMGeometricEffectBuffer":return eze.local();case"CIMGeometricEffectControlMeasureLine":return tze.local();case"CIMGeometricEffectCut":return ize.local();case"CIMGeometricEffectDashes":return lze.local();case"CIMGeometricEffectDonut":return cze.local();case"CIMGeometricEffectJog":return uze.local();case"CIMGeometricEffectMove":return hze.local();case"CIMGeometricEffectOffset":return dze.local();case"CIMGeometricEffectReverse":return pze.local();case"CIMGeometricEffectRotate":return fze.local();case"CIMGeometricEffectScale":return mze.local();case"CIMGeometricEffectWave":return gze.local()}return null}function sOt(t){if(!t)return null;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":return yze.local();case"CIMMarkerPlacementAtExtremities":return _ze.local();case"CIMMarkerPlacementAtRatioPositions":return vze.local();case"CIMMarkerPlacementInsidePolygon":return bze.local();case"CIMMarkerPlacementOnLine":return wze.local();case"CIMMarkerPlacementOnVertices":return xze.local();case"CIMMarkerPlacementPolygonCenter":return Sze.local()}return null}function YX(t){const e=t.getFrame(0);if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)return e;const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const r=i.getContext("2d");return e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0),i}let nOt=class Tze{constructor(e=0,i=0,r=0,s=0){this.x=e,this.y=i,this.width=r,this.height=s}static fromExtent(e){return new Tze(e.xmin,-e.ymax,e.xmax-e.xmin,e.ymax-e.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}};function oOt(t){return`rgb(${t.slice(0,3).toString()})`}function XX(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}let Eze=class{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,i){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,s=r.getContext("2d",{willReadFrequently:!0});rB(s,i),this._parameters=i,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:n,weight:o}=i.font;this._lineThroughWidthOffset=n&&n==="line-through"?.1*this._lineHeight:0;const a=i.backgroundColor!=null||i.borderLine!=null,l=a?Fft:0,c=this._computeTextWidth(s,i)+2*l,u=this._lineHeight*this._textLines.length+2*l;if(r.width=c+2*this._lineThroughWidthOffset,r.height=u,r.width===0||r.height===0)return r.width=r.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:r};this._renderedLineHeight=Math.round(this._lineHeight*i.pixelRatio),this._renderedHaloSize=Yn(i.halo.size)*i.pixelRatio,this._renderedWidth=c*i.pixelRatio,this._renderedHeight=u*i.pixelRatio,this._lineThroughWidthOffset*=i.pixelRatio;const h=i.color??[0,0,0,0],p=i.halo&&i.halo.color?i.halo.color:[0,0,0,0];this._fillStyle=XX(h),this._haloStyle=oOt(p);const f=this._renderedLineHeight,g=this._renderedHaloSize;s.save(),s.clearRect(0,0,r.width,r.height),rB(s,i);const y=l*i.pixelRatio,v=aOt(s.textAlign,this._renderedWidth-2*y)+g+y,b=g+y,w=g>0;let x=this._lineThroughWidthOffset,S=0;if(a){s.save();const z=i.backgroundColor??[0,0,0,0],B=i.borderLine?.color??[0,0,0,0],Y=2*Yn(i.borderLine?.size??0);s.fillStyle=XX(z),s.strokeStyle=XX(B),s.lineWidth=Y,s.fillRect(0,0,r.width,r.height),s.strokeRect(0,0,r.width,r.height),s.restore()}w&&this._renderHalo(s,v,b,x,S,i),S+=b,x+=v;for(const z of this._textLines)w?(s.globalCompositeOperation="destination-out",s.fillStyle="rgb(0, 0, 0)",s.fillText(z,x,S),s.globalCompositeOperation="source-over",s.fillStyle=this._fillStyle,s.fillText(z,x,S)):(s.fillStyle=this._fillStyle,s.fillText(z,x,S)),n&&n!=="none"&&this._renderDecoration(s,x,S,n,o),S+=f;s.restore();const E=this._renderedWidth+2*this._lineThroughWidthOffset,C=this._renderedHeight,R=s.getImageData(0,0,E,C),I=new Uint8Array(R.data);if(i.premultiplyColors){let z;for(let B=0;B<I.length;B+=4)z=I[B+3]/255,I[B]=I[B]*z,I[B+1]=I[B+1]*z,I[B+2]=I[B+2]*z}let F,D;switch(i.horizontalAlignment){case"left":F=-.5;break;case"right":F=.5;break;default:F=0}switch(i.verticalAlignment){case"bottom":D=-.5;break;case"top":D=.5;break;case"baseline":D=-1/6;break;default:D=0}return{size:[E,C],image:new Uint32Array(I.buffer),sdf:!1,simplePattern:!1,anchorX:F,anchorY:D,canvas:r}}_renderHalo(e,i,r,s,n,o){const a=this._renderedWidth,l=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=a,this._haloRasterizationCanvas.height=l;const c=this._haloRasterizationCanvas,u=c.getContext("2d");u.clearRect(0,0,a,l),rB(u,o);const{decoration:h,weight:p}=o.font;u.fillStyle=this._haloStyle,u.strokeStyle=this._haloStyle,u.lineJoin="round",this._renderHaloNative(u,i,r,h,p),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(c,0,0,a,l,s,n,a,l),e.globalAlpha=1}_renderHaloNative(e,i,r,s,n){const o=this._renderedLineHeight,a=this._renderedHaloSize;for(const l of this._textLines){const c=2*a,u=5,h=.1;for(let p=0;p<u;p++){const f=(1-(u-1)*h+p*h)*c;e.lineWidth=f,e.strokeText(l,i,r),s&&s!=="none"&&this._renderDecoration(e,i,r,s,n,f)}r+=o}}computeTextSize(e,i){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,s=r.getContext("2d");rB(s,i),this._parameters=i,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const n=this._computeTextWidth(s,i),o=this._lineHeight*this._textLines.length;return r.width=n,r.height=o,[n*i.pixelRatio,o*i.pixelRatio]}_computeTextWidth(e,i){let r=0;for(const n of this._textLines)r=Math.max(r,e.measureText(n).width);const s=i.font;return(s.style==="italic"||s.style==="oblique"||typeof s.weight=="string"&&(s.weight==="bold"||s.weight==="bolder")||typeof s.weight=="number"&&s.weight>600)&&(r+=.3*e.measureText("w").width),r+=2*Yn(this._parameters.halo.size),Math.round(r)}_computeLineHeight(){let e=1.275*this._parameters.size;const i=this._parameters.font.decoration;return i&&i==="underline"&&(e*=1.3),Math.round(e+2*Yn(this._parameters.halo.size))}_renderDecoration(e,i,r,s,n,o){const a=.9*this._lineHeight,l=n==="bold"?.06:n==="bolder"?.09:.04;switch(e.textAlign){case"center":i-=this._renderedWidth/2;break;case"right":i-=this._renderedWidth}const c=e.textBaseline;if(s==="underline")switch(c){case"top":r+=a;break;case"middle":r+=a/2}else if(s==="line-through")switch(c){case"top":r+=a/1.5;break;case"middle":r+=a/3}const u=o?1.5*o:Math.ceil(a*l);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=u,e.moveTo(i-this._lineThroughWidthOffset,r),e.lineTo(i+this._renderedWidth+2*this._lineThroughWidthOffset,r),e.stroke(),e.restore()}};function rB(t,e){const i=Math.max(e.size,.5),r=e.font,s=`${r.style} ${r.weight} ${Yn(i*e.pixelRatio).toFixed(1)}px ${r.family}, sans-serif`;let n;switch(t.font=s,t.textBaseline="top",e.horizontalAlignment){case"left":default:n="left";break;case"right":n="right";break;case"center":n="center"}t.textAlign=n}function aOt(t,e){return t==="center"?.5*e:t==="right"?e:0}const n1i=512,o1i=29,a1i=24;var Fwe;(function(t){t[t.FilterFlags=0]="FilterFlags",t[t.Animation=1]="Animation",t[t.GPGPU=2]="GPGPU",t[t.VV=3]="VV",t[t.DD0=4]="DD0",t[t.DD1=5]="DD1",t[t.DD2=6]="DD2"})(Fwe||(Fwe={}));const l1i=1.05,c1i=5,u1i=6,h1i=1.15,d1i=2,p1i=10,lOt=1024,f1i=256,m1i=32,g1i=512;function cOt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function uOt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function hOt(t,e,i,r,s,n,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t}function dOt(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=i*n-r*s;return l?(l=1/l,t[0]=n*l,t[1]=-r*l,t[2]=-s*l,t[3]=i*l,t[4]=(s*a-n*o)*l,t[5]=(r*o-i*a)*l,t):null}function pOt(t){return t[0]*t[3]-t[1]*t[2]}function Cze(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1],h=i[2],p=i[3],f=i[4],g=i[5];return t[0]=r*c+n*u,t[1]=s*c+o*u,t[2]=r*h+n*p,t[3]=s*h+o*p,t[4]=r*f+n*g+a,t[5]=s*f+o*g+l,t}function fOt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(i),u=Math.cos(i);return t[0]=r*u+n*c,t[1]=s*u+o*c,t[2]=r*-c+n*u,t[3]=s*-c+o*u,t[4]=a,t[5]=l,t}function mOt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r*c,t[1]=s*c,t[2]=n*u,t[3]=o*u,t[4]=a,t[5]=l,t}function gOt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=r*c+n*u+a,t[5]=s*c+o*u+l,t}function yOt(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function _Ot(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function vOt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function bOt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function wOt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function xOt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function Mze(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function SOt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function TOt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t}function EOt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function COt(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],u=e[2],h=e[3],p=e[4],f=e[5],g=ba();return Math.abs(i-l)<=g*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=g*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-u)<=g*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(n-h)<=g*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-p)<=g*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-f)<=g*Math.max(1,Math.abs(a),Math.abs(f))}const MOt=Cze,AOt=Mze;Object.freeze(Object.defineProperty({__proto__:null,add:xOt,copy:cOt,determinant:pOt,equals:COt,exactEquals:EOt,frob:wOt,fromRotation:yOt,fromScaling:_Ot,fromTranslation:vOt,identity:uOt,invert:dOt,mul:MOt,multiply:Cze,multiplyScalar:SOt,multiplyScalarAndAdd:TOt,rotate:fOt,scale:mOt,set:hOt,str:bOt,sub:AOt,subtract:Mze,translate:gOt},Symbol.toStringTag,{value:"Module"}));function ROt(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function POt(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function OOt(t,e,i,r,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function IOt(t,e){return new Float32Array(t,e,6)}function Aze(t,e,i,r){const s=e[r],n=e[r+1];t[r]=i[0]*s+i[2]*n+i[4],t[r+1]=i[1]*s+i[3]*n+i[5]}function $Ot(t,e,i,r=0,s=0,n=2){const o=s||e.length/n;for(let a=r;a<o;a++)Aze(t,e,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:POt,create:ROt,createView:IOt,fromValues:OOt,transform:Aze,transformMany:$Ot},Symbol.toStringTag,{value:"Module"}));const NOt=()=>oe.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var Gy,km;function y1i(t){if(!t)return Gy.Center;switch(t){case"Left":case"left":return Gy.Left;case"Right":case"right":return Gy.Right;case"Justify":return NOt().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),Gy.Center;case"Center":case"center":return Gy.Center}}function _1i(t){if(!t)return km.Center;switch(t){case"Top":case"top":return km.Top;case"Center":case"middle":return km.Center;case"Baseline":case"baseline":return km.Baseline;case"Bottom":case"bottom":return km.Bottom}}function v1i(t){switch(t){case Gy.Right:case"right":return-1;case Gy.Center:case"center":return 0;case Gy.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${t}`),0}}function b1i(t){switch(t){case km.Top:case"top":return 1;case km.Center:case"middle":return 0;case km.Bottom:case km.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${t}`),0}}(function(t){t[t.Left=-1]="Left",t[t.Center=0]="Center",t[t.Right=1]="Right"})(Gy||(Gy={})),function(t){t[t.Top=1]="Top",t[t.Center=0]="Center",t[t.Bottom=-1]="Bottom",t[t.Baseline=2]="Baseline"}(km||(km={}));const S2=Math.PI/180,Rze=.5,LOt=()=>oe.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");let VT=class py{constructor(e){this._t=e}static createIdentity(){return new py([1,0,0,0,1,0])}clone(){const e=this._t;return new py(e.slice())}transform(e){const i=this._t;return[i[0]*e[0]+i[1]*e[1]+i[2],i[3]*e[0]+i[4]*e[1]+i[5]]}static createScale(e,i){return new py([e,0,0,0,i,0])}scale(e,i){const r=this._t;return r[0]*=e,r[1]*=e,r[2]*=e,r[3]*=i,r[4]*=i,r[5]*=i,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,i){return new py([0,0,e,0,0,i])}translate(e,i){const r=this._t;return r[2]+=e,r[5]+=i,this}static createRotate(e){const i=Math.cos(e),r=Math.sin(e);return new py([i,-r,0,r,i,0])}rotate(e){return py.multiply(this,py.createRotate(e),this)}angle(){const e=this._t[0],i=this._t[3],r=Math.sqrt(e*e+i*i);return[e/r,i/r]}static multiply(e,i,r){const s=e._t,n=i._t,o=s[0]*n[0]+s[3]*n[1],a=s[1]*n[0]+s[4]*n[1],l=s[2]*n[0]+s[5]*n[1]+n[2],c=s[0]*n[3]+s[3]*n[4],u=s[1]*n[3]+s[4]*n[4],h=s[2]*n[3]+s[5]*n[4]+n[5],p=r._t;return p[0]=o,p[1]=a,p[2]=l,p[3]=c,p[4]=u,p[5]=h,r}invert(){const e=this._t;let i=e[0]*e[4]-e[1]*e[3];if(i===0)return new py([0,0,0,0,0,0]);i=1/i;const r=(e[1]*e[5]-e[2]*e[4])*i,s=(e[2]*e[3]-e[0]*e[5])*i,n=e[4]*i,o=-e[1]*i,a=-e[3]*i,l=e[0]*i;return new py([n,o,r,a,l,s])}},Pze=class{constructor(e,i){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new Tl(i$,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(i||VT.createIdentity()),this._sizeTransfos.push(i?i.scaleRatio():1)}setTransform(e,i){this._transfos=[e||VT.createIdentity()],this._sizeTransfos=[i||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,i){const r=i?e.scaleRatio():1;VT.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*r)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,i,r){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,i);break;case"CIMTextSymbol":this.drawTextSymbol(e,i,r)}}drawMultiLayerSymbol(e,i){if(!e||!i)return;const r=e.symbolLayers;if(!r)return;const s=e.effects;if(s&&s.length>0){const n=this.executeEffects(s,i);if(n){let o=n.next();for(;o;)this.drawSymbolLayers(r,o.asJSON()),o=n.next()}}else this.drawSymbolLayers(r,i)}executeEffects(e,i){const r=this._resourceManager.geometryEngine;let s=new iPt(Ro.fromJSONCIM(i));for(const n of e){const o=rOt(n);o&&(s=o.execute(s,n,this.geomUnitsPerPoint(),null,r))}return s}drawSymbolLayers(e,i){let r=e.length;for(;r--;){const s=e[r];if(!s||s.enable===!1)continue;const n=s.effects;if(n&&n.length>0){const o=this.executeEffects(n,i);if(o){let a=null;for(;(a=o.next())&&(this.drawSymbolLayer(s,a.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(s,i);if(this._earlyReturn)return}}drawSymbolLayer(e,i){switch(e.type){case"CIMSolidFill":this.drawSolidFill(i,e.color);break;case"CIMHatchFill":this.drawHatchFill(i,e);break;case"CIMPictureFill":this.drawPictureFill(i,e);break;case"CIMGradientFill":this.drawGradientFill(i,e);break;case"CIMSolidStroke":this.drawSolidStroke(i,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMPictureStroke":this.drawPictureStroke(i,e);break;case"CIMGradientStroke":this.drawGradientStroke(i,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,i)}}drawHatchFill(e,i){const r=kOt(i,e,this.geomUnitsPerPoint());r&&(this.pushClipPath(e),this.drawMultiLayerSymbol(i.lineSymbol,r),this.popClipPath())}drawPictureFill(e,i){}drawGradientFill(e,i){}drawPictureStroke(e,i){}drawGradientStroke(e,i){}drawMarkerLayer(e,i){const r=e.markerPlacement;if(r){const s=sOt(r);if(s){const n=r.type==="CIMMarkerPlacementInsidePolygon"||r.type==="CIMMarkerPlacementPolygonCenter"&&r.clipAtBoundary;n&&this.pushClipPath(i);const o=s.execute(Ro.fromJSONCIM(i),r,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(o){let a=null;for(;(a=o.next())&&(this.drawMarker(e,a),!this._earlyReturn););}n&&this.popClipPath()}}else{const s=this._placementPool.acquire();if(AO(i))s.tx=i.x,s.ty=i.y,this.drawMarker(e,s);else if(zc(i)){const n=nOe(i);n&&([s.tx,s.ty]=n,this.drawMarker(e,s))}else for(const n of i.points)if(s.tx=n[0],s.ty=n[1],this.drawMarker(e,s),this._earlyReturn)break;this._placementPool.release(s)}}drawMarker(e,i){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,i);break;case"CIMVectorMarker":this.drawVectorMarker(e,i)}}drawPictureMarker(e,i){if(!e)return;const r=this._resourceManager.getResource(e.url),s=Hi(e.size,WP.CIMPictureMarker.size);if(r==null||s<=0)return;const n=r.width,o=r.height;if(!n||!o)return;const a=n/o,l=Hi(e.scaleX,1),c=VT.createIdentity(),u=e.anchorPoint;if(u){let v=u.x,b=u.y;e.anchorPointUnits!=="Absolute"&&(v*=s*a*l,b*=s),c.translate(-v,-b)}let h=Hi(e.rotation);e.rotateClockwise&&(h=-h),this._mapRotation&&(h+=this._mapRotation),h&&c.rotate(h*S2);let p=Hi(e.offsetX),f=Hi(e.offsetY);if(p||f){if(this._mapRotation){const v=S2*this._mapRotation,b=Math.cos(v),w=Math.sin(v),x=p*w+f*b;p=p*b-f*w,f=x}c.translate(p,f)}const g=this.geomUnitsPerPoint();g!==1&&c.scale(g,g);const y=i.getAngle();y&&c.rotate(y),c.translate(i.tx,i.ty),this.push(c,!1),this.drawImage(e,s),this.pop()}drawVectorMarker(e,i){if(!e)return;const r=e.markerGraphics;if(!r)return;const s=Hi(e.size,WP.CIMVectorMarker.size),n=e.frame,o=n?n.ymax-n.ymin:0,a=s&&o?s/o:1,l=VT.createIdentity();n&&l.translate(.5*-(n.xmax+n.xmin),.5*-(n.ymax+n.ymin));const c=e.anchorPoint;if(c){let y=c.x,v=c.y;e.anchorPointUnits!=="Absolute"?n&&(y*=n.xmax-n.xmin,v*=n.ymax-n.ymin):(y/=a,v/=a),l.translate(-y,-v)}a!==1&&l.scale(a,a);let u=Hi(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*S2);let h=Hi(e.offsetX),p=Hi(e.offsetY);if(h||p){if(this._mapRotation){const y=S2*this._mapRotation,v=Math.cos(y),b=Math.sin(y),w=h*b+p*v;h=h*v-p*b,p=w}l.translate(h,p)}const f=this.geomUnitsPerPoint();f!==1&&l.scale(f,f);const g=i.getAngle();g&&l.rotate(g),l.translate(i.tx,i.ty),this.push(l,e.scaleSymbolsProportionally);for(const y of r){y?.symbol&&y.geometry||LOt().error("Invalid marker graphic",y);let v=y.textString;if(typeof v=="number"&&(v=v.toString()),this.drawSymbol(y.symbol,y.geometry,v),this._earlyReturn)break}this.pop()}drawTextSymbol(e,i,r){if(!e||!AO(i)||Hi(e.height,WP.CIMTextSymbol.height)<=0)return;const s=VT.createIdentity();let n=Hi(e.angle);n=-n,n&&s.rotate(n*S2);const o=Hi(e.offsetX),a=Hi(e.offsetY);(o||a)&&s.translate(o,a);const l=this.geomUnitsPerPoint();l!==1&&s.scale(l,l),s.translate(i.x,i.y),this.push(s,!1),this.drawText(e,r),this.pop()}},DOt=class extends Pze{constructor(e,i){super(e,i),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new nOt(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return Oq(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if(zc(e))this._processPath(e.rings,0);else if(Lm(e))this._processPath(e.paths,0);else if(Nm(e)){const i=T2(e);i&&this._processPath(i.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(e,i,r){if(!e||this._clipCount>0||r==null||r<=0)return;const s=Math.max(.5*this.transformSize(Hi(r,WP.CIMSolidStroke.width)),.5*Rze);if(zc(e))this._processPath(e.rings,s);else if(Lm(e))this._processPath(e.paths,s);else if(Nm(e)){const n=T2(e);n&&this._processPath(n.rings,s)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(e,i){zc(i)&&e.markerPlacement&&(e.markerPlacement.type==="CIMMarkerPlacementInsidePolygon"||e.markerPlacement.type==="CIMMarkerPlacementPolygonCenter"&&e.markerPlacement.clipAtBoundary)?this._processPath(i.rings,0):super.drawMarkerLayer(e,i)}drawHatchFill(e,i){this.drawSolidFill(e)}drawPictureFill(e,i){this.drawSolidFill(e)}drawGradientFill(e,i){this.drawSolidFill(e)}drawPictureStroke(e,i){this.drawSolidStroke(e,null,i.width)}drawGradientStroke(e,i){this.drawSolidStroke(e,null,i.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,i){const{url:r}=e,s=Hi(e.scaleX,1);let n=s*i,o=i;const a=this._resourceManager.getResource(r);if(a!=null){const l=a.height/a.width;n=s*(i?l>1?i:i/l:a.width),o=i?l>1?i*l:i:a.height}this._merge(this.transformPt([-n/2,-o/2]),0),this._merge(this.transformPt([-n/2,o/2]),0),this._merge(this.transformPt([n/2,-o/2]),0),this._merge(this.transformPt([n/2,o/2]),0)}drawText(e,i){if(!i||i.length===0)return;this._textRasterizer||(this._textRasterizer=new Eze);const r=Oze(e);let[s,n]=this._textRasterizer.computeTextSize(i,r);s=Sa(s),n=Sa(n);let o=0;switch(e.horizontalAlignment){case"Left":o=s/2;break;case"Right":o=-s/2}let a=0;switch(e.verticalAlignment){case"Bottom":a=n/2;break;case"Top":a=-n/2;break;case"Baseline":a=n/6}this._merge(this.transformPt([-s/2+o,-n/2+a]),0),this._merge(this.transformPt([-s/2+o,n/2+a]),0),this._merge(this.transformPt([s/2+o,-n/2+a]),0),this._merge(this.transformPt([s/2+o,n/2+a]),0)}_processPath(e,i){if(e)for(const r of e){const s=r?r.length:0;if(s>1){this._merge(this.transformPt(r[0]),i);for(let n=1;n<s;n++)this._merge(this.transformPt(r[n]),i)}}}_merge(e,i){e[0]-i<this._xmin&&(this._xmin=e[0]-i),e[0]+i>this._xmax&&(this._xmax=e[0]+i),e[1]-i<this._ymin&&(this._ymin=e[1]-i),e[1]+i>this._ymax&&(this._ymax=e[1]+i)}},FOt=class extends Pze{constructor(e,i,r,s){super(i,r),this._applyAdditionalRenderProps=s,this._colorSubstitutionHelper=new rPt,this._ctx=e}drawSolidFill(e,i){if(!e)return;if(zc(e))this._buildPath(e.rings,!0);else if(Lm(e))this._buildPath(e.paths,!0);else if(Nm(e))this._buildPath(T2(e).rings,!0);else{if(!Z2(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const r=this._ctx;r.fillStyle=typeof i=="string"?i:"rgba("+Math.round(i[0])+","+Math.round(i[1])+","+Math.round(i[2])+","+(i[3]??255)/255+")",r.fill("evenodd")}drawSolidStroke(e,i,r,s,n,o){if(!e||!i||r===0)return;if(zc(e))this._buildPath(e.rings,!0);else if(Lm(e))this._buildPath(e.paths,!1);else{if(!Nm(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(T2(e).rings,!0)}const a=this._ctx;a.strokeStyle=typeof i=="string"?i:"rgba("+Math.round(i[0])+","+Math.round(i[1])+","+Math.round(i[2])+","+(i[3]??255)/255+")",a.lineWidth=Math.max(this.transformSize(r),Rze),this._setCapStyle(s),this._setJoinStyle(n),a.miterLimit=o,a.stroke()}pushClipPath(e){if(this._ctx.save(),zc(e))this._buildPath(e.rings,!0);else if(Lm(e))this._buildPath(e.paths,!0);else{if(!Nm(e))return;this._buildPath(T2(e).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,i){const{colorSubstitutions:r,url:s,tintColor:n}=e,o=Hi(e.scaleX,1),a=this._resourceManager.getResource(s);if(a==null)return;let l=i*(a.width/a.height),c=i;i||(l=a.width,c=a.height);const u=PM(s)||"src"in a&&PM(a.src);let h="getFrame"in a?YX(a):a;r&&(h=this._colorSubstitutionHelper.applyColorSubstituition(h,r)),this._applyAdditionalRenderProps&&!u&&n&&(h=this._colorSubstitutionHelper.tintImageData(h,n));const p=this.transformPt([0,0]),[f,g]=this.getTransformAngle(),y=this.transformSize(1),v=this._ctx;v.save(),v.setTransform({m11:o*y*f,m12:o*y*g,m21:-y*g,m22:y*f,m41:p[0],m42:p[1]}),v.drawImage(h,-l/2,-c/2,l,c),v.restore()}drawText(e,i){if(!i||i.length===0)return;this._textRasterizer||(this._textRasterizer=new Eze);const r=Oze(e);r.size*=this.transformSize(Sa(1));const s=this._textRasterizer.rasterizeText(i,r);if(!s)return;const{size:n,anchorX:o,anchorY:a,canvas:l}=s,c=n[0]*(o+.5),u=n[1]*(a-.5),h=this._ctx,p=this.transformPt([0,0]),[f,g]=this.getTransformAngle(),y=1;h.save(),h.setTransform({m11:y*f,m12:y*g,m21:-y*g,m22:y*f,m41:p[0]-y*c,m42:p[1]+y*u}),h.drawImage(l,0,0),h.restore()}drawPictureFill(e,i){if(!e)return;let{colorSubstitutions:r,height:s,offsetX:n,offsetY:o,rotation:a,scaleX:l,tintColor:c,url:u}=i;const h=this._resourceManager.getResource(u);if(h==null)return;if(zc(e))this._buildPath(e.rings,!0);else if(Lm(e))this._buildPath(e.paths,!0);else if(Nm(e))this._buildPath(T2(e).rings,!0);else{if(!Z2(e))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const p=this._ctx,f=PM(u)||"src"in h&&PM(h.src);let g,y="getFrame"in h?YX(h):h;if(r&&(y=this._colorSubstitutionHelper.applyColorSubstituition(y,r)),this._applyAdditionalRenderProps){f||c&&(y=this._colorSubstitutionHelper.tintImageData(y,c)),g=p.createPattern(y,"repeat");const v=this.transformSize(1);a||(a=0),n?n*=v:n=0,o?o*=v:o=0,s&&(s*=v);const b=s?s/h.height:1,w=l&&s?l*s/h.width:1;if(a!==0||b!==1||w!==1||n!==0||o!==0){const x=new DOMMatrix;x.rotateSelf(0,0,-a).translateSelf(n,o).scaleSelf(w,b,1),g.setTransform(x)}}else g=p.createPattern(y,"repeat");p.save(),p.fillStyle=g,p.fill("evenodd"),p.restore()}drawPictureStroke(e,i){if(!e)return;let{colorSubstitutions:r,capStyle:s,joinStyle:n,miterLimit:o,tintColor:a,url:l,width:c}=i;const u=this._resourceManager.getResource(l);if(u==null)return;let h;if(zc(e))h=e.rings;else if(Lm(e))h=e.paths;else{if(!Nm(e))return Z2(e)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;h=T2(e).rings}c||(c=u.width);const p=PM(l)||"src"in u&&PM(u.src);let f="getFrame"in u?YX(u):u;r&&(f=this._colorSubstitutionHelper.applyColorSubstituition(f,r)),this._applyAdditionalRenderProps&&(p||a&&(f=this._colorSubstitutionHelper.tintImageData(f,a)));const g=Math.max(this.transformSize(Yn(c)),.5),y=g/f.width,v=this._ctx,b=v.createPattern(f,"repeat-y");let w,x;v.save(),this._setCapStyle(s),this._setJoinStyle(n),o!==void 0&&(v.miterLimit=o),v.lineWidth=g;for(let S of h)if(S=ee(S),zOt(S),S&&!(S.length<=1)){w=this.transformPt(S[0]);for(let E=1;E<S.length;E++){x=this.transformPt(S[E]);const C=UOt(w,x),R=new DOMMatrix;R.translateSelf(0,w[1]-g/2).scaleSelf(y,y,1).rotateSelf(0,0,90-C),b.setTransform(R),v.strokeStyle=b,v.beginPath(),v.moveTo(w[0],w[1]),v.lineTo(x[0],x[1]),v.stroke(),w=x}}v.restore()}_buildPath(e,i){const r=this._ctx;if(r.beginPath(),e)for(const s of e){const n=s?s.length:0;if(n>1){let o=this.transformPt(s[0]);r.moveTo(o[0],o[1]);for(let a=1;a<n;a++)o=this.transformPt(s[a]),r.lineTo(o[0],o[1]);i&&r.closePath()}}}_setCapStyle(e){switch(e){case tf.Butt:this._ctx.lineCap="butt";break;case tf.Round:this._ctx.lineCap="round";break;case tf.Square:this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case Ky.Bevel:this._ctx.lineJoin="bevel";break;case Ky.Round:this._ctx.lineJoin="round";break;case Ky.Miter:this._ctx.lineJoin="miter"}}};function kOt(t,e,i){let r=Hi(t.separation,WP.CIMHatchFill.separation)*i,s=Hi(t.rotation);if(r===0)return null;r<0&&(r=-r);let n=0;const o=.5*r;for(;n>o;)n-=r;for(;n<-o;)n+=r;const a=li();eit(a,e),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;s>180;)s-=180;for(;s<0;)s+=180;const c=Math.cos(s*S2),u=Math.sin(s*S2),h=-r*u,p=r*c;let f,g,y,v;n=Hi(t.offsetX)*i*u-Hi(t.offsetY)*i*c,f=y=Number.MAX_VALUE,g=v=-Number.MAX_VALUE;for(const R of l){const I=R[0],F=R[1],D=c*I+u*F,z=-u*I+c*F;f=Math.min(f,D),y=Math.min(y,z),g=Math.max(g,D),v=Math.max(v,z)}y=Math.floor(y/r)*r;let b=c*f-u*y-h*n/r,w=u*f+c*y-p*n/r,x=c*g-u*y-h*n/r,S=u*g+c*y-p*n/r;const E=1+Math.round((v-y)/r),C=[];for(let R=0;R<E;R++)b+=h,w+=p,x+=h,S+=p,C.push([[b,w],[x,S]]);return{paths:C}}function UOt(t,e){const i=e[0]-t[0],r=e[1]-t[1];return 180/Math.PI*Math.atan2(r,i)}const T2=t=>t?{spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:null;function Oze(t,e=1){const i=nze(t),r=sze(t.fontStyleName),s=t.fontFamilyName??Rde,{weight:n,style:o}=r,a=e*(t.height||5),l=EPt(t.horizontalAlignment),c=CPt(t.verticalAlignment),u=OD(t),h=OD(t.haloSymbol),p=h!=null?e*(t.haloSize??0):0,f=t.callout?.type==="CIMBackgroundCallout"?t.callout.backgroundSymbol:null,g=OD(f),y=Nse(f),v=$se(f);return{color:u,size:a,horizontalAlignment:l,verticalAlignment:c,font:{family:s,style:SPt(o),weight:TPt(n),decoration:i},halo:{size:p||0,color:h,style:o},backgroundColor:g,borderLine:y!=null&&v!=null?{size:y,color:v}:null,pixelRatio:1,premultiplyColors:!0}}const BOt=1e-4;function zOt(t){let e,i,r,s,n,o=t[0],a=1;for(;a<t.length;)e=t[a][0]-o[0],i=t[a][1]-o[1],s=e!==0?i/e:Math.PI/2,r!==void 0&&s-r<=BOt?(t.splice(a-1,1),o=n):(n=o,o=t[a],a++),r=s}const Ode=[252,146,31,255],VOt=[153,153,153,255],Ize={type:"esriSMS",style:"esriSMSCircle",size:6,color:Ode,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},$ze={type:"esriSLS",style:"esriSLSSolid",width:.75,color:Ode},Nze={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},GOt={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},jOt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},HOt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},qOt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},Lze=$0.fromJSON(Ize),Ide=Kd.fromJSON($ze),Dze=Gx.fromJSON(Nze),WOt=HI.fromJSON(GOt);function T1i(t){if(t==null)return null;switch(t.type){case"mesh":return null;case"point":case"multipoint":return Lze;case"polyline":return Ide;case"polygon":case"extent":return Dze}return null}$0.fromJSON(jOt);Kd.fromJSON(HOt);Gx.fromJSON(qOt);const E1i=Number.POSITIVE_INFINITY,$de=Math.PI,C1i=2*$de,YOt=128/$de,XOt=256/360,M1i=$de/180,ZOt=1/Math.LN2;function Fze(t,e){return(t%=e)>=0?t:t+e}function A1i(t){return Fze(t*YOt,256)}function R1i(t){return Fze(t*XOt,256)}function P1i(t){return Math.log(t)*ZOt}function O1i(t,e,i){return t*(1-i)+e*i}const JOt=8,QOt=14,KOt=16;function I1i(t){return JOt+Math.max((t-QOt)*KOt,0)}function $1i(t,e,i){let r,s,n,o=0;for(const a of i){r=a.length;for(let l=1;l<r;++l)s=a[l-1],n=a[l],s.y>e!=n.y>e&&((n.x-s.x)*(e-s.y)-(n.y-s.y)*(t-s.x)>0?o++:o--)}return o!==0}function N1i(t,e,i,r){let s,n,o,a;const l=r*r;for(const c of i){const u=c.length;if(!(u<2)){s=c[0].x,n=c[0].y;for(let h=1;h<u;++h){if(o=c[h].x,a=c[h].y,ktt(t,e,s,n,o,a)<l)return!0;s=o,n=a}}}return!1}function eIt(t,e,i,r,s,n,o){const a=Math.max(r,Math.min(e,n))-e,l=Math.max(s,Math.min(i,o))-i;return a*a+l*l<=t*t}function L1i(t,e){if(e===0||Number.isNaN(e))return t;const i=[],r=new ql(0,0),s=new ql(0,0),n=new ql(0,0);for(let o=0;o<t.length;o++){const a=t[o],l=[];for(let c=0;c<a.length;c++){const u=a[c-1],h=a[c],p=a[c+1];c===0?r.setCoords(0,0):r.assignSub(h,u).normalize().rightPerpendicular(),c===a.length-1?s.setCoords(0,0):s.assignSub(p,h).normalize().rightPerpendicular(),n.assignAdd(r,s).normalize();const f=n.x*s.x+n.y*s.y;f!==0&&n.scale(1/f),l.push(ql.add(h,n.scale(e)))}i.push(l)}return i}function D1i(t,e,i,r){const s=new ql(t[0],t[1]);if(s.scale(r),e==="viewport"){const n=-i*(Math.PI/180),o=Math.cos(n),a=Math.sin(n);s.rotate(o,a)}return s}const kze=Math.PI,tIt=kze/2,Ug=96/72,kwe=4,Y8=()=>oe.getLogger("esri.symbols.cim.CIMSymbolHelper");function MG(t,e,i){switch(e.type){case"CIMSymbolReference":return MG(t,e.symbol,i);case"CIMPointSymbol":i==null&&(i={x:0,y:0}),t.drawSymbol(e,i);break;case"CIMLineSymbol":i==null&&(i={paths:[[[0,0],[10,0]]]}),t.drawSymbol(e,i);break;case"CIMPolygonSymbol":i==null&&(i={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),t.drawSymbol(e,i);break;case"CIMTextSymbol":{const r={x:0,y:0};t.drawSymbol(e,r);break}case"CIMVectorMarker":{const r=new i$;t.drawMarker(e,r);break}}return t.envelope()}function iIt(t){if(!t)return 0;switch(t.type){case"CIMGeometricEffectArrow":return Math.abs(.5*t.width);case"CIMGeometricEffectBuffer":return Math.abs(t.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(t.length);case"CIMGeometricEffectJog":return Math.abs(.5*t.length);case"CIMGeometricEffectMove":return Math.max(Math.abs(Hi(t.offsetX)),Math.abs(Hi(t.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(t.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(t.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return .5*Math.max(Math.abs(t.fromWidth),Math.abs(t.toWidth));case"CIMGeometricEffectWave":return Math.abs(t.amplitude);case"CIMGeometricEffectDonut":return Math.abs(t.width)}}function F1i(t){if(!t)return 0;let e=0;for(const i of t)e+=iIt(i);return e}let ZX=class AG{static getEnvelope(e,i,r){if(!e)return null;const s=new DOt(r);if(Array.isArray(e)){let n;for(const o of e)n?n.union(MG(s,o,i)):n=MG(s,o,i);return n}return MG(s,e,i)}static getTextureAnchor(e,i){const r=this.getEnvelope(e,null,i);if(!r)return[0,0,0];const s=(r.x+.5*r.width)*Ug,n=(r.y+.5*r.height)*Ug,o=r.width*Ug+2,a=r.height*Ug+2;return[-s/o,-n/a,a]}static rasterize(e,i,r,s,n=!0){const o=r||this.getEnvelope(i,null,s);if(!o)return[null,0,0,0,0];const a=(o.x+.5*o.width)*Ug,l=(o.y+.5*o.height)*Ug;e.width=o.width*Ug,e.height=o.height*Ug,r||(e.width+=2,e.height+=2);const c=e.getContext("2d",{willReadFrequently:!0}),u=VT.createScale(Ug,-Ug);u.translate(.5*e.width-a,.5*e.height+l);const h=new FOt(c,s,u);switch(i.type){case"CIMPointSymbol":{const g={type:"point",x:0,y:0};h.drawSymbol(i,g);break}case"CIMVectorMarker":{const g=new i$;h.drawMarker(i,g);break}}const p=c.getImageData(0,0,e.width,e.height),f=new Uint8Array(p.data);if(n){let g;for(let y=0;y<f.length;y+=4)g=f[y+3]/255,f[y]=f[y]*g,f[y+1]=f[y+1]*g,f[y+2]=f[y+2]*g}return[f,e.width,e.height,-a/e.width,-l/e.height]}static fromTextSymbol(e){const{text:i}=e;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:AG.createCIMTextSymbolfromTextSymbol(e),textString:i}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(e){const{height:i,outline:r,width:s,xoffset:n,xscale:o,yoffset:a,yscale:l}=e,c=[],u={type:"CIMPolygonSymbol",symbolLayers:c};if(r){const y=Uwe(r);y&&c.push(y)}let h=e.url;e.type==="esriPFS"&&e.imageData&&(h=e.imageData);const p="angle"in e?e.angle??0:0,f=(s??0)*(o||1),g=(i??0)*(l||1);return c.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:iP.Picture,tintColor:null,url:h,height:g,width:f,offsetX:Hi(n),offsetY:Hi(a),rotation:Hi(-p),colorSubstitutions:null}),u}static fromSimpleFillSymbol(e){const{color:i,style:r,outline:s}=e,n=[],o={type:"CIMPolygonSymbol",symbolLayers:n};if(s){const a=Uwe(s);a&&n.push(a)}if(r&&r!=="solid"&&r!=="none"&&r!=="esriSFSSolid"&&r!=="esriSFSNull"){const a={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:rd(i),capStyle:tf.Butt,joinStyle:Ky.Miter,width:.75}]};let l=0;const c=Sa(lIt(r)?8:10);switch(r){case"vertical":case"esriSFSVertical":l=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":l=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":l=45;break;case"cross":case"esriSFSCross":l=0}n.push({type:"CIMHatchFill",lineSymbol:a,offsetX:0,offsetY:0,rotation:l,separation:c}),r==="cross"||r==="esriSFSCross"?n.push({type:"CIMHatchFill",lineSymbol:ee(a),offsetX:0,offsetY:0,rotation:90,separation:c}):r!=="diagonal-cross"&&r!=="esriSFSDiagonalCross"||n.push({type:"CIMHatchFill",lineSymbol:ee(a),offsetX:0,offsetY:0,rotation:45,separation:c})}else!r||r!=="solid"&&r!=="esriSFSSolid"||n.push({type:"CIMSolidFill",enable:!0,color:rd(i)});return o}static fromSimpleLineSymbol(e){const{cap:i,color:r,join:s,marker:n,miterLimit:o,style:a,width:l}=e;let c=null;a!=="solid"&&a!=="none"&&a!=="esriSLSSolid"&&a!=="esriSLSNull"&&(c=[{type:"CIMGeometricEffectDashes",dashTemplate:Dse(a,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const u=[];if(n){let h;switch(n.placement){case"begin-end":h=Qy.Both;break;case"begin":h=Qy.JustBegin;break;case"end":h=Qy.JustEnd;break;default:h=Qy.None}const p=AG.fromSimpleMarker(n,l,r).symbolLayers[0];p.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:h,offsetAlongLine:0},u.push(p)}return u.push({type:"CIMSolidStroke",color:a!=="none"&&a!=="esriSLSNull"?rd(r):[0,0,0,0],capStyle:Bze(i),joinStyle:zze(s),miterLimit:o,width:l,effects:c}),{type:"CIMLineSymbol",symbolLayers:u}}static fromPictureMarker(e){const{angle:i,height:r,width:s,xoffset:n,yoffset:o}=e;let a=e.url;return e.type==="esriPMS"&&e.imageData&&(a=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:iP.Picture,tintColor:null,url:a,size:r,width:s,offsetX:Hi(n),offsetY:Hi(o),rotation:Hi(-i)}]}}static createCIMTextSymbolfromTextSymbol(e){const{angle:i,color:r,font:s,haloColor:n,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:c,text:u,verticalAlignment:h,xoffset:p,yoffset:f,backgroundColor:g,borderLineColor:y,borderLineSize:v}=e;let b,w,x,S,E,C;s&&(b=s.family,w=s.style,x=s.weight,S=s.size,E=s.decoration);let R=!1;return u&&(R=jRt(u)[1]),(g||v)&&(C={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:rd(g)},{type:"CIMSolidStroke",color:rd(y),width:v}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:i,blockProgression:Rse.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:Cse.Normal,fontEncoding:Mse.Unicode,fontFamilyName:b||"Arial",fontStyleName:nIt(w,x),fontType:Ase.Unspecified,haloSize:o,height:S,hinting:Ose.Default,horizontalAlignment:rIt(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:c,offsetX:Hi(p),offsetY:Hi(f),strikethrough:E==="line-through",underline:E==="underline",symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:rd(r)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:rd(n)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:R?q8.RTL:q8.LTR,verticalAlignment:sIt(h??"baseline"),verticalGlyphOrientation:Ise.Right,wordSpacing:100,billboardMode3D:Pse.FaceNearPlane,callout:C}}static createPictureMarkerRasterizationParam(e){const{angle:i,height:r,width:s,xoffset:n,yoffset:o}=e,a=e.url??e.source?.url??e.source?.imageData;return a?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:iP.Picture,tintColor:null,url:a,size:r,width:s,offsetX:Hi(n),offsetY:Hi(o),rotation:Hi(-i)}}:null}static createPictureFillRasterizationParam(e){const{width:i,height:r,xoffset:s,yoffset:n,url:o}=e;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:iP.Picture,tintColor:null,url:o,width:i,height:r,offsetX:Hi(s),offsetY:Hi(n),rotation:0}}:null}static fromSimpleMarker(e,i,r){const{style:s}=e,n=e.color??r;if(s==="path"||s==="esriSMSPath"){const h=[];if("outline"in e&&e.outline){const g=e.outline;h.push({type:"CIMSolidStroke",enable:!0,width:g.width,color:rd(g.color),path:e.path})}h.push({type:"CIMSolidFill",enable:!0,color:rd(n),path:e.path});const[p,f]=c3("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-Hi(e.angle),size:Hi(e.size||6),offsetX:Hi(e.xoffset),offsetY:Hi(e.yoffset),scaleSymbolsProportionally:!1,frame:p,markerGraphics:[{type:"CIMMarkerGraphic",geometry:f,symbol:{type:"CIMPolygonSymbol",symbolLayers:h}}]}]}}const o=[];let a,l,c=e.size;if("outline"in e&&e.outline&&e.outline.style!=="none"&&e.outline.style!=="esriSLSNull"){const h=e.outline,p=h.style!=="solid"&&h.style!=="esriSLSSolid";[a,l]=p?c3(s,e.size):c3(s);const f=h.width??Ide.width;if(p){const v=f/e.size,b=(a.xmax-a.xmin)*v/2,w=(a.ymax-a.ymin)*v/2;a.xmin-=b,a.xmax+=b,a.ymin-=w,a.ymax+=w,c&&(c+=f)}const g=e.style!=="cross"&&e.style!=="x"||e?.outline.style==="dot"||e?.outline.style==="short-dot"?Gl.HalfGap:Gl.FullPattern,y=p?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:Dse(h.style,null).map(v=>h.width&&h.width>0?v*h.width:v),lineDashEnding:g,controlPointEnding:Gl.FullPattern}]:void 0;o.push({type:"CIMSolidStroke",capStyle:p?tf.Round:tf.Butt,enable:!0,width:f,color:rd(h.color),effects:y})}else!i||e.type!=="line-marker"||e.style!=="cross"&&e.style!=="x"?[a,l]=c3(s):([a,l]=c3(s),o.push({type:"CIMSolidStroke",enable:!0,width:i,color:rd(n)}));o.push({type:"CIMSolidFill",enable:!0,color:rd(n)});const u={type:"CIMPolygonSymbol",symbolLayers:o};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:Hi(-e.angle),size:Hi(c||6*i),offsetX:Hi(e.xoffset),offsetY:Hi(e.yoffset),scaleSymbolsProportionally:!1,frame:a,markerGraphics:[{type:"CIMMarkerGraphic",geometry:l,symbol:u}]}]}}static fromCIMHatchFill(e,i){const r=i*(e.separation??WP.CIMHatchFill.separation),s=r/2,n=ee(e.lineSymbol);n.symbolLayers?.forEach(l=>{switch(l.type){case"CIMSolidStroke":l.width!=null&&(l.width*=i),l.effects?.forEach(c=>{if(c.type==="CIMGeometricEffectDashes"){const u=c.dashTemplate;c.dashTemplate=u?.map(h=>h*i)}});break;case"CIMVectorMarker":{l.size!=null&&(l.size*=i);const c=l.markerPlacement;c!=null&&"placementTemplate"in c&&(c.placementTemplate=c.placementTemplate.map(u=>u*i));break}}});let o=this._getLineSymbolPeriod(n)||kwe;for(;o<kwe;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-s,ymax:s},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:n}],size:r}}static fetchResources(e,i,r,s=null){return e&&i&&Uze(e,n=>{cIt(n,i,r),"url"in n&&n.url&&r.push(i.fetchResource(n.url,{signal:s}))}),r}static fetchFonts(e,i,r){if(e&&i){if("symbolLayers"in e&&e.symbolLayers){for(const s of e.symbolLayers)if(s.type==="CIMVectorMarker"&&s.markerGraphics)for(const n of s.markerGraphics)n?.symbol&&AG.fetchFonts(n.symbol,i,r)}else if(e.type==="CIMTextSymbol"){const{fontFamilyName:s,fontStyleName:n}=e;if(!s||s.toLowerCase()==="calcitewebcoreicons")return;const{style:o,weight:a}=sze(n),l=nze(e),c=new qk({family:s,style:o,weight:a,decoration:l});r.push(i.loadFont(c).catch(()=>{Y8().error(`Unsupported font ${s} in CIM symbol`)}))}}}static _getLineSymbolPeriod(e){if(e){const i=this._getEffectsRepeat(e.effects);if(i)return i;if(e.symbolLayers){for(const r of e.symbolLayers)if(r){const s=this._getEffectsRepeat(r.effects);if(s)return s;switch(r.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const n=this._getPlacementRepeat(r.markerPlacement);if(n)return n}}}}}return 0}static _getEffectsRepeat(e){if(e){for(const i of e)if(i)switch(i.type){case"CIMGeometricEffectDashes":{const r=i.dashTemplate;if(r&&r.length){let s=0;for(const n of r)s+=n;return 1&r.length&&(s*=2),s}break}case"CIMGeometricEffectWave":return i.period;default:Y8().error(`unsupported geometric effect type ${i.type}`)}}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const i=e.placementTemplate;if(i&&i.length){let r=0;for(const s of i)r+=+s;return 1&i.length&&(r*=2),r}break}}return 0}static fromCIMInsidePolygon(e){const i=e.markerPlacement,r={...e};r.markerPlacement=null,r.anchorPoint=null;const s=Math.abs(i.stepX),n=Math.abs(i.stepY),o=(i.randomness??100)/100;let a,l,c,u;if(i.gridType==="Random"){const h=Sa(lOt),p=Math.max(Math.floor(h/s),1),f=Math.max(Math.floor(h/n),1);a=p*s/2,l=f*n/2,c=2*l;const g=new H2(i.seed),y=o*s/1.5,v=o*n/1.5;u=[];for(let b=0;b<p;b++)for(let w=0;w<f;w++){const x=b*s-a+y*(.5-g.getFloat()),S=w*n-l+v*(.5-g.getFloat());u.push({x,y:S}),b===0&&u.push({x:x+2*a,y:S}),w===0&&u.push({x,y:S+2*l})}}else i.shiftOddRows===!0?(a=s/2,l=n,c=2*n,u=[{x:-a,y:0},{x:a,y:0},{x:0,y:l},{x:0,y:-l}]):(a=s/2,l=n/2,c=n,u=[{x:-s,y:0},{x:0,y:-n},{x:-s,y:-n},{x:0,y:0},{x:s,y:0},{x:0,y:n},{x:s,y:n},{x:-s,y:n},{x:s,y:-n}]);return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-l,ymax:l},markerGraphics:u.map(h=>({type:"CIMMarkerGraphic",geometry:h,symbol:{type:"CIMPointSymbol",symbolLayers:[r]}})),size:c}}};function Uze(t,e){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const i=t.symbolLayers;if(!i)return;for(const r of i)if(e(r),r.type==="CIMVectorMarker"){const s=r.markerGraphics;if(!s)continue;for(const n of s)if(n){const o=n.symbol;o&&Uze(o,e)}}break}}}const Bze=t=>{if(!t)return tf.Butt;switch(t){case"butt":return tf.Butt;case"square":return tf.Square;case"round":return tf.Round}},zze=t=>{if(!t)return Ky.Miter;switch(t){case"miter":return Ky.Miter;case"round":return Ky.Round;case"bevel":return Ky.Bevel}},rIt=t=>{if(t==null)return"Center";switch(t){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},sIt=t=>{if(t==null)return"Center";switch(t){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},rd=t=>{if(!t)return[0,0,0,0];const{r:e,g:i,b:r,a:s}=t;return[e,i,r,255*s]},nIt=(t,e)=>{const i=oIt(e),r=aIt(t);return i&&r?`${i}-${r}`:`${i}${r}`},oIt=t=>{if(!t)return"";switch(t.toLowerCase()){case"bold":case"bolder":return"bold"}return""},aIt=t=>{if(!t)return"";switch(t.toLowerCase()){case"italic":case"oblique":return"italic"}return""},Dse=(t,e)=>{const i=ae("safari")?.001:0,r=e==="butt";switch(t){case"dash":case"esriSLSDash":return r?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return r?[4,3,1,3]:[3,4,i,4];case"dot":case"esriSLSDot":return r?[1,3]:[i,4];case"long-dash":case"esriSLSLongDash":return r?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return r?[8,3,1,3]:[7,4,i,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return r?[8,3,1,3,1,3]:[7,4,i,4,i,4];case"short-dash":case"esriSLSShortDash":return r?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return r?[4,1,1,1]:[3,2,i,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return r?[4,1,1,1,1,1]:[3,2,i,2,i,2];case"short-dot":case"esriSLSShortDot":return r?[1,1]:[i,2];case"solid":case"esriSLSSolid":case"none":return Y8().error("Unexpected: style does not require rasterization"),[0,0];default:return Y8().error(`Tried to rasterize SLS, but found an unexpected style: ${t}!`),[0,0]}},c3=(t,e=100)=>{const i=e/2;let r,s;const n=t;if(n==="circle"||n==="esriSMSCircle"){let a=Math.acos(1-.25/i),l=Math.ceil(kze/a/4);l===0&&(l=1),a=tIt/l,l*=4;const c=[];c.push([i,0]);for(let u=1;u<l;u++)c.push([i*Math.cos(u*a),-i*Math.sin(u*a)]);c.push([i,0]),r={rings:[c]},s={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if(n==="cross"||n==="esriSMSCross")r={paths:[[[0,i],[0,-i]],[[i,0],[-i,0]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="diamond"||n==="esriSMSDiamond")r={rings:[[[-i,0],[0,i],[i,0],[0,-i],[-i,0]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="square"||n==="esriSMSSquare")r={rings:[[[-i,-i],[-i,i],[i,i],[i,-i],[-i,-i]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="x"||n==="esriSMSX")r={paths:[[[i,i],[-i,-i]],[[i,-i],[-i,i]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="triangle"||n==="esriSMSTriangle"){const o=e*.5773502691896257,a=-o,l=2/3*e,c=l-e;r={rings:[[[a,c],[0,l],[o,c],[a,c]]]},s={xmin:a,ymin:c,xmax:o,ymax:l}}else n==="arrow"&&(r={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i});return[s,r]},lIt=t=>t==="vertical"||t==="horizontal"||t==="cross"||t==="esriSFSCross"||t==="esriSFSVertical"||t==="esriSFSHorizontal";function cIt(t,e,i){if(!(!t.effects||e.geometryEngine!=null)){if(e.geometryEnginePromise)return void i.push(e.geometryEnginePromise);wPt(t.effects)&&(e.geometryEnginePromise=xPt(),i.push(e.geometryEnginePromise),e.geometryEnginePromise.then(r=>e.geometryEngine=r))}}function Uwe(t){if(!t)return null;let e=null;const{cap:i,color:r,join:s,miterLimit:n,style:o,width:a}=t;return o!=="solid"&&o!=="none"&&o!=="esriSLSSolid"&&o!=="esriSLSNull"&&(e=[{type:"CIMGeometricEffectDashes",dashTemplate:Dse(o,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:o!=="esriSLSNull"&&o!=="none"?rd(r):[0,0,0,0],capStyle:Bze(i),joinStyle:zze(s),miterLimit:n,width:a,effects:e}}function Vze(t,e,i,r,s){if(t==null)return null;const n=t.referencesGeometry()&&s?uIt(e,r,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...i,$feature:o},t.services)}catch(a){return oe.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const JX=new Map;function uIt(t,e,i){const{transform:r,hasZ:s,hasM:n}=i;JX.has(e)||JX.set(e,hIt(e));const o=JX.get(e)(t.geometry,r,s,n);return{...t,geometry:o}}function hIt(t){const e={};switch(t){case"esriGeometryPoint":return(i,r,s,n)=>S5e(r,e,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>T5e(r,e,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>E5e(r,e,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>x5e(r,e,i,s,n);default:return oe.getLogger("esri.views.2d.support.arcadeOnDemand").error(new j("mapview-arcade",`Unable to handle geometryType: ${t}`)),i=>i}}const dIt=t=>{if(!t)return[0,0,0,0];const{r:e,g:i,b:r,a:s}=t;return[e,i,r,255*s]};let rP=class Gn{static findApplicableOverrides(e,i,r){if(e&&i){if(e.primitiveName){let s=!1;for(const n of r)if(n.primitiveName===e.primitiveName){s=!0;break}if(!s)for(const n of i)n.primitiveName===e.primitiveName&&r.push(n)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)Gn.findApplicableOverrides(s,i,r);if(e.symbolLayers)for(const s of e.symbolLayers)Gn.findApplicableOverrides(s,i,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const s of e.effects)Gn.findApplicableOverrides(s,i,r);if(e.markerPlacement&&Gn.findApplicableOverrides(e.markerPlacement,i,r),e.type==="CIMVectorMarker"){if(e.markerGraphics)for(const s of e.markerGraphics)Gn.findApplicableOverrides(s,i,r),Gn.findApplicableOverrides(s.symbol,i,r)}else e.type==="CIMCharacterMarker"?Gn.findApplicableOverrides(e.symbol,i,r):e.type==="CIMHatchFill"?Gn.findApplicableOverrides(e.lineSymbol,i,r):e.type==="CIMPictureMarker"&&Gn.findApplicableOverrides(e.animatedSymbolProperties,i,r)}}}static findEffectOverrides(e,i){if(!e)return null;if(e.type==="CIMGeometricEffectDashes"&&oze(e),!i||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const r=Rwe(e),s=e.primitiveName,n=[];for(const o of i)o.primitiveName===s&&n.push(Rwe(o));return{type:"cim-effect-param",effect:r,overrides:APt(n)}}static async resolveSymbolOverrides(e,i,r,s,n,o,a){if(!e?.symbol)return null;let{symbol:l,primitiveOverrides:c}=e;const u=!!c;if(!u&&!s)return l;l=ee(l),c=ee(c);let h=!0;if(i||(i={attributes:{}},h=!1),u){if(h||(c=c.filter(p=>!p.valueExpressionInfo?.expression.includes("$feature"))),a||(c=c.filter(p=>!p.valueExpressionInfo?.expression.includes("$view"))),c.length>0){const p={spatialReference:r,fields:MPt(i.attributes),geometryType:n};await Gn.createRenderExpressions(c,p),Gn.evaluateOverrides(c,i,n??"esriGeometryPoint",o,a)}Gn.applyOverrides(l,c)}return s&&Gn.applyDictionaryTextOverrides(l,i,s,null),l}static async createRenderExpressions(e,i){const r=[];for(const s of e){const n=s.valueExpressionInfo;if(!n||Gn._expressionToRenderExpression.has(n.expression))continue;const o=oLe(n.expression,i.spatialReference,i.fields);r.push(o),o.then(a=>Gn._expressionToRenderExpression.set(n.expression,a))}r.length>0&&await Promise.all(r)}static evaluateOverrides(e,i,r,s,n){const o={$view:{scale:n?.scale}};for(const a of e){a.value&&typeof a.value=="object"&&vDe(a.value)&&(a.propertyName==="Color"||a.propertyName==="StrokeColor")&&(a.value=dIt(a.value));const l=a.valueExpressionInfo;if(!l)continue;const c=Gn._expressionToRenderExpression.get(l.expression);c&&(a.value=Vze(c,i,o,r,s))}}static applyDictionaryTextOverrides(e,i,r,s,n="Normal"){if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const o=e.symbolLayers;if(!o)return;for(const a of o)a&&a.type==="CIMVectorMarker"&&Gn.applyDictionaryTextOverrides(a,i,r,s,e.type==="CIMTextSymbol"?e.textCase:n)}break;case"CIMVectorMarker":{const o=e.markerGraphics;if(!o)return;for(const a of o)a&&Gn.applyDictionaryTextOverrides(a,i,r,s)}break;case"CIMMarkerGraphic":{const o=e.textString;if(o&&o.includes("[")){const a=fPt(o,r);e.textString=mPt(i,a,s,n)}}}}static applyOverrides(e,i,r,s){if(e.primitiveName){for(const n of i)if(n.primitiveName===e.primitiveName){const o=Pde(n.propertyName);if(s&&s.push({cim:e,nocapPropertyName:o,value:e[o]}),r){let a=!1;for(const l of r)l.primitiveName===e.primitiveName&&(a=!0);a||r.push(n)}n.value!=null&&(e[o]=n.value)}}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)Gn.applyOverrides(n,i,r,s);if(e.symbolLayers)for(const n of e.symbolLayers)Gn.applyOverrides(n,i,r,s);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const n of e.effects)Gn.applyOverrides(n,i,r,s);if(e.type==="CIMVectorMarker"&&e.markerGraphics)for(const n of e.markerGraphics)Gn.applyOverrides(n,i,r,s),Gn.applyOverrides(n.symbol,i,r,s)}}static restoreOverrides(e){for(const i of e)i.cim[i.nocapPropertyName]=i.value}static buildOverrideKey(e){let i="";for(const r of e)r.value!==void 0&&(i+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return i}static toValue(e,i){if(e==="DashTemplate")return i.split(" ").map(r=>Number(r));if(e==="Color"){const r=new Ke(i).toRgba();return r[3]*=255,r}return i}};rP._expressionToRenderExpression=new Map;function Nde(t,e,i,r){if(t)if(t.type!=="CIMTextSymbol"){if(i&&t.effects)for(const s of t.effects)mIt(s,e);if(t.symbolLayers)for(const s of t.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":pIt(s,e,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!r?.preserveOutlineWidth&&s.width&&(s.width*=e);break;case"CIMPictureFill":s.height&&(s.height*=e),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e);break;case"CIMHatchFill":Nde(s.lineSymbol,e,!0,{...r,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e),s.separation&&(s.separation*=e)}}else t.height!=null&&(t.height*=e)}function pIt(t,e,i){if(t&&(t.markerPlacement&&fIt(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const r of t.markerGraphics)t.scaleSymbolsProportionally||Nde(r.symbol,e,!0,i)}function fIt(t,e){switch(rze(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function mIt(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const i=t.dashTemplate.map(r=>r*e);t.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function gIt(t){const e=[];return Fse(_Pt(t),e),e.length?new Ke(yPt(e[0])):null}function Fse(t,e){if(!t)return;let i;i=t.type==="CIMTextSymbol"?t.symbol:t;const r=t.type==="CIMPolygonSymbol";if(i?.symbolLayers){for(const s of i.symbolLayers)if(!(s.colorLocked||r&&(bPt(s)||vPt(s)&&s.markerPlacement&&rze(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&Bwe(e,s.tintColor);break;case"CIMVectorMarker":s.markerGraphics?.forEach(n=>{Fse(n.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":Bwe(e,s.color);break;case"CIMHatchFill":Fse(s.lineSymbol,e)}}}function Bwe(t,e){for(const i of t)if(i.join(".")===e.join("."))return;t.push(e)}var zwe,Vwe,Gze={exports:{}};Vwe=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:X0},u=X0,h="none",p=")",f=",",g="(",y="%",v="px",b="cm",w="mm",x="in",S="pt",E="pc",C="deg",R="rad",I="grad",F="turn",D="#",z=".",B="e",Y=/^[ \t\n\r]/,W=/^[a-z\-]/,J=/^[0-9a-fA-F]/,me=/^[+\-]/,L=/^[0-9]/,k=Qc("none"),H=ea("none",!1),q=ea(")",!1),Q=ea(",",!1),K=Qc("whitespace"),re=iS([" ","	",`
`,"\r"],!1,!1),be=Qc("function"),Re=ea("(",!1),je=Qc("identifier"),_t=iS([["a","z"],"-"],!1,!1),ht=Qc("percentage"),ut=ea("%",!1),lt=Qc("length"),at=ea("px",!1),bi=ea("cm",!1),gi=ea("mm",!1),We=ea("in",!1),ii=ea("pt",!1),Ye=ea("pc",!1),He=Qc("angle"),Lt=ea("deg",!1),kt=ea("rad",!1),Kt=ea("grad",!1),wt=ea("turn",!1),rt=Qc("number"),st=Qc("color"),Ht=ea("#",!1),ui=iS([["0","9"],["a","f"],["A","F"]],!1,!1),Er=iS(["+","-"],!1,!1),Oi=iS([["0","9"]],!1,!1),ki=ea(".",!1),Rr=ea("e",!1),Dr=function(){return[]},rr=function(Z,Ae){return{type:"function",name:Z,parameters:Ae||[]}},sr=function(Z,Ae){return Ae.length>0?w$(Z,Ae,3):[Z]},ji=function(Z){return{type:"quantity",value:Z.value,unit:Z.unit}},hi=function(Z){return{type:"color",colorType:Z.type,value:Z.value}},Ci=function(Z){return Z},nr=function(){return ku()},_r=function(Z){return{value:Z,unit:"%"}},Cs=function(Z){return{value:Z,unit:"px"}},Pr=function(Z){return{value:Z,unit:"cm"}},Fr=function(Z){return{value:Z,unit:"mm"}},Zs=function(Z){return{value:Z,unit:"in"}},Cn=function(Z){return{value:Z,unit:"pt"}},Ca=function(Z){return{value:Z,unit:"pc"}},Jc=function(Z){return{value:Z,unit:"deg"}},Io=function(Z){return{value:Z,unit:"rad"}},Qo=function(Z){return{value:Z,unit:"grad"}},uo=function(Z){return{value:Z,unit:"turn"}},Js=function(Z){return{value:Z,unit:null}},Ii=function(){return{type:"hex",value:ku()}},zn=function(Z){return{type:"function",value:Z}},ho=function(){return{type:"named",value:ku()}},Kn=function(){return parseFloat(ku())},de=0,gs=0,Mf=[{line:1,column:1}],Ko=0,Af=[],Rt=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');u=c[n.startRule]}function ku(){return s.substring(gs,de)}function ea(Z,Ae){return{type:"literal",text:Z,ignoreCase:Ae}}function iS(Z,Ae,ze){return{type:"class",parts:Z,inverted:Ae,ignoreCase:ze}}function rS(){return{type:"end"}}function Qc(Z){return{type:"other",description:Z}}function Y0(Z){var Ae,ze=Mf[Z];if(ze)return ze;for(Ae=Z-1;!Mf[Ae];)Ae--;for(ze={line:(ze=Mf[Ae]).line,column:ze.column};Ae<Z;)s.charCodeAt(Ae)===10?(ze.line++,ze.column=1):ze.column++,Ae++;return Mf[Z]=ze,ze}function sS(Z,Ae,ze){var Ui=Y0(Z),eo=Y0(Ae);return{source:l,start:{offset:Z,line:Ui.line,column:Ui.column},end:{offset:Ae,line:eo.line,column:eo.column}}}function wi(Z){de<Ko||(de>Ko&&(Ko=de,Af=[]),Af.push(Z))}function g1(Z,Ae,ze){return new e(e.buildMessage(Z,Ae),Z,Ae,ze)}function X0(){var Z;return(Z=y1())===a&&(Z=fc()),Z}function y1(){var Z,Ae;return Rt++,Z=de,Qs(),s.substr(de,4)===h?(Ae=h,de+=4):(Ae=a,Rt===0&&wi(H)),Ae!==a?(Qs(),gs=Z,Z=Dr()):(de=Z,Z=a),Rt--,Z===a&&Rt===0&&wi(k),Z}function fc(){var Z,Ae;if(Z=[],(Ae=Uu())!==a)for(;Ae!==a;)Z.push(Ae),Ae=Uu();else Z=a;return Z}function Uu(){var Z,Ae,ze,Ui;return Z=de,Qs(),(Ae=_1())!==a?(Qs(),(ze=Mg())===a&&(ze=null),Qs(),s.charCodeAt(de)===41?(Ui=p,de++):(Ui=a,Rt===0&&wi(q)),Ui!==a?(Qs(),gs=Z,Z=rr(Ae,ze)):(de=Z,Z=a)):(de=Z,Z=a),Z}function Mg(){var Z,Ae,ze,Ui,eo,pn,mc,lS;if(Z=de,(Ae=ta())!==a){for(ze=[],Ui=de,eo=Qs(),s.charCodeAt(de)===44?(pn=f,de++):(pn=a,Rt===0&&wi(Q)),pn===a&&(pn=null),mc=Qs(),(lS=ta())!==a?Ui=eo=[eo,pn,mc,lS]:(de=Ui,Ui=a);Ui!==a;)ze.push(Ui),Ui=de,eo=Qs(),s.charCodeAt(de)===44?(pn=f,de++):(pn=a,Rt===0&&wi(Q)),pn===a&&(pn=null),mc=Qs(),(lS=ta())!==a?Ui=eo=[eo,pn,mc,lS]:(de=Ui,Ui=a);gs=Z,Z=sr(Ae,ze)}else de=Z,Z=a;return Z}function ta(){var Z,Ae;return Z=de,(Ae=oS())===a&&(Ae=XC())===a&&(Ae=aS())===a&&(Ae=v1()),Ae!==a&&(gs=Z,Ae=ji(Ae)),(Z=Ae)===a&&(Z=de,(Ae=X4())!==a&&(gs=Z,Ae=hi(Ae)),Z=Ae),Z}function Qs(){var Z,Ae;for(Rt++,Z=[],Y.test(s.charAt(de))?(Ae=s.charAt(de),de++):(Ae=a,Rt===0&&wi(re));Ae!==a;)Z.push(Ae),Y.test(s.charAt(de))?(Ae=s.charAt(de),de++):(Ae=a,Rt===0&&wi(re));return Rt--,Ae=a,Rt===0&&wi(K),Z}function _1(){var Z,Ae,ze;return Rt++,Z=de,(Ae=nS())!==a?(s.charCodeAt(de)===40?(ze=g,de++):(ze=a,Rt===0&&wi(Re)),ze!==a?(gs=Z,Z=Ci(Ae)):(de=Z,Z=a)):(de=Z,Z=a),Rt--,Z===a&&(Ae=a,Rt===0&&wi(be)),Z}function nS(){var Z,Ae,ze;if(Rt++,Z=de,Ae=[],W.test(s.charAt(de))?(ze=s.charAt(de),de++):(ze=a,Rt===0&&wi(_t)),ze!==a)for(;ze!==a;)Ae.push(ze),W.test(s.charAt(de))?(ze=s.charAt(de),de++):(ze=a,Rt===0&&wi(_t));else Ae=a;return Ae!==a&&(gs=Z,Ae=nr()),Rt--,(Z=Ae)===a&&(Ae=a,Rt===0&&wi(je)),Z}function oS(){var Z,Ae,ze;return Rt++,Z=de,Qs(),(Ae=Kc())!==a?(s.charCodeAt(de)===37?(ze=y,de++):(ze=a,Rt===0&&wi(ut)),ze!==a?(gs=Z,Z=_r(Ae)):(de=Z,Z=a)):(de=Z,Z=a),Rt--,Z===a&&Rt===0&&wi(ht),Z}function XC(){var Z,Ae,ze;return Rt++,Z=de,Qs(),(Ae=Kc())!==a?(s.substr(de,2)===v?(ze=v,de+=2):(ze=a,Rt===0&&wi(at)),ze!==a?(gs=Z,Z=Cs(Ae)):(de=Z,Z=a)):(de=Z,Z=a),Z===a&&(Z=de,Qs(),(Ae=Kc())!==a?(s.substr(de,2)===b?(ze=b,de+=2):(ze=a,Rt===0&&wi(bi)),ze!==a?(gs=Z,Z=Pr(Ae)):(de=Z,Z=a)):(de=Z,Z=a),Z===a&&(Z=de,Qs(),(Ae=Kc())!==a?(s.substr(de,2)===w?(ze=w,de+=2):(ze=a,Rt===0&&wi(gi)),ze!==a?(gs=Z,Z=Fr(Ae)):(de=Z,Z=a)):(de=Z,Z=a),Z===a&&(Z=de,Qs(),(Ae=Kc())!==a?(s.substr(de,2)===x?(ze=x,de+=2):(ze=a,Rt===0&&wi(We)),ze!==a?(gs=Z,Z=Zs(Ae)):(de=Z,Z=a)):(de=Z,Z=a),Z===a&&(Z=de,Qs(),(Ae=Kc())!==a?(s.substr(de,2)===S?(ze=S,de+=2):(ze=a,Rt===0&&wi(ii)),ze!==a?(gs=Z,Z=Cn(Ae)):(de=Z,Z=a)):(de=Z,Z=a),Z===a&&(Z=de,Qs(),(Ae=Kc())!==a?(s.substr(de,2)===E?(ze=E,de+=2):(ze=a,Rt===0&&wi(Ye)),ze!==a?(gs=Z,Z=Ca(Ae)):(de=Z,Z=a)):(de=Z,Z=a)))))),Rt--,Z===a&&Rt===0&&wi(lt),Z}function aS(){var Z,Ae,ze;return Rt++,Z=de,(Ae=Kc())!==a?(s.substr(de,3)===C?(ze=C,de+=3):(ze=a,Rt===0&&wi(Lt)),ze!==a?(gs=Z,Z=Jc(Ae)):(de=Z,Z=a)):(de=Z,Z=a),Z===a&&(Z=de,(Ae=Kc())!==a?(s.substr(de,3)===R?(ze=R,de+=3):(ze=a,Rt===0&&wi(kt)),ze!==a?(gs=Z,Z=Io(Ae)):(de=Z,Z=a)):(de=Z,Z=a),Z===a&&(Z=de,(Ae=Kc())!==a?(s.substr(de,4)===I?(ze=I,de+=4):(ze=a,Rt===0&&wi(Kt)),ze!==a?(gs=Z,Z=Qo(Ae)):(de=Z,Z=a)):(de=Z,Z=a),Z===a&&(Z=de,(Ae=Kc())!==a?(s.substr(de,4)===F?(ze=F,de+=4):(ze=a,Rt===0&&wi(wt)),ze!==a?(gs=Z,Z=uo(Ae)):(de=Z,Z=a)):(de=Z,Z=a)))),Rt--,Z===a&&(Ae=a,Rt===0&&wi(He)),Z}function v1(){var Z,Ae;return Rt++,Z=de,Qs(),(Ae=Kc())!==a?(gs=Z,Z=Js(Ae)):(de=Z,Z=a),Rt--,Z===a&&Rt===0&&wi(rt),Z}function X4(){var Z,Ae,ze,Ui;if(Rt++,Z=de,s.charCodeAt(de)===35?(Ae=D,de++):(Ae=a,Rt===0&&wi(Ht)),Ae!==a){if(ze=[],J.test(s.charAt(de))?(Ui=s.charAt(de),de++):(Ui=a,Rt===0&&wi(ui)),Ui!==a)for(;Ui!==a;)ze.push(Ui),J.test(s.charAt(de))?(Ui=s.charAt(de),de++):(Ui=a,Rt===0&&wi(ui));else ze=a;ze!==a?(gs=Z,Z=Ii()):(de=Z,Z=a)}else de=Z,Z=a;return Z===a&&(Z=de,(Ae=Uu())!==a&&(gs=Z,Ae=zn(Ae)),(Z=Ae)===a&&(Z=de,(Ae=nS())!==a&&(gs=Z,Ae=ho()),Z=Ae)),Rt--,Z===a&&(Ae=a,Rt===0&&wi(st)),Z}function Kc(){var Z,Ae,ze,Ui,eo,pn,mc;for(Z=de,me.test(s.charAt(de))?(s.charAt(de),de++):Rt===0&&wi(Er),Ae=de,ze=[],L.test(s.charAt(de))?(Ui=s.charAt(de),de++):(Ui=a,Rt===0&&wi(Oi));Ui!==a;)ze.push(Ui),L.test(s.charAt(de))?(Ui=s.charAt(de),de++):(Ui=a,Rt===0&&wi(Oi));if(s.charCodeAt(de)===46?(Ui=z,de++):(Ui=a,Rt===0&&wi(ki)),Ui!==a){if(eo=[],L.test(s.charAt(de))?(pn=s.charAt(de),de++):(pn=a,Rt===0&&wi(Oi)),pn!==a)for(;pn!==a;)eo.push(pn),L.test(s.charAt(de))?(pn=s.charAt(de),de++):(pn=a,Rt===0&&wi(Oi));else eo=a;eo!==a?Ae=ze=[ze,Ui,eo]:(de=Ae,Ae=a)}else de=Ae,Ae=a;if(Ae===a)if(Ae=[],L.test(s.charAt(de))?(ze=s.charAt(de),de++):(ze=a,Rt===0&&wi(Oi)),ze!==a)for(;ze!==a;)Ae.push(ze),L.test(s.charAt(de))?(ze=s.charAt(de),de++):(ze=a,Rt===0&&wi(Oi));else Ae=a;if(Ae!==a){if(ze=de,s.charCodeAt(de)===101?(Ui=B,de++):(Ui=a,Rt===0&&wi(Rr)),Ui!==a){if(me.test(s.charAt(de))?(eo=s.charAt(de),de++):(eo=a,Rt===0&&wi(Er)),eo===a&&(eo=null),pn=[],L.test(s.charAt(de))?(mc=s.charAt(de),de++):(mc=a,Rt===0&&wi(Oi)),mc!==a)for(;mc!==a;)pn.push(mc),L.test(s.charAt(de))?(mc=s.charAt(de),de++):(mc=a,Rt===0&&wi(Oi));else pn=a;pn!==a?ze=Ui=[Ui,eo,pn]:(de=ze,ze=a)}else de=ze,ze=a;ze===a&&(ze=null),gs=Z,Z=Kn()}else de=Z,Z=a;return Z}function b$(Z,Ae){return Z.map(function(ze){return ze[Ae]})}function w$(Z,Ae,ze){return[Z].concat(b$(Ae,ze))}if((o=u())!==a&&de===s.length)return o;throw o!==a&&de<s.length&&wi(rS()),g1(Af,Ko<s.length?s.charAt(Ko):null,Ko<s.length?sS(Ko,Ko+1):sS(Ko,Ko))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+c.line+":"+c.column;if(a){var h=this.location.end,p=i("",c.line.toString().length," "),f=a[l.line-1],g=(l.line===h.line?h.column:f.length+1)-l.column||1;n+=`
 --> `+u+`
`+p+` |
`+c.line+" | "+f+`
`+p+" | "+i("",l.column-1," ")+i("",g,"^")}else n+=`
 at `+u}return n},e.buildMessage=function(s,n){var o={literal:function(f){return'"'+l(f.text)+'"'},class:function(f){var g=f.parts.map(function(y){return Array.isArray(y)?c(y[0])+"-"+c(y[1]):c(y)});return"["+(f.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(f){return f.description}};function a(f){return f.charCodeAt(0).toString(16).toUpperCase()}function l(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function u(f){return o[f.type](f)}function h(f){var g,y,v=f.map(u);if(v.sort(),v.length>0){for(g=1,y=1;g<v.length;g++)v[g-1]!==v[g]&&(v[y]=v[g],y++);v.length=y}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function p(f){return f?'"'+l(f)+'"':"end of input"}return"Expected "+h(s)+" but "+p(n)+" found."},{SyntaxError:e,parse:r}},(zwe=Gze).exports&&(zwe.exports=Vwe());var yIt=Gze.exports;function jze(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=Gwe(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new j("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:Gwe(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!Stt(e[i].effects,e[i+1].effects))throw new j("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});Ttt(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function Gwe(t){let e;if(!t)return[];try{e=yIt.parse(t)}catch(i){throw new j("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>_It(i))}function _It(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return vIt(t);case"opacity":return bIt(t);case"hue-rotate":return wIt(t);case"blur":return xIt(t);case"drop-shadow":return SIt(t);case"bloom":return TIt(t)}}catch(e){throw e.details.filter=t,e}throw new j("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function vIt(t){let e=1;return r$(t.parameters,1),t.parameters.length===1&&(e=Tm(t.parameters[0])),new FK(t.name,e)}function bIt(t){let e=1;return r$(t.parameters,1),t.parameters.length===1&&(e=Tm(t.parameters[0])),new KPe(e)}function wIt(t){let e=0;return r$(t.parameters,1),t.parameters.length===1&&(e=PIt(t.parameters[0])),new JPe(e)}function xIt(t){let e=0;return r$(t.parameters,1),t.parameters.length===1&&(e=Fde(t.parameters[0]),T4(e,t.parameters[0])),new qPe(e)}function SIt(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new j("effect:type-error","Accepts only one color",{});i=OIt(r)}else{const s=Fde(r);if(Object.isFrozen(e))throw new j("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&T4(s,r)}if(e.length<2||e.length>3)throw new j("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new XPe(e[0],e[1],e[2]||0,i||Hze("black"))}function TIt(t){let e=1,i=0,r=0;return r$(t.parameters,3),t.parameters[0]&&(e=Tm(t.parameters[0])),t.parameters[1]&&(i=Fde(t.parameters[1]),T4(i,t.parameters[1])),t.parameters[2]&&(r=Tm(t.parameters[2])),new jPe(e,i,r)}function r$(t,e){if(t.length>e)throw new j("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function v7(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in Dde)return"<length>";if(t.unit in Lde)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function T4(t,e){if(t<0)throw new j("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function EIt(t){if(t.type!=="quantity"||t.unit!==null)throw new j("effect:type-error",`Expected <double>, Actual: ${v7(t)}`,{term:t})}function CIt(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new j("effect:type-error",`Expected <double> or <percentage>, Actual: ${v7(t)}`,{term:t})}const Lde={deg:1,grad:.9,rad:180/Math.PI,turn:360};function MIt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Lde[t.unit]!=null))throw new j("effect:type-error",`Expected <angle>, Actual: ${v7(t)}`,{term:t})}const Dde={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function AIt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Dde[t.unit]!=null))throw new j("effect:type-error",`Expected <length>, Actual: ${v7(t)}`,{term:t})}function Tm(t){CIt(t);const e=t.value;return T4(e,t),t.unit==="%"?.01*e:e}function RIt(t){return EIt(t),T4(t.value,t),t.value}function PIt(t){return MIt(t),t.value*Lde[t.unit]||0}function Fde(t){return AIt(t),t.value*Dde[t.unit]||0}function OIt(t){switch(t.colorType){case"hex":return get(t.value);case"named":return Hze(t.value);case"function":return NIt(t.value)}}function Hze(t){if(!mPe(t))throw new j("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return met(t)}const IIt=/^rgba?/i,$It=/^hsla?/i;function NIt(t){if(r$(t.parameters,4),IIt.test(t.name))return[Tm(t.parameters[0]),Tm(t.parameters[1]),Tm(t.parameters[2]),t.parameters[3]?Tm(t.parameters[3]):1];if($It.test(t.name))return gPe(RIt(t.parameters[0]),Tm(t.parameters[1]),Tm(t.parameters[2]),t.parameters[3]?Tm(t.parameters[3]):1);throw new j("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function GF(t,e,i){try{return DIt(t)}catch(r){i?.messages?.push(r)}return null}function jF(t,e,i,r){try{const s=LIt(t);ja(i,s,e)}catch(s){r.messages&&r.messages.push(s)}}function LIt(t){const e=jze(t);return e?Ett(e)?e.map(i=>i.toJSON()):e.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function DIt(t){if(!t||t.length===0)return null;if(FIt(t)){const e=[];for(const i of t)e.push({scale:i.scale,value:jwe(i.value)});return e}return jwe(t)}function FIt(t){const e=t[0];return!!e&&"scale"in e}function jwe(t){if(!t?.length)return"";const e=[];for(const i of t){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[a_(i,"amount")];break;case"blur":r=[a_(i,"radius","pt")];break;case"hue-rotate":r=[a_(i,"angle","deg")];break;case"drop-shadow":r=[a_(i,"xoffset","pt"),a_(i,"yoffset","pt"),a_(i,"blurRadius","pt"),kIt(i,"color")];break;case"bloom":r=[a_(i,"strength"),a_(i,"radius","pt"),a_(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;jze(s),e.push(s)}return e.join(" ")}function a_(t,e,i){if(t[e]==null)throw new j("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return i?t[e]+i:""+t[e]}function kIt(t,e){if(t[e]==null)throw new j("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const i=t[e];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}let qze=class{constructor(e,i){this._storage=new OBe,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),i&&this._storage.registerRemoveFunc("",i)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,i,r=1){this._storage.put(this,e,i,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};new qze(1e3);new Ke([128,128,128]);const UIt=new Ke("white");function U1i(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(e=>e.type==="object");case"line-3d":return t.symbolLayers.some(e=>e.type==="path");case"polygon-3d":return t.symbolLayers.some(e=>e.type==="object"||e.type==="extrude");default:return!1}}function BIt(t){return t.resource?.href??""}function B1i(t,e){if(!t)return null;let i=null;return jE(t)?i=zIt(t):w9(t)&&(i=t.type==="cim"?gIt(t):t.color?new Ke(t.color):null),i?HF(i,e):null}function zIt(t){const e=t.symbolLayers;if(!e)return null;let i=null;return e.forEach(r=>{r.type==="object"&&r.resource?.href||(i=r.type==="water"?r.color:r.material?r.material.color:null)}),i?new Ke(i):null}function HF(t,e){if(e==null||t==null)return t;const i=t.toRgba();return i[3]=i[3]*e,new Ke(i)}function VIt(t,e,i){const r=t.symbolLayers;if(!r)return;const s=n=>HF(e=e??n??(i!=null?UIt:null),i);r.forEach(n=>{if(n.type!=="object"||!n.resource?.href||e)if(n.type==="water")n.color=s(n.color);else{const o=n.material!=null?n.material.color:null,a=s(o);n.material==null?n.material=new zd({color:a}):n.material.color=a,i!=null&&"outline"in n&&n.outline?.color!=null&&(n.outline.color=HF(n.outline.color,i))}})}function GIt(t,e,i){(e=e??t.color)&&(t.color=HF(e,i)),i!=null&&"outline"in t&&t.outline?.color&&(t.outline.color=HF(t.outline.color,i))}function z1i(t,e,i){t&&(e||i!=null)&&(e&&(e=new Ke(e)),jE(t)?VIt(t,e,i):w9(t)&&GIt(t,e,i))}async function jIt(t,e){const i=t.symbolLayers;i&&await gq(i,async r=>HIt(r,e))}async function HIt(t,e){switch(t.type){case"extrude":WIt(t,e);break;case"icon":case"line":case"text":qIt(t,e);break;case"path":XIt(t,e);break;case"object":await YIt(t,e)}}function qIt(t,e){const i=Wze(e);i!=null&&(t.size=i)}function Wze(t){for(const e of t)if(typeof e=="number")return e;return null}function WIt(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function YIt(t,e){const{resourceSize:i,symbolSize:r}=await ZIt(t),s=Yze(e,i,r);t.width=ID(e[0],r[0],i[0],s),t.depth=ID(e[1],r[1],i[1],s),t.height=ID(e[2],r[2],i[2],s)}function XIt(t,e){const i=Yze(e,bv,[t.width,void 0,t.height]);t.width=ID(e[0],t.width,1,i),t.height=ID(e[2],t.height,1,i)}function Yze(t,e,i){for(let r=0;r<3;r++){const s=t[r];switch(s){case"symbol-value":{const n=i[r];return n!=null?n/e[r]:1}case"proportional":break;default:if(s&&e[r])return s/e[r]}}return 1}async function ZIt(t){const{computeObjectLayerResourceSize:e}=await ye(()=>import("./symbolLayerUtils-c5dd0513.js"),[],import.meta.url),i=await e(t,10),{width:r,height:s,depth:n}=t,o=[r,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/i[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function ID(t,e,i,r){switch(t){case"proportional":return i*r;case"symbol-value":return e??i;default:return t}}function JIt(t,e){const i=Wze(e);if(i!=null)switch(t.type){case"simple-marker":t.size=i;break;case"picture-marker":{const r=t.width/t.height;r>1?(t.width=i,t.height=i*r):(t.width=i*r,t.height=i);break}case"simple-line":t.width=i;break;case"text":t.font.size=i}}async function V1i(t,e){if(t&&e)return jE(t)?jIt(t,e):void(w9(t)&&JIt(t,e))}function G1i(t,e,i){if(t&&e!=null)if(jE(t)){const r=t.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=(s.tilt??0)+e;break;case"roll":s.roll=(s.roll??0)+e;break;default:s.heading=(s.heading??0)+e}})}else w9(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=e))}function j1i(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function H1i(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}const q1i=1.2,QIt=Ud,KIt=4;let b7=class{constructor(e,i,r,s){this.graphics3DSymbolLayer=e,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Is.ADD);if(e||this._addedToStage){for(const i of this.renderGeometries)i.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,To.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Is.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=M()){return ue(e,0,0,0)}getBoundingBoxObjectSpace(e=Oo()){return hs(e)}addObjectState(e,i){e===qv.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.geometry.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,To.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(i=>{e.removeRenderGeometry(i)})}removeRenderGeometryObjectState(e,i){e.geometry.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,To.HIGHLIGHT)}computeAttachmentOrigin(e){for(const i of this.renderGeometries)i.geometry.computeAttachmentOrigin(OM)&&(e.draped.origin[0]+=OM[0],e.draped.origin[1]+=OM[1],e.draped.num++)}async getProjectedBoundingBox(e,i,r,s,n){hs(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,Hwe,r),wft(n,Hwe)}if(i){let o;Vm(n,OM);const a=Ghe(n,i.service.spatialReference,i);try{o=await i.service.queryElevation(OM[0],OM[1],s,a,"ground")}catch{}o!=null&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,i,r,s){if(this.boundingBox)v9(Bg,this.boundingBox);else{const n=e.boundingSphere,o=n[3];Bg[0]=n[0]-o,Bg[1]=n[1]-o,Bg[2]=n[2]-o,Bg[3]=n[0]+o,Bg[4]=n[1]+o,Bg[5]=n[2]+o}return i(Bg,0,2),this.calculateRelativeScreenBounds&&s.push({location:Vm(Bg),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),xue(Bg,r)}};const Hwe=li(),Bg=Oo(),OM=M();function X8(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}function Xze(t){const{size:e}=t.definition,i=t.fontString(e);let r=qwe.get(i);if(!r){const s=X8(t$t,0,0).getContext("2d");t.setFontProperties(s,e);const n=s.measureText(i$t);r=new e$t(n.actualBoundingBoxAscent,n.actualBoundingBoxDescent),qwe.set(i,r)}return r}const qwe=new Map;let e$t=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,i){this.maxAscent=e,this.maxDescent=i}};const t$t={canvas:null},i$t=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),Z8=1;let Zze=class{constructor(e,i,r,s){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.replaceAll(" "," ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let i=0;i<this._lines.length-1;i++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=X8(Wwe,sB,sB).getContext("2d"),i=this._parameters.definition.pixelRatio,r=this._fontSize*i;this._parameters.setFontProperties(e,r);let s=2*this._haloSize;const n=this._parameters.definition.font;n.style!=="italic"&&n.style!=="oblique"&&n.weight!=="bold"&&n.weight!=="bolder"||(s+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let o=0,a=0,l=0,c=0,u=0;this._lines.forEach((b,w)=>{const x=e.measureText(b),S=x.width/i,E=S+s;this._textWidths.push(S),this._lineWidths.push(E),o=Math.max(o,E),c=Math.max(c,x.actualBoundingBoxAscent/i),u=Math.max(u,x.actualBoundingBoxDescent/i),w===0&&(a=x.actualBoundingBoxAscent/i),w===this._lines.length-1&&(l=x.actualBoundingBoxDescent/i)});const h=Xze(this._parameters),p=Math.max(c,h.maxAscent),f=Math.max(u,h.maxDescent),g=a,y=this._parameters.definition.font.decoration==="underline"?f:l,v=o;this._metricsCached=new s$t(g,y,p,f,v)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*r$t}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,Z8)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case Vw.Left:return this._horizontalPadding;case Vw.Center:return(this.displayWidth-this._lineWidths[e])/2;case Vw.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,i,r){e.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;i+=o,r+=a;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],h=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,i+h,r),this._renderLineDecoration(e,i+h,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,i+this._getLineXOffset(c),r),this._renderLineDecoration(e,i+h,r,this._textWidths[c]),r+=this._lineSpacing}if(ts.TEXT_SHOW_BASELINE){e.strokeStyle=Ywe,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let u=0;u<this._lines.length;++u)this._drawLine(e,[s,c],[s+this.displayWidth,c]),c+=this._lineSpacing}if(ts.TEXT_SHOW_BORDER&&(e.strokeStyle=Ywe,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this._midLineAscent}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=$e(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(i,r+s),e.arcTo(i,r,i+s,r,s),e.lineTo(i+n-s,r),e.arcTo(i+n,r,i+n,r+s,s),e.lineTo(i+n,r+o-s),e.arcTo(i+n,r+o,i+n-s,r+o,s),e.lineTo(i+s,r+o),e.arcTo(i,r+o,i,r+o-s,s),e.closePath()):e.rect(i,r,n,o)}_renderHalo(e,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=X8(Wwe,Math.max(o,sB),Math.max(a,sB)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let h=n;for(let p=0;p<this._lines.length;++p){const f=this._getLineXOffset(p);this._renderLineDecoration(c,s+f,h,this._textWidths[p],!0),h+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),e.globalAlpha=1}_renderHaloEmulated(e,i,r){for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of Jze)this._fillText(e,n,i+o+this._haloSize*a,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const s=2*this._haloSize;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let u=0;u<l;u++){const h=1-(l-1)*c+u*c;e.lineWidth=this._toRenderUnit(h*s),this._strokeText(e,o,i+a,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,s){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(e,i,r,s){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,u=Math.floor(n)+.5,h=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,u),e.lineTo(c,u),e.lineTo(c,h),e.lineTo(l,h),e.lineTo(l,u),e.stroke()}};const Jze=[];for(let e=0;e<360;e+=360/16)Jze.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var Vw;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(Vw||(Vw={}));const Wwe={canvas:null},r$t=.2,sB=512,Ywe="rgb(255, 0, 255, 0.5)";let s$t=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,i,r,s,n){this.firstLineAscent=e,this.lastLineDescent=i,this.maxLineAscent=r,this.maxLineDescent=s,this.displayWidth=n}};const n$t=Object.freeze({left:0,center:.5,right:1}),RG=Object.freeze({"bottom-left":Ni(0,0),bottom:Ni(.5,0),"bottom-right":Ni(1,0),left:Ni(0,.5),center:Ni(.5,.5),right:Ni(1,.5),"top-left":Ni(0,1),top:Ni(.5,1),"top-right":Ni(1,1)});function Qze(t){switch(t){case"left":return Vw.Left;case"right":return Vw.Right;default:return Vw.Center}}function Xwe(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function o$t(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function a$t(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function l$t(t){return t==="middle"?"center":t}function c$t(t,e){switch(t){case"top":return Gi(e,0,Z8);case"bottom":return Gi(e,0,-Z8);default:return Cl(e,kE)}}let cI=class{constructor(e,i={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=Ne(),this._shaderTransformation=null,this._boundingSphere=null,this.id=Ld(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.castShadow=i.castShadow??!1,i.objectShaderTransformation!=null&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){Xn(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??=Ne(),Or(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??=Bn(),nt(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*FO(this.shaderTransformation)),this._boundingSphere):x3e}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const Zwe=Be(0,0,1),u$t=16,h$t=1.5,U2=bde,d$t=[U2/2,U2/2,1-U2/2,1-U2/2],p$t=[k8*U2,k8*U2];let kse=class Kze extends j0{getCachedSize(){return{size:this._getIconSize()}}constructor(e,i,r,s){super(e,i,r,s),this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._patchTask=null,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(r!=null)this._prepareResourcesPrimitive(i,r);else{const s=BIt(this.symbolLayer),n=Jwe(s);n!=null?await this._prepareResourcesCIM(i,JSON.parse(n),e):await this._prepareResourcesHref(i,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=i7(this._getIconSize());if(e)throw new j("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,i=Math.round(e.size!=null?Yn(e.size):u$t);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(e){let i=this._cimData;if(i&&i.symbol||this.logger.error("Can't create texture, CIM data is undefined"),i.primitiveOverrides){i=ee(i);const c=i.primitiveOverrides;rP.evaluateOverrides(c,e,this._arcadeInfo.geometryType,null,null),rP.applyOverrides(i.symbol,c)}const r=dle(JSON.stringify(i));let s=this._cimSymbolTextures.get(r);if(s)return s;const n=this._context.sharedResources.cimSymbolRasterizer,o=this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null;o&&rP.applyDictionaryTextOverrides(i.symbol,e,o,null);const a=this._cimScaleFactorOrFunction!=null?dPt(this._cimScaleFactorOrFunction,e):1;a!==1&&i.symbol&&Nde(i.symbol,a,!0);const l=ZX.getEnvelope(i,null,n.resourceManager);if(l?.width&&l.height){const c=l.x+l.width/2,u=l.y+l.height/2,h=n.rasterize({type:"cim",data:i},l.width,l.height,c,u,1,"esriGeometryPoint"),p=new L2({x:-l.x/l.width-.5,y:(l.height+l.y)/l.height-.5});this._cimMaterialParametersInfo.anchorPosition=Qwe("relative",p),s=new xx(h,{width:h?.width??1,height:h?.height??1,reloadable:!0})}else s=new xx(new ImageData(1,1),{width:1,height:1,reloadable:!0});return this._cimSymbolTextures.set(r,s),this._context.stage.add(s),s}_prepareMaterialParameters(){const e={anchorPosition:Qwe(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(f$t(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;e.verticalOffset={screenLength:Yn(r),minWorldLength:s||0,maxWorldLength:n??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!ae("enable-feature:non-occluded-hud"),e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,i){const r=this._getOutlineSize();if(QX(i)&&r===0)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const n=this._context.sharedResources.textures.fromData(`${i}-icon`,()=>jMt(i));this._textureHandle=n,e.textureId=n.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=GMt(i),e.distanceFieldBoundingBox=d$t;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/U2,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,i,r){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await jd(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(o.ok===!1)throw pl(o.error),new j("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._textureHandle=o.value;const a=o.value.texture;this._size=Kwe(a,s),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,i,r){if(this._cimData=i,!this._context.sharedResources.cimSymbolRasterizer){const u=(await ye(()=>import("./CIMSymbolRasterizer-494a5f68.js"),[],import.meta.url)).CIMSymbolRasterizer;zt(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference))}const s=this._context.sharedResources.cimSymbolRasterizer,n=[],o=i,a=o?.symbol;ZX.fetchResources(a,s.resourceManager,n,r),ZX.fetchFonts(a,s.resourceManager,n);const l=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):[],c=this._context.renderCoordsHelper.spatialReference;if(this._arcadeInfo={spatialReference:c,fields:l,geometryType:"esriGeometryPoint"},o?.primitiveOverrides&&n.push(rP.createRenderExpressions(o.primitiveOverrides,this._arcadeInfo)),n.length>0&&(await Promise.all(n),zt(r)),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(u.scaleExpression){const h=u.scaleExpression,p=await oLe(h,this._context.layer.spatialReference,l);this._cimScaleFactorOrFunction=(f,g,y)=>{const v=Vze(p,f,{$view:y},"esriGeometryPoint",g);return v!==null?v:1}}}zt(r),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource?.href?null:this.symbolLayer.resource?.primitive??Uft}_getOutlineSize(){let e=0;const i=this.symbolLayer;return i.outline?.size!=null?Math.max(Yn(i.outline.size),0):(e=QX(this._getPrimitive())?h$t:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),i=this.symbolLayer,r=i?.outline?.color;if(r!=null){const s=Ke.toUnitRGB(r),n=r.a*e;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(QX(this._getPrimitive()))return QIt;const e=this._getPrimitive()==null,i=this.symbolLayer?.material?.color;return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:e})}_createMaterialAndAddToStage(e,i){if(this._cimData){this._fastUpdates=null;let r=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new iI(e),this._cimSymbolMaterials.set(e.textureId??0,r),i.add(r)),r}return this._fastUpdates=KO(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._materials[0]=new iI(e),i.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._patchTask=qc(this._patchTask),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._textureHandle=yi(this._textureHandle)}_getScaleFactor(e,i){if(this._drivenProperties.size&&e.size){for(let r=0;r<3;r++){const s=e.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[r]=Yn(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/i;if(isFinite(+e.size[2]))return+e.size[2]/i}return 1}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s=[0,0];if(this._cimData){if(!this._cimData.symbol)return null;const h=this._generateTextureCIM(i),p={textureId:h.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(p,this._context.stage);const f=window.devicePixelRatio||1;s=[h.parameters.width/f,h.parameters.height/f]}else s=this._size,r=this._materials[0];const n=hE(i.geometry);if(n==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates?.visualVariables.size){const h=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,h)}l*=this._symbolTextureRatio;const c=Ni(s[0]*l,s[1]*l),u=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,r,a,c,e.layer.uid):this._createAs3DShape(i,n,r,a,c,u,i.uid)}layerOpacityChanged(){const e=this._getFillColor(),i=this._getOutlineColor();this._forEachMaterial(r=>{r.setParameters({color:e}),r.setParameters({outlineColor:i})})}updateGeometry(e,i){if(this.draped||!this._validateGeometry(i))return!1;const{elevationContext:r,stageObject:s}=e;if(r.mode!==this.getGeometryElevationMode(i))return!1;const n=hE(i);if(!n)return!1;const o=a5e(s,this._context,n,r);if(o==null)return!1;const a=cde(this._context,n);return s.geometries[0].localOrigin===a&&(e.alignedSampledElevation=o,ZE(e,n,this._context.elevationProvider),!0)}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=c4(Kze.elevationModeChangeTypes,r,s);if(n!==cn.UPDATE)return n;const o=mf(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!eI(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return Dn.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return Dn.FastUpdate}prepareSymbolLayerPatch(e){if(this._patchTask?.abort(),e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchResource(e,i)}_preparePatchResource(e,i){if(!i.resource||i.resource.type!=="partial")return;const r=i.resource.diff;if(r?.href?.type!=="complete")return;const s=r.href.newValue,{textures:n}=this._context.sharedResources;if(s==null||n==null||Jwe(s)!=null)return;const o=this._getIconSize(),a=o*this._context.graphicsCoreOwner.view.state.pixelRatio;e.symbolLayerStatePatches.push(()=>{this._patchTask=qc(this._patchTask),this._patchTask=P0(l=>this._context.schedule(async(c,u)=>{const h=await jd(n.fromUrl(s,a,{signal:u}));zt(u);const p=!h.ok;if(p&&pl(h.error),this._textureHandle=yi(this._textureHandle),this._patchTask=null,p){this._forEachMaterial(y=>{y.visible=!1,y.setParameters({textureId:null})});const g=`Failed to load (Request for icon resource failed: ${s})`;return void this.logger.error(new j("graphics3diconsymbollayer:request-failed",g))}this._textureHandle=h.value;const f=h.value.texture;this._size=Kwe(f,o),this._forEachMaterial(g=>{g.setParameters({textureId:f.id}),g.visible=!0})},l))}),delete r.href}_defaultElevationInfoNoZ(){return m$t}_createAs3DShape(e,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=this._context.layer.uid,u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:c}),h=Fre(r,Zwe,null,s,n,g$t,null,l,u),p=lde(this._context,i,h,o,a);if(p==null)return null;const f=new G0(this,p.object,[h],null,null,uE,o);return f.alignedSampledElevation=p.sampledElevation,f.needsElevationUpdates=mf(o.mode)||o.mode==="absolute-height",f.getScreenSize=this._createScreenSizeGetter(n,l),f.calculateRelativeScreenBounds=g=>r.calculateRelativeScreenBounds(f.getScreenSize(),1,g),ZE(f,i,this._context.elevationProvider),f}_createAsOverlay(e,i,r,s,n,o){r.renderPriority=this._renderPriority;const a=M();lc(i,a,this._context.overlaySR),a[2]=Cde;const l=this._context.clippingExtent;if(l!=null&&!wue(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),h=Fre(r,Zwe,a,s,n,null,null,c,u),p=new cI(h,{layerUid:o,graphicUid:e.uid}),f=new b7(this,[p],null,this._context.drapeSourceRenderer);return f.getScreenSize=this._createScreenSizeGetter(n,c),f.calculateRelativeScreenBounds=g=>r.calculateRelativeScreenBounds(f.getScreenSize(),1,g),f}_createScreenSizeGetter(e,i){const r=this._outlineSize+2;if(this._fastUpdates&&i){const o=e[0]/this._symbolTextureRatio,a=e[1]/this._symbolTextureRatio;return(l=vt())=>{const[c,u]=Ohe(y$t,this._fastUpdates.materialParameters,i);return l[0]=c*o+r,l[1]=u*a+r,l}}const s=e[0]/this._symbolTextureRatio+r,n=e[1]/this._symbolTextureRatio+r;return(o=vt())=>(o[0]=s,o[1]=n,o)}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),i=Be(e,e,e),r=Sa(1),s=e*r,n=Be(s,s,s);return new a4({size:!0,color:!0,rotation:!0,opacity:!1},i,n,r)}_forEachMaterial(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._materials[0]}}};function f$t(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function QX(t){return t!=null&&(t==="cross"||t==="x")}function Jwe(t){const e=Zw(t);return e?.mediaType==="application/json"?e.data:void 0}function Qwe(t,e){return t==="relative"?Ni((e.x||0)+.5,.5-(e.y||0)):t in RG?RG[t]:RG.center}function Kwe({parameters:t},e){const i=(t.width??1)/(t.height??1);return i>1?[e,Math.round(e/i)]:[Math.round(e*i),e]}kse.PRIMITIVE_SIZE=p$t,kse.elevationModeChangeTypes={definedChanged:cn.UPDATE,staysOnTheGround:cn.NONE,onTheGroundChanged:cn.RECREATE};const m$t={mode:"relative-to-ground",offset:0},g$t=ni(0,0,0,1),y$t=M();function Use(t){switch(t){case"butt":return nf.BUTT;case"square":return nf.SQUARE;case"round":return nf.ROUND;default:return null}}function exe(t){return t==="diamond"?"kite":t}function Bse(t,e,i=null){const r=[],s=e.mapPositions;_$t(e,r);const n=r[0][1].data,o=r[0][1].indices.length,a=Hx(o);return v$t(e,r,a),x$t(e,r,a),b$t(e,r,a),w$t(e,r,a),S$t(e,r,a),T$t(e,r,a),E$t(e,r,n),new Zn(t,r,s,an.Line,i)}function _$t(t,e){const{attributeData:{position:i},removeDuplicateStartEnd:r}=t,s=C$t(i)&&r,n=i.length/3-(s?1:0),o=new Array(2*(n-1)),a=s?i.slice(0,-3):i;let l=0;for(let c=0;c<n-1;c++)o[l++]=c,o[l++]=c+1;e.push([O.POSITION,new dt(a,o,3,s)])}function v$t(t,e,i){if(t.attributeData.colorFeature!=null)return;const r=t.attributeData.color;e.push([O.COLOR,new dt(r??Xp,i,4)])}function b$t(t,e,i){t.attributeData.normal&&e.push([O.NORMAL,new dt(t.attributeData.normal,i,3)])}function w$t(t,e,i){t.attributeData.colorFeature!=null&&e.push([O.COLORFEATUREATTRIBUTE,new dt([t.attributeData.colorFeature],i,1,!0)])}function x$t(t,e,i){t.attributeData.sizeFeature==null&&e.push([O.SIZE,new dt([t.attributeData.size??1],i,1,!0)])}function S$t(t,e,i){t.attributeData.sizeFeature!=null&&e.push([O.SIZEFEATUREATTRIBUTE,new dt([t.attributeData.sizeFeature],i,1,!0)])}function T$t(t,e,i){t.attributeData.opacityFeature!=null&&e.push([O.OPACITYFEATUREATTRIBUTE,new dt([t.attributeData.opacityFeature],i,1,!0)])}function E$t(t,e,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Xe.Global||!t.overlayInfo.spatialReference.isGeographic)return;const r=qo(i.length),s=$r(t.overlayInfo.spatialReference);for(let h=0;h<r.length;h+=3)mce(i,h,r,h,s);const n=i.length/3,o=qs(n+1);let a=M$t,l=A$t,c=0,u=0;Gi(a,r[u++],r[u++]),u++,o[0]=0;for(let h=1;h<n+1;++h)h===n&&(u=0),Gi(l,r[u++],r[u++]),u++,c+=NDe(a,l),o[h]=c,[a,l]=[l,a];e.push([O.DISTANCETOSTART,new dt(o,e[0][1].indices,1,!0)])}function C$t(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const M$t=vt(),A$t=vt();function Q1i(t,e){if(t==null||t.length===0)return[];const i=[];return t.forEach(r=>{const s=r.length,n=qo(3*s);r.forEach((a,l)=>{n[3*l]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};i.push(o)}),i}function R$t(t,e,i,r){const s=t.type==="polygon"?S0.CCW_IS_HOLE:S0.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=b4(n,!!t.hasZ,s,t.spatialReference),l=qo(o.length),c=nUe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,i,r),u=c!=null;return{lines:u?eVe(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function P$t(t,e){const i=t.type==="polygon"?S0.CCW_IS_HOLE:S0.NONE,r=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=b4(r,!1,i),o=Ts(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=Cde;return{lines:o?eVe(n,s):[],projectionSuccess:o}}function eVe(t,e,i=null){const r=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;r.push({position:sf(e,3*s,3*n),mapPositions:i!=null?sf(i,o,a):void 0})}return r}function O$t(t){const e=new tr,i=t.multipassEnabled&&t.output===G.Color,r=t.space===Nu.World;e.include(sBe,t),e.include(wBe,t);const{vertex:s,fragment:n}=e;return n.include(Cg),Pu(s,t),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.PREVPOSITION,"vec3"),e.attributes.add(O.UV0,"vec2"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),i&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add(new os("nearFar",(o,a)=>a.camera.nearFar),new Ki("viewport",(o,a)=>a.camera.fullViewport)),s.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(T`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),r?(e.attributes.add(O.NORMAL,"vec3"),XO(s),s.constants.add("tiltThreshold","float",.7),s.code.add(T`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(T`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(T`
      #define vecN ${r?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${r?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===JE.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===Nu.Screen&&(s.uniforms.add(new Ps("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(T`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(T`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new et("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(T`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),WI(s),s.code.add(T`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position, 1.0);
vec4 prev = view * vec4(prevPosition, 1.0);
clip(pos, prev);`),r?(t.hideOnShortSegments&&s.code.add(T`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(T`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(T`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===Nu.Screen&&s.code.add(T`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(T`
        ${i?"depth = pos.z;":""}

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${r?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&e.include(V0,t),e.include(Wn,t),n.uniforms.add(new Ki("intrinsicColor",o=>o.color),new Et("tex",o=>o.markerTexture)),n.include(B0),e.constants.add("texelSize","float",1/dE),n.code.add(T`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",wde/dE),e.constants.add("relativeTipLineWidth","float",KMt),n.code.add(T`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${r?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),t.transparencyPassType===mt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),e.constants.add("symbolAlphaCutoff","float",Ba),n.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${r?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===G.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===G.Color?T`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===G.Color&&t.transparencyPassType===mt.ColorAlpha?T`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${t.output===G.Highlight?T`fragColor = vec4(1.0);`:""}
  }
  `),e}const I$t=Object.freeze(Object.defineProperty({__proto__:null,build:O$t},Symbol.toStringTag,{value:"Module"})),tVe=new Map([[O.POSITION,0],[O.PREVPOSITION,1],[O.UV0,2],[O.NORMAL,3],[O.COLOR,4],[O.COLORFEATUREATTRIBUTE,4],[O.SIZE,5],[O.SIZEFEATUREATTRIBUTE,5],[O.OPACITYFEATUREATTRIBUTE,6]]);let iVe=class rVe extends hr{initializeProgram(e){return new dr(e.rctx,rVe.shader.get().build(this.configuration),tVe)}_makePipelineState(e,i){const r=this.configuration,s=e===mt.NONE;return ti({blending:r.output===G.Color?s?Ch:c1(e):null,depthTest:r.space===Nu.Draped?null:{func:Yx(e)},depthWrite:r.space===Nu.Draped?null:s?r.writeDepth?Oh:null:Z9(e),drawBuffers:r.output===G.Depth?{buffers:[zo.NONE]}:u1(e),colorWrite:fi,stencilWrite:r.hasOccludees?x0:null,stencilTest:r.hasOccludees?i?bx:Xx:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=ti({blending:Ch,depthTest:P8,depthWrite:null,colorWrite:fi,stencilWrite:null,stencilTest:kUe}),this._occluderPipelineOpaque=ti({blending:Ch,depthTest:P8,depthWrite:null,colorWrite:fi,stencilWrite:DUe,stencilTest:FUe}),this._occluderPipelineMaskWrite=ti({blending:null,depthTest:Qhe,depthWrite:null,colorWrite:null,stencilWrite:x0,stencilTest:bx})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};iVe.shader=new ir(I$t,()=>ye(()=>import("./LineMarker.glsl-fb37ddb3.js"),[],import.meta.url));let $$t=class extends qx{constructor(e){super(e,new L$t),this.produces=new Map([[Ce.OPAQUE_MATERIAL,i=>i===G.Highlight||Ov(i)&&this.parameters.renderOccluded===pr.OccludeAndTransparentStencil],[Ce.OPAQUE_NO_SSAO_DEPTH,i=>Uw(i)],[Ce.OCCLUDER_MATERIAL,i=>L_e(i)&&this.parameters.renderOccluded===pr.OccludeAndTransparentStencil],[Ce.TRANSPARENT_OCCLUDER_MATERIAL,i=>L_e(i)&&this.parameters.renderOccluded===pr.OccludeAndTransparentStencil],[Ce.TRANSPARENT_MATERIAL,i=>Ov(i)&&this.parameters.writeDepth],[Ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>Ov(i)&&!this.parameters.writeDepth],[Ce.DRAPED_MATERIAL,i=>i===G.Color||i===G.Highlight]]),this._vertexAttributeLocations=tVe,this._configuration=new sa,this._layout=this.createLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.space=i.slot===Ce.DRAPED_MATERIAL?Nu.Draped:this.parameters.worldSpace?Nu.World:Nu.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==nf.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===pr.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=Xs().vec3f(O.POSITION).vec3f(O.PREVPOSITION).vec2f(O.UV0);return this.parameters.worldSpace&&e.vec3f(O.NORMAL),this.parameters.vvSize?e.f32(O.SIZEFEATUREATTRIBUTE):e.f32(O.SIZE),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4f(O.COLOR),this.parameters.vvOpacity&&e.f32(O.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new D$t(this._layout,this.parameters)}createGLMaterial(e){return new N$t(e)}},N$t=class extends Gue{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextures.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const i=this._material.parameters.markerPrimitive;return i!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextures.swap(i,this._markerPrimitive)}),this._markerPrimitive=i),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(iVe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===G.Color&&this._updateOccludeeState(e),this._updateParameters(e)}},L$t=class extends l4{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=nf.BUTT,this.anchor=JE.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},D$t=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,i,r,s,n){const o=r.attributes.get(O.POSITION).data,a=o.length/3;let l=[1,0,0];const c=r.attributes.get(O.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let u=1,h=0;this._parameters.vvSize?h=r.attributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:r.attributes.has(O.SIZE)&&(u=r.attributes.get(O.SIZE).data[0]);let p=[1,1,1,1],f=0;this._parameters.vvColor?f=r.attributes.get(O.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(O.COLOR)&&(p=r.attributes.get(O.COLOR).data);let g=0;this._parameters.vvOpacity&&(g=r.attributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const y=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const b=(E,C,R,I)=>{if(y[v++]=E[0],y[v++]=E[1],y[v++]=E[2],y[v++]=C[0],y[v++]=C[1],y[v++]=C[2],y[v++]=R[0],y[v++]=R[1],this._parameters.worldSpace&&(y[v++]=l[0],y[v++]=l[1],y[v++]=l[2]),this._parameters.vvSize?y[v++]=h:y[v++]=u,this._parameters.vvColor)y[v++]=f;else{const F=Math.min(4*I,p.length-4);y[v++]=p[F],y[v++]=p[F+1],y[v++]=p[F+2],y[v++]=p[F+3]}this._parameters.vvOpacity&&(y[v++]=g)};let w;(function(E){E[E.ASCENDING=1]="ASCENDING",E[E.DESCENDING=-1]="DESCENDING"})(w||(w={}));const x=(E,C)=>{const R=ue(F$t,o[3*E],o[3*E+1],o[3*E+2]),I=k$t;let F=E+C;do ue(I,o[3*F],o[3*F+1],o[3*F+2]),F+=C;while(NE(R,I)&&F>=0&&F<a);e&&(nt(R,R,e),nt(I,I,e)),b(R,I,[-1,-1],E),b(R,I,[1,-1],E),b(R,I,[1,1],E),b(R,I,[-1,-1],E),b(R,I,[1,1],E),b(R,I,[-1,1],E)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||x(0,w.ASCENDING),S!=="end"&&S!=="begin-end"||x(a-1,w.DESCENDING)}};const F$t=M(),k$t=M(),$l={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},U$t={dash:$l.dash,"dash-dot":[...$l.dash,...$l.dot],dot:$l.dot,"long-dash":$l["long-dash"],"long-dash-dot":[...$l["long-dash"],...$l.dot],"long-dash-dot-dot":[...$l["long-dash"],...$l.dot,...$l.dot],none:null,"short-dash":$l["short-dash"],"short-dash-dot":[...$l["short-dash"],...$l["short-dot"]],"short-dash-dot-dot":[...$l["short-dash"],...$l["short-dot"],...$l["short-dot"]],"short-dot":$l["short-dot"],solid:null},B$t=8;function z$t(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function rbi(t){return{pattern:[t,t],pixelRatio:2}}function sVe(t){return t!=null&&t.type==="style"?V$t(t.style):null}function V$t(t){return t!=null?z$t(U$t[t],B$t):null}const G$t=["polyline","polygon","extent"],txe=new a4({size:!0,color:!0,rotation:!1,opacity:!0});let nVe=class oVe extends j0{constructor(e,i,r,s){super(e,i,r,s)}async doLoad(){if(this._fastUpdates=KO(this._context.renderer,txe),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Sa(1))<0)throw new j("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,i=!1){const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const s={width:this._computeMaterialWidth(this.symbolLayer?.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:Use(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:sVe(this.symbolLayer.pattern)};return this._fastUpdates?.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){return this._materials[yn.Line]==null&&(this._materials[yn.Line]=new KR(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[yn.Line])),this._materials[yn.Line]}get _ringMaterial(){return this._materials[yn.Ring]==null&&(this._materials[yn.Ring]=new KR(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[yn.Ring])),this._materials[yn.Ring]}get _wireframeLineMaterial(){return this._materials[yn.LineWireframe]==null&&(this._materials[yn.LineWireframe]=new KR({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[yn.LineWireframe])),this._materials[yn.LineWireframe]}get _wireframeRingMaterial(){return this._materials[yn.RingWireframe]==null&&(this._materials[yn.RingWireframe]=new KR({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[yn.RingWireframe])),this._materials[yn.RingWireframe]}get _markerMaterial(){return this._materials[yn.Marker]==null&&this.symbolLayer.marker!=null&&(this._materials[yn.Marker]=new $$t({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:exe(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[yn.Marker])),this._materials[yn.Marker]}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0}_getDrivenSize(e){return this._drivenProperties.size&&e.size?Yn(ECt(e.size)):1}_getDrivenColor(e){const i=ni(1,1,1,1);return this._drivenProperties.color&&e.color&&(i[0]=e.color[0],i[1]=e.color[1],i[2]=e.color[2],e.color.length>0&&(i[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(i[3]=e.opacity),i}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,G$t,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,i.uid)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables")return Dn.RecreateSymbol;{const s=this._fastUpdates;if(!eI(s,i,txe))return Dn.RecreateSymbol;this._forEachMaterial(n=>n?.setParameters(s.materialParameters))}}return Dn.FastUpdate}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff,r={};i.size?.type==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),i.cap?.type==="complete"&&(r.cap=Use(i.cap.newValue??"butt"),delete i.cap);const s=this._prepareMarkerPatch(e,i);this._prepareMaterialPatch(e,i,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(n=>n?.setParameters(r)))}layerOpacityChanged(){this._forEachMaterial((e,i)=>this._updateMaterialLayerOpacity(e,i===yn.Marker))}_forEachMaterial(e){this._materials.forEach(e)}_updateMaterialLayerOpacity(e,i=!1){if(e==null)return;const r=e.parameters.color,s=this.symbolLayer?.material?.color,n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),o=ni(r[0],r[1],r[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=c4(oVe.elevationModeChangeTypes,r,s);if(n!==cn.UPDATE)return n;const o=mf(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i?.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){const s=ixe(e.graphic.geometry),n=s.type==="polygon"?s.rings:s.paths,o=new Array,a=Oo(),l=R$t(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),c=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(l,n,c,"LineSymbol3DLayer");for(let p=0;p<l.lines.length;p++){const f=l.lines[p],g=f.position,y=f.mapPositions;if(this._context.clippingExtent!=null&&(hs(a),Id(a,y),!Gm(a,this._context.clippingExtent)))continue;const v=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,g,y,s.type,$D.ELEVATED,r);o.push(v),ts.LINE_WIREFRAMES&&o.push(v.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&o.push(v.instantiate({material:this._markerMaterial}))}if(o.length===0)return null;const u=new Zx({geometries:o,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),h=new G0(this,u,o,null,null,dTt,i);return h.alignedSampledElevation=l.sampledElevation,h.needsElevationUpdates=mf(i.mode),h}_createGeometry(e,i,r,s,n,o,a){const l=o===$D.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=n==="polygon",u=this._fastUpdates?.visualVariables.color,h=this._fastUpdates?.visualVariables.size,p=this._fastUpdates?.visualVariables.opacity,f=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),g={position:r,size:h?null:this._getDrivenSize(i.renderingInfo),color:u?null:this._getDrivenColor(i.renderingInfo),sizeFeature:h?eg(h.field,i.graphic):null,colorFeature:u?eg(u.field,i.graphic):null,opacityFeature:p?eg(p.field,i.graphic):null};return Bse(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:s,attributeData:g},f)}_createAsOverlay(e,i){const r=e.graphic,s=ixe(r.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=ts.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=Oo(),h=hs(),p=P$t(s,this._context.overlaySR),f=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,n,f,"LineSymbol3DLayer");for(const g of p.lines){if(hs(u),Id(u,g.position),!Gm(u,this._context.clippingExtent))continue;HO(h,u);const y=v=>{const b=this._createGeometry(v,e,g.position,void 0,s.type,$D.DRAPED,r.uid),w=new cI(b,{layerUid:i,graphicUid:r.uid});c.push(w)};if(l!=null){y(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||Id(u,g.position,0,1),v!=="end"&&v!=="begin-end"||Id(u,g.position,g.position.length-3,1)}y(o),ts.LINE_WIREFRAMES&&y(a)}return new b7(this,c,h,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){return e=e??Sa(1),this._drivenProperties.size?this._fastUpdates?.visualVariables.size?Yn(1):1:Yn(e)}_prepareMaterialPatch(e,i,r){const s=i.material;if(s==null)return void(r.changed&&r.useMaterialColor&&nB(this._getCombinedOpacityAndColor(this._materialColor),this._materials[yn.Marker],e));if(s.type==="collection")return;const n=s.type==="complete"?s.newValue?.color:s.diff.color?.type==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&nB(Bk(o),this._materials[yn.Marker],e),this._patternHidesLine&&(o[3]=0),nB(o,this._materials[yn.Line],e),delete i.material}_prepareMarkerPatch(e,i){const r=i.marker,s=this._markerMaterial;if(r==null||r.type!=="partial"||r.diff==null||r.diff.placement!=null||r.diff.style!=null&&r.diff.style.type!=="complete"||r.diff.color!=null&&r.diff.color.type!=="complete"||s==null)return{changed:!1,useMaterialColor:this._markerColor==null};const n=r.diff.color,o=n!=null,a=o?n.newValue:null,l=a==null&&this._markerColor==null;a&&nB(this._getCombinedOpacityAndColor(a),s,e);const c=r.diff.style?.newValue;return c&&e.symbolLayerStatePatches.push(()=>s.setParameters({markerPrimitive:exe(c)})),delete i.marker,{changed:o,useMaterialColor:l}}};function ixe(t){switch(t.type){case"extent":if(t instanceof lr)return Ix.fromExtent(t);break;case"polygon":case"polyline":return t}return null}function nB(t,e,i){e!=null&&i.symbolLayerStatePatches.push(()=>e.setParameters({color:t}))}var $D,yn;nVe.elevationModeChangeTypes={definedChanged:cn.RECREATE,staysOnTheGround:cn.NONE,onTheGroundChanged:cn.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}($D||($D={})),function(t){t[t.Line=0]="Line",t[t.Ring=1]="Ring",t[t.LineWireframe=2]="LineWireframe",t[t.RingWireframe=3]="RingWireframe",t[t.Marker=4]="Marker"}(yn||(yn={}));let u3=null,J8=!0;function KX(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(J8)try{return new ImageData(t,e)}catch{J8=!1}return aVe(t,e,i)}function j$t(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(J8)try{return new ImageData(t,e,i)}catch{J8=!1}const s=aVe(e,i,r);return s.data.set(t,0),s}function H$t(){return u3||(u3=document.createElement("canvas"),u3.width=1,u3.height=1),u3}function aVe(t,e,i){return i||(i=H$t()),i.getContext("2d").createImageData(t,e)}async function q$t(t,e){const i=window.URL.createObjectURL(t);try{const{data:r}=await qi(i,{...e,responseType:"image"});return r}catch(r){throw En(r)?r:new j("invalid-image",`Could not fetch requested image at ${i}`)}finally{window.URL.revokeObjectURL(i)}}async function sbi(t,e){const{arrayBuffer:i,mediaType:r}=await W$t(t,e),s=r==="image/png";if(r==="image/gif"){const{isAnimatedGIF:n,parseGif:o}=await ye(()=>import("./gif-8d12f87b.js"),[],import.meta.url);if(n(i))return o(i,e)}if(s){const{isAnimatedPNG:n,parseApng:o}=await ye(()=>import("./apng-f9584909.js"),[],import.meta.url);if(n(i))return o(i,e)}return q$t(new Blob([i],{type:r}),e)}async function W$t(t,e){const i=Zw(t);if(i?.isBase64)return{arrayBuffer:fRe(i.data),mediaType:i.mediaType};const r=await qi(t,{responseType:"array-buffer",...e});return{arrayBuffer:r.data,mediaType:r.getHeader?.("Content-Type")??""}}var rR;const eZ=new WeakMap;let Y$t=0,fy=rR=class extends we{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,i,r){if(t instanceof HTMLImageElement){const s={type:"image-element",src:$E(t.src,r),crossOrigin:t.crossOrigin};e[i]=s}else if(t instanceof HTMLCanvasElement){const s={type:"canvas-element",imageData:rxe(t.getContext("2d").getImageData(0,0,t.width,t.height))};e[i]=s}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:$E(t.src,r),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[i]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:rxe(t)};e[i]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=sxe(t.imageData),i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(e,0,0),i}case"image-data":return sxe(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return nxe(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return nxe(t);if(e){const i=e.substr(e.length-4,4).toLowerCase(),r=e.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(i="")=>`d:${i},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(eZ.has(this.data)||eZ.set(this.data,++Y$t),e(eZ.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new rR(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const i=this.clone();return t.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}static from(t){return typeof t=="string"?new rR({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new rR({data:t}):SE(rR,t)}};function rxe(t){let e="";for(let i=0;i<t.data.length;i++)e+=String.fromCharCode(t.data[i]);return{data:btoa(e),width:t.width,height:t.height}}function sxe(t){const e=atob(t.data),i=new Uint8ClampedArray(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return j$t(i,t.width,t.height)}function nxe(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}d([m({type:String,json:{write:Bv}})],fy.prototype,"url",null),d([m({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),m()],fy.prototype,"data",null),d([Ve("data")],fy.prototype,"writeData",null),d([Le("data")],fy.prototype,"readData",null),d([m({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],fy.prototype,"transparent",null),d([m({json:{write:!0}})],fy.prototype,"wrap",void 0),d([m({readOnly:!0})],fy.prototype,"contentHash",null),fy=rR=d([N("esri.geometry.support.MeshTexture")],fy);const ND=fy;let sR=class extends ms(we){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};d([m({type:[Number],nonNullable:!0,json:{write:!0}})],sR.prototype,"offset",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],sR.prototype,"rotation",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],sR.prototype,"scale",void 0),sR=d([N("esri.geometry.support.MeshTextureTransform")],sR);const YP=sR;var zse;let am=zse=class extends we{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new zse(this.clonePropertiesWithDeduplication(e));return t?.set(this,r),r}clonePropertiesWithDeduplication(t){return{color:this.color!=null?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(t),normalTexture:this.normalTexture?.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};d([m({type:Ke,json:{write:!0}})],am.prototype,"color",void 0),d([m({type:ND,json:{write:!0}})],am.prototype,"colorTexture",void 0),d([m({type:YP,json:{write:!0}})],am.prototype,"colorTextureTransform",void 0),d([m({type:ND,json:{write:!0}})],am.prototype,"normalTexture",void 0),d([m({type:YP,json:{write:!0}})],am.prototype,"normalTextureTransform",void 0),d([m({nonNullable:!0,json:{write:!0}})],am.prototype,"alphaMode",void 0),d([m({nonNullable:!0,json:{write:!0}})],am.prototype,"alphaCutoff",void 0),d([m({nonNullable:!0,json:{write:!0}})],am.prototype,"doubleSided",void 0),am=zse=d([N("esri.geometry.support.MeshMaterial")],am);const kde=am;var Vse;let Tp=Vse=class extends kde{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new Vse(this.clonePropertiesWithDeduplication(e));return t?.set(this,r),r}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(t),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(t),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(t),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};d([m({type:Ke,json:{write:!0}})],Tp.prototype,"emissiveColor",void 0),d([m({type:ND,json:{write:!0}})],Tp.prototype,"emissiveTexture",void 0),d([m({type:YP,json:{write:!0}})],Tp.prototype,"emissiveTextureTransform",void 0),d([m({type:ND,json:{write:!0}})],Tp.prototype,"occlusionTexture",void 0),d([m({type:YP,json:{write:!0}})],Tp.prototype,"occlusionTextureTransform",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Tp.prototype,"metallic",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Tp.prototype,"roughness",void 0),d([m({type:ND,json:{write:!0}})],Tp.prototype,"metallicRoughnessTexture",void 0),d([m({type:YP,json:{write:!0}})],Tp.prototype,"metallicRoughnessTextureTransform",void 0),Tp=Vse=d([N("esri.geometry.support.MeshMaterialMetallicRoughness")],Tp);const lVe=Tp;var PG;let lp=PG=class extends we{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return nR(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},oe.getLogger(this))}castPosition(t){return t&&t instanceof Float32Array&&oe.getLogger(this).warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),nR(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},oe.getLogger(this))}castUv(t){return nR(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},oe.getLogger(this))}castNormal(t){return nR(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},oe.getLogger(this))}castTangent(t){return nR(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},oe.getLogger(this))}clone(){const t={position:ee(this.position),uv:ee(this.uv),normal:ee(this.normal),tangent:ee(this.tangent),color:ee(this.color)};return new PG(t)}clonePositional(){const t={position:ee(this.position),normal:ee(this.normal),tangent:ee(this.tangent),uv:this.uv,color:this.color};return new PG(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function tZ(t,e,i,r){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):t}function nR(t,e,i,r,s){if(!t)return t;if(t instanceof e)return tZ(t,r,e,s);for(const n of i)if(t instanceof n)return tZ(new e(t),r,e,s);if(Array.isArray(t))return tZ(new e(t),r,e,s);{const n=i.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function h3(t,e,i){e[i]=X$t(t)}function X$t(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i];return e}d([m({json:{write:h3}})],lp.prototype,"color",void 0),d([vi("color")],lp.prototype,"castColor",null),d([m({nonNullable:!0,json:{write:h3}})],lp.prototype,"position",void 0),d([vi("position")],lp.prototype,"castPosition",null),d([m({json:{write:h3}})],lp.prototype,"uv",void 0),d([vi("uv")],lp.prototype,"castUv",null),d([m({json:{write:h3}})],lp.prototype,"normal",void 0),d([vi("normal")],lp.prototype,"castNormal",null),d([m({json:{write:h3}})],lp.prototype,"tangent",void 0),d([vi("tangent")],lp.prototype,"castTangent",null),lp=PG=d([N("esri.geometry.support.MeshVertexAttributes")],lp);var bL;let my=bL=class extends we{static from(t){return SE(bL,t)}constructor(t){super(t),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return nR(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},oe.getLogger(this))}castMaterial(t){return SE(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?lVe:kde,t)}clone(){return new bL({faces:ee(this.faces),shading:this.shading,material:ee(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(t,e){const i={faces:ee(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new bL(i)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};d([m({json:{write:!0}})],my.prototype,"faces",void 0),d([vi("faces")],my.prototype,"castFaces",null),d([m({type:kde,json:{write:!0}})],my.prototype,"material",void 0),d([vi("material")],my.prototype,"castMaterial",null),d([m()],my.prototype,"name",void 0),d([m({type:String,json:{write:!0}})],my.prototype,"shading",void 0),d([m({type:Boolean})],my.prototype,"trustSourceNormals",void 0),my=bL=d([N("esri.geometry.support.MeshComponent")],my);const Z$t=my;let wL=class extends ms(we){constructor(e){super(e),this.type="georeferenced",this.origin=null}};d([Nt({georeferenced:"georeferenced"},{readOnly:!0})],wL.prototype,"type",void 0),d([m({type:[Number],nonNullable:!1,json:{write:!0}})],wL.prototype,"origin",void 0),wL=d([N("esri.geometry.support.MeshGeoreferencedVertexSpace")],wL);const J$t=wL;let xL=class extends ms(we){constructor(e){super(e),this.type="local",this.origin=M()}};d([Nt({local:"local"},{readOnly:!0})],xL.prototype,"type",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],xL.prototype,"origin",void 0),xL=d([N("esri.geometry.support.MeshLocalVertexSpace")],xL);const Q$t=xL;function oxe(){return oe.getLogger("esri.geometry.Mesh")}function K$t(t){return!w7(t)}function w7(t){return t.origin!=null}function lbi(t){return w7(t.vertexSpace)}function cbi(t,e){if(!w7(t))return null;const[i,r,s]=t.origin;return new $t({x:i,y:r,z:s,spatialReference:e})}function ubi(t,e){const{x:i,y:r,z:s,spatialReference:n}=t,o=[i,r,s??0];return e?.geographic!==void 0&&(Yw(oxe(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),e.vertexSpace&&oxe().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),(e?.vertexSpace??t3t(e?.geographic)??e3t(n))==="local"?new Q$t({origin:o}):new J$t({origin:o})}function e3t(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}function t3t(t){return t==null?void 0:t?"local":"georeferenced"}function hbi(t,e){return t.type===e.type&&(t.origin===e.origin||t.origin!=null&&e.origin!=null&&ga(t.origin,e.origin))}const i3t=()=>oe.getLogger("esri.views.3d.support.buffer.math");function r3t(t,e,i){if(t.count!==e.count)return;const r=t.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],u=i[6],h=i[7],p=i[8],f=i[9],g=i[10],y=i[11],v=i[12],b=i[13],w=i[14],x=i[15],S=t.typedBuffer,E=t.typedBufferStride,C=e.typedBuffer,R=e.typedBufferStride;for(let I=0;I<r;I++){const F=I*E,D=I*R,z=C[D],B=C[D+1],Y=C[D+2],W=C[D+3];S[F]=s*z+l*B+p*Y+v*W,S[F+1]=n*z+c*B+f*Y+b*W,S[F+2]=o*z+u*B+g*Y+w*W,S[F+3]=a*z+h*B+y*Y+x*W}}function s3t(t,e,i,r=4,s=r){if(t.length/r!=e.length/s)return void i3t().error("source and destination buffers need to have the same number of elements");const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],h=i[5],p=i[6],f=i[7],g=i[8],y=i[9],v=i[10],b=i[11],w=i[12],x=i[13],S=i[14],E=i[15];let C=0,R=0;for(let I=0;I<n;I++){const F=e[C],D=e[C+1],z=e[C+2],B=e[C+3];t[R]=o*F+u*D+g*z+w*B,t[R+1]=a*F+h*D+y*z+x*B,t[R+2]=l*F+p*D+v*z+S*B,t[R+3]=c*F+f*D+b*z+E*B,C+=s,R+=r}}function n3t(t,e,i){x7(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function x7(t,e,i,r=4,s=r){if(t.length/r!=e.length/s)return;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],h=i[5],p=i[6],f=i[7],g=i[8];let y=0,v=0;for(let b=0;b<n;b++){const w=e[y],x=e[y+1],S=e[y+2],E=e[y+3];t[v]=o*w+c*x+p*S,t[v+1]=a*w+u*x+f*S,t[v+2]=l*w+h*x+g*S,t[v+3]=E,y+=s,v+=r}}function o3t(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,u=n[c],h=n[c+1],p=n[c+2],f=u*u+h*h+p*p;if(f>0){const g=1/Math.sqrt(f);r[l]=g*u,r[l+1]=g*h,r[l+2]=g*p}}}function a3t(t,e,i){Q8(t.typedBuffer,e,i,t.typedBufferStride)}function Q8(t,e,i,r=4){const s=Math.min(t.length/r,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=i*n[a],t[l+1]=i*n[a+1],t[l+2]=i*n[a+2],t[l+3]=i*n[a+3],a+=o,l+=r}Object.freeze(Object.defineProperty({__proto__:null,normalize:o3t,scale:Q8,scaleView:a3t,transformMat3:x7,transformMat3View:n3t,transformMat4:s3t,transformMat4View:r3t},Symbol.toStringTag,{value:"Module"}));const l3t="Projection may be possible after calling projection.load().";function c3t(t,e,i,r){t.error(`Failed to project from (wkid:${e.wkid}) to (wkid:${i.wkid}).${r?" ":""}${r}`)}function cVe(t,e,i,r,s){return S7(Zv.TO_PCPF,Zo.fromTypedArray(t),ic.NORMAL,ff.fromTypedArray(e),ff.fromTypedArray(i),r,Zo.fromTypedArray(s))?s:null}function u3t(t,e,i,r,s){return S7(Zv.FROM_PCPF,Zo.fromTypedArray(t),ic.NORMAL,ff.fromTypedArray(e),ff.fromTypedArray(i),r,Zo.fromTypedArray(s))?s:null}function h3t(t,e,i){return Ts(t,e,0,i,Xd(e),0,t.length/3)?i:null}function d3t(t,e,i){return Ts(t,Xd(i),0,e,i,0,t.length/3)?e:null}function Gse(t,e,i){return lx(Fo,i),a7(e,t,Fo),dj(Fo)&&aI(e,e),e}function jse(t,e,i){return vf(Fo,i),x7(e,t,Fo),dj(Fo)&&aI(e,e,4),e}function Hse(t,e,i,r){const s=e===ic.NORMAL;return uVe(t,e,i,(n,o)=>{const a=Math.cos(Gt(n));o[0]=s?a:1/a,o[1]=1},r)}function qse(t,e,i,r){const s=e===ic.NORMAL;return uVe(t,e,i,(n,o)=>{const a=Math.cosh(-n/br.radius);o[0]=1,o[1]=s?a:1/a},r)}function uVe(t,e,i,r,s){const n=e===ic.NORMAL?3:4,o=[0,0];for(let a=0,l=1;a<t.length;a+=n,l+=3){r(i[l],o);const c=t[a]*o[0],u=t[a+1]*o[1],h=t[a+2],p=1/Math.sqrt(c*c+u*u+h*h);s[a]=c*p,s[a+1]=u*p,s[a+2]=h*p,n===4&&(s[a+3]=t[a+3])}return s}function hVe(t,e,i,r,s){if(!S7(Zv.TO_PCPF,Zo.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),ic.TANGENT,ff.fromTypedArray(e),ff.fromTypedArray(i),r,Zo.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function p3t(t,e,i,r,s){if(!S7(Zv.FROM_PCPF,Zo.fromTypedArray(t,16),ic.TANGENT,ff.fromTypedArray(e),ff.fromTypedArray(i),r,Zo.fromTypedArray(s,16)))return null;for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}var ic,Zv;function axe(t,e,i,r,s){switch(Bd(r,i,fv,r),t===Zv.FROM_PCPF&&Ao(fv,fv),e){case ic.NORMAL:return lx(s,fv);case ic.TANGENT:return vf(s,fv)}}function S7(t,e,i,r,s,n,o){if(!e)return;const a=r.count,l=Xd(n);if(g3t(n))for(let c=0;c<a;c++)s.getVec(c,oB),e.getVec(c,zg),Ga(zg,zg,axe(t,i,oB,l,Fo)),o.setVec(c,zg);else for(let c=0;c<a;c++){s.getVec(c,oB),e.getVec(c,zg);const u=nj(r.get(c,1));let h=Math.cos(u);i===ic.TANGENT!=(t===Zv.TO_PCPF)&&(h=1/h),axe(t,i,oB,l,Fo),t===Zv.TO_PCPF?(Fo[0]*=h,Fo[1]*=h,Fo[2]*=h,Fo[3]*=h,Fo[4]*=h,Fo[5]*=h):(Fo[0]*=h,Fo[3]*=h,Fo[6]*=h,Fo[1]*=h,Fo[4]*=h,Fo[7]*=h),Ga(zg,zg,Fo),Se(zg,zg),o.setVec(c,zg)}return o}function dVe(t){return t.vertexSpace.type==="local"?f3t(t):m3t(t)}function f3t({vertexSpace:t,transform:e,inSpatialReference:i,outSpatialReference:r,localMode:s,outPositions:n,positions:o}){const a=t.origin??co,l=t.origin!=null?e?.localMatrix??us:us,c=Xd(i),u=r.isWebMercator&&s||!Fu(i,c)?i:c;Bd(i,a,fv,u),Or(fv,fv,l);const h=n??qo(o.length);return wx(h,o,fv),Ts(h,u,0,h,r,0,h.length/3),h}function m3t({vertexSpace:t,transform:e,outPositions:i,positions:r,inSpatialReference:s,outSpatialReference:n}){const o=t.origin!=null?e?.localMatrix??us:us,a=i??qo(r.length);Aq(o,us)?b_t(a,r):wx(a,r,o);const l=t.origin??co;if(!ga(l,co)){const[c,u,h]=l;for(let p=0;p<a.length;p+=3)a[p]+=c,a[p+1]+=u,a[p+2]+=h}return Ts(a,s,0,a,n,0,a.length/3)?a:null}function g3t(t){return t.isWGS84||mO(t)||pC(t)||fC(t)}(function(t){t[t.NORMAL=0]="NORMAL",t[t.TANGENT=1]="TANGENT"})(ic||(ic={})),function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"}(Zv||(Zv={}));const oB=M(),zg=M(),fv=Ne(),Fo=ps(),dbi=Object.freeze(Object.defineProperty({__proto__:null,get VectorType(){return ic},loadProjectErrorMessage:l3t,logProjectionError:c3t,project:dVe,projectFromPCPF:d3t,projectNormalFromPCPF:u3t,projectNormalToPCPF:cVe,projectTangentFromPCPF:p3t,projectTangentToPCPF:hVe,projectToPCPF:h3t,transformNormal:Gse,transformTangent:jse,transformVectorENUPlateCarree:Hse,transformVectorWMPlateCarree:qse},Symbol.toStringTag,{value:"Module"}));var Sy;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(Sy||(Sy={}));let pVe=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=Rv.KTX2_ENCODING}};function LD(t){return t?.type==="encoded-mesh-texture"}async function y3t(t){const e=new Blob([t]),i=await e.text();return JSON.parse(i)}async function _3t(t,e){if(e===Rv.KTX2_ENCODING)return new pVe(t);const i=new Blob([t],{type:e}),r=URL.createObjectURL(i),s=new Image;if(ae("esri-iPhone"))return new Promise((n,o)=>{const a=()=>{c(),n(s)},l=u=>{c(),o(u)},c=()=>{URL.revokeObjectURL(r),s.removeEventListener("load",a),s.removeEventListener("error",l)};s.addEventListener("load",a),s.addEventListener("error",l),s.src=r});try{s.src=r,await s.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(r),s}function jy(t){if(t==null)return null;const e=t.offset!=null?t.offset:f5e,i=t.rotation!=null?t.rotation:0,r=t.scale!=null?t.scale:m5e,s=aD(1,0,0,0,1,0,e[0],e[1],1),n=aD(Math.cos(i),-Math.sin(i),0,Math.sin(i),Math.cos(i),0,0,0,1),o=aD(r[0],0,0,0,r[1],0,0,0,1),a=ps();return UO(a,n,o),UO(a,s,a),a}const v3t={disableDelayMs:2e3};let b3t=class extends G0{constructor(){super(...arguments),this.fastTransformUpdatesAllowed=!1,this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1,this._autoDisableFastUpdatesTimeoutId=0}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}destroy(){super.destroy(),this._cancelAutoDisableFastUpdates()}enableFastTransformUpdates(e,i){if(!this.fastTransformUpdatesAllowed||this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!0;const{stageObject:r}=this,s=r.geometries.slice();r.removeAllGeometries();const n=pj(iZ,r.transformation),o=i.getOrigin(n);for(const a of s){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,r.addGeometry(c)}this._originalGeometries=s}autoDisableFastTransformUpdates(e){this._cancelAutoDisableFastUpdates(),this._autoDisableFastUpdatesTimeoutId=setTimeout(()=>{this._autoDisableFastUpdatesTimeoutId=0,e()},v3t.disableDelayMs)}updateAutoDisableFastTransformUpdates(e){this._autoDisableFastUpdatesTimeoutId&&this.autoDisableFastTransformUpdates(e)}_cancelAutoDisableFastUpdates(){clearTimeout(this._autoDisableFastUpdatesTimeoutId),this._autoDisableFastUpdatesTimeoutId=0}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!1;const{stageObject:i}=this,r=i.geometries.map(s=>e(s.material));i.removeAllGeometries();for(let s=0;s<this._originalGeometries.length;s++){const n=this._originalGeometries[s],o=r[s];o.setParameters({modelTransformation:null}),o===n.material?i.addGeometry(n):i.addGeometry(n.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,i,r){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:s}=this;if(s.geometries.length===0)return;const n=s.geometries[0].localOrigin,o=pj(iZ,e),a=r.getOrigin(o);if(a===n)return;const l=i?.localMatrix??us;s.shaderTransformation=null,s.transformation=e,s.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,i,r){const{stageObject:s}=this,n=i?.localMatrix??us;if(!this._fastTransformUpdatesEnabled)return s.shaderTransformation=null,s.transformation=e,s.geometries.forEach(f=>f.transformation=n),void this._updateEdgeTransform(r);const o=s.transformation,a=s.geometries[0].transformation,l=e,c=n,u=Or(lxe,o,a),h=Or(cxe,l,c),p=Or(uxe,h,Ao(uxe,a));s.shaderTransformation=p,this._setFastMaterialTransformation({matA:u,matB:h}),this._updateEdgeTransform(r)}alignWithElevation(e,i,r,s){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,i,r,s);r!=null&&t7(this.elevationContext.featureExpressionInfoContext,r);const n=(g,y)=>_x(g,e,this.elevationContext,i,y),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=Or(lxe,a,l),u=o.effectiveTransformation,h=Xn(w3t,u);this.alignedSampledElevation=uE(this,this.elevationContext,e.spatialReference,n,i,h),o.shaderTransformation=h;const p=o.geometries[0].transformation,f=Or(cxe,h,p);this._setFastMaterialTransformation({matA:c,matB:f}),this._updateEdgeTransform(s)}_setFastMaterialTransformation({matA:e,matB:i}){const{stageObject:r}=this;if(r.geometries.length===0)return;const s=r.geometries[0].localOrigin,n=mC(x3t,ce(iZ,s.vec3,-1)),o=Or(hxe,n,e),a=Or(dxe,n,i),l=Ao(hxe,o),c=Or(dxe,a,l);for(const u of r.geometries)u.material.setParameters({modelTransformation:c})}_updateEdgeTransform(e){const{stageObject:i,_stageLayer:r}=this;r.stage.renderer.withEdgeView(s=>{s.fastUpdateObject3DEdgesTransform(i)||this.resetEdgeObject(e)})}};const iZ=M(),lxe=Ne(),cxe=Ne(),w3t=Ne(),uxe=Ne(),hxe=Ne(),dxe=Ne(),x3t=Ne();let S3t=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,i,r){e.enableFastTransformUpdates(s=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(s))return s;const o=i.byMaterial(s);return this._fastTransformOriginalMaterials.set(s,o),i.delete(s),s}const n=new vg(s.parameters);return r.stage.add(n),this._fastTransformClonedMaterials.set(n,s),n},r.localOriginFactory)}disable(e,i,r){const s=new Set,n=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,u=this._fastTransformOriginalMaterials.get(c);return i.has(u.uid)?(s.add(c),i.byUid(u.uid).material):(n.add(c),u.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),r.stage.remove(a),l});for(const o of s)this._fastTransformOriginalMaterials.delete(o),r.stage.remove(o);for(const o of n){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),i.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,i,r){this._graphicReferenceCount--,this.disable(e,i,r)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:i})=>i)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},T3t=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,i){this._byUid.set(e,i),this._byMaterial.set(i.material,i)}delete(e){const i=this._byMaterial.get(e)?.uid;i&&(this._byUid.delete(i),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};const E3t=Xs().vec3f(O.POSITION),C3t=Xs().vec3f(O.POSITION).vec2f(O.UV0),M3t=Xs().vec3f(O.POSITION).vec4u8(O.COLOR),A3t=Xs().vec3f(O.POSITION).vec2f(O.UV0).vec4u8(O.OBJECTANDLAYERIDCOLOR);function R3t(t){const e=new tr,{vertex:i,fragment:r}=e;return e.include(ec,t),e.include(LC,t),Pu(i,t),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vpos","vec3"),i.code.add(T`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`),t.output===G.Highlight&&e.include(Wx,t),e.include(Wn,t),r.uniforms.add(new et("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||r.uniforms.add(new Ki("constantColor",s=>s.color)),r.code.add(T`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    ${t.output===G.ObjectAndLayerIdColor?T`color.a = 1.0;`:""}

    if (color.a < ${T.float(Ba)}) {
      discard;
    }

    ${t.output===G.Color?T`fragColor = highlightSlice(color, vpos);`:""}
    ${t.output===G.Highlight?T`outputHighlight();`:""}
  }
  `),e}const P3t=Object.freeze(Object.defineProperty({__proto__:null,build:R3t},Symbol.toStringTag,{value:"Module"}));let fVe=class mVe extends hr{initializeProgram(e){return new dr(e.rctx,mVe.shader.get().build(this.configuration),Fi)}initializePipeline(){const e=this.configuration,i=Za(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),r=(s,n=null,o=null)=>ti({blending:n,depthTest:Qhe,depthWrite:o,colorWrite:fi,stencilWrite:e.hasOccludees?x0:null,stencilTest:e.hasOccludees?s?bx:Xx:null});return e.output===G.Color?(this._occludeePipelineState=r(!0,e.transparent?i:null,Oh),r(!1,e.transparent?i:null,Oh)):r(!1)}get primitiveType(){return Li.LINES}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};fVe.shader=new ir(P3t,()=>ye(()=>import("./NativeLine.glsl-0852b6f9.js"),[],import.meta.url));let oR=class extends $u{constructor(){super(...arguments),this.output=G.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}};d([V({count:G.COUNT})],oR.prototype,"output",void 0),d([V()],oR.prototype,"hasSlicePlane",void 0),d([V()],oR.prototype,"hasVertexColors",void 0),d([V()],oR.prototype,"transparent",void 0),d([V()],oR.prototype,"hasOccludees",void 0);let rZ=class extends qx{constructor(e){super(e,new I3t),this._configuration=new oR,this.produces=new Map([[Ce.OPAQUE_MATERIAL,i=>i===G.Color||i===G.Highlight||i===G.ObjectAndLayerIdColor]])}getConfiguration(e){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!DDe(i))return void oe.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes.get(O.POSITION).data,l=r.camera,c=N3t;Cl(c,r.point);const u=2;ue(d3[0],c[0]-u,c[1]+u,0),ue(d3[1],c[0]+u,c[1]+u,0),ue(d3[2],c[0]+u,c[1]-u,0),ue(d3[3],c[0]-u,c[1]-u,0);for(let y=0;y<4;y++)if(!l.unprojectFromRenderScreen(d3[y],l_[y]))return;Xl(l.eye,l_[0],l_[1],sZ),Xl(l.eye,l_[1],l_[2],nZ),Xl(l.eye,l_[2],l_[3],oZ),Xl(l.eye,l_[3],l_[0],aZ);let h=Number.MAX_VALUE,p=0;for(let y=0;y<a.length-5;y+=3){if(ou[0]=a[y]+i[12],ou[1]=a[y+1]+i[13],ou[2]=a[y+2]+i[14],au[0]=a[y+3]+i[12],au[1]=a[y+4]+i[13],au[2]=a[y+5]+i[14],Wr(sZ,ou)<0&&Wr(sZ,au)<0||Wr(nZ,ou)<0&&Wr(nZ,au)<0||Wr(oZ,ou)<0&&Wr(oZ,au)<0||Wr(aZ,ou)<0&&Wr(aZ,au)<0)continue;if(l.projectToRenderScreen(ou,PS),l.projectToRenderScreen(au,OS),PS[2]<0&&OS[2]>0){Me(Vg,ou,au);const b=l.frustum,w=-Wr(b[zr.NEAR],ou)/xe(Vg,b[zr.NEAR]);ce(Vg,Vg,w),Te(ou,ou,Vg),l.projectToRenderScreen(ou,PS)}else if(PS[2]>0&&OS[2]<0){Me(Vg,au,ou);const b=l.frustum,w=-Wr(b[zr.NEAR],au)/xe(Vg,b[zr.NEAR]);ce(Vg,Vg,w),Te(au,au,Vg),l.projectToRenderScreen(au,OS)}else if(PS[2]<0&&OS[2]<0)continue;PS[2]=0,OS[2]=0;const v=Oce(nE(PS,OS,mxe),c);v<h&&(h=v,ge(pxe,ou),ge(fxe,au),p=y/3)}const f=r.rayBegin,g=r.rayEnd;if(h<u*u){let y=Number.MAX_VALUE;if(Z$e(nE(pxe,fxe,mxe),nE(f,g,$3t),RS)){Me(RS,RS,f);const v=De(RS);ce(RS,RS,1/v),y=v/jr(f,g)}o(y,RS,p,!1)}}intersectDraped(e,i,r,s,n,o){if(!r.options.selectionMode)return;const a=e.attributes.get(O.POSITION).data,l=e.attributes.get(O.SIZE),c=l?l.data[0]:0,u=s[0],h=s[1],p=((c+1)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,g=0;for(let y=0;y<a.length-5;y+=3){const v=a[y],b=a[y+1],w=u-v,x=h-b,S=a[y+3]-v,E=a[y+4]-b,C=$e((S*w+E*x)/(S*S+E*E),0,1),R=S*C-w,I=E*C-x,F=R*R+I*I;F<f&&(f=F,g=y/3)}f<p*p&&n(o.dist,o.normal,g,!1)}createGLMaterial(e){return new O3t(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?M3t:E3t;return new QI(e)}},O3t=class extends jx{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===G.Color&&this._updateOccludeeState(e),this.ensureTechnique(fVe,e)}},I3t=class extends $he{constructor(){super(...arguments),this.color=Xp,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.hasOccludees=!1}};const ou=M(),au=M(),Vg=M(),RS=M(),PS=_l(),OS=_l(),pxe=M(),fxe=M(),mxe=Eg(),$3t=Eg(),N3t=M(),d3=[_l(),_l(),_l(),_l()],l_=[M(),M(),M(),M()],sZ=mr(),nZ=mr(),oZ=mr(),aZ=mr(),L3t=["mesh"];let D3t=class extends j0{constructor(e,i,r,s){super(e,i,r,s),this._materialInfoCache=new T3t,this._fastUpdateProcessor=new S3t,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){ts.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new rZ({color:[1,0,1,1]}),this._debugTangentNormalMaterial=new rZ({color:[1,.5,0,1]}),this._debugFaceNormalMaterial=new rZ({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach(e=>e.unload()),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,L3t,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i),s=e.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,i){const r=this._getLayerOpacity();this._updateMaterialParameters(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>i(s)?.layerOpacityChanged(r,this._context.isAsync))}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,vx)}slicePlaneEnabledChanged(e,i){return this._updateMaterialParameters(({material:r})=>{r.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(r=>i(r)?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:i})=>i.setParameters({usePBR:e})),!0}updateTransform(e,i,r,s){if(!e.fastTransformUpdatesAllowed)return!1;const n=e.fastTransformUpdatesEnabled;switch(s){case Sy.EnableFastUpdates:if(n)return!0;break;case Sy.DisableFastUpdates:if(!n)return!0;break;default:if(!n)return!!this.updateTransform(e,i,r,Sy.EnableFastUpdates)&&(e.autoDisableFastTransformUpdates(()=>this.updateTransform(e,i,r,Sy.DisableFastUpdates)),!0)}const o=this._context.renderCoordsHelper.spatialReference,a=Y3t,{origin:l,transform:c}=r;if(!Bd(i,ue(_s,l.x,l.y,l.z??0),a,o))return!1;switch(s){case Sy.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case Sy.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case Sy.UpdateFastLocalOrigin:e.updateFastLocalOrigin(a,c,this._context.localOriginFactory)}const{elevationContext:u}=e;u.centerPointInElevationSR=this._getCenterPointInElevationSR(a);const{elevationProvider:h,renderCoordsHelper:p}=this._context,f=(g,y)=>_x(g,h,u,p,y);return e.alignedSampledElevation=uE(e,u,h.spatialReference,f,p,a),e.updateTransform(a,c,this._context.isAsync),e.updateAutoDisableFastTransformUpdates(()=>this.updateTransform(e,i,r,Sy.DisableFastUpdates)),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_materialPropertiesDefault(e,i){const r=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(e,i,r){const s=this._materialPropertiesDefault(e,r);if(!i.material)return s;const{color:n,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:u,alphaCutoff:h,alphaMode:p}=i.material,f=IS(n),g=IS(o),y=f3(a),v=IS(l),b=f3(c);if(s.color=n,s.colorTexture=o,s.normalTexture=l,s.uid=`${s.uid},cmuid:${f},ctmuid:${g},cttuid:${y},ntmuid:${v},nttuid:${b},ds:${u},ac:${h},am:${p}`,i.material instanceof lVe){const{metallic:w,roughness:x,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:E,emissiveColor:C,emissiveTexture:R,emissiveTextureTransform:I,occlusionTexture:F,occlusionTextureTransform:D}=i.material,z=IS(S),B=f3(E),Y=IS(C),W=IS(R),J=f3(I),me=IS(F),L=f3(D);s.metallic=w,s.roughness=x,s.metallicRoughnessTexture=S,s.emissiveColor=C,s.emissiveTexture=R,s.occlusionTexture=F,s.colorTextureTransform=p3(a),s.normalTextureTransform=p3(c),s.emissiveTextureTransform=p3(I),s.occlusionTextureTransform=p3(D),s.metallicRoughnessTextureTransform=p3(E),s.uid=`${s.uid},mrm:${w},mrr:${x},mrt:${z},mrtt:${B},emuid:${Y},etmuid:${W},ett:${J},otmuid:${me},ott:${L}`}return s}_getInternalTextureId(e){return this._getInternalTexture(e,Yr.Opaque)?.id}_getInternalTexture(e,i){const r=H3t(e);if(!r)return null;const s=`${e.contentHash}/${i}`;let n=this._textures.get(s);if(!n){let o=null;const a=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,l={wrap:V3t(e.wrap),noUnpackFlip:!0,maxAnisotropy:a,mipmap:a>1};LD(r)?(o=r.data,l.preMultiplyAlpha=!1,l.encoding=r.encoding):(o=r,l.preMultiplyAlpha=i!==Yr.Opaque,l.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),n=new xx(o,l),this._textures.set(s,n),n.load(this._context.stage.renderView.renderingContext),this._context.stage.add(n)}return n}_setInternalMaterialParameters(e,i){if(e.color!=null&&j3t(e.color,i),e.colorTexture!=null){const s=this._getInternalTexture(e.colorTexture,i.textureAlphaMode);s?(i.textureId=s.id,i.textureAlphaPremultiplied=!!s.parameters.preMultiplyAlpha):i.textureId=void 0}e.normalTexture&&(i.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor&&(i.emissiveFactor=Ke.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(i.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture&&(i.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture&&(i.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),i.colorTextureTransformMatrix=jy(e.colorTextureTransform),i.normalTextureTransformMatrix=jy(e.normalTextureTransform);const r=e.normalTextureTransform?.scale!=null?e.normalTextureTransform?.scale:Jq;i.scale=[r[0],r[1]],i.occlusionTextureTransformMatrix=jy(e.occlusionTextureTransform),i.emissiveTextureTransformMatrix=jy(e.emissiveTextureTransform),i.metallicRoughnessTextureTransformMatrix=jy(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const i=this._drivenProperties.color;let r=this.symbolLayer.material?.colorMixMode??null;if(i)e.externalColor=Xp;else{const s=this.symbolLayer.material?.color??null;s?e.externalColor=Ke.toUnitRGBA(s):(r=null,e.externalColor=Xp)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_getOrCreateMaterial(e,i){const r=i.material?.color,s=i.material?.colorTexture,n=i.material?.alphaMode,o=n==="blend",a=n!=="opaque"&&(G3t(e)||r!=null&&r.a<1||s?.transparent||o),l=this._materialProperties(e,i,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const u={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},h=UUe({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:Ke.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),p={usePBR:this._usePBR(),isSchematic:h,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:co,diffuse:bv,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:ns.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p.mrrFactors=h?[...Khe]:[l.metallic,l.roughness,s7[2]],i.material&&(p.doubleSided=i.material.doubleSided,p.cullFace=i.material.doubleSided?ns.None:ns.Back,p.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(p),this._setMaterialTransparentParameter(p,u),this._setInternalMaterialParameters(l,p);const f=new vg(p);return u.material=f,this._materialInfoCache.set(l.uid,u),this._context.stage.add(f),f}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,i){e.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,i.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Yr.MaskBlend:Yr.Opaque:e.textureAlphaMode=i.alphaMode==="opaque"?Yr.Opaque:i.alphaMode==="mask"?Yr.Mask:Yr.Blend}_createFaceDebugNormals(e,i){const r=i.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=i[0].transformation,c=lx(ps(),l);for(let u=0;u<r;u++){const h=i[u].attributes.get(O.POSITION);if(!h)continue;const p=h.data,f=h.indices;for(let g=0;g<f.length;g+=3)T7(p,f,g,$y),yVe(p,f,g,_s,Lp,sP),Te(_s,_s,Lp),Te(_s,_s,sP),ce(_s,_s,1/3),nt(_s,_s,l),o.push(..._s),Ga($y,$y,c),Se($y,$y),ao(_s,_s,$y,n),o.push(..._s),a.push(a.length),a.push(a.length)}return o.length?new Zn(this._debugFaceNormalMaterial,[[O.POSITION,new dt(o,a,3,!0)]],null,an.Line):null}_createPerVertexDebugVectors(e,i,r,s,n){const o=i.length,a=e.spatialReference.isGeographic?20015077/180:1,l=.1*n*Math.max(e.extent.width*a,e.extent.height*a,e.extent.zmax-e.extent.zmin),c=[],u=[],h=i[0].transformation,p=lx(ps(),h);r===O.TANGENT&&vf(p,h);for(let f=0;f<o;f++){const g=i[f],y=g.attributes.get(O.POSITION),v=g.attributes.get(r);if(!y||!v)continue;const b=y.data,w=y.indices,x=v.data,S=v.indices;for(let E=0;E<w.length;E++){const C=3*w[E],R=S[E]*v.stride;ue(_s,b[C+0],b[C+1],b[C+2]),nt(_s,_s,h),c.push(..._s),ue(Lp,x[R+0],x[R+1],x[R+2]),Ga(Lp,Lp,p),Se(Lp,Lp),ao(_s,_s,Lp,l),c.push(..._s),u.push(u.length),u.push(u.length)}}return c.length?new Zn(s,[[O.POSITION,new dt(c,u,3,!0)]],null,an.Line):null}_createAs3DShape(e,i,r,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,i,s);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;if(ts.DRAW_MESH_GEOMETRY_NORMALS){const v=this._createPerVertexDebugVectors(n,a,O.NORMAL,this._debugVertexNormalMaterial,1),b=this._createPerVertexDebugVectors(n,a,O.TANGENT,this._debugTangentNormalMaterial,.5),w=this._createFaceDebugNormals(n,a);v&&a.push(v),b&&a.push(b),w&&a.push(w)}const c=new Zx({geometries:a,layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0});c.transformation=l;const u=CUe(this.symbolLayer,{opacity:this._getLayerOpacity()}),h=u?new CTt(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,p=new b3t(this,c,a,null,null,uE,r,h);this._fastUpdateProcessor.onAddGraphic(),p.needsElevationUpdates=vx(r.mode),p.useObjectOriginAsAttachmentOrigin=!0,p.fastTransformUpdatesAllowed=this._fastTransformUpdatesAllowed(n),r.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:f,renderCoordsHelper:g}=this._context,y=(v,b)=>_x(v,f,r,g,b);return p.alignedSampledElevation=uE(p,r,f.spatialReference,y,g),p}_fastTransformUpdatesAllowed(e){const{vertexSpace:i,spatialReference:r}=e;if(!w7(i))return!1;const{type:s}=i,{view:n}=this._context.graphicsCoreOwner,{viewingMode:o}=n.state,a=n.spatialReference;return o===Xe.Global&&s==="local"||o===Xe.Local&&Bs(a,r)&&s==="georeferenced"&&!r.isGeographic}_getCenterPointInElevationSR(e){const i=Dx(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return Fx([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,i),i}_passthroughReprojectionInfo(e){return e.reprojection===eh.NONE&&!!e.objectTransformation}_createPositionBuffer(e,i){const r=e.vertexAttributes.position;let s=r,n=null;if(i.reprojection===eh.NONE)return{position:s,georeferencedPositionBuffer:n};const o=i.reprojection===eh.RENDER?i.transformBeforeProject:null;o&&(s=wx(new Float64Array(s.length),s,o));const{normal:a,tangent:l}=e.vertexAttributes;this._passthroughReprojectionInfo(i)||!a&&!l||(n=s);const c=s===r||s===n?new Float64Array(s.length):s;return Ts(s,e.spatialReference,0,c,this._context.renderCoordsHelper.spatialReference,0,s.length/3),{position:c,georeferencedPositionBuffer:n}}_createNormalBuffer(e,i,r,s){const n=e.vertexAttributes.normal;if(n==null)return null;let o=n;const a=s.reprojection===eh.RENDER?s.transformBeforeProject:null;a&&(o=Gse(o,new Float32Array(o.length),a));const l=this._context.graphicsCoreOwner.view.viewingMode;if(s.reprojection===eh.NONE)return o;if(l==="local"){if(!CE(this._context.renderCoordsHelper.spatialReference))return o;if(r==null)return null;if(e.spatialReference.isGeographic){const u=o===n?new Float32Array(o.length):o;return Hse(o,ic.NORMAL,r,u)}if(e.spatialReference.isWebMercator){const u=o===n?new Float32Array(o.length):o;return qse(o,ic.NORMAL,r,u)}return o}if(r==null)return null;const c=o===n?new Float32Array(o.length):o;return cVe(o,r,i,e.spatialReference,c)}_createTangentBuffer(e,i,r,s){const n=e.vertexAttributes.tangent;if(n==null)return null;let o=n;const a=s.reprojection===eh.RENDER?s.transformBeforeProject:null;a&&(o=jse(o,new Float32Array(o.length),a));const l=this._context.graphicsCoreOwner.view.viewingMode;if(s.reprojection===eh.NONE)return o;if(l==="local"){if(!CE(this._context.renderCoordsHelper.spatialReference))return o;if(r==null)return null;if(e.spatialReference.isGeographic){const u=o===n?new Float32Array(o.length):o;return Hse(o,ic.TANGENT,r,u)}if(e.spatialReference.isWebMercator){const u=o===n?new Float32Array(o.length):o;return qse(o,ic.TANGENT,r,u)}return o}if(r==null)return null;const c=o===n?new Float32Array(o.length):o;return hVe(o,r,i,e.spatialReference,c)}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(e),r=FTt(this.symbolLayer?.material?.colorMixMode),s=new Uint8Array(4);return TUe(i,r,s),s}return null}_createBuffers(e,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(s&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),{position:l,georeferencedPositionBuffer:c}=this._createPositionBuffer(e,a),u=q3t(e),h=this._createSymbolColorBuffer(i),p=this._createNormalBuffer(e,l,c,a),f=this._createTangentBuffer(e,l,c,a),g=n,{transformation:y,position:v,normal:b,tangent:w}=this._passthroughReprojectionInfo(a)?{transformation:a.objectTransformation,position:l,normal:p,tangent:f}:this._transformOriginLocal(e,l,p,f);return{positionBuffer:v,normalBuffer:b,tangentBuffer:w,uvBuffer:g,colorBuffer:u,symbolColorBuffer:h,objectTransformation:y,geometryTransformation:a.reprojection===eh.NONE&&a.geometryTransformation?a.geometryTransformation:Ne()}}_computeReprojectionInfo(e){const{vertexSpace:i}=e,r=i.type==="georeferenced"?Bs(this._context.renderCoordsHelper.spatialReference,e.spatialReference)?eh.NONE:eh.RENDER:eh.NONE;if(K$t(i))return{reprojection:r};const s=i.origin,n=Ne(),o=e.transform?.localMatrix??us;if(r===eh.NONE)return Bd(e.spatialReference,s,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:DO(o)};const a=mC(Ne(),s);return Or(a,a,o),{reprojection:r,transformBeforeProject:a}}_transformOriginLocal(e,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;aB[0]=o.x,aB[1]=o.y,aB[2]=o.z??0;const a=Ne();Bd(e.spatialReference,aB,a,n),Ao(lB,a);const{position:l,normal:c,tangent:u}=e.vertexAttributes,h=i===l?new Float64Array(i.length):i;wx(h,i,lB);const p=r?r===c?new Float32Array(r.length):r:null,f=s?s===u?new Float32Array(s.length):s:null;return r&&p&&Gse(r,p,lB),s&&f&&jse(s,f,lB),{transformation:a,position:h,normal:p,tangent:f}}_validateFaces(e,i){const r=e.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const i=e.vertexAttributes?.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference,s=dVe({positions:i,transform:e.transform,vertexSpace:e.vertexSpace,inSpatialReference:e.spatialReference,outSpatialReference:r??e.spatialReference,localMode:this._context.stage.viewingMode===Xe.Local});if(!s)return!1;const n=s.length/3;return hs(cZ),Id(cZ,s,0,n),!Gm(cZ,this._context.clippingExtent)}_createGeometryInfo(e,i,r){if(!Fu(e.spatialReference,this._context.renderCoordsHelper.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(!this._validateVertexSpace(e)||this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,i);if(s==null)return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:h,geometryTransformation:p}=s,f=z3t(e),g=new Array;let y=!1;const v=pj(_s,h),b=this._context.localOriginFactory.getOrigin(v);for(const w of f){if(!this._validateFaces(e,w))return null;const x=F3t(e,w);if(x.length===0)continue;const S=k3t(n,c,w,x);S.didFlipNormals&&(y=!0);const E=[[O.POSITION,new dt(n,x,3,!0)],[O.NORMAL,new dt(S.normals,S.indices,3,!0)]];a&&E.push([O.COLOR,new dt(a,x,4,!0)]),l&&E.push([O.SYMBOLCOLOR,new dt(l,Hx(x.length),4,!0)]),o&&E.push([O.UV0,new dt(o,x,2,!0)]),u&&E.push([O.TANGENT,new dt(u,x,4,!0)]);const C=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),R=this._getOrCreateMaterial(e,w),I=new Zn(R,E,null,an.Mesh,C);I.transformation=p,I.localOrigin=b,g.push(I)}return y&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,objectTransformation:h}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((i,r)=>{r.setParameters(i.parameters)})}_validateVertexSpace(e){const{_context:{graphicsCoreOwner:{view:{state:{viewingMode:i}}}}}=this,{vertexSpace:r}=e;return i!==Xe.Local||r.type!=="local"||(this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."),!1)}test(){return{...super.test(),materials:this._materialInfoCache.materials}}},Ude=class{constructor(e,i,r){this.normals=e,this.indices=i,this.didFlipNormals=r}};function F3t(t,e){return e.faces??OC(t.vertexAttributes.position.length/3)}function k3t(t,e,i,r){switch(i.shading||"flat"){default:case"source":return U3t(t,e,i,r);case"flat":return gVe(t,r);case"smooth":return B3t(t,r)}}function gVe(t,e){const i=qs(e.length),r=new Array(3*e.length);for(let s=0;s<e.length;s+=3){const n=T7(t,e,s,$y);for(let o=0;o<3;o++)i[s+o]=n[o],r[s+o]=s/3}return new Ude(i,r,!1)}function U3t(t,e,i,r){if(e==null)return gVe(t,r);let s=!1;if(!i.trustSourceNormals)for(let n=0;n<r.length;n+=3){T7(t,r,n,$y);for(let o=0;o<3;o++){const a=3*r[n+o];_s[0]=e[a],_s[1]=e[a+1],_s[2]=e[a+2],xe($y,_s)<0&&(e[a]=-e[a],e[a+1]=-e[a+1],e[a+2]=-e[a+2],s=!0)}}return new Ude(e,r,s)}function B3t(t,e){const i={};for(let n=0;n<e.length;n+=3){const o=T7(t,e,n,$y);for(let a=0;a<3;a++){const l=e[n+a];let c=i[l];c||(c={normal:M(),count:0},i[l]=c),Te(c.normal,c.normal,o),c.count++}}const r=qs(3*e.length),s=new Array(3*e.length);for(let n=0;n<e.length;n++){const o=i[e[n]];o.count!==1&&(Se(o.normal,o.normal),o.count=1);for(let a=0;a<3;a++)r[3*n+a]=o.normal[a];s[n]=n}return new Ude(r,s,!1)}function yVe(t,e,i,r,s,n){const o=3*e[i],a=3*e[i+1],l=3*e[i+2];r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],s[0]=t[a],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l],n[1]=t[l+1],n[2]=t[l+2]}function T7(t,e,i,r){return yVe(t,e,i,_s,Lp,sP),Me(Lp,Lp,_s),Me(sP,sP,_s),yt(_s,Lp,sP),Se(r,_s),r}function z3t(t){return t.components??X3t}function p3(t){if(!t)return null;const{scale:e,offset:i,rotation:r}=t;return{scale:e,offset:i,rotation:Gt(r)}}function V3t(t="repeat"){if(typeof t=="string"){const e=lZ(t);return{s:e,t:e}}return{s:lZ(t.horizontal),t:lZ(t.vertical)}}function lZ(t){switch(t){case"clamp":return Di.CLAMP_TO_EDGE;case"mirror":return Di.MIRRORED_REPEAT;default:return Di.REPEAT}}function G3t(t){const e=t.vertexAttributes.color;if(e==null)return!1;for(let i=3;i<e.length;i+=4)if(e[i]!==255)return!0;return!1}function j3t(t,e){e.diffuse=Ke.toUnitRGB(t),e.opacity=t.a}function H3t(t){return t.data??t.url}function IS(t){return t==null?"-":t instanceof Ke?t.toHex():t.contentHash}function f3(t){const{offset:e,scale:i,rotation:r}=t??W3t;return`${e[0]},${e[1]},${r},${i[0]},${i[1]}`}function q3t(t){return t.vertexAttributes.color}const W3t=new YP,aB=M(),_s=M(),Lp=M(),sP=M(),$y=M(),lB=Ne(),Y3t=Ne(),cZ=Oo(),X3t=[new Z$t];var eh;(function(t){t[t.NONE=0]="NONE",t[t.RENDER=1]="RENDER"})(eh||(eh={}));let Z3t=class{constructor(e,i,r,s){this.graphics3DSymbolLayer=e,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const i=this._lodRenderer.instanceData;e!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,i,r){if(this.elevationAligner){t7(this.elevationContext.featureExpressionInfoContext,r);const s=(o,a)=>_x(o,e,this.elevationContext,i,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,i);n!=null&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=M()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Gg),nt(e,this._lodRenderer.baseBoundingSphere.center,Gg)}getBoundingBoxObjectSpace(e=Oo()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Gg);const i=this._lodRenderer.baseBoundingBox;hs(e);for(let r=0;r<8;++r)ue(cp,1&r?i[3]:i[0],2&r?i[4]:i[1],4&r?i[5]:i[2]),nt(cp,cp,Gg),pg(e,cp);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Gg),e.render.origin[0]+=Gg[12],e.render.origin[1]+=Gg[13],e.render.origin[2]+=Gg[14],e.render.num++}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=J3t,l=Sue(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Gg);for(let u=0;u<l;u++){const h=a[u];cp[0]=o[h[0]],cp[1]=o[h[1]],cp[2]=o[h[2]],nt(cp,cp,Gg),$S[3*u]=cp[0],$S[3*u+1]=cp[1],$S[3*u+2]=cp[2]}if(!e($S,0,l))return null;hs(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let h=0;h<3;h++)o[h]=Math.min(o[h],$S[u+h]),o[h+3]=Math.max(o[h+3],$S[u+h]);c&&r.push({location:$S.slice(u,u+3),screenSpaceBoundingRect:c})}if(i&&(Vm(o,uZ),this.elevationContext.mode!=="absolute-height")){let u;const h=Ghe(o,i.service.spatialReference,i);try{u=await i.service.queryElevation(uZ[0],uZ[1],s,h,"ground")}catch{}u!=null&&$Le(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e,i){if(e===qv.Highlight){const r=new o8(e);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(e){this._highlights.forEach(i=>e.remove(i))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const $S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],cp=M(),uZ=M(),J3t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Gg=Ne();function Q3t(t,e){const i=t.stageResources.geometries.map(s=>new vUe(s,t.stageResources.textures)),r=t.lodThreshold==null||t.lodThreshold===0&&e>0?eNt(i):t.lodThreshold;return new bUe(i,r,t.pivotOffset)}function K3t(t){return new wUe(t.map((e,i)=>Q3t(e,i)))}function eNt(t){const e=t.reduce((i,{geometry:r})=>i+r.indexCount/3,0);return Math.sqrt(e*tNt/Math.PI)}const tNt=20;function iNt(t){return t=t||globalThis.location.hostname,rNt.some(e=>t?.match(e)!=null)}function Wse(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(_Ve)!=null||e.match(bVe)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(vVe)!=null||e.match(wVe)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const _Ve=/^devext\.arcgis\.com$/,vVe=/^qaext\.arcgis\.com$/,bVe=/^[\w-]*\.mapsdevext\.arcgis\.com$/,wVe=/^[\w-]*\.mapsqa\.arcgis\.com$/,rNt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local\.esri\.com$/,_Ve,vVe,/^jsapps\.esri\.com$/,bVe,wVe];function sNt(t,e){Bde(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function Bde(t,e,i=2,r=i){const s=e.length/2;let n=0,o=0;if(f0(e)||mXe(e)){for(let l=0;l<s;++l)t[n]=e[o],t[n+1]=e[o+1],n+=i,o+=r;return}const a=gXe(e);if(fXe(e))for(let l=0;l<s;++l)t[n]=Math.max(e[o]/a,-1),t[n+1]=Math.max(e[o+1]/a,-1),n+=i,o+=r;else for(let l=0;l<s;++l)t[n]=e[o]/a,t[n+1]=e[o+1]/a,n+=i,o+=r}function nNt(t,e,i,r){const s=t.typedBuffer,n=t.typedBufferStride,o=r?.count??t.count;let a=(r?.dstIndex??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:nNt,normalizeIntegerBuffer:Bde,normalizeIntegerBufferView:sNt},Symbol.toStringTag,{value:"Module"}));function oNt(t,e){E7(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function E7(t,e,i=3,r=i){const s=e.length/r;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=i,o+=r}function aNt(t,e,i,r,s){const n=t.typedBuffer,o=t.typedBufferStride,a=s?.count??t.count;let l=(s?.dstIndex??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:E7,copyView:oNt,fill:aNt},Symbol.toStringTag,{value:"Module"}));function lNt(t,e){zde(t.typedBuffer,e,t.typedBufferStride)}function zde(t,e,i=4){const r=e.typedBuffer,s=e.typedBufferStride,n=e.count;let o=0,a=0;for(let l=0;l<n;++l)t[o]=r[a],t[o+1]=r[a+1],t[o+2]=r[a+2],t[o+3]=r[a+3],o+=i,a+=s}function cNt(t,e,i,r,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=n?.count??t.count;let c=(n?.dstIndex??0)*a;for(let u=0;u<l;++u)o[c]=e,o[c+1]=i,o[c+2]=r,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:zde,copyView:lNt,fill:cNt},Symbol.toStringTag,{value:"Module"}));let xVe=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load("json",e,i)}async loadBinary(e,i){return R0(e)?(zt(i),Ele(e)):this._load("binary",e,i)}async loadImage(e,i){return this._load("image",e,i)}async _load(e,i,r){if(this._streamDataRequester==null)return(await qi(i,{responseType:uNt[e]})).data;const s=await jd(this._streamDataRequester.request(i,e,r));if(s.ok===!0)return s.value;throw pl(s.error),new j("",`Request for resource failed: ${s.error}`)}};const uNt={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function hNt(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function dNt(t,e={}){return{data:t,parameters:{wrap:{s:Di.REPEAT,t:Di.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}function OG(t,e){const i=t.count;e||(e=new t.TypedArrayConstructor(i));for(let r=0;r<i;r++)e[r]=t.get(r);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:OG},Symbol.toStringTag,{value:"Module"}));let gxe=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const i=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,i,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var DD,yxe;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(DD||(DD={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(yxe||(yxe={}));const SVe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},pNt={pbrMetallicRoughness:SVe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},fNt={ESRI_externalColorMixMode:"tint",ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},_xe=(t={})=>{const e={...SVe,...t.pbrMetallicRoughness},i=mNt({...fNt,...t.extras});return{...pNt,...t,pbrMetallicRoughness:e,extras:i}};function mNt(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const gNt={magFilter:_i.LINEAR,minFilter:_i.LINEAR_MIPMAP_LINEAR,wrapS:Di.REPEAT,wrapT:Di.REPEAT},yNt=t=>({...gNt,...t});function _Nt(t){let e,i;return t.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(e=s||"",i=n||"","")),{dirPart:e,filePart:i}}const cB={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let vNt=class Nb{constructor(e,i,r,s){if(this._context=e,this.uri=i,this.json=r,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"],this._baseUri=_Nt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.scenes==null)throw new j("gltf-loader-unsupported-feature","Scenes must be defined.");if(r.meshes==null)throw new j("gltf-loader-unsupported-feature","Meshes must be defined");if(r.nodes==null)throw new j("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,i,r){if(R0(i)){const o=Zw(i);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new Nb(e,i,l)}catch{}const a=Ele(i);if(Nb._isGLBData(a))return this._fromGLBData(e,i,a)}if(ENt.test(i)||r?.expectedType==="gltf"){const o=await e.loadJSON(i,r);return new Nb(e,i,o)}const s=await e.loadBinary(i,r);if(Nb._isGLBData(s))return this._fromGLBData(e,i,s);if(CNt.test(i)||r?.expectedType==="glb")throw new j("gltf-loader-invalid-glb","This is not a valid glb file.");const n=await e.loadJSON(i,r);return new Nb(e,i,n)}static _isGLBData(e){if(e==null)return!1;const i=new gxe(e);return i.remainingBytes()>=4&&i.readUint32()===cB.MAGIC}static async _fromGLBData(e,i,r){const s=await Nb._parseGLBData(r);return new Nb(e,i,s.json,s.binaryData)}static async _parseGLBData(e){const i=new gxe(e);if(i.remainingBytes()<12)throw new j("gltf-loader-error","glb binary data is insufficiently large.");const r=i.readUint32(),s=i.readUint32(),n=i.readUint32();if(r!==cB.MAGIC)throw new j("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(e.byteLength<n)throw new j("gltf-loader-error","glb binary data is smaller than header specifies.");if(s!==2)throw new j("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let o,a,l=0;for(;i.remainingBytes()>=8;){const c=i.readUint32(),u=i.readUint32();if(l===0){if(u!==cB.CHUNK_TYPE_JSON)throw new j("gltf-loader-error","First glb chunk must be JSON.");if(c<0)throw new j("gltf-loader-error","No JSON data found.");o=await y3t(i.readUint8Array(c))}else if(l===1){if(u!==cB.CHUNK_TYPE_BIN)throw new j("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");a=i.readUint8Array(c)}else oe.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");l+=1}if(!o)throw new j("gltf-loader-error","No glb JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,i){const r=this.json.buffers[e];if(r.uri==null){if(this._glbBuffer==null)throw new j("gltf-loader-error","glb buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,i);if(s.byteLength!==r.byteLength)throw new j("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,i){const r=this._bufferLoaders.get(e);if(r)return r;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),i).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,i){if(!this.json.accessors)throw new j("gltf-loader-unsupported-feature","Accessors missing.");const r=this.json.accessors[e];if(r?.bufferView==null)throw new j("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(r.type in[DD.MAT2,DD.MAT3,DD.MAT4])throw new j("gltf-loader-unsupported-feature",`AttributeType ${r.type} is not supported`);const s=this.json.bufferViews[r.bufferView],n=await this.getBuffer(s.buffer,i),o=xNt[r.type],a=SNt[r.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,i){if(e.indices==null)return;const r=await this.getAccessor(e.indices,i);if(r.isDenselyPacked)switch(r.componentType){case At.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case At.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case At.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case At.UNSIGNED_BYTE:return OG(up(ZO,r));case At.UNSIGNED_SHORT:return OG(up(N9,r));case At.UNSIGNED_INT:return OG(up(D9,r))}}async getPositionData(e,i){if(e.attributes.POSITION==null)throw new j("gltf-loader-unsupported-feature","No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,i);if(r.componentType!==At.FLOAT)throw new j("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+At[r.componentType]);if(r.componentCount!==3)throw new j("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return up(Zo,r)}async getNormalData(e,i){if(e.attributes.NORMAL==null)throw new j("gltf-loader-error","No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,i);if(r.componentType!==At.FLOAT)throw new j("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+At[r.componentType]);if(r.componentCount!==3)throw new j("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return up(Zo,r)}async getTangentData(e,i){if(e.attributes.TANGENT==null)throw new j("gltf-loader-error","No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,i);if(r.componentType!==At.FLOAT)throw new j("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+At[r.componentType]);if(r.componentCount!==4)throw new j("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed());return new _g(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,i){if(e.attributes.TEXCOORD_0==null)throw new j("gltf-loader-error","No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,i);if(r.componentCount!==2)throw new j("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed());if(r.componentType===At.FLOAT)return up(PC,r);if(!r.normalized)throw new j("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return TNt(r)}async getVertexColors(e,i){if(e.attributes.COLOR_0==null)throw new j("gltf-loader-error","No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,i);if(r.componentCount!==4&&r.componentCount!==3)throw new j("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed());if(r.componentCount===4){if(r.componentType===At.FLOAT)return up(_g,r);if(r.componentType===At.UNSIGNED_BYTE)return up(uc,r);if(r.componentType===At.UNSIGNED_SHORT)return up(t4,r)}else if(r.componentCount===3){if(r.componentType===At.FLOAT)return up(Zo,r);if(r.componentType===At.UNSIGNED_BYTE)return up($9,r);if(r.componentType===At.UNSIGNED_SHORT)return up(L9,r)}throw new j("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+At[r.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,i,r){let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const n=e.material!=null?_xe(this.json.materials[e.material]):_xe(),o=n.pbrMetallicRoughness,a=this.hasVertexColors(e),l=this.getTexture(o.baseColorTexture,i),c=this.getTexture(n.normalTexture,i),u=r?this.getTexture(n.occlusionTexture,i):void 0,h=r?this.getTexture(n.emissiveTexture,i):void 0,p=r?this.getTexture(o.metallicRoughnessTexture,i):void 0,f=e.material!=null?e.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:o.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await l,normalTexture:await c,name:n.name,id:f,occlusionTexture:await u,emissiveTexture:await h,emissiveFactor:n.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await p,hasVertexColors:a,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode,colorTextureTransform:o?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:n.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:n.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:n.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:o?.metallicRoughnessTexture?.extensions?.KHR_texture_transform,receiveAmbientOcclusion:n.extras.ESRI_receiveAmbientOcclusion,receiveShadows:n.extras.ESRI_receiveShadows}}return s}async getTexture(e,i){if(!e)return;if((e.texCoord||0)!==0)throw new j("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const r=e.index,s=this.json.textures[r],n=yNt(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=vxe(s),a=this.json.images[o],l=await this._loadTextureImageData(r,s,i);return pq(this._textureCache,r,()=>{const c=h=>h===33071||h===33648||h===10497,u=h=>{throw new j("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${h}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:u(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:u(n.wrapT),minFilter:n.minFilter,name:a.name,id:r}})}getNodeTransform(e){if(e===void 0)return bNt;let i=this._nodeTransformCache.get(e);if(!i){const r=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?i=Or(Ne(),r,s.matrix):s.translation||s.rotation||s.scale?(i=DO(r),s.translation&&ac(i,i,s.translation),s.rotation&&(uB[3]=d9(uB,s.rotation),bh(i,i,uB[3],uB)),s.scale&&$k(i,i,s.scale)):i=DO(r),this._nodeTransformCache.set(e,i)}return i}_resolveUri(e){return Bc(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=kI.parse(this.json.asset.version,"glTF");wNt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(i=>this._supportedExtensions.includes(i)))throw new j("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,i)=>{e.children&&e.children.forEach(r=>{this._nodeParentMap.set(r,i)})})}async _loadTextureImageData(e,i,r){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(i,r);return this._textureLoaders.set(e,n),n}async _createTextureLoader(e,i){const r=vxe(e),s=this.json.images[r];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),i);return new pVe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),i)}if(s.bufferView==null)throw new j("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new j("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,i);if(n.byteStride!=null)throw new j("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return _3t(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await QQ(Array.from(this._bufferLoaders.values())),i=await QQ(Array.from(this._textureLoaders.values()));return e.reduce((r,s)=>r+(s?.byteLength??0),0)+i.reduce((r,s)=>r+(s?LD(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const bNt=NPe(Ne(),Math.PI/2),wNt=new kI(2,0,"glTF"),uB=Qd(),xNt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},SNt={[At.BYTE]:1,[At.UNSIGNED_BYTE]:1,[At.SHORT]:2,[At.UNSIGNED_SHORT]:2,[At.HALF_FLOAT]:2,[At.FLOAT]:4,[At.INT]:4,[At.UNSIGNED_INT]:4};function TNt(t){switch(t.componentType){case At.BYTE:return new F9(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case At.UNSIGNED_BYTE:return new I9(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case At.SHORT:return new i4(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case At.UNSIGNED_SHORT:return new rhe(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case At.UNSIGNED_INT:return new she(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case At.FLOAT:return new PC(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}function up(t,e){return new t(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*(e.entryCount-1)+e.componentByteSize*e.componentCount)}function vxe(t){if(t.extensions?.KHR_texture_basisu!=null)return t.extensions.KHR_texture_basisu.source;if(t.source!==null)return t.source;throw new j("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}const ENt=/\.gltf$/i,CNt=/\.glb$/i;let MNt=0;async function TVe(t,e,i={},r=!0){const s=await vNt.load(t,e,i),n="gltf_"+MNt++,o={lods:[],materials:new Map,textures:new Map,meta:ANt(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=s.json.asset.extras?.ESRI_webstyleSymbol?.webstyle,c=new Map;await RNt(s,async(h,p,f,g)=>{const y=c.get(f)??0;c.set(f,y+1);const v=h.mode!==void 0?h.mode:Li.TRIANGLES,b=v===Li.TRIANGLES||v===Li.TRIANGLE_STRIP||v===Li.TRIANGLE_FAN?v:null;if(b==null)return void oe.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Li[v]+"). Skipping primitive.");if(!s.hasPositions(h))return void oe.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const w=s.getPositionData(h,i),x=s.getMaterial(h,i,r),S=s.hasNormals(h)?s.getNormalData(h,i):null,E=s.hasTangents(h)?s.getTangentData(h,i):null,C=s.hasTextureCoordinates(h)?s.getTextureCoordinates(h,i):null,R=s.hasVertexColors(h)?s.getVertexColors(h,i):null,I=s.getIndexData(h,i),F={name:g,transform:DO(p),attributes:{position:await w,normal:S?await S:null,texCoord0:C?await C:null,color:R?await R:null,tangent:E?await E:null},indices:await I,primitiveType:b,material:ONt(o,await x,n)};let D=null;o.meta?.ESRI_lod!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(D=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:g,lodThreshold:D},o.lods[f].parts[y]=F});for(const h of o.lods)h.parts=h.parts.filter(p=>!!p);const u=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri,ESRI_webstyle:l},customMeta:{},size:u}}function ANt(t){const e=t.json;let i=null;return e.nodes.forEach(r=>{const s=r.extras;s!=null&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function RNt(t,e){const i=t.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const a of r){const l=i.nodes[a];n.push(o(a,0)),PNt(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=i.nodes[a],u=t.getNodeTransform(a);if(c.weights!=null&&oe.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const h=i.meshes[c.mesh];for(const p of h.primitives)n.push(e(p,u,l,h.name))}for(const h of c.children||[])n.push(o(h,l))}await Promise.all(n)}function PNt(t){return t.extensions?.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function ONt(t,e,i){const r=n=>{const o=`${i}_tex_${n&&n.id}${n?.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=dNt(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:INt.has(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${i}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=hNt({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?r(e.colorTexture):void 0,textureNormal:e.normalTexture?r(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?r(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?r(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?r(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor,receiveShadows:e.receiveShadows,receiveAmbientOcclustion:e.receiveAmbientOcclusion});t.materials.set(s,n)}return s}const INt=new Set([_i.LINEAR_MIPMAP_LINEAR,_i.LINEAR_MIPMAP_NEAREST]);function $Nt(t,e){switch(e){case Li.TRIANGLES:return NNt(t);case Li.TRIANGLE_STRIP:return LNt(t);case Li.TRIANGLE_FAN:return DNt(t)}}function NNt(t){return typeof t=="number"?OC(t):gw(t)?new Uint16Array(t):t}function LNt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const i=e-2,r=n8(3*i);if(typeof t=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=t[n],r[s++]=t[n+1],r[s++]=t[n+2]):(r[s++]=t[n+1],r[s++]=t[n],r[s++]=t[n+2])}return r}function DNt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const i=e-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof t=="number"){let a=0;for(let l=0;l<i;++l)r[a++]=0,r[a++]=l+1,r[a++]=l+2;return r}const s=t[0];let n=t[1],o=0;for(let a=0;a<i;++a){const l=t[a+2];r[o++]=s,r[o++]=n,r[o++]=l,n=l}return r}let FNt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},kNt=class{constructor(e,i,r){this.name=e,this.lodThreshold=i,this.pivotOffset=r,this.stageResources=new FNt,this.numberOfVertices=0}};const L_=()=>oe.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function EVe(t,e){const i=await UNt(t,e),r=await jNt(i.textureDefinitions??{},e);let s=0;for(const n in r)if(r.hasOwnProperty(n)){const o=r[n];s+=o?.image?o.image.width*o.image.height*4:0}return{resource:i,textures:r,size:s+iAe(i)}}async function UNt(t,e){const i=e?.streamDataRequester;if(i)return BNt(t,i,e);const r=await jd(qi(t,e));if(r.ok===!0)return r.value.data;pl(r.error),CVe(r.error)}async function BNt(t,e,i){const r=await jd(e.request(t,"json",i));if(r.ok===!0)return r.value;pl(r.error),CVe(r.error.details.url)}function CVe(t){throw new j("",`Request for object resource failed: ${t}`)}function zNt(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(L_().warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a?.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(L_().warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(L_().warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(L_().warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else L_().warn("Indexed geometries must specify faces"),r=!1;break}default:L_().warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(L_().warn("Geometry requires material"),r=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(L_().warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function VNt(t,e){const i=new Array,r=new Array,s=new Array,n=new yx,o=t.resource,a=kI.parse(o.version||"1.0","wosr");qNt.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},h=t.textures;let p=0;const f=new Map;for(let g=0;g<c.length;g++){const y=c[g];if(!zNt(y))continue;const v=HNt(y),b=y.params.vertexAttributes,w=[],x=Y=>{if(y.params.topology==="PerAttributeArray")return null;const W=y.params.faces;for(const J in W)if(J===Y)return W[J].values;return null},S=b[O.POSITION],E=S.values.length/S.valuesPerElement;for(const Y in b){const W=b[Y],J=W.values,me=x(Y)??OC(E);w.push([Y,new dt(J,me,W.valuesPerElement,!0)])}const C=v.texture,R=h&&h[C];if(R&&!f.has(C)){const{image:Y,parameters:W}=R,J=new xx(Y,W);r.push(J),f.set(C,J)}const I=f.get(C),F=I?I.id:void 0,D=v.material;let z=n.get(D,C);if(z==null){const Y=u[D.substring(D.lastIndexOf("/")+1)].params;Y.transparency===1&&(Y.transparency=0);const W=R&&R.alphaChannelUsage,J=Y.transparency>0||W==="transparency"||W==="maskAndTransparency",me=R?MVe(R.alphaChannelUsage):void 0,L={ambient:Dc(Y.diffuse),diffuse:Dc(Y.diffuse),opacity:1-(Y.transparency||0),transparent:J,textureAlphaMode:me,textureAlphaCutoff:.33,textureId:F,initTextureTransparent:!0,doubleSided:!0,cullFace:ns.None,colorMixMode:Y.externalColorMixMode||"tint",textureAlphaPremultiplied:R?.parameters.preMultiplyAlpha??!1};e?.materialParameters&&Object.assign(L,e.materialParameters),z=new vg(L),n.set(D,C,z)}s.push(z);const B=new Zn(z,w);p+=w.find(Y=>Y[0]===O.POSITION)?.[1]?.indices.length??0,i.push(B)}return{engineResources:[{name:l,stageResources:{textures:r,materials:s,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:p,lodThreshold:null}],referenceBoundingBox:GNt(i)}}function GNt(t){const e=hs();return t.forEach(i=>{const r=i.boundingInfo;r!=null&&(pg(e,r.bbMin),pg(e,r.bbMax))}),e}async function jNt(t,e){const i=new Array;for(const n in t){const o=t[n],a=o.images[0].data;if(!a){L_().warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",h={noUnpackFlip:!0,wrap:{s:Di.REPEAT,t:Di.REPEAT},preMultiplyAlpha:MVe(u)!==Yr.Opaque},p=e?.disableTextures?Promise.resolve(null):Xv(l,e);i.push(p.then(f=>({refId:c,image:f,parameters:h,alphaChannelUsage:u})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function MVe(t){switch(t){case"mask":return Yr.Mask;case"maskAndTransparency":return Yr.MaskBlend;case"none":return Yr.Opaque;default:return Yr.Blend}}function HNt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const qNt=new kI(1,2,"wosr"),IM=2.1;async function AVe(t,e){const i=RVe(Wse(t));if(i.fileType==="wosr"){const h=await(e.cache?e.cache.loadWOSR(i.url,e):EVe(i.url,e)),{engineResources:p,referenceBoundingBox:f}=VNt(h,e);return{lods:p,referenceBoundingBox:f,isEsriSymbolResource:!1,isWosr:!0}}const r=await(e.cache?e.cache.loadGLTF(i.url,e,!!e.usePBR):TVe(new xVe(e.streamDataRequester),i.url,e,e.usePBR)),s=r.model.meta?.ESRI_proxyEllipsoid,n=r.meta.isEsriSymbolResource&&s!=null&&r.meta.ESRI_webstyle==="EsriRealisticTreesStyle";n&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,ZNt(r,s));const o=!!e.usePBR,a=r.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[...h2t]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...s7]},l={...e.materialParameters,treeRendering:n},{engineResources:c,referenceBoundingBox:u}=PVe(r,a,l,e.skipHighLods&&i.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:i.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function RVe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function PVe(t,e,i,r){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=hs();return s.lods.forEach((u,h)=>{const p=r.skipHighLods===!0&&(l>1&&h===0||l>3&&h===1)||r.skipHighLods===!1&&r.singleLodIndex!=null&&h!==r.singleLodIndex;if(p&&h!==0)return;const f=new kNt(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(g=>{const y=p?new vg({}):WNt(s,g,f,e,i,o,a),{geometry:v,vertexCount:b}=YNt(g,y??new vg({})),w=v.boundingInfo;w!=null&&h===0&&(pg(c,w.bbMin),pg(c,w.bbMax)),y!=null&&(f.stageResources.geometries.push(v),f.numberOfVertices+=b)}),p||n.push(f)}),{engineResources:n,referenceBoundingBox:c}}function WNt(t,e,i,r,s,n,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,u=e.attributes.normal!=null;if(l==null)return null;const h=XNt(l.alphaMode);if(!n.has(a)){if(c){const C=(R,I=!1)=>{if(R!=null&&!o.has(R)){const F=t.textures.get(R);if(F!=null){const D=F.data;o.set(R,new xx(LD(D)?D.data:D,{...F.parameters,preMultiplyAlpha:!LD(D)&&I,encoding:LD(D)&&D.encoding!=null?D.encoding:void 0}))}}};C(l.textureColor,h!==Yr.Opaque),C(l.textureNormal),C(l.textureOcclusion),C(l.textureEmissive),C(l.textureMetallicRoughness)}const f=l.color[0]**(1/IM),g=l.color[1]**(1/IM),y=l.color[2]**(1/IM),v=l.emissiveFactor[0]**(1/IM),b=l.emissiveFactor[1]**(1/IM),w=l.emissiveFactor[2]**(1/IM),x=l.textureColor!=null&&c?o.get(l.textureColor):null,S=UUe({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion}),E=l.normalTextureTransform?.scale!=null?l.normalTextureTransform?.scale:Jq;n.set(a,new vg({...r,transparent:h===Yr.Blend,customDepthTest:HE.Lequal,textureAlphaMode:h,textureAlphaCutoff:l.alphaCutoff,diffuse:[f,g,y],ambient:[f,g,y],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?ns.None:ns.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:u?yr.Attribute:yr.ScreenDerivative,castShadows:!0,receiveShadows:l.receiveShadows,receiveAmbientOcclusion:l.receiveAmbientOcclustion,textureId:x?.id,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:x!=null&&!!x.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[v,b,w],mrrFactors:S?[...Khe]:[l.metallicFactor,l.roughnessFactor,r.mrrFactors[2]],isSchematic:S,colorTextureTransformMatrix:jy(l.colorTextureTransform),normalTextureTransformMatrix:jy(l.normalTextureTransform),scale:[E[0],E[1]],occlusionTextureTransformMatrix:jy(l.occlusionTextureTransform),emissiveTextureTransformMatrix:jy(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:jy(l.metallicRoughnessTextureTransform),...s}))}const p=n.get(a);if(i.stageResources.materials.push(p),c){const f=g=>{g!=null&&i.stageResources.textures.push(o.get(g))};f(l.textureColor),f(l.textureNormal),f(l.textureOcclusion),f(l.textureEmissive),f(l.textureMetallicRoughness)}return p}function YNt(t,e){const i=t.attributes.position.count,r=$Nt(t.indices||i,t.primitiveType),s=qs(3*i),{typedBuffer:n,typedBufferStride:o}=t.attributes.position;wx(s,n,t.transform,3,o);const a=[[O.POSITION,new dt(s,r,3,!0)]];if(t.attributes.normal!=null){const c=qs(3*i),{typedBuffer:u,typedBufferStride:h}=t.attributes.normal;lx($M,t.transform),a7(c,u,$M,3,h),dj($M)&&aI(c,c),a.push([O.NORMAL,new dt(c,r,3,!0)])}if(t.attributes.tangent!=null){const c=qs(4*i),{typedBuffer:u,typedBufferStride:h}=t.attributes.tangent;vf($M,t.transform),x7(c,u,$M,4,h),dj($M)&&aI(c,c,4),a.push([O.TANGENT,new dt(c,r,4,!0)])}if(t.attributes.texCoord0!=null){const c=qs(2*i),{typedBuffer:u,typedBufferStride:h}=t.attributes.texCoord0;Bde(c,u,2,h),a.push([O.UV0,new dt(c,r,2,!0)])}const l=t.attributes.color;if(l!=null){const c=new Uint8Array(4*i);l.elementCount===4?l instanceof _g?Q8(c,l,255):l instanceof uc?zde(c,l):l instanceof t4&&Q8(c,l,1/256):(c.fill(255),l instanceof Zo?I8(c,l.typedBuffer,255,4,l.typedBufferStride):t.attributes.color instanceof $9?E7(c,l.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof L9&&I8(c,l.typedBuffer,1/256,4,l.typedBufferStride)),a.push([O.COLOR,new dt(c,r,4,!0)])}return{geometry:new Zn(e,a),vertexCount:i}}const $M=ps();function XNt(t){switch(t){case"BLEND":return Yr.Blend;case"MASK":return Yr.Mask;case"OPAQUE":case null:case void 0:return Yr.Opaque}}function ZNt(t,e){for(let i=0;i<t.model.lods.length;++i){const r=t.model.lods[i];for(const s of r.parts){const n=s.attributes.normal;if(n==null)return;const o=s.attributes.position,a=o.count,l=M(),c=M(),u=M(),h=new Uint8Array(4*a),p=new Float64Array(3*a),f=Ao(Ne(),s.transform);let g=0,y=0;for(let v=0;v<a;v++){o.getVec(v,c),n.getVec(v,l),nt(c,c,s.transform),Me(u,c,e.center),cj(u,u,e.radius);const b=u[2],w=De(u),x=Math.min(.45+.55*w*w,1);cj(u,u,e.radius),f!==null&&nt(u,u,f),Se(u,u),i+1!==t.model.lods.length&&t.model.lods.length>1&&Br(u,u,l,b>-1?.2:Math.min(-4*b-3.8,1)),p[g]=u[0],p[g+1]=u[1],p[g+2]=u[2],g+=3,h[y]=255*x,h[y+1]=255*x,h[y+2]=255*x,h[y+3]=255,y+=4}s.attributes.normal=new Zo(p),s.attributes.color=new uc(h)}}}const Abi=Object.freeze(Object.defineProperty({__proto__:null,fetch:AVe,gltfToEngineResources:PVe,parseUrl:RVe},Symbol.toStringTag,{value:"Module"})),JNt=()=>!!ae("enable-feature:force-wosr"),Rbi=()=>!!ae("enable-feature:direct-3d-object-feature-layer-display"),QNt=()=>ae.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),KNt=()=>ae.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),Pbi=()=>!!ae("enable-i3s-patching"),eLt=()=>ae.add("enable-i3s-patching",!0,!0,!0),tLt=()=>ae.add("enable-i3s-patching",!1,!0,!0),Obi=()=>!!ae("enable-feature:SceneLayer-editing"),iLt=(t="i3s-patching")=>{switch(tLt(),KNt(),ae.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":QNt();break;case"i3s-patching":eLt()}};iLt("i3s-patching");let hZ={};async function rLt(t,e){try{return{data:(await Gde(t,e)).data,baseUrl:Ale(t),styleUrl:t}}catch(i){return pl(i),null}}function sLt(t,e,i){const r=e.portal!=null?e.portal:Mo.getDefault();let s;const n=`${r.url} - ${r.user?.username} - ${t}`;return hZ[n]||(hZ[n]=nLt(t,r,i).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl??"",styleName:t}))),hZ[n]}function nLt(t,e,i){return e.load(i).then(()=>{const r=new Fy({disableExtraQuery:!0,query:`owner:${bxe} AND type:${wxe} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{let s=null;const n=t.toLowerCase();if(r&&Array.isArray(r)){for(const o of r)if(o.typeKeywords?.some(l=>l.toLowerCase()===n)&&o.type===wxe&&o.owner===bxe){s=o;break}}if(!s)throw new j("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(i)})}function Vde(t,e,i){return t?.styleUrl!=null?rLt(t.styleUrl,i):t?.styleName!=null?sLt(t.styleName,e,i):Promise.reject(new j("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function OVe(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function IVe(t,e,i=["gltf"]){if(e==="cimRef")return encodeURI(t.cimRef);if(t.formatInfos&&!JNt())for(const r of i){const s=t.formatInfos.find(n=>n.type===r);if(s)return s.href}return encodeURI(t.webRef)}function Gde(t,e){const i={responseType:"json",query:{f:"json"},...e};return qi(Dd(t),i)}const bxe="esri_en",wxe="Style",oLt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",aLt=Yy.fromSimpleMarkerSymbol(Lze),lLt=AC.fromSimpleLineSymbol(Ide),cLt=Vx.fromSimpleFillSymbol(Dze),uLt=new Wk({symbolLayers:new ct([new CC({material:{color:Ode},edges:new SLe({size:Sa(1),color:new Ke(VOt)})})])}),hLt=new AC({symbolLayers:new ct([new GI({material:{color:new Ke([0,0,0])},size:Sa(1)})])}),dLt=new Vx({symbolLayers:new ct([new CC({outline:{color:new Ke([0,0,0]),size:Sa(1)}})])});function Ibi(t){if(t==null)return null;switch(t.type){case"mesh":return uLt;case"point":case"multipoint":return aLt;case"polyline":return lLt;case"polygon":case"extent":return cLt}return null}const NM={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function pLt(t,e=NM){if(!t)return{symbol:null};const{retainId:i=NM.retainId,ignoreDrivers:r=NM.ignoreDrivers,hasLabelingContext:s=NM.hasLabelingContext,retainCIM:n=NM.retainCIM,cimFallbackEnabled:o=NM.cimFallbackEnabled}=e;let a=null;if(jE(t)||t instanceof RC)a=t.clone();else if(t.type==="cim"){const l=t.data?.symbol?.type;switch(l){case"CIMPointSymbol":a=n?t.clone():Yy.fromCIMSymbol(t);break;case"CIMLineSymbol":o&&(a=hLt.clone(),e?.logWarning?.("Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":o&&(a=dLt.clone(),e?.logWarning?.("Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!a)return{error:new j("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${l||"unknown"}' is unsupported in 3D`,{symbol:t})}}else if(t instanceof Kd)a=AC.fromSimpleLineSymbol(t);else if(t instanceof $0)a=Yy.fromSimpleMarkerSymbol(t);else if(t instanceof Yk)a=Yy.fromPictureMarkerSymbol(t);else if(t instanceof Gx)a=e.geometryType&&e.geometryType==="mesh"?Wk.fromSimpleFillSymbol(t):Vx.fromSimpleFillSymbol(t);else{if(!(t instanceof HI))return{error:new j("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};a=s?b9.fromTextSymbol(t):Yy.fromTextSymbol(t)}return i&&a&&a.type!=="cim"&&(a.id=t.id),r&&jE(a)&&a.symbolLayers.forEach(l=>l.ignoreDrivers=!0),{symbol:a}}function K8(t,e,i,r){const s=$Ve(t,{},{context:r,isLabelSymbol:!1});s!=null&&(e[i]=s)}function xxe(t,e,i,r){const s=$Ve(t,{},{context:r,isLabelSymbol:!0});s!=null&&(e[i]=s)}function Sxe(t){return t instanceof jI||t instanceof RC}function $Ve(t,e,i){if(t==null)return null;const{context:r,isLabelSymbol:s}=i,n=r?.origin,o=r?.messages;if(n==="web-scene"&&!Sxe(t)){const a=pLt(t,{retainCIM:!0,hasLabelingContext:s});return a.symbol!=null?a.symbol.write(e,r):(o?.push(new j("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!pPe(r?.layer))&&Sxe(t)?(o?.push(new j("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function NVe(t,e){return Jft(t,null,e)}function fLt(t,e,i,r){const s=t.name;return s==null?Promise.reject(new j("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?mLt(s,e,r):Vde(t,e,r).then(n=>Hde(n,s,e,i,IVe,r))}function jde(t,e){return e.items.find(i=>i.name===t)}function Hde(t,e,i,r,s,n){const o=i?.portal!=null?i.portal:Mo.getDefault(),a={portal:o,url:ln(t.baseUrl),origin:"portal-item"},l=jde(e,t.data);if(!l){const f=`The symbol name '${e}' could not be found`;return Promise.reject(new j("symbolstyleutils:symbol-name-not-found",f,{symbolName:e}))}let c=Qw(s(l,r),a),u=l.thumbnail?.href??null;const h=l.thumbnail?.imageData;iNt()&&(c=Wse(c)??"",u=Wse(u));const p={portal:o,url:ln(Ale(c)),origin:"portal-item"};return Gde(c,n).then(f=>{const g=r==="cimRef"?OVe(f.data):f.data,y=NVe(g,p);if(y&&jE(y)){if(u){const v=Qw(u,a);y.thumbnail=new oE({url:v})}else h&&(y.thumbnail=new oE({url:`data:image/png;base64,${h}`}));t.styleUrl?y.styleOrigin=new EF({portal:i.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(y.styleOrigin=new EF({portal:i.portal,styleName:t.styleName,name:e}))}return y})}function mLt(t,e,i){const r=oLt.replaceAll(/\{SymbolName\}/gi,t),s=e.portal!=null?e.portal:Mo.getDefault();return Gde(r,i).then(n=>{const o=OVe(n.data);return NVe(o,{portal:s,url:ln(Ale(r)),origin:"portal-item"})})}const gLt=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:Hde,getStyleItemFromStyle:jde,resolveWebStyleSymbol:fLt},Symbol.toStringTag,{value:"Module"}));async function yLt(t){if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new j("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const i={portal:t.portal},r=await Vde(t,i).catch(()=>null);if(r===null)return null;const s=jde(e,r.data);if(s&&!s.formatInfos?.some(a=>a.type==="gltf_basisu"))return null;const n=await Hde(r,e,i,"webRef",(a,l)=>IVe(a,l,["gltf_basisu","gltf"])).catch(()=>null);if(n===null||n.type!=="point-3d")return null;const o=n.symbolLayers.items[0];return o.type==="object"?o.resource:null}let _Lt=class{constructor(e,i,r){this._elementSize=i,this._buffer=Vr.createVertex(e,wr.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,i,r,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(i-e)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,i){const r=e*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,s)}resize(e){const i=e*this._elementSize,r=new ArrayBuffer(i);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=e}},vLt=class{constructor(e){this.modelOriginHi=e.getField(O.INSTANCEMODELORIGINHI,Zo),this.modelOriginLo=e.getField(O.INSTANCEMODELORIGINLO,Zo),this.model=e.getField(O.INSTANCEMODEL,fx),this.modelNormal=e.getField(O.INSTANCEMODELNORMAL,fx),this.featureAttribute=e.getField(O.INSTANCEFEATUREATTRIBUTE,_g),this.color=e.getField(O.INSTANCECOLOR,uc),this.objectAndLayerIdColor=e.getField(O.INSTANCEOBJECTANDLAYERIDCOLOR,uc)}},Txe=class{constructor(e,i){this._rctx=e,this._instanceBufferLayout=i,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,i=this._tailIndex;return e>=i?e-i:e+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){Tt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){Tt(this._updating,"not updating"),this.size<oXe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){Tt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),Tt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){Tt(this._updating,"not updating"),Tt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(eH,Math.floor(this._capacity*iq));this._resize(e)}_shrink(){const e=Math.max(eH,Math.floor(this._capacity*nXe));this._resize(e)}_resize(e){if(Tt(this._updating,"not updating"),e===this._capacity)return;const i=new _Lt(this._rctx,this._instanceBufferLayout.stride,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);Tt(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=i,this._view=new vLt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,e),i-r):r>i?(this._buffer.copyRange(r,this._capacity,e),i>0&&this._buffer.copyRange(0,i,e,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,i){e<i?this._buffer.transferRange(e,i):e>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(e,this._capacity))}};const eH=64;var Ms;function bLt(t){let e=Xs().mat4f64(O.LOCALTRANSFORM).mat4f64(O.GLOBALTRANSFORM).vec4f64(O.BOUNDINGSPHERE).vec3f64(O.MODELORIGIN).mat3f(O.INSTANCEMODEL).mat3f(O.INSTANCEMODELNORMAL).vec2f(O.MODELSCALEFACTORS);return t.includes(O.FEATUREATTRIBUTE)&&(e=e.vec4f(O.FEATUREATTRIBUTE)),t.includes(O.COLOR)&&(e=e.vec4u8(O.COLOR)),t.includes(O.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(O.OBJECTANDLAYERIDCOLOR)),e=e.u8(O.STATE).u8(O.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Ms||(Ms={}));let Exe=class{constructor(e){this.localTransform=e.getField(O.LOCALTRANSFORM,PF),this.globalTransform=e.getField(O.GLOBALTRANSFORM,PF),this.modelOrigin=e.getField(O.MODELORIGIN,ff),this.model=e.getField(O.INSTANCEMODEL,fx),this.modelNormal=e.getField(O.INSTANCEMODELNORMAL,fx),this.modelScaleFactors=e.getField(O.MODELSCALEFACTORS,PC),this.boundingSphere=e.getField(O.BOUNDINGSPHERE,O9),this.featureAttribute=e.getField(O.FEATUREATTRIBUTE,_g),this.color=e.getField(O.COLOR,uc),this.objectAndLayerIdColor=e.getField(O.OBJECTANDLAYERIDCOLOR,uc),this.state=e.getField(O.STATE,ZO),this.lodLevel=e.getField(O.LODLEVEL,ZO)}},aR=class extends Fe{constructor(e,i){super(e),this.events=new un,this._capacity=0,this._size=0,this._next=0,this._layout=bLt(i),this._capacity=eH,this._buffer=this._layout.createBuffer(this._capacity),this._view=new Exe(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Ms.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const i=this._view.state;Tt(e>=0&&e<this._capacity&&!!(i.get(e)&Ms.ALLOCATED),"invalid instance handle"),this._getStateFlag(e,Ms.ACTIVE)?this._setStateFlags(e,Ms.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const i=this._view.state;Tt(e>=0&&e<this._capacity&&!!(i.get(e)&Ms.ALLOCATED),"invalid instance handle"),i.set(e,0),this._size--}setLocalTransform(e,i,r=!0){this._view.localTransform.setMat(e,i),r&&this.updateModelTransform(e)}getLocalTransform(e,i){this._view.localTransform.getMat(e,i)}setGlobalTransform(e,i,r=!0){this._view.globalTransform.setMat(e,i),r&&this.updateModelTransform(e)}getGlobalTransform(e,i){this._view.globalTransform.getMat(e,i)}updateModelTransform(e){const i=this._view,r=Vu,s=Ff;i.localTransform.getMat(e,Cxe),i.globalTransform.getMat(e,dZ);const n=Or(dZ,dZ,Cxe);ue(r,n[12],n[13],n[14]),i.modelOrigin.setVec(e,r),vf(s,n),i.model.setMat(e,s);const o=Vat(Vu,n);o.sort(),i.modelScaleFactors.set(e,0,o[1]),i.modelScaleFactors.set(e,1,o[2]),Gk(s,s),xC(s,s),i.modelNormal.setMat(e,s),this._setStateFlags(e,Ms.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,i){const r=this._view;r.model.getMat(e,Ff),r.modelOrigin.getVec(e,Vu),i[0]=Ff[0],i[1]=Ff[1],i[2]=Ff[2],i[3]=0,i[4]=Ff[3],i[5]=Ff[4],i[6]=Ff[5],i[7]=0,i[8]=Ff[6],i[9]=Ff[7],i[10]=Ff[8],i[11]=0,i[12]=Vu[0],i[13]=Vu[1],i[14]=Vu[2],i[15]=1}applyShaderTransformation(e,i){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedModelTransform(e,i){return this.getModelTransform(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedLocalTransform(e,i){this._view.localTransform.getMat(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedMaxScaleFactor(e){let i=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Vu,this,e),i*=Math.max(Vu[0],Vu[1],Vu[2])),i}getCombinedMedianScaleFactor(e){let i=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Vu,this,e),i*=wLt(Vu[0],Vu[1],Vu[2])),i}getModel(e,i){this._view.model.getMat(e,i)}setFeatureAttribute(e,i){this._view.featureAttribute.setVec(e,i)}getFeatureAttribute(e,i){this._view.featureAttribute.getVec(e,i)}setColor(e,i){this._view.color.setVec(e,i)}setObjectAndLayerIdColor(e,i){this._view.objectAndLayerIdColor.setVec(e,i)}setVisible(e,i){i!==this.getVisible(e)&&(this._setStateFlag(e,Ms.VISIBLE,i),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Ms.VISIBLE)}setHighlight(e,i){i!==this.getHighlight(e)&&(this._setStateFlag(e,Ms.HIGHLIGHT,i),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Ms.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++i;return i}_setStateFlags(e,i){const r=this._view.state;i=r.get(e)|i,r.set(e,i)}_clearStateFlags(e,i){const r=this._view.state;i=r.get(e)&~i,r.set(e,i)}_setStateFlag(e,i,r){r?this._setStateFlags(e,i):this._clearStateFlags(e,i)}_getStateFlag(e,i){return!!(this._view.state.get(e)&i)}_grow(){this._capacity=Math.max(eH,Math.floor(this._capacity*iq)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new Exe(this._buffer)}_findSlot(){const e=this._view.state;let i=this._next;for(;e.get(i)&Ms.ALLOCATED;)i=i+1===this._capacity?0:i+1;return this._next=i+1===this._capacity?0:i+1,i}};function wLt(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}d([m({constructOnly:!0})],aR.prototype,"shaderTransformation",void 0),d([m()],aR.prototype,"_size",void 0),d([m({readOnly:!0})],aR.prototype,"size",null),aR=d([N("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],aR);const Vu=M(),Ff=ps(),Cxe=Ne(),dZ=Ne();let xLt=class extends qm{constructor(e,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=i,this._tmpSphere=Bn(),this._tmpMat4=Ne()}addInstance(e){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);nt(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*FO(r),i.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},SLt=class{constructor(e,i){this._worldSpaceRadius=e,this._minScreenSpaceRadii=i}selectLevel(e,i,r){const s=r.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*i/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},TLt=class extends Vk{constructor(e,i,r,s,n,o){super(e,i),this.layerUid=e,this.graphicUid=i,this.geometryId=r,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function qde(t){return _f(t)&&t.intersector===bs.LOD&&!!t.target}let ELt=class{constructor(e,i){const r=e.renderContext.rctx,s=i.geometry;this._materials=e.materials,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=o.createBuffer(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new RBe(s.material,this._materials),this.vertexBufferLayout=o,this.vbo=Vr.createVertex(r,wr.STATIC_DRAW,l.buffer),this.vao=new k0(r,Fi,{geometry:Dh(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,i,r,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,s,(u,h,p,f,g)=>{if(u>=0){if(i!=null&&!i(e.rayBegin,e.rayEnd,u))return;const y=new TLt(o.layerUid,o.graphicUid(n),c,p,a,l);if((e.results.min.drapedLayerOrder==null||g>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||u<e.results.min.dist)&&e.results.min.set(bs.LOD,y,u,h,e.transform.transform,g),e.options.store!==Ya.MIN&&(e.results.max.drapedLayerOrder==null||g>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||u>e.results.max.dist)&&e.results.max.set(bs.LOD,y,u,h,e.transform.transform,g),e.options.store===Ya.ALL){const v=eue(e.results.min.ray);v.set(bs.LOD,y,u,h,e.transform.transform,g),e.results.all.push(v)}}})}},CLt=class LVe{static async create(e,i,r){const s=await Promise.allSettled(i.components.map(o=>e.controller.schedule(()=>new ELt(e,o),r))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(Rx);if(va(r)||n.length!==s.length){n.forEach(o=>o.destroy()),zt(r);for(const o of s)if(o.status==="rejected")throw o.reason}return new LVe(i.minScreenSpaceRadius,n)}constructor(e,i){this.minScreenSpaceRadius=e,this.components=i}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,i,r,s,n,o,a){this.components.forEach(l=>l.intersect(e,i,r,s,n,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=hs();this.components.forEach(i=>{i.boundingInfo!=null&&(pg(e,i.boundingInfo.bbMin),pg(e,i.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,i=M();Vm(e,i),this._boundingSphere={center:i,radius:.5*ILe(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,i)=>e+i.triangleCount,0)}};const MLt=t=>{const e=t.baseBoundingSphere.radius,i=t.levels.map(r=>r.minScreenSpaceRadius);return new SLt(e,i)};let Ep=class extends Mvt{constructor(e,i){super(e),this.type=bs.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new Kr,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[Ce.OPAQUE_MATERIAL,r=>this._produces(r)],[Ce.TRANSPARENT_MATERIAL,r=>!!this._hasTransparentLevels()&&this._produces(r)]]),this._instanceData=new aR({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(i.registerTask(Ut.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=RLt(this.optionalFields),this._glInstanceBufferLayout=Dh(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((e,i)=>i.reduce((r,s)=>r+s.usedMemory,e),0)}get renderStats(){const e=this._instanceData.size,i=[];return this._levels.forEach((r,s)=>{const n=this._allRenderInstanceData[0][s].size+this._allRenderInstanceData[1][s].size,o=r.triangleCount;i.push({renderedInstances:n,renderedTriangles:n*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:i.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:i.reduce((r,s)=>r+s.renderedTriangles,0),levels:i}}async initializeRenderContext(e,i){this._context=e;const r=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new Txe(r,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new Txe(r,this._instanceBufferLayout)),CLt.create(e,o,i)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(Rx);if(va(i)||n.length!==s.length){n.forEach(o=>o.destroy()),zt(i);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=MLt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}_hasTransparentLevels(){return this._levels.some(e=>e.components.some(i=>i.material.produces.get(Ce.TRANSPARENT_MATERIAL)?.(G.Color)))}hasHighlights(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}_produces(e){return e!==G.Highlight&&e!==G.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!ts.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const i=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),i||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(_h),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const i=this._getInstanceDatas(e.output);if(!i)return null;const r=new Array;return i.forEach(s=>this.levels.forEach((n,o)=>{n.components.forEach(a=>r.push(this._beginComponent(e,s[o],a)))})),r}renderNode(e,i){const r=this._getInstanceDatas(e.output);if(!r||i==null)return;let s=0;e.rctx.bindVAO(),r.forEach(n=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,i[s++],n[a],l,a))}))}_getInstanceDatas(e){const i=e!==G.Highlight&&e!==G.ShadowHighlight,r=e!==G.ShadowExcludeHighlight;return i&&r?this._allRenderInstanceData:i?this._defaultRenderInstanceData:r?this._highlightRenderInstanceData:null}intersect(e,i,r,s){if(!this.baseMaterial.isVisible()||this._octree==null)return;const n=M();Me(n,s,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,Rxe),e.transform.set(Rxe),nt(Pxe,r,e.transform.inverse),nt(Oxe,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),u=this._levels.length;Tt(!!(l&Ms.ACTIVE),"invalid instance state"),Tt(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(e,i,Pxe,Oxe,a,this.metadata,u)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(r,n,o)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(this._octreeCached==null){const e=this._instanceData,i=e.view?.state;if(!i)return null;this._octreeCached=new xLt(e,this.baseBoundingSphere);for(let r=0;r<e.capacity;++r)i.get(r)&Ms.ACTIVE&&this._octreeCached.addInstance(r)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Ge(this._octreeCached)}queryDepthRange(e){if(this._octree==null)return{near:1/0,far:-1/0};const i=e.viewForward,r=this._octree.findClosest(i,qm.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(i,qm.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(r,jg),Me(jg,jg,n);const a=xe(jg,i)-jg[3];o.boundingSphere.getVec(s,jg),Me(jg,jg,n);const l=xe(jg,i)+jg[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(i=>i.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:i,_camera:r,_levelSelector:s}=this;this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.beginUpdate()));const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;const u=Math.ceil(l/500);for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&Ms.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const g=o.lodLevel.get(c);if(p&Ms.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][g].freeTail(),p&Ms.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][g].freeTail(),p&Ms.REMOVE)n.freeInstance(c);else if(p&Ms.VISIBLE){let y=0;i&&(o.modelOrigin.getVec(c,Axe),y=s.selectLevel(Axe,n.getCombinedMedianScaleFactor(c),r)),f=p&~(Ms.ACTIVE|Ms.TRANSFORM_CHANGED),y>=0&&(p&Ms.HIGHLIGHT?(Mxe(this._highlightRenderInstanceData[0][y],o,c),f|=Ms.HIGHLIGHT_ACTIVE):(Mxe(this._defaultRenderInstanceData[0][y],o,c),f|=Ms.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,y)}else f=p&~(Ms.ACTIVE|Ms.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octreeCached!=null){const y=!!(p&Ms.ACTIVE),v=!!(f&Ms.ACTIVE);!y&&v?this._octreeCached.addInstance(c):y&&!v?this._octreeCached.removeInstance(c):y&&v&&p&Ms.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%u==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.endUpdate())),this._context.requestRender()}_beginComponent(e,i,r){if(i.size===0)return null;const s=r.glMaterials.load(e.rctx,e.bindParameters.slot,e.output);return s!=null?s.beginSlot(e.bindParameters):null}_renderComponent(e,i,r,s,n){if(!i)return;const{bindParameters:o,rctx:a}=e;a.runAppleAmdDriverHelper();const l=a.bindTechnique(i,o,s.material.parameters,PLt);a.bindVAO(s.vao),i.ensureAttributeLocations(s.vao),ts.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===G.Color&&(l.setUniform4fv("externalColor",Ixe[Math.min(n,Ixe.length-1)]),l.setUniform1i("colorMixMode",L4e.replace));const c=r.capacity,u=r.headIndex,h=r.tailIndex,p=r.firstIndex,f=this._glInstanceBufferLayout,g=(y,v)=>{kue(a,Fi,r.buffer,f,y),a.drawArraysInstanced(i.primitiveType,0,s.vertexCount,v-y),KDe(a,Fi,r.buffer,f)};s.material.parameters.transparent&&p!=null?u>h?(Tt(p>=h&&p<=u,"invalid firstIndex"),g(p,u),g(h,p)):u<h&&(p<=u?(Tt(p>=0&&p<=u,"invalid firstIndex"),g(p,u),g(h,c),g(0,p)):(Tt(p>=h&&p<=c,"invalid firstIndex"),g(p,c),g(0,u),g(h,p))):u>h?g(h,u):u<h&&(g(0,u),g(h,c)),a.bindVAO(null)}};function Mxe(t,e,i){const r=t.allocateHead();ALt(e,i,t.view,r)}function ALt(t,e,i,r){P_t(t.modelOrigin,e,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,t.model,e),i.modelNormal.copyFrom(r,t.modelNormal,e),t.color&&i.color&&i.color.copyFrom(r,t.color,e),t.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,t.objectAndLayerIdColor,e),t.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,t.featureAttribute,e)}function RLt(t){let e=Xs().vec3f(O.INSTANCEMODELORIGINHI).vec3f(O.INSTANCEMODELORIGINLO).mat3f(O.INSTANCEMODEL).mat3f(O.INSTANCEMODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(O.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(O.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(O.INSTANCEOBJECTANDLAYERIDCOLOR)),e}d([m({constructOnly:!0})],Ep.prototype,"symbol",void 0),d([m({constructOnly:!0})],Ep.prototype,"optionalFields",void 0),d([m({constructOnly:!0})],Ep.prototype,"metadata",void 0),d([m({constructOnly:!0})],Ep.prototype,"shaderTransformation",void 0),d([m()],Ep.prototype,"_instanceData",void 0),d([m()],Ep.prototype,"_cycleStartIndex",void 0),d([m({readOnly:!0})],Ep.prototype,"_enableLevelSelection",null),d([m()],Ep.prototype,"_updateCyclesWithStaticCamera",void 0),d([m({readOnly:!0})],Ep.prototype,"running",null),Ep=d([N("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Ep);const Axe=M(),jg=pi(),Rxe=Ne(),Pxe=M(),Oxe=M(),Ixe=[ni(1,0,1,1),ni(0,0,1,1),ni(0,1,0,1),ni(1,1,0,1),ni(1,0,0,1)],PLt=new k2t;let $xe=class{constructor(e,i,r,s,n,o,a,l,c,u,h,p){this.lodResources=e,this.lodRenderer=i,this.stageResources=r,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=h,this.pivotOffset=p}},OLt=class extends j0{getCachedSize(){const[e,i,r]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:i,height:r}}constructor(e,i,r,s){super(e,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&i7(this.symbolLayer))throw new Error;if(this._isPrimitive){const i=this.symbolLayer.resource,r=i&&ATt(i?.primitive)?i.primitive:VLe;this._resources=await this._createResourcesForPrimitive(r,e)}else{const i=await yLt(this.symbol.styleOrigin),r=i?.href??this.symbolLayer.resource?.href;this._resources=await this._createResourcesForUrl(r,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}get materials(){return this._resources?.stageResources.materials??[]}_setMaterialTransparencyParameters(e,i=this.symbolLayer?.material?.color){const r=this._getCombinedOpacity(i),s=r<1||this.needsDrivenTransparentPass;return e.transparent=s,e.opacity=r,e.cullFace=s?ns.None:ns.Back,e}async _createResourcesForPrimitive(e,i){const r=this.symbolLayer,s=Oo(Pft(e)),n=Dc(HV(s)),o=Dc(rY(n,r)),a=De(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...Khe],ambient:bv,diffuse:bv,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},h=!!u.usePBR;this._setMaterialTransparencyParameters(u);const p=this.symbol;if(p.type==="point-3d"&&p.verticalOffset){const{screenLength:w,minWorldLength:x,maxWorldLength:S}=p.verticalOffset;u.verticalOffset={screenLength:Yn(w),minWorldLength:x||0,maxWorldLength:S??1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=Xp;else{const w=r.material!=null?r.material.color:null,x=w!=null?Ke.toUnitRGBA(w):Xp;u.externalColor=x}this._fastUpdates=KO(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,null)),u.isInstanced=!0,this._fastUpdates?(Object.assign(u,this._fastUpdates.materialParameters),this._optionalFields.push(O.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(u.hasInstancedColor=!0,this._optionalFields.push(O.COLOR)),ae("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(O.OBJECTANDLAYERIDCOLOR);const f=new vg(u),g=xUe(e,f);if(!g)throw new Error(`Unknown object symbol primitive: ${e}`);const y=$5(g).map(w=>({opacity:1,transparent:w.parameters.transparent})),v=await this._createStageResources(g,h,i),b=await this._createLodRenderer(g,i);return new $xe(g,b,v,y,n,l,c,s,o,a,h,null)}async _createResourcesForUrl(e,i){const r={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=KO(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(r.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(O.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(r.materialParameters.hasInstancedColor=!0,this._optionalFields.push(O.COLOR)),ae("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(O.OBJECTANDLAYERIDCOLOR);const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:D,minWorldLength:z,maxWorldLength:B}=s.verticalOffset;r.materialParameters.verticalOffset={screenLength:Yn(D),minWorldLength:z||0,maxWorldLength:B??1/0},r.materialParameters.castShadows=!1}const n=this._context.physicalBasedRenderingEnabled;r.signal=i,r.usePBR=n,r.skipHighLods=this._context.skipHighSymbolLods;const o=await AVe(e,r),a=o.isEsriSymbolResource,l=o.isWosr,c=K3t(o.lods),u=this._context,h=this.symbolLayer.material,p=this._getExternalColorParameters(h),f=this.symbolLayer?.material?.color,g=this._getCombinedOpacity(f,{hasIntrinsicColor:!0}),y=this.needsDrivenTransparentPass,v=$5(c),b=$5(c).map(D=>({opacity:D.parameters.opacity||1,transparent:D.parameters.transparent}));v.forEach(D=>{const z=D.parameters;D.setParameters(p);const B=z.opacity*g,Y=B<1||y||z.transparent;D.setParameters({opacity:B,transparent:Y}),u.screenSizePerspectiveEnabled&&D.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const w=o.referenceBoundingBox,x=Dc(HV(w)),S=Dc(c.levels[0].pivotOffset),E=Dc(rY(x,this.symbolLayer)),C=De(E),R=this._fastUpdates;eI(R,this._context.renderer,this._fastVisualVariableConvertOptions(w,E,x,S))&&v.forEach(D=>D.setParameters(R.materialParameters));const I=await this._createStageResources(c,n,i),F=await this._createLodRenderer(c,i);return new $xe(c,F,I,b,x,a,l,w,E,C,n,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,i,r){const s=this._context.stage,n=$5(e);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=w1e(e);s.addMany(o),this._addDisposeResource(()=>{o.forEach(l=>l.unload()),s.removeMany(o)}),await Promise.all(o.map(l=>this._context.stage.schedule(()=>l.load(s.renderView.renderingContext),r))),zt(r);const a=x1e(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},n=this._fastUpdates,o=n?{applyTransform:(l,c,u)=>{l.getFeatureAttribute(c,hB),Xn(u,Bxt(n.materialParameters,hB,u))},scaleFactor:(l,c,u)=>{c.getFeatureAttribute(u,hB),Ohe(l,n.materialParameters,hB)}}:null,a=new Ep({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(a),a.destroy()}),await r.addRenderPlugin(a,i),a}_getExternalColorParameters(e){const i={};return this._drivenProperties.color?i.externalColor=Xp:e?.color!=null?i.externalColor=Ke.toUnitRGBA(e.color):(i.externalColor=Xp,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;const r=hE(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i),n=e.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(this._resources==null)return;const e=this._drivenProperties.opacity,i=!this._isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const o=r[n],a=this.symbolLayer?.material?.color,l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:i})*l.opacity,u=c<1||e||l.transparent;o.setParameters({opacity:c,transparent:u}),this._isPrimitive&&o.setParameters({cullFace:u?ns.None:ns.Back})}}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,vx)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:i}=this._resources;for(const r of e.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,i){if(this._resources==null)return Dn.RecreateSymbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!eI(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,o,a,l)))return Dn.RecreateSymbol;for(const u of r)u.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return Dn.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,i=n5e(e.levels),r=a=>Array.from(a.attributes.values()).reduce((l,c)=>l+Ww(c.data,c.indices),0),s=x1e(e).reduce((a,l)=>a+r(l),0),n=w1e(e).reduce((a,l)=>a+l.memoryEstimate,0)+s,o={...s5e(this.symbol,this.symbolLayer),resourceBytes:n};return new zp({verticesPerFeature:i,memory:o})}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,i,r,s,n,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(lc(i,LM,this._context.elevationProvider.spatialReference),l!=null&&!wue(l,LM))return null;const c=Lxe(s),u=this._computeGlobalTransform(i,s,pZ,dB),h=this._computeLocalTransform(this._resources,this.symbolLayer,r,Dxe),p=this._resources.lodRenderer.instanceData,f=p.addInstance();this._instanceIndexToGraphicUid.set(f,n),p.setLocalTransform(f,h,!1),p.setGlobalTransform(f,u),a&&p.setFeatureAttribute(f,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&p.setColor(f,SD(r.color,r.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&p.setObjectAndLayerIdColor(f,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const g=new Z3t(this,f,hTt,s);return c&&(g.alignedSampledElevation=dB.sampledElevation),g.needsElevationUpdates=vx(s.mode),ZE(g,i,this._context.elevationProvider),g}_computeGlobalTransform(e,i,r,s){return _x(e,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),LM[0]=e.x,LM[1]=e.y,LM[2]=s.z,Bd(e.spatialReference,LM,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,i,r,s){return df(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(e,r,s),this._applyAnchor(e,i,s),s}_applyObjectScale(e,i,r){if(this._fastUpdates?.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:e.symbolSize,n=v1e(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||$k(r,r,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchTransform(e,i),this._preparePatchColor(e,i)}updateGeometry(e,i){if(this._resources==null)return!0;const r=i&&hE(i);if(r==null)return!1;const s=this.getGeometryElevationMode(i);return e.elevationContext.mode===s&&(this._computeGlobalTransform(r,e.elevationContext,pZ,dB),Lxe(e.elevationContext)&&(e.alignedSampledElevation=dB.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,pZ,!0),ZE(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||this._resources==null)return;const r=(g,y,v)=>(g!=null&&g.type==="complete"?g.newValue:y)??v,s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),u=r(i.anchor,this.symbolLayer.anchor,void 0),h=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const p={heading:s,tilt:n,roll:o,anchor:u,anchorPosition:h},f=this._resources;this.loadStatus===wd.LOADED&&e.symbolLayerStatePatches.push(()=>{f.symbolSize=Dc(rY(f.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((g,y)=>{const v=this._computeLocalTransform(f,p,y,Dxe),b=g.instanceIndex;f.lodRenderer.instanceData.setLocalTransform(b,v,!0)})}_preparePatchColor(e,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=s!=null?Ke.toUnitRGBA(s):Xp;delete r.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParameters({},s)):l=this._setMaterialTransparencyParameters({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_applyObjectRotation(e,i,r){if(!this._fastUpdates?.requiresShaderTransformation||!i)return ETt(e.heading,e.tilt,e.roll,r)}_applyAnchor(e,i,r){if(this._fastUpdates?.requiresShaderTransformation)return;const s=Nxe(e.resourceBoundingBox,e.pivotOffset,i);s&&ac(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,i,r,s){const n=e!=null?Dc(HV(e)):bv,o=e!=null?Nxe(e,s,this.symbolLayer):co,a=this._context.renderCoordsHelper.unitInMeters,l=v1e(i??void 0,i,r,a),c=Be(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new a4({size:!0,color:!0,rotation:!0,opacity:!1},n,i??bv,a,o,l,c)}};function Nxe(t,e,i){const r=M();switch(i.anchor){case"center":ge(r,Vm(t)),Ha(r,r);break;case"top":{const s=Vm(t);ue(r,-s[0],-s[1],-t[5]);break}case"bottom":{const s=Vm(t);ue(r,-s[0],-s[1],-t[2]);break}case"relative":{const s=Vm(t),n=HV(t),o=i.anchorPosition,a=o?Be(o.x,o.y,o.z):co;Tq(r,n,a),Te(r,r,s),Ha(r,r);break}default:e!=null?Ha(r,e):ge(r,co)}return r}function Lxe(t){return t.mode!=="absolute-height"}const LM=M(),Dxe=Ne(),pZ=Ne(),hB=pi(),dB=new u4;let ILt=class{constructor(e,i,r,s){this.vertices=e,this.positionsES=i,this.offset=s;const n=e.length,o=Math.floor(n/2),a=this.offset+3*o,l=r[a],c=r[a+1],u=r[a+2];this.origin=Be(l,c,u),this.positions=qs(3*n);const h=this.offset+3*n;for(let p=this.offset;p<h;p+=3)this.positions[p]=r[p]-l,this.positions[p+1]=r[p+1]-c,this.positions[p+2]=r[p+2]-u;this.updatePathVertexInformation()}get usedMemory(){return Ww(this.positions)}updatePathVertexInformation(){const e=this.vertices.length,i=this.vertices[0];let r=this.offset;const s=this.positions;i.vRight[0]=s[r+3]-s[r],i.vRight[1]=s[r+4]-s[r+1],i.vRight[2]=s[r+5]-s[r+2],r+=3;let n=De(i.vRight);i.vMinSiblingLength=n,Se(i.vRight,i.vRight);let o=i;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=s[r+3]-s[r],l.vRight[1]=s[r+4]-s[r+1],l.vRight[2]=s[r+5]-s[r+2];const c=De(l.vRight);l.vMinSiblingLength=Math.min(n,c),n=c,Se(l.vRight,l.vRight)}else ge(l.vRight,l.vLeft),l.vMinSiblingLength=n;o=l,r+=3}}},$Lt=class{constructor(e,i,r,s,n,o={}){this.path=e,this.profile=i,this.extruder=r,this.startCap=s,this.endCap=n,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=x_t(1*this.numVerticesTotal),this.profileRightAxes=qs(4*this.numVerticesTotal),this.profileUpAxes=qs(4*this.numVerticesTotal),this.profileVertexAndNormals=qs(4*this.numVerticesTotal),this.positions=s8(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return Ww(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(e,i,r,s,n){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=i.right[0],this.profileRightAxes[o+1]=i.right[1],this.profileRightAxes[o+2]=i.right[2],this.profileUpAxes[o]=i.up[0],this.profileUpAxes[o+1]=i.up[1],this.profileUpAxes[o+2]=i.up[2],this.profileVertexAndNormals[o]=r[0],this.profileVertexAndNormals[o+1]=r[1],this.profileVertexAndNormals[o+2]=s[0],this.profileVertexAndNormals[o+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,i,r,s,n,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=i.right[0],this.profileRightAxes[a+1]=i.right[1],this.profileRightAxes[a+2]=i.right[2],this.profileRightAxes[a+3]=n,this.profileUpAxes[a]=i.up[0],this.profileUpAxes[a+1]=i.up[1],this.profileUpAxes[a+2]=i.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=r[0],this.profileVertexAndNormals[a+1]=r[1],this.profileVertexAndNormals[a+2]=s[0],this.profileVertexAndNormals[a+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:i,vertices:r}=this.path;this.positions=s8(e,i,3*r.length);let s=0;const n=(a,l,c,u,h)=>this.emitCapVertex(s,a,l,c,u,h),o=(a,l,c,u)=>this.emitVertex(s,a,l,c,u);for(this.startCap.rebuildConnectingProfileGeometry(r[s],this.profile,n),s=1;s<r.length-1;++s)this.extruder.extrude(r[s],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(r[s],this.profile,n),s=0,this.startCap.rebuildCapGeometry(r[s],n),s=r.length-1,this.endCap.rebuildCapGeometry(r[s],n)}buildTopology(){const e=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let s=3*(2*(i*r));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.numIndices,this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,u,h)=>{n.push(c),n.push(u),n.push(h),o.push(c),o.push(u),o.push(h),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[h])};for(let c=0;c<i;++c){const u=this.profile.indices[2*c],h=this.profile.indices[2*c+1];for(let p=0;p<r;++p){const f=p*e+u,g=(p+1)*e+h,y=p*e+h;l(f,(p+1)*e+u,g),l(f,g,y)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=l0(n),this.normalIndices=l0(o),this.pathVertexIndices=l0(a)}onPathChanged(){this._rebuildGeometry()}},Wde=class{rebuildConnectingProfileGeometry(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.frame,i.vertices[s],i.normals[s],0,0)}},Fxe=class extends Wde{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},pB=class extends Wde{constructor(e,i=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=i,this.flip=r}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,i,r){const s=this.profilePlaneOffset;for(let n=0;n<i.vertices.length;++n)r(e.frame,i.vertices[n],i.normals[n],s,0)}rebuildCapGeometry(e,i){const r=this.profile,s=this.flip?1:-1,n=this.profilePlaneOffset,o=DVe;Gi(o,0,0);for(let a=0;a<r.vertices.length;++a)i(e.frame,r.vertices[a],o,n,s)}buildTopology(e,i){const r=this.profile,s=this.vertexBufferStart+r.indices[0];for(let n=1;n<r.numSegments;++n){const o=r.indices[2*n],a=r.indices[2*n+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?i(c,l,s):i(s,l,c)}}},kxe=class extends Wde{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const i=this.profile;e+=2*i.numSegments*(this.numSegments-1);for(let r=0;r<i.numSegments;++r){const s=i.indices[2*r],n=i.indices[2*r+1];i.poleIndices[s]===i.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,i){const r=this.profile,s=e.frame,n=.5*this.sign,o=NLt,a=DVe;Gi(a,0,0);for(const l of r.poles)l.normal?i(s,l.position,l.normal,n,0):i(s,l.position,a,n,this.sign);if(this.breakNormals)for(let l=0;l<r.vertices.length;++l)i(s,r.vertices[l],r.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,u=Math.sin(c),h=Math.cos(c);for(let p=0;p<r.vertices.length;++p){const f=r.poles[r.poleIndices[p]];By(o,r.vertices[p],f.position),Ed(o,o,u),f.normal?(bm(o,o,f.position),i(s,o,f.normal,n*h,0)):(AF(a,o),Ed(a,a,u),bm(o,o,f.position),i(s,o,a,n*h,this.sign*h))}}}buildTopology(e,i){const r=this.profile,s=this.breakNormals?this.vertexBufferStart+r.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+r.poles.length+r.vertices.length:this.vertexBufferStart+r.poles.length;for(let o=0;o<r.numSegments;++o){const a=r.indices[2*o],l=r.indices[2*o+1],c=this.vertexBufferStart+r.poleIndices[a],u=this.vertexBufferStart+r.poleIndices[l];let h=s+a,p=s+l;for(let f=0;f<this.numSegments-1;++f){const g=n+f*r.vertices.length+a,y=n+f*r.vertices.length+l;this.flip?(i(g,p,h),i(p,g,y)):(i(h,p,g),i(y,g,p)),h=g,p=y}this.flip?(i(c,p,h),c!==u&&i(c,u,p)):(i(h,p,c),c!==u&&i(p,u,c))}}};const NLt=vt(),DVe=vt();let LLt=class{numProfilesPerJoin(){return 1}extrude(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.frame,i.vertices[s],i.normals[s],!1)}},fZ=class{constructor(e,i){this.cutoffAngle=e,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,i,r){const s=FLt,{rotationAngle:n,rotationRight:o,frame:a}=e;if(Math.abs(n)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){Ph(Bxe,.5*-n+c*n/this.numBendSubdivisions,l),DLt(s,a,Bxe);for(let u=0;u<i.vertices.length;++u)bo(i.vertices[u],o)*n>=0?r(s,i.vertices[u],i.normals[u],!1):r(a,e.applyMiterStretch(Uxe,i.vertices[u]),i.normals[u],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<i.vertices.length;++c){const u=bo(i.vertices[c],o)*n>=0;r(a,e.applyMiterStretch(Uxe,i.vertices[c]),i.normals[c],!u)}}},FVe=class{constructor(){this.up=M(),this.right=M()}};function DLt(t,e,i){nt(t.up,e.up,i),nt(t.right,e.right,i)}const Uxe=vt(),Bxe=Ne(),FLt=new FVe;let kLt=class extends Zn{constructor(e,i,r,s,n,o){super(e,i,null,an.Mesh,o),this.path=r,this.geometrySR=s,this.stencilWidth=n}};var h0;function kVe(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(h0||(h0={}));let UVe=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},BVe=class extends UVe{constructor(e){super(e),this.vertexAttributeColor=ni(255,255,255,255),this.size=new Array,this.vertexAttributePosition=qs(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:i,pathVertexData:r,path:s,positions:n,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<i;++c){let u=r[c];const h=u===0||u===s.vertices.length-1;u*=3;const p=GLt;let f=0,g=0;const y=4*c,v=ue(jLt,o[y],o[y+1],o[y+2]),b=ue(HLt,a[y],a[y+1],a[y+2]),w=Gi(zxe,l[y]*e[0],l[y+1]*e[1]);if(h)yt(p,b,v),f=o[y+3]*e[0],g=a[y+3];else{const C=BLt,R=zLt;Gi(C,o[y+3],a[y+3]);const I=$ue(C);AF(C,C);const F=bo(w,C);if(Math.abs(F)>I){Gi(R,-C[1],C[0]);const D=bo(w,R);Ed(C,C,I*Math.sign(F)),Ed(R,R,D),bm(w,C,R)}ue(p,0,0,0)}const x=ue(VLt,v[0]*w[0]+b[0]*w[1],v[1]*w[0]+b[1]*w[1],v[2]*w[0]+b[2]*w[1]),S=3*c;this.vertexAttributePosition[S]=n[u]+x[0]+p[0]*f,this.vertexAttributePosition[S+1]=n[u+1]+x[1]+p[1]*f,this.vertexAttributePosition[S+2]=n[u+2]+x[2]+p[2]*f;const E=Gi(zxe,l[y+2],l[y+3]);gf(this.vertexAttributeNormal,c,v[0]*E[0]+b[0]*E[1]+p[0]*g,v[1]*E[0]+b[1]*E[1]+p[1]*g,v[2]*E[0]+b[2]*E[1]+p[2]*g)}}createGeometryData(){const e=this.builder.vertexIndices.length,{normalIndices:i,vertexIndices:r}=this.builder;return[[O.POSITION,new dt(this.vertexAttributePosition,r,3,!0)],[O.NORMALCOMPRESSED,new dt(this.vertexAttributeNormal,i,2,!0)],[O.COLOR,new dt(this.vertexAttributeColor,Hx(e),4)]]}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,i,r,s){const n=this.builder.vertexIndices,o=new Hk(this.vertexAttributePosition,3),a=n.length/3;PUe(e,i,0,a,n,o,void 0,r,(l,c,u)=>{s(l,u,c,!1)})}},ULt=class extends UVe{constructor(e,i,r,s){super(e),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new BVe(e),this.vvData=qs(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){const{positions:e,profileRightAxes:i,profileUpAxes:r,profileVertexAndNormals:s,pathVertexIndices:n,vertexIndices:o}=this.builder;return[[O.POSITION,new dt(e,n,3,!0)],[O.PROFILERIGHT,new dt(i,o,4,!0)],[O.PROFILEUP,new dt(r,o,4,!0)],[O.PROFILEVERTEXANDNORMAL,new dt(s,o,4,!0)],[O.FEATUREVALUE,new dt(this.vvData,n,4,!0)]]}onPathChanged(e){super.onPathChanged(e);const i=e.getMutableAttribute(O.POSITION);i&&(i.data=this.builder.positions)}};const zxe=vt(),BLt=vt(),zLt=vt(),VLt=M(),GLt=M(),jLt=M(),HLt=M();function qLt(t,e){let i=null;const r=t.vertices.length,s=.99619469809,n=M(),o=M(),a=M(),l=M(),c=M(),u=M(),h=mr();let p=t.vertices[0];ge(o,e),ue(n,0,1,0),a8(p.vRight,o,n,n,a,o,s),ge(p.frame.up,o),ge(p.frame.right,a);const f=t.positions;let g=t.offset;i=p;for(let y=1;y<r;++y){p=t.vertices[y],Te(c,p.vLeft,p.vRight);let v=De(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=p.vRight[0],c[1]=p.vRight[1],c[2]=p.vRight[2]),u[0]=f[g]+i.frame.up[0],u[1]=f[g+1]+i.frame.up[1],u[2]=f[g+2]+i.frame.up[2],g+=3;const b=ue(WLt,f[g],f[g+1],f[g+2]);zk(b,c,h),vC(h,Yd(u,p.vLeft),l)?(l[0]-=f[g],l[1]-=f[g+1],l[2]-=f[g+2],Se(o,l),yt(a,c,o),Se(a,a)):a8(c,i.frame.up,i.frame.right,n,a,o,s),ge(p.frame.up,o),ge(p.frame.right,a),i=p}}const WLt=M();let zVe=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,i){return this.vertices.push(cN(e)),this.normals.push(cN(i)),this.vertices.length-1}addPole(e,i=null){return this.poles.push({position:cN(e),normal:i?cN(i):null}),this.poles.length-1}addSegment(e,i=null){this.indices.push(e.v0),this.indices.push(e.v1),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.indices.length/2}translate(e,i){for(const r of this.vertices)r[0]+=e,r[1]+=i;for(const r of this.poles)r.position[0]+=e,r.position[1]+=i}get usedMemory(){return this.vertices.length*Ww(this.vertices[0])*2+Ww(this.indices)}};const VVe={top:[0,-.5],bottom:[0,.5]};function mZ(t){const i=_Ue,r=new zVe,s={v0:0,v1:0};r.addPole(Ni(0,0));for(let o=0;o<i;++o){const a=2*o*Math.PI/i,l=Math.cos(a),c=Math.sin(a),u=Ni(l*.5,c*.5),h=Ni(l,c);r.addVertex(u,h)}for(let o=0;o<i-1;++o){const a={v0:o,v1:o+1};r.addSegment(a,s)}const n={v0:i-1,v1:0};if(r.addSegment(n,s),t!=="center"){const o=VVe[t];r.translate(o[0],o[1])}return r}const YLt={center:mZ("center"),top:mZ("top"),bottom:mZ("bottom")},XLt={center:gZ("center"),top:gZ("top"),bottom:gZ("bottom")};function gZ(t){const r=new zVe,s=Ni(.5*-1,.5*-1),n=Ni(.5*1,.5*-1),o=Ni(.5*1,.5*1),a=Ni(.5*-1,.5*1),l=Ni(0,-1),c=Ni(1,0),u=Ni(0,1),h=Ni(-1,0);if(r.addPole(Ni(0,.5*1),u),r.addPole(Ni(0,.5*1)),r.addPole(Ni(0,.5*-1)),r.addPole(Ni(0,.5*-1),l),r.addVertex(s,l),r.addVertex(n,l),r.addSegment({v0:0,v1:1},{v0:3,v1:3}),r.addVertex(n,c),r.addVertex(o,c),r.addSegment({v0:2,v1:3},{v0:2,v1:1}),r.addVertex(o,u),r.addVertex(a,u),r.addSegment({v0:4,v1:5},{v0:0,v1:0}),r.addVertex(a,h),r.addVertex(s,h),r.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const p=VVe[t];r.translate(p[0],p[1])}return r}function ZLt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function JLt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function GVe(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function QLt(t,e){if(t===e){const i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function KLt(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*n-s*r;return o?(o=1/o,t[0]=n*o,t[1]=-r*o,t[2]=-s*o,t[3]=i*o,t):null}function eDt(t,e){const i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t}function tDt(t){return t[0]*t[3]-t[2]*t[1]}function jVe(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*a+n*l,t[1]=s*a+o*l,t[2]=r*c+n*u,t[3]=s*c+o*u,t}function iDt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=s*l+o*a,t[2]=r*-a+n*l,t[3]=s*-a+o*l,t}function rDt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1];return t[0]=r*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function sDt(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t}function nDt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function oDt(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function aDt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function lDt(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]}function cDt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function HVe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function uDt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function hDt(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=ba();return Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}function dDt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function pDt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}const fDt=jVe,mDt=HVe;Object.freeze(Object.defineProperty({__proto__:null,LDU:lDt,add:cDt,adjoint:eDt,copy:ZLt,determinant:tDt,equals:hDt,exactEquals:uDt,frob:aDt,fromRotation:sDt,fromScaling:nDt,identity:JLt,invert:KLt,mul:fDt,multiply:jVe,multiplyScalar:dDt,multiplyScalarAndAdd:pDt,rotate:iDt,scale:rDt,set:GVe,str:oDt,sub:mDt,subtract:HVe,transpose:QLt},Symbol.toStringTag,{value:"Module"}));function qVe(){return[1,0,0,1]}function gDt(t){return[t[0],t[1],t[2],t[3]]}function yDt(t,e,i,r){return[t,e,i,r]}function _Dt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:gDt,create:qVe,createView:_Dt,fromValues:yDt},Symbol.toStringTag,{value:"Module"}));let WVe=class{constructor(){this.vLeft=M(),this.vRight=M(),this.vMinSiblingLength=0,this.frame=new FVe}setFrameFromUpVector(e){ge(this.frame.up,e),Te(g3,this.vLeft,this.vRight),Se(g3,g3),ce(jxe,this.frame.up,xe(g3,this.frame.up)),Me(fB,g3,jxe),Se(fB,fB),yt(this.frame.right,fB,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},vDt=class extends WVe{get rotationFrameUp(){return this.frame.up}get rotationRight(){return G$e}get rotationAngle(){return ce(Y1,this.frame.up,xe(this.frame.up,this.vLeft)),Me(Y1,this.vLeft,Y1),Ha(Y1,Y1),Se(Y1,Y1),ce(FM,this.frame.up,xe(this.frame.up,this.vRight)),Me(FM,this.vRight,FM),Se(FM,FM),yt(tH,this.rotationFrameUp,this.vLeft),Math.sign(xe(tH,this.vRight))*(Math.PI-Jo(xe(Y1,FM)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)<=0)return i;const s=IK(Math.cos(.5*r));return Gi(e,(s-1+1)*i[0],i[1])}},bDt=class extends WVe{get rotationFrameUp(){const e=Math.sign(xe(this.frame.right,this.vRight));return yt(m3,this.vRight,this.vLeft),ce(m3,m3,e),Se(m3,m3)}get rotationRight(){const e=this.rotationFrameUp,i=xe(e,this.frame.up),r=xe(e,this.frame.right);return ce(DM,this.frame.up,-r),ce(Gxe,this.frame.right,i),Te(DM,DM,Gxe),Se(DM,DM),wDt(Vxe,this.frame,DM),Vxe}get rotationAngle(){const e=Math.sign(xe(this.frame.right,this.vRight));return Ha(tH,this.vLeft),-e*(Math.PI-Jo(xe(tH,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*IK(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)===0)return i;const s=IK(Math.cos(.5*r)),n=this.rotationRight,o=GVe(SDt,1+(s-1)*n[0]*n[0],(s-1)*n[0]*n[1],(s-1)*n[0]*n[1],1+(s-1)*n[1]*n[1]);return ODe(e,i,o)}};function wDt(t,e,i){Gi(t,xe(i,e.right),xe(i,e.up))}function xDt(t){switch(t){case h0.World:return new vDt;case h0.Path:return new bDt}}const m3=M(),Vxe=vt(),DM=M(),Gxe=M(),tH=M(),Y1=M(),FM=M(),jxe=M(),g3=M(),fB=M(),SDt=qVe(),yZ=8;function TDt(t,e){const i=O.FEATUREVALUE;t.attributes.add(i,"vec4");const r=t.vertex;r.code.add(T`
  bool isCapVertex() {
    return ${i}.w == 1.0;
  }
  `),r.uniforms.add(new os("size",s=>s.size)),e.vvSize?(r.uniforms.add(new Qt("vvSizeMinSize",s=>s.vvSize.minSize),new Qt("vvSizeMaxSize",s=>s.vvSize.maxSize),new Qt("vvSizeOffset",s=>s.vvSize.offset),new Qt("vvSizeFactor",s=>s.vvSize.factor)),r.code.add(T`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${i}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):r.code.add(T`vec2 getSize(){
return size;
}`),e.vvOpacity?(r.constants.add("vvOpacityNumber","int",yZ),r.uniforms.add(new jc("vvOpacityValues",s=>s.vvOpacity.values,yZ),new jc("vvOpacityOpacities",s=>s.vvOpacity.opacityValues,yZ)),r.code.add(T`
    vec4 applyOpacity(vec4 color) {
      float value = ${i}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):r.code.add(T`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(r.constants.add("vvColorNumber","int",jP),r.uniforms.add(new jc("vvColorValues",s=>s.vvColor.values,jP),new X4e("vvColorColors",s=>s.vvColor.colors,jP)),r.code.add(T`
    vec4 getColor() {
      float value = ${i}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):r.code.add(T`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(e4),t.attributes.add(O.PROFILERIGHT,"vec4"),t.attributes.add(O.PROFILEUP,"vec4"),t.attributes.add(O.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(T`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(T`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(T`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(T`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let EDt=class extends l4{constructor(){super(...arguments),this.size=Ni(1,1)}};function qF(t,e){e.spherical?t.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function CDt(t){const e=new tr,{vertex:i,fragment:r}=e;switch(Pu(i,t),e.varyings.add("vpos","vec3"),e.include(TDt,t),t.output!==G.Color&&t.output!==G.ObjectAndLayerIdColor||(e.include(ec,t),e.include(sI,t),e.include(YI,t),e.include(NC,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.multipassEnabled&&e.varyings.add("depth","float"),i.code.add(T`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===G.Color?"forwardLinearDepth();":""}
        forwardObjectAndLayerIdColor();

        vcolor = getColor();
      }
    `)),e.include(V0,t),t.output){case G.Color:e.include(Wn,t),e.include(XE,t),e.include(p4,t),e.include(sI,t),e.include(MUe,t),yg(r,t),f4(r),t$(r),r.uniforms.add(i.uniforms.get("localOrigin"),new Qt("ambient",s=>s.ambient),new Qt("diffuse",s=>s.diffuse),new Qt("specular",s=>s.specular),new et("opacity",s=>s.opacity)),r.include(B0),t.transparencyPassType===mt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),L0(r),r.code.add(T`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===mt.ColorAlpha?T`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
        }
      `);break;case G.Depth:e.include(ec,t),i.code.add(T`void main() {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Wn,t),r.code.add(T`void main() {
discardBySlice(vpos);
}`);break;case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ViewshedShadow:e.include(ec,t),R9(e),e.varyings.add("depth","float"),i.code.add(T`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(Wn,t),e.include(n7,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case G.ObjectAndLayerIdColor:e.include(Wn,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`);break;case G.Normal:e.include(ec,t),e.include(qF,t),XO(i),e.varyings.add("vnormal","vec3"),i.code.add(T`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Wn,t),r.code.add(T`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case G.Highlight:e.include(ec,t),e.include(qF,t),e.varyings.add("vnormal","vec3"),i.code.add(T`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Wn,t),e.include(Wx,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const MDt=Object.freeze(Object.defineProperty({__proto__:null,build:CDt},Symbol.toStringTag,{value:"Module"})),YVe=new Map([[O.POSITION,0],[O.PROFILERIGHT,1],[O.PROFILEUP,2],[O.PROFILEVERTEXANDNORMAL,3],[O.FEATUREVALUE,4],[O.OBJECTANDLAYERIDCOLOR,5]]);let ADt=class extends EDt{constructor(){super(...arguments),this.ambient=Be(.2,.2,.2),this.diffuse=Be(.8,.8,.8),this.specular=Be(0,0,0),this.opacity=1,this.origin=M(),this.modelTransformation=null}},XVe=class ZVe extends hr{initializeConfiguration(e,i){i.spherical=e.viewingMode===Xe.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new dr(e.rctx,ZVe.shader.get().build(this.configuration),YVe)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===mt.NONE,s=e===mt.FrontFace;return ti({blending:i.output===G.Color&&i.transparent?r?Ch:c1(e):null,culling:i.hasSlicePlane&&!i.transparent&&i.doubleSidedMode!==Ws.None?UDe:null,depthTest:{func:Yx(e)},depthWrite:r||s?Oh:null,drawBuffers:i.output===G.Depth?{buffers:[zo.NONE]}:u1(e),colorWrite:fi,stencilWrite:i.hasOccludees?x0:null,stencilTest:i.hasOccludees?Xx:null,polygonOffset:r||s?null:Q9})}};XVe.shader=new ir(MDt,()=>ye(()=>import("./Path.glsl-b5888464.js"),[],import.meta.url));let fo=class extends $u{constructor(){super(...arguments),this.output=G.Color,this.doubleSidedMode=Ws.None,this.transparencyPassType=mt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1,this.objectAndLayerIdColorInstanced=!1}};d([V({count:G.COUNT})],fo.prototype,"output",void 0),d([V({count:Ws.COUNT})],fo.prototype,"doubleSidedMode",void 0),d([V({count:mt.COUNT})],fo.prototype,"transparencyPassType",void 0),d([V()],fo.prototype,"spherical",void 0),d([V()],fo.prototype,"receiveShadows",void 0),d([V()],fo.prototype,"receiveAmbientOcclusion",void 0),d([V()],fo.prototype,"vvSize",void 0),d([V()],fo.prototype,"vvColor",void 0),d([V()],fo.prototype,"vvOpacity",void 0),d([V()],fo.prototype,"hasSlicePlane",void 0),d([V()],fo.prototype,"transparent",void 0),d([V()],fo.prototype,"hasOccludees",void 0),d([V()],fo.prototype,"multipassEnabled",void 0),d([V()],fo.prototype,"cullAboveGround",void 0),d([V()],fo.prototype,"doublePrecisionRequiresObfuscation",void 0),d([V({constValue:!1})],fo.prototype,"occlusionPass",void 0),d([V({constValue:Ot.Disabled})],fo.prototype,"pbrMode",void 0),d([V({constValue:!0})],fo.prototype,"hasVvInstancing",void 0),d([V({constValue:!1})],fo.prototype,"useCustomDTRExponentForWater",void 0),d([V({constValue:!1})],fo.prototype,"useFillLights",void 0),d([V({constValue:!1})],fo.prototype,"hasColorTexture",void 0);let RDt=class JVe extends qx{constructor(e){super(e,new ODt),this.supportsEdges=!0,this.produces=new Map([[Ce.OPAQUE_MATERIAL,i=>(this.parameters.castShadows&&DP(i)||gD(i))&&!this.parameters.transparent],[Ce.TRANSPARENT_MATERIAL,i=>(this.parameters.castShadows&&DP(i)||gD(i))&&this.parameters.transparent]]),this._vertexAttributeLocations=YVe,this._configuration=new fo,this._vertexBufferLayout=JVe.getVertexBufferLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e===G.Color&&(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Ws.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Ws.WindingOrder:Ws.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=i.ssao!=null),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==G.Shadow&&e!==G.ShadowExcludeHighlight&&e!==G.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,i,r,s,n,o){const a=e;if(!kVe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:b,factor:w,minSize:x,maxSize:S}=this.parameters.vvSize,E=l.sizeAttributeValue;c[0]*=$e(b[0]+E*w[0],x[0],S[0]),c[1]*=$e(b[2]+E*w[2],x[2],S[2])}const u=new h4(!1,r.options.normalRequired),h=Math.max(c[0],c[1]),p=e.boundingInfo;if(p==null)return void Hxe(l,c,s,n,u,o);const f=GE(p.bbMin[0]-h,p.bbMin[1]-h,p.bbMin[2]-h,p.bbMax[0]+h,p.bbMax[1]+h,p.bbMax[2]+h),g=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],y=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),v=[y/g[0],y/g[1],y/g[2]];Xhe(f,s,v,r.tolerance)&&Hxe(l,c,s,n,u,o)}createBufferWriter(){return new QI(this._vertexBufferLayout)}createGLMaterial(e){return new PDt(e)}static getVertexBufferLayout(){const e=Xs().vec3f(O.POSITION).vec4f(O.PROFILERIGHT).vec4f(O.PROFILEUP).vec4f(O.PROFILEVERTEXANDNORMAL).vec4f(O.FEATUREVALUE);return ae("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}},PDt=class extends jx{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output===G.Color&&(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(XVe,e)}};function Hxe(t,e,i,r,s,n){t.baked.size&&t.baked.size[0]===e[0]&&t.baked.size[1]===e[1]||t.baked.bake(e),t.baked.intersect(i,r,s,n)}let ODt=class extends ADt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const IDt=["polyline"];let $Dt=class extends j0{constructor(e,i,r,s){super(e,i,r,s),this._intrinsicSize=Ni(1,1),this._upVectorAlignment=h0.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,i=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new a4({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,i],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=this._context.renderer?.visualVariables?.length>0?KO(this._context.renderer,this._vvConvertOptions):null;const r=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?h0.World:h0.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=YLt[r];break;case"quad":this._profile=XLt[r]}switch(this.symbolLayer.join){case"round":this._extruder=new fZ(0,yUe);break;case"bevel":this._extruder=new fZ(0,1);break;case"miter":this._extruder=new fZ(.8*Math.PI,1);break;default:this._extruder=new LLt}const n=this.symbolLayer.cap||"butt";switch(n){case"none":this._startCap=new Fxe,this._endCap=new Fxe;break;case"butt":default:this._startCap=new pB(this._profile,0),this._endCap=new pB(this._profile,0,!0);break;case"square":this._startCap=new pB(this._profile,-.5),this._endCap=new pB(this._profile,.5,!0);break;case"round":{const p=s==="quad";this._startCap=new kxe({profile:this._profile,flip:!1,breakNormals:p,subdivisions:dse}),this._endCap=new kxe({profile:this._profile,flip:!0,breakNormals:p,subdivisions:dse});break}}const o=this.symbolLayer?.material?.color,a=this._getCombinedOpacityAndColor(o),l=Dc(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,h={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||n==="none"?ns.None:ns.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Gi(this._intrinsicSize,e,i),!hse(this._intrinsicSize[0])||!hse(this._intrinsicSize[1])))throw new j("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates?.visualVariables.size||Ed(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const p={...h,...this._fastUpdates.materialParameters,size:k$e(this._intrinsicSize)};this._materials[0]=new RDt(p)}else h.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,h.normalType=yr.Compressed,this._materials[0]=new vg(h);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,IDt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i),s=e.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacity(e),r=i<1||this.needsDrivenTransparentPass;this._materials[0]?.setParameters({opacity:i,transparent:r})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,vx)}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._materials[0]?.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!eI(this._fastUpdates,i,this._vvConvertOptions))return Dn.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return Dn.FastUpdate}_getVertexData(e){let i=0;const r=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const h of r)i+=h.length;const l=qo(3*i);let c,u=0;for(const h of r){s.push({offset:u,numVertices:h.length});for(const p of h)l[u++]=p[0],l[u++]=p[1],l[u++]=e.hasZ?p[2]:0}return o==null||n.equals(o)||Ts(l,n,0,l,o,0,i)?(o==null||o.equals(a)?c=ake(l):(c=qo(3*i),Ts(l,o,0,c,a,0,i)),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,i,r,s){this.usedMemory=0;const n=e.geometry,o=this._getVertexData(n);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(g=>g.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=n.spatialReference,c=Oo(),u=this._context.renderCoordsHelper,h=new iue(o.vertexDataES);for(const g of o.pathVertexDataInfos){const y=g.numVertices;if(y<2)continue;const v=g.offset;if(this._context.clippingExtent!=null&&(hs(c),Id(c,o.vertexDataES,v,y),!Gm(c,this._context.clippingExtent)))continue;const b=new Array,w=v+3*y;for(let F=v;F<w;F+=3){h.offset=F;const D=iTt(h,this._context.elevationProvider,r,u);ue(wn,o.vertexDataRS[F],o.vertexDataRS[F+1],o.vertexDataRS[F+2]),u.setAltitude(wn,D),o.vertexDataRS[F]=wn[0],o.vertexDataRS[F+1]=wn[1],o.vertexDataRS[F+2]=wn[2],b.push(xDt(this._upVectorAlignment))}const x=new ILt(b,o.vertexDataES,o.vertexDataRS,v);QVe(x,this._upVectorAlignment,this._context.renderCoordsHelper);const S=new $Lt(x,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates){const F=this._fastUpdates.visualVariables,D=eg(F.size?.field,e)??0,z=eg(F.color?.field,e)??0,B=eg(F.opacity?.field,e)??0;E=new ULt(S,D,z,B)}else{const F=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const B=i.size;F[0]*=qxe(B[0],B[2]==="symbol-value"?this.symbolLayer.height||0:B[2],this.symbolLayer.width||0),F[1]*=qxe(B[2],B[0]==="symbol-value"?this.symbolLayer.width||0:B[0],this.symbolLayer.height||0)}let D;this._drivenProperties.color&&(D=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(D=D?[D[0],D[1],D[2],i.opacity]:[1,1,1,i.opacity]);const z=new BVe(S);z.bake(F),D&&z.bakeVertexColors(D),E=z}const C=E.createGeometryData(),R=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),I=new kLt(this._materials[0],C,E,l,this._stencilWidth,R);I.transformation=ac(Ne(),us,S.path.origin),a.push(I),this.usedMemory+=S.usedMemory}if(a.length===0)return null;const p=new Zx({geometries:a,layerUid:this._context.layer.uid,graphicUid:s}),f=new G0(this,p,a,null,null,(g,y,v,b,w)=>LDt(g,y,b,w,this._upVectorAlignment),r);return f.alignedSampledElevation=0,f.needsElevationUpdates=vx(r.mode),f}};function QVe(t,e,i){const{origin:r,positions:s}=t;let n=t.offset;switch(e){default:case h0.World:for(const o of t.vertices)wn[0]=s[n++]+r[0],wn[1]=s[n++]+r[1],wn[2]=s[n++]+r[2],i.worldUpAtPosition(wn,wn),o.setFrameFromUpVector(wn);break;case h0.Path:wn[0]=s[n]+r[0],wn[1]=s[n+1]+r[1],wn[2]=s[n+2]+r[2],i.worldUpAtPosition(wn,wn),qLt(t,wn)}}function qxe(t,e,i){switch(t){case"symbol-value":return i;case"proportional":return e;default:return t}}function NDt(t,e,i,r){let s=0;const{origin:n,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let u=t.offset;u<c;u+=3)ue(wn,l[u],l[u+1],l[u+2]),i(wn,_Z),s+=_Z.sampledElevation,wn[0]=a[u]+n[0],wn[1]=a[u+1]+n[1],wn[2]=a[u+2]+n[2],r.setAltitude(wn,_Z.z),a[u]=wn[0]-n[0],a[u+1]=wn[1]-n[1],a[u+2]=wn[2]-n[2];return t.updatePathVertexInformation(),s/o.length}function LDt(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!kVe(l))continue;const c=l.path,u=c.builder.path;a+=NDt(u,e,i,r),s!==h0.World&&QVe(u,s,r),c.onPathChanged(l),l.invalidateBoundingInfo(),n.geometryVertexAttributeUpdated(l,O.POSITION)}return a/o.length}const wn=M(),_Z=new u4;function DDt(t,e,i,r,s=1){if(i.isGeographic&&r===Xe.Global){const c=qo(e.length),u=e.length,h=$r(i);for(let p=0;p<u;p+=3)mce(e,p,c,p,h);e=c}Gi(xo,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)xo[0]=Math.min(xo[0],e[c]),xo[1]=Math.min(xo[1],e[c+1]);const n=xo[0]%s,o=xo[1]%s,a=xo[0]-n,l=xo[1]-o;for(let c=0;c<e.length;c+=3){const u=c/3*4;t[u]=(e[c]-a)/s,t[u+1]=(e[c+1]-l)/s,t[u+2]=a/s,t[u+3]=l/s}}function KVe(t,e,i,r,s=1){ue(NS,1,0,0),ue(LS,0,1,0),ue(UM,0,0,1),kDt(vZ,i),Wat(Wxe,i)&&FDt(Wxe,NS,LS,UM,r,vZ),Gi(xo,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Gi(DS,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<i.length;u+=3){ue(kM,i[u],i[u+1],i[u+2]);const h=xe(NS,kM),p=xe(LS,kM);xo[0]=Math.min(xo[0],h),xo[1]=Math.min(xo[1],p),DS[0]=Math.max(DS[0],h),DS[1]=Math.max(DS[1],p)}const n=xe(UM,vZ);wZ(X1,xo[0],xo[1],n,NS,LS,UM),wZ(FS,DS[0],xo[1],n,NS,LS,UM),wZ(kS,xo[0],DS[1],n,NS,LS,UM),Me(FS,FS,X1),ce(FS,FS,.5),Me(kS,kS,X1),ce(kS,kS,.5),Te(X1,X1,FS),Te(X1,X1,kS);const o=xo[0]%s,a=xo[1]%s,l=xo[0]-o,c=xo[1]-a;for(let u=0;u<i.length;u+=3){ue(kM,i[u],i[u+1],i[u+2]);const h=u/3,p=4*h;t[p]=(xe(NS,kM)-l)/s,t[p+1]=(xe(LS,kM)-c)/s,t[p+2]=l/s,t[p+3]=c/s;const f=9*h;for(let g=0;g<3;g++)e[f+g]=X1[g],e[f+g+3]=FS[g],e[f+g+6]=kS[g]}}const vZ=M(),kM=M(),Wxe=mr(),NS=M(),LS=M(),UM=M(),xo=vt(),DS=vt(),X1=M(),FS=M(),kS=M();function FDt(t,e,i,r,s,n){s!=null?(s.basisMatrixAtPosition(n,Hg),ue(mB,Hg[0],Hg[1],Hg[2]),ue(gB,Hg[4],Hg[5],Hg[6]),ue(bZ,Hg[8],Hg[9],Hg[10])):(ue(mB,1,0,0),ue(gB,0,1,0),ue(bZ,0,0,1));const o=t;xe(o,bZ)<0&&ce(o,o,-1),ge(r,o);const a=xe(o,gB),l=xe(o,mB);Math.abs(a)>Math.abs(l)?(ao(e,mB,o,-l),Se(e,e),yt(i,e,o),Se(i,i),ce(i,i,-1)):(ao(i,gB,o,-a),Se(i,i),yt(e,i,o),Se(e,e))}const Hg=Ne(),mB=M(),gB=M(),bZ=M();function kDt(t,e){ue(y3,0,0,0);for(let i=0;i<e.length-3;i+=3)y3[0]+=e[i],y3[1]+=e[i+1],y3[2]+=e[i+2];ce(t,y3,1/(e.length/3-1))}const y3=M();function wZ(t,e,i,r,s,n,o){ue(t,e*s[0]+i*n[0]+r*o[0],e*s[1]+i*n[1]+r*o[1],e*s[2]+i*n[2]+r*o[2])}let Yde=class extends qx{intersect(e,i,r,s,n,o){return AUe(e,r,s,n,void 0,o)}};function UDt(t){const e=new tr,{vertex:i,fragment:r,attributes:s,varyings:n}=e;Pu(i,t),e.include(ec,t),e.include(LC,t),e.include($v,t),e.include(NC,t),s.add(O.POSITION,"vec3"),t.vvColor&&s.add(O.COLORFEATUREATTRIBUTE,"float"),n.add("vColor","vec4"),n.add("vpos","vec3");const o=t.multipassEnabled&&t.output===G.Color;o&&n.add("depth","float"),i.uniforms.add(new Ki("eColor",l=>l.color)),i.code.add(T`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),e.include(Wn,t),o&&e.include(V0,t),r.include(B0);const a=t.output===G.Highlight;return a&&e.include(Wx,t),t.transparencyPassType===mt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),r.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${t.output===G.ObjectAndLayerIdColor?T`fColor.a = 1.0;`:""}

    if (fColor.a < ${T.float(Ba)}) {
      discard;
    }

    ${t.output===G.Color?T`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===mt.ColorAlpha?T`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}`:""}
    ${a?T`outputHighlight();`:""};
    ${t.output===G.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const BDt=Object.freeze(Object.defineProperty({__proto__:null,build:UDt},Symbol.toStringTag,{value:"Module"}));let eGe=class tGe extends hr{initializeProgram(e){return new dr(e.rctx,tGe.shader.get().build(this.configuration),Fi)}_createPipeline(e,i){const r=this.configuration,s=e===mt.NONE,n=e===mt.FrontFace;return ti({blending:r.output===G.Color&&r.transparent?s?Ch:c1(e):null,culling:C9(r.cullFace),depthTest:r.draped?null:{func:Yx(e)},depthWrite:r.draped?null:(s||n)&&r.writeDepth?Oh:null,drawBuffers:r.output===G.Depth?{buffers:[zo.NONE]}:u1(e),colorWrite:fi,stencilWrite:r.hasOccludees?x0:null,stencilTest:r.hasOccludees?i?bx:Xx:null,polygonOffset:s||n?r.polygonOffset?zDt:null:K9(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};eGe.shader=new ir(BDt,()=>ye(()=>import("./ColorMaterial.glsl-c60e1cbc.js"),[],import.meta.url));const zDt={factor:1,units:1};let na=class extends $u{constructor(){super(...arguments),this.output=G.Color,this.cullFace=ns.None,this.transparencyPassType=mt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1}};d([V({count:G.COUNT})],na.prototype,"output",void 0),d([V({count:ns.COUNT})],na.prototype,"cullFace",void 0),d([V({count:mt.COUNT})],na.prototype,"transparencyPassType",void 0),d([V()],na.prototype,"hasSlicePlane",void 0),d([V()],na.prototype,"hasVertexColors",void 0),d([V()],na.prototype,"transparent",void 0),d([V()],na.prototype,"polygonOffset",void 0),d([V()],na.prototype,"enableOffset",void 0),d([V()],na.prototype,"writeDepth",void 0),d([V()],na.prototype,"hasOccludees",void 0),d([V()],na.prototype,"multipassEnabled",void 0),d([V()],na.prototype,"cullAboveGround",void 0),d([V()],na.prototype,"objectAndLayerIdColorInstanced",void 0),d([V()],na.prototype,"vvColor",void 0),d([V()],na.prototype,"draped",void 0),d([V({constValue:!1})],na.prototype,"occlusionPass",void 0),d([V({constValue:!0})],na.prototype,"hasVvInstancing",void 0),d([V({constValue:!1})],na.prototype,"vvSize",void 0),d([V({constValue:!1})],na.prototype,"vvOpacity",void 0);let Yxe=class extends Yde{constructor(e){super(e,new GDt),this.supportsEdges=!0,this.produces=new Map([[Ce.OPAQUE_MATERIAL,i=>i===G.Highlight||xY(i)&&!this._isTransparent],[Ce.OPAQUE_NO_SSAO_DEPTH,i=>Uw(i)&&this.parameters.writeLinearDepth&&!this._isTransparent],[Ce.TRANSPARENT_MATERIAL,i=>xY(i)&&this._isTransparent&&this.parameters.writeDepth],[Ce.TRANSPARENT_NO_SSAO_DEPTH,i=>Uw(i)&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[Ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>(xY(i)||Uw(i)&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[Ce.DRAPED_MATERIAL,i=>kFe(i)]]),this._configuration=new na}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<J9,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}createGLMaterial(e){return new VDt(e)}createBufferWriter(){const e=Xs().vec3f(O.POSITION);return ae("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4u8(O.COLOR),new QI(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}},VDt=class extends jx{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===G.Color&&this._updateOccludeeState(e),this.ensureTechnique(eGe,e)}},GDt=class extends l4{constructor(){super(...arguments),this.color=Ud,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=ns.None,this.hasOccludees=!1,this.draped=!1}};var Ua;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(Ua||(Ua={}));const Yse=.70710678118,Xxe=Yse,jDt=.08715574274;function HDt(t){const e=new tr,i=t.multipassEnabled&&t.output===G.Color,{vertex:r,fragment:s,attributes:n,varyings:o}=e;Pu(r,t),e.include(ec,t),e.include(LC,t),e.include($v,t),e.include(NC,t),t.draped?r.uniforms.add(new et("worldToScreenRatio",(l,c)=>1/c.screenToPCSRatio)):n.add(O.BOUNDINGRECT,"mat3"),n.add(O.POSITION,"vec3"),n.add(O.UVMAPSPACE,"vec4"),t.vvColor&&n.add(O.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),i&&o.add("depth","float"),r.uniforms.add(new Ki("uColor",l=>l.color));const a=t.style===Ua.ForwardDiagonal||t.style===Ua.BackwardDiagonal||t.style===Ua.DiagonalCross;return a&&r.code.add(T`
      const mat2 rotate45 = mat2(${T.float(Yse)}, ${T.float(-Xxe)},
                                 ${T.float(Xxe)}, ${T.float(Yse)});
    `),t.draped||(yg(r,t),r.uniforms.add(new et("worldToScreenPerDistanceRatio",(l,c)=>1/c.camera.perScreenPixelRatio)),r.code.add(T`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),r.code.add(T`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),r.code.add(T`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${T.float(jDt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),r.code.add(T`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":T`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${T.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),r.code.add(T`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),e.include(Wn,t),s.include(B0),t.draped&&s.uniforms.add(new et("texelSize",(l,c)=>1/c.camera.pixelRatio)),t.output===G.Highlight&&e.include(Wx,t),i&&e.include(V0,t),t.output!==G.Highlight&&(s.code.add(T`
      const float lineWidth = ${T.float(t.lineWidth)};
      const float spacing = ${T.float(t.patternSpacing)};
      const float spacingINV = ${T.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(T`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),t.transparencyPassType===mt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),s.code.add(T`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==G.Highlight?T`color.a *= ${qDt(t)};`:""}

      ${t.output===G.ObjectAndLayerIdColor?T`color.a = 1.0;`:""}

      if (color.a < ${T.float(Ba)}) {
        discard;
      }

      ${t.output===G.Color?T`fragColor = color; ${t.transparencyPassType===mt.ColorAlpha?T`
                    fragColor = premultiplyAlpha(fragColor);
                    fragAlpha = fragColor.a;`:""}`:""}
      ${t.output===G.Highlight?T`outputHighlight();`:""}
      ${t.output===G.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
    }
  `),e}function qDt(t){function e(i){return t.draped?T`coverage(vuv.${i}, texelSize)`:T`sampleAA(vuv.${i})`}switch(t.style){case Ua.ForwardDiagonal:case Ua.Horizontal:return e("y");case Ua.BackwardDiagonal:case Ua.Vertical:return e("x");case Ua.DiagonalCross:case Ua.Cross:return T`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const WDt=Object.freeze(Object.defineProperty({__proto__:null,build:HDt},Symbol.toStringTag,{value:"Module"}));let iGe=class rGe extends hr{initializeProgram(e){return new dr(e.rctx,rGe.shader.get().build(this.configuration),ae("enable-feature:objectAndLayerId-rendering")?nGe:sGe)}_setPipelineState(e,i){const r=this.configuration,s=e===mt.NONE,n=e===mt.FrontFace;return ti({blending:r.output===G.Color?s?Ch:c1(e):null,culling:C9(r.cullFace),depthTest:r.draped?null:{func:Yx(e)},depthWrite:r.draped?null:s?Oh:Z9(e),drawBuffers:r.output===G.Depth?{buffers:[zo.NONE]}:u1(e),colorWrite:fi,stencilWrite:r.hasOccludees?x0:null,stencilTest:r.hasOccludees?i?bx:Xx:null,polygonOffset:s||n?r.polygonOffset?YDt:null:K9(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};iGe.shader=new ir(WDt,()=>ye(()=>import("./Pattern.glsl-d51ce644.js"),[],import.meta.url));const YDt={factor:1,units:1};let Lo=class extends $u{constructor(){super(...arguments),this.output=G.Color,this.cullFace=ns.None,this.transparencyPassType=mt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasOccludees=!1,this.enableOffset=!0,this.multipassEnabled=!1,this.cullAboveGround=!1,this.vvColor=!1,this.objectAndLayerIdColorInstanced=!1}};d([V({count:G.COUNT})],Lo.prototype,"output",void 0),d([V({count:ns.COUNT})],Lo.prototype,"cullFace",void 0),d([V({count:Ua.COUNT})],Lo.prototype,"style",void 0),d([V({count:mt.COUNT})],Lo.prototype,"transparencyPassType",void 0),d([V()],Lo.prototype,"hasSlicePlane",void 0),d([V()],Lo.prototype,"hasVertexColors",void 0),d([V()],Lo.prototype,"polygonOffset",void 0),d([V()],Lo.prototype,"hasOccludees",void 0),d([V()],Lo.prototype,"patternSpacing",void 0),d([V()],Lo.prototype,"lineWidth",void 0),d([V()],Lo.prototype,"enableOffset",void 0),d([V()],Lo.prototype,"draped",void 0),d([V()],Lo.prototype,"multipassEnabled",void 0),d([V()],Lo.prototype,"cullAboveGround",void 0),d([V()],Lo.prototype,"vvColor",void 0),d([V({constValue:!0})],Lo.prototype,"writeDepth",void 0),d([V({constValue:!1})],Lo.prototype,"occlusionPass",void 0),d([V({constValue:!1})],Lo.prototype,"hasVvInstancing",void 0),d([V({constValue:!1})],Lo.prototype,"vvSize",void 0),d([V({constValue:!1})],Lo.prototype,"vvOpacity",void 0);const sGe=new Map([[O.POSITION,0],[O.COLOR,3],[O.UVMAPSPACE,4],[O.COLORFEATUREATTRIBUTE,5],[O.BOUNDINGRECT,6]]),nGe=new Map([[O.POSITION,0],[O.COLOR,3],[O.UVMAPSPACE,4],[O.COLORFEATUREATTRIBUTE,5],[O.BOUNDINGRECT,6],[O.OBJECTANDLAYERIDCOLOR,9]]);let Xde=class extends Yde{constructor(e){super(e,new QDt),this.supportsEdges=!0,this.produces=new Map([[Ce.OPAQUE_MATERIAL,i=>lE(i)],[Ce.TRANSPARENT_MATERIAL,i=>Ov(i)],[Ce.TRANSPARENT_NO_SSAO_DEPTH,i=>Uw(i)&&this.parameters.writeLinearDepth],[Ce.DRAPED_MATERIAL,i=>this.parameters.draped&&i===G.Color||lE(i)]]),this._vertexAttributeLocations=ae("enable-feature:objectAndLayerId-rendering")?nGe:sGe,this._configuration=new Lo}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<J9,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}createGLMaterial(e){return new XDt(e)}createBufferWriter(){const e=Xs().vec3f(O.POSITION).vec4f(O.UVMAPSPACE);return this.parameters.draped||e.mat3f(O.BOUNDINGRECT),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4u8(O.COLOR),ae("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),new ZDt(e)}},XDt=class extends jx{_updateParameters(e){return this.ensureTechnique(iGe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===G.Color&&this._updateOccludeeState(e),this._updateParameters(e)}},ZDt=class extends QI{write(e,i,r,s,n){z4e(r,this.vertexBufferLayout,e,i,s,n);for(const o of this.vertexBufferLayout.fields.keys()){const a=r.attributes.get(o),l=a?.indices;if(a&&l)switch(o){case O.UVMAPSPACE:{Tt(a.size===4);const c=s.getField(o,_g);c&&tI(a,c,n);break}case O.BOUNDINGRECT:{Tt(a.size===9);const c=s.getField(o,fx);c&&JDt(a,e,c,n);break}}}}};function JDt(t,e,i,r){const{data:s,indices:n}=t,o=e,a=i.typedBuffer,l=i.typedBufferStride,c=n.length;r*=l;for(let u=0;u<c;++u){const h=9*n[u],p=s[h],f=s[h+1],g=s[h+2];a[r]=o[0]*p+o[4]*f+o[8]*g+o[12],a[r+1]=o[1]*p+o[5]*f+o[9]*g+o[13],a[r+2]=o[2]*p+o[6]*f+o[10]*g+o[14];for(let y=3;y<9;++y)a[r+y]=s[h+y];r+=l}}let QDt=class extends l4{constructor(){super(...arguments),this.color=ni(1,1,1,1),this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=ns.None,this.hasOccludees=!1,this.style=Ua.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function KDt(t,e){const i=t?.pattern??null;return i==null?new Yxe(e):i.style==="none"||i.style==="solid"?(i.style==="none"&&(e.color=ni(0,0,0,0),e.forceTransparentMode=!0),new Yxe(e)):(e.style=eFt(i.style),new Xde(e))}function eFt(t){switch(t){case"horizontal":return Ua.Horizontal;case"vertical":return Ua.Vertical;case"cross":return Ua.Cross;case"forward-diagonal":return Ua.ForwardDiagonal;case"backward-diagonal":return Ua.BackwardDiagonal;case"diagonal-cross":return Ua.DiagonalCross;default:return}}function tFt(t){return t.material instanceof Xde&&!t.material.parameters.draped}function iFt(t,e){if(tFt(t)){const i=t.attributes.get(O.POSITION).data,r=t.getMutableAttribute(O.UVMAPSPACE).data,s=t.getMutableAttribute(O.BOUNDINGRECT).data;KVe(r,s,i,e)}}function rFt(t,e,i,r,s){const n=lUe(t,e,i,r,s),o=t.stageObject.geometries;for(const a of o)iFt(a,s);return n}const sFt=["polyline","polygon","extent"],Zxe=new a4({size:!1,color:!0,rotation:!1,opacity:!1});let oGe=class aGe extends j0{constructor(e,i,r,s){super(e,i,r,s),this._needsUV=!1}async doLoad(){this._fastUpdates=KO(this._context.renderer,Zxe)}_createMaterials(){if(this._materials.length>0)return;const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacityAndColor(e);this._materials[_n.Fill]=KDt(this.symbolLayer,{color:i,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters}),this._needsUV=this._materials[_n.Fill]instanceof Xde;const r=this.symbolLayer.outline;if(aFt(r)){const s=sVe(r.pattern);this._materials[_n.Outline]=new KR({width:Yn(r.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,cap:Use(r.patternCap||"butt")})}this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,sFt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._createMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!eI(this._fastUpdates,i,Zxe))return Dn.RecreateSymbol;this._materials[_n.Fill]?.setParameters(this._fastUpdates.materialParameters)}return Dn.FastUpdate}layerOpacityChanged(){if(this._materials[_n.Fill]!=null){const e=this._materials[_n.Fill].parameters.color,i=this.symbolLayer?.material?.color,r=this._getCombinedOpacity(i);this._materials[_n.Fill].setParameters({color:[e[0],e[1],e[2],r],forceTransparentMode:this.needsDrivenTransparentPass})}if(this._materials[_n.Outline]!=null){const e=this._materials[_n.Outline].parameters.color;this._materials[_n.Outline].setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=c4(aGe.elevationModeChangeTypes,r,s);if(n!==cn.UPDATE)return n;const o=mf(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){if(this._materials[_n.Fill]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[_n.Outline]){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[_n.Outline].setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){const s=BF(e.geometry);if(!s)return null;const n=Mde(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=new nFt(n,i,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=qs(4*a,!0),o.boundingRect=qo(9*a,!0),KVe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._materials[_n.Outline]&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new Zx({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new G0(this,l,o.outGeometries,null,null,rFt,r);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=mf(r.mode),c}_createAs3DShapeFill(e,i){const r=i.renderData.polygons;for(const{position:s,mapPositions:n,holeIndices:o,index:a,count:l}of r){if(this._context.clippingExtent!=null&&(hs(kf),Id(kf,n),!Gm(kf,this._context.clippingExtent)))continue;const c=MCt(n,o,this._context.elevationProvider.spatialReference);if(c.length===0)continue;const u=this._fastUpdates?.visualVariables.color,h=W1e({material:this._materials[_n.Fill],indices:c,mapPositions:n,attributeData:{position:s,color:u?null:i.color,colorFeature:u?eg(u.field,e):null,uvMapSpace:this._needsUV?s8(i.uvMapSpace,4*a,4*l):null,boundingRect:this._needsUV?sf(i.boundingRect,9*a,9*l):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(h)}}_createAs3DShapeOutline(e){if(this._materials[_n.Outline]==null)return;const i=e.renderData.outlines;for(const{mapPositions:r,position:s}of i){if(this._context.clippingExtent!=null&&(hs(kf),Id(kf,r),!Gm(kf,this._context.clippingExtent)))continue;const n=Bse(this._materials[_n.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:r,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(n)}}_createAsOverlay(e,i){const r=BF(e.geometry);if(r==null)return null;this._materials[_n.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,this._materials[_n.Outline]!=null&&(this._materials[_n.Outline].renderPriority=this._renderPriority);const s=FBe(r,this._context.overlaySR),n=new oFt(s,i,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=qs(4*o,!0),DDt(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=hs(),n.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(n),this._createAsOverlayFill(e,n),this._materials[_n.Outline]&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,r.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new b7(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,i){const r=i.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){const l=hs(kf);if(Id(l,s),!Gm(l,this._context.clippingExtent))continue;const c=oI(s,n,3);if(c.length===0)continue;HO(i.outBoundingBox,l);const u=this._fastUpdates?.visualVariables.color,h=W1e({material:this._materials[_n.Fill],indices:c,attributeData:{position:s,color:u?null:i.color,colorFeature:u?eg(u.field,e):null,uvMapSpace:this._needsUV?s8(i.uvMapSpace,4*o,4*a):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(new cI(h,i))}}_createAsOverlayOutline(e){if(this._materials[_n.Outline]==null)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if(hs(kf),Id(kf,s),!Gm(kf,this._context.clippingExtent))continue;HO(e.outBoundingBox,kf);const n=Bse(this._materials[_n.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(new cI(n,e))}}_getOutlineOpacity(){const e=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){const e=this.symbolLayer?.outline?.color,i=this._getOutlineOpacity();return SD(e!=null?Ke.toUnitRGB(e):null,i)}test(){return{...super.test(),createAsOverlay:(e,i)=>this._createAsOverlay(e,i),createAs3DShape:(e,i,r)=>this._createAs3DShape(e,i,r)}}};oGe.elevationModeChangeTypes={definedChanged:cn.RECREATE,staysOnTheGround:cn.NONE,onTheGroundChanged:cn.RECREATE};const kf=Oo();let nFt=class extends d7{constructor(e,i,r,s){super(e,r,s),this.color=i}},oFt=class extends d7{constructor(e,i,r,s){super(e,r,s),this.color=i}};var _n;function aFt(t){return t?.size!=null&&t.size>0&&t.color!=null&&(t.pattern==null||t.pattern.type!=="style"||t.pattern.style!=="none")}(function(t){t[t.Fill=0]="Fill",t[t.Outline=1]="Outline"})(_n||(_n={}));let lGe=class{constructor(e,i="center",r=!1,s=vt(),n=ni(0,0,0,-1),o="world",a=M(),l=0){this.verticalOffset=e,this.anchor=i,this.hasLabelVerticalOffset=r,this.screenOffset=s,this.centerOffset=n,this.centerOffsetUnits=o,this.translation=a,this.elevationOffset=l}},cGe=class{constructor(e,i="center",r="center",s=null,n=vt()){this.placement=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=s,this.displaySize=n}},uGe=class hGe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=Jxe(e.color),this.haloStyle=lFt(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?Jxe(e.background.color):null}fontString(e){const i=this.definition.font,r="sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji";return`${i.style} ${i.weight} ${e}px ${i.family}, ${r}`}setFontProperties(e,i){e.font=this.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}static async fromSymbol(e,i){const r=e?.material?.color,s=Ke.toUnitRGBA(r)??Ud,n=e.size!=null?Yn(e.size):12,o=e.lineHeight,a=e.background!=null?Ke.toUnitRGBA(e.background.color):Ud,l={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"},c=e.halo,u=c?.color!=null&&c.size>0?{size:Yn(c.size),color:Ke.toUnitRGBA(c.color)}:{size:0,color:Ud},h=new hGe({color:s,size:n,background:{color:a,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:i});if(e.font){let p=!1;const f=h.fontString(n);try{p=(await document.fonts.load(f)).some(g=>!WRt(g))}catch{oe.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}if(!p&&!cFt.has(e.font.family))try{await qRt(e.font)}catch{}}return h}};function lFt(t){return`rgb(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}function Jxe(t){return`rgba(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()},${t[3]})`}const cFt=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),Z1=4096;let B2=class extends Fe{constructor(e){super(e),this.type=an.Texture,this.id=Ld(),this.events=new un,this._glTexture=null,this._atlas=new dFt(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=jt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return FD=0,[Z1-J1-FD,Z1-J1-FD-Qxe]}load(e){if(this._glTexture)return this._glTexture;const i=new fs;return i.wrapMode=Di.CLAMP_TO_EDGE,i.samplingMode=_i.LINEAR_MIPMAP_LINEAR,i.hasMipmap=!0,i.preMultiplyAlpha=!0,i.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new Gr(e,i,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(Ut.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=Zr(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=jt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.width.toString()),this._canvas.setAttribute("height",e.height.toString())}_resizeAtlas(e,i){const{width:r,height:s}=this._atlas;r===e&&s===i||(this._atlas.width=e,this._atlas.height=i,this._glTexture?.resize(e,i),this._glTexture?.updateData(0,0,0,r,s,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(n=>{this._stageObjects.get(n.textRenderer.key)?.forEach(a=>xZ(a,n))}),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,i,r,s){const n=this._atlas;if(n.width<r||n.height<s)return!1;let o=n.cursors.get(s);if(!o){if(n.height<n.nextY+s)return!1;o=[new Kxe(n.nextY)],n.cursors.set(s,o),n.nextY+=s}let a=o.find(l=>n.width>=l.x+r);if(a==null){if(n.height<n.nextY+s)return!1;a=new Kxe(n.nextY),n.nextY+=s,o.push(a)}return e.setNewPosition(a),this._elements.set(i,e),this._elementsToRender.set(i,e),a.x+=r,!0}_ensureStageObjects(e){const i=this._stageObjects.get(e);if(i)return i;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,i){this._ensureStageObjects(e).add(i)}_removeStageObject(e,i){this._stageObjects.get(e)?.delete(i)&&(i.geometries[0].setAttributeData(O.SIZE,[0,0]),i.geometryVertexAttributeUpdated(i.geometries[0],O.SIZE),this._elementsToRender.delete(e))}_processAddition(e){const i=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(i,e);const r=this._atlas,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+J1,a=n+J1+Qxe;if(!this._addAtlasElement(e,i,o,a)){if(this._canRepack)this._reset();else if(r.width<o){const l=Math.min(Fw(Math.max(o,1.5*r.width)),Z1);this._resizeAtlas(l,r.height)}else{const l=r.nextY+a,c=Math.min(Fw(Math.max(l,1.5*r.height)),Z1);if(c>r.height)this._resizeAtlas(r.width,c);else if(r.width<Z1){const u=Math.min(Fw(1.5*r.width),Z1);this._resizeAtlas(u,r.height)}}this._elements.set(i,e)}}_renderElement(e){const i=e.commitNewPosition(),r=e.textRenderer;this._ctx.clearRect(i[0]-J1,i[1]-J1,r.renderedWidth+2*J1,r.renderedHeight+2*J1),r.render(this._ctx,i[0],i[1]),this._stageObjects.get(r.key)?.forEach(n=>xZ(n,e))}get running(){return this.updating}runTask(e){if(this._glTexture==null)return Wa;for(;this._needsRepack&&(this._canRepack||this._atlas.height<Z1&&this._atlas.height<Z1);){this._canRepack=this._needsRepack=!1;const i=this._elements;this._elements=new Map,i.forEach(r=>this._processAddition(r)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[i,r]of this._elementsToRender){if(e.done)break;this._renderElement(r),this._elementsToRender.delete(i),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addTextTexture(e,i){const r=e.key;this._addStageObject(r,i);let s=this._elements.get(r);s==null&&(s=new hFt(this._atlas,e),this._processAddition(s),this.setDirty()),uFt(i,s),xZ(i,s)}removeTextTexture(e,i){const r=e.key;if(!this._elements.get(r))return;this._removeStageObject(r,i);const s=this._stageObjects.get(r);s&&s.size!==0||this._elements.delete(r),s?.size===0&&this._stageObjects.delete(r),this._canRepack=!0}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};function uFt(t,e){t.geometries[0].setAttributeData(O.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],O.SIZE)}function xZ(t,e){t.geometries[0].setAttributeData(O.UV0,e.uv),t.geometryVertexAttributeUpdated(t.geometries[0],O.UV0,!0)}d([m({constructOnly:!0})],B2.prototype,"view",void 0),d([m({type:Boolean})],B2.prototype,"updating",void 0),B2=d([N("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],B2);const J1=2,Qxe=2;let hFt=class{constructor(e,i){this._atlas=e,this.textRenderer=i,this._uv=pi(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return Ud;const{renderedWidth:e,renderedHeight:i}=this.textRenderer;return Ds(this._uv,this._xOffset/this._atlas.width,(this._yOffset+i)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},dFt=class{constructor(e,i){this.width=e,this.height=i,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=FD}},Kxe=class{constructor(e){this.y=e,this.x=FD}},FD=0,pFt=class{constructor(e,i,r){this._renderer=new Zze(e,i,r,B2.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=X8(fFt,this._renderer.renderedWidth,this._renderer.renderedHeight),i=e.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new xx(e,{wrap:{s:Di.CLAMP_TO_EDGE,t:Di.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const fFt={canvas:null},mFt=Be(0,0,1);let gFt=class extends j0{constructor(e,i,r,s){super(e,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=i7(this.symbolLayer.size);if(e)throw new j("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await uGe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const i=e.graphic,r=hE(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(s==null||s==="")return null;const n=Aue(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(n!=null&&!YLe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:o}=this.symbolLayer,a=new lGe(n);c$t(o,a.screenOffset);const l=new cGe(a,this.symbolLayer.horizontalAlignment,l$t(o));return this._createAs3DShape(i,r,s,l)}createLabel(e,i,r,s,n){const o=e.graphic,a=hE(o.geometry);if(a==null)return this.logger.warn(`unsupported geometry type for label: ${o.geometry.type}`),null;const l=i.text;return!l||/^\s+$/.test(l)?null:this._createAs3DShape(o,a,l,i,r,s,n)}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,i){return eSe(e,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),cn.UPDATE}slicePlaneEnabledChanged(e,i){return eSe(e,i,r=>{for(const s of r.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,i){const r=i.elevationContext;this.setGraphicElevationContext(e,r,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=mf(r.mode)||r.mode==="absolute-height"}updateGeometry(e,i){if(this.draped||!this._validateGeometry(i))return!1;const{elevationContext:r,stageObject:s}=e;if(r.mode!==this.getGeometryElevationMode(i))return!1;const n=hE(i);if(!n)return!1;const o=a5e(s,this._context,n,r);if(o==null)return!1;const a=cde(this._context,n);return s.geometries[0].localOrigin===a&&(e.alignedSampledElevation=o,ZE(e,n,this._context.elevationProvider),!0)}_defaultElevationInfoNoZ(){return _Ft}_createAs3DShape(e,i,r,s,n=null,o=null,a=()=>s.placement.elevationOffset){const l=this.setGraphicElevationContext(e,new E8,s.placement.elevationOffset),c=e.geometry?.type==="polyline",u=e.uid;let h=null,p=null;if(o==null){const B=Qze(s.horizontalPlacement);h=new pFt(r,B,this._textRenderParameters);let Y=null;if(this._context.sharedResources.textures!=null){p=this._context.sharedResources.textures.fromData(h.key,()=>h.create()),p.texture.events.on("unloaded",()=>Y=yi(Y));const W=this._context.stage.renderView.textures.acquire(p.texture.id);if(W==null||Lh(W))return p.release(),null;Y=W}}const f=yFt(h,s),g={occlusionTest:!ae("enable-feature:non-occluded-hud"),screenOffset:s.placement.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.placement.centerOffsetUnits,drawInSecondSlot:!0};if(c&&(g.shaderPolygonOffset=1e-4),o?g.textureId=o.id:p&&(g.textureId=p.texture.id),s.placement.verticalOffset!=null){const{screenLength:B,minWorldLength:Y,maxWorldLength:W}=s.placement.verticalOffset;g.verticalOffset={screenLength:Yn(B),minWorldLength:Y||0,maxWorldLength:W??1/0}}const y={screenOffset:g.screenOffset,anchorPosition:f,centerOffsetUnits:g.centerOffsetUnits,verticalOffset:g.verticalOffset,shaderPolygonOffset:g.shaderPolygonOffset};if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:B,screenSizePerspectiveSettingsLabels:Y}=this._context.sharedResources,W=Xze(this._textRenderParameters);g.screenSizePerspective=Y.overrideFontHeight(W.maxHeight),g.screenSizePerspectiveAlignment=B,y.fontHeight=W.maxHeight}g.hasSlicePlane=this._context.slicePlaneEnabled;const v=(B,Y,W)=>{let J=B.get(W);return J==null&&(J=new iI(Y),B.add(W,J)),J},b=n?v(n,g,JSON.stringify(y)):new iI(g),w=s.placement.translation,x=h?Ni(h.displayWidth,h.displayHeight):kE,S=s.placement.centerOffset,E=mFt,C=vt(),R=Fre(b,E,w,null,x,S,C,null),I=lde(this._context,i,R,l,u);if(I==null)return null;const F=(B,Y,W,J,me,L)=>{const k=a()||s.placement.elevationOffset,H=this.setGraphicElevationContext(e,Y,k);return uE(B,H,W,J,me,L)},D=new G0(this,I.object,[R],n==null?[b]:null,p,F,l);D.alignedSampledElevation=I.sampledElevation,D.needsElevationUpdates=mf(l.mode)||l.mode==="absolute-height",D.getScreenSize=(B=vt())=>(B[0]=h?h.displayWidth:s.displaySize[0],B[1]=h?h.displayHeight:s.displaySize[1],B);const z=new gUe(s.placement.elevationOffset,r);return D.metadata=z,ZE(D,i,this._context.elevationProvider),D}};function eSe(t,e,i){t&&t.forEach(r=>{const s=e(r);s!=null&&i(s,r.graphic)})}function yFt(t,e){if(e.verticalPlacement==="baseline"){const r=n$t[e.horizontalPlacement],s=t!=null?t.baselineAnchorY:0;return Ni(r,s)}const i=a$t(e.horizontalPlacement,e.verticalPlacement);return RG[i]}const _Ft={mode:"relative-to-ground",offset:0};function tSe(t){t.fragment.uniforms.add(new Et("texWaveNormal",e=>e.waveNormal),new Et("texWavePerturbation",e=>e.wavePerturbation),new Ki("waveParams",e=>Ds(vFt,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new os("waveDirection",e=>Gi(bFt,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(zCt),t.fragment.code.add(T`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const vFt=pi(),bFt=vt();function wFt(t){const e=new tr,{vertex:i,fragment:r}=e;Pu(i,t),e.include(ec,t),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.UV0,"vec2");const s=new Ki("waterColor",n=>n.color);if(t.output===G.Color&&t.draped)return e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(Ba)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(s),r.code.add(T`void main() {
fragColor = waterColor;
}`),e;switch(t.output===G.Color&&(e.include(qF,t),e.include(YI,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.multipassEnabled&&e.varyings.add("depth","float"),i.uniforms.add(s),i.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(Ba)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===G.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(V0,t),t.output){case G.Color:e.include(Zj),e.include(Hue,{pbrMode:Ot.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(tSe),e.include(Wn,t),e.include(sI,t),e.include(Y5e,t),r.uniforms.add(s,new et("timeElapsed",n=>n.timeElapsed),i.uniforms.get("view"),i.uniforms.get("localOrigin")),yg(r,t),r.include(B0),t.transparencyPassType===mt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),r1(r),L0(r),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?T`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===mt.ColorAlpha?T`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `);break;case G.Normal:e.include(qF,t),e.include(tSe,t),e.include(Wn,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i.uniforms.add(s),i.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(Ba)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new et("timeElapsed",n=>n.timeElapsed)),r.code.add(T`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case G.Highlight:e.include(Wx,t),e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(Ba)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(Wn,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case G.ObjectAndLayerIdColor:e.include(NC,t),e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(Ba)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(Wn,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const xFt=Object.freeze(Object.defineProperty({__proto__:null,build:wFt},Symbol.toStringTag,{value:"Module"}));let dGe=class pGe extends hr{initializeConfiguration(e,i){i.spherical=e.viewingMode===Xe.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new dr(e.rctx,pGe.shader.get().build(this.configuration),Fi)}_setPipelineState(e){const i=this.configuration,r=e===mt.NONE,s=e===mt.FrontFace;return ti({blending:i.output!==G.Normal&&i.output!==G.Highlight&&i.output!==G.ObjectAndLayerIdColor&&i.transparent?r?Ch:c1(e):null,depthTest:i.draped?null:{func:Yx(e)},depthWrite:i.draped?null:r?i.writeDepth?Oh:null:Z9(e),drawBuffers:u1(e),colorWrite:fi,polygonOffset:r||s?null:K9(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};dGe.shader=new ir(xFt,()=>ye(()=>import("./WaterSurface.glsl-b2b0bdde.js"),[],import.meta.url));let Do=class extends $u{constructor(){super(...arguments),this.output=G.Color,this.transparencyPassType=mt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}};d([V({count:G.COUNT})],Do.prototype,"output",void 0),d([V({count:mt.COUNT})],Do.prototype,"transparencyPassType",void 0),d([V()],Do.prototype,"spherical",void 0),d([V()],Do.prototype,"receiveShadows",void 0),d([V()],Do.prototype,"hasSlicePlane",void 0),d([V()],Do.prototype,"transparent",void 0),d([V()],Do.prototype,"enableOffset",void 0),d([V()],Do.prototype,"writeDepth",void 0),d([V()],Do.prototype,"hasScreenSpaceReflections",void 0),d([V()],Do.prototype,"doublePrecisionRequiresObfuscation",void 0),d([V()],Do.prototype,"hasCloudsReflections",void 0),d([V()],Do.prototype,"objectAndLayerIdColorInstanced",void 0),d([V()],Do.prototype,"draped",void 0),d([V()],Do.prototype,"multipassEnabled",void 0),d([V()],Do.prototype,"cullAboveGround",void 0),d([V({constValue:!1})],Do.prototype,"occlusionPass",void 0),d([V({constValue:Ot.Water})],Do.prototype,"pbrMode",void 0),d([V({constValue:!0})],Do.prototype,"useCustomDTRExponentForWater",void 0),d([V({constValue:!0})],Do.prototype,"highStepCount",void 0),d([V({constValue:!1})],Do.prototype,"useFillLights",void 0);let SFt=class extends jx{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const i=e.ssr.lastFrameColor!=null;i!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:i})}_updateCloudsReflectionState(e){const i=e.cloudsFade.data!=null;i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(e){return this._techniques.constructionContext.waterTextures.ensureResources(e)}beginSlot(e){return this._output===G.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniques.constructionContext.waterTextures.passParameters),this.ensureTechnique(dGe,e)}},TFt=class extends Yde{constructor(e){super(e,new fGe),this._configuration=new Do,this._animation=new mke,this.produces=new Map([[Ce.OPAQUE_MATERIAL,i=>Ov(i)&&!this.parameters.transparent||lE(i)],[Ce.TRANSPARENT_MATERIAL,i=>Ov(i)&&this.parameters.transparent||lE(i)],[Ce.DRAPED_MATERIAL,i=>this.parameters.draped&&i===G.Color||lE(i)],[Ce.DRAPED_WATER,i=>i===G.Normal]])}getConfiguration(e,i){return this._configuration.output=e,this._configuration.writeDepth=!0,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<J9,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}update(e){const i=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<EFt;const r=this._animation.advance(e);return this.setParameters({timeElapsed:fle(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&r}createGLMaterial(e){return new SFt(e)}createBufferWriter(){return new QI(ae("enable-feature:objectAndLayerId-rendering")?A3t:C3t)}get test(){}},fGe=class extends $he{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Ni(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=ni(0,0,0,0),this.transparent=!0,this.hasSlicePlane=!1,this.draped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=M(),this.modelTransformation=null}};const EFt=35e3,CFt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},MFt=["polyline","polygon","extent"];let z2=class Xse extends j0{constructor(e,i,r,s){super(e,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,MFt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(this._materials[0])return;const e=new fGe,i=this.symbolLayer.color;i!=null&&(e.color=Ke.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?Xse.headingVectorFromAngle(this.symbolLayer.waveDirection):Ni(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=CFt[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.draped=this.draped,this._materials[0]=new TFt(e),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(this._materials[0]==null)return;const e=this._materials[0].parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],i],transparent:r})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=c4(Xse.elevationModeChangeTypes,r,s);if(n!==cn.UPDATE)return n;const o=mf(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){const s=BF(e.geometry);if(s==null)return null;const n=Mde(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=n.position.length/3,a=qo(2*o);iSe(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new AFt(n,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new Zx({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),u=new G0(this,c,l.outGeometries,null,null,lUe,i);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=mf(i.mode),u}_create3DShapeGeometries(e){const i=e.renderData.polygons,r=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of i){if(this._context.clippingExtent!=null&&(hs(US),Id(US,a),!Gm(US,this._context.clippingExtent)))continue;const c=oI(a,l,3);if(c.length===0)continue;const u=sf(r,2*n,2*s),h=Y1e({material:this._materials[0],indices:c,mapPositions:a,attributeData:{position:o,uv0:u}},e.objectAndLayerIdColor);e.outGeometries.push(h)}}_createAsOverlay(e){const i=BF(e.geometry);if(i==null)return null;this._materials[0].renderPriority=this._renderPriority;const r=FBe(i,this._context.overlaySR),s=r.position.length/3,n=qo(2*s);iSe(n,r.position,s,this._context.overlaySR);const o=new RFt(r,n,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),o.outBoundingBox=hs(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,i.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new b7(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const i=e.uvCoords,r=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){if(hs(US),Id(US,s),!Gm(US,this._context.clippingExtent))continue;HO(e.outBoundingBox,US);const l=oI(s,n,3);if(l.length===0)continue;const c=sf(i,2*o,2*a),u=Y1e({material:this._materials[0],indices:l,attributeData:{position:s,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new cI(u,e))}}static headingVectorFromAngle(e){const i=vt(),r=Sq(e);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};function iSe(t,e,i,r){const s=Xc(r);Hd(Q1);for(let a=0;a<i;a++)Gi(rSe,e[3*a],e[3*a+1]),Qle(Q1,rSe);UE(Q1,Q1,s);const n=Q1[0]%z2.unitSizeOfTexture,o=Q1[1]%z2.unitSizeOfTexture;yB[0]=Q1[0]-n,yB[1]=Q1[1]-o;for(let a=0;a<i;a++)t[2*a]=(e[3*a]*s-yB[0])/z2.unitSizeOfTexture,t[2*a+1]=(e[3*a+1]*s-yB[1])/z2.unitSizeOfTexture}z2.unitSizeOfTexture=100,z2.elevationModeChangeTypes={definedChanged:cn.RECREATE,staysOnTheGround:cn.NONE,onTheGroundChanged:cn.RECREATE};const yB=vt(),Q1=li(),rSe=vt(),US=Oo();let AFt=class extends d7{constructor(e,i,r,s){super(e,r,s),this.uvCoords=i}},RFt=class extends d7{constructor(e,i,r,s){super(e,r,s),this.uvCoords=i}};function PFt(t,e,i,r){const s=IFt[t.type]?.[e.type]||OFt[e.type];return s?new s(t,e,i,r):(oe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const OFt={icon:kse,object:OLt,line:nVe,path:$Dt,fill:oGe,extrude:HAt,text:gFt,water:z2},IFt={"mesh-3d":{fill:D3t}};let $Ft=class extends ade{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const s=this.symbolLayers[r];s!=null&&(s.symbol=e,s.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const o=i.at(n);if(o.enabled===!1)continue;_B.renderPriority=1-(1+n)/r,_B.renderPriorityStep=1/r,_B.ignoreDrivers=o.ignoreDrivers;const a=PFt(this.symbol,o,this._context,_B),l=xk(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await gq(this.symbolLayers,async(n,o)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),zt(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return i!=null?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e?.queryForSnapping)}createGraphics3DGraphic(e,i){const r=e.graphic,s=this.symbolLayers.map(o=>o?.createGraphics3DGraphic(e)??null),n=this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null;return new rCt(r,i||this,s,e.layer,n)}get complexity(){return ode(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof G0?l:null};if(n!=null&&!n.globalPropertyChanged(e,i,o))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==wd.LOADED?Dn.RecreateSymbol:this.symbolLayers.reduce((r,s)=>r!==Dn.RecreateSymbol&&s!=null?Math.min(r,s.applyRendererDiff(e,i)):r,Dn.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===wd.FAILED||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[n];u!=null&&a.graphics3DGraphicPatches.forEach(h=>h(u,c))})}})}updateGeometry(e,i){return this._updateGeometryOrTransform(e,(r,s)=>r.updateGeometry(s,i))}updateTransform(e,i,r,s){return this._updateGeometryOrTransform(e,(n,o)=>n.updateTransform(o,i,r,s))}_updateGeometryOrTransform(e,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(s==null)continue;const n=e.layers[r];if(!n||!i(s,n))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(r==null)continue;const s=e.layers[i];s!=null&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,i=0,r=0;return this.symbolLayers.forEach(s=>{s!=null&&(s.loadStatus===wd.LOADING?e++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:e,slow:i,fast:r}}async queryForSnapping(e,i,r,s){const n=this.symbolLayers.filter(Rx).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,i,r,s)),o=await Promise.all(n);return zt(s),o.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)e?.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const _B=new sCt;let NFt=class extends ade{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:i5e}globalPropertyChanged(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,i):Dn.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,i)}updateTransform(e,i,r,s){return this.graphics3DSymbol?.updateTransform(e,i,r,s)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function Zde(t){return t instanceof NFt?t.graphics3DSymbol:t instanceof $Ft?t:null}const WF=()=>oe.getLogger("esri.views.3d.layers.graphics.labelPlacement");let LFt=class{constructor(e,i,r,s=null){this.graphics3DGraphic=e,this.labelSymbol=i,this.labelClass=r,this.disablePlacement=s}};function sSe(t){const e=jFt(t);if(e==null)return null;const i=DFt(t,e);if(i==null)return null;const r=i.anchor,s=!!e.hasLabelVerticalOffset,n=e.verticalOffset;return kFt(new lGe(n,r,s),i,t)}function DFt(t,e){if(e.anchor)return e;const i=t.labelClass.labelPlacement,r=Wm[i],s=r||iH(t);return i&&!r&&WF().warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),FFt(s,t)}function Jde(t){const e=t.graphics3DGraphic.graphics3DSymbol,i=Zde(e);return i!=null?i.symbol.symbolLayers.at(0):null}function FFt(t,e){const i=e.graphics3DGraphic.graphic.geometry;if(i==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(WF().warnOncePerTick(nSe(t?.placement,e.disablePlacement.logEntityDescription)),iH(e)):t;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return WF().warnOncePerTick(nSe(t?.placement,`'${r}' geometries`)),iH(e);break;case"point":case"mesh":return t}return t}function nSe(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function iH(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:co,anchor:"center"};case"polygon":{const i=Jde(t);return i!=null&&i.type==="extrude"?Wm["above-center"]:{placement:"center-center",normalizedOffset:co,anchor:"center"}}case"point":case"mesh":return Wm["above-center"];default:return}}function kFt(t,e,i){const r=i.graphics3DGraphic.graphic.geometry;if(r==null)return null;switch(r.type){case"point":case"mesh":BFt(t,e,i);break;case"polygon":UFt(t,e,i)}const s=KIt-Z8;return t.screenOffset[0]+=s*e.normalizedOffset[0],t.screenOffset[1]+=s*e.normalizedOffset[1],t}function UFt(t,e,i){const r=Jde(i);if(r!=null)switch(r.type){case"extrude":{const s=i.graphics3DGraphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(kD),Vm(kD,t.translation),t.translation[2]=zx(kD)/2):ue(t.translation,0,0,0),mGe(t,e,s);break}}}function BFt(t,e,i){const r=Jde(i);if(r==null)return;const s=i.graphics3DGraphic.layers[0];switch(s!=null?s.getCenterObjectSpace(t.translation):ue(t.translation,0,0,0),r.type){case"icon":case"text":zFt(t,e,i,s);break;case"object":case"fill":mGe(t,e,s)}}function zFt(t,e,i,r){const{graphics3DGraphic:s}=i,n=r!=null?r.getScreenSize():null;if(s.isDraped||n==null)t.hasLabelVerticalOffset||t.anchor==="center"||(Wm[i.labelClass.labelPlacement]&&WF().warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=VFt(i);t.screenOffset[0]=n[0]/2*(e.normalizedOffset[0]-o[0]);const a=n[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function VFt(t,e=HFt){const{graphics3DGraphic:i}=t,r=i.layers[0],s=r?.stageObject.geometries[0].material??null;if(s&&s instanceof iI){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function mGe(t,e,i){const r=i!=null?i.getBoundingBoxObjectSpace(kD):kD,s=Be(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=De(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function GFt(t){return t==="above-center"}function jFt(t){const e=t.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=t,s=Zde(r.graphics3DSymbol),n=s?.symbol.type==="point-3d"?s.symbol:null,o=Wm[e]||iH(t);return n!=null&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:n.verticalOffset.clone(),anchor:null,normalizedOffset:null}:!i||!i.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&GFt(o.placement)?{placement:"above-center",verticalOffset:i.verticalOffset.clone(),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(WF().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}const Wm={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},oSe={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in oSe){const e=oSe[t],i=Wm[t];e.forEach(r=>{Wm[r]=i})}Object.freeze&&(Object.freeze(Wm),Object.keys(Wm).forEach(t=>{Object.freeze(Wm[t]),Object.freeze(Wm[t]?.normalizedOffset)}));const HFt=[0,0],kD=Oo();let aSe=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,i){this._materials.set(e,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}},lSe=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.addedToTextureAtlas=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},qFt=class{constructor(e,i,r,s,n){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},WFt=class{constructor(e,i,r,s,n,o,a,l){this.layer=i,this.graphics3DCore=r,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new rBe(e,{pickable:!0,disableOctree:!0},i.uid)}destroy(){this.stageLayer.destroy()}},GT=class extends Fe{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([_e(()=>this.view.state?.camera,()=>this.setDirty()),_e(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(Ut.LABELER,this)]),this._textTextureAtlas=new B2({view:this.view}),this._hudMaterialCollection=new aSe(this.view._stage),this._calloutMaterialCollection=new aSe(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=jt(this._textTextureAtlas),this._hudMaterialCollection=jt(this._hudMaterialCollection),this._calloutMaterialCollection=jt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),Uf.graphic=null,Uf.renderingInfo=null,Uf.layer=null}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const s=new lSe(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s),i.setVisibilityFlag(fa.LABEL,yl.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(fa.LABEL,yl.USER,!1),this.setLabelGraphicVisibility(i,!1),i.clearLabelGraphics(),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r&&(this._textTextureAtlas.addTextTexture(r,i.stageObject),e.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r!=null&&(this._textTextureAtlas.removeTextTexture(r,i.stageObject),e.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),Wa}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active)if(SZ(i))this._dirty=!0;else if(TZ(i.labelClassContexts)){if(i.labelClassContexts===null){this._deactivateLabelingContext(i);continue}this._createLabelClassContext(i),this._dirty=!0}else Pd(i.labelsToInitialize,(r,s)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(s,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(i.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0);this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const i=e.labelClassAbortController?.signal;e.layer.when&&await e.layer.when(),zt(i),e.scaleVisibility?.updateScaleRangeActive();const r=e.graphics3DCore,s=r.layer,n=s.labelingInfo?.filter(o=>!!o.symbol);!n||n.length===0||(await gq(n,async(o,a)=>{const l=o.symbol,c=Zde(r.getOrCreateGraphics3DSymbol(l));if(c==null)return void oe.getLogger(this).error("Failed to create Graphics3DSymbol for label");await c.load(),zt(i);let u=null;Aue(l)&&l.hasVisibleCallout()&&(u=gEt(l,r.symbolCreationContext),await u.load(),zt(i));const h=await jd(eTt(o,e.layer.fieldsIndex,this.view.spatialReference));if(zt(i),h.ok===!0){const p=await this._createTextRenderParameters(c.symbol);zt(i),e.labelClassContexts[a]=new qFt(o,c,u,p,h.value)}else oe.getLogger(this).error(`Label expression failed to evaluate: ${h.error}`)}),zt(i))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(En(i))throw i;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.at(0);return i?.type!=="text"?null:uGe.fromSymbol(i,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,qc(i),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,s,n,o){const a=new cGe(r,Xwe(r.anchor),o$t(r.anchor),e.text,Ni(e.displayWidth,e.displayHeight));return Uf.graphic=i,Uf.renderingInfo=null,Uf.layer=s,n.createLabel(Uf,a,this._hudMaterialCollection,this._textTextureAtlas,()=>{const l=sSe(o);return l?l.elevationOffset:null})}_createLineCalloutGraphic(e,i,r,s,n){Uf.graphic=e,Uf.layer=n;const o=s.screenOffset[0];return Uf.renderingInfo=new fEt(null,i,s.translation,s.centerOffset,o,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(Uf)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,s=r.labelClassContexts;if(TZ(s)||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let n=!1;const o=i.graphic,a=r.layer,l=vB(r.layer);for(let c=0;c<s.length;c++){const u=e.textRenderers[c],h=e.textLabelPlacements[c];if(u==null||h==null)continue;const p=s[c],f=p.graphics3DSymbol,g=f.symbol&&f.symbol.type==="label-3d"?f.symbol:null,y=f.symbolLayers[0];if(!y)continue;y.setElevationInfoOverride(r.elevationInfoOverride);const v=new LFt(i,g,p.labelClass),b=this._createTextSymbolGraphic(u,o,h,a,y,v);if(b==null)return!1;b._labelClass=p.labelClass,b._labelIndex=c,i.addLabelGraphic(b,r.stageLayer),i.deconflictionPriority=p.textRenderParameters?.definition.size??0,i.setVisibilityFlag(fa.LABEL,yl.USER,l),i.setVisibilityFlag(fa.LABEL,yl.SCALE_RANGE,!0),i.setVisibilityFlag(fa.LABEL,yl.DECONFLICTION,!1),n=!0;const w=p.graphics3DCalloutSymbolLayer;if(w&&h.hasLabelVerticalOffset){w.setElevationInfoOverride(r.elevationInfoOverride);const x=this._createLineCalloutGraphic(o,g,w,h,a);x!=null&&(p.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(x,r.stageLayer))}break}return n&&r.scaleVisibility?.updateGraphicLabelScaleVisibility(i),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;i[r._labelIndex].graphics3DSymbol.symbolLayers[0]?.onRemoveGraphic(r)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(TZ(r))return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const o=r[n];if(e.textRenderers[n]=null,e.textLabelPlacements[n]=null,o?.textRenderParameters==null)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const b=a.needsHydrationToEvaluate()?DSt(s,i.layer):s;l=a.evaluate(b)}catch{l=null}else l=a.evaluate(s);if(l==null||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,u=c.symbol?.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const h=e.graphics3DGraphic,p=o.labelClass,f=i.disablePlacement,g=sSe({graphics3DGraphic:h,labelSymbol:u,labelClass:p,disablePlacement:f});if(g==null)continue;const y=Xwe(g.anchor),v=Qze(y);e.textRenderers[n]=new Zze(l,v,o.textRenderParameters,B2.maxSize),e.textLabelPlacements[n]=g}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const s=new lSe(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s)}this.setDirty(),this.deconflictor.setDirty()}_updateGraphicGeometry(e,i){const r=i.graphic.uid,s=this._labels.get(r);if(!s)return!0;for(const n of s.graphics3DGraphic.labelLayers)if(n._labelClass!=null&&!e.labelClassContexts[n._labelIndex].graphics3DSymbol.symbolLayers[0].updateGeometry(n,i.graphic.geometry))return!1;return this.setDirty(),this.deconflictor.setDirty(),!0}_removeGraphic(e,i){const r=i.graphic.uid,s=this._labels.get(r);e.graphics.delete(r),s&&(this._destroyGraphic(s,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.delete(i),e.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const s=e.graphics.get(r);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){const s=new Map;i.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),r.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const i=vB(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const s=this._labels.get(r);s&&(this._destroyGraphic(s,r),s.visible=!1,e.labelsToInitialize.set(r,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const s=r?.emptySymbolLabelSupported||!1,n=r?.elevationInfoOverride||null,o=r?.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new WFt(this.view._stage,a,e,i,s,n,o,vB(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),updateGraphicGeometry:c=>this._updateGraphicGeometry(l,c),layerLabelsEnabled:()=>vB(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(s=>this._removeGraphic(i,s)),i.destroy(),this.setDirty()}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,s=this._labels.get(r);s&&s.visible!==i&&(i&&!s.addedToTextureAtlas?(this._addLabelTextureToAtlas(s),s.textInitialized||s.labelingContext.labelsToInitialize.set(r,s)):!i&&s.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(s),s.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(e=>SZ(e))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(SZ(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){}};function SZ(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function TZ(t){return!t||t.length===0}function vB(t){return t.labelsVisible===!0&&!!t.labelingInfo?.some(e=>!!e.symbol)}d([m({constructOnly:!0})],GT.prototype,"view",void 0),d([m({constructOnly:!0})],GT.prototype,"deconflictor",void 0),d([m()],GT.prototype,"_textTextureAtlas",void 0),d([m({type:Boolean,readOnly:!0})],GT.prototype,"updating",null),GT=d([N("esri.views.3d.layers.graphics.Labeler")],GT);const Uf=new mEt(null,null,null);let SL=class lR{constructor(e,i,r,s=null){this.lij=[0,0,0],this.extent=li(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Tu.VISIBLE_ON_SURFACE,screenRect:li(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,i,r,s)}acquire(e,i,r,s){this.tilingScheme=s,this.id=lR.id(e,i,r),this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,s.getExtent(e,i,r,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(i,r,s,this.tilingScheme),e[1].acquire(i,r+1,s,this.tilingScheme),e[2].acquire(i,r,s+1,this.tilingScheme),e[3].acquire(i,r+1,s+1,this.tilingScheme),e):[new lR(i,r,s,this.tilingScheme),new lR(i,r+1,s,this.tilingScheme),new lR(i,r,s+1,this.tilingScheme),new lR(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,zv(e.measures.screenRect,this.measures.screenRect)}static id(e,i,r){return`${e}/${i}/${r}`}};var Tu;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Tu||(Tu={}));function YFt(t,e,i,r,s,n,o=1){const a=rx(e,s,Hq);if(a==null)return!1;if(a===rn){if(t===r&&i===n)return!0;const c=i+o;for(let u=i,h=n;u<c;++u,++h)ge(r[h],t[u]);return!0}const l=i+o;for(let c=i,u=n;c<l;++c,++u)a(t[c],0,r[u],0);return!0}const gGe=.5*Math.PI,XFt=gGe/Math.PI*180;let ZFt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:M(),direction:M()};for(let i=0;i<4;i++)this._extent[i]={origin:M(),direction:M(),cap:{next:null,direction:M()}},this._planes[i]=mr();this._planes[zr.NEAR]=mr(),this._planes[zr.FAR]=mr(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,i,r,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,i,r),Te(this._center.origin,n[0].origin,n[2].origin),ce(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||ce(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,Kv(a.cap.direction,a.origin,l.origin),wF(a.direction,a.cap.direction,a.origin,this._planes[o]),s||ce(a.direction,a.direction,-1)}wF(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[zr.NEAR]),s?qee(this._planes[zr.NEAR],this._planes[zr.FAR]):(Kq(this._planes[zr.FAR],this._planes[zr.NEAR]),qee(this._planes[zr.NEAR],this._planes[zr.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=i,this._minGlobalAltitude=.9*$r(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,i,r=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Xe.Global){const n=this._maxSpanSpatialReference.isGeographic?XFt:gGe*i;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(r||!e.intersectsRay(Yd(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!r&&e.intersectsRay(Yd(o.origin,o.direction))||e.intersectsLineSegment(nE(o.origin,o.cap.next,QFt),o.cap.direction))return!0}const s=r?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(Zvt(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,i,r){Kle(e,Bf),Bf[2]=r,Bd(i,Bf,EZ,this._renderCoordsHelper.spatialReference),Ao(cSe,EZ),hs(Gu);for(const{x0:n,x1:o,y0:a,y1:l}of JFt)for(let c=0;c<5;c++){const u=c/4;Bf[0]=Wt(e[n],e[o],u),Bf[1]=Wt(e[a],e[l],u),Bf[2]=r,wa(Bf,i,Bf,this._renderCoordsHelper.spatialReference),nt(Bf,Bf,cSe),pg(Gu,Bf)}ue(this._extent[0].origin,Gu[0],Gu[1],Gu[2]),ue(this._extent[1].origin,Gu[3],Gu[1],Gu[2]),ue(this._extent[2].origin,Gu[3],Gu[4],Gu[2]),ue(this._extent[3].origin,Gu[0],Gu[4],Gu[2]);for(let n=0;n<4;++n)nt(this._extent[n].origin,this._extent[n].origin,EZ)}_toRenderBoundingExtentLocal(e,i,r){Zq(e,i,c_,this._renderCoordsHelper.spatialReference),ue(this._extent[0].origin,c_[0],c_[1],r),ue(this._extent[1].origin,c_[2],c_[1],r),ue(this._extent[2].origin,c_[2],c_[3],r),ue(this._extent[3].origin,c_[0],c_[3],r)}_toRenderBoundingExtent(e,i,r){switch(this._renderCoordsHelper.viewingMode){case Xe.Global:this._toRenderBoundingExtentGlobal(e,i,r);break;case Xe.Local:this._toRenderBoundingExtentLocal(e,i,r);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(Wr(e.planes[zr.NEAR],this._center.origin)<0&&xe(this._center.direction,e.direction)<0)return!0;for(let i=0;i<4;i++){const r=this._extent[i];if(Wr(e.planes[zr.NEAR],r.origin)<0&&xe(r.direction,e.direction)<0)return!0}return!1}};const JFt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Bf=M(),EZ=Ne(),cSe=Ne(),Gu=Oo(),c_=li(),QFt=Eg();let KFt=class{constructor(e,i){this._renderCoordsHelper=e,this._getIsGroundOpaque=i,this._surfaceElevation=0,this._isGroundOpaque=!1,this._cache=new Map,this._frustumBoundingSphereCenter=M(),this._frustumBoundingSphereRadius=0,this._frustum=new Sw(e),this._extendedFrustum=new Sw(e),this._intersector=new ZFt({renderCoordsHelper:e}),this._renderSR=e.spatialReference;const r=Xd(this._renderSR);this._renderSREllipsoidRadius=$r(r).radius,this._renderCoordsHelper=e}begin(e,i){this._surfaceElevation=i,this._aboveGround=e.aboveGround,this._isGroundOpaque=this._getIsGroundOpaque(),this._frustum.update(e),fSe(this._frustum),this._updateExtendedFrustum(e),this._updateFrustumBoundingSphere()}end(){this._cache.clear()}calculate(e){const i=this._renderCoordsHelper.viewingMode===Xe.Global&&e.lij[0]>=ekt&&e.lij[0]<tkt,r=this._getOrCalculateSingleTileVisibility(e,!i);return r!==Tu.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(e):r}_calculateAggregatedChildrenVisibility(e){let i=Tu.INVISIBLE;const r=this._cache.get(e.id);if(r!=null)return r;const s=pSe.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==Tu.INVISIBLE&&(i=o,o===Tu.VISIBLE_ON_SURFACE))break}return pSe.release(s),this._cache.set(e.id,i),i}_getOrCalculateSingleTileVisibility(e,i){const r=this._cache.get(e.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(e);return i&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Xe.Global&&e.lij[0]<ikt?this._calculateSingleTileVisibilitySided(e,!1)===Tu.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_isTileVisibleInFrustum(e){return this._renderCoordsHelper.viewingMode===Xe.Local?this._isTileVisibleInFrustumLocal(e):this._isTileVisibleInFrustumGlobal(e)}_updateFrustumBoundingSphere(){const e=this._frustum,i=e.origin,r=fkt;Se(r,e.direction);const s=e.points,n=mkt;Vi(n,s[4],i);const o=.5*xe(n,n)/xe(r,n),a=this._frustumBoundingSphereCenter;ao(a,i,r,o);const l=1+o;this._frustumBoundingSphereRadius=l}_isTileVisibleInFrustumLocal(e){const i=e.tilingScheme.spatialReference,r=e.extent,s=this._renderSR,n=lkt;if(n[0]=r[0],n[1]=r[1],n[2]=0,n[3]=r[2],n[4]=r[3],n[5]=0,!Ts(n,i,0,n,s,0,2))return!1;const o=gSe;ue(o[0],n[0],n[1],0),ue(o[1],n[3],n[1],0),ue(o[2],n[3],n[4],0),ue(o[3],n[0],n[4],0);const a=ySe;ue(a,.5*(n[0]+n[3]),.5*(n[1]+n[4]),.5*(n[2]+n[5]));const l=ckt;ue(l,0,0,1);const c=.5*Rw(o[0],o[2]),u=this._frustum,h=this._frustumBoundingSphereRadius,p=this._frustumBoundingSphereCenter,f=ykt;Vi(f,p,a);const g=xe(l,f),y=gkt;if(ao(y,a,l,g),Rw(y,p)>c+h)return!1;const v=akt,b=this._isGroundOpaque&&this._aboveGround,w=this._isGroundOpaque&&!this._aboveGround,x=Math.min(w?v3:1/0,g+h),S=Math.max(b?-v3:-1/0,g-h);for(let E=0;E<4;++E)ao(v[E],o[E],l,x),ao(v[E+4],o[E],l,S);return!Zse(u.planes,v,8)}_isTileVisibleInFrustumGlobal(e){const i=e.tilingScheme.spatialReference,r=e.extent,s=this._isGroundOpaque&&this._aboveGround,n=this._isGroundOpaque&&!this._aboveGround;if(e.lij[0]<yGe)return!0;const o=gSe,a=.5*(r[0]+r[2]);if(ue(o[0],r[0],r[1],0),ue(o[1],r[2],r[1],0),ue(o[2],r[2],r[3],0),ue(o[3],r[0],r[3],0),ue(o[4],a,r[1],0),ue(o[5],a,r[3],0),!YFt(o,i,0,o,this._renderSR,0,6))return!1;const l=o[0][2]>0,c=o[3][2]<0,u=l||c,h=this._renderSREllipsoidRadius;if(u){const K=Be(0,0,1),re=ukt;Lb(re,K,o[0]);const be=hkt;if(Lb(be,K,o[1]),l){const Re=_Se,je=o[4],_t=vSe;Lb(_t,je,K),Lb(Re,_t,je);const ht=o[0];yt(ht,re,Re),_3(ht,h);const ut=o[1];yt(ut,be,Re),_3(ut,h)}else if(c){const Re=_Se,je=o[5],_t=vSe;Lb(_t,je,K),Lb(Re,je,_t);const ht=o[3];yt(ht,Re,re),_3(ht,h);const ut=o[2];yt(ut,Re,be),_3(ut,h)}}const p=ySe;{const K=Vi(wkt,o[3],o[0]);Se(K,K);const re=Te(xkt,o[0],o[3]);ce(re,re,.5);const be=-xe(re,K),Re=Te(Skt,o[0],o[1]);ce(Re,Re,.5);const je=Te(Tkt,o[2],o[3]);ce(je,je,.5);const _t=Vi(Ekt,je,Re);Se(_t,_t);const ht=-(be+xe(K,Re))/xe(K,_t);ao(p,Re,_t,ht),_3(p,h)}const f=this._frustumBoundingSphereRadius,g=this._frustumBoundingSphereCenter,y=this._frustum,v=y.planes,b=dkt;Se(b,p);const w=xe(o[0],b)/$c(o[0]),x=y.origin,S=y.points;let E=!1;if(s){{E=!0;const re=Se(M(),x);for(let be=0;be<4;++be){const Re=S[4+be],je=Vi(M(),Re,x);Se(je,je);const _t=yt(M(),re,je);Se(_t,_t);const ht=yt(M(),je,_t);if(Se(ht,ht),xe(x,ht)>h){E=!1;break}}}if(E&&xe(x,b)<h*w-v3)return!1;const K=Se(zkt,y.origin);if(xe(K,b)<0)return!1;{const re=Se(Vkt,y.direction);if(xe(re,b)>Gkt)return!1}}const C=Math.sqrt(1-w*w);if(C>.9)return!0;let R=!1;{const K=xe(b,g),re=$c(g);if(re<=f&&!v.some(je=>Wr(je,CZ)>0)){if(!s)return!0;R=!0}const be=K/re;if(!R&&K<=0&&-K>f)return!1;const Re=f/re;if(Math.sqrt(1-be*be)*Math.sqrt(1-Re*Re)-Re*be>C)return!1}if(!E&&(o.some(K=>y.intersectsPoint(K))||y.intersectsPoint(p)))return!0;const I=_kt;Vi(I,g,CZ);const F=xe(I,b),D=pkt;ce(D,b,F);const z=Rw(D,g),B=i.isWGS84,Y=e.lij,W=B&&Y[2]===2**Y[0]-1,J=B&&Y[2]===0,me=J?Lkt:W?$kt:Okt,L=J?Dkt:W?Nkt:Ikt;if(!R){const K=o,re=Fkt,be=Ckt,Re=Mkt,je=CZ;for(const _t of me){const ht=K[_t];if(mSe(be,K[(_t+1)%4],ht),mSe(Re,je,ht),Lb(re,Re,be),okt(re,S,1))return!1}}let k=null;if(!s&&F<1.01*f){const K=2.5*f;if(z>w*K+f)return!1;const re=bkt,be=K/w;for(let Re=0;Re<4;++Re)ce(re[Re],o[Re],be/h);ue(re[4],0,0,0),k=re}else{const K=(n?h+v3:F+f)/w,re=s?h-v3:(F-f)/w,be=vkt;for(let Re=0;Re<4;++Re){const je=o[Re];ce(be[Re],je,re/h),ce(be[Re+4],je,K/h)}k=be}if(Zse(v,k,k.length))return!1;const H=y.lines,q=Akt,Q=Rkt;for(const K of H){Se(Q,K.direction);for(const re of L){const be=k[re];if(Se(q,be),MZ(Q,q,k,S))return!1;const Re=(re+1)%4;if(s){const je=k[Re];if(Vi(q,je,be),Se(q,q),MZ(Q,q,k,S))return!1}if(n){const je=k[4+re],_t=k[4+Re];if(Vi(q,_t,je),Se(q,q),MZ(Q,q,k,S))return!1}}}return!0}_calculateSingleTileVisibilitySided(e,i){return this._isTileVisibleInFrustum(e)?(this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,i),this._intersector.isVisibleInFrustum(this._frustum,this._renderSREllipsoidRadius,!0)?Tu.VISIBLE_ON_SURFACE:Tu.VISIBLE_WHEN_EXTENDED):Tu.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),fSe(this._extendedFrustum);const i=this._renderCoordsHelper.worldUpAtPosition(e.eye,fd);this._aboveGround||Ha(i,i);const r=Jo(-xe(i,e.viewForward));if(this._hasExtendedFrustum=r>e.fovY/2,!this._hasExtendedFrustum)return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,fd),a){case St.FAR_BOTTOM_LEFT:case St.FAR_TOP_LEFT:case St.NEAR_BOTTOM_LEFT:case St.NEAR_TOP_LEFT:Wee(this._extendedFrustum.planes[zr.LEFT],fd,fd);break;case St.FAR_BOTTOM_RIGHT:case St.FAR_TOP_RIGHT:case St.NEAR_BOTTOM_RIGHT:case St.NEAR_TOP_RIGHT:Wee(this._extendedFrustum.planes[zr.RIGHT],fd,fd)}ce(fd,fd,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(Yd(l,fd),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),Xl(n[St.NEAR_BOTTOM_LEFT],n[St.NEAR_BOTTOM_RIGHT],n[St.NEAR_TOP_RIGHT],hSe),Xl(n[St.NEAR_BOTTOM_RIGHT],n[St.NEAR_TOP_RIGHT],n[St.NEAR_TOP_LEFT],dSe),xe(hSe,dSe)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[St.NEAR_BOTTOM_LEFT],o[St.NEAR_BOTTOM_RIGHT]]=[o[St.NEAR_BOTTOM_RIGHT],o[St.NEAR_BOTTOM_LEFT]]:[o[St.NEAR_TOP_LEFT],o[St.NEAR_TOP_RIGHT]]=[o[St.NEAR_TOP_RIGHT],o[St.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-uSe;return{zWithMargin:e,pointIndices:Sw.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+uSe;return{zWithMargin:e,pointIndices:Sw.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<e}}};const ekt=2,tkt=6,ikt=12,rkt=.95,uSe=1,fd=M(),hSe=mr(),dSe=mr(),pSe=new Tl(Array,t=>{t.length!==4&&(t[0]=new SL,t[1]=new SL,t[2]=new SL,t[3]=new SL)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});function fSe(t){const e=Sw.nearFarLineIndices,i=t.mutablePoints;for(const r of e){const[s,n]=r,o=i[s],a=i[n];Me(fd,a,o),ce(fd,fd,rkt),Te(i[n],o,fd)}t.updatePoints(i)}function Lb(t,e,i){return yt(t,e,i),Se(t,t),t}function mSe(t,e,i){return Vi(t,e,i),Se(t,t),t}function _3(t,e){return ce(t,t,e/$c(t)),t}const skt=[zr.LEFT,zr.RIGHT,zr.BOTTOM,zr.TOP,zr.FAR];function nkt(t,e,i){for(let r=0;r<i;++r)if(Wr(t,e[r])<=0)return!1;return!0}function Zse(t,e,i){for(const r of skt)if(nkt(t[r],e,i))return!0;return!1}const yGe=4;function okt(t,e,i){for(const r of e)if(xe(r,t)<i)return!1;return!0}const akt=[M(),M(),M(),M(),M(),M(),M(),M()],lkt=[0,0,0,0,0,0],gSe=[M(),M(),M(),M(),M(),M()],ySe=M(),ckt=M(),_Se=M(),ukt=M(),hkt=M(),vSe=M(),dkt=M(),pkt=M(),fkt=M(),mkt=M(),gkt=M(),ykt=M(),CZ=Be(0,0,0),_kt=M(),vkt=[M(),M(),M(),M(),M(),M(),M(),M()],bkt=[M(),M(),M(),M(),M()],wkt=M(),xkt=M(),Skt=M(),Tkt=M(),Ekt=M(),Ckt=M(),Mkt=M(),Akt=M(),Rkt=M(),Pkt=M(),Okt=[0,1,2,3],Ikt=[0,1,2,3],$kt=[0,1,3],Nkt=[0,1,3],Lkt=[1,2,3],Dkt=[1,2,3],Fkt=M();function kkt(t,e,i){let r=1/0,s=-1/0;for(const n of i){const o=xe(e,n);r=Math.min(r,o),s=Math.max(s,o)}t[0]=r,t[1]=s}function Ukt(t,e,i,r){let s=1/0,n=-1/0;for(const o of r){const a=xe(i,o);if(s=Math.min(s,a),n=Math.max(n,a),s<=e&&n>=t)return!1}return!0}const Bkt=[0,0];function MZ(t,e,i,r){if(i.length===0||r.length===0)return!0;const s=Pkt;Lb(s,t,e);const n=r[0]<i[0],o=n?i:r,a=Bkt;return kkt(a,s,n?r:i),Ukt(a[0],a[1],s,o)}const v3=430,zkt=M(),Vkt=M(),Gkt=Math.cos(.25*Math.PI);let jkt=class{constructor(e){this._camera=new Kr,this._focusOnMap=[0,0],this._screenRect=li(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new KFt(e.renderCoordsHelper,e.getIsGroundOpaque)}begin(e,i,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,Oq(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=Jtt(e.extent,this._focusOnMap),e.measures.visibility!==Tu.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const i=Hkt,r=1<<i,s=e.measures.screenRect;Hd(s);let n=0;const o=e.lij,a=o[0],l=a+i,c=o[1]<<i,u=o[2]<<i,h=this._tileSizeWithBias(e),p=h*h,f=this._camera,{frustum:g,viewport:y}=f;if(this._renderCoordsHelper.viewingMode===Xe.Local||a>yGe){const v=bSe;this._tilingScheme.getExtent(o[0],o[1],o[2],v);const b=BM,w=Ykt,x=Hd();for(let C=0;C<4;++C)this._toRenderCoords(v,SSe[C][0],SSe[C][1],w[C]),f.projectToScreen(w[C],b[C]),Qle(x,b[C]);const S=Zse(g,w,4),E=x[0]>y[2]||x[1]>y[3]||x[2]<y[0]||x[3]<y[1];if(S||E)return void(e.measures.shouldSplit=!1)}for(let v=0;v<r;v++)for(let b=0;b<r;b++)if(n+=this._computeScreenArea(l,c+v,u+b,s),n>p)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Tu.VISIBLE_WHEN_EXTENDED?this._tileSize*qkt:this._tileSize}_computeScreenArea(e,i,r,s){this._tilingScheme.ensureMaxLod(e);const n=bSe;this._tilingScheme.getExtent(e,i,r,n);const o=Wkt;return this._toRenderCoords(n,0,3,o[0]),this._toRenderCoords(n,2,3,o[1]),this._toRenderCoords(n,2,1,o[2]),this._toRenderCoords(n,0,1,o[3]),this._computeTriangleScreenArea([o[0],o[1],o[2]],s)+this._computeTriangleScreenArea([o[2],o[1],o[3]],s)}_computeTriangleScreenArea(e,i){const r=this._camera.frustum[zr.NEAR];let s=0,n=-1,o=-1;for(let a=0;a<3;++a)Wr(r,e[a])>0?(s++,n===-1&&(n=a)):o===-1&&(o=a);if(s===0)return this._computeTriangleScreenAreaInside(e,i);if(s===1){const a=xSe,l=(n+1)%3,c=(n+2)%3,u=n;ge(a[0],e[l]),ge(a[1],e[c]),wB(a[2],e[c],e[u],r);const h=this._computeTriangleScreenAreaInside(a,i);return wB(a[1],e[l],e[u],r),h+this._computeTriangleScreenAreaInside(a,i)}if(s===2){const a=xSe,l=o;ge(a[0],e[l]);const c=(o+1)%3,u=(o+2)%3;return wB(a[1],e[l],e[c],r),wB(a[2],e[l],e[u],r),this._computeTriangleScreenAreaInside(a,i)}return 0}_computeTriangleScreenAreaInside(e,i){for(let r=0;r<3;r++)this._camera.projectToRenderScreen(e[r],wSe),this._camera.renderToScreen(wSe,BM[r]),Iw(i,BM[r],i);return E_t(BM[0],BM[1],BM[2])}_toRenderCoords(e,i,r,s){return bB[0]=e[i],bB[1]=e[r],bB[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(bB,this._tilingScheme.spatialReference,s),s}};const Hkt=2,qkt=5,BM=[Hs(),Hs(),Hs(),Hs()],bSe=li(),bB=M(),Wkt=[M(),M(),M(),M()],wSe=_l(),xSe=[M(),M(),M()];function wB(t,e,i,r){const s=Wr(r,e),n=Wr(r,i),o=Math.abs(n-s);ce(t,e,Math.abs(n)/o),ao(t,t,i,Math.abs(s)/o)}const Ykt=[M(),M(),M(),M()],SSe=[[0,3],[2,3],[2,1],[0,1]];function Jwi(t,e,i){if(t==null||i==null)return!1;let r=!0;return wo[0]=t.xmin!=null?t.xmin:0,wo[1]=t.ymin!=null?t.ymin:0,wo[2]=t.zmin!=null?t.zmin:0,r=r&&Ts(wo,t.spatialReference,0,e,i,0,1),wo[0]=t.xmax!=null?t.xmax:0,wo[1]=t.ymax!=null?t.ymax:0,wo[2]=t.zmax!=null?t.zmax:0,r=r&&Ts(wo,t.spatialReference,0,e,i,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function _Ge(t,e,i){if(t==null||i==null)return!1;let r=!0;return wo[0]=t.xmin!=null?t.xmin:0,wo[1]=t.ymin!=null?t.ymin:0,wo[2]=t.zmin!=null?t.zmin:0,r=r&&Ts(wo,t.spatialReference,0,wo,i,0,1),e[0]=wo[0],e[1]=wo[1],wo[0]=t.xmax!=null?t.xmax:0,wo[1]=t.ymax!=null?t.ymax:0,wo[2]=t.zmax!=null?t.zmax:0,r=r&&Ts(wo,t.spatialReference,0,wo,i,0,1),e[2]=wo[0],e[3]=wo[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const wo=M();let Da=class extends Fe{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void oe.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const i=this._get("filterExtent");if(i===e||i!=null&&e&&i.equals(e))return;const r=e!=null?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=li();return _Ge(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new ct,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new ci}initialize(){this.addHandles([_e(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Mr),_e(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location],()=>this._setDirty(),Sr),_e(()=>this.terrain?.baseOpacity??1,()=>this._setDirty())]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(Ut.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Zr(this._frameWorker)}addClient(){const e=Ld();return this._clients.add(e),this._clients.size===1&&this._setDirty(),er(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(_h))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=Ut.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=Ut.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new jkt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,getIsGroundOpaque:()=>(this.terrain?.baseOpacity??1)===1}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(i=>new SL(i[0],i[1],i[2],e))}_purgeHorizonTiles(e){if(e.sort((i,r)=>{const s=i.measures.screenRect,n=r.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),!(e.length>Zkt))return e.toArray();Hd(xB);for(let i=0;i<e.length;i++)if(Iw(xB,e.data[i].measures.screenRect,xB),Au(xB)>Xkt)return e.data.slice(i,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:i}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!Nq(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==Tu.INVISIBLE&&(r.measures.shouldSplit?(i.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const i=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),r=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(r),this.tiles.addMany(i),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,i)=>e.measures.visibility!==i.measures.visibility?e.measures.visibility===Tu.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-i.measures.distance),this.tiles.forEach((e,i)=>e.loadPriority=i)}};d([m({constructOnly:!0})],Da.prototype,"scheduler",void 0),d([m({constructOnly:!0})],Da.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],Da.prototype,"tilingSchemeOwner",void 0),d([m({constructOnly:!0})],Da.prototype,"cameraOnSurface",void 0),d([m({constructOnly:!0})],Da.prototype,"focus",void 0),d([m({constructOnly:!0})],Da.prototype,"viewState",void 0),d([m({constructOnly:!0})],Da.prototype,"terrain",void 0),d([m()],Da.prototype,"tiles",void 0),d([m()],Da.prototype,"tileSize",void 0),d([m({readOnly:!0})],Da.prototype,"tilingScheme",null),d([m()],Da.prototype,"filterExtent",null),d([m({readOnly:!0})],Da.prototype,"_filterExtentRect",null),d([m({readOnly:!0})],Da.prototype,"_rootTileIds",null),d([m({value:!1})],Da.prototype,"suspended",null),d([m({readOnly:!0})],Da.prototype,"updating",null),Da=d([N("esri.views.3d.layers.support.FeatureTileTree3D")],Da);const xB=li(),Xkt=10,Zkt=50;let tn=class extends Fe{constructor(){super(...arguments),this._propertiesPool=new jv({camera:Kr},this),this._lastSeenCameraProjectionValues=new Kr,this.mode=zi.ANIMATING,this._cssCamera=new Kr,this._camera=new Kr,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new un,this.viewingMode=Xe.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,i){this._set("viewingMode",e),this._set("spatialReference",i),this._set("constraints",new N_({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new jv({camera:Kr},this)}destroy(){this.cameraController=null,this._propertiesPool?.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Xe.Global){const e=$r(this.spatialReference).radius;this.camera=new Kr({eye:Be(4*e,0,0),center:Be(e,0,0),up:Be(0,0,1)})}else this.camera=new Kr({eye:Be(0,0,100),center:Be(0,0,0),up:Be(0,1,0)})}get animation(){return this.cameraController instanceof $F&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:i,width:r,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(i/s),e.width=Math.round(r/s),e}get camera(){return this._camera}set camera(e){e!==hp&&hp.copyFrom(e),hp.computeUp(this.viewingMode),this.events.emit("before-camera-change",hp);const i=this._camera;if(Qkt(this._lastSeenCameraProjectionValues,hp)&&(this._lastSeenCameraProjectionValues.copyFrom(hp),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!i.equals(hp)&&(this._camera=this._propertiesPool.get("camera").copyFrom(hp),this._cameraChanged=!i.almostEquals(hp),this._cameraChanged)){const r=VAe(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===zi.IDLE}get updating(){return this.mode!==zi.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Xe.Global}get isLocal(){return this.viewingMode===Xe.Local}get navigating(){return!!this.cameraController?.isInteractive}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.cameraController?.destroy(),e&&(this.removeHandles(TSe),this.addHandles(Du(()=>e.state===Ns.Finished||e.state===Ns.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),TSe),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Ns.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Ns.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();hp.copyFrom(this._get("camera")),e(hp),this.camera=hp,this._processingUpdates=!1,this._processUpdateQueue()}};d([m()],tn.prototype,"mode",void 0),d([m({readOnly:!0,type:qO})],tn.prototype,"animation",null),d([m({type:Kr})],tn.prototype,"cssCamera",null),d([m()],tn.prototype,"_cssCamera",void 0),d([m({type:Kr})],tn.prototype,"camera",null),d([m()],tn.prototype,"_camera",void 0),d([m({readOnly:!0})],tn.prototype,"pixelRatio",null),d([m()],tn.prototype,"rasterPixelRatio",void 0),d([m()],tn.prototype,"contentPixelRatio",void 0),d([m({readOnly:!0})],tn.prototype,"alignPixelEnabled",null),d([m({readOnly:!0})],tn.prototype,"updating",null),d([m({})],tn.prototype,"_contentCamera",void 0),d([m({type:Kr})],tn.prototype,"contentCamera",null),d([m({readOnly:!0})],tn.prototype,"fixedContentCamera",null),d([m({readOnly:!0})],tn.prototype,"constraints",void 0),d([m({readOnly:!0})],tn.prototype,"events",void 0),d([m({readOnly:!0})],tn.prototype,"isGlobal",null),d([m({readOnly:!0})],tn.prototype,"isLocal",null),d([m({readOnly:!0})],tn.prototype,"viewingMode",void 0),d([m({readOnly:!0})],tn.prototype,"spatialReference",void 0),d([m()],tn.prototype,"navigating",null),d([m()],tn.prototype,"stationary",null),d([m()],tn.prototype,"_cameraChanged",void 0),d([m()],tn.prototype,"cameraController",null),tn=d([N("esri.views.3d.state.ViewState")],tn);const Jkt=tn;function Qkt(t,e){return t.fov!==e.fov||t.fullViewport[0]!==e.fullViewport[0]||t.fullViewport[1]!==e.fullViewport[1]||t.fullViewport[2]!==e.fullViewport[2]||t.fullViewport[3]!==e.fullViewport[3]||t.padding[Si.TOP]!==e.padding[Si.TOP]||t.padding[Si.RIGHT]!==e.padding[Si.RIGHT]||t.padding[Si.BOTTOM]!==e.padding[Si.BOTTOM]||t.padding[Si.LEFT]!==e.padding[Si.LEFT]}const hp=new Kr,TSe="ViewStateHandles";function vGe(t){return t?n4t:o4t}function Kkt(t,e){return e?.mode?e.mode:vGe(t).mode}function e4t(t,e){return e??vGe(t)}function bGe(t,e){return Kkt(t!=null&&t.hasZ,e)}function exi(t,e){return e4t(t!=null&&!!t.hasZ,e)}function txi(t){const e=wGe(t);return bGe(t.geometry,e)}function ixi(t){const e=wGe(t),i=bGe(t.geometry,e),r=e!=null&&i!=="on-the-ground"?SGe(e):0,s=e?.featureExpressionInfo;return{mode:i,offset:r,featureExpressionInfo:s}}function rxi(t){return i4t(t)||t4t(t)}function t4t(t){return t?.featureExpressionInfo?.expression==="0"}function i4t(t){if(!t||t.mode==="on-the-ground")return!1;const e=t?.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!e||e==="0")}function wGe(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}function Qde(t,e){if(!t?.offset)return 0;const{offset:i,unit:r}=t;if(r==="decimal-degrees")return 0;const s=r!=="unknown"&&r?r:"meters",n=QRe(e);return n?ko(i,s,n):0}function sxi(t,e,i){if(!i?.mode)return;const r=t.hasZ?t.z:0,s=Qde(i,t.spatialReference);switch(i.mode){case"absolute-height":return r-s;case"on-the-ground":return 0;case"relative-to-ground":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"ground")??0)+s);case"relative-to-scene":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"scene")??0)+s)}}function nxi(t,e,i,r=null){return xGe(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,i,r)}function oxi(t,e,i,r,s=null){return xGe(t,e[0],e[1],e.length>2?e[2]:0,i,r,s)}function xGe(t,e,i,r,s,n,o=null){if(n==null)return;const a=o!=null?o.mode:"absolute-height";if(a==="on-the-ground")return 0;const{absoluteZ:l}=r4t(e,i,r,s,t,n);return s4t(l,e,i,r,s,t,o,a)}function r4t(t,e,i,r,s,n){const o=Qde(n,r);switch(n.mode){case"absolute-height":return{absoluteZ:i+o,elevation:0};case"on-the-ground":{const a=s.elevationProvider.getElevation(t,e,0,r,"ground")??0;return{absoluteZ:a,elevation:a}}case"relative-to-ground":{const a=s.elevationProvider.getElevation(t,e,i,r,"ground")??0;return{absoluteZ:i+a+o,elevation:a}}case"relative-to-scene":{const a=s.elevationProvider.getElevation(t,e,i,r,"scene")??0;return{absoluteZ:i+a+o,elevation:a}}}}function s4t(t,e,i,r,s,n,o,a){const l=Qde(o,s);switch(a){case"absolute-height":return t-l;case"relative-to-ground":return t-((n.elevationProvider.getElevation(e,i,r,s,"ground")??0)+l);case"relative-to-scene":return t-((n.elevationProvider.getElevation(e,i,r,s,"scene")??0)+l)}}function axi(t,e){if(e==null)return!1;const{mode:i}=e;return i!=null&&(t==="scene"&&i==="relative-to-scene"||t==="ground"&&i!=="absolute-height")}function lxi(t,e,i){return i&&i.mode!==e?`${t} only support ${e} elevation mode`:null}function cxi(t,e,i){return i?.mode===e?`${t} do not support ${e} elevation mode`:null}function uxi(t,e){return e?.featureExpressionInfo!=null&&e.featureExpressionInfo.expression!=="0"?`${t} do not support featureExpressionInfo`:null}function hxi(t,e){e&&t.warn(".elevationInfo=",e)}function SGe(t){return(t?.offset??0)*hUe(t?.unit)}const n4t={mode:"absolute-height",offset:0},o4t={mode:"on-the-ground",offset:null},a4t="OBJECTID";let dxi=class extends Vk{constructor(e,i,r,s){super(i,r),this.point=e,this.createGraphic=s}};function TGe(t){return _f(t)&&t.intersector===bs.PCL&&!!t.target}let fxi=class extends tNe{constructor(e,i,r,s,n){super(e),this.layerUid=e,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=s,this.triangleNr=n}},gxi=class extends Vk{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}},_xi=class extends Vk{constructor(e,i){super(e,null),this.createTiles3DGraphic=i}};function C7(t){return _f(t)&&t.intersector===bs.I3S&&!!t.target}function EGe(t){return _f(t)&&t.intersector===bs.VOXEL&&!!t.target}function l4t(t){return _f(t)&&t.intersector===bs.TILES3D&&!!t.target}function CGe(t,e){return l9(t)||c9(t)?YF(t.target?.object,e):bAt(t)?e.map?.ground:TGe(t)||C7(t)||ABe(t)||EGe(t)?YF(t.target,e):null}function bxi(t,e){const i=Kde(t,e);return i!=null&&i.type==="graphic"?i.graphic:null}function Kde(t,e){if(t==null)return null;if(l9(t)||c9(t))return ESe(t.target?.object,e);if(TGe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(EGe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(l4t(t)){const i=t.target.createTiles3DGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return ABe(t)||qde(t)?ESe(t.target,e):C7(t)?c4t(t.target,e):null}function ESe(t,e){if(t?.graphicUid==null)return null;const i=YF(t,e);if(i==null)return null;if(i===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const r=e.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||t.graphicUid==null?null:"getHit"in r?r.getHit(t.graphicUid):null}function c4t(t,e){const i=YF(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?h4t(r.getGraphicFromIntersectorTarget(t)):null}function u4t(t,e){const i=YF(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function h4t(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function YF(t,e){return t?.layerUid==null?null:e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.allLayers.find(i=>i.uid===t.layerUid)}function wxi(t,e){if(l9(t)||c9(t))return Nw(t.target.object.boundingVolumeWorldSpace.bounds);if(qde(t)){FPe(SB,t.transformation);const i=Math.max(SB[0],SB[1],SB[2]);return t.target.baseBoundingSphere.radius*i}if(C7(t)){const i=u4t(t.target,e);return i?.5*ILe(i):null}return null}function xxi(t){return!l9(t)&&!c9(t)&&(qde(t)?t.target.numLodLevels>1:!!C7(t))}const SB=M();async function d4t(t,e,i,r){const s=i?RGe(t,i):r,n=Hs(e.x,e.y);s.requiresGroundFeedback=!0,s.enableDraped=!0;const o=pf(t.state.viewingMode);o.options.selectionMode=!0,o.options.store=Ya.ALL,t.sceneIntersectionHelper.intersectIntersectorScreen(n,o,s);const a=f4t(t,o.results.all,s.graphics),l=o.results.ground,c=CGe(l,t),u=c!=null&&"type"in c&&aF(c.type)?c:null,h={screenPoint:e,results:a,ground:{mapPoint:nP(t,l),distance:_f(l)?l.distanceInRenderSpace:0,layer:u}};return ts.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=o),h}function p4t(t,e,i,r){const s=i?RGe(t,i):r,n=!(!s.graphics?.include&&!s.graphics?.exclude),o=!(!s.mediaElements?.include&&!s.mediaElements?.exclude),a=$m(e);s.enableDraped=s.include&&!s.include.has(cx)||s.exclude?.has(cx);const l=t.sceneIntersectionHelper,c=pf(t.state.viewingMode);if(c.options.selectionMode=!0,c.options.store=n||o?Ya.ALL:Ya.MIN,c.options.hud=!i?.excludeHud,l.intersectIntersectorScreen(a,c,s),n||o){for(const u of c.results.all){const h=Kde(u,t);if(h==null||n&&(h.type!=="graphic"||MGe(s.graphics,h.graphic))||o&&(h.type!=="media"||AGe(s.mediaElements,h.element)))return nP(t,u)}return null}return nP(t,c.results.min)}function f4t(t,e,i){const r=new Array;let s=null;for(let n=0;n<e.length;n++){const o=e[n],a=CGe(o,t);if(a!=null&&(a===t.map.ground||"type"in a&&aF(a.type)))break;const l=Kde(o,t);if(l==null)continue;if(l.type==="graphic"){if(s==null&&n!==e.length-1&&(s=new Set),s!=null){const h=epe(l.graphic);if(s.has(h))continue;s.add(h)}if(!MGe(i,l.graphic))continue}const c=nP(t,o),u=o.distanceInRenderSpace;if(l.type==="media"){const h=l.element.toSource(c);r.push({...l,mapPoint:c,distance:u,sourcePoint:h})}else r.push({...l,mapPoint:c,distance:u})}return r}function nP(t,e,i){return e.getIntersectionPoint(oP)?(i=Jse(t,oP,i),e.intersector===bs.TERRAIN&&t.basemapTerrain&&(i.z=Wy(t.basemapTerrain,i)??0),i):null}function epe(t){const e=t.sourceLayer,i=t.layer,r=e&&"objectIdField"in e?e:i&&"objectIdField"in i?i:e;if(r){const s=r.objectIdField??a4t,n=t.attributes?.[s];if(n)return`o-${r.id}-${n}`}return`u-${t.uid}`}function MGe(t,e){return AGe(t,epe(e))}function AGe(t,e){return t==null||(t.include==null||t.include.has(e))&&(t.exclude==null||!t.exclude.has(e))}function Jse(t,e,i){let r=t.spatialReference||Je.WGS84;return wa(e,t.renderSpatialReference,oP,r)?e=oP:(r=Je.WGS84,wa(e,t.renderSpatialReference,oP,r)&&(e=oP)),i?(i.x=e[0],i.y=e[1],i.z=e[2],i.spatialReference=r):i=new $t(e,r),i}function RGe(t,e){const i=Qse(t,e.include,uI.INCLUDE),r=Qse(t,e.exclude,uI.EXCLUDE);return{include:i.layerUids,exclude:r.layerUids,graphics:{include:i.graphicUids,exclude:r.graphicUids},mediaElements:{include:i.mediaElements,exclude:r.mediaElements}}}function Qse(t,e,i,r={layerUids:void 0,graphicUids:void 0,mediaElements:void 0}){if(!e)return r;if(e instanceof fg)m4t(r,epe(e)),i===uI.INCLUDE&&(t.graphicsView!=null&&e.layer===t?zM(r,t.graphicsView.processor.layer.id):e.layer&&zM(r,e.layer.uid));else if("layer"in e&&"element"in e)g4t(r,e.element),i===uI.INCLUDE&&zM(r,e.layer.uid);else if(YQ(e))for(const s of e)s===t.graphics&&t.graphicsView!=null?zM(r,t.graphicsView.processor.layer.id):s===t.map.ground?zM(r,cx):Qse(t,s,i,r);else"uid"in e&&zM(r,e.uid);return r}function zM(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function m4t(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function g4t(t,e){t.mediaElements||(t.mediaElements=new Set),t.mediaElements.add(e)}const oP=M();var uI;(function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"})(uI||(uI={}));let y4t=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new ci,this._tolerance=VO,this._tmpRay=jo(),this._tmpRegion=li(),this._validateHUDIntersector=pf(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),CSe(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,CSe(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,s){return i.options.selectionMode=!1,i.options.store=Ya.MIN,this.computeIntersection(e,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,s=.5){return e.getRenderCenter(EB,r,s),EB[0]+=.0466,EB[1]-=.0123,whe(e,EB,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,r)}intersectToolIntersectorScreen(e,i,r){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,r);const s=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||_f(s)&&s.intersector!==bs.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(e,i,r))}setTolerance(e=VO){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===bs.TERRAIN?1:r.type===bs.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===bs.TERRAIN?1:r.type===bs.TERRAIN?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return bhe(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==Xe.Local||e==null||Te(i,e.origin,Se(tt.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,s)}_intersectElevation(e,i,r=0,s=null){if(e==null)return null;const n=this._view,{renderCoordsHelper:o}=n,a=AE(n.spatialReference),l=i!=null?i.mode:"absolute-height",c=SGe(i)/a,u=(l!=="on-the-ground"?c+r:0)*a/o.unitInMeters,{camera:h}=n.state;if(l==="absolute-height"){const S=o?.getAltitude(h.eye),E=xe(Se(b3,e.direction),o.worldUpAtPosition(h.eye,b4t));if(S<u&&E<0||S>=u&&E>0)return null;if(o.intersectInfiniteManifold(e,u,b3)){const C=Jse(n,b3);return C.z??=0,C.z-=c,C}return null}const p=tt.get();h.projectToRenderScreen(e.origin,p);const f=new MSe(null,this._forEachLayer),{slicePlane:g}=n,y=g!=null?a0e(g):null,v=pf(this.viewingMode);v.options.store=Ya.MIN,v.options.verticalOffset=u,v.options.normalRequired=!1;const b=e.origin,w=Te(tt.get(),b,e.direction);v.reset(b,w,h),v.point=p;const x=s?"type"in s&&s.type==="graphics"?S=>S.layerUid!==s.uid:S=>S.graphicUid!==s.uid:null;switch(l){case"relative-to-scene":{const S=E=>(!x||x(E))&&!!E.lastValidElevationBB;v.intersect(f.layers,p,this._tolerance,null,S),this._externalIntersectionHandlers.forAll(E=>{if(E.type===bs.I3S||E.type===bs.TERRAIN||E.type===bs.TILES3D){const C=E.slicePlaneEnabled?y:null;E.intersect(v,C,v.rayBegin,v.rayEnd,p)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(S=>{if(S.isGround){const E=S.slicePlaneEnabled?y:null;S.intersect(v,E,v.rayBegin,v.rayEnd,p)}})}if(v.results.min.getIntersectionPoint(b3)){const S=Jse(n,b3);return S.z=r,S}return null}computeIntersection(e,i,r,s){if(e==null)return;const n=this._view.state.camera,o=tt.get();n.projectToRenderScreen(e.origin,o);const a=new MSe(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const l=e.origin,c=Te(tt.get(),e.origin,e.direction);i.reset(l,c,n),i.intersect(a.layers,o,this._tolerance);const u=this._view.slicePlane,h=u!=null?a0e(u):null;i.intersect(a.sliceableLayers,o,this._tolerance,h);const p=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(y=>{const v=y.layerUid,b=Array.isArray(v),w=b?v:[v];b&&(i.options.filteredLayerUids=[]);let x=!1;for(const S of w)a.filterLayerUid(S)?x=!0:b&&i.options.filteredLayerUids.push(S);if(i.options.isFiltered=!x,y.isGround&&p||!i.options.isFiltered){const S=y.slicePlaneEnabled?h:null;y.intersect(i,S,l,c,o,s)}});const f=tt.get(),g=this._view.basemapTerrain;if(r&&r.enableDraped&&g.spatialReference!=null&&i.results.ground.getIntersectionPoint(f)){const y=g.overlayManager.renderer,v=this._view.renderCoordsHelper.spatialReference,b=tt.get();this._view.renderCoordsHelper.fromRenderCoords(f,b,g.spatialReference),b[2]=this._view.elevationProvider?.getElevation(f[0],f[1],f[2],v,"ground")??0,y.intersect(i,b,i.results.ground,w=>a.filterRenderGeometry(w))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;zv(this._tmpRegion,VK);const r=this._view.state.camera,s=[],n=this._tmpRegion,o=b=>{const w=new v4t(b);r.projectToRenderScreen(b.target.center,w.screenPoint),w.screenPoint[0]=Math.floor(w.screenPoint[0]),w.screenPoint[1]=Math.floor(w.screenPoint[1]),s.push(w),Qle(n,w.screenPoint)};e.sortResults(i.all),i.min.dist!=null&&o(i.min);for(const b of i.all)i.min.target.object!==b.target.object&&i.max.target.object!==b.target.object&&o(b);if(i.max.dist!=null&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-TL),u=Math.max(0,n[1]-TL),h=Math.min(Kl(n)+2*TL,a-c),p=Math.min(Au(n)+2*TL,l-u);if(h<=0||p<=0)return;const f=new Uint8Array(h*p*4);this._view._stage.renderer.readHUDVisibility(c,u,h,p,f);let g=!0;const y=e.results.max.dist==null;let v=0;for(const b of s)for(const w of _4t){const x=4*(Math.min(b.screenPoint[0]+w[0],a)-n[0]+(Math.min(b.screenPoint[1]+w[1],l)-n[1])*h);if(!(x<0||x>=f.length)&&f[x]){g&&(e.results.min.copy(b.result),g=!1),y&&e.results.max.copy(b.result),e.options.store===Ya.ALL&&e.results.all.splice(v++,0,b.result);break}}}};const TL=1,_4t=(()=>{const t=[],e=TL;for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)t.push([r+e,i+e]);return t})();let v4t=class{constructor(e){this.result=e,this.screenPoint=_l()}},TB;function CSe(t){return TB&&TB.viewingMode===t||(TB=pf(t)),TB}let MSe=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e?.include,this.exclude=e?.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:i,exclude:r}=this;return e==null?i==null&&r==null:(i==null||i.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function ASe(t){return typeof t=="object"&&"intersect"in t}const b3=M(),b4t=M(),EB=_l();let Cxi=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,s,n){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,n,r,s)}},w4t=class{constructor(e,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(Ut.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(_h);else for(const i of this._queries)i.result.reject(Yi())}queryElevation(e,i,r,s=0){const n=lo(),o={x:e,y:i,minDemResolution:s,result:n,signal:r};return this._queries.push(o),oo(r,()=>{KMe(this._queries,o),n.reject(Yi())}),n.promise}get running(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(u=>u.result.reject()),void e.madeProgress();const s=i.map(u=>[u.x,u.y]),n=i.reduce((u,h)=>Math.min(u,h.minDemResolution),1/0),o=new PI({points:s,spatialReference:this.spatialReference}),a=i.length>1&&i.some(u=>!!u.signal)?new AbortController:null,l=a!=null?a.signal:i[0].signal;if(a!=null){let u=0;i.forEach(h=>oo(h.signal,()=>{u++,h.result.reject(Yi()),u===i.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};r.queryElevation(o,c).then(u=>{i.forEach((h,p)=>{h.signal!=null&&h.signal.aborted?h.result.reject(Yi()):h.result.resolve(u.geometry.points[p][2])})}).catch(u=>{i.forEach(h=>h.result.reject(u))}),e.madeProgress()}get test(){}},rH=class{constructor(e=1/0,i=-1/0){this.elevationRangeMin=e,this.elevationRangeMax=i}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,i){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,i)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}},EL=class extends un.EventedMixin(Fe){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=Ge(this._cachedQuery)}enableCache(e){e||(this.lastElevationQuery=null),this._cacheEnabled=e}getElevation(e,i,r,s,n){if(this._cacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&i===a.y&&r===a.z&&Bs(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=CB(o,this._im,e,i,r,s,n),o==null&&(o=CB(o,this._ground,e,i,r,s,n)),n==="scene"&&(o=CB(o,this._scene,e,i,r,s,n)),this._cacheEnabled&&(this.lastElevationQuery={x:e,y:i,z:r,spatialReference:s,queryContext:n,result:o}),o}getSphereElevationBounds(e,i,r){const s=new rH;function n(o){for(const a of o)if(a.getSphereElevationBounds){const l=a.getSphereElevationBounds(e,i,r);l!=null&&s.expandElevationRangeValues(l.elevationRangeMin,l.elevationRangeMax)}}return n(this._ground),n(this._im),r==="scene"&&n(this._scene),s}getRootElevationBounds(){const e=new rH;for(const i of[this._im,this._ground,this._scene])i.forEach(r=>{if(r.getRootElevationBounds){const s=r.getRootElevationBounds();s!=null&&e.expandElevationRangeValues(s.elevationRangeMin,s.elevationRangeMax)}});return e}async queryElevation(e,i,r,s,n,o=null,a=0){const l=this._getElevationQuery(s);try{const c=await l.queryElevation(e,i,o,a);return n==="scene"?CB(c,this._scene,e,i,r,s,n):c}catch(c){return pl(c),this.getElevation(e,i,r,s,n)}}register(e,i){this.addHandles(i.on("elevation-change",r=>this.emit("elevation-change",r)),i),this._providersFromContext(e).push(i)}unregister(e){this.removeHandles(e);for(const i of[this._im,this._ground,this._scene]){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const i=this._cachedQuery;if(i!=null&&Bs(e,i.spatialReference))return i;i?.destroy({completeTasks:!0});const{wkid:r,wkt:s,wkt2:n,latestWkid:o}=e,a=new w4t(this.view.resourceController.scheduler,new Je({wkid:r,wkt:s,wkt2:n,latestWkid:o}),()=>this.view.map?.ground,{maximumAutoTileRequests:4});return this._cachedQuery=a,a}};function CB(t,e,i,r,s,n,o){for(const a of e){const l=a.getElevation(i,r,s,n,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}d([m({constructOnly:!0})],EL.prototype,"view",void 0),d([m()],EL.prototype,"spatialReference",null),EL=d([N("esri.views.3d.support.CombinedElevationProvider")],EL);let XF=class Kse{static isValidProfile(e){return e in Kse.profiles}static getDefaultProfile(){return ae("esri-iPhone")?"low":"medium"}static apply(e,i){const r=Kse.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxNumberOfDrawCalls=r.graphics3D.maxNumberOfDrawCalls,i.graphics3D.maxTotalNumberOfVertices=r.graphics3D.maxTotalNumberOfVertices,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods,i.graphics3D.uncompressedTextureDownsamplingEnabled=r.graphics3D.uncompressedTextureDownsamplingEnabled;const s=i.sceneService.object,n=r.sceneService.object;s.lodFactor=n.lodFactor,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.vtlContentZoom=r.tiledSurface.vtlContentZoom,i.tiledSurface.elevationLevelDelta=r.tiledSurface.elevationLevelDelta,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.highResolutionAtmosphere=r.highResolutionAtmosphere,i.reflections=r.reflections,i.ambientOcclusion=r.ambientOcclusion,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}};XF.test={reset(){const t=PGe();for(const e of Object.keys(t))XF.profiles[e]=t[e]}};const w3={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function PGe(){const t=!!ae("esri-mobile"),e=!!ae("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+w3.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!ae("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600+w3.GalaxyS20:750+w3.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!ae("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900+w3.SurfacePro7:1500+w3.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}(function(t){t.profiles=PGe()})(XF||(XF={}));const IG=XF,OGe=new Ke([0,255,255]),IGe=1,$Ge=.25,NGe=new Ke([0,0,0]),LGe=.4,DGe=.2;let gy=class extends Fe{constructor(){super(...arguments),this.color=OGe.clone(),this.haloColor=null,this.haloOpacity=IGe,this.fillOpacity=$Ge,this.shadowOpacity=LGe,this.shadowColor=NGe.clone(),this.shadowDifference=DGe}};d([m({type:Ke})],gy.prototype,"color",void 0),d([m({type:Ke})],gy.prototype,"haloColor",void 0),d([m()],gy.prototype,"haloOpacity",void 0),d([m()],gy.prototype,"fillOpacity",void 0),d([m()],gy.prototype,"shadowOpacity",void 0),d([m({type:Ke})],gy.prototype,"shadowColor",void 0),d([m()],gy.prototype,"shadowDifference",void 0),gy=d([N("esri.views.3d.support.HighlightOptions")],gy);const FGe=gy;function x4t(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function S4t(t){return typeof t=="string"?ln(t):ee(t)}function T4t(t,e,i){const r={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n))r[s]=n.map(o=>T4t(o));else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i?.[s]);r[s]=e?o:JSON.stringify(o)}else r[s]=e?n:JSON.stringify(n);else r[s]=n}return r}function Ixi(t){return{geometryType:rce(t[0]),geometries:t.map(e=>e.toJSON())}}function E4t(t,e,i){const r=uit(e);return t.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}let jT=class extends we{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),i=this.geometries[0],r={};return r.outSR=zme(this.outSpatialReference),r.inSR=zme(i.spatialReference),r.geometries=JSON.stringify({geometryType:rce(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};d([m()],jT.prototype,"geometries",void 0),d([m({json:{read:{source:"outSR"}}})],jT.prototype,"outSpatialReference",void 0),d([m()],jT.prototype,"transformation",void 0),d([m()],jT.prototype,"transformForward",void 0),jT=d([N("esri.rest.support.ProjectParameters")],jT);const tpe=jT,C4t=Tn(tpe);async function kGe(t,e,i){e=C4t(e);const r=S4t(t),s={...r.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=rce(e.geometries[0]),a=x4t(s,i);return qi(r.path+"/project",a).then(({data:{geometries:l}})=>E4t(l,o,n))}async function ipe(t=null,e){if(gr.geometryServiceUrl)return gr.geometryServiceUrl;if(!t)throw new j("internal:geometry-service-url-not-configured");let i;i="portal"in t?t.portal||Mo.getDefault():t,await i.load({signal:e});const r=i.helperServices?.geometry?.url;if(!r)throw new j("internal:geometry-service-url-not-configured");return r}async function M4t(t,e,i=null,r){const s=await ipe(i,r),n=new tpe({geometries:[t],outSpatialReference:e}),o=await kGe(s,n,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new j("internal:geometry-service-projection-failed")}const A4t=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:ipe,projectGeometry:M4t},Symbol.toStringTag,{value:"Module"}));let R4t=class{constructor(e,i){this.spatialReference=i,this.unitInMeters=Xc(this.spatialReference,$r(this.spatialReference).metersPerDegree);const r=e&&"portalItem"in e?e.portalItem:void 0;this._geometryServiceURLPromise=ipe(r).catch(()=>{throw new j("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?r=e:(r=[e],s=!1);const n=r.map(l=>l instanceof $t?l:new $t(l,this.spatialReference)),o=new tpe({geometries:n,outSpatialReference:Je.WGS84}),a=(await kGe(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}};var ri;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(ri||(ri={}));const HT=[ri.ELEVATION,ri.MAP];async function P4t(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=i.results[0],s=(r.distance??0)*(1+O4t),n=i.results.findIndex(o=>(o.distance??0)>s);return n!==-1&&(i.results=i.results.slice(0,n)),r&&i.ground.distance>s&&(i.ground.mapPoint=null),i}const O4t=.05;async function I4t(t,e){const{results:i,ground:r}=await P4t(t,e),s=(!r.layer||!aF(r.layer.type))&&r.mapPoint,n=[],o=L4t(t),a=s?$4t(t,o):N4t;let l=0,c=0;const u=()=>{const p=a.layerViews[c];s&&p&&"fetchPopupFeaturesAtLocation"in p&&n.push({mapPoint:r.mapPoint,layerView:p}),++c};let h=null;for(;l<i.length||c<a.layerViews.length;){const p=i[l];if(p&&p.type!=="graphic")++l;else if(p?.layer?.type!=="scene"||p?.layer?.parent!==t?.map?.basemap)if(p){const f=p.layer?.uid,g=a.layerUids.has(f)&&p.distance===r.distance,y=o.get(p.layer?.uid);if(h??=p.mapPoint,c<a.layerViews.length&&(g||(p.distance??0)>r.distance)&&a.layerViews[c]!==y){u();continue}n.push({graphic:p.graphic,layerView:y}),++l}else u();else++l}return h??=r.mapPoint,{hits:n,location:h}}function $4t(t,e){const i=new Set,r=[];for(let n=t.basemapTerrain.numLayers(ri.MAP)-1;n>=0;n--){const o=t.basemapTerrain.layerViewByIndex(n,ri.MAP);i.add(o.layer.uid),r.push(o)}const s=t.basemapTerrain.overlayManager.renderer.layers;for(const{uid:n}of s){const o=e.get(n);o&&(i.add(n),r.push(o))}return r.reverse(),{layerUids:i,layerViews:r}}const N4t={layerUids:new Set,layerViews:[]};function L4t(t){const e=new Map;for(const i of t.allLayerViews){const r=i.layer.uid;e.set(r,i)}return e}let dd=class extends Fe{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};d([m()],dd.prototype,"minTotalNumberOfFeatures",void 0),d([m()],dd.prototype,"maxTotalNumberOfFeatures",void 0),d([m()],dd.prototype,"maxNumberOfDrawCalls",void 0),d([m()],dd.prototype,"maxTotalNumberOfVertices",void 0),d([m()],dd.prototype,"snapshotAvailable",void 0),d([m()],dd.prototype,"polygonLodFactor",void 0),d([m()],dd.prototype,"polylineLodFactor",void 0),d([m()],dd.prototype,"skipHighSymbolLods",void 0),d([m()],dd.prototype,"uncompressedTextureDownsamplingEnabled",void 0),dd=d([N("esri.views.3d.support.QualitySettings.Graphics3DSettings")],dd);let Ym=class extends Fe{constructor(){super(...arguments),this.lodFactor=1}};d([m()],Ym.prototype,"lodFactor",void 0),Ym=d([N("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Ym);let iv=class extends Fe{constructor(){super(...arguments),this.object=new Ym,this.point=new Ym,this.integratedMesh=new Ym,this.pointCloud=new Ym,this.uncompressedTextureDownsamplingEnabled=!1}};d([m({type:Ym})],iv.prototype,"object",void 0),d([m({type:Ym})],iv.prototype,"point",void 0),d([m({type:Ym})],iv.prototype,"integratedMesh",void 0),d([m({type:Ym})],iv.prototype,"pointCloud",void 0),d([m()],iv.prototype,"uncompressedTextureDownsamplingEnabled",void 0),iv=d([N("esri.views.3d.support.QualitySettings.SceneServiceSettings")],iv);let rv=class extends Fe{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.elevationLevelDelta=3,this.reduceTileLevelDifferences=!0}};d([m()],rv.prototype,"lodBias",void 0),d([m()],rv.prototype,"angledSplitBias",void 0),d([m()],rv.prototype,"vtlContentZoom",void 0),d([m()],rv.prototype,"elevationLevelDelta",void 0),d([m()],rv.prototype,"reduceTileLevelDifferences",void 0),rv=d([N("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],rv);let aP=class extends Fe{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};d([m()],aP.prototype,"pixelRatio",void 0),d([m()],aP.prototype,"maxTotalNumberOfFeatures",void 0),aP=d([N("esri.views.3d.support.QualitySettings.HeatmapSettings")],aP);let il=class extends Fe{constructor(){super(...arguments),this.graphics3D=new dd,this.sceneService=new iv,this.tiledSurface=new rv,this.heatmap=new aP,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};d([m({type:dd})],il.prototype,"graphics3D",void 0),d([m({type:iv})],il.prototype,"sceneService",void 0),d([m({type:rv})],il.prototype,"tiledSurface",void 0),d([m({type:aP})],il.prototype,"heatmap",void 0),d([m()],il.prototype,"fadeDuration",void 0),d([m()],il.prototype,"antialiasingEnabled",void 0),d([m()],il.prototype,"physicallyBasedRenderingEnabled",void 0),d([m()],il.prototype,"highQualityTransparency",void 0),d([m()],il.prototype,"highResolutionAtmosphere",void 0),d([m()],il.prototype,"reflections",void 0),d([m()],il.prototype,"ambientOcclusion",void 0),d([m()],il.prototype,"memoryLimit",void 0),d([m()],il.prototype,"additionalCacheMemory",void 0),d([m()],il.prototype,"frameRate",void 0),d([m()],il.prototype,"maximumPixelRatio",void 0),il=d([N("esri.views.3d.support.QualitySettings")],il);const RSe=il;let D4t=class ene{constructor(e,i,r,s){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=s,this._tmpCoordinateSystem=Ult(s),this.referenceEllipsoid=$r(i),this.sphericalPCPF=Xd(i)}set extent(e){e&&Blt(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return Ylt(this._coordinateSystem,e)}setAltitude(e,i,r=e){return O3e(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){Xlt(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return jlt(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return Hlt(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,Ls.X,tt.get()),s=this.worldBasisAtPosition(e,Ls.Y,tt.get()),n=this.worldBasisAtPosition(e,Ls.Z,tt.get());return O0(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,tt.get()),s=this.worldBasisAtPosition(e,Ls.Y,tt.get()),n=n3e(i,s,r);return El(n)}intersectManifoldClosestSilhouette(e,i,r){return HW(this._coordinateSystem,i,this._tmpCoordinateSystem),Wlt(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){HW(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=tt.get();return qlt(this._tmpCoordinateSystem,e,s)?ge(r,s):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===Xe.Global)return this.intersectManifold(e,i,r);HW(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=tt.get();return vC(s.plane,e,n)?ge(r,n):null}toRenderCoords(e,i,r){return zj(e)?lc(e,i,this.spatialReference):wa(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return zj(i)?(r!=null&&(i.spatialReference=r),Fx(e,this.spatialReference,i)?i:null):wa(e,this.spatialReference,i,r)?i:null}static create(e,i){switch(e){case Xe.Local:return new ene(Xe.Local,i,Xc(i),Glt());case Xe.Global:return new ene(Xe.Global,i,1,Vlt(i))}}static renderUnitScaleFactor(e,i){return Gme(e)/Gme(i)}};var Hy;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(Hy||(Hy={}));const F4t=(()=>{const t=new Array;return t[Hy.ELEVATION]=10,t[Hy.BASEMAP]=10,t[Hy.I3S_INDEX]=10,t[Hy.I3S_DATA]=10,t[Hy.SYMBOLOGY]=5,t})(),k4t=30;function U4t(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function B4t(t){return new Ac({view:t})}const PSe=.1,MB=1,AZ=1,z4t=.75,V4t=.6,OSe=1.3;let Ac=class extends Fe{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new OBe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(xE({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(MB),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,i){return new MAt(e,this._cacheStorage,i)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<V4t&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(MB);else if(e)(this._memoryPredicted>1.1*AZ||this._usedMemory>AZ)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>PSe&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/OSe),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>AZ)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/OSe),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<z4t&&this._quality<MB){this._stableQuality=this._quality;const i=.05;e=this._updateQuality(this._quality+i)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,PSe),MB))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){if(!this.view)return;this.view._stage?.renderer?.tick();const e=this.view._stage?.renderer?.usedMemory;let i=(this.view.basemapTerrain?.usedMemory??0)+(e?e.fbos+e.edges+e.plugins:0),r=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(a=>{if(U4t(a)){const l=a.ignoresMemoryFactor?this._quality:1;i+=a.usedMemory*l,r+=a.unloadedMemory*l}});const s=this._warnMemoryUsage==null||Math.round(10*i)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(i>n&&s){this._warnMemoryUsage=i;const a=c=>(c/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",l=Math.round(100*this._quality);oe.getLogger(this).warn(`Memory Limit exceeded! Limit: ${a(n)} Current: ${a(i)} Projected: ${a(i+r)} Quality: ${l}%`)}this._usedMemory=i/n,this._memoryPredicted=(i+r)/n;const o=n-i;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){}};d([m({constructOnly:!0})],Ac.prototype,"view",void 0),d([m()],Ac.prototype,"maxMemory",null),d([m()],Ac.prototype,"additionalCacheMemory",null),d([m({readOnly:!0})],Ac.prototype,"memoryFactor",null),d([m({readOnly:!0})],Ac.prototype,"updating",null),d([m({readOnly:!0})],Ac.prototype,"usedMemory",null),d([m({readOnly:!0})],Ac.prototype,"usedCacheMemory",null),d([m()],Ac.prototype,"_quality",void 0),d([m()],Ac.prototype,"_usedMemory",void 0),d([m()],Ac.prototype,"_updating",void 0),d([m()],Ac.prototype,"_stableQuality",void 0),d([m()],Ac.prototype,"_maxMemory",void 0),d([m()],Ac.prototype,"_additionalCacheMemory",void 0),Ac=d([N("esri.views.3d.support.MemoryController")],Ac);let G4t=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},j4t=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new H4t}},H4t=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},q4t=class{constructor(e,i,r,s){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new j4t(n))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,s)=>this._taskCallback(r,s))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,Tt(i.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){}},W4t=class{constructor(e,i){this.element=e,this.type="image+type",this.isOpaque=i==="image/jpeg"}};function cR(t){return t!=null&&"type"in t&&t.type==="vector-tile"}function UGe(t){return t!=null&&"type"in t&&t.type==="raster-tile"}function BGe(t){return t!=null&&"type"in t&&t.type==="tile-texture"}function M7(t){return t!=null&&"type"in t&&t.type==="image+type"}let $G=class extends Fe{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new q4t((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,i),r&&(this._frameTask=r.registerTask(Ut.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Zr(this._frameTask),this._tasks.forEach(e=>qc(e.abortController)),this._loadQueue=Ge(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,s={}){const n=lo();n.__signal=s!=null?s.signal:null;const o=this._createOrUpdateTask(e,i,r,s,n);return oo(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,i,r,s,n,o){const a=new Z4t(e,i,r,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,i){QD(e.resolvers,i),i.reject(Yi()),e.resolvers.length===0&&(e.status===Op.DOWNLOADING&&(e.status=Op.CANCELLED,this._loadQueue.cancel(e),e.abortController?.abort(),e.request=null,e.abortController=null),e.status=Op.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,s,n){const o=J4t(s?.uid||e,i,r),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,i,r,o,n)}_doneLoadingCB(e,i){this._loadQueue&&(Tt(e.status===Op.DOWNLOADING),e.status=Op.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();zt(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==Op.DOWNLOADED&&(i.err=i.err||Yi()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!En(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=M7(e.result)||e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(i)En(i)?s.reject(i):s.reject(new j("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const n=r>0?ee(e.result):e.result;s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===Op.CANCELLED)return!1;let r,s;switch(e.startTime=performance.now(),e.status=Op.DOWNLOADING,e.docType){case"binary":s="array-buffer",r=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=qi(e.url,{...e.options,responseType:s,timeout:r,signal:n});const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},a=l=>{e.status===Op.DOWNLOADING&&i(e,l)};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,u=X4t(c);if(s="image",e.size=c.byteLength,u==="unknown")return e.request=qi(e.url,{responseType:s,timeout:r,signal:n}),void e.request.then(f=>o(f.data),a);const h=new Blob([c],{type:u}),p=window.URL.createObjectURL(h);e.request=qi(p,{responseType:s,timeout:r,signal:n}),e.request.then(f=>o(new W4t(f.data,u)),a).finally(()=>window.URL.revokeObjectURL(p))},a),!0)}get test(){}};d([m({readOnly:!0})],$G.prototype,"updating",void 0),$G=d([N("esri.views.3d.support.StreamDataLoader")],$G);const Y4t={numRetries:0};function X4t(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let Z4t=class extends G4t{constructor(e,i,r,s,n){super(s),this.url=e,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=Op.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Y4t.numRetries}};function J4t(t,e,i){return`${t}:${e}:${i}`}var Op;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Op||(Op={}));let NG=class extends Fe{constructor(){super(...arguments),this.updating=!1}};function Q4t(t){return new lm({view:t})}d([m({readOnly:!0})],NG.prototype,"updating",void 0),NG=d([N("esri.views.3d.support.ResourceController.ResourceControllerMain")],NG);let lm=class extends NG{constructor(){super(...arguments),this._immediateTask=LO,this._normalTask=LO,this._updatingObjects=s0([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=dot(),this._memoryController=B4t(this.view),this._streamDataLoader=new $G,this._streamDataLoader.setup(k4t,F4t,this._scheduler),this.addHandles([_e(()=>this.view.state?.mode,e=>{e!=null&&(this._scheduler.state=e)},Mr),_e(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=xE({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(Ut.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(Ut.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Zr(this._frameTask),this._streamDataLoader=Ge(this._streamDataLoader),this._memoryController=Ge(this._memoryController),this._scheduler=Ge(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some(e=>e.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const i=this._streamDataLoader;return{request:(r,s,n)=>i.request(r,s,e,n),get busy(){return!i.hasDownloadSlots(e)}}}addUpdatingObject(e){const i=this._updatingObjects;return i.value=[...i.value,e],er(()=>{i.value=i.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(fle(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};d([m()],lm.prototype,"view",void 0),d([m()],lm.prototype,"_scheduler",void 0),d([m()],lm.prototype,"_memoryController",void 0),d([m()],lm.prototype,"_streamDataLoader",void 0),d([m()],lm.prototype,"_immediateTask",void 0),d([m()],lm.prototype,"_normalTask",void 0),d([m()],lm.prototype,"_updatingObjects",void 0),d([m({readOnly:!0})],lm.prototype,"updating",null),lm=d([N("esri.views.3d.support.ResourceController")],lm);var tne;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(tne||(tne={}));let Jxi=class{constructor(e,i=0,r=0,s=0,n=0,o=null){this.usedMemory=e,this.displayedFeatures=i,this.totalFeatures=r,this.maximumFeatures=s,this.nodes=n,this.core=o}};function K4t(t){return"performanceInfo"in t}let eUt=class{constructor(e){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer;const i=e.performanceInfo;this.memory=i.usedMemory,this.displayedNumberOfFeatures=i.displayedFeatures,this.maximumNumberOfFeatures=i.maximumFeatures,this.totalNumberOfFeatures=i.totalFeatures}},tUt=class{constructor(e){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const i=e.resourceController.memoryController;this.totalMemory=(i.maxMemory??0)*tne.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=i.usedCacheMemory}this.terrainMemory=e.basemapTerrain?.usedMemory??0,this.edgesMemory=e._stage?.renderer.usedMemory.edges??0,this.fboMemory=e._stage?.renderer.usedMemory.fbos??0,e.allLayerViews?.items.forEach(i=>{K4t(i)&&this.layerPerformanceInfos.push(new eUt(i))}),this.layerPerformanceInfos.sort((i,r)=>r.memory-i.memory)}},iUt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,i,r){const s=r?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):ISe(this._gltfLoading,this._gltfMemCache,s,o=>TVe(new xVe(o.streamDataRequester),e,o,r),i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,s=this._wosrMemCache.get(r);return s!=null?Promise.resolve(s):ISe(this._wosrLoading,this._wosrMemCache,r,n=>EVe(e,n),i)}};async function ISe(t,e,i,r,s){zt(s);const n=oo(s,()=>rUt(t,i));let o=t.get(i);if(o)o.refCount++;else{const a=new AbortController;o={refCount:1,abortController:a,promise:r({...s,signal:a.signal})},t.set(i,o)}try{const a=await o.promise;return e.put(i,a,a.size),t.delete(i),zt(s),a}finally{Zr(n)}}function rUt(t,e){const i=t.get(e);i!=null&&--i.refCount>0||(t.delete(e),i?.abortController.abort())}let lP=class extends Fe{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=i?.registerTask(Ut.TEXTURE_UNLOAD)??LO}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);if(!s){const n=new VGe;n.texture=i(),this._stage&&(n.texture.load(this._stage.renderView.renderingContext),this._stage.add(n.texture)),this._textureRequests.set(r,n),s=n}return s.referenceCount++,new zGe(r,s.texture,()=>this._release(r))}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){}_releaseNow(e){if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||(i.texture?.unload(),this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return i!=null?`${e}.${i}px`:e}};d([m()],lP.prototype,"_frameTask",void 0),d([m()],lP.prototype,"updating",null),lP=d([N("esri.views.3d.support.TextureCollection")],lP);let zGe=class{constructor(e,i,r){this.uid=e,this.texture=i,this.release=r}},VGe=class{constructor(){this.referenceCount=0}},sUt=class extends lP{constructor(e,i,r){super(i,r),this._streamDataRequester=e}async fromUrl(e,i,r){zt(r);const s=r?.signal,n=this.makeUid(e,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o=new VGe,o.abortController=a;const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async u=>{const h=this._createTexture(e,u,i);return c.texture=h,c.abortController=null,await h.load(this._stage.renderView.renderingContext),this._stage.add(h),new zGe(n,h,()=>this._release(n))},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await IAe(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,i,r){const s={width:i.width,height:i.height,wrap:{s:Di.CLAMP_TO_EDGE,t:Di.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(wRe(e)){if(r||i.width===0&&i.height===0){const n=i.width?i.height/i.width:1;r=r||64,n>1?(i.width=Math.round(r/n),i.height=r):(i.width=r,i.height=Math.round(r*n))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new xx(i,s)}},nUt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(Hy.SYMBOLOGY),this.objectResourceCache=new iUt((r,s)=>e.resourceController.memoryController.newCache(r,s)),this.textures=new sUt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const i=$r(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=v4e(e.viewingMode,i),this.screenSizePerspectiveSettingsLabels=bxt(e.viewingMode,i)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return er();this._graphicsOwners.push(e);const i=_e(()=>e.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),er(()=>{i.remove(),QD(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(i=>i.layer?.screenSizePerspectiveEnabled===!0);if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new A0;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([_e(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Mr),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Ge(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;AB.distance=e.centerOnSurfaceInfrequent.distance,AB.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(AB),this.screenSizePerspectiveSettingsLabels.update(AB),this._view._stage.renderView.requestRender()}get test(){}};const AB={distance:0,fovY:0};let uR=class{constructor(e,i,r=""){this.graphics=e,this._symbol=new Yy({symbolLayers:new ct([new ww({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new MC({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})])})}show(e,i){if(i==null)return;this.hide();const r=new $t({x:e[0],y:e[1],z:e[2],spatialReference:i});this._graphic=new fg({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},cw=class extends Fe{constructor(e){super(e)}};d([m({constructOnly:!0})],cw.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],cw.prototype,"surface",void 0),d([m({constructOnly:!0})],cw.prototype,"state",void 0),cw=d([N("esri.views.3d.support.pointsOfInterest.PointOfInterest")],cw);const oUt=Array;let cm=class extends cw{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new jv({location:$t,renderLocation:oUt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=M(),this._tmpPoint=new $t}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(qa(()=>this.map?.ground?.layers,"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Ge(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){const e=this._camera,i=jr(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return ux(r,i,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map?.ground)return this._updateSurfaceAltitude(0),Wa;const e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const i=(this._tmpPoint.z??0)>aUt&&this.renderCoordsHelper.viewingMode===Xe.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?lUt:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{En(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,Wa}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(RZ,this._estimatedSurfaceAltitude,this._camera.eye),ga(this._get("renderLocation"),RZ)||(this._set("renderLocation",ge(this._propertiesPool.get("renderLocation"),RZ)),this.notifyChange("renderLocation"))}};d([m({constructOnly:!0})],cm.prototype,"scheduler",void 0),d([m({constructOnly:!0})],cm.prototype,"cache",void 0),d([m({constructOnly:!0})],cm.prototype,"task",void 0),d([m()],cm.prototype,"location",null),d([m({constructOnly:!0})],cm.prototype,"map",void 0),d([m()],cm.prototype,"renderLocation",void 0),d([m()],cm.prototype,"scale",null),d([m()],cm.prototype,"updating",null),cm=d([N("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],cm);const RZ=M(),aUt=1e5,lUt=1e6,cUt=Array;let Ip=class extends cw{constructor(e){super(e),this._propertiesPool=new jv({location:$t,renderLocation:cUt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=M(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Zr(this._frameWorker),this._propertiesPool=Ge(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Wa}_updateRenderLocation(){const e=hUt;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=dUt;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(ge(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=jr(this._camera.eye,e):(ce(e,this._camera.viewForward,this._get("distance")),Te(e,e,this._camera.eye)),ga(this._get("renderLocation"),e)||this._set("renderLocation",ge(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){const r=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const s=$r(this.renderCoordsHelper.spatialReference).radius,n=s+e,o=Ql(r.eye),a=o<n*n,l=jr(r.eye,i);if(a&&l>s/4){const c=n-Math.sqrt(o);return ce(i,r.viewForward,c),Te(i,i,r.eye),!0}}else{const s=this.surface?.ready?this.surface.extent:null;s!=null&&Zq(s,this.surface?.spatialReference,x3,this.renderCoordsHelper.spatialReference)&&(i[0]=$e(i[0],x3[0],x3[2]),i[1]=$e(i[1],x3[1],x3[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(ts.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,s=jr(r,e),n=jr(r,i);if(Math.abs(n-s)/s>uUt)return!0}return!1}};d([m({constructOnly:!0})],Ip.prototype,"scheduler",void 0),d([m({constructOnly:!0})],Ip.prototype,"task",void 0),d([m()],Ip.prototype,"distance",void 0),d([m({constructOnly:!0})],Ip.prototype,"estimateSurfaceAltitudeAtCenter",void 0),d([m({readOnly:!0})],Ip.prototype,"location",null),d([m({readOnly:!0})],Ip.prototype,"renderLocation",void 0),d([m()],Ip.prototype,"updating",void 0),Ip=d([N("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],Ip);const uUt=.05,hUt=M(),dUt=M(),x3=li();let pUt=class{constructor(e){this._handles=new A0,this.events=new un,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Ge(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),e.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",fUt)}};const fUt={},mUt=Array;let um=class extends cw{constructor(e){super(e),this._propertiesPool=new jv({location:$t,renderLocation:mUt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([_e(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),_e(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(Ut.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Ge(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){const{camera:e,contentPixelRatio:i}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/i)}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,$Se);const n=Math.max(0,(Math.acos(xe($Se,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!NE(e,i)){const c=this._propertiesPool.get("renderLocation");ge(c,i),this._set("renderLocation",c)}return Wa}const o=1-$e(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(NSe);const l=this._propertiesPool.get("renderLocation");return Br(l,i,NSe,a),e&&NE(e,l)||this._set("renderLocation",l),Wa}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(_l());if(r[1]=i.aboveGround?i.padding[Si.BOTTOM]:i.fullHeight-i.padding[Si.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,S3)){Me(S3,S3,i.eye);const n=Se(S3,S3);if(this.renderCoordsHelper.intersectInfiniteManifold(Yd(i.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,i.eye)}updateRenderLocation(){this._dirty=!0}};d([m()],um.prototype,"_dirty",void 0),d([m({constructOnly:!0})],um.prototype,"scheduler",void 0),d([m({constructOnly:!0})],um.prototype,"centerOnSurface",void 0),d([m({constructOnly:!0})],um.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),d([m()],um.prototype,"updating",null),d([m()],um.prototype,"location",null),d([m()],um.prototype,"renderLocation",void 0),d([m()],um.prototype,"worldUnitsPerContentPixel",null),um=d([N("esri.views.3d.support.pointsOfInterest.Focus")],um);const $Se=M(),S3=M(),NSe=M();let D_=class extends Fe{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=M();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([_e(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),qa(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),this.surfaceView?.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=Kle(this.surfaceView.extent),i=new $t({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{})):this._set("location",i)}};d([m({constructOnly:!0})],D_.prototype,"view",void 0),d([m({constructOnly:!0})],D_.prototype,"cache",void 0),d([m()],D_.prototype,"surface",null),d([m()],D_.prototype,"surfaceView",null),d([m({readOnly:!0})],D_.prototype,"location",void 0),d([m({readOnly:!0})],D_.prototype,"renderLocation",null),D_=d([N("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],D_);let F_=class extends Fe{constructor(e){super(e),this._tileGeometryUpdateExtent=Hd(),this._tileGeometryUpdateSpatialReference=null,this.events=new un,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(Ut.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",gUt),Hd(this._tileGeometryUpdateExtent),this._set("updating",!1)),Wa}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Iw(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,s=yUt,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,BS,i),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,zS,i),BS[0]<zS[0]?(s[0]=BS[0],s[2]=zS[0]):(s[0]=zS[0],s[2]=BS[0]),BS[1]<zS[1]?(s[1]=BS[1],s[3]=zS[1]):(s[1]=zS[1],s[3]=BS[1]),Nq(s,e)}};d([m({constructOnly:!0})],F_.prototype,"state",void 0),d([m({constructOnly:!0})],F_.prototype,"centerOnSurfaces",void 0),d([m({constructOnly:!0})],F_.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],F_.prototype,"scheduler",void 0),d([m({constructOnly:!0})],F_.prototype,"surface",void 0),d([m({readOnly:!0})],F_.prototype,"updating",void 0),F_=d([N("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],F_);const gUt={},BS=M(),zS=M(),yUt=Hd();let _u=class extends Fe{constructor(e){super(e),this.renderPointOfView=M(),this._pois=new Array,this._debugCenters=new Map,this._tmpRay=jo(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new jv({renderPointOfView:_Ut},this)}initialize(){const{state:e,basemapTerrain:i,renderCoordsHelper:r,map:s}=this.view;this._surfaceIntersector=pf(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Ya.MIN,this._contentIntersector=pf(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=this.view.basemapTerrain?.elevationQueryCache,l={state:e,scheduler:o,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Ip({...l,task:Ut.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new Ip({...l,task:Ut.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new Ip({...l,task:Ut.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new cm({...l,cache:a,task:Ut.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new F_({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new pUt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new D_({cache:a,view:this.view})),this._set("focus",new um({state:e,scheduler:o,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(u,h)=>this._estimateSurfaceIntersectionAtRenderPoint(u,this.view.state.contentCamera,h)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new uR(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new uR(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new uR(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new uR(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new uR(c,"green","Focus")),this.addHandles([_e(()=>e.contentCamera,u=>this._cameraChanged(u),Mr),_e(()=>i.extent,()=>this._updateCenterPointsOfInterest()),Du(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),Mr),qa(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),qa(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Du(()=>ts.SHOW_POI,u=>this._setDebug(u),Ir)]),this._cameraChanged(this.view.state.contentCamera);for(const u of this._pois)u.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(e=>e.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,VM,bUt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(VM):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const i=e.origin,r=Te(VM,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,r),this._surfaceIntersector.results.min.getIntersectionPoint(VM)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(VM)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const s=whe(i,e,vUt);if(s==null)return null;const n=s.origin,o=Te(VM,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,i),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;ga(this.renderPointOfView,i)||this._set("renderPointOfView",ge(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(i=>i.hide()),void this.removeHandles("debug");for(const i of this._pois)this.addHandles(_e(()=>i.renderLocation,r=>this._debugCenters.get(i)?.show(r,i.renderCoordsHelper.spatialReference),Ir),"debug")}get test(){}};d([m()],_u.prototype,"centerOnContent",void 0),d([m()],_u.prototype,"centerOnSurfaceFrequent",void 0),d([m()],_u.prototype,"centerOnSurfaceInfrequent",void 0),d([m()],_u.prototype,"cameraOnSurface",void 0),d([m()],_u.prototype,"focus",void 0),d([m()],_u.prototype,"renderPointOfView",void 0),d([m()],_u.prototype,"surfaceOrigin",void 0),d([m()],_u.prototype,"contentGeometryUpdates",void 0),d([m()],_u.prototype,"surfaceGeometryUpdates",void 0),d([m({constructOnly:!0})],_u.prototype,"view",void 0),d([m()],_u.prototype,"updating",null),_u=d([N("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],_u);const _Ut=Array,VM=M(),vUt=jo(),bUt={exclude:new Set([cx])};let wUt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i,i.values.byteLength+256)}};function pE(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function GGe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function xUt(t,e,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function SUt(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:GGe,create:pE,createView:SUt,fromValues:xUt},Symbol.toStringTag,{value:"Module"}));var lh,LSe,DSe;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(lh||(lh={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(LSe||(LSe={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(DSe||(DSe={}));let Jv=class qT{static getId(e,i,r,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${s}`}constructor(e,i,r,s){this.set(e,i,r,s)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,s){this.set(e,i,r,s)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}containsChild(e){const i=e.level-this.level;return i>0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new qT(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new qT(this.level-1,this.row>>1,this.col>>1,this.world)}getNeighborId(e,i){return`${this.level}/${this.row+i}/${this.col+e}/${this.world}`}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new qT(e,i,r,s),new qT(e,i,r+1,s),new qT(e,i+1,r,s),new qT(e,i+1,r+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};Jv.pool=new Tl(Jv,null,null,25,50);function K1(t,e){return[t,e]}function VS(t,e,i){return t[0]=e,t[1]=i,t}function TUt(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}const zf=new Jv("0/0/0/0");let EUt=class jGe{static create(e,i,r=null){const s=Cv(e.spatialReference),n=i.origin||K1(e.origin.x,e.origin.y),o=K1(e.size[0]*i.resolution,e.size[1]*i.resolution),a=K1(-1/0,-1/0),l=K1(1/0,1/0),c=K1(1/0,1/0);r!=null&&(VS(a,Math.max(0,Math.floor((r.xmin-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymax)/o[1]))),VS(l,Math.max(0,Math.floor((r.xmax-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymin)/o[1]))),VS(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:u,rows:h}=i;let p,f,g,y;return!r&&u&&h&&(VS(a,u[0],h[0]),VS(l,u[1],h[1]),VS(c,u[1]-u[0]+1,h[1]-h[0]+1)),e.isWrappable?(p=K1(Math.ceil(Math.round((s.valid[1]-s.valid[0])/i.resolution)/e.size[0]),c[1]),f=K1(Math.floor((s.origin[0]-n[0])/o[0]),a[1]),g=K1(p[0]+f[0]-1,l[1]),y=!0):(f=a,g=l,p=c,y=!1),new jGe(i.level,i.resolution,i.scale,n,a,l,c,o,f,g,p,y)}constructor(e,i,r,s,n,o,a,l,c,u,h,p){this.level=e,this.resolution=i,this.scale=r,this.origin=s,this.first=n,this.last=o,this.size=a,this.norm=l,this.worldStart=c,this.worldEnd=u,this.worldSize=h,this.wrap=p}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){zf.set(i);const s=r?zf.col:this.denormalizeCol(zf.col,zf.world),n=zf.row;return TUt(e,this.getXForColumn(s),this.getYForRow(n+1),this.getXForColumn(s+1),this.getYForRow(n)),e}getTileCoords(e,i,r=!1){zf.set(i);const s=r?zf.col:this.denormalizeCol(zf.col,zf.world);return Array.isArray(e)?VS(e,this.getXForColumn(s),this.getYForRow(zf.row)):(e.x=this.getXForColumn(s),e.y=this.getYForRow(zf.row)),e}},ine=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:i,colFrom:r,colTo:s}of this.spans)for(let n=r;n<=s;n++){const o=e.getWorldForColumn(n);yield new Jv(e.level,i,e.normalizeCol(n),o)}}forEach(e,i){const{spans:r,lodInfo:s}=this,{level:n}=s;if(r.length!==0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++)e.call(i,n,o,s.normalizeCol(c),s.getWorldForColumn(c))}};ine.pool=new Tl(ine);let PZ=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const Mn=new Jv("0/0/0/0");let CUt=class HGe{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,s]=e,[n,o]=i,a=n-r,l=o-s,c=l!==0?a/l:0,u=(Math.ceil(s)-s)*c,h=(Math.floor(s)-s)*c;return new HGe(r,Math.floor(s),Math.ceil(o),c,a<0?u:h,a<0?h:u,a<0?n:r,a<0?r:n)}constructor(e,i,r,s,n,o,a,l){this.x=e,this.ymin=i,this.ymax=r,this.invM=s,this.leftAdjust=n,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const jh=[[0,0],[0,0],[0,0],[0,0]],MUt=1e-6;let vSi=class{constructor(e,i=null,r=e.lods[0].level,s=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const n=e.lods.filter(a=>a.level>=r&&a.level<=s);this.minScale=n[0].scale,this.maxScale=n[n.length-1].scale;const o=this._lodInfos=n.map(a=>EUt.create(e,a,i));n.forEach((a,l)=>{this._infoByLevel[a.level]=o[l],this._infoByScale[a.scale]=o[l],this.scales[l]=a.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){Mn.set(i);const s=this._infoByLevel[Mn.level];return s?s.getTileBounds(e,Mn,r):e}getTileCoords(e,i,r=!1){Mn.set(i);const s=this._infoByLevel[Mn.level];return s?s.getTileCoords(e,Mn,r):e}getTileCoverage(e,i=192,r=!0,s="closest"){if(!r&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const n=s==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),o=ine.pool.acquire(n),a=this._wrap;let l,c,u,h=1/0,p=-1/0;const f=o.spans;jh[0][0]=jh[0][1]=jh[1][1]=jh[3][0]=-i,jh[1][0]=jh[2][0]=e.size[0]+i,jh[2][1]=jh[3][1]=e.size[1]+i;for(const b of jh)e.toMap(b,b),b[0]=n.getColumnForX(b[0]),b[1]=n.getRowForY(b[1]);const g=[];let y=3;for(let b=0;b<4;b++){if(jh[b][1]===jh[y][1]){y=b;continue}const w=CUt.create(jh[b],jh[y]);h=Math.min(w.ymin,h),p=Math.max(w.ymax,p),g[w.ymin]===void 0&&(g[w.ymin]=[]),g[w.ymin].push(w),y=b}if(h==null||p==null||p-h>100)return null;let v=[];for(l=h;l<p;){g[l]!=null&&(v=v.concat(g[l])),c=1/0,u=-1/0;for(let b=v.length-1;b>=0;b--){const w=v[b];c=Math.min(c,w.getLeftCol()),u=Math.max(u,w.getRightCol())}if(c=Math.floor(c),u=Math.floor(u),l>=n.first[1]&&l<=n.last[1])if(a)if(n.size[0]<n.worldSize[0]){const b=Math.floor(u/n.worldSize[0]);for(let w=Math.floor(c/n.worldSize[0]);w<=b;w++)f.push(new PZ(l,Math.max(n.getFirstColumnForWorld(w),c),Math.min(n.getLastColumnForWorld(w),u)))}else f.push(new PZ(l,c,u));else c>n.last[0]||u<n.first[0]||(c=Math.max(c,n.first[0]),u=Math.min(u,n.last[0]),f.push(new PZ(l,c,u)));l+=1;for(let b=v.length-1;b>=0;b--){const w=v[b];w.ymax>=l?w.incrRow():v.splice(b,1)}}return o}getTileParentId(e){Mn.set(e);const i=this._infoByLevel[Mn.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(Mn,this._lodInfos[r],Mn),Mn.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){Mn.set(i);const r=this._infoByLevel[Mn.level],s=e.lodInfo;if(s.resolution>r.resolution){this._getTileIdAtLOD(Mn,s,Mn);const o=s.denormalizeCol(Mn.col,Mn.world);for(const a of e.spans)if(a.row===Mn.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(s.resolution<r.resolution){const[o,a,l,c]=e.spans.reduce((y,v)=>(y[0]=Math.min(y[0],v.row),y[1]=Math.max(y[1],v.row),y[2]=Math.min(y[2],v.colFrom),y[3]=Math.max(y[3],v.colTo),y),[1/0,-1/0,1/0,-1/0]),u=r.denormalizeCol(Mn.col,Mn.world),h=s.getColumnForX(r.getXForColumn(u)),p=s.getRowForY(r.getYForRow(Mn.row)),f=s.getColumnForX(r.getXForColumn(u+1))-1,g=s.getRowForY(r.getYForRow(Mn.row+1))-1;return!(h>c||f<l||p>a||g<o)}const n=s.denormalizeCol(Mn.col,Mn.world);return e.spans.some(o=>o.row===Mn.row&&o.colFrom<=n&&o.colTo>=n)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const s=Cv(this.tileInfo.spatialReference),n=-r*(s.valid[1]-s.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+MUt)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,s)=>Math.abs(s-e)<Math.abs(r-e)?s:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}zoomToScale(e){return this.tileInfo.zoomToScale(e)}_getTileIdAtLOD(e,i,r){const s=this._infoByLevel[r.level];return e.set(r),i.resolution<s.resolution?null:(i.resolution===s.resolution||(e.level=i.level,e.col=Math.floor(r.col*s.resolution/i.resolution+.01),e.row=Math.floor(r.row*s.resolution/i.resolution+.01)),e)}},AUt=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},RUt=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new KV,this._controllers=new KV,this._processingItems=new KV,this._pausedSignal=s0(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new Aj(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&i&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=Zr(this._schedule),this._task=Zr(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const s=new AbortController;let n=null;i&&(n=oo(i,()=>s.abort()));const o=()=>{const u=this._processingItems.get(e);u&&u.controller.abort(),a(),c.reject(Yi())},a=()=>{l.remove(),n?.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=xk(s.signal,o),c=lo();return this._deferreds.set(e,c),this._controllers.set(e,s),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject(Yi("Removed from queue")),this._removeItem(e)),e}reset(){const e=[];this._processingItems.forEach(i=>e.push(i)),this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=dC(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let i;const r=new AbortController,s=new AUt(e,r);this._processingItems.set(e,s);try{i=this.process(e,r.signal)}catch(n){this._processError(s,n)}Lh(i)?(s.promise=i,i.then(n=>this._processResult(s,n),n=>this._processError(s,n))):this._processResult(s,i)}get test(){}};function PUt(t,e){return t.length=0,e.forEach(i=>t.push(i)),t}const OZ=new Set,RB=[],GM=new Map,FSe=[0,0];let GS=class extends Fe{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:i,strategy:r}=this;this._queue=new RUt({concurrency:e,process:(s,n)=>{const o=this._keyToItem.get(s);return i(o,{signal:n})},peeker:r==="scale-first"?s=>this._peekByScaleFirst(s):s=>this._peekByCenterFirst(s)})}destroy(){this.clear(),this._queue=Ge(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const i=typeof e=="string"?e:e.id;return this.has(i)&&this._queue.isOngoing(i)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),s=()=>{this._keyToItem.delete(i)};return this._keyToItem.set(i,e),r.then(s,s),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;e.forEach(u=>{const h=this._keyToItem.get(u),p=this.tileInfoView.getTileScale(h.key);GM.has(p)||(GM.set(p,[]),r=Math.max(p,r),s=Math.min(p,s)),GM.get(p).push(h.key),OZ.add(p)});let n=this.state.scale;GM.has(n)||(PUt(RB,OZ),RB.sort((u,h)=>u-h),n=RB.reduce((u,h)=>Math.abs(h-n)<Math.abs(u-n)?h:u,RB[0])),n=Math.min(n,r),n=Math.max(n,s);const o=GM.get(n),a=i.getClosestInfoForScale(n),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((u,h)=>{const p=a.denormalizeCol(u.col,u.world),f=a.denormalizeCol(h.col,h.world);return Math.sqrt((l-p)*(l-p)+(c-u.row)*(c-u.row))-Math.sqrt((l-f)*(l-f)+(c-h.row)*(c-h.row))}),OZ.clear(),GM.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView,r=this.state.center;let s,n=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);i.getTileCoords(FSe,a.key);const l=dx(FSe,r);l<n&&(n=l,s=a.key)}),s.id}};d([m({constructOnly:!0})],GS.prototype,"concurrency",void 0),d([m({constructOnly:!0})],GS.prototype,"process",void 0),d([m()],GS.prototype,"state",void 0),d([m({constructOnly:!0})],GS.prototype,"strategy",void 0),d([m({constructOnly:!0})],GS.prototype,"tileInfoView",void 0),GS=d([N("esri.views.2d.tiling.TileQueue")],GS);new Jv(0,0,0,0);let OUt=class{constructor(e,i){this.sourceTile=i,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},IUt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function kSe(t,e,i,r,s,n){const o=i-s;if(o>=0)return(e>>o)+(r-(n<<o))*(t>>o);const a=-o;return e-(n-(r<<a))*(t>>a)<<a}let qGe=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(e,i,r,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function $Ut(t,e,i,r,s,n,o){const a=e[r++];for(let l=0;l<a;l++){const c=new OUt(n,o);c.xTile=e[r++],c.yTile=e[r++],c.hash=e[r++],c.priority=e[r++],c.featureIndex=e[r++];const u=e[r++];for(let f=0;f<u;f++){const g=e[r++],y=e[r++],v=e[r++],b=e[r++],w=!!e[r++],x=e[r++],S=i[r++],E=i[r++],C=e[r++],R=e[r++];c.colliders.push({xTile:g,yTile:y,dxPixels:v,dyPixels:b,hard:w,partIndex:x,width:C,height:R,minLod:S,maxLod:E})}const h=t[r++];for(let f=0;f<h;f++)c.textVertexRanges.push([t[r++],t[r++]]);const p=t[r++];for(let f=0;f<p;f++)c.iconVertexRanges.push([t[r++],t[r++]]);s.push(c)}return r}function NUt(t,e,i){for(const[r,s]of t.symbols)LUt(t,e,i,s,r)}function LUt(t,e,i,r,s){const n=t.layerData.get(s);if(n.type===lh.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],u=c.startOpacity,h=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&h===0;const p=i?Math.floor(127*u)|h<<7:h?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.iconVertexRanges)for(let h=c;h<c+u;h+=4)n.iconOpacity[h/4]=l;if(o.selectedForRendering){const c=a.parts[1],u=c.startOpacity,h=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&h===0;const p=i?Math.floor(127*u)|h<<7:h?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.textVertexRanges)for(let h=c;h<c+u;h+=4)n.textOpacity[h/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}function DUt(t,e,i,r){const s=t.colliders;let n,o,a,l;for(const c of s)if(t.unique.show&&t.unique.parts[c.partIndex].show&&(n=c.xScreen-r[0]+c.dxScreen,o=c.yScreen-r[1]+c.dyScreen,a=n+c.width,l=o+c.height,eIt(i,e.x,e.y,n,o,a,l)))return!0;return!1}let A7=class{constructor(e,i){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let r=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[r++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},FUt=class extends A7{constructor(e,i){super(e,i),this.type=lh.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=r[s++],l=r[s++],c=r[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=jt(this.vao)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=Vr.createVertex(e,wr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=Vr.createIndex(e,wr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=this.layer.lineMaterial;this.vao=new gg(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}},kUt=class extends A7{constructor(e,i){super(e,i),this.type=lh.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=r[s++],l=r[s++],c=r[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=jt(this.fillVAO),this.outlineVAO=jt(this.outlineVAO)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=Vr.createVertex(e,wr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=Vr.createIndex(e,wr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=s[r++],h=Vr.createVertex(e,wr.STATIC_DRAW,new Int32Array(n.buffer,4*r,u));r+=u;const p=s[r++],f=Vr.createIndex(e,wr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,p));r+=p;const g=this.layer,y=g.fillMaterial,v=g.outlineMaterial;this.fillVAO=new gg(e,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new gg(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:h},f)}},UUt=class extends A7{constructor(e,i,r){super(e,i),this.type=lh.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++],c=s[a++],u=s[a++],h=new Jv(l,c,u,0),p=s[a++];for(let v=0;v<p;v++){const b=s[a++],w=s[a++],x=s[a++];this.iconPerPageElementsMap.set(b,[w,x])}const f=s[a++];for(let v=0;v<f;v++){const b=s[a++],w=s[a++],x=s[a++];this.glyphPerPageElementsMap.set(b,[w,x])}const g=s[a++],y=s[a++];this.iconOpacity=new Int32Array(g),this.textOpacity=new Int32Array(y),a=$Ut(s,n,o,a,this.symbols,r,h),this.bufferDataOffset=a}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+Ww(this.iconOpacity)+Ww(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[i,r]of this.iconPerPageElementsMap)e+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){this.iconVAO=jt(this.iconVAO),this.textVAO=jt(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,i=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===i.usedMemory&&i.setSubData(e,0,0,e.length);const r=this.textOpacity,s=this.textVAO.vertexBuffers.opacity;r.length>0&&r.byteLength===s.usedMemory&&s.setSubData(r,0,0,r.length)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=Vr.createVertex(e,wr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=Vr.createIndex(e,wr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=s[r++],h=Vr.createVertex(e,wr.STATIC_DRAW,new Int32Array(n.buffer,4*r,u));r+=u;const p=s[r++],f=Vr.createIndex(e,wr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,p));r+=p;const g=Vr.createVertex(e,wr.STATIC_DRAW,this.iconOpacity.buffer),y=Vr.createVertex(e,wr.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,b=v.iconMaterial,w=v.textMaterial;this.iconVAO=new gg(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a,opacity:g},c),this.textVAO=new gg(e,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:h,opacity:y},f)}},BUt=class extends A7{constructor(e,i){super(e,i),this.type=lh.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=jt(this.vao)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=Vr.createVertex(e,wr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=Vr.createIndex(e,wr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=this.layer.circleMaterial;this.vao=new gg(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}};const ISi=!0,zUt=32,rne=200;let VUt=class extends un{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const i=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i?.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=lo(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=lo(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver?.(),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,i){const r=ae("mapview-transitions-duration")===0?0:1/ae("mapview-transitions-duration");if(this.fadeTransitionEnabled&&r!==0){const s=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===s)this.computedVisible=this.visible;else{const o=e*r;this.computedOpacity=n>s?Math.max(s,n-o):Math.min(s,n+o),this.computedVisible=this.computedOpacity>0;const a=s===this.computedOpacity;this.inFadeTransition=!a,a||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},WGe=class extends VUt{constructor(e,i,r,s,n,o,a=n,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new Jv(e),this.resolution=i,this.x=r,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;Jce(r,o,0,0,0,a,0,s,n,1),UO(this.transforms.displayViewScreenMat3,e.displayViewMat3,r)}get destroyed(){return this._destroyed}},LSi=class YGe extends WGe{constructor(e,i,r,s,n,o,a,l=null){super(e,i,r,s,n,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<rne}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<rne)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){let i=!1;for(const r of e){const s=this.layerData.get(r);s&&(this._memoryUsedByLayerData-=s.memoryUsed,s.type===lh.SYMBOL&&this.symbols.delete(r)&&(i=!0),s.destroy(),this.layerData.delete(r))}this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&(this.featureIndex?.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){this.status!=="unloaded"&&(this.featureIndex=null,XGe.delete(this),YGe._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(e){this.featureIndex?.clear();let i=!1;if(e){const{bucketsWithData:r,emptyBuckets:s}=e,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===lh.SYMBOL&&(this.symbols.set(o,a.symbols),i=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a);this._memCache?.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const[r,s]of this.layerData)s.type===lh.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const i=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,s=this.height/this.rangeY*i,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;u9(o),BO(o,o,n),h9(o,o,Math.PI*e.rotation/180),jk(o,o,[r,s,1])}_createTransforms(){return{displayViewScreenMat3:pE(),tileMat3:pE(),tileUnitsToPixels:pE()}}static _destroyRenderBuckets(e){if(!e)return;const i=new Set;for(const r of e.values())i.has(r)||(r.destroy(),i.add(r));e.clear()}_createRenderBuckets(e){const i=new Map,r=new Map;for(const s of e){const n=this._deserializeBucket(s,r);for(const o of n.layerUIDs)i.set(o,n)}return i}_deserializeBucket(e,i){let r=i.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case lh.FILL:r=new kUt(e,this.styleRepository);break;case lh.LINE:r=new FUt(e,this.styleRepository);break;case lh.SYMBOL:r=new UUt(e,this.styleRepository,this);break;case lh.CIRCLE:r=new BUt(e,this.styleRepository)}return i.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const i=this.layerData.get(e);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(e)}};const XGe=new Map;function GUt(){XGe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(i=>console.log(i)),console.log("========"),t[1].forEach(i=>console.log(i))})}let jUt=class{constructor(e="scene"){this.context=e,this.extent=Hd()}};const FSi={value:.5,readOnly:!0},HUt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let cP=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},qUt=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},WUt=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new qUt(r,i)}computeMinMaxValue(e,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,h=.5*aue;let p=(c-1)/o,f=(r-this.j*o)*p,g=(i-this.i*o)*p;if(p<1){const y=Math.floor(f),v=Math.floor(g),b=y+v*c,w=u[b],x=u[b+1],S=u[b+c],E=u[b+c+1];if(w+x+S+E<h){const C=f-y,R=g-v,I=MU(w,x,S,E,C,R),F=MU(w,x,S,E,C+p,R),D=MU(w,x,S,E,C,R+p),z=MU(w,x,S,E,C+p,R+p);return s.min=Math.min(I,F,D,z),s.max=Math.max(I,F,D,z),s}f=y,g=v,p=1}else f=Math.floor(f),g=Math.floor(g),p=Math.ceil(p);for(let y=f;y<=f+p;y++)for(let v=g;v<=g+p;v++){const b=u[y+v*c];b<h?(a=Math.min(a,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const YUt=.5*aue;function js(t,e,i){if(i==null)return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=$e(r.dy*(r.y1-e),0,s),o=$e(r.dx*(t-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.data.width,u=a*c+l,h=r.data.values,p=h[u],f=h[u+1],g=u+c,y=h[g],v=h[g+1];if(p+y+f+v<YUt){n-=a,o-=l;const b=p+(f-p)*o;return b+(y+(v-y)*o-b)*n}}return null}var It;(function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"})(It||(It={}));function ZGe(t){return rpe(t)||pC(t)||fC(t)}function rpe(t){return Uv(t)||mO(t)}const jM=M(),XUt=M(),u_=M(),h_=M();function ZUt(t,e,i=0){const r=t.extent;if(r==null)return!1;if(i===0)return cOe(r,e);const s=Math.min(r[2]-r[0],r[3]-r[1]);return Ztt(r,e,i*s)}function PB(t,e,i,r){ge(jM,i),jM[r]=e[r];const s=Me(jM,jM,e),n=Me(XUt,t,e),o=xe(n,s),a=xe(s,s);let l;l=o<=0?e:a<=o?i:Te(jM,e,ce(s,s,o/a));const c=Me(jM,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function JUt(t,e,i){const r=t.extent;if(r==null)return 0;u_[0]=r[0],u_[1]=r[1],u_[2]=i,h_[0]=r[2],h_[1]=r[3],h_[2]=i;let s=1/0,n=1/0;return e[0]<u_[0]?s=PB(e,u_,h_,0):e[0]>h_[0]&&(s=PB(e,h_,u_,0)),e[1]<u_[1]?n=PB(e,u_,h_,1):e[1]>h_[1]&&(n=PB(e,h_,u_,1)),Math.min(s,n)}function QUt(t,e,i,r){if(t==null)return oue();const s=t.spatialReference;if(s.isGeographic&&!rpe(s))return new j("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const n=ph.checkUnsupported(t);return n??(i==null?new j("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):KUt(t,i)||(e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new j("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function KUt(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,s=[r*t.size[0],r*t.size[1]],n=[t.origin.x,t.origin.y],o=lOe(e),a=li();ph.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>VR){const c=i[0].scale*2**i[0].level;let u=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/r;const h=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**h)*10**h,new j("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:VR})}return null}const e5t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:QUt,isInsideExtent:ZUt,tiltToExtentEdge:JUt},Symbol.toStringTag,{value:"Module"}));function t5t(){return!0}function i5t(){return 0}function r5t(t,e,i,r){if(t==null)return oue();const s=t?.lods.length-1,n=t.spatialReference;if(n.isWebMercator){if(!ph.makeWebMercatorAuxiliarySphere(s).compatibleWith(t,r))return new j("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!ZGe(n))return new j("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!ph.makeGCSWithTileSize(t.spatialReference,t.size[0],s).compatibleWith(t,r))return t.spatialReference.isWGS84?new j("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new j("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?null:new j("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const s5t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:r5t,isInsideExtent:t5t,tiltToExtentEdge:i5t},Symbol.toStringTag,{value:"Module"})),n5t={[Xe.Global]:s5t,[Xe.Local]:e5t};function go(t,e){t||console.warn("Terrain: "+e)}let Go=!1,sH=!1;function o5t(t){sH=t,Go=Go||t}function a5t(t){Go=t}function qe(t,e){if(Go&&!t){const i=new Error().stack?.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function sne(t){return spe(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function nH(t){return t?.type==="imagery-tile"||t?.type==="wcs"}function spe(t){return t?.type==="imagery-tile-3d"}function JGe(t){return t?.type==="tile-3d"}function hI(t){return t?.type==="vector-tile-3d"}function QGe(t){return t?.type==="wmts-3d"}function nne(t){return t?.type==="elevation-3d"}function T3(t){return t?.type==="group"}function ZF(t){return t&&(JGe(t)||QGe(t)||spe(t)||hI(t))}function one(t){return t&&(JGe(t)||spe(t)||hI(t)||QGe(t))}function ane(t){return one(t)||nne(t)}function l5t(t){return UGe(t?.sourceLayerInfo?.data)}function c5t(t){return KGe(t?.sourceLayerInfo)||!!t?.isVTLBackground}function u5t(t){return BGe(t?.sourceLayerInfo?.data)}function h5t(t){const e=t?.sourceLayerInfo?.data;return M7(e)||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData}function KGe(t){return cR(t?.data)}function XP(t){return t!=null&&"release"in t&&t.release(),null}function zSi(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function npe(t,e,i,r,s){return n5t[r].checkIfTileInfoSupportedForViewSR(t,i,e,s)}function R7(t,e,i){let r=null,s=null;if(t?.type==="wmts"){const o=d5t(t,e,i);r=o.tileInfo,s=o.fullExtent}else{s=nH(t)?t.getCompatibleFullExtent(e):t.fullExtent;const o=i===Xe.Local;nH(t)?r=t.getCompatibleTileInfo(e,s,o):t?.type==="vector-tile"?r=o&&!p5t(e)||f5t.force512VTL?t.tileInfo:t.tileInfo.getCompatibleForVTL(256):r=t.tileInfo}const n="tilemapCache"in t?t.tilemapCache?.effectiveMaxLOD:void 0;return r!=null&&s!=null&&npe(r,s,e,i,n)==null?{tileInfo:r,fullExtent:s}:null}function d5t(t,e,i){const r=KKe(t);if(r!=null){if(!ct.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>npe(n.tileInfo,n.fullExtent,e,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function p5t(t){return t.isWGS84||t.isWebMercator||mO(t)||!EE(t)}const f5t={force512VTL:!1};function USe(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function d_(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function Yp(t,e,i=y5t){return Math.abs(t-e)<i}function oH(t){return t===It.NORTH_EAST?It.SOUTH_WEST:t===It.NORTH_WEST?It.SOUTH_EAST:t===It.SOUTH_WEST?It.NORTH_EAST:It.NORTH_WEST}function ope(t){return t===It.NORTH?It.SOUTH:t===It.EAST?It.WEST:t===It.SOUTH?It.NORTH:It.EAST}function m5t(t){return t===It.NORTH_WEST||t===It.SOUTH_WEST}function g5t(t){return t===It.NORTH_WEST||t===It.NORTH_EAST}function BSe(t){return t===It.NORTH_WEST||t===It.WEST||t===It.SOUTH_WEST}function zSe(t){return t===It.NORTH_EAST||t===It.EAST||t===It.SOUTH_EAST}function VSe(t){return t===It.SOUTH_EAST||t===It.SOUTH||t===It.SOUTH_WEST}function GSe(t){return t===It.NORTH_EAST||t===It.NORTH||t===It.NORTH_WEST}const Xm=[It.NORTH,It.EAST,It.SOUTH,It.WEST],aH=[It.NORTH_EAST,It.SOUTH_EAST,It.SOUTH_WEST,It.NORTH_WEST],y5t=1e-5;let Rp=class extends Fe{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if("operationalLayerType"in r&&QKe(r.operationalLayerType)&&this.viewSpatialReference!=null){const s=e6e(r.fullExtent,this.viewSpatialReference);s!=null&&e.push(lOe(s))}}),e}};function _5t(t,e){return t===Xe.Global?new lne(e):new cne(e)}d([m({readOnly:!0})],Rp.prototype,"layerViewsExtent",null),d([m({readOnly:!0})],Rp.prototype,"tiledLayersExtent",null),d([m({readOnly:!0})],Rp.prototype,"stencilEnabledExtents",null),d([m()],Rp.prototype,"viewSpatialReference",void 0),d([m()],Rp.prototype,"tilingScheme",void 0),d([m()],Rp.prototype,"defaultTiledLayersExtent",void 0),d([m({constructOnly:!0})],Rp.prototype,"layers",void 0),d([m({constructOnly:!0})],Rp.prototype,"layerViews",void 0),Rp=d([N("esri.views.3d.terrain.ExtentHelper")],Rp);let lne=class extends Rp{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?tLe:$dt}};lne=d([N("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],lne);let cne=class extends Rp{_computeLayerViewsExtent(){const e=Hd(),i=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=e6e("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,i);Iw(e,a,e)}});const r=UK(e)?e:null,s=this._get("layerViewsExtent");return X2(r,s)?s:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=Hd();this.layers.forEach(o=>{if(o.loaded&&KL(o)){const a=R7(o,i,Xe.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a,u="tilemapCache"in o?o.tilemapCache?.effectiveMaxLOD:void 0;l!=null&&c!=null&&(nH(o)||e.compatibleWith(l,u)&&c.spatialReference.equals(e.spatialReference))&&Iw(r,c,r)}}),Iw(r,this.defaultTiledLayersExtent,r);const s=UK(r)?r:null,n=this._get("tiledLayersExtent");return X2(s,n)?n:s}};function e6e(t,e){return t==null||t.spatialReference.equals(e)?t:sD(t,t.spatialReference,e)}cne=d([N("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],cne);function t6e(){const t=globalThis.require?.modules;if(t){const e=Object.keys(t);for(const i of e)i.includes(".glsl")&&delete t[i]}}const i6e=1.3,v5t=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let eb,mu=class extends Fe{constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=ae("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){const e=this.view;this.renderer=new Sp({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.plugins.add(this.renderer);const i=()=>this.setDrawTexturesDirty();this._groundIntersector=pf(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([_e(()=>this.renderer.hasHighlights,i),this.renderer.events.on("has-water",r=>e._stage?.renderer.setParameters({hasOverlayWater:r})),this.renderer.events.on("content-changed",i),_e(()=>e.state.camera.pixelRatio,i),_e(()=>e.state.alignPixelEnabled,i),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),_e(()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),_e(()=>[e.state?.pixelRatio,e.state?.contentPixelRatio],()=>this.setPlacementDirty(),Mr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(Ut.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(_h,r.camera,vr.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(vr.BACKGROUND,r)})]),e._stage.renderer.renderOverlay=r=>this._renderOverlay(r)}destroy(){this.view?._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{}),eb&&(eb.hide(),eb=null),this.renderer=Ge(this.renderer)}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||ts.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?$r(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return i6e/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}_renderOverlay(e){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._dispatchAnimationUpdate(e),this._drawOverlays(vr.UPDATE,this.view.state)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const i=this.view.renderSpatialReference;e!=null&&i!=null?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new tx(-20037508342787e-6,20037508342787e-6):new tx(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,i,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,i,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,ud)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,vr.UPDATE)}_updateOverlays(e,i,r){if(!this._spatialReference)return Wa;const s=this._computeOverlayResolution(i);this._computeOverlayExtents(i,s,qg),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,qg.stretch);const n=this._updateOverlay(io.INNER,qg.inner,s,1*qg.pixelRatioAdjustment,qg.mapUnitsPerPixel),o=Kl(qg.inner)/Kl(qg.outer),a=this._updateOverlay(io.OUTER,qg.outer,s,o*qg.pixelRatioAdjustment,qg.mapUnitsPerPixel);n!==Ty.EXTENT&&a!==Ty.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(r)),n===Ty.NONE&&a===Ty.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const i=this.view.state.contentPixelRatio*this.view.resolutionScale,r=e.fullWidth/e.pixelRatio*i,s=e.fullHeight/e.pixelRatio*i,n=Math.ceil(1.5*Math.max(r,s));return Math.min(Fw(n),this._maxResolution)}_updateOverlay(e,i,r,s,n){if(this.renderer.overlays.length===0)return Ty.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,b5t(i,o.extent)&&r===o.resolution)return a===n?Ty.NONE:Ty.RERENDER_ONLY;zv(o.extent,i),o.resolution=r;const l=Kle(o.extent);return o.renderLocalOrigin=N8(l[0],l[1],0,"OV_"+this._latestOriginId++),Ty.EXTENT}setTileParameters(e){const i=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[io.INNER],s=this.renderer.overlays[io.OUTER],n=e.extent;this._rectInsideRect(r.extent,n)||this._rectanglesOverlap(n,r.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,io.INNER,i),this._setTileOverlayData(n,io.OUTER,i)):(this._clearTileOverlayData(io.INNER,i),this._clearTileOverlayData(io.OUTER,i))}else this._clearTileOverlayData(io.INNER,i),this._clearTileOverlayData(io.OUTER,i)}overlayPixelSizeInMapUnits(e,i){if(this.renderer.overlays.length===0)return i();const r=this.renderer.overlays[io.INNER],s=this.renderer.overlays[io.OUTER],n=this._pointIsInExtent(e,r.extent)?r:s;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,i,r){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[i].extent,n=Kl(s),o=Au(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}r.setScale(i,Kl(e)/n,Au(e)/o),r.setOffset(i,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}async reloadShaders(){t6e(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(_h)}_dispatchAnimationUpdate(e){const i=e-this._animationTimeLast;if(i>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=i/this.surface.view._stage.renderer.animationTimeDilation,s=new D4e(this.view.state.camera,r,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,s){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,T5t,i,r);if(n==null)return!1;const o=n.origin,a=Te(OB,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=$e(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const u=OB;BI(r9(s9,$r(this.view.spatialReference).radius+l),Yd(e.eye,e.viewForward),u),Me(u,u,e.eye);const h=ix.normalize(n3e(e.viewForward,u,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:s;r=c?p*h:h+p*(1-h)}else{const u=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(u),p=ni(0,h,1,0),f=xh(p,p,e.projectionMatrix)[1],g=$e(.5+.5*f,0,1);r=g===1||g===0?.5:c?g*s:1-(1-g)*s}return!!this._intersectGroundFromView(e,.5,r,i)&&lF(i,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,i,r){const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=M();this._findHorizonBasedPointOfInterest(e,n)||ge(n,s),ts.OVERLAY_SHOW_CENTER?(eb==null&&(eb=new uR(this.view.graphics,"red")),eb.show(n,this._renderSR)):eb?.hide();const o=Math.max(.1,jr(e.eye,n)),a=mx(this.view.renderCoordsHelper,s,e.eye);this._overlaySREqualsRenderSR||wa(n,this._renderSR,n,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference?.isGeographic,u=c&&this._spatialReference?1/$r(this._spatialReference).metersPerDegree:1,h=this.view.state.contentPixelRatio,p=e.perScreenPixelRatio/h*o*u;r.mapUnitsPerPixel=p/this._worldToPCSRatio,r.stretch=this._overlayStretch;let f=i*p/2*r.stretch,g=!1,y=c?90:1/0;this._isSpherical&&l&&this._spatialReference&&(this._spatialReference.isWebMercator?(f/=Math.cos(nj(n[1])),y=l[3]):(g=!0,f/=$r(this._spatialReference).metersPerDegree,y=90),f>=y&&(f=y,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let v=1;g&&(v=1/Math.max(.2,Math.cos(Math.abs(Gt(n[1])))),f*v>180&&(v=180/f),r.mapUnitsPerPixel*=v);const b=Math.log(2)/12;f=Math.exp(Math.round(Math.log(f)/b)*b);const w=f*v,x=32,S=.5*i/(x*w),E=.5*i/(x*f);n[0]=Math.round(n[0]*S)/S,n[1]=Math.round(n[1]*E)/E;const C=r.inner;C[0]=n[0]-w,C[1]=n[1]-f,C[2]=n[0]+w,C[3]=n[1]+f,this._isSpherical&&this._shiftExtentToFitBounds(C,1/0,y);const R=r.outer;if(6*w>Kl(l))zv(R,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)R[0]=C[0]-w,R[1]=C[1]-f,R[2]=C[2]+w,R[3]=C[3]+f;else{wa(e.eye,this._renderSR,OB,this._spatialReference),By(jS,n,OB);let F=-Math.atan2(jS[1],jS[0])+.125*Math.PI;F<0&&(F+=2*Math.PI);const D=Math.floor(F/(.25*Math.PI));UE(jS,v5t[D],2*f),jS[0]*=v,jS[2]*=v,Ice(R,C,jS)}if(this._isSpherical)R[0]=this._longitudeCyclical.clamp(R[0]),R[2]=this._longitudeCyclical.clamp(R[2]),R[1]=Math.max(R[1],-y),R[3]=Math.min(R[3],y);else{const F=BK(C,l,x5t),D=BK(R,l,S5t);bge(F,D)&&(R[2]=R[0],R[3]=R[1])}const I=Math.abs(C[2]-C[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,I),r.pixelRatioAdjustment=r.mapUnitsPerPixel/I}_drawOverlays(e,i){if(!this.renderer.hasOverlays)return;if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const r=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const s=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(i),s!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(vr.UPDATE),r?(this.surface.requestRender(e),e===vr.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(vr.BACKGROUND),this.renderer}_rectanglesOverlap(e,i){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(i[0],i[2],e[0])||this._longitudeCyclical.contains(i[0],i[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],i[0]))&&!(e[1]>i[3]||e[3]<i[1]):Nq(e,i))}_rectInsideRect(e,i){return i!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],i[0])&&this._longitudeCyclical.contains(e[0],e[2],i[2])&&i[1]>e[1]&&i[3]<e[3]:bge(e,i))}_pointIsInExtent(e,i){if(this._longitudeCyclical)return this._longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,s=e.y;return r>i[0]&&r<i[2]&&s>i[1]&&s<i[3]}_shiftExtentToFitBounds(e,i,r){let s=0,n=0;e[0]<-i?s=e[0]+i:e[2]>i&&(s=i-e[2]),e[1]<-r?n=e[1]+r:e[3]>r&&(n=r-e[3]),mj(e,s,n)}get test(){}};function b5t(t,e){const r=ts.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}d([m()],mu.prototype,"_spatialReference",void 0),d([m({readOnly:!0})],mu.prototype,"running",null),d([m()],mu.prototype,"_placementDirty",void 0),d([m()],mu.prototype,"_contentUpdated",void 0),d([m()],mu.prototype,"_isSpherical",null),d([m()],mu.prototype,"_worldToPCSRatio",null),d([m()],mu.prototype,"renderer",void 0),d([m({constructOnly:!0})],mu.prototype,"view",void 0),d([m({constructOnly:!0})],mu.prototype,"surface",void 0),d([m()],mu.prototype,"suspended",null),d([m()],mu.prototype,"updating",null),d([m({type:Boolean})],mu.prototype,"rendersOccludedDraped",null),mu=d([N("esri.views.3d.terrain.OverlayManager")],mu);let w5t=class{constructor(){this.inner=li(),this.outer=li(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=i6e}};const jS=pi(),OB=M(),qg=new w5t,x5t=li(),S5t=li(),T5t=jo();var Ty;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(Ty||(Ty={}));let E5t=class{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=hs(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=yi(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,hs(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(e){return this.outerEdgesOffsetAndLength[2*e]}getEdgeCount(e){return this.outerEdgesOffsetAndLength[2*e+1]}getEdgeVertexIndex(e,i){return this.getEdgeAttributeIndex(e,i)}getEdgeVertexPosition(e,i,r,s){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(e,s),i),Te(i,i,r)}getEdgeNormal(e,i,r){const{typedBuffer:s,typedBufferStride:n}=this.vertexAttributes.normalCompressed;GAt(i,s,this.getEdgeAttributeIndex(e,r),n)}setEdgeNormalFromValues(e,i,r,s,n){this._setNormal(this.getEdgeAttributeIndex(e,i),r,s,n)}setEdgeVertexFromValuesRawPositionUV(e,i,r,s,n,o,a){const l=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(l,r,s,n),this._setUV(l,o,a)}setEdgeVertexFromValuesRawPositionUVNormal(e,i,r,s,n,o,a,l,c,u){const h=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(h,r,s,n),this._setUV(h,o,a),this._setNormal(h,l,c,u)}_getEdgeVertexRaw(e,i){this.vertexAttributes.position.getVec(e,i)}_setNormal(e,i,r,s){const{typedBuffer:n,typedBufferStride:o}=this.vertexAttributes.normalCompressed;gf(n,e,i,r,s,o)}_setUV(e,i,r){ig(this.vertexAttributes.uv0,e,i,r)}getEdgeAttributeIndex(e,i){return qe(0<=i&&i<this.getEdgeCount(e)),this.getEdgeFirstVertexIndex(e)+i}};const jSe=16384;function ig(t,e,i,r){t.setValues(e,i*jSe,r*jSe)}let C5t=class{constructor(){this.sinLonLUT=new Array(dN+1),this.cosLonLUT=new Array(dN+1),this.sinLatLUT=new Array(dN+1),this.cosLatLUT=new Array(dN+1)}update(e,i,r){const s=i[0],n=i[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},M5t=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}},r6e=class LG{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Ge(this._current),this._next=Ge(this._next),this._waiting=Ge(this._waiting),this._delayed=Ge(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let e=LG.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,Gw.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==qn.FADING,n=e-this._fadeStart>=i;(r||s||n)&&(Ge(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=LG.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(e,i=Gw.Immediate){this._delayed=Ge(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const r=LG.test.fadeMoment||performance.now();return i!==Gw.Immediate?(this._delayed=e,void(this._delayedTime=r+i)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(e!=null&&(Ge(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}};var Gw;r6e.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(Gw||(Gw={}));var dI;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(dI||(dI={}));let s6e=class{constructor(){this._queue=new ci,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e?.[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},A5t=class{constructor(){this._q=new ci}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.isLeaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function UD(t,e,i){if(e?.fullExtent==null)return!1;const r=e.fullExtent,s=t.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function e0(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function R5t(t,e,i=null){i==null||i.length===0?t===dI.BACK_TO_FRONT?e.sort(P5t):e.sort(O5t):e.sort((r,s)=>I5t(r,s,t,i))}function P5t(t,e){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function O5t(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function n6e(t,e,i){const r=t.screenDepth,s=e.screenDepth;return r<s?-i:r>s?i:e0(t,e)}function I5t(t,e,i,r){return HSe(t,r)===HSe(e,r)?n6e(t,e,i):t?i:-i}function HSe(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function $5t(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function N5t(t,e){const i=t.length;for(let r=0;r<i;++r)t.at(r).updateDistanceToPOI(e);t.sort($5t)}function L5t(t,e,i){let r=1,s=0,n=0;for(;t!==e;)if(r*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),1&t.lij[1]||(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,s,n,r)}function D5t(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i)return!0}}return!1}function QSi(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,s=i?e:t,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}let ape=class{get updating(){return!!this._tileRequested}init(e,i,r,s){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,i){this._setUpsampleTile(e,i),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,qn.FADING,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),s=sne(r),{minLevel:n,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?UD:()=>!0;let u=this.tile;const h=u.level;let p;const f=this._tileLayerInfo.upsampleInfo,g=f!=null?f.tile.level:-1,y=f!=null&&g-h>=a,v=s?.tilemapCache,b=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;u&&c(u,s,!1)&&u.level>=n;){const w=u.level,x=h-w,S=u.layerInfo[i][e];if(S.data&&x>=a){(!y||w>g)&&this._setUpsampleTile(u),S.dataInvalidated&&(p=u);break}const E=b?.getLevelRowColumn(u.lij)??u.lij;if(v?.getAvailability(E[0],E[1],E[2])!=="unavailable"&&w<=o&&!S.data&&!S.dataMissing&&((!p||u.level===n||w%eLe==0||h-p.level<a)&&(p=u),x>=l))break;u=u.parent}if(p!=null&&h-p.level<a)if(f)p=null;else{const w=this._findAncestorWithData();w!=null&&(this._setUpsampleTile(w),p=w.layerInfo[i][e].dataInvalidated?w:null)}return p}_findAncestorWithData(){const e=this.tile.elevationLevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=i)return s;r=s}return r}_setUpsampleTile(e,i){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,qn.FADING,i)}get test(){}},F5t=class extends ape{constructor(){super(...arguments),this.type="none"}get _desiredMinLevelDelta(){throw qSe}get _progressiveLevelModulo(){throw qSe}dispose(){}};const qSe=new Error("Abstract method called on TileAgent"),ju=new F5t;let k5t=class extends ape{constructor(){super(...arguments),this.type="elevation",this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}};function U5t(t){return t.type==="elevation"}let B5t=class extends ape{constructor(){super(),this.type="map",this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return eLe}};function z5t(t){return t.type==="map"}var Wl;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(Wl||(Wl={}));let DG=class{constructor(){this.waitingAgents=new ci,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const i=IZ.acquire();return i._init(e),i}release(){this.dispose(),FG.delete(this),IZ.release(this)}dispose(){this.loadingAgent=jt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=XP(this._data)}static prune(){IZ.prune(0)}_init(e){this.waitingAgents.clear(),this._data=XP(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=qc(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,i){if(e!==i&&i!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),L5t(e,i,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){XP(this._data),this._data=e}};const IZ=new Tl(DG,null,()=>{}),FG=new Map;function V5t(){FG.size>0&&(console.log(`${FG.size} live TilePerLayerInfo allocations:`),FG.forEach(t=>console.log(t,`
`)))}var Mt;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.GEOMETRY=8]="GEOMETRY",t[t.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=32]="TEXTURE_FADING"})(Mt||(Mt={}));const G5t=.1;let lpe=class{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=li(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=li(),this.centerAtSeaLevel=M(),this._center=[M(),Bn(),M()],this.up=jle(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=M(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){cpe.prune(0),upe.prune(0),DG.prune()}get _isCached(){return!this.isLeaf&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Hn.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,i=e?.frustumVisibility??Wl.INTERSECTS;this._frustumVisibility=i===Wl.INSIDE?Wl.INSIDE:i===Wl.OUTSIDE?Wl.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==Wl.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}init(e,i,r,s,n){this._lij[0]=e,this._lij[1]=i,this._lij[2]=r,this.ellipsoid=$r(n.tilingScheme.spatialReference),n.tilingScheme.getExtent(e,i,r,this.extent),n.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,n.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Hn.MIDDLE][3]=0,this.elevationLevel=e,s&&!Number.isNaN(s.elevationBoundsMin)?(this._elevationBoundsMin=s.elevationBoundsMin,this._elevationBoundsMax=s.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=s,this.unsetChildren(),this._surface=n,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const o of HT){const a=n.numLayers(o),l=this.layerInfo[o];for(const c of l)c.release();l.length=a;for(let c=0;c<a;c++)l[c]=DG.acquire(this._surface.upsampleInfoPool),o===ri.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(n.tilingScheme.pixelSize,dN)}dispose(){go(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of HT){for(const i of this.layerInfo[e])i.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[ri.MAP].reduce((e,{data:i})=>e+(cR(i)?i.usedMemory/i.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=this._baseUsedMemory,this._mapTileMemoryInternal=0;let e=0;for(const{data:r}of this.layerInfo[ri.MAP])cR(r)?e+=this._getTerrainDataMemory(r):this._mapTileMemoryInternal+=this._getTerrainDataMemory(r);const i=this._cpuImageMemorySize;for(const r of this.layerInfo[ri.ELEVATION])this._usedMemory+=r.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=this.renderData.texture?.usedMemory??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r?.data?e===ri.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):e===ri.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return BGe(e)?e.texture.usedMemory:UGe(e)?e.memoryUsage:cR(e)?e.usedMemory/e.referenced:M7(e)||e instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(e){const i=this._center[Hn.MIDDLE],r=e,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(e,i,r){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===Wl.OUTSIDE))return Mt.NONE;const s=this.level;Me($B,this._center[Hn.MIDDLE],i);let n=Ql($B),o=$B,a=this._center[Hn.MIDDLE];Me($Z,this._center[Hn.TOP],i);const l=Ql($Z);l<n&&(n=l,o=$Z,a=this._center[Hn.TOP]),Me(NZ,this._center[Hn.BOTTOM],i);const c=Ql(NZ);if(c<n&&(n=c,o=NZ,a=this._center[Hn.BOTTOM]),this._edgeLen2>n&&s<e.maxLod)return Mt.SPLIT;const u=Math.sqrt(n),h=e.fovX*u*2,p=this._edgeLen/h,f=()=>{if(s<e.maxLod)return this.elevationLevel=s,Mt.NONE;const R=s+Math.ceil(-Math.log2(e.relativeWidthLimit/p));return R!==this.elevationLevel?(this.elevationLevel=R,Mt.ELEVATION):Mt.NONE},g=r!=null?r-s:1/0;if(g<=.5)return f();const y=xe(this.up,$B),v=this._elevationBoundsMax-this._elevationBoundsMin,b=v/this.edgeLen;if(e.aboveGround&&y>0&&b<.001&&y/u-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return Mt.NONE;const w=r!=null?3-Math.min(g,2):1;if(p*w<e.relativeWidthLimit||s>=e.maxLod)return f();if(s<7)return Mt.SPLIT;ce(Aa,this.up,y),Me(Aa,Aa,o);const x=Ql(Aa);if(x<=this.radius*this.radius)return Mt.SPLIT;ce(Aa,Aa,this.radius/Math.sqrt(x)),Te(Aa,Aa,a),Me(Aa,i,Aa);const S=Math.min(1,(Math.abs(xe(Aa,this.up))+.5*v+this._curvatureHeight)/De(Aa)),E=G5t/e.angledSplitBias,C=e.fovY*u*2;return S*(this._edgeLen/C*w)<E*e.relativeHeightLimit?Mt.NONE:Mt.SPLIT}setChildren(e,i,r,s){go(!!(e&&i&&r&&s),"Null child passed");const n=this._children;return n[0]=e,n[1]=i,n[2]=r,n[3]=s,n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const e of HT)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const i of HT){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==ju&&(IB(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(Mt.GEOMETRY),this.resetPendingUpdate(Mt.TEXTURE_NOFADING),this.resetPendingUpdate(Mt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[ri.MAP];for(const i of e)i.loadingAgent&&i.loadingAgent!==ju&&(IB(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(X2(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(Mt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!r?.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of HT){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==ju&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(Mt.SPLIT)||e!==ri.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){const i=this._pendingUpdates;return this._pendingUpdates|=e,e===Mt.SPLIT||e===Mt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),i!==this._pendingUpdates}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const s=this.layerInfo[i][e];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e);const a=cR(s.data);return r.dataArrived(this,a),!0}if(s.requestPromise)return!0;qc(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this._lij[0]===e[0]&&this._lij[1]===e[1]&&this._lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return Ql(Me(Aa,this._center[Hn.MIDDLE],e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const s=this.layerInfo[i][e],n=s.waitingAgents,o=n.removeUnordered(r)!=null;go(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const s=cR(r),n=this.layerInfo[i][e];n.data=r,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i){const r=this.layerInfo[i][e];r.dataMissing=!0,r.waitingAgents.forAll(s=>s.dataMissing()),r.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i,r){switch(r&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,i)),e){case ri.MAP:return this._updateTexture(i);case ri.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===qn.FADING?Mt.TEXTURE_NOFADING:Mt.TEXTURE_FADING),this.setPendingUpdate(e===qn.FADING?Mt.TEXTURE_FADING:Mt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(Mt.GEOMETRY);for(const e of this.layerInfo[ri.ELEVATION])e.pendingUpdates|=Mt.GEOMETRY}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax;let r=1/0,s=-1/0;const n=this.layerInfo[ri.ELEVATION];let o=!0;for(const a of n)a.elevationBounds!=null&&(r=Math.min(r,a.elevationBounds.min),s=Math.max(s,a.elevationBounds.max),a.elevationBounds.hasNoDataValues||(o=!1));o&&(r=Math.min(r,0),s=Math.max(s,0)),e===r&&i===s||(this._elevationBoundsMin=r,this._elevationBoundsMax=s,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax,r=.5*(e+i),s=this._center;ce(Aa,this.up,r),Te(s[Hn.MIDDLE],this.centerAtSeaLevel,Aa),ce(Aa,this.up,e),Te(s[Hn.TOP],this.centerAtSeaLevel,Aa),ce(Aa,this.up,i),Te(s[Hn.BOTTOM],this.centerAtSeaLevel,Aa)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[ri.ELEVATION][e],s=this.elevationLevelDelta,n=Math.max(this.elevationLevel-s,0),o=r.elevationBounds;if(o!=null&&o.level>=i&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,ri.ELEVATION),l=sne(a);if(!UD(this,l,!1))return;const c=H5t;let u=!1;const h=r.data;if(h&&h.level<=n){const p=r.data;c.min=p.samplerData.data.minValue,c.max=p.samplerData.data.maxValue,c.hasNoDataValues=p.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let p,f,g=0;for(let y=this._parent;y&&(!f||g<s)&&(g=this.elevationLevel-y.level,p=f||p,f=y.layerInfo[ri.ELEVATION][e].data,!(!f&&p&&y.level<=n));y=y.parent);f=f||p,f&&(f.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],c),c.min!==1/0&&(c.level=f.level,u=!0))}u&&(r.elevationBounds==null&&(r.elevationBounds=new cP),r.elevationBounds.copyFrom(c))}modifyLayers(e,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==ju&&(IB(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:DG.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,qn.FADING))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===ju&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of HT){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==ju&&(r.loadingAgent.setSuspension(i),r.loadingAgent===ju&&this.updateRenderData(e,qn.FADING))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==ju&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=ju,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||vO(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){for(let s=e;s<i;++s){const n=this._surface.layerViewByIndex(s,r);if(ZF(n)&&n?.layer?.blendMode!=="normal"||vO(n?.layer?.parent)&&this._hasBlendableAncestor(n?.layer?.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const s=this._isSuspended(i);for(let n=e;n<r.length;++n){const o=r[n];let a=!1;const l=this._surface.layerViewByIndex(n,i),c=sne(l);if(o.loadingAgent?UD(this,c,!1)?(o.loadingAgent!==ju&&o.loadingAgent.setSuspension(s),o.loadingAgent!==ju&&(a=o.loadingAgent.update())):o.dispose():UD(this,c,!1)&&(o.loadingAgent=j5t(this,n,i,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===ju&&this.setPendingUpdate(Mt.GEOMETRY):(IB(o.loadingAgent),o.loadingAgent=ju)),o.loadingAgent===ju&&this.updateRenderData(i,qn.FADING),!this._hasBlendModes(e,r.length,i)&&a&&l.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.elevationLevel-this.level,r=Math.max(this.level-e,this.elevationLevelDelta-i),s=$e(1+(this.maxTesselation>>r),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(r!=null){for(const s of r)if(q5t(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!i(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(e,i){const r=this._lij,s=this.getNeighborLIJ(r,e);return s?kG(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(e,i){const r=e===It.NORTH_EAST?1:e===It.NORTH_WEST?0:e===It.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!i||!i(s));)s=s.children[r];return s}findNeighborCornerTileExact(e,i){return this.findNeighborTile(e,r=>i(r)||r.level===this.level)?.findCorner(oH(e),i)||null}forAllSubtreeOnSide(e,i){const r=e===It.NORTH?[0,1]:e===It.NORTH_EAST?[1]:e===It.EAST?[1,3]:e===It.SOUTH_EAST?[3]:e===It.SOUTH?[2,3]:e===It.SOUTH_WEST?[2]:e===It.WEST?[0,2]:[0],s=n=>{const o=n.children;!i(n)&&o[0]&&r.forEach(a=>s(o[a]))};s(this)}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(qe(!Go||r>=0),r===0)return 0;const s=2**r,n=!(1&~e),o=n?0:1,a=i.lij[o+1]*s,l=this._lij[o+1],c=l-a,u=n?s-1-c:c;return Go&&(qe(a<=l&&l<a+s),qe(0<=u&&u<s)),u}forEachLoadedNeighbor(e){const i=this.level,r=s=>s.level===i||s.isLoaded;Xm.forEach(s=>{const n=this.findNeighborTile(s,r);n!=null&&n!==this&&n.forAllSubtreeOnSide(ope(s),o=>!!o.isLoaded&&(e(o,s),!0))}),aH.forEach(s=>{const n=this.findNeighborTile(s,r)?.findCorner(oH(s),o=>o.isLoaded);qe(!n||une(this,n,s)),n?.isLoaded&&e(n,s)})}getNeighborLIJ(e,i){const r=GSe(i)?-1:VSe(i)?1:0,s=BSe(i)?-1:zSe(i)?1:0,n=[e[0],e[1]+r,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this._lij[2]===0}get isNorthEnd(){return this._lij[1]===0}get isSouthEnd(){const e=this.surface.extent,i=e?.[1]??null;return i!=null&&this.extent[1]+ba()>=i}checkGeometryWaterproofness(){sH&&(qe(this.isLoaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(GSe(e)&&i[3]+s>=r[3]||VSe(e)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&BSe(e)&&i[0]-s<=r[0])&&!(!n&&zSe(e)&&i[2]+s>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;ge(this._lastPOI,e);const r=this._center[Hn.MIDDLE],s=e[0]-r[0],n=e[1]-r[1],o=e[2]-r[2];this.distanceToPOI=s*s+n*n+o*o}get test(){return{cachedMemory:this._cachedMemory}}};function j5t(t,e,i,r){const s=i===ri.ELEVATION?upe.acquire():cpe.acquire();return s.init(t,e,i,r),s}function IB(t){t.dispose(),U5t(t)?upe.release(t):z5t(t)&&cpe.release(t)}const cpe=new Tl(B5t),upe=new Tl(k5t),H5t=new cP;var Hn;function q5t(t,e){const i=t.lij,r=e[0]-i[0];return!(r<0)&&e[1]>>r===i[1]&&e[2]>>r===i[2]}function kG(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function W5t(t,e,i){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&i===It.EAST||t.isWestEnd&&e.isEastEnd&&i===It.WEST))return!0;const r=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(i){case It.NORTH:return Yp(t.extent[3],e.extent[1],r);case It.SOUTH:return Yp(t.extent[1],e.extent[3],r);case It.EAST:return Yp(t.extent[2],e.extent[0],r)||Yp(t.extent[2],-e.extent[0],r);case It.WEST:return Yp(t.extent[0],e.extent[2],r)||Yp(t.extent[0],-e.extent[2],r)}}function une(t,e,i){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?WSe(t,e,i):WSe(e,t,oH(i)))}function WSe(t,e,i){qe(t.level>=e.level);const r=m5t(i),s=g5t(i),n=t.extent,o=e.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),u=Yp(a[0],l[0],c)||t.surface.isGlobal&&Yp(a[0],-l[0],c),h=Yp(a[1],l[1],c);if(u&&h)return!0;if(t.level===e.level||!u&&!h)return qe(!1),!1;const p=u?YSe(o[1],o[3],n[1],n[3],c):YSe(o[0],o[2],n[0],n[2],c);return qe(p),p}function YSe(t,e,i,r,s){return t-s<=i&&i<=r&&r<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(Hn||(Hn={}));const $B=M(),$Z=M(),NZ=M(),Aa=M();let Y5t=class{constructor(){this._scales=ni(-1,-1,-1,-1),this._offsets=ni(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};function X5t(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(T`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function hpe(t){t.code.add(T`
    float lineFactorAtPosition(float value) {
      float pos = value * ${T.float(257)};
      if(pos < 0.5 || pos > ${T.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}var t0;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(t0||(t0={}));let Z5t=class extends rde{constructor(){super(...arguments),this.overlayOpacity=1}};function J5t(t,e){const{vertex:i,fragment:r,varyings:s}=t;s.add("vtc","vec2"),i.uniforms.add(new XSe("texOffsetAndScale")),r.uniforms.add(new ZSe("tex")),r.uniforms.add(new LZ("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(i.uniforms.add(new XSe("nextTexOffsetAndScale")),s.add("nvtc","vec2"),r.uniforms.add(new ZSe("texNext")),r.uniforms.add(new LZ("nextTexOpacities")),r.uniforms.add(new Q5t("fadeFactor")));const o=e.tileBlendInput===t0.ColorComposite,a=e.tileBlendInput===t0.GridComposite;a&&r.include(hpe),o&&r.uniforms.add(new LZ("backgroundColor")),i.code.add(T`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?T`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:T``}
  }`),r.code.add(T`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?T`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?T`backgroundColor`:T`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:T`return color;`}
    }`),n?r.code.add(T`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(T`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let Q5t=class extends hn{constructor(e){super(e,"float")}},LZ=class extends hn{constructor(e){super(e,"vec3")}},XSe=class extends hn{constructor(e){super(e,"vec4")}},ZSe=class extends hn{constructor(e){super(e,"sampler2D")}},o6e=class extends Z5t{};function K5t(t){const e=new tr,{vertex:i,fragment:r,varyings:s}=e;e.include(e4),e.include(JI,t),e.include(jm,t);const n=()=>{e.include(qF,t),i.code.add(T`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};Pu(i,t),e.include(ec,t);const o=t.overlayMode!==Jy.Disabled,a=o&&t.invisible;switch(t.output){case G.Color:{e.include(J5t,t),e.include(XE,t),o&&e.include(s3,{...t,pbrMode:t.pbrMode===Ot.Simplified?Ot.TerrainWithWater:Ot.Water});const l=t.overlayMode===Jy.EnabledWithWater;l&&e.include(X5t,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),t.screenSizePerspective&&XO(i);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(YI,t),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),i.code.add(T`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?T`forwardVertexTangent(vnormal);`:T``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?T`setOverlayVTC(uv);`:""}
          ${t.tileBorders?T`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?T`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?T`forwardLinearDepth();`:""}

        }
      `),e.include(Wn,t),e.include(XE,t),e.include(p4,t),e.include(sI,t),yg(r,t),f4(r),t$(r),r.uniforms.add(i.uniforms.get("localOrigin"),new Qt("viewDirection",(u,h)=>Se(JSe,ue(JSe,h.camera.viewMatrix[12],h.camera.viewMatrix[13],h.camera.viewMatrix[14])))),l&&r.uniforms.add(new Et("ovWaterTex",(u,h)=>h.overlay?.getTexture(vs.WaterNormal)),new UFe("view",(u,h)=>ac(eBt,h.camera.viewMatrix,u.origin))),r.code.add(T`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),r1(r),L0(r),r.code.add(T`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?T`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?T`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===Ot.Simplified||t.pbrMode===Ot.TerrainWithWater?T`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:T`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?T`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?T`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?T`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:T`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?T`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case G.Depth:a&&e.include(s3,t),i.code.add(T`
              void main(void) {
                ${a?T`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPosition(proj, view, position);
              }
          `),r.code.add(T`
              void main() {
                ${a?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              }
          `);break;case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ViewshedShadow:e.include(n7,t),Qie(e),R9(e),i.code.add(T`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(T`void main() {
outputDepth(linearDepth);
}`);break;case G.Normal:a&&e.include(s3,t),s.add("vnormal","vec3"),XO(i),n(),i.code.add(T`
        void main(void) {
          ${a?T`setOverlayVTC(getUV0());`:""}
          gl_Position = transformPosition(proj, view, position);
          vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
        }
      `),r.code.add(T`
        void main() {
          ${a?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) {
            normal = -normal;
          }
          fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
        }
      `);break;case G.Highlight:o&&e.include(s3,t),i.code.add(T`
          void main() {
            ${o?T`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(Wx,t),r.code.add(T`
          void main() {
            ${o?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===G.ObjectAndLayerIdColor&&(o?(e.include(s3,{...t,pbrMode:Ot.Disabled}),i.code.add(T`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),r.code.add(T`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(i.code.add(T`void main(void) {
        ${t.opaque?T` gl_Position = transformPosition(proj, view, position);`:""}
      }`),r.code.add(T`void main() {
fragColor = vec4(0.0);
}`))),e}const eBt=Ne(),JSe=M(),tBt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:o6e,build:K5t},Symbol.toStringTag,{value:"Module"}));let a6e=class l6e extends hr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,i){i.spherical=e.viewingMode===Xe.Global}initializeProgram(e){return new dr(e.rctx,l6e.shader.get().build(this.configuration),c6e)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return ti({blending:i.renderOccluded?Zd(ke.ONE,ke.ONE_MINUS_SRC_ALPHA):null,culling:r?Due:null,depthTest:i.renderOccluded?null:{func:Lr.LESS},depthWrite:i.renderOccluded?null:Oh,colorWrite:fi,stencilTest:e?c2t(Iu.IntegratedMeshMaskExcluded):null,drawBuffers:i.output===G.Depth?{buffers:[zo.NONE]}:null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};a6e.shader=new ir(tBt,()=>ye(()=>import("./Terrain.glsl-302a375a.js"),[],import.meta.url));const c6e=new Map([[O.POSITION,0],[O.UV0,1],[O.NORMALCOMPRESSED,2]]);let iBt=class{constructor(){this.geometry=new E5t,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureRef=new r6e(()=>this.tile.surface.fadeDuration),this.overlay=new Y5t,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(e,i){this.clear(),this._tile=e,this.geometry.reset(),this.intersectionData=null,this.geometryState=new M5t,this._localOrigin=i,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Go&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)qe(this.geometry.getEdgeCount(i)===this.geometryState.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const l=r.surface.extent;if(l!=null&&(e===0&&r.extent[3]>l[3]||e===1&&r.extent[2]>l[2]||e===2&&r.extent[1]<l[1]||e===3&&r.extent[0]<l[0]))return s}const n=r.level,o=Xm[e];if(!i)return qe(r.surface?.rootTiles==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),s;if(i.isLoaded){const l=i,c=l.renderData.geometryState,u=n-l.level;if(qe(u>=0),u===0){const f=c.numVerticesPerSide-1;return Math.max(f,s)}const h=2**u,p=c.edgeResolutions[(e+2)%4]/h;return Math.max(1,p)}qe(!i.isLeaf);let a=s;return i.forAllSubtreeOnSide(ope(o),l=>l===r||(l.isLoaded?(a=Math.max(a,2**(l.level-n)),!0):(qe(!l.isLeaf),!1))),a}updateNeighborData(){const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState,r=o=>(o.isLoaded||o.level===e.level)&&o?.intersectsClippingArea,s=i.edgePeerNeighbors,n=i.edgePeerNeighborSamplerVersions;for(let o=0;o<4;++o){const a=e.findNeighborTile(Xm[o],r),l=E2(e,a),c=l?.renderData?.geometryState.samplerDataVersion??-1,u=s[o],h=l!==E2(e,u),p=n[o]!==c;Go&&a&&(qe(e.level>=a.level),qe(e.level-a.level<=vo)),s[o]=a,(h||p)&&(n[o]=c,this._markEdgeDirty(o));const f=i.edgeResolutions[o],g=this._calculateEdgeResolution(o,a);qe(cF(g)),qe(g>=1),i.edgeResolutions[o]=g,f!==g&&this._markEdgeResolutionDirty(o)}for(let o=0;o<4;++o){const a=e.findNeighborTile(aH[o],r);i.cornerPeerNeighbors[o]=a;const l=E2(e,s[o]),c=E2(e,s[(o+1)%4]),u=E2(e,a);Vf[o]=u,Vf[(o+1)%4]=c,Vf[(o+2)%4]=e,Vf[(o+3)%4]=l,qe(Vf.some(g=>g?.isLoaded||g===e));const h=Vf.reduce((g,y)=>Math.min(g,y?.level??1/0),1/0);Vf.forEach((g,y)=>{g&&g?.level>h&&(Vf[y]=null)}),qe(Vf.some(g=>g?.isLoaded||g===e));const p=i.cornerNeighborCornerTiles,f=i.cornerNeighborCornerTileSamplerVersions;for(let g=0;g<4;++g){const y=Vf[g],v=y?.renderData.geometryState.samplerDataVersion??-1,b=4*o+g,w=p[b]!==y,x=!w&&f[b]!==v;(w||x)&&(p[b]=y,f[b]=v,this._markCornerDirty(o))}Go&&qe(dpe.some(g=>p[4*o+g]?.isLoaded||p[4*o+g]===e))}Go&&qe(this.geometryState.edgeResolutions.every(o=>o>0));for(let o=0;o<4;++o)Vf[o]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Go&&qe(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(f=>f>0)),this.intersectionData=null;const{tile:i,_vao:r,geometry:s,geometryState:n}=this,o=!r||!{geometry:s}||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,a=this.dirtyEdgeResolutions!==0,l=n.edgeResolutions.reduce((f,g)=>f+g+1,0),c=o||a&&l>(s?.maxEdgeVertexCount??0),u=!c&&a,h=!u&&(this.dirtyEdges!==0||a),p=!h&&this.dirtyCorners!==0;c?(this.releaseGeometry(),this._createGeometry(e)):u?i.updateEdgeElevationsAndResolutions():h||p?i.updateEdgeElevations():p?i.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=jt(this._vao),this.geometry.release(),!0)}ensureTexture(e,i,r){const s=i?Xt.RGBA:Xt.RGB;return this._texture==null||this._texture.descriptor.width===e&&this._texture.descriptor.pixelFormat===s||this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}get numVerticesPerSideChanged(){return!!(this._modifiedFlags&sBt)}get samplerDataChanged(){return!!(this._modifiedFlags&nBt)}get clippingAreaChanged(){return!!(this._modifiedFlags&oBt)}get wireframeChanged(){return!!(this._modifiedFlags&aBt)}get dirtyEdges(){return this._modifiedFlags>>DZ&15}get dirtyCorners(){return this._modifiedFlags>>FZ&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>kZ&15}_markCornerDirty(e){const i=1<<e<<FZ;this._modifiedFlags|=i}_markEdgeDirty(e){const i=1<<e<<DZ;this._modifiedFlags|=i,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const i=1<<e<<kZ;this._modifiedFlags|=i,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<FZ|15<<DZ|15<<kZ}updateGeometryState(){const e=this._getElevationInfo(),i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.getDefaultVerticesPerSide(),s=Math.max(r,5);let n=i.clippingArea;i.intersectsClippingArea&&!i.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._modifiedFlags|=1,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._modifiedFlags|=2,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),qw(o.clippingArea,n)||(this._modifiedFlags=4,o.clippingArea=n,a=!0);const l=i.surface.wireframe;return o.wireframe!==l&&(this._modifiedFlags=8,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||=a,a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const i=this.geometry.vertexAttributes,r=this.geometry.indices,s=e.gl;this._vao=new k0(e,c6e,{geometry:Dh(i.layout)},{geometry:Vr.createVertex(e,s.STATIC_DRAW,i.buffer)},Vr.createIndex(e,s.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=Gw.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,i=this.tile.layerInfo[ri.ELEVATION],r=i.length,s=new Array(r);let n=0,o=0,a=!1;for(let u=0;u<r;u++){const h=i[u];if(h.upsampleInfo!=null){const p=h.upsampleInfo.tile,f=p.layerInfo[ri.ELEVATION][u].data,g=f&&f.samplerData;e&&e[n]===g||(a=!0),s[n++]=g,o=Math.max(o,p.lij[0])}else if(h.data){const p=this.tile.surface.layerViewByIndex(u,ri.ELEVATION);if(UD(this.tile,p.layer,!1)){const f=h.data;e&&e[n]===f.samplerData||(a=!0),s[n++]=f.samplerData,o=this.tile.level}}}e!=null&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const e=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+e}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(!Go)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void qe(e?.isLoaded);const i=e.surface.extent;if(i!=null&&!e.intersectsExtent(i))return;const r=Xm.map((a,l)=>i!=null&&(l<2?-1:1)*(e.extent[3-l]-i[3-l])<0),s=e.level;qe(this.dirtyCorners===0),qe(this.dirtyEdges===0),qe(this.dirtyEdgeResolutions===0),qe(!this.numVerticesPerSideChanged),qe(!this.samplerDataChanged),qe(!this.clippingAreaChanged),qe(!this.wireframeChanged);const n=aH.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a?.intersectsClippingArea?a:null),o=this.geometryState;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];qe(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l?.lij}] exp=[${c?.lij}]`)}Xm.forEach((a,l)=>{if(r[l])return;const c=e.findNeighborTile(a,Q=>(Q.level===s||Q?.isLoaded)&&Q?.intersectsClippingArea);if(!c){const Q=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void qe(!Q)}qe(c.isLoaded||c.level===e.level),qe(c===this.geometryState.edgePeerNeighbors[l]);const u=s-c.level;if(!c.isLoaded)return qe(!c.isLeaf),void qe(u===0);const h=c.renderData;qe(W5t(e,c,a)),qe(u>=0);const p=2**u;if(u<0)return void qe(!1);const f=e.renderData,g=f.geometry,y=f.localOrigin,v=g.getEdgeCount(l),b=g.numVerticesPerSide-1,w=h.geometry;if(!w)return void qe(!1);const x=h.localOrigin,S=this.geometryState.edgePeerNeighbors[l];if(S?.isLoaded){const Q=S.renderData;qe(f.geometryState.edgePeerNeighborSamplerVersions[l]===Q.geometryState.samplerDataVersion),qe(this.geometryState.edgePeerNeighborSamplerVersions[l]===Q.geometryState.samplerDataVersion)}const E=(l+2)%4,C=w.getEdgeCount(E),R=v-1,I=C-1;qe(R*p===I,`Tile[${e.lij}]:e${l},res=${R} edgeRes mismatch with Neighbor[${c.lij}]:e${E},res=${I} (expected:${R*p})`);const F=e.extent,D=a===It.NORTH||a===It.SOUTH,z=C-1,B=z>>u,Y=v-1;if(B<1)return void qe(Y===1);qe(B===Y),qe(cF(B));const W=w.numVerticesPerSide-1;qe(u>0||B===Math.max(W,b));const J=e.getNeighborEdgeStartVertexIndex(l,c);qe(0<=J&&J<p);const me=J*B;qe(0<=me&&me<=z-B);let L=0,k=me;g.getEdgeVertexPosition(l,Wg,y,0),g.getEdgeVertexPosition(l,Yg,y,v-1);const H=jr(Wg,Yg),q=Math.max(rBt,1e-4*H);for(let Q=0;Q<=B;++Q){g.getEdgeVertexPosition(l,Wg,y,L),w.getEdgeVertexPosition(E,Yg,x,k);const K=Q/B,re=D?F[0]+K*(F[2]-F[0]):a===It.WEST?F[0]:F[2],be=D?a===It.SOUTH?F[1]:F[3]:F[1]+K*(F[3]-F[1]),Re=e.surface.extent;if(Re==null||$q(Re,re,be)){const je=Rw(Wg,Yg),_t=$c(Wg)-br.radius,ht=$c(Yg)-br.radius,ut=je<q;if(!ut){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${L}/${v}] and [${c.lij}].edge${E}[${k}/${C}]`),Re!=null&&console.warn("  surface extent= ",Re," x,y=",re,",",be);const bi=M();Me(bi,f.localOrigin,h.localOrigin),$c(bi)>0&&console.warn(`   localOrigins: ${f.localOrigin} vs ${h.localOrigin} d=${$c(bi)} [${bi}]`),(()=>{const ii=Fn(Wg),Ye=Fn(Yg);e.updateEdgeElevations(),c.updateEdgeElevations(),g.getEdgeVertexPosition(l,Wg,y,L),w.getEdgeVertexPosition(E,Yg,x,k);const He=M();Vi(He,Wg,ii),$c(He)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${ii} vs ${Wg} d=${$c(He)} [${He}]`),Vi(He,Yg,Ye),$c(He)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${Ye} vs ${Yg} d=${$c(He)} [${He}]`)})();const gi=g.getEdgeCount(l),We=w.getEdgeCount(C);qe(ut,`Mismatch in tile [${e.lij}].edge[${l}][${L}/${gi}] vs neighbor [${c.lij}].edge[${E}][${k}/${We}] ${d_(Wg)} vs ${d_(Yg)}  dist=${je} h(t|n|d)=${_t}|${ht}|${ht-_t}`)}g.getEdgeNormal(l,HM,L),w.getEdgeNormal(E,qM,k),Se(QSe,HM),Se(KSe,qM);const lt=xe(QSe,KSe),at=1-lt<.01||!1||e===c;if(!at){const bi=M();Vi(bi,HM,qM);const gi=()=>`Mismatch in tile edge normal ${USe(e.lij)} (${L}/${v-1}) edge ${l} vs neighbor ${USe(c.lij)}  (${k}/${C-1}) nedge ${E} :${d_(HM)} vs ${d_(qM)}  dot = ${lt} : ${d_(bi)}`;console.warn("Mismatch in tile edge normal: ",gi());{e.updateEdgeElevations(),c.updateEdgeElevations();const We=M(),ii=M();g.getEdgeNormal(l,We,L),w.getEdgeNormal(E,ii,k),NE(HM,We)||console.warn("Missing update in tile normal: ",d_(HM)," => ",d_(We)),NE(qM,ii)||console.warn("Missing update in neighbor normal: ",d_(qM)," => ",d_(ii))}qe(at,gi())}}L+=1,k+=1}})}};const Wg=M(),Yg=M(),HM=M(),qM=M(),QSe=M(),KSe=M(),rBt=1,Vf=[null,null,null,null];function E2(t,e){return e?.isLoaded||e===t?e:null}const sBt=1,nBt=2,oBt=4,aBt=8,DZ=4,FZ=8,kZ=12,dpe=[0,1,2,3],lBt=65536;function cBt(t,e){const{tile:i,geometry:r,geometryState:s}=t,{extentInRadians:n,surface:o}=i,{isWebMercator:a,renderer:l}=o,{numVerticesPerSide:c,wireframe:u}=s,h=c-1,p=(c-2)**2,f=a&&(e===Wp.HAS_SOUTH_POLE||e===Wp.HAS_BOTH_POLES),g=a&&(e===Wp.HAS_NORTH_POLE||e===Wp.HAS_BOTH_POLES),y=((f?1:0)+(g?1:0))*UG*c,v=T6e(s),b=p+y+4*v,w=l.tileGeometryCache.acquire(b);r.numVerticesPerSide=c,r.vertexAttributes=w,r.maxEdgeVertexCount=v;const{boundingBox:x}=r;hs(x);const S=fpe(t);Fa.update(h,n,S),hBt(t),r.poleVerticesStartIndex=p;const E=uBt(t,f,g);r.edgeVerticesStartIndex=p+y,gpe(t),ppe(t),g6e(r,E,u),t.intersectionData=null}function uBt(t,e,i){const{tile:r,localOrigin:s,geometry:n}=t,{extent:o,ellipsoid:a}=r,{boundingBox:l,numVerticesPerSide:c,vertexAttributes:u,poleVerticesStartIndex:h}=n,p=c-1,f=s[0],g=s[1],y=s[2],v=a.radius,b=o[1],w=o[3],x=[];let S=h;const E=(C,R)=>{const I=R*c;of(-f,-g,C*v-y,l),x.push(new RBt(C===1,I,C===1?0:2,S,UG));const F=d6e(C===-1?b:w,v),D=C*Math.PI/2-F,z=.99*(C===1?1:-1),B=v+0,{position:Y,uv0:W}=u,{typedBuffer:J,typedBufferStride:me}=u.normalCompressed;for(let L=1;L<=UG;++L){const k=F+D*(L/UG),H=Math.cos(k),q=Math.sin(k);for(let Q=0;Q<=p;Q++){const K=Q/p,re=Fa.sinLonLUT[Q],be=Fa.cosLonLUT[Q]*H,Re=re*H,je=q,_t=be*B-f,ht=Re*B-g,ut=je*B-y;of(_t,ht,ut,l),Y.setValues(S,_t,ht,ut),ig(W,S,K,z),gf(J,S,be,Re,je,me),++S}}};return e&&E(-1,0),i&&E(1,p),x}function hBt(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{numVerticesPerSide:n,samplerData:o}=r,a=n-2,l=n-1,{vertexAttributes:c,boundingBox:u}=i,h=c.position,p=c.uv0,{typedBuffer:f,typedBufferStride:g}=c.normalCompressed,{extent:y}=e,v=y[0],b=y[2],w=y[1],x=y[3],S=e.ellipsoid.radius,E=s[0],C=s[1],R=s[2],I=h.typedBuffer,F=h.typedBufferStride,D=1/l;let z=0;if(1<=a){const B=D,Y=w*(1-B)+x*B,W=Fa.sinLatLUT[1],J=Fa.cosLatLUT[1];for(let me=1;me<=a;me++){const L=me*D,k=v*(1-L)+b*L,H=Fa.sinLonLUT[me],q=Fa.cosLonLUT[me],Q=S+js(k,Y,o),K=Q*q*J-E,re=Q*H*J-C,be=Q*W-R;of(K,re,be,u);const Re=(me-1)*F;I[Re]=K,I[Re+1]=re,I[Re+2]=be,ig(p,me-1,L,B)}}for(let B=1;B<=a;B++){const Y=B*D,W=w*(1-Y)+x*Y,J=Fa.sinLatLUT[B],me=Fa.cosLatLUT[B],L=B+1,k=L*D,H=w*(1-k)+x*k,q=Fa.sinLatLUT[L],Q=Fa.cosLatLUT[L],K=Fa.sinLonLUT[0],re=Fa.cosLonLUT[0],be=S+js(v,W,o);let Re=re*me*be-E,je=K*me*be-C,_t=J*be-R;const ht=z*F;let ut=I[ht],lt=I[ht+1],at=I[ht+2];for(let bi=1;bi<=a;bi++){const gi=bi*D,We=v*(1-gi)+b*gi,ii=Fa.sinLonLUT[bi],Ye=Fa.cosLonLUT[bi];let He=0,Lt=0,kt=0;if(bi<a){const Fr=(z+1)*F;He=I[Fr],Lt=I[Fr+1],kt=I[Fr+2]}else{const Fr=Fa.sinLonLUT[l],Zs=Fa.cosLonLUT[l],Cn=S+js(b,W,o);He=Zs*me*Cn-E,Lt=Fr*me*Cn-C,kt=J*Cn-R}const Kt=Re,wt=je,rt=_t;Re=ut,je=lt,_t=at,ut=He,lt=Lt,at=kt;const st=He-Kt,Ht=Lt-wt,ui=kt-rt;let Er=0,Oi=0,ki=0;if(B>1){const Fr=(z-a)*F;Er=I[Fr],Oi=I[Fr+1],ki=I[Fr+2]}else{const Fr=Fa.sinLatLUT[0],Zs=Fa.cosLatLUT[0],Cn=S+js(We,w,o);Er=Ye*Zs*Cn-E,Oi=ii*Zs*Cn-C,ki=Fr*Cn-R}const Rr=S+js(We,H,o),Dr=Ye*Q*Rr-E,rr=ii*Q*Rr-C,sr=q*Rr-R;if(B<a){const Fr=z+a,Zs=Fr*F;I[Zs]=Dr,I[Zs+1]=rr,I[Zs+2]=sr,of(Dr,rr,sr,u),ig(p,Fr,gi,k)}const ji=Er-Dr,hi=Oi-rr,Ci=ki-sr;let nr=Ye*me,_r=ii*me,Cs=J;Cs*Cs<.999&&(nr=ui*hi-Ht*Ci,_r=st*Ci-ui*ji,Cs=Ht*ji-st*hi);const Pr=1/Math.sqrt(nr*nr+_r*_r+Cs*Cs);gf(f,z,nr*Pr,_r*Pr,Cs*Pr,g),++z}}}function dBt(t){t.tile.intersectsClippingArea&&(ppe(t),s$(t),t.intersectionData=null)}function pBt(t){t.tile.intersectsClippingArea&&(v6e(t),ppe(t),s$(t),x6e(t),t.intersectionData=null)}function fBt(t){t.tile.intersectsClippingArea&&(h6e(t),u6e(t,!0),s$(t),t.intersectionData=null)}function ppe(t){t.tile.intersectsClippingArea&&(h6e(t),u6e(t))}function u6e(t,e=!1){const{geometry:i,geometryState:r,tile:s,localOrigin:n}=t,{level:o,extent:a,extentInRadians:l,ellipsoid:c}=s,u=c.radius,h=l[0],p=l[2],f=l[1],g=l[3],{samplerData:y}=r,v=a[0],b=a[2],w=a[1],x=a[3],S=fpe(t),{boundingBox:E,vertexAttributes:C}=i,R=n[0],I=n[1],F=n[2],D=C.position,z=D.typedBuffer,B=D.typedBufferStride,Y=C.uv0;for(let W=0;W<4;++W){const J=W===1||W===3,me=r.edgeResolutions[W];qe(cF(me));const L=me+1,k=E2(s,r.edgePeerNeighbors[W]);if(S6e(s,k,W)){b6e(t,W,k);continue}const H=k!=null;qe(!H||k.level===s.level),qe(!H||e0(s,k)<=0);const q=k?.renderData,Q=q?.geometryState;if(Go){const st=s.surface;if(!k&&st&&!st.updatingRootTiles){const Ht=Xm[W],ui=s.findNeighborTile(Ht,Er=>Er.isLoaded||Er.isLeaf||Er.level===s.level);ui?ui.intersectsClippingArea&&(qe(!ui.isLoaded),qe(!ui.isLeaf),qe(ui.level===o)):qe(st?.rootTiles==null||!s.shouldHaveNeighbor(Ht))}}const K=W===1?a[2]:a[0],re=k?.extent,be=re&&J?W===1?re[0]:re[2]:K,Re=W===0?a[3]:a[1],je=W===1?1:0,_t=W===0?1:0,ht=W===1?p:h,ut=W===0?g:f,lt=Math.sin(ht),at=Math.cos(ht),bi=Math.sin(ut),gi=Math.cos(ut),We=Q?.samplerData,ii=H?(st,Ht,ui)=>.5*(js(st,Ht,y)+js(ui,Ht,We)):(st,Ht,ui)=>js(st,Ht,y),Ye=i.outerEdgesOffsetAndLength[2*W+0],He=e&&L>3?L-3:1,Lt=y!=null&&y.some(st=>st!=null),kt=We!=null&&We.some(st=>st!=null),Kt=Lt||kt,wt=1/me,rt=Ye;qe(!re||Yp(re[2]-re[0],a[2]-a[0])),(()=>{const st=W===1?-1:W===3?1:0,Ht=W===0?-1:W===2?1:0,ui=(a[2]-a[0])*wt,Er=st*ui,Oi=Ht*ui,ki=J?st*((p-h)*wt):0,Rr=J?0:Ht*wt,Dr=_t,rr=J?ht+ki:ht,sr=J?Math.sin(rr):lt,ji=J?Math.cos(rr):at,hi=J?ht-ki:ht,Ci=J?Math.sin(hi):lt,nr=J?Math.cos(hi):at,_r=J?ut:S(Dr+Rr),Cs=J?bi:Math.sin(_r),Pr=J?gi:Math.cos(_r),Fr=J?ut:S(Dr-Rr),Zs=J?bi:Math.sin(Fr),Cn=J?gi:Math.cos(Fr);let Ca=0,Jc=0,Io=0;{const Ii=0*wt,zn=J?K:v*(1-Ii)+b*Ii,ho=J?be:zn,Kn=J?w*(1-Ii)+x*Ii:Re,de=J?ht:h*(1-Ii)+p*Ii,gs=J?lt:Math.sin(de),Mf=J?at:Math.cos(de),Ko=J?S(Ii):ut,Af=J?Math.sin(Ko):bi,Rt=J?Math.cos(Ko):gi,ku=u+ii(zn,Kn,ho);Ca=Mf*Rt*ku,Jc=gs*Rt*ku,Io=Af*ku}let Qo=0,uo=0,Js=0;{const Ii=1*wt,zn=J?K:v*(1-Ii)+b*Ii,ho=J?be:zn,Kn=J?w*(1-Ii)+x*Ii:Re,de=J?ht:h*(1-Ii)+p*Ii,gs=J?lt:Math.sin(de),Mf=J?at:Math.cos(de),Ko=J?S(Ii):ut,Af=J?Math.sin(Ko):bi,Rt=J?Math.cos(Ko):gi,ku=u+ii(zn,Kn,ho);Qo=Mf*Rt*ku,uo=gs*Rt*ku,Js=Af*ku}for(let Ii=1;Ii<L-1;Ii+=He){let zn=0,ho=0,Kn=0;{const fc=(Ii+1)*wt,Uu=J?K:v*(1-fc)+b*fc,Mg=J?be:Uu,ta=J?w*(1-fc)+x*fc:Re,Qs=J?ht:h*(1-fc)+p*fc,_1=J?lt:Math.sin(Qs),nS=J?at:Math.cos(Qs),oS=J?S(fc):ut,XC=J?Math.sin(oS):bi,aS=J?Math.cos(oS):gi,v1=u+ii(Uu,ta,Mg);zn=nS*aS*v1,ho=_1*aS*v1,Kn=XC*v1}const de=zn,gs=ho,Mf=Kn,Ko=Qo,Af=uo,Rt=Js;Qo=de,uo=gs,Js=Mf;{const fc=rt+Ii,Uu=fc*B,Mg=Ko-R,ta=Af-I,Qs=Rt-F;z[Uu]=Mg,z[Uu+1]=ta,z[Uu+2]=Qs,of(Mg,ta,Qs,E);const _1=Ii*wt;ig(Y,fc,J?je:_1,J?_1:_t)}const ku=Ca,ea=Jc,iS=Io;Ca=Ko,Jc=Af,Io=Rt;const rS=Ko,Qc=Af,Y0=Rt,sS=1/Math.sqrt(rS*rS+Qc*Qc+Y0*Y0),wi=Y0*sS;let g1=0,X0=0,y1=0;if(Kt&&wi*wi<.999){let fc=0,Uu=0,Mg=0;{const ta=W===0?-1:1;fc=ta*(de-ku),Uu=ta*(gs-ea),Mg=ta*(Mf-iS)}{const ta=Ii*wt,Qs=J?K:v*(1-ta)+b*ta,_1=J?be:Qs,nS=J?w*(1-ta)+x*ta:Re,oS=J?ht:h*(1-ta)+p*ta,XC=J?lt:Math.sin(oS),aS=J?at:Math.cos(oS),v1=J?S(ta):ut,X4=J?Math.sin(v1):bi,Kc=J?Math.cos(v1):gi;let b$=rS,w$=Qc,Z=Y0;if(H){const Ae=u+js(_1-Er,nS-Oi,We),ze=J?Kc:Cn;b$=(J?nr:aS)*ze*Ae,w$=(J?Ci:XC)*ze*Ae,Z=(J?X4:Zs)*Ae}{const Ae=u+js(Qs+Er,nS+Oi,y),ze=J?Kc:Pr,Ui=(J?ji:aS)*ze*Ae,eo=(J?sr:XC)*ze*Ae,pn=(J?X4:Cs)*Ae;H||(b$=2*rS-Ui,w$=2*Qc-eo,Z=2*Y0-pn);const mc=W===3?-1:1,lS=mc*(b$-Ui),Xfe=mc*(w$-eo),Zfe=mc*(Z-pn);g1=Mg*Xfe-Uu*Zfe,X0=fc*Zfe-Mg*lS,y1=Uu*lS-fc*Xfe;const aW=1/Math.sqrt(g1*g1+X0*X0+y1*y1);g1*=aW,X0*=aW,y1*=aW}}}else g1=rS*sS,X0=Qc*sS,y1=Y0*sS;i.setEdgeNormalFromValues(W,Ii,g1,X0,y1)}})()}}function h6e(t){w6e(t)}function d6e(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function mBt(t,e,i,r){return d6e(t*(1-r)+e*r,i)}function gBt(t,e,i){return t*(1-i)+e*i}function fpe(t){const{tile:e}=t;if(e.surface.isWebMercator){const r=e.extent,s=e.ellipsoid.radius;return n=>mBt(r[1],r[3],s,n)}const i=e.extentInRadians;return r=>gBt(i[1],i[3],r)}function yBt(t,e){const{tile:i,geometryState:r,geometry:s}=t,{extent:n,surface:o}=i,{wireframe:a}=r,l=n[0],c=n[1],u=n[2]-l,h=n[3]-c,{numVerticesPerSide:p,clippingArea:f}=r,g=f!=null?Math.max(0,(f[0]-l)/u):0,y=f!=null?Math.max(0,(f[1]-c)/h):0,v=f!=null?Math.min(1,(f[2]-l)/u):1,b=f!=null?Math.min(1,(f[3]-c)/h):1,w=(p-2)**2,x=T6e(r),S=w+4*x,E=o.renderer.tileGeometryCache.acquire(S),{boundingBox:C}=s;hs(C),s.numVerticesPerSide=p,s.vertexAttributes=E,s.maxEdgeVertexCount=x,s.minu=g,s.minv=y,s.maxu=v,s.maxv=b,_Bt(t),s.edgeVerticesStartIndex=w,gpe(t),mpe(t),g6e(s,[],a),t.intersectionData=null}function _Bt(t){const e=t.tile;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{samplerData:n,clippingArea:o,numVerticesPerSide:a}=r,{surface:l,extent:c,ellipsoid:u}=e,{isWebMercatorOnPlateCarree:h}=l,p=o??ype,f=c[0],g=c[1],y=c[2],v=c[3],b=Math.max(f,p[0]),w=Math.min(y,p[2]),x=Math.max(g,p[1]),S=Math.min(v,p[3]),E=u.radius,C=e.horizontalScale,R=a-1,I=a-2,{minu:F,minv:D,maxu:z,maxv:B,boundingBox:Y,vertexAttributes:W}=i,J=W.position,me=W.uv0,{typedBuffer:L,typedBufferStride:k}=W.normalCompressed,H=s[0],q=s[1],Q=s[2],K=J.typedBuffer,re=J.typedBufferStride;let be=0;const Re=$e(g,x,S),je=h?(Math.PI/2-2*Math.atan(Math.exp(-Re/E)))*E:Re*C,_t=1/R,ht=$e(g*(1-_t)+v*_t,x,S);let ut=je,lt=h?(Math.PI/2-2*Math.atan(Math.exp(-ht/E)))*E:ht*C;for(let at=1;at<=I;at++){const bi=at/R,gi=$e(g*(1-bi)+v*bi,x,S),We=$e(bi,D,B),ii=lt,Ye=(at-1)/R,He=$e(g*(1-Ye)+v*Ye,x,S),Lt=ut,kt=(at+1)/R,Kt=$e(g*(1-kt)+v*kt,x,S),wt=h?(Math.PI/2-2*Math.atan(Math.exp(-Kt/E)))*E:Kt*C,rt=$e(kt,D,B);ut=lt,lt=wt;const st=$e(f,b,w);let Ht=st*C,ui=js(st,gi,n);const Er=1/R,Oi=$e(Er,F,z),ki=$e(f*(1-Oi)+y*Oi,b,w);let Rr=Oi,Dr=ki,rr=ki*C,sr=js(ki,gi,n);if(at===1){const ji=rr-H,hi=ut-q,Ci=sr-Q,nr=0*re;K[nr]=ji,K[nr+1]=hi,K[nr+2]=Ci,of(ji,hi,Ci,Y);const _r=$e(Er,F,z);ig(me,be,_r,We)}for(let ji=1;ji<=I;ji++){const hi=rr,Ci=sr,nr=(ji+1)/R,_r=$e(nr,F,z),Cs=$e(f*(1-nr)+y*nr,b,w),Pr=Dr;Dr=Cs;{const uo=be+1,Js=uo*re;if(at===1||ji===I){const Ii=Cs*C,zn=js(Cs,gi,n);if(at===1&&ji<I){const ho=Ii-H,Kn=ii-q,de=zn-Q;K[Js]=ho,K[Js+1]=Kn,K[Js+2]=de,of(ho,Kn,de,Y),ig(me,uo,_r,We)}rr=Ii,sr=zn}else rr=K[Js]+H,sr=K[Js+2]+Q}const Fr=rr,Zs=sr,Cn=Ht,Ca=ui;Ht=hi,ui=Ci;const Jc=(be-I)*re,Io=at===1?js(Pr,He,n):K[Jc+2]+Q,Qo=js(Pr,Kt,n);if(at<I){const uo=be+I,Js=uo*re,Ii=hi-H,zn=wt-q,ho=Qo-Q;K[Js]=Ii,K[Js+1]=zn,K[Js+2]=ho,of(Ii,zn,ho,Y);const Kn=Rr;Rr=_r,ig(me,uo,Kn,rt)}{const uo=Fr-Cn,Js=Lt-wt,Ii=Js*(Zs-Ca),zn=uo*(Io-Qo),ho=-Js*uo,Kn=Ii*Ii+zn*zn+ho*ho;if(Kn===0)gf(L,be,0,0,1,k);else{const de=1/Math.sqrt(Kn);gf(L,be,Ii*de,zn*de,ho*de,k)}}++be}}}function vBt(t,e){t.tile.intersectsClippingArea&&(f6e(t),p6e(t,!0),s$(t),t.intersectionData=null)}function bBt(t,e){t.tile.intersectsClippingArea&&(v6e(t),mpe(t),s$(t),x6e(t),t.intersectionData=null)}function wBt(t,e){t.tile.intersectsClippingArea&&(mpe(t),s$(t),t.intersectionData=null)}function mpe(t,e){t.tile.intersectsClippingArea&&(f6e(t),p6e(t,!1))}function p6e(t,e){const{geometry:i,geometryState:r,localOrigin:s}=t,n=t.tile,{surface:o,extent:a}=n,{clippingArea:l,samplerData:c}=r,u=l??ype,h=a[0],p=a[2],f=a[1],g=a[3],y=[g>u[3],p>u[2],f<u[1],h<u[0]],v=n.horizontalScale,b=m6e(o.isWebMercatorOnPlateCarree,n.ellipsoid.radius,v),{minu:w,minv:x,maxu:S,maxv:E,boundingBox:C}=i,R=Math.max(h,u[0]),I=Math.min(p,u[2]),F=Math.max(f,u[1]),D=Math.min(g,u[3]),z=s[0],B=s[1],Y=s[2];for(let W=0;W<4;++W){const J=W===1||W===3,me=r.edgeResolutions[W];qe(cF(me));const L=me+1,k=y[W],H=E2(n,r.edgePeerNeighbors[W]);if(!k&&S6e(n,H,W)){b6e(t,W,H);continue}const q=H!=null&&!k,Q=H?.renderData,K=Q?.geometryState;if(Go&&(qe(!q||H.level===n.level),qe(!q||e0(n,H)<=0),n&&!H&&!o.updatingRootTiles)){const wt=Xm[W],rt=n.findNeighborTile(wt,st=>st.isLoaded||st.isLeaf||st.level===n.level);o.updatingRootTiles||(rt?rt.intersectsClippingArea&&(qe(!rt.isLoaded),qe(!rt.isLeaf),qe(rt.level===n.level)):qe(o?.rootTiles==null||!n.shouldHaveNeighbor(wt)))}const re=$e(W===1?p:h,R,I),be=$e(W===0?g:f,F,D),Re=K?.samplerData,je=e&&L>3?L-3:1,_t=$e(W===1?1:0,w,S),ht=$e(W===0?1:0,x,E),ut=q?(wt,rt)=>.5*(js(wt,rt,Re)+js(wt,rt,c)):(wt,rt)=>js(wt,rt,c),lt=(p-h)/me,at=J?W===1?lt:-lt:0,bi=J?0:W===0?lt:-lt,gi=-at,We=-bi;let ii=0,Ye=0,He=0;{const wt=0/me,rt=J?re:$e(h*(1-wt)+p*wt,R,I),st=J?$e(f*(1-wt)+g*wt,F,D):be,Ht=ut(rt,st);ii=rt*v,Ye=b(st),He=Ht}let Lt=0,kt=0,Kt=0;{const wt=1/me,rt=J?re:$e(h*(1-wt)+p*wt,R,I),st=J?$e(f*(1-wt)+g*wt,F,D):be,Ht=ut(rt,st);Lt=rt*v,kt=b(st),Kt=Ht}for(let wt=1;wt<L-1;wt+=je){const rt=wt/me,st=Lt,Ht=kt,ui=Kt;{const Ci=J?_t:$e(rt,w,S),nr=J?$e(rt,x,E):ht,_r=st-z,Cs=Ht-B,Pr=ui-Y;of(st,Cs,Pr,C),i.setEdgeVertexFromValuesRawPositionUV(W,wt,_r,Cs,Pr,Ci,nr)}{const Ci=(wt+1)/me,nr=J?re:$e(h*(1-Ci)+p*Ci,R,I),_r=J?$e(f*(1-Ci)+g*Ci,F,D):be,Cs=ut(nr,_r);Lt=nr*v,kt=b(_r),Kt=Cs}const Er=Lt,Oi=Kt,ki=ii,Rr=Ye,Dr=He;ii=st,Ye=Ht,He=ui;let rr=0,sr=0,ji=0;if(J){const Ci=kt-Ht,nr=Oi-ui,_r=Rr-Ht,Cs=Dr-ui,Pr=$e(f*(1-rt)+g*rt,F,D),Fr=re+gi,Zs=Fr*v-st,Cn=js(Fr,Pr,c)-ui,Ca=W===3?-1:1;if(rr=Ca*(-_r+Ci)*Cn,sr=Ca*Zs*(-Cs+nr),ji=-Ca*Zs*(-_r+Ci),q){const Jc=re+at,Io=Jc*v-st;rr=(-_r+Ci)*(Cn-(js(Jc,Pr,Re)-ui)),sr=(Zs-Io)*(-Cs+nr),ji=-(Zs-Io)*(-_r+Ci)}}else{const Ci=Er-st,nr=Oi-ui,_r=ki-st,Cs=Dr-ui,Pr=$e(h*(1-rt)+p*rt,R,I),Fr=be+We,Zs=js(Pr,Fr,c)-ui,Cn=b(Fr)-Ht,Ca=W===2?-1:1;if(rr=Ca*Cn*(-Cs+nr),sr=Ca*(-_r+Ci)*Zs,ji=-Ca*Cn*(-_r+Ci),q){const Jc=Pr,Io=be+bi,Qo=b(Io)-Ht;rr=(-Cn+Qo)*(-Cs+nr),sr=(-_r+Ci)*(-Zs+(js(Jc,Io,Re)-ui)),ji=-(-Cn+Qo)*(-_r+Ci)}}const hi=1/Math.sqrt(rr*rr+sr*sr+ji*ji);i.setEdgeNormalFromValues(W,wt,rr*hi,sr*hi,ji*hi)}}}function f6e(t,e){w6e(t)}function xBt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function SBt(t,e){return t*e}function m6e(t,e,i){return t?r=>xBt(r,e):r=>SBt(r,i)}function g6e(t,e,i){const{numVerticesPerSide:r,vertexAttributes:s,maxEdgeVertexCount:n}=t,o=r-1,a=s.count,l=2*(r-3)*(r-3),c=4*(o+n-3),u=dpe.reduce((y,v)=>y+(o+t.getEdgeCount(v)-3),0),h=e.reduce((y,v)=>y+o*(2*(v.latitudeResolution-1)+1),0),p=3*(i?2:1),f=(l+c+h)*p,g=a>=lBt?new Uint32Array(f):new Uint16Array(f);for(let y=0;y<f;++y)g[y]=0;t.indices=g,t.indexCount=(l+u+h)*p,t.poleIndicesStartIndex=l*p,t.edgeIndicesStartIndex=(l+h)*p,i?(CBt(t),MBt(t,e),_6e(t)):(TBt(t),EBt(t,e),y6e(t))}function TBt(t){const{numVerticesPerSide:e,indices:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=e-2,l=e-3,c=0,u=e-3;let h=0;for(let p=0;p<l;++p){const f=p*a;for(let g=c;g<u;++g){const y=f+g,v=y+1,b=v+a,w=b-1;E6e(y,v,b,w,o,n)?(i[h]=y,i[h+1]=v,i[h+2]=b,i[h+3]=b,i[h+4]=w,i[h+5]=y):(i[h]=y,i[h+1]=v,i[h+2]=w,i[h+3]=w,i[h+4]=v,i[h+5]=b),h+=6}}}function EBt(t,e){const{numVerticesPerSide:i,indices:r,poleIndicesStartIndex:s}=t,n=i-1;let o=s;for(const a of e){const l=a.isNorth?1:2,c=a.isNorth?2:1,u=a.isNorth?3:4,h=a.isNorth?4:3;let p=t.getEdgeVertexIndex(a.connectedOuterEdgeOffset,0),f=1;for(let g=0;g<a.latitudeResolution;++g){const y=g===0?a.rowOffset:p+i;for(let v=0;v<n;v++){const b=y+v;r[o]=p,r[o+l]=p+1,r[o+c]=b,g<a.latitudeResolution-1?(r[o+u]=p+1,r[o+h]=b+1,r[o+5]=b,o+=6):o+=3,p+=f}p=y,f=1}}}function y6e(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let o=r;for(let a=0;a<4;++a){const l=_pe[a];let c=0,u=0;const h=t.getEdgeCount(a),p=l.count;qe(p===s-1);const f=a===1||a===2,g=f?1:2,y=f?2:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<h-1||u<p-1;){const S=w+u*x,E=v+c*b,C=c<h-1,R=u<p-1,I=C&&(!R||(C?0+s*(c+.5)/(h-1):0)<=(R?1+n*(u+.5)/(p-1):0));I?++c:++u;const F=I?E+b:S+x;e[o]=S,e[o+g]=E,e[o+y]=F,o+=3}}t.indexCount=o}function CBt(t){const{indices:e,numVerticesPerSide:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=i-2;let l=0;for(let c=0;c<i-3;++c){const u=c*a;for(let h=0;h<i-3;++h){const p=c*a+h,f=p+1,g=f+a,y=g-1,v=u+h,b=v+1,w=b+a;E6e(v,b,w,w-1,o,n)?(uP(e,l,p,f,g),l+=6,uP(e,l,g,y,p)):(uP(e,l,p,f,y),l+=6,uP(e,l,y,g,f)),l+=6}}}function MBt(t,e){const{indices:i,numVerticesPerSide:r,poleIndicesStartIndex:s}=t,n=r-1;let o=s;for(const a of e){const l=a.connectedOuterEdgeOffset;let c=t.getEdgeVertexIndex(l,0),u=1;for(let h=0;h<a.latitudeResolution;++h){const p=h===0?a.rowOffset:c+r;for(let f=0;f<n;f++)uP(i,o,c,c+1,p+f),o+=6,h<a.latitudeResolution-1&&(uP(i,o,c+1,p+f+1,p+f),o+=6),c+=u;c=p,u=1}}}function _6e(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let o=r;for(let a=0;a<4;++a){const l=_pe[a];let c=0,u=0;const h=t.getEdgeCount(a),p=l.count;qe(p===s-1);const f=a===1||a===2,g=f?1:3,y=f?3:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<h-1||u<p-1;){const S=w+u*x,E=v+c*b,C=c<h-1,R=u<p-1,I=C&&(!R||(C?0+s*(c+.5)/(h-1):0)<=(R?1+n*(u+.5)/(p-1):0));I?++c:++u;const F=I?E+b:S+x;e[o]=S,e[o+g]=E,e[o+g+1]=E,e[o+y]=F,e[o+y+1]=F,e[o+5]=S,o+=6}}t.indexCount=o}function gpe(t){const{geometry:e,geometryState:i}=t,{edgeResolutions:r}=i,{numVerticesPerSide:s,edgeVerticesStartIndex:n}=e,o=s-2;let a=n;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?o-1:0)*o+(l===1?o-1:0),h=(c?0:1)*o+(c?1:0),p=_pe[l];p.vertex0Index=u,p.stride=h,p.count=o}{const c=r[l]+1;e.outerEdgesOffsetAndLength[2*l+0]=a,e.outerEdgesOffsetAndLength[2*l+1]=c,a+=c}}}function v6e(t){gpe(t),t.geometryState.wireframe?_6e(t.geometry):y6e(t.geometry)}function b6e(t,e,i){const{geometryState:r,geometry:s,tile:n,localOrigin:o}=t,a=e===1||e===3,l=r.edgeResolutions[e];qe(cF(l));const c=l+1,{boundingBox:u,minu:h,minv:p,maxu:f,maxv:g,vertexAttributes:y}=s,v=$e(e===1?1:0,h,f),b=$e(e===0?1:0,p,g),w=i.renderData,x=w.geometryState,S=w.geometry,E=(e+2)%4,C=S.getEdgeCount(E),R=n.getNeighborEdgeStartVertexIndex(e,i)*l,I=l*2**(n.level-i.level);qe(x.edgeResolutions[E]===I),qe(C-1===I);const F=w.localOrigin[0]-o[0],D=w.localOrigin[1]-o[1],z=w.localOrigin[2]-o[2],B=s.getEdgeFirstVertexIndex(e),Y=y.position,W=Y.typedBuffer,J=Y.typedBufferStride,me=y.normalCompressed,L=me.typedBuffer,k=me.typedBufferStride,H=y.uv0,q=S.vertexAttributes,Q=S.getEdgeFirstVertexIndex(E),K=q.position.typedBuffer,re=q.position.typedBufferStride,be=q.normalCompressed.typedBuffer,Re=q.normalCompressed.typedBufferStride;for(let je=1;je<c-1;++je){const _t=B+je,ht=Q+(R+je),ut=_t*J,lt=ht*re,at=K[lt]+F,bi=K[lt+1]+D,gi=K[lt+2]+z;W[ut]=at,W[ut+1]=bi,W[ut+2]=gi,of(at,bi,gi,u);const We=_t*k,ii=ht*Re;L[We]=be[ii],L[We+1]=be[ii+1];const Ye=je/l,He=a?v:$e(Ye,h,f),Lt=a?$e(Ye,p,g):b;ig(H,_t,He,Lt)}}function w6e(t){const{geometry:e,geometryState:i,localOrigin:r}=t,{clippingArea:s,samplerData:n}=i,{minu:o,minv:a,maxu:l,maxv:c,boundingBox:u,vertexAttributes:h}=e,p=t.tile,{surface:f,ellipsoid:g,extent:y,extentInRadians:v,horizontalScale:b}=p,w=f.view?.viewingMode==="local",x=g.radius;let S=0,E=0,C=0;const R=(We,ii,Ye)=>{const He=v[ii===0?1:3],Lt=v[We===0?0:2],kt=Math.cos(He),Kt=Math.sin(He),wt=Math.sin(Lt),rt=Math.cos(Lt),st=x+Ye;S=rt*kt*st,E=wt*kt*st,C=Kt*st},I=w?(()=>{const We=s,ii=We!=null&&(y[3]>We[3]||y[2]>We[2]||y[1]<We[1]||y[0]<We[0]),Ye=m6e(f.isWebMercatorOnPlateCarree,x,b);return(He,Lt,kt)=>{const Kt=He===0?y[0]:y[2],wt=Lt===0?y[1]:y[3],rt=ii?$e(Kt,We[0],We[2]):Kt,st=ii?$e(wt,We[1],We[3]):wt,Ht=kt;S=rt*b,E=Ye(st),C=Ht}})():R;let F=0,D=0,z=0,B=0,Y=0,W=0,J=0,me=0,L=0;const k=w&&f.isWebMercatorOnPlateCarree,H=(We,ii,Ye,He,Lt)=>{let kt=0,Kt=0,wt=0;if(w){const rt=ii*b,st=k?(Math.PI/2-2*Math.atan(Math.exp(-Ye/x)))*x:Ye*b;kt=rt-S,Kt=st-E,wt=He-C}else{const rt=fpe(We),st=We.tile,Ht=st.extent,ui=st.extentInRadians,Er=(ii-Ht[0])/(Ht[2]-Ht[0]),Oi=(Ye-Ht[1])/(Ht[3]-Ht[1]),ki=ui[0]*(1-Er)+ui[2]*Er,Rr=rt(Oi),Dr=Math.cos(Rr),rr=Math.sin(Rr),sr=Math.sin(ki),ji=Math.cos(ki),hi=x+He;kt=ji*Dr*hi-S,Kt=sr*Dr*hi-E,wt=rr*hi-C}switch(Lt){case 0:J+=kt,me+=Kt,L+=wt;break;case 1:B-=kt,Y-=Kt,W-=wt;break;case 2:J-=kt,me-=Kt,L-=wt;break;case 3:B+=kt,Y+=Kt,W+=wt}},q=s??ype,Q=y[0],K=y[2],re=y[1],be=y[3],Re=[be>q[3],K>q[2],re<q[1],Q<q[0]],je=Math.max(Q,q[0]),_t=Math.min(K,q[2]),ht=Math.max(re,q[1]),ut=Math.min(be,q[3]),lt=We=>Math.max(q[0],Math.min(q[2],We)),at=We=>Math.max(q[1],Math.min(q[3],We)),bi=We=>{const ii=i.cornerNeighborCornerTiles;F=0,D=0,z=1,B=0,Y=0,W=0,J=0,me=0,L=0;let Ye=1/0;for(let rt=0;rt<4;++rt){const st=ii[4*We+rt];Ye=Math.min(Ye,st?.level??1/0)}for(let rt=0;rt<4;++rt){const st=ii[4*We+rt];E3[rt]=st?.level===Ye?st:null}let He=1,Lt=0;for(let rt=0;rt<4;++rt){const st=E3[rt];st&&(He=Math.max(He,st?.renderData.geometryState.numVerticesPerSide),Lt=st.extent[2]-st.extent[0])}const kt=Lt,Kt=He;qe(Kt>1);const wt=kt/Kt;for(let rt=0;rt<4;++rt){const st=E3[(rt+3)%4],Ht=E3[rt%4];if(!st&&!Ht)continue;const ui=rt===0?1:rt===1?2:rt===2?3:0,Er=rt===0?2:rt===1?3:rt===2?0:1;if(st&&Ht){const Oi=UZ[rt][0]*wt,ki=UZ[rt][1]*wt,Rr=st.extent,Dr=lt(Rr[ui===0||ui===1?2:0]+Oi),rr=at(Rr[ui===0||ui===3?3:1]+ki),sr=Ht.extent,ji=lt(sr[Er===0||Er===1?2:0]+Oi),hi=at(sr[Er===0||Er===3?3:1]+ki),Ci=st.renderData,nr=Ht.renderData,_r=js(Dr,rr,Ci.geometryState.samplerData),Cs=js(ji,hi,nr.geometryState.samplerData);H(Ci,Dr,rr,.5*(_r+Cs),rt)}else{const Oi=st??Ht,ki=st?ui:Er,Rr=Oi.extent,Dr=UZ[rt],rr=lt(Rr[ki===0||ki===1?2:0]+Dr[0]*wt),sr=at(Rr[ki===0||ki===3?3:1]+Dr[1]*wt),ji=Oi.renderData,hi=js(rr,sr,ji.geometryState.samplerData);H(ji,rr,sr,hi,rt)}}if(!w){const rt=Math.sqrt(S*S+E*E+C*C);F=S/rt,D=E/rt,z=C/rt}if(w||z*z<.999){const rt=Math.sqrt(B*B+Y*Y+W*W);B/=rt,Y/=rt,W/=rt;const st=Math.sqrt(J*J+me*me+L*L);J/=st,me/=st,L/=st,F=W*me-Y*L,D=B*L-W*J,z=Y*J-B*me;const Ht=1/Math.sqrt(F*F+D*D+z*z);F*=Ht,D*=Ht,z*=Ht}},gi=i.cornerNeighborCornerTiles;for(let We=0;We<4;++We){const ii=We,Ye=(We+1)%4,He=We===0||We===1?1:0,Lt=We===0||We===3?1:0,kt=$e(He,o,l),Kt=$e(Lt,a,c),wt=e.getEdgeFirstVertexIndex(ii),rt=e.getEdgeCount(ii),st=We===0||We===3?rt-1:0,Ht=e.getEdgeFirstVertexIndex(Ye),ui=e.getEdgeCount(Ye),Er=We===0||We===1?ui-1:0;let Oi=-1;for(let Dr=0;Dr<4;++Dr){const rr=gi[4*We+Dr],sr=gi[4*We+Oi];rr&&(Oi===-1||e0(sr,rr)>0)&&(Oi=Dr)}const ki=Oi,Rr=gi[4*We+ki];if(Rr!==p){const Dr=p.level-Rr.level,rr=2**Dr,sr=[Rr.lij[0]+Dr,Rr.lij[1]*rr,Rr.lij[2]*rr],ji=[sr[1]+rr===p.lij[1],We===0&&(ki===1||ki===0&&Rr!==gi[4*We+3])||We===1&&(ki===0||ki===1&&Rr!==gi[4*We+2]),sr[1]===p.lij[1]+1,We===2&&(ki===3||ki===2&&Rr!==gi[4*We+1])||We===3&&(ki===2||ki===3&&Rr!==gi[4*We+0])],hi=ji.reduce((Pr,Fr)=>Pr+(Fr?1:0),0);qe(hi===1||hi===2);let Ci=-1,nr=-1;const _r=Rr.renderData;if(hi===1){const Pr=ji.findIndex(Zs=>Zs);qe(0<=Pr&&Pr<=3),Ci=(Pr+2)%4;const Fr=i.edgeResolutions[Pr];nr=p.getNeighborEdgeStartVertexIndex(Pr,Rr)*Fr+Fr*(Pr===0&&We===0||Pr===1&&We===0||Pr===2&&We===1||Pr===3&&We===3?1:0)}else{qe(ji[1]||ji[3]),Ci=ji[1]?3:1;const Pr=_r.geometryState.edgeResolutions[Ci];nr=We===0||We===3?0:Pr}const Cs=_r.geometry;{const Pr=wt+st,Fr=Ht+Er,Zs=Cs.getEdgeFirstVertexIndex(Ci)+nr,Cn=Cs.vertexAttributes,Ca=_r.localOrigin;{const Io=Cn.position,Qo=Io.typedBuffer,uo=Zs*Io.typedBufferStride,Js=Qo[uo]+Ca[0]-r[0],Ii=Qo[uo+1]+Ca[1]-r[1],zn=Qo[uo+2]+Ca[2]-r[2];of(Js,Ii,zn,u);const ho=h.position,Kn=ho.typedBuffer;{const de=Pr*ho.typedBufferStride;Kn[de]=Js,Kn[de+1]=Ii,Kn[de+2]=zn}{const de=Fr*ho.typedBufferStride;Kn[de]=Js,Kn[de+1]=Ii,Kn[de+2]=zn}}const Jc=h.uv0;ig(Jc,Pr,kt,Kt),ig(Jc,Fr,kt,Kt);{const Io=Cn.normalCompressed.typedBuffer,Qo=Zs*Cn.normalCompressed.typedBufferStride,uo=h.normalCompressed,Js=uo.typedBuffer;{const Ii=Pr*uo.typedBufferStride;Js[Ii]=Io[Qo],Js[Ii+1]=Io[Qo+1]}{const Ii=Fr*uo.typedBufferStride;Js[Ii]=Io[Qo],Js[Ii+1]=Io[Qo+1]}}}}else{const Dr=Re[ii],rr=Re[Ye];let sr;if(Dr||rr){const nr=$e(Q*(1-He)+K*He,je,_t),_r=$e(re*(1-Lt)+be*Lt,ht,ut);sr=js(nr,_r,n)}else sr=ABt(gi,We);I(He,Lt,sr),bi(We);const ji=S-r[0],hi=E-r[1],Ci=C-r[2];of(ji,hi,Ci,u),e.setEdgeVertexFromValuesRawPositionUVNormal(ii,st,ji,hi,Ci,kt,Kt,F,D,z),e.setEdgeVertexFromValuesRawPositionUVNormal(Ye,Er,ji,hi,Ci,kt,Kt,F,D,z)}}for(let We=0;We<4;++We)E3[We]=null}function ABt(t,e){const i=4*e,r=dpe.reduce((a,l)=>Math.min(a,t[i+l]?.level??1/0),1/0);Go&&(qe(!t[i+0]||!t[i+2]||une(t[i+0],t[i+2],It.SOUTH_WEST)),qe(!t[i+1]||!t[i+3]||une(t[i+1],t[i+3],It.NORTH_WEST)));let s=0,n=0;for(let a=0;a<4;++a){const l=t[i+a];if(l&&l.level===r){const c=a===0||a===1,u=a===0||a===3,h=l.extent,p=h[c?0:2],f=h[u?1:3],g=l.renderData?.geometryState?.samplerData;n+=js(p,f,g),s++}}const o=s?n/s:0;return qe(o!=null),o}function s$(t){const{vao:e,geometry:i}=t,{vertexAttributes:r,edgeVerticesStartIndex:s}=i,n=r.position.typedBuffer;e.vertexBuffers.geometry.setSubData(n,s,s,n.length)}function x6e(t){const{vao:e,geometry:i}=t,{indices:r,indexCount:s,edgeIndicesStartIndex:n}=i;e.indexBuffer.setSubData(r,n,n,s)}let RBt=class{constructor(e,i,r,s,n){this.isNorth=e,this.connectedRowOffset=i,this.connectedOuterEdgeOffset=r,this.rowOffset=s,this.latitudeResolution=n}};const UZ=[[0,1],[1,0],[0,-1],[-1,0]],Fa=new C5t,ype=Oq(-1/0,-1/0,1/0,1/0),E3=[null,null,null,null];function S6e(t,e,i){if(!e)return!1;const r=e0(t,e);return r>0||r===0&&i>=2}let NB=class{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(e){return qe(0<=e&&e<this.count),this.vertex0Index+this.stride*e}};const _pe=[new NB,new NB,new NB,new NB];function of(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}function T6e(t){const{edgeResolutions:e,numVerticesPerSide:i}=t,r=1+Math.max(...e);return Math.max(i,r)}function E6e(t,e,i,r,s,n){const o=t*s,a=n[o],l=n[o+1],c=n[o+2],u=e*s,h=n[u],p=n[u+1],f=n[u+2],g=i*s,y=n[g],v=n[g+1],b=n[g+2],w=r*s,x=n[w],S=n[w+1],E=n[w+2];return(h-x)*(h-x)+(p-S)*(p-S)+(f-E)*(f-E)>(a-y)*(a-y)+(l-v)*(l-v)+(c-b)*(c-b)}function uP(t,e,i,r,s){t[e]=i,t[e+1]=r,t[e+2]=r,t[e+3]=s,t[e+4]=s,t[e+5]=i}const UG=6;let PBt=class extends lpe{constructor(e,i,r,s,n){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=li(),this._baseUsedMemory=900,this._subtreeGeometryElevationBoundMin=0,this._subtreeGeometryElevationBoundMax=0,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const o=n.view.renderSpatialReference,a=n.spatialReference,l=o!=null&&CE(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const{isWebMercatorOnPlateCarree:c}=n,u=this._extentInRenderSR,h=this.extent;if(c){const p=Be(h[0],h[1],0);wa(p,Je.WebMercator,p,Je.PlateCarree);const f=Be(h[2],h[3],0);wa(f,Je.WebMercator,f,Je.PlateCarree),u[0]=p[0],u[1]=p[1],u[2]=f[0],u[3]=f[1]}else for(let p=0;p<4;++p)u[p]=h[p]*l;this.centerAtSeaLevel[0]=.5*(u[0]+u[2]),this.centerAtSeaLevel[1]=.5*(u[1]+u[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(u[2]-u[0],u[3]-u[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBoundsMax-this.elevationBoundsMin),o=Math.max(s,n);this._center[Hn.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const i=this._aabb(),r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5];let c=!0;for(let u=0;u<6;u++){const h=e[u],p=h[0],f=h[1],g=h[2],y=h[3];if(p*(p>0?r:o)+f*(f>0?s:a)+g*(g>0?n:l)+y>=0)return Wl.OUTSIDE;c=c&&p*(p<0?r:o)+f*(f<0?s:a)+g*(g<0?n:l)+y<=0}return c?Wl.INSIDE:Wl.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return Eft(e[0],e[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),e[2],e[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(e,i,r,s){return LB[0]=1/i[0],LB[1]=1/i[1],LB[2]=1/i[2],Zhe(this._aabb(),e,LB,r,s)}createGeometry(){yBt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds(),this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){const e=this._subtreeGeometryElevationBoundMin,i=this._subtreeGeometryElevationBoundMax,r=this.renderData;let s=e,n=i;if(r){const o=r.geometry.boundingBox;s=o[2],n=o[5]}else if(!this.isLeaf){s=1/0,n=-1/0;for(const o of this.children)s=Math.min(s,o._subtreeGeometryElevationBoundMin),n=Math.max(n,o._subtreeGeometryElevationBoundMax)}(s!==this._subtreeGeometryElevationBoundMin||n!==this._subtreeGeometryElevationBoundMax)&&(this._subtreeGeometryElevationBoundMin=s,this._subtreeGeometryElevationBoundMax=n,this.parent?._updateSubtreeGeometryElevationsBounds())}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){vBt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){wBt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){bBt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}};const LB=M();let OBt=class{constructor(){this.extent=pi(),this.minLevel=0,this.maxLevel=0,this.callback=null}},BG=class extends Fe{constructor(){super(...arguments),this._queries=new ci({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new ci({initialSize:30}),this._queryPool=new Tl(OBt)}queryVisibleLevelRange(e,i,r,s){const n=this._queryPool.acquire();Kp(n.extent,e),n.minLevel=i??-Number.MAX_VALUE,n.maxLevel=r??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};d([m()],BG.prototype,"updating",null),BG=d([N("esri.views.3d.terrain.ScaleRangeQueries")],BG);function IBt(t,e,i,r){const s=Math.cos(i);t[0]=Math.cos(e)*s*r,t[1]=Math.sin(e)*s*r,t[2]=Math.sin(i)*r}let $Bt=class extends lpe{constructor(e,i,r,s,n){super(),this._convexHull=new Array(24),this._boundingSphere=Bn(),this._baseUsedMemory=1816,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],u=this.extentInRadians[3],h=Wt(l,u,.5),p=Wt(a,c,.5),f=e===0?0:Math.min(Math.abs(l),Math.abs(u));this._edgeLen=(c-a)*Math.cos(f)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),IBt(this.centerAtSeaLevel,p,h,this.ellipsoid.radius),Se(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)ue(e[Hn.MIDDLE],0,0,0),ue(e[Hn.TOP],0,0,0),ue(e[Hn.BOTTOM],0,0,0),e[Hn.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const i=e[Hn.MIDDLE],r=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,NBt(i,r,3*n));e[Hn.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!xw(e,this._boundingSphere))return Wl.OUTSIDE;if(this.lij[0]<10)return Wl.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<qI;n++){const o=n===zr.NEAR,a=e[n],l=a[0],c=a[1],u=a[2],h=a[3]-(o?r:0);let p=!1;for(let f=0;f<8;++f){const g=3*f;if(l*i[g]+c*i[g+1]+u*i[g+2]+h<0){if(p=!0,!s)break}else s=!1}if(!p)return Wl.OUTSIDE}return s?Wl.INSIDE:Wl.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){cBt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Go&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=e,r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this.ellipsoid.radius,o=s;if(this.level===0)ue(i,0,0,0),e[3]=n+o;else{const a=this.extentInRadians,l=.5*(a[0]+a[2]),c=a[1],u=a[3];HS(iTe,l,c,n),HS(rTe,l,u,n),Te(i,iTe,rTe),ce(i,i,(n+.5*(r+s))/$c(i));const h=this.convexHull;let p=0;const f=(y,v)=>{const b=y[0]-h[3*v],w=y[1]-h[3*v+1],x=y[2]-h[3*v+2];return Math.sqrt(b*b+w*w+x*x)};for(let y=0;y<8;++y){const v=f(i,y);p=Math.max(p,v)}const g=p;e[3]=g+2}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this._getPatchType(),o=this.surface.isWebMercator,a=o&&n===Wp.HAS_NORTH_POLE,l=o&&n===Wp.HAS_SOUTH_POLE,c=l||a,u=Math.PI/2,h=e[0],p=e[2],f=l?-u:e[1],g=a?u:e[3],y=.5*(h+p),v=r,b=i+(c?Math.min(0,v-1):v),w=(L,k,H)=>HS(L,k,H,b),x=M(),S=M(),E=M(),C=M();w(x,h,f),w(S,h,g),w(E,p,g),w(C,p,f);const R=(L,k)=>{for(let H=0;H<3;++H)this._convexHull[3*k+H]=L[H]};R(x,0),R(S,1),R(E,2),R(C,3);const I=s,F=i+(c?Math.max(0,I+1):I),D=M(),z=M(),B=M();HS(z,y,g,b),HS(B,y,f,b),Te(D,z,B),Se(D,D);const Y=M(),W=M(),J=(L,k)=>{Vi(W,L,k),Se(W,W);const H=-xe(L,Y)/xe(W,Y);qe(H>=0),ce(W,W,H),Te(L,L,W)};if(2**this.lij[0]>2*this.lij[1]){const L=B,k=M();yt(k,tTe,L),Se(k,k),yt(Y,L,k),Se(Y,Y),qe(Yp(xe(Y,L)/$c(L),0)),J(x,S),J(C,E),R(x,0),R(C,3)}else if(2**this.lij[0]!==2*this.lij[1]){const L=z,k=M();yt(k,tTe,L),Se(k,k),yt(Y,k,L),Se(Y,Y),J(S,x),J(E,C),R(S,1),R(E,2)}const me=(L,k)=>{const H=F/xe(k,D);for(let q=0;q<3;++q)this._convexHull[3*L+q]=k[q]*H};me(4,x),me(5,S),me(6,E),me(7,C)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?Wp.HAS_BOTH_POLES:Wp.HAS_NORTH_POLE:r?Wp.HAS_SOUTH_POLE:Wp.REGULAR}intersectsRay(e,i,r,s){const n=this._boundingSphere,o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-e[0],c=n[1]-e[1],u=n[2]-e[2],h=(l*i[0]+c*i[1]+u*i[2])/a,p=i[0]*h-l,f=i[1]*h-c,g=i[2]*h-u;return p*p+f*f+g*g<o*o}getDefaultVerticesPerSide(){return this.level<eTe.length?eTe[this.level]+1:2}updateCornerElevations(){fBt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){dBt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){pBt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!Go||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=e,s=M(),n=this.ellipsoid.radius,o=this.elevationBoundsMin,a=this.elevationBoundsMax,l=n+o,c=1,u=0,h=this._center[Hn.MIDDLE][3],p=this.convexHull,f=(Ye,He)=>{for(let Lt=0;Lt<3;++Lt)Ye[Lt]=p[3*He+Lt]};{const Ye=M(),He=M(),Lt=M(),kt=M(),Kt=M(),wt=(rt,st,Ht,ui)=>{f(He,rt),f(Lt,st),f(kt,Ht),Vi(He,He,Lt),Vi(kt,kt,Lt),yt(Ye,He,kt),Se(Ye,Ye);const Er=xe(Ye,Lt);f(Kt,ui);const Oi=xe(Ye,Kt),ki=Math.abs(Oi-Er);qe(Yp(ki,0),`Non coplanar ${rt},${st},${Ht},${ui} diff = ${ki}`)};wt(0,1,2,3),wt(4,5,6,7),wt(0,1,4,5),wt(1,2,5,6),wt(2,3,6,7),wt(3,0,7,4)}const g=qo(24),y=(Ye,He,Lt)=>{const kt=4*Ye;for(let Kt=0;Kt<3;++Kt)g[kt+Kt]=He[Kt];g[kt+3]=Lt},v=M(),b=M(),w=M(),x=M(),S=(Ye,He,Lt,kt)=>{f(v,He),f(b,Lt),f(w,kt),Vi(v,v,b),Se(v,v),Vi(w,w,b),Se(w,w),yt(x,v,w),Se(x,x);const Kt=xe(x,b);y(Ye,x,Kt)};S(0,0,1,2),S(1,1,0,4),S(2,1,5,2),S(3,3,2,6),S(4,4,0,3),S(5,4,6,5);const E=1,C=(Ye,He,Lt,kt)=>{const Kt=4*Ye;return g[Kt]*He+g[Kt+1]*Lt+g[Kt+2]*kt-g[Kt+3]},R=(Ye,He,Lt,kt)=>C(Ye,He,Lt,kt)>=-E,I=(Ye,He)=>R(Ye,He[0],He[1],He[2]),F=2**this.lij[0]>2*this.lij[1],D=(Ye,He,Lt)=>Math.sqrt(C6e(Ye,He,Lt,r[0],r[1],r[2]))<i,z=Ye=>D(Ye[0],Ye[1],Ye[2]),B=(Ye,He)=>D(Ye[He],Ye[He+1],Ye[He+2]),Y=this.extentInRadians,W=.5*(Y[0]+Y[2]),J=Y[1],me=Y[3],L=M(),k=M();HS(L,W,me,l),HS(k,W,J,l);const H=F?"Upper":"Lower";let q=!0;for(let Ye=0;Ye<6;++Ye){for(let He=0;He<8;++He){const Lt=3*He,kt=R(Ye,p[Lt],p[Lt+1],p[Lt+2]);q&&=kt,qe(kt,`Tile[${this.lij}] Convex hull point ${He} outside of plane ${Ye}`)}qe(I(Ye,k),`Tile[${this.lij}] (${H}) bottom mid outside of plane ${Ye}`),qe(I(Ye,L),`Tile[${this.lij}] (${H}) top mid outside of plane ${Ye}`)}qe(q,"Not all convex hull points are inside  convex hull polyhedron"),qe(z(k),`Tile[${this.lij}] (${H}) bottom mid outside of bounding sphere`),qe(z(L),`Tile[${this.lij}] (${H}) top mid outside of bounding sphere`);for(let Ye=0;Ye<8;++Ye){const He=B(p,3*Ye);qe(He,`Tile[${this.lij}] Convex hull point ${Ye} outside of bounding sphere`)}for(let Ye=0;Ye<6;++Ye)for(let He=0;He<8;++He){const Lt=3*He;R(Ye,p[Lt],p[Lt+1],p[Lt+2])||console.error(`Tile[${this.lij}] Convex hull point ${He} outside of plane ${Ye}`)}const{extentInRadians:Q}=this,K=Math.max(Q[2]-Q[0],Q[3]-Q[1]),re=Math.round(K*n),{renderData:be}=this;if(!be)return;const{geometry:Re,geometryState:je,localOrigin:_t}=be,ht=Re.vertexAttributes?.position;if(!ht)return;const ut=M(),lt=Re.numVerticesPerSide-2,{indices:at,indexCount:bi,edgeVerticesStartIndex:gi,poleVerticesStartIndex:We}=Re;if(!at)return;const ii=new Set;for(let Ye=0;Ye<bi;++Ye){const He=at[Ye];if(ii.has(He))continue;ii.add(He);const Lt=He<We,kt=He>=gi;let Kt=!1,wt=-1;if(kt){let hi=gi;for(let Ci=0;Ci<4;++Ci){const nr=je.edgeResolutions[Ci];if(He===hi||He===hi+nr-1){Kt=!0;break}if(hi+=nr,He<hi){wt=Ci;break}}}const rt=kt?je.edgePeerNeighbors[wt]:null,st=kt&&rt&&e0(this,rt)>0;ht.getVec(He,s),Te(ut,s,_t);const Ht=$c(ut)-n;let ui=0,Er=!1;const Oi=o-Ht,ki=Ht-a,Rr=Oi>c,Dr=ki>c,rr=Rr||Dr,sr=()=>{const hi=Lt?"internal":kt&&!Kt?"edge":Kt?"corner":"pole";return`Tile[${this.lij}].vertex[${He}]:${hi}`+(Rr?"(below)":Dr?"(above)":"")+(st?"(Neighbor)":"")},ji=Rw(ut,r);if(ji>=i+u){const hi=ji-i;rr||(console.error(`${sr()} is out of the bounding sphere by ${hi.toFixed(0)} / ${i.toFixed(0)}[tol=${u}] h=${Ht.toFixed(0)} / [${o.toFixed(0)}..${a.toFixed(0)}] (${(hi/i).toFixed(0)})`),Er=!0)}for(let hi=0;hi<6;++hi)if(!R(hi,ut[0],ut[1],ut[2])){const Ci=C(hi,ut[0],ut[1],ut[2]),nr=He%lt,_r=(He-nr)/lt;hi===0&&Oi||hi===5&&ki||(console.error(`${sr()} (${nr},${_r})|${lt}] is out of the bounding trapezoid plane ${hi} h=${Math.round(Ht)} / [${Math.round(o)}..${Math.round(a)}] dist=${Math.round(Ci)} radii = ${Math.round(i)}/${Math.round(h)}} : maxL = ${re}`),++ui)}if(Er||ui>0)break}}get convexHull(){return this._convexHull}};const eTe=[128,64,64,32,16,8,8,4];function NBt(t,e,i){return C6e(t[0],t[1],t[2],e[i],e[i+1],e[i+2])}function C6e(t,e,i,r,s,n){const o=r-t,a=s-e,l=n-i;return o*o+a*a+l*l}const HS=(t,e,i,r)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(i),a=Math.sin(i);t[0]=r*o*s,t[1]=r*o*n,t[2]=r*a},tTe=[0,0,1],iTe=M(),rTe=M();let hm=class extends Fe{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};d([m()],hm.prototype,"fovX",void 0),d([m()],hm.prototype,"fovY",void 0),d([m()],hm.prototype,"relativeWidthLimit",void 0),d([m()],hm.prototype,"relativeHeightLimit",void 0),d([m()],hm.prototype,"maxLod",void 0),d([m()],hm.prototype,"angledSplitBias",void 0),d([m()],hm.prototype,"aboveGround",void 0),d([m()],hm.prototype,"frustum",void 0),hm=d([N("esri.views.3d.terrain.SplitLimits")],hm);const LBt=Xs().vec3f(O.POSITION).vec2i16(O.UV0).vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0});let DBt=class{constructor(e){this._storage=new x4((i,r)=>e.newCache(i,r),"TileGeometry")}acquire(e){const r=Math.ceil(e/4)*4,s=this._storage,n=FBt(r),o=s.pop(n);if(o)return o;const a=LBt.createBuffer(r);return a.release=()=>s.put(n,a),a}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function FBt(t){return t.toString()}var Ze;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Ze||(Ze={}));const hne={normal:Ze.Normal,average:Ze.Average,lighten:Ze.Lighten,lighter:Ze.Lighter,screen:Ze.Screen,plus:Ze.Plus,"color-dodge":Ze.ColorDodge,darken:Ze.Darken,multiply:Ze.Multiply,"color-burn":Ze.ColorBurn,overlay:Ze.Overlay,"soft-light":Ze.SoftLight,"hard-light":Ze.HardLight,"vivid-light":Ze.VividLight,hue:Ze.Hue,saturation:Ze.Saturation,luminosity:Ze.Luminosity,color:Ze.Color,difference:Ze.Difference,exclusion:Ze.Exclusion,minus:Ze.Minus,invert:Ze.Invert,reflect:Ze.Reflect,"destination-over":Ze.DestinationOver,"destination-atop":Ze.DestinationAtop,"destination-in":Ze.DestinationIn,"destination-out":Ze.DestinationOut,"source-atop":Ze.SourceAtop,"source-in":Ze.SourceIn,"source-out":Ze.SourceOut,xor:Ze.Xor};function kBt(t){return t===Ze.DestinationOver||t===Ze.DestinationAtop||t===Ze.DestinationIn||t===Ze.DestinationOut||t===Ze.SourceAtop||t===Ze.SourceIn||t===Ze.SourceOut||t===Ze.Xor}let M6e=class extends Zc{constructor(){super(...arguments),this.blendMode=Ze.Normal}};d([V({count:Ze.COUNT})],M6e.prototype,"blendMode",void 0);var jl;(function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"})(jl||(jl={}));var ro;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(ro||(ro={}));var Em;(function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"})(Em||(Em={}));let BD=class extends M6e{constructor(){super(...arguments),this.output=ro.Composite,this.baseOpacityMode=jl.NotRequired,this.premultipliedSource=Em.Off}};d([V({count:ro.COUNT})],BD.prototype,"output",void 0),d([V({count:jl.COUNT})],BD.prototype,"baseOpacityMode",void 0),d([V()],BD.prototype,"premultipliedSource",void 0);let A6e=class extends is{constructor(){super(...arguments),this.scale=1,this.offset=kE}};function R6e(t){t.attributes.add(O.POSITION,"vec2"),t.attributes.add(O.UV0,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.uniforms.add(new et("scale",e=>e.scale),new os("offset",e=>e.offset)).code.add(T`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}function UBt(t,e){const i=e.blendMode;i!==Ze.Normal&&(i===Ze.Reflect&&t.code.add(T`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Ze.ColorDodge&&i!==Ze.VividLight||t.code.add(T`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Ze.ColorBurn&&i!==Ze.VividLight||t.code.add(T`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Ze.Overlay&&t.code.add(T`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Ze.HardLight&&t.code.add(T`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Ze.SoftLight&&t.code.add(T`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Ze.VividLight&&t.code.add(T`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Ze.Hue&&i!==Ze.Saturation&&i!==Ze.Color&&i!==Ze.Luminosity||(t.code.add(T`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Ze.Hue&&i!==Ze.Saturation||t.code.add(T`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(T`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Ze.Multiply?T`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.Average?T`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.Lighten?T`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.Darken?T`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.Lighter?T`return vec4(cl * ol + cb * ob, ol + ob);`:i===Ze.Plus?T`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Ze.Minus?T`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Ze.Screen?T`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.Difference?T`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.Invert?T`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Ze.DestinationOver?T`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Ze.DestinationAtop?T`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Ze.DestinationOut?T`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Ze.SourceAtop?T`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Ze.SourceOut?T`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Ze.Xor?T`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Ze.DestinationIn?T`return vec4(cb * ob * ol, ol * ob);`:i===Ze.SourceIn?T`return vec4(cl * ol * ob, ol * ob);`:i===Ze.Hue?T`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.Saturation?T`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.Color?T`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.Luminosity?T`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.Exclusion?T`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.Reflect?T`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.ColorDodge?T`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.ColorBurn?T`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.Overlay?T`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.SoftLight?T`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.HardLight?T`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ze.VividLight?T`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:T``}
    }
  `))}function P6e(t,e){const i=e.output===ro.GridComposite,r=e.output===ro.ColorComposite,s=e.output===ro.GroupBackgroundComposite,n=e.output===ro.Composite,o=e.baseOpacityMode===jl.Required,a=t.fragment;o&&a.uniforms.add(new et("baseOpacity",h=>h.baseOpacity)),i?a.include(hpe):r?a.uniforms.add(new Qt("backgroundColor",h=>h.backgroundColor)):n&&a.uniforms.add(new Et("fboColor",h=>h.fboTexture));const l=e.blendMode!==Ze.Normal,c=e.premultipliedSource===Em.On,u=!l&&!c&&(n&&!o||s);a.include(UBt,e),a.code.add(T`
    vec4 getBackground(vec2 uv) {
      return ${o?T`baseOpacity *`:""} ${s?T`vec4(0.0, 0.0, 0.0, 0.0)`:r?T`vec4(backgroundColor, 1.0)`:i?T`vec4(gridColor(uv), 1.0)`:T`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec2 bgUV, vec4 colorLayer, float opacity) {
      ${l?T`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec4 bgColor = getBackground(bgUV);
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:T`
          float composeAlpha = colorLayer.a * opacity;
          ${u?T`return colorLayer * opacity;`:T`
            vec4 bgColor = getBackground(bgUV);
            return bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}var KE;function BBt(t){const e=new tr,i=e.fragment;if(e.include(R6e),t.background===KE.Only){const r=t.output===ro.ColorComposite;return r?i.uniforms.add(new Qt("backgroundColor",s=>s.backgroundColor)):i.include(hpe),i.code.add(T`
      void main() {
        fragColor = vec4(${r?T`backgroundColor`:T`gridColor(uv)`}, 1.0);
      }
    `),e}return e.include(P6e,t),i.uniforms.add(new Et("tex",r=>r.texture),new et("opacity",r=>r.opacity)).code.add(T`void main() {
fragColor = blendLayers(uv, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(KE||(KE={}));const zBt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return KE},build:BBt},Symbol.toStringTag,{value:"Module"}));let VBt=class extends A6e{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=co}},O6e=class I6e extends hr{initializeProgram(e){return new dr(e.rctx,I6e.shader.get().build(this.configuration),Fi)}initializePipeline(){return ti({blending:Zd(ke.ONE,ke.ONE_MINUS_SRC_ALPHA),colorWrite:fi})}};O6e.shader=new ir(zBt,()=>ye(()=>import("./BlendLayers.glsl-47a7fa3c.js"),[],import.meta.url));let $6e=class extends BD{constructor(){super(...arguments),this.background=KE.BelowLayer}};d([V()],$6e.prototype,"background",void 0);let dne=class{constructor(e,i,r,s,n,o){this.texture=e,this.type=i,e.retain(),this.offsetAndScale=ni(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Be(s,n,o)}destroy(){this.texture.release()}};var fE,eC;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(fE||(fE={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(eC||(eC={}));var pne,uw,lH,Om,fne,cH,mne,hw,gne;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(pne||(pne={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(uw||(uw={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(lH||(lH={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(Om||(Om={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(fne||(fne={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(cH||(cH={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(mne||(mne={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(hw||(hw={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(gne||(gne={}));let Gf=class{};Gf.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:uw.VISIBLE}},Gf.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:uw.VISIBLE}},Gf.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:uw.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:Tse.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:Ese.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},Gf.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:uw.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:lH.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:cH.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:Om.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:cH.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:fne.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:Om.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:mne.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[gne.HORIZONTAL]}},Gf.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:uw.VISIBLE}},Gf.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},Gf.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:hw.MAP}},Gf.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:hw.MAP},"line-width":{type:"number",minimum:0,default:1}},Gf.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:hw.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:hw.MAP}},Gf.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},Gf.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:hw.MAP}};function GBt(t,e,i,r,s,n){const{iconRotationAlignment:o,textRotationAlignment:a,iconTranslate:l,iconTranslateAnchor:c,textTranslate:u,textTranslateAnchor:h}=r;let p=0;for(const f of t.colliders){const[g,y]=f.partIndex===0?l:u,v=f.partIndex===0?c:h,b=f.minLod<=n&&n<=f.maxLod;p+=b?0:1,f.enabled=b,f.xScreen=f.xTile*s[0]+f.yTile*s[3]+s[6],f.yScreen=f.xTile*s[1]+f.yTile*s[4]+s[7],v===hw.MAP?(f.xScreen+=i*g-e*y,f.yScreen+=e*g+i*y):(f.xScreen+=g,f.yScreen+=y),Om.VIEWPORT===(f.partIndex===0?o:a)?(f.dxScreen=f.dxPixels,f.dyScreen=f.dyPixels):(f.dxScreen=i*(f.dxPixels+f.width/2)-e*(f.dyPixels+f.height/2)-f.width/2,f.dyScreen=e*(f.dxPixels+f.width/2)+i*(f.dyPixels+f.height/2)-f.height/2)}t.colliders.length>0&&p===t.colliders.length&&(t.unique.show=!1)}let jBt=class{constructor(e,i,r,s,n,o){this._symbols=e,this._styleRepository=s,this._zoom=n,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new qGe(i,r,zUt),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);for(const a of e)for(const l of a.symbols)this._allNeededMatrices.has(l.tile)||this._allNeededMatrices.set(l.tile,GGe(l.tile.transforms.tileUnitsToPixels))}work(e){const i=this._gridIndex;function r(n){const o=n.xScreen+n.dxScreen,a=n.yScreen+n.dyScreen,l=o+n.width,c=a+n.height,[u,h,p,f]=i.getCellSpan(o,a,l,c);for(let g=h;g<=f;g++)for(let y=u;y<=p;y++){const v=i.cells[g][y];for(const b of v){const w=b.xScreen+b.dxScreen,x=b.yScreen+b.dyScreen,S=w+b.width,E=x+b.height;if(!(l<w||o>S||c<x||a>E))return!0}}return!1}const s=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const n=this._symbols[this._currentLayerCursor],o=this._getProperties(n.styleLayerUID);for(;this._currentSymbolCursor<n.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-s>e)return!1;const a=n.symbols[this._currentSymbolCursor];if(!a.unique.show)continue;GBt(a,this._si,this._co,o,this._allNeededMatrices.get(a.tile),this._zoom);const l=a.unique;if(!l.show)continue;const{iconAllowOverlap:c,iconIgnorePlacement:u,textAllowOverlap:h,textIgnorePlacement:p}=o;for(const f of a.colliders){if(!f.enabled)continue;const g=l.parts[f.partIndex];g.show&&!(f.partIndex?h:c)&&r(f)&&(f.hard?l.show=!1:g.show=!1)}if(l.show)for(const f of a.colliders){if(!f.enabled||(f.partIndex?p:u)||!l.parts[f.partIndex].show)continue;const g=f.xScreen+f.dxScreen,y=f.yScreen+f.dyScreen,v=g+f.width,b=y+f.height,[w,x,S,E]=this._gridIndex.getCellSpan(g,y,v,b);for(let C=x;C<=E;C++)for(let R=w;R<=S;R++)this._gridIndex.cells[C][R].push(f)}}}return!0}_getProperties(e){const i=this._styleProps.get(e);if(i)return i;const r=this._zoom,s=this._styleRepository.getStyleLayerByUID(e),n=s.getLayoutValue("symbol-placement",r)!==lH.POINT;let o=s.getLayoutValue("icon-rotation-alignment",r);o===Om.AUTO&&(o=n?Om.MAP:Om.VIEWPORT);let a=s.getLayoutValue("text-rotation-alignment",r);a===Om.AUTO&&(a=n?Om.MAP:Om.VIEWPORT);const l=s.getPaintValue("icon-translate",r),c=s.getPaintValue("icon-translate-anchor",r),u=s.getPaintValue("text-translate",r),h=s.getPaintValue("text-translate-anchor",r),p={iconAllowOverlap:s.getLayoutValue("icon-allow-overlap",r),iconIgnorePlacement:s.getLayoutValue("icon-ignore-placement",r),textAllowOverlap:s.getLayoutValue("text-allow-overlap",r),textIgnorePlacement:s.getLayoutValue("text-ignore-placement",r),iconRotationAlignment:o,textRotationAlignment:a,iconTranslateAnchor:c,iconTranslate:l,textTranslateAnchor:h,textTranslate:u};return this._styleProps.set(e,p),p}};function HBt(t,e){if(t.priority-e.priority)return t.priority-e.priority;const i=t.tile.key,r=e.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:t.xTile-e.xTile?t.xTile-e.xTile:t.yTile-e.yTile}let qBt=class{get running(){return this._running}constructor(e,i,r,s,n,o){this._visibleTiles=e,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=s,this._symbolLayerSorter=n,this._isLayerVisible=o,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,i){this._screenWidth===e&&this._screenHeight===i||this.restart(),this._screenWidth=e,this._screenHeight=i}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const i=performance.now();if(!this._selectionJob.work(e)||(this._selectionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const i=performance.now();if(!this._collisionJob.work(e)||(this._collisionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const i=performance.now();if(!this._opacityJob.work(e)||(this._opacityJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}return this._running=!1,!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let l=0;l<e.length;l++){const c=e[l];for(let u=0;u<c.uniqueSymbols.length;u++){const h=c.uniqueSymbols[u];for(const p of h.tileSymbols)p.selectedForRendering=!1}}const i=[];let r=0,s=0;const n=this._isLayerVisible;function o(l){let c;const u=performance.now();for(;s<e.length;s++,r=0){const h=e[s],p=h.styleLayerUID;if(!n(p)){i[s]||(i[s]={styleLayerUID:p,symbols:[]});continue}i[s]=i[s]||{styleLayerUID:p,symbols:[]};const f=i[s];for(;r<h.uniqueSymbols.length;r++){if(c=h.uniqueSymbols[r],r%100==99&&performance.now()-u>l)return!1;let g=null,y=!1,v=!1;for(const b of c.tileSymbols)if(!v||!y){const w=b.tile;(!g||w.isCoverage||w.neededForCoverage&&!y)&&(g=b,(w.neededForCoverage||w.isCoverage)&&(v=!0),w.isCoverage&&(y=!0))}if(g.selectedForRendering=!0,v){f.symbols.push(g),c.show=!0;for(const b of c.parts)b.show=!0}else c.show=!1}}for(const h of i)h.symbols.sort(HBt);return!0}const a=this._symbolLayerSorter;return{work:o,get sortedSymbols(){return i.sort(a)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,i=this._visibleTiles;let r=0;function s(n,o){const a=n.symbols;for(const[l,c]of a)WBt(c,o);e(n,o);for(const l of n.childrenTiles)s(l,o)}return{work(n){const o=performance.now();for(;r<i.length;r++){if(performance.now()-o>n)return!1;const a=i[r];a.parentTile==null&&s(a,performance.now())}return!0}}}};function WBt(t,e){for(const i of t){const r=i.unique;for(const s of r.parts){const n=s.targetOpacity>.5?1:-1;s.startOpacity+=n*((e-s.startTime)/rne),s.startOpacity=Math.min(Math.max(s.startOpacity,0),1),s.startTime=e,s.targetOpacity=r.show&&s.show?1:0}}}const YBt=32,XBt=8,ZBt=64,JBt=20;let QBt=class{constructor(e,i,r){this.tileCoordRange=e,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return this._uniqueSymbolLayerArray==null&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(e,i){this._uniqueSymbolLayerArray=null;let r=this._tiles.get(e.id);r||(r={symbols:new Map},this._tiles.set(e.id,r));const s=new Map;if(i)for(const a of i)r.symbols.has(a)&&(s.set(a,r.symbols.get(a)),r.symbols.delete(a));else for(const[a,l]of e.layerData)r.symbols.has(a)&&(s.set(a,r.symbols.get(a)),r.symbols.delete(a));this._removeSymbols(s);const n=e.symbols,o=new Map;for(const[a,l]of n){let c=l.length;if(c>=YBt){let u=this.tileCoordRange;do u/=2,c/=4;while(c>XBt&&u>ZBt);const h=new qGe(this.tileCoordRange,this.tileCoordRange,u);o.set(a,{flat:l,index:h}),r.symbols.set(a,{flat:l,index:h});for(const p of l)h.getCell(p.xTile,p.yTile).push(p)}else o.set(a,{flat:l}),r.symbols.set(a,{flat:l})}this._addSymbols(e.key,n)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const[i,r]of this._tiles){const s=new Map;for(const n of e)r.symbols.has(n)&&(s.set(n,r.symbols.get(n)),r.symbols.delete(n));this._removeSymbols(s),r.symbols.size===0&&this._tiles.delete(i)}}removeTile(e){this._uniqueSymbolLayerArray=null;const i=this._tiles.get(e.id);if(!i)return;const r=new Map;for(const[s,n]of e.symbols)i.symbols.has(s)&&(r.set(s,i.symbols.get(s)),i.symbols.delete(s));this._removeSymbols(r),i.symbols.size===0&&this._tiles.delete(e.id)}querySymbols(e,i,r,s){const n=[],o=this.uniqueSymbols;for(const a of o){const l=a.styleLayerUID,c=a.uniqueSymbols;for(const u of c){const h=u.tileSymbols.find(p=>p.selectedForRendering);h&&DUt(h,e,i*(window.devicePixelRatio||1),r)&&n.push({vtlSymbol:h,styleLayerUID:l,tileKey:h.tile.key})}}return n}_removeSymbols(e){for(const[i,{flat:r}]of e)for(const s of r){const n=s.unique,o=n.tileSymbols,a=o.length-1;for(let l=0;l<a;l++)if(o[l]===s){o[l]=o[a];break}if(o.length=a,a===0){const l=this._uniqueSymbolsReferences.get(i);l.delete(n),l.size===0&&this._uniqueSymbolsReferences.delete(i)}s.unique=null}}_addSymbols(e,i){if(i.size===0)return;const r=this._visibleTiles;for(const s of r)s.parentTile||s.key.world!==e.world||s.key.level===e.level&&!s.key.equals(e)||this._matchSymbols(s,e,i);for(const[s,n]of i)for(const o of n)if(o.unique==null){const a=this._createUnique();o.unique=a,a.tileSymbols.push(o);let l=this._uniqueSymbolsReferences.get(s);l||(l=new Set,this._uniqueSymbolsReferences.set(s,l)),l.add(a)}}_matchSymbols(e,i,r){if(e.key.level>i.level){const n=e.key.level-i.level;if(e.key.row>>n!==i.row||e.key.col>>n!==i.col)return}if(i.level>e.key.level){const n=i.level-e.key.level;if(i.row>>n!==e.key.row||i.col>>n!==e.key.col)return}if(i.equals(e.key)){for(const n of e.childrenTiles)this._matchSymbols(n,i,r);return}const s=new Map;for(const[n,o]of r){const a=[];for(const h of o){const p=kSe(this.tileCoordRange,h.xTile,i.level,i.col,e.key.level,e.key.col),f=kSe(this.tileCoordRange,h.yTile,i.level,i.row,e.key.level,e.key.row);p>=0&&p<this.tileCoordRange&&f>=0&&f<this.tileCoordRange&&a.push({symbol:h,xTransformed:p,yTransformed:f})}const l=[],c=(e.key.level<i.level?1:1<<e.key.level-i.level)+JBt,u=this._tiles.get(e.id).symbols.get(n);if(u){const h=u.flat;for(const p of a){let f,g=!1;const y=p.xTransformed,v=p.yTransformed;f=u.index!=null?u.index.getCell(y,v):h;const b=p.symbol,w=b.hash;for(const x of f)if(w===x.hash&&Math.abs(y-x.xTile)<=c&&Math.abs(v-x.yTile)<=c){const S=x.unique;b.unique=S,S.tileSymbols.push(b),g=!0;break}g||l.push(b)}}l.length>0&&s.set(n,l)}for(const n of e.childrenTiles)this._matchSymbols(n,i,s)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsReferences,i=new Array(e.size);let r,s=0;for(const[n,o]of e){const a=new Array(o.size);r=0;for(const l of o)a[r++]=l;i[s]={styleLayerUID:n,uniqueSymbols:a},s++}return i}};function KBt(t,e){const i=t.transforms.tileUnitsToPixels,r=Sq(e),s=Math.cos(r),n=Math.sin(r),o=Math.ceil(512*(Math.abs(n)+Math.abs(s)));u9(Xg),BO(Xg,Xg,[o/2,o/2]),h9(Xg,Xg,r),BO(Xg,Xg,[-256,-256]),jk(Xg,Xg,[1/8,1/8,1]),t.transforms.tileUnitsToPixels=Xg;const a=[],l=new QBt(4096,a,()=>new IUt),c=new qBt(a,l,(u,h,p)=>new jBt(u,h,p,t.styleRepository,t.key.level,e),(u,h)=>{NUt(u,h,!1)},()=>0,u=>{const h=t.styleRepository.getStyleLayerByUID(u).getLayoutProperty("visibility");return!h||h.getValue()!==uw.NONE});a.push(t),l.add(t),c.setScreenSize(o,o),c.continue(1/0),l.removeTile(t),t.transforms.tileUnitsToPixels=i}const Xg=pE();let ezt=class extends WGe{_createTransforms(){return{displayViewScreenMat3:pE(),tileMat3:pE()}}},tzt=class{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const i=[];for(const r of this._candidateTiles)e>0?(r.reshuffle(),e--):i.push(r);this._candidateTiles=i}};const izt=.125;let rzt=class{constructor(){this._renderParams={reshuffleManager:new tzt,context:null,drawPhase:1,state:new szt,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new ezt(new Jv(0,0,0,0),0,0,0,512,512,4096,4096),this._heading=0,this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(e,i,r,s,n,o,a,l,c,u){const h=this._backgroundTile;this._updateRenderParameters(e,i,h,r,n,o,a,l,c,u),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,h,s)}renderContent(e,i,r,s,n,o,a,l,c,u,h,p){this._declutter(r),s.forAll(g=>this._declutter(g.sourceLayerInfo.data)),this._stencilSymbols(e,i,r,s,n,o,a,Math.round(1/l),c,u,h,p);let f=1;r.stencilRef=f++,e.setStencilFunction(Lr.EQUAL,r.stencilRef,255),this._render(e,i,r,n,o,a,l,c,u,h,p),s.forAll(g=>{g.sourceLayerInfo.data.stencilRef=f++,this._renderSymbols(e,g.sourceLod,g.sourceLayerInfo.data,n,o,a,Math.round(1/l),g.offset,u,h,p)})}_stencilSymbols(e,i,r,s,n,o,a,l,c,u,h,p){let f=1;r.stencilRef=f++,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(Us.KEEP,Us.KEEP,Us.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(Lr.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(e,i,r,n,o,a,l,c,u,h,p);for(const g of s.toArray()){const{sourceLod:y,offset:v,sourceLayerInfo:b}=g;b.data.stencilRef=f++,e.setStencilFunction(Lr.ALWAYS,b.data.stencilRef,255),this._stencilTileSymbols(e,y,b.data,n,o,a,l,v,u,h,p)}e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,i,r,s,n,o,a,l,c,u,h){e.setStencilFunction(Lr.EQUAL,r.stencilRef,255),this._render(e,i,r,s,n,o,a,l,c,u,h,pne.SYMBOL)}_render(e,i,r,s,n,o,a,l,c,u,h,p){this._updateRenderParameters(e,i,r,s,o,a,l,c,u,h),this._renderParams.stencilSymbols=!1,s.drawTile(this._renderParams,r,n,p)}_stencilTileSymbols(e,i,r,s,n,o,a,l,c,u,h){this._updateRenderParameters(e,i,r,s,o,a,l,c,u,h),this._renderParams.stencilSymbols=!0,r.triangleCount=0,s.drawSymbols(this._renderParams,r,n)}_updateRenderParameters(e,i,r,s,n,o,a,l,c,u){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(e);const h=i[0]-n.getLevelShift(i[0]),p=this._renderParams;p.context=e,p.painter=s,p.glyphMosaic=s.glyphMosaic,p.spriteMosaic=s.spriteMosaic,p.pixelRatio=c*u,p.displayLevel=h,p.requiredLevel=h;const f=n.getScale(i[0]),[g,y]=n.getOffset(i,o*f),v=izt*o*f/l,b=r.transforms.displayViewScreenMat3;b[0]=v,b[4]=-v,b[6]=-1-g-a[0]*o*2,b[7]=1+y+(1-a[1])*o*2-2;const w=p.state,x=l/u;w.size[0]=x,w.size[1]=x,w.pixelRatio=u,w.rotation=(360-this._heading)%360;const S=2/x;Jce(w.displayViewMat3,S,0,0,0,-S,0,-1,1,1);const E=u9(w.displayMat3),C=Sq(this._heading);BO(E,E,[x/2,x/2]),h9(E,E,C),BO(E,E,[-x/2,-x/2]),UO(E,w.displayViewMat3,E)}updateHeading(e){this._heading=e}_declutter(e){this._declutteredForHeading.get(e)!==this._heading&&(KBt(e,(360-this._heading)%360),this._declutteredForHeading.set(e,this._heading))}},szt=class{constructor(){this.size=[0,0],this.pixelRatio=1,this.rotation=0,this.displayMat3=ps(),this.displayViewMat3=ps(),this.transform=null,this.inverseTransform=null,this.viewMat2d=null,this.viewMat3=null,this.id=0,this.extent=null,this.center=null,this.scale=1,this.resolution=0,this.worldScreenWidth=0,this.spatialReference=null,this.viewpoint=null,this.getScreenTransform=null,this.toMap=null,this.toScreen=null,this.clone=null,this.copy=null,this.toJSON=null}};function nzt(t){t.fragment.uniforms.add(new Et("u_colormap",e=>e.u_colormap),new et("u_colormapOffset",e=>e.colormap.u_colormapOffset),new et("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new et("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(T`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function ozt(t){t.fragment.uniforms.add(new Et("u_transformGrid",e=>e.u_transformGrid),new os("u_transformSpacing",e=>e.common.u_transformSpacing),new os("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(T`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let azt=class extends A6e{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function lzt(t,e){t.include(ozt),t.fragment.uniforms.add(new Et("u_image",r=>r.u_image),new a0("u_flipY",r=>r.common.u_flipY),new a0("u_applyTransform",r=>r.common.u_applyTransform));const{requireBilinearWithNN:i}=e;i&&t.fragment.uniforms.add(new os("u_srcImageSize",r=>r.common.u_srcImageSize)),t.fragment.code.add(T`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),i?t.fragment.code.add(T`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(T`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}let vpe=class extends azt{constructor(e,i,r,s,n,o){super(e,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=co,this.fboTexture=null,this.baseOpacity=1}},czt=class extends vpe{},uzt=class extends vpe{};function hzt(t){const e=new tr;return e.include(R6e),e.include(lzt,t),e.include(nzt,t),e.include(P6e,t),e.fragment.code.add(T`vec4 applyBackgroundBlend(vec4 layerColor) {
return blendLayers(vuv, layerColor, u_opacity);
}`),t.colorizerType===fE.Stretch?pzt(e,t):t.colorizerType===fE.Lut?dzt(e):t.colorizerType===fE.Hillshade&&fzt(e,t),e}function dzt(t){t.fragment.code.add(T`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function pzt(t,e){t.fragment.uniforms.add(new KI("u_bandCount",r=>r.symbolizer.u_bandCount),new jc("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new jc("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new jc("u_factor",r=>r.symbolizer.u_factor,3),new et("u_minOutput",r=>r.symbolizer.u_minOutput),new et("u_maxOutput",r=>r.symbolizer.u_maxOutput),new a0("u_useGamma",r=>r.symbolizer.u_useGamma),new jc("u_gamma",r=>r.symbolizer.u_gamma,3),new jc("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new et("u_opacity",r=>r.common.u_opacity)),t.fragment.code.add(T`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?T`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:T`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(T`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===eC.Noop?T`
        fragColor = applyBackgroundBlend(currentPixel);`:T`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function fzt(t,e){const i=t.fragment;i.uniforms.add(new Et("u_image",s=>s.u_image),new KI("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new jc("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new jc("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new jc("u_cosZs",s=>s.symbolizer.u_cosZs,6),new jc("u_weights",s=>s.symbolizer.u_weights,6),new os("u_factor",s=>s.symbolizer.u_factor),new et("u_minValue",s=>s.symbolizer.u_minValue),new et("u_maxValue",s=>s.symbolizer.u_maxValue),new os("u_srcImageSize",s=>s.common.u_srcImageSize)),i.include(B0),i.code.add(T`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(T`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?T`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:T`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(T`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const mzt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:uzt,ColorizerStretchUniforms:czt,ColorizerUniforms:vpe,build:hzt},Symbol.toStringTag,{value:"Module"}));let N6e=class L6e extends hr{initializeProgram(e){return new dr(e.rctx,L6e.shader.get().build(this.configuration),Fi)}initializePipeline(){return ti({blending:Zd(ke.ONE,ke.ONE_MINUS_SRC_ALPHA),colorWrite:fi})}};N6e.shader=new ir(mzt,()=>ye(()=>import("./RasterColorizer.glsl-d5c676a0.js"),[],import.meta.url));let CL=class extends BD{constructor(){super(...arguments),this.colorizerType=fE.Stretch,this.stretchType=eC.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};d([V({count:fE.COUNT})],CL.prototype,"colorizerType",void 0),d([V({count:eC.COUNT})],CL.prototype,"stretchType",void 0),d([V()],CL.prototype,"applyColormap",void 0),d([V()],CL.prototype,"requireBilinearWithNN",void 0);let sTe=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new z0(this._rctx,new fs(e),new bFe(dl.DEPTH24_STENCIL8,e));return this._fbos.set(e,r),r}};const gzt=()=>oe.getLogger("esri.views.3d.terrain");let yzt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._fbos=[],this._vectorTileHelper=new rzt,this._bindParameters=new A9(null,null),this._blendLayersTechniqueConfig=new $6e,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=U0(this._rctx,Qk)}dispose(){this._fbos.forEach(jt),this._fbos=null,this._vtFBO=jt(this._vtFBO),this._vaoQuad=jt(this._vaoQuad),this._vectorTileHelper=jt(this._vectorTileHelper),this._backgroundTechnique=yi(this._backgroundTechnique),this._applyOpacityTechnique=yi(this._applyOpacityTechnique),this._blendLayersTechnique=yi(this._blendLayersTechnique)}updateHeading(e){this._vectorTileHelper?.updateHeading(e)}_getBlendLayersTechnique(e,i,r,s=Em.Off,n=KE.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniques.releaseAndAcquire(O6e,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,i){const r=this._getBlendLayersTechnique(Ze.Normal,i?ro.ColorComposite:ro.GridComposite,jl.NotRequired,Em.Off,KE.Only),s=this._rctx.bindTechnique(r,this._bindParameters,e);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Li.TRIANGLE_STRIP,0,Pv(this._vaoQuad,"geometry"))}drawGroup(e,i,r,s,n=Em.On){i===ro.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const o=e.baseOpacity<1?jl.Required:jl.NotRequired,a=this._getBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawImageData(e,i,r,s,n=Em.Off){if(e.texture==null)return;const o=e.baseOpacity<1?jl.Required:jl.NotRequired;e.fboTexture=i===ro.GroupBackgroundComposite||s===Ze.Normal&&o===jl.NotRequired&&n===Em.Off?null:this.switch(r).colorTexture;const a=this._getBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawRasterData(e,i,r,s,n){const o=n.sourceLayerInfo.data;if(!o.source||(n.tile.surface.layerViewByIndex(n.layerIndex,ri.MAP).ensureSymbolizerParameters(o),!o.bind(this._rctx)))return;const a=e.baseOpacity<1?jl.Required:jl.NotRequired;e.fboTexture=s===Ze.Normal&&a===jl.NotRequired?null:this.switch(r).colorTexture;const l=this._getRasterColorizerTechnique(o,i,s,a);o.opacity=e.opacity;const c=o.getUniforms();c.scale=n.scale,c.offset=n.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const u=this._rctx.bindTechnique(l,null,c);this._render(u)}_getRasterColorizerTechnique(e,i,r,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new CL,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?eC.Noop:eC.PerBand,this._rasterColorizerTechnique=this._techniques.releaseAndAcquire(N6e,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,i,r,s,n,o,a,l){const c=this._rctx,u=n.sourceLayerInfo.data,h=n.tile.surface.layerViewByIndex(n.layerIndex,ri.MAP),p=e.baseOpacity<1?jl.Required:jl.NotRequired,f=p===jl.Required||e.opacity<1||s!==Ze.Normal||i!==ro.Composite,g=f?Em.On:Em.Off,y=this._getBlendLayersTechnique(s,i,p,g);c.setPipelineState(y.getPipeline());let v=null,b=null;f?(b=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new sTe(this._rctx)),v=this._vtFBO.get(r),c.bindFramebuffer(v),this._clearCurrentFBO()):l&&c.clear(ss.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(c,n.sourceLod,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/n.scale),n.offset,a,o,h.contentZoom),u&&this._vectorTileHelper.renderContent(c,n.sourceLod,u,n.vtlNeighborInfos,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/n.scale),n.offset,a,o,h.contentZoom)}catch(w){gzt().warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return v==null||(c.bindFramebuffer(b),e.texture=v.colorTexture,e.offset=kE,e.scale=1,this.drawImageData(e,i,r,s,g),l)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,Gr.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;i.gl.copyTexImage2D(on.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),i.bindTexture(r,Gr.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clear(ss.COLOR_BUFFER_BIT|ss.DEPTH_BUFFER_BIT|ss.STENCIL_BUFFER_BIT)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let s=this._fbos.length;s<=i;s++)this._fbos.push(new sTe(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},_zt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new ci({allocator:e=>e||new vzt})}},vzt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},nTe=class{constructor(e,i){this._texture=e,this._cache=i,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,this._refCount===0)if(this._cache){const e=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(e,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}},bzt=class{constructor(e,i,r,s,n,o){this.start=e,this.end=i,this.blendMode=r,this.opacity=s,this.output=n,this.baseOpacity=o}},wzt=class{constructor(e,i,r,s){this._rctx=e,this.tileSize=i,this._techniques=r,this._cache=s,this._passParameters=new VBt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._compositor=new yzt(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._compositor=jt(this._compositor),this._backgroundTexture=yi(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateHeading(e){this._compositor?.updateHeading(e)}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,s=r.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1,c=!1;const u=r.view.state.contentPixelRatio;let h=!1;uH.clear(),WM.length=0;const p=e.layerInfo[ri.MAP];let f=0,g=null;for(;f<p.length;f++){const b=r.layerViewByIndex(f,ri.MAP),w=b.layer.opacity,x=b.fullOpacity;if(c=c||sV(b.layer),ZF(b)){let C=b.layer.blendMode!=="normal";if(vO(b.layer.parent)){const R=yne(b.layer.parent);R!=null&&R!==""&&(C=D6e(b.layer.parent)||C)}C&&(h=C,l=!1)}if(w===0&&!h){p[f].pendingUpdates&=~(Mt.TEXTURE_NOFADING&Mt.TEXTURE_FADING);continue}++o;const S=hI(b),E=BZ(e,f,S);if(E){if(p[f].pendingUpdates&=~(Mt.TEXTURE_NOFADING&Mt.TEXTURE_FADING),vO(b.layer.parent)){const C=yne(b.layer.parent);C!=null&&C!==""&&F6e(b.layer.parent,f)}S?a=Math.max(a,this.tileSize*u):s===1&&x===1&&(b.isOpaque||this._dataToTexture(E)&&E.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,g===null&&(g=f)}}const y=a/this.tileSize,v=this._ensureBackgroundTexture(this.tileSize);n!==0&&g!==null?n===1&&!h&&this._useLayerTexture(e,g)||this._composeLayers(e,i,f-1,c,a,y,!l||h,uH,h):Szt(e,o,v,i!==qn.FADING)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._compositor.bind(e),this._passParameters.offset=kE,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,this.backgroundColor!=null),this._compositor.copyFBOToTexture(this._backgroundTexture),this._compositor.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useLayerTexture(e,i){const r=e.surface.layerViewByIndex(i,ri.MAP),s=sV(r.layer),n=s?e.surface.baseOpacity:1,o=s?1:e.surface.baseOpacity,a=r.fullOpacity,l=BZ(e,i,!1);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new dne(l.sourceLayerInfo.data,qn.FADING,l,n,o,a)),!0)}_composeLayers(e,i,r,s,n,o,a,l,c){this._compositor.ensureBuffer(n);const u=e.surface.baseOpacity;let h=!1,p=_i.LINEAR_MIPMAP_LINEAR,f=!1,g=0;for(let w=r;w>=0;w--){const x=e.surface.layerViewByIndex(w,ri.MAP),S=hI(x),E=BZ(e,w,S),C=x.layer.opacity;if(!E||C===0&&!c)continue;const R=!sV(x.layer)&&!h;R&&(h=!0);let I=!1;l.forEach(B=>{B.start===w&&(B.output=s?ro.Composite:a&&R?this.backgroundIsGrid?ro.GridComposite:ro.ColorComposite:ro.Composite,B.baseOpacity=R?u:1,WM.push(B),this._compositor.openGroup(n),I=!0)});const F=g===0,D=I?ro.GroupBackgroundComposite:a&&F?this.backgroundIsGrid?ro.GridComposite:ro.ColorComposite:ro.Composite,z=hne[ZF(x)?x.layer.blendMode:"normal"];for(this._passParameters.baseOpacity=R&&!I&&u<1?u:1,this._passParameters.opacity=C,c5t(E)?f=this._compositor.drawVectorData(this._passParameters,D,n,z,E,o,this.tileSize,f):l5t(E)?(this._compositor.drawRasterData(this._passParameters,D,n,z,E),xzt(E)&&(p=_i.NEAREST)):this._dataToTexture(E)&&(this._passParameters.texture=E.sourceLayerInfo.data.texture,this._passParameters.offset=E.offset,this._passParameters.scale=E.scale,this._compositor.drawImageData(this._passParameters,D,n,z));WM.length>0&&WM[WM.length-1].end===w;){const B=WM.pop();this._passParameters.baseOpacity=B.baseOpacity,this._passParameters.opacity=B.opacity,this._passParameters.offset=kE,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,B.output,n,hne[B.blendMode])}g++}const y=e.renderData,v=c||h&&u<1,b=y.ensureTexture(n,v,()=>this._buildTexture(n,v,p));this._compositor.copyFBOToTexture(b),this._compositor.unbind(),y.setTextureReference(new dne(b,i,k6e,h?1:u,0,1))}_dataToTexture(e){if(h5t(e)){const i=e.sourceLayerInfo;i.data=this._buildTexture(i.data,!0),e.tile.setMemoryDirty()}return u5t(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,i,r=_i.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const s=new fs;s.wrapMode=Di.CLAMP_TO_EDGE,s.samplingMode=r,s.maxAnisotropy=this._maxAnisotropy,s.preMultiplyAlpha=!0,s.flipped=!0,s.hasMipmap=!0,i||(s.pixelFormat=Xt.RGB);const n=this._rctx;let o;if(typeof e=="number")s.width=s.height=e,o=this._buildTileTexture(s,e);else if(M7(e))s.isOpaque=e.isOpaque,s.isOpaque&&(s.pixelFormat=Xt.RGB),o=this._buildTileTexture(s,e.element.width,e.element);else try{s.width=e.width,s.height=e.height,o=this._buildTileTexture(s,e.width,e)}catch{o=new nTe(tFe(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=n.bindTexture(o.texture,Gr.TEXTURE_UNIT_FOR_UPDATES);return o.generateMipmap(),n.bindTexture(a,Gr.TEXTURE_UNIT_FOR_UPDATES),o}_buildTileTexture(e,i,r){const s=`${i} ${e.pixelFormat}`,n=this._cache.pop(s);return n?(n.retain(),n.texture.setData(r),n):new nTe(new Gr(this._rctx,e,r),this._cache)}get test(){}};function BZ(t,e,i){Nl.layerIndex=e,Nl.vtlNeighborInfos.clear();const r=t.layerInfo[ri.MAP][e];if(Gi(Nl.offset,0,0),Nl.tile=t,Nl.scale=1,Nl.sourceLod=t.lij,Nl.sourceLayerInfo=r,Nl.isVTLBackground=i,r.data)return i&&t.forEachLoadedNeighbor((n,o)=>{if(n.level!==t.level)return;const a=n.layerInfo[ri.MAP][e];if(!KGe(a)||r.data===a.data)return;const l=Nl.vtlNeighborInfos.pushNew();l.offset=k_[o],l.sourceLod=n.lij,l.sourceLayerInfo=a}),Nl;const s=r.upsampleInfo;if(s){const n=s.tile.layerInfo[ri.MAP][e];return Nl.tile=s.tile,Cl(Nl.offset,s.offset),Nl.scale=s.scale,Nl.sourceLod=s.tile.lij,Nl.sourceLayerInfo=n,Nl}return i?Nl:null}function yne(t){return t.uid}function xzt(t){const e=t.sourceLayerInfo.data;return!!e.source&&e.interpolation==="nearest"}function D6e(t){let e=t.blendMode!=="normal";return vO(t.parent)&&(e=D6e(t.parent)||e),e}function F6e(t,e){vO(t.parent)&&F6e(t.parent,e);const i=yne(t);if(i!=null&&i!==""){const r=uH.get(i);r?r.start=e:uH.set(i,new bzt(e,e,t.blendMode,t.opacity,ro.Composite,1))}}function Szt(t,e,i,r){const s=t.renderData,n=!r&&s.textureReference!=null&&(t.surface.view.layerViewManager.updating||e>0)?Gw.Delayed:Gw.Immediate;s.setTextureReference(new dne(i,qn.FADING,k6e,t.surface.baseOpacity,0,1),n)}const uH=new Map,WM=new Array,Nl=new _zt,k6e={offset:[0,0],scale:1},k_=new Array;k_[It.NORTH]=[0,-1],k_[It.NORTH_EAST]=[-1,-1],k_[It.EAST]=[-1,0],k_[It.SOUTH_EAST]=[-1,1],k_[It.SOUTH]=[0,1],k_[It.SOUTH_WEST]=[1,1],k_[It.WEST]=[1,0],k_[It.NORTH_WEST]=[1,-1];const Tzt=200,zZ=40,Ezt=.8,Czt=10,ML=1e-6;function Mzt(t,e,i){const r=e,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(r[a]<l){if(s[a]<=ML)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-ML){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(r[a]>l){if(s[a]>=-ML)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=ML){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let oTe=class{constructor(e,i,r,s,n){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}},U6e=class _ne{constructor(e,i,r,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positions=s,this._rayDirection=M(),this._callback=lTe,this._intersectionOptions=aTe,this.bspNodeTree=new Array;const n=r-i,o=new(n<Izt?Uint8Array:n<$zt?Uint16Array:Uint32Array)(n);this.triangleIndexMap=o;for(let a=0;a<n;++a)o[a]=a;{const a=Ozt(e,i,r,s.data,s.stride),l=$e(Math.log2(n/zZ),2,Czt),c=(u,h,p)=>{const f=Rzt(o,a,u,h),g=h-u;if(g<=zZ){const S=new oTe(f,void 0,0,u,h);return this.bspNodeTree.push(S),S}const{axis:y,midValue:v}=Pzt(f),b=Azt(o,a,u,h,y,v),w=(S,E)=>{if(p>l)return;const C=E-S;return C<zZ||C>=Ezt*g?void 0:c(S,E,p+1)},x=new oTe(f,y,v,b.next,b.mid);return this.bspNodeTree.push(x),x.leftNode=w(u,b.next),x.rightNode=w(b.mid,h),x};c(0,n,0)}}intersectRayTriangleRange(e,i){if(e>=i)return;const r=this.positions;OUe(this._rayFrom,this._rayDirection,e,i,this.globalTriangleVertexIndices,r.data,r.stride,this._intersectionOptions.normalRequired,this._callback,this.triangleIndexMap,this.firstTriangleIndex),_ne.numFacesTested+=i-e}intersectRay(e,i,r,s){_ne.numFacesTested=0;const n=e,o=i,a=o[0]-n[0],l=o[1]-n[1],c=o[2]-n[2];if(a*a+l*l+c*c<ML)return;this._rayFrom=n;const u=this._rayDirection;u[0]=a,u[1]=l,u[2]=c;const h=this.triangleIndexMap.length;this._callback=s,this._intersectionOptions=r,this.intersectRayBSP(this.bspNodeTree[0],0,h),this._callback=lTe,this._intersectionOptions=aTe}intersectRayBSP(e,i,r){const s=this._rayFrom,n=this._rayDirection;if(!Mzt(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=i,c=e.midStartIndex;if(l<c){const u=e.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=r;if(l<c){const u=e.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}};U6e.numFacesTested=0;const YM=[1/0,1/0,1/0],XM=[-1/0,-1/0,-1/0];function Azt(t,e,i,r,s,n){let o=i,a=r;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=r;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function Rzt(t,e,i,r){if(r<=i)return GE(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[i];for(let n=0;n<3;++n)YM[n]=e[s+0+n],XM[n]=e[s+3+n]}for(let s=i+1;s<r;++s){const n=6*t[s];for(let o=0;o<3;++o)YM[o]=Math.min(YM[o],e[n+0+o]),XM[o]=Math.max(XM[o],e[n+3+o])}return GE(YM[0],YM[1],YM[2],XM[0],XM[1],XM[2])}function Pzt(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],s=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function Ozt(t,e,i,r,s){const n=i-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l]*s,u=t[l+1]*s,h=t[l+2]*s;for(let p=0;p<3;++p){const f=r[c+p],g=r[u+p],y=r[h+p];o[6*a+p]=Math.min(f,g,y),o[6*a+3+p]=Math.max(f,g,y)}}return o}const Izt=255,$zt=65535,aTe=new h4,lTe=()=>{};let mn=class extends $u{constructor(){super(...arguments),this.output=G.Color,this.overlayMode=Jy.Disabled,this.tileBlendInput=t0.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.opaque=!0,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=Ot.Simplified}};d([V({count:G.COUNT})],mn.prototype,"output",void 0),d([V({count:Jy.COUNT})],mn.prototype,"overlayMode",void 0),d([V({count:t0.COUNT})],mn.prototype,"tileBlendInput",void 0),d([V()],mn.prototype,"spherical",void 0),d([V()],mn.prototype,"doublePrecisionRequiresObfuscation",void 0),d([V()],mn.prototype,"receiveShadows",void 0),d([V()],mn.prototype,"hasSlicePlane",void 0),d([V()],mn.prototype,"backfaceCullingEnabled",void 0),d([V()],mn.prototype,"textureFadingEnabled",void 0),d([V()],mn.prototype,"renderOccluded",void 0),d([V()],mn.prototype,"hasScreenSpaceReflections",void 0),d([V()],mn.prototype,"hasCloudsReflections",void 0),d([V()],mn.prototype,"invisible",void 0),d([V()],mn.prototype,"opaque",void 0),d([V()],mn.prototype,"tileBorders",void 0),d([V()],mn.prototype,"visualizeNormals",void 0),d([V()],mn.prototype,"screenSizePerspective",void 0),d([V()],mn.prototype,"receiveAmbientOcclusion",void 0),d([V({count:Ot.COUNT})],mn.prototype,"pbrMode",void 0),d([V({constValue:yr.Compressed})],mn.prototype,"normalType",void 0),d([V({constValue:ks.Compressed})],mn.prototype,"textureCoordinateType",void 0),d([V({constValue:!1})],mn.prototype,"highStepCount",void 0),d([V({constValue:!1})],mn.prototype,"useCustomDTRExponentForWater",void 0),d([V({constValue:!1})],mn.prototype,"useFillLights",void 0),d([V({constValue:!0})],mn.prototype,"hasColorTexture",void 0);const VZ=7,Nzt=10,GZ=Oo();var Yl;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(Yl||(Yl={}));let Cp=class extends vke{get _isGlobal(){return this._stage.viewingMode===Xe.Global}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(t,e,i,r,s){super({}),this._overlayRenderer=t,this._stage=e,this._allTiles=i,this._ellipsoidRadius=r,this.type=bs.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new mn,this._passParameters=new o6e,this._drawParameters=new bse,this._renderDataPool=new Tl(iBt),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new s6e,this._transparencyState=Yl.Opaque,this._castShadows=!1,this._inViewshed=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=pr.Occlude,this.produces=new Map([[Ce.OPAQUE_TERRAIN,()=>this._produces()],[Ce.TRANSPARENT_TERRAIN,()=>this._produces()],[Ce.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileTextureCache=new x4((n,o)=>s.newCache(n,o),"TileTexture"),this.tileGeometryCache=new DBt(s)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(_e(()=>this._overlayRenderer.rendersOccludedDraped,t=>{this.renderOccludedFlags=t?V8:pr.Occlude,this.setNeedsRender()},Mr))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?ohe:k9}set renderingDisabled(t){this._set("renderingDisabled",!!t),this.setDirty()}set visible(t){this._set("visible",!!t),this.setDirty()}updateHeading(t){this._tileRenderer?.updateHeading(t)}set transparency(t){this._transparencyState!==t&&(this._techniqueConfiguration.invisible=t===Yl.TransparentWithDraped||t===Yl.Empty,this._techniqueConfiguration.opaque=t===Yl.Opaque,this._transparencyState=t,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(t){this._techniqueConfiguration.tileBorders!==t&&(this._techniqueConfiguration.tileBorders=t,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(t){this._techniqueConfiguration.visualizeNormals!==t&&(this._techniqueConfiguration.visualizeNormals=t,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(t){this._techniqueConfiguration.backfaceCullingEnabled!==t&&(this._techniqueConfiguration.backfaceCullingEnabled=t,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(t){this._set("renderOrder",t),this._setSortingDirty()}get layerUid(){return cx}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(t){this._techniqueConfiguration.hasSlicePlane!==t&&(this._techniqueConfiguration.hasSlicePlane=t,this.setNeedsRender())}set textureFadingEnabled(t){this._techniqueConfiguration.textureFadingEnabled!==t&&(this._techniqueConfiguration.textureFadingEnabled=t,this.setNeedsRender())}set pbrMode(t){this._techniqueConfiguration.pbrMode!==t&&(this._techniqueConfiguration.pbrMode=t,this.setNeedsRender())}setDebugScreenSizePerspective(t){this._techniqueConfiguration.screenSizePerspective!==t&&(this._techniqueConfiguration.screenSizePerspective=t,this.setNeedsRender())}setRootTiles(t){this._rootTiles=t,this.setDirty()}setStencilEnabledLayerExtents(t){this._stencilEnabledLayerExtents=t,this._setSortingDirty()}setTileSize(t){this._tileSize=t,this._tileRenderer!=null&&(this._tileRenderer.tileSize=t),this.setDirty()}_prepareTileForLoading(t){t.renderData||(t.renderData=this._renderDataPool.acquire(),t.renderData.init(t,this._getLocalOriginOfTile(t)))}loadTile(t){this._prepareTileForLoading(t),this.updateTileGeometryState(t),this.updateTileTexture(t,Mt.TEXTURE_FADING)}updateTileTexture(t,e){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(t,e===Mt.TEXTURE_FADING?qn.FADING:qn.UNFADED),this.setNeedsRender(),t.resetPendingUpdate(e))}updateTileGeometryState(t){for(const i of t.layerInfo[ri.ELEVATION])i.pendingUpdates&=~Mt.GEOMETRY;t.resetPendingUpdate(Mt.GEOMETRY);const e=t.renderData.updateGeometryState();return e&&this.setDirty(),e}updateGeometryIfNeeded(t){t.isLoaded&&t.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(t){const e=t.renderData;e&&(e.releaseGeometry(),this._renderDataPool.release(e),e.clear(),t.renderData=null,t.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(t){const e=Nzt-VZ,i=Math.max(0,Math.floor((t.level-e)/VZ)*VZ);if(this._isGlobal&&i===0)return co;for(;t.parent&&t.level>i;)t=t.parent;return t.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(t){this._get("wireframe")!==t&&(this._set("wireframe",t),this.setNeedsRender())}setDirty(t=vr.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(t)}_setSortingDirty(t=vr.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(t)}setNeedsRender(t=vr.UPDATE){this._context.requestRender(t)}initializeRenderContext(t){this._context=t,this._tileRenderer=new wzt(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=tFe(this._rctx)}uninitializeRenderContext(){this._emptyTex=jt(this._emptyTex),this._tileRenderer=jt(this._tileRenderer)}intersect(t,e,i,r){if(!this._rootTiles||t.options.selectOpaqueTerrainOnly&&t.options.selectionMode&&this.transparency!==Yl.Opaque)return;const s=Lzt,n=Dzt;Me(s,r,i),ue(n,1/s[0],1/s[1],1/s[2]);const o=t.results.min,a=t.results.max,l=t.results.ground,c=t.options.store===Ya.MIN,u=!!t.results.ground.target,h=Bht(t.verticalOffset),p=t.tolerance;let f,g=c&&o.dist!=null?o.dist:1/0;const y=t.options,v=y.normalRequired||!y.backfacesTerrain,b=new h4(!1,v),w=S=>{const E=S.renderData;if(!E?.vao)return;const C=E.geometry;v9(GZ,C.boundingBox);const R=E.localOrigin;h!=null&&(h.localOrigin=R,h.applyToAabb(GZ));const I=GZ;if(ZM[0]=i[0]-R[0],ZM[1]=i[1]-R[1],ZM[2]=i[2]-R[2],!Zhe(I,ZM,n,p,g))return;const F=(k,H,q)=>{k.set(this.type,S,H,q,us),g=c&&o.dist!=null?o.dist:1/0},D=(k,H,q)=>{if((!v||q!=null)&&k>=0&&(y.backfacesTerrain||xe(q,s)<0)&&(y.invisibleTerrain||!y.selectionMode||e==null||e(i,r,k))){if((l.dist==null||k<l.dist)&&F(l,k,q),y.isFiltered)return;y.store===Ya.ALL&&(f==null?(f=eue(t.ray),F(f,k,q),t.results.all.push(f)):k<f.dist&&F(f,k,q)),(o.dist==null||k<o.dist)&&F(o,k,q),y.store!==Ya.MIN&&(a.dist==null||k>a.dist)&&F(a,k,q)}},z=Fzt;Me(z,r,R);const{indices:B,indexCount:Y}=C,W=C.vertexAttributes,J=W.getField(O.POSITION,Zo),me=new Hk(J.typedBuffer,3,W.stride/4),L=Y/3;if(!h&&L>Tzt){const k=S.renderData;k.intersectionData==null&&(k.intersectionData=new U6e(B,0,L,me)),k.intersectionData.intersectRay(ZM,z,b,D)}else PUe(ZM,z,0,L,B,me,h,b,D)},x=this._rootTiles;x!=null&&(()=>{const S=this._tileIterator;S.reset(x);const E=t.options.invisibleTerrain;for(let C=S.next();C;C=S.next())!(C.visible||E&&C.intersectsClippingArea)||h==null&&!C.intersectsRay(i,s,p,g)||u&&this._useStencilForTile(C)?S.skipSubtree():w(C)})()}processScaleRangeQueries(t,e){if(!e.done)for(this._updatePatchGroups();t.updating&&!e.done;){t.prepare();for(const i of this._visiblePatchesByOrigin.values())for(const r of i)r.renderData?.textureReference!=null&&t.queriesForTile(r);t.process(),e.madeProgress()}}prepareTechnique(t){const e=ae("enable-feature:terrain-shadows")&&t.bindParameters.shadowMap.enabled;e!==this._castShadows&&(this._castShadows=e,this._patchesByOriginDirty=!0);const i=t.bindParameters.viewshedEnabled;if(this._inViewshed!==i&&(this._inViewshed=i,this._patchesByOriginDirty=!0),t.bindParameters.slot===Ce.OCCLUDED_TERRAIN){if(!(t.renderOccludedMask&V8))return null}else{const r=this.transparency===Yl.Opaque?Ce.OPAQUE_TERRAIN:Ce.TRANSPARENT_TERRAIN;if(t.bindParameters.slot!==r)return null}if(this.transparency===Yl.Empty)return null;switch(t.output){case G.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=t.bindParameters.ssr.lastFrameColor!=null,this._techniqueConfiguration.hasCloudsReflections=t.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=t.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=t.bindParameters.ssao!=null,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(G.Color,t.bindParameters.slot===Ce.OCCLUDED_TERRAIN);case G.Shadow:case G.ShadowExcludeHighlight:return this._castShadows?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.Shadow,!1)):null;case G.ViewshedShadow:return this._inViewshed?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.ViewshedShadow,!1)):null;case G.Depth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.Depth,!1);case G.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.Normal,!1);case G.ObjectAndLayerIdColor:return this._updateTechnique(G.ObjectAndLayerIdColor,!1);case G.Highlight:return this._overlayRenderer.hasHighlights?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.Highlight,!1)):null}return null}renderNode(t,e){switch(this._updatePatchGroups(),e.useStencil=!1,t.output){case G.Color:{const i=t.bindParameters.slot===Ce.OCCLUDED_TERRAIN?vs.Occluded:vs.Color;this._renderMaterialPass(t,e,i);break}case G.Depth:case G.Normal:this._renderAuxiliaryPass(t,e,vs.Color,this._visiblePatchesByOrigin);break;case G.Highlight:this._renderAuxiliaryPass(t,e,vs.Highlight,this._visiblePatchesByOrigin);break;case G.Shadow:case G.ShadowExcludeHighlight:case G.ViewshedShadow:this._renderAuxiliaryPass(t,e,null,this._allPatchesByOrigin);break;case G.ObjectAndLayerIdColor:this._renderAuxiliaryPass(t,e,vs.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(t){if(this._tileRenderer==null)return;const e=this._tileRenderer;let i;if(t!=null){const r=Ke.toUnitRGBA(t);i=Be(r[0]||0,r[1]||0,r[2]||0)}e.setBackground(i),this._allTiles.forAll(r=>e.updateTileTexture(r,qn.FADING)),this._techniqueConfiguration.tileBlendInput=e.backgroundIsGrid?t0.GridComposite:e.backgroundColor!=null?t0.ColorComposite:t0.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==dI.NONE){const t=Array.from(this._visiblePatchesByOrigin.values()),e=this._stencilEnabledLayerExtents;for(const i of t)R5t(this.renderOrder,i,e);t.sort((i,r)=>n6e(i[0],r[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(t.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){const t=this._rootTiles;if(t!=null){t[0]?.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const e of t)this._rebuildPatchGroupsForRootTile(e)}}_rebuildPatchGroupsForRootTile(t){const e=this._tileIterator;for(e.resetOne(t);!e.done;){const i=e.next(),r=i.renderData;if(!r){this._numTilesCulled++;continue}const s=r.localOrigin;if(this._castShadows||this._inViewshed){let o=this._allPatchesByOrigin.get(s);o||(o=[],this._allPatchesByOrigin.set(s,o)),o.push(i)}if(!i.visible){this._numTilesCulled++,e.skipSubtree();continue}let n=this._visiblePatchesByOrigin.get(s);n||(n=[],this._visiblePatchesByOrigin.set(s,n)),n.push(i),e.skipSubtree()}}_useStencilForTile(t){for(const e of this._stencilEnabledLayerExtents)if(t.intersectsExtent(e))return!0;return!1}_renderAuxiliaryPass(t,e,i,r){const s=t.rctx;this._passParameters.overlayContent=i,s.bindTechnique(e,t.bindParameters,this._passParameters);const n=this._stencilEnabledLayerExtents.length>0;r.forEach(o=>{this._drawParameters.origin=o[0].renderData.localOrigin,e.program.bindDraw(this._drawParameters,t.bindParameters,this._passParameters);for(let a=0;a<o.length;a++)this._renderPatch(t,e,o[a],Li.TRIANGLES,n,i)}),t.rctx.bindVAO(null)}_renderMaterialPass(t,e,i){const{rctx:r}=t;this._passParameters.overlayContent=i,r.bindTechnique(e,t.bindParameters,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const s=t.bindParameters.camera,n=e.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const h=v4e(this._stage.viewingMode,this._ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;h.update({distance:p,fovY:s.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=i===vs.Occluded;a&&(n.bindTexture("tex",this._emptyTex),n.setUniform3fv("textureOpacities",co),n.setUniform4fv("texOffsetAndScale",Ud));const l=this._tileRenderer?.backgroundColor!=null?this._tileRenderer.backgroundColor:co;this._techniqueConfiguration.tileBlendInput===t0.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?Li.LINES:Li.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this._emptyTex);const u=this._visiblePatchesByOrigin;for(const h of u.values()){const p=h[0].renderData.localOrigin;e.program.bindDraw(new bse(p),t.bindParameters,this._passParameters),this._numOriginsRendered++;for(const f of h){const g=f.renderData,y=g.textureReference;if(y!=null){if(!a){n.setUniform4fv("texOffsetAndScale",y.offsetAndScale),n.bindTexture("tex",y.texture.texture);const v=g.textureFadeFactor,b=v<1?g.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&b!=null&&v<1?(n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",b.offsetAndScale),n.setUniform3fv("nextTexOpacities",b.opacities),n.bindTexture("texNext",b.texture.texture)):n.setUniform1f("fadeFactor",1),g.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",y.opacities)}this._renderPatch(t,e,f,c,o,i),f.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}t.rctx.bindVAO(null)}_renderPatch(t,e,i,r,s,n){const o=i.renderData,a=o.vao,l=a?.indexBuffer;if(!a||l==null)return void(Go&&console.error("Rendered tile with no indices: ",i.lij," : ",o));const c=e.program;n==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(c,o.overlay),s&&(e.useStencil=this._useStencilForTile(i),t.rctx.setPipelineState(e.getPipeline()));const u=o.geometry.indexCount;t.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),t.rctx.drawElements(r,u,l.indexType,0)}_bindOverlayPatchData(t,e){t.setUniform4fv("overlayTexOffset",e.offsets),t.setUniform4fv("overlayTexScale",e.scales)}_updateTechnique(t,e){return this._techniqueConfiguration.output=t,this._techniqueConfiguration.renderOccluded=e,this._shaderTechnique=this._techniques.releaseAndAcquire(a6e,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){}};d([m({readOnly:!0})],Cp.prototype,"_isGlobal",null),d([m()],Cp.prototype,"renderOccludedFlags",void 0),d([m({value:!1})],Cp.prototype,"renderingDisabled",null),d([m({value:!0})],Cp.prototype,"visible",null),d([m()],Cp.prototype,"renderPatchBorders",null),d([m()],Cp.prototype,"visualizeNormals",null),d([m()],Cp.prototype,"cullBackFaces",null),d([m({value:dI.FRONT_TO_BACK})],Cp.prototype,"renderOrder",null),d([m()],Cp.prototype,"wireframe",null),Cp=d([N("esri.views.3d.terrain.TerrainRenderer")],Cp);const Lzt=M(),Dzt=M(),ZM=M(),Fzt=M();let kzt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},yy=class extends Fe{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),_e(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!KL(i)||i.isRejected())&&!(i.isFulfilled()&&!Uzt(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!(i?.type==="vector-tile"||nH(i)))),e)if(e.isResolved()){const i=R7(e,this.viewSpatialReference,this.viewingMode);if(i!=null){const r=new ph(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===Xe.Global){const i=e.levels.length-1,r=e.spatialReference;r.isWebMercator?e=ph.makeWebMercatorAuxiliarySphere(i):rpe(r)&&(e=ph.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(_e(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Xe.Global){const e=this.extentHelper.viewSpatialReference;e.isWebMercator?this.tilingScheme=ph.WebMercatorAuxiliarySphere:ZGe(e)&&(this.tilingScheme=ph.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||X2(e,this.extent)||(this.tilingScheme=ph.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){}};function Uzt(t,e,i){return R7(t,e,i)!=null}d([m()],yy.prototype,"tilingScheme",void 0),d([m({readOnly:!0})],yy.prototype,"extent",void 0),d([m({value:!1})],yy.prototype,"tilingSchemeLocked",void 0),d([m({constructOnly:!0})],yy.prototype,"viewSpatialReference",void 0),d([m({constructOnly:!0})],yy.prototype,"layers",void 0),d([m({constructOnly:!0})],yy.prototype,"extentHelper",void 0),d([m({constructOnly:!0})],yy.prototype,"viewingMode",void 0),yy=d([N("esri.views.3d.terrain.TilingSchemeLogic")],yy);let Bzt=class{constructor(){this.offset=vt(),this.scale=0,this.tile=null}init(e,i,r,s){this.tile=e,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}};var zG;let ai=zG=class extends un.EventedMixin(Fe){constructor(t){super(t),this._scaleRangeQueries=new BG,this._iteratorPool=new Tl(s6e,e=>e.remove=()=>this._iteratorPool.release(e)),this._postorderIterator=new A5t,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new kzt,this._viewChanged=!1,this.heading=0,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=M(),this._eyePosSurfaceSR=M(),this._splitLimits=new hm,this._frustum=RF(),this._viewProjectionMatrix=Ne(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new Mv,this._frameTask=LO,this._allTiles=new ci,this._upsampleInfoPool=new Tl(Bzt),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=li(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Je.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new cP(1/0,-1/0),this.rootTileElevationBounds=new cP(1/0,-1/0),this._sebProjectorMap=new Map,this._sebProjectorCache=_ce(),this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new mu({...t,surface:this}),this._isGlobal=!t.view?.state?.isLocal,this._isGeographic=this._spatialReference?.isGeographic??!1,this._tileConstructor=this._isGlobal?$Bt:PBt}initialize(){const t=this.view,e=t.resourceController,i=e.memoryController;this._tileCache=new x4((l,c)=>i.newCache(l,c),"terrain-tile"),this._upsampleMapCache=i.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new wUt(i.newCache("elevation-query"));const r=this.overlayManager;this._renderer=new Cp(r.renderer,t._stage,this._allTiles,$r(t.spatialReference).radius,i),this.addHandles([_e(()=>r.renderer.isEmpty,()=>this._evaluateTransparency()),_e(()=>this.renderer.visible,l=>this.suspended=!l),_e(()=>this.heading,l=>{this._renderer.updateHeading(l),this._updateTileTextures(qn.FADING)}),_e(()=>({heading:t.camera?.heading,state:t.state?.mode}),({heading:l,state:c})=>{if(l==null)return;if(this.isGlobal&&this.isGeographic||this.isWebMercatorOnPlateCarree)return void(this.heading=90*Math.round(l/90)%360);const u=Math.round(l)%360,h=Math.abs(u-this.heading);(c===zi.IDLE||Math.min(h,360-h)>=30)&&(this.heading=u)})],"overlayManager"),this.addHandles([_e(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?qn.UNFADED:qn.IMMEDIATE)},Sr),_e(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?qn.UNFADED:qn.IMMEDIATE),Sr),_e(()=>this.backgroundColor,(l,c)=>{l?.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},Mr),_e(()=>this.snapLevel,()=>this._viewChanged=!0,Mr),_e(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),_e(()=>ts.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?ye(()=>import("./TerrainTileTree3DDebugger-7336e107.js"),["./TerrainTileTree3DDebugger-7336e107.js","./TileTreeDebugger-aacc6bf8.js"],import.meta.url).then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&ts.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:t}))}):l||(this._treeDebugger=Ge(this._treeDebugger))},Ir)]);const{spatialReference:s}=t;this._extentHelper=_5t(this.viewingMode,{layers:t.map.allLayers,layerViews:t.allLayerViews,viewSpatialReference:s});const n=new dF({getCollections:()=>t.defaultsFromMap?.mapCollections?.map(({layers:l})=>l),getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new yy({layers:n,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:s});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(Hy.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(Hy.BASEMAP);const a=e.scheduler;this._frameTask=a.registerTask(Ut.TERRAIN_SURFACE,this),this.addHandles([_e(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),Ir),_e(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Mr),_e(()=>this.extent,()=>this._updateRootTiles(),Ir),t.on("resize",()=>this._viewChangeUpdate()),_e(()=>{const l=t.state;return[this._lodBias,this.lodSnapping,t.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),Sr),_e(()=>t.qualitySettings?.fadeDuration,l=>this._renderer.textureFadingEnabled=l>0,Ir),_e(()=>t.qualitySettings?.physicallyBasedRenderingEnabled,l=>this._renderer.pbrMode=l?Ot.Simplified:Ot.Disabled,Ir),_e(()=>t.qualitySettings?.tiledSurface.elevationLevelDelta,()=>this._updateAllTileGeometries()),_e(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Mr)]),this.addHandles(t.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._removeAllTiles(),this._set("tilingSchemeLogic",Ge(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((t,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Ge(this.overlayManager)),this._tileCache=Ge(this._tileCache),lpe.prune(),this._treeDebugger=Ge(this._treeDebugger),this._renderer=Ge(this._renderer),this._iteratorPool=Ge(this._iteratorPool),this._upsampleMapCache=Ge(this._upsampleMapCache),this._elevationQueryCache=Ge(this._elevationQueryCache),this._set("view",null),this._extentHelper=Ge(this._extentHelper),this._upsampleInfoPool=Ge(this._upsampleInfoPool),GUt(),V5t()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===MD.ON){const t=this.view,e=this.tilingScheme,i=t.terrainScale;if(e&&i){const r=e.levelAtScale(i)+t.qualitySettings.tiledSurface.lodBias,s=e.getMaxLod();return Math.min(r,s||1/0)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?MD.ON:MD.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get _userClippingExtent(){const{spatialReference:t}=this,{clippingArea:e}=this.view;if(e==null||t==null)return null;const i=li(),r=_Ge(e,i,t)?i:null,s=this._get("extent");return X2(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const t=BK(this.groundExtent,this._userClippingExtent,li()),e=this._get("extent");return X2(t,e)?e:t}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(t){this.view.map.ground.opacity=t}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(t){this._renderer.renderOrder=t,this._set("renderOrder",t)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(t){this.view.map.ground.surfaceColor=t}set slicePlaneEnabled(t){this._renderer.slicePlaneEnabled=t,this._set("slicePlaneEnabled",t),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(t){t!==this._renderer.wireframe&&(this._renderer.wireframe=t,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===Yl.Opaque}set suspended(t){this._set("suspended",t),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(t,e,i,r){this._renderer.intersect(t,e,i,r)}getElevationLevelDelta(t){return t<4?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}getElevation(t,e,i,r){const s=this._rootTiles;if(!s?.length||s[0].layerInfo[ri.ELEVATION].length===0)return null;let n=this._elevationProjectorCache.get(r);if(n===void 0&&(n=rx(r,this._spatialReference)??null,this._elevationProjectorCache.set(r,n)),n==null)return oe.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const o=ue(C3,t,e,i);return n(o,0,o,0),cTe(s,o[0],o[1])}getElevations(t,e,i){const r=this._rootTiles,s=r?r[0].layerInfo[ri.ELEVATION].length:0;if(r?.length&&s!==0)for(let n=0;n<e;++n){const o=3*n;i(n,cTe(r,t[o],t[o+1]))}else for(let n=0;n<e;++n)i(n,null)}getScale(t){if(!this.tilingScheme)return null;if(!lc(t,C3,this.spatialReference))return oe.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const i of e)if(i?.containsPoint(C3)){let r=i;for(;r.children[0]&&!r.rendered;){const s=r.children[0].extent;let n=0;C3[0]>s[2]&&(n+=1),C3[1]<s[1]&&(n+=2),r=r.children[n]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}_ensureSEBProject(t){const e=this._sebProjectorMap.get(t);if(e)return e;const i=rx(t,this._tilingSchemeSpatialReference,this._sebProjectorCache)??null;return this._sebProjectorMap.set(t,i),i}getSphereElevationBounds(t,e){const i=this._ensureSEBProject(e);if(i==null)return oe.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;zE(t,JM);const r=JM;i(r,0,r,0);const s=new rH,n=this._rootTiles;if(n!=null){const o=[];for(const l of n)o.push(l);let a=0;for(;a<o.length;){const l=o[a];if(++a,!vge(l.extent,JM))continue;const c=l.children;if(c[0]==null||l.rendered)s.expandElevationRangeValues(l.elevationBoundsMin,l.elevationBoundsMax);else for(const u of c)o.push(u)}}return s}getRootElevationBounds(){return new rH(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getSphereScale(t,e){if(!this.tilingScheme)return null;if(!lc(t,JM,this.spatialReference))return oe.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;JM[3]=e;let i=null;const r=n=>{if(n&&vge(n.extent,JM)){const o=n.children;if(o[0]&&!n.rendered)for(const a of o)r(a);else{const a=this._getLodBiasCorrectedScale(n.level);i=i==null?a:Math.min(i,a)}}},s=this._rootTiles;if(s!=null)for(const n of s)r(n);return i}queryVisibleScaleRange(t,e,i,r){const s=e?this.tilingScheme.levelAtScale(e):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(t,s+o,n+o,r)}_evaluateTransparency(){const t=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?e?Yl.Empty:Yl.TransparentWithDraped:t>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?Yl.Opaque:Yl.Semitransparent,s=i!==r;return s&&(this._renderer.transparency=r,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){const t=this.tilingSchemeLogic.tilingScheme;if(t===this.tilingScheme)return;go(!!t,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();const e=t?.spatialReference??Je.WebMercator;this._spatialReference=e,this._isWebMercator=!!e?.isWebMercator,this._isWebMercatorOnPlateCarree=this._isWebMercator&&CE(this.view?.renderSpatialReference),this._isGeographic=e?.isGeographic??!1,this._set("tilingScheme",t),this._tilingSchemeSpatialReference=this.tilingScheme?.spatialReference,this._sebProjectorMap.clear(),this._updateClippingExtent(),t&&(this._updateTiledLayers(),this._renderer.setTileSize(t.pixelSize),this.overlayManager.setSpatialReference(t.spatialReference),this._updateRootTiles())}_acquireTile(t,e,i,r){const s=this._tileCache.pop(zG._tileMemcacheKey);return s?(s.init(t,e,i,r,this),s):new this._tileConstructor(t,e,i,r,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:t,tilingScheme:e}=this;if(!e)return;const i=Vzt;let r=e.rootTilesInExtent(t,i,5*VR);if(this._rootTiles!=null){if(r.length>VR)return void oe.getLogger(this).warn(Ndt);const s=this._rootTiles.map(o=>o.lij),n=HQ(s,r,kG);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this._rootTiles.filter(a=>!(n.removed.findIndex(l=>kG(l,a.lij))>-1)||(this._purgeTile(a),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>VR&&(oe.getLogger(this).warn(Ldt),r=e.rootTilesInExtent(t,i,VR)),this._setRootTiles(r.map(s=>this._newRootTile(s)));X2(i,this._rootTilesExtent)||(this._rootTilesExtent=li(i)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const t=this._allTiles.filter(e=>e.isLoaded&&e.intersectsClippingArea);t.sort(e0),t.forEach(e=>this._renderer.updateTileGeometryState(e)),t.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(t),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(t){if(t.length===0)return;t.sort(e0);const e=this.renderer;t.forEach(i=>e.updateGeometryIfNeeded(i)),t.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(t){return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===Mt.SPLIT}_newRootTile(t){const e=this._acquireTile(0,t[1],t[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(Mt.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(t){if(this._rootTiles=t,this._allTiles.clear(),t!=null){const e=this._iteratorPool.acquire();for(e.reset(t);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(t)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(t){t.updateClippingStatus(this.extent)&&t.resetPendingUpdate(Mt.GEOMETRY)&&this._updateTileGeometryState(t)}_updateTilesVisibility(t){if(t==null)return;const e=D5t(t),i=this.visibleElevationBounds;let r=e?i.min:1/0,s=e?i.max:-1/0;const n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(t);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(Mt.GEOMETRY)&&this._updateTileGeometryState(l),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(r=Math.min(l.elevationBoundsMin,r),s=Math.max(l.elevationBoundsMax,s))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(r)&&isFinite(s)&&(i.min!==r||i.max!==s)&&(this.visibleElevationBounds=new cP(r,s))}_updateRootTileElevationBounds(){let t=1/0,e=-1/0;const i=this._rootTiles;i?.forEach(({elevationBoundsMin:s,elevationBoundsMax:n})=>{t=Math.min(t,s),e=Math.max(e,n)});const r=this.rootTileElevationBounds;r.min===t&&r.max===e||(this.rootTileElevationBounds=new cP(t,e))}_updateViewDependentParameters(){const{camera:t,contentCamera:e}=this.view.state,i=Math.tan(.5*e.fovX),r=Math.tan(.5*e.fovY),s=this.tilingScheme.pixelSize,n=2**-this._lodBias*t.pixelRatio;this._splitLimits.aboveGround=t.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/t.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/t.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=e8(this._splitLimits.frustum??RF(),e.frustum):this._splitLimits.frustum=null,e8(this._frustum,t.frustum),Or(this._viewProjectionMatrix,e.projectionMatrix,e.viewMatrix),ge(this._eyePosRenderSR,e.eye),wa(t.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(t){t.updateVisibility(),this._renderer.updateTileGeometryState(t)&&this._markTileToUpdate(t),this._usedMemory=null}_markAllTileNeighborsForUpdate(t){t.forEachLoadedNeighbor(e=>{this._layerViews[ri.MAP].some(hI)&&e.setPendingUpdate(Mt.TEXTURE_FADING),this._pendingTilesToUpdate.add(e)})}_updateTileTexture(t,e){const i=t.resetPendingUpdate(Mt.TEXTURE_FADING)?Mt.TEXTURE_FADING:!!t.resetPendingUpdate(Mt.TEXTURE_NOFADING)&&Mt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(t,i),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const t=jZ.extent;Hd(t),this._pendingTilesForElevationUpdateEvent.forEach(e=>Iw(t,e.extent,t)),this._pendingTilesForElevationUpdateEvent.clear(),jZ.spatialReference=this.spatialReference,this.emit("elevation-change",jZ),this._shouldEmitChangeEvent=!1}runTask(t){this._handleLayerViewChanges(t),this._frameTask.processQueue(t),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,t),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(t),this._sortTiles(t);const e=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(t,e),this._updateElevation(t),this._updateTextures(t),e||this._mergeAndSplit(t,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),t.done&&t.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),Go&&this._checkTileInvariant(),!t.hasProgressed)return Wa}_checkTileInvariant(){const t=new Map;this._allTiles.forAll(e=>t.set(e,new Set)),this._allTiles.forAll(e=>{if(go(e.rendered===e.isLeaf,` rendered ${e.rendered} != ${e.isLeaf} leaf`),!e.isLeaf){const i=s=>s.unmergableChildCount===0&&s.maxLevelDeltaNeighborCount===0,r=e.children.reduce((s,n)=>s+(i(n)?0:1),0);if(go(e.unmergableChildCount===r,` Tile[${e.lij.toString()}] unmergeable child count mismatch: actual ${e.unmergableChildCount} vs ${r}`),e.hasPendingUpdate(Mt.MERGE)){go(!e.hasPendingUpdate(Mt.SPLIT),"Tile can be both split and merge at the same time");for(const s of e.children)go(s.isLeaf||s.hasPendingUpdate(Mt.MERGE),"Child of tile to merge must also merge")}}for(let i=0;i<4;++i){if(e.rendered){const o=e.renderData?.geometryState.edgePeerNeighbors[i];if(o!=null){{const a=e.level-o.level<=vo;a||(console.log(`tile level delta [${e.lij.toString()}] vs [${o.lij.toString()}] > ${vo}  (edge[${i}])`),go(a,`tile level delta [${e.level}] vs [${o.level}] > ${vo}`))}go(e.level-o.level<=vo,`Max tile lod delta exceeded: [${e.lij.toString()}] vs [${o.lij.toString()}]`)}}const r=e.level-vo,s=o=>o.isLeaf||o.level===e.level,n=e.findNeighborTile(Xm[i],s);if(n!=null){if(e.isLeaf&&e.level>=vo){let o=n;for(;e.level-o.level<vo;)o=o.parent;const a=[r,e.lij[1]>>vo,e.lij[2]>>vo];if(!kG(a,o.lij)){const l=t.get(o);go(!l.has(e),"Cannot already have neighbor"),l.add(e)}}go(n.rendered||n.level===e.level,"Non-same-level-neighbor of rendered must be rendered"),go(e.level-n.level<=vo,`Tile level delta [${e.level}] vs [${n.level}] > ${vo}`)}}}),this._allTiles.forAll(e=>{const i=e.maxLevelDeltaNeighborCount,r=t.get(e);go(i===r.size,`Tile[${e.lij.toString()}] merge-blocker mismatch: actual ${i} vs ${r.size}`)})}_updateAllTilesStatus(t){if(!this._viewChanged||!this._rootTiles||t.done)return;this._viewChanged=!1;const e=new Gzt(this._allTiles.length);e.pushAll(this._rootTiles);const i=this.snapLevel,r=this._splitLimits,s=this._eyePosRenderSR;this._allTiles.forAll(o=>{o.maxLevelDeltaNeighborCount=0,o.unmergableChildCount=0});const n=this._viewProjectionMatrix;for(;!e.empty;){const o=e.pop(),a=o.parent,l=a!=null&&a.hasPendingUpdate(Mt.MERGE),c=l?Mt.MERGE:o.shouldSplit(r,s,i),u=c===Mt.SPLIT;o.isLeaf?HZ(o,u):e.pushAll(o.children),l?(o.resetPendingUpdate(Mt.SPLIT),o.isLeaf||o.setPendingUpdate(Mt.MERGE),this._updateClippingStatus(o),o.updateVisibility(),o.updateScreenDepth(n)):u?(o.resetPendingUpdate(Mt.MERGE),o.isLeaf&&o.setPendingUpdate(Mt.SPLIT)):(o.resetPendingUpdate(Mt.SPLIT)&&o.updateAgentSuspension(),c===Mt.ELEVATION&&o.updateAgents(ri.ELEVATION),o.isLeaf||(o.setPendingUpdate(Mt.MERGE),o.resetPendingUpdate(Mt.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),t.madeProgress()}_sortTiles(t){t.done||this._allTilesSorted||(N5t(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),t.madeProgress())}_markTileToUpdate(t){qe(t.isLoaded),t.intersectsClippingArea&&(this._pendingTilesToUpdate.add(t),this._markAllTileNeighborsForUpdate(t))}_updatePendingTileGeometries(){const t=this._pendingTilesToUpdate,e=Array.from(t.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea);if(e.length===0)return void t.clear();const i=(s,n)=>{!n?.isLoaded||!n.intersectsClippingArea||n.level<s.level||t.has(n)||(t.add(n),e.push(n),n.renderData.updateNeighborData())};e.sort(e0);const r=e.length;for(let s=0;s<r;++s){const n=e[s];qe(n.isLoaded),qe(n.intersectsClippingArea);const o=n.renderData;o.updateNeighborData();const a=o.dirtyEdgeResolutions,l=o.geometryState,c=u=>{const h=aH[u];i(n,l.cornerPeerNeighbors[u]?.findCorner(oH(h),p=>p.isLoaded))};for(let u=0;u<4;++u)if(a&1<<u){const h=o.geometryState.edgePeerNeighbors[u];h&&h?.level>=n.level&&h.forAllSubtreeOnSide(ope(Xm[u]),p=>!(!p.isLoaded||!p.intersectsClippingArea)&&(qe(t.has(p)||e0(n,p)<0),i(n,p),!0)),c((u+1)%4),c(u)}}t.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,Go&&sH&&this.checkAllTilesWaterproofness()}_mergeAndSplit(t,e){if(this.suspended||t.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const r=this.view.state.fixedContentCamera;let s=!1;for(;!t.done;){s=!0;let n=!1;const o=!this._allTiles.some(a=>{if(!i&&!r&&!a.visible)return t.done;let l=a;if(a.hasPendingUpdate(Mt.MERGE)){if(!e||a.unmergableChildCount>0)return t.done;for(a.resetPendingUpdate(Mt.MERGE);l.parent!=null&&l.parent.unmergableChildCount===0&&l.parent.resetPendingUpdate(Mt.MERGE);)l=l.parent;this._mergeTile(l),n=!0,t.madeProgress()}else if(a.resetPendingUpdate(Mt.SPLIT)){let c=!0;const u=a.level;if(u>=vo){const h=p=>p.isLeaf||u-p.level<vo;for(let p=0;p<4;++p){const f=a.findNeighborTile(Xm[p],h);f!=null&&u-f.level===vo&&(c=!1,Go&&(qe(f.isLeaf),qe(f.hasPendingUpdate(Mt.SPLIT))))}}c?(this._splitTile(a),t.madeProgress(),n=!0):a.setPendingUpdate(Mt.SPLIT)}return t.done});if(n&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!i){i=!0;continue}if(!n)break}else this._allTilesDirty=!0}s?t.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(t)}_updateElevation(t){t.done||(this._allTiles.some(e=>(e.resetPendingUpdate(Mt.GEOMETRY)&&(this._updateTileGeometryState(e),this._shortBatches&&this._updatePendingTileGeometries(),t.madeProgress()),t.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(t){t.done||this._allTiles.some(e=>(this._updateTileTexture(e,t),t.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(vr.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const t=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-t)*Idt}_getLodBiasCorrectedScale(t){const e=this.tilingScheme.levels,i=$e(t-this._lodBias,0,e.length-1),r=i-Math.floor(i);return e[Math.floor(i)].scale*(1-r)+e[Math.ceil(i)].scale*r}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(t=>this._purgeTile(t)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeDescendantTiles(t){if(!t.children[0])return;const e=t.children.slice();t.unsetChildren();for(let i=0;i<4;++i)this._purgeTile(e[i])}_purgeTile(t){t.isLeaf?uTe(t):this._purgeDescendantTiles(t),this._allTiles.removeUnordered(t),this._unloadTile(t),this._tileCache.put(zG._tileMemcacheKey,t)}_unloadTile(t){this._pendingTilesToUpdate.delete(t),this._pendingTilesForElevationUpdateEvent.delete(t),t.unload(this._renderer)}_splitTile(t){go(t.isLeaf,"Tile that is already split should not be split again!"),go(t.rendered,"Tile marked to split is not rendered"),uTe(t);const e=t.level+1,i=2*t.lij[1],r=2*t.lij[2],s=t.setChildren(this._createTile(e,i,r,t),this._createTile(e,i,r+1,t),this._createTile(e,i+1,r,t),this._createTile(e,i+1,r+1,t));this._allTiles.pushArray(s),t.updateAgentSuspension(),go(t.rendered,"parent should be rendered"),this._unloadTile(t),s.forEach(n=>this._loadTile(n)),s.forEach(n=>this._pendingTilesToUpdate.add(n)),this._markAllTileNeighborsForUpdate(t),this._emitTileScaleChange(t,t.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),s.forEach(n=>HZ(n,n.hasPendingUpdate(Mt.SPLIT))),++this._performanceInfo.numSplit}_emitTileScaleChange(t,e=t.level){DB.spatialReference=this.spatialReference,DB.extent=t.extent,DB.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",DB)}_createTile(t,e,i,r){go(!!r,"_createTile sanity check");const s=this._acquireTile(t,e,i,r);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(Mt.SPLIT),s}get _shortBatches(){return this.view.state.mode!==zi.IDLE}_mergeTile(t){go(!t.hasPendingUpdate(Mt.SPLIT),"_mergeTile sanity check"),go(!t.isLeaf,"Cannot merge a leaf"),t.isLeaf||(this._purgeDescendantTiles(t),go(!t.renderData,"_mergeTile sanity check"),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t),this._shortBatches&&this._updatePendingTileGeometries(),HZ(t,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(t){t.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(t)}_handleLayerViewChanges(t=_h){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const i=new Set;let r=-1;for(let s=this.view.allLayerViews.length-1;s>=0;s--){const n=this.view.allLayerViews.items[s];if(i.add(n.uid),ane(n)||T3(n))if(this._basemapLayerViewHandles.has(n.uid)&&!T3(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);a!=null&&((a<r||r==null)&&(e=!0),r=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(e=!0)}this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),t.madeProgress()}_allSurfaceLayersTransparent(){let t=this.view.map?.ground?.opacity===0;for(const e of this.view.allLayerViews.items)if(one(e)&&!sV(e.layer)&&e.fullOpacity!==0)return t=!1,t;return t}_hasCompositeBlendMode(){for(const t of this.view.allLayerViews.items)if((ZF(t)||T3(t))&&kBt(hne[t.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(t){return nne(t)?ri.ELEVATION:ri.MAP}_registerTiledLayerView(t){const e=[];if((ZF(t)||T3(t))&&e.push(_e(()=>t.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(qn.UNFADED)})),!T3(t)){const i=this._layerClassFromLayerView(t);e.push(_e(()=>t.suspended,()=>this._updateTiledLayers())),e.push(_e(()=>t.fullOpacity,()=>this._updateTileTextures(qn.UNFADED))),e.push(_e(()=>"effectiveScaleRange"in t.layer?t.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.push(t.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,t.uid);r!=null&&this._invalidateLayerData(r,i)}))}this._unregisterTiledLayerView(t.uid),this._basemapLayerViewHandles.set(t.uid,e)}_unregisterTiledLayerView(t){const e=this._basemapLayerViewHandles.get(t);if(e){for(const i of e)i.remove();this._basemapLayerViewHandles.delete(t)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const t=this.view.allLayerViews,e=[[],[]];let i=null;t.forEach(r=>{if(!r.layer||r.suspended||!ane(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===ri.MAP){const n=r.displayLevelRange.maxLevel;n!==1/0&&(i===null||n>i)&&(i=n)}e[s].push(r)});for(const r of HT){const s=this._layerViews[r],n=e[r];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let u=0;u<o;u++){const h=n[u].uid;this._layerIndexByUid[r].set(h,u);const p=s.indexOf(n[u]);l[u]=p,u!==p&&(a=!0),p>-1&&(c[p]=u)}if(a){const u=this._postorderIterator;for(u.reset(this._rootTiles);!u.done;)u.next().modifyLayers(c,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}_restartAllAgents(t){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const i=e.next();i.restartAgents(t),t===ri.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(t,e){return this._layerViews[e][t]}numLayers(t){return this._layerViews[t].length}_updateTileTextures(t){this._allTiles.forAll(e=>{e.updateAgents(ri.MAP),t===qn.IMMEDIATE?this.renderer.updateTileTexture(e,Mt.TEXTURE_NOFADING):e.updateRenderData(ri.MAP,t)}),this._evaluateTransparency()}_invalidateLayerData(t,e){this._allTiles.forAll(i=>i.removeLayerAgent(t,e)),this._allTiles.forAll(i=>i.invalidateLayerData(t,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(t=vr.UPDATE){this.renderer.setNeedsRender(t)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(t,e,i,r){const s=this.layerViewByIndex(e,i),n=s.layer;return!n.tilemapCache||hI(s)?this._requestTileData(t,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(t.lij[0],t.lij[1],t.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,zt(r),En(o)||this._dataMissing(t,i,s),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(t,i,s,r),r.signal)))}_requestTileData(t,e,i,r){const s=e===ri.ELEVATION;return r.requester??=s?this._elevationDataRequester:this._mapDataRequester,s?nne(i)?this._requestElevationTileData(t,i,r):Promise.reject():one(i)?this._requestMapTileData(t,i,r):Promise.reject()}_requestElevationTileData(t,e,i){++this._asyncWorkItems;const r=n=>{!va(i)&&n&&(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(t,e,n))},s=n=>{En(n)||(oe.getLogger(this).error(`Tile ${t.lij.toString()} layer ${ri.ELEVATION}/${e.uid} error ${n}`),this._dataMissing(t,ri.ELEVATION,e),this.requestUpdate())};return e.fetchTile(t.lij,i).then(n=>this._frameTask.schedule(()=>r(n)),s).finally(()=>--this._asyncWorkItems)}_elevationDataArrived(t,e,i){const r=this._layerIndexByUid[ri.ELEVATION].get(e.uid);if(r==null)return void oe.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",ri.ELEVATION,t.lij.toString());const s=new WUt(t.lij,t.extent,i);t.dataArrived(r,ri.ELEVATION,s);const n=[t],o=t.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_requestMapTileData(t,e,i){++this._asyncWorkItems;const r=(a,l)=>{XP(l),va(i)||(console.error(`Tile ${t.lij.toString()} layer ${ri.MAP}/${e.uid} error ${a}`),this._dataMissing(t,ri.MAP,e),this.requestUpdate())},s=a=>l=>r(l,a),n=a=>this._frameTask.schedule(()=>{this.requestUpdate(),va(i)?XP(a):this._mapTileDataArrived(t,e,a)},i.signal,s(a)).catch(s(a)),o=(a,l=null)=>this._frameTask.schedule(()=>r(a,l));return e.fetchTile(t.lij,i).then(n,o).finally(()=>--this._asyncWorkItems)}_mapTileDataArrived(t,e,i){const r=this._getLayerIdxByUID(ri.MAP,e.uid);if(r==null)return XP(i),void oe.getLogger(this).warn("TerrainSurface: received data from unknown layer");t.dataArrived(r,ri.MAP,i)}_getLayerIdxByUID(t,e){return this._layerIndexByUid[t].get(e)}_dataMissing(t,e,i){const r=this._getLayerIdxByUID(e,i.uid);r!=null?t.dataMissing(r,e):oe.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(t){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(t))}get performanceInfo(){const t=this._performanceInfo;return t.numNodes=this._allTiles.length,t.numLeaves=t.numVisible=t.numRendered=t.numLoadedPerLevel.length=t.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.isLeaf&&t.numLeaves++;const i=e.level;e.renderData&&(t.numLoadedPerLevel[i]=(t.numLoadedPerLevel[i]||0)+1),e.visible&&(t.numVisible++,e.rendered&&(t.numRenderedPerLevel[i]=(t.numRenderedPerLevel[i]||0)+1,t.numRendered++))}),t}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((t,e)=>t+e.usedMemory,0)):null}getUsedMemoryForLayerView(t){let e=0;const i=this._layerClassFromLayerView(t),r=this._getLayerIdxByUID(i,t.uid);return r!=null&&this._allTiles.forAll(s=>e+=s.getUsedMemoryForLayer(i,r)),e}getTile(t){if(t==null||this._rootTiles==null)return null;const e=t.split("/").map(o=>+o);if(e[0]===0)return this._rootTiles.find(o=>o.lij[1]===e[1]&&o.lij[2]===e[2]);const i=e[0],r=e[1]>>i,s=e[2]>>i;let n;if(this._rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<e[0]-1;for(;n.lij[0]<e[0];){let a=e[1]&o?2:0;if((e[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return go(n.lij[0]===e[0]&&n.lij[1]===e[1]&&n.lij[2]===e[2],"not the right tile?"),n}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(t){this._renderer.renderPatchBorders=t}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(t){this._renderer.visualizeNormals=t}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(t){this._renderer.renderingDisabled=t}get test(){}checkAllTilesWaterproofness(){if(!sH)return;const t=this._rootTiles;if(t==null)return;const e=n=>n?.renderData?.geometry?.indices?.length>0,i=(n,o)=>{e(n)&&console.error("Tile[",n.lij,"] has geometry although parent[",o.lij,"] has geom")},r=n=>{if(n.intersectsClippingArea)if(n.renderData&&!n.renderData.geometryState&&console.error("Tile[",n.lij,"] has renderData but not geometryState"),n.renderData&&!n.renderData.geometry&&console.error("Tile[",n.lij,"] has renderData but not geometryInfo"),!n.renderData?.geometry||(n.renderData.geometry.indices?.length??0)>0||console.error("Tile[",n.lij,"] has renderData but no indices - geometryInfo: ",n.renderData.geometry),e(n)){n.checkGeometryWaterproofness();for(const o of n.children)i(o,n)}else if(n.isLeaf)console.error("Tile[",n.lij,"] has no geometry and no children, from root to leaf");else for(const o of n.children)r(o)},s=n=>{const o=n.parent?.visible??!0,a=n.visible;n.computeVisibility();const l=n.visible;if(a!==l&&o&&console.error(" Tile[",n.lij,"] has out of date visibility: ",a," instead of ",l),!n.isLeaf)for(const c of n.children)s(c)};for(const n of t)r(n),s(n)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(t){return this._isGlobal&&t[2]===this.lijEastEnd(t[0])-1}isWestEndWrap(t){return this._isGlobal&&t[2]===0}lijEastEnd(t){return 1<<t+(this._isGeographic?1:0)}wrapEastWest(t){const e=this.lijEastEnd(t[0]),i=t[2];if(0<=i&&i<e)return t;if(!this._isGlobal)return null;const r=(i+(i<0?e:0))%e;return[t[0],t[1],r]}enableInternalChecks(t){a5t(t)}enableWaterproofnessChecks(t){o5t(t)}};ai._tileMemcacheKey="TerrainTileMemcache",d([m()],ai.prototype,"_renderer",void 0),d([m({constructOnly:!0})],ai.prototype,"_scaleRangeQueries",void 0),d([m({constructOnly:!0})],ai.prototype,"view",void 0),d([m({constructOnly:!0})],ai.prototype,"overlayManager",void 0),d([m()],ai.prototype,"_hasPendingUpdates",void 0),d([m()],ai.prototype,"_asyncWorkItems",void 0),d([m()],ai.prototype,"_allTilesDirty",void 0),d([m()],ai.prototype,"_allTilesSorted",void 0),d([m()],ai.prototype,"_viewChanged",void 0),d([m({type:Number})],ai.prototype,"heading",void 0),d([m()],ai.prototype,"_splitLimits",void 0),d([m({readOnly:!0})],ai.prototype,"_watchUpdatingTracking",void 0),d([m()],ai.prototype,"_frameTask",void 0),d([m({readOnly:!0})],ai.prototype,"snapLevel",null),d([m({readOnly:!0})],ai.prototype,"lodSnapping",null),d([m()],ai.prototype,"_userClippingExtent",null),d([m()],ai.prototype,"_rootTilesExtent",void 0),d([m({readOnly:!0})],ai.prototype,"extent",null),d([m({readOnly:!0})],ai.prototype,"groundExtent",null),d([m({readOnly:!0})],ai.prototype,"_tilingSchemeExtent",null),d([m({readOnly:!0})],ai.prototype,"updating",null),d([m({readOnly:!0})],ai.prototype,"running",null),d([m(HUt)],ai.prototype,"updatingProgress",void 0),d([m({readOnly:!0})],ai.prototype,"updatingProgressValue",null),d([m()],ai.prototype,"_maxNumUpdating",void 0),d([m()],ai.prototype,"baseOpacity",null),d([m()],ai.prototype,"hasCompositeBlendMode",void 0),d([m({readOnly:!0})],ai.prototype,"viewingMode",null),d([m()],ai.prototype,"maxTextureScale",void 0),d([m({readOnly:!0})],ai.prototype,"ready",null),d([m({value:dI.FRONT_TO_BACK})],ai.prototype,"renderOrder",null),d([m({readOnly:!0})],ai.prototype,"rootTiles",null),d([m()],ai.prototype,"_rootTiles",void 0),d([m({readOnly:!0})],ai.prototype,"spatialReference",null),d([m({type:Ke})],ai.prototype,"backgroundColor",null),d([m({value:!1})],ai.prototype,"slicePlaneEnabled",null),d([m({readOnly:!0})],ai.prototype,"tilingScheme",void 0),d([m({readOnly:!0})],ai.prototype,"tilingSchemeLocked",null),d([m({readOnly:!0})],ai.prototype,"tilingSchemeLogic",void 0),d([m()],ai.prototype,"wireframe",null),d([m({value:!1})],ai.prototype,"suspended",null),d([m()],ai.prototype,"fadeDuration",null),d([m()],ai.prototype,"visibleElevationBounds",void 0),d([m()],ai.prototype,"rootTileElevationBounds",void 0),d([m()],ai.prototype,"_layerViewsDirty",void 0),d([m()],ai.prototype,"renderPatchBorders",null),d([m()],ai.prototype,"visualizeNormals",null),d([m()],ai.prototype,"renderingDisabled",null),ai=zG=d([N("esri.views.3d.terrain.TerrainSurface")],ai);const zzt=ai,C3=M(),JM=Bn(),Vzt=li();new ci;const jZ=new jUt("ground"),DB={spatialReference:null,extent:null,scale:0};function cTe(t,e,i){for(const r of t){if(!r.containsPointXY(e,i))continue;let s=r;for(;s&&!s.renderData;){const o=(e>s.extentMidX?1:0)+(i<s.extentMidY?2:0);s=s.children[o]}const n=s?.renderData?.geometryState.samplerData??null;return js(e,i,n)}return null}class Gzt{constructor(e){this.capacity=e,this._head=0,this._tail=0,this._data=new Array(e)}push(e){const i=this._tail;if(!(i<this.capacity))throw new Error("Queue full");this._data[i]=e,this._tail=i+1}pushAll(e){const i=e.length;if(i===0)return;const r=this._tail;if(!(r+i<=this.capacity))throw new Error("Queue full");for(let s=0;s<i;++s)this._data[r+s]=e[s];this._tail=r+i}pop(){const e=this._head;if(e<this._tail){const i=this._data[e];return this._head=e+1,i}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}}function HZ(t,e){!t.isLeaf||t.level<vo||bpe(t,i=>{e&&B6e(i);const r=vne(i);if(i.maxLevelDeltaNeighborCount++,r){let s=i.parent;for(;s;){const n=vne(s);if(s.unmergableChildCount++,!n)break;s=s.parent}}})}function B6e(t){if(t.hasPendingUpdate(Mt.SPLIT))return;let e=t.parent;for(;e?.resetPendingUpdate(Mt.MERGE);)e=e.parent;t.resetPendingUpdate(Mt.MERGE),t.isLeaf&&t.setPendingUpdate(Mt.SPLIT),t.level<vo||bpe(t,i=>{B6e(i)})}function uTe(t){t.level<vo||bpe(t,e=>{if(e.maxLevelDeltaNeighborCount--,e.maxLevelDeltaNeighborCount===0&&e.unmergableChildCount===0){let i=e.parent;for(;i&&(i.unmergableChildCount--,vne(i));)i=i.parent}})}function vne(t){return t.maxLevelDeltaNeighborCount===0&&t.unmergableChildCount===0}function bpe(t,e){if(t.level<vo)return;const i=t.level-vo,r=t.lij[1]>>vo,s=t.lij[2]>>vo,n=o=>o.isLeaf||o.level===i;for(let o=0;o<4;++o){const a=t.findNeighborTile(Xm[o],n);if(!a||a.level!==i)continue;const l=a.lij;l[1]===r&&l[2]===s||e(a)}}let jzt=class{constructor(e,i,r,s){this.operation=e,this.geometry=i,this.states=r,this.sync=s}},AL=class extends Fe{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,i){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},u)=>{let h=!1;if(l===Is.UPDATE){const p=o.get(u);if(p){if(c&To.TRANSFORMATION){const f=this.model.getObject(n);this.model.updateRenderGeometryTransformation(f,a,p)&&(h=!0)}h||i.updates.push({renderGeometry:p,updateType:c})}else Tt(!1,"ModelDirtySet.commitLayer: invalid update")}if(l===Is.REMOVE||h){const p=o.get(u);p?(i.removes.push(p),o.delete(u)):l===Is.REMOVE&&Tt(!1,"ModelDirtySet.commitLayer: invalid remove")}if(l===Is.ADD||h){const p=this.model.getObject(n);if(p!=null){const f=this.model.getRenderGeometry(p,a);i.adds.push(f),o.set(u,f)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(e,i){const r=this._dirtyGeomRecords.get(e);r&&r.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c,sync:u},h)=>{let p=!1;if(l===Is.UPDATE&&u){const f=o.get(h);if(f){if(c&To.TRANSFORMATION){const g=this.model.getObject(n);this.model.updateRenderGeometryTransformation(g,a,f)&&(p=!0)}p||i.updates.push({renderGeometry:f,updateType:c})}else Tt(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,i){const r=this._residentGeomRecords.get(e);r&&r.forEach(s=>s.forEach(n=>i.push(n)))}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,null,Is.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(To.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(To.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(To.OCCLUDEE,e)}attributesChanged({object:e,geometry:i,sync:r}){this._updateOrCreateDirtyRecord(e,i,null,Is.UPDATE,To.GEOMETRY,r)}layerAdded(e){e.objects.forAll(i=>this._layerObjectAdded(e,i))}layerRemoved(e){e.objects.forAll(i=>this._layerObjectRemoved(e,i))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,i){const r=e.id;for(const s of i.geometries)this._geometryAdded(i,s,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const i of e.objects)this._layerObjectAdded(e.layer,i)}layerObjectsRemoved(e){for(const i of e.objects)this._layerObjectRemoved(e.layer,i)}_layerObjectRemoved(e,i){const r=e.id;for(const s of i.geometries)this._geometryRemoved(i,s,r)}transformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,i,Is.UPDATE,To.TRANSFORMATION)})}shaderTransformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{s.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,Is.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,Is.REMOVE)}_updateOrCreateDirtyRecord(e,i,r,s,n=To.NONE,o=!1){r=r??this._getParentLayerId(e);const a=e.id,l=i.id,c=this._ensureDirtyRecord(r,a),u=c.get(l);let h=!1;if(u){const p=u.operation;p===Is.REMOVE&&s===Is.ADD&&u.states!==To.NONE?u.operation=Is.UPDATE:p===Is.REMOVE&&s===Is.ADD||p===Is.ADD&&s===Is.REMOVE?(c.delete(l),h=!0):p!==Is.UPDATE||s!==Is.REMOVE&&s!==Is.UPDATE?(Tt((p===Is.REMOVE||p===Is.ADD)&&s===Is.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),u.states|=n):(u.operation=s,u.states|=n),u.sync=u.sync||o}else c.set(l,new jzt(s,i,n,o));this.dirty=!h||this._hasDirtyGeometryRecords}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}get _hasDirtyGeometryRecords(){for(const e of this._dirtyGeomRecords.values())for(const i of e.values())if(i.size>0)return!0;return!1}_ensureDirtyRecord(e,i){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:xZe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forEach((r,s)=>{r.forEach((n,o)=>{i.length>0&&(i+=`
`),i+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){i+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)i+=a[l][c]+", "}})}),i}get test(){}};d([m({constructOnly:!0})],AL.prototype,"model",void 0),d([m()],AL.prototype,"dirty",void 0),AL=d([N("esri.views.3d.webgl-engine.lib.ModelDirtySet")],AL);const Hzt=AL;let VG=class extends Fe{constructor(){super(...arguments),this.dirtySet=new Hzt({model:this}),this._content=new Map,this._originFactory=new CBe(null)}getObject(e){return this._content.get(e)}add(e){const i=e.id;Tt(!this._content.has(i),"Model/Stage already contains object to be added"),this._content.set(i,e),F8(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),F8(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const i of e)i&&(Tt(!this._content.has(i.id),"Model/Stage already contains object to be added"),this._content.set(i.id,i))}removeMany(e){for(const i of e)i&&(Tt(this._content.has(i.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(i.id))}has(e){return this._content.has(e.id)}forEachOfType(e,i){this._content.forEach(r=>{r.type===e&&i(r)})}getRenderGeometry(e,i){const r=new cI(i,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});r.transformation=e.getCombinedStaticTransformation(i,hTe);const{localOrigin:s}=i;return r.localOrigin=s??this._originFactory.getOrigin(r.boundingSphere),r}updateRenderGeometryTransformation(e,i,r){if(e==null)return!1;r.transformation=e.getCombinedStaticTransformation(i,hTe);const s=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==s}getStats(){const e={},i=Array.from(this._content.values());for(let r=0;r<an.COUNT;++r)e[r]=i.filter(s=>s.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){}};d([m({constructOnly:!0})],VG.prototype,"dirtySet",void 0),VG=d([N("esri.views.3d.webgl-engine.parts.Model")],VG);const hTe=Ne();let qzt=class{constructor(e){this._totalCount=e,this._componentCountCache=-1,this._indexRanges=[0,e]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return this._indexRanges.length===0}isVisible(e){if(e<0||e>=this._totalCount)return!1;if(this.allVisible())return!0;{const i=this._indexRanges;let r=0,s=i.length/2;if(e<i[2*r]||e>i[2*s]+i[2*s+1])return!1;for(;s-r>0;){const n=Math.floor(.5*(r+s)),o=i[2*n];if(e<o){if(s-r==1)return!1;s=n;continue}if(e<o+i[2*n+1])return!0;if(s-r==1)return!1;r=n+1}return!1}}get componentCount(){if(this._componentCountCache===-1){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];this._componentCountCache=i}return this._componentCountCache}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=Wzt(e),this._componentCountCache=-1}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!e(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=e[n],l=e[o];i[s]=a,i[s+1]=l-a}return i}};function Wzt(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let s=1;s<t.length;s++){const n=t[s];i+r===n?r+=1:(e.push(i),e.push(r),i=n,r=1)}return e.push(i),e.push(r),e}let Yzt=class{constructor(e,i){this.offsets=i,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const r=this.count;this.visibility=new qzt(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:i}=Xzt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=i}}};function Xzt(t,e,i){const r=[],s=[];let n=i.length,o=i.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[a])),n=a):(o!==a-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}let Zzt=class{constructor(e,i,r,s,n,o){this.transform=e,this.toMapSpace=i,this.obb=r,this.components=s,this.renderable=n,this.intersectionGeometry=o,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=Ge(this.intersectionGeometry),this.renderable=Ge(this.renderable),this.components=Ge(this.components)}};function Jzt(t,e,i,r,s,n,o){const a=n-o,l=e-t,c=new Float64Array(4*l);for(let u=0;u<l;++u){const h=3*(u+t),p=s*i[h+0],f=r[p+0],g=r[p+1],y=a/(r[p+2]-o),v=f*y,b=g*y,w=s*i[h+1],x=r[w+0],S=r[w+1],E=a/(r[w+2]-o),C=x*E,R=S*E,I=s*i[h+2],F=r[I+0],D=r[I+1],z=a/(r[I+2]-o),B=F*z,Y=D*z,W=4*u;c[W+0]=Math.min(v,C,B),c[W+1]=Math.min(b,R,Y),c[W+2]=Math.max(v,C,B),c[W+3]=Math.max(b,R,Y)}return c}function Qzt(t,e,i,r,s){const n=e-t,o=new Float64Array(4*n);for(let a=0;a<n;++a){const l=3*(a+t),c=s*i[l+0],u=r[c+0],h=r[c+1],p=s*i[l+1],f=r[p+0],g=r[p+1],y=s*i[l+2],v=r[y+0],b=r[y+1],w=4*a;o[w+0]=Math.min(u,f,v),o[w+1]=Math.min(h,g,b),o[w+2]=Math.max(u,f,v),o[w+3]=Math.max(h,g,b)}return o}function Kzt(t,e){return new(eVt(t))(e)}function eVt(t){return t<128?Uint8Array:t<32768?Uint16Array:t<1<<31?Uint32Array:Array}let z6e=class{constructor(e,i){this.elementCount=e,this.model=i,this._elementIndexMap=null,this._bspNodes=[],this._generatedBVH=!1,this.localMode=i.localMode,this.planetCenterZ=i.planetCenterZ,this.geometryMinZ=i.geometryMinZ,this.planetCenter=Be(0,0,this.planetCenterZ),this.maxBspNodeDepth=i.maxBspNodeDepth??8,this.minElementCountForBVH=i.minElementCountForBVH??15,this.minBspNodeElementCount=i.minBspNodeElementCount??5}get elementIndexMap(){return this._ensureBVH(),this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||this._bspNodes.length===0&&this._generateBsp()}intersectRay(e,i,r){this.elementCount<1||(this._skipBVH?this._intersectRayWithoutBVH(r):this._intersectRayWithBVH(e,i,r))}_intersectRayWithoutBVH(e){this._intersectRange(0,this.elementCount)}_intersectRange(e,i){this.model.intersectRange(e,i)}_intersectRayWithBVH(e,i,r){this._ensureBVH(),r?this._intersectGeometryWithBVHVerticalRay(e):this._intersectGeometryWithBVHGeneralRay(e,i)}_intersectGeometryWithBVHVerticalRay(e){let i=e[0],r=e[1];if(!this.localMode){const{geometryMinZ:o,planetCenterZ:a}=this,l=(o-a)/(e[2]-a);i=e[0]*l,r=e[1]*l}const{_bspNodes:s}=this;let n=0;for(;n>=0;){const o=s[n],{d:a,dim:l,minIndexIndex:c,minMidIndexIndex:u,maxMidIndexIndex:h,maxIndexIndex:p,aabb2D:f}=o;if(i<f[0]||i>f[2]||r<f[1]||r>f[3])break;if(l===-1||o.child0===-1&&o.child1===-1){this._intersectRange(c,p);break}{this._intersectRange(u,h);const g=(l===0?i:r)-a;if(g<0){if(o.child0===-1){this._intersectRange(c,u);break}n=o.child0}else{if(!(g>0))break;if(o.child1===-1){this._intersectRange(h,p);break}n=o.child1}}}}_intersectGeometryWithBVHGeneralRay(e,i){let r=e[0],s=e[1],n=i[0],o=i[1];const{geometryMinZ:a}=this;if(!this.localMode){let g=0,y=1;const v=Math.min(.5*this.planetCenterZ,a),b=e[2],w=i[2];if(b<v&&w<v||(b<v&&(g=(v-b)/(w-b)),w<v&&(y=(v-b)/(w-b)),g>y))return;const x=(1-g)*e[0]+g*i[0],S=(1-g)*e[1]+g*i[1],E=(1-g)*e[2]+g*i[2],C=(1-y)*e[0]+y*i[0],R=(1-y)*e[1]+y*i[1],I=(1-y)*e[2]+y*i[2],{planetCenterZ:F}=this,D=a-F,z=D/(E-F);r=x*z,s=S*z;const B=D/(I-F);n=C*B,o=R*B}const l=n-r,c=o-s,u=this._bspNodes;let h=1;{const{aabb2D:g}=u[0],y=(w,x,S,E)=>{if(Math.abs(x)<1e-5*Math.max(E-S,1))return!1;const C=x>0,R=C?E:S,I=w+h*x;return(C?I<R:I>R)&&(h=Math.max((R-w)/x,h),!0)},v=()=>y(r,l,g[0],g[2]),b=()=>y(s,c,g[1],g[3]);Math.abs(l)>=Math.abs(c)?v()||b():b()||v()}const p=[0,0,h];let f=0;for(;f<p.length;){const g=p[f];let y=p[f+1],v=p[f+2];if(f+=3,y>v)continue;const b=u[g],{minIndexIndex:w,maxIndexIndex:x}=b,{child0:S,child1:E,minMidIndexIndex:C,maxMidIndexIndex:R,aabb2D:I,d:F,dim:D}=b;{const z=r+y*l,B=r+v*l,Y=Math.min(z,B),W=Math.max(z,B),J=I[0],me=I[2];if(W<J||me<Y)continue;if(Y<J){const L=(J-r)/l;l>0?y=Math.max(y,L):v=Math.min(v,L)}if(me<W){const L=(me-r)/l;l>0?v=Math.min(v,L):y=Math.max(y,L)}}{const z=s+y*c,B=s+v*c,Y=Math.min(z,B),W=Math.max(z,B),J=I[1],me=I[3];if(W<J||me<Y)continue;if(Y<J){const L=(J-s)/c;c>0?y=Math.max(y,L):v=Math.min(v,L)}if(me<W){const L=(me-s)/c;c>0?v=Math.min(v,L):y=Math.max(y,L)}}if(S===-1&&E===-1)this._intersectRange(w,x);else{const z=D===0?r:s,B=D===0?l:c,Y=z+y*B,W=z+v*B,J=Math.min(Y,W),me=Math.max(Y,W),L=$e((F-z)/B,0,h);w<C&&J<=F&&(S!==-1?(p.push(S),p.push(B>=0?y:Math.max(y,L)),p.push(B>=0?Math.min(v,L):v)):this._intersectRange(w,C)),this._intersectRange(C,R),R<x&&F<=me&&(E!==-1?(p.push(E),p.push(B>=0?Math.max(y,L):y),p.push(B>=0?v:Math.min(v,L))):this._intersectRange(R,x))}}}_generateBsp(){const{elementCount:e}=this;if(e<1)return;const i=Kzt(e,e);this._elementIndexMap=i;for(let f=0;f<e;++f)i[f]=f;const r=this.model.getAabbs2D();let s=0;const n=this._bspNodes;n.length=0;const{localMode:o}=this;let a=!1;if(!o){const{planetCenterZ:f,geometryMinZ:g}=this;a=f>=0||g<.5*f}const l=[],c=(f,g,y,v,b)=>{l.push(f),l.push(g),l.push(y),l.push(v<0?-1:(b?0:1)+2*v)},{maxBspNodeDepth:u,minBspNodeElementCount:h}=this,p=(f,g,y,v,b)=>{const w=n.length;if(w>0&&(a||y>=u||g-f<h))return;const x=[0,0,0,0];sVt(x,f,g,i,r);const{d:S,dim:E}=o?tVt(x):iVt(x),{rangeMidStart:C,rangeMidEnd:R}=rVt(f,g,E,S,i,r),I=y===u-1,F=!I&&C>=f+h,D=!I&&g>=R+h;if(F||D||w===0){const z=new nVt(f,C,R,g,E,S,x);if(F&&c(f,C,y+1,w,!0),D&&c(R,g,y+1,w,!1),n.push(z),v!==-1){const B=n[v];b?B.child0=w:B.child1=w}}};for(c(0,e,0,-1,!1);s<l.length;){const f=l[s],g=l[s+1],y=l[s+2],v=l[s+3];s+=4;const b=v>>1;p(f,g,y,b,v-(b<<1)==0)}this._generatedBVH=!0}};function tVt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,o;return r-e>=s-i?(o=.5*(e+r),n=0):(o=.5*(i+s),n=1),{d:o,dim:n}}function iVt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,o;return r-e>=s-i?(n=0,o=.5*(e+r)):(n=1,o=.5*(i+s)),{dim:n,d:o}}function rVt(t,e,i,r,s,n){let o=t;{let u=e;for(;o<u;){const h=s[o];dTe(h,i,r,n)<0?++o:(--u,s[o]=s[u],s[u]=h)}}const a=o;let l=o,c=e;for(;l<c;){const u=s[c-1];dTe(u,i,r,n)>0?--c:(s[c-1]=s[l],s[l]=u,++l)}return{rangeMidStart:a,rangeMidEnd:c}}function dTe(t,e,i,r){const s=4*t,n=r[s+0+e];return r[s+2+e]<i?-1:n>i?1:0}function sVt(t,e,i,r,s){let n=1/0,o=1/0,a=-1/0,l=-1/0;for(let c=e;c<i;++c){const u=4*r[c];n=Math.min(n,s[u+0]),o=Math.min(o,s[u+1]),a=Math.max(a,s[u+2]),l=Math.max(l,s[u+3])}t[0]=n,t[1]=o,t[2]=a,t[3]=l}let nVt=class{constructor(e,i,r,s,n,o,a){this.minIndexIndex=e,this.minMidIndexIndex=i,this.maxMidIndexIndex=r,this.maxIndexIndex=s,this.dim=n,this.d=o,this.aabb2D=a,this.child0=-1,this.child1=-1}},oVt=class{constructor(e,i,r,s,n,o,a,l,c){this.componentIndex=e,this.vertexData=i,this.vertexStride=r,this.indexData=s,this.startTriangleNumber=n,this.endTriangleNumber=o,this.geometryMinZ=a,this.planetCenterZ=l,this.localMode=c,this.maxBspNodeDepth=8,this.minElementCountForBVH=20,this.minBspNodeElementCount=10,this.rayDirection=M(),this.ray0=M(),this.isVerticalRay=!1,this._triangleHitCallback=pTe,this.totalElevationOffset=0,this.normalRequired=!1,this._bvh=new z6e(o-n,this)}getAabbs2D(){return this.localMode?Qzt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):Jzt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(e,i,r,s,n,o){ge(this.ray0,e),Vi(this.rayDirection,i,e),this.isVerticalRay=r,this.totalElevationOffset=s,this.normalRequired=o,this._triangleHitCallback=n,this._bvh.intersectRay(e,i,r),this._triangleHitCallback=pTe}intersectRange(e,i){const r=this._bvh.elementIndexMap;V6e(this.ray0,this.rayDirection,e,i,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,r,this.startTriangleNumber)}getTriangleElevationOffset(e){return this.totalElevationOffset}};function V6e(t,e,i,r,s,n,o,a,l,c,u,h=null,p=0){a!==0?KTt(t,e,i,r,s,n,o,a,l,c,u,h,p):OUe(t,e,i,r,s,n,o,c,u,h,p)}function pTe(){}function aVt(t,e,i,r){if(i>=e)return t;t==null&&(t=lVt());const s=t.isVisibleBit;let n=t.data;const o=G6e(n),a=i/o|0,l=i-o*a,c=(e-1)/o|0,u=n,h=r===s;if(!(i<u.length*o)&&h){const p=a+1,f=Math.ceil(u.length*iq),g=c+1;let y=Math.max(p,f);y=Math.min(y,g),n=new Uint32Array(y),n.set(u)}return a<n.length&&(n[a]=uVt(n[a],l,h)),t.data=n,t}function bne(t,e){if(t==null)return!0;const{isVisibleBit:i,data:r}=t,s=G6e(r);return e<r.length*s?cVt(i,r,e,s):!t.isVisibleBit}function lVt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function cVt(t,e,i,r){const s=i/r|0,n=i-s*r;return hVt(e[s],n)===t}function G6e(t){return t.BYTES_PER_ELEMENT*8}function uVt(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function hVt(t,e){return!!(t&1<<e)}let dVt=class{constructor(e,i,r,s,n,o,a,l){this.vertexData=e,this.vertexStride=i,this.indexData=r,this._components=s,this._componentAabbs3D=n,this.geometryMinZ=o,this.planetCenterZ=a,this.localMode=l,this.maxBspNodeDepth=6,this.minElementCountForBVH=10,this.minBspNodeElementCount=3,this._ray0=gVt,this._ray1=yVt,this._invDir=M(),this._componentVerticalOffsets=null,this._verticalOffset=null,this._tolerance=0,this._intersectionOptions=_Vt,this._callback=fTe,this.rayDirectionC=M(),this._componentIndexMap=null,this._bvh=new z6e(s.count,this),this.componentIntersectionData=new Array(s.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){const{numComponents:e,planetCenterZ:i,minZGlobal:r}=this,s=new Float64Array(4*e),n=this._componentAabbs3D;for(let o=0;o<e;++o){const a=6*o,l=n[a+0],c=n[a+1],u=n[a+2],h=n[a+3],p=n[a+4],f=r/(u-i),g=r/(n[a+5]-i),y=Math.min(l*f,l*g),v=Math.min(c*f,c*g),b=Math.max(h*f,h*g),w=Math.max(p*f,p*g),x=4*o;s[x+0]=y,s[x+1]=v,s[x+2]=b,s[x+3]=w}return s}getAabbs2DLocal(){const{numComponents:e}=this,i=new Float64Array(4*e),r=this._componentAabbs3D;for(let s=0;s<e;++s){const n=6*s,o=r[n+0],a=r[n+1],l=r[n+3],c=r[n+4],u=4*s;i[u+0]=o,i[u+1]=a,i[u+2]=l,i[u+3]=c}return i}intersectRay(e,i,r,s,n,o,a){const{isVerticalRay:l}=a;this._ray0=e,this._ray1=i,this._componentVerticalOffsets=r,this._verticalOffset=s,this._tolerance=o,this._intersectionOptions=a,this._componentIndexMap=this._bvh.elementIndexMap,n2t(e,i,this._invDir),this._callback=n,this._bvh.intersectRay(e,i,l),this._callback=fTe}intersectRange(e,i){const r=this._componentIndexMap,s=this._components,n=s.pickability,o=s.visibility;for(let a=e;a<i;++a){const l=r?r[a]:a;bne(n,l)&&o.isVisible(l)&&this._intersectComponent(l)}}getComponentTriangleCount(e){const i=this._components.offsets,r=i[e]/3;return i[e+1]/3-r}getComponentAabb3D(e,i){const r=this._componentAabbs3D,s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}_intersectComponent(e){if(!bne(this._components.pickability,e))return;const i=this.getComponentAabb3D(e,pVt);let r=!1;const{localMode:s,_componentVerticalOffsets:n,_verticalOffset:o,_ray0:a,_ray1:l,_invDir:c,planetCenterZ:u,_tolerance:h,rayDirectionC:p,componentIntersectionData:f}=this,{isVerticalRay:g}=this._intersectionOptions,y=this._components.offsets,v=ge(fVt,a),b=ge(mVt,l),w=n?.[e]??0,x=w+(o?.offset??0);if(x!==0&&(s?(v[2]=a[2]-x,b[2]=l[2]-x,r=!0):o!=null&&(o.componentOffset=w)),o==null||r||x===0||o.applyToAabb(i),!Xhe(i,v,c,h))return;Vi(p,b,v);const S=y[e]/3,E=y[e+1]/3,C=E-S,R=(Y,W,J)=>{this._callback(Y,W,e,J)},{vertexData:I,vertexStride:F,indexData:D,_intersectionOptions:z}=this,{normalRequired:B}=z;if(C>vVt){let Y=f[e];Y==null&&(Y=new oVt(e,I,F,D,S,E,this.geometryMinZ,u,s),f[e]=Y),Y.intersectRay(v,b,g,r?0:x,R,B)}else V6e(v,p,S,E,D,I,F,r?0:x,u,B,R)}};const pVt=Oo(),fVt=M(),mVt=M(),gVt=M(),yVt=M(),fTe=()=>{},_Vt=new h4,vVt=40;let bVt=class{constructor(e,i,r){this.viewingMode=e,this.positionData=i,this._components=r,this.verticalOffset=null,this.componentVerticalOffsets=null,this._planetCenter=M(),this._componentBvh=null,this._aabb=[0,0,0,0,0,0],this._indices=i.indices?l0(i.indices):OC(i.positions.length/3),this._positions=i.positions}destroy(){this._positions=null,this._indices=null,this._perComponentAabbs=null,this._componentBvh=null}getComponentAabb(e,i){const r=this._ensureComponentAabbs(),s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,s,n,o,a,l){this.verticalOffset=s,this.componentVerticalOffsets=n;const{position:c}=o,u=Vi(wVt,e,c),h=Vi(xVt,i,c),p=Gk(SVt,o.rotationScale);Ga(u,u,p),Ga(h,h,p);const f=xC(EVt,p);if(this.viewingMode===Xe.Global){const y=this._planetCenter;Ha(y,c),Ga(y,y,p)}const g=(y,v,b,w)=>{l(b,y,w?Ga(TVt,w,f):null,v)};this._intersectComponents(u,h,n,s,g,r,a)}_computePerComponentAabbs(){const e=this._aabb,i=.5*(e[0]+e[3]),r=.5*(e[1]+e[4]),s=.5*(e[2]+e[5]),n=this._components.count,o=qs(6*n),a=this._indices,l=this._positions,c=this._components.offsets;let u=0,h=1/0,p=1/0,f=1/0,g=-1/0,y=-1/0,v=-1/0;for(let b=0;b<n;b++){const w=c[b],x=c[b+1];let S=1/0,E=1/0,C=1/0,R=-1/0,I=-1/0,F=-1/0;if(w<x)for(let D=w;D<x;D++){const z=3*a[D],B=l[z],Y=l[z+1],W=l[z+2];S=Math.min(S,B),E=Math.min(E,Y),C=Math.min(C,W),R=Math.max(R,B),I=Math.max(I,Y),F=Math.max(F,W)}else S=i,E=r,C=s,R=i,I=r,F=s;o[u++]=S,o[u++]=E,o[u++]=C,o[u++]=R,o[u++]=I,o[u++]=F,h=Math.min(h,S),p=Math.min(p,E),f=Math.min(f,C),g=Math.max(g,R),y=Math.max(y,I),v=Math.max(v,F)}return this._aabb[0]=h,this._aabb[1]=p,this._aabb[2]=f,this._aabb[3]=g,this._aabb[4]=y,this._aabb[5]=v,o}_intersectComponents(e,i,r,s,n,o,a){let l=this._componentBvh;l==null&&(l=new dVt(this._positions,3,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode),this._componentBvh=l),l.intersectRay(e,i,r,s,n,o,a)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===Xe.Local}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}};const wVt=M(),xVt=M(),SVt=ps(),TVt=M(),EVt=ps();let CVt=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},MVt=class{constructor(e,i,r,s){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=s}dispose(){this.vao.dispose()}},wpe=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function AVt(t,e){return{near:t,far:e}}function E4(t){return t?JF(t,1/0,-1/0):AVt(1/0,-1/0)}function JF(t,e,i){return t.near=e,t.far=i,t}function pI(t,e){e!=null&&(t.near=Math.min(t.near,e.near),t.far=Math.max(t.far,e.far))}function FB(t,e){return t.near<=e&&e<=t.far}const wne={near:0,far:0};function RVt(t,e){const i=E4(),{eye:r,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=xe(Vi(sd,a.center,r),n),c=a.projectedRadius(n);if(FB(i,l-c)&&FB(i,l+c))return;const u=NVt(a,s);if(u===-1)return;if(u===0)return p_.far=l+c,p_.near=l-c,void pI(i,p_);const h=kB.pushNew();h.near=l-c,h.far=l+c,h.mask=u,h.object=o});for(let o=0;o<kB.length;o++){const a=kB.data[o];if(FB(i,a.near)&&FB(i,a.far))continue;p_.far=a.far,p_.near=1/0,$Vt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,r,PVt,c=>{let u=OVt;for(let h=0;h<j6e&&c.length>0;h++){if(!(a.mask&1<<h))continue;IVt(s[h],c,u);const p=c;c=u,u=p}for(let h=0;h<c.length;h+=3){ue(vu,c.data[h],c.data[h+1],c.data[h+2]);const p=xe(Vi(vu,vu,r),n);p_.near=Math.min(p_.near,p)}})===0&&(p_.near=0),pI(i,p_)}return kB.length=0,i}const kB=new ci({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),p_=E4(),vu=M(),qS=M(),PVt=new ci({deallocator:null}),OVt=new ci({deallocator:null});function IVt(t,e,i){i.length=0;const r=e.length-3;qZ(vu,e,r);const s=Wr(t,vu);s<=0&&(i.push(vu[0]),i.push(vu[1]),i.push(vu[2]));let n=0,o=s;for(;n<r;n+=3){qZ(qS,e,n);const a=Wr(t,qS);o*a<0&&(Br(vu,qS,vu,a/(a-o)),bu(i,vu)),a<=0&&bu(i,qS),o=a,ge(vu,qS)}o*s<0&&(qZ(qS,e,r),Br(vu,qS,vu,s/(s-o)),bu(i,vu))}function qZ(t,e,i){return ue(t,e.data[i],e.data[i+1],e.data[i+2])}function bu(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function $Vt(t,e,i,r){Lw(gTe,t.quaternion),Vi(sd,e,t.center),oh(sd,sd,gTe);const s=t.halfSize,n=8*((sd[0]<-s[0]?-1:sd[0]>s[0]?1:0)+3*(sd[1]<-s[1]?-1:sd[1]>s[1]?1:0)+9*(sd[2]<-s[2]?-1:sd[2]>s[2]?1:0)+13),o=mTe[n];if(o===0)return o;xF(UB,t.quaternion),jk(UB,UB,t.halfSize);const a=(l,c)=>{const u=mTe[n+c+1];return ue(l,((1&u)<<1)-1,(2&u)-1,((4&u)>>1)-1),Ga(l,l,UB),Te(l,t.center,l)};return i.length=0,bu(i,a(WZ,0)),bu(i,a(yTe,1)),bu(i,a(sd,2)),bu(i,a(_Te,3)),r(i),o===1||(i.length=0,bu(i,WZ),bu(i,_Te),bu(i,a(sd,4)),bu(i,a(vTe,5)),r(i),o===2||(i.length=0,bu(i,WZ),bu(i,vTe),bu(i,a(sd,6)),bu(i,yTe),r(i))),o}const mTe=(()=>{const t=new Array(216);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),j6e=4;function NVt(t,e){let i=0;for(let r=0;r<j6e;r++){const s=t.intersectPlane(e[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const UB=ps(),gTe=Qd(),sd=M(),WZ=M(),yTe=M(),_Te=M(),vTe=M();let LVt=class{constructor(e){this._objects=e}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?RVt(e,this._objects.visibleObjects):null}};function DVt(t){const e=Xs().vec3f(O.POSITION);return t.hasNormals&&e.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===ks.Default?e.vec2f(O.UV0):t.textureCoordinates===ks.Atlas&&(e.vec2f(O.UV0),e.vec4u16(O.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(O.COLOR,{glNormalized:!0}),e}let FVt=class{constructor(){this.externalColor=pi(),this.externalColorMixMode=Eo.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}};var mh;function kVt(t,e){const i=t.vertex;switch(i.code.add(T`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case mh.None:i.code.add(T`#define vertexDiscardByOpacity(_opacity_) {}`);break;case mh.Opaque:i.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case mh.Transparent:i.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case mh.COUNT:break;default:e.vertexDiscardMode}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(mh||(mh={}));var d0;function f2i(t){return t&&pC(t)?d0.Mars:t&&fC(t)?d0.Moon:d0.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(d0||(d0={}));var Zp;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(Zp||(Zp={}));let Ai=class extends Zc{constructor(){super(...arguments),this.output=G.Color,this.textureCoordinateType=ks.None,this.componentData=u0.Uniform,this.cullFace=ns.Back,this.vertexDiscardMode=mh.None,this.doubleSidedMode=Ws.WindingOrder,this.alphaDiscardMode=Yr.Opaque,this.integratedMeshMode=Zp.None,this.transparencyPassType=mt.NONE,this.ellipsoidMode=d0.Earth,this.pbrMode=Ot.Disabled,this.normalType=yr.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.hasNormalTextureTransform=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};d([V({count:G.COUNT})],Ai.prototype,"output",void 0),d([V({count:ks.COUNT})],Ai.prototype,"textureCoordinateType",void 0),d([V({count:u0.COUNT})],Ai.prototype,"componentData",void 0),d([V({count:ns.COUNT})],Ai.prototype,"cullFace",void 0),d([V({count:mh.COUNT})],Ai.prototype,"vertexDiscardMode",void 0),d([V({count:Ws.COUNT})],Ai.prototype,"doubleSidedMode",void 0),d([V({count:Yr.COUNT})],Ai.prototype,"alphaDiscardMode",void 0),d([V({count:Zp.COUNT})],Ai.prototype,"integratedMeshMode",void 0),d([V({count:mt.COUNT})],Ai.prototype,"transparencyPassType",void 0),d([V({count:d0.COUNT})],Ai.prototype,"ellipsoidMode",void 0),d([V({count:Ot.COUNT})],Ai.prototype,"pbrMode",void 0),d([V({count:yr.COUNT})],Ai.prototype,"normalType",void 0),d([V()],Ai.prototype,"spherical",void 0),d([V()],Ai.prototype,"doublePrecisionRequiresObfuscation",void 0),d([V()],Ai.prototype,"hasVertexColors",void 0),d([V()],Ai.prototype,"hasNormals",void 0),d([V()],Ai.prototype,"hasSlicePlane",void 0),d([V()],Ai.prototype,"hasColorTexture",void 0),d([V()],Ai.prototype,"receiveAmbientOcclusion",void 0),d([V()],Ai.prototype,"receiveShadows",void 0),d([V()],Ai.prototype,"blendingEnabled",void 0),d([V()],Ai.prototype,"hasScreenSpaceReflections",void 0),d([V()],Ai.prototype,"hasPolygonOffset",void 0),d([V()],Ai.prototype,"hasMetallicRoughnessTexture",void 0),d([V()],Ai.prototype,"hasEmissionTexture",void 0),d([V()],Ai.prototype,"hasOcclusionTexture",void 0),d([V()],Ai.prototype,"hasNormalTexture",void 0),d([V()],Ai.prototype,"hasOccludees",void 0),d([V()],Ai.prototype,"multipassEnabled",void 0),d([V()],Ai.prototype,"cullAboveGround",void 0),d([V()],Ai.prototype,"hasNormalTextureTransform",void 0),d([V()],Ai.prototype,"hasCloudsReflections",void 0),d([V()],Ai.prototype,"snowCover",void 0),d([V()],Ai.prototype,"objectAndLayerIdColor",void 0),d([V({constValue:!1})],Ai.prototype,"occlusionPass",void 0),d([V({constValue:ar.Draw})],Ai.prototype,"pbrTextureBindType",void 0),d([V({constValue:!0})],Ai.prototype,"hasSliceHighlight",void 0),d([V({constValue:!1})],Ai.prototype,"hasSliceInVertexProgram",void 0),d([V({constValue:!1})],Ai.prototype,"useCustomDTRExponentForWater",void 0),d([V({constValue:!1})],Ai.prototype,"hasVertexTangents",void 0),d([V({constValue:!0})],Ai.prototype,"supportsTextureAtlas",void 0),d([V({constValue:!1})],Ai.prototype,"highStepCount",void 0),d([V({constValue:!1})],Ai.prototype,"instancedDoublePrecision",void 0),d([V({constValue:!1})],Ai.prototype,"hasModelTransformation",void 0),d([V({constValue:!0})],Ai.prototype,"useFillLights",void 0),d([V({constValue:!1})],Ai.prototype,"objectAndLayerIdColorInstanced",void 0);function UVt(t,e){t.include(LC,e),t.fragment.include(sde);const i=t.fragment;i.uniforms.add(new M8("baseColor",r=>r.baseColor)),i.uniforms.add(new VUe("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(T`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(T`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(T`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function bTe(t,e){const i=t.fragment;switch(e.doubleSidedMode){case Ws.None:i.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Ws.View:t.include(FP,e),i.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Ws.WindingOrder:i.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case Ws.COUNT:}switch(e.normalType){case yr.Attribute:case yr.Compressed:t.include(r7,e),i.code.add(T`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case yr.ScreenDerivative:t.include(FP,e),i.code.add(T`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case yr.Ground:e.spherical?(t.include(FP,e),i.code.add(T`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(T`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),i.code.add(T`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case yr.COUNT:}}function BVt(t,e){const i=t.fragment;if(e.hasColorTexture&&(e.output===G.Color||e.alphaDiscardMode!==Yr.Opaque)){t.include(Vue,e);const r=e.textureCoordinateType===ks.Atlas;i.uniforms.add(new o0("baseColorTexture",s=>s.texture)),r?(t.include(zue),i.code.add(T`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):i.code.add(T`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else i.code.add(T`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function zVt(t){const e=new tr;e.include(FP,t),e.include(r7,t),e.include(LC,t),e.include(jm,t),e.include(YI,t),e.include(VTt,t),e.include(p2t,t),e.include(Xxt,t),e.include(BVt,t),e.include(kVt,t);const{vertex:i,fragment:r}=e;t.pbrMode!==Ot.Normal&&t.pbrMode!==Ot.Schematic||(e.include(jue,t),t.hasNormalTexture&&e.include(HUe,t));const s=t.output===G.Shadow||t.output===G.ShadowHighlight||t.output===G.ShadowExcludeHighlight;s&&t.componentData===u0.Varying?i.code.add(T`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(T`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===Zp.ColorOverlay||t.integratedMeshMode===Zp.ColorOverlayWithWater,o=n&&t.output===G.Color&&t.pbrMode===Ot.WaterOnIntegratedMesh;n&&(e.include(XE,t),e.include(jCt,t),t.spherical?i.code.add(T`
      const float invEllipsoidRadius = ${T.float(1/(t.ellipsoidMode===d0.Earth?br.radius:t.ellipsoidMode===d0.Mars?Qm.radius:kv.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(T`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),i.code.add(T`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===G.ObjectAndLayerIdColor?T`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${T.float(Ba)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===G.ObjectAndLayerIdColor?T`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?T`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:T`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?T`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===G.Color&&(r.include(Lue),e.include(V0,t),e.include(UVt,t),e.include(bTe,t),e.include(XE,t),t.transparencyPassType===mt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),t.receiveShadows?(e.include(m4,t),r.code.add(T`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(T`float evaluateShadow() { return 0.0; }`),n&&r.uniforms.add(new Et("ovColorTex",(l,c)=>Z5e(l,c))),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?T`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?T`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===Ot.Normal||t.pbrMode===Ot.Schematic?(L0(r),r.code.add(T`
        ${t.pbrMode===Ot.Normal?T`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?r.code.add(T`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(T`vec3 shadingNormal = normalVertex;`),r.code.add(T`${t.spherical?T`vec3 normalGround = normalize(positionWorld());`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(T`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();
        ${t.snowCover?T`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                ssao = mix(ssao, 0.5 * ssao, snow);
                shadingNormal = mix(shadingNormal, surfaceNormal, snow);`:""}

        ${n?T` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?r.code.add(T`float shadow = evaluateShadow();`):t.spherical?(t$(r),r.code.add(T`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(T`float shadow = 0.0;`),o&&r.uniforms.add(new Et("ovNormalTex",(l,c)=>c.overlay?.getTexture(vs.WaterNormal))),t.snowCover&&r.code.add(T`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),r.code.add(T`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?T` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?T`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(T`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===mt.ColorAlpha?T`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `));const a=t.output===G.Depth;return(a||s||t.output===G.ViewshedShadow)&&(a||e.include(n7,t),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${a?"":T`outputDepth(linearDepth);`}
      }
    `)),t.output===G.Normal&&(e.include(bTe,t),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${t.normalType===yr.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===G.ObjectAndLayerIdColor&&e.fragment.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?T`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===G.Highlight&&(e.include(Wx),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?T`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}const VVt=Object.freeze(Object.defineProperty({__proto__:null,build:zVt},Symbol.toStringTag,{value:"Module"}));let H6e=class q6e extends hr{initializeConfiguration(e,i){i.spherical=e.viewingMode===Xe.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new dr(e.rctx,q6e.shader.get().build(this.configuration),W6e)}_setPipelineState(e){const i=this.configuration,r=i.integratedMeshMode!==Zp.None,s=e===mt.NONE,n=e===mt.FrontFace;return ti({blending:i.output===G.Color&&i.blendingEnabled?s?Ch:c1(e):null,culling:C9(i.cullFace),depthTest:{func:Yx(e)},depthWrite:s||n?Oh:null,drawBuffers:i.output===G.Depth?{buffers:[zo.NONE]}:u1(e),colorWrite:fi,stencilWrite:r||i.hasOccludees?x0:null,stencilTest:r?u2t(Iu.IntegratedMeshMaskExcluded):i.hasOccludees?Xx:null,polygonOffset:s||n?i.hasPolygonOffset?{factor:2,units:2}:null:Q9})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};H6e.shader=new ir(VVt,()=>ye(()=>import("./ComponentShader.glsl-54f37ae6.js"),[],import.meta.url));const W6e=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.COLOR,2],[O.UV0,3],[O.UVREGION,4],[O.COMPONENTINDEX,5]]);let GVt=class extends is{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},xpe=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function nn(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(n){const o=this[r];if(o==null)this[r]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(s){this[r]!==s&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=s,this._setDirty())}})}}function wTe(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let Y6e=class{constructor(e){this._low=M(),this._high=M(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){ge(this._low,ge(xTe,e));const i=Vi(xTe,e,this._low);ge(this._high,i)}get(e){return Te(e,this._low,this._high)}getLowScaled(e){return ce(e,this._low,1)}};const xTe=fh();let oa=class extends GVt{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=ni(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Dc(s7),this.emissiveFactor=Be(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new GG,this.componentParameters=new zD,this.textureAlphaCutoff=x8,this.alphaDiscardMode=Yr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=d0.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new Ai;const r=new Y6e(e.position),s=F$e(e.rotationScale);Gk(s,s),xC(s,s),this.transformNormalGlobalFromModel=s,this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=yi(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,i,r,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.hasNormals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasEmissionTexture=this.emissionTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.transparencyPassType=i.identifier===kc.Material&&r.transparencyPassType!=null?r.transparencyPassType:mt.NONE,n.multipassEnabled=i.identifier===kc.Material&&r.multipassEnabled,n.cullAboveGround=i.identifier===kc.Material&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Ws.View:Ws.None,n.hasColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();if(n.blendingEnabled=o===Oc.Transparent||o===Oc.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?qVt(r)?HVt(r)?Zp.ColorOverlayWithWater:Zp.ColorOverlay:Zp.NoOverlay:Zp.None,n.hasPolygonOffset=this.polygonOffsetEnabled,n.pbrMode=n.integratedMeshMode===Zp.ColorOverlayWithWater?Ot.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?s.needsNormals&&this.isIntegratedMesh?Ot.Disabled:Ot.Schematic:Ot.Normal:Ot.Disabled,n.normalType=s.needsNormals?n.hasNormals?yr.Compressed:yr.ScreenDerivative:yr.Ground,n.hasSlicePlane=r.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,i.identifier===kc.ShadowMap)n.output=G.Shadow,n.vertexDiscardMode=mh.None;else if(i.identifier===kc.ViewshedShadowMap)n.output=G.ViewshedShadow,n.vertexDiscardMode=mh.None;else if(i.identifier===kc.Highlight)n.output=G.Highlight,n.vertexDiscardMode=mh.None;else{switch(o===Oc.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?mh.Opaque:mh.Transparent:n.vertexDiscardMode=mh.None,n.output=i.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,i.output){case G.Color:n.receiveAmbientOcclusion=r.ssao!=null,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.lastFrameColor!=null,n.hasCloudsReflections=r.cloudsFade.data!=null;break;case G.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(r)}return this._technique=e.releaseAndAcquire(H6e,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,i,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,n=r.components,o=r.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Oc.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case Oc.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case Oc.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case Oc.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),jVt(i)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const u=this.componentParameters.castShadows!==Vo.None;u&&e.shadowMap.submitDraw(this,s,a,o),l!=null&&(e.highlight.submitDraw(this,s,l,o),u&&e.highlightShadowMap.submitDraw(this,s,l,o)),i.viewshedEnabled&&e.viewshedShadowMap.submitDraw(this,s,a,o),u&&c!=null&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Oc.IntegratedMesh:this.objectOpacity<1?Oc.Transparent:this.componentParameters.opaqueOverride===Vo.All?Oc.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Yr.Blend||this.alphaDiscardMode===Yr.MaskBlend?Oc.Transparent:this.componentParameters.transparent===Vo.None?Oc.Opaque:this.componentParameters.transparent===Vo.All?Oc.Transparent:Oc.OpaqueAndTransparent}};var Oc,Vo;d([nn({vectorOps:s3e})],oa.prototype,"baseColor",void 0),d([nn()],oa.prototype,"usePBR",void 0),d([nn()],oa.prototype,"hasParametersFromSource",void 0),d([nn({vectorOps:lge})],oa.prototype,"mrrFactors",void 0),d([nn({vectorOps:lge})],oa.prototype,"emissiveFactor",void 0),d([nn({dispose:!0})],oa.prototype,"baseColorTexture",void 0),d([nn({dispose:!0})],oa.prototype,"metallicRoughnessTexture",void 0),d([nn({dispose:!0})],oa.prototype,"emissionTexture",void 0),d([nn({dispose:!0})],oa.prototype,"occlusionTexture",void 0),d([nn({dispose:!0})],oa.prototype,"normalTexture",void 0),d([nn()],oa.prototype,"objectOpacity",void 0),d([wTe()],oa.prototype,"commonMaterialParameters",void 0),d([wTe()],oa.prototype,"componentParameters",void 0),d([nn()],oa.prototype,"textureAlphaCutoff",void 0),d([nn()],oa.prototype,"alphaDiscardMode",void 0),d([nn()],oa.prototype,"isIntegratedMesh",void 0),d([nn()],oa.prototype,"polygonOffsetEnabled",void 0),d([nn()],oa.prototype,"ellipsoidMode",void 0),d([nn()],oa.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(Oc||(Oc={}));let GG=class extends xpe{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=ns.Back,this.hasSlicePlane=!0}};d([nn()],GG.prototype,"doubleSided",void 0),d([nn()],GG.prototype,"cullFace",void 0),d([nn()],GG.prototype,"hasSlicePlane",void 0);let zD=class extends xpe{constructor(){super(...arguments),this.externalColor=ni(1,1,1,1),this.externalColorMixMode=Eo.Multiply,this.castShadows=Vo.All}get transparent(){return this.externalColor[3]<1?Vo.All:Vo.None}get opaqueOverride(){return this.externalColorMixMode===Eo.Replace&&this.externalColor[3]===1?Vo.All:Vo.None}get visible(){return this.externalColor[3]>0?Vo.All:Vo.None}get type(){return u0.Uniform}};d([nn({vectorOps:s3e})],zD.prototype,"externalColor",void 0),d([nn()],zD.prototype,"externalColorMixMode",void 0),d([nn()],zD.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(Vo||(Vo={}));let RL=class extends xpe{constructor(){super(...arguments),this.texture=null,this.transparent=Vo.None,this.opaqueOverride=Vo.None,this.castShadows=Vo.None}get type(){return u0.Varying}};function jVt(t){return t.overlay?.getTexture(vs.Highlight)!=null}function HVt(t){return t.overlay?.getTexture(vs.WaterNormal)!=null}function qVt(t){return t.overlay?.getTexture(vs.ColorNoRasterImage)!=null}d([nn()],RL.prototype,"texture",void 0),d([nn()],RL.prototype,"transparent",void 0),d([nn()],RL.prototype,"opaqueOverride",void 0),d([nn()],RL.prototype,"castShadows",void 0);const X6e=Xs().vec3f(O.POSITION).u16(O.COMPONENTINDEX).freeze(),WVt=Xs().vec2u8(O.SIDENESS).freeze(),S2i=Dh(WVt),xne=Xs().vec3f(O.POSITION0).vec3f(O.POSITION1).vec2i16(O.NORMALCOMPRESSED).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}).freeze(),Sne=Xs().vec3f(O.POSITION0).vec3f(O.POSITION1).vec2i16(O.NORMALCOMPRESSED).vec2i16(O.NORMAL2COMPRESSED).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}).freeze(),T2i=new Map([[O.POSITION0,0],[O.POSITION1,1],[O.COMPONENTINDEX,2],[O.VARIANTOFFSET,3],[O.VARIANTSTROKE,4],[O.VARIANTEXTENSION,5],[O.NORMALCOMPRESSED,6],[O.NORMAL2COMPRESSED,7],[O.SIDENESS,8]]);function STe(t,e,i){const r=e/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(b,w)=>{b<w?s[b+1]++:n[w+1]++};for(let b=0;b<r;b++){const w=t[3*b],x=t[3*b+1],S=t[3*b+2];o(w,x),o(x,S),o(S,w)}let a=0,l=0;for(let b=0;b<i;b++){const w=s[b+1],x=n[b+1];s[b+1]=a,n[b+1]=l,a+=w,l+=x}const c=new Uint32Array(6*r),u=s[i],h=(b,w,x)=>{if(b<w){const S=s[b+1]++;c[2*S]=w,c[2*S+1]=x}else{const S=n[w+1]++;c[2*u+2*S]=b,c[2*u+2*S+1]=x}};for(let b=0;b<r;b++){const w=t[3*b],x=t[3*b+1],S=t[3*b+2];h(w,x,b),h(x,S,b),h(S,w,b)}const p=(b,w)=>{const x=2*b,S=w-b;for(let E=1;E<S;E++){const C=c[x+2*E],R=c[x+2*E+1];let I=E-1;for(;I>=0&&c[x+2*I]>C;I--)c[x+2*I+2]=c[x+2*I],c[x+2*I+3]=c[x+2*I+1];c[x+2*I+2]=C,c[x+2*I+3]=R}};for(let b=0;b<i;b++)p(s[b],s[b+1]),p(u+n[b],u+n[b+1]);const f=new Int32Array(3*r),g=(b,w)=>b===t[3*w]?0:b===t[3*w+1]?1:b===t[3*w+2]?2:-1,y=(b,w)=>{const x=g(b,w);f[3*w+x]=-1},v=(b,w,x,S)=>{const E=g(b,w);f[3*w+E]=S;const C=g(x,S);f[3*S+C]=w};for(let b=0;b<i;b++){let w=s[b];const x=s[b+1];let S=n[b];const E=n[b+1];for(;w<x&&S<E;){const C=c[2*w],R=c[2*u+2*S];C===R?(v(b,c[2*w+1],R,c[2*u+2*S+1]),w++,S++):C<R?(y(b,c[2*w+1]),w++):(y(R,c[2*u+2*S+1]),S++)}for(;w<x;)y(b,c[2*w+1]),w++;for(;S<E;)y(c[2*u+2*S],c[2*u+2*S+1]),S++}return f}const YZ=.7;let Z6e=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?XVt:YVt}write(e,i,r){BB.seed=this._edgeHashFunction(r);const s=BB.getIntRange(0,255),n=BB.getIntRange(0,this.settings.variants-1),o=BB.getFloat(),a=255*(.5*ZVt(-(1-Math.min(o/YZ,1))+Math.max(0,o-YZ)/(1-YZ),1.2)+.5);e.position0.setVec(i,r.position0),e.position1.setVec(i,r.position1),e.componentIndex.set(i,r.componentIndex),e.variantOffset.set(i,s),e.variantStroke.set(i,n),e.variantExtension.set(i,a)}};const ew=new Float32Array(6),tw=new Uint32Array(ew.buffer),hP=new Uint32Array(1);function YVt(t){return ew[0]=t.position0[0],ew[1]=t.position0[1],ew[2]=t.position0[2],ew[3]=t.position1[0],ew[4]=t.position1[1],ew[5]=t.position1[2],hP[0]=31*(31*(31*(31*(31*(166811+tw[0])+tw[1])+tw[2])+tw[3])+tw[4])+tw[5],hP[0]}function XVt(t){const e=ew;e[0]=QM(t.position0[0]),e[1]=QM(t.position0[1]),e[2]=QM(t.position0[2]),e[3]=QM(t.position1[0]),e[4]=QM(t.position1[1]),e[5]=QM(t.position1[2]),hP[0]=5381;for(let i=0;i<tw.length;i++)hP[0]=31*hP[0]+tw[i];return hP[0]}const TTe=1e4;function QM(t){return Math.round(t*TTe)/TTe}function ZVt(t,e){return Math.abs(t)**e*Math.sign(t)}let Tne=class{constructor(){this._commonWriter=new Z6e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return xne.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),Te(KM,r.faceNormal0,r.faceNormal1),Se(KM,KM);const{typedBuffer:s,typedBufferStride:n}=e.normalCompressed;gf(s,i,KM[0],KM[1],KM[2],n)}};Tne.Layout=xne,Tne.glLayout=Dh(xne,1);let Ene=class{constructor(){this._commonWriter=new Z6e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return Sne.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r);{const{typedBuffer:s,typedBufferStride:n}=e.normalCompressed;gf(s,i,r.faceNormal0[0],r.faceNormal0[1],r.faceNormal0[2],n)}{const{typedBuffer:s,typedBufferStride:n}=e.normal2Compressed;gf(s,i,r.faceNormal1[0],r.faceNormal1[1],r.faceNormal1[2],n)}}};Ene.Layout=Sne,Ene.glLayout=Dh(Sne,1);const KM=M(),BB=new H2;let JVt=class{constructor(){this.position0=M(),this.position1=M(),this.faceNormal0=M(),this.faceNormal1=M(),this.componentIndex=0,this.cosAngle=0}};const jG=-1;function QVt(t,e,i){const r=t.vertices.position,s=t.vertices.componentIndex,n=qu.position0,o=qu.position1,a=qu.faceNormal0,l=qu.faceNormal1,{edges:c,normals:u}=iGt(t),h=c.length/4,p=e.allocate(h);let f=0;const g=h,y=i?.allocate(g);let v=0,b=0,w=0;zB.length=0;for(let I=0;I<h;++I){const F=4*I;r.getVec(c.data[F],n),r.getVec(c.data[F+1],o);const D=zB.pushNew();D.index=4*I,D.length=jr(n,o)}zB.sort((I,F)=>F.length-I.length);const x=new Array,S=new Array;zB.forAll(({length:I,index:F})=>{const D=c.data[F],z=c.data[F+1],B=c.data[F+2],Y=c.data[F+3],W=Y===jG;if(r.getVec(D,n),r.getVec(z,o),W){const J=3*B;ue(a,u.data[J],u.data[J+1],u.data[J+2]),ge(l,a),qu.componentIndex=s.get(D),qu.cosAngle=xe(a,l)}else{let J=3*B;if(ue(a,u.data[J],u.data[J+1],u.data[J+2]),J=3*Y,ue(l,u.data[J],u.data[J+1],u.data[J+2]),qu.componentIndex=s.get(D),qu.cosAngle=xe(a,l),eGt(qu,nGt))return;qu.cosAngle<-.9999&&ge(l,a)}b+=I,w++,W||KVt(qu,aGt)?(e.write(p,f++,qu),x.push(I)):tGt(qu,J6e)&&(y&&i&&i.write(y,v++,qu),S.push(I))});const E=new Float32Array(x.reverse()),C=new Float32Array(S.reverse()),R=y&&i?{instancesData:y.slice(0,v),lodInfo:{lengths:C}}:void 0;return{regular:{instancesData:p.slice(0,f),lodInfo:{lengths:E}},silhouette:R,averageEdgeLength:b/w}}function KVt(t,e){return t.cosAngle<e}function eGt(t,e){return t.cosAngle>e}function tGt(t,e){const i=Jo(t.cosAngle);return Kv(ETe,t.position1,t.position0),i*(xe(yt(sGt,t.faceNormal0,t.faceNormal1),ETe)>0?-1:1)>e}function iGt(t){const e=t.faces.length/3,i=t.faces,r=t.neighbors,s=t.vertices.position;Hu.length=XZ.length=0;for(let n=0;n<e;n++){const o=3*n,a=r[o],l=r[o+1],c=r[o+2],u=i[o],h=i[o+1],p=i[o+2];s.getVec(u,WS),s.getVec(h,VB),s.getVec(p,GB),Me(VB,VB,WS),Me(GB,GB,WS),yt(WS,VB,GB),Se(WS,WS),XZ.pushArray(WS),(a===jG||u<h)&&(Hu.push(u),Hu.push(h),Hu.push(n),Hu.push(a)),(l===jG||h<p)&&(Hu.push(h),Hu.push(p),Hu.push(n),Hu.push(l)),(c===jG||p<u)&&(Hu.push(p),Hu.push(u),Hu.push(n),Hu.push(c))}return{edges:Hu,normals:XZ}}let rGt=class{constructor(){this.index=0,this.length=0}};const zB=new ci({allocator:t=>t||new rGt,deallocator:null}),Hu=new ci({deallocator:null}),XZ=new ci({deallocator:null}),qu=new JVt,sGt=M(),ETe=M(),WS=M(),VB=M(),GB=M(),J6e=Gt(4),nGt=Math.cos(J6e),oGt=Gt(35),aGt=Math.cos(oGt);function P2i(t){const e=lGt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return CTe.updateSettings(t.writerSettings),MTe.updateSettings(t.writerSettings),QVt(e,CTe,MTe)}function lGt(t,e,i,r){if(e){const o=STe(i,r,t.count);return new cGt(i,r,o,t)}const s=gse(t.buffer,t.stride/4,{originalIndices:i,originalIndicesLength:r}),n=STe(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:X6e.createView(s.buffer)}}let cGt=class{constructor(e,i,r,s){this.faces=e,this.facesLength=i,this.neighbors=r,this.vertices=s}};const CTe=new Tne,MTe=new Ene,I2i=Xs().vec3f(O.POSITION0).vec3f(O.POSITION1),uGt=Xs().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX);let hGt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},dGt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0;const r=new fs(this.textureWidth,1);r.samplingMode=_i.NEAREST,r.wrapMode=Di.CLAMP_TO_EDGE,this._texture=new Gr(this._rctx,r),this._data=new uc(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,s,n,o){const a=e*this._fieldCount+i;this._dirty=!0,this._data.set(a,0,r),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,i,r,s){const n=e*this._fieldCount+i;this._dirty=!0,this._data.set(n,r,s)}getDataElement(e,i,r){const s=e*this._fieldCount+i;return this._dirty=!0,this._data.get(s,r)}resizeToFit(e){const i=(e+1)*this._fieldCount;if(i>this._data.count){const r=Math.ceil(i/this.textureWidth)*this.textureWidth,s=new uc(new ArrayBuffer(4*r));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const Q6e=65536;let pGt=class{constructor(e,i=1){this.textureBuffer=new dGt(e,i),this._indexManager=new hGt(Q6e)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},fGt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>Q6e)return null;const i=new pGt(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const ATe=()=>oe.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let mGt=class{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._visible=new ci,this._hidden=new ci,this._renderSubmit=new LVt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=ae("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new fGt(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){Tt(this._hidden.length===0&&this._visible.length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll(e=>e.destroy()),this._hidden.forAll(e=>e.destroy()),this._visible.clear(),this._hidden.clear()}createObject(e){const i=e.geometry,r=new Yzt(this._componentBufferManager,l0(i.componentOffsets)),s=this._createRenderable(e,r),n=new bVt(this._viewingMode,i.positionData,r),o=new Zzt(e.transform,e.toMapSpace,e.obb.clone(),r,s,n);return(o.visible?this._visible:this._hidden).push(o),o}destroyObject(e){const i=e;(i.visible?this._visible:this._hidden).removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(i?(this._hidden.removeUnordered(r),this._visible.push(r)):(this._visible.removeUnordered(r),this._hidden.push(r)),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=Xo(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.components.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.components.visibility.componentCount;return{visible:r,invisible:i.components.count-r}}setComponentData(e,i){const r=e,s=r.renderable.material,n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new FVt,c=o.textureBuffer,u=new Uint8Array(4),h=new Uint32Array(u.buffer);let p=0,f=0,g=0,y=n.verticalOffsets,v=1/0,b=-1/0,w=!1,x=!1,S=0;for(let E=0;E<n.count;E++){i(E,l),p+=+(l.externalColor[3]<1),f+=+(l.externalColorMixMode===Eo.Replace&&l.externalColor[3]===1),g+=+l.castShadows,TUe(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[E],0,u[0],u[1],u[2],u[3]),w||=E>0&&S!==h[0],S=h[0],x||=l.elevationOffset!==0,x&&y==null&&(y=new Array(E).fill(0)),y!=null&&(y[E]=l.elevationOffset),v=Math.min(v,l.elevationOffset),b=Math.max(b,l.elevationOffset),zTt(l.elevationOffset,u),c.setData(a[E],1,u[0],u[1],u[2],u[3]);const C=l.objectAndLayerIdColor;C!=null&&c.setData(a[E],2,C[0],C[1],C[2],C[3]),l.pickable!==bne(n.pickability,E)&&(n.pickability=aVt(n.pickability,n.count,E,l.pickable))}n.verticalOffsets=x?y:null,r.offsetObb=x?fNe(r.obb,v,b,this._viewingMode,r.offsetObb??r.obb.clone()):null,w||x||this._hasObjectAndLayerId?(s.componentParameters=new RL,s.componentParameters.castShadows=ZZ(g,n.count),s.componentParameters.transparent=ZZ(p,n.count),s.componentParameters.opaqueOverride=ZZ(f,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new zD,s.componentParameters.castShadows=l.castShadows?Vo.All:Vo.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(e,i,r,s=!1){e.intersectionGeometry.getComponentAabb(i,r);const n=e,o=n.components.verticalOffsets;if(s||o==null)return r;const a=o[i];if(this._viewingMode===Xe.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=b0e(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}expandRangeWithComponentObjectElevationRange(e,i,r,s){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==i||s.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const n=e,o=n.components,a=o.count,l=o.verticalOffsets,c=n.intersectionGeometry,u=this._viewingMode===Xe.Local,h=c.getComponentAabbs(),p=yGt;let f=1/0,g=-1/0;for(let y=0;y<a;y++){const v=6*y,b=l?.[y]??0;let w=1/0,x=-1/0;if(u)w=h[v+2]+b+i,x=h[v+5]+b+i;else{if(p[0]=h[v],p[1]=h[v+1],p[2]=h[v+2],p[3]=h[v+3],p[4]=h[v+4],p[5]=h[v+5],b!==0){const R=b0e(b);R.localOrigin=n.transform.position,R.applyToAabb(p)}const S=Math.max(Math.abs(p[3]),Math.abs(p[0])),E=Math.max(Math.abs(p[4]),Math.abs(p[1])),C=i+p[5]+r;s.expandElevationRangeValues(i+p[2],Math.sqrt(S*S+E*E+C*C)-r)}s.expandElevationRangeValues(w,x),f=Math.min(f,w),g=Math.max(g,x)}this._elevationRangeCacheVerticalOffset=i,this._elevationRangeCacheMin=f,this._elevationRangeCacheMax=g}intersect(e,i,r,s,n,o,a){const l=e,{transform:c}=l,{position:u}=c;return n!=null&&(n.localOrigin=u),l.intersectionGeometry.intersect(i,r,s,n,l.components.verticalOffsets,c,o,a)}addEdges(e,i,r,s,n){const o=e,{indices:a,positions:l}=o.intersectionGeometry,c=o.components.offsets;return i.addComponentObject(o,l,a,c,r,s,n)}async extractEdgeInformation(e,i,r){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:uGt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=X6e.createBuffer(a.length/3);E7(c.position.typedBuffer,a,c.position.typedBufferStride,3),k5e(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,h=this._computeVisibilityIndices(o,n,l,u);return{origin:Fn(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:h,indicesLength:h.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,i,r,s){if(e&&i.allVisible())return e;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=f0(e)?new Array(n):e?.BYTES_PER_ELEMENT===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const u=r[l],h=r[c];for(let p=u;p<h;p++)o[a++]=e?e[p]:p;return!0}),o}addComponentHighlight(e,i){const r=e.components;r.highlightCounts==null&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,i){const r=e.components;if(r.highlightCounts==null)return void ATe().warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else ATe().warn("Removing non-existing highlight.")}clearHighlights(e){const i=e.components;i.highlightCounts!=null&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(e,i){const r=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=Vr.createVertex(r,wr.STATIC_DRAW,s.vertices.data),a=s.indices?Vr.createIndex(r,wr.STATIC_DRAW,s.indices):null,l=Dh(DVt(n)),c=new Uint16Array(s.vertices.count);for(let y=0;y<i.count;y++){const v=i.offsets[y],b=i.offsets[y+1],w=i.materialDataIndices[y];if(s.indices!=null)for(let x=v;x<b;x++)c[s.indices[x]]=w;else for(let x=v;x<b;x++)c[x]=w}const u=Vr.createVertex(r,wr.STATIC_DRAW,c.buffer),h=new oa(e.transform,e.toMapSpace),p=new gg(r,W6e,{data:l,componentIndices:gGt},{data:o,componentIndices:u},a),f=new MVt(p,Li.TRIANGLES,n,a!=null),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.usedMemory+u.usedMemory+(a!=null?a.usedMemory:0)};return new CVt(h,f,g)}_notifyDirty(){this._renderManager.notifyDirty()}};const gGt=Dh(Xs().u16(O.COMPONENTINDEX));function ZZ(t,e){return t===e?Vo.All:t===0?Vo.None:Vo.Some}const yGt=Oo();let K6e=class extends is{};function _Gt(){const t=new tr,{outputs:e,fragment:i}=t;return t.include(Rl),i.uniforms.add(new o0("textureInput",r=>r.input)),i.constants.add("sampleArea","int",Math.ceil(hH/2)),e.add("fragGrid","vec2"),i.code.add(T`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${T.int(Ey)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -sampleArea; x < cellSize + sampleArea; x += 2) {
        for(int y = -sampleArea; y < cellSize + sampleArea; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`),t}const Ey=32,hH=9,eje=.4,vGt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:K6e,blurSize:eje,build:_Gt,gridCellPixelSize:Ey,outlineSize:hH},Symbol.toStringTag,{value:"Module"}));function bGt(){const t=new tr,{vertex:e,fragment:i}=t,r=e.code,s=i.code;return t.attributes.add(O.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(O.UV0,"vec2"),e.uniforms.add(new Et("coverageTex",n=>n.coverageTexture),new os("coverageRounding",n=>n.coverageRounding)),r.add(T`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new Et("tex",n=>n.blurTexture),new Et("highlightTexture",n=>n.highlightTexture),new Ki("uColor",n=>n.color),new Ki("haloColor",n=>n.haloColor),new Ki("opacities",n=>Ds(wGt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),i.constants.add("inner","float",1-(hH-eje)/hH),s.add(T`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const wGt=pi(),xGt=Object.freeze(Object.defineProperty({__proto__:null,build:bGt},Symbol.toStringTag,{value:"Module"}));let tje=class ije extends hr{initializeProgram(e){return new dr(e.rctx,ije.shader.get().build(),Fi)}initializePipeline(){return ti({blending:Za(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),colorWrite:fi})}};tje.shader=new ir(xGt,()=>ye(()=>import("./HighlightApply.glsl-bc2d4e67.js"),[],import.meta.url));let rje=class extends is{constructor(){super(...arguments),this.blurSize=vt()}};function SGt(){const t=new tr,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add(O.POSITION,"vec2"),e.add(O.UV0,"vec2"),i.add("blurCoordinate","vec3"),r.uniforms.add(new Et("coverageTex",n=>n.coverageTexture),new os("coverageRounding",n=>n.coverageRounding)),r.code.add(T`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`),s.uniforms.add(new WUe("blurSize",n=>n.blurSize),new o0("tex",n=>n.blurInputTexture)),s.code.add(T`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const TGt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:rje,build:SGt},Symbol.toStringTag,{value:"Module"}));let sje=class nje extends hr{initializeProgram(e){return new dr(e.rctx,nje.shader.get().build(),Fi)}initializePipeline(){return ti({colorWrite:fi})}};sje.shader=new ir(TGt,()=>ye(()=>import("./HighlightBlur.glsl-ec922517.js"),[],import.meta.url));let oje=class aje extends hr{initializeProgram(e){return new dr(e.rctx,aje.shader.get().build(),Fi)}initializePipeline(){return ti({colorWrite:fi})}};oje.shader=new ir(vGt,()=>ye(()=>import("./HighlightDownsample.glsl-244bda0b.js"),[],import.meta.url));let EGt=class extends is{constructor(){super(...arguments),this.color=ni(1,0,1,1),this.haloColor=ni(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.coverageRounding=Ni(1,1)}},hR=class extends e${constructor(e){super(e),this.produces="highlight-color",this.consumes={required:["highlight-color","highlights"]},this._passParameters=new EGt,this._downsampleDrawParameters=new K6e,this._blurDrawParameters=new rje,this._blurColorFormat=ae("mac")?xs.RGBA:xs.RGBA4,this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0},this._blurTechnique=e.techniques.acquire(sje),this._downsampleTechnique=e.techniques.acquire(oje),this._applyTechnique=e.techniques.acquire(tje)}initialize(){this.addHandles([_e(()=>this.view.highlightOptions.color,e=>{this._passParameters.color=MF(e??OGe),this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color),this.requestRender(vr.UPDATE)},Sr),_e(()=>this.view.highlightOptions.haloColor,e=>{this._passParameters.haloColor=e!=null?MF(e):this._passParameters.color,this.requestRender(vr.UPDATE)},Sr),_e(()=>this.view.highlightOptions.haloOpacity,e=>{this._passParameters.haloOpacity=e??IGe,this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity,this.requestRender(vr.UPDATE)},Sr),_e(()=>this.view.highlightOptions.fillOpacity,e=>{this._passParameters.fillOpacity=e??$Ge,this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity,this.requestRender(vr.UPDATE)},Sr)])}destroy(){this._blurTechnique.release(),this._downsampleTechnique.release(),this._applyTechnique.release(),this._grid.coverage=yi(this._grid.coverage),this._grid.vao=jt(this._grid.vao)}render(e){if(this.bindParameters.decorations===Gc.OFF)return e.find(({name:b})=>b==="highlight-color");if(!(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled))return this.requestRender(vr.UPDATE),e.find(({name:b})=>b==="highlight-color");const i=e.find(({name:b})=>b==="highlights").getTexture(),r=this.bindParameters.camera,s=r.fullWidth,n=r.fullHeight,o=r.pixelRatio,a=Math.ceil(s/o),l=Math.ceil(n/o),c=this.renderingContext;this._gridUpdateResources(i),this._gridComputeCoverage(i,this.bindParameters),this._passParameters.highlightTexture=i,this._passParameters.coverageTexture=this._grid.coverage?.getTexture();const{width:u,height:h}=i.descriptor;Gi(this._passParameters.coverageRounding,u/(Math.ceil(u/Ey)*Ey),h/(Math.ceil(h/Ey)*Ey));const p=this._grid.vao;c.bindVAO(p);const f=this.fboCache.acquire(a,l,"highlight blur",this._blurColorFormat);c.unbindTexture(f.fbo?.colorTexture),c.bindFramebuffer(f.fbo),c.setClearColor(0,0,0,0),c.clear(ss.COLOR_BUFFER_BIT),c.setViewport(0,0,a,l),this._blurDrawParameters.blurInputTexture=i,Gi(this._blurDrawParameters.blurSize,1/a,0);const g=c.bindTechnique(this._blurTechnique,this.bindParameters,this._passParameters,this._blurDrawParameters);c.drawArrays(this._blurTechnique.primitiveType,0,Pv(p,"geometry"));const y=this.fboCache.acquire(a,l,"highlight blur",this._blurColorFormat);c.unbindTexture(y.fbo?.colorTexture),c.bindFramebuffer(y.fbo),c.setClearColor(0,0,0,0),c.clear(ss.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=f.getTexture(),Gi(this._blurDrawParameters.blurSize,0,1/l),g.bindDraw(this._blurDrawParameters,this.bindParameters,this._passParameters),c.drawArrays(this._blurTechnique.primitiveType,0,Pv(p,"geometry"));const v=e.find(({name:b})=>b==="highlight-color");return c.bindFramebuffer(v.fbo),c.setViewport4fv(r.fullViewport),this._passParameters.blurTexture=y.getTexture(),c.bindTechnique(this._applyTechnique,this.bindParameters,this._passParameters),c.drawArrays(this._applyTechnique.primitiveType,0,Pv(p,"geometry")),f.release(),y.release(),v}_gridUpdateResources(e){const i=this.renderingContext,r=this._grid,s=Math.ceil(e.descriptor.height/Ey),n=Math.ceil(e.descriptor.width/Ey);if(r.vao&&r.verticalCellCount===s&&r.horizontalCellCount===n)return;r.verticalCellCount=s,r.horizontalCellCount=n;const o=s+1,a=n+1,l=1/s,c=1/n,u=new Float32Array(6*4*o*a);let h=0;for(let p=0;p<o;p++)for(let f=0;f<a;f++)u[h++]=(f-.5)*c*2-1,u[h++]=(p-.5)*l*2-1,u[h++]=f*c,u[h++]=p*l,u[h++]=(f+.5)*c*2-1,u[h++]=(p-.5)*l*2-1,u[h++]=f*c,u[h++]=p*l,u[h++]=(f-.5)*c*2-1,u[h++]=(p+.5)*l*2-1,u[h++]=f*c,u[h++]=p*l,u[h++]=(f-.5)*c*2-1,u[h++]=(p+.5)*l*2-1,u[h++]=f*c,u[h++]=p*l,u[h++]=(f+.5)*c*2-1,u[h++]=(p-.5)*l*2-1,u[h++]=f*c,u[h++]=p*l,u[h++]=(f+.5)*c*2-1,u[h++]=(p+.5)*l*2-1,u[h++]=f*c,u[h++]=p*l;r.vao?.dispose(),r.vao=new k0(i,Fi,{geometry:Qk},{geometry:Vr.createVertex(i,wr.STATIC_DRAW,u)})}_gridComputeCoverage(e,i){const r=this.renderingContext,s=this._grid,n=e.descriptor,o=Math.ceil(n.width/Ey),a=Math.ceil(n.height/Ey);this._downsampleDrawParameters.input=e,s.coverage?.release(),s.coverage=this.fboCache.acquire(o,a,"highlight coverage",xs.RG),r.unbindTexture(s.coverage.fbo?.colorTexture),r.bindFramebuffer(s.coverage.fbo),r.bindTechnique(this._downsampleTechnique,i,this._passParameters,this._downsampleDrawParameters),r.setViewport(0,0,o,a),r.screen.draw()}get test(){}};d([m()],hR.prototype,"produces",void 0),d([m()],hR.prototype,"consumes",void 0),d([m({constructOnly:!0})],hR.prototype,"techniques",void 0),hR=d([N("esri.views.3d.webgl-engine.effects.highlight.Highlight")],hR);let Spe=class extends Zc{constructor(){super(...arguments),this.receiveShadows=!0}};d([V()],Spe.prototype,"receiveShadows",void 0);function lje(t){const e=t.fragment;t.include(d4),e.include(N0),e.code.add(T`vec3 normalFromDepth(sampler2D depthMap, vec3 pixelPos, vec2 fragCoord, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
float leftPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(-1, 0), 0).r);
float rightPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(1, 0), 0).r);
float bottomPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, -1), 0).r);
float topPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, 1), 0).r);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`)}const CGt=.99999,MGt=.025;function AGt(t){const e=new tr;e.include(m4,t),e.include(Rl),e.include(lje);const i=e.fragment;return i.include(Cg),i.uniforms.add(new Et("defaultDepthTex",(r,s)=>s.shadowMap.getSnapshot(QE.ExcludeHighlight)),new Et("highlightDepthTex",(r,s)=>s.shadowMap.getSnapshot(QE.Highlight)),new Et("depthMap",(r,s)=>s.depth?.attachment),new Et("highlightTexture",r=>r.highlight),new Ki("uColor",r=>r.shadowColor),new et("opacity",r=>r.shadowOpacity),new et("occludedOpacity",r=>r.occludedShadowOpacity),new et("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new Qt("lightingMainDirectionView",(r,s)=>Se(PTe,nt(PTe,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new Ps("inverseViewMatrix",(r,s)=>Ao(RTe,ac(RTe,s.camera.viewMatrix,s.camera.center)))),i.constants.add("unoccludedHighlightFlag","vec4",Dhe),i.code.add(T`
    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${T.float(CGt)}) {
        discard;
      }

      float depth = depthFromTexture(depthMap, uv);

      // 1.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth >= 1.0 || depth <= 0.0) {
        discard;
      }

      float currentPixelDepth = linearizeDepth(depth);
      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);
      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;
      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(depthMap, currentPixelPos.xyz, gl_FragCoord.xy, uv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${T.float(MGt)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `),e}const RTe=Ne(),PTe=M(),RGt=Object.freeze(Object.defineProperty({__proto__:null,build:AGt},Symbol.toStringTag,{value:"Module"}));let PGt=class extends rde{constructor(){super(...arguments),this.shadowColor=ni(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},cje=class uje extends hr{constructor(e){super(e,new Spe,()=>this.destroy())}initializeProgram(e){return new dr(e.rctx,uje.shader.get().build(this.configuration),Fi)}initializePipeline(){return ti({blending:Za(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),colorWrite:fi,depthTest:null,depthWrite:null})}get primitiveType(){return Li.TRIANGLE_STRIP}};cje.shader=new ir(RGt,()=>ye(()=>import("./ShadowHighlight.glsl-e8131543.js"),[],import.meta.url));const OGt=.001953125,IGt=4e4,$Gt=5e4;let WT=class extends e${constructor(e){super(e),this.produces="composite-color",this.consumes={required:["composite-color","highlights"]},this._passParameters=new PGt,this._maxOpacity=1,this._shadowDifference=.2,this._technique=e.techniques.acquire(cje)}initialize(){this.addHandles([_e(()=>this.view.highlightOptions.shadowOpacity,e=>{this._passParameters.shadowOpacity=e??LGe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},Sr),_e(()=>this.view.highlightOptions.shadowDifference,e=>{this._shadowDifference=e??DGe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},Sr),_e(()=>this.view.highlightOptions.shadowColor,e=>{this._passParameters.shadowColor=MF(e??NGe),this._updateMaxOpacity()},Sr)])}destroy(){this._technique.release()}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}render(e){const i=e.find(({name:n})=>n==="composite-color"),r=this.bindParameters;if(!r.shadowHighlightsVisible||!r.depth||!this._ensureIfVisible(r.camera,r.lighting.mainLight.direction))return i;if(!this._technique.compiled)return this.requestRender(vr.UPDATE),i;this._passParameters.highlight=e.find(({name:n})=>n==="highlights")?.getTexture(),this._passParameters.origin=r.camera.center;const s=this.renderingContext;return s.bindFramebuffer(i.fbo),s.bindTechnique(this._technique,r,this._passParameters),s.screen.draw(),i}_ensureIfVisible(e,i){this._passParameters.opacityElevation=1-uF(IGt,$Gt,e.relativeElevation);const r=this.viewingMode===Xe.Global?Se(OTe,e.center):ue(OTe,0,0,1),s=xe(r,i);return this._passParameters.dayNightTerminator=uF(0,1,$e(30*s,0,1)),this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=OGt}};d([m()],WT.prototype,"produces",void 0),d([m()],WT.prototype,"consumes",void 0),d([m({constructOnly:!0})],WT.prototype,"viewingMode",void 0),d([m({constructOnly:!0})],WT.prototype,"techniques",void 0),WT=d([N("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],WT);const OTe=M();let hje=class extends is{constructor(){super(...arguments),this.mask=null,this.overlay=null,this.input=null,this.size=0}};function NGt(){const t=new tr;return t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new Ki("drawPosition",(e,i)=>LGt(e,i))),t.varyings.add("vUV","vec2"),t.vertex.code.add(T`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new Et("textureInput",e=>e.input)),t.fragment.uniforms.add(new Et("textureMask",e=>e.mask)),t.fragment.uniforms.add(new Et("textureOverlay",e=>e.overlay)),t.fragment.uniforms.add(new a0("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new a0("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(T`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function LGt(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,s=t.magnifier.offset.y*i;$m(t.magnifier.position,ITe);const n=e.camera.screenToRender(ITe,DGt),o=Math.ceil(i*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return Ds(FGt,(n[0]+r)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const ITe=Hs(),DGt=IPe(),FGt=pi(),kGt=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:hje,build:NGt},Symbol.toStringTag,{value:"Module"}));let dje=class pje extends hr{initializeProgram(e){return new dr(e.rctx,pje.shader.get().build(),Fi)}initializePipeline(){return ti({blending:Zd(ke.ONE,ke.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:fi})}};dje.shader=new ir(kGt,()=>ye(()=>import("./Magnifier.glsl-8bb4d7b9.js"),[],import.meta.url));async function UGt(t){const e=ye(()=>import("./mask-svg-023bbc42.js"),[],import.meta.url),i=ye(()=>import("./overlay-svg-d838c8e3.js"),[],import.meta.url),r=Xv((await e).default,{signal:t}),s=Xv((await i).default,{signal:t}),n={mask:await r,overlay:await s};return zt(t),n}let Db=class extends e${constructor(e){super(e),this.produces="magnifier-color",this.consumes={required:["magnifier-color"]},this._imageSources=null,this._imageLoadTask=null,this._passParameters=new hje,this._vao=null,this._technique=null,this._magnifier=null,this._tmpScreenPoint=Hs(),this._tmpRenderPoint=IPe()}initialize(){this.addHandles([_e(()=>this.view.magnifier,e=>this._update(e),Sr)])}_update(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const i=()=>{const r=this._validMagnifier;r?(this._loadResources(r),this.produces="magnifier-color"):this.produces="disabled",this.requestRender()};this._magnifier&&this.addHandles(_e(()=>this._magnifier?.version,i)),i()}get _validMagnifier(){return this._magnifier?.visible&&this._magnifier?.position&&this._magnifier?.size>0?this._magnifier:null}get _factor(){return this._magnifier?.factor||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeTextures(),this._vao=jt(this._vao)}_disposeTextures(){this._passParameters.mask=jt(this._passParameters.mask),this._passParameters.overlay=jt(this._passParameters.overlay),this._passParameters.input=jt(this._passParameters.input)}render(e){const i=this._validMagnifier,r=e.find(({name:v})=>v==="magnifier-color");if(i==null)return r;if(this._imageSources==null)return this.requestRender(vr.UPDATE),r;const s=this.renderingContext,n=this.camera.pixelRatio,o=Math.ceil(n*i.size);if(this._vao??=U0(s,Fue,Fi,0,1),this._technique??=this.techniques.acquire(dje),this._ensureTextureResources(s,o),!this._technique?.compiled||!this._passParameters.input)return this.requestRender(vr.UPDATE),r;const a=Math.ceil(1/this._factor*o),l=this._passParameters.input;l.resize(a,a),$m(i.position,this._tmpScreenPoint);const c=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),u=this.camera.fullWidth,h=this.camera.fullHeight,p=.5*a,f=.5*a;c[0]=$e(c[0],p,u-p-1),c[1]=$e(c[1],f,h-f-1);const g=Math.floor(c[0]-p),y=Math.floor(c[1]-f);return s.bindFramebuffer(r.fbo),this._technique.program.bindTexture("textureInput",l),s.gl.copyTexImage2D(l.descriptor.target,0,l.descriptor.pixelFormat,g,y,a,a,0),this._passParameters.magnifier=i,s.bindTechnique(this._technique,this.bindParameters,this._passParameters),s.bindVAO(this._vao),s.drawArrays(Li.TRIANGLE_STRIP,0,4),r}_loadResources(e){const{maskUrl:i,overlayUrl:r}=e;this._imageLoadTask?.maskUrl===i&&this._imageLoadTask?.overlayUrl===r||(this._imageLoadTask?.task.abort(),this._imageLoadTask=this._imageSources=null),this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:P0(async s=>{const n=i==null||r==null?UGt(s):null,o=i!=null?Xv(i,{signal:s}):n.then(l=>l.mask),a=r!=null?Xv(r,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a}})})}_ensureTextureResources(e,i){if(this._imageSources==null||this._passParameters.size===i&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay)return;this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=i,this._imageSources.overlay.height=this._imageSources.mask.height=i;const r=new fs;r.internalFormat=Xt.RGBA,r.wrapMode=Di.CLAMP_TO_EDGE,r.flipped=!0,r.preMultiplyAlpha=!wRe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result,this._passParameters.overlay=new Gr(e,r,this._imageSources.overlay),r.pixelFormat=r.internalFormat=Xt.ALPHA,r.preMultiplyAlpha=!1,this._passParameters.mask=new Gr(e,r,this._imageSources.mask),r.pixelFormat=r.internalFormat=Xt.RGBA,r.flipped=!1,this._passParameters.input=new Gr(e,r)}};d([m()],Db.prototype,"produces",void 0),d([m()],Db.prototype,"consumes",void 0),d([m()],Db.prototype,"_imageSources",void 0),d([m()],Db.prototype,"_imageLoadTask",void 0),d([m({constructOnly:!0})],Db.prototype,"techniques",void 0),Db=d([N("esri.views.3d.webgl-engine.effects.magnifier.MagnifierRenderNode")],Db);const eA={maxSearchSteps:8,maxDistanceAreaTex:16};function BGt(){const t=new tr;return t.include(Rl),t.fragment.uniforms.add(new Et("edgesTexture",e=>e.inputTexture),new Et("areaTexture",e=>e.areaTexture),new Et("searchTexture",e=>e.searchTexture)),t.fragment.code.add(T`
    #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
    #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

    vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
      return texture(tex, coord + offset.x * resolution, 0.0);
    }

    float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture( searchTex, e, 0.0 ).r;
    }

    float searchLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${T.int(eA.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${T.int(eA.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
      return texcoord.x;
    }

    float searchUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${T.int(eA.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
      return texcoord.y;
    }

    float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${T.int(eA.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
      return texcoord.y;
    }

    vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
      vec2 texcoord = float( ${T.int(eA.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
      texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
      texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
      return texture( areaTex, texcoord, 0.0 ).rg;
    }

    void main() {
      vec2 size = vec2(textureSize(edgesTexture, 0));
      vec2 resolution = 1.0 / size;
      vec2 pixelCoord = uv * size;
      vec4 offsets[2];
      offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
      offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
      vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${T.int(eA.maxSearchSteps)} );

      ivec4 subsampleIndices = ivec4(0.0);
      vec4 weights = vec4(0.0);
      vec2 e = texture( edgesTexture, uv ).rg;
      if ( e.g > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.x = searchLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
        coords.y = offsets[1].y;
        d.x = coords.x;
        float e1 = texture( edgesTexture, coords, 0.0 ).r;
        coords.x = searchRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
        d.y = coords.x;
        d = d * size.x - pixelCoord.x;
        vec2 sqrt_d = sqrt( abs(d) );
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
        weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
      }

      if ( e.r > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.y = searchUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
        coords.x = offsets[0].x;
        d.x = coords.y;
        float e1 = texture( edgesTexture, coords, 0.0 ).g;
        coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
        d.y = coords.y;
        d = d * size.y - pixelCoord.y;
        vec2 sqrt_d = sqrt(abs(d));
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
        weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

        // for some reason the following lines are necessary to prevent
        // texture lookup precision issues on some Intel integrated graphics chips
        vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
        weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
      }
      fragColor = weights;
    }`),t}const zGt=Object.freeze(Object.defineProperty({__proto__:null,build:BGt},Symbol.toStringTag,{value:"Module"}));let fje=class mje extends hr{initializeProgram(e){return new dr(e.rctx,mje.shader.get().build(),Fi)}initializePipeline(){return ti({colorWrite:fi})}};fje.shader=new ir(zGt,()=>ye(()=>import("./BlendWeights.glsl-b7d5b2dc.js"),[],import.meta.url));function VGt(){const t=new tr;return t.include(Rl),t.fragment.uniforms.add(new Et("blendWeightsTexture",e=>e.inputTexture),new Et("colorTexture",e=>e.color)),t.fragment.code.add(T`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const GGt=Object.freeze(Object.defineProperty({__proto__:null,build:VGt},Symbol.toStringTag,{value:"Module"}));let gje=class yje extends hr{initializeProgram(e){return new dr(e.rctx,yje.shader.get().build(),Fi)}initializePipeline(){return ti({colorWrite:fi})}};gje.shader=new ir(GGt,()=>ye(()=>import("./Blur.glsl-c76c6bfb.js"),[],import.meta.url));const $Te={threshold:.05,localConstrastAdaption:2};function jGt(){const t=new tr;return t.include(Rl),t.fragment.uniforms.add(new Et("colorTexture",e=>e.color)),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(T`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${T.float($Te.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${T.float($Te.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `),t}const HGt=Object.freeze(Object.defineProperty({__proto__:null,build:jGt},Symbol.toStringTag,{value:"Module"}));let _je=class vje extends hr{initializeProgram(e){return new dr(e.rctx,vje.shader.get().build(),Fi)}initializePipeline(){return ti({colorWrite:fi})}};_je.shader=new ir(HGt,()=>ye(()=>import("./EdgeDetect.glsl-4094a148.js"),[],import.meta.url));let qGt=class extends is{},Fb=class extends e${constructor(e){super(e),this.produces="disabled",this.consumes={required:["aa-color","composite-color"]},this._areaTexture=null,this._searchTexture=null,this._smaaParameters=new qGt,this._edgeTechnique=e.techniques.acquire(_je),this._blendTechnique=e.techniques.acquire(fje),this._blurTechnique=e.techniques.acquire(gje)}initialize(){this.addHandles([_e(()=>this.isEnabled(),e=>e?this.enable():this.disable(),Sr)])}async enable(){if(this.produces="aa-color",this._abortController||this._areaTexture&&this._searchTexture)return;this._abortController=new AbortController;const e=this._abortController.signal;try{const i=await ye(()=>import("./SMAAData-660b7d34.js"),[],import.meta.url);await this._loadTextures(i,e),this.requestRender(vr.UPDATE)}catch{}this._abortController=null}async _loadTextures(e,i){zt(i);const[r,s]=await Promise.allSettled([Xv(e.areaTexture,{signal:i}),Xv(e.searchTexure,{signal:i})]);if(zt(i),r.status!=="fulfilled"||s.status!=="fulfilled")return;const n=this.renderingContext;this._areaTexture=NTe(n,_i.LINEAR,Xt.RGB,r.value),this._searchTexture=NTe(n,_i.NEAREST,Xt.LUMINANCE,s.value)}disable(){this.produces="disabled"}destroy(){this._searchTexture=jt(this._searchTexture),this._areaTexture=jt(this._areaTexture),this._blurTechnique.release(),this._blendTechnique.release(),this._edgeTechnique.release()}render(e){const i=e.find(({name:c})=>c==="aa-color");if(!(this._edgeTechnique.compiled&&this._blendTechnique.compiled&&this._blurTechnique.compiled&&this._areaTexture&&this._searchTexture))return this.requestRender(vr.UPDATE),i;const r=e.find(({name:c})=>c==="composite-color"),s=r.fbo.width,n=r.fbo.height,o=this.renderingContext;o.setViewport(0,0,s,n);const a=this.fboCache.acquire(s,n,"smaa edges",xs.RG);o.unbindTexture(a.fbo?.colorTexture),o.bindFramebuffer(a.fbo),o.setClearColor(0,0,0,1),o.clear(ss.COLOR_BUFFER_BIT),this._smaaParameters.color=r.getTexture(),o.bindTechnique(this._edgeTechnique,null,this._smaaParameters),o.screen.draw();const l=this.fboCache.acquire(s,n,"smaa blend");return o.unbindTexture(l.fbo?.colorTexture),o.bindFramebuffer(l.fbo),o.setClearColor(0,0,1,1),o.clear(ss.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=a.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,o.bindTechnique(this._blendTechnique,null,this._smaaParameters),o.screen.draw(),a.release(),o.bindFramebuffer(i.fbo),o.setClearColor(0,1,0,1),o.clear(ss.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=l.getTexture(),o.bindTechnique(this._blurTechnique,null,this._smaaParameters),o.screen.draw(),l.release(),i}};function NTe(t,e,i,r){const s=new fs;return s.pixelFormat=i,s.wrapMode=Di.CLAMP_TO_EDGE,s.width=r.width,s.height=r.height,s.samplingMode=e,new Gr(t,s,r)}d([m()],Fb.prototype,"produces",void 0),d([m()],Fb.prototype,"consumes",void 0),d([m({constructOnly:!0})],Fb.prototype,"isEnabled",void 0),d([m({constructOnly:!0})],Fb.prototype,"techniques",void 0),d([m()],Fb.prototype,"_abortController",void 0),Fb=d([N("esri.views.3d.webgl-engine.effects.smaa.SMAA")],Fb);let Tpe=class extends is{constructor(){super(...arguments),this.opacity=1}};function WGt(t){const e=new tr;return e.include(Rl),e.fragment.uniforms.add(new Et("tex",i=>i.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new et("opacity",i=>i.opacity)),t.isDepthBlit&&(e.fragment.uniforms.add(new os("nearFar",(i,r)=>r.camera.nearFar)),e.fragment.include(N0),e.fragment.include(Cg)),e.fragment.code.add(T`
    void main() {
      ${t.isDepthBlit?T`
              float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
              fragColor = float2rgba(normalizedLinearDepth);`:T`
              fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};`}
    }`),e}const YGt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:Tpe,build:WGt},Symbol.toStringTag,{value:"Module"}));var vh;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(vh||(vh={}));let VD=class extends Zc{constructor(){super(...arguments),this.alphaMode=vh.None,this.hasOpacityFactor=!1,this.isDepthBlit=!1}};d([V({count:vh.COUNT})],VD.prototype,"alphaMode",void 0),d([V()],VD.prototype,"hasOpacityFactor",void 0),d([V()],VD.prototype,"isDepthBlit",void 0);let Epe=class bje extends hr{initializeProgram(e){return new dr(e.rctx,bje.shader.get().build(this.configuration),Fi)}initializePipeline(){switch(this.configuration.alphaMode){case vh.None:return ti({colorWrite:fi});case vh.Alpha:return ti({blending:Za(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),colorWrite:fi});case vh.PremultipliedAlpha:case vh.COUNT:return ti({blending:Zd(ke.ONE,ke.ONE_MINUS_SRC_ALPHA),colorWrite:fi})}}};Epe.shader=new ir(YGt,()=>ye(()=>import("./Compositing.glsl-1d16a425.js"),[],import.meta.url));let wje=class extends is{};function XGt(){const t=new tr;return t.include(Rl),t.fragment.uniforms.add(new Et("tex",e=>e.texture)),t.fragment.code.add(T`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const ZGt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:wje,build:XGt},Symbol.toStringTag,{value:"Module"}));let xje=class Sje extends hr{initializeProgram(e){return new dr(e.rctx,Sje.shader.get().build(),Fi)}initializePipeline(){return ti({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};xje.shader=new ir(ZGt,()=>ye(()=>import("./HUDCompositing.glsl-3ee00c1b.js"),[],import.meta.url));let Tje=class extends is{};function JGt(){const t=new tr;return t.include(Rl),t.fragment.uniforms.add(new Et("colorTexture",e=>e.colorTexture),new Et("alphaTexture",e=>e.alphaTexture),new Et("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(T`void main() {
float srcAlpha = texture(alphaTexture, uv).r;
if(srcAlpha <= 1e-5){
discard;
}
vec4 srcColor = texture(colorTexture, uv);
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb / srcAlpha, frontFace.rgb, frontFace.a), 1.0 - srcColor.a);
}`),t}const QGt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:Tje,build:JGt},Symbol.toStringTag,{value:"Module"}));let Cpe=class Eje extends hr{initializeProgram(e){return new dr(e.rctx,Eje.shader.get().build(),Fi)}initializePipeline(){return ti({blending:Za(ke.SRC_ALPHA,ke.ONE,ke.ONE_MINUS_SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),colorWrite:fi})}};Cpe.shader=new ir(QGt,()=>ye(()=>import("./OITCompositing.glsl-f7114527.js"),[],import.meta.url));let KGt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._configuration=new VD,this._passParameters=new Tpe,this._oitParameters=new Tje,this._hudParameters=new wje}compositeOIT(e,i,r,s){this._oitParameters.colorTexture=i,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=s;const n=this._techniques.acquire(Cpe);this._rctx.bindTechnique(n,e,this._oitParameters),this._rctx.screen.draw(),n.release()}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._techniques.acquire(xje);this._rctx.bindTechnique(r,e,this._hudParameters),this._rctx.screen.draw(),r.release()}composite(e,i,r=vh.None,s=1){this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=i,this._passParameters.opacity=s;const n=this._techniques.acquire(Epe,this._configuration);this._rctx.bindTechnique(n,e,this._passParameters),this._rctx.screen.draw(),n.release()}blitDepthToLinearDepth(e,i){this._configuration.isDepthBlit=!0,this.composite(e,i),this._configuration.isDepthBlit=!1}};const e6t=1e4,Cne=100,t6t=500,i6t=500,r6t=.1;function s6t(t,e,i){return qhe(e,t)*(i[1]-i[0])+i[0]}function n6t(t,e,i){let r=0;if(!e.some(n=>!!n.materialReference&&(r+=n.numGeometries,r>=e6t)))return f6t.compute(t,e);const s=E4();return i.forAll(n=>pI(s,o6t(t,n))),s}function o6t(t,e){if(!e.visible)return;const i=E4(),r=e.getSpatialQueryAccelerator();return r?a6t(i,t,r):l6t(i,t,e.objects),i}function a6t(t,e,i){const r=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=i.objectCount;if(a<t6t)JF(Dp,e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,s,qm.DepthOrder.FRONT_TO_BACK,Dp,(l,c)=>{Mne(t,e,l),Dp.far=t.near,c.setRange(Dp)},n,o),JF(Dp,Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,s,qm.DepthOrder.BACK_TO_FRONT,Dp,(l,c)=>{Mne(t,e,l),Dp.near=t.far,c.setRange(Dp)},n,o);else{const l=Math.max(Math.min(a,i6t),Math.ceil(a*r6t)),c=i.findClosest(s,qm.DepthOrder.FRONT_TO_BACK,n,o,l),u=i.findClosest(s,qm.DepthOrder.BACK_TO_FRONT,n,o,l);c&&u&&(LTe(t,e,c.boundingVolumeWorldSpace.bounds),LTe(t,e,u.boundingVolumeWorldSpace.bounds))}}function l6t(t,e,i){tA.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&tA.add(r)}),tA.empty||(tA.sort(e),JF(Dp,e.near,Math.min(t.near,e.far)),tA.forEachInDepthRange(Dp,qm.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<t.near&&Mne(t,e,r)}),JF(Dp,Math.max(t.far,e.near),e.far),tA.forEachInDepthRange(Dp,qm.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{t.far=Math.max(t.far,n)}))}function Mne(t,e,i){if(!i.visible||!xw(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=p6t;i.geometries.forEach(n=>{Or(s,r,n.transformation);const o=FO(s);Cje(t,e,n.boundingInfo,s,o)})}function Cje(t,e,i,r,s){if(i==null)return;nt(Lc,i.center,r);const{eye:n,viewForward:o}=e,a=o[0]*(Lc[0]-n[0])+o[1]*(Lc[1]-n[1])+o[2]*(Lc[2]-n[2]);if(Lc[3]=i.radius*s,!(a-Lc[3]>t.near&&a+Lc[3]<t.far)&&xw(e.frustum,Lc))if(i.radius>Cne&&i.getChildren())for(const l of i.getChildren())Cje(t,e,l,r,s);else Ane.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function LTe(t,e,i){const r=e.eye,s=e.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];t.near=Math.min(t.near,n-i[3]),t.far=Math.max(t.far,n+i[3])}let c6t=class{constructor(){this._items=new ci({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(s=>{const n=s.object.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,i,r){if(i===qm.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}}},u6t=class{constructor(){this._view=Ne(),this._viewProj=Ne(),this._frustum=RF(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,i){this._reset(),Xn(this._view,e.viewMatrix),Or(this._viewProj,e.projectionMatrix,this._view),e8(this._frustum,e.frustum);const r=this._view,s=r[2],n=r[6],o=r[10],a=r[14];i.forAll(p=>{p.materialReference&&p.forEachGeometry&&p.forEachGeometry(f=>{if(!f.visible||!f.castShadow)return;const g=f.boundingSphere,y=s*g[0]+n*g[1]+o*g[2]+a,v=y-g[3],b=y+g[3];this._geometries.push(f),this._near.push(-b),this._far.push(-v)})});const l=new wpe;if(this._geometries.length===0)return l;for(let p=0;p<this._geometries.length;++p)this._near[p]>l.far&&(l.far=this._near[p]),this._near[p]>2&&this._far[p]<l.near&&(l.near=this._far[p]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,h=0;for(let p=0;p<this._geometries.length;++p)this._near[p]<l.near&&(this._near[p]>=c.near?l.near=this._near[p]:this._nearCandidates[u++]=p),this._far[p]>l.far&&(this._far[p]<=c.far?l.far=this._far[p]:this._farCandidates[h++]=p);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((p,f)=>this._near[p]<this._near[f]?-1:this._near[p]>this._near[f]?1:0),this._farCandidates.sort((p,f)=>this._far[p]<this._far[f]?1:this._far[p]>this._far[f]?-1:0);for(let p=0;p<this._nearCandidates.length;++p){const f=this._nearCandidates[p];if(this._near[f]<l.near){const g=this._geometries[f],y=g.boundingInfo;this._includeNearBoundingInfoRec(y,g.shaderTransformation,l)}}for(let p=0;p<this._farCandidates.length;++p){const f=this._farCandidates[p];if(this._far[f]>l.far){const g=this._geometries[f],y=g.boundingInfo;this._includeFarBoundingInfoRec(y,g.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,i,r){if(e==null)return;const s=e.center;nt(Lc,s,i);const n=FO(i),o=Lc[0],a=Lc[1],l=Lc[2],c=e.radius*n,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const h=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],p=h+c;if(!(-(h-c)<2||-p>=r.near))if(-p>this._looseRange.near)r.near=-p;else{if(c>Cne){const f=e.getChildren();if(f!==void 0){for(const g of f)this._includeNearBoundingInfoRec(g,i,r);return}}Ane.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,i,r){if(e==null)return;let s=e.radius;const n=e.center;nt(Lc,n,i);const o=FO(i),a=Lc[0],l=Lc[1],c=Lc[2];s*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>s||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>s||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>s||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>s)return;const h=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-h<=r.far))if(-h<this._looseRange.far)r.far=-h;else{if(s>Cne){const p=e.getChildren();if(p!==void 0){for(const f of p)this._includeFarBoundingInfoRec(f,i,r);return}}Ane.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}},h6t=class{constructor(){this._modelViewProj=Ne(),this._clipPosition=[pi(),pi(),pi(),pi(),pi(),pi(),pi(),pi()]}unionDepthRangeWithAABB(e,i,r,s,n){const o=this._modelViewProj;Or(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?s[0]:n[0],h=l===0||l===1||l===4||l===5?s[1]:n[1],p=l<4?s[2]:n[2];c[0]=o[0]*u+o[4]*h+o[8]*p+o[12],c[1]=o[1]*u+o[5]*h+o[9]*p+o[13],c[2]=o[2]*u+o[6]*h+o[10]*p+o[14],c[3]=o[3]*u+o[7]*h+o[11]*p+o[15]}for(let l=0;l<12;++l){const c=d6t(this._clipPosition[QZ[l][0]],this._clipPosition[QZ[l][1]],this._clipPosition[QZ[l][2]]);let u=!0;for(let h=0;h<c.length;++h)if(c[h][3]>=2){u=!1;break}if(!u){a=!0;for(let h=0;h<c.length;++h){const p=c[h][3];Number.isFinite(p)&&(e.near=Math.min(p,e.near),e.far=Math.max(p,e.far))}}}return a}};function d6t(t,e,i){let r=[t,e,i];for(let s=0;s<4;++s){const n=r;r=[];for(let o=0;o<n.length;++o){const a=n[o],l=n[(o+1)%n.length];JZ(l,s)?(JZ(a,s)||r.push(DTe(a,l,s)),r.push(l)):JZ(a,s)&&r.push(DTe(a,l,s))}}return r}function JZ(t,e){return e===0?t[0]>=-t[3]:e===1?t[1]>=-t[3]:e===2?t[0]<=t[3]:e===3?t[1]<=t[3]:void Tt(!1)}function DTe(t,e,i){let r=0;return i===0?r=(-t[3]-t[0])/(e[0]-t[0]+e[3]-t[3]):i===1?r=(-t[3]-t[1])/(e[1]-t[1]+e[3]-t[3]):i===2?r=(t[3]-t[0])/(e[0]-t[0]-e[3]+t[3]):i===3&&(r=(t[3]-t[1])/(e[1]-t[1]-e[3]+t[3])),Qq(pi(),t,e,r)}const QZ=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Lc=Bn(),p6t=Ne(),Dp=E4(),tA=new c6t,f6t=new u6t,Ane=new h6t;let m6t=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new uc(new ArrayBuffer(4)),this._layerToOidToColor=new yx,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new yx,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,s,n,o=null,a=null,l=null){e&&i&&r&&s&&(this._layerUidToId.set(s,r),this._layerUidToPopupEnabled.set(s,n),n&&this._layerUidToGraphicsUidToObjectId.set(s,i,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l}))}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return ni(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(e.layerUid);if(i===void 0)return this.colorZero;if(i===!1)return this.colorZero;const r=this._layerUidToGraphicsUidToObjectId.get(e.layerUid,e.graphicUid)?.objectId;if(!r)return this.colorZero;let s=this._layerToOidToColor.get(e.layerUid,r);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerUid,r,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new uc(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(r.layerUid,r.graphicUid),n=this._layerUidToId.get(r.layerUid);s&&n&&e.set(i,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:s.objectId,lid:n,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",oid:s.objectId,lid:n})}return e}};var dw,V2;(function(t){t.OPAQUE="opaque-color",t.TRANSPARENT="transparent-color",t.COMPOSITE="composite-color",t.FINAL="final-color"})(dw||(dw={})),function(t){t.ANTIALIASING="aa-color",t.HIGHLIGHTS="highlight-color",t.MAGNIFIER="magnifier-color"}(V2||(V2={}));function g6t(t,e,i,r,s,n,o){return r=r||t.spatialReference,Ts(e,r,i,s,t.renderCoordsHelper.spatialReference,n,o)?s:null}let Mje=class{constructor(e,i){this.key=e,this.free=i,this.incarnation=0,this._refCount=1}retain(e=1){this._refCount+=e}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this.free(),!0))}};var fI;(function(t){t[t.FBO=0]="FBO",t[t.DEPTH=1]="DEPTH",t[t.COLOR=2]="COLOR"})(fI||(fI={}));let Aje=class extends Mje{constructor(e,i,r){super(e,r),this.attachment=i,this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}},y6t=class extends Aje{constructor(e,i,r){super(e,i,r),this.attachment=i,this.type=fI.COLOR}},FTe=class extends Aje{constructor(){super(...arguments),this.type=fI.DEPTH}};function _6t(t){return t?.attachment.type===Wv.Texture}let Rje=class extends Mje{constructor(e,i,r,s,n,o){super(e,o),this.type=fI.FBO,this._colors=new Map,this._name="composite-color",this.acquireDepth=null,this.acquireColor=null,this._name=i,this.fbo=r,this.acquireDepth=s,this.acquireColor=n}dispose(){this.fbo?.dispose()}get usedMemory(){return this.fbo?.usedMemory||0}get name(){return this._name}setName(e){this._name=e}getTexture(e=So.COLOR_ATTACHMENT0){return e===YO?this.fbo?.depthStencilTexture:this.fbo?.getColorTexture(e)}getAttachment(e=So.COLOR_ATTACHMENT0){return e===YO?this._depth:this._colors.get(e)}attachDepth(e){return e?.retain(),this.detachDepth(),e&&this.fbo?.attachDepthStencil(e.attachment),this._depth=e,this}detachDepth(){this.fbo?.detachDepthStencilTexture(),this.fbo?.detachDepthStencilBuffer(),this._depth=yi(this._depth)}obtainDepthTexture(){const e=this._depth;return _6t(e)?(this.fbo?.detachDepthStencilTexture(),this._depth=null,e):null}attachColor(e,i){return e.retain(),this.detachColor(i),this.fbo?.attachColorTexture(e.attachment,i),this._colors.set(i,e),this}detachColor(e){this.fbo?.detachColorTexture(e);const i=this._colors.get(e);this._colors.delete(e),i?.release()}detachAll(){this._colors.forEach((e,i)=>this.detachColor(i)),this.detachDepth()}},KZ=class{constructor(e,i){this._last=new ci,this._incarnation=0,this._cache=new x4(e,i)}destroy(){this._last?.forAll(e=>e.dispose()),this._last=null,this._cache.destroy()}set interactive(e){e&&!this._last?this._last=new ci:e||(this._last?.forAll(i=>i.dispose()),this._last=null)}clean(){this._last?.filterInPlace(e=>!(e.incarnation<this._incarnation)||(this._cache.put(e.key,e),!1))}frame(){++this._incarnation}pop(e){if(this._last){const i=this._last.find(r=>r.key===e);if(i)return this._last.removeUnordered(i),i}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){return this._last?.reduce((e,i)=>e+i.usedMemory,0)??0}},v6t=class{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new KZ(e.newCache,"FBOCache"),this._depthCache=new KZ(e.newCache,"DepthAttachmentCache"),this._colorCache=new KZ(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback&&this.debugCallback()}frameEnd(){const e=this.debugCallback;e&&this._acquired.forEach(i=>i.type===fI.FBO&&e(i.name,i.fbo))}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,i)=>e+("getTexture"in i?i.getTexture()?.usedMemory??0:i.usedMemory),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,i,r,s=xs.RGBA){const n=eJ(s,e,i);let o=this._cache.pop(n);if(o){o.retain(),o.setName(r);const a=this.rctx.getBoundFramebufferObject();this.rctx.bindFramebuffer(o.fbo),this.rctx.setDrawBuffers([So.COLOR_ATTACHMENT0]),this.rctx.bindFramebuffer(a)}else o=new Rje(n,r,new z0(this.rctx,{...kTe[s],width:e,height:i}),a=>{a??=pa.DEPTH_STENCIL_TEXTURE;const l=this._acquireDepth(a,o.fbo.width,o.fbo.height,`${o.name} depth`);return o.attachDepth(l),l.release(),o},(a,l)=>{l??=xs.RGBA;const c=this._acquireColor(l,e,i,`${o.name} color ${a}`);return o.attachColor(c,a),c.release(),o},()=>{this.debugCallback&&this.debugCallback(o.name,o.fbo),this._acquired.delete(o),o.detachAll(),this._cache.put(o)});return this._trackHandle(o)}acquireDepth(e,i,r,s){return this._acquireDepth(e,i,r,s)}_acquireDepth(e,i,r,s){const n=eJ(e,i,r),o=this._depthCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=e===pa.DEPTH_STENCIL_TEXTURE?new FTe(n,new Gr(this.rctx,{...UTe[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)}):new FTe(n,new wFe(this.rctx,{...UTe[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)});return a.name=s,this._trackHandle(a)}_acquireColor(e,i,r,s){const n=eJ(e,i,r),o=this._colorCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=new y6t(n,new Gr(this.rctx,{...kTe[e],width:i,height:r}),()=>{this._acquired.delete(a),this._colorCache.put(a)});return a.name=s,this._trackHandle(a)}_trackHandle(e){return this._acquired.add(e),e}};const QF=new Rje("default","default",null,()=>QF,()=>QF,()=>{});function eJ(t,e,i){return`${t}x${e}x${i}`}const HG=new fs;HG.pixelFormat=Xt.RED,HG.internalFormat=Ct.R8,HG.wrapMode=Di.CLAMP_TO_EDGE;const qG=new fs;qG.pixelFormat=Xt.RG,qG.internalFormat=Ct.RG8,qG.wrapMode=Di.CLAMP_TO_EDGE;const WG=new fs;WG.internalFormat=Ct.RGBA4,WG.dataType=cc.UNSIGNED_SHORT_4_4_4_4,WG.wrapMode=Di.CLAMP_TO_EDGE;const Pje=new fs;Pje.wrapMode=Di.CLAMP_TO_EDGE;const PL=new fs;PL.wrapMode=Di.CLAMP_TO_EDGE,PL.samplingMode=_i.LINEAR_MIPMAP_LINEAR,PL.hasMipmap=!0,PL.maxAnisotropy=8;const OL=new fs;OL.pixelFormat=Xt.RED,OL.dataType=cc.HALF_FLOAT,OL.internalFormat=Ct.R16F,OL.samplingMode=_i.NEAREST;const YG=new fs;YG.dataType=cc.HALF_FLOAT,YG.internalFormat=Ct.RGBA16F,YG.samplingMode=_i.NEAREST;const kTe={[xs.RED]:HG,[xs.RG]:qG,[xs.RGBA4]:WG,[xs.RGBA]:Pje,[xs.RGBA_MIPMAP]:PL,[xs.R16F]:OL,[xs.RGBA16F]:YG},IL=new fs;IL.pixelFormat=Xt.DEPTH_STENCIL,IL.dataType=cc.UNSIGNED_INT_24_8,IL.samplingMode=_i.NEAREST,IL.wrapMode=Di.CLAMP_TO_EDGE;const UTe={[pa.DEPTH_STENCIL_TEXTURE]:IL,[pa.DEPTH16_BUFFER]:new bFe(dl.DEPTH_COMPONENT16,4)};var KF;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(KF||(KF={}));let f_=class{constructor(e,i,r=KF.FrontToBack){this._rctx=e,this._techniques=i,this._sorting=r,this._draws=new ci({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,s){const n=this._draws.pushNew();n.geometry=i,n.geometryRanges=r,n.material=e,n.depthSquaredHint=s,n.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0}prepare(e,i){return this._draws.map(r=>r.material.prepareTechnique(this._techniques,e,i,r.geometry.parameters))}dispatch(e,i,r){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=r[a];l===n&&l.configuration.transparencyPassType===mt.NONE||(s.bindTechnique(l,i,e),n=l);const c=this._draws.data[a],u=c.geometry;s.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,i,e),this._previouslyBoundDraw.set(l,c.material));const h=c.geometryRanges,p=h.length;if(c.indexType!==0){const f=XG.get(c.indexType);for(let g=0;g<p;g+=2){const y=h[g],v=h[g+1];s.drawElements(u.primitiveType,v,c.indexType,y*f)}}else for(let f=0;f<p;f+=2){const g=h[f],y=h[f+1];s.drawArrays(u.primitiveType,g,y)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===KF.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=e*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.byteSize-r.geometry.vao.byteSize})}get count(){return this._draws.length}};const XG=new Map;XG.set(At.UNSIGNED_BYTE,1),XG.set(At.UNSIGNED_SHORT,2),XG.set(At.UNSIGNED_INT,4);let Rne=class extends Cvt{constructor(){super({}),this._passes=null,this.produces=new Map([[Ce.OPAQUE_MATERIAL,e=>this._produces(e)],[Ce.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[Ce.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new FCt,this._shadowPassParameters=new kCt,this._highlightPassParameters=new UCt,this._viewshedPassParameters=new BCt,this._systems=new Set}initializeRenderContext(e){this._context=e;const i=e.renderContext.rctx,r=e.techniques;this._passes={materialOpaque:new f_(i,r),materialTransparent:new f_(i,r,KF.BackToFront),materialIntegratedMesh:new f_(i,r),shadowMap:new f_(i,r),highlight:new f_(i,r),highlightIntegratedMesh:new f_(i,r),highlightShadowMap:new f_(i,r),viewshedShadowMap:new f_(i,r),defaultShadowMap:new f_(i,r)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return this._systems.size!==0&&this._passes!==null&&(e===G.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==G.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!==null){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,e.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this._context.techniques.frameUpdate()}}prepareTechniques(e){if(this._systems.size===0)return null;const i=e.output===G.Shadow||e.output===G.ShadowHighlight||e.output===G.ShadowExcludeHighlight?this._shadowPassParameters:e.output===G.ViewshedShadow?this._viewshedPassParameters:e.output===G.Highlight?this._highlightPassParameters:this._materialPassParameters,r=e.bindParameters;return this._updateParameters(r.camera,i,r.slot===Ce.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,(s,n)=>s.prepare(n,e.bindParameters))}renderNode(e,i){this._invoke(e,(r,s)=>r.dispatch(s,e.bindParameters,i))}_invoke(e,i){if(this._passes===null)return null;switch(e.bindParameters.slot){case Ce.OPAQUE_MATERIAL:switch(e.output){case G.Color:case G.Depth:case G.Normal:case G.ObjectAndLayerIdColor:return i(this._passes.materialOpaque,this._materialPassParameters);case G.Highlight:return i(this._passes.highlight,this._highlightPassParameters);case G.Shadow:return i(this._passes.shadowMap,this._shadowPassParameters);case G.ShadowHighlight:return i(this._passes.highlightShadowMap,this._shadowPassParameters);case G.ShadowExcludeHighlight:return i(this._passes.defaultShadowMap,this._shadowPassParameters);case G.ViewshedShadow:return i(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;case Ce.TRANSPARENT_MATERIAL:switch(e.output){case G.Color:case G.Depth:case G.Normal:case G.ObjectAndLayerIdColor:return i(this._passes.materialTransparent,this._materialPassParameters)}break;case Ce.INTEGRATED_MESH:switch(e.output){case G.Color:case G.Depth:case G.Normal:case G.ObjectAndLayerIdColor:return i(this._passes.materialIntegratedMesh,this._materialPassParameters);case G.Highlight:return i(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const i=new wpe;return this._systems.forEach(r=>pI(i,r.queryShadowCasterDepthRange(e))),i}_updateParameters(e,i,r){const s=e.viewInverseTransposeMatrix;ue(tJ,s[3],s[7],s[11]),iJ.set(tJ),ge(i.transformWorldFromViewTH,iJ.high),ge(i.transformWorldFromViewTL,iJ.low),ge(i.slicePlaneLocalOrigin,tJ),vf(i.transformViewFromCameraRelativeRS,e.viewMatrix),Xn(i.transformProjFromView,e.projectionMatrix),i.identifier===kc.Material&&(this._materialPassParameters.transparent=r,xC(BTe,i.transformViewFromCameraRelativeRS),Gk(i.transformNormalViewFromGlobal,BTe))}};Rne=d([N("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],Rne);const tJ=M(),BTe=ps(),iJ=new Y6e;function jB(t){return t.name}let b6t=class{constructor(e){this._context=e,this._nodes=new ci}destroy(){this._nodes.forEach(e=>e.destroy()),this._nodes.clear()}add(e){this._nodes.push(e),Qj&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}remove(e){this._nodes.remove(e),Qj&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}produces(e){return this._nodes.some(({produces:i})=>i===e)}require(e,...i){const r=this._nodes;return i.reduce((s,n)=>s+r.reduce((o,{consumes:a,produces:l})=>o+(a.required.includes(e)&&l===n?1:0),0),0)}optional(e,...i){const r=this._nodes;return i.reduce((s,n)=>s+r.reduce((o,{consumes:a,produces:l})=>o+(a.optional?.includes(e)&&l===n?1:0),0),0)}updateAnimation(){return this._nodes.reduce((e,i)=>i.updateAnimation()||e,!1)}render(e,i,r=()=>{}){const s=jB(e)?e.name:e,n=this._nodes.filter(({produces:o})=>o===s);return n.length===0||(n.forEach(o=>{const a=jB(e)?[e]:[];for(const l of o.consumes.required){if(l===s)continue;const c=i.get(l);if(!c)return void(r&&r(a));a.push(c)}if(o.consumes.optional)for(const l of o.consumes.optional){if(l===s)continue;const c=i.get(l);c&&a.push(c)}try{const l=o.doRender(a,this._context);l&&l!==e&&(jB(e)?(e.release(),e=l,i.set(s,e)):e=l)}catch(l){oe.getLogger(o).errorOnce(l)}r&&r(a)}),this._context.rctx.enforceState()),jB(e)?e:QF}},w6t=class{constructor(e){this._context=e,this._renderPlugins=new ci,this._materialRenderers=new Map,this._slots=new Array,this._renderVersion=s0(0);for(let i=0;i<Ce.MAX_SLOTS;++i)this._slots[i]=[]}destroy(){this._renderPlugins.forEach(e=>e.destroy()),this._renderPlugins.clear(),this._materialRenderers.clear()}get plugins(){return this._renderPlugins}add(e,i){const r=()=>{if(i?.aborted)throw e.uninitializeRenderContext(),Yi();this._renderPlugins.push(e),e.materialReference&&this._materialRenderers.set(e.materialReference,e),e.produces.forEach((n,o)=>{this._slots[o].push(e)}),this._context.requestRender(),this._renderVersion.value++},s=e.initializeRenderContext(this._context,i);if(Lh(s))return s.then(r);r()}remove(e){if(e.materialReference!=null&&this._materialRenderers.delete(e.materialReference),this._renderPlugins.removeUnordered(e)!=null){for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);e.uninitializeRenderContext(),this._context.requestRender(),this._renderVersion.value++}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(e)||i)}),i}renderFeatureChanged(){this._renderPlugins.forAll(e=>{e.renderFeatureChanged&&e.renderFeatureChanged()})}prepare(...e){for(const i of e)this._context.renderContext.bindParameters.slot=i,this._slots[i].forEach(r=>{r.produces.get(i)?.(G.Color)&&(zre(r)&&r.prepareTechnique(this._context.renderContext),K_e(r)&&r.prepareTechniques(this._context.renderContext))})}_getRenderables(){const e=this._context.renderContext.bindParameters.slot,i=this._context.renderContext.output??G.Color,r=new Map;return this._slots[e].forEach(s=>{if(s.produces.get(e)?.(i)&&(!s.isDecoration||this._context.renderContext.bindParameters.decorations!==Gc.OFF))if(zre(s)){const o=s.prepareTechnique(this._context.renderContext);o!=null&&r.set(s,o)}else if(K_e(s)){const o=s.prepareTechniques(this._context.renderContext);o!=null&&r.set(s,o)}else r.set(s,null)}),r}render(e,...i){for(const r of i)this._context.renderContext.bindParameters.slot=r,this._getRenderables().forEach((s,n)=>n.renderNode(this._context.renderContext,s,e))}queryDepthRange(e){const i=new wpe;return this._renderPlugins.forAll(r=>{const s=r.queryDepthRange?.(e);pI(i,s)}),i}get updating(){return this._renderVersion.value>=0&&this._renderPlugins.some(e=>e.running)}produces(e,...i){for(const r of i)if(this._slots[r].some(s=>{const n=s.produces.get(r);return!!n&&n(e)}))return!0;return!1}consumes(e){return this._renderPlugins.some(i=>i.consumes().required.includes(e))}getMaterialRenderer(e){return this._materialRenderers.get(e)}removeEmptyMaterialRenderers(){this._renderPlugins.filterInPlace(e=>!e.materialReference||e.numGeometries!==0||(this._materialRenderers.delete(e.materialReference),e.destroy(),!1))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get hasOccludees(){return this._renderPlugins.some(e=>e.hasOccludees)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|i.renderOccludedFlags,pr.None)}get usedMemory(){return this._renderPlugins.reduce((e,i)=>i.materialReference!==null?e:e+(i.usedMemory??0),0)}get test(){}},x6t=class{constructor(e){this.techniques=e,this._blitConfiguration=new VD,this._blitParameters=new Tpe}render(e,i,r,s,n){e.bindFramebuffer(r.fbo);const o=this.techniques.acquire(Epe,this._blitConfiguration);return e.setClearColor(0,0,0,1),e.clear(ss.COLOR_BUFFER_BIT),o?.compiled?(this._blitParameters.texture=i.getTexture(),e.bindTechnique(o,s,this._blitParameters),e.screen.draw(),o.release(),r):(n(vr.UPDATE),r)}},S6t=class{constructor(){this._step=GTe,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,ae("disable-feature:high-quality-idle"))this._dilation=1;else{const s=i?performance.now()-this._firstIdleTime:0;if(s>=zTe+E6t)return this._step=1/0,void(this._dilation=1);this._dilation=s>=zTe?C6t:1}const r=$e(e/T6t,GTe,A6t);this._step===1/0?this._step=r:this._step=this._step*VTe+r*(1-VTe)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const T6t=.5,zTe=12e4,E6t=1e4,C6t=10,VTe=.9,M6t=30,GTe=1e3/1,A6t=1e3/M6t;let R6t=class{constructor(e,i){this._fbos=e,this.compositingHelper=i,this._width=4,this._height=4,this._clearColor=pi()}dispose(){this._color=yi(this._color),this.releaseBuffers()}get framebuffer(){return this.color.attachDepth(this.depth),this.color.fbo}get colorTexture(){return this.color.getTexture()}get depthTexture(){return this.depth.attachment}initializeFrame(e,i,r){this._fbos.interactive=r===Am.Default;const s=this._fbos.rctx;this._width=e.fullWidth,this._height=e.fullHeight,D2(this,s.parameters.maxTextureSize);const n=this._color;return this._color=null,this.releaseBuffers(),Kp(this._clearColor,i),n}releaseBuffers(){this._color?.detachDepth(),this._depth=yi(this._depth)}renderHUDVisibility(e,i,r){return e?.fbo?.width===this._width&&e?.fbo?.height===this._height||(e?.release(),e=this._fbos.acquire(this._width,this._height,"hud visibility",xs.RGBA4)),e.attachDepth(r||this.depth),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(P6t),i(),e.detachDepth(),e}compositeToHUDVisibility(e,i){this._fbos.rctx.bindFramebuffer(e.hudVisibility?.fbo),this.compositingHelper.compositeHUD(e,i)}renderOITPass(e,i,r){let s,n;const{_width:o,_height:a}=this;switch(i){case mt.ColorAlpha:s=this._fbos.acquire(o,a,r?"oit hud color alpha":"oit color alpha",xs.RGBA16F),s.acquireColor(So.COLOR_ATTACHMENT1,xs.R16F),n=[0,0,0,1];break;case mt.FrontFace:s=this._fbos.acquire(o,a,r?"oit hud front":"oit front"),n=[0,0,0,0]}return r?s.acquireDepth(pa.DEPTH16_BUFFER):s.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.clearFramebuffer(n,r,r),e(),s.detachDepth(),s}compositeToFramebuffer(e,i,r,s){this.bindFbo(),this.compositingHelper.composite(e,i,r,s)}compositeOIT(e,i,r,s){s?(this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.setClearColor(0,0,0,1e-13),this._fbos.rctx.clear(ss.COLOR_BUFFER_BIT)):this.bindFbo(),this.compositingHelper.compositeOIT(e,i.getTexture(),i.getTexture(So.COLOR_ATTACHMENT1),r.getTexture())}renderDepthDetached(e){this._bindTarget(this.color),e(),this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,i,r,s,n=xs.RGBA,o=pa.DEPTH16_BUFFER,a=this._width,l=this._height,c=null){return e?.fbo?.width===a&&e?.fbo?.height===l||(e=yi(e)),e=e??this._fbos.acquire(a,l,i,n),c?.forEach(u=>e.acquireColor(u.attachment,u.format)),o!=null&&e.acquireDepth(o),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(s,!0,!0),r(),e}renderToTargets(e,i,r,s,n=!1,o=!1){this._bindTarget(i,r),this._fbos.rctx.clearFramebuffer(s,n,o),e(),i.detachDepth()}bindFbo(){const e=this._color==null;if(this._bindTarget(this.color,this.depth),e){const i=this._fbos.rctx;i.setClearStencil(0),i.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),i.clear(ss.COLOR_BUFFER_BIT|ss.DEPTH_BUFFER_BIT|ss.STENCIL_BUFFER_BIT)}}_bindTarget(e,i){e.attachDepth(i),this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._ensureColor()}_ensureColor(){return this._color||(this._color=this._fbos.acquire(this._width,this._height,"composite-color")),this._color}updateColor(e){const i=this._ensureColor();i.attachDepth(this.depth),this._color=e(i)}get depth(){return this._depth||(this._depth=this._fbos.acquireDepth(pa.DEPTH_STENCIL_TEXTURE,this._width,this._height,"depth")),this._depth}};const P6t=[0,1,0,1];let O6t=class{constructor(){this._inputs=new Map}set(e,i){this._inputs.set(e,i)}get(e){return this._inputs.get(e)}has(e){return this._inputs.has(e)}release(e){this._inputs.get(e)?.release()&&this._inputs.delete(e)}};const P7=255,I6t=1/P7;function $6t(t){const e=new tr,i=e.fragment;return i.include(Cg),i.include(N0),e.include(d4),e.include(Rl),e.include(m4,t),i.uniforms.add(new Et("shadowMap",(r,s)=>s.shadowMap.depthTexture),new Et("depthMap",(r,s)=>s.depth?.attachment),new Ps("inverseViewMatrix",(r,s)=>Ao(jTe,ac(jTe,s.camera.viewMatrix,s.camera.center)))),i.constants.add("sampleValue","float",I6t),e.outputs.add("sampleCount","float"),i.code.add(T`void main(void) {
float depth = depthFromTexture(depthMap, uv);
if (depth >= 1.0 || depth <= 0.0) {
discard;
}
float currentPixelDepth = linearizeDepth(depth);
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`),e}const jTe=Ne(),N6t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:P7,build:$6t},Symbol.toStringTag,{value:"Module"}));var mI;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(mI||(mI={}));let Pne=class extends Zc{constructor(){super(...arguments),this.visualization=mI.Gradient,this.bandsEnabled=!1}};d([V({count:mI.COUNT})],Pne.prototype,"visualization",void 0),d([V()],Pne.prototype,"bandsEnabled",void 0);let Oje=class extends is{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=Bk(L6t),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const L6t=ni(.01,0,.25,1);function D6t(t){const e=new tr,i=e.fragment;i.include(Cg),i.include(Lue),e.include(d4),e.include(Rl);const{visualization:r,bandsEnabled:s}=t;i.constants.add("inverseSampleValue","float",P7),i.uniforms.add(new Et("shadowCastMap",a=>a.shadowCastMap),new et("sampleScale",a=>a.sampleScale),new et("opacityFromElevation",a=>a.opacityFromElevation),new Ki("uColor",a=>a.color));const n=r===mI.Gradient,o=r===mI.Threshold;return n&&s?i.uniforms.add(new et("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new et("threshold",a=>a.threshold)),i.code.add(T`
    void main(void) {
      float record = texture(shadowCastMap, uv).r;
      float pixelSamples = record * inverseSampleValue;
      if (pixelSamples < 1.0) {
        discard;
      }

      float strength = pixelSamples * sampleScale;

      ${o?T`
          if (strength <= threshold) {
            discard;
          }`:""}

      ${n&&s?T`strength = ceil(strength / bandSize) * bandSize;`:""}

      fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?T`* strength`:""});
    }
  `),e}const F6t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:Oje,build:D6t},Symbol.toStringTag,{value:"Module"}));let Ije=class $je extends hr{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new dr(e.rctx,$je.shader.get().build(this.configuration),Fi)}initializePipeline(){return ti({blending:Ch,colorWrite:fi,depthTest:null,depthWrite:null})}get primitiveType(){return Li.TRIANGLE_STRIP}};Ije.shader=new ir(F6t,()=>ye(()=>import("./ShadowCastVisualize.glsl-8e574168.js"),[],import.meta.url));const k6t=4e4,U6t=5e4,Nje=1/512;let ZG=class extends Fe{constructor(e,i,r,s){super({}),this._techniques=e,this._rctx=i,this._data=r,this._requestRender=s,this._passParameters=new Oje(this._data),this._techniqueConfig=new Pne,this._enabled=!1,this._vao=U0(i)}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=jt(this._vao),this._techniques.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniques.releaseAndAcquire(Ije,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const i=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(i,e,this._passParameters),this._rctx.drawArrays(i.primitiveType,0,Pv(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>Nje}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniques.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniques.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const i=this._passParameters.color;RP(e,i)||(Kp(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};d([m()],ZG.prototype,"opacityFromElevation",null),ZG=d([N("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],ZG);let Lje=class Dje extends hr{constructor(e){super(e,new Spe,()=>this.destroy())}initializeProgram(e){return new dr(e.rctx,Dje.shader.get().build(this.configuration),Fi)}initializePipeline(){return ti({blending:Za(ke.ONE,ke.ONE,ke.ONE,ke.ONE),colorWrite:fi,depthTest:null,depthWrite:null})}get primitiveType(){return Li.TRIANGLE_STRIP}};Lje.shader=new ir(N6t,()=>ye(()=>import("./ShadowCastAccumulate.glsl-1995d2f8.js"),[],import.meta.url));let gu=class extends Fe{constructor(e,i,r,s,n,o){super({}),this.fbos=e,this._stage=r,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new rde,this._cachedLightDirections=[],this._depthRange=wne,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new A9(new xde(e,r.viewingMode),null),this._bindParameters.shadowMap.enabled=!0,this._vao=U0(this._rctx),this._accumulationRenderer=new ZG(i,this._rctx,this,o);const a=this._stage.view.resourceController.scheduler;this.addHandles([a.registerTask(Ut.SHADOW_ACCUMULATOR,this),_e(()=>r.renderView,l=>{this.removeHandles(HTe),l!=null&&this.addHandles(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),HTe)},Sr),_e(()=>this._previewing,()=>this._requestRenderIfEnabled(),Mr)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=jt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=jt(this._fbo),this._vao=jt(this._vao),this._accumulationTechniqueCached=yi(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new Lje(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._bindParameters.depth!=null&&this._depthRange!==wne&&this._opacityFromElevation>Nje}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const i=this._cachedLightDirections;if(qw(i,e,NE))return;const r=Math.min(P7,e.length);i.length=r,this._sampleCount=r;for(let s=0;s<r;++s)i[s]=ge(i[s]??M(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,i,r,s){if(this._depthRange=i,this._updateCamera(r),this._bindParameters.contentCamera=s,this._bindParameters.depth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return!1;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(B6t,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();return this._cameraForcedForScreenshot=!1,this._requestRender(),n>0}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const i=this._fbo!=null;e.enabled!==i&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||i<0||i>=this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,Xt.RGBA,cc.UNSIGNED_BYTE,qTe),qTe[0]/this._progress)}_enable(){this._progress=0;const e=new fs;e.pixelFormat=Xt.RED,e.internalFormat=Ct.R8,e.wrapMode=Di.CLAMP_TO_EDGE,this._fbo=new z0(this._rctx,e),this._requestRender()}_disable(){this._fbo=jt(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clear(ss.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,Pv(this._vao,"geometry"))}_updateCamera(e){const i=this._fbo;if(i==null)return;const r=this._bindParameters.camera;e.equals(r)||r.copyFrom(e),i.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-uF(k6t,U6t,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};d([m()],gu.prototype,"_progress",void 0),d([m()],gu.prototype,"_sampleCount",void 0),d([m()],gu.prototype,"_fbo",void 0),d([m()],gu.prototype,"_depthRange",void 0),d([m()],gu.prototype,"_previewing",void 0),d([m()],gu.prototype,"_accumulationRenderer",void 0),d([m()],gu.prototype,"_isRefining",null),d([m()],gu.prototype,"_isActive",null),d([m()],gu.prototype,"canAccumulate",null),d([m()],gu.prototype,"_isDoneAccumulating",null),d([m()],gu.prototype,"_opacityFromElevation",null),d([m()],gu.prototype,"running",null),gu=d([N("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],gu);const B6t=6,HTe="renderView",qTe=new Uint8Array(4),WTe=i1();let z6t=class{constructor(){this._plane=i1()}get isEnabled(){return!y3e(this.plane,WTe)}get plane(){return this._plane}set plane(e){bC(e||WTe,this._plane)}},kb=class extends Kr{constructor(){super(...arguments),this.sectionAngles=pi()}get sectionAnglesDeg(){return bF(this.sectionAngles.map(e=>El(e)))}set sectionAnglesDeg(e){this.sectionAngles=bF(e.map(i=>Gt(i)))}get projectionMatrix(){const e=Ne();return pF(e,this.sectionMatrix,this._projectionMatrixInternal)}get sectionMatrix(){const e=this.sectionAngles[0],i=this.sectionAngles[1],r=this.sectionAngles[2],s=this.sectionAngles[3];Tt(e<=i),Tt(r<=s);const n=2*Math.tan(this.fovX/2),o=2*Math.tan(this.fovY/2),a=Math.tan(e),l=Math.tan(i),c=Math.tan(r),u=l-a,h=Math.tan(s)-c,p=n/u,f=o/h,g=-(a+u/2)/n*2,y=-(c+h/2)/o*2,v=Ne();mC(v,[g,y,0]);const b=Ne();$Pe(b,[p,f,1]);const w=Ne();return pF(w,b,v)}get _sectionRatioX(){const e=Math.tan(this.sectionAngles[0]),i=Math.tan(this.sectionAngles[1]),r=2*Math.tan(this.fovX/2);return Math.min(1,(i-e)/r)}setViewport(e,i){const r=i*this._sectionRatioX;return this.viewport=[e[0],e[1],r,i],r}};d([m()],kb.prototype,"sectionAngles",void 0),d([m()],kb.prototype,"sectionAnglesDeg",null),d([m()],kb.prototype,"projectionMatrix",null),d([m()],kb.prototype,"sectionMatrix",null),d([m()],kb.prototype,"_sectionRatioX",null),kb=d([N("esri.views.3d.webgl-engine.lib.ViewshedFaceCamera")],kb);let V6t=class{constructor(){this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.textureSizeMultiple=128,this.toleranceSides=5,this.toleranceBottomTop=10}textureSizeModifier(e){return e?this.textureSizeModHighQuality:this.textureSizeModLowQuality}textureResizeModulo(e){return Math.ceil(e/this.textureSizeMultiple)*this.textureSizeMultiple}};const rJ=["front","left","right","back","top","bottom"];function G6t(t){return!["top","bottom"].includes(t)}let j6t=class{constructor(e){this._fbos=e,this._enabled=!1,this._faces={},this._textureWidth=0,this._textureHeight=0,this.settings=new V6t,this._maxTextureWidth=Math.min(ae("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}get depthTexture(){return this._handle?.getTexture()}get enabled(){return this._enabled}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get isTextureZero(){return this._textureWidth===0||this._textureHeight===0}get nearFar(){const e=this.faces;return e.length===0?null:e[0].nearFar}get numActiveFaces(){const e=this._faces;let i=0;return Object.keys(e).forEach(r=>{e[r]&&(i+=1)}),i}get faces(){const e=this._faces,i=[];for(const r of rJ){const s=e[r];s&&i.push(s)}return i}get atlasRegions(){return this.faces.map(e=>[e.x/this._textureWidth,(e.x+e.width)/this._textureWidth,e.y/this._textureHeight,(e.y+e.height)/this._textureHeight])}get viewshedProjectionMatrices(){return this.faces.map(e=>e.projectionMatrix)}get viewshedViewMatrices(){return this.faces.map(e=>e.viewMatrix)}_setupFaceCamera(e,i,r,s){const{observerRenderSpace:n,tiltedUpVector:o,targetRenderSpace:a,farDistanceRenderSpace:l,horizontalFieldOfView:c,verticalFieldOfView:u}=i,h=M();Vi(h,a,n);const p=M(),f=M(),g=(F,D)=>{const z=M(),B=Ne();return Ph(B,F,D),nt(z,h,B),Te(z,n,z),z};let y,v=o;const b=Math.min(90,c),w=Math.min(90,Math.max(0,(c-90)/2));let x=-45,S=45,E=-45,C=45;if(G6t(e)){const F=D=>$e(D,-45,45);E=F(-u/2)-this.settings.toleranceBottomTop,C=F(+u/2)+this.settings.toleranceBottomTop}switch(e){case"front":y=a,x=-b/2,S=b/2;break;case"left":y=g(Math.PI/2,o),x=45-w;break;case"right":y=g(-Math.PI/2,o),S=-45+w;break;case"top":y=Te(p,n,o),v=Ha(f,h);break;case"bottom":y=Vi(p,n,o),v=h;break;case"back":y=g(Math.PI,o)}const R=new kb({center:y,eye:n,up:v,far:l});R.sectionAnglesDeg=[x-this.settings.toleranceSides,S+this.settings.toleranceSides,E,C],R.fovY=Math.PI/2;const I=R.setViewport(r,s);return this._faces[e]=R,I}_bindFBO(){const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._handle?.fbo)}_computeActiveFaces(e){const i=new Set,{horizontalFieldOfView:r,verticalFieldOfView:s}=e,n=-s/2,o=s/2;return r===0||s===0||(n<=45&&o>=-45&&i.add("front"),r>90&&(i.add("left"),i.add("right")),r>270&&i.add("back"),o>45-this.settings.toleranceBottomTop&&i.add("top"),n<-45+this.settings.toleranceBottomTop&&i.add("bottom")),i}_computeBaseTextureSize(e,i,r,s){const n=Math.min(window.devicePixelRatio,i)/e.pixelRatio,o=this.settings.textureSizeModifier(r),a=Fw(Math.floor(Math.max(e.fullWidth,e.fullHeight)*n*o)),l=Math.floor(this._maxTextureWidth/s),c=Math.min(l,a);return iFe(c)}_ensureFBO(){const e=this._textureWidth,i=this._textureHeight;this._handle?.fbo?.width===e&&this._handle?.fbo?.height===i||(this._handle?.release(),this._handle=this._fbos.acquire(e,i,"viewshed shadow map",xs.RGBA4)),this._handle.acquireDepth(pa.DEPTH16_BUFFER)}clearFBO(){const e=this._fbos.rctx;this._ensureFBO(),this._bindFBO(),e.setClearColor(1,1,1,1),e.clear(ss.COLOR_BUFFER_BIT|ss.DEPTH_BUFFER_BIT)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._handle=yi(this._handle)}start(e,i,r,s){if(this._faces={},!this.enabled)return!1;const n=this._computeActiveFaces(i),o=n.size;if(o===0)return!1;const a=this._computeBaseTextureSize(e,s,r,o);if(a===0)return!1;let l=0,c=0,u=0;return rJ.filter(h=>n.has(h)).forEach(h=>{const p=H6t(h,o);p>c&&(u=Math.max(u,l),l=0),c=p;const f=p*a;l+=this._setupFaceCamera(h,i,[l,f],a)}),u=Math.max(u,l),this._textureWidth=this.settings.textureResizeModulo(u),this._textureHeight=q6t(o)*a,this.clearFBO(),!0}finish(){this._handle?.detachDepth()}get test(){return{faces:this._faces,faceTypes:rJ}}};function H6t(t,e){if(e<4)return 0;const i=t==="front"||t==="left";return e===4?i?0:1:i||t==="right"?0:1}function q6t(t){return t<4?1:2}let W6t=class extends is{constructor(){super(...arguments),this.localOrigin=Gle()}};function Y6t(t){t.include(d4),t.fragment.uniforms.add(new Ps("inverseViewMatrix",(e,i)=>{const r=Ne();return ac(r,i.camera.viewMatrix,e.localOrigin),Ox(r,r)})),t.fragment.code.add(T`vec4 reconstructLocalPosition(vec2 coord, float linearDepth) {
vec4 cameraSpace = vec4(reconstructPosition(coord, linearDepth), 1.0);
return inverseViewMatrix * cameraSpace;
}`)}let Fje=class extends W6t{constructor(){super(...arguments),this.targetVector=[1,0,0],this.upVector=[0,0,1],this.fovs=[45,45],this.headingAndTilt=[0,0],this.shadowMap={depthTexture:null,nearFar:[1,100],numActiveFaces:1,atlasRegions:[[0,0,1,1]]},this.projectionMatrices=us.flat(),this.viewMatrices=us.flat()}};function X6t(t){const e=new tr,i=e.fragment;e.include(Rl),e.include(Y6t),e.include(zue),i.include(N0),i.include(ede),i.uniforms.add(new Et("depthTexture",(s,n)=>n.depth?.attachment)),i.uniforms.add(new Ps("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Ps("inverseViewNormalMatrix",(s,n)=>Ox(Z6t,n.camera.viewInverseTransposeMatrix))),i.uniforms.add(new Qt("viewshedTargetVector",(s,n)=>s.targetVector),new Qt("viewshedUpVector",(s,n)=>s.upVector),new os("viewshedFOVs",(s,n)=>s.fovs),new os("viewshedHeadingAndTilt",(s,n)=>s.headingAndTilt),new os("viewshedNearFar",(s,n)=>s.shadowMap.nearFar??[1,100])),i.uniforms.add(new Et("viewshedShadowMap",s=>s.shadowMap.depthTexture),new pse("viewshedProjectionMatrices",(s,n)=>s.projectionMatrices,6),new pse("viewshedViewMatrices",(s,n)=>s.viewMatrices,6),new KI("viewshedNumFaces",(s,n)=>s.shadowMap.numActiveFaces),new jc("viewshedAtlasRegions",(s,n)=>s.shadowMap.atlasRegions.flat(),24)),i.constants.add("visibleColor","vec4",[0,1,0,.5]),i.constants.add("occludedColor","vec4",[1,0,0,.5]);const r=t.useNormalMap;return r?(i.uniforms.add(new Et("normalMap",(s,n)=>s.normalTexture)),i.code.add(T`vec3 normalFromTexture() {
vec4 norm4 = texture(normalMap, uv);
vec3 nNormal = vec3(-1.0) + 2.0 * norm4.xyz;
return normalize((inverseViewNormalMatrix * vec4(nNormal, 1.0)).xyz);
}`)):e.include(lje),i.code.add(T`
    // UV coordinates of point projected onto viewshed shadow map
    vec2 getViewshedUv(vec4 worldPosition, int face) {
      mat4 viewshedMatrix = viewshedProjectionMatrices[face];
      vec4 viewshedUv4 = viewshedMatrix * worldPosition;
      vec3 viewshedUv = viewshedUv4.xyz / viewshedUv4.w;
      return viewshedUv.xy;
    }

    float viewshedDepthToFloat(float depth) {
      return (depth - viewshedNearFar[0]) / (viewshedNearFar[1] - viewshedNearFar[0]);
    }

    // Orthographic depth to viewshed of given point and given cube map face in range [0, 1].
    float getOrthographicDepthToViewshed(vec4 worldPosition, int face) {
      mat4 viewshedViewMatrix = viewshedViewMatrices[face];
      vec4 viewshedUv4 = viewshedViewMatrix * worldPosition;
      vec3 viewshedUv = viewshedUv4.xyz / viewshedUv4.w;
      float depth = -viewshedUv.z;
      return viewshedDepthToFloat(depth);
    }

    // Read depth from shadow map given uv and cube map face
    float getDepthFromShadowMap(vec2 uv, int face) {
      int index = 4 * face;

      float umin = viewshedAtlasRegions[index];
      float umax = viewshedAtlasRegions[index + 1];
      float vmin = viewshedAtlasRegions[index + 2];
      float vmax = viewshedAtlasRegions[index + 3];

      vec4 atlasRegion = vec4(umin, vmin, umax, vmax);
      return rgba4ToFloat(textureAtlasLookup(viewshedShadowMap, uv, atlasRegion));
    }

    struct ViewshedPoint {
      int face;
      vec2 uv;
      bool isWithin;
      float orthographicDepth;
    };

    // Find cube map face the given position lies in and return relevant information about it
    bool getViewshedPoint(vec4 worldPosition, out ViewshedPoint point) {
      vec3 nUp = normalize(viewshedUpVector);

      // Try with all active cube map faces
      for(int i=0; i < viewshedNumFaces; i++) {

        // Check if when projected, point lies within shadow map texture
        vec2 viewshedUv = getViewshedUv(worldPosition, i);
        if (viewshedUv.x > 0.0 && viewshedUv.x < 1.0 && viewshedUv.y > 0.0 && viewshedUv.y < 1.0) {
          float orthoDepth = getOrthographicDepthToViewshed(worldPosition, i);
          if (orthoDepth >= 0.0) { // found a cube map face

            // Check whether point is really inside viewshed geometry, not just within the camera frustum

            // outside farDistance
            vec3 position = worldPosition.xyz;
            bool isWithin = length(position) <= viewshedNearFar[1];

            // horizontally outside fov
            float t = dot(nUp, position);
            bool isBottomHalf = t > 0.0;
            vec3 nProjVector = normalize(position - t * nUp);
            if (isWithin) {
              float angle = acos(dot(normalize(viewshedTargetVector), nProjVector));
              if (angle > viewshedFOVs[0] / 2.0) {
                isWithin = false;
              }
            }

            // vertically outside fov
            if (isWithin) {
              float angle = acos(dot(nProjVector, normalize(position)));
              if (!isBottomHalf) {
                angle = -angle;
              }
              float tilt = viewshedHeadingAndTilt[1];
              float limit = viewshedFOVs[1] / 2.0;
              if (angle > limit || angle < -limit) {
                isWithin = false;
              }
            }

            point = ViewshedPoint(i, viewshedUv, isWithin, orthoDepth);
            return true;
          }
        }
      }

      // no cube face matches
      return false;
    }

    float normalCosAngle(float linearDepth, vec3 localPosition) {
      ${r?T`vec3 normal = normalFromTexture();`:T`
        vec3 cameraSpacePosition = reconstructPosition(gl_FragCoord.xy, linearDepth);
        vec3 normal = normalFromDepth(depthTexture, cameraSpacePosition, gl_FragCoord.xy, uv);
        normal = (inverseViewNormalMatrix * vec4(normal, 1.0)).xyz;
        `};

      vec3 viewingDir = normalize(localPosition);
      return dot(normal, viewingDir);
    }

    void main() {
      float depth = depthFromTexture(depthTexture, uv);

      // Outside camera planes
      if (depth >= 1.0 || depth <= 0.0) {
        return;
      }

      float linearDepth = linearizeDepth(depth);

      // Relative to viewshed position
      vec4 localPosition = reconstructLocalPosition(gl_FragCoord.xy, linearDepth);

      ViewshedPoint point;
      bool foundFace = getViewshedPoint(localPosition, point);

      // Outside every viewshed
      if (!foundFace || !point.isWithin) {
        return;
      }

      float viewshedDepth = getDepthFromShadowMap(point.uv, point.face);
      float distance = point.orthographicDepth;

      bool visible = distance < viewshedDepth;
      fragColor = visible ? visibleColor : occludedColor;

      float cosAngle = normalCosAngle(linearDepth, localPosition.xyz);

      // Everything facing away, and close to parallel is considered occluded.
      // Theshold corresponds to around 0.6 degrees, tuned empirically.
      if (cosAngle > -0.01) {
        fragColor = occludedColor;
      }
    }`),e}const Z6t=Ne(),J6t=Object.freeze(Object.defineProperty({__proto__:null,ViewshedPassParameters:Fje,build:X6t},Symbol.toStringTag,{value:"Module"}));let kje=class Uje extends hr{initializeProgram(e){return new dr(e.rctx,Uje.shader.get().build(this.configuration),Fi)}initializePipeline(){return ti({colorWrite:fi,blending:Ch})}};kje.shader=new ir(J6t,()=>ye(()=>import("./Viewshed.glsl-104e821a.js"),[],import.meta.url));let Bje=class extends Zc{constructor(){super(...arguments),this.useNormalMap=!0}};d([V()],Bje.prototype,"useNormalMap",void 0);let YT=class extends ahe{get viewshedShadowMap(){return this._viewshedShadowMap}get enabled(){return this._viewsheds.length>0}constructor(e,i){super(e),this._pluginContext=null,this.renderHighQuality=!1,this._parameters=new Fje,this._configuration=new Bje,this._viewsheds=new ct,this.produces=new Map([[Ce.VIEWSHED,()=>!0]]),this._renderShadowMap=i}initialize(){this.addHandles(_e(()=>this.view.qualitySettings.maximumPixelRatio,e=>this._maximumPixelRatio=e,Sr))}destroy(){this.uninitializeRenderContext()}consumes(){return this.enabled?ohe:k9}initializeRenderContext(e){this._pluginContext=e,this._viewshedShadowMap=new j6t(this.fboCache),this._viewshedShadowMap.enabled=!0}renderNode(e,i,r){const{bindParameters:s,rctx:n}=e;if(!this.enabled||!s.depth||r==null)return;const o=this._setupNormals(r);if(this._technique!=null&&this._configuration.useNormalMap===o||(this._configuration.useNormalMap=o,this._technique=this._pluginContext?.techniques.acquire(kje,this._configuration)),this._technique?.compiled)for(const a of this._viewsheds){const l=e.rctx.getBoundFramebufferObject(),c=this._renderViewshedShadowCubeMap(s,a),u=this._viewshedShadowMap;c&&u.depthTexture!=null&&!u.isTextureZero&&(this._setPassParameters(a),e.rctx.bindFramebuffer(l),n.bindTechnique(this._technique,s,this._parameters),n.screen.draw())}else this._pluginContext?.requestRender()}uninitializeRenderContext(){this._pluginContext=null,this._viewshedShadowMap.dispose(),this._technique=Ge(this._technique)}updateViewsheds(e){const i=e.removes;i!=null&&(ct.isCollection(i)?this._viewsheds.removeMany(i):this._viewsheds.remove(i));const r=e.adds;if(r!=null)if(ct.isCollection(r)){const s=r.filter(n=>!this._viewsheds.includes(n));this._viewsheds.addMany(s)}else this._viewsheds.includes(r)||this._viewsheds.add(r)}_renderViewshedShadowCubeMap(e,i){const r=this._viewshedShadowMap;if(!r.enabled)return!1;const s=r.start(e.camera,i,this.renderHighQuality,this._maximumPixelRatio);if(s)for(const n of r.faces)this._renderShadowMap(e,n,G.ViewshedShadow);return r.finish(),s}_setPassParameters(e){const i=this._parameters,r=this._viewshedShadowMap,s=e.observerRenderSpace;i.localOrigin=s,i.fovs=[Gt(e.horizontalFieldOfView),Gt(e.verticalFieldOfView)],i.headingAndTilt=[Gt(e.heading),Gt(e.tiltParallelToSurface)],i.upVector=e.tiltedUpVector;const n=Q6t(e.targetRenderSpace,s);i.targetVector=n,i.shadowMap=r;const o=[],a=[];for(let l=0;l<r.numActiveFaces;l++)ac(sJ,r.viewshedViewMatrices[l],s),o.push(...sJ.flat()),K6t(r.viewshedProjectionMatrices[l],sJ,YTe),a.push(...YTe.flat());i.viewMatrices=o,i.projectionMatrices=a}_setupNormals(e){const i=e.get("normals"),r=i?.getTexture();return this._parameters.normalTexture=r,r!=null}get test(){return{viewsheds:this._viewsheds}}};function Q6t(t,e){const i=M();return Vi(i,t,e)}function K6t(t,e,i){const r=Be(.5,.5,.5);return mC(i,r),$k(i,i,r),pF(i,i,t),pF(i,i,e),i}d([m()],YT.prototype,"_pluginContext",void 0),d([m()],YT.prototype,"fboCache",void 0),d([m()],YT.prototype,"view",void 0),d([m()],YT.prototype,"viewshedShadowMap",null),YT=d([N("esri.views.3d.webgl-engine.lib.Viewshed")],YT);const sJ=Ne(),YTe=Ne();let XTe=class{constructor(e,i,r,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},U_=!1;function ejt(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i?new XTe(()=>t.createQuery(),r=>{t.deleteQuery(r),U_=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{U_||(U_=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),U_=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new XTe(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),U_=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{U_||(U_=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),U_=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function tjt(t,e){const i=t.capabilities.disjointTimerQuery;return i==null?null:new ijt(i,e)}let ijt=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(r,null)})}start(){U_||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(i==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var sn;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.DEPTH="depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.NORMALS="normals",t.SSAO="SSAO",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.OPAQUE_ENVIRONMENT="opaque environment",t.TRANSPARENT_ENVIRONMENT="transparent environment",t.LASER_LINES="laser lines",t.VIEWSHED="viewshed",t.OCCLUDED="occluded",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(sn||(sn={}));const nJ=Object.values(dw).concat(Object.values(V2)).concat(Object.values(sn)),ZTe="Total";let rjt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new vv(ZTe),this._cpuTimeSamplers=new Map(nJ.map(i=>[i,new vv(i)])),this._enableGPUTimer=0,this._totalGPUTime=new vv("GPU"),this._gpuTimeSamplers=new Map(nJ.map(i=>[i,new vv(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const i=[...nJ,ZTe];this._gpuTimerPool=tjt(this._rctx,i)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=jt(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).record(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const i=this._gpuTimerPool.stop(sn.FINISH);this._gpuTimeSamplers.get(sn.FINISH).record(i),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}};class JG{constructor(e,i,r,s,n,o){this._stage=e,this._techniques=r,this._rctx=s,this._compositingHelper=n,this._requestRender=o,this._pluginsHas={hudElements:!1,water:!1},this._hasOverlayWater=!1,this.renderOverlay=a=>{},this._isRendering=!1,this._inGlobeView=!1,this._backgroundColor=ni(0,0,0,1),this._sliceHelper=new z6t,this._blit=null,this._state=s0(zi.IDLE),this._highQualityTransparencyEnabled=!0,this._terrainTransparency=Yl.Opaque,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new S6t,this._loadEdgeViewTask=null,this._edgeViewCallbacks=[],this._reprojectionMatrixVersion=s0(0),this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new O6t,this._releaseNormals=a=>{a.some(({name:l})=>l==="normals")&&this._pluginInput.release("normals")},this._debugNeedsDepth=!1,this.fboCache=new v6t(s),this._renderStateFeatures=s0(Dve(!ae("disable-feature:high-quality-idle"),e.view.qualityProfile)),this._offscreen=new R6t(this.fboCache,this._compositingHelper),this.performanceInfo=new rjt(this._rctx),this._shadowMap=new xde(this.fboCache,e.viewingMode),this._viewshed=new YT({fboCache:this.fboCache,view:e.view},(a,l,c)=>{l.setGLViewport(this._rctx);const{camera:u,contentCamera:h}=a;this._ensureBindParametersCamera(l,l),this._renderAllGeometry(c),this._ensureBindParametersCamera(u,h),a.camera.setGLViewport(this._rctx)}),this._shadowAccumulator=new gu(this.fboCache,r,e,a=>{const l=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(a.camera,a.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=l},(a,l,c)=>{const u=this._stage.view.qualitySettings.maximumPixelRatio;a.shadowMap.start(a.camera,l,c,!0,u),this._renderShadowCascades(G.Shadow,a.shadowMap),a.shadowMap.finish(),a.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(a.camera,a.contentCamera)},o),this._renderContext=new dAt(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper),this._nodes=new b6t(this._renderContext),this._plugins=new w6t({renderContext:this._renderContext,techniques:r,materials:i,requestRender:o,controller:e,fbos:this.fboCache,isFeatureEnabled:a=>this.isFeatureEnabled(a)}),this.renderPassManager=new Rne,this._plugins.add(this.renderPassManager),this._plugins.add(this._viewshed),this._handles=[_e(()=>this._stage.view.state.camera,()=>o(),Sr),_e(()=>ts.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,a=>{this._renderHiddenTransparentEdges=a?()=>this._renderEdges(Td.TRANSPARENT):()=>{},o()},Ir),_e(()=>this._stage.view.environment.background?.color,a=>{const l=a?MF(a):Ud;Ds(this._backgroundColor,l[0]*l[3],l[1]*l[3],l[2]*l[3],l[3]),o()},Sr),_e(()=>this._stage.view.state.camera.relativeElevation,a=>{this._inGlobeView=(a??1/0)>=O8},Sr)]}destroy(){this._handles.forEach(e=>e.remove()),this._gpuTimerHandle=Zr(this._gpuTimerHandle),this._nodes.destroy(),this._offscreen.dispose(),this._shadowMap.dispose(),this._shadowAccumulator.dispose(),this._loadEdgeViewTask=qc(this._loadEdgeViewTask),this._edgeView=Ge(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),cke.prune()}get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(e=null,i=!ae("disable-feature:high-quality-idle")){this._renderStateFeatures.value=Dve(i,e),this._plugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(e,i=this._state.value){return this._renderStateFeatures.value.get(i,e)??!1}setFeatureEnabled(e,i,r){this._renderStateFeatures.mutate(s=>s.set(i,e,r)),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(bn.HighQualityTransparency)}get hasReflections(){return(this._pluginsHas.water||this._hasOverlayWater)&&(this._ssrEnabled||this.isFeatureEnabled(bn.WaterReflection))}get hasDecorations(){return this._plugins.hasDecorations||this._nodes.produces("magnifier-color")}get hasHighlights(){return this._plugins.produces(G.Highlight,Ce.OPAQUE_MATERIAL,Ce.TRANSPARENT_MATERIAL,Ce.DRAPED_MATERIAL)}get hasLaserlines(){return this._plugins.produces(this._renderContext.output,Ce.LASERLINES,Ce.LASERLINES_CONTRAST_CONTROL)}get hasSSAO(){return(this._stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(bn.SSAO))&&!this._inGlobeView}get hasSMAA(){return this._stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(bn.Antialiasing)}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(bn.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=yi(this._bindParameters.ssr.lastFrameColor),this._bindParameters.multipassTerrain.depth=yi(this._bindParameters.multipassTerrain.depth),this._bindParameters.multipassGeometry.depth=yi(this._bindParameters.multipassGeometry.depth)}_disposeOffscreenBuffers(){this._offscreen.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._viewshed.viewshedShadowMap.disposeOffscreenBuffers(),this._bindParameters.depth=yi(this._bindParameters.depth),this._bindParameters.hudVisibility=yi(this._bindParameters.hudVisibility)}get updating(){return this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){return this._loadEdgeViewTask||(this._loadEdgeViewTask=P0(async e=>{const{EdgeView:i}=await ye(()=>import("./EdgeView-8bbdca23.js").then(s=>s.E),["./EdgeView-8bbdca23.js","./EdgeWorkerHandle-697a8b6d.js","./WorkerHandle-ce022e20.js","./workerHelper-9cb8f8e7.js"],import.meta.url);zt(e);const r=this._edgeView=new i({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:sjt(this._stage.view.resourceController)});return this._handles.push(_e(()=>r.updating,()=>this._requestRender(),Mr)),this._requestRender(),this._edgeViewCallbacks.forEach(s=>s(r)),this._edgeViewCallbacks.length=0,r})),this._loadEdgeViewTask.promise}withEdgeView(e){this.loadEdgeView(),this._edgeView==null?this._edgeViewCallbacks.push(e):e(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&Aq(this._bindParameters.ssr.reprojectionMatrix,us)}set _reprojectionMatrix(e){ZMe(this._bindParameters.ssr.reprojectionMatrix,e)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(e){const{_shadowMap:i,_bindParameters:r}=this;if(e.qualitySettings?.reflections!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&i.maxCascades!==e.shadowMapMaxCascades&&(i.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const s=e.environment.lighting.type!=="virtual";r.enableFillLights!==s&&(r.enableFillLights=s,this._requestRender())}e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCast!==void 0&&this._shadowAccumulator.setOptions(e.shadowCast)}get hasSlicePlane(){return!!this._sliceHelper.plane}get plugins(){return this._plugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,i){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:s,updates:n}=e;if(r.length===0&&s.length===0&&n.length===0)return;const o=RFe(e);let a=!1;o.forEach((l,c)=>{if(i.done)return;let u=this._plugins.getMaterialRenderer(c);if(u==null&&l.adds.length>0){const h=new RD({material:c});h.initializeRenderContext(this._plugins._context),u=h,this._plugins.add(u)}u&&(u.modify(l),u.numGeometries===0&&(a=!0)),l.removes.forEach(h=>e.removes.removeUnordered(h)),l.adds.forEach(h=>e.adds.removeUnordered(h)),l.updates.forEach(h=>e.updates.removeUnordered(h)),i.madeProgress()}),a&&this._plugins.removeEmptyMaterialRenderers(),this._updateHasFlags(),this._requestRender()}_updateHasFlags(){const e=this._pluginsHas;e.hudElements=this._plugins.produces(G.Color,Ce.LINE_CALLOUTS_HUD_DEPTH,Ce.HUD_MATERIAL,Ce.LABEL_MATERIAL),e.water=this._plugins.produces(G.Normal,Ce.DRAPED_WATER),this._bindParameters.hasOccludees=this._plugins.hasOccludees}updateAnimation(e){const i=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(e),this._hasAnimations=this._nodes.updateAnimation()||this._hasAnimations,this._hasAnimations!==i&&(this._gpuTimerHandle=i?Zr(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(e,i,r=Am.Default,s=Gc.ON){this._isRendering=!0,this.performanceInfo.startFrame(),this.fboCache.frameStart(),this._disposeBindBuffers();const n=this._offscreen,{camera:o,contentCamera:a,mode:l,alignPixelEnabled:c}=e;this._state.value=l,this._bindParameters.overlay=this.renderOverlay(i),this._bindParameters.overlay&&this.performanceInfo.advance(sn.OVERLAY),this._renderContext.time=i,this._bindParameters.transparencyPassType=mt.NONE,this._bindParameters.alignPixelEnabled=c,this._bindParameters.decorations=s,this._bindParameters.mainColor=this._bindParameters.mainDepth=null,this._bindParameters.viewshedEnabled=this._viewshed.enabled;const u=this._nodes.produces("magnifier-color"),h=this._nodes.produces("final-color"),p=i1(this._sliceHelper.plane);s===Gc.OFF&&(this._sliceHelper.plane=null),o.setGLViewport(this._rctx);const f=n.initializeFrame(o,this._backgroundColor,r);this.hasReflections?this._bindParameters.ssr.lastFrameColor=f:f?.release(),this._ensureBindParametersCamera(o,a),this._plugins.prepareRender(),this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&s===Gc.ON;const g=this._plugins.produces(G.Color,Ce.OPAQUE_TERRAIN)&&(this._terrainTransparency===Yl.Semitransparent||this._terrainTransparency===Yl.TransparentWithDraped),y=this._highQualityTransparency&&g,v=this._plugins.produces(G.Color,...HB);this._prepareShaders(y,v),this.performanceInfo.advance(sn.PREPARE);const b=this._computeDepthRange(o);this._renderShadowMap(o,this._bindParameters.lighting.mainLight.direction,b),this._ensureBindParametersCamera(o,a);let w=this._renderNormals();if(this._pluginInput.set("normals",w),w){let Y=null;this._needsDepth&&(Y=w.getAttachment(YO),Y?.retain()),this._pluginInput.set("ssao",this._renderSSAO()),this._renderNoSSAOGeometryDepth(Y),w=null}else this._renderAllGeometryDepth();this._renderShadowAccumulation(b,o,a),this._ensureBindParametersSSR(i),this._renderContext.output=G.Color,n.bindFbo(),this._bindParameters.mainColor=n.colorTexture,this._bindParameters.mainDepth=n.depthTexture;const x=this.plugins.produces(G.Color,...oJ);x&&this._renderOpaqueGeometry(),this._offscreen.updateColor(Y=>this._renderNodes(dw.OPAQUE,Y,x)),this.fboCache.debugCallback?.("opaque-color",this._offscreen.color.fbo),this._renderPlugins(Ce.OPAQUE_ENVIRONMENT,sn.OPAQUE_ENVIRONMENT),this._renderMultipassTerrainDepth(y),this._setMultipassTerrain(y),this._renderEdges(Td.OPAQUE),n.bindFbo(),this._renderPlugins(Ce.VOXEL,sn.VOXEL),this._renderHiddenTransparentEdges(),v&&(this._oitEnabled?this._renderOITPass(dP.Geometry):this._renderTransparentMaterial()),this._offscreen.updateColor(Y=>this._renderNodes(dw.TRANSPARENT,Y,v)),this.fboCache.debugCallback?.("transparent-color",this._offscreen.color.fbo),this._renderMultipassGeometryDepth(y),this._renderHUDVisibility(),y||this._plugins.render(this._pluginInput,Ce.LINE_CALLOUTS);const S=r===Am.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;this._renderEdges(Td.TRANSPARENT);const E=g?this._renderTransparentTerrain():null;E&&(this.performanceInfo.advance(sn.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&(y?this._renderLineCallouts(Su.Occluded):n.compositeToHUDVisibility(this._bindParameters,E.getTexture()),this._renderHUD(Su.Occluded,n.color))),this._setTerrainCulling(!1),E&&(n.compositeToFramebuffer(this._bindParameters,E.getTexture(),vh.PremultipliedAlpha,1),E.release(),y&&(this._renderEdges(Td.OPAQUE),v&&(this._oitEnabled?this._renderOITPass(dP.Geometry):this._renderTransparentMaterial(),this.performanceInfo.advance(sn.TRANSPARENT)),this._renderEdges(Td.TRANSPARENT))),this._bindParameters.ssao=yi(this._bindParameters.ssao),y&&this._renderLineCallouts(Su.NotOccluded),this._setMultipassEnabled(!1),this._renderTransparentEnvironment(),this._renderViewshed(),this._renderLaserlines(),this._renderOccluded(),this._pluginInput.set("highlights",this._renderHighlightPrepass()),this._offscreen.updateColor(Y=>this._renderNodes(dw.COMPOSITE,Y));const C=this._nodes.produces("aa-color"),R=!(r!==Am.Default||h||u&&s===Gc.ON&&r===Am.Default),I=this._pluginInput.get("composite-color"),F=R?QF:this.fboCache.acquire(I.fbo.width,I.fbo.height,"aa-color"),D=C?this._renderNodes(V2.ANTIALIASING,F):this._blitToDefault(I,F,!1);this._pluginInput.set(V2.ANTIALIASING,D),this._renderHUD(Su.NotOccluded,D);const z=this._renderNodes(V2.HIGHLIGHTS,D);let B=this._renderNodes(V2.MAGNIFIER,z);return u&&s===Gc.ON&&r===Am.Default&&!h&&(B=this._blitToDefault(B)),h?(B.attachDepth(n.depth),this._blitToDefault(this._renderNodes(dw.FINAL,B)),B.detachDepth()):this._pluginInput.set(dw.FINAL,B),this._pluginInput.release("highlights"),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),this._offscreen.releaseBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=p,this._isRendering=!1,this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),r!==Am.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),{screen:this._pluginInput.get("final-color"),oid:S}}_prepareShaders(e,i){this._renderContext.output=G.Color,this._prepareOpaqueGeometry(),this._setMultipassTerrain(e),this._plugins.prepare(Ce.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),e||this._plugins.prepare(Ce.LINE_CALLOUTS),i&&this._prepareTransparencySlots(),this._plugins.prepare(Ce.VIEWSHED,Ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Ce.TRANSPARENT_ENVIRONMENT,Ce.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(){if(!ae("enable-feature:objectAndLayerId-rendering"))return;const e=this._renderContext.output,i=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oid");return i.acquireDepth(pa.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(i.fbo),this.fboCache.rctx.clearFramebuffer([0,0,0,0],!0,!0),this._renderAllGeometry(G.ObjectAndLayerIdColor),this._rctx.bindFramebuffer(i.fbo),this.fboCache.rctx.clearFramebuffer(void 0,!0,!0),this._bindParameters.hudRenderStyle=Su.NotOccluded,this._plugins.render(this._pluginInput,Ce.HUD_MATERIAL),this._renderContext.output=e,this.performanceInfo.advance(sn.OBJECT_AND_LAYER_ID_COLOR),i}finish(e){this._hasAnimations||this._animationTimestep.clear();const i=this.performanceInfo.gpuSamplingEnabled,r=e===vr.BACKGROUND;if(r||i){const s=r?this.performanceInfo.elapsedTime:0,n=i?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),o=Math.max(s,n);this._animationTimestep.frame(o,r)}}readDepthPixels(e,i){if(!this._bindParameters.mainDepth)return;const{width:r,height:s}=this._offscreen,n=this.fboCache.acquire(r,s,"linear-depth");this._rctx.bindFramebuffer(n.fbo),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.clearFramebuffer([0,0,0,0],!0,!0),this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,this._bindParameters.mainDepth),n.fbo?.readPixels(e[0],e[1],e[2],e[3],Xt.RGBA,cc.UNSIGNED_BYTE,i),n.release()}readHUDVisibility(e,i,r,s,n){this._bindParameters.hudVisibility?.fbo?.readPixels(e,i,r,s,Xt.RGBA,cc.UNSIGNED_BYTE,n)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassTerrain(e){this._setMultipassEnabled(e),this._setTerrainCulling(e)}_setMultipassEnabled(e){this._bindParameters.multipassEnabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderEdges(e){const i=this._edgeView;if(!i?.shouldRender())return;const{width:r,height:s,depth:n}=this._offscreen,o=this.fboCache.acquire(r,s,"edges"),a=()=>i.render(this._bindParameters,e),l=this._bindParameters.multipassGeometry.depth;this._offscreen.renderToTargets(a,o,l??n,QTe),this._offscreen.compositeToFramebuffer(this._bindParameters,o.getTexture(),vh.Alpha,1),o.release(),this.performanceInfo.advance(e===Td.OPAQUE?sn.OPAQUE_EDGES:sn.TRANSPARENT_EDGES)}_renderShadowMap(e,i,r){const s=this._shadowMap;s.enabled&&(s.start(e,i,r,this.isFeatureEnabled(bn.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._needsShadowHighlight?(this._renderShadowCascades(G.ShadowHighlight,this._shadowMap),s.moveSnapshot(QE.Highlight),this._renderShadowCascades(G.ShadowExcludeHighlight,this._shadowMap),s.copySnapshot(QE.ExcludeHighlight),this._renderShadowCascades(G.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(G.Shadow),s.finish(),e.setGLViewport(this._rctx),this.performanceInfo.advance(sn.SHADOW_MAP))}_renderShadowCascades(e,i=this._shadowMap){for(const r of i.cascades)r.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(r.camera,r.camera),this._renderAllGeometry(e)}get _needsDepth(){return this._plugins.consumes(G.Depth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast||this._debugNeedsDepth}_renderNoSSAOGeometryDepth(e){if(!this._needsDepth||!e)return void(this._bindParameters.depth=yi(this._bindParameters.depth));const{width:i,height:r}=this._offscreen,s=this.fboCache.acquire(i,r,"depth");s.attachDepth(e),e.release(),this._rctx.bindFramebuffer(s.fbo),this._rctx.clearFramebuffer(void 0,!1,!0),this._renderGeometryExcludedFromSSAO(G.Depth),yi(this._bindParameters.depth),this._bindParameters.depth=s.obtainDepthTexture(),s.release(),this.performanceInfo.advance(sn.DEPTH)}_renderAllGeometryDepth(){if(!this._needsDepth)return void(this._bindParameters.depth=yi(this._bindParameters.depth));const{width:e,height:i}=this._offscreen,r=this.fboCache.acquire(e,i,"depth").acquireDepth(pa.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderAllGeometry(G.Depth),yi(this._bindParameters.depth),this._bindParameters.depth=r.obtainDepthTexture(),r.release(),this.performanceInfo.advance(sn.DEPTH)}_renderMultipassTerrainDepth(e){if(!e)return void(this._bindParameters.multipassTerrain.depth=yi(this._bindParameters.multipassTerrain.depth));const i=this._renderContext.output;this._renderContext.output=G.Depth;const{width:r,height:s}=this._offscreen,n=this.fboCache.acquire(r,s,"terrain depth").acquireDepth(pa.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderTransparentTerrain(),yi(this._bindParameters.multipassTerrain.depth),this._bindParameters.multipassTerrain.depth=n.obtainDepthTexture(),this._renderContext.output=i,n.release()}_renderMultipassGeometryDepth(e){if(!e)return void(this._bindParameters.multipassGeometry.depth=yi(this._bindParameters.multipassGeometry.depth));const i=this._renderContext.output,{width:r,height:s}=this._offscreen,n=this.fboCache.acquire(r,s,"geometry depth").acquireDepth(pa.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderOpaqueGeometryAndTransparentMaterial(G.Depth),this._renderContext.output=i,yi(this._bindParameters.multipassGeometry.depth),this._bindParameters.multipassGeometry.depth=n.obtainDepthTexture(),n.release()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return wne;const i=n6t(e,this._plugins.plugins,this._stage.layers);return pI(i,this._plugins.queryDepthRange(e)),i.near=Math.max(e.near,i.near),i.far=Math.min(e.far,i.far),i}_renderNormals(){const e=this._nodes.require("normals","final-color","composite-color","opaque-color","transparent-color"),i=(this.hasSSAO?1:0)+(this.hasLaserlines?1:0)+e;if(i===0)return;const r=this._offscreen.renderToCachedFBO(null,"normals",()=>this._renderGeometryForSSAO(G.Normal),[0,0,0,0],xs.RGBA,pa.DEPTH_STENCIL_TEXTURE),s=this._nodes.optional("normals","final-color","composite-color","opaque-color","transparent-color")+(this._viewshedEnabled?1:0);return r.retain(i+s-1),this.performanceInfo.advance(sn.NORMALS),r}_renderSSAO(){const e=this._pluginInput.get("normals");if(!this.hasSSAO||!e)return void e?.detachDepth();const i=this._nodes.render("ssao",this._pluginInput);return this._bindParameters.ssao=i,e.detachDepth(),this._pluginInput.release("normals"),this.performanceInfo.advance(sn.SSAO),i}_renderAllGeometry(e){this._renderContext.output=e,this._plugins.prepare(Ce.TRANSPARENT_TERRAIN),this._renderOpaqueGeometryAndTransparentMaterial(e),this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(e){this._renderContext.output=e,this._plugins.prepare(Ce.TRANSPARENT_MATERIAL,Ce.TRANSPARENT_NO_SSAO_DEPTH),this._renderOpaqueGeometry(),this._renderTransparentMaterial()}_renderGeometryForSSAO(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,Ce.INTEGRATED_MESH,Ce.OPAQUE_TERRAIN,Ce.OPAQUE_MATERIAL,Ce.TRANSPARENT_MATERIAL),this._renderTransparentTerrain()}_renderGeometryExcludedFromSSAO(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,Ce.OPAQUE_NO_SSAO_DEPTH,Ce.TRANSPARENT_NO_SSAO_DEPTH)}_prepareOpaqueGeometry(){this._plugins.prepare(...oJ,Ce.OPAQUE_ENVIRONMENT)}_renderOpaqueGeometry(){this._plugins.render(this._pluginInput,...oJ)}_renderTransparentMaterial(){this._plugins.render(this._pluginInput,...HB)}_renderTransparentTerrain(){const e=this._renderContext.output;if(!this._plugins.produces(e,Ce.TRANSPARENT_TERRAIN))return;const i=()=>this._plugins.render(this._pluginInput,Ce.TRANSPARENT_TERRAIN);if(e!==G.Color)return void i();const{width:r,height:s,depth:n}=this._offscreen,o=this.fboCache.acquire(r,s,"transparent terrain");return this._offscreen.renderToTargets(i,o,n,[0,0,0,0]),o}_renderHUDVisibility(){this._plugins.produces(this._renderContext.output,Ce.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._plugins.render(this._pluginInput,Ce.OCCLUSION_PIXELS),this._bindParameters.multipassGeometry.depth),this._offscreen.bindFbo(),this.performanceInfo.advance(sn.HUD_VISIBILITY)):this._bindParameters.hudVisibility=yi(this._bindParameters.hudVisibility)}_renderLineCallouts(e){if(this._bindParameters.hudRenderStyle=e,e===Su.Occluded){const i=()=>this._plugins.render(this._pluginInput,Ce.LINE_CALLOUTS),{width:r,height:s,color:n}=this._offscreen,o=this.fboCache.acquireDepth(pa.DEPTH16_BUFFER,r,s,"line callouts");this._offscreen.renderToTargets(i,n,o,void 0,!0,!0),o.release()}else this._plugins.render(this._pluginInput,Ce.LINE_CALLOUTS)}_renderLaserlines(){if(this.hasLaserlines){if(this._plugins.render(this._pluginInput,Ce.LASERLINES),this._plugins.produces(this._renderContext.output,Ce.LASERLINES_CONTRAST_CONTROL)){const e=this._offscreen,{width:i,height:r,depth:s}=e,n=this.fboCache.acquire(i,r,"laser lines"),o=()=>this._plugins.render(this._pluginInput,Ce.LASERLINES_CONTRAST_CONTROL);e.renderToTargets(o,n,s,QTe),e.compositeToFramebuffer(this._bindParameters,n.getTexture(),vh.PremultipliedAlpha,1),n.release()}this._pluginInput.release("normals"),this.performanceInfo.advance(sn.LASER_LINES)}}_renderHUD(e,i){if(this._pluginsHas.hudElements){if(this._oitEnabled){const r=this._renderOITPass(dP.HUD,e);this._rctx.bindFramebuffer(i.fbo),this._compositingHelper.composite(this._bindParameters,r.getTexture(),vh.PremultipliedAlpha),r.release()}else if(e===Su.Occluded){this._renderContext.output=G.Color;const r=()=>this._renderHUDElements(e),{width:s,height:n,color:o}=this._offscreen,a=this.fboCache.acquireDepth(pa.DEPTH16_BUFFER,s,n,"hud");this._offscreen.renderToTargets(r,o,a,void 0,!0,!0),a.release()}else this._renderContext.output=G.Color,i.acquireDepth(pa.DEPTH16_BUFFER),this._rctx.bindFramebuffer(i.fbo),this._renderHUDElements(e),i.detachDepth();this.performanceInfo.advance(e===Su.Occluded?sn.HUD_OCCLUDED:sn.HUD)}}_renderHUDElements(e){this._bindParameters.hudRenderStyle=e,this._plugins.prepare(Ce.LINE_CALLOUTS_HUD_DEPTH,Ce.HUD_MATERIAL,Ce.LABEL_MATERIAL),this._plugins.render(this._pluginInput,Ce.LINE_CALLOUTS_HUD_DEPTH,Ce.HUD_MATERIAL,Ce.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._plugins.produces(G.ShadowHighlight,Ce.OPAQUE_MATERIAL)}_renderHighlightPrepass(){if(!this.hasHighlights)return;const e=()=>{this._renderAllGeometry(G.Highlight),this._rctx.clear(ss.DEPTH_BUFFER_BIT),this._renderHUDElements(Su.Both)},i=this._offscreen.renderToCachedFBO(null,"highlights",e,[0,0,0,0],xs.RGBA4,pa.DEPTH_STENCIL_TEXTURE);return i.detachDepth(),i}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(e,i,r){this._needsShadowCast&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,e,i,r)&&this.performanceInfo.advance(sn.ACCUMULATED_SHADOWS)}_prepareTransparencySlots(){this._renderContext.output=G.Color,this._bindParameters.transparencyPassType=mt.ColorAlpha,this._plugins.prepare(...HB),this._bindParameters.transparencyPassType=mt.FrontFace,this._plugins.prepare(...HB),this._bindParameters.transparencyPassType=mt.NONE,this._techniques.acquire(Cpe).release()}_renderOITPass(e,i=Su.Both){const r=e===dP.HUD,s=r?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oit hud composite"):null,n=r?()=>this._renderHUDElements(i):()=>this._renderTransparentMaterial(),o=this._renderContext.output;this._renderContext.output=G.Color,this._bindParameters.transparencyPassType=mt.ColorAlpha;const a=this._offscreen.renderOITPass(n,mt.ColorAlpha,r);this._bindParameters.transparencyPassType=mt.FrontFace;const l=this._offscreen.renderOITPass(n,mt.FrontFace,r);return this._offscreen.compositeOIT(this._bindParameters,a,l,s),s?.detachDepth(),l.release(),a.release(),this._bindParameters.transparencyPassType=mt.NONE,this._renderContext.output=o,s}_renderOccluded(){let e=0;Hh.clear(),this._plugins.plugins.forAll(l=>{l.materialReference&&l.queryRenderOccludedState(pr.OccludeAndTransparentStencil)&&(e|=pr.OccludeAndTransparentStencil,Hh.push(l))});const i=this._offscreen,r=(l,c,u,h,p)=>{if(!(e&c))return;const{width:f,height:g,depth:y}=i,v=this.fboCache.acquire(f,g,"tmp color");i.renderToTargets(u,v,y,[0,0,0,0],h,p),i.compositeToFramebuffer(this._bindParameters,v.getTexture(),vh.PremultipliedAlpha,l),v.release()},s=(l,c)=>{this._bindParameters.slot=l,c.forAll(u=>{if(zre(u)){const h=u.prepareTechnique(this._renderContext);h&&u.renderNode(this._renderContext,h)}})};Hh.length!==0&&(s(Ce.OCCLUDER_MATERIAL,Hh),r(.5,pr.OccludeAndTransparentStencil,()=>s(Ce.TRANSPARENT_OCCLUDER_MATERIAL,Hh),!1,!1));const n=Hh.length>0;Hh.clear(),this._plugins.plugins.forAll(l=>{if(!l.materialReference)return;const c=l.queryRenderOccludedState(pr.OccludeAndTransparent),u=l.queryRenderOccludedState(pr.Transparent),h=l.queryRenderOccludedState(pr.Opaque);(c||u||h)&&(e|=c?pr.OccludeAndTransparent:u?pr.Transparent:pr.Opaque,Hh.push(l))});const o=this._plugins.renderOccludedFlags;if(e|=o,!e)return;const a=l=>{this._renderContext.renderOccludedMask=l,o>pr.Occlude&&this._plugins.render(this._pluginInput,Ce.OCCLUDED_TERRAIN),s(Ce.OPAQUE_MATERIAL,Hh),s(Ce.TRANSPARENT_MATERIAL,Hh),s(Ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Hh),this._renderContext.renderOccludedMask=B8};this._renderContext.output=G.Color,r(.5,pr.OccludeAndTransparent,()=>a(pr.OccludeAndTransparent),!0,Iu.OutlineVisualElementMask),r(.5,pr.Transparent,()=>a(pr.Transparent),!0,Iu.OutlineVisualElementMask),r(1,pr.Opaque,()=>a(pr.Opaque),!0,Iu.OutlineVisualElementMask),(n||Hh.length>0)&&this.performanceInfo.advance(sn.OCCLUDED),Hh.clear()}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters),this._offscreen.bindFbo(),this._plugins.render(this._pluginInput,Ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Ce.TRANSPARENT_ENVIRONMENT),this.performanceInfo.advance(sn.TRANSPARENT_ENVIRONMENT)}_renderViewshed(){this._viewshedEnabled&&(this._viewshed.renderHighQuality=this.isFeatureEnabled(bn.HighResolutionViewshed),this._plugins.render(this._pluginInput,Ce.VIEWSHED),this._pluginInput.release("normals"),this.performanceInfo.advance(sn.VIEWSHED))}_renderPlugins(e,i){this._plugins.produces(this._renderContext.output,e)&&(this._plugins.render(this._pluginInput,e),this.performanceInfo.advance(i))}_renderNodes(e,i,r=!1){if(!this._nodes.produces(e))return r&&this.performanceInfo.advance(e),i;i.setName(e),this._pluginInput.set(e,i);const s=this._nodes.render(i,this._pluginInput,this._releaseNormals);return this.performanceInfo.advance(e),s}_blitToDefault(e,i=QF,r=!0){this._blit||(this._blit=new x6t(this._techniques));const s=this._blit.render(this._rctx,e,i,this._bindParameters,this._requestRender);return this._pluginInput.set(e.name,s),r&&e.release(),s}_ensureBindParametersCamera(e,i){this._bindParameters.camera=e,this._bindParameters.contentCamera=i}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=us:(Ao(e2e,this._bindParameters.camera.viewMatrix),Ao(KTe,this._bindParameters.camera.projectionMatrix),Or(iA,e2e,KTe),Or(iA,this._renderContext.lastFrameCamera.viewMatrix,iA),Or(iA,this._renderContext.lastFrameCamera.projectionMatrix,iA),this._reprojectionMatrix=iA);const i=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=i>0?Math.min(i,e-this._ssrEnableTime)/i:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=us,this._ssrEnableTime=null}addRenderNode(e){this._nodes.add(e),this._requestRender()}removeRenderNode(e){this._nodes.remove(e),this._requestRender()}get usedMemory(){return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:this.edgeView?.usedMemory??0}}get _viewshedEnabled(){return this._viewshed.enabled&&this._plugins.produces(this._renderContext.output,Ce.VIEWSHED)}get test(){}}var dP,JTe;d([m({readOnly:!0})],JG.prototype,"fullResolutionAtmosphere",null),d([m()],JG.prototype,"_edgeView",void 0),d([m()],JG.prototype,"updating",null),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(dP||(dP={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.ShadowMap=2]="ShadowMap",t[t.HudVisibility=3]="HudVisibility",t[t.ViewshedShadowMap=4]="ViewshedShadowMap"}(JTe||(JTe={}));const QTe=[0,0,0,0],oJ=[Ce.INTEGRATED_MESH,Ce.OPAQUE_TERRAIN,Ce.OPAQUE_MATERIAL,Ce.OPAQUE_NO_SSAO_DEPTH],HB=[Ce.TRANSPARENT_MATERIAL,Ce.TRANSPARENT_NO_SSAO_DEPTH],Hh=new ci,KTe=Ne(),e2e=Ne(),iA=Ne();function sjt(t){return e=>t.immediate.schedule(e)}let njt=class{constructor(e){this._rctx=e,this._vao=ojt(e)}destroy(){this._vao=jt(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(Li.TRIANGLES,0,3))}get test(){}};function ojt(t,e=Fue,i=Fi){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new k0(t,i,{geometry:e},{geometry:Vr.createVertex(t,wr.STATIC_DRAW,r)})}let zje=class Vje{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=Vje.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Vr.createIndex(this._rctx,wr.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Dt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Li.POINTS,1,At.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}},t2e=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:ke.ONE,dstRGB:ke.ZERO,srcAlpha:ke.ONE,dstAlpha:ke.ZERO},this.blendEquation={mode:Hv.ADD,modeAlpha:Hv.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Hm.BACK,this.frontFace=WO.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Lr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Hm.FRONT_AND_BACK,func:Lr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Hm.FRONT_AND_BACK,fail:Us.KEEP,zFail:Us.KEEP,zPass:Us.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[zo.BACK],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},ajt=class{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<Nn.COUNT;)this._current.push(0)}increment(e,i,r=1){this._current[e]+=r,this._allocations?.add(i)}decrement(e,i,r=1){this._current[e]-=r,this._allocations?.remove(i)}get current(){return this._current}get total(){return this.current.reduce((e,i,r)=>e+(r<Nn.UNCOUNTED?i:0),0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let i=0;i<Nn.COUNT;++i){const r=this._current[i];r>0&&(e+=`${Nn[i]}: ${r}
`)}}return e+=this._allocations?.resetLog(),e}},ljt=class{constructor(e,i,r){const s=i.textureFilterAnisotropic,n=r.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES),this.maxDrawBuffers=e.getParameter(e.MAX_DRAW_BUFFERS)}};const cjt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var i2e,Gje={exports:{}};(i2e=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(Gje.exports=i2e);const ujt=s4(Gje.exports);var r2e,jje={exports:{}};r2e=jje,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(r2e.exports=e)}();const s2e=s4(jje.exports);var Hje={exports:{}};(function(t){(function(e){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();i!==void 0&&(t.exports=i)})()})(Hje);const hjt=s4(Hje.exports);var jf=999,n2e=9999,aJ=0,lJ=1,o2e=2,a2e=3,l2e=4,qB=5,djt=6,pjt=7,fjt=8,c2e=9,mjt=10,u2e=11,gjt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function yjt(){var t,e,i,r=0,s=0,n=jf,o=[],a=[],l=1,c=0,u=0,h=!1,p=!1,f="";return function(B){return a=[],B!==null?y(B.replace?B.replace(/\r\n/g,`
`):B):v()};function g(B){B.length&&a.push({type:gjt[n],data:B,position:u,line:l,column:c})}function y(B){var Y;for(r=0,i=(f+=B).length;t=f[r],r<i;){switch(Y=r,n){case aJ:r=E();break;case lJ:r=S();break;case o2e:r=x();break;case a2e:r=C();break;case l2e:r=F();break;case u2e:r=I();break;case qB:r=D();break;case n2e:r=z();break;case c2e:r=w();break;case jf:r=b()}Y!==r&&(f[Y]===`
`?(c=0,++l):++c)}return s+=r,f=f.slice(r),a}function v(B){return o.length&&g(o.join("")),n=mjt,g("(eof)"),a}function b(){return o=o.length?[]:o,e==="/"&&t==="*"?(u=s+r-1,n=aJ,e=t,r+1):e==="/"&&t==="/"?(u=s+r-1,n=lJ,e=t,r+1):t==="#"?(n=o2e,u=s+r,r):/\s/.test(t)?(n=c2e,u=s+r,r):(h=/\d/.test(t),p=/[^\w_]/.test(t),u=s+r,n=h?l2e:p?a2e:n2e,r)}function w(){return/[^\s]/g.test(t)?(g(o.join("")),n=jf,r):(o.push(t),e=t,r+1)}function x(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,r+1):(g(o.join("")),n=jf,r)}function S(){return x()}function E(){return t==="/"&&e==="*"?(o.push(t),g(o.join("")),n=jf,r+1):(o.push(t),e=t,r+1)}function C(){if(e==="."&&/\d/.test(t))return n=qB,r;if(e==="/"&&t==="*")return n=aJ,r;if(e==="/"&&t==="/")return n=lJ,r;if(t==="."&&o.length){for(;R(o););return n=qB,r}if(t===";"||t===")"||t==="("){if(o.length)for(;R(o););return g(t),n=jf,r+1}var B=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||B){for(;R(o););return n=jf,r}return o.push(t),e=t,r+1}function R(B){for(var Y,W,J=0;;){if(Y=s2e.indexOf(B.slice(0,B.length+J).join("")),W=s2e[Y],Y===-1){if(J--+B.length>0)continue;W=B.slice(0,1).join("")}return g(W),u+=W.length,(o=o.slice(W.length)).length}}function I(){return/[^a-fA-F0-9]/.test(t)?(g(o.join("")),n=jf,r):(o.push(t),e=t,r+1)}function F(){return t==="."||/[eE]/.test(t)?(o.push(t),n=qB,e=t,r+1):t==="x"&&o.length===1&&o[0]==="0"?(n=u2e,o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),n=jf,r):(o.push(t),e=t,r+1)}function D(){return t==="f"&&(o.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),n=jf,r):(o.push(t),e=t,r+1)}function z(){if(/[^\d\w_]/.test(t)){var B=o.join("");return n=ujt.indexOf(B)>-1?fjt:hjt.indexOf(B)>-1?pjt:djt,g(o.join("")),n=jf,r}return o.push(t),e=t,r+1}}function _jt(t){var e=yjt(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function vjt(t){return _jt(t)}function bjt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const cJ=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function wjt(t,e="100",i="300 es"){const r=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replaceAll(/\s{2,}/g," ");if(o===i)return o;if(o===e)return s.data="#version "+i,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function xjt(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function $L(t,e,i,r){r=r||i;for(const s of t)if(s.type==="ident"&&s.data===i)return r in e?e[r]++:e[r]=0,$L(t,e,r+"_"+e[r],r);return i}function qje(t,e,i="afterVersion"){function r(l,c){for(let u=c;u<l.length;u++){const h=l[u];if(h.type==="operator"&&h.data===";")return u}return null}function s(l){let c=-1,u=0,h=-1;for(let p=0;p<l.length;p++){const f=l[p];if(f.type==="preprocessor"&&(/#(if|ifdef|ifndef)\s+.+/.test(f.data)?++u:/#endif\s*.*/.test(f.data)&&--u),i!=="afterVersion"&&i!=="afterPrecision"||f.type==="preprocessor"&&f.data.startsWith("#version")&&(h=Math.max(h,p)),i==="afterPrecision"&&f.type==="keyword"&&f.data==="precision"){const g=r(l,p);if(g===null)throw new Error("precision statement not followed by any semicolons!");h=Math.max(h,g)}c<h&&u===0&&(c=p)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function Sjt(t,e,i,r="lowp"){qje(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Tjt(t,e,i,r,s="lowp"){qje(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Ejt(t,e){let i,r,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&t.splice(i,r-i+1),s}function h2e(t,e){if(t.startsWith("#version 300"))return t;const i=vjt(t);if(wjt(i,"100","300 es")==="300 es")return t;let r=null,s=null;const n={},o={};for(let a=0;a<i.length;++a){const l=i[a];switch(l.type){case"keyword":e===Sd.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===Sd.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===Sd.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(r||(r=$L(i,n,"fragColor"),Sjt(i,r,"vec4")),l.data=r),e===Sd.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=Ejt(i,a+1),u=$L(i,n,"fragData");Tjt(i,u,"vec4",c,"mediump"),l.data=u}else e===Sd.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=$L(i,n,"gl_FragDepth")),l.data=s);break;case"ident":if(cjt.includes(l.data)){if(e===Sd.VERTEX_SHADER&&xjt(i,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=$L(i,n,l.data)),l.data=o[l.data]}}}for(let a=i.length-1;a>=0;--a){const l=i[a];if(l.type==="preprocessor"){const c=l.data.match(/#extension\s+(.*):/);if(c?.[1]&&cJ.has(c[1].trim())){const p=i[a+1];i.splice(a,p&&p.type==="whitespace"?2:1)}const u=l.data.match(/#ifdef\s+(.*)/);u?.[1]&&cJ.has(u[1].trim())&&(l.data="#if 1");const h=l.data.match(/#ifndef\s+(.*)/);h?.[1]&&cJ.has(h[1].trim())&&(l.data="#if 0")}}return Cjt(t,bjt(i))}function Cjt(t,e){return e}const Mjt=4294967295;let Ajt=class{constructor(e,i,r,s,n=new Map,o=[]){this._context=e,this._locations=s,this._uniformBlockBindings=n,this._transformFeedbackVaryings=o,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),i=h2e(i,Sd.VERTEX_SHADER),r=h2e(r,Sd.FRAGMENT_SHADER),this._vShader=d2e(this._context,Sd.VERTEX_SHADER,i),this._fShader=d2e(this._context,Sd.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Nn.Shader,this),zie()&&(this.vertexShader=i,this.fragmentShader=r),this.usedMemory=i.length+r.length;const a=this._context.gl,l=a.createProgram();a.attachShader(l,this._vShader),a.attachShader(l,this._fShader),this._locations.forEach((c,u)=>a.bindAttribLocation(l,c,u)),this._transformFeedbackVaryings?.length&&a.transformFeedbackVaryings(l,this._transformFeedbackVaryings,a.SEPARATE_ATTRIBS),a.linkProgram(l),zie()&&!a.getProgramParameter(l,a.LINK_STATUS)&&console.error(`Could not link shader
validated: ${a.getProgramParameter(l,a.VALIDATE_STATUS)}, gl error ${a.getError()}, vertex: ${a.getShaderParameter(this._vShader,a.COMPILE_STATUS)}, fragment: ${a.getShaderParameter(this._fShader,a.COMPILE_STATUS)}, info log: ${a.getProgramInfoLog(l)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[c,u]of this._uniformBlockBindings){const h=a.getUniformBlockIndex(l,c);h<Mjt&&a.uniformBlockBinding(l,h,u)}this._glName=l,this._context.instanceCounter.increment(Nn.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,i=this._context.instanceCounter;this._nameToUniformLocation.forEach(r=>r&&i.decrement(Nn.Uniform,r)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(i.decrement(Nn.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,i.decrement(Nn.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,i.decrement(Nn.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const i=this._nameToUniformLocation.get(e);if(i!==void 0)return i;if(this.glName){const r=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,r),r&&this._context.instanceCounter.increment(Nn.Uniform,r),r}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1iv(e,i){Zg(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i){Zg(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i){Zg(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i){Zg(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1fv(e,i){Zg(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),s[0]=i,s[1]=r)}setUniform2fv(e,i){Zg(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),this._nameToUniform3.set(e,[i,r,s])):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(e,i){const r=this._getUniformLocation(e);r!=null&&Zg(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(r,i)}setUniform4f(e,i,r,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),this._nameToUniform4.set(e,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(e,i){const r=this._getUniformLocation(e);r!=null&&Zg(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(r,i)}setUniformMatrix3fv(e,i,r=!1){const s=this._getUniformLocation(e);s!=null&&Zg(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(s,r,i)}setUniformMatrix4fv(e,i,r=!1){const s=this._getUniformLocation(e);s!=null&&Zg(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(s,r,i)}stop(){}};function d2e(t,e,i){const r=t.gl,s=r.createShader(e);return r.shaderSource(s,i),r.compileShader(s),zie()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Sd.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(Rjt(i))),s}function Rjt(t){let e=2;return t.replaceAll(`
`,()=>`
`+Pjt(e++)+":")}function Pjt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Zg(t,e,i){const r=t.get(e);if(!r)return t.set(e,Array.from(i)),!0;const s=i.length;if(r.length!==s)return t.set(e,Array.from(i)),!0;for(let n=0;n<s;++n){const o=i[n];if(r[n]!==o){for(r[n]=o;n<s;++n)r[n]=i[n];return!0}}return!1}let Ojt=class{constructor(e){this._rctx=e,this._store=new yx}dispose(){this._store.forEach(e=>e.forEach(i=>i.dispose())),this._store.clear()}acquire(e,i,r,s){const n=this._store.get(e,i);if(n!=null)return n.ref(),n;const o=new Ajt(this._rctx,e,i,r,s);return o.ref(),this._store.set(e,i,o),o}get test(){}},O7=class{constructor(){this._result=!1}dispose(){this._program=jt(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},Ijt=class extends O7{constructor(e){super(),this._rctx=e,this._helperProgram=null,ae("mac")&&ae("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(e){const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=i.getViewport();i.resetState();const l=new fs(1);l.wrapMode=Di.CLAMP_TO_EDGE,l.samplingMode=_i.NEAREST;const c=new z0(i,l),u=Vr.createIndex(this._rctx,wr.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(c),i.setViewport(0,0,1,1),i.useProgram(this._helperProgram),i.bindBuffer(u,Dt.ELEMENT_ARRAY_BUFFER),i.drawElements(Li.POINTS,1,At.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(Li.TRIANGLES,0,258);const h=new Uint8Array(4);return c.readPixels(0,0,1,1,Xt.RGBA,cc.UNSIGNED_BYTE,h),i.setViewport(s,n,o,a),i.bindFramebuffer(r),c.dispose(),u.dispose(),h[0]===255}_prepareProgram(){const i=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${T.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${T.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareHelperProgram(){const e=zje.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},$jt=class extends O7{constructor(e){super(),this._rctx=e,this._program=p2e(this._rctx,!1),this._obfuscated=p2e(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=jt(this._obfuscated)}_test(e){if(ae("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=i.getViewport(),l=this._runProgram(e),c=this._runProgram(this._obfuscated);return i.setViewport(s,n,o,a),i.bindFramebuffer(r),l!==0&&(c===0||l/c>5)}_runProgram(e){const i=this._rctx;i.resetState();const r=new fs(1);r.wrapMode=Di.CLAMP_TO_EDGE,r.samplingMode=_i.NEAREST;const s=new z0(i,r),n=Vr.createVertex(i,wr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new gg(i,new Map([["position",0]]),{geometry:[new mg("position",2,At.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=Be(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Be(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);Zie(a,c,3);const u=new Float32Array(6);Zie(l,u,3),i.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",u[0],u[2],u[4]),e.setUniform3f("u_lowB",u[1],u[3],u[5]),i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Li.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);s.readPixels(0,0,1,1,Xt.RGBA,cc.UNSIGNED_BYTE,h),o.dispose(),s.dispose();const p=(a[2]-l[2])/25,f=qhe(h);return Math.abs(p-f)}};function p2e(t,e){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,r=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(i,r,new Map([["position",0]]))}let Njt=class extends O7{constructor(e){if(super(),this._rctx=e,!e.gl||!(e.capabilities.colorBufferFloat?.textureFloat&&e.capabilities.colorBufferFloat?.floatBlend))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new fs(1);r.wrapMode=Di.CLAMP_TO_EDGE,r.dataType=cc.FLOAT,r.internalFormat=Ct.RGBA32F,r.samplingMode=_i.NEAREST;const s=new z0(i,r),n=Vr.createVertex(i,wr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new gg(i,new Map([["a_pos",0]]),{geometry:[new mg("a_pos",2,At.UNSIGNED_SHORT,0,4)]},{geometry:n});i.gl.getError(),i.useProgram(e);const a=i.getBoundFramebufferObject(),{x:l,y:c,width:u,height:h}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Li.TRIANGLE_STRIP,0,4);const p=ti({blending:Zd(ke.ZERO,ke.ONE_MINUS_SRC_ALPHA)});i.setPipelineState(p),i.drawArrays(Li.TRIANGLE_STRIP,0,4);const f=i.gl.getError();return i.setViewport(l,c,u,h),i.bindFramebuffer(a),o.dispose(),s.dispose(),f!==i.gl.INVALID_OPERATION||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}};new mg("a_pos",2,At.BYTE,0,2);new mg("a_pos",2,At.BYTE,0,4),new mg("a_tex",2,At.BYTE,2,4);const Ljt={geometry:[new mg("a_pos",2,At.UNSIGNED_SHORT,0,4)]};let Djt=class extends O7{constructor(e){super(),this._rctx=e;const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new fs(1);r.wrapMode=Di.CLAMP_TO_EDGE,r.samplingMode=_i.NEAREST;const s=new z0(i,r),n=Vr.createVertex(i,wr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new gg(i,new Map([["a_pos",0]]),Ljt,{geometry:n}),a=new fs;a.samplingMode=_i.LINEAR,a.wrapMode=Di.CLAMP_TO_EDGE;const l=new Gr(i,a,NL);i.useProgram(e),i.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=i.getBoundFramebufferObject(),{x:u,y:h,width:p,height:f}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clear(ss.COLOR_BUFFER_BIT),i.bindVAO(o),i.drawArrays(Li.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return s.readPixels(0,0,1,1,Xt.RGBA,cc.UNSIGNED_BYTE,g),o.dispose(),s.dispose(),l.dispose(),i.setViewport(u,h,p,f),i.bindFramebuffer(c),g[0]!==255}};const NL=new Image;NL.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",NL.width=5,NL.height=5,NL.decode();let Fjt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new Njt(e),this.svgPremultipliesAlpha=new Djt(e),this.doublePrecisionRequiresObfuscation=new $jt(e),this.drawArraysRequiresIndicesTypeReset=new Ijt(e)}dispose(){this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function kjt(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function Ujt(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function Bjt(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function zjt(t,e){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}function Vjt(t,e,i,r,s){if(r)return!0;if(e[i])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function Gjt(t,e){if(e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function jjt(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}let Hjt=class{constructor(e,i){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC??=kjt(this._gl,this._disabledExtensions),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??=Ujt(this._gl,this._disabledExtensions),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??=Bjt(this._gl,this._disabledExtensions),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??=ejt(this._gl,this._disabledExtensions),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??=zjt(this._gl,this._disabledExtensions),this._colorBufferFloat}get loseContext(){return this._loseContext??=jjt(this._gl,this._debugWebGLExtensions),this._loseContext}get textureNorm16(){return this._textureNorm16??=Gjt(this._gl,this._disabledExtensions),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??=Vjt(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]),this._textureFloatLinear}enable(e){return this[e]}},qjt=class{constructor(e,i){this.gl=e,this.instanceCounter=new ajt,this.programCache=new Ojt(this),this._transformFeedbackRequestInfo=null,this._state=new t2e,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(i)}configure(e){this._capabilities=new Hjt(this.gl,e),this._parameters=new ljt(this.gl,this._capabilities,e),Gr.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new t2e,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new Myt({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)},setDrawBuffers:r=>{if(r)this.setDrawBuffers(r.buffers);else{const{drawFramebuffer:s}=this._state;s===null?this.setDrawBuffers([zo.BACK]):s.colorAttachments.length===0?this.setDrawBuffers([zo.NONE]):this.setDrawBuffers([So.COLOR_ATTACHMENT0])}}}),this.enforceState(),jt(this._driverTest),this._driverTest=new Fjt(this)}dispose(){jt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Dt.ARRAY_BUFFER),this.unbindBuffer(Dt.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(Dt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Dt.PIXEL_PACK_BUFFER),this.unbindBuffer(Dt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Dt.COPY_READ_BUFFER),this.unbindBuffer(Dt.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,wm()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,s){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,i,r,s),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,i,r,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,s){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(e,i,r,s),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,s){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(e,i,r,s),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(e,i,r,s),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=Hm.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,i,r,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===Hm.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=Hm.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,i,r,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(fY+e),this._state.activeTexture=e),r}setDrawBuffers(e){const{drawFramebuffer:i}=this._state,r=i===null,s=r?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(i);if(s?.length!==e.length||!s.every((n,o)=>n===e[o]))if(e.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(r){if(e.length>1)return void console.error("The default framebuffer can only have one active draw buffer.");if(e[0]!==zo.BACK&&e[0]!==zo.NONE)return void console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.")}r||!e.includes(zo.BACK)?(this.gl.drawBuffers(e),r?this._state.drawBuffers.defaultFramebuffer=e:this._state.drawBuffers.fbos.set(i,e),this._stateTracker.invalidateDrawBuffers()):console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers.")}}clear(e,i=255){if(e){if(e&ss.COLOR_BUFFER_BIT){const r=this._state.drawFramebuffer?.colorAttachments;r&&this.setDrawBuffers(r),this.setColorMask(!0,!0,!0,!0)}e&ss.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&ss.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(e)}}clearFramebuffer(e,i=!1,r=!1){let s=0;if(e){const o=Math.max(1e-13,e[3]);this.setClearColor(e[0],e[1],e[2],o),s|=ss.COLOR_BUFFER_BIT}i&&(s|=ss.DEPTH_BUFFER_BIT),r===!1?r=0:(r===!0&&(r=255),s|=ss.STENCIL_BUFFER_BIT),s&&this.clear(s,r)}drawArrays(e,i,r){if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(this._state.program?.hasTransformFeedbackVaryings==null)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if(wm()){this._numOfDrawCalls++,this._numOfTriangles+=f2e(e,r);const s=this._state.textureUnitMap;for(let n=0;n<s.length;n++){const o=s[n];if(o!=null&&o===this._state.drawFramebuffer?.colorTexture)throw new Error(`Detected readWrite. Texture already bound at index ${n}`)}}this.gl.drawArrays(e,i,r),zy(this.gl)}drawArraysInstanced(e,i,r,s){this.gl.drawArraysInstanced(e,i,r,s),zy(this.gl)}drawElements(e,i,r,s){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if(wm()&&(this._numOfDrawCalls++,this._numOfTriangles+=f2e(e,i)),this.gl.drawElements(e,i,r,s),wm()){const n=QDe(this);if(n){const o=this.getBoundVAO(),a=o?.indexBuffer,l=o?.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},u={mode:e,count:i,type:r,offset:s},h=a?.size??0,p=s+i,f=h<p?`. Buffer is too small. Attempted to draw index ${p} of ${h}`:"";console.error(`drawElements: ${n}${f}`,{args:u,vao:c})}}}logInfo(){wm()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){wm()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===i&&n.width===r&&n.height===s||(n.x=e,n.y=i,n.width=r,n.height=s,this.gl.viewport(e,i,r,s))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport({x:e,y:i,width:r,height:s}){this.setViewport(e,i,r,s)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){this._state.program!==e&&(this._state.program?.stop(),this._state.program=e,this.gl.useProgram(e?.glName??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return e?.glName==null?(s!=null&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,s):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),e==null)return this.gl.bindFramebuffer(Hl.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(Hl.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const s=i===Hl.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==e)&&(e==null?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),s?this._state.readFramebuffer=e??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=e??null))}blitFramebuffer(e,i,r=0,s=0,n=e.width,o=e.height,a=0,l=0,c=i.width,u=i.height,h=ss.COLOR_BUFFER_BIT,p=_i.NEAREST){this.bindFramebufferSeparate(e,Hl.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,Hl.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,u,h,p)}bindBuffer(e,i){if(e)switch(i??=e.bufferType,i){case Dt.ARRAY_BUFFER:this._state.vertexBuffer=lu(this.gl,e,i,this._state.vertexBuffer);break;case Dt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=lu(this.gl,e,i,this._state.indexBuffer);break;case Dt.UNIFORM_BUFFER:this._state.uniformBuffer=lu(this.gl,e,i,this._state.uniformBuffer);break;case Dt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=lu(this.gl,e,i,this._state.pixelPackBuffer);break;case Dt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=lu(this.gl,e,i,this._state.pixelUnpackBuffer);break;case Dt.COPY_READ_BUFFER:this._state.copyReadBuffer=lu(this.gl,e,i,this._state.copyReadBuffer);break;case Dt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=lu(this.gl,e,i,this._state.copyWriteBuffer);break;case Dt.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=lu(this.gl,e,i,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=e===Dt.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let s=r[i];return s==null&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(e,i,r){const s=this._getBufferBinding(e,i);s!=null&&(s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0))}bindBufferRange(e,i,r,s,n){const o=this._getBufferBinding(e,i);o!=null&&(o.buffer===r&&o.offset===s&&o.size===n||(s%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(e,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,i,r,s){i!=null?(wm()&&(s??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(Dt.UNIFORM_BUFFER,e,i.buffer,r,s):this.bindBufferBase(Dt.UNIFORM_BUFFER,e,i.buffer)):this.bindBufferBase(Dt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(Dt.UNIFORM_BUFFER,i,null)}}unbindBuffer(e){switch(e){case Dt.ARRAY_BUFFER:this._state.vertexBuffer=lu(this.gl,null,e,this._state.vertexBuffer);break;case Dt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=lu(this.gl,null,e,this._state.indexBuffer);break;case Dt.UNIFORM_BUFFER:this._state.uniformBuffer=lu(this.gl,null,e,this._state.uniformBuffer);break;case Dt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=lu(this.gl,null,e,this._state.pixelPackBuffer);break;case Dt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=lu(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Dt.COPY_READ_BUFFER:this._state.copyReadBuffer=lu(this.gl,null,e,this._state.copyReadBuffer);break;case Dt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=lu(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(e){const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,i){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:r}=this;r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,e.glName),r.beginTransformFeedback(i),this._transformFeedbackRequestInfo={primitiveType:i}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(e=10){const{gl:i}=this,r=i.fenceSync(Bie.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(Nn.Sync,r),i.flush();do await eF(e),s=i.clientWaitSync(r,0,0);while(s===Jj.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Nn.Sync,r),i.deleteSync(r),s===Jj.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=Hl.FRAMEBUFFER){return e===Hl.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Dt.ARRAY_BUFFER),this.unbindBuffer(Dt.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(Dt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Dt.PIXEL_PACK_BUFFER),this.unbindBuffer(Dt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Dt.COPY_READ_BUFFER),this.unbindBuffer(Dt.COPY_WRITE_BUFFER);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(ke.ONE,ke.ZERO),this.setBlendEquation(Hv.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Hm.BACK),this.setFrontFace(WO.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Lr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Lr.ALWAYS,0,0),this.setStencilOp(Us.KEEP,Us.KEEP,Us.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([zo.BACK]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const{gl:e}=this;e.bindVertexArray(null);for(let r=0;r<this.parameters.maxVertexAttributes;r++)e.disableVertexAttribArray(r);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(Dt.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(Dt.UNIFORM_BUFFER,null);for(let r=0;r<this._parameters.maxUniformBufferBindings;r++){const s=this._state.uniformBufferBindingPoints[r];if(s!=null){const{buffer:n,offset:o,size:a}=s;n!==null?o===0&&a===0?e.bindBufferBase(Dt.UNIFORM_BUFFER,r,n.glName):e.bindBufferRange(Dt.UNIFORM_BUFFER,r,n.glName,o,a):e.bindBufferBase(Dt.UNIFORM_BUFFER,r,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(Dt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(Dt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(Dt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(Dt.COPY_WRITE_BUFFER,null),e.bindFramebuffer(Hl.READ_FRAMEBUFFER,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(Hl.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),e.readBuffer(So.COLOR_ATTACHMENT0)),e.bindFramebuffer(Hl.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null),this._state.drawFramebuffer===null){const r=this._state.drawBuffers.defaultFramebuffer;e.drawBuffers(r??[zo.BACK])}else{const r=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);e.drawBuffers(r??[So.COLOR_ATTACHMENT0])}if(this._state.vertexArrayObject){const r=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(r)}e.useProgram(this._state.program?.glName??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,this._state.renderbuffer?.glName??null),this._state.blend===!0?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),this._state.faceCulling===!0?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let r=0;r<this.parameters.maxTextureImageUnits;r++){e.activeTexture(fY+r),e.bindTexture(on.TEXTURE_2D,null),e.bindTexture(on.TEXTURE_CUBE_MAP,null),e.bindTexture(on.TEXTURE_3D,null),e.bindTexture(on.TEXTURE_2D_ARRAY,null);const s=this._state.textureUnitMap[r];s!=null&&e.bindTexture(s.descriptor.target,s.glName)}e.activeTexture(fY+this._state.activeTexture);const i=this._state.viewport;e.viewport(i.x,i.y,i.width,i.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function lu(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function f2e(t,e){switch(t){case Li.POINTS:return 2*e;case Li.TRIANGLES:return e/3;case Li.TRIANGLE_STRIP:case Li.TRIANGLE_FAN:return e-2;default:return 0}}let Wjt=class extends qjt{constructor(e,i,r){super(e,i),this.gl=e,this.newCache=r,this._appleAmdDriverHelper=null,this._refCount=1,this.screen=new njt(this)}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){super.dispose(),this._appleAmdDriverHelper?.dispose(),this.screen.destroy()}bindTechnique(e,i,r,s,n){return this.useProgram(e.program),this.setPipelineState(e.getPipeline(!!n)),e.program.bindPass(r,i),s&&e.program.bindDraw(s,i,r),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??=new zje(this),this._appleAmdDriverHelper.run())}get test(){}};function m2e(t){return!!t.frameUpdate}let dR=class extends Fe{constructor(e,i,r){super({}),this._stage=e,this._techniques=i,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new un,this._frameTask=e.view.resourceController.scheduler.registerTask(Ut.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(an.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniques.acquire(Tde,new Ede)),this._textureTechnique}acquire(e){const i=this._textures.get(e);return i?(i.ref(),i.loadingPromise??i):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(i=>{const r=i.texture.frameUpdate(i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e&&this.events.emit("changed",vr.BACKGROUND)}_createNewRef(e){const i=this._stage.getObject(e);if(i==null)return Tt(i!==void 0),null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),s=new Yjt(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&i.unload()})});return this._textures.set(e,s),s.ref(),i.glTexture?(this._updateGLTexture(s,i.glTexture),m2e(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=i.load(this._rctx),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),m2e(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,En(l)||oe.getLogger(this).error(l),null);return Lh(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",vr.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};d([m()],dR.prototype,"_loadingCount",void 0),d([m()],dR.prototype,"_frameTask",void 0),d([m()],dR.prototype,"updating",null),dR=d([N("esri.views.3d.webgl-engine.lib.TextureRepository")],dR);let Yjt=class{constructor(e,i){this.id=e,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(oe.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function Xjt(t,e){return new nBe(i=>eAt(i,t),i=>i,e)}let LL=class extends Fe{constructor(){super(...arguments),this._passParameters=new Zjt,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=qc(this._resourcesTask),this._passParameters.waveNormal=jt(this._passParameters.waveNormal),this._passParameters.wavePerturbation=jt(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=P0(async i=>{await Promise.allSettled([this._loadImageResource(e,kr("esri/images/materials/water/normals.jpg"),r=>this._passParameters.waveNormal=r,i),this._loadImageResource(e,kr("esri/images/materials/water/perturbation.jpg"),r=>this._passParameters.wavePerturbation=r,i)])})),this._resourcesTask.finished?px.LOADED:px.LOADING}async _loadImageResource(e,i,r,s){try{const n=await Xv(i,{signal:s});zt(s);const o=new fs(n.width,n.height);o.pixelFormat=Xt.RGB,o.samplingMode=_i.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,r(new Gr(e,o,n))}catch(n){oe.getLogger(this).error("Failed to load water material normal texture.",n)}}};d([m()],LL.prototype,"_resourcesTask",void 0),d([m({type:Boolean,readOnly:!0})],LL.prototype,"updating",null),LL=d([N("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],LL);let Zjt=class extends is{};const g2e=2048,Jjt=1.5,Qjt=8;function Kjt(t,e){const{format:i,quality:r,rotation:s,disableDecorations:n}=t||{},o=Mpe(t,e.padding),a=o8t(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=n8t(t,a),u=c8t(i),h=f8t[u];return{format:u,quality:$e(r??h,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!!t?.ignoreBackground,ignorePadding:!!t?.ignorePadding}}function e8t(t,e){const i=Kjt(t,e),r=i.area,s=i.width/r.width,n=Mpe(i,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,u=Math.floor(l*s+o),h=Math.floor(c*s+a),p=t?.layers??[],f=i.ignoreBackground,g=i.ignorePadding;return{framebufferWidth:u,framebufferHeight:h,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:p,disableDecorations:i.disableDecorations,ignoreBackground:f,ignorePadding:g,objectAndLayerIdColor:!1}}function uJ(t,e,i){const{ctx:r,canvas:s}=Wje(t,i),n=r.getImageData(0,0,t.width,t.height),o=i8t(s,e);return Yje(s),{dataUrl:o,data:n}}function hJ(t,e){const{ctx:i,canvas:r}=Wje(t,e),s=i.getImageData(0,0,t.width,t.height);return Yje(r),s}function Wje(t,e){const i=t8t();e.premultipliedAlpha&&h8t(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&u8t(r),{ctx:r,canvas:i}}function Yje(t){t.width=0,t.height=0}function t8t(){return dJ==null&&(dJ=document.createElement("canvas")),dJ}let dJ=null;function i8t(t,e){const i=d8t[e.format],r=e.quality/100;return t.toDataURL(i,r)}function r8t(t,e,i,r=0,s=0,n=t.width-r,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:u,data:h}=e,p=n/c,f=o/u,g=Math.ceil(p/2),y=Math.ceil(f/2),v=t.width;for(let b=0;b<u;b++)for(let w=0;w<c;w++){const x=4*(w+(a?u-b-1:b)*c);let S=0,E=0,C=0,R=0,I=0,F=0;const D=(b+.5)*f;for(let z=Math.floor(b*f);z<(b+1)*f;z++){const B=Math.abs(D-(z+.5))/y,Y=(w+.5)*p,W=B*B;for(let J=Math.floor(w*p);J<(w+1)*p;J++){const me=Math.abs(Y-(J+.5))/g,L=Math.sqrt(W+me*me);if(L>=1)continue;let k=2*L*L*L-3*L*L+1;const H=4*(r+J+(s+z)*v);F+=k*l[H+3],E+=k,!i&&l[H+3]<255&&(k=k*l[H+3]/255),C+=k*l[H],R+=k*l[H+1],I+=k*l[H+2],S+=k}}h[x]=C/S,h[x+1]=R/S,h[x+2]=I/S,h[x+3]=F/E}return e}function s8t(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=t,a=Mpe(t,i),l=a.left+a.right,c=a.top+a.bottom,u=r-l,h=s-c,p=Math.min(Qjt,Math.min((g2e-l)/u,(g2e-c)/h));return p<Jjt?t:{...t,framebufferWidth:Math.round(u*p)+l,framebufferHeight:Math.round(h*p)+c,pixelRatio:n*p,resample:{region:{x:Math.round((o.x-a.left)*p)+a.left,y:Math.round((o.y-a.top)*p)+a.top,width:Math.round(o.width*p),height:Math.round(o.height*p)},width:r,height:s}}}function n8t(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const s=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function o8t(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t?.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return a8t(l8t(i,t),e)}function a8t(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),s={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),u=s.height-c;return{x:s.x,y:Math.floor(s.y+u/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function l8t(t,e){if(e?.width==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const n=Math.floor(t.height*i);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/i);return t.y-=(s-t.height)/2,t.height=s,t}function Mpe(t,e){return!e||t?.ignorePadding?m8t:e}function c8t(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return p8t}}function u8t(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function h8t(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const s=e[r+3];if(s!==255&&s>0){const n=255/s;e[r]=e[r]*n,e[r+1]=e[r+1]*n,e[r+2]=e[r+2]*n}}}const d8t={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},y2e=98,p8t="png",f8t={png:100,jpg:y2e,jpeg:y2e},m8t={top:0,right:0,bottom:0,left:0};let g8t=class{constructor(e,i,r){this.parameters=e,this.frameHasDecorations=i,this.fbos=r}},y8t=class{constructor(e,i,r){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(vr.BACKGROUND);const i=lo();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const s={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,i);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const s=e.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderFunctions.renderOverlay(e,r.disableDecorations?Gc.OFF:Gc.ON,i),s.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=KX(r,s,a);this._rctx.gl.readPixels(0,0,r,s,Xt.RGBA,At.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=KX(n.width,n.height,a);return r8t(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=KX(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,Xt.RGBA,At.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,i,r){const s=e.parameters.camera,n={width:i.framebufferWidth,height:i.framebufferHeight};D2(n,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1;const a=i.disableDecorations&&e.frameHasDecorations,l=n.width!==s.fullWidth||n.height!==s.fullHeight,c=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,u=l||a||c||i.objectAndLayerIdColor;let h=null,p=null;if(u){const v=s.clone();if(i.ignorePadding){const E=Bk(v.padding);for(let C=0;C<4;C++)E[C]=Math.round(E[C]/v.pixelRatio*i.pixelRatio);v.padding=E}v.fullWidth=n.width,v.fullHeight=n.height,v.pixelRatio=i.pixelRatio;const b=s.fovX-v.fovX,w=s.fovY-v.fovY;b<0&&b<w?v.fovX=s.fovX:w<0&&w<b&&(v.fovY=s.fovY);const x={camera:v,contentCamera:v,mode:zi.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(x),o=!0;const S=this._renderFunctions.renderScene(x,r,i.objectAndLayerIdColor?Am.ObjectAndLayerID:Am.Screenshot,i.disableDecorations?Gc.OFF:Gc.ON);p=S.screen,h=S.oid}const f=()=>{this._rctx.bindFramebuffer(null),p?.release()};this._rctx.bindFramebuffer(p?.fbo);const g=this._readbackScreenshot(i,f);let y=null;if(i.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),h?.release()};this._rctx.bindFramebuffer(h?.fbo),y=this._readbackScreenshot(i,v),this._rctx.bindFramebuffer(null)}if(u&&!this._rctx.contextAttributes.alpha)for(let v=3;v<g.data.length;v+=4)g.data[v]=255;if(y&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;return o&&this._forceCameraHook(e.parameters),[g,y]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}};function One(t,e={}){return t.getContext("webgl2",e)||null}let rl=class extends Fe{constructor(e){super({}),this.events=new un,this.waterTextures=new LL,this.objectAndLayerIdRenderHelper=ae("enable-feature:objectAndLayerId-rendering")?new m6t:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode;try{this._initializeContext(e)}catch(s){return void console.error("Failed to initialize context",s)}const{memoryController:i}=e.view.resourceController;this.stippleTextures=cMt(this._rctx,i),this.markerTextures=Xjt(this._rctx,i),this._techniques=new Q5e({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextures:this.stippleTextures,waterTextures:this.waterTextures,markerTextures:this.markerTextures}),this._textures=new dR(e,this._techniques,this._rctx),this.addHandles(this._textures.events.on("changed",s=>this.requestRender(s))),this._materials=new K5e(this._textures,this._techniques,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new KGt(this._rctx,this._techniques),this.renderer=new JG(e,this._materials,this._techniques,this._rctx,this._compositingHelper,s=>this.requestRender(s)),this.addHandles([_e(()=>e.view.ready,s=>{s&&this._createRenderNodes(e.view,e.viewingMode)},Ir),_e(()=>this.waterTextures?.updating,()=>this.requestRender(),Ir),_e(()=>e.view.qualityProfile,s=>this.renderer?.updateRenderFeatures(s),Sr)]);const r={renderScene:(s,n,o,a)=>this.renderer.render(s,n,o,a),requestRenderScene:s=>this.requestRender(s),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(s,n,o)=>e.options.screenshot.renderOverlay(s,n,o)};this._screenshotManager=new y8t(this._rctx,r,s=>this.events.emit("force-camera-for-screenshot",s)),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Zr(this._frameTask),this._techniques=Ge(this._techniques),this._componentObjects=Ge(this._componentObjects),this._screenshotManager=Ge(this._screenshotManager),Ge(this.renderer),this._textures=Ge(this._textures),Ge(this.waterTextures),Ge(this.markerTextures),Ge(this.stippleTextures),this._canvas=null,this._container=null,this._rctx=Ge(this._rctx)}_createRenderNodes(e,i){new FT({view:e,isEnabled:()=>this.renderer.hasSSAO,techniques:this._techniques}),new Fb({view:e,isEnabled:()=>this.renderer.hasSMAA,techniques:this._techniques}),new Db({view:e,techniques:this._techniques}),new hR({view:e,techniques:this._techniques}),new WT({view:e,viewingMode:i,techniques:this._techniques})}requestRender(e=vr.UPDATE){this._needsRender=!0,e===vr.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get compositingHelper(){return this._compositingHelper}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(i=>i[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,s,n,o=n){const a=s.constrainWindowSize(i,r,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(a,l);let c=Number.MAX_VALUE;for(let u=0;u<a[2]*a[3];u++){const h=s6t(4*u,l,s.nearFar);c>h&&h!==s.nearFar[0]&&h!==s.nearFar[1]&&(c=h)}if(e){const u=e.pickDepth(i*s.pixelRatio,r*s.pixelRatio,s);u!=null&&c>u&&u!==s.nearFar[0]&&u!==s.nearFar[1]&&(c=u)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const i=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){t6e(),await this._techniques.reloadAll(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,s=vr.BACKGROUND,n=!1;const o={preRender:({time:a})=>{r=this.updating,s=this._needsUpdate?vr.UPDATE:vr.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||i.forcedAnimationTime!=null||r||this._needsRender){const c=l/this.renderer.animationTimeDilation,u=new D4e(i.camera,c,i.forcedAnimationTime);this.renderer.updateAnimation(u)&&this.requestRender(vr.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(i,a),n=!0,l&&this.renderer.hasReflections&&(this.requestRender(vr.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=this.renderer.hasSlicePlane||this.renderer.hasDecorations||this.renderer.hasHighlights,c=new g8t(i,l,this.renderer.fboCache);this._textures.update(),this._screenshotManager.update(c,a)},finish:()=>{n&&(this.renderer.finish(i.mode===zi.IDLE?s:vr.UPDATE),n=!1)}};this._frameTask=xE(o)}_initializeContext(e){const i=e.options;this._canvas=i.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},s=One(this._canvas,r);s!=null?(this._rctx=_8t(s,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&oe.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&ae("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):oe.getLogger(this).error("A WebGL2 context could not be created.")}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjects==null&&(this._componentObjects=new mGt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(e){this._componentObjects=e}};function _8t(t,e){const i={disabledExtensions:e.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:e.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(s,n)=>e.view.resourceController.memoryController.newCache(s,n);return new Wjt(t,i,r)}d([m({type:Boolean,readOnly:!0})],rl.prototype,"updating",null),d([m()],rl.prototype,"_rctx",void 0),d([m()],rl.prototype,"_container",void 0),d([m()],rl.prototype,"_canvas",void 0),d([m()],rl.prototype,"stippleTextures",void 0),d([m()],rl.prototype,"markerTextures",void 0),d([m()],rl.prototype,"waterTextures",void 0),d([m({readOnly:!0})],rl.prototype,"objectAndLayerIdRenderHelper",void 0),d([m()],rl.prototype,"_textures",void 0),d([m({readOnly:!0})],rl.prototype,"renderer",void 0),d([m()],rl.prototype,"_screenshotManager",void 0),d([m()],rl.prototype,"componentObjectCollection",null),d([m()],rl.prototype,"_componentObjects",void 0),d([m()],rl.prototype,"_needsUpdate",void 0),d([m()],rl.prototype,"_needsWaterReflectionUpdate",void 0),rl=d([N("esri.views.3d.webgl-engine.parts.RenderView")],rl);let nd=class extends Fe{constructor(e){super(e),this._model=new VG,this._layers=new ci,this._asyncChangeSet=new qie,this._syncChangeSet=new qie,this._layerSyncSet=new Set}initialize(){this._set("renderView",new rl(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(Ut.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(e){this._model.add(e),F8(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(F8(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){e!=null&&(this._model?.removeMany(e),this.renderView?.requestRender())}forEachOfType(e,i){this._model.forEachOfType(e,i)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),!e.hasProgressed)return Wa}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const s=this._layerSyncSet.has(r.id)||r.updatePolicy===zw.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,n),this._layerSyncSet.delete(r.id),n.empty||(this.renderer.modify(n,s?_h:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,_h),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==zw.ASYNC||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(i=>{this._layerSyncSet.has(i.id)||i.updatePolicy===zw.SYNC?(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id)):e.commitSyncUpdates(i.id,this._syncChangeSet)});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,_h),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,_h),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,_h))}addRenderPlugin(e,i){const r=this.renderer.plugins.add(e,i),s=()=>{ASe(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(Lh(r))return r.then(s);s()}removeRenderPlugin(e){this.destroyed||(ASe(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){}};nd.DebugSettings={endFrameContentValidation:!1},d([m({constructOnly:!0})],nd.prototype,"view",void 0),d([m({constructOnly:!0})],nd.prototype,"options",void 0),d([m({readOnly:!0})],nd.prototype,"viewingMode",null),d([m({constructOnly:!0})],nd.prototype,"container",void 0),d([m({readOnly:!0})],nd.prototype,"updating",null),d([m({constructOnly:!0})],nd.prototype,"_model",void 0),d([m()],nd.prototype,"renderView",void 0),d([m({readOnly:!0})],nd.prototype,"renderer",null),d([m({readOnly:!0})],nd.prototype,"running",null),nd=d([N("esri.views.3d.webgl-engine.Stage")],nd);function rCi(t){return t&&typeof t.highlight=="function"}function v8t(t){return t&&typeof t.maskOccludee=="function"}function b8t(t,e,i){return t==null||t>=i&&(e===0||t<=e)}function sCi(t,e){if(e&&t){const{minScale:i,maxScale:r}=t;if(w8t(i,r))return b8t(e,i,r)}return!0}function w8t(t,e){return t!=null&&t>0||e!=null&&e>0}function nCi(t){return!t?.minScale||!t.maxScale||t.minScale>=t.maxScale}let pJ;function x8t(){return pJ||(pJ=E8t()),pJ}let S8t=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}};function T8t(t){if(typeof WebGL2RenderingContext>"u")return null;const e=document.createElement("canvas");if(!e)return null;let i=One(e,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=One(e),i!=null&&(t.majorPerformanceCaveat=!0)),i==null)return i;t.available=!0,t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const r=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return r&&(t.supportsHighPrecisionFragment=r.precision>0),i}function E8t(){const t=new S8t,e=T8t(t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function C8t(t){const e=x8t();return e.available?t==="3d"&&e.majorPerformanceCaveat?new j("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new j("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new j("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new j("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function M8t(t){return t&&"nodeType"in t}function A8t(t){return t&&typeof t.render=="function"}const _2e={component:"esri-component"};let XT=class extends Fe{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(e){this._set("id",e)}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(_2e.component),i&&i.classList.remove(_2e.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||M8t(e)?(this._set("widget",null),Xq(e)):(A8t(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};d([m()],XT.prototype,"id",null),d([m()],XT.prototype,"node",null),d([vi("node")],XT.prototype,"castNode",null),d([m({readOnly:!0})],XT.prototype,"widget",void 0),XT=d([N("esri.views.ui.Component")],XT);const QG=XT,Xje="calcite-mode-";function R8t(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function P8t(){return R8t().startsWith("dark")}function Zje(){return`${Xje}${P8t()?"dark":"light"}`}function O8t(t){I8t(t),t.classList.add(Zje())}function I8t(t){Array.from(t.classList).forEach(e=>{e.startsWith(Xje)&&t.classList.remove(e)})}const $8t={left:0,top:0,bottom:0,right:0},Jje={bottom:30,top:15,right:15,left:15},m_="esri-ui",Wu={ui:m_,corner:`${m_}-corner`,innerContainer:`${m_}-inner-container`,manualContainer:`${m_}-manual-container`,cornerContainer:`${m_}-corner-container`,topLeft:`${m_}-top-left`,topRight:`${m_}-top-right`,bottomLeft:`${m_}-bottom-left`,bottomRight:`${m_}-bottom-right`};function N8t(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function WB(t){return t===0?"0":`${t}px`}function fJ(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function mJ(t,{top:e,bottom:i,left:r,right:s}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=s}let _y=class extends un.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=Eh(),this.view=null,this._applyViewPadding=()=>{const i=this.container;i&&mJ(i,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const i=this._innerContainer;i&&mJ(i,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([_e(()=>[this.view?.padding,this.container],this._applyViewPadding,Ir),_e(()=>this.padding,this._applyUIPadding,Ir),_e(()=>[this.container,this._locale],([e,i])=>{e&&e.setAttribute("lang",i)},Ir),aPe(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const i=this._get("container");e!==i&&(e&&(e.classList.add(Wu.ui),O8t(e),this._attachContainers(e)),i&&(i.classList.remove(Wu.ui),mJ(i,{top:"",bottom:"",left:"",right:""}),C$e(i)),this._set("container",e))}get height(){const e=this.view?.height??0;if(e===0)return e;const i=this._getViewPadding(),{top:r,bottom:s}=i;return Math.max(e-r-s,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...Jje,...e}}get width(){const e=this.view?.width??0;if(e===0)return e;const i=this._getViewPadding(),{left:r,right:s}=i;return Math.max(e-r-s,0)}add(e,i){let r,s,n;if(Array.isArray(e))return void e.forEach(a=>this.add(a,i));const o=fJ(e);o&&({index:r,position:i,component:e,key:s}=o),i&&typeof i=="object"&&({index:r,key:s,position:i,internal:n}=i),!e||i&&!this._isValidPosition(i)||this._add(e,i,r,s,n)}remove(e,i){if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,i));const r=this._find(e);if(r){if(this._componentMap.has(r)&&this._componentMap.get(r)?.key!==i)return;const s=this._components.indexOf(r);return r.node.parentNode?.removeChild(r.node),this._componentMap.delete(r),r.widget?.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(s,1)[0]}}empty(e,i={removeInternal:!1}){if(Array.isArray(e)){for(const n of e)this.empty(n,i);return}const r=this._positionNameToContainerLookup[e??"manual"],s=Array.prototype.slice.call(r.children).map(n=>this._findByNode(n)).filter(n=>n==null?!1:!(this._componentMap.get(n)?.internal??!1)||i.removeInternal);for(const n of s)this.remove(n)}move(e,i){if(Array.isArray(e)&&e.forEach(o=>this.move(o,i)),!e)return;let r;const s=fJ(e)||fJ(i);if(s&&(r=s.index,i=s.position,e=s.component||e),i&&!this._isValidPosition(i))return;const n=this.remove(e);n&&this.add(n,{position:i,index:r})}find(e){if(!e)return null;const i=this._findById(e);return i&&(i.widget||i.node)}getComponents(e,i={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(r=>this._getComponentsAtPosition(r,i)):this._getComponentsAtPosition(e,i):this._components.filter(r=>i.includeInternal||!this._componentMap.get(r)?.internal).map(({widget:r,node:s})=>r??s)}getPosition(e){for(const i in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[i].contains(e))return i;return null}_add(e,i,r,s,n){e instanceof QG||(e=new QG({node:e}));const{widget:o}=e;o!=null&&o instanceof Fe&&o.addHandles(er(()=>{queueMicrotask(()=>this.remove(e))}),this._removeWidgetHandleKey),this._place({component:e,position:i,index:r}),this._components.push(e),this._componentMap.set(e,{key:s,internal:n})}_find(e){return e?e instanceof QG?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.view?.padding??$8t}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Wu.innerContainer,Wu.cornerContainer);const i=document.createElement("div");i.classList.add(Wu.innerContainer,Wu.manualContainer);const r=document.createElement("div");r.classList.add(Wu.topLeft,Wu.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(Wu.topRight,Wu.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(Wu.bottomLeft,Wu.corner),e.appendChild(n);const o=document.createElement("div");o.classList.add(Wu.bottomRight,Wu.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=i;const a=Qct();this._cornerNameToContainerLookup={"top-left":r,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:r,"top-trailing":a?r:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:i,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const i=e.position??"manual",{component:r,index:s}=e,n=this._positionNameToContainerLookup[i],o=s!=null&&s>-1;if(N8t(r.widget)&&r.widget.startup(),!o)return void n.appendChild(r.node);const a=Array.from(n.children);if(s===0)return void(n.firstChild?Cye(r.node,n.firstChild):n.appendChild(r.node));s>=a.length?n.appendChild(r.node):Cye(r.node,a[s])}_toPixelPosition(e){return{top:WB(e.top),left:WB(e.left),right:WB(e.right),bottom:WB(e.bottom)}}_findByComponent(e){return this._components.find(i=>i===e)??null}_findById(e){return this._components.find(({id:i})=>i===e)??null}_findByNode(e){return this._components.find(({node:i})=>i===e)??null}_getComponentsAtPosition(e,i){const r=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(Rx).filter(s=>i.includeInternal||!this._componentMap.get(s)?.internal).map(({widget:s,node:n})=>s??n)}};d([m()],_y.prototype,"_locale",void 0),d([m()],_y.prototype,"container",null),d([m()],_y.prototype,"height",null),d([m({value:Jje})],_y.prototype,"padding",null),d([vi("padding")],_y.prototype,"castPadding",null),d([m()],_y.prototype,"view",void 0),d([m()],_y.prototype,"width",null),_y=d([N("esri.views.ui.UI")],_y);const L8t=_y,D8t={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},F8t={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}},k8t=t=>({...F8t,...t}),U8t=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},B8t=(t,e)=>t.find(e),v2e=(t,e,i=!1)=>{let r=t;return e.forEach((s,n)=>{const o=r?.children?B8t(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==e.length-1||(r=o)}),r},z8t=t=>{let e;const i={...D8t,...t},r=k8t(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],u=(p,f,g)=>{let y;r.eventHandlerInterceptor=(b,w,x,S)=>function(E){let C;s("domEvent",E);const R=U8t(E.currentTarget,y.domNode),I=R.some(D=>customElements.get(D?.tagName?.toLowerCase()));if(E.eventPhase===Event.CAPTURING_PHASE||!I)R.reverse(),C=v2e(y.getLastRender(),R);else{const D=E.composedPath(),z=D.slice(D.indexOf(E.currentTarget),D.indexOf(y.domNode)).reverse();C=v2e(y.getLastRender(),z,!0)}let F;return C&&(F=i.handleInterceptedEvent(e,C,this,E)),s("domEventProcessed",E),F},i.postProcessProjectionOptions?.(r);const v=g();y=p(f,v,r),r.eventHandlerInterceptor=void 0,l.push(y),c.push(g),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(y,v)};let h=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let p=0;p<l.length;p++){const f=c[p]();s("rendered",void 0),l[p].update(f),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(h=i.modifyDoRenderImplementation(h,l,c)),e={renderNow:h,scheduleRender:()=>{n||a||(n=requestAnimationFrame(h))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(p,f)=>{u(bw.append,p,f)},insertBefore:(p,f)=>{u(bw.insertBefore,p,f)},merge:(p,f)=>{u(bw.merge,p,f)},replace:(p,f)=>{u(bw.replace,p,f)},detach:p=>{for(let f=0;f<c.length;f++)if(c[f]===p)return c.splice(f,1),l.splice(f,1)[0];throw new Error("renderFunction was not found")}},e};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.10.0
 */const Qje="calcite-mode-auto",Kje="calcite-mode-dark",V8t="calcite-mode-light",cCi={autoMode:Qje,darkMode:Kje,lightMode:V8t,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.10.0
 */const DL=globalThis.calciteConfig,uCi=DL?.focusTrapStack||[],b2e="2.10.0";function G8t(){if(DL&&DL.version){console.warn(`[calcite-components] while initializing v${b2e}, an existing configuration with version "${DL.version}" was found. This may cause unexpected behavior. The version will not be added to the existing global configuration.`);return}const t=DL||globalThis.calciteConfig||{};Object.defineProperty(t,"version",{value:b2e,writable:!1}),globalThis.calciteConfig=t}var mv={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,formAssociated:!1,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0,experimentalSlotFixes:!1},j8t=Object.defineProperty,H8t=(t,e)=>{for(var i in e)j8t(t,i,{get:e[i],enumerable:!0})},q8t=t=>{const e=new URL(t,Ml.$resourcesUrl$);return e.origin!==M4.location.origin?e.href:e.pathname},W8t=t=>Ml.$resourcesUrl$=t,w2e={},Y8t="http://www.w3.org/2000/svg",X8t="http://www.w3.org/1999/xhtml",Z8t=t=>t!=null,Ape=t=>(t=typeof t,t==="object"||t==="function");function J8t(t){var e,i,r;return(r=(i=(e=t.head)==null?void 0:e.querySelector('meta[name="csp-nonce"]'))==null?void 0:i.getAttribute("content"))!=null?r:void 0}var Q8t={};H8t(Q8t,{err:()=>e8e,map:()=>K8t,ok:()=>Ine,unwrap:()=>eHt,unwrapErr:()=>tHt});var Ine=t=>({isOk:!0,isErr:!1,value:t}),e8e=t=>({isOk:!1,isErr:!0,value:t});function K8t(t,e){if(t.isOk){const i=e(t.value);return i instanceof Promise?i.then(r=>Ine(r)):Ine(i)}if(t.isErr){const i=t.value;return e8e(i)}throw"should never get here"}var eHt=t=>{if(t.isOk)return t.value;throw t.value},tHt=t=>{if(t.isErr)return t.value;throw t.value},tC=(t,e="")=>()=>{},iHt="slot-fb{display:contents}slot-fb[hidden]{display:none}",x2e="http://www.w3.org/1999/xlink",t8e=(t,e,...i)=>{let r=null,s=null,n=null,o=!1,a=!1;const l=[],c=h=>{for(let p=0;p<h.length;p++)r=h[p],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof t!="function"&&!Ape(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?dH(null,r):r),a=o)};if(c(i),e){e.key&&(s=e.key),e.name&&(n=e.name);{const h=e.className||e.class;h&&(e.class=typeof h!="object"?h:Object.keys(h).filter(p=>h[p]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,nHt);const u=dH(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=s,u.$name$=n,u},dH=(t,e)=>{const i={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return i.$attrs$=null,i.$key$=null,i.$name$=null,i},rHt={},sHt=t=>t&&t.$tag$===rHt,nHt={forEach:(t,e)=>t.map(S2e).forEach(e),map:(t,e)=>t.map(S2e).map(e).map(oHt)},S2e=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),oHt=t=>{if(typeof t.vtag=="function"){const i={...t.vattrs};return t.vkey&&(i.key=t.vkey),t.vname&&(i.name=t.vname),t8e(t.vtag,i,...t.vchildren||[])}const e=dH(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},aHt=t=>LHt.map(e=>e(t)).find(e=>!!e),lHt=(t,e)=>t!=null&&!Ape(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,cHt=t=>t,hCi=(t,e,i)=>{const r=cHt(t);return{emit:s=>uHt(r,e,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s})}},uHt=(t,e,i)=>{const r=Ml.ce(e,i);return t.dispatchEvent(r),r},T2e=new WeakMap,hHt=(t,e,i)=>{let r=mH.get(t);kHt&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=e:r.replaceSync(e)):r=e,mH.set(t,r)},dHt=(t,e,i)=>{var r;const s=i8e(e,i),n=mH.get(s);if(t=t.nodeType===11?t:rg,n)if(typeof n=="string"){t=t.head||t;let o=T2e.get(t),a;if(o||T2e.set(t,o=new Set),!o.has(s)){{a=rg.createElement("style"),a.innerHTML=n;const l=(r=Ml.$nonce$)!=null?r:J8t(rg);l!=null&&a.setAttribute("nonce",l),t.insertBefore(a,t.querySelector("link"))}e.$flags$&4&&(a.innerHTML+=iHt),o&&o.add(s)}}else t.adoptedStyleSheets.includes(n)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,n]);return s},pHt=t=>{const e=t.$cmpMeta$,i=t.$hostElement$,r=e.$flags$,s=tC("attachStyles",e.$tagName$),n=dHt(i.shadowRoot?i.shadowRoot:i.getRootNode(),e,t.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},i8e=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),E2e=(t,e,i,r,s,n)=>{if(i!==r){let o=I2e(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=C2e(i),u=C2e(r);l.remove(...c.filter(h=>h&&!u.includes(h))),l.add(...u.filter(h=>h&&!c.includes(h)))}else if(e==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?t.style.setProperty(l,r[l]):t.style[l]=r[l])}else if(e!=="key")if(e==="ref")r&&r(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n"){if(e[2]==="-"?e=e.slice(3):I2e(M4,a)?e=a.slice(2):e=a[2]+e.slice(3),i||r){const l=e.endsWith(r8e);e=e.replace(mHt,""),i&&Ml.rel(t,e,i,l),r&&Ml.ael(t,e,r,l)}}else{const l=Ape(r);if((o||l&&r!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=r;else{const u=r??"";e==="list"?o=!1:(i==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),r==null||r===!1?(r!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(x2e,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?t.setAttributeNS(x2e,e,r):t.setAttribute(e,r))}}},fHt=/\s/,C2e=t=>t?t.split(fHt):[],r8e="Capture",mHt=new RegExp(r8e+"$"),s8e=(t,e,i)=>{const r=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||w2e,n=e.$attrs$||w2e;for(const o of M2e(Object.keys(s)))o in n||E2e(r,o,s[o],void 0,i,e.$flags$);for(const o of M2e(Object.keys(n)))E2e(r,o,s[o],n[o],i,e.$flags$)};function M2e(t){return t.includes("ref")?[...t.filter(e=>e!=="ref"),"ref"]:t}var pR,$ne,gI,Rpe=!1,pH=!1,Ppe=!1,vd=!1,fH=(t,e,i,r)=>{var s;const n=e.$children$[i];let o=0,a,l,c;if(Rpe||(Ppe=!0,n.$tag$==="slot"&&(pR&&r.classList.add(pR+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)a=n.$elm$=rg.createTextNode(n.$text$);else if(n.$flags$&1)a=n.$elm$=rg.createTextNode("");else{if(vd||(vd=n.$tag$==="svg"),a=n.$elm$=rg.createElementNS(vd?Y8t:X8t,n.$flags$&2?"slot-fb":n.$tag$),vd&&n.$tag$==="foreignObject"&&(vd=!1),s8e(null,n,vd),Z8t(pR)&&a["s-si"]!==pR&&a.classList.add(a["s-si"]=pR),Ipe(a,r),n.$children$)for(o=0;o<n.$children$.length;++o)l=fH(t,n,o,a),l&&a.appendChild(l);n.$tag$==="svg"?vd=!1:a.tagName==="foreignObject"&&(vd=!0)}return a["s-hn"]=gI,n.$flags$&3&&(a["s-sr"]=!0,a["s-cr"]=$ne,a["s-sn"]=n.$name$||"",a["s-rf"]=(s=n.$attrs$)==null?void 0:s.ref,c=t&&t.$children$&&t.$children$[i],c&&c.$tag$===n.$tag$&&t.$elm$&&ek(t.$elm$,!1)),a},ek=(t,e)=>{Ml.$flags$|=1;const i=Array.from(t.childNodes);if(t["s-sr"]&&mv.experimentalSlotFixes){let r=t;for(;r=r.nextSibling;)r&&r["s-sn"]===t["s-sn"]&&r["s-sh"]===gI&&i.push(r)}for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==gI&&s["s-ol"]&&(jw(a8e(s),s,Ope(s)),s["s-ol"].remove(),s["s-ol"]=void 0,s["s-sh"]=void 0,Ppe=!0),e&&ek(s,e)}Ml.$flags$&=-2},n8e=(t,e,i,r,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===gI&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=fH(null,i,s,t),a&&(r[s].$elm$=a,jw(o,a,Ope(e))))},o8e=(t,e,i)=>{for(let r=e;r<=i;++r){const s=t[r];if(s){const n=s.$elm$;u8e(s),n&&(pH=!0,n["s-ol"]?n["s-ol"].remove():ek(n,!0),n.remove())}}},gHt=(t,e,i,r,s=!1)=>{let n=0,o=0,a=0,l=0,c=e.length-1,u=e[0],h=e[c],p=r.length-1,f=r[0],g=r[p],y,v;for(;n<=c&&o<=p;)if(u==null)u=e[++n];else if(h==null)h=e[--c];else if(f==null)f=r[++o];else if(g==null)g=r[--p];else if(YB(u,f,s))fR(u,f,s),u=e[++n],f=r[++o];else if(YB(h,g,s))fR(h,g,s),h=e[--c],g=r[--p];else if(YB(u,g,s))(u.$tag$==="slot"||g.$tag$==="slot")&&ek(u.$elm$.parentNode,!1),fR(u,g,s),jw(t,u.$elm$,h.$elm$.nextSibling),u=e[++n],g=r[--p];else if(YB(h,f,s))(u.$tag$==="slot"||g.$tag$==="slot")&&ek(h.$elm$.parentNode,!1),fR(h,f,s),jw(t,h.$elm$,u.$elm$),h=e[--c],f=r[++o];else{for(a=-1,l=n;l<=c;++l)if(e[l]&&e[l].$key$!==null&&e[l].$key$===f.$key$){a=l;break}a>=0?(v=e[a],v.$tag$!==f.$tag$?y=fH(e&&e[o],i,a,t):(fR(v,f,s),e[a]=void 0,y=v.$elm$),f=r[++o]):(y=fH(e&&e[o],i,o,t),f=r[++o]),y&&jw(a8e(u.$elm$),y,Ope(u.$elm$))}n>c?n8e(t,r[p+1]==null?null:r[p+1].$elm$,i,r,o,p):o>p&&o8e(e,n,c)},YB=(t,e,i=!1)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:i?!0:t.$key$===e.$key$:!1,Ope=t=>t&&t["s-ol"]||t,a8e=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,fR=(t,e,i=!1)=>{const r=e.$elm$=t.$elm$,s=t.$children$,n=e.$children$,o=e.$tag$,a=e.$text$;let l;a===null?(vd=o==="svg"?!0:o==="foreignObject"?!1:vd,o==="slot"&&!Rpe||s8e(t,e,vd),s!==null&&n!==null?gHt(r,s,e,n,i):n!==null?(t.$text$!==null&&(r.textContent=""),n8e(r,null,e,n,0,n.length-1)):s!==null&&o8e(s,0,s.length-1),vd&&o==="svg"&&(vd=!1)):(l=r["s-cr"])?l.parentNode.textContent=a:t.$text$!==a&&(r.data=a)},l8e=t=>{const e=t.childNodes;for(const i of e)if(i.nodeType===1){if(i["s-sr"]){const r=i["s-sn"];i.hidden=!1;for(const s of e)if(s!==i){if(s["s-hn"]!==i["s-hn"]||r!==""){if(s.nodeType===1&&(r===s.getAttribute("slot")||r===s["s-sn"])||s.nodeType===3&&r===s["s-sn"]){i.hidden=!0;break}}else if(s.nodeType===1||s.nodeType===3&&s.textContent.trim()!==""){i.hidden=!0;break}}}l8e(i)}},lv=[],c8e=t=>{let e,i,r;for(const s of t.childNodes){if(s["s-sr"]&&(e=s["s-cr"])&&e.parentNode){i=e.parentNode.childNodes;const n=s["s-sn"];for(r=i.length-1;r>=0;r--)if(e=i[r],!e["s-cn"]&&!e["s-nr"]&&e["s-hn"]!==s["s-hn"]&&!mv.experimentalSlotFixes)if(A2e(e,n)){let o=lv.find(a=>a.$nodeToRelocate$===e);pH=!0,e["s-sn"]=e["s-sn"]||n,o?(o.$nodeToRelocate$["s-sh"]=s["s-hn"],o.$slotRefNode$=s):(e["s-sh"]=s["s-hn"],lv.push({$slotRefNode$:s,$nodeToRelocate$:e})),e["s-sr"]&&lv.map(a=>{A2e(a.$nodeToRelocate$,e["s-sn"])&&(o=lv.find(l=>l.$nodeToRelocate$===e),o&&!a.$slotRefNode$&&(a.$slotRefNode$=o.$slotRefNode$))})}else lv.some(o=>o.$nodeToRelocate$===e)||lv.push({$nodeToRelocate$:e})}s.nodeType===1&&c8e(s)}},A2e=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",u8e=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(u8e)},jw=(t,e,i)=>{const r=t?.insertBefore(e,i);return Ipe(e,t),r},h8e=t=>{const e=[];return t&&e.push(...t["s-scs"]||[],t["s-si"],t["s-sc"],...h8e(t.parentElement)),e},Ipe=(t,e,i=!1)=>{var r;if(t&&e&&t.nodeType===1){const s=new Set(h8e(e).filter(Boolean));if(s.size&&((r=t.classList)==null||r.add(...t["s-scs"]=[...s]),t["s-ol"]||i))for(const n of Array.from(t.childNodes))Ipe(n,t,!0)}},yHt=(t,e,i=!1)=>{var r,s,n,o,a;const l=t.$hostElement$,c=t.$cmpMeta$,u=t.$vnode$||dH(null,null),h=sHt(e)?e:t8e(null,null,e);if(gI=l.tagName,c.$attrsToReflect$&&(h.$attrs$=h.$attrs$||{},c.$attrsToReflect$.map(([p,f])=>h.$attrs$[f]=l[p])),i&&h.$attrs$)for(const p of Object.keys(h.$attrs$))l.hasAttribute(p)&&!["key","ref","style","class"].includes(p)&&(h.$attrs$[p]=l[p]);h.$tag$=null,h.$flags$|=4,t.$vnode$=h,h.$elm$=u.$elm$=l.shadowRoot||l,pR=l["s-sc"],Rpe=(c.$flags$&1)!==0,$ne=l["s-cr"],pH=!1,fR(u,h,i);{if(Ml.$flags$|=1,Ppe){c8e(h.$elm$);for(const p of lv){const f=p.$nodeToRelocate$;if(!f["s-ol"]){const g=rg.createTextNode("");g["s-nr"]=f,jw(f.parentNode,f["s-ol"]=g,f)}}for(const p of lv){const f=p.$nodeToRelocate$,g=p.$slotRefNode$;if(g){const y=g.parentNode;let v=g.nextSibling;{let b=(r=f["s-ol"])==null?void 0:r.previousSibling;for(;b;){let w=(s=b["s-nr"])!=null?s:null;if(w&&w["s-sn"]===f["s-sn"]&&y===w.parentNode){for(w=w.nextSibling;w===f||w?.["s-sr"];)w=w?.nextSibling;if(!w||!w["s-nr"]){v=w;break}}b=b.previousSibling}}(!v&&y!==f.parentNode||f.nextSibling!==v)&&f!==v&&(!f["s-hn"]&&f["s-ol"]&&(f["s-hn"]=f["s-ol"].parentNode.nodeName),jw(y,f,v),f.nodeType===1&&(f.hidden=(n=f["s-ih"])!=null?n:!1)),f&&typeof g["s-rf"]=="function"&&g["s-rf"](f)}else f.nodeType===1&&(i&&(f["s-ih"]=(o=f.hidden)!=null?o:!1),f.hidden=!0)}}pH&&l8e(h.$elm$),Ml.$flags$&=-2,lv.length=0}if(mv.experimentalScopedSlotChanges&&c.$flags$&2)for(const p of h.$elm$.childNodes)p["s-hn"]!==gI&&!p["s-sh"]&&(i&&p["s-ih"]==null&&(p["s-ih"]=(a=p.hidden)!=null?a:!1),p.hidden=!0);$ne=void 0},_Ht=(t,e)=>{},$pe=(t,e)=>(t.$flags$|=16,_Ht(t,t.$ancestorComponent$),BHt(()=>vHt(t,e))),vHt=(t,e)=>{const i=t.$hostElement$,r=tC("scheduleUpdate",t.$cmpMeta$.$tagName$),s=i;if(!s)throw new Error(`Can't render component <${i.tagName.toLowerCase()} /> with invalid Stencil runtime! Make sure this imported component is compiled with a \`externalRuntime: true\` flag. For more information, please refer to https://stenciljs.com/docs/custom-elements#externalruntime`);let n;return e?n=ZP(s,"componentWillLoad"):n=ZP(s,"componentWillUpdate"),n=R2e(n,()=>ZP(s,"componentWillRender")),r(),R2e(n,()=>wHt(t,s,e))},R2e=(t,e)=>bHt(t)?t.then(e):e(),bHt=t=>t instanceof Promise||t&&t.then&&typeof t.then=="function",wHt=async(t,e,i)=>{const r=t.$hostElement$,s=tC("update",t.$cmpMeta$.$tagName$);r["s-rc"],i&&pHt(t);const n=tC("render",t.$cmpMeta$.$tagName$);xHt(t,e,r,i),n(),s(),SHt(t)},P2e=null,xHt=(t,e,i,r)=>{try{P2e=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(mv.hasRenderFn||mv.reflect)&&(mv.vdomRender||mv.reflect)&&(mv.hydrateServerSide||yHt(t,e,r))}catch(l){C4(l,t.$hostElement$)}return P2e=null,null},SHt=t=>{const e=t.$cmpMeta$.$tagName$,i=t.$hostElement$,r=tC("postUpdate",e),s=i;t.$ancestorComponent$,ZP(s,"componentDidRender"),t.$flags$&64?(ZP(s,"componentDidUpdate"),r()):(t.$flags$|=64,ZP(s,"componentDidLoad"),r())},dCi=t=>{{const e=n$(t),i=e.$hostElement$.isConnected;return i&&(e.$flags$&18)===2&&$pe(e,!1),i}},ZP=(t,e,i)=>{if(t&&t[e])try{return t[e](i)}catch(r){C4(r)}},THt=(t,e)=>n$(t).$instanceValues$.get(e),EHt=(t,e,i,r)=>{const s=n$(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;i=lHt(i,r.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(e,i);{if(r.$watchers$&&a&128){const h=r.$watchers$[e];h&&h.map(p=>{try{l[p](i,o,e)}catch(f){C4(f,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,e)===!1)return;$pe(s,!1)}}}},CHt=(t,e,i)=>{var r;const s=t.prototype;if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const n=Object.entries(e.$members$);n.map(([o,[a]])=>{(a&31||a&32)&&Object.defineProperty(s,o,{get(){return THt(this,o)},set(l){EHt(this,o,l,e)},configurable:!0,enumerable:!0})});{const o=new Map;s.attributeChangedCallback=function(a,l,c){Ml.jmp(()=>{var u;const h=o.get(a);if(this.hasOwnProperty(h))c=this[h],delete this[h];else{if(s.hasOwnProperty(h)&&typeof this[h]=="number"&&this[h]==c)return;if(h==null){const p=n$(this),f=p?.$flags$;if(f&&!(f&8)&&f&128&&c!==l){const y=this,v=(u=e.$watchers$)==null?void 0:u[a];v?.forEach(b=>{y[b]!=null&&y[b].call(y,c,l,a)})}return}}this[h]=c===null&&typeof this[h]=="boolean"?!1:c})},t.observedAttributes=Array.from(new Set([...Object.keys((r=e.$watchers$)!=null?r:{}),...n.filter(([a,l])=>l[0]&15).map(([a,l])=>{var c;const u=l[1]||a;return o.set(u,a),l[0]&512&&((c=e.$attrsToReflect$)==null||c.push([a,u])),u})]))}}return t},MHt=async(t,e,i,r)=>{let s;if(!(e.$flags$&32)){e.$flags$|=32,i.$lazyBundleId$;{s=t.constructor;const o=t.localName;customElements.whenDefined(o).then(()=>e.$flags$|=128)}if(s&&s.style){let o=s.style;typeof o!="string"&&(e.$modeName$=aHt(t),e.$modeName$&&(o=o[e.$modeName$]));const a=i8e(i,e.$modeName$);if(!mH.has(a)){const l=tC("registerStyles",i.$tagName$);hHt(a,o,!!(i.$flags$&1)),l()}}}e.$ancestorComponent$,(()=>$pe(e,!0))()},O2e=t=>{},AHt=t=>{if(!(Ml.$flags$&1)){const e=n$(t),i=e.$cmpMeta$,r=tC("connectedCallback",i.$tagName$);e.$flags$&1?(d8e(t,e,i.$listeners$),e?.$lazyInstance$?O2e(e.$lazyInstance$):e?.$onReadyPromise$&&e.$onReadyPromise$.then(()=>O2e(e.$lazyInstance$))):(e.$flags$|=1,i.$flags$&12&&RHt(t),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),MHt(t,e,i)),r()}},RHt=t=>{const e=t["s-cr"]=rg.createComment("");e["s-cn"]=!0,jw(t,e,t.firstChild)},PHt=async t=>{if(!(Ml.$flags$&1)){const e=n$(t);e.$rmListeners$&&(e.$rmListeners$.map(i=>i()),e.$rmListeners$=void 0)}},pCi=(t,e)=>{const i={$flags$:e[0],$tagName$:e[1]};i.$members$=e[2],i.$listeners$=e[3],i.$watchers$=t.$watchers$,i.$attrsToReflect$=[];const r=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){NHt(this,i)},connectedCallback(){AHt(this),r&&r.call(this)},disconnectedCallback(){PHt(this),s&&s.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)})}}),t.is=i.$tagName$,CHt(t,i)},fCi=(t,e)=>e,d8e=(t,e,i,r)=>{i&&i.map(([s,n,o])=>{const a=IHt(t,s),l=OHt(e,o),c=$Ht(s);Ml.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>Ml.rel(a,n,l,c))})},OHt=(t,e)=>i=>{var r;try{mv.lazyLoad||t.$hostElement$[e](i)}catch(s){C4(s)}},IHt=(t,e)=>e&4?rg:e&8?M4:e&16?rg.body:t,$Ht=t=>DHt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,p8e=new WeakMap,n$=t=>p8e.get(t),NHt=(t,e)=>{const i={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return d8e(t,i,e.$listeners$),p8e.set(t,i)},I2e=(t,e)=>e in t,C4=(t,e)=>(0,console.error)(t,e),mH=new Map,LHt=[],M4=typeof window<"u"?window:{},rg=M4.document||{head:{}},mCi=M4.HTMLElement||class{},Ml={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,i,r)=>t.addEventListener(e,i,r),rel:(t,e,i,r)=>t.removeEventListener(e,i,r),ce:(t,e)=>new CustomEvent(t,e)},DHt=(()=>{let t=!1;try{rg.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),FHt=t=>Promise.resolve(t),kHt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),Nne=!1,Lne=[],f8e=[],m8e=(t,e)=>i=>{t.push(i),Nne||(Nne=!0,e&&Ml.$flags$&4?UHt(Dne):Ml.raf(Dne))},$2e=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(i){C4(i)}t.length=0},Dne=()=>{$2e(Lne),$2e(f8e),(Nne=Lne.length>0)&&Ml.raf(Dne)},UHt=t=>FHt().then(t),gCi=m8e(Lne,!1),BHt=m8e(f8e,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.10.0
 */function N2e(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(Kje)||t.contains(Qje)&&e?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&r(o),n=o};let n=i();r(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function zHt(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?N2e():document.addEventListener("DOMContentLoaded",()=>N2e(),{once:!0})),G8t()}const VHt=zHt;VHt();let g8e;function GHt(){try{q8t(".")}catch{W8t(Bc(kr(g8e)))}}function A4(t){const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push(t[i]?.());return e.length>0?Promise.all(e):null}g8e="components/assets";const y8e=Symbol("widget"),_8e=Symbol("widget-test-data"),jHt=[],HHt={},gH=new WeakMap;function v8e(t,e){let i=e.children;if(i?.length)for(let s=0;s<i.length;++s)i[s]=v8e(t,i[s]);else i=jHt;const r=e.vnodeSelector;if(yH(r)){const s=e.properties||HHt,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:qHt,afterUpdate:WHt,afterRemoved:b8e,parentWidget:t,widgetConstructor:r,widgetProperties:{...s,key:n,children:i}},children:void 0,text:void 0,domNode:null}}return e}function qHt(t,e,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){const o=new s(n);o.container=t,gH.set(t,o),o.afterCreate?.(o,t),r.addHandles(er(()=>b8e(t))),queueMicrotask(()=>{o[_8e].projector.renderNow()})}function WHt(t,e,i,{widgetProperties:r}){const s=gH.get(t);s&&(s.set(r),s.afterUpdate?.(s,t))}function b8e(t){const e=gH.get(t);e&&(e.afterRemoved?.(e,t),e.destroy(),gH.delete(t))}function yH(t){return typeof t=="function"&&t[y8e]}const L2e=new Set;function YHt(t){L2e.add(t),t.finally(()=>L2e.delete(t))}var w8e;const XHt="esri.widgets.Widget";let ZHt=0;function x8e(t,e){const i=Object.prototype.hasOwnProperty;for(const r in e)i.call(e,r)&&i.call(t,r)&&(t[r]!=null&&e[r]!=null&&typeof t[r]=="object"&&typeof e[r]=="object"?x8e(t[r],e[r]):t[r]=e[r]);return t}const JHt=z8t({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,s,n,o)=>{const a=e?.(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),u=f=>a?.call(n,f);n.addEventListener(c,u,l);const h=()=>n.removeEventListener(c,u,l),p=o.afterRemoved;o.afterRemoved=f=>{p?.(f),h()}}return a}},handleInterceptedEvent(t,e,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(q3e(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let gJ=!1,Na=class extends Mk(un.EventedAccessor){constructor(e,i){super(e,i),this._attached=!1,this._projector=JHt,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=CI(async()=>{if(this._messageBundleProps?.length){const l=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:c,propertyName:u})=>{if(this.destroyed)return;let h=await hPe(c);this.uiStrings&&Object.keys(this.uiStrings)&&(h=x8e(ee(h),this.uiStrings)),this[u]=h}));if(this.destroyed)return;for(const c of l)c.status==="rejected"&&oe.getLogger(this).error("widget-intl:locale-error",this.declaredClass,c.reason)}await this.loadLocale()}),GHt();const r="esri-widget-uid-"+Yq(),s=this.render.bind(this);this._trackingTarget=new dq(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const n=()=>({vnodeSelector:"div",properties:{key:`${r}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),o=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const l=s()??n(),c=l.properties??={};if(c.key??=r,yH(l.vnodeSelector)){if(!this.visible)return n()}else this.visible?c.styles||(c.styles={}):(c.class="",c.styles={display:"none"}),c.styles.display??="";let u=0;return l.children?.forEach(h=>{yH(h.vnodeSelector)||(h.properties??={},h.properties.key??=`${this.id}--${u++}`)}),v8e(this,l)};this.render=()=>{if(gJ)return o();let l=Xct(this)??null;if(l)return l;this._trackingTarget.clear(),gJ=!0;try{l=Fv(this._trackingTarget,o)}catch(c){throw oe.getLogger(this).error(c),c}finally{gJ=!1}return l&&Zct(this,l),l};const a=this.beforeFirstRender();a?this._resourcesFetch=a.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),YHt(this._resourcesFetch)}normalizeCtorArgs(e,i){const r={...e};return i&&(r.container=i),r}postInitialize(){}beforeFirstRender(){const e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(gme):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(Ge(this._trackingTarget),Ge(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,YW(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return Xq(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+ZHt++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(w8e=y8e,_8e)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(YW(this),this._projector.scheduleRender())}own(e){gAe(oe.getLogger(this),"`Widget.own()` is deprecated in favor of 'Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(e)}classes(...e){return Jct.apply(this,e)}renderNow(){YW(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles(_e(()=>this.viewModel,(i,r)=>{r&&this.removeHandles("delegated-events"),i&&cq(i)&&this.addHandles(this._delegatedEventNames.map(s=>Tv(i,s,n=>{this.emit(s,n)})),"delegated-events")},Sr)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(gme),this.scheduleRender()};this.addHandles([aPe(e),_e(()=>this.uiStrings,e),Du(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};Na[w8e]=!0,d([m()],Na.prototype,"_readyForTrueRender",void 0),d([m({value:null})],Na.prototype,"container",null),d([vi("container")],Na.prototype,"castContainer",null),d([m()],Na.prototype,"icon",null),d([m()],Na.prototype,"id",null),d([m()],Na.prototype,"label",null),d([m()],Na.prototype,"renderable",null),d([m()],Na.prototype,"uiStrings",void 0),d([m()],Na.prototype,"viewModel",void 0),d([m({value:!0})],Na.prototype,"visible",null),d([m()],Na.prototype,"key",void 0),d([m()],Na.prototype,"children",void 0),d([m()],Na.prototype,"afterCreate",void 0),d([m()],Na.prototype,"afterUpdate",void 0),d([m()],Na.prototype,"afterRemoved",void 0),Na=d([N(XHt)],Na);const DC=Na;let KG,e6=null;const JP=new Map;async function _Ci(t){e6==null&&(KG==null&&(KG=ye(()=>import("./Lyr3DWasmPerSceneView-c1e8226d.js"),["./Lyr3DWasmPerSceneView-c1e8226d.js","./ILyr3DWasmPerSceneView-b1ab6e1f.js","./WorkerHandle-ce022e20.js","./Lyr3DModule-8aa424b5.js","./makeScheduleFunction-e2d1207a.js"],import.meta.url)),e6=await KG);const e=t.view;let i=JP.get(e);return i||(i=new e6.default({view:e}),JP.set(e,i)),await i.initializeWasm(),i.add3DTilesLayerView(t)}function QHt(t){return JP.get(t)}function vCi(t){const e=t.view,i=JP.get(e);i&&i.remove3DTilesLayerView(t)<1&&(JP.delete(e),JP.size===0&&(KG=null,e6=null))}function D2e(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function KHt(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function M3(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function eqt(t){return t.type==="bing-maps"}const g_=[];let mR=class extends Fe{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new ct,this.view=null,this._allLayerViewsChange=i=>{this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const r=this.view?.allLayerViews;r&&(this.addHandles(r.map(s=>_e(()=>[s.suspended,s.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension"),r.forEach(s=>{s.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(s.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),i?.removed&&i.removed.forEach(s=>{this._pendingAttributions.delete(s),this._fetchedAttributionData.delete(s)}),this._updateAttributionItems()},this.addHandles([qa(()=>this.view?.allLayerViews,"change",i=>this._allLayerViewsChange(i),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Du(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.view?.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,i=e?.allLayerViews;if(g_.length=0,!e||!i)return void this._clear();i.forEach(s=>{if(s.suspended||!s.layer?.attributionVisible)return;const n=s.layer;if(D2e(n,"user"))return void M3(g_,s,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(s)){const a=this._fetchedAttributionData.get(s);return void(a?M3(g_,s,this._getDynamicAttribution(a,e,n)):D2e(n)&&M3(g_,s,n.copyright))}return void this._fetchAttributionData(s)}const o="portalItem"in n?n.portalItem?.accessInformation:void 0;M3(g_,s,o||n.copyright)});const r=i.find(s=>s.layer?.type==="integrated-mesh-3dtiles");if(this.view&&r){const s=QHt(this.view);if(s){const n=s.getAttributionText();for(let o=0;o<n.length;++o)M3(g_,r,n[o])}}KHt(this.items,g_)&&(this.items.removeAll(),this.items.addMany(g_)),g_.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const i=await jd(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=i.ok?this._createContributionIndex(i.value,eqt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,i){const r=e.contributors,s={};if(!r)return s;for(let n=0;n<r.length;n++){const o=r[n],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,u=l.zoomMin-(i&&l.zoomMin?1:0),h=l.zoomMax-(i&&l.zoomMax?1:0),p=new lr({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:Je.WGS84}),f={extent:JL(p),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:n};for(let g=u;g<=h;g++)s[g]??=[],s[g].push(f)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(e,i,r){const{extent:s,scale:n}=i;let o=r.tileInfo?.scaleToZoom(n)??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!s||o==null||o<=-1)return"";const a=e[o],l=Pk(s.center.clone().normalize(),i.spatialReference),c=new Set;return a?a.filter(u=>{const h=u.id,p=!c.has(h)&&l&&u.extent&&kle(u.extent,l);return p&&c.add(h),p}).sort((u,h)=>h.score-u.score||u.objectId-h.objectId).map(u=>u.attribution).join(", "):""}};d([m({readOnly:!0,type:ct})],mR.prototype,"items",void 0),d([m({readOnly:!0})],mR.prototype,"state",null),d([m()],mR.prototype,"view",void 0),mR=d([N("esri.widgets.Attribution.AttributionViewModel")],mR);const S8e=mR,af={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function tqt(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:rqt(t[e])}}}function iqt(t){const e=t?.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function rqt(t){return function(e,...i){iqt(e)?iut(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}function iC(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var sqt=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},T8e=function(t,e){for(var i=0,r=t.length;i<r;i++){var s=t[i];Array.isArray(s)?T8e(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=sqt(s)),e.push(s))}},nqt=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var s=[];return T8e(i,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function fr(t,e,...i){return typeof t!="function"||yH(t)?nqt(t,e,...i):t(e,...i)}function wCi(...t){return t}const rA="esri-attribution",sA={base:rA,poweredBy:`${rA}__powered-by`,sources:`${rA}__sources`,open:`${rA}--open`,sourcesOpen:`${rA}__sources--open`,link:`${rA}__link`};let yu=class extends DC{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new S8e}initialize(){this.addHandles(qa(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[sA.open]:this._isOpen};return fr("div",{bind:this,class:this.classes(sA.base,af.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return fr("div",{class:sA.poweredBy},"Powered by"," ",fr("a",{class:sA.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?0:void 0,{attributionText:s}=this,n={[sA.sourcesOpen]:e,[af.interactive]:i};return fr("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(sA.sources,n),innerHTML:s,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};d([m()],yu.prototype,"_isOpen",void 0),d([m()],yu.prototype,"_isInteractive",null),d([m()],yu.prototype,"_attributionTextOverflowed",void 0),d([m()],yu.prototype,"_prevSourceNodeHeight",void 0),d([m({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],yu.prototype,"attributionText",null),d([m()],yu.prototype,"icon",null),d([m()],yu.prototype,"itemDelimiter",void 0),d([m()],yu.prototype,"label",null),d([m(),iC("esri/widgets/Attribution/t9n/Attribution")],yu.prototype,"messages",void 0),d([m()],yu.prototype,"view",null),d([m({type:S8e})],yu.prototype,"viewModel",void 0),d([tqt()],yu.prototype,"_toggleState",null),yu=d([N("esri.widgets.Attribution")],yu);const oqt=yu;function aqt(t){return t?.spatialReference?.isWebMercator||t?.spatialReference?.isGeographic||!1}const lqt=t=>{let e=class extends t{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return aq(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return d([m()],e.prototype,"goToOverride",void 0),d([m()],e.prototype,"view",void 0),e=d([N("esri.widgets.support.GoTo")],e),e};let ZT=class extends lqt(Fe){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(_e(()=>this.view,this._updateRotationWatcher,Ir))}destroy(){this.view=null}get canShowNorth(){return aqt(this.view)}get state(){return!this.view?.ready||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){this.view?.ready&&(this.view?.type==="2d"?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:ae("mapview-essential-goto-duration")}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){e!=null&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this._set("orientation",{x:0,y:0,z:i})}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?_e(()=>e?.rotation,this._updateForRotation,Ir):_e(()=>e?.camera,this._updateForCamera,Ir))}};d([m({readOnly:!0})],ZT.prototype,"canShowNorth",null),d([m({readOnly:!0})],ZT.prototype,"orientation",void 0),d([m({readOnly:!0})],ZT.prototype,"state",null),d([m()],ZT.prototype,"view",void 0),ZT=d([N("esri.widgets.Compass.CompassViewModel")],ZT);const E8e=ZT,F2e="esri-compass",k2e={base:F2e,iconContainer:`${F2e}__icon-container`};let B_=class extends DC{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new E8e,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=r=>({transform:`rotateZ(${r.z}deg)`})}loadDependencies(){return A4({button:()=>ye(()=>import("./calcite-button-102b9bd3.js"),["./calcite-button-102b9bd3.js","./form-29a8328a.js","./dom-783a058e.js","./guid-076c3249.js","./interactive-c2ad4bac.js","./label-c5ecabbf.js","./component-2f26ee70.js","./loadable-e7fb2c8e.js","./t9n-e07b91d6.js","./key-3e48269c.js","./observers-c305feff.js","./icon-7bc6cd13.js","./loader-3ac12c5a.js"],import.meta.url),icon:()=>ye(()=>import("./calcite-icon-d45cf06d.js"),["./calcite-icon-d45cf06d.js","./icon-7bc6cd13.js","./dom-783a058e.js","./guid-076c3249.js","./observers-c305feff.js"],import.meta.url)})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,{messages:r}=this;return fr("div",{class:this.classes(k2e.base,af.widget)},fr("calcite-button",{class:af.widgetButton,disabled:i==="disabled",kind:"neutral",label:r.reset,onclick:this._reset,round:!0,scale:"s",title:r.reset},fr("div",{"aria-hidden":"true",class:k2e.iconContainer,title:r.reset},fr("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};d([m()],B_.prototype,"goToOverride",null),d([m()],B_.prototype,"icon",null),d([m()],B_.prototype,"label",null),d([m(),iC("esri/widgets/Compass/t9n/Compass")],B_.prototype,"messages",void 0),d([m()],B_.prototype,"view",null),d([m({type:E8e})],B_.prototype,"viewModel",void 0),B_=d([N("esri.widgets.Compass")],B_);const cqt=B_,U2e="esri-navigation-toggle",B2e={base:U2e,isLayoutHorizontal:`${U2e}--horizontal`};let gR=class extends Fe{constructor(e){super(e),this._navigationMode="pan",this.view=null}initialize(){this.addHandles(Du(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.view?.ready&&this.view?.type==="3d"?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._setNavigationMode()}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate")}_setNavigationMode(){const e=this.view?.inputManager;e&&(e.primaryDragAction=this._navigationMode==="pan"?"pan":"rotate")}};d([m({readOnly:!0})],gR.prototype,"state",null),d([m()],gR.prototype,"_navigationMode",void 0),d([m()],gR.prototype,"view",void 0),gR=d([N("esri.widgets.NavigationToggle.NavigationToggleViewModel")],gR);const C8e=gR;let z_=class extends DC{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new C8e,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{(this.viewModel?.navigationMode==="pan"?this._rotateButton:this._panButton)?.setFocus(),this.toggle()}}loadDependencies(){return A4({button:()=>ye(()=>import("./calcite-button-102b9bd3.js"),["./calcite-button-102b9bd3.js","./form-29a8328a.js","./dom-783a058e.js","./guid-076c3249.js","./interactive-c2ad4bac.js","./label-c5ecabbf.js","./component-2f26ee70.js","./loadable-e7fb2c8e.js","./t9n-e07b91d6.js","./key-3e48269c.js","./observers-c305feff.js","./icon-7bc6cd13.js","./loader-3ac12c5a.js"],import.meta.url)})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.viewModel?.state==="disabled",i=this.viewModel?.navigationMode==="pan",r=this.messages.toggle;return fr("div",{class:this.classes(B2e.base,af.widget,{[B2e.isLayoutHorizontal]:this.layout==="horizontal"})},fr("calcite-button",{afterCreate:s=>{this._panButton=s},appearance:i?"outline-fill":"solid",class:af.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?void 0:-1,title:r}),fr("calcite-button",{afterCreate:s=>{this._rotateButton=s},appearance:i?"solid":"outline-fill",class:af.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?-1:void 0,title:r}))}};d([m()],z_.prototype,"icon",null),d([m()],z_.prototype,"label",null),d([m({value:"vertical"})],z_.prototype,"layout",null),d([m(),iC("esri/widgets/NavigationToggle/t9n/NavigationToggle")],z_.prototype,"messages",void 0),d([m()],z_.prototype,"view",null),d([m({type:C8e})],z_.prototype,"viewModel",void 0),z_=d([N("esri.widgets.NavigationToggle")],z_);const uqt=z_;let JT=class extends Fe{get canZoomIn(){if(!this.view?.ready)return!1;const i=this.view?.constraints?.effectiveMaxScale;return i===0||this._scale>i}get canZoomOut(){const{view:e}=this;if(!e?.ready)return!1;const r=e.constraints?.effectiveMinScale;return r===0||this._scale<r}get _scale(){const e=this.view?.animation?.target;return(e&&"then"in e?void 0:e?.scale)??this.view?.scale??0}};d([m({readOnly:!0})],JT.prototype,"canZoomIn",null),d([m({readOnly:!0})],JT.prototype,"canZoomOut",null),d([m()],JT.prototype,"view",void 0),d([m()],JT.prototype,"_scale",null),JT=d([N("esri.widgets.Zoom.ZoomConditions2D")],JT);const hqt=JT;let yR=class extends Fe{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};d([m({readOnly:!0})],yR.prototype,"canZoomIn",null),d([m({readOnly:!0})],yR.prototype,"canZoomOut",null),d([m()],yR.prototype,"view",void 0),yR=d([N("esri.widgets.Zoom.ZoomConditions3D")],yR);const dqt=yR;let Ub=class extends Fe{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new hqt({view:e}):e.type==="3d"&&(this._zoomConditions=new dqt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():KD(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():KD(e.goTo({zoomFactor:.5}))}};d([m()],Ub.prototype,"_zoomConditions",void 0),d([m()],Ub.prototype,"canZoomIn",null),d([m()],Ub.prototype,"canZoomOut",null),d([m({readOnly:!0})],Ub.prototype,"state",null),d([m()],Ub.prototype,"view",null),Ub=d([N("esri.widgets.Zoom.ZoomViewModel")],Ub);const M8e=Ub,z2e={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"};let V_=class extends DC{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new M8e,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return A4({button:()=>ye(()=>import("./calcite-button-102b9bd3.js"),["./calcite-button-102b9bd3.js","./form-29a8328a.js","./dom-783a058e.js","./guid-076c3249.js","./interactive-c2ad4bac.js","./label-c5ecabbf.js","./component-2f26ee70.js","./loadable-e7fb2c8e.js","./t9n-e07b91d6.js","./key-3e48269c.js","./observers-c305feff.js","./icon-7bc6cd13.js","./loader-3ac12c5a.js"],import.meta.url)})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[z2e.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:r}=this.viewModel,{zoomIn:s,zoomOut:n}=this.messages;return fr("div",{class:this.classes(z2e.base,af.widget,e)},fr("calcite-button",{class:af.widgetButton,disabled:!i,iconStart:"plus",kind:"neutral",label:s,onclick:this.zoomIn,title:s}),fr("calcite-button",{class:af.widgetButton,disabled:!r,iconStart:"minus",kind:"neutral",label:n,onclick:this.zoomOut,title:n}))}};d([m()],V_.prototype,"icon",null),d([m()],V_.prototype,"label",null),d([m({value:"vertical"})],V_.prototype,"layout",null),d([m(),iC("esri/widgets/Zoom/t9n/Zoom")],V_.prototype,"messages",void 0),d([m()],V_.prototype,"view",null),d([m({type:M8e})],V_.prototype,"viewModel",void 0),V_=d([N("esri.widgets.Zoom")],V_);const pqt=V_;function fqt(t){return t?.view!==void 0}let t6=class extends L8t{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=i=>{this.components.forEach(r=>{const s=this._find(r),n=s?.widget;fqt(n)&&(n.view=i)})},this._componentsWatcher=(i,r)=>{this._removeComponents(r),this._addComponents(i),this._adjustPadding(i)}}initialize(){this.addHandles([_e(()=>this.components,this._componentsWatcher,Ir),_e(()=>this.view,this._updateViewAwareWidgets,Ir)])}_add(e,i,r,s,n){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,i,r,s,n)}_removeComponents(e){e.forEach(i=>{const r=this._find(i);r&&(this.remove(r),r.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:i}=this.padding;this.padding=i}}_addComponents(e){this.constructed&&e.forEach(i=>this.add(this._createComponent(i),this._defaultPositionLookup[i]))}_createComponent(e){const i=this._createWidget(e);return new QG({id:e,node:i})}_createWidget(e){const i=this.view;switch(e){case"attribution":return new oqt({view:i});case"compass":return new cqt({view:i});case"navigation-toggle":return new uqt({view:i});case"zoom":return new pqt({view:i})}}};d([m()],t6.prototype,"components",void 0),t6=d([N("esri.views.ui.DefaultUI")],t6);const A8e=t6;let i6=class extends A8e{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};d([m()],i6.prototype,"components",void 0),i6=d([N("esri.views.ui.3d.DefaultUI3D")],i6);const R8e=i6;let pt=class extends ict(Xdt(yut(qmt))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new jv({slicePlane:u3e},this),this._resourceController=Q4t(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new cse({view:this}),this.labeler=new GT({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new kO,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new y2,this.environment=new KA,this.environmentManager=new nm,this.floors=new ct,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Xmt({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Jkt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new R8e,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new FGe,oat();const e=(i=null)=>{i!=null&&i.type===Qr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.addHandles([qa(()=>this.map?.allLayers,"after-changes",i=>e(i),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),_e(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new mxt({view:this}),this.stateManager=new Rn({view:this})}initialize(){this.groundView=new Fdt({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(qa(()=>this.map?.allLayers,"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Ir),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Ir),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>dZe(e>0?1e3/Math.ceil(e):0),Ir),this.updatingHandles.add(()=>this.map?.ground,t,Sr),this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),Sr),this.addHandles(_e(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Mr))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Ge(this.sharedSymbolResources),this._set("labeler",Ge(this.labeler)),this._set("deconflictor",Ge(this.deconflictor)),this._resourceController=Ge(this._resourceController),this._set("stateManager",Ge(this.stateManager)),this._set("inputManager",Ge(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Ge(this.environmentManager)),this._set("environment",Ge(this.environment)),this.groundView=Ge(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){return this.stateManager?.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;const t=this.map;let e=this._userClippingArea||ame(t,"clippingArea");return!this._userClippingArea&&!ame(t,"clippingEnabled")||e==null?(this._clippingArea=null,null):e instanceof lr?this.spatialReference&&(e=XB(e,this.spatialReference),e==null)?(oe.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),e.intersection(this._groundAndLayersExtent)==null&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(oe.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?oe.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===Xe.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:XB(e,t)}get tileInfo(){return this.basemapTerrain?.tilingScheme?.toTileInfo()}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||Je.WGS84,i=XB(this.clippingArea,e);i!=null&&(t=t!=null?t.intersection(i):i);const r=this._get("dataExtent");return t!=null&&t.equals(r)?r:t}get _groundAndLayersExtent(){const t=this.spatialReference||Je.WGS84;let e;const i=n=>{const o=XB(n,t);o!=null&&(e!=null?e.union(o):e=o.clone())},r=this.basemapTerrain;if(r?.spatialReference){const n=r.groundExtent;i(new lr({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}castEnvironment(t){return t?t instanceof KA?t:t instanceof NO?this.environment?.cloneWithWebsceneEnvironment(t)??KA.fromWebsceneEnvironment(t):Tn(KA,t):new KA}get extent(){return this.stateManager?.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){IG.isValidProfile(t)&&(IG.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||IG.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");bC(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode&&!!this.stateManager?.preinit(this.spatialReference)}get resolution(){return this.spatialReference!=null?Jlt(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get terrainScale(){return this.stateManager?.terrainScale}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?$x.deriveUnitFromSR(t,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,i=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(s=>{if(s.isFulfilled()){if(s.updating){if(e=!0,s.suspended||ane(s))return;++i,t+=s.updatingProgress}}else++i});for(const s of this._updatingObjects)s!=null&&s.updating&&(i+=.1,t+=.5*.1);for(const s of this._updatingObjectsWithProgress)s!=null&&s.updating&&(++i,t+=s.updatingProgress);const r=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(s=>!s.isFulfilled())||this.textures?.updating),e?(this._numUpdating=Math.max(i,this._numUpdating),t+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const s=performance.now();if(t<1){const n=Math.min((s-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-n)+t*n}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?s:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){const t=this._predeterminedViewingMode;if(t!=null)return kW(t);const e=this.spatialReference;return e?this.defaultsFromMap?.viewingMode!=null&&e.equals(this.defaultsFromMap.spatialReference)?kW(this.defaultsFromMap.viewingMode):gF(e,Xe.Global)?"global":"local":"global"}set viewingMode(t){this.ready?oe.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new tUt(this)}on(t,e,i,r){return this.viewEvents.on(t,e,i,r)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return oe.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=Q0e(t)?J0e(this,t):t;return p4t(this,i,e,this._defaultToMapOptions)}toScreen(t){if(!this.ready)return oe.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?Wy(this.elevationProvider,t):null)??0;return lc(t,ZB,this.renderSpatialReference,e),this.state.camera.projectToScreen(ZB,yJ),hf(yJ[0],yJ[1])}pixelSizeAt(t){return this.ready?t?(lc(t,ZB,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(ZB)):0:(oe.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t,()=>this.pixelSizeAt(t)):1}hitTest(t,e){if(!this.ready)return oe.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=Q0e(t)?J0e(this,t):t;return d4t(this,i,e,this._defaultHitTestOptions)}async popupHitTest(t){return I4t(this,t)}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new j("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return uJ(i,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return hJ(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e);return[hJ(i[0],this._pixelFormat()),hJ(i[1],this._pixelFormat())]}_completeSettings(t){const e=e8t(t,this);return e.pixelRatio/=this.state.pixelRatio,s8t(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){}async takeScreenshotWithObjectAndLayerId(t){if(!ae("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e),r=uJ(i[0],e,this._pixelFormat()),s=this._completeSettings(t);return s.format="png",[r,uJ(i[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return n_e.importLayerView(t)}hasLayerViewModule(t){return n_e.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let t=C8t(this.type);const e=ae("safari");if(e&&e<9&&(t=new j("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw oe.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return t!=null?fye(t):null}getSpatialReferenceSupport(t,e){const i=this._predeterminedViewingMode;if(i!=null)return this._validateSpatialReferenceForViewingMode(t,e,i)?{constraints:this._makeSpatialReferenceConstraints(t,e,i)}:null;const r=this._validateSpatialReferenceForViewingMode(t,e,Xe.Local),s=this._validateSpatialReferenceForViewingMode(t,e,Xe.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(t,e,Xe.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,Xe.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,i){return!!gF(t,i)&&(e==null||!!rge(e)||(!KL(e)||R7(e,t,i)!=null)&&(!ige(e)||i!==Xe.Global))}_makeSpatialReferenceConstraints(t,e,i){if(e==null)return[{spatialReference:t,viewingMode:i}];const{isWebMercator:r,isWGS84:s}=t;return rge(e)&&(r||s)?!s||i===Xe.Local||npe(e.tileInfo,e.fullExtent,t,Xe.Global)===null?[{spatialReference:t,viewingMode:i},{spatialReference:Je.WebMercator,viewingMode:i}]:[{spatialReference:r?Je.WGS84:Je.WebMercator,viewingMode:i}]:KL(e)||ige(e)||!r&&!s?KL(e)&&r&&i!==Xe.Global?[{spatialReference:t,viewingMode:i},{spatialReference:Je.WGS84,viewingMode:Xe.Local}]:[{spatialReference:t,viewingMode:i}]:[{spatialReference:t,viewingMode:i},{spatialReference:r?Je.WGS84:Je.WebMercator,viewingMode:i}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport(t)!=null,i=this._predeterminedViewingMode;return e||(i!=null?oe.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${kW(i)} viewing mode.`):t.isGeographic&&oe.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}trackGraphicState(t){if(!t.graphic)return oe.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let i=null,r=!1;const s=n=>{!r&&n!=null&&"processor"in n&&n.processor?.type==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(t))};return e!=null?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),er(()=>{r=!0,i!=null&&(i.remove(),i=null)})}highlight(t){if(Array.isArray(t))return Xw(t.map(i=>this.highlight(i)));if(ct.isCollection(t))return Xw(t.toArray().map(i=>this.highlight(i)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):er()}maskOccludee(t){if(!t)return oe.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let i=null,r=!1;const s=n=>{!r&&n!=null&&v8t(n)&&(i=n.maskOccludee(t))};return e!=null?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),er(()=>{r=!0,i!=null&&(i.remove(),i=null)})}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await SO(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new j("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(i,r))})}):this.whenLayerView(t.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new zzt({view:this})),this._set("elevationProvider",new EL({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new _u({view:this})),this._set("featureTiles",new Da({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{const e=this.basemapTerrain?.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?Nx(Iq(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>ts.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(ye(()=>import("./FeatureTileTree3DDebugger-ddd4a8a0.js"),["./FeatureTileTree3DDebugger-ddd4a8a0.js","./TileTreeDebugger-aacc6bf8.js"],import.meta.url)).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&ts.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||!this._featureTreeDebugger||ts.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Sr),this.updatingHandles.add(()=>this.clippingArea,t,Sr),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Sr)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new R4t(this.map,t));const e=this.state.isGlobal,i=Zlt(e,t);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",D4t.create(this.state.viewingMode,i)),e||this.addHandles(_e(()=>this.basemapTerrain?.extent,r=>{const s=this.renderCoordsHelper.spatialReference;r==null||r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!Zq(r,this.basemapTerrain.spatialReference,V2e,s)||(this.renderCoordsHelper.extent=V2e)},Mr),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(VO/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===Qr.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(_e(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),Mr),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e,i){if(!this.overlay||!this.overlay.hasVisibleItems)return i;const r=t.getContext("2d");return r.putImageData(i,0,0),this.overlay.renderCanvas(t,{disableDecorations:e===Gc.OFF}),r.getImageData(0,0,i.width,i.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(r,s,n)=>this._renderScreenshotOverlay(r,s,n)}},e=new y4t(this.state.viewingMode,r=>this._stage.layers.forAll(r),this);this._set("sceneIntersectionHelper",e);const i=Xq(this.surface);this._stage=new nd({view:this,options:t,container:i}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,r=>this._stage.renderer.setParameters({highQualityTransparency:r}),Ir),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),Tv(this._stage.renderView.canvas,"webglcontextlost",r=>{this.fatalError=new j("webgl-context-lost",r.statusMessage)})],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(VO/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Ge(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new nUt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await ye(()=>import("./GraphicsView3D-04e6dc00.js"),["./GraphicsView3D-04e6dc00.js","./GraphicsProcessor-cee10e46.js","./Graphics3DObjectStates-867041f5.js","./optimizedFeatureQueryEngineAdapter-6cdbde2c.js","./PooledRBush-81406012.js","./quickselect-6bdb87cc.js","./popupUtils-5d416a17.js"],import.meta.url)).default;zt(t),await SO(()=>this.basemapTerrain?.ready,t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=fye(this.viewingMode);t===Xe.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(qa(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded();const e=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties:null,i=e?.environment;i&&D$e(this.environment,i),this.timeExtent=e?.timeExtent,this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new lP(this._stage,this.resourceController.scheduler));const r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach(s=>s(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",Ge(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(cx);for(const t of this.map.allLayers.items)aF(t.type)&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(cx);for(const t of this.map.allLayers.items)aF(t.type)&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}};function XB(t,e){return t!=null&&Fu(t.spatialReference,e)?Nx(t,e):null}pt.type="3d",d([m()],pt.prototype,"_userClippingArea",void 0),d([m()],pt.prototype,"_resourceController",void 0),d([m()],pt.prototype,"_stage",void 0),d([m({readOnly:!0})],pt.prototype,"deconflictor",void 0),d([m({readOnly:!0})],pt.prototype,"labeler",void 0),d([m(Gee(kO,"analyses"))],pt.prototype,"analyses",void 0),d([m({type:qO,readOnly:!0})],pt.prototype,"animation",null),d([m({readOnly:!0})],pt.prototype,"basemapTerrain",void 0),d([m({readOnly:!0})],pt.prototype,"elevationProvider",void 0),d([m()],pt.prototype,"camera",null),d([m({type:Wd})],pt.prototype,"contentCamera",null),d([m({readOnly:!0})],pt.prototype,"canvas",void 0),d([m({type:$t})],pt.prototype,"center",null),d([m({type:lr})],pt.prototype,"clippingArea",null),d([m({type:y2})],pt.prototype,"constraints",void 0),d([m({type:lr,readOnly:!0})],pt.prototype,"renderDataExtent",null),d([m({readOnly:!0})],pt.prototype,"tileInfo",null),d([m({type:lr,readOnly:!0})],pt.prototype,"dataExtent",null),d([m({type:lr,readOnly:!0})],pt.prototype,"_groundAndLayersExtent",null),d([m({type:KA})],pt.prototype,"environment",void 0),d([vi("environment")],pt.prototype,"castEnvironment",null),d([m({readOnly:!0})],pt.prototype,"environmentManager",void 0),d([m({type:lr})],pt.prototype,"extent",null),d([m()],pt.prototype,"floors",void 0),d([m()],pt.prototype,"screenCenter",null),d([m()],pt.prototype,"frustum",null),d([m({type:Number,readOnly:!0})],pt.prototype,"fullOpacity",void 0),d([m({readOnly:!0})],pt.prototype,"graphicsView",void 0),d([m({readOnly:!0})],pt.prototype,"analysisViewManager",void 0),d([m()],pt.prototype,"groundView",void 0),d([m({type:Boolean})],pt.prototype,"initialExtentRequired",null),d([m()],pt.prototype,"_defaultsFromMapSettings",null),d([m()],pt.prototype,"interacting",null),d([m()],pt.prototype,"stationary",null),d([m()],pt.prototype,"navigating",null),d([m()],pt.prototype,"map",void 0),d([m({readOnly:!0})],pt.prototype,"mapCoordsHelper",void 0),d([m()],pt.prototype,"padding",null),d([m({type:_u,readOnly:!0})],pt.prototype,"pointsOfInterest",void 0),d([m({type:Da,readOnly:!0})],pt.prototype,"featureTiles",void 0),d([m()],pt.prototype,"_featureTreeDebugger",void 0),d([m({type:Boolean})],pt.prototype,"screenSizePerspectiveEnabled",void 0),d([m({constructOnly:!0})],pt.prototype,"deactivatedWebGLExtensions",void 0),d([m({constructOnly:!0})],pt.prototype,"debugWebGLExtensions",void 0),d([m({constructOnly:!0})],pt.prototype,"renderCanvas",void 0),d([m({constructOnly:!0})],pt.prototype,"state",void 0),d([m({readOnly:!0})],pt.prototype,"inputManager",void 0),d([m({readOnly:!0})],pt.prototype,"stateManager",void 0),d([m({type:["low","medium","high"]})],pt.prototype,"qualityProfile",null),d([m({type:RSe,get(){let t=this._get("qualitySettings");return t||(t=new RSe,IG.apply(this.qualityProfile,t)),t}})],pt.prototype,"qualitySettings",void 0),d([m()],pt.prototype,"slicePlane",null),d([m({readOnly:!0})],pt.prototype,"typeSpecificPreconditionsReady",null),d([m({readOnly:!0})],pt.prototype,"renderCoordsHelper",void 0),d([m({readOnly:!0})],pt.prototype,"sceneIntersectionHelper",void 0),d([m({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],pt.prototype,"resolution",null),d([m({type:Number})],pt.prototype,"scale",null),d([m()],pt.prototype,"heightModelInfo",null),d([m()],pt.prototype,"spatialReference",void 0),d([m({type:Boolean,constructOnly:!0})],pt.prototype,"alphaCompositingEnabled",void 0),d([m({constructOnly:!0})],pt.prototype,"preserveDrawingBufferEnabled",void 0),d([m({type:Boolean})],pt.prototype,"supersampleScreenshotsEnabled",void 0),d([m({readOnly:!0})],pt.prototype,"type",void 0),d([m(),vi(t=>t instanceof A8e?t:SE(R8e,t))],pt.prototype,"ui",void 0),d([m({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],pt.prototype,"updating",null),d([m()],pt.prototype,"_updatingObjects",null),d([m()],pt.prototype,"_updatingObjectsWithProgress",null),d([m({type:Number,readOnly:!0,dependsOn:["updating"]})],pt.prototype,"updatingProgress",void 0),d([m({type:["global","local"]})],pt.prototype,"viewingMode",null),d([m({type:dg})],pt.prototype,"viewpoint",null),d([m({type:Number})],pt.prototype,"zoom",null),d([m({type:FGe})],pt.prototype,"highlightOptions",void 0),d([m({readOnly:!0})],pt.prototype,"quality",null),d([m({readOnly:!0})],pt.prototype,"resolutionScale",null),d([m()],pt.prototype,"textures",void 0),pt=d([N("esri.views.SceneView")],pt);const ZB=M(),yJ=Hs(),V2e=li(),mqt=pt;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const P8e="calcite-mode-auto",O8e="calcite-mode-dark",gqt="calcite-mode-light",Fne={autoMode:P8e,darkMode:O8e,lightMode:gqt,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};var gv={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,formAssociated:!1,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0,experimentalSlotFixes:!1},yqt=Object.defineProperty,_qt=(t,e)=>{for(var i in e)yqt(t,i,{get:e[i],enumerable:!0})},I8e=t=>{const e=new URL(t,Al.$resourcesUrl$);return e.origin!==P4.location.origin?e.href:e.pathname},vqt=t=>Al.$resourcesUrl$=t,G2e={},bqt="http://www.w3.org/2000/svg",wqt="http://www.w3.org/1999/xhtml",xqt=t=>t!=null,Npe=t=>(t=typeof t,t==="object"||t==="function");function Sqt(t){var e,i,r;return(r=(i=(e=t.head)==null?void 0:e.querySelector('meta[name="csp-nonce"]'))==null?void 0:i.getAttribute("content"))!=null?r:void 0}var Tqt={};_qt(Tqt,{err:()=>$8e,map:()=>Eqt,ok:()=>kne,unwrap:()=>Cqt,unwrapErr:()=>Mqt});var kne=t=>({isOk:!0,isErr:!1,value:t}),$8e=t=>({isOk:!1,isErr:!0,value:t});function Eqt(t,e){if(t.isOk){const i=e(t.value);return i instanceof Promise?i.then(r=>kne(r)):kne(i)}if(t.isErr){const i=t.value;return $8e(i)}throw"should never get here"}var Cqt=t=>{if(t.isOk)return t.value;throw t.value},Mqt=t=>{if(t.isErr)return t.value;throw t.value},rC=(t,e="")=>()=>{},Aqt="slot-fb{display:contents}slot-fb[hidden]{display:none}",j2e="http://www.w3.org/1999/xlink",it=(t,e,...i)=>{let r=null,s=null,n=null,o=!1,a=!1;const l=[],c=h=>{for(let p=0;p<h.length;p++)r=h[p],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof t!="function"&&!Npe(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?_H(null,r):r),a=o)};if(c(i),e){e.key&&(s=e.key),e.name&&(n=e.name);{const h=e.className||e.class;h&&(e.class=typeof h!="object"?h:Object.keys(h).filter(p=>h[p]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,Pqt);const u=_H(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=s,u.$name$=n,u},_H=(t,e)=>{const i={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return i.$attrs$=null,i.$key$=null,i.$name$=null,i},d1={},Rqt=t=>t&&t.$tag$===d1,Pqt={forEach:(t,e)=>t.map(H2e).forEach(e),map:(t,e)=>t.map(H2e).map(e).map(Oqt)},H2e=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),Oqt=t=>{if(typeof t.vtag=="function"){const i={...t.vattrs};return t.vkey&&(i.key=t.vkey),t.vname&&(i.name=t.vname),it(t.vtag,i,...t.vchildren||[])}const e=_H(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},Iqt=t=>o9t.map(e=>e(t)).find(e=>!!e),$qt=(t,e)=>t!=null&&!Npe(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,Nqt=t=>t,Une=(t,e,i)=>{const r=Nqt(t);return{emit:s=>Lqt(r,e,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s})}},Lqt=(t,e,i)=>{const r=Al.ce(e,i);return t.dispatchEvent(r),r},q2e=new WeakMap,Dqt=(t,e,i)=>{let r=wH.get(t);c9t&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=e:r.replaceSync(e)):r=e,wH.set(t,r)},Fqt=(t,e,i)=>{var r;const s=N8e(e,i),n=wH.get(s);if(t=t.nodeType===11?t:sg,n)if(typeof n=="string"){t=t.head||t;let o=q2e.get(t),a;if(o||q2e.set(t,o=new Set),!o.has(s)){{a=sg.createElement("style"),a.innerHTML=n;const l=(r=Al.$nonce$)!=null?r:Sqt(sg);l!=null&&a.setAttribute("nonce",l),t.insertBefore(a,t.querySelector("link"))}e.$flags$&4&&(a.innerHTML+=Aqt),o&&o.add(s)}}else t.adoptedStyleSheets.includes(n)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,n]);return s},kqt=t=>{const e=t.$cmpMeta$,i=t.$hostElement$,r=e.$flags$,s=rC("attachStyles",e.$tagName$),n=Fqt(i.shadowRoot?i.shadowRoot:i.getRootNode(),e,t.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},N8e=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),W2e=(t,e,i,r,s,n)=>{if(i!==r){let o=eEe(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=Y2e(i),u=Y2e(r);l.remove(...c.filter(h=>h&&!u.includes(h))),l.add(...u.filter(h=>h&&!c.includes(h)))}else if(e==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?t.style.setProperty(l,r[l]):t.style[l]=r[l])}else if(e!=="key")if(e==="ref")r&&r(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n"){if(e[2]==="-"?e=e.slice(3):eEe(P4,a)?e=a.slice(2):e=a[2]+e.slice(3),i||r){const l=e.endsWith(L8e);e=e.replace(Bqt,""),i&&Al.rel(t,e,i,l),r&&Al.ael(t,e,r,l)}}else{const l=Npe(r);if((o||l&&r!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=r;else{const u=r??"";e==="list"?o=!1:(i==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),r==null||r===!1?(r!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(j2e,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?t.setAttributeNS(j2e,e,r):t.setAttribute(e,r))}}},Uqt=/\s/,Y2e=t=>t?t.split(Uqt):[],L8e="Capture",Bqt=new RegExp(L8e+"$"),D8e=(t,e,i,r)=>{const s=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,n=t&&t.$attrs$||G2e,o=e.$attrs$||G2e;for(r of X2e(Object.keys(n)))r in o||W2e(s,r,n[r],void 0,i,e.$flags$);for(r of X2e(Object.keys(o)))W2e(s,r,n[r],o[r],i,e.$flags$)};function X2e(t){return t.includes("ref")?[...t.filter(e=>e!=="ref"),"ref"]:t}var _R,Bne,yI,Lpe=!1,vH=!1,Dpe=!1,bd=!1,bH=(t,e,i,r)=>{var s;const n=e.$children$[i];let o=0,a,l,c;if(Lpe||(Dpe=!0,n.$tag$==="slot"&&(_R&&r.classList.add(_R+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)a=n.$elm$=sg.createTextNode(n.$text$);else if(n.$flags$&1)a=n.$elm$=sg.createTextNode("");else{if(bd||(bd=n.$tag$==="svg"),a=n.$elm$=sg.createElementNS(bd?bqt:wqt,n.$flags$&2?"slot-fb":n.$tag$),bd&&n.$tag$==="foreignObject"&&(bd=!1),D8e(null,n,bd),xqt(_R)&&a["s-si"]!==_R&&a.classList.add(a["s-si"]=_R),n.$children$)for(o=0;o<n.$children$.length;++o)l=bH(t,n,o,a),l&&a.appendChild(l);n.$tag$==="svg"?bd=!1:a.tagName==="foreignObject"&&(bd=!0)}return a["s-hn"]=yI,n.$flags$&3&&(a["s-sr"]=!0,a["s-cr"]=Bne,a["s-sn"]=n.$name$||"",a["s-rf"]=(s=n.$attrs$)==null?void 0:s.ref,c=t&&t.$children$&&t.$children$[i],c&&c.$tag$===n.$tag$&&t.$elm$&&tk(t.$elm$,!1)),a},tk=(t,e)=>{Al.$flags$|=1;const i=Array.from(t.childNodes);if(t["s-sr"]&&gv.experimentalSlotFixes){let r=t;for(;r=r.nextSibling;)r&&r["s-sn"]===t["s-sn"]&&r["s-sh"]===yI&&i.push(r)}for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==yI&&s["s-ol"]&&(U8e(s).insertBefore(s,Fpe(s)),s["s-ol"].remove(),s["s-ol"]=void 0,s["s-sh"]=void 0,Dpe=!0),e&&tk(s,e)}Al.$flags$&=-2},F8e=(t,e,i,r,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===yI&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=bH(null,i,s,t),a&&(r[s].$elm$=a,o.insertBefore(a,Fpe(e))))},k8e=(t,e,i)=>{for(let r=e;r<=i;++r){const s=t[r];if(s){const n=s.$elm$;V8e(s),n&&(vH=!0,n["s-ol"]?n["s-ol"].remove():tk(n,!0),n.remove())}}},zqt=(t,e,i,r,s=!1)=>{let n=0,o=0,a=0,l=0,c=e.length-1,u=e[0],h=e[c],p=r.length-1,f=r[0],g=r[p],y,v;for(;n<=c&&o<=p;)if(u==null)u=e[++n];else if(h==null)h=e[--c];else if(f==null)f=r[++o];else if(g==null)g=r[--p];else if(JB(u,f,s))vR(u,f,s),u=e[++n],f=r[++o];else if(JB(h,g,s))vR(h,g,s),h=e[--c],g=r[--p];else if(JB(u,g,s))(u.$tag$==="slot"||g.$tag$==="slot")&&tk(u.$elm$.parentNode,!1),vR(u,g,s),t.insertBefore(u.$elm$,h.$elm$.nextSibling),u=e[++n],g=r[--p];else if(JB(h,f,s))(u.$tag$==="slot"||g.$tag$==="slot")&&tk(h.$elm$.parentNode,!1),vR(h,f,s),t.insertBefore(h.$elm$,u.$elm$),h=e[--c],f=r[++o];else{for(a=-1,l=n;l<=c;++l)if(e[l]&&e[l].$key$!==null&&e[l].$key$===f.$key$){a=l;break}a>=0?(v=e[a],v.$tag$!==f.$tag$?y=bH(e&&e[o],i,a,t):(vR(v,f,s),e[a]=void 0,y=v.$elm$),f=r[++o]):(y=bH(e&&e[o],i,o,t),f=r[++o]),y&&U8e(u.$elm$).insertBefore(y,Fpe(u.$elm$))}n>c?F8e(t,r[p+1]==null?null:r[p+1].$elm$,i,r,o,p):o>p&&k8e(e,n,c)},JB=(t,e,i=!1)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:i?!0:t.$key$===e.$key$:!1,Fpe=t=>t&&t["s-ol"]||t,U8e=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,vR=(t,e,i=!1)=>{const r=e.$elm$=t.$elm$,s=t.$children$,n=e.$children$,o=e.$tag$,a=e.$text$;let l;a===null?(bd=o==="svg"?!0:o==="foreignObject"?!1:bd,o==="slot"&&!Lpe||D8e(t,e,bd),s!==null&&n!==null?zqt(r,s,e,n,i):n!==null?(t.$text$!==null&&(r.textContent=""),F8e(r,null,e,n,0,n.length-1)):s!==null&&k8e(s,0,s.length-1),bd&&o==="svg"&&(bd=!1)):(l=r["s-cr"])?l.parentNode.textContent=a:t.$text$!==a&&(r.data=a)},B8e=t=>{const e=t.childNodes;for(const i of e)if(i.nodeType===1){if(i["s-sr"]){const r=i["s-sn"];i.hidden=!1;for(const s of e)if(s!==i){if(s["s-hn"]!==i["s-hn"]||r!==""){if(s.nodeType===1&&(r===s.getAttribute("slot")||r===s["s-sn"])||s.nodeType===3&&r===s["s-sn"]){i.hidden=!0;break}}else if(s.nodeType===1||s.nodeType===3&&s.textContent.trim()!==""){i.hidden=!0;break}}}B8e(i)}},cv=[],z8e=t=>{let e,i,r;for(const s of t.childNodes){if(s["s-sr"]&&(e=s["s-cr"])&&e.parentNode){i=e.parentNode.childNodes;const n=s["s-sn"];for(r=i.length-1;r>=0;r--)if(e=i[r],!e["s-cn"]&&!e["s-nr"]&&e["s-hn"]!==s["s-hn"]&&!gv.experimentalSlotFixes)if(Z2e(e,n)){let o=cv.find(a=>a.$nodeToRelocate$===e);vH=!0,e["s-sn"]=e["s-sn"]||n,o?(o.$nodeToRelocate$["s-sh"]=s["s-hn"],o.$slotRefNode$=s):(e["s-sh"]=s["s-hn"],cv.push({$slotRefNode$:s,$nodeToRelocate$:e})),e["s-sr"]&&cv.map(a=>{Z2e(a.$nodeToRelocate$,e["s-sn"])&&(o=cv.find(l=>l.$nodeToRelocate$===e),o&&!a.$slotRefNode$&&(a.$slotRefNode$=o.$slotRefNode$))})}else cv.some(o=>o.$nodeToRelocate$===e)||cv.push({$nodeToRelocate$:e})}s.nodeType===1&&z8e(s)}},Z2e=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",V8e=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(V8e)},Vqt=(t,e,i=!1)=>{var r,s,n,o,a;const l=t.$hostElement$,c=t.$cmpMeta$,u=t.$vnode$||_H(null,null),h=Rqt(e)?e:it(null,null,e);if(yI=l.tagName,c.$attrsToReflect$&&(h.$attrs$=h.$attrs$||{},c.$attrsToReflect$.map(([p,f])=>h.$attrs$[f]=l[p])),i&&h.$attrs$)for(const p of Object.keys(h.$attrs$))l.hasAttribute(p)&&!["key","ref","style","class"].includes(p)&&(h.$attrs$[p]=l[p]);h.$tag$=null,h.$flags$|=4,t.$vnode$=h,h.$elm$=u.$elm$=l.shadowRoot||l,_R=l["s-sc"],Lpe=(c.$flags$&1)!==0,Bne=l["s-cr"],vH=!1,vR(u,h,i);{if(Al.$flags$|=1,Dpe){z8e(h.$elm$);for(const p of cv){const f=p.$nodeToRelocate$;if(!f["s-ol"]){const g=sg.createTextNode("");g["s-nr"]=f,f.parentNode.insertBefore(f["s-ol"]=g,f)}}for(const p of cv){const f=p.$nodeToRelocate$,g=p.$slotRefNode$;if(g){const y=g.parentNode;let v=g.nextSibling;{let b=(r=f["s-ol"])==null?void 0:r.previousSibling;for(;b;){let w=(s=b["s-nr"])!=null?s:null;if(w&&w["s-sn"]===f["s-sn"]&&y===w.parentNode){for(w=w.nextSibling;w===f||w?.["s-sr"];)w=w?.nextSibling;if(!w||!w["s-nr"]){v=w;break}}b=b.previousSibling}}(!v&&y!==f.parentNode||f.nextSibling!==v)&&f!==v&&(!f["s-hn"]&&f["s-ol"]&&(f["s-hn"]=f["s-ol"].parentNode.nodeName),y.insertBefore(f,v),f.nodeType===1&&(f.hidden=(n=f["s-ih"])!=null?n:!1)),f&&typeof g["s-rf"]=="function"&&g["s-rf"](f)}else f.nodeType===1&&(i&&(f["s-ih"]=(o=f.hidden)!=null?o:!1),f.hidden=!0)}}vH&&B8e(h.$elm$),Al.$flags$&=-2,cv.length=0}if(gv.experimentalScopedSlotChanges&&c.$flags$&2)for(const p of h.$elm$.childNodes)p["s-hn"]!==yI&&!p["s-sh"]&&(i&&p["s-ih"]==null&&(p["s-ih"]=(a=p.hidden)!=null?a:!1),p.hidden=!0);Bne=void 0},Gqt=(t,e)=>{},kpe=(t,e)=>(t.$flags$|=16,Gqt(t,t.$ancestorComponent$),d9t(()=>jqt(t,e))),jqt=(t,e)=>{const i=t.$hostElement$,r=rC("scheduleUpdate",t.$cmpMeta$.$tagName$),s=i;let n;return e?n=QP(s,"componentWillLoad"):n=QP(s,"componentWillUpdate"),n=J2e(n,()=>QP(s,"componentWillRender")),r(),J2e(n,()=>qqt(t,s,e))},J2e=(t,e)=>Hqt(t)?t.then(e):e(),Hqt=t=>t instanceof Promise||t&&t.then&&typeof t.then=="function",qqt=async(t,e,i)=>{const r=t.$hostElement$,s=rC("update",t.$cmpMeta$.$tagName$);r["s-rc"],i&&kqt(t);const n=rC("render",t.$cmpMeta$.$tagName$);Wqt(t,e,r,i),n(),s(),Yqt(t)},Q2e=null,Wqt=(t,e,i,r)=>{try{Q2e=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(gv.hasRenderFn||gv.reflect)&&(gv.vdomRender||gv.reflect)&&(gv.hydrateServerSide||Vqt(t,e,r))}catch(l){R4(l,t.$hostElement$)}return Q2e=null,null},Yqt=t=>{const e=t.$cmpMeta$.$tagName$,i=t.$hostElement$,r=rC("postUpdate",e),s=i;t.$ancestorComponent$,QP(s,"componentDidRender"),t.$flags$&64?(QP(s,"componentDidUpdate"),r()):(t.$flags$|=64,QP(s,"componentDidLoad"),r())},I7=t=>{{const e=o$(t),i=e.$hostElement$.isConnected;return i&&(e.$flags$&18)===2&&kpe(e,!1),i}},QP=(t,e,i)=>{if(t&&t[e])try{return t[e](i)}catch(r){R4(r)}},Xqt=(t,e)=>o$(t).$instanceValues$.get(e),Zqt=(t,e,i,r)=>{const s=o$(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;i=$qt(i,r.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(e,i);{if(r.$watchers$&&a&128){const h=r.$watchers$[e];h&&h.map(p=>{try{l[p](i,o,e)}catch(f){R4(f,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,e)===!1)return;kpe(s,!1)}}}},Jqt=(t,e,i)=>{var r;const s=t.prototype;if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const n=Object.entries(e.$members$);n.map(([o,[a]])=>{(a&31||a&32)&&Object.defineProperty(s,o,{get(){return Xqt(this,o)},set(l){Zqt(this,o,l,e)},configurable:!0,enumerable:!0})});{const o=new Map;s.attributeChangedCallback=function(a,l,c){Al.jmp(()=>{var u;const h=o.get(a);if(this.hasOwnProperty(h))c=this[h],delete this[h];else{if(s.hasOwnProperty(h)&&typeof this[h]=="number"&&this[h]==c)return;if(h==null){const p=o$(this),f=p?.$flags$;if(f&&!(f&8)&&f&128&&c!==l){const y=this,v=(u=e.$watchers$)==null?void 0:u[a];v?.forEach(b=>{y[b]!=null&&y[b].call(y,c,l,a)})}return}}this[h]=c===null&&typeof this[h]=="boolean"?!1:c})},t.observedAttributes=Array.from(new Set([...Object.keys((r=e.$watchers$)!=null?r:{}),...n.filter(([a,l])=>l[0]&15).map(([a,l])=>{var c;const u=l[1]||a;return o.set(u,a),l[0]&512&&((c=e.$attrsToReflect$)==null||c.push([a,u])),u})]))}}return t},Qqt=async(t,e,i,r)=>{let s;if(!(e.$flags$&32)&&(e.$flags$|=32,i.$lazyBundleId$,s=t.constructor,customElements.whenDefined(i.$tagName$).then(()=>e.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[e.$modeName$=Iqt(t)]);const a=N8e(i,e.$modeName$);if(!wH.has(a)){const l=rC("registerStyles",i.$tagName$);Dqt(a,o,!!(i.$flags$&1)),l()}}e.$ancestorComponent$,(()=>kpe(e,!0))()},K2e=t=>{},Kqt=t=>{if(!(Al.$flags$&1)){const e=o$(t),i=e.$cmpMeta$,r=rC("connectedCallback",i.$tagName$);e.$flags$&1?(j8e(t,e,i.$listeners$),e?.$lazyInstance$?K2e(e.$lazyInstance$):e?.$onReadyPromise$&&e.$onReadyPromise$.then(()=>K2e(e.$lazyInstance$))):(e.$flags$|=1,i.$flags$&12&&e9t(t),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),Qqt(t,e,i)),r()}},e9t=t=>{const e=t["s-cr"]=sg.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},t9t=async t=>{if(!(Al.$flags$&1)){const e=o$(t);e.$rmListeners$&&(e.$rmListeners$.map(i=>i()),e.$rmListeners$=void 0)}},H0=(t,e)=>{const i={$flags$:e[0],$tagName$:e[1]};i.$members$=e[2],i.$listeners$=e[3],i.$watchers$=t.$watchers$,i.$attrsToReflect$=[];const r=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){n9t(this,i)},connectedCallback(){Kqt(this),r&&r.call(this)},disconnectedCallback(){t9t(this),s&&s.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)})}}),t.is=i.$tagName$,Jqt(t,i)},G8e=(t,e)=>e,j8e=(t,e,i,r)=>{i&&i.map(([s,n,o])=>{const a=r9t(t,s),l=i9t(e,o),c=s9t(s);Al.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>Al.rel(a,n,l,c))})},i9t=(t,e)=>i=>{try{gv.lazyLoad||t.$hostElement$[e](i)}catch(r){R4(r)}},r9t=(t,e)=>e&4?sg:e&8?P4:e&16?sg.body:t,s9t=t=>a9t?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,H8e=new WeakMap,o$=t=>H8e.get(t),n9t=(t,e)=>{const i={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return j8e(t,i,e.$listeners$),H8e.set(t,i)},eEe=(t,e)=>e in t,R4=(t,e)=>(0,console.error)(t,e),wH=new Map,o9t=[],P4=typeof window<"u"?window:{},sg=P4.document||{head:{}},q0=P4.HTMLElement||class{},Al={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,i,r)=>t.addEventListener(e,i,r),rel:(t,e,i,r)=>t.removeEventListener(e,i,r),ce:(t,e)=>new CustomEvent(t,e)},a9t=(()=>{let t=!1;try{sg.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),l9t=t=>Promise.resolve(t),c9t=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),zne=!1,tEe=[],q8e=[],u9t=(t,e)=>i=>{t.push(i),zne||(zne=!0,e&&Al.$flags$&4?h9t(Vne):Al.raf(Vne))},iEe=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(i){R4(i)}t.length=0},Vne=()=>{iEe(tEe),iEe(q8e),(zne=tEe.length>0)&&Al.raf(Vne)},h9t=t=>l9t().then(t),d9t=u9t(q8e,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */function rEe(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(O8e)||t.contains(P8e)&&e?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&r(o),n=o};let n=i();r(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function p9t(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?rEe():document.addEventListener("DOMContentLoaded",()=>rEe(),{once:!0}))}const f9t=p9t;f9t();let G_=class extends Fe{constructor(e){super(e),this._vendorInfo=null,this._fullscreenStyle="width: 100%; height: 100%;",this.view=null,this._errorHandler=this._errorHandler.bind(this),this._stateHandler=this._stateHandler.bind(this)}destroy(){this._removeFullscreenListeners(),this.view=null}get element(){return this.view?.container??null}set element(e){this._override("element",e)}get state(){return this.element?this._isSupported()?this._isActive()?"active":"ready":"feature-unsupported":"disabled"}enter(){this._enterFullscreen()}exit(){this._exitFullscreen()}toggle(){this._isActive()?this._exitFullscreen():this._enterFullscreen()}_isSupported(){this._removeFullscreenListeners();const e=this._getVendorInfo(this.element);return this._addFullscreenListeners(e),this._vendorInfo=e,!!e}_isActive(){return!!this._vendorInfo&&!!document[this._vendorInfo.propertyName]}_stateHandler(){this.notifyChange("state"),this.state==="active"?this._addStyle():this._removeStyle()}_errorHandler(e){oe.getLogger(this).error("fullscreen request failed",e)}_getVendorInfo(e){if(e)return e.requestFullscreen?{enterName:"requestFullscreen",exitName:"exitFullscreen",errorEventName:"fullscreenerror",changeEventName:"fullscreenchange",propertyName:"fullscreen"}:e.webkitRequestFullScreen?{enterName:"webkitRequestFullscreen",exitName:"webkitCancelFullScreen",errorEventName:"webkitfullscreenerror",changeEventName:"webkitfullscreenchange",propertyName:"webkitIsFullScreen"}:e.mozRequestFullScreen?{enterName:"mozRequestFullScreen",exitName:"mozCancelFullScreen",errorEventName:"mozfullscreenerror",changeEventName:"mozfullscreenchange",propertyName:"mozFullScreen"}:void 0}_enterFullscreen(){if(this.state==="feature-unsupported")return void oe.getLogger(this).warn("The fullscreen API is not supported in this browser.");const{element:e}=this;e&&(this._vendorInfo&&e[this._vendorInfo.enterName].call(e),this.notifyChange("state"))}_addStyle(){const{element:e}=this;e&&e.setAttribute("style",this._fullscreenStyle)}_removeStyle(){const{element:e}=this;e&&e.removeAttribute("style")}_exitFullscreen(){if(this.state==="feature-unsupported")return;const{element:e}=this;e&&(this._vendorInfo&&document[this._vendorInfo.exitName].call(document),this.notifyChange("state"))}_addFullscreenListeners(e){e&&(document.addEventListener(e.changeEventName,this._stateHandler),document.addEventListener(e.errorEventName,this._errorHandler))}_removeFullscreenListeners(){const{_vendorInfo:e}=this;e&&(document.removeEventListener(e.changeEventName,this._stateHandler),document.removeEventListener(e.errorEventName,this._errorHandler))}};d([m()],G_.prototype,"element",null),d([m({readOnly:!0})],G_.prototype,"state",null),d([m()],G_.prototype,"view",void 0),d([m()],G_.prototype,"enter",null),d([m()],G_.prototype,"exit",null),d([m()],G_.prototype,"toggle",null),G_=d([N("esri.widgets.Fullscreen.FullscreenViewModel")],G_);const W8e=G_,m9t={base:"esri-fullscreen"};let vy=class extends DC{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new W8e,this._toggle=()=>{this.viewModel.toggle()}}loadDependencies(){return A4({button:()=>ye(()=>import("./calcite-button-102b9bd3.js"),["./calcite-button-102b9bd3.js","./form-29a8328a.js","./dom-783a058e.js","./guid-076c3249.js","./interactive-c2ad4bac.js","./label-c5ecabbf.js","./component-2f26ee70.js","./loadable-e7fb2c8e.js","./t9n-e07b91d6.js","./key-3e48269c.js","./observers-c305feff.js","./icon-7bc6cd13.js","./loader-3ac12c5a.js"],import.meta.url)})}get element(){return this.viewModel.element}set element(e){this.viewModel.element=e}get fullscreenTitle(){const e=this.viewModel?.state;return e==="active"?this.messages.exit:e==="ready"?this.messages.enter:""}get icon(){const e=this.viewModel?.state;return e==="ready"||e==="disabled"||e==="feature-unsupported"?"zoom-out-fixed":"zoom-in-fixed"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const{fullscreenTitle:e,icon:i}=this,r=this.viewModel?.state,s=r==="feature-unsupported";return fr("div",{class:this.classes(m9t.base,af.widget)},!s&&fr("calcite-button",{class:af.widgetButton,disabled:r==="disabled",iconStart:i,kind:"neutral",label:e,onclick:this._toggle,title:e}))}};d([m()],vy.prototype,"element",null),d([m({readOnly:!0})],vy.prototype,"fullscreenTitle",null),d([m()],vy.prototype,"icon",null),d([m()],vy.prototype,"label",null),d([m(),iC("esri/widgets/Fullscreen/t9n/Fullscreen")],vy.prototype,"messages",void 0),d([m()],vy.prototype,"view",null),d([m({type:W8e})],vy.prototype,"viewModel",void 0),vy=d([N("esri.widgets.Fullscreen")],vy);const g9t=vy;var y9t=Object.defineProperty,_9t=Object.getOwnPropertyDescriptor,v9t=(t,e,i,r)=>{for(var s=r>1?void 0:r?_9t(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&y9t(e,i,s),s};let xH=class extends DC{constructor(t){super(t)}};xH=v9t([N("arcgis-core-template..Widget")],xH);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */function b9t(t){return t.map(e=>{let i="";for(let r=0;r<e;r++)i+=((1+Math.random())*65536|0).toString(16).substring(1);return i}).join("-")}const Y8e=()=>b9t([2,1,1,1,3]);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */function w9t(t){return FC(t,`.${Fne.darkMode}, .${Fne.lightMode}`)?.classList.contains("calcite-mode-dark")?"dark":"light"}function X8e(t){const e="dir",i=`[${e}]`,r=FC(t,i);return r?r.getAttribute(e):"ltr"}function Z8e(t){return t.getRootNode()}function J8e(t){return t.host||null}function Q8e(t,{selector:e,id:i}){function r(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=Z8e(s),o=i?"getElementById"in n?n.getElementById(i):null:e?n.querySelector(e):null,a=J8e(n);return o||(a?r(a):null)}return r(t)}function FC(t,e){function i(r){return r?r.closest(e)||i(J8e(Z8e(r))):null}return i(t)}function x9t(t,e){return K8e(t,e)}function K8e(t,e){if(!t)return;const i=e(t);if(i!==void 0)return i;const{parentNode:r}=t;return K8e(r instanceof ShadowRoot?r.host:r,e)}function S9t(t,e){return!!x9t(e,i=>i===t?!0:void 0)}function T9t(t){return typeof t?.setFocus=="function"}async function eHe(t){if(t)return T9t(t)?t.setFocus():t.focus()}function GD(t){return(!!t).toString()}function y_(t){return!!Upe(t).length}function Upe(t){return t.target.assignedElements({flatten:!0})}const QB=(t,e,i,r=!0)=>{const s=t.indexOf(e),n=s===0,o=s===t.length-1;r&&(i=i==="previous"&&n?"last":i==="next"&&o?"first":i);let a;return i==="previous"?a=t[s-1]||t[r?t.length-1:s]:i==="next"?a=t[s+1]||t[r?0:s]:i==="last"?a=t[t.length-1]:a=t[0],eHe(a),a};function E9t(t,e){if(t.parentNode!==e.parentNode)return!1;const i=Array.from(t.parentNode.children);return i.indexOf(t)<i.indexOf(e)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */function C9t(){return navigator.userAgentData}function M9t(){const t=C9t();return t?.brands?t.brands.map(({brand:e,version:i})=>`${e}/${i}`).join(" "):navigator.userAgent}const kC=/firefox/i.test(M9t()),mE=kC?new WeakMap:null;function A9t(){const{disabled:t}=this;t||HTMLElement.prototype.click.call(this)}function tHe(t){const e=t.target;if(kC&&!mE.get(e))return;const{disabled:i}=e;i&&t.preventDefault()}const iHe=["mousedown","mouseup","click"];function rHe(t){const e=t.target;kC&&!mE.get(e)||e.disabled&&(t.stopImmediatePropagation(),t.preventDefault())}const SH={capture:!0};function sHe(t){if(t.disabled){t.el.setAttribute("aria-disabled","true"),t.el.contains(document.activeElement)&&document.activeElement.blur(),nHe(t);return}oHe(t),t.el.removeAttribute("aria-disabled")}function nHe(t){if(t.el.click=A9t,kC){const e=R9t(t),i=mE.get(t.el);i!==e&&(Gne(i),mE.set(t.el,e)),sEe(mE.get(t.el));return}sEe(t.el)}function sEe(t){t&&(t.addEventListener("pointerdown",tHe,SH),iHe.forEach(e=>t.addEventListener(e,rHe,SH)))}function R9t(t){return t.el.parentElement||t.el}function oHe(t){if(delete t.el.click,kC){Gne(mE.get(t.el)),mE.delete(t.el);return}Gne(t.el)}function Gne(t){t&&(t.removeEventListener("pointerdown",tHe,SH),iHe.forEach(e=>t.removeEventListener(e,rHe,SH)))}function aHe(t){!t.disabled||!kC||nHe(t)}function lHe(t){kC&&oHe(t)}const P9t={container:"interaction-container"};function cHe({disabled:t},e){return it("div",{class:P9t.container,inert:t},...e)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const uHe=new WeakMap,hHe=new WeakMap;function UC(t){hHe.set(t,new Promise(e=>uHe.set(t,e)))}function BC(t){uHe.get(t)()}function O9t(t){return hHe.get(t)}async function zC(t){return await O9t(t),I7(t),new Promise(e=>requestAnimationFrame(()=>e()))}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */function ik(t,e,i){const r=I9t(t);return new r(e,i)}function I9t(t){class e extends window.MutationObserver{constructor(r){super(r),this.observedEntry=[],this.callback=r}observe(r,s){return this.observedEntry.push({target:r,options:s}),super.observe(r,s)}unobserve(r){const s=this.observedEntry.filter(n=>n.target!==r);this.observedEntry=[],this.callback(super.takeRecords(),this),this.disconnect(),s.forEach(n=>this.observe(n.target,n.options))}}return function(){return t==="intersection"?window.IntersectionObserver:t==="mutation"?e:window.ResizeObserver}()}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const $9t=new RegExp("\\.(0+)?$"),N9t=new RegExp("0+$");class Vs{constructor(e){if(e instanceof Vs)return e;const[i,r]=D9t(e).split(".").concat("");this.value=BigInt(i+r.padEnd(Vs.DECIMALS,"0").slice(0,Vs.DECIMALS))+BigInt(Vs.ROUNDED&&r[Vs.DECIMALS]>="5"),this.isNegative=e.charAt(0)==="-"}getIntegersAndDecimals(){const e=this.value.toString().replace("-","").padStart(Vs.DECIMALS+1,"0"),i=e.slice(0,-Vs.DECIMALS),r=e.slice(-Vs.DECIMALS).replace(N9t,"");return{integers:i,decimals:r}}toString(){const{integers:e,decimals:i}=this.getIntegersAndDecimals();return`${this.isNegative?"-":""}${e}${i.length?"."+i:""}`}formatToParts(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),s=e.numberFormatter.formatToParts(BigInt(i));return this.isNegative&&s.unshift({type:"minusSign",value:e.minusSign}),r.length&&(s.push({type:"decimal",value:e.decimal}),r.split("").forEach(n=>s.push({type:"fraction",value:n}))),s}format(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),s=`${this.isNegative?e.minusSign:""}${e.numberFormatter.format(BigInt(i))}`,n=r.length?`${e.decimal}${r.split("").map(o=>e.numberFormatter.format(Number(o))).join("")}`:"";return`${s}${n}`}add(e){return Vs.fromBigInt(this.value+new Vs(e).value)}subtract(e){return Vs.fromBigInt(this.value-new Vs(e).value)}multiply(e){return Vs._divRound(this.value*new Vs(e).value,Vs.SHIFT)}divide(e){return Vs._divRound(this.value*Vs.SHIFT,new Vs(e).value)}}Vs.DECIMALS=100;Vs.ROUNDED=!0;Vs.SHIFT=BigInt("1"+"0".repeat(Vs.DECIMALS));Vs._divRound=(t,e)=>Vs.fromBigInt(t/e+(Vs.ROUNDED?t*BigInt(2)/e%BigInt(2):BigInt(0)));Vs.fromBigInt=t=>Object.assign(Object.create(Vs.prototype),{value:t,isNegative:t<BigInt(0)});const L9t=/^([-0])0+(?=\d)/;function D9t(t){const e=t.split(/[eE]/);if(e.length===1)return t;const i=+t;if(Number.isSafeInteger(i))return`${i}`;const r=t.charAt(0)==="-",s=+e[1],n=e[0].split("."),o=(r?n[0].substring(1):n[0])||"",a=n[1]||"",l=(h,p)=>{const f=Math.abs(p)-h.length,g=f>0?`${"0".repeat(f)}${h}`:h;return`${g.slice(0,p)}.${g.slice(p)}`},c=(h,p)=>{const f=p>h.length?`${h}${"0".repeat(p-h.length)}`:h;return`${f.slice(0,p)}.${f.slice(p)}`},u=s>0?`${o}${c(a,s)}`:`${l(o,s)}${a}`;return`${r?"-":""}${u.charAt(0)==="."?"0":""}${u.replace($9t,"").replace(L9t,"")}`}const sC="en",F9t=["ar","bg","bs","ca","cs","da","de","el",sC,"es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","no","nl","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"],k9t=["ar","bg","bs","ca","cs","da","de","de-AT","de-CH","el",sC,"en-AU","en-CA","en-GB","es","es-MX","et","fi","fr","fr-CH","he","hi","hr","hu","id","it","it-CH","ja","ko","lt","lv","mk","no","nl","pl","pt","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"];new Intl.NumberFormat().resolvedOptions().numberingSystem;function U9t(t,e="cldr"){const i=e==="cldr"?k9t:F9t;return t?i.includes(t)?t:(t=t.toLowerCase(),t==="nb"?"no":e==="t9n"&&t==="pt"?"pt-BR":(t.includes("-")&&(t=t.replace(/(\w+)-(\w+)/,(r,s,n)=>`${s}-${n.toUpperCase()}`),i.includes(t)||(t=t.split("-")[0])),t==="zh"?"zh-CN":i.includes(t)?t:(console.warn(`Translations for the "${t}" locale are not available and will fall back to the default, English (en).`),sC))):sC}const rk=new Set;function $7(t){B9t(t),rk.size===0&&dHe?.observe(document.documentElement,{attributes:!0,attributeFilter:["lang"],subtree:!0}),rk.add(t)}function B9t(t){t.effectiveLocale=z9t(t)}function N7(t){rk.delete(t),rk.size===0&&dHe.disconnect()}const dHe=ik("mutation",t=>{t.forEach(e=>{const i=e.target;rk.forEach(r=>{if(!S9t(i,r.el))return;const n=FC(r.el,"[lang]");if(!n){r.effectiveLocale=sC;return}const o=n.lang;r.effectiveLocale=n.hasAttribute("lang")&&o===""?sC:o})})});function z9t(t){return t.el.lang||FC(t.el,"[lang]")?.lang||document.documentElement.lang||sC}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */function jne(t){return t==="l"?"m":"s"}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const KB={};async function V9t(t,e){const i=`${e}_${t}`;return KB[i]||(KB[i]=fetch(I8e(`./assets/${e}/t9n/messages_${t}.json`)).then(r=>(r.ok||nEe(),r.json())).catch(()=>nEe())),KB[i]}function nEe(){throw new Error("could not fetch component message bundle")}function Bpe(t){t.messages={...t.defaultMessages,...t.messageOverrides}}async function L7(t){t.defaultMessages=await pHe(t,t.effectiveLocale),Bpe(t)}async function pHe(t,e){const{el:i}=t,s=i.tagName.toLowerCase().replace("calcite-","");return V9t(U9t(e,"t9n"),s)}async function D7(t,e){t.defaultMessages=await pHe(t,e),Bpe(t)}function F7(t){t.onMessagesChange=G9t}function k7(t){t.onMessagesChange=void 0}function G9t(){Bpe(this)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const j9t={icon:"icon",flipRtl:"flip-rtl"},_J={},vJ={},fHe={s:16,m:24,l:32};async function H9t({icon:t,scale:e}){const i=fHe[e],r=q9t(t),s=r.charAt(r.length-1)==="F",o=`${s?r.substring(0,r.length-1):r}${i}${s?"F":""}`;if(_J[o])return _J[o];vJ[o]||(vJ[o]=fetch(I8e(`./assets/icon/${o}.json`)).then(l=>l.json()).catch(()=>(console.error(`"${o}" is not a valid calcite-ui-icon name`),"")));const a=await vJ[o];return _J[o]=a,a}function q9t(t){const e=!isNaN(Number(t.charAt(0))),i=t.split("-");if(i.length>0){const s=/[a-z]/i;t=i.map((n,o)=>n.replace(s,function(l,c){return o===0&&c===0?l:l.toUpperCase()})).join("")}return e?`i${t}`:t}const W9t=":host{display:inline-flex;color:var(--calcite-ui-icon-color)}:host([scale=s]){inline-size:16px;block-size:16px;min-inline-size:16px;min-block-size:16px}:host([scale=m]){inline-size:24px;block-size:24px;min-inline-size:24px;min-block-size:24px}:host([scale=l]){inline-size:32px;block-size:32px;min-inline-size:32px;min-block-size:32px}.flip-rtl{transform:scaleX(-1)}.svg{display:block}:host([hidden]){display:none}[hidden]{display:none}",Y9t=W9t,X9t=H0(class extends q0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.icon=null,this.flipRtl=!1,this.scale="m",this.textLabel=void 0,this.pathData=void 0,this.visible=!1}connectedCallback(){this.waitUntilVisible(()=>{this.visible=!0,this.loadIconPathData()})}disconnectedCallback(){this.intersectionObserver?.disconnect(),this.intersectionObserver=null}async componentWillLoad(){this.loadIconPathData()}render(){const{el:e,flipRtl:i,pathData:r,scale:s,textLabel:n}=this,o=X8e(e),a=fHe[s],l=!!n,c=[].concat(r||"");return it(d1,{key:"5eb4d26c41c6df7a4fe28e6647a452d4a91106a2","aria-hidden":GD(!l),"aria-label":l?n:null,role:l?"img":null},it("svg",{key:"cd87fba0ba564d4a16ca5f18176d99b1f974b8fa","aria-hidden":"true",class:{[j9t.flipRtl]:o==="rtl"&&i,svg:!0},fill:"currentColor",height:"100%",viewBox:`0 0 ${a} ${a}`,width:"100%",xmlns:"http://www.w3.org/2000/svg"},c.map(u=>typeof u=="string"?it("path",{d:u}):it("path",{d:u.d,opacity:"opacity"in u?u.opacity:1}))))}async loadIconPathData(){const{icon:e,scale:i,visible:r}=this;if(!e||!r)return;const s=await H9t({icon:e,scale:i});e===this.icon&&(this.pathData=s)}waitUntilVisible(e){if(this.intersectionObserver=ik("intersection",i=>{i.forEach(r=>{r.isIntersecting&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,e())})},{rootMargin:"50px"}),!this.intersectionObserver){e();return}this.intersectionObserver.observe(this.el)}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{icon:["loadIconPathData"],scale:["loadIconPathData"]}}static get style(){return Y9t}},[1,"calcite-icon",{icon:[513],flipRtl:[516,"flip-rtl"],scale:[513],textLabel:[1,"text-label"],pathData:[32],visible:[32]},void 0,{icon:["loadIconPathData"],scale:["loadIconPathData"]}]);function Jx(){if(typeof customElements>"u")return;["calcite-icon"].forEach(e=>{switch(e){case"calcite-icon":customElements.get(e)||customElements.define(e,X9t);break}})}Jx();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const Z9t='@charset "UTF-8";@media (prefers-reduced-motion: reduce){:root{--calcite-internal-duration-factor:0}}:host{position:relative;margin-inline:auto;display:none;align-items:center;justify-content:center;opacity:1;min-block-size:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke:var(--calcite-color-brand);stroke-width:3;fill:none;transform:scale(1, 1);animation:loader-color-shift calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 2 / var(--calcite-internal-duration-factor)) alternate-reverse infinite linear;padding-block:var(--calcite-loader-padding, 4rem);will-change:contents}:host([scale=s]){--calcite-loader-font-size:var(--calcite-font-size--2);--calcite-loader-size:2rem;--calcite-loader-size-inline:0.75rem}:host([scale=m]){--calcite-loader-font-size:var(--calcite-font-size-0);--calcite-loader-size:4rem;--calcite-loader-size-inline:1rem}:host([scale=l]){--calcite-loader-font-size:var(--calcite-font-size-2);--calcite-loader-size:6rem;--calcite-loader-size-inline:1.5rem}:host([no-padding]){padding-block:0px}:host{display:flex}.loader__text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;color:var(--calcite-color-text-1);margin-block-start:calc(var(--calcite-loader-size) + 1.5rem)}.loader__percentage{position:absolute;display:block;text-align:center;color:var(--calcite-color-text-1);font-size:var(--calcite-loader-font-size);inline-size:var(--calcite-loader-size);inset-inline-start:50%;margin-inline-start:calc(var(--calcite-loader-size) / 2 * -1);line-height:0.25;transform:scale(1, 1)}.loader__svgs{position:absolute;overflow:visible;opacity:1;inline-size:var(--calcite-loader-size);block-size:var(--calcite-loader-size);inset-inline-start:50%;margin-inline-start:calc(var(--calcite-loader-size) / 2 * -1);animation-iteration-count:infinite;animation-timing-function:linear;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 6.66 / var(--calcite-internal-duration-factor));animation-name:loader-clockwise}.loader__svg{position:absolute;inset-block-start:0px;transform-origin:center;overflow:visible;inset-inline-start:0;inline-size:var(--calcite-loader-size);block-size:var(--calcite-loader-size);animation-iteration-count:infinite;animation-timing-function:linear}.loader__svg--1{animation-name:loader-offset-1}.loader__svg--2{animation-name:loader-offset-2}.loader__svg--3{animation-name:loader-offset-3}:host([type=determinate]){animation:none;stroke:var(--calcite-color-border-3)}:host([type=determinate]) .loader__svgs{animation:none}:host([type=determinate]) .loader__svg--3{animation:none;stroke:var(--calcite-color-brand);stroke-dasharray:150.79632;transform:rotate(-90deg);transition:all var(--calcite-internal-animation-timing-fast) linear}:host([inline]){position:relative;margin:0px;animation:none;stroke:currentColor;stroke-width:2;padding-block:0px;block-size:var(--calcite-loader-size-inline);min-block-size:var(--calcite-loader-size-inline);inline-size:var(--calcite-loader-size-inline);margin-inline-end:calc(var(--calcite-loader-size-inline) * 0.5);vertical-align:calc(var(--calcite-loader-size-inline) * -1 * 0.2)}:host([inline]) .loader__svgs{inset-block-start:0px;margin:0px;inset-inline-start:0;inline-size:var(--calcite-loader-size-inline);block-size:var(--calcite-loader-size-inline)}:host([inline]) .loader__svg{inline-size:var(--calcite-loader-size-inline);block-size:var(--calcite-loader-size-inline)}:host([complete]){opacity:0;transform:scale(0.75, 0.75);transform-origin:center;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms}:host([complete]) .loader__svgs{opacity:0;transform:scale(0.75, 0.75);transform-origin:center;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms}:host([complete]) .loader__percentage{color:var(--calcite-color-brand);transform:scale(1.05, 1.05);transform-origin:center;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear}.loader__svg--1{stroke-dasharray:27.9252444444 139.6262222222;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 4.8 / var(--calcite-internal-duration-factor))}@keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444 251.3272;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222 139.6262222222;stroke-dashoffset:-83.7757333333}100%{stroke-dasharray:27.9252444444 251.3272;stroke-dashoffset:-279.2524444444}}.loader__svg--2{stroke-dasharray:55.8504888889 139.6262222222;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 6.4 / var(--calcite-internal-duration-factor))}@keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889 223.4019555556;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222 139.6262222222;stroke-dashoffset:-97.7383555556}100%{stroke-dasharray:55.8504888889 223.4019555556;stroke-dashoffset:-279.2524444444}}.loader__svg--3{stroke-dasharray:13.9626222222 139.6262222222;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 7.734 / var(--calcite-internal-duration-factor))}@keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222 265.2898222222;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222 139.6262222222;stroke-dashoffset:-76.7944222222}100%{stroke-dasharray:13.9626222222 265.2898222222;stroke-dashoffset:-279.2524444444}}@keyframes loader-color-shift{0%{stroke:var(--calcite-color-brand)}33%{stroke:var(--calcite-color-brand-press)}66%{stroke:var(--calcite-color-brand-hover)}100%{stroke:var(--calcite-color-brand)}}@keyframes loader-clockwise{100%{transform:rotate(360deg)}}:host([hidden]){display:none}[hidden]{display:none}',J9t=Z9t,Q9t=H0(class extends q0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.inline=!1,this.label=void 0,this.scale="m",this.type=void 0,this.value=0,this.text=""}render(){const{el:e,inline:i,label:r,scale:s,text:n,type:o,value:a}=this,l=e.id||Y8e(),c=.45,u=i?this.getInlineSize(s):this.getSize(s),h=u*c,p=`0 0 ${u} ${u}`,f=o==="determinate",g=2*h*Math.PI,y=a/100*g,v=g-y,b=Math.floor(a),w={"aria-valuenow":b,"aria-valuemin":0,"aria-valuemax":100,complete:b===100},x={r:h,cx:u/2,cy:u/2},S={"stroke-dasharray":`${y} ${v}`};return it(d1,{key:"1042b6b24e04a6e4582947c6a544da715ff255a4","aria-label":r,id:l,role:"progressbar",...f?w:{}},it("div",{key:"4fa16470d15e126378e330a03732e0f5f5fe12a6",class:"loader__svgs"},it("svg",{key:"f2f2349163dd4280309cae9a53d20596850e89ae","aria-hidden":"true",class:"loader__svg loader__svg--1",viewBox:p},it("circle",{key:"cab1f07b5e5f275709446ee13e9a06212bc544a9",...x})),it("svg",{key:"f8d6bedac7cef0c7f619eec7734a1cda1b8021db","aria-hidden":"true",class:"loader__svg loader__svg--2",viewBox:p},it("circle",{key:"778a680d0d93cdf7896c8bf225f153ea806e76ce",...x})),it("svg",{key:"80f42b04b4f0dd270c0a0f8063c9c5e6ed687b79","aria-hidden":"true",class:"loader__svg loader__svg--3",viewBox:p,...f?{style:S}:{}},it("circle",{key:"3d4cb781a9af29810069f020aecffba667c72335",...x}))),n&&it("div",{key:"4e7b35dddd29bbcfc4043aecd14ee22131c9f5cc",class:"loader__text"},n),f&&it("div",{key:"396313f330b54f7f7a45ebac7ccb1cf8b8116471",class:"loader__percentage"},a))}getSize(e){return{s:32,m:56,l:80}[e]}getInlineSize(e){return{s:12,m:16,l:20}[e]}get el(){return this}static get style(){return J9t}},[1,"calcite-loader",{inline:[516],label:[1],scale:[513],type:[513],value:[2],text:[1]}]);function O4(){if(typeof customElements>"u")return;["calcite-loader"].forEach(e=>{switch(e){case"calcite-loader":customElements.get(e)||customElements.define(e,Q9t);break}})}O4();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const Hf={button:"button",buttonTextVisible:"button--text-visible",buttonCompact:"button--compact",indicatorText:"indicator-text",iconContainer:"icon-container",slotContainer:"slot-container",slotContainerHidden:"slot-container--hidden",textContainer:"text-container",textContainerVisible:"text-container--visible",indicatorWithIcon:"indicator-with-icon",indicatorWithoutIcon:"indicator-without-icon"},K9t={tooltip:"tooltip"},e7t=`:host{box-sizing:border-box;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-2);font-size:var(--calcite-font-size--1)}:host *{box-sizing:border-box}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex;background-color:transparent;--calcite-action-indicator-color:var(--calcite-color-brand);--calcite-action-color-transparent-hover:var(--calcite-color-transparent-hover);--calcite-action-color-transparent-press:var(--calcite-color-transparent-press)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}.button{position:relative;margin:0px;display:flex;inline-size:auto;cursor:pointer;align-items:center;justify-content:flex-start;border-style:none;background-color:var(--calcite-color-foreground-1);fill:var(--calcite-color-text-3);font-family:var(--calcite-font-family);font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-color-text-3);outline-color:transparent;text-align:unset;flex:1 0 auto}.button:hover{background-color:var(--calcite-color-foreground-2);fill:var(--calcite-color-text-1);color:var(--calcite-color-text-1)}.button:focus{background-color:var(--calcite-color-foreground-2);fill:var(--calcite-color-text-1);color:var(--calcite-color-text-1);outline:2px solid var(--calcite-ui-focus-color, var(--calcite-color-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-offset-invert-focus),
                1
              )
            )
          )}.button:active{background-color:var(--calcite-color-foreground-3)}.button .icon-container{pointer-events:none;margin:0px;display:flex;align-items:center;justify-content:center;min-inline-size:1rem;min-block-size:1.5rem}.button .text-container{margin:0px;inline-size:0px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:1.5rem;opacity:0;transition-property:opacity;transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-property:margin;transition-property:inline-size}.button .text-container--visible{inline-size:auto;flex:1 1 auto;opacity:1}:host([data-active]) .button{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-color-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-offset-invert-focus),
                1
              )
            )
          )}:host([scale=s]) .button{padding-inline:0.5rem;padding-block:0.25rem;font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-normal)}:host([scale=s]) .button--text-visible .icon-container{margin-inline-end:0.5rem}:host([scale=m]) .button{padding-inline:1rem;padding-block:0.75rem;font-size:var(--calcite-font-size--1);line-height:1rem;font-weight:var(--calcite-font-weight-normal)}:host([scale=m]) .button--text-visible .icon-container{margin-inline-end:0.75rem}:host([scale=l]) .button{padding:1.25rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-normal)}:host([scale=l]) .button--text-visible .icon-container{margin-inline-end:1rem}:host([alignment=center]) .button{justify-content:center}:host([alignment=end]) .button{justify-content:flex-end}:host([alignment=center]) .button .text-container--visible,:host([alignment=end]) .button .text-container--visible{flex:0 1 auto}:host([scale=s][compact]) .button,:host([scale=m][compact]) .button,:host([scale=l][compact]) .button{padding-inline:0px}.slot-container{display:flex}.slot-container--hidden{display:none}.button--text-visible{inline-size:100%}:host([active]) .button,:host([active]) .button:hover,:host([active]) .button:focus,:host([active][loading]) .button{background-color:var(--calcite-color-foreground-3);fill:var(--calcite-color-text-1);color:var(--calcite-color-text-1)}:host([appearance=transparent]) .button{background-color:transparent;transition-property:box-shadow;transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1)}:host([active]) .button:active{background-color:var(--calcite-color-foreground-1)}:host([appearance=transparent][active]) .button,:host([appearance=transparent]) .button:hover,:host([appearance=transparent]) .button:focus{background-color:var(--calcite-action-color-transparent-hover)}:host([appearance=transparent]) .button:active{background-color:var(--calcite-action-color-transparent-press)}:host([appearance=transparent][disabled]) .button{background-color:transparent}:host([loading][appearance=solid]) .button,:host([loading][appearance=solid]) .button:hover,:host([loading][appearance=solid]) .button:focus{background-color:var(--calcite-color-foreground-1)}:host([loading][appearance=solid]) .button .text-container,:host([loading][appearance=solid]) .button:hover .text-container,:host([loading][appearance=solid]) .button:focus .text-container{opacity:var(--calcite-opacity-disabled)}:host([loading]) calcite-loader[inline]{color:var(--calcite-color-text-3);margin-inline-end:0px}:host([disabled]) .button,:host([disabled]) .button:hover,:host([disabled]) .button:focus{cursor:default;background-color:var(--calcite-color-foreground-1);opacity:var(--calcite-opacity-disabled)}:host([disabled][active]) .button,:host([disabled][active]) .button:hover,:host([disabled][active]) .button:focus{background-color:var(--calcite-color-foreground-3);opacity:var(--calcite-opacity-disabled)}.indicator-with-icon{position:relative}.indicator-with-icon::after{content:"";position:absolute;block-size:0.5rem;inline-size:0.5rem;border-radius:9999px;inset-block-end:-0.275rem;inset-inline-end:-0.275rem;background-color:var(--calcite-action-indicator-color)}.indicator-without-icon{margin-inline:0.25rem;inline-size:1rem;position:relative}.indicator-without-icon::after{content:"";position:absolute;block-size:0.5rem;inline-size:0.5rem;border-radius:9999px;inset-block-end:-0.275rem;inset-inline-end:-0.275rem;background-color:var(--calcite-action-indicator-color)}.indicator-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}`,t7t=e7t,i7t=H0(class extends q0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.mutationObserver=ik("mutation",()=>I7(this)),this.guid=`calcite-action-${Y8e()}`,this.indicatorId=`${this.guid}-indicator`,this.buttonId=`${this.guid}-button`,this.handleTooltipSlotChange=e=>{const r=e.target.assignedElements({flatten:!0}).filter(s=>s?.matches("calcite-tooltip"))[0];r&&(r.referenceElement=this.buttonEl)},this.active=!1,this.alignment=void 0,this.appearance="solid",this.compact=!1,this.disabled=!1,this.icon=void 0,this.iconFlipRtl=!1,this.indicator=!1,this.label=void 0,this.loading=!1,this.scale="m",this.text=void 0,this.textEnabled=!1,this.messages=void 0,this.messageOverrides=void 0,this.effectiveLocale="",this.defaultMessages=void 0}onMessagesChange(){}effectiveLocaleChange(){D7(this,this.effectiveLocale)}connectedCallback(){aHe(this),$7(this),F7(this),this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}async componentWillLoad(){UC(this),await L7(this)}componentDidLoad(){BC(this)}disconnectedCallback(){lHe(this),N7(this),k7(this),this.mutationObserver?.disconnect()}componentDidRender(){sHe(this)}async setFocus(){await zC(this),this.buttonEl?.focus()}renderTextContainer(){const{text:e,textEnabled:i}=this,r={[Hf.textContainer]:!0,[Hf.textContainerVisible]:i};return e?it("div",{class:r,key:"text-container"},e):null}renderIndicatorText(){const{indicator:e,messages:i,indicatorId:r,buttonId:s}=this;return it("div",{"aria-labelledby":s,"aria-live":"polite",class:Hf.indicatorText,id:r,role:"region"},e?i.indicator:null)}renderIconContainer(){const{loading:e,icon:i,scale:r,el:s,iconFlipRtl:n,indicator:o}=this,a=r==="l"?"l":"m",l=e?it("calcite-loader",{inline:!0,label:this.messages.loading,scale:a}):null,c=i?it("calcite-icon",{class:{[Hf.indicatorWithIcon]:o},flipRtl:n,icon:i,scale:jne(this.scale)}):null,u=l||c,h=u||s.children?.length,p=it("div",{class:{[Hf.slotContainer]:!0,[Hf.slotContainerHidden]:e}},it("slot",null));return h?it("div",{"aria-hidden":"true",class:Hf.iconContainer,key:"icon-container"},u,p):null}render(){const{active:e,compact:i,disabled:r,icon:s,loading:n,textEnabled:o,label:a,text:l,indicator:c,indicatorId:u,buttonId:h,messages:p}=this,f=a||l,g=f?`${f}${c?` (${p.indicator})`:""}`:"",y={[Hf.button]:!0,[Hf.buttonTextVisible]:o,[Hf.buttonCompact]:i};return it(d1,{key:"ea1d66de5f1b0d591306a8f40d1ce22c6b99a8cd"},it(cHe,{key:"ac7794e91182528fa2729ecac860a1abe4fbaeec",disabled:r},it("button",{key:"32d7d5461e68006e2baadf7f65e504fbf2f0f9a0","aria-busy":GD(n),"aria-controls":c?u:null,"aria-disabled":GD(r),"aria-label":g,"aria-pressed":GD(e),class:y,disabled:r,id:h,ref:v=>this.buttonEl=v},this.renderIconContainer(),this.renderTextContainer(),!s&&c&&it("div",{class:Hf.indicatorWithoutIcon,key:"indicator-no-icon"})),it("slot",{key:"5e4ba8c04428b6797dfdaaa8ca1e96d6bc8487a7",name:K9t.tooltip,onSlotchange:this.handleTooltipSlotChange}),this.renderIndicatorText()))}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return t7t}},[1,"calcite-action",{active:[516],alignment:[513],appearance:[513],compact:[516],disabled:[516],icon:[1],iconFlipRtl:[516,"icon-flip-rtl"],indicator:[516],label:[1],loading:[516],scale:[513],text:[1],textEnabled:[516,"text-enabled"],messages:[1040],messageOverrides:[1040],effectiveLocale:[32],defaultMessages:[32],setFocus:[64]},void 0,{messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}]);function zpe(){if(typeof customElements>"u")return;["calcite-action","calcite-icon","calcite-loader"].forEach(e=>{switch(e){case"calcite-action":customElements.get(e)||customElements.define(e,i7t);break;case"calcite-icon":customElements.get(e)||Jx();break;case"calcite-loader":customElements.get(e)||O4();break}})}zpe();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const r7t=["calcite-input","calcite-input-number","calcite-input-text","calcite-text-area"];function s7t(t){return`${t.split("-").map((r,s)=>s===0?r:`${r[0].toUpperCase()}${r.slice(1)}`).join("")}${r7t.includes(t)?"Input":"Change"}`}function n7t(t,{status:e,message:i,icon:r}){"status"in t&&(t.status=e),"validationIcon"in t&&typeof t.validationIcon!="string"&&(t.validationIcon=r),"validationMessage"in t&&!t.validationMessage&&(t.validationMessage=i)}function o7t(t){return t.nodeName==="CALCITE-RADIO-BUTTON"?FC(t,"calcite-radio-button-group"):t}const a7t=new CustomEvent("calciteInvalid",{bubbles:!0,composed:!0});function oEe(t){const e=t?.target,i=e?.validationMessage,r=o7t(e?.parentElement);if(!r)return;const s=r?.nodeName?.toLowerCase(),n=s?.split("-");if(n.length<2||n[0]!=="calcite")return;t?.preventDefault(),"validity"in r&&(r.validity=e?.validity),r.dispatchEvent(a7t),n7t(r,{message:i,icon:!0,status:"invalid"});const o=s7t(s);r.addEventListener(o,()=>{"status"in r&&(r.status="idle"),"validationIcon"in r&&!r.validationIcon&&(r.validationIcon=!1),"validationMessage"in r&&r.validationMessage===i&&(r.validationMessage=""),"validity"in r&&(r.validity=e?.validity)},{once:!0})}function l7t(t){const{formEl:e}=t;return e?(e.addEventListener("invalid",oEe,!0),e.requestSubmit(),e.removeEventListener("invalid",oEe,!0),requestAnimationFrame(()=>{const i=e.querySelectorAll("[status=invalid]");for(const r of i)if(r?.validationMessage){r?.setFocus();break}}),!0):!1}function c7t(t){t.formEl?.reset()}function u7t(t){const{el:e,form:i}=t;return i?Q8e(e,{id:i}):FC(e,"form")}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const mHe="calciteInternalLabelClick",Vpe="calciteInternalLabelConnected",Hne="calciteInternalLabelDisconnected",aEe="calcite-label",sk=new WeakMap,jD=new WeakMap,nk=new WeakMap,TH=new WeakMap,KP=new Set,h7t=t=>{const{id:e}=t,i=e&&Q8e(t,{selector:`${aEe}[for="${e}"]`});if(i)return i;const r=FC(t,aEe);return!r||d7t(r,t)?null:r};function d7t(t,e){let i;const r="custom-element-ancestor-check",s=o=>{o.stopImmediatePropagation();const a=o.composedPath();i=a.slice(a.indexOf(e),a.indexOf(t))};return t.addEventListener(r,s,{once:!0}),e.dispatchEvent(new CustomEvent(r,{composed:!0,bubbles:!0})),t.removeEventListener(r,s),i.filter(o=>o!==e&&o!==t).filter(o=>o.tagName?.includes("-")).length>0}function gHe(t){if(!t)return;const e=h7t(t.el);if(jD.has(e)&&e===t.labelEl||!e&&KP.has(t))return;const i=g7t.bind(t);if(e){t.labelEl=e;const r=sk.get(e)||[];r.push(t),sk.set(e,r.sort(yHe)),jD.has(t.labelEl)||(jD.set(t.labelEl,lEe),t.labelEl.addEventListener(mHe,lEe)),KP.delete(t),document.removeEventListener(Vpe,nk.get(t)),TH.set(t,i),document.addEventListener(Hne,i)}else KP.has(t)||(i(),document.removeEventListener(Hne,TH.get(t)))}function p7t(t){if(!t||(KP.delete(t),document.removeEventListener(Vpe,nk.get(t)),document.removeEventListener(Hne,TH.get(t)),nk.delete(t),TH.delete(t),!t.labelEl))return;const e=sk.get(t.labelEl);e.length===1&&(t.labelEl.removeEventListener(mHe,jD.get(t.labelEl)),jD.delete(t.labelEl)),sk.set(t.labelEl,e.filter(i=>i!==t).sort(yHe)),t.labelEl=null}function yHe(t,e){return E9t(t.el,e.el)?-1:1}function f7t(t){return t.label||t.labelEl?.textContent?.trim()||""}function lEe(t){const e=t.detail.sourceEvent.target,i=sk.get(this),r=i.find(o=>o.el===e);if(i.includes(r))return;const n=i[0];n.disabled||n.onLabelClick(t)}function m7t(){KP.has(this)&&gHe(this)}function g7t(){KP.add(this);const t=nk.get(this)||m7t.bind(this);nk.set(this,t),document.addEventListener(Vpe,t)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const qh={buttonLoader:"calcite-button--loader",content:"content",contentSlotted:"content--slotted",icon:"icon",iconStart:"icon--start",iconEnd:"icon--end",loadingIn:"loading-in",loadingOut:"loading-out",iconStartEmpty:"icon-start-empty",iconEndEmpty:"icon-end-empty",buttonPadding:"button-padding",buttonPaddingShrunk:"button-padding--shrunk"},y7t=`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline-block;inline-size:auto;vertical-align:middle}:host([round]){border-radius:50px}:host([round]) a,:host([round]) button{border-radius:50px}:host button,:host a{outline-color:transparent}:host button:focus,:host a:focus{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-color-brand));outline-offset:calc(
            2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-offset-invert-focus),
                1
              )
            )
          )}:host button,:host a{--calcite-button-content-margin-internal:0.5rem;--calcite-button-padding-x-internal:7px;--calcite-button-padding-y-internal:3px;padding-block:var(--calcite-button-padding-y-internal);padding-inline:var(--calcite-button-padding-x-internal);position:relative;box-sizing:border-box;display:flex;block-size:100%;inline-size:100%;cursor:pointer;-webkit-user-select:none;user-select:none;appearance:none;align-items:center;justify-content:center;border-radius:0px;border-style:none;text-align:center;font-family:inherit;font-weight:var(--calcite-font-weight-normal);text-decoration-line:none;transition:color var(--calcite-animation-timing) ease-in-out, background-color var(--calcite-animation-timing) ease-in-out, box-shadow var(--calcite-animation-timing) ease-in-out, outline-color var(--calcite-internal-animation-timing-fast) ease-in-out}:host button:hover,:host a:hover{text-decoration-line:none}:host button span,:host a span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.content{margin-inline:var(--calcite-button-content-margin-internal)}.icon-start-empty .content{margin-inline-start:unset}.icon-end-empty .content{margin-inline-end:unset}:host([scale=m]) button,:host([scale=m]) a{--calcite-button-content-margin-internal:0.75rem}:host([scale=l]) button,:host([scale=l]) a{--calcite-button-content-margin-internal:1rem}:host([width=auto]){inline-size:auto}:host([width=half]){inline-size:50%}:host([width=full]){inline-size:100%}:host([alignment=center]:not([width=auto])) a,:host([alignment=center]:not([width=auto])) button{justify-content:center}:host([alignment=start]:not([width=auto])) a,:host([alignment=start]:not([width=auto])) button{justify-content:flex-start}:host([alignment=end]:not([width=auto])) a,:host([alignment=end]:not([width=auto])) button{justify-content:flex-end}:host([alignment*=space-between]:not([width=auto])) a,:host([alignment*=space-between]:not([width=auto])) button{justify-content:space-between}:host([alignment=icon-start-space-between]:not([width=auto])) .icon--start{margin-inline-end:auto}:host([alignment=icon-start-space-between]:not([width=auto])) a,:host([alignment=icon-start-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=icon-end-space-between]:not([width=auto])) .icon--end{margin-inline-start:auto}:host([alignment=icon-end-space-between]:not([width=auto])) a,:host([alignment=icon-end-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=center]) a:not(.content--slotted) .icon--start+.icon--end,:host([alignment=center]) button:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:var(--calcite-button-content-margin-internal)}.icon{position:relative;margin:0px;display:inline-flex;font-weight:var(--calcite-font-weight-normal);line-height:inherit}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}@keyframes loader-in{0%{inline-size:0;opacity:0;transform:scale(0.5)}100%{inline-size:1em;opacity:1;transform:scale(1)}}@keyframes loader-out{0%{inline-size:1em;opacity:1;transform:scale(1)}100%{inline-size:0;opacity:0;transform:scale(0.5)}}.calcite-button--loader{display:flex}.calcite-button--loader calcite-loader{margin:0px;transition:inline-size var(--calcite-internal-animation-timing-slow) ease-in-out, opacity var(--calcite-internal-animation-timing-slow) ease-in-out, transform var(--calcite-internal-animation-timing-slow) ease-in-out}.calcite-button--loader calcite-loader.loading-in{animation-name:loader-in;animation-duration:var(--calcite-internal-animation-timing-slow)}.calcite-button--loader calcite-loader.loading-out{animation-name:loader-out;animation-duration:var(--calcite-internal-animation-timing-slow)}:host([loading]) button.content--slotted .calcite-button--loader calcite-loader,:host([loading]) a.content--slotted .calcite-button--loader calcite-loader{margin-inline-end:var(--calcite-button-content-margin-internal)}:host([loading]) button:not(.content--slotted) .icon--start,:host([loading]) button:not(.content--slotted) .icon--end,:host([loading]) a:not(.content--slotted) .icon--start,:host([loading]) a:not(.content--slotted) .icon--end{display:none}:host([appearance]) button,:host([appearance]) a{border-width:1px;border-style:solid;border-color:transparent}:host([kind=brand]) button,:host([kind=brand]) a{background-color:var(--calcite-color-brand);color:var(--calcite-color-text-inverse)}:host([kind=brand]) button:hover,:host([kind=brand]) button:focus,:host([kind=brand]) a:hover,:host([kind=brand]) a:focus{background-color:var(--calcite-color-brand-hover)}:host([kind=brand]) button:active,:host([kind=brand]) a:active{background-color:var(--calcite-color-brand-press)}:host([kind=brand]) button calcite-loader,:host([kind=brand]) a calcite-loader{color:var(--calcite-color-text-inverse)}:host([kind=danger]) button,:host([kind=danger]) a{background-color:var(--calcite-color-status-danger);color:var(--calcite-color-text-inverse)}:host([kind=danger]) button:hover,:host([kind=danger]) button:focus,:host([kind=danger]) a:hover,:host([kind=danger]) a:focus{background-color:var(--calcite-color-status-danger-hover)}:host([kind=danger]) button:active,:host([kind=danger]) a:active{background-color:var(--calcite-color-status-danger-press)}:host([kind=danger]) button calcite-loader,:host([kind=danger]) a calcite-loader{color:var(--calcite-color-text-inverse)}:host([kind=neutral]) button,:host([kind=neutral]) a{background-color:var(--calcite-color-foreground-3);color:var(--calcite-color-text-1)}:host([kind=neutral]) button:hover,:host([kind=neutral]) button:focus,:host([kind=neutral]) a:hover,:host([kind=neutral]) a:focus{background-color:var(--calcite-color-foreground-2)}:host([kind=neutral]) button:active,:host([kind=neutral]) a:active{background-color:var(--calcite-color-foreground-1)}:host([kind=neutral]) button calcite-loader,:host([kind=neutral]) a calcite-loader{color:var(--calcite-color-text-1)}:host([kind=inverse]) button,:host([kind=inverse]) a{color:var(--calcite-color-text-inverse);background-color:var(--calcite-color-inverse)}:host([kind=inverse]) button:hover,:host([kind=inverse]) button:focus,:host([kind=inverse]) a:hover,:host([kind=inverse]) a:focus{background-color:var(--calcite-color-inverse-hover)}:host([kind=inverse]) button:active,:host([kind=inverse]) a:active{background-color:var(--calcite-color-inverse-press)}:host([kind=inverse]) button calcite-loader,:host([kind=inverse]) a calcite-loader{color:var(--calcite-color-text-inverse)}:host([appearance=outline-fill]) button,:host([appearance=outline-fill]) a{border-width:1px;border-style:solid;background-color:var(--calcite-color-foreground-1);box-shadow:inset 0 0 0 1px transparent}:host([appearance=outline-fill][kind=brand]) button,:host([appearance=outline-fill][kind=brand]) a{border-color:var(--calcite-color-brand);background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-brand)}:host([appearance=outline-fill][kind=brand]) button:hover,:host([appearance=outline-fill][kind=brand]) a:hover{border-color:var(--calcite-color-brand-hover);color:var(--calcite-color-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-color-brand-hover)}:host([appearance=outline-fill][kind=brand]) button:focus,:host([appearance=outline-fill][kind=brand]) a:focus{border-color:var(--calcite-color-brand);color:var(--calcite-color-brand);box-shadow:inset 0 0 0 2px var(--calcite-color-brand)}:host([appearance=outline-fill][kind=brand]) button:active,:host([appearance=outline-fill][kind=brand]) a:active{border-color:var(--calcite-color-brand-press);color:var(--calcite-color-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-color-brand-press)}:host([appearance=outline-fill][kind=brand]) button calcite-loader,:host([appearance=outline-fill][kind=brand]) a calcite-loader{color:var(--calcite-color-brand)}:host([appearance=outline-fill][kind=danger]) button,:host([appearance=outline-fill][kind=danger]) a{border-color:var(--calcite-color-status-danger);background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-status-danger)}:host([appearance=outline-fill][kind=danger]) button:hover,:host([appearance=outline-fill][kind=danger]) a:hover{border-color:var(--calcite-color-status-danger-hover);color:var(--calcite-color-status-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-color-status-danger-hover)}:host([appearance=outline-fill][kind=danger]) button:focus,:host([appearance=outline-fill][kind=danger]) a:focus{border-color:var(--calcite-color-status-danger);color:var(--calcite-color-status-danger);box-shadow:inset 0 0 0 2px var(--calcite-color-status-danger)}:host([appearance=outline-fill][kind=danger]) button:active,:host([appearance=outline-fill][kind=danger]) a:active{border-color:var(--calcite-color-status-danger-press);color:var(--calcite-color-status-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-color-status-danger-press)}:host([appearance=outline-fill][kind=danger]) button calcite-loader,:host([appearance=outline-fill][kind=danger]) a calcite-loader{color:var(--calcite-color-status-danger)}:host([appearance=outline-fill][kind=neutral]) button,:host([appearance=outline-fill][kind=neutral]) a{background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-1);border-color:var(--calcite-color-border-1)}:host([appearance=outline-fill][kind=neutral]) button:hover,:host([appearance=outline-fill][kind=neutral]) a:hover{box-shadow:inset 0 0 0 1px var(--calcite-color-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:focus,:host([appearance=outline-fill][kind=neutral]) a:focus{box-shadow:inset 0 0 0 2px var(--calcite-color-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:active,:host([appearance=outline-fill][kind=neutral]) a:active{box-shadow:inset 0 0 0 2px var(--calcite-color-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button calcite-loader,:host([appearance=outline-fill][kind=neutral]) a calcite-loader{color:var(--calcite-color-text-1)}:host([appearance=outline-fill][kind=inverse]) button,:host([appearance=outline-fill][kind=inverse]) a{background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-1);border-color:var(--calcite-color-inverse)}:host([appearance=outline-fill][kind=inverse]) button:hover,:host([appearance=outline-fill][kind=inverse]) a:hover{border-color:var(--calcite-color-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-color-inverse-hover)}:host([appearance=outline-fill][kind=inverse]) button:focus,:host([appearance=outline-fill][kind=inverse]) a:focus{border-color:var(--calcite-color-inverse);box-shadow:inset 0 0 0 2px var(--calcite-color-inverse)}:host([appearance=outline-fill][kind=inverse]) button:active,:host([appearance=outline-fill][kind=inverse]) a:active{border-color:var(--calcite-color-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-color-inverse-press)}:host([appearance=outline-fill][kind=inverse]) button calcite-loader,:host([appearance=outline-fill][kind=inverse]) a calcite-loader{color:var(--calcite-color-text-1)}:host([appearance=outline]) button,:host([appearance=outline]) a{border-width:1px;border-style:solid;background-color:transparent;box-shadow:inset 0 0 0 1px transparent}:host([appearance=outline][kind=brand]) button,:host([appearance=outline][kind=brand]) a{border-color:var(--calcite-color-brand);background-color:transparent;color:var(--calcite-color-brand)}:host([appearance=outline][kind=brand]) button:hover,:host([appearance=outline][kind=brand]) a:hover{border-color:var(--calcite-color-brand-hover);color:var(--calcite-color-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-color-brand-hover)}:host([appearance=outline][kind=brand]) button:focus,:host([appearance=outline][kind=brand]) a:focus{border-color:var(--calcite-color-brand);color:var(--calcite-color-brand);box-shadow:inset 0 0 0 2px var(--calcite-color-brand)}:host([appearance=outline][kind=brand]) button:active,:host([appearance=outline][kind=brand]) a:active{border-color:var(--calcite-color-brand-press);color:var(--calcite-color-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-color-brand-press)}:host([appearance=outline][kind=brand]) button calcite-loader,:host([appearance=outline][kind=brand]) a calcite-loader{color:var(--calcite-color-brand)}:host([appearance=outline][kind=danger]) button,:host([appearance=outline][kind=danger]) a{border-color:var(--calcite-color-status-danger);background-color:transparent;color:var(--calcite-color-status-danger)}:host([appearance=outline][kind=danger]) button:hover,:host([appearance=outline][kind=danger]) a:hover{border-color:var(--calcite-color-status-danger-hover);color:var(--calcite-color-status-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-color-status-danger-hover)}:host([appearance=outline][kind=danger]) button:focus,:host([appearance=outline][kind=danger]) a:focus{border-color:var(--calcite-color-status-danger);color:var(--calcite-color-status-danger);box-shadow:inset 0 0 0 2px var(--calcite-color-status-danger)}:host([appearance=outline][kind=danger]) button:active,:host([appearance=outline][kind=danger]) a:active{border-color:var(--calcite-color-status-danger-press);color:var(--calcite-color-status-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-color-status-danger-press)}:host([appearance=outline][kind=danger]) button calcite-loader,:host([appearance=outline][kind=danger]) a calcite-loader{color:var(--calcite-color-status-danger)}:host([appearance=outline][kind=neutral]) button,:host([appearance=outline][kind=neutral]) a{background-color:transparent;color:var(--calcite-color-text-1);border-color:var(--calcite-color-border-1)}:host([appearance=outline][kind=neutral]) button:hover,:host([appearance=outline][kind=neutral]) a:hover{box-shadow:inset 0 0 0 1px var(--calcite-color-foreground-3)}:host([appearance=outline][kind=neutral]) button:focus,:host([appearance=outline][kind=neutral]) a:focus{box-shadow:inset 0 0 0 2px var(--calcite-color-foreground-3)}:host([appearance=outline][kind=neutral]) button:active,:host([appearance=outline][kind=neutral]) a:active{box-shadow:inset 0 0 0 2px var(--calcite-color-foreground-3)}:host([appearance=outline][kind=neutral]) button calcite-loader,:host([appearance=outline][kind=neutral]) a calcite-loader{color:var(--calcite-color-text-1)}:host([appearance=outline][kind=inverse]) button,:host([appearance=outline][kind=inverse]) a{background-color:transparent;color:var(--calcite-color-text-1);border-color:var(--calcite-color-inverse)}:host([appearance=outline][kind=inverse]) button:hover,:host([appearance=outline][kind=inverse]) a:hover{border-color:var(--calcite-color-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-color-inverse-hover)}:host([appearance=outline][kind=inverse]) button:focus,:host([appearance=outline][kind=inverse]) a:focus{border-color:var(--calcite-color-inverse);box-shadow:inset 0 0 0 2px var(--calcite-color-inverse)}:host([appearance=outline][kind=inverse]) button:active,:host([appearance=outline][kind=inverse]) a:active{border-color:var(--calcite-color-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-color-inverse-press)}:host([appearance=outline][kind=inverse]) button calcite-loader,:host([appearance=outline][kind=inverse]) a calcite-loader{color:var(--calcite-color-text-1)}:host([appearance=outline-fill][split-child=primary]) button,:host([appearance=outline][split-child=primary]) button{border-inline-end-width:0;border-inline-start-width:1px}:host([appearance=outline-fill][split-child=secondary]) button,:host([appearance=outline][split-child=secondary]) button{border-inline-start-width:0;border-inline-end-width:1px}:host([appearance=transparent]:not(.enable-editing-button)) button,:host([appearance=transparent]:not(.enable-editing-button)) a{background-color:transparent}:host([appearance=transparent]:not(.enable-editing-button)) button:hover,:host([appearance=transparent]:not(.enable-editing-button)) button:focus,:host([appearance=transparent]:not(.enable-editing-button)) a:hover,:host([appearance=transparent]:not(.enable-editing-button)) a:focus{background-color:var(--calcite-color-transparent-hover)}:host([appearance=transparent]:not(.enable-editing-button)) button:active,:host([appearance=transparent]:not(.enable-editing-button)) a:active{background-color:var(--calcite-color-transparent-press)}:host([appearance=transparent][kind=brand]) button,:host([appearance=transparent][kind=brand]) a{color:var(--calcite-color-brand)}:host([appearance=transparent][kind=brand]) button:hover,:host([appearance=transparent][kind=brand]) a:hover{color:var(--calcite-color-brand-hover)}:host([appearance=transparent][kind=brand]) button:focus,:host([appearance=transparent][kind=brand]) a:focus{color:var(--calcite-color-brand)}:host([appearance=transparent][kind=brand]) button:active,:host([appearance=transparent][kind=brand]) a:active{color:var(--calcite-color-brand-press)}:host([appearance=transparent][kind=brand]) button calcite-loader,:host([appearance=transparent][kind=brand]) a calcite-loader{color:var(--calcite-color-brand)}:host([appearance=transparent][kind=danger]) button,:host([appearance=transparent][kind=danger]) a{color:var(--calcite-color-status-danger)}:host([appearance=transparent][kind=danger]) button:hover,:host([appearance=transparent][kind=danger]) a:hover{color:var(--calcite-color-status-danger-hover)}:host([appearance=transparent][kind=danger]) button:focus,:host([appearance=transparent][kind=danger]) a:focus{color:var(--calcite-color-status-danger)}:host([appearance=transparent][kind=danger]) button:active,:host([appearance=transparent][kind=danger]) a:active{color:var(--calcite-color-status-danger-press)}:host([appearance=transparent][kind=danger]) button calcite-loader,:host([appearance=transparent][kind=danger]) a calcite-loader{color:var(--calcite-color-status-danger)}:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) button,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) a,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) calcite-loader{color:var(--calcite-color-text-1)}:host([appearance=transparent][kind=neutral].cancel-editing-button) button{border-block-start-width:1px;border-block-end-width:1px;color:var(--calcite-color-text-3);border-block-start-color:var(--calcite-color-border-input);border-block-end-color:var(--calcite-color-border-input);border-block-style:solid}:host([appearance=transparent][kind=neutral].cancel-editing-button) button:not(.content--slotted){--calcite-button-padding-y-internal:0}:host([appearance=transparent][kind=neutral].cancel-editing-button) button:hover{color:var(--calcite-color-text-1)}:host([appearance=transparent][kind=neutral].enable-editing-button) button{background-color:transparent}:host(.confirm-changes-button) button:focus,:host(.cancel-editing-button) button:focus,:host(.enable-editing-button) button:focus{outline-offset:-2px}:host([appearance=transparent][kind=inverse]) button,:host([appearance=transparent][kind=inverse]) a,:host([appearance=transparent][kind=inverse]) calcite-loader{color:var(--calcite-color-text-inverse)}:host([scale=s]) button.content--slotted,:host([scale=s]) a.content--slotted{font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s][appearance=transparent]) button.content--slotted,:host([scale=s][appearance=transparent]) a.content--slotted{--calcite-button-padding-x-internal:0.5rem}:host([scale=s]) button,:host([scale=s]) a{--calcite-button-padding-y-internal:3px}:host([scale=m]) button.content--slotted,:host([scale=m]) a.content--slotted{--calcite-button-padding-x-internal:11px;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) button,:host([scale=m]) a{--calcite-button-padding-y-internal:7px}:host([scale=m][appearance=transparent]) button.content--slotted,:host([scale=m][appearance=transparent]) a.content--slotted{--calcite-button-padding-x-internal:0.75rem}:host([scale=l]) button.content--slotted,:host([scale=l]) a.content--slotted{--calcite-button-padding-x-internal:15px;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) .button-padding{--calcite-button-padding-x-internal:1rem;--calcite-button-padding-y-internal:11px}:host([scale=l]) .button-padding--shrunk{--calcite-button-padding-y-internal:9px}:host([scale=s]) button:not(.content--slotted),:host([scale=s]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:3px;inline-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:1.5rem}:host([scale=m]) button:not(.content--slotted),:host([scale=m]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:7px;inline-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2rem}:host([scale=l]) button:not(.content--slotted),:host([scale=l]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:9px;inline-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2.75rem}:host([scale=l][appearance=transparent]) button:not(.content--slotted),:host([scale=l][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-y-internal:0.625rem}:host([scale=s][icon-start][icon-end]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:23px;block-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=s][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:1.5rem}:host([scale=m][icon-start][icon-end]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:2rem;block-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=m][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:33px}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:43px;block-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted) .icon--start+.icon--end,:host([scale=l][icon-start][icon-end]) a:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:1rem}:host([scale=l][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:2.75rem}:host([hidden]){display:none}[hidden]{display:none}`,_7t=y7t,v7t=H0(class extends q0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.mutationObserver=ik("mutation",()=>this.updateHasContent()),this.resizeObserver=ik("resize",()=>this.setTooltipText()),this.handleClick=()=>{const{type:e}=this;this.href||(e==="submit"?l7t(this):e==="reset"&&c7t(this))},this.setTooltipText=()=>{const{contentEl:e}=this;e&&(this.tooltipText=e.offsetWidth<e.scrollWidth&&this.el.innerText||null)},this.setChildEl=e=>{this.childEl=e,e&&this.resizeObserver?.observe(e)},this.alignment="center",this.appearance="solid",this.label=void 0,this.kind="brand",this.disabled=!1,this.form=void 0,this.download=!1,this.href=void 0,this.iconEnd=void 0,this.iconFlipRtl=void 0,this.iconStart=void 0,this.loading=!1,this.name=void 0,this.rel=void 0,this.round=!1,this.scale="m",this.splitChild=!1,this.target=void 0,this.type="button",this.width="auto",this.messages=void 0,this.messageOverrides=void 0,this.hasContent=!1,this.hasLoader=!1,this.effectiveLocale="",this.defaultMessages=void 0,this.tooltipText=void 0}handleGlobalAttributesChanged(){I7(this)}loadingChanged(e,i){e&&!i&&(this.hasLoader=!0),!e&&i&&window.setTimeout(()=>{this.hasLoader=!1},300)}onMessagesChange(){}async connectedCallback(){aHe(this),$7(this),F7(this),this.hasLoader=this.loading,this.setupTextContentObserver(),gHe(this),this.formEl=u7t(this)}disconnectedCallback(){this.mutationObserver?.disconnect(),lHe(this),p7t(this),N7(this),k7(this),this.resizeObserver?.disconnect(),this.formEl=null}async componentWillLoad(){UC(this),this.updateHasContent(),await L7(this)}componentDidLoad(){BC(this),this.setTooltipText()}componentDidRender(){sHe(this)}render(){const e=this.href?"a":"button",i=e,r=this.hasLoader?it("div",{class:qh.buttonLoader},it("calcite-loader",{class:this.loading?qh.loadingIn:qh.loadingOut,inline:!0,label:this.messages.loading,scale:this.scale==="l"?"m":"s"})):null,s=!this.iconStart&&!this.iconEnd,n=it("calcite-icon",{key:"45941adf90ef50fe1aa5ed4a874dc8a841f4b16f",class:{[qh.icon]:!0,[qh.iconStart]:!0},flipRtl:this.iconFlipRtl==="start"||this.iconFlipRtl==="both",icon:this.iconStart,scale:jne(this.scale)}),o=it("calcite-icon",{key:"dcd2f544410e55c7dc3a277f9c5c04da0c00b041",class:{[qh.icon]:!0,[qh.iconEnd]:!0},flipRtl:this.iconFlipRtl==="end"||this.iconFlipRtl==="both",icon:this.iconEnd,scale:jne(this.scale)}),a=it("span",{key:"f69134d138dab0649abf8dda9ad85f129746dded",class:qh.content,ref:l=>this.contentEl=l},it("slot",{key:"0012a57d49d94c50e9fdc9eceb4b4395dfa1424b"}));return it(cHe,{key:"fae594988f9fd052100e50250ac09621066e1cc8",disabled:this.disabled},it(i,{key:"afb4ffda9526e954612e2edc2ccee94bc459478a","aria-disabled":e==="a"?GD(this.disabled||this.loading):null,"aria-expanded":this.el.getAttribute("aria-expanded"),"aria-label":this.loading?this.messages.loading:f7t(this),"aria-live":"polite",class:{[qh.buttonPadding]:s,[qh.buttonPaddingShrunk]:!s,[qh.contentSlotted]:this.hasContent,[qh.iconStartEmpty]:!this.iconStart,[qh.iconEndEmpty]:!this.iconEnd},disabled:e==="button"?this.disabled||this.loading:null,download:e==="a"&&(this.download===""||this.download)?this.download:null,href:e==="a"&&this.href,name:e==="button"&&this.name,onClick:this.handleClick,rel:e==="a"&&this.rel,tabIndex:this.disabled?-1:null,target:e==="a"&&this.target,title:this.tooltipText,type:e==="button"&&this.type,ref:this.setChildEl},r,this.iconStart?n:null,this.hasContent?a:null,this.iconEnd?o:null))}async setFocus(){await zC(this),this.childEl?.focus()}effectiveLocaleChange(){D7(this,this.effectiveLocale)}updateHasContent(){const e=this.el.textContent.trim().length>0||this.el.childNodes.length>0;this.hasContent=this.el.childNodes.length===1&&this.el.childNodes[0]?.nodeName==="#text"?this.el.textContent?.trim().length>0:e}setupTextContentObserver(){this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}onLabelClick(){this.handleClick(),this.setFocus()}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{"aria-expanded":["handleGlobalAttributesChanged"],loading:["loadingChanged"],messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return _7t}},[1,"calcite-button",{alignment:[513],appearance:[513],label:[1],kind:[513],disabled:[516],form:[513],download:[520],href:[513],iconEnd:[513,"icon-end"],iconFlipRtl:[513,"icon-flip-rtl"],iconStart:[513,"icon-start"],loading:[516],name:[513],rel:[513],round:[516],scale:[513],splitChild:[520,"split-child"],target:[513],type:[513],width:[513],messages:[1040],messageOverrides:[1040],hasContent:[32],hasLoader:[32],effectiveLocale:[32],defaultMessages:[32],tooltipText:[32],setFocus:[64]},void 0,{"aria-expanded":["handleGlobalAttributesChanged"],loading:["loadingChanged"],messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}]);function b7t(){if(typeof customElements>"u")return;["calcite-button","calcite-icon","calcite-loader"].forEach(e=>{switch(e){case"calcite-button":customElements.get(e)||customElements.define(e,v7t);break;case"calcite-icon":customElements.get(e)||Jx();break;case"calcite-loader":customElements.get(e)||O4();break}})}b7t();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const w7t=":host{display:flex}ul{margin:0px;display:inline-flex;block-size:100%;align-items:center;padding:0px}:host([layout=vertical]) ul{display:flex;inline-size:100%;flex-direction:column}:host([hidden]){display:none}[hidden]{display:none}",x7t=w7t,S7t=H0(class extends q0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.menuItems=[],this.handleMenuSlotChange=e=>{this.menuItems=Upe(e),this.setMenuItemLayout(this.menuItems,this.layout)},this.label=void 0,this.layout="horizontal",this.messageOverrides=void 0,this.messages=void 0,this.defaultMessages=void 0,this.effectiveLocale=""}handleGlobalAttributesChanged(){I7(this),this.setMenuItemLayout(this.menuItems,this.layout)}handleLayoutChange(e){this.setMenuItemLayout(this.menuItems,e)}onMessagesChange(){}effectiveLocaleChange(){D7(this,this.effectiveLocale)}connectedCallback(){$7(this),F7(this)}async componentWillLoad(){UC(this),await L7(this)}componentDidLoad(){BC(this)}disconnectedCallback(){N7(this),k7(this)}async setFocus(){await zC(this),this.el.focus()}calciteInternalNavMenuItemKeyEvent(e){const i=e.target,r=e.detail.children,s=e.detail.event.key;e.stopPropagation(),s==="ArrowDown"?i.layout==="vertical"?QB(this.menuItems,i,"next",!1):e.detail.isSubmenuOpen&&r[0].setFocus():s==="ArrowUp"?this.layout==="vertical"?QB(this.menuItems,i,"previous",!1):e.detail.isSubmenuOpen&&r[r.length-1].setFocus():s==="ArrowRight"?this.layout==="horizontal"?QB(this.menuItems,i,"next",!1):e.detail.isSubmenuOpen&&r[0].setFocus():s==="ArrowLeft"?this.layout==="horizontal"?QB(this.menuItems,i,"previous",!1):e.detail.isSubmenuOpen&&this.focusParentElement(e.target):s==="Escape"&&this.focusParentElement(e.target),e.preventDefault()}focusParentElement(e){const i=e.parentElement;i&&(eHe(i),i.open=!1)}setMenuItemLayout(e,i){e.forEach(r=>{r.layout=i,this.getEffectiveRole()==="menubar"&&(r.isTopLevelItem=!0,r.topLevelMenuLayout=this.layout)})}getEffectiveRole(){return this.el.getAttribute("role")||"menubar"}render(){return it(d1,{key:"669e13e4abc6cbb425226bd6e7d25f83f0283eab"},it("ul",{key:"d6b5858ea4e4935a7f789c2ed9b40432baa28e7e","aria-label":this.label,role:this.getEffectiveRole()},it("slot",{key:"5e72015f3b6c1f81dabe0ada164d105d1bda82e4",onSlotchange:this.handleMenuSlotChange})))}static get delegatesFocus(){return!0}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{role:["handleGlobalAttributesChanged"],layout:["handleLayoutChange"],messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return x7t}},[17,"calcite-menu",{label:[1],layout:[513],messageOverrides:[1040],messages:[1040],defaultMessages:[32],effectiveLocale:[32],setFocus:[64]},[[0,"calciteInternalMenuItemKeyEvent","calciteInternalNavMenuItemKeyEvent"]],{role:["handleGlobalAttributesChanged"],layout:["handleLayoutChange"],messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}]);function _He(){if(typeof customElements>"u")return;["calcite-menu"].forEach(e=>{switch(e){case"calcite-menu":customElements.get(e)||customElements.define(e,S7t);break}})}_He();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const fn={container:"container",content:"content",dropdownVertical:"dropdown--vertical",dropdownMenuItems:"dropdown-menu-items",dropdownAction:"dropdown-action",layoutVertical:"layout--vertical",hoverHrefIcon:"hover-href-icon",icon:"icon",iconBreadcrumb:"icon--breadcrumb",iconDropdown:"icon--dropdown",iconEnd:"icon--end",iconStart:"icon--start",isParentVertical:"parent--vertical",itemContent:"item-content",open:"open",nested:"nested",textContainer:"text-container"},T7t=`:host{position:relative;box-sizing:border-box;display:flex;align-items:center;flex-shrink:0}:host .container,:host .item-content,:host .content{min-block-size:3rem}:host([layout=vertical]){inline-size:100%}:host(:not([layout=vertical])){block-size:100%}.container,.item-content{display:flex;block-size:100%;inline-size:100%;flex-direction:row;align-items:stretch}.content{position:relative;box-sizing:border-box;display:flex;block-size:100%;inline-size:100%;cursor:pointer;align-items:center;justify-content:center;background-color:var(--calcite-color-foreground-1);padding-inline:1rem;font-size:var(--calcite-font-size-0);color:var(--calcite-color-text-2);outline:2px solid transparent;outline-offset:2px;text-decoration:none;border-block-end:0.125rem solid transparent;padding-block-start:0.125rem}.content:hover{background-color:var(--calcite-color-foreground-2);color:var(--calcite-color-text-2)}.content:focus{background-color:var(--calcite-color-foreground-2);color:var(--calcite-color-text-2);outline:2px solid var(--calcite-ui-focus-color, var(--calcite-color-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-offset-invert-focus),
                1
              )
            )
          )}.content:active{background-color:var(--calcite-color-foreground-3);color:var(--calcite-color-text-1)}.content span{display:inline-flex}.content.layout--vertical{display:flex;inline-size:100%;justify-content:flex-start;padding-block:1rem;border-block-end:0;border-inline-end:0.25rem solid transparent}:host([active]) .content{color:var(--calcite-color-text-1);border-color:var(--calcite-color-brand)}:host([active]) .content .icon{--calcite-ui-icon-color:var(--calcite-color-brand)}:host([layout=vertical]) .content{padding-inline:0.75rem}.icon--start{margin-inline-end:0.75rem}.icon--end{margin-inline-start:0.75rem}:host([layout=vertical]) .icon--end{margin-inline-start:auto;padding-inline-start:0.75rem}.icon--dropdown{position:relative;margin-inline-start:auto;margin-inline-end:0px;padding-inline-start:0.5rem;--calcite-ui-icon-color:var(--calcite-color-text-3)}:host([layout=vertical]) .icon--end~.icon--dropdown{margin-inline-start:0.75rem}:host([layout=vertical]) .hover-href-icon{padding-inline-start:0.5rem}:host([layout=vertical]) .hover-href-icon~.icon--end{margin-inline-start:0.5rem}:host([layout=vertical]) .hover-href-icon~.icon--breadcrumb{margin-inline-start:0.75rem}.icon--breadcrumb{margin-inline-end:0px;padding-inline-start:0.5rem;--calcite-ui-icon-color:var(--calcite-color-text-3)}:host([layout=vertical]) .icon--breadcrumb{margin-inline-start:auto}:host([layout=vertical]) .icon--breadcrumb~.icon--dropdown{margin-inline-start:0.5rem}:host([layout=vertical]) .icon--end~.icon--breadcrumb{margin-inline-start:0.5rem}:host([breadcrumb]) .content{padding-inline-end:0.75rem}calcite-action{position:relative;block-size:auto;border-inline-start:1px solid var(--calcite-color-foreground-1)}calcite-action:after{position:absolute;inset-inline-start:-1px;display:block;inline-size:1px;content:"";inset-block:0.75rem;background-color:var(--calcite-color-border-3)}calcite-action:hover:after{block-size:100%;inset-block:0}.content:focus~calcite-action,.content:hover~calcite-action{color:var(--calcite-color-text-1);border-inline-start:1px solid var(--calcite-color-border-3)}.container:hover .dropdown-action{background-color:var(--calcite-color-foreground-2)}.dropdown-menu-items{position:absolute;display:none;block-size:auto;min-inline-size:100%;flex-direction:column;overflow:visible;border:1px solid var(--calcite-color-border-3);background:var(--calcite-color-foreground-1);inset-block-start:100%;z-index:var(--calcite-z-index-dropdown)}.dropdown-menu-items.open{display:block}.dropdown-menu-items.nested{position:absolute;inset-block-start:-1px;transform:translateX(calc(100% - 2px))}.parent--vertical{flex-direction:column}.dropdown--vertical.dropdown-menu-items{position:relative;border-radius:0px;box-shadow:none;inset-block-start:0;transform:none}.dropdown--vertical.dropdown-menu-items:last-of-type{border-inline:0}:host([layout=vertical]:last-of-type) .dropdown-menu-items{border-block-end:0}:host([slot=submenu-item]) .parent--vertical{padding-inline-start:1.5rem}.dropdown-menu-items.nested.calcite--rtl{transform:translateX(calc(-100% + 2px))}.dropdown--vertical.dropdown-menu-items.nested.calcite--rtl{transform:none}.hover-href-icon{position:relative;inset-inline-end:0.25rem;margin-inline-start:auto;opacity:0;transition:all var(--calcite-internal-animation-timing-medium) ease-in-out}.content:focus .hover-href-icon,.content:hover .hover-href-icon{inset-inline-end:-0.25rem;opacity:1}:host([hidden]){display:none}[hidden]{display:none}`,E7t=T7t,C7t=H0(class extends q0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteInternalMenuItemKeyEvent=Une(this,"calciteInternalMenuItemKeyEvent",7),this.calciteMenuItemSelect=Une(this,"calciteMenuItemSelect",7),this.clickHandler=e=>{(this.href&&e.target===this.dropdownActionEl||!this.href&&this.hasSubmenu)&&(this.open=!this.open),this.selectMenuItem(e)},this.handleMenuItemSlotChange=e=>{this.submenuItems=Upe(e),this.submenuItems.forEach(i=>{i.topLevelMenuLayout||(i.topLevelMenuLayout=this.topLevelMenuLayout)}),this.hasSubmenu=this.submenuItems.length>0},this.keyDownHandler=async e=>{const{hasSubmenu:i,href:r,layout:s,open:n,submenuItems:o}=this,a=e.key,l=e.target===this.dropdownActionEl;if(!e.defaultPrevented){if(a===" "||a==="Enter")i&&(!r||r&&l)&&(this.open=!n),!(r&&l)&&a!=="Enter"&&this.selectMenuItem(e),(a===" "||r&&l)&&e.preventDefault();else if(a==="Escape"){if(n){this.open=!1;return}this.calciteInternalMenuItemKeyEvent.emit({event:e}),e.preventDefault()}else if(a==="ArrowDown"||a==="ArrowUp"){if(e.preventDefault(),(l||!r)&&i&&!n&&s==="horizontal"){this.open=!0;return}this.calciteInternalMenuItemKeyEvent.emit({event:e,children:o,isSubmenuOpen:n&&i})}else if(a==="ArrowLeft")e.preventDefault(),this.calciteInternalMenuItemKeyEvent.emit({event:e,children:o,isSubmenuOpen:!0});else if(a==="ArrowRight"){if(e.preventDefault(),(l||!r)&&i&&!n&&s==="vertical"){this.open=!0;return}this.calciteInternalMenuItemKeyEvent.emit({event:e,children:o,isSubmenuOpen:n&&i})}}},this.active=void 0,this.breadcrumb=void 0,this.href=void 0,this.iconEnd=void 0,this.iconFlipRtl=void 0,this.iconStart=void 0,this.isTopLevelItem=!1,this.label=void 0,this.layout=void 0,this.messageOverrides=void 0,this.messages=void 0,this.open=!1,this.rel=void 0,this.target=void 0,this.text=void 0,this.topLevelMenuLayout=void 0,this.defaultMessages=void 0,this.effectiveLocale="",this.hasSubmenu=!1,this.submenuItems=void 0}onMessagesChange(){}effectiveLocaleChange(){D7(this,this.effectiveLocale)}async setFocus(){await zC(this),this.anchorEl.focus()}handleClickOut(e){this.topLevelMenuLayout!=="vertical"&&this.hasSubmenu&&this.open&&!e.composedPath().includes(this.el)&&(this.open=!1)}handleFocusOut(e){this.topLevelMenuLayout!=="vertical"&&!this.el.contains(e.relatedTarget)&&(this.open=!1)}connectedCallback(){$7(this),F7(this)}async componentWillLoad(){UC(this),await L7(this)}componentDidLoad(){BC(this)}disconnectedCallback(){N7(this),k7(this)}blurHandler(){this.isFocused=!1}focusHandler(e){const i=e.target;this.isFocused=!0,i.open&&!this.open&&(i.open=!1)}selectMenuItem(e){e.target!==this.dropdownActionEl&&this.calciteMenuItemSelect.emit()}renderIconStart(){return it("calcite-icon",{class:`${fn.icon} ${fn.iconStart}`,flipRtl:this.iconFlipRtl==="start"||this.iconFlipRtl==="both",icon:this.iconStart,key:fn.iconStart,scale:"s"})}renderIconEnd(){return it("calcite-icon",{class:`${fn.icon} ${fn.iconEnd}`,flipRtl:this.iconFlipRtl==="end"||this.iconFlipRtl==="both",icon:this.iconEnd,key:fn.iconEnd,scale:"s"})}renderBreadcrumbIcon(e){return it("calcite-icon",{class:`${fn.icon} ${fn.iconBreadcrumb}`,icon:e==="rtl"?"chevron-left":"chevron-right",key:fn.iconBreadcrumb,scale:"s"})}renderDropdownIcon(e){const i=e==="rtl"?"chevron-left":"chevron-right";return it("calcite-icon",{class:`${fn.icon} ${fn.iconDropdown}`,icon:this.topLevelMenuLayout==="vertical"||this.isTopLevelItem?this.open?"chevron-up":"chevron-down":i,key:fn.iconDropdown,scale:"s"})}renderDropdownAction(e){const i=e==="rtl"?"chevron-left":"chevron-right";return it("calcite-action",{class:fn.dropdownAction,icon:this.topLevelMenuLayout==="vertical"||this.isTopLevelItem?this.open?"chevron-up":"chevron-down":i,key:fn.dropdownAction,onClick:this.clickHandler,onKeyDown:this.keyDownHandler,text:this.messages.open,ref:r=>this.dropdownActionEl=r})}renderSubmenuItems(e){return it("calcite-menu",{class:{[fn.dropdownMenuItems]:!0,[fn.open]:this.open,[fn.nested]:!this.isTopLevelItem,[Fne.rtl]:e==="rtl",[fn.dropdownVertical]:this.topLevelMenuLayout==="vertical"},label:this.messages.submenu,layout:"vertical",role:"menu"},it("slot",{name:"submenu-item",onSlotchange:this.handleMenuItemSlotChange}))}renderHrefIcon(e){return it("calcite-icon",{class:fn.hoverHrefIcon,icon:e==="rtl"?"arrow-left":"arrow-right",key:fn.hoverHrefIcon,scale:"s"})}renderItemContent(e){const i=this.href&&(this.topLevelMenuLayout==="vertical"||!this.isTopLevelItem);return it(G8e,null,this.iconStart&&this.renderIconStart(),it("div",{class:fn.textContainer},it("span",null,this.text)),i&&this.renderHrefIcon(e),this.iconEnd&&this.renderIconEnd(),this.breadcrumb?this.renderBreadcrumbIcon(e):null,!this.href&&this.hasSubmenu?this.renderDropdownIcon(e):null)}render(){const e=X8e(this.el);return it(d1,{key:"a84ca1769bc08137a7defbea5e10ee12a78fbd58",onBlur:this.blurHandler,onFocus:this.focusHandler},it("li",{key:"88d13dda176ed2821b59505a6866b98b88f47f9b",class:{[fn.container]:!0,[fn.isParentVertical]:this.topLevelMenuLayout==="vertical"},role:"none"},it("div",{key:"185265194184e457cfc1d578bee3b8c5e02d45b3",class:fn.itemContent},it("a",{key:"456bbee5f9af53b51951c57b355b0696fa76fff7","aria-current":this.isFocused?"page":!1,"aria-expanded":this.open,"aria-haspopup":this.hasSubmenu,"aria-label":this.label,class:{[fn.layoutVertical]:this.layout==="vertical",[fn.content]:!0},href:this.href,onClick:this.clickHandler,onKeyDown:this.keyDownHandler,rel:this.rel,role:"menuitem",tabIndex:this.isTopLevelItem?0:-1,target:this.target,ref:i=>this.anchorEl=i},this.renderItemContent(e)),this.href&&this.hasSubmenu?this.renderDropdownAction(e):null),this.renderSubmenuItems(e)))}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return E7t}},[1,"calcite-menu-item",{active:[516],breadcrumb:[516],href:[1],iconEnd:[513,"icon-end"],iconFlipRtl:[513,"icon-flip-rtl"],iconStart:[513,"icon-start"],isTopLevelItem:[4,"is-top-level-item"],label:[1],layout:[513],messageOverrides:[1040],messages:[1040],open:[1540],rel:[513],target:[513],text:[1],topLevelMenuLayout:[1,"top-level-menu-layout"],defaultMessages:[32],effectiveLocale:[32],hasSubmenu:[32],submenuItems:[32],setFocus:[64]},[[8,"click","handleClickOut"],[0,"focusout","handleFocusOut"]],{messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}]);function M7t(){if(typeof customElements>"u")return;["calcite-menu-item","calcite-action","calcite-icon","calcite-loader","calcite-menu"].forEach(e=>{switch(e){case"calcite-menu-item":customElements.get(e)||customElements.define(e,C7t);break;case"calcite-action":customElements.get(e)||zpe();break;case"calcite-icon":customElements.get(e)||Jx();break;case"calcite-loader":customElements.get(e)||O4();break;case"calcite-menu":customElements.get(e)||_He();break}})}M7t();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const __={container:"container",containerContent:"container-content",hasProgress:"progress-bar",hide:"hide",primary:"primary",secondary:"secondary",tertiary:"tertiary"},_c={logo:"logo",user:"user",progress:"progress",navigationAction:"navigation-action",contentStart:"content-start",contentEnd:"content-end",contentCenter:"content-center",navSecondary:"navigation-secondary",navTertiary:"navigation-tertiary"},A7t={hamburger:"hamburger"},R7t=":host([hidden]){display:none}[hidden]{display:none}.container{margin-inline:auto;display:flex;inline-size:100%;flex-direction:column;margin-block:0;margin-inline:auto;background-color:var(--calcite-navigation-background, var(--calcite-color-foreground-1))}.container.primary,.container.secondary,.container.tertiary{border-block-end:1px solid;border-block-end-color:var(--calcite-navigation-border-color, var(--calcite-color-border-3))}.user,.logo{display:flex}.hide{display:none}.primary{block-size:4rem}.secondary{block-size:3rem}.tertiary{block-size:3rem}.container-content{margin-inline:auto;display:flex;block-size:100%;inline-size:100%;margin-block:0;inline-size:var(--calcite-navigation-width, 100%);max-inline-size:100%}.container-content.progress-bar{margin-block-start:0.125rem}slot[name]{display:flex;flex-direction:row}slot[name=navigation-secondary]::slotted(calcite-navigation),slot[name=navigation-tertiary]::slotted(calcite-navigation){inline-size:100%}slot[name=content-start]::slotted(*),slot[name=content-center]::slotted(*),slot[name=content-end]::slotted(*){display:flex;flex-direction:row;align-items:center}slot[name=progress],slot[name=progress] calcite-progress{inset-block-start:0;inset-inline:0}slot[name=content-end]{margin-inline-start:auto}slot[name=content-start]{margin-inline-end:auto}slot[name=content-end],slot[name=logo]~slot[name=user],slot[name=user]:only-child{margin-inline-start:auto}slot[name=content-center]{margin-inline-start:auto;margin-inline-end:auto}slot[name=content-start]~slot[name=content-center]{margin-inline-start:0px}slot[name=content-start]~slot[name=content-end],slot[name=content-center]~slot[name=content-end],slot[name=content-center]~slot[name=user],slot[name=content-end]~slot[name=user]{margin:0px}",P7t=R7t,O7t=H0(class extends q0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteNavigationActionSelect=Une(this,"calciteNavigationActionSelect",6),this.actionClickHandler=()=>{this.calciteNavigationActionSelect.emit()},this.handleUserSlotChange=e=>{this.isPrimaryLevel()&&(this.userSlotHasElements=y_(e))},this.handleLogoSlotChange=e=>{this.isPrimaryLevel()&&(this.logoSlotHasElements=y_(e))},this.handleContentStartSlotChange=e=>{this.isPrimaryLevel()&&(this.primaryContentStartSlotHasElements=y_(e))},this.handleContentEndSlotChange=e=>{this.isPrimaryLevel()&&(this.primaryContentEndSlotHasElements=y_(e))},this.handleContentCenterSlotChange=e=>{this.isPrimaryLevel()&&(this.primaryContentCenterSlotHasElements=y_(e))},this.handleSecondarySlotChange=e=>{this.secondarySlotHasElements=y_(e)},this.handleTertiarySlotChange=e=>{this.tertiarySlotHasElements=y_(e)},this.handleMenuActionSlotChange=e=>{this.isPrimaryLevel()&&(this.navigationActionSlotHasElements=y_(e),this.navigationActionSlotHasElements&&(this.navigationAction=!1))},this.handleProgressSlotChange=e=>{this.isPrimaryLevel()&&(this.progressSlotHasElement=y_(e))},this.label=void 0,this.navigationAction=!1,this.logoSlotHasElements=void 0,this.navigationActionSlotHasElements=void 0,this.primaryContentCenterSlotHasElements=void 0,this.primaryContentEndSlotHasElements=void 0,this.primaryContentStartSlotHasElements=void 0,this.progressSlotHasElement=void 0,this.secondarySlotHasElements=void 0,this.tertiarySlotHasElements=void 0,this.userSlotHasElements=void 0}async setFocus(){return await zC(this),this.navigationActionEl?.setFocus()}componentWillLoad(){UC(this)}componentDidLoad(){BC(this)}isPrimaryLevel(){return this.el.slot!==_c.navSecondary&&this.el.slot!==_c.navTertiary}renderMenuAction(){return it("slot",{name:_c.navigationAction,onSlotchange:this.handleMenuActionSlotChange},this.navigationAction&&it("calcite-action",{icon:A7t.hamburger,onClick:this.actionClickHandler,text:this.label,ref:e=>this.navigationActionEl=e}))}render(){const e=this.logoSlotHasElements||this.userSlotHasElements||this.navigationActionSlotHasElements||this.primaryContentCenterSlotHasElements||this.primaryContentEndSlotHasElements||this.primaryContentStartSlotHasElements||this.navigationAction,i=this.el.slot;return it(d1,{key:"8bbdbb63ced5dbf54b0e2f7d21327780ec02c461"},it("div",{key:"30f9b294f2d7589b879ebf6444c7d50291544395",class:{[__.container]:!0,[__.secondary]:i===_c.navSecondary,[__.tertiary]:i===_c.navTertiary,[__.primary]:e}},it("div",{key:"b5e645212bd0eb7fe7188fedf8a9a97022012698",class:{[__.hide]:!this.progressSlotHasElement,[_c.progress]:!0}},it("slot",{key:"138fe1bcec98a49c9d2a70ab13c057f2e5f14b7c",name:_c.progress,onSlotchange:this.handleProgressSlotChange})),it("div",{key:"ef62d2575a2620b8530a4fc2e1df97adce0fabd7",class:{[__.containerContent]:!0,[__.hasProgress]:this.progressSlotHasElement}},this.renderMenuAction(),it("div",{key:"c775762b072e199be013daa9821fcb9833ac08b8",class:{[__.hide]:!this.logoSlotHasElements,[_c.logo]:!0}},it("slot",{key:"6925a8a345685c3bb90d5e994454c24bac80611a",name:_c.logo,onSlotchange:this.handleLogoSlotChange})),it("slot",{key:"0121dc1a80006070b325c19e73a80f0374301392",name:_c.contentStart,onSlotchange:this.handleContentStartSlotChange}),it("slot",{key:"3257e07e02c5aa5ae517306069eed4ca8abf3b8f",name:_c.contentCenter,onSlotchange:this.handleContentCenterSlotChange}),it("slot",{key:"23f105f826d3fe35f9270b552927bbf89aa7dbbd",name:_c.contentEnd,onSlotchange:this.handleContentEndSlotChange}),it("div",{key:"469ad09b41f4cbdc09473065fa5fcf8638a82c1d",class:{[__.hide]:!this.userSlotHasElements,[_c.user]:!0}},it("slot",{key:"78bb1fe16546fa871887991ab1916fb32ebf8186",name:_c.user,onSlotchange:this.handleUserSlotChange})))),it(G8e,{key:"28d6c126b06c4c4a52c425e90772c5f151468014"},it("slot",{key:"913e9cce3188cc23d87eb0471f5d91cbdb3788b8",name:_c.navSecondary,onSlotchange:this.handleSecondarySlotChange}),it("slot",{key:"ff4d86c572567ca4993b6091185fc9d48ecb1ab0",name:_c.navTertiary,onSlotchange:this.handleTertiarySlotChange})))}get el(){return this}static get style(){return P7t}},[1,"calcite-navigation",{label:[1],navigationAction:[516,"navigation-action"],logoSlotHasElements:[32],navigationActionSlotHasElements:[32],primaryContentCenterSlotHasElements:[32],primaryContentEndSlotHasElements:[32],primaryContentStartSlotHasElements:[32],progressSlotHasElement:[32],secondarySlotHasElements:[32],tertiarySlotHasElements:[32],userSlotHasElements:[32],setFocus:[64]}]);function I7t(){if(typeof customElements>"u")return;["calcite-navigation","calcite-action","calcite-icon","calcite-loader"].forEach(e=>{switch(e){case"calcite-navigation":customElements.get(e)||customElements.define(e,O7t);break;case"calcite-action":customElements.get(e)||zpe();break;case"calcite-icon":customElements.get(e)||Jx();break;case"calcite-loader":customElements.get(e)||O4();break}})}I7t();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const $7t=(t,e)=>{const i=t.level?`h${t.level}`:"div";return delete t.level,it(i,{...t},e)};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const Jg={container:"container",heading:"heading",description:"description",anchor:"anchor",image:"image",standalone:"standalone",icon:"icon"},N7t=`:host{display:inline-flex;outline:2px solid transparent;outline-offset:2px}.anchor{margin:0px;display:flex;cursor:pointer;align-items:center;justify-content:center;font-size:var(--calcite-font-size-0);line-height:1.25rem;text-decoration-line:none;outline-color:transparent;transition:background-color, block-size, border-color, box-shadow, color, inset-block-end, inset-block-start, inset-inline-end, inset-inline-start inset-size, opacity, outline-color, transform var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;color:inherit;border-block-end:2px solid transparent}.anchor:hover,.anchor:focus{background-color:var(--calcite-color-foreground-2)}.anchor:focus{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-color-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-offset-invert-focus),
                1
              )
            )
          )}.anchor:active{background-color:var(--calcite-color-foreground-3)}.image,.icon{margin:0px;display:flex;block-size:1.75rem;padding-inline:1rem}.image~.icon{padding-inline-start:0px}.image~.container,.icon~.container{padding-inline-start:0px}:host(:active) .anchor{color:var(--calcite-color-text-1)}:host([active]) .anchor{color:var(--calcite-color-text-1);border-color:var(--calcite-color-brand);--calcite-ui-icon-color:var(--calcite-color-brand)}.container{margin-block-start:0.125rem;display:flex;flex-direction:column;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-inline:1rem;text-align:start}.heading{margin-inline-start:0px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:var(--calcite-font-size-0);font-weight:var(--calcite-font-weight-medium);color:var(--calcite-color-text-1)}.standalone{font-size:var(--calcite-font-size-1)}.description{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:var(--calcite-color-text-2);font-size:var(--calcite-font-size--1)}:host([hidden]){display:none}[hidden]{display:none}`,L7t=N7t,D7t=H0(class extends q0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.active=void 0,this.href=void 0,this.icon=void 0,this.iconFlipRtl=!1,this.label=void 0,this.rel=void 0,this.description=void 0,this.target=void 0,this.heading=void 0,this.thumbnail=void 0,this.headingLevel=void 0}async setFocus(){await zC(this),this.href&&this.el.focus()}componentWillLoad(){UC(this)}componentDidLoad(){BC(this)}renderIcon(){return it("calcite-icon",{class:Jg.icon,flipRtl:this.iconFlipRtl,icon:this.icon,scale:"l"})}renderHeaderContent(){const{heading:e,headingLevel:i,description:r}=this,s=e?it($7t,{class:{[Jg.heading]:!0,[Jg.standalone]:!this.description},key:Jg.heading,level:i},e):null,n=r?it("span",{class:Jg.description,key:Jg.description},r):null;return s||n?it("div",{class:Jg.container,key:Jg.container},s,n):null}render(){const{thumbnail:e}=this;return it(d1,{key:"cd8a1c95e9c72a494942c09285db6ce4e554e6a1"},it("a",{key:"bcb1a269e0d6cde0969de9d822f1f98e689f826a",class:Jg.anchor,href:this.href,rel:this.rel,target:this.target},e&&it("img",{key:"c028ae89a0e3ae62e90280e3646894e9ee70458b",alt:this.label||"",class:Jg.image,src:e}),this.icon&&this.renderIcon(),this.renderHeaderContent()))}static get delegatesFocus(){return!0}get el(){return this}static get style(){return L7t}},[17,"calcite-navigation-logo",{active:[516],href:[513],icon:[513],iconFlipRtl:[516,"icon-flip-rtl"],label:[1],rel:[513],description:[1],target:[513],heading:[1],thumbnail:[1],headingLevel:[514,"heading-level"],setFocus:[64]}]);function F7t(){if(typeof customElements>"u")return;["calcite-navigation-logo","calcite-icon"].forEach(e=>{switch(e){case"calcite-navigation-logo":customElements.get(e)||customElements.define(e,D7t);break;case"calcite-icon":customElements.get(e)||Jx();break}})}F7t();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const k7t=/^#[0-9A-F]{3}$/i,U7t=/^#[0-9A-F]{6}$/i,B7t=/^#[0-9A-F]{4}$/i,z7t=/^#[0-9A-F]{8}$/i;function qne(t,e=!1){return V7t(t,e)||G7t(t,e)}function vHe(t,e,i){return t?t.length===e&&i.test(t):!1}function V7t(t,e=!1){return vHe(t,e?5:4,e?B7t:k7t)}function G7t(t,e=!1){return vHe(t,e?9:7,e?z7t:U7t)}function j7t(t,e=!1){if(!qne(t,e))return null;t=t.replace("#","");let i,r,s,n;if(t.length===3||t.length===4){const[a,l,c,u]=t.split("");i=parseInt(`${a}${a}`,16),r=parseInt(`${l}${l}`,16),s=parseInt(`${c}${c}`,16),n=parseInt(`${u}${u}`,16)/255}else i=parseInt(t.slice(0,2),16),r=parseInt(t.slice(2,4),16),s=parseInt(t.slice(4,6),16),n=parseInt(t.slice(6,8),16)/255;return isNaN(n)?{r:i,g:r,b:s}:{r:i,g:r,b:s,a:n}}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */function H7t(t){let e=0;for(let r=0;r<t.length;r++)e=t.charCodeAt(r)+((e<<5)-e);let i="#";for(let r=0;r<3;r++){const s=e>>r*8&255;i+=("00"+s.toString(16)).substr(-2)}return i}function q7t(t){let{r:e,g:i,b:r}=t;e/=255,i/=255,r/=255;const s=Math.max(e,i,r),n=Math.min(e,i,r),o=s-n;if(s===n)return 0;let a=(s+n)/2;switch(s){case e:a=(i-r)/o+(i<r?6:0);break;case i:a=(r-e)/o+2;break;case r:a=(e-i)/o+4;break}return Math.round(a*60)}function W7t(t){return q7t(j7t(t))}const Y7t=":host{display:inline-block;overflow:hidden;border-radius:50%}:host([scale=s]){block-size:1.5rem;inline-size:1.5rem;font-size:var(--calcite-font-size--3)}:host([scale=m]){block-size:2rem;inline-size:2rem;font-size:var(--calcite-font-size--2)}:host([scale=l]){block-size:2.75rem;inline-size:2.75rem;font-size:var(--calcite-font-size-0)}.icon{display:flex}.background{display:flex;block-size:100%;inline-size:100%;align-items:center;justify-content:center;border-radius:50%}.initials{font-weight:var(--calcite-font-weight-bold);text-transform:uppercase;color:var(--calcite-color-text-2)}.thumbnail{block-size:100%;inline-size:100%;border-radius:50%}:host([hidden]){display:none}[hidden]{display:none}",X7t=Y7t,Z7t=H0(class extends q0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.scale="m",this.thumbnail=void 0,this.fullName=void 0,this.username=void 0,this.userId=void 0,this.label=void 0,this.thumbnailFailedToLoad=!1}render(){return this.determineContent()}determineContent(){if(this.thumbnail&&!this.thumbnailFailedToLoad)return it("img",{alt:this.label||"",class:"thumbnail",onError:()=>this.thumbnailFailedToLoad=!0,src:this.thumbnail});const e=this.generateInitials(),i=this.generateFillColor();return it("span",{"aria-label":this.label||this.fullName,class:"background",role:"figure",style:{backgroundColor:i}},e?it("span",{"aria-hidden":"true",class:"initials"},e):it("calcite-icon",{class:"icon",icon:"user",scale:this.scale}))}generateFillColor(){const{userId:e,username:i,fullName:r,el:s}=this,n=w9t(s),o=e&&`#${e.substr(e.length-6)}`,a=i||r||"",l=o&&qne(o)?o:H7t(a);return!e&&!a||!qne(l)?"var(--calcite-color-foreground-2)":`hsl(${W7t(l)}, 60%, ${n==="dark"?20:90}%)`}generateInitials(){const{fullName:e,username:i}=this;return e?e.trim().split(" ").map(r=>r.substring(0,1)).join(""):i?i.substring(0,2):!1}get el(){return this}static get style(){return X7t}},[1,"calcite-avatar",{scale:[513],thumbnail:[513],fullName:[513,"full-name"],username:[513],userId:[513,"user-id"],label:[1],thumbnailFailedToLoad:[32]}]);function bHe(){if(typeof customElements>"u")return;["calcite-avatar","calcite-icon"].forEach(e=>{switch(e){case"calcite-avatar":customElements.get(e)||customElements.define(e,Z7t);break;case"calcite-icon":customElements.get(e)||Jx();break}})}bHe();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.8.5
 */const nA={textContainer:"text-container",fullName:"full-name",username:"username",button:"button"},J7t=`:host{display:inline-flex;outline:2px solid transparent;outline-offset:2px}:host .button{background-color:transparent;border:none;margin:0px;display:flex;cursor:pointer;align-items:center;justify-content:center;font-family:var(--calcite-font-family);font-size:var(--calcite-font-size-0);line-height:1.25rem;outline-color:transparent;transition:background-color, block-size, border-color, box-shadow, color, inset-block-end, inset-block-start, inset-inline-end, inset-inline-start inset-size, opacity, outline-color, transform var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;border-block-end:2px solid transparent}:host(:hover) .button,:host(:focus) .button{background-color:var(--calcite-color-foreground-2)}:host(:focus) .button{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-color-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-offset-invert-focus),
                1
              )
            )
          )}:host(:active) .button{background-color:var(--calcite-color-foreground-3);color:var(--calcite-color-text-1)}:host([active]) .button{border-color:var(--calcite-color-brand);color:var(--calcite-color-text-1);--calcite-ui-icon-color:var(--calcite-color-brand)}.text-container{margin-block-start:0.125rem;display:flex;flex-direction:column;padding-inline:1rem;text-align:start}calcite-avatar{padding-inline:1rem}calcite-avatar~.text-container{padding-inline-start:0px}.full-name{margin-inline-start:0px;font-size:var(--calcite-font-size-0);font-weight:var(--calcite-font-weight-medium);color:var(--calcite-color-text-1)}.username{color:var(--calcite-color-text-2);font-size:var(--calcite-font-size--1)}:host([hidden]){display:none}[hidden]{display:none}`,Q7t=J7t,K7t=H0(class extends q0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.active=void 0,this.fullName=void 0,this.label=void 0,this.textDisabled=!1,this.thumbnail=void 0,this.userId=void 0,this.username=void 0}async setFocus(){await zC(this),this.el.focus()}componentWillLoad(){UC(this)}componentDidLoad(){BC(this)}render(){return it(d1,{key:"869bc0b518ff407bf3f110ebda48571f456229a8"},it("button",{key:"0cb5497ebcbf9fad2bfb6ffdd3bfad151594460d","aria-label":this.label,class:nA.button},it("calcite-avatar",{key:"6de54637d077afa83f7520636037b6da33b24334","full-name":this.fullName,label:this.label,thumbnail:this.thumbnail,"user-id":this.userId,username:this.username}),(this.fullName||this.username)&&!this.textDisabled&&it("div",{key:"0d0be3d6ba276d6c3e24a67b7085dd75e56b3e5b",class:nA.textContainer},this.fullName&&it("span",{class:nA.fullName,key:nA.fullName},this.fullName),this.username&&it("span",{class:nA.username,key:nA.username},this.username))))}static get delegatesFocus(){return!0}get el(){return this}static get style(){return Q7t}},[17,"calcite-navigation-user",{active:[516],fullName:[1,"full-name"],label:[1],textDisabled:[516,"text-disabled"],thumbnail:[1],userId:[1,"user-id"],username:[1],setFocus:[64]}]);function eWt(){if(typeof customElements>"u")return;["calcite-navigation-user","calcite-avatar","calcite-icon"].forEach(e=>{switch(e){case"calcite-navigation-user":customElements.get(e)||customElements.define(e,K7t);break;case"calcite-avatar":customElements.get(e)||bHe();break;case"calcite-icon":customElements.get(e)||Jx();break}})}eWt();var tWt=Object.defineProperty,iWt=Object.getOwnPropertyDescriptor,Gpe=(t,e,i,r)=>{for(var s=r>1?void 0:r?iWt(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&tWt(e,i,s),s};let ok=class extends xH{constructor(t){super(t),this.userMenuOpen=!1,this.closeUserMenu=()=>{this.userMenuOpen=!1};const e=t.store.view.container;e.addEventListener("mousedown",this.closeUserMenu),this.addHandles([{remove:()=>{e.removeEventListener("mousedown",this.closeUserMenu)}}])}signOut(){this.store.userStore.signOut(),this.closeUserMenu()}openScene(){const t=this.store.map.portalItem.itemPageUrl;t&&window.open(t,"new")}render(){const t=this.userMenuOpen?"":"hide";return fr("div",null,fr("calcite-navigation",{slot:"header"},fr("calcite-navigation-logo",{slot:"logo",heading:this.store.map.portalItem.title,description:"ArcGIS Maps SDK for JavaScript",thumbnail:"./icon-64.svg",onclick:()=>{this.openScene()}}),this.renderUserProfile()),fr("calcite-menu",{id:"user-menu",layout:"vertical",label:"Application menu",class:t},fr("calcite-menu-item",{"icon-start":"sign-out",text:"Sign Out",onclick:()=>this.signOut()})))}renderUserProfile(){const t=this.store.userStore;if(t.authenticated){const e=t.user;return fr("calcite-navigation-user",{slot:"user",active:this.userMenuOpen,onclick:()=>{this.userMenuOpen=!this.userMenuOpen},thumbnail:e?.thumbnailUrl,"full-name":e?.fullName,username:e?.username})}else return fr("calcite-menu",{slot:"content-end"},fr("calcite-menu-item",{onclick:()=>t.signIn(),text:"Sign in","icon-start":"user","text-enabled":!0}))}};Gpe([m()],ok.prototype,"store",2);Gpe([m()],ok.prototype,"userMenuOpen",2);ok=Gpe([N("arcgis-core-template.Header")],ok);const rWt=ok;var sWt=Object.defineProperty,nWt=Object.getOwnPropertyDescriptor,wHe=(t,e,i,r)=>{for(var s=r>1?void 0:r?nWt(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&sWt(e,i,s),s};let EH=class extends xH{postInitialize(){const t=this.store.view,e=new g9t({view:t});t.ui.add(e,"top-right")}render(){return fr("div",null,fr(rWt,{store:this.store}))}};wHe([m()],EH.prototype,"store",2);EH=wHe([N("arcgis-core-template.App")],EH);const oWt=EH;var Wne;let FL=Wne=class extends we{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new Wne({minValue:this.minValue,maxValue:this.maxValue})}};d([m({type:Number,json:{write:!0}})],FL.prototype,"minValue",void 0),d([m({type:Number,json:{write:!0}})],FL.prototype,"maxValue",void 0),FL=Wne=d([N("esri.renderers.support.AuthoringInfoClassBreakInfo")],FL);var Yne;let iw=Yne=class extends we{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new Yne({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:ee(this.classBreakInfos)})}};d([m({type:String,json:{write:!0}})],iw.prototype,"field",void 0),d([m({type:String,json:{write:!0}})],iw.prototype,"normalizationField",void 0),d([m({type:String,json:{write:!0}})],iw.prototype,"label",void 0),d([m({type:[FL],json:{write:!0}})],iw.prototype,"classBreakInfos",void 0),iw=Yne=d([N("esri.renderers.support.AuthoringInfoFieldInfo")],iw);var Xne;let bR=Xne=class extends we{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new Xne({label:this.label,value:this.value,size:this.size})}};d([m({type:String,json:{write:!0}})],bR.prototype,"label",void 0),d([m({type:Number,json:{write:!0}})],bR.prototype,"size",void 0),d([m({type:Number,json:{write:!0}})],bR.prototype,"value",void 0),bR=Xne=d([N("esri.renderers.support.AuthoringInfoSizeStop")],bR);const aWt=bR;var Zne;const ez=new ur({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),tz=new ur({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),cEe={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},uEe=["high-to-low","above-and-below","centered-on","extremes"],hEe=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size"])],dEe=["seconds","minutes","hours","days","months","years"],lWt=["circle","diamond","hexagon-flat","hexagon-pointy","square"];let sl=Zne=class extends we{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}get normalizationField(){return this.theme==="reference-size"?this._get("normalizationField"):null}set normalizationField(t){this._set("normalizationField",t)}get referenceSizeScale(){return this.theme==="reference-size"?this._get("referenceSizeScale"):null}set referenceSizeScale(t){this._set("referenceSizeScale",t)}get referenceSizeSymbolStyle(){return this.theme==="reference-size"?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(t){this._set("referenceSizeSymbolStyle",t)}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get sizeStops(){return this.theme==="reference-size"?this._get("sizeStops"):null}set sizeStops(t){this._set("sizeStops",t)}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new Zne({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,sizeStops:ee(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};d([m({types:cEe,json:{write:!0}})],sl.prototype,"endTime",void 0),d([vi("endTime")],sl.prototype,"castEndTime",null),d([m({type:String,json:{write:!0}})],sl.prototype,"field",void 0),d([m({type:Number,json:{write:!0}})],sl.prototype,"maxSliderValue",void 0),d([m({type:Number,json:{write:!0}})],sl.prototype,"minSliderValue",void 0),d([m({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],sl.prototype,"normalizationField",null),d([m({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],sl.prototype,"referenceSizeScale",null),d([m({type:lWt,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],sl.prototype,"referenceSizeSymbolStyle",null),d([m({types:cEe,json:{write:!0}})],sl.prototype,"startTime",void 0),d([vi("startTime")],sl.prototype,"castStartTime",null),d([m({type:[aWt],json:{origins:{"web-scene":{write:!1}},write:!0}})],sl.prototype,"sizeStops",null),d([m({type:ez.apiValues,value:null,json:{type:ez.jsonValues,read:ez.read,write:ez.write}})],sl.prototype,"style",null),d([m({type:hEe,value:null,json:{type:hEe,origins:{"web-scene":{type:uEe,write:{writer:(t,e)=>{uEe.includes(t)&&(e.theme=t)}}}},write:!0}})],sl.prototype,"theme",null),d([m({type:tz.apiValues,json:{type:tz.jsonValues,read:tz.read,write:tz.write}})],sl.prototype,"type",void 0),d([m({type:dEe,json:{type:dEe,write:!0}})],sl.prototype,"units",void 0),sl=Zne=d([N("esri.renderers.support.AuthoringInfoVisualVariable")],sl);const cWt=sl;let r6=class extends we{constructor(e){super(e),this.type=null}};d([m({readOnly:!0,json:{read:!1,write:!0}})],r6.prototype,"type",void 0),r6=d([N("esri.rest.support.ColorRamp")],r6);const jpe=r6;var Jne;let QT=Jne=class extends jpe{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new Jne({fromColor:ee(this.fromColor),toColor:ee(this.toColor),algorithm:this.algorithm})}};d([Nt({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],QT.prototype,"algorithm",void 0),d([m({type:Ke,json:{type:[cr],write:!0}})],QT.prototype,"fromColor",void 0),d([m({type:Ke,json:{type:[cr],write:!0}})],QT.prototype,"toColor",void 0),d([m({type:["algorithmic"]})],QT.prototype,"type",void 0),QT=Jne=d([N("esri.rest.support.AlgorithmicColorRamp")],QT);const Hpe=QT;var Qne;let kL=Qne=class extends jpe{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new Qne({colorRamps:ee(this.colorRamps)})}};d([m({type:[Hpe],json:{write:!0}})],kL.prototype,"colorRamps",void 0),d([m({type:["multipart"]})],kL.prototype,"type",void 0),kL=Qne=d([N("esri.rest.support.MultipartColorRamp")],kL);const xHe=kL,uWt={key:"type",base:jpe,typeMap:{algorithmic:Hpe,multipart:xHe}};function hWt(t){return t?.type?t.type==="algorithmic"?Hpe.fromJSON(t):t.type==="multipart"?xHe.fromJSON(t):null:null}var Kne;const YS=new ur({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),iz=new ur({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),pEe=new ur({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),fEe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],dWt=["high-to-low","above-and-below","above","below"],pWt=["flow-line","wave-front"],fWt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let to=Kne=class extends we{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?hWt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new Kne({classificationMethod:this.classificationMethod,colorRamp:ee(this.colorRamp),fadeRatio:ee(this.fadeRatio),fields:this.fields?.slice(0),field1:ee(this.field1),field2:ee(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};d([m({type:YS.apiValues,value:null,json:{type:YS.jsonValues,read:YS.read,write:YS.write,origins:{"web-document":{default:"manual",type:YS.jsonValues,read:YS.read,write:YS.write}}}})],to.prototype,"classificationMethod",null),d([m({types:uWt,json:{write:!0}})],to.prototype,"colorRamp",void 0),d([Le("colorRamp")],to.prototype,"readColorRamp",null),d([m({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],to.prototype,"fadeRatio",void 0),d([m({type:[String],value:null,json:{write:!0}})],to.prototype,"fields",null),d([m({type:iw,value:null,json:{write:!0}})],to.prototype,"field1",null),d([m({type:iw,value:null,json:{write:!0}})],to.prototype,"field2",null),d([m({type:pWt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],to.prototype,"flowTheme",null),d([m({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],to.prototype,"focus",null),d([m({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],to.prototype,"isAutoGenerated",void 0),d([m({type:Number,value:null,json:{type:cr,write:!0}})],to.prototype,"numClasses",null),d([m({type:fEe,json:{type:fEe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],to.prototype,"lengthUnit",void 0),d([m({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],to.prototype,"maxSliderValue",void 0),d([m({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],to.prototype,"minSliderValue",void 0),d([m({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],to.prototype,"statistics",null),d([m({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],to.prototype,"standardDeviationInterval",null),d([m({type:iz.apiValues,value:null,json:{type:iz.jsonValues,read:iz.read,write:iz.write,origins:{"web-scene":{type:pEe.jsonValues,write:{writer:pEe.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],to.prototype,"type",null),d([m({type:[cWt],json:{write:!0}})],to.prototype,"visualVariables",void 0),d([m({type:fWt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],to.prototype,"univariateSymbolStyle",null),d([m({type:dWt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],to.prototype,"univariateTheme",null),to=Kne=d([N("esri.renderers.support.AuthoringInfo")],to);const qpe=to,bJ=new ur({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let UL=class extends we{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const i=new Set;return await this.collectRequiredFields(i,e),Array.from(i).sort()}getSymbol(e,i){}async getSymbolAsync(e,i){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};d([m({type:qpe,json:{write:!0}})],UL.prototype,"authoringInfo",void 0),d([m({type:bJ.apiValues,readOnly:!0,json:{type:bJ.jsonValues,read:!1,write:{writer:bJ.write,ignoreOrigin:!0}}})],UL.prototype,"type",void 0),UL=d([N("esri.renderers.Renderer")],UL);const p1=UL;function mWt(t){return t.match(gWt)?.[1]?.replace(/\\'/g,"'")??null}const gWt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var eoe;let eO=eoe=class extends we{constructor(){super(...arguments),this.title=null}clone(){return new eoe({title:this.title})}};d([m({type:String,json:{write:!0}})],eO.prototype,"title",void 0),eO=eoe=d([N("esri.renderers.support.LegendOptions")],eO);var toe;let s6=toe=class extends eO{constructor(){super(...arguments),this.showLegend=null}clone(){return new toe({title:this.title,showLegend:this.showLegend})}};d([m({type:Boolean,json:{write:!0}})],s6.prototype,"showLegend",void 0),s6=toe=d([N("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],s6);const SHe=s6,wJ=new ur({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let dm=class extends we{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(oe.getLogger(this).error(".field: field must be a string value"),null):Sk(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};d([m()],dm.prototype,"index",void 0),d([m({type:wJ.apiValues,readOnly:!0,json:{read:wJ.read,write:wJ.write}})],dm.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],dm.prototype,"field",void 0),d([vi("field")],dm.prototype,"castField",null),d([m({type:String,json:{write:!0}})],dm.prototype,"valueExpression",void 0),d([m({type:String,json:{write:!0}})],dm.prototype,"valueExpressionTitle",void 0),d([m({readOnly:!0})],dm.prototype,"arcadeRequired",null),d([m({type:SHe,json:{write:!0}})],dm.prototype,"legendOptions",void 0),dm=d([N("esri.renderers.visualVariables.VisualVariable")],dm);const I4=dm;var ioe;let KT=ioe=class extends we{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,i){e[i]=t??0}clone(){return new ioe({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};d([m({type:Ke,json:{type:[cr],write:!0}})],KT.prototype,"color",void 0),d([m({type:String,json:{write:!0}})],KT.prototype,"label",void 0),d([m({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],KT.prototype,"value",void 0),d([Ve("value")],KT.prototype,"writeValue",null),KT=ioe=d([N("esri.renderers.visualVariables.support.ColorStop")],KT);const yWt=KT;var roe;let e2=roe=class extends I4{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new roe({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};d([m({readOnly:!0})],e2.prototype,"cache",null),d([m({type:["color"],json:{type:["colorInfo"]}})],e2.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],e2.prototype,"normalizationField",void 0),d([m({type:[yWt],json:{write:!0}})],e2.prototype,"stops",null),e2=roe=d([N("esri.renderers.visualVariables.ColorVariable")],e2);const THe=e2;var soe;let Bb=soe=class extends we{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return xO(e.transparency)}writeOpacity(t,e,i){e[i]=Ik(t)}clone(){return new soe({label:this.label,opacity:this.opacity,value:this.value})}};d([m({type:String,json:{write:!0}})],Bb.prototype,"label",void 0),d([m({type:Number,json:{type:cr,write:{target:"transparency"}}})],Bb.prototype,"opacity",void 0),d([Le("opacity",["transparency"])],Bb.prototype,"readOpacity",null),d([Ve("opacity")],Bb.prototype,"writeOpacity",null),d([m({type:Number,json:{write:!0}})],Bb.prototype,"value",void 0),Bb=soe=d([N("esri.renderers.visualVariables.support.OpacityStop")],Bb);const _Wt=Bb;var noe;let t2=noe=class extends I4{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new noe({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};d([m({readOnly:!0})],t2.prototype,"cache",null),d([m({type:["opacity"],json:{type:["transparencyInfo"]}})],t2.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],t2.prototype,"normalizationField",void 0),d([m({type:[_Wt],json:{write:!0}})],t2.prototype,"stops",null),t2=noe=d([N("esri.renderers.visualVariables.OpacityVariable")],t2);const EHe=t2;var ooe;let j_=ooe=class extends I4{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,i,r){if(r?.messages){const s=`visualVariables[${this.index}]`;r.messages.push(new j("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:r}))}}clone(){return new ooe({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions?.clone()})}};d([m({readOnly:!0})],j_.prototype,"cache",null),d([m({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],j_.prototype,"axis",void 0),d([m({type:["rotation"],json:{type:["rotationInfo"]}})],j_.prototype,"type",void 0),d([m({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],j_.prototype,"rotationType",void 0),d([m({type:String,json:{write:!0}})],j_.prototype,"valueExpressionTitle",void 0),d([Ve("web-scene","valueExpressionTitle")],j_.prototype,"writeValueExpressionTitleWebScene",null),j_=ooe=d([N("esri.renderers.visualVariables.RotationVariable")],j_);const CHe=j_;function vWt(t){return Nr(t)}var aoe;let zb=aoe=class extends we{constructor(t){super(t),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new aoe({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};d([m({type:String,json:{write:!0}})],zb.prototype,"label",void 0),d([m({type:Number,cast:Nr,json:{write:!0}})],zb.prototype,"size",void 0),d([m({type:Number,json:{write:!0}})],zb.prototype,"value",void 0),d([m({type:Boolean,json:{write:!1}})],zb.prototype,"useMinValue",void 0),d([m({type:Boolean,json:{write:!1}})],zb.prototype,"useMaxValue",void 0),zb=aoe=d([N("esri.renderers.visualVariables.support.SizeStop")],zb);const n6=zb;var loe;let o6=loe=class extends SHe{constructor(){super(...arguments),this.customValues=null}clone(){return new loe({title:this.title,showLegend:this.showLegend,customValues:this.customValues?.slice(0)})}};d([m({type:[Number],json:{write:!0}})],o6.prototype,"customValues",void 0),o6=loe=d([N("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],o6);const bWt=o6;var coe;const rz=new ur({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),uoe=new ur({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function mEe(t){if(t!=null)return typeof t=="string"||typeof t=="number"?vWt(t):t.type==="size"?QR(t)?t:(delete(t={...t}).type,new as(t)):void 0}function gEe(t,e,i){if(typeof t!="object")return t;const r=new as;return r.read(t,i),r}let as=coe=class extends I4{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&z5e.test(this.valueExpression)}}set index(t){QR(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),QR(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return U5e(this)}set maxDataValue(t){t&&this.stops&&(oe.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(oe.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return mEe(t)}readMaxSize(t,e,i){return gEe(t,e,i)}set minDataValue(t){t&&this.stops&&(oe.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(oe.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return mEe(t)}readMinSize(t,e,i){return gEe(t,e,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value):t&&(oe.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return hCt(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,i,r){if(t==="$view.scale"){if(r?.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new j("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else e[i]=t}readValueUnit(t){return t?uoe.read(t):null}clone(){return new coe({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:QR(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:QR(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone()})}flipSizes(){if(this.transformationType===ka.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===ka.Stops){const t=this.stops;if(!t)return this;const e=t.map(r=>r.size).reverse(),i=t.length;for(let r=0;r<i;r++)t[r].size=e[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops?.map(t=>t.value||0)}};d([m({readOnly:!0})],as.prototype,"cache",null),d([m({type:rz.apiValues,json:{type:rz.jsonValues,origins:{"web-map":{read:!1}},read:rz.read,write:rz.write}})],as.prototype,"axis",void 0),d([m()],as.prototype,"index",null),d([m({type:String,readOnly:!0})],as.prototype,"inputValueType",null),d([m({type:bWt,json:{write:!0}})],as.prototype,"legendOptions",void 0),d([m({type:Number,value:null,json:{write:!0}})],as.prototype,"maxDataValue",null),d([m({type:Number,value:null,json:{write:!0}})],as.prototype,"maxSize",null),d([vi("maxSize")],as.prototype,"castMaxSize",null),d([Le("maxSize")],as.prototype,"readMaxSize",null),d([m({type:Number,value:null,json:{write:!0}})],as.prototype,"minDataValue",null),d([m({type:Number,value:null,json:{write:!0}})],as.prototype,"minSize",null),d([vi("minSize")],as.prototype,"castMinSize",null),d([Le("minSize")],as.prototype,"readMinSize",null),d([m({type:String,json:{write:!0}})],as.prototype,"normalizationField",void 0),d([m({readOnly:!0})],as.prototype,"arcadeRequired",null),d([m({type:String})],as.prototype,"scaleBy",void 0),d([m({type:[n6],value:null,json:{write:!0}})],as.prototype,"stops",null),d([m({type:["outline"],json:{write:!0}})],as.prototype,"target",void 0),d([m({type:String,readOnly:!0})],as.prototype,"transformationType",null),d([m({type:["size"],json:{type:["sizeInfo"]}})],as.prototype,"type",void 0),d([m({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],as.prototype,"useSymbolValue",void 0),d([m({type:String,json:{write:!0}})],as.prototype,"valueExpression",void 0),d([Le("valueExpression",["valueExpression","expression"])],as.prototype,"readValueExpression",null),d([Ve("web-scene","valueExpression")],as.prototype,"writeValueExpressionWebScene",null),d([m({type:["radius","diameter","area","width","distance"],json:{write:!0}})],as.prototype,"valueRepresentation",void 0),d([m({type:uoe.apiValues,json:{write:uoe.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],as.prototype,"valueUnit",void 0),d([Le("valueUnit")],as.prototype,"readValueUnit",null),as=coe=d([N("esri.renderers.visualVariables.SizeVariable")],as);const Wpe=as,wWt={color:THe,size:Wpe,opacity:EHe,rotation:CHe},xWt=new ur({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),SWt=/^\[([^\]]+)\]$/i;let a6=class extends Fe{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e&&e.filter(i=>!!i),e?.length){for(const i of e)switch(i.type){case"color":this.colorVariables.push(i);break;case"opacity":this.opacityVariables.push(i);break;case"rotation":this.rotationVariables.push(i);break;case"size":this.sizeVariables.push(i)}this.sizeVariables.length&&this.sizeVariables.some(i=>!!i.target)&&e.sort((i,r)=>{let s=null;return s=i.target===r.target?0:i.target?1:-1,s});for(let i=0;i<e.length;i++)e[i].index=i;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,i,r){const{rotationExpression:s,rotationType:n}=i,o=s?.match(SWt),a=o?.[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map(l=>{const c=xWt.read(l.type),u=wWt[c];u||(oe.getLogger(this).warn(`Unknown variable type: ${c}`),r?.messages&&r.messages.push(new m0("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:r})));const h=new u;return h.read(l,r),h})}writeVariables(e,i){const r=[];for(const s of e){const n=s.toJSON(i);n&&r.push(n)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};d([m()],a6.prototype,"visualVariables",null),a6=d([N("esri.renderers.visualVariables.VisualVariableFactory")],a6);const TWt=a6,EWt={base:I4,key:"type",typeMap:{opacity:EHe,color:THe,rotation:CHe,size:Wpe}},a$=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new TWt}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const s=this.visualVariables;return s?s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)):[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&Ou(i,r,n.field),n.normalizationField&&Ou(i,r,n.normalizationField),n.valueExpression&&(CWt(n.valueExpression,i,r)||await Wc(i,r,n.valueExpression)))}};return d([m({types:[EWt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),d([Le("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),d([Ve("visualVariables")],e.prototype,"writeVisualVariables",null),e=d([N("esri.renderers.mixins.VisualVariablesMixin")],e),e};function CWt(t,e,i){const r=mWt(t);return r!=null&&(Ou(e,i,r),!0)}const U7={types:nDe,json:{write:{writer:K8},origins:{"web-scene":{types:z0e,write:{writer:K8},read:{reader:AI({types:z0e})}}}}},Ype=hle({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},U7),MHe={types:{base:pc,key:"type",typeMap:{"simple-fill":aE.typeMap["simple-fill"],"picture-fill":aE.typeMap["picture-fill"],"polygon-3d":aE.typeMap["polygon-3d"]}},json:{write:{writer:K8},origins:{"web-scene":{type:Vx,write:{writer:K8}}}}},l6={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t?.toString()}}}};var hoe;let Vb=hoe=class extends we{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new hoe({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?.clone()??null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};d([m({type:String,json:{write:!0}})],Vb.prototype,"description",void 0),d([m({type:String,json:{write:!0}})],Vb.prototype,"label",void 0),d([m({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],Vb.prototype,"minValue",void 0),d([m({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],Vb.prototype,"maxValue",void 0),d([m(Ype)],Vb.prototype,"symbol",void 0),Vb=hoe=d([N("esri.renderers.support.ClassBreakInfo")],Vb);const CH=Vb;var doe;const AHe="log",c6="percent-of-total",u6="field",sz=new ur({esriNormalizeByLog:AHe,esriNormalizeByPercentOfTotal:c6,esriNormalizeByField:u6}),MWt=Tn(CH);let aa=doe=class extends a$(p1){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,i){if(!Array.isArray(t))return;let r=e.minValue;return t.map(s=>{const n=new CH;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(t,e,i,r){const s=t.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),e[i]=s}castField(t){return t==null?t:typeof t=="function"?(oe.getLogger(this).error(".field: field must be a string value"),null):Sk(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,i=this.normalizationTotal!=null;return e||i?(t=e&&u6||i&&c6||null,e&&i&&oe.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==u6&&t!==c6||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,i){let r=null;r=typeof t=="number"?new CH({minValue:t,maxValue:e,symbol:oDe(i)}):MWt(ee(t)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(t,e){return this.valueExpression&&e?.arcade==null&&oe.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let i=e;this.valueExpression&&e?.arcade==null&&(i={...i,arcade:await hx()});const r=this.getBreakIndex(t,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(t,e){if(this.valueExpression&&e?.arcade==null)return void oe.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(t,e);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&e?.arcade==null){const s=await hx(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this.getBreakIndex(t,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new doe({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol?.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol?.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:ee(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:ee(this.visualVariables),legendOptions:ee(this.legendOptions),authoringInfo:ee(this.authoringInfo)})}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),Wc(t,e,this.valueExpression)];Ou(t,e,this.field),Ou(t,e,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n,timeZone:o}=e??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const c=n.arcadeUtils;if(!l){const h=c.createSyntaxTree(a);l=c.createFunction(h),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const u=c.executeFunction(l,c.createExecContext(t,c.getViewInfo({viewingMode:i,scale:r,spatialReference:s}),o));return this._getBreakIndexfromInfos(u)}_getBreakIndexForField(t){const e=this.field,i=t.attributes,r=this.normalizationType;let s=parseFloat(i[e]);if(r){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if(r===AHe)s=Math.log(s)*Math.LOG10E;else if(r!==c6||n==null||isNaN(n)){if(r===u6&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=t&&(e?t<=r[1]:t<r[1]))return i}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let i=1;i<e;i++)if(t[i-1].maxValue!==t[i].minValue)return!1;return!0}};d([m(MHe)],aa.prototype,"backgroundFillSymbol",void 0),d([m({type:[CH]})],aa.prototype,"classBreakInfos",void 0),d([Le("classBreakInfos")],aa.prototype,"readClassBreakInfos",null),d([Ve("classBreakInfos")],aa.prototype,"writeClassBreakInfos",null),d([m({type:String,json:{write:!0}})],aa.prototype,"defaultLabel",void 0),d([m(U7)],aa.prototype,"defaultSymbol",void 0),d([m({type:String,json:{write:!0}})],aa.prototype,"field",void 0),d([vi("field")],aa.prototype,"castField",null),d([m({type:Boolean})],aa.prototype,"isMaxInclusive",void 0),d([m({type:eO,json:{write:!0}})],aa.prototype,"legendOptions",void 0),d([m({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],aa.prototype,"minValue",null),d([m({type:String,json:{write:!0}})],aa.prototype,"normalizationField",void 0),d([m({type:Number,cast:t=>Gp(t),json:{write:!0}})],aa.prototype,"normalizationTotal",void 0),d([m({type:sz.apiValues,value:null,json:{type:sz.jsonValues,read:sz.read,write:sz.write}})],aa.prototype,"normalizationType",null),d([Nt({classBreaks:"class-breaks"})],aa.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],aa.prototype,"valueExpression",void 0),d([m({type:String,json:{write:!0}})],aa.prototype,"valueExpressionTitle",void 0),aa=doe=d([N("esri.renderers.ClassBreaksRenderer")],aa);const RHe=aa;let B7=class{};function AWt(t){return t instanceof OI?t===B7.instance:t?.toString().toLowerCase()==="unknown"}function ZCi(t){return AWt(t)?B7.instance:t}B7.instance=new qd("Etc/UTC");function RWt(t){return"timeZone"in t}function PWt(t){return"timeZone"in t}function OWt(t){return"dateFieldsTimeZone"in t}const IWt=new Map;let PHe=class h6{static fromJSON(e){return new h6(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new h6(e.fields??[],_Ee(e))}static fromLayerJSON(e){return new h6(e.fields??[],_Ee(e))}constructor(e=[],i){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const r=[];for(const s of this.fields){const n=s?.name,o=yEe(n);if(n&&o){const a=C2(n);this._fieldsMap.set(n,s),this._fieldsMap.set(a,s),this._normalizedFieldsMap.set(o,s),r.push(`${a}:${s.type}:${this._timeZoneByFieldName?.get(n)}`),fLe(s)?(this.dateFields.push(s),this._dateFieldsSet.add(s)):pue(s)&&(this._numericFieldsSet.add(s),this.numericFields.push(s)),N0e(s)||L0e(s)||(s.editable=s.editable==null||!!s.editable,s.nullable=s.nullable==null||!!s.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)N0e(e)||L0e(e)||e.nullable||Mpt(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(C2(e))??this._normalizedFieldsMap.get(yEe(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(e){const i=this.get(e&&typeof e!="string"?e.name:e);return i?this._timeZoneByFieldName?this._timeZoneByFieldName.get(i.name):i.type==="date"||i.type==="esriFieldTypeDate"?(oe.getLogger("esri.layers.support.FieldsIndex").error(new j("getTimeZone:no-timezone-information",`no time zone information for field '${i.name}'`)),Kw):OHe.has(i.type)?LE:null:null}getLuxonTimeZone(e){const i=this.getTimeZone(e);return i?i===LE?B7.instance:i===Kw?tc.utcInstance:pq(IWt,i,()=>qd.create(i)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return Bpt(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map(e=>X6(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}};function C2(t){return t.trim().toLowerCase()}function yEe(t){return hpt(t)?.toLowerCase()??""}const OHe=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function _Ee(t){const e=new Map;if(!t.fields)return e;const i=t.datesInUnknownTimezone===!0,{timeInfo:r,editFieldsInfo:s}=t,n=(r?"startField"in r?r.startField:r.startTimeField:"")??"",o=(r?"endField"in r?r.endField:r.endTimeField:"")??"",a=OWt(t)?t.dateFieldsTimeZone??null:t.dateFieldsTimeReference?hV(t.dateFieldsTimeReference):null,l=s?RWt(s)?s.timeZone??a:s.dateFieldsTimeReference?hV(s.dateFieldsTimeReference):a??Kw:null,c=r?PWt(r)?r.timeZone??a:r.timeReference?hV(r.timeReference):a:null,u=new Map([[C2(s?.creationDateField??""),l],[C2(s?.editDateField??""),l],[C2(n),c],[C2(o),c]]);for(const{name:h,type:p}of t.fields)if(OHe.has(p))e.set(h,LE);else if(p!=="date"&&p!=="esriFieldTypeDate")e.set(h,null);else if(i)e.set(h,LE);else{const f=u.get(C2(h??""))??a;e.set(h,f)}return e}const vEe="esri.renderers.support.DictionaryLoader",$Wt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let IHe=class{constructor(e,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new qze(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(h){if(En(h))return this._dictionaryPromise=null,null}const s=this._dictionaryVersion?.since(4,0),n={};if(this.fieldMap)for(const h of this._symbolFields){const p=aze(this.fieldMap[h],this._fieldIndex);if(p){const f=e.attributes[p];n[h]=s?f:f!=null?""+e.attributes[p]:""}else n[h]=""}let o=null;try{o=r?.(n,i)}catch{return null}if(!o||typeof o!="string"||o==="invalid")return null;const a=o.split(";"),l=[],c=[];for(const h of a)if(h)if(h.includes("po:")){const p=h.substr(3).split("|");if(p.length===3){const f=p[0],g=p[1];let y=p[2];if(g==="DashTemplate")y=y.split(" ").map(v=>Number(v));else if(g==="Color"){const v=new Ke(y).toRgba();y=[v[0],v[1],v[2],255*v[3]]}else y=Number(y);c.push({primitiveName:f,propertyName:g,value:y,defaultValue:null})}}else if(h.includes("|")){for(const p of h.split("|"))if(this._itemNames.has(p)){l.push(p);break}}else this._itemNames.has(h)&&l.push(h);const u=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point";return this._cimPartsToCIMSymbol(e,l,c,u,i)}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void oe.getLogger(vEe).error("no valid URL!");const i=qi(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:r}]=await Promise.all([i,hx()]);if(!r)throw this._dictionaryPromise=null,new j("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:s,dictionary_version:n,expression:o,itemsNames:a}=r,l=o;let c=!1;n&&(this._dictionaryVersion=kI.parse(n),c=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=s.symbol;const u={};if(this.config){const f=this.config;for(const g in f)u[g]=f[g]}if(s.configuration)for(const f of s.configuration)u.hasOwnProperty(f.name)||(u[f.name]=f.value);const h=[];if(e?.fields&&this.fieldMap)for(const f in this.fieldMap){const g=this.fieldMap[f],y=e.fields.filter(v=>v.name.toLowerCase()===g?.toLowerCase());y.length>0&&h.push({...y[0],type:c?y[0].type:"esriFieldTypeString"})}h.length>0&&(this._fieldIndex=new PHe(h));const p=lpt(l,e!=null?e.spatialReference:null,h,u).then(f=>{const g={scale:0};return(y,v)=>{if(f==null)return null;const b=f.repurposeFeature({geometry:null,attributes:y});return g.scale=v!=null?v.scale??void 0:void 0,f.evaluate({$feature:b,$view:g},f.services)}}).catch(f=>(oe.getLogger(vEe).error("Creating dictionary expression failed:",f),null));return this._dictionaryPromise=p,p}async _cimPartsToCIMSymbol(e,i,r,s,n){const o=new Array(i.length);for(let c=0;c<i.length;c++)o[c]=this._getSymbolPart(i[c],n);let a=await Promise.all(o);const l=this.fieldMap;if(l){a=ee(a);for(const c of a)rP.applyDictionaryTextOverrides(c,e,l,this._fieldIndex,Lse(c))}return new Bx({data:NWt(a,r,s)})}async _getSymbolPart(e,i){const r=this._symbolCache.get(e);if(r)return r;if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(o=>o.data);const s=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),n=qi(s,{responseType:"json",query:{f:"json"},...i});this._ongoingRequests.set(e,n),n.finally(()=>this._ongoingRequests.delete(e));try{const o=await n;return this._symbolCache.put(e,o.data),o.data}catch(o){throw o}}};function NWt(t,e,i){if(!t||t.length===0)return null;const r={...t[0]};if(t.length>1){r.symbolLayers=[];for(const s of t){const n=s;r.symbolLayers.unshift(...n.symbolLayers)}}return i&&(r.callout=$Wt),{type:"CIMSymbolReference",symbol:r,primitiveOverrides:e}}var poe;let pm=poe=class extends a$(p1){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new IHe(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,i,r){r?.origin||super.writeVisualVariables(t,e,i,r)}clone(){return new poe({config:ee(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:ee(this.fieldMap),url:ee(this.url),visualVariables:ee(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await Wc(t,e,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];e.has(r)&&t.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};d([m({type:IHe})],pm.prototype,"_loader",null),d([m({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],pm.prototype,"config",void 0),d([m({type:Object,json:{write:!0}})],pm.prototype,"fieldMap",void 0),d([m({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],pm.prototype,"scaleExpression",void 0),d([Ve("scaleExpression")],pm.prototype,"writeData",null),d([m({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],pm.prototype,"scaleExpressionTitle",void 0),d([m({type:String,json:{write:!0}})],pm.prototype,"url",void 0),d([Ve("visualVariables")],pm.prototype,"writeVisualVariables",null),pm=poe=d([N("esri.renderers.DictionaryRenderer")],pm);const LWt=pm;var foe;let H_=foe=class extends we{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(oe.getLogger(this).error(".field: field must be a string value"),null):Sk(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new foe({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};d([m({type:Ke,json:{type:[Number],write:!0}})],H_.prototype,"color",void 0),d([m({type:String,json:{write:!0}})],H_.prototype,"field",void 0),d([vi("field")],H_.prototype,"castField",null),d([m({type:String,json:{write:!0}})],H_.prototype,"label",void 0),d([m({type:String,json:{write:!0}})],H_.prototype,"valueExpression",void 0),d([m({type:String,json:{write:!0}})],H_.prototype,"valueExpressionTitle",void 0),H_=foe=d([N("esri.renderers.support.AttributeColorInfo")],H_);const $He=H_;var moe;let d6=moe=class extends we{constructor(){super(...arguments),this.unit=null}clone(){return new moe({unit:this.unit})}};d([m({type:String,json:{write:!0}})],d6.prototype,"unit",void 0),d6=moe=d([N("esri.renderers.support.DotDensityLegendOptions")],d6);const DWt=d6;var goe;let Zu=goe=class extends a$(p1){constructor(t){super(t),this.attributes=null,this.backgroundColor=new Ke([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Kd,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new Gx({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new goe({attributes:ee(this.attributes),backgroundColor:ee(this.backgroundColor),dotBlendingEnabled:ee(this.dotBlendingEnabled),dotShape:ee(this.dotShape),dotSize:ee(this.dotSize),dotValue:ee(this.dotValue),legendOptions:ee(this.legendOptions),outline:ee(this.outline),referenceScale:ee(this.referenceScale),seed:ee(this.seed),visualVariables:ee(this.visualVariables),authoringInfo:ee(this.authoringInfo)})}getControllerHash(){return`${this.attributes?.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const i of this.attributes??[])i.valueExpression&&await Wc(t,e,i.valueExpression),i.field&&t.add(i.field)}};d([m({type:[$He],json:{write:!0}})],Zu.prototype,"attributes",void 0),d([m({type:Ke,json:{write:!0}})],Zu.prototype,"backgroundColor",void 0),d([m({type:Boolean,json:{write:!0}})],Zu.prototype,"dotBlendingEnabled",void 0),d([m({type:String,json:{write:!1}})],Zu.prototype,"dotShape",void 0),d([m({type:Number,json:{write:!0}})],Zu.prototype,"dotSize",void 0),d([m({type:DWt,json:{write:!0}})],Zu.prototype,"legendOptions",void 0),d([m({type:Kd,json:{default:null,write:!0}})],Zu.prototype,"outline",void 0),d([m({type:Number,json:{write:!0}})],Zu.prototype,"dotValue",void 0),d([m({type:Number,json:{write:!0}})],Zu.prototype,"referenceScale",void 0),d([m({type:Number,json:{write:!0}})],Zu.prototype,"seed",void 0),d([Nt({dotDensity:"dot-density"})],Zu.prototype,"type",void 0),Zu=goe=d([N("esri.renderers.DotDensityRenderer")],Zu);const FWt=Zu;var yoe;let BL=yoe=class extends we{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new yoe({color:this.color&&this.color.clone(),ratio:this.ratio})}};d([m({type:Ke,json:{type:[cr],default:null,write:!0}})],BL.prototype,"color",void 0),d([m({type:Number,json:{write:!0}})],BL.prototype,"ratio",void 0),BL=yoe=d([N("esri.renderers.support.HeatmapColorStop")],BL);const p6=BL;let wR=class extends ms(we){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};d([m({type:String,json:{write:!0}})],wR.prototype,"minLabel",void 0),d([m({type:String,json:{write:!0}})],wR.prototype,"maxLabel",void 0),d([m({type:String,json:{write:!0}})],wR.prototype,"title",void 0),wR=d([N("esri.renderers.support.HeatmapLegendOptions")],wR);const Xpe=2.4;function kWt(t){return Sa(t*Xpe)}function UWt(t){return Yn(t)/Xpe}function BWt(t,e,i,r){let{color:s,ratio:n}=e,{color:o,ratio:a}=i;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=$e((r-n)/(a-n),0,1);Qq(t,s.toArray(),o.toArray(),l)}function KCi(t){const i=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return i;let r=t[0],s=t[0],n=1;const o=pi();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<t.length;)r=s,s=t[n++];BWt(o,r,s,l),i.set(o,4*a)}return i}function eMi(t,e,i){const r=Math.sqrt(t**2+e**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function tMi(t){return typeof t=="function"?t:t?e=>+e[t]:()=>1}var _oe;function bEe(t){if(t!=null){const{maxDensity:e,minDensity:i,radius:r}=t;if(e!=null||i!=null||r!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=t;return a}}return t}let nl=_oe=class extends p1{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new p6({ratio:0,color:new Ke("rgba(255, 140, 0, 0)")}),new p6({ratio:.75,color:new Ke("rgba(255, 140, 0, 1)")}),new p6({ratio:.9,color:new Ke("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return bEe(t)}get blurRadius(){return UWt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",kWt(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(Xpe**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||oc(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,dC(()=>{CXe(oe.getLogger(this),t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=bEe(t),super.read(t,e)}getSymbol(){return new $0}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&Ou(t,e,i),r&&typeof r=="string"&&await Wc(t,e,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new _oe({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:ee(this.colorStops),field:this.field,legendOptions:ee(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};d([m({type:qpe,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],nl.prototype,"authoringInfo",void 0),d([m({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],nl.prototype,"blurRadius",null),d([m({type:[p6],json:{write:!0}})],nl.prototype,"colorStops",void 0),d([m({type:String,json:{write:!0}})],nl.prototype,"field",void 0),d([m({type:wR,json:{write:!0}})],nl.prototype,"legendOptions",void 0),d([m({type:Number,json:{write:!0}})],nl.prototype,"maxDensity",void 0),d([m({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],nl.prototype,"maxPixelIntensity",null),d([m({type:Number,json:{write:!0}})],nl.prototype,"minDensity",void 0),d([m({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],nl.prototype,"minPixelIntensity",null),d([m({type:Number,cast:Nr,json:{write:!0}})],nl.prototype,"radius",void 0),d([m({type:Number,range:{min:0},json:{default:0,write:!0}})],nl.prototype,"referenceScale",void 0),d([Nt({heatmap:"heatmap"})],nl.prototype,"type",void 0),d([m({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],nl.prototype,"valueExpression",void 0),d([m({type:String})],nl.prototype,"valueExpressionTitle",void 0),d([m({readOnly:!0})],nl.prototype,"_pixelIntensityToDensity",null),nl=_oe=d([N("esri.renderers.HeatmapRenderer")],nl);const NHe=nl;let M2=class extends ms(we){constructor(){super(...arguments),this.color=new Ke([0,0,0,0]),this.label=null,this.threshold=0}};d([m({type:Ke,json:{write:!0}})],M2.prototype,"color",void 0),d([m({type:String,json:{write:!0}})],M2.prototype,"label",void 0),d([m({type:Number,range:{min:0,max:1},json:{write:!0}})],M2.prototype,"threshold",void 0),M2=d([N("esri.renderers.support.OthersCategory")],M2);let f6=class extends ms(we){constructor(){super(...arguments),this.title=null}};d([m({type:String,json:{write:!0}})],f6.prototype,"title",void 0),f6=d([N("esri.renderers.support.PieChartLegendOptions")],f6);let od=class extends a$(ms(p1)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Ke([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new M2,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){return new $0({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(Rx)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,i)=>e+i.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,i)=>e+JSON.stringify(i),"")}async collectRequiredFields(e,i){await this.collectVVRequiredFields(e,i);for(const r of this.attributes)r.valueExpression&&await Wc(e,i,r.valueExpression),r.field&&e.add(r.field)}};d([m({type:[$He],json:{write:!0}})],od.prototype,"attributes",void 0),d([m({type:Gx,json:{default:null,write:!0}})],od.prototype,"backgroundFillSymbol",void 0),d([m({type:Ke,json:{write:!0}})],od.prototype,"defaultColor",void 0),d([m({type:String,json:{write:!0}})],od.prototype,"defaultLabel",void 0),d([m({type:Number,range:{min:0,max:1},json:{write:!0}})],od.prototype,"holePercentage",void 0),d([m({type:M2,json:{write:!0}})],od.prototype,"othersCategory",void 0),d([m({type:f6,json:{write:!0}})],od.prototype,"legendOptions",void 0),d([m({type:Kd,json:{default:null,write:!0}})],od.prototype,"outline",void 0),d([m({type:Number,cast:Nr,json:{write:!0}})],od.prototype,"size",void 0),d([Nt({pieChart:"pie-chart"})],od.prototype,"type",void 0),od=d([N("esri.renderers.PieChartRenderer")],od);const zWt=od;var voe;let i2=voe=class extends a$(p1){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new voe({description:this.description,label:this.label,symbol:ee(this.symbol),visualVariables:ee(this.visualVariables),authoringInfo:ee(this.authoringInfo)})}};d([m({type:String,json:{write:!0}})],i2.prototype,"description",void 0),d([m({type:String,json:{write:!0}})],i2.prototype,"label",void 0),d([m(Ype)],i2.prototype,"symbol",void 0),d([Nt({simple:"simple"})],i2.prototype,"type",void 0),i2=voe=d([N("esri.renderers.SimpleRenderer")],i2);const l$=i2,VWt=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function boe(t){return t instanceof Fe}function wEe(t){return t instanceof ct?Object.keys(t.items):boe(t)?oc(t).keys():t?Object.keys(t):[]}function nz(t,e){return t instanceof ct?t.items[e]:t[e]}function GWt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function HD(t){return t?t.declaredClass:null}function LHe(t,e){const i=t.diff;if(i&&typeof i=="function")return i(t,e);const r=wEe(t),s=wEe(e);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||GWt(t,e))return{type:"complete",oldValue:t,newValue:e};const n=s.filter(h=>!r.includes(h)),o=r.filter(h=>!s.includes(h)),a=r.filter(h=>s.includes(h)&&nz(t,h)!==nz(e,h)).concat(n,o).sort(),l=HD(t);if(l&&VWt.has(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const u=boe(t)&&boe(e);for(const h of a){const p=nz(t,h),f=nz(e,h);let g;if((u||typeof p!="function"&&typeof f!="function")&&p!==f&&(p!=null||f!=null)){if(i&&i[h]&&typeof i[h]=="function")g=i[h]?.(p,f);else if(p instanceof Date&&f instanceof Date){if(p.getTime()===f.getTime())continue;g={type:"complete",oldValue:p,newValue:f}}else g=typeof p=="object"&&typeof f=="object"&&HD(p)===HD(f)?LHe(p,f):{type:"complete",oldValue:p,newValue:f};g!=null&&(c!=null?c.diff[h]=g:c={type:"partial",diff:{[h]:g}})}}return c}function nMi(t,e){return jWt(t,e)}function jWt(t,e){if(t==null)return!1;const i=e.split(".");let r=t;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function oMi(t,e){if(!t)return!1;if(t.type==="partial"){const i=Object.keys(t.diff);return i.length===1&&i[0]===e}return!1}function HWt(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&HD(t)!==HD(e)?{type:"complete",oldValue:t,newValue:e}:LHe(t,e)}function oz(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const i of e.added)if(!oz(i))return!1;for(const i of e.removed)if(!oz(i))return!1;for(const i of e.changed)if(!oz(i))return!1;return!0}case"partial":for(const e in t.diff)if(!oz(t.diff[e]))return!1;return!0}}let xR=class extends ms(we){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};d([m(l6)],xR.prototype,"value",void 0),d([m(l6)],xR.prototype,"value2",void 0),d([m(l6)],xR.prototype,"value3",void 0),xR=d([N("esri.renderers.support.UniqueValue")],xR);const tO=xR;let Gb=class extends ms(we){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const i=typeof(e=Array.isArray(e)?e:[e])[0];return i==="string"||i==="number"?e.map(r=>new tO({value:r})):i==="object"?e[0]instanceof tO?e:e.map(r=>new tO(r)):null}};d([m({type:String,json:{write:!0}})],Gb.prototype,"description",void 0),d([m({type:String,json:{write:!0}})],Gb.prototype,"label",void 0),d([m(U7)],Gb.prototype,"symbol",void 0),d([m({type:[tO],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new tO({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const i=[];for(const r of t){const s=[r.value,r.value2,r.value3].filter(Rx).map(n=>n.toString());i.push(s)}e.values=i}}}})],Gb.prototype,"values",void 0),d([vi("values")],Gb.prototype,"castValues",null),Gb=d([N("esri.renderers.support.UniqueValueClass")],Gb);const DHe=Gb;let zL=class extends ms(we){constructor(e){super(e),this.heading=null,this.classes=null}};d([m({type:String,json:{write:!0}})],zL.prototype,"heading",void 0),d([m({type:[DHe],json:{write:!0}})],zL.prototype,"classes",void 0),zL=d([N("esri.renderers.support.UniqueValueGroup")],zL);const woe=zL;var xoe;let r2=xoe=class extends we{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new xoe({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${t}`}};d([m({type:String,json:{write:!0}})],r2.prototype,"description",void 0),d([m({type:String,json:{write:!0}})],r2.prototype,"label",void 0),d([m(Ype)],r2.prototype,"symbol",void 0),d([m(l6)],r2.prototype,"value",void 0),r2=xoe=d([N("esri.renderers.support.UniqueValueInfo")],r2);const qD=r2;var VL;const FHe="esri.renderers.UniqueValueRenderer",tb=()=>oe.getLogger(FHe),xEe="uvInfos-watcher",SEe="uvGroups-watcher",qWt=",",WWt=Tn(qD);function YWt(t){const{field1:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=t,a=!(!e||!i);return[{classes:(n??[]).map(l=>{const{symbol:c,label:u,value:h,description:p}=l,[f,g,y]=a?h?.toString()?.split(s||"")||[]:[h],v=[];return(e||o)&&v.push(f),i&&v.push(g),r&&v.push(y),{symbol:c,label:u,values:[v],description:p}})}]}let On=VL=class extends a$(p1){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,i){if(!e&&!i)return;if(!e||!i)return{type:"complete",oldValue:e,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=e.find(a=>a.value===i[n].value);o?HWt(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<e.length;n++)i.find(o=>o.value===e[n].value)||(s.removed.push(e[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:Sk(t)}writeField(t,e,i,r){typeof t=="string"?e[i]=t:r?.messages?r.messages.push(new j("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):tb().error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,i){return i.portal||Mo.getDefault()}readStyleOrigin(t,e,i){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const r=Qw(e.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(t,e,i,r){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=$E(t.styleUrl,r))}set uniqueValueGroups(t){this.styleOrigin?tb().error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?tb().error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){if(this.styleOrigin)return void tb().error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof t=="object"?WWt(t):new qD({value:t,symbol:oDe(e)}),this.uniqueValueInfos?.push(i),this._valueInfoMap[i.value]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void tb().error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e)for(let i=0;i<e.length;i++){const r=e[i];if(String(r.value)===String(t)){delete this._valueInfoMap[t],e.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let i=e;return this.valueExpression&&e?.arcade==null&&(i={...i,arcade:await hx()}),this._getUniqueValueInfo(t,i)}getSymbol(t,e){return this.valueExpression&&e?.arcade==null?void tb().error("#getSymbol()","Please use getSymbolAsync if valueExpression is used"):this._getUniqueValueInfo(t,e)?.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&i?.arcade==null){const s=await hx(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}return this._getUniqueValueInfo(t,i)?.symbol||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=this.uniqueValueInfos?.reduce((r,s)=>r+s.getMeshHash(),"");return`${t}.${e}.${i}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new VL({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:ee(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:ee(this.visualVariables),legendOptions:ee(this.legendOptions),authoringInfo:ee(this.authoringInfo),backgroundFillSymbol:ee(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=ee(this.uniqueValueInfos),i=ee(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(ee(this.styleOrigin))),Object.freeze(e),Object.freeze(i)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",i),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),Wc(t,e,this.valueExpression)];Ou(t,e,this.field),Ou(t,e,this.field2),Ou(t,e,this.field3),await Promise.all(i)}populateFromStyle(){return Vde(this.styleOrigin,{portal:this.portal}).then(t=>{const e=[];return this._valueInfoMap={},t?.data&&Array.isArray(t.data.items)&&t.data.items.forEach(i=>{const r=new RC({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==t.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const s=new qD({value:i.name,symbol:r});e.push(s),this._valueInfoMap[i.name]=s}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",qWt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(xEe);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const i of t)e.push(_e(()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description}),(r,s)=>{r!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,xEe)}}_watchUniqueValueGroups(){this.removeHandles(SEe);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const i of t){e.push(_e(()=>({classes:i.classes}),(r,s)=>{r!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const r of i.classes??[])e.push(_e(()=>({symbol:r.symbol,values:r.values,label:r.label,description:r.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,SEe)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!i);for(const l of n)for(const c of l.classes??[]){const{symbol:u,label:h,values:p,description:f}=c;for(const g of p??[]){const{value:y,value2:v,value3:b}=g,w=[y];i&&w.push(v),r&&w.push(b);const x=a?w.join(s||""):w[0]??void 0;t.push(new qD({symbol:u,label:h,value:x,description:f}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:i,valueExpression:r,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!e&&!r||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!i),a=n.map(c=>{const{symbol:u,label:h,value:p,description:f}=c,[g,y,v]=o?p?.toString()?.split(s||"")||[]:[p];return new DHe({symbol:u,label:h,description:f,values:[new tO({value:g,value2:y,value3:v})]})}),l=[new woe({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n,timeZone:o}=e??{};let a=this._cache.compiledFunc;const l=n.arcadeUtils;if(!a){const u=l.createSyntaxTree(this.valueExpression);a=l.createFunction(u),this._cache.compiledFunc=a}const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:i,scale:r,spatialReference:s}),o));return this._valueInfoMap[c+""]}_getUnqiueValueInfoForFields(t){const e=this.field,i=t.attributes;let r;if(this.field2){const s=this.field2,n=this.field3,o=[];e&&o.push(i[e]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else e&&(r=i[e]);return this._valueInfoMap[r+""]}static fromPortalStyle(t,e){const i=new VL(e?.properties);i._set("styleOrigin",Object.freeze({styleName:t})),i._set("portal",e?.portal||Mo.getDefault());const r=i.populateFromStyle();return r.catch(s=>{tb().error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(t,e){const i=new VL(e?.properties);i._set("styleOrigin",Object.freeze({styleUrl:t}));const r=i.populateFromStyle();return r.catch(s=>{tb().error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};d([m({readOnly:!0})],On.prototype,"_cache",null),d([Nt({uniqueValue:"unique-value"})],On.prototype,"type",void 0),d([m(MHe)],On.prototype,"backgroundFillSymbol",void 0),d([m({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],On.prototype,"field",null),d([vi("field")],On.prototype,"castField",null),d([Ve("field")],On.prototype,"writeField",null),d([m({type:String,value:null,json:{write:!0}})],On.prototype,"field2",null),d([m({type:String,value:null,json:{write:!0}})],On.prototype,"field3",null),d([m({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],On.prototype,"orderByClassesEnabled",void 0),d([m({type:String,value:null,json:{write:!0}})],On.prototype,"valueExpression",null),d([m({type:String,json:{write:!0}})],On.prototype,"valueExpressionTitle",void 0),d([m({type:eO,json:{write:!0}})],On.prototype,"legendOptions",void 0),d([m({type:String,json:{write:!0}})],On.prototype,"defaultLabel",void 0),d([m(hle({...U7},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],On.prototype,"defaultSymbol",null),d([m({type:String,value:null,json:{write:!0}})],On.prototype,"fieldDelimiter",null),d([m({type:Mo,readOnly:!0})],On.prototype,"portal",void 0),d([Le("portal",["styleName"])],On.prototype,"readPortal",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],On.prototype,"styleOrigin",void 0),d([Le("styleOrigin",["styleName","styleUrl"])],On.prototype,"readStyleOrigin",null),d([Ve("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],On.prototype,"writeStyleOrigin",null),d([m({type:[woe],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,i)=>(e.uniqueValueGroups||YWt(e)).map(r=>woe.fromJSON(r,i))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],On.prototype,"uniqueValueGroups",null),d([m({type:[qD],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],On.prototype,"uniqueValueInfos",null),On=VL=d([N(FHe)],On);const Zpe=On,$4={key:"type",base:p1,typeMap:{heatmap:NHe,simple:l$,"unique-value":Zpe,"class-breaks":RHe,"dot-density":FWt,dictionary:LWt,"pie-chart":zWt},errorContext:"renderer"},kHe={key:"type",base:p1,typeMap:{simple:l$,"unique-value":Zpe,"class-breaks":RHe,heatmap:NHe},errorContext:"renderer",validate:XWt};function XWt(t){switch(t.type){case"simple":return ZWt(t);case"unique-value":return JWt(t);case"class-breaks":return QWt(t);case"heatmap":return t}}function ZWt(t){if(t.symbol)return t;oe.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function JWt(t){const e=t.uniqueValueInfos,i=e?.filter(({symbol:r,label:s},n)=>(r||oe.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${n}] ${s}) without a symbol from web scene.`),!!r));return i?.length!==e?.length&&(t.uniqueValueInfos=i),t}function QWt(t){const e=t.classBreakInfos,i=e?.filter(({symbol:r,label:s},n)=>(r||oe.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${n}] ${s}) without a symbol from web scene.`),!!r));return i?.length!==e?.length&&(t.classBreakInfos=i),t}function uMi(t,e){return _I(t,null,e)}const KWt=AI({types:$4});function _I(t,e,i){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(i?.messages&&i.messages.push(new m0("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:i})),null):KWt(t,e,i):null}const xl=(t=>t)(["operational-layers","basemap","ground"]);var Soe;let s2=Soe=class extends we{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new Soe({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};d([m({type:String,json:{write:!0}})],s2.prototype,"expression",void 0),d([m({type:String,json:{write:!0}})],s2.prototype,"name",void 0),d([m({type:["boolean","date","number","string"],json:{write:!0}})],s2.prototype,"returnType",void 0),d([m({type:String,json:{write:!0}})],s2.prototype,"title",void 0),s2=Soe=d([N("esri.form.ExpressionInfo")],s2);const eYt=s2;let n2=class extends we{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};d([m({type:String,json:{write:!0}})],n2.prototype,"description",void 0),d([m({type:String,json:{write:!0}})],n2.prototype,"label",void 0),d([m()],n2.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],n2.prototype,"visibilityExpression",void 0),n2=d([N("esri.form.elements.Element")],n2);const nC=n2;var Toe;let m6=Toe=class extends we{constructor(t){super(t),this.type=null}clone(){return new Toe({type:this.type})}};d([m({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],m6.prototype,"type",void 0),m6=Toe=d([N("esri.form.elements.inputs.AttachmentInput")],m6);const tYt=m6;var Eoe;let o2=Eoe=class extends nC{constructor(t){super(t),this.attachmentKeyword=null,this.editableExpression=null,this.input=null,this.type="attachment"}clone(){return new Eoe({attachmentKeyword:this.attachmentKeyword,description:this.description,editableExpression:this.editableExpression,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};d([m({type:String,json:{write:!0}})],o2.prototype,"attachmentKeyword",void 0),d([m({type:String,json:{write:!0}})],o2.prototype,"editableExpression",void 0),d([m({type:tYt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],o2.prototype,"input",void 0),d([m({type:["attachment"],json:{read:!1,write:!0}})],o2.prototype,"type",void 0),o2=Eoe=d([N("esri.form.elements.AttachmentElement")],o2);const TEe=o2;let g6=class extends we{constructor(e){super(e),this.type=null}};d([m()],g6.prototype,"type",void 0),g6=d([N("esri.form.elements.inputs.Input")],g6);const f1=g6;let GL=class extends f1{constructor(e){super(e),this.maxLength=null,this.minLength=0}};d([m({type:Number,json:{write:!0}})],GL.prototype,"maxLength",void 0),d([m({type:Number,json:{write:!0}})],GL.prototype,"minLength",void 0),GL=d([N("esri.form.elements.inputs.TextInput")],GL);const Jpe=GL;var Coe;let y6=Coe=class extends Jpe{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new Coe({maxLength:this.maxLength,minLength:this.minLength})}};d([m({type:["barcode-scanner"],json:{read:!1,write:!0}})],y6.prototype,"type",void 0),y6=Coe=d([N("esri.form.elements.inputs.BarcodeScannerInput")],y6);const iYt=y6;var Moe;let SR=Moe=class extends f1{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new Moe({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};d([m({type:String,json:{write:!0}})],SR.prototype,"noValueOptionLabel",void 0),d([m({type:Boolean,json:{write:!0}})],SR.prototype,"showNoValueOption",void 0),d([m({type:["combo-box"],json:{read:!1,write:!0}})],SR.prototype,"type",void 0),SR=Moe=d([N("esri.form.elements.inputs.ComboBoxInput")],SR);const rYt=SR;var Aoe;function EEe(t){return t??null}function CEe(t){return t??null}let by=Aoe=class extends f1{constructor(t){super(t),this.max=null,this.min=null,this.type="date-picker"}readMax(t,e){return EEe(e.max)}writeMax(t,e){e.max=CEe(t)}readMin(t,e){return EEe(e.min)}writeMin(t,e){e.min=CEe(t)}clone(){return new Aoe({max:this.max,min:this.min})}};d([m({type:String,json:{type:String,write:!0}})],by.prototype,"max",void 0),d([Le("max")],by.prototype,"readMax",null),d([Ve("max")],by.prototype,"writeMax",null),d([m({type:String,json:{type:String,write:!0}})],by.prototype,"min",void 0),d([Le("min")],by.prototype,"readMin",null),d([Ve("min")],by.prototype,"writeMin",null),d([m({type:["date-picker"],json:{read:!1,write:!0}})],by.prototype,"type",void 0),by=Aoe=d([N("esri.form.elements.inputs.DatePickerInput")],by);const sYt=by;var Roe;function xJ(t){return t??null}function SJ(t){return t??null}let Ju=Roe=class extends f1{constructor(t){super(t),this.includeTimeOffset=!0,this.max=null,this.min=null,this.timeResolution="minutes",this.type="datetimeoffset-picker"}readMax(t,e){return xJ(e.max)}writeMax(t,e){e.max=SJ(t)}readMin(t,e){return xJ(e.min)}writeMin(t,e){e.min=SJ(t)}readTimeResolution(t,e){return xJ(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=SJ(t)}clone(){return new Roe({includeTimeOffset:this.includeTimeOffset,max:this.max,min:this.min,timeResolution:this.timeResolution})}};d([m({type:Boolean,json:{write:!0}})],Ju.prototype,"includeTimeOffset",void 0),d([m({type:String,json:{type:String,write:!0}})],Ju.prototype,"max",void 0),d([Le("max")],Ju.prototype,"readMax",null),d([Ve("max")],Ju.prototype,"writeMax",null),d([m({type:String,json:{type:String,write:!0}})],Ju.prototype,"min",void 0),d([Le("min")],Ju.prototype,"readMin",null),d([Ve("min")],Ju.prototype,"writeMin",null),d([m({type:String,json:{type:String,write:!0}})],Ju.prototype,"timeResolution",void 0),d([Le("timeResolution")],Ju.prototype,"readTimeResolution",null),d([Ve("timeResolution")],Ju.prototype,"writeTimeResolution",null),d([m({type:["datetimeoffset-picker"],json:{read:!1,write:!0}})],Ju.prototype,"type",void 0),Ju=Roe=d([N("esri.form.elements.inputs.DateTimeOffsetPickerInput")],Ju);const nYt=Ju;var Poe;function MEe(t){return t!=null?new Date(t):null}function AEe(t){return t?t.getTime():null}let fm=Poe=class extends f1{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return MEe(e.max)}writeMax(t,e){e.max=AEe(t)}readMin(t,e){return MEe(e.min)}writeMin(t,e){e.min=AEe(t)}clone(){return new Poe({includeTime:this.includeTime,max:this.max,min:this.min})}};d([m({type:Boolean,json:{write:!0}})],fm.prototype,"includeTime",void 0),d([m({type:Date,json:{type:Number,write:!0}})],fm.prototype,"max",void 0),d([Le("max")],fm.prototype,"readMax",null),d([Ve("max")],fm.prototype,"writeMax",null),d([m({type:Date,json:{type:Number,write:!0}})],fm.prototype,"min",void 0),d([Le("min")],fm.prototype,"readMin",null),d([Ve("min")],fm.prototype,"writeMin",null),d([m({type:["datetime-picker"],json:{read:!1,write:!0}})],fm.prototype,"type",void 0),fm=Poe=d([N("esri.form.elements.inputs.DateTimePickerInput")],fm);const oYt=fm;var Ooe;let TR=Ooe=class extends f1{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new Ooe({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};d([m({type:String,json:{write:!0}})],TR.prototype,"noValueOptionLabel",void 0),d([m({type:Boolean,json:{write:!0}})],TR.prototype,"showNoValueOption",void 0),d([m({type:["radio-buttons"],json:{read:!1,write:!0}})],TR.prototype,"type",void 0),TR=Ooe=d([N("esri.form.elements.inputs.RadioButtonsInput")],TR);const aYt=TR;var Ioe;let ER=Ioe=class extends f1{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new Ioe({offValue:this.offValue,onValue:this.onValue})}};d([m({type:[String,Number],json:{write:!0}})],ER.prototype,"offValue",void 0),d([m({type:[String,Number],json:{write:!0}})],ER.prototype,"onValue",void 0),d([m({type:["switch"],json:{read:!1,write:!0}})],ER.prototype,"type",void 0),ER=Ioe=d([N("esri.form.elements.inputs.SwitchInput")],ER);const lYt=ER;var $oe;let _6=$oe=class extends Jpe{constructor(t){super(t),this.type="text-area"}clone(){return new $oe({maxLength:this.maxLength,minLength:this.minLength})}};d([m({type:["text-area"],json:{read:!1,write:!0}})],_6.prototype,"type",void 0),_6=$oe=d([N("esri.form.elements.inputs.TextAreaInput")],_6);const cYt=_6;var Noe;let v6=Noe=class extends Jpe{constructor(t){super(t),this.type="text-box"}clone(){return new Noe({maxLength:this.maxLength,minLength:this.minLength})}};d([m({type:["text-box"],json:{read:!1,write:!0}})],v6.prototype,"type",void 0),v6=Noe=d([N("esri.form.elements.inputs.TextBoxInput")],v6);const uYt=v6;var Loe;function TJ(t){return t??null}function EJ(t){return t??null}let ad=Loe=class extends f1{constructor(t){super(t),this.max=null,this.min=null,this.timeResolution="minutes",this.type="time-picker"}readMax(t,e){return TJ(e.max)}writeMax(t,e){e.max=EJ(t)}readMin(t,e){return TJ(e.min)}writeMin(t,e){e.min=EJ(t)}readTimeResolution(t,e){return TJ(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=EJ(t)}clone(){return new Loe({max:this.max,min:this.min,timeResolution:this.timeResolution})}};d([m({type:String,json:{type:String,write:!0}})],ad.prototype,"max",void 0),d([Le("max")],ad.prototype,"readMax",null),d([Ve("max")],ad.prototype,"writeMax",null),d([m({type:String,json:{type:String,write:!0}})],ad.prototype,"min",void 0),d([Le("min")],ad.prototype,"readMin",null),d([Ve("min")],ad.prototype,"writeMin",null),d([m({type:String,json:{type:String,write:!0}})],ad.prototype,"timeResolution",void 0),d([Le("timeResolution")],ad.prototype,"readTimeResolution",null),d([Ve("timeResolution")],ad.prototype,"writeTimeResolution",null),d([m({type:["time-picker"],json:{read:!1,write:!0}})],ad.prototype,"type",void 0),ad=Loe=d([N("esri.form.elements.inputs.TimePickerInput")],ad);const hYt=ad,dYt={base:f1,key:"type",typeMap:{"barcode-scanner":iYt,"combo-box":rYt,"date-picker":sYt,"datetime-picker":oYt,"datetimeoffset-picker":nYt,"radio-buttons":aYt,switch:lYt,"text-area":cYt,"text-box":uYt,"time-picker":hYt}};var Doe;let Mp=Doe=class extends nC{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return this._get("editable")??!0}set editable(t){this._set("editable",t)}clone(){return new Doe({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};d([m({types:hDe,json:{read:{reader:S9},write:!0}})],Mp.prototype,"domain",void 0),d([m({type:Boolean,json:{write:!0}})],Mp.prototype,"editable",null),d([m({type:String,json:{write:!0}})],Mp.prototype,"editableExpression",void 0),d([m({type:String,json:{write:!0}})],Mp.prototype,"fieldName",void 0),d([m({type:String,json:{write:!0}})],Mp.prototype,"hint",void 0),d([m({types:dYt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Mp.prototype,"input",void 0),d([m({type:String,json:{write:!0}})],Mp.prototype,"requiredExpression",void 0),d([m({type:String,json:{read:!1,write:!0}})],Mp.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],Mp.prototype,"valueExpression",void 0),Mp=Doe=d([N("esri.form.elements.FieldElement")],Mp);const REe=Mp;var Foe;let q_=Foe=class extends nC{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new Foe({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:ee(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};d([m({type:Number,json:{write:!0}})],q_.prototype,"displayCount",void 0),d([m({type:["list"],json:{write:!0}})],q_.prototype,"displayType",void 0),d([m({type:String,json:{write:!0}})],q_.prototype,"editableExpression",void 0),d([m({type:[yue],json:{write:!0}})],q_.prototype,"orderByFields",void 0),d([m({type:Number,json:{write:!0}})],q_.prototype,"relationshipId",void 0),d([m({type:["relationship"],json:{read:!1,write:!0}})],q_.prototype,"type",void 0),q_=Foe=d([N("esri.form.elements.RelationshipElement")],q_);const PEe=q_;var koe;let CR=koe=class extends nC{constructor(t){super(t),this.text=null,this.textFormat="plain-text",this.type="text"}clone(){return new koe({text:this.text,textFormat:this.textFormat,visibilityExpression:this.visibilityExpression})}};d([m({type:String,json:{write:!0}})],CR.prototype,"text",void 0),d([m({type:String,json:{write:!0}})],CR.prototype,"textFormat",void 0),d([m({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],CR.prototype,"type",void 0),CR=koe=d([N("esri.form.elements.TextElement")],CR);const OEe=CR;function UHe(t){return{typesWithGroup:{base:nC,key:"type",typeMap:{attachment:TEe,field:REe,group:t,relationship:PEe,text:OEe}},typesWithoutGroup:{base:nC,key:"type",typeMap:{attachment:TEe,field:REe,relationship:PEe,text:OEe}}}}function BHe(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function zHe(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>s.toJSON())}function VHe(t,e,i=!0){return t?t.map(r=>ag(i?e.typesWithGroup:e.typesWithoutGroup,r)):null}var Uoe;let Cy=Uoe=class extends nC{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return VHe(t,CJ,!1)}readElements(t,e){return BHe(e.formElements,CJ,!1)}writeElements(t,e){e.formElements=zHe(t,CJ,!1)}clone(){return new Uoe({description:this.description,elements:ee(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};d([m({json:{write:!0}})],Cy.prototype,"elements",void 0),d([vi("elements")],Cy.prototype,"castElements",null),d([Le("elements",["formElements"])],Cy.prototype,"readElements",null),d([Ve("elements")],Cy.prototype,"writeElements",null),d([m({type:["collapsed","expanded"],json:{write:!0}})],Cy.prototype,"initialState",void 0),d([m({type:String,json:{read:!1,write:!0}})],Cy.prototype,"type",void 0),Cy=Uoe=d([N("esri.form.elements.GroupElement")],Cy);const CJ=UHe(Cy),pYt=Cy,fYt=t=>t.type==="field",mYt=t=>t.type==="group",gYt=t=>t.type==="text";var Boe;const MJ=UHe(pYt);let mm=Boe=class extends we{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return VHe(t,MJ)}readElements(t,e){return BHe(e.formElements,MJ)}writeElements(t,e){e.formElements=zHe(t,MJ)}clone(){return new Boe({description:this.description,expressionInfos:ee(this.expressionInfos),elements:ee(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}async getFieldsUsed(t,e){const i=new Set,{description:r,elements:s,expressionInfos:n,title:o}=this;if(WD(i,t,r),WD(i,t,o),!s)return[];const a=yYt(s,n).map(l=>Wc(i,t,l));await Promise.all(a);for(const l of s)GHe(i,{fieldsIndex:t,relationships:e},l);return Array.from(i).sort()}};function GHe(t,e,i){const{fieldsIndex:r}=e;if(!r||r.fields.length!==t.size)switch(WD(t,r,i.label),WD(t,r,i.description),i.type){case"field":Ou(t,r,i.fieldName);break;case"group":i.elements.forEach(s=>GHe(t,e,s));break;case"relationship":if(e.relationships){const s=e.relationships.find(n=>n.id===i.relationshipId);s&&Ou(t,r,s.keyField)}VE(t,r,i.orderByFields?.map(s=>s.field));break;case"text":WD(t,r,i.text)}}function yYt(t,e){if(!e||e.length===0)return[];const i=jHe(t),r=[];for(const s of e)i.has(s.name)&&r.push(s.expression);return r}function jHe(t){const e=new Set;for(const i of t)if(_me(e,i.visibilityExpression),!gYt(i)){if(mYt(i))z6(e,jHe(i.elements));else if(_me(e,i.editableExpression),fYt(i)){const{requiredExpression:r,valueExpression:s}=i;z6(e,[r,s])}}return e}function WD(t,e,i){VE(t,e,gLe(i))}d([m({type:String,json:{write:!0}})],mm.prototype,"description",void 0),d([m({json:{write:!0}})],mm.prototype,"elements",void 0),d([vi("elements")],mm.prototype,"castElements",null),d([Le("elements",["formElements"])],mm.prototype,"readElements",null),d([Ve("elements")],mm.prototype,"writeElements",null),d([m({type:[eYt],json:{write:!0}})],mm.prototype,"expressionInfos",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],mm.prototype,"preserveFieldValuesWhenHidden",void 0),d([m({type:String,json:{write:!0}})],mm.prototype,"title",void 0),mm=Boe=d([N("esri.form.FormTemplate")],mm);const _Yt=mm;function IEe(t,e,i){if(t.hasM==null||t.hasZ)for(const r of e)for(const s of r)s.length>2&&(s[2]*=i)}function vYt(t,e,i){if(!t&&!e||!i)return;const r=AE(i);$Ee(t,i,r),$Ee(e,i,r)}function $Ee(t,e,i){if(t)for(const r of t)bYt(r.geometry,e,i)}function bYt(t,e,i){if(!t?.spatialReference||Bs(t.spatialReference,e))return;const r=AE(t.spatialReference)/i;if(r!==1){if("x"in t)t.z!=null&&(t.z*=r);else if("rings"in t)IEe(t,t.rings,r);else if("paths"in t)IEe(t,t.paths,r);else if("points"in t&&(t.hasM==null||t.hasZ))for(const s of t.points)s.length>2&&(s[2]*=r)}}function NEe(t,e,i){if(!i?.features||!i.hasZ)return;const r=GIe(i.geometryType,e,t.outSpatialReference);if(r!=null)for(const s of i.features)r(s.geometry)}var zoe;const Voe=new ur({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let ol=zoe=class extends we{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){const i=Je.fromJSON(e.spatialReference),r=[];for(let s=0;s<t.length;s++){const n=t[s],o=fg.fromJSON(n),a=n.geometry?.spatialReference;o.geometry==null||a||(o.geometry.spatialReference=i);const l=n.aggregateGeometries,c=o.aggregateGeometries;if(l&&c!=null)for(const u in c){const h=c[u],p=l[u],f=p?.spatialReference;h==null||f||(h.spatialReference=i)}r.push(o)}return r}writeGeometryType(t,e,i,r){if(t)return void Voe.write(t,e,i,r);const{features:s}=this;if(s){for(const n of s)if(n?.geometry!=null)return void Voe.write(n.geometry.type,e,i,r)}}readQueryGeometry(t,e){if(!t)return null;const i=!!t.spatialReference,r=Vv(t);return r&&!i&&e.spatialReference&&(r.spatialReference=Je.fromJSON(e.spatialReference)),r}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&r.geometry!=null&&r.geometry.spatialReference)return void(e.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new zoe(this.cloneProperties())}cloneProperties(){return ee({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let i=0;i<e.features.length;i++){const r=e.features[i];if(r.geometry){const s=t?.[i];r.geometry=s?.toJSON()||r.geometry}}return e}quantize(t){const{scale:[e,i],translate:[r,s]}=t,n=c=>Math.round((c-r)/e),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,u=a.length;c<u;c++)l?.(a[c].geometry)||(a.splice(c,1),c--,u--);return this.transform=t,this}unquantize(){const{geometryType:t,features:e,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=p=>p*n+r,l=p=>s-p*o;let c=null,u=null;if(this.hasZ&&i?.scale?.[2]!=null){const{translate:[,,p],scale:[,,f]}=i;c=g=>g*f+p}if(this.hasM&&i?.scale?.[3]!=null){const{translate:[,,,p],scale:[,,,f]}=i;u=g=>g==null?g:g*f+p}const h=this._getHydrationFunction(t,a,l,c,u);for(const{geometry:p}of e)p!=null&&h&&h(p);return this.transform=null,this}_quantizePoints(t,e,i){let r,s;const n=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),u=i(l[1]);c===r&&u===s||(n.push([c-r,u-s]),r=c,s=u)}else r=e(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(t,e,i){return t==="point"?r=>(r.x=e(r.x),r.y=i(r.y),r):t==="polyline"||t==="polygon"?r=>{const s=zc(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,e,i);c&&n.push(c)}return n.length>0?(zc(r)?r.rings=n:r.paths=n,r):null}:t==="multipoint"?r=>{const s=this._quantizePoints(r.points,e,i);return s&&s.length>0?(r.points=s,r):null}:t==="extent"?r=>r:null}_getHydrationFunction(t,e,i,r,s){return t==="point"?n=>{n.x=e(n.x),n.y=i(n.y),r&&(n.z=r(n.z))}:t==="polyline"||t==="polygon"?n=>{const o=zc(n)?n.rings:n.paths;let a,l;for(let c=0,u=o.length;c<u;c++){const h=o[c];for(let p=0,f=h.length;p<f;p++){const g=h[p];p>0?(a+=g[0],l+=g[1]):(a=g[0],l=g[1]),g[0]=e(a),g[1]=i(l)}}if(r&&s)for(let c=0,u=o.length;c<u;c++){const h=o[c];for(let p=0,f=h.length;p<f;p++){const g=h[p];g[2]=r(g[2]),g[3]=s(g[3])}}else if(r)for(let c=0,u=o.length;c<u;c++){const h=o[c];for(let p=0,f=h.length;p<f;p++){const g=h[p];g[2]=r(g[2])}}else if(s)for(let c=0,u=o.length;c<u;c++){const h=o[c];for(let p=0,f=h.length;p<f;p++){const g=h[p];g[2]=s(g[2])}}}:t==="extent"?n=>{n.xmin=e(n.xmin),n.ymin=i(n.ymin),n.xmax=e(n.xmax),n.ymax=i(n.ymax),r&&n.zmax!=null&&n.zmin!=null&&(n.zmax=r(n.zmax),n.zmin=r(n.zmin)),s&&n.mmax!=null&&n.mmin!=null&&(n.mmax=s(n.mmax),n.mmin=s(n.mmin))}:t==="multipoint"?n=>{const o=n.points;let a,l;for(let c=0,u=o.length;c<u;c++){const h=o[c];c>0?(a+=h[0],l+=h[1]):(a=h[0],l=h[1]),h[0]=e(a),h[1]=i(l)}if(r&&s)for(let c=0,u=o.length;c<u;c++){const h=o[c];h[2]=r(h[2]),h[3]=s(h[3])}else if(r)for(let c=0,u=o.length;c<u;c++){const h=o[c];h[2]=r(h[2])}else if(s)for(let c=0,u=o.length;c<u;c++){const h=o[c];h[2]=s(h[2])}}:null}};d([m({type:String,json:{write:!0}})],ol.prototype,"displayFieldName",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ol.prototype,"exceededTransferLimit",void 0),d([m({type:[fg],json:{write:!0}})],ol.prototype,"features",void 0),d([Le("features")],ol.prototype,"readFeatures",null),d([m({type:[Xk],json:{write:!0}})],ol.prototype,"fields",void 0),d([m({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:Voe.read}}})],ol.prototype,"geometryType",void 0),d([Ve("geometryType")],ol.prototype,"writeGeometryType",null),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ol.prototype,"hasM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ol.prototype,"hasZ",void 0),d([m({types:gC,json:{write:!0}})],ol.prototype,"queryGeometry",void 0),d([Le("queryGeometry")],ol.prototype,"readQueryGeometry",null),d([m({type:Je,json:{write:!0}})],ol.prototype,"spatialReference",void 0),d([Ve("spatialReference")],ol.prototype,"writeSpatialReference",null),d([m({json:{write:!0}})],ol.prototype,"transform",void 0),ol=zoe=d([N("esri.rest.support.FeatureSet")],ol),ol.prototype.toJSON.isDefaultToJSON=!0;const Qpe=ol;let wYt=0,sv=class extends lg.LoadableMixin(Mk(ct)){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const i=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(i)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}get _workerGeometryType(){const e=this.layer?.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,i={}){await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);NEe(e,this.layer.spatialReference,r);const s=Qpe.fromJSON(r);if(!this._requiresClientGraphicMapping())return s;const n=this.layer.objectIdField;for(const o of s.features){const a=o.attributes[n],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return s.geometryType=this.layer.geometryType,s}async queryFeaturesJSON(e,i={}){if(this._requiresClientGraphicMapping())throw new j("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);return NEe(e,this.layer.spatialReference,r),r}queryFeatureCount(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,i))}queryObjectIds(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,i))}queryExtent(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,i)).then(r=>({count:r.count,extent:lr.fromJSON(r.extent)}))}querySnapping(e,i={}){return this.load(i).then(()=>this._connection.invoke("querySnapping",e,i))}async _applyEdits(e){if(!this._connection)throw new j("feature-layer-source:edit-failure","Memory source not loaded");const i=this.layer.objectIdField;let r=null;const s=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=u=>"objectId"in u&&u.objectId!=null?u.objectId:"attributes"in u&&u.attributes[i]!=null?u.attributes[i]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const u of e.deleteFeatures){const h=o(u);h!=null&&s.push(h)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const u of e.updateFeatures)if(n.push(this._serializeFeature(u)),a){const h=o(u);h!=null&&a.set(h,u)}}vYt(r?r.features:null,n,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:n,deletes:s});return this.fullExtent=l,r&&r.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,i){if(this._layerOrSourceGeometryType!=="mesh"||e==null)return;const r=[];for(const{geometry:s}of e)s==null||s.type!=="mesh"||s.hasExtent||s.loaded||r.push(s.load({signal:i}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,i){if(this._idToClientGraphic){if(e)for(const r of i.updateResults){if(!r.success)continue;const s=e.get(r.objectId);s!=null&&this._addIdToClientGraphic(s)}for(const r of i.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const i=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:i?new j("feature-layer-source:edit-failure",i.description,{code:i.code}):null}}_prepareAddFeatures(e){const i=new Map,r=new Array(e.length);let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);s||a.geometry==null||(s=a.geometry.type),r[o]=l,i.set(`${l.uid}`,a)}const n=this;return{features:r,inferredGeometryType:s,finish(o){const a=n.sourceJSON.objectIdField;for(const l in o){const c=o[l],u=i.get(l);u&&(u.attributes||(u.attributes={}),c===-1?delete u.attributes[a]:u.attributes[a]=c,n._addIdToClientGraphic(u))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const i=this.sourceJSON.objectIdField,r=e.attributes?.[i];r!=null&&this._idToClientGraphic.set(r,e)}get _layerOrSourceGeometryType(){return this.layer?.geometryType??this.sourceJSON?.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:i}=e,r=this._geometryForSerialization(e),s=(wYt++).toString();return r?{uid:s,geometry:r.toJSON(),attributes:i}:{uid:s,attributes:i}}_geometryForSerialization(e){const{geometry:i}=e;return i==null?null:this._geometryRequiresClientGraphicMapping(i)?i.extent?Ix.fromExtent(i.extent):null:i}async _startWorker(e){this._connection=await N$e("MemorySourceWorker",{strategy:ae("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{fields:i,spatialReference:r,objectIdField:s,hasM:n,hasZ:o,timeInfo:a,dateFieldsTimeZone:l}=this.layer,c=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const u=this._prepareAddFeatures(this.items);this.addHandles(this.on("before-changes",g=>{oe.getLogger(this).error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),g.preventDefault()}));const h={features:u.features,fields:i?.map(g=>g.toJSON()),geometryType:xge.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&n,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:s,spatialReference:c?null:r&&r.toJSON(),timeInfo:a?.toJSON()??null,dateFieldsTimeZone:l},p=await this._connection.invoke("load",h,{signal:e});for(const g of p.warnings)oe.getLogger(this.layer).warn("#load()",`${g.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:g});p.featureErrors.length&&oe.getLogger(this.layer).warn("#load()",`Encountered ${p.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:p.featureErrors});const f=p.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(u.inferredGeometryType)&&(f.geometryType=xge.toJSON(u.inferredGeometryType)),this.sourceJSON=f,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),u.finish(p.assignedObjectIds)}};d([Ple({Type:fg,ensureType:Tn(fg)})],sv.prototype,"itemType",void 0),d([m()],sv.prototype,"type",void 0),d([m({constructOnly:!0})],sv.prototype,"layer",void 0),d([m({readOnly:!0})],sv.prototype,"_workerGeometryType",null),d([m()],sv.prototype,"sourceJSON",void 0),sv=d([N("esri.layers.graphics.sources.MemorySource")],sv);function xYt(t){return"portalItem"in t}const SYt=t=>{let e=class extends t{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):xYt(this)?this.portalItem?.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return d([m({type:String})],e.prototype,"apiKey",null),e=d([N("esri.layers.mixins.APIKeyMixin")],e),e},HHe=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=FI(this.url);if(i!=null&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",ont(i,oe.getLogger(this)))}};return d([m()],e.prototype,"title",null),d([m({type:String})],e.prototype,"url",null),e=d([N("esri.layers.mixins.ArcGISService")],e),e},TYt={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}},LEe={read:{reader:GF},write:{allowNull:!0,writer:jF}},EYt={json:{read:!1,write:!1,origins:{"web-map":LEe,"portal-item":LEe}}},qHe=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return d([m(TYt)],e.prototype,"blendMode",void 0),d([m(EYt)],e.prototype,"effect",void 0),e=d([N("esri.layers.mixins.BlendLayer")],e),e},WHe=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return d([m({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],e.prototype,"customParameters",void 0),e=d([N("esri.layers.mixins.CustomParametersMixin")],e),e},CYt=Ont(),YHe=new Map,XHe=new Map;async function mMi(t,e,i){if(!t||!i)return!1;if(!e)return!0;const r=new URL(t).host;let s=YHe.get(r);if(!s){const n=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");s=(await qi(n,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return s===e}async function gMi(t,e,i=!1){if(!t||!e)return!0;const r=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),s=XHe.get(r)?.entries();if(s){for(const[n,o]of s)if(o.name===e){const a=!o.stack?.hasForwardEdits();if(!a&&i){const[{deleteForwardEdits:l},{default:c}]=await Promise.all([ye(()=>import("./deleteForwardEdits-bb68541b.js"),[],import.meta.url),ye(()=>import("./DeleteForwardEditsParameters-e1c6125a.js"),[],import.meta.url)]),u=await l(r,n,new c({sessionId:CYt,moment:o.moment}));return u.success&&o.stack?.clearForwardEdits(),u.success}return a}}return!0}function MYt(t,e){if(!t)return!1;const i=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),r=XHe.get(i)?.entries();if(r){for(const[s,n]of r)if(n.name===e)return n.lockType==="edit"}return!1}const Kpe=new un.EventEmitter;function AYt(t){return Kpe.on("apply-edits",new WeakRef(t))}function RYt(t){return Kpe.on("update-moment",new WeakRef(t))}function yMi(t,e,i=null,r=!1){const s=lo();return r=e==null||r,Kpe.emit("apply-edits",{serviceUrl:t,layerId:e,gdbVersion:i,mayReceiveServiceEdits:r,result:s.promise}),s}const ZHe=Symbol();function _Mi(t){return t!=null&&typeof t=="object"&&ZHe in t}function A3(t){return t!=null&&typeof t=="object"&&"gdbVersion"in t}function AJ(t,e,i){const r=new URL(t).host,s=YHe.get(r),n=o=>!o||o===s;return n(e)&&n(i)||e===i}const PYt=t=>{var e;let i=class extends t{constructor(...r){super(...r),this[e]=!0,this._applyEditsHandler=s=>{const{serviceUrl:n,layerId:o,gdbVersion:a,mayReceiveServiceEdits:l,result:c}=s,u=n===this.url,h=o!=null&&this.layerId!=null&&o===this.layerId,p=A3(this),f=A3(this)&&AJ(n,a,this.gdbVersion);if(!u||p&&!f||!h&&!l)return;this.lastEditsEventDate=new Date;const g=c.then(y=>{if(h&&(y.addedFeatures.length||y.updatedFeatures.length||y.deletedFeatures.length||y.addedAttachments.length||y.updatedAttachments.length||y.deletedAttachments.length))return this.emit("edits",ee(y)),y;const v=y.editedFeatures?.find(({layerId:w})=>w===this.layerId);if(v){const{adds:w,updates:x,deletes:S}=v.editedFeatures,E={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:w?w.map(({attributes:C})=>({objectId:this.objectIdField&&C[this.objectIdField],globalId:this.globalIdField&&C[this.globalIdField]})):[],deletedFeatures:S?S.map(({attributes:C})=>({objectId:this.objectIdField&&C[this.objectIdField],globalId:this.globalIdField&&C[this.globalIdField]})):[],updatedFeatures:x?x.map(({current:{attributes:C}})=>({objectId:this.objectIdField&&C[this.objectIdField],globalId:this.globalIdField&&C[this.globalIdField]})):[],editedFeatures:ee(y.editedFeatures),exceededTransferLimit:!1,historicMoment:ee(y.historicMoment)};return this.emit("edits",E),E}const b={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:ee(y.editedFeatures),exceededTransferLimit:!1,historicMoment:ee(y.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(n,a,b.historicMoment)&&this.emit("edits",b),b}).then(y=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(n,a,y.historicMoment)&&(this.historicMoment=y.historicMoment),y));this.emit("apply-edits",{result:g})},this._updateMomentHandler=s=>{const{serviceUrl:n,gdbVersion:o,moment:a}=s,l=n===this.url,c=A3(this),u=A3(this)&&AJ(n,o,this.gdbVersion),h=A3(this)&&!AJ(n,this.gdbVersion,null);l&&c&&u&&h&&"historicMoment"in this&&this.historicMoment!==a&&(this.historicMoment=a)},this.when().then(()=>{this.addHandles(AYt(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(RYt(this._updateMomentHandler))},()=>{})}_shouldUpdateHistoricMoment(r,s,n){return"historicMoment"in this&&this.historicMoment!==n&&MYt(r,s)}};return e=ZHe,d([m()],i.prototype,"lastEditsEventDate",void 0),i=d([N("esri.layers.mixins.EditBusLayer")],i),i};var Goe;const RJ=new ur({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),PJ=new ur({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let wy=Goe=class extends we{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new Sh({geometry:ee(i),objectIds:ee(n),spatialRelationship:r,timeExtent:ee(s),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new Goe({geometry:ee(e),objectIds:ee(s),spatialRelationship:i,timeExtent:ee(r),where:t,units:n,distance:o})}};d([m({type:String,json:{write:!0}})],wy.prototype,"where",void 0),d([m({types:gC,json:{write:!0}})],wy.prototype,"geometry",void 0),d([m({type:RJ.apiValues,json:{name:"spatialRel",read:{reader:RJ.read},write:{allowNull:!1,writer:RJ.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],wy.prototype,"spatialRelationship",void 0),d([m({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],wy.prototype,"distance",void 0),d([m({type:[Number],json:{write:!0}})],wy.prototype,"objectIds",void 0),d([m({type:PJ.apiValues,json:{read:PJ.read,write:{writer:PJ.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],wy.prototype,"units",void 0),d([m({type:wl,json:{write:!0}})],wy.prototype,"timeExtent",void 0),wy=Goe=d([N("esri.layers.support.FeatureFilter")],wy);const OYt=wy;var joe;const DEe={read:{reader:GF},write:{writer:jF,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},FEe={read:{reader:GF},write:{writer:jF,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},kEe={name:"showExcludedLabels",default:!0};let a2=joe=class extends we{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){const i=super.write(t,e);if(e?.origin){if(i.filter){const r=Object.keys(i.filter);if(r.length>1||r[0]!=="where")return e.messages?.push(new j("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in i)return e.messages?.push(new j("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return i}clone(){return new joe({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};d([m({type:OYt,json:{write:{allowNull:!0,writer(t,e,i,r){const s=t?.write({},r);s&&Object.keys(s).length!==0?ja(i,s,e):ja(i,null,e)}}}})],a2.prototype,"filter",void 0),d([m({json:{read:GF,write:{writer:jF,allowNull:!0},origins:{"web-map":DEe,"portal-item":DEe}}})],a2.prototype,"includedEffect",void 0),d([m({json:{read:GF,write:{writer:jF,allowNull:!0},origins:{"web-map":FEe,"portal-item":FEe}}})],a2.prototype,"excludedEffect",void 0),d([m({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":kEe,"portal-item":kEe}}})],a2.prototype,"excludedLabelsVisible",void 0),a2=joe=d([N("esri.layers.support.FeatureEffect")],a2);const IYt=a2,UEe={write:{allowNull:!0}},$Yt={type:IYt,json:{origins:{"web-map":UEe,"portal-item":UEe}}},JHe=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return d([m($Yt)],e.prototype,"featureEffect",void 0),e=d([N("esri.layers.mixins.FeatureEffectLayer")],e),e};var Hoe;let jL=Hoe=class extends we{constructor(t){super(t)}async collectRequiredFields(t,e){return Wc(t,e,this.expression)}clone(){return new Hoe({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};d([m({type:String,json:{write:!0}})],jL.prototype,"expression",void 0),d([m({type:String,json:{write:!0}})],jL.prototype,"title",void 0),jL=Hoe=d([N("esri.symbols.support.FeatureExpressionInfo")],jL);const BEe=jL;var qoe;const az=Yc()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),zEe=new ur({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let W_=qoe=class extends we{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,i,r){e[i]=t.write({},r),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new qoe({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&RXe(this.featureExpressionInfo,t.featureExpressionInfo)}};d([m({type:BEe,json:{write:!0}})],W_.prototype,"featureExpressionInfo",void 0),d([Le("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],W_.prototype,"readFeatureExpressionInfo",null),d([Ve("featureExpressionInfo",{featureExpressionInfo:{type:BEe},"featureExpression.value":{type:[0]}})],W_.prototype,"writeFeatureExpressionInfo",null),d([m({type:az.apiValues,nonNullable:!0,json:{type:az.jsonValues,read:az.read,write:{writer:az.write,isRequired:!0}}})],W_.prototype,"mode",null),d([m({type:Number,json:{write:!0}})],W_.prototype,"offset",void 0),d([m({type:gTt,json:{type:String,read:zEe.read,write:zEe.write}})],W_.prototype,"unit",null),W_=qoe=d([N("esri.symbols.support.ElevationInfo")],W_);const QHe=W_,KHe={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:xl}}},z7={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,i){e[i]=!t}}}},V7={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:xl}}},eqe={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Bv}}},tqe={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:xl}}},NYt={value:null,type:QHe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:xl}}};function vMi(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const iqe={write:{enabled:!0,layerContainerTypes:xl},read:!0},Woe={type:Number,json:{origins:{"web-document":iqe,"portal-item":{write:!0}}}},LYt={...Woe,json:{...Woe.json,origins:{"web-document":{...iqe,write:{enabled:!0,layerContainerTypes:xl,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,i)=>i&&i.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition?.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?xO(e.layerDefinition.drawingInfo.transparency):void 0:xO(e.drawingInfo.transparency)}}},bMi={type:lr,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const i=lr.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(i.spatialReference=Je.fromJSON(e.spatialReference)),i}}}},read:!1}},DYt={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},rqe={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:xl}}},name:"layerDefinition.minScale",write:!0}},sqe={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:xl}}},name:"layerDefinition.maxScale",write:!0}},nqe={json:{write:{ignoreOrigin:!0,layerContainerTypes:xl},origins:{"web-map":{read:!1,write:!1}}}};let Y_=class extends ms(we){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};d([m()],Y_.prototype,"creatorField",void 0),d([m()],Y_.prototype,"creationDateField",void 0),d([m()],Y_.prototype,"editorField",void 0),d([m()],Y_.prototype,"editDateField",void 0),d([m()],Y_.prototype,"realm",void 0),d([m(bj("dateFieldsTimeReference",!0))],Y_.prototype,"timeZone",void 0),Y_=d([N("esri.layers.support.EditFieldsInfo")],Y_);const FYt=Y_;let My=class extends ms(we){constructor(e){super(e)}};d([m({constructOnly:!0,json:{write:!0}})],My.prototype,"name",void 0),d([m({constructOnly:!0,json:{write:!0}})],My.prototype,"fields",void 0),d([m({constructOnly:!0,json:{write:!0}})],My.prototype,"isAscending",void 0),d([m({constructOnly:!0,json:{write:!0}})],My.prototype,"indexType",void 0),d([m({constructOnly:!0,json:{write:!0}})],My.prototype,"isUnique",void 0),d([m({constructOnly:!0,json:{write:!0}})],My.prototype,"description",void 0),My=d([N("esri.layers.support.FeatureIndex")],My);async function kYt(t,e,i){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=oqe(t));const r=UYt(t),s=t.capabilities.query.supportsPagination;e.start=0,e.num=r;let n=null;for(;;){const o=await t.source.queryFeaturesJSON(e,i);if(n==null?n=o:n.features=n.features.concat(o.features),n.exceededTransferLimit=o.exceededTransferLimit,!s||!o.exceededTransferLimit)break;e.start+=r}return n}function UYt(t){return oqe(t)*BYt(t)}function BYt(t){return t.capabilities.query.maxRecordCount||2e3}function oqe(t){return t.capabilities.query.supportsMaxRecordCountFactor?Sh.MAX_MAX_RECORD_COUNT_FACTOR:1}var Yoe;let al=Yoe=class extends we{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new Yoe(ee({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};d([m({type:[String],json:{write:!0}})],al.prototype,"attachmentTypes",void 0),d([m({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],al.prototype,"attachmentsWhere",void 0),d([m({type:Boolean,json:{write:!0}})],al.prototype,"cacheHint",void 0),d([m({type:[String],json:{write:!0}})],al.prototype,"keywords",void 0),d([m({type:[Number],json:{write:!0}})],al.prototype,"globalIds",void 0),d([m({json:{write:!0}})],al.prototype,"name",void 0),d([m({type:Number,json:{read:{source:"resultRecordCount"}}})],al.prototype,"num",void 0),d([m({type:[Number],json:{write:!0}})],al.prototype,"objectIds",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],al.prototype,"returnMetadata",void 0),d([m({type:[Number],json:{write:!0}})],al.prototype,"size",void 0),d([m({type:Number,json:{read:{source:"resultOffset"}}})],al.prototype,"start",void 0),d([Ve("start"),Ve("num")],al.prototype,"writeStart",null),d([m({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],al.prototype,"where",void 0),al=Yoe=d([N("esri.rest.support.AttachmentQuery")],al),al.from=Tn(al);const zYt=al;var Xoe;let jn=Xoe=class extends we{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new Xoe(ee({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};d([m({type:Boolean,json:{write:!0}})],jn.prototype,"cacheHint",void 0),d([m({type:vm,json:{write:!0}})],jn.prototype,"dynamicDataSource",void 0),d([m({type:String,json:{write:!0}})],jn.prototype,"gdbVersion",void 0),d([m({type:Number,json:{write:!0}})],jn.prototype,"geometryPrecision",void 0),d([m({type:Date})],jn.prototype,"historicMoment",void 0),d([Ve("historicMoment")],jn.prototype,"_writeHistoricMoment",null),d([m({type:Number,json:{write:!0}})],jn.prototype,"maxAllowableOffset",void 0),d([m({json:{write:!0}})],jn.prototype,"objectIds",void 0),d([m({type:[String],json:{write:!0}})],jn.prototype,"orderByFields",void 0),d([m({type:[String],json:{write:!0}})],jn.prototype,"outFields",void 0),d([m({type:Je,json:{read:{source:"outSR"},write:{target:"outSR"}}})],jn.prototype,"outSpatialReference",void 0),d([m({json:{write:!0}})],jn.prototype,"relationshipId",void 0),d([m({type:Number,json:{read:{source:"resultOffset"}}})],jn.prototype,"start",void 0),d([Ve("start"),Ve("num")],jn.prototype,"writeStart",null),d([m({type:Number,json:{read:{source:"resultRecordCount"}}})],jn.prototype,"num",void 0),d([m({json:{write:!0}})],jn.prototype,"returnGeometry",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],jn.prototype,"returnM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],jn.prototype,"returnZ",void 0),d([m({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],jn.prototype,"where",void 0),jn=Xoe=d([N("esri.rest.support.RelationshipQuery")],jn),jn.from=Tn(jn);const efe=jn,SMi=Object.freeze(Object.defineProperty({__proto__:null,default:efe},Symbol.toStringTag,{value:"Module"})),Zoe=new ur({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function VYt(t,e,i,r){const s=await Qx(t);if(await tfe(t,e,r),!s.addAttachment)throw new j(r,"Layer source does not support addAttachment capability");return s.addAttachment(e,i)}function tfe(t,e,i){const{attributes:r}=e,{objectIdField:s}=t;return t.capabilities?.data?.supportsAttachment?e?r?s&&r[s]?Promise.resolve():Promise.reject(new j(i,`feature is missing the identifying attribute ${s}`)):Promise.reject(new j(i,"'attributes' are required on a feature to query attachments")):Promise.reject(new j(i,"A feature is required to add/delete/update attachments")):Promise.reject(new j(i,"this layer doesn't support attachments"))}async function GYt(t,e,i,r,s){const n=await Qx(t);if(await tfe(t,e,s),!n.updateAttachment)throw new j(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(e,i,r)}async function jYt(t,e,i){const{applyEdits:r}=await ye(()=>import("./editingSupport-6c57d782.js"),["./editingSupport-6c57d782.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./infoFor3D-a657d595.js"],import.meta.url),s=await t.load();let n=i;return s.type==="feature"&&s.infoFor3D&&e.deleteFeatures!=null&&s.globalIdField!=null&&(n={...n,globalIdToObjectId:await lXt(s,e.deleteFeatures,s.globalIdField)}),r(s,s.source,e,i)}async function HYt(t,e,i){const{uploadAssets:r}=await ye(()=>import("./editingSupport-6c57d782.js"),["./editingSupport-6c57d782.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./infoFor3D-a657d595.js"],import.meta.url),s=await t.load();return r(s,s.source,e,i)}async function qYt(t,e,i,r){const s=await Qx(t);if(await tfe(t,e,r),!s.deleteAttachments)throw new j(r,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(e,i)}async function WYt(t,e,i){const r=(await t.load({signal:e?.signal})).source;if(!r.fetchRecomputedExtents)throw new j(i,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function YYt(t,e,i,r){e=zYt.from(e),await t.load();const s=t.source,n=t.capabilities;if(!n?.data?.supportsAttachment)throw new j(r,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:u,start:h,where:p}=e;if(!n?.operations?.supportsQueryAttachments&&(o?.length>0||l?.length>0||u?.length>0||c||h||p))throw new j(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a?.length||l?.length||p))throw new j(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!s.queryAttachments)throw new j(r,"Layer source does not support queryAttachments capability",e);return s.queryAttachments(e)}async function XYt(t,e,i,r){const s=await Qx(t);if(!s.queryObjectIds)throw new j(r,"Layer source does not support queryObjectIds capability");return s.queryObjectIds(Sh.from(e)??t.createQuery(),i)}async function ZYt(t,e,i,r){const s=await Qx(t);if(!s.queryFeatureCount)throw new j(r,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount(Sh.from(e)??t.createQuery(),i)}async function JYt(t,e,i,r){const s=await Qx(t);if(!s.queryExtent)throw new j(r,"Layer source does not support queryExtent capability");return s.queryExtent(Sh.from(e)??t.createQuery(),i)}async function QYt(t,e,i,r){const s=await Qx(t);if(!s.queryRelatedFeatures)throw new j(r,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(efe.from(e),i)}async function KYt(t,e,i,r){const s=await Qx(t);if(!s.queryRelatedFeaturesCount)throw new j(r,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(efe.from(e),i)}async function eXt(t){const e=t.source;if(e?.refresh)try{const{dataChanged:i,updates:r}=await e.refresh();if(r!=null&&(t.sourceJSON={...t.sourceJSON,...r},t.read(r,{origin:"service",url:t.parsedUrl})),i)return!0}catch{}if(t.definitionExpression)try{return(await lue(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function tXt(t){const e=new Sh,i=t.capabilities?.data,r=t.capabilities?.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),i&&(i.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),i.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:s,timeExtent:n}=t;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function aqe(t){const{globalIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeGlobalID")return r.name}}function lqe(t){const{objectIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeOID")return r.name}}function iXt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function rXt(t,e){const{subtypes:i,subtypeField:r}=t;if(!e||!i?.length||!r)return null;const s=e.attributes[r];return s==null?null:i.find(n=>n.code===s)}async function Qx(t){return(await t.load()).source}async function sXt(t,e){if(!Ar||Ar.findCredential(t))return;let i;try{const r=await fPe(t,e);r&&(i=await Ar.checkSignInStatus(`${r}/sharing`))}catch{}if(i)try{const r=e!=null?e.signal:null;await Ar.getCredential(t,{signal:r})}catch{}}async function nXt(t,e,i){const r=t.parsedUrl?.path;r&&t.authenticationTriggerEvent===e&&await sXt(r,i)}function oXt(t){return!b6(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const OJ=AI({types:nDe});function G7(t,e){if(t.defaultSymbol)return t.types?.length?new Zpe({defaultSymbol:OJ(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(i=>({id:i.id,symbol:OJ(i.symbol,i,e)}))}):new l$({symbol:OJ(t.defaultSymbol,t,e)})}function aXt(t){let e=t.sourceJSON?.cacheMaxAge;if(!e)return!1;const i=t.editingInfo?.lastEditDate?.getTime();return i==null||(e*=1e3,Date.now()-i<e)}async function lXt(t,e,i){if(e==null)return null;const r=[],{objectIdField:s}=t;if(e.forEach(c=>{let u=null;if("attributes"in c){const{attributes:h}=c;u={globalId:h[i],objectId:h[s]!=null&&h[s]!==-1?h[s]:null}}else u={globalId:c.globalId,objectId:c.objectId!=null&&c.objectId!==-1?c.objectId:null};u.globalId!=null&&(u.objectId!=null&&u.objectId!==-1||r.push(u.globalId))}),r.length===0)return null;const n=t.createQuery();n.where=r.map(c=>`${i}='${c}'`).join(" OR "),n.returnGeometry=!1,n.outFields=[s,i],n.cacheHint=!1;const o=await EQe(kYt(t,n));if(!o.ok)return null;const a=new Map,l=o.value.features;for(const c of l){const u=c.attributes[i],h=c.attributes[s];u!=null&&h!=null&&h!==-1&&a.set(u,h)}return a}function cXt(t,e,i){if(!e||!i||!t)return null;const r=i.getAttribute(e);return r==null?null:t.find(s=>{const{id:n}=s;return n!=null&&n.toString()===r.toString()})??null}function b6(t){return t.sourceJSON?.isMultiServicesView||uXt(t)}function uXt(t){return!!t.sourceJSON?.capabilities?.toLowerCase().split(",").map(e=>e.trim()).includes("map")}let MR=class extends ms(we){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};d([m({type:String,json:{read:{source:"shapeAreaFieldName"}}})],MR.prototype,"shapeAreaField",void 0),d([m({type:String,json:{read:{source:"shapeLengthFieldName"}}})],MR.prototype,"shapeLengthField",void 0),d([m({type:String,json:{read:t=>rKe.read(t)||sKe.read(t)}})],MR.prototype,"units",void 0),MR=d([N("esri.layers.support.GeometryFieldsInfo")],MR);const hXt=MR;var Joe;let AR=Joe=class extends we{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new ct}clone(){return new Joe({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};d([m({type:String,json:{write:!0}})],AR.prototype,"floorField",void 0),d([m({json:{read:!1,write:!1}})],AR.prototype,"viewAllMode",void 0),d([m({json:{read:!1,write:!1}})],AR.prototype,"viewAllLevelIds",void 0),AR=Joe=d([N("esri.layers.support.LayerFloorInfo")],AR);const dXt=AR,VEe=new ur({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),GEe=new ur({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Ap=class extends ms(we){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};d([m({json:{read:VEe.read,write:VEe.write}})],Ap.prototype,"cardinality",void 0),d([m({json:{read:!0,write:!0}})],Ap.prototype,"composite",void 0),d([m({json:{read:!0,write:!0}})],Ap.prototype,"id",void 0),d([m({json:{read:!0,write:!0}})],Ap.prototype,"keyField",void 0),d([m({json:{read:!0,write:!0}})],Ap.prototype,"keyFieldInRelationshipTable",void 0),d([m({json:{read:!0,write:!0}})],Ap.prototype,"name",void 0),d([m({json:{read:!0,write:!0}})],Ap.prototype,"relatedTableId",void 0),d([m({json:{read:!0,write:!0}})],Ap.prototype,"relationshipTableId",void 0),d([m({json:{read:GEe.read,write:GEe.write}})],Ap.prototype,"role",void 0),Ap=d([N("esri.layers.support.Relationship")],Ap);const pXt=Ap;function Zt(t,e,i){return!!cqe(t,e,i)}function HL(t,e,i){return cqe(t,e,i)}function cqe(t,e,i){return t&&t.hasOwnProperty(e)?t[e]:i}const fXt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function mXt(t){const e=t?.supportedSpatialAggregationStatistics?.map(i=>i.toLowerCase());return{envelope:!!e?.includes("envelopeaggregate"),centroid:!!e?.includes("centroidaggregate"),convexHull:!!e?.includes("convexhullaggregate")}}function N4(t,e){return!!t?.supportedOperationsWithCacheHint?.map(r=>r.toLowerCase())?.includes(e.toLowerCase())}function uqe(t,e){return{analytics:gXt(t),attachment:yXt(t),data:_Xt(t),metadata:vXt(t),operations:bXt(t.capabilities,t,e),query:wXt(t,e),queryRelated:xXt(t),queryTopFeatures:SXt(t),editing:TXt(t)}}function gXt(t){return{supportsCacheHint:N4(t.advancedQueryCapabilities,"queryAnalytics")}}function yXt(t){const e=t.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:N4(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:Zt(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(r=>{const s=fXt[r.name];s&&(i[s]=!!r.isEnabled)}),i}function _Xt(t){return{isVersioned:Zt(t,"isDataVersioned",!1),supportsAttachment:Zt(t,"hasAttachments",!1),supportsM:Zt(t,"hasM",!1),supportsZ:Zt(t,"hasZ",!1)}}function vXt(t){return{supportsAdvancedFieldProperties:Zt(t,"supportsFieldDescriptionProperty",!1)}}function bXt(t,e,i){const r=t?t.toLowerCase().split(",").map(p=>p.trim()):[],s=i?FI(i):null,n=r.includes(s!=null&&s.serverType==="MapServer"?"data":"query"),o=r.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&r.includes("create"),l=o&&r.includes("delete"),c=o&&r.includes("update");const u=r.includes("changetracking"),h=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:Zt(e,"supportsCalculate",!1),supportsTruncate:Zt(e,"supportsTruncate",!1),supportsValidateSql:Zt(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:u,supportsQuery:n,supportsQueryAnalytics:Zt(h,"supportsQueryAnalytic",!1),supportsQueryAttachments:Zt(h,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Zt(h,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Zt(e,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:Zt(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:Zt(e,"supportsAsyncConvert3D",!1)}}function wXt(t,e){const i=t.advancedQueryCapabilities,r=t.ownershipBasedAccessControlForFeatures,s=t.archivingInfo,n=t.currentVersion,o=e?.includes("MapServer"),a=!o||n>=ae("mapserver-pbf-version-support"),l=s$e(e),c=new Set((t.supportedQueryFormats??"").split(",").map(u=>u.toLowerCase().trim()));return{maxRecordCount:HL(t,"maxRecordCount",void 0),maxRecordCountFactor:HL(t,"maxRecordCountFactor",void 0),standardMaxRecordCount:HL(t,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:mXt(i),supportsCacheHint:Zt(i,"supportsQueryWithCacheHint",!1)||N4(i,"query"),supportsCentroid:Zt(i,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:l,supportsDefaultSpatialReference:Zt(i,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:Zt(i,"supportsDisjointSpatialRel",!1),supportsDistance:Zt(i,"supportsQueryWithDistance",!1),supportsDistinct:Zt(i,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:Zt(i,"supportsReturningQueryExtent",!1),supportsFormatPBF:a&&c.has("pbf"),supportsFullTextSearch:Zt(i,"supportsFullTextSearch",!1),supportsGeometryProperties:Zt(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:Zt(i,"supportsHavingClause",!1),supportsHistoricMoment:Zt(s,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:Zt(i,"supportsMaxRecordCountFactor",!1),supportsOrderBy:Zt(i,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:Zt(i,"supportsPagination",!1),supportsPercentileStatistics:Zt(i,"supportsPercentileStatistics",!1),supportsQuantization:Zt(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Zt(t,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:Zt(r,"allowAnonymousToQuery",!0),supportsQueryByOthers:Zt(r,"allowOthersToQuery",!0),supportsQueryGeometry:Zt(t,"supportsReturningQueryGeometry",!1),supportsResultType:Zt(i,"supportsQueryWithResultType",!1),supportsSpatialAggregationStatistics:Zt(i,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:Zt(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Zt(t,"useStandardizedQueries",!1),supportsStatistics:Zt(i,"supportsStatistics",t.supportsStatistics),supportsTopFeaturesQuery:Zt(i,"supportsTopFeaturesQuery",!1),tileMaxRecordCount:HL(t,"tileMaxRecordCount",void 0)}}function xXt(t){const e=t.advancedQueryCapabilities,i=Zt(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Zt(e,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:N4(e,"queryRelated")}}function SXt(t){return{supportsCacheHint:N4(t.advancedQueryCapabilities,"queryTopFilter")}}function TXt(t){const e=t.ownershipBasedAccessControlForFeatures,i=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:Zt(t,"allowGeometryUpdates",!0),supportsGlobalId:Zt(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Zt(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Zt(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Zt(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Zt(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Zt(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Zt(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Zt(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Zt(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:Zt(i,"supportsAsyncApplyEdits",!1),zDefault:HL(t,"zDefault",void 0)}}function CMi(t){return{operations:{supportsAppend:Zt(t,"supportsAppend",!1),supportsExportClip:Zt(t,"supportsExportClip",!1),supportsExportFrameset:Zt(t,"supportsExportFrameset",!1),supportsMensuration:Zt(t,"supportsMensuration",!1),supportsUpdate:Zt(t,"supportsUpdate",!1)},query:{supportsCoverageQuery:t?.playbackInfo?.klv["0601"]??!1}}}let X_=class extends ms(we){constructor(e){super(e),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(e){if(!e)return null;const i={};for(const r of Object.keys(e))i[r]=S9(e[r]);return i}writeDomains(e,i){if(!e)return;const r={};for(const s of Object.keys(e))e[s]&&(r[s]=e[s]?.toJSON());i.domains=r}};d([m({type:Number,json:{write:!0}})],X_.prototype,"code",void 0),d([m({type:Object,json:{write:!0}})],X_.prototype,"defaultValues",void 0),d([m({json:{write:!0}})],X_.prototype,"domains",void 0),d([Le("domains")],X_.prototype,"readDomains",null),d([Ve("domains")],X_.prototype,"writeDomains",null),d([m({type:String,json:{write:!0}})],X_.prototype,"name",void 0),X_=d([N("esri.layers.support.Subtype")],X_);const EXt=X_,CXt=t=>{let e=class extends t{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(ct.ofType(My)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=Je.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.version=void 0}get authenticationTriggerEvent(){if(!this.url)return null;const{capabilities:i}=this;if(i){const{query:s,operations:n,editing:o}=i;if(!s.supportsQueryByOthers||!s.supportsQueryByAnonymous||n.supportsEditing&&!(o.supportsUpdateByOthers&&o.supportsUpdateByAnonymous&&o.supportsDeleteByOthers&&o.supportsDeleteByAnonymous))return"load"}if(this.userHasUpdateItemPrivileges){if(aXt(this))return"load";if(this.hasUpdateItemRestrictions)return i.operations.supportsQuery?"editing":"load"}if(this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions)return"editing";const r=this.editFieldsInfo;return(r?.creatorField||r?.editorField)&&i?.operations.supportsEditing?"editing":null}readCapabilitiesFromService(i,r){return uqe(r,this.url)}readEditingInfo(i,r){const{editingInfo:s}=r;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}get effectiveCapabilities(){const i=this.capabilities;if(!i)return null;const r=ee(i),{operations:s,editing:n}=r;return b6(this)?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),r):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,r):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),r)}readGlobalIdFieldFromService(i,r){return aqe(r)}get hasFullEditingRestrictions(){const i=this.capabilities;if(!i||b6(this))return!1;const{operations:r,editing:s}=i;return r.supportsEditing&&!(r.supportsAdd&&r.supportsDelete&&r.supportsUpdate&&s.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const i=this.capabilities;if(!i)return!1;const{operations:r,editing:s}=i;return b6(this)?!r.supportsQuery:!(r.supportsAdd&&r.supportsDelete&&r.supportsEditing&&r.supportsQuery&&r.supportsUpdate&&s.supportsDeleteByOthers&&s.supportsGeometryUpdate&&s.supportsUpdateByOthers)}readIsTableFromService(i,r){return r.type==="Table"}readMaxScale(i,r){return r.effectiveMaxScale||i||0}readMinScale(i,r){return r.effectiveMinScale||i||0}readObjectIdFieldFromService(i,r){return lqe(r)}readServiceDefinitionExpression(i,r){return r.definitionQuery||r.definitionExpression}set url(i){if(i==null)return void this._set("url",i);const r=ant({layer:this,url:i,nonStandardUrlAllowed:!0,logger:oe.getLogger(this)});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,s,n){lnt(this,i,null,r,n)}readVersion(i,r){return iXt(r)}};return d([m({readOnly:!0})],e.prototype,"authenticationTriggerEvent",null),d([m({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),d([m({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),d([Le("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),d([m(bj("dateFieldsTimeReference"))],e.prototype,"dateFieldsTimeZone",void 0),d([m({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),d([m({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),d([m({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),d([m({readOnly:!0,type:FYt})],e.prototype,"editFieldsInfo",void 0),d([m({readOnly:!0})],e.prototype,"editingInfo",void 0),d([Le("editingInfo")],e.prototype,"readEditingInfo",null),d([m({readOnly:!0})],e.prototype,"effectiveCapabilities",null),d([m((()=>{const i=ee(NYt),r=i.json.origins;return r["web-map"]={read:!1,write:!1},r["portal-item"]={read:!1,write:!1},i})())],e.prototype,"elevationInfo",void 0),d([m({type:dXt,json:{name:"layerDefinition.floorInfo",write:!0,origins:{"web-scene":{name:"layerDefinition.floorInfo",write:{enabled:!0,layerContainerTypes:xl}}}}})],e.prototype,"floorInfo",void 0),d([m({type:lr,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),d([m()],e.prototype,"gdbVersion",void 0),d([m({readOnly:!0,type:hXt,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),d([m({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:Zoe.read}}}})],e.prototype,"geometryType",void 0),d([m({type:String})],e.prototype,"globalIdField",void 0),d([Le("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),d([m({readOnly:!0})],e.prototype,"hasFullEditingRestrictions",null),d([m({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),d([m({readOnly:!0})],e.prototype,"hasUpdateItemRestrictions",null),d([m({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),d([m({readOnly:!0,type:$x})],e.prototype,"heightModelInfo",void 0),d([m({type:Date})],e.prototype,"historicMoment",void 0),d([m({type:ct.ofType(My),readOnly:!0})],e.prototype,"indexes",void 0),d([m({readOnly:!0})],e.prototype,"isTable",void 0),d([Le("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),d([m({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),d([m(sqe)],e.prototype,"maxScale",void 0),d([Le("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),d([m(rqe)],e.prototype,"minScale",void 0),d([Le("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),d([m({type:String})],e.prototype,"objectIdField",void 0),d([Le("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),d([m(bj("preferredTimeReference"))],e.prototype,"preferredTimeZone",void 0),d([m({type:[pXt],readOnly:!0})],e.prototype,"relationships",void 0),d([m({type:Boolean})],e.prototype,"returnM",void 0),d([m({type:Boolean})],e.prototype,"returnZ",void 0),d([m({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),d([m({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),d([Le("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),d([m({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),d([m()],e.prototype,"sourceJSON",void 0),d([m({type:Je,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),d([m({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),d([m({type:[EXt],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"subtypes",void 0),d([m({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),d([m(eqe)],e.prototype,"url",null),d([Ve("url")],e.prototype,"writeUrl",null),d([m({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),d([Le("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=d([N("esri.layers.mixins.FeatureLayerBase")],e),e};let RR=class extends ms(we){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};d([m({type:String,json:{write:!0}})],RR.prototype,"expression",void 0),d([m({type:String,json:{write:!0}})],RR.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],RR.prototype,"returnType",void 0),RR=d([N("esri.layers.support.ExpressionInfo")],RR);const ife=RR;var Qoe;let Z_=Qoe=class extends we{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new Qoe({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:ee(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};d([m({type:Boolean,json:{write:!0}})],Z_.prototype,"isAutoGenerated",void 0),d([m({type:String,json:{write:!0}})],Z_.prototype,"name",void 0),d([m({type:String,json:{write:!0}})],Z_.prototype,"alias",void 0),d([m({type:String,json:{write:!0}})],Z_.prototype,"onStatisticField",void 0),d([m({type:ife,json:{write:!0}})],Z_.prototype,"onStatisticExpression",void 0),d([m({type:String,json:{write:!0}})],Z_.prototype,"statisticType",void 0),Z_=Qoe=d([N("esri.layers.support.AggregateField")],Z_);const oC=Z_;let Hw=class extends we{constructor(){super(...arguments),this.type=null}};d([m({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],Hw.prototype,"type",void 0),Hw=d([N("esri.layers.support.FeatureReduction")],Hw);var Koe;let jb=Koe=class extends we{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?use(e.value):t}writeExpression(t,e,i){this.value!=null&&(t=use(this.value)),t!=null&&(e[i]=t)}clone(){return new Koe({expression:this.expression,title:this.title,value:this.value})}};d([m({type:String,json:{write:{writerEnsuresNonNull:!0}}})],jb.prototype,"expression",void 0),d([Le("expression",["expression","value"])],jb.prototype,"readExpression",null),d([Ve("expression")],jb.prototype,"writeExpression",null),d([m({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],jb.prototype,"title",void 0),d([m({json:{read:!1,write:!1}})],jb.prototype,"value",void 0),jb=Koe=d([N("esri.layers.support.LabelExpressionInfo")],jb);const hqe=jb;var eae;const lz=new ur({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function cz(t,e,i){return{enabled:!pPe(i?.layer)}}function dqe(t){return!t||t.origin!=="service"&&t.layer?.type!=="map-image"}function MXt(t){return t?.type==="map-image"}function pqe(t){return!!MXt(t)&&!!t.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}function AXt(t){return dqe(t)||pqe(t?.layer)}let mo=eae=class extends we{static evaluateWhere(t,e){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(t==null)return!0;const r=t.split(" ");if(r.length===3)return i(e[r[0]],r[1],r[2]);if(r.length===7){const s=i(e[r[0]],r[1],r[2]),n=r[3],o=i(e[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=WOt,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const i=e.labelExpressionInfo;if(!i||!i.value&&!i.expression)return t}writeLabelExpression(t,e,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=HSt(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=Uhe(this.labelExpressionInfo.expression);r&&(t="["+r+"]")}}t!=null&&(e[i]=t)}writeLabelExpressionInfo(t,e,i,r){if(t==null&&this.labelExpression!=null&&dqe(r))t=new hqe({expression:this.getLabelExpressionArcade()});else if(!t)return;const s=t.toJSON(r);s.expression&&(e[i]=s)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return e7(this)}getLabelExpressionArcade(){return qSt(this)}getLabelExpressionSingleField(){return WSt(this)}hash(){return JSON.stringify(this)}clone(){return new eae({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:ee(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:ee(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};d([m({type:String,json:{write:!0}})],mo.prototype,"name",void 0),d([m({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:cz}}}}})],mo.prototype,"allowOverrun",void 0),d([m({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:cz}}}}})],mo.prototype,"deconflictionStrategy",void 0),d([m({type:String,json:{write:{overridePolicy(t,e,i){return this.labelExpressionInfo&&i?.origin==="service"&&pqe(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],mo.prototype,"labelExpression",void 0),d([Le("labelExpression")],mo.prototype,"readLabelExpression",null),d([Ve("labelExpression")],mo.prototype,"writeLabelExpression",null),d([m({type:hqe,json:{write:{overridePolicy:(t,e,i)=>AXt(i)?{allowNull:!0}:{enabled:!1}}}})],mo.prototype,"labelExpressionInfo",void 0),d([Ve("labelExpressionInfo")],mo.prototype,"writeLabelExpressionInfo",null),d([m({type:lz.apiValues,json:{type:lz.jsonValues,read:lz.read,write:lz.write}})],mo.prototype,"labelPlacement",void 0),d([m({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],mo.prototype,"labelPosition",void 0),d([m({type:Number})],mo.prototype,"maxScale",void 0),d([Ve("maxScale")],mo.prototype,"writeMaxScale",null),d([m({type:Number})],mo.prototype,"minScale",void 0),d([Ve("minScale")],mo.prototype,"writeMinScale",null),d([m({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:cz}}}}})],mo.prototype,"repeatLabel",void 0),d([m({type:Number,cast:Nr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:cz}}}}})],mo.prototype,"repeatLabelDistance",void 0),d([m({types:Qft,json:{origins:{"web-scene":{types:Kft,write:xxe,default:null}},write:xxe,default:null}})],mo.prototype,"symbol",void 0),d([m({type:Boolean,json:{write:!0}})],mo.prototype,"useCodedValues",void 0),d([m({type:String,json:{write:!0}})],mo.prototype,"where",void 0),mo=eae=d([N("esri.layers.support.LabelClass")],mo);const L4=mo;var tae;let Rc=tae=class extends Hw{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=null,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.size=Nr("12px"),this.fields=[],this.renderer=null}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());ja(i,r,e)}readRenderer(t,e,i){const r=e.drawingInfo?.renderer;return r?_I(r,e,i)??void 0:G7(e,i)}clone(){return new tae({fields:ee(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:ee(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:ee(this.popupTemplate),renderer:ee(this.renderer),binType:ee(this.binType),size:this.size})}};d([Nt({binning:"binning"})],Rc.prototype,"type",void 0),d([Nt({geohash:"geohash",square:"square"}),m({type:["geohash","square"]})],Rc.prototype,"binType",void 0),d([m({type:Number,json:{write:!0}})],Rc.prototype,"fixedBinLevel",void 0),d([m({type:[L4],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Rc.prototype,"labelingInfo",void 0),d([m(V7)],Rc.prototype,"labelsVisible",void 0),d([m({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Rc.prototype,"maxScale",void 0),d([m(z7)],Rc.prototype,"popupEnabled",void 0),d([m({type:VI,json:{name:"popupInfo",write:!0}})],Rc.prototype,"popupTemplate",void 0),d([m({type:Number,cast:t=>t==="auto"?t:Nr(t)})],Rc.prototype,"size",void 0),d([m({type:[oC],json:{write:!0}})],Rc.prototype,"fields",void 0),d([Ve("fields")],Rc.prototype,"writeFields",null),d([m({types:$4,json:{write:{target:"drawingInfo.renderer"}}})],Rc.prototype,"renderer",void 0),d([Le("renderer",["drawingInfo.renderer"])],Rc.prototype,"readRenderer",null),Rc=tae=d([N("esri.layers.support.FeatureReductionBinning")],Rc);const fqe=Rc;var iae;function jEe(t){return t.type==="simple"&&!t.visualVariables?.length}let la=iae=class extends we{constructor(t){super(t),this.type="cluster",this.clusterRadius=Nr("80px"),this.clusterMinSize=Nr("12px"),this.clusterMaxSize=Nr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=[]}readRenderer(t,e,i){const r=e.drawingInfo?.renderer;return r?.authoringInfo?.isAutoGenerated?null:r?jEe(r)?null:_I(r,e,i)??void 0:G7(e,i)}readSymbol(t,e,i){const r=e.drawingInfo?.renderer;return r?.authoringInfo?.isAutoGenerated?null:r&&jEe(r)?_I(r,e,i)?.symbol:null}writeSymbol(t,e,i,r){const s=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||s){const n=new l$({symbol:t});e.drawingInfo={renderer:n.write({},r)}}}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());ja(i,r,e)}readFields(t,e,i){return t.filter(r=>!r.isAutoGenerated).map(r=>oC.fromJSON(r))}clone(){return new iae({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:ee(this.labelingInfo),labelsVisible:this.labelsVisible,fields:ee(this.fields),maxScale:this.maxScale,renderer:ee(this.renderer),symbol:ee(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:ee(this.popupTemplate)})}};d([m({type:["cluster"],readOnly:!0,json:{write:!0}})],la.prototype,"type",void 0),d([m({type:Number,cast:t=>t==="auto"?t:Nr(t),json:{write:!0}})],la.prototype,"clusterRadius",void 0),d([m({type:Number,cast:Nr,json:{write:!0}})],la.prototype,"clusterMinSize",void 0),d([m({type:Number,cast:Nr,json:{write:!0}})],la.prototype,"clusterMaxSize",void 0),d([m({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],la.prototype,"maxScale",void 0),d([m(z7)],la.prototype,"popupEnabled",void 0),d([m({type:VI,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],la.prototype,"popupTemplate",void 0),d([m({types:$4,json:{write:{target:"drawingInfo.renderer"}}})],la.prototype,"renderer",void 0),d([Le("renderer",["drawingInfo.renderer"])],la.prototype,"readRenderer",null),d([m({types:Zft})],la.prototype,"symbol",void 0),d([Le("symbol",["drawingInfo.renderer"])],la.prototype,"readSymbol",null),d([Ve("symbol")],la.prototype,"writeSymbol",null),d([m({type:[L4],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],la.prototype,"labelingInfo",void 0),d([m(V7)],la.prototype,"labelsVisible",void 0),d([m({type:[oC],json:{write:!0}})],la.prototype,"fields",void 0),d([Ve("fields")],la.prototype,"writeFields",null),d([Le("fields")],la.prototype,"readFields",null),la=iae=d([N("esri.layers.support.FeatureReductionCluster")],la);const mqe=la;var rae;let w6=rae=class extends Hw{constructor(t){super(t),this.type="selection"}clone(){return new rae}};d([m({type:["selection"]})],w6.prototype,"type",void 0),w6=rae=d([N("esri.layers.support.FeatureReductionSelection")],w6);const HEe=w6,qEe={key:"type",base:Hw,typeMap:{cluster:mqe,binning:fqe}},RXt={types:{key:"type",base:Hw,typeMap:{selection:HEe,cluster:mqe,binning:fqe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:qEe},"portal-item":{types:qEe},"web-scene":{types:{key:"type",base:Hw,typeMap:{selection:HEe}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:xl}}}}},oA={Base64:0,Hex:1,String:2,Raw:3},iO=8,gqe=(1<<iO)-1;function Ew(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function PXt(t){const e=[];for(let i=0,r=t.length*iO;i<r;i+=iO)e[i>>5]|=(t.charCodeAt(i/iO)&gqe)<<i%32;return e}function OXt(t){const e=[];for(let i=0,r=32*t.length;i<r;i+=iO)e.push(String.fromCharCode(t[i>>5]>>>i%32&gqe));return e.join("")}function IXt(t){const e="0123456789abcdef",i=[];for(let r=0,s=4*t.length;r<s;r++)i.push(e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15));return i.join("")}function $Xt(t){const e="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(let s=0,n=4*t.length;s<n;s+=3){const o=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*t.length?r.push(e):r.push(i.charAt(o>>6*(3-a)&63))}return r.join("")}function NXt(t,e){return t<<e|t>>>32-e}function j7(t,e,i,r,s,n){return Ew(NXt(Ew(Ew(e,t),Ew(r,n)),s),i)}function vc(t,e,i,r,s,n,o){return j7(e&i|~e&r,t,e,s,n,o)}function bc(t,e,i,r,s,n,o){return j7(e&r|i&~r,t,e,s,n,o)}function wc(t,e,i,r,s,n,o){return j7(e^i^r,t,e,s,n,o)}function xc(t,e,i,r,s,n,o){return j7(i^(e|~r),t,e,s,n,o)}function LXt(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let i=1732584193,r=-271733879,s=-1732584194,n=271733878;for(let o=0;o<t.length;o+=16){const a=i,l=r,c=s,u=n;i=vc(i,r,s,n,t[o],7,-680876936),n=vc(n,i,r,s,t[o+1],12,-389564586),s=vc(s,n,i,r,t[o+2],17,606105819),r=vc(r,s,n,i,t[o+3],22,-1044525330),i=vc(i,r,s,n,t[o+4],7,-176418897),n=vc(n,i,r,s,t[o+5],12,1200080426),s=vc(s,n,i,r,t[o+6],17,-1473231341),r=vc(r,s,n,i,t[o+7],22,-45705983),i=vc(i,r,s,n,t[o+8],7,1770035416),n=vc(n,i,r,s,t[o+9],12,-1958414417),s=vc(s,n,i,r,t[o+10],17,-42063),r=vc(r,s,n,i,t[o+11],22,-1990404162),i=vc(i,r,s,n,t[o+12],7,1804603682),n=vc(n,i,r,s,t[o+13],12,-40341101),s=vc(s,n,i,r,t[o+14],17,-1502002290),r=vc(r,s,n,i,t[o+15],22,1236535329),i=bc(i,r,s,n,t[o+1],5,-165796510),n=bc(n,i,r,s,t[o+6],9,-1069501632),s=bc(s,n,i,r,t[o+11],14,643717713),r=bc(r,s,n,i,t[o],20,-373897302),i=bc(i,r,s,n,t[o+5],5,-701558691),n=bc(n,i,r,s,t[o+10],9,38016083),s=bc(s,n,i,r,t[o+15],14,-660478335),r=bc(r,s,n,i,t[o+4],20,-405537848),i=bc(i,r,s,n,t[o+9],5,568446438),n=bc(n,i,r,s,t[o+14],9,-1019803690),s=bc(s,n,i,r,t[o+3],14,-187363961),r=bc(r,s,n,i,t[o+8],20,1163531501),i=bc(i,r,s,n,t[o+13],5,-1444681467),n=bc(n,i,r,s,t[o+2],9,-51403784),s=bc(s,n,i,r,t[o+7],14,1735328473),r=bc(r,s,n,i,t[o+12],20,-1926607734),i=wc(i,r,s,n,t[o+5],4,-378558),n=wc(n,i,r,s,t[o+8],11,-2022574463),s=wc(s,n,i,r,t[o+11],16,1839030562),r=wc(r,s,n,i,t[o+14],23,-35309556),i=wc(i,r,s,n,t[o+1],4,-1530992060),n=wc(n,i,r,s,t[o+4],11,1272893353),s=wc(s,n,i,r,t[o+7],16,-155497632),r=wc(r,s,n,i,t[o+10],23,-1094730640),i=wc(i,r,s,n,t[o+13],4,681279174),n=wc(n,i,r,s,t[o],11,-358537222),s=wc(s,n,i,r,t[o+3],16,-722521979),r=wc(r,s,n,i,t[o+6],23,76029189),i=wc(i,r,s,n,t[o+9],4,-640364487),n=wc(n,i,r,s,t[o+12],11,-421815835),s=wc(s,n,i,r,t[o+15],16,530742520),r=wc(r,s,n,i,t[o+2],23,-995338651),i=xc(i,r,s,n,t[o],6,-198630844),n=xc(n,i,r,s,t[o+7],10,1126891415),s=xc(s,n,i,r,t[o+14],15,-1416354905),r=xc(r,s,n,i,t[o+5],21,-57434055),i=xc(i,r,s,n,t[o+12],6,1700485571),n=xc(n,i,r,s,t[o+3],10,-1894986606),s=xc(s,n,i,r,t[o+10],15,-1051523),r=xc(r,s,n,i,t[o+1],21,-2054922799),i=xc(i,r,s,n,t[o+8],6,1873313359),n=xc(n,i,r,s,t[o+15],10,-30611744),s=xc(s,n,i,r,t[o+6],15,-1560198380),r=xc(r,s,n,i,t[o+13],21,1309151649),i=xc(i,r,s,n,t[o+4],6,-145523070),n=xc(n,i,r,s,t[o+11],10,-1120210379),s=xc(s,n,i,r,t[o+2],15,718787259),r=xc(r,s,n,i,t[o+9],21,-343485551),i=Ew(i,a),r=Ew(r,l),s=Ew(s,c),n=Ew(n,u)}return[i,r,s,n]}function yqe(t,e=oA.Hex){const i=e||oA.Base64,r=LXt(PXt(t),t.length*iO);switch(i){case oA.Raw:return r;case oA.Hex:return IXt(r);case oA.String:return OXt(r);case oA.Base64:return $Xt(r)}}const DXt=()=>oe.getLogger("esri.views.2d.layers.support.clusterUtils");ae.add("esri-cluster-arcade-enabled",!0);const FXt=ae("esri-cluster-arcade-enabled"),kXt=new Set(["simple-line","simple-fill","picture-fill"]);function WEe(t,e){let i=e.clone();if(!UXt(i))return i;if(e.getSymbols().some(r=>kXt.has(r.type))&&(i=new l$({symbol:new $0})),i.authoringInfo||(i.authoringInfo=new qpe),i.authoringInfo.isAutoGenerated=!0,"visualVariables"in i){const r=(i.visualVariables||[]).filter(s=>s.valueExpression!=="$view.scale");r.forEach(s=>{s.type==="rotation"?s.field?s.field=XS(t,s.field,"avg_angle","number"):s.valueExpression&&(s.field=R3(t,s.valueExpression,"avg_angle","number"),s.valueExpression=null):s.normalizationField?(s.field=XS(t,s.field,"avg_norm","number",s.normalizationField),s.normalizationField=null):s.field?s.field=XS(t,s.field,"avg","number"):s.valueExpression&&(s.field=R3(t,s.valueExpression,"avg","number"),s.valueExpression=null)}),i.visualVariables=r}switch(i.type){case"simple":break;case"pie-chart":for(const r of i.attributes)r.field?r.field=XS(t,r.field,"sum","number"):r.valueExpression&&(r.field=R3(t,r.valueExpression,"sum","number"),r.valueExpression=null);break;case"unique-value":i.field?i.field=XS(t,i.field,"mode","string"):i.valueExpression&&(i.field=R3(t,i.valueExpression,"mode","string"),i.valueExpression=null);break;case"class-breaks":i.normalizationField?(i.field=XS(t,i.field,"avg_norm","number",i.normalizationField),i.normalizationField=null):i.field?i.field=XS(t,i.field,"avg","number"):i.valueExpression&&(i.field=R3(t,i.valueExpression,"avg","number"),i.valueExpression=null)}return i}const UXt=t=>{const e=i=>DXt().error(new j("Unsupported-renderer",i,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const i=t.normalizationType;if(i!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${i}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!FXt){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(i=>!(!("valueExpression"in i)||!i.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function BXt(t,e,i){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const r=i,s="field",n=e.toLowerCase()+",norm:"+s+","+r.toLowerCase();return"cluster_avg_"+yqe(n)}}}function R3(t,e,i,r){const s=yqe(e),n=i==="mode"?`cluster_type_${s}`:i==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return t.some(o=>o.name===n)||t.push(new oC({name:n,isAutoGenerated:!0,onStatisticExpression:new ife({expression:e,returnType:r}),statisticType:i})),n}function XS(t,e,i,r,s){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const n=BXt(i,e,s);return t.some(o=>o.name===n)||(i==="avg_norm"?t.push(new oC({name:n,isAutoGenerated:!0,onStatisticExpression:new ife({expression:`$feature.${e} / $feature.${s}`,returnType:r}),statisticType:"avg"})):t.push(new oC({name:n,isAutoGenerated:!0,onStatisticField:e,statisticType:i}))),n}const _qe=t=>{let e=class extends t{constructor(...i){super(...i),this.addHandles(_e(()=>this.renderer,()=>{if(this.featureReduction){const r=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",r)}},Mr))}set featureReduction(i){const r=this._normalizeFeatureReduction(i);this._set("featureReduction",r)}set renderer(i){}_withClusterVariable(i,r,s){const n=i.clone();return"visualVariables"in n&&(n.visualVariables||(n.visualVariables=[]),n.visualVariables.some(o=>o.type==="size")||n.visualVariables.push(new Wpe({field:"cluster_count",stops:[new n6({value:1}),new n6({useMinValue:!0,size:r}),new n6({useMaxValue:!0,size:s})]}))),n}_normalizeFeatureReduction(i){if(i?.type!=="cluster")return i;const r=i.clone(),s=[new oC({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(r.fields??[]).filter(h=>!h.isAutoGenerated),o=i.renderer&&!i.renderer.authoringInfo?.isAutoGenerated,{clusterMinSize:a,clusterMaxSize:l}=r;if(o){r.fields=[...s,...n];const h=this._withClusterVariable(r.renderer,a,l);return r.effectiveFeatureRenderer=h,r.effectiveClusterRenderer=h,r}if(i.symbol){if(r.fields=[...s,...n],r.renderer=null,!this.renderer)return r.effectiveFeatureRenderer=null,r.effectiveClusterRenderer=null,r;const h=WEe(s,this.renderer),p=this._withClusterVariable(h,a,l),f="visualVariables"in p&&p.visualVariables?p.visualVariables:[],g=new l$({symbol:i.symbol,visualVariables:f});return r.fields=[...s,...n],r.effectiveFeatureRenderer=p,r.effectiveClusterRenderer=g,r}if(!this.renderer)return i;const c=WEe(s,this.renderer);r.fields=[...s,...n],r.renderer=c;const u=this._withClusterVariable(c,a,l);return r.effectiveFeatureRenderer=u,r.effectiveClusterRenderer=u,r}};return d([m(RXt)],e.prototype,"featureReduction",null),e=d([N("esri.layers.mixins.FeatureReductionLayer")],e),e},YEe={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},XEe={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},ZEe={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},zXt={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,Voxel:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":YEe,"web-map/basemap":XEe,"web-map/tables":ZEe,"link-chart/operational-layers":{...YEe,LinkChartLayer:!0},"link-chart/basemap":XEe,"link-chart/tables":ZEe,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0}},vqe=t=>{let e=class extends t{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(i,r,s){return s?.portalItem?.type==="Group Layer"?void 0:i}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&bJe(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s,n){i&&n?.layerContainerType!=="tables"&&(r.layerType=i)}writeTitle(i,r){r.title=i??"Layer"}readTimeExtent(i){return i?wl.fromArray(i):null}writeTimeExtent(i,r,s,n){i&&n.layerContainerType!=="tables"&&(i.isEmpty?n?.messages&&n.messages.push(new j("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):r[s]=i.toArray())}read(i,r){r&&(r.layer=this),uRe(this,i,s=>super.read(i,s),r)}write(i,r){if(!this.persistenceEnabled&&!r?.ignorePersistenceEnabled)return null;if(r?.origin){const o=`${r.origin}/${r.layerContainerType||"operational-layers"}`;let l=!!zXt[o]?.[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&o==="web-scene/operational-layers"&&(l=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&o==="web-map/operational-layers"&&(l=!1),!l)return r.messages?.push(new j("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${o}'`,{layer:this})),null}const s=super.write(i,{...r,layer:this}),n=!!r&&!!r.messages&&!!r.messages.filter(o=>o instanceof j&&o.name==="web-document-write:property-required").length;return pO(s?.url)?(r?.messages?.push(new j("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return d([m({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),d([Le("id",["id"])],e.prototype,"readId",null),d([m(nqe)],e.prototype,"listMode",void 0),d([Ve("listMode")],e.prototype,"writeListMode",null),d([m({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:xl}}}}})],e.prototype,"operationalLayerType",void 0),d([Ve("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),d([m(Woe)],e.prototype,"opacity",void 0),d([m({type:Boolean,readOnly:!1})],e.prototype,"persistenceEnabled",void 0),d([m({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),d([Ve("title"),Ve(["web-scene"],"title")],e.prototype,"writeTitle",null),d([m({type:wl,json:{origins:{"web-scene":{write:{layerContainerTypes:xl}}}}})],e.prototype,"visibilityTimeExtent",void 0),d([Le("visibilityTimeExtent")],e.prototype,"readTimeExtent",null),d([Ve(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[cr,MI]]}})],e.prototype,"writeTimeExtent",null),d([m({type:Boolean,json:{origins:{"web-scene":{name:"visibility",write:{enabled:!0,layerContainerTypes:xl}}},name:"visibility",write:!0}})],e.prototype,"visible",void 0),e=d([N("esri.layers.mixins.OperationalLayer")],e),e};var sae;const uz=new ur({asc:"ascending",desc:"descending"});let PR=sae=class extends we{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new sae({field:this.field,valueExpression:this.valueExpression,order:this.order})}};d([m({type:String,json:{write:!0}})],PR.prototype,"field",void 0),d([m({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],PR.prototype,"valueExpression",void 0),d([m({type:uz.apiValues,json:{type:uz.jsonValues,read:uz.read,write:uz.write}})],PR.prototype,"order",void 0),PR=sae=d([N("esri.layers.support.OrderByInfo")],PR);const bqe=PR;function VXt(t,e,i){if(!t)return null;const r=t.find(n=>!!n.field);if(!r)return null;const s=new bqe;return s.read(r,i),[s]}function GXt(t,e,i,r){const s=t.find(n=>!!n.field);s&&ja(i,[s.toJSON()],e)}const jXt={type:[bqe],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:VXt},write:{writer:GXt}}},HXt=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return d([m(jXt)],e.prototype,"orderBy",void 0),e=d([N("esri.layers.mixins.OrderedLayer")],e),e},wqe=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Ge(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new Y2({id:r.itemId,portal:s?.portal})}writePortalItem(i,r){i?.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem?.id)try{const{load:s}=await ye(()=>import("./layersLoader-0d33e64a.js"),["./layersLoader-0d33e64a.js","./fetchService-fa9a0116.js","./portalLayers-47ed75dc.js","./associatedFeatureServiceUtils-82735909.js","./layersCreator-f0e45f92.js"],import.meta.url);return zt(r),await s({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData,layerModuleTypeMap:i.layerModuleTypeMap},r)}catch(s){throw En(s)||oe.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(pl(r),!0)))}async setUserPrivileges(i,r){if(!gr.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(r);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(i,r);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){pl(s)}}async _fetchUserPrivileges(i,r){let s=this.portalItem;if(!i||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(r);const n=i===s.id;if(n&&s.portal.user)return pye(s);let o,a;if(n)o=s.portal.url;else try{o=await fPe(this.url,r)}catch(h){pl(h)}if(!o||!FJe(o,s.portal.url))return this._fetchFallbackUserPrivileges(r);try{const h=r!=null?r.signal:null;a=await Ar?.getCredential(`${o}/sharing`,{prompt:!1,signal:h})}catch(h){pl(h)}const l=!0,c=!1,u=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:u}};try{if(n?await s.reload():(s=new Y2({id:i,portal:{url:o}}),await s.load(r)),s.portal.user)return pye(s)}catch(h){pl(h)}return{features:{edit:l,fullEdit:c},content:{updateItem:u}}}async _fetchFallbackUserPrivileges(i){let r=!0;try{r=await this._fetchUserHasEditingPrivileges(i)}catch(s){pl(s)}return{features:{edit:r,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(i){const r=this.url?Ar?.findCredential(this.url):null;if(!r)return!0;const s=hz.credential===r?hz.user:await this._fetchEditingUser(i);return hz.credential=r,hz.user=s,s?.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){const r=this.portalItem?.portal?.user;if(r)return r;const s=Ar?.findServerInfo(this.url??"");if(!s?.owningSystemUrl)return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=Mo.getDefault();if(o&&o.loaded&&Dd(o.restUrl)===Dd(n))return o.user;const a=`${n}/community/self`,l=i!=null?i.signal:null,c=await jd(qi(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?Ble.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const s=r?.portal,n=this.portalItem?.id&&(this.portalItem.portal||Mo.getDefault());return s&&n&&!_Re(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new j("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,{...r,layer:this})}};return d([m({type:Y2})],e.prototype,"portalItem",null),d([Le("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),d([Ve("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),d([m({clonable:!1})],e.prototype,"resourceReferences",void 0),d([m({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),d([m({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),d([m({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=d([N("esri.layers.mixins.PortalLayer")],e),e},hz={credential:null,user:null};let qL=class extends Fe{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};d([m()],qL.prototype,"updating",void 0),d([m()],qL.prototype,"status",void 0),qL=d([N("esri.layers.support.PublishingInfo")],qL);const qXt=qL,WXt=Symbol(),YXt=t=>{var e;let i=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const r=this._get("publishingInfo");if(r)return r;const s=new qXt;return this._checkPublishingStatus(s),s}_checkPublishingStatus(r){let o=0;const a=async c=>{let u;r.updating=!0;try{u=await this.fetchPublishingStatus()}catch{u="unavailable"}u!=="published"&&u!=="unavailable"||(r.status==="publishing"&&this.refresh(),l.remove()),r.status=u,r.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.addHandles(l)}};return e=WXt,d([m({readOnly:!0,clonable:!1})],i.prototype,"publishingInfo",null),i=d([N("esri.layers.mixins.PublishableLayer")],i),i},Cw=new ct,YD=new WeakMap;function XXt(t){JXt(t)&&Cw.push(new WeakRef(t))}function ZXt(t){const e=Cw.find(i=>i.deref()===t);e&&Cw.remove(e)}function JXt(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function xqe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:xqe(e,t%e):0}let IJ=0,dz=0;function QXt(){const t=Date.now();let e=!1;for(const i of Cw){const r=i.deref();r?r.refreshInterval&&t-(YD.get(r)??0)+5>=6e4*r.refreshInterval&&(YD.set(r,t),r.refresh(t)):e=!0}if(e)for(let i=Cw.length-1;i>=0;i--)Cw.at(i).deref()||Cw.removeAt(i)}UAe(()=>{const t=Date.now();let e=0;for(const i of Cw){const r=i.deref();r&&(e=xqe(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?YD.get(r)||YD.set(r,t):YD.delete(r))}if(e!==dz){if(dz=e,clearInterval(IJ),dz===0)return void(IJ=0);IJ=setInterval(QXt,dz)}});function OMi(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const JEe=.1,Sqe=t=>{let e=class extends t{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=CI(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||XXt(this)},()=>{})}destroy(){ZXt(this)}castRefreshInterval(i){return i>=JEe?i:i<=0?0:JEe}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){KD(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{oe.getLogger(this).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}get test(){}};return d([m({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:xl}}}}})],e.prototype,"refreshInterval",void 0),d([vi("refreshInterval")],e.prototype,"castRefreshInterval",null),d([m({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),d([m({readOnly:!0})],e.prototype,"refreshParameters",null),e=d([N("esri.layers.mixins.RefreshableLayer")],e),e},Tqe=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&KXt(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return d([m({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),d([m({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=d([N("esri.layers.mixins.ScaleRangeLayer")],e),e};function KXt(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}function QEe(t,e){return $O.fromJSON({value:t,unit:e})}let kl=class extends ms(we){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(e,i){return i.timeExtent&&Array.isArray(i.timeExtent)&&i.timeExtent.length===2?wl.fromArray(i.timeExtent):null}writeFullTimeExtent(e,i){e?.start!=null&&e.end!=null?i.timeExtent=e.toArray():i.timeExtent=null}readInterval(e,i){return i.timeInterval&&i.timeIntervalUnits?QEe(i.timeInterval,i.timeIntervalUnits):i.defaultTimeInterval&&i.defaultTimeIntervalUnits?QEe(i.defaultTimeInterval,i.defaultTimeIntervalUnits):null}writeInterval(e,i){i.timeInterval=e?.toJSON().value??null,i.timeIntervalUnits=e?.toJSON().unit??null}};d([m({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],kl.prototype,"cumulative",void 0),d([m({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],kl.prototype,"endField",void 0),d([m({type:wl,json:{write:{enabled:!0,allowNull:!0}}})],kl.prototype,"fullTimeExtent",void 0),d([Le("fullTimeExtent",["timeExtent"])],kl.prototype,"readFullTimeExtent",null),d([Ve("fullTimeExtent")],kl.prototype,"writeFullTimeExtent",null),d([m({type:Boolean,json:{write:!0}})],kl.prototype,"hasLiveData",void 0),d([m({type:$O,json:{write:{enabled:!0,allowNull:!0}}})],kl.prototype,"interval",void 0),d([Le("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],kl.prototype,"readInterval",null),d([Ve("interval")],kl.prototype,"writeInterval",null),d([m({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],kl.prototype,"startField",void 0),d([m(bj("timeReference",!0))],kl.prototype,"timeZone",void 0),d([m({type:String,json:{write:{enabled:!0,allowNull:!0}}})],kl.prototype,"trackIdField",void 0),d([m({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],kl.prototype,"useTime",void 0),d([m({type:[Date],json:{read:!1}})],kl.prototype,"stops",void 0),kl=d([N("esri.layers.support.TimeInfo")],kl);const Eqe=kl,eZt={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:xl}}},Cqe=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=wce.fromJSON(s.timeOffsetUnits);return n&&o?new $O({value:n,unit:o}):null}set timeInfo(i){hue(i,this.fieldsIndex),this._set("timeInfo",i)}};return d([m({type:wl,json:{write:!1}})],e.prototype,"timeExtent",void 0),d([m({type:$O})],e.prototype,"timeOffset",void 0),d([Le("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),d([m({value:null,type:Eqe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),d([m(eZt)],e.prototype,"useViewTime",void 0),e=d([N("esri.layers.mixins.TemporalLayer")],e),e},KEe=new ur({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let Hb=class extends ms(we){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};d([m({json:{write:!0}})],Hb.prototype,"name",void 0),d([m({json:{write:!0}})],Hb.prototype,"description",void 0),d([m({json:{read:KEe.read,write:KEe.write}})],Hb.prototype,"drawingTool",void 0),d([m({json:{write:!0}})],Hb.prototype,"prototype",void 0),d([m({json:{write:!0}})],Hb.prototype,"thumbnail",void 0),Hb=d([N("esri.layers.support.FeatureTemplate")],Hb);const rfe=Hb;let J_=class extends ms(we){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const i={};for(const r of Object.keys(e))i[r]=S9(e[r]);return i}writeDomains(e,i){const r={};for(const s of Object.keys(e))e[s]&&(r[s]=e[s]?.toJSON());i.domains=r}};d([m({json:{write:!0}})],J_.prototype,"id",void 0),d([m({json:{write:!0}})],J_.prototype,"name",void 0),d([m({json:{write:!0}})],J_.prototype,"domains",void 0),d([Le("domains")],J_.prototype,"readDomains",null),d([Ve("domains")],J_.prototype,"writeDomains",null),d([m({type:[rfe],json:{write:!0}})],J_.prototype,"templates",void 0),J_=d([N("esri.layers.support.FeatureType")],J_);const Mqe=J_;function Aqe(){return{fields:{type:[Xk],value:null,set:function(t){if(t&&ae("big-integer-warning-enabled")){const e=t.filter(i=>i.type==="big-integer"||i.type==="oid"&&(i.length||0)>=8);if(e.length){const i=e.map(r=>`'${r.name}'`).join(", ");oe.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${i}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",t)}},fieldsIndex:{readOnly:!0,get(){return PHe.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){const t=this._userOutFields;if(!t?.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const e of t)this.fieldsIndex?.has(e)||oe.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${e} found in outFields`,{layer:this,outFields:t});return due(this.fieldsIndex,t)}}}}const $J=()=>oe.getLogger("esri.layers.support.labelingInfo"),tZt=/\[([^[\]]+)\]/gi;function x6(t,e,i){return t?t.map(r=>{const s=new L4;if(s.read(r,i),s.labelExpression){const n=e.fields||e.layerDefinition?.fields||this.fields;s.labelExpression=s.labelExpression.replaceAll(tZt,(o,a)=>`[${iZt(a,n)}]`)}return s}):null}function iZt(t,e){if(!e)return t;const i=t.toLowerCase();for(let r=0;r<e.length;r++){const s=e[r].name;if(s.toLowerCase()===i)return s}return t}const rZt={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along","above-along","below-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};function LMi(t,e){const i=[];for(const r of t){const s=r.labelPlacement,n=rZt[e];if(!r.symbol)return $J().warn("No ILabelClass symbol specified."),[];if(!n)return $J().error(new j("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),[];if(n.includes(s))i.push(r);else{const o=n[0];s&&$J().warn(`Found invalid label placement type ${s} for ${e}. Defaulting to ${o}`);const a=r.clone();a.labelPlacement=o,i.push(a)}}return i}const OR=[];function sZt(t,e){if(s$e(t.url??""))return!0;const{wkid:i}=e;for(const r of OR){if((t.version??0)>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}OR.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=23301;e<=23333;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102934;e<=102955;e++)t.add(e);return t}]),OR.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),OR.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),OR.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),OR.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]);async function Rqe(t,e,i){const r=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await jd(r.populateFromStyle());if(zt(i),s.ok===!1){const n=s.error;e?.messages&&e.messages.push(new m0("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:e})),t.clear("renderer",e?.origin)}}}var nae;let IR=nae=class extends we{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new nae({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};d([m({type:[String],json:{write:!0}})],IR.prototype,"groupByFields",void 0),d([m({type:Number,json:{write:!0}})],IR.prototype,"topCount",void 0),d([m({type:[String],json:{write:!0}})],IR.prototype,"orderByFields",void 0),IR=nae=d([N("esri.rest.support.TopFilter")],IR);const nZt=IR;var oae;const eCe=new ur({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),tCe=new ur({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let gn=oae=class extends we{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new oae(ee({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};d([m({type:Boolean,json:{write:!0}})],gn.prototype,"cacheHint",void 0),d([m({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],gn.prototype,"distance",void 0),d([m({types:gC,json:{read:Vv,write:!0}})],gn.prototype,"geometry",void 0),d([m({type:Number,json:{write:!0}})],gn.prototype,"geometryPrecision",void 0),d([m({type:Number,json:{write:!0}})],gn.prototype,"maxAllowableOffset",void 0),d([m({type:Number,json:{read:{source:"resultRecordCount"}}})],gn.prototype,"num",void 0),d([m({json:{write:!0}})],gn.prototype,"objectIds",void 0),d([m({type:[String],json:{write:!0}})],gn.prototype,"orderByFields",void 0),d([m({type:[String],json:{write:!0}})],gn.prototype,"outFields",void 0),d([m({type:Je,json:{read:{source:"outSR"},write:{target:"outSR"}}})],gn.prototype,"outSpatialReference",void 0),d([m({type:String,json:{write:!0}})],gn.prototype,"resultType",void 0),d([m({json:{write:!0}})],gn.prototype,"returnGeometry",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],gn.prototype,"returnM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],gn.prototype,"returnZ",void 0),d([m({type:Number,json:{read:{source:"resultOffset"}}})],gn.prototype,"start",void 0),d([Ve("start"),Ve("num")],gn.prototype,"writeStart",null),d([m({type:String,json:{read:{source:"spatialRel",reader:eCe.read},write:{target:"spatialRel",writer:eCe.write}}})],gn.prototype,"spatialRelationship",void 0),d([m({type:wl,json:{write:!0}})],gn.prototype,"timeExtent",void 0),d([m({type:nZt,json:{write:!0}})],gn.prototype,"topFilter",void 0),d([m({type:String,json:{read:tCe.read,write:{writer:tCe.write,overridePolicy(t){return{enabled:t!=null&&this.distance!=null&&this.distance>0}}}}})],gn.prototype,"units",void 0),d([m({type:String,json:{write:!0}})],gn.prototype,"where",void 0),gn=oae=d([N("esri.rest.support.TopFeaturesQuery")],gn),gn.from=Tn(gn);const pz=gn;function Pqe({displayField:t,editFieldsInfo:e,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=cZt({editFieldsInfo:e,fields:i,objectIdField:r},n);if(!o.length)return null;const a=dZt({titleBase:s,fields:i,displayField:t}),l=hZt();return new VI({title:a,content:l,fieldInfos:o})}const oZt=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):Ept(t,e);function aZt(t,e){const i=t;return e&&(t=t.filter(r=>!e.includes(r.type))),t===i&&(t=t.slice()),t.sort(lZt),t}function lZt(t,e){return t.type==="oid"?-1:e.type==="oid"?1:iCe(t)?-1:iCe(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function cZt(t,e){const i=e?.visibleFieldNames;return aZt(t.fields??[],e?.ignoreFieldTypes||pZt).map(r=>new mue({fieldName:r.name,isEditable:Tpt(r,t),label:r.alias,format:uZt(r),visible:oZt(r,{...t,visibleFieldNames:i})}))}function uZt(t){switch(t.type){case"small-integer":case"integer":case"single":return new LV({digitSeparator:!0,places:0});case"double":return new LV({digitSeparator:!0,places:2});case"string":return Xpt(t.name)?new LV({digitSeparator:!0,places:0}):void 0;default:return}}function hZt(){return[new TF,new SF]}function dZt(t){const e=fpt(t),{titleBase:i}=t;return e?`${i}: {${e.trim()}}`:i??""}function iCe(t){return(t.name&&t.name.toLowerCase())==="name"?!0:t.alias?.toLowerCase()==="name"}const pZt=["geometry","blob","raster","guid","xml"],cu="FeatureLayer";function fz(t,e){return new j("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function rCe(t){return t&&t instanceof ct}const NJ=Aqe();function LJ(t,e,i){const r=!!i?.writeLayerSchema;return{enabled:r,ignoreOrigin:r}}let Bt=class extends CXt(_qe(JHe(YXt(PYt(qHe(HXt(Cqe(Tqe(Sqe(HHe(vqe(wqe(jq(WHe(SYt(ms(Gq))))))))))))))))){constructor(...t){super(...t),this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.resourceInfo=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=Je.WGS84,this.subtypeCode=null,this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0,this._debouncedSaveOperations=CI(async(e,i,r)=>{const{save:s,saveAs:n}=await ye(()=>import("./featureLayerUtils-9f4f6cbe.js"),["./featureLayerUtils-9f4f6cbe.js","./utils-a5240654.js","./fetchService-fa9a0116.js"],import.meta.url);switch(e){case wh.SAVE:return s(this,i);case wh.SAVE_AS:return n(this,r,i)}})}destroy(){this.source?.destroy()}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}load(t){const e=t!=null?t.signal:null;if(this.portalItem?.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(e).then(r=>this.initLayerProperties(r))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},t).catch(pl).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const r=await this._fetchFirstValidLayerId(e);r!=null&&(this.layerId=r)}if(!this.url&&!this._hasMemorySource())throw new j("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(e))}).then(()=>nXt(this,"load",t));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(t,e){return e=e.layerDefinition||e,uqe(e,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities?.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}readEditingEnabled(t,e){return this._readEditingEnabled(e,!1)}readEditingEnabledFromWebMap(t,e,i){return this._readEditingEnabled(e,!0,i)}writeEditingEnabled(t,e){this._writeEditingEnabled(t,e,!1)}writeEditingEnabledToWebMap(t,e,i,r){this._writeEditingEnabled(t,e,!0,r)}get effectiveEditingEnabled(){return oXt(this)}readIsTable(t,e){return(e=e?.layerDefinition??e).type==="Table"||!e.geometryType}writeIsTable(t,e,i,r){r?.writeLayerSchema&&ja(i,t?"Table":"Feature Layer",e)}readGlobalIdField(t,e){return aqe(e.layerDefinition||e)}readObjectIdField(t,e){return lqe(e.layerDefinition||e)}get parsedUrl(){const t=ln(this.url);return t!=null&&(this.dynamicDataSource!=null?t.path=uf(t.path,"dynamicLayer"):this.layerId!=null&&(t.path=uf(t.path,this.layerId.toString()))),t}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(t){Gj(t,this.fieldsIndex),this._set("renderer",t)}readRenderer(t,e,i){e=e.layerDefinition||e;const r=e.drawingInfo?.renderer;if(r){const s=_I(r,e,i)??void 0;return s||oe.getLogger(this).error("Failed to create renderer",{rendererDefinition:e.drawingInfo.renderer,layer:this,context:i}),s}return G7(e,i)}set source(t){const e=this._get("source");e!==t&&(rCe(e)&&this._resetMemorySource(e),rCe(t)&&this._initMemorySource(t),this._set("source",t))}castSource(t){return t?Array.isArray(t)||t instanceof ct?new sv({layer:this,items:t}):t:null}readSource(t,e){const i=Qpe.fromJSON(e.featureSet);return new sv({layer:this,items:i?.features??[]})}readTemplates(t,e){const i=e.editFieldsInfo,r=i?.creatorField,s=i?.editorField;return t=t?.map(n=>rfe.fromJSON(n)),this._fixTemplates(t,r),this._fixTemplates(t,s),t}readTitle(t,e){const i=e.layerDefinition?.name??e.name,r=e.title||e.layerDefinition?.title;if(i){const s=this.portalItem?.title;if(this.sublayerTitleMode==="item-title")return this.url?nnt(this.url,i):i;let n=i;if(!n&&this.url){const o=FI(this.url);o!=null&&(n=o.title)}return n?(this.sublayerTitleMode==="item-title-and-service-name"&&s&&s!==n&&(n=s+" - "+n),bce(n)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(t,e){return e.title||e.layerDefinition?.name}readTypeIdField(t,e){let i=(e=e.layerDefinition||e).typeIdField;if(i&&e.fields){i=i.toLowerCase();const r=e.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(t,e){t=(e=e.layerDefinition||e).types;const i=e.editFieldsInfo,r=i?.creatorField,s=i?.editorField;return t?.map(n=>(n=Mqe.fromJSON(n),this._fixTemplates(n.templates,r),this._fixTemplates(n.templates,s),n))}readVisible(t,e){return e.layerDefinition?.defaultVisibility!=null?!!e.layerDefinition.defaultVisibility:e.visibility!=null?!!e.visibility:void 0}async addAttachment(t,e){return VYt(this,t,e,cu)}async updateAttachment(t,e,i){return GYt(this,t,e,i,cu)}async applyEdits(t,e){return jYt(this,t,e)}async uploadAssets(t,e){return HYt(this,t,e)}on(t,e){return super.on(t,e)}createPopupTemplate(t){return Pqe(this,t)}async createGraphicsSource(t){if(this._hasMemorySource()&&this.source)return this.source.load({signal:t});const{default:e}=await IAe(ye(()=>import("./FeatureLayerSource-efbc64c5.js"),["./FeatureLayerSource-efbc64c5.js","./External-882ffaa7.js","./infoFor3D-a657d595.js","./MeshTransform-aee14b25.js","./editingSupport-6c57d782.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./QueryTask-0180e8e9.js","./executeForIds-4d407351.js","./query-f1663770.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js","./executeQueryJSON-10f3e1e5.js","./executeQueryPBF-4af0a7ad.js"],import.meta.url),t);return new e({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:t})}createQuery(){const t=tXt(this);t.dynamicDataSource=this.dynamicDataSource;const e=this.subtypeCode!=null?`${this.subtypeField} = ${this.subtypeCode}`:null,i=Qdt(this.definitionExpression,e);return t.where=i||"1=1",t}async deleteAttachments(t,e){return qYt(this,t,e,cu)}async fetchRecomputedExtents(t){return WYt(this,t,cu)}getFeatureType(t){return cXt(this.types,this.typeIdField,t)}getFieldDomain(t,e){const i=e?.feature,r=rXt(this,i);if(r){const n=r.domains?.[t];return n?.type==="inherited"?this._getLayerDomain(t):n}const s=this.getFeatureType(i);if(s){const n=s.domains&&s.domains[t];if(n&&n.type!=="inherited")return n}return this._getLayerDomain(t)}getField(t){return this.fieldsIndex.get(t)}async queryAttachments(t,e){return YYt(this,t,e,cu)}async queryFeatures(t,e){const i=await this.load(),r=await i.source.queryFeatures(Sh.from(t)??i.createQuery(),e);if(r?.features)for(const s of r.features)s.layer=s.sourceLayer=i;return r}async queryObjectIds(t,e){return XYt(this,t,e,cu)}async queryFeatureCount(t,e){return ZYt(this,t,e,cu)}async queryExtent(t,e){return JYt(this,t,e,cu)}async queryRelatedFeatures(t,e){return QYt(this,t,e,cu)}async queryRelatedFeaturesCount(t,e){return KYt(this,t,e,cu)}async queryTopFeatures(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopFeatures||!r?.query?.supportsTopFeaturesQuery)throw new j(cu,"Layer source does not support queryTopFeatures capability");const s=await i.queryTopFeatures(pz.from(t),e);if(s?.features)for(const n of s.features)n.layer=n.sourceLayer=this;return s}async queryTopObjectIds(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopObjectIds||!r?.query.supportsTopFeaturesQuery)throw new j(cu,"Layer source does not support queryTopObjectIds capability");return i.queryTopObjectIds(pz.from(t),e)}async queryTopFeaturesExtent(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopExtents||!r?.query?.supportsTopFeaturesQuery)throw new j(cu,"Layer source does not support queryTopExtents capability");return i.queryTopExtents(pz.from(t),e)}async queryTopFeatureCount(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopCount||!r?.query?.supportsTopFeaturesQuery)throw new j(cu,"Layer source does not support queryFeatureCount capability");return i.queryTopCount(pz.from(t),e)}read(t,e){const i=t.featureCollection;if((i||t.type==="Feature Collection")&&(this.resourceInfo=t),i){const r=i.layers;r&&r.length===1&&(super.read(r[0],e),i.showLegend!=null&&super.read({showLegend:i.showLegend},e))}super.read(t,e),e&&e.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo","dateFieldsTimeZone"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(t,e){e={...e,origin:e?.origin??void 0,writeLayerSchema:e?.writeLayerSchema??this._hasMemorySource()};const{origin:i,layerContainerType:r,messages:s}=e;if(this.dynamicDataSource)return s?.push(fz(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if((i==="web-map"||i==="web-scene")&&r!=="tables")return s?.push(fz(this,`a table source can only be written to tables, not ${r}`)),null;if(this._hasMemorySource())return s?.push(fz(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&(i==="web-map"||i==="web-scene")&&r==="tables")return s?.push(fz(this,"using a non-table source cannot be written to tables in web maps or web scenes")),null;return super.write(t,e)}clone(){if(this._hasMemorySource())throw new j(cu,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(t){return!!this.loaded&&(this.source?.type==="memory"||sZt(this,t))}async save(t){return this._debouncedSaveOperations(wh.SAVE,t)}async saveAs(t,e){return this._debouncedSaveOperations(wh.SAVE_AS,e,t)}_readEditingEnabled(t,e,i){let r=t.layerDefinition?.capabilities;return r?this._hasEditingCapability(r):(r=t.capabilities,e&&i?.origin==="web-map"&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(t){return t.toLowerCase().split(",").map(e=>e.trim()).includes("editing")}_writeEditingEnabled(t,e,i,r){if(!t){const s=this.capabilities?.operations?.supportsSync?"Query,Sync":"Query";ja("layerDefinition.capabilities",s,e),i&&!r?.writeLayerSchema&&(e.capabilities=s)}}_getLayerDomain(t){const e=this.fieldsIndex.get(t);return e?e.domain:null}_fetchFirstValidLayerId(t){return qi(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:t}).then(e=>{const i=e.data;if(i)return this.findFirstValidLayerId(i)})}async initLayerProperties(t){return this._set("source",t),t.sourceJSON&&(this.sourceJSON=t.sourceJSON,this.read(t.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Gj(this.renderer,this.fieldsIndex),hue(this.timeInfo,this.fieldsIndex),Rqe(this,{origin:"service"})}async hasDataChanged(){return eXt(this)}async fetchPublishingStatus(){const t=this.source;return t?.fetchPublishingStatus?t.fetchPublishingStatus():"unavailable"}_verifyFields(){const t=this.parsedUrl?.path??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+t+")"),this.isTable||this._hasMemorySource()||t.search(/\/FeatureServer\//i)!==-1||this.fields?.some(e=>e.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+t+")")}_fixTemplates(t,e){t&&t.forEach(i=>{const r=i.prototype?.attributes;r&&e&&delete r[e]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new j("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new j("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(t){t.forEach(e=>{e.layer=this,e.sourceLayer=this}),this.addHandles([t.on("after-add",e=>{e.item.layer=this,e.item.sourceLayer=this}),t.on("after-remove",e=>{e.item.layer=null,e.item.sourceLayer=null})],"fl-source")}_resetMemorySource(t){t.forEach(e=>{e.layer=null,e.sourceLayer=null}),this.removeHandles("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}findFirstValidLayerId(t){return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}};d([Le("service","capabilities")],Bt.prototype,"readCapabilities",null),d([m({json:{origins:{"web-scene":{write:!1}},write:!0}})],Bt.prototype,"charts",void 0),d([m({readOnly:!0})],Bt.prototype,"createQueryVersion",null),d([m({json:{read:{source:"layerDefinition.copyrightText"}}})],Bt.prototype,"copyright",void 0),d([m({json:{read:{source:"layerDefinition.displayField"}}})],Bt.prototype,"displayField",void 0),d([m({types:aE,readOnly:!0})],Bt.prototype,"defaultSymbol",void 0),d([m({type:vm})],Bt.prototype,"dynamicDataSource",void 0),d([m({type:Boolean})],Bt.prototype,"editingEnabled",null),d([Le(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Bt.prototype,"readEditingEnabled",null),d([Le("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Bt.prototype,"readEditingEnabledFromWebMap",null),d([Ve(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Bt.prototype,"writeEditingEnabled",null),d([Ve("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Bt.prototype,"writeEditingEnabledToWebMap",null),d([m({readOnly:!0})],Bt.prototype,"effectiveEditingEnabled",null),d([m({...NJ.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:LJ}}}}})],Bt.prototype,"fields",void 0),d([m(NJ.fieldsIndex)],Bt.prototype,"fieldsIndex",void 0),d([m({type:_Yt,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Bt.prototype,"formTemplate",void 0),d([m({json:{read:{source:"layerDefinition.extent"}}})],Bt.prototype,"fullExtent",void 0),d([m({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:LJ,writer(t,e,i){const r=t?Zoe.toJSON(t):null;r&&ja(i,r,e)}}}},read:{source:"layerDefinition.geometryType",reader:Zoe.read}}})],Bt.prototype,"geometryType",void 0),d([m({json:{read:{source:"layerDefinition.hasM"}}})],Bt.prototype,"hasM",void 0),d([m({json:{read:{source:"layerDefinition.hasZ"}}})],Bt.prototype,"hasZ",void 0),d([m(DYt)],Bt.prototype,"id",void 0),d([m({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Bt.prototype,"infoFor3D",void 0),d([m({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Bt.prototype,"isTable",void 0),d([Le("service","isTable",["type","geometryType"]),Le("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Bt.prototype,"readIsTable",null),d([Ve("web-map","isTable")],Bt.prototype,"writeIsTable",null),d([m(V7)],Bt.prototype,"labelsVisible",void 0),d([m({type:[L4],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:x6,write:!1},"web-scene":{name:"layerDefinition.drawingInfo.labelingInfo",read:x6,write:{enabled:!0,layerContainerTypes:xl}}},name:"layerDefinition.drawingInfo.labelingInfo",read:x6,write:!0}})],Bt.prototype,"labelingInfo",void 0),d([m((()=>{const t=ee(LYt);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,i,r){ja(r,Ik(e),i)}}},t})())],Bt.prototype,"opacity",void 0),d([m(tqe)],Bt.prototype,"legendEnabled",void 0),d([m({type:["show","hide"],json:(()=>{const t=ee(nqe.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],Bt.prototype,"listMode",void 0),d([Le("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],Bt.prototype,"readGlobalIdField",null),d([m({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:LJ}}}}})],Bt.prototype,"objectIdField",void 0),d([Le("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],Bt.prototype,"readObjectIdField",null),d([m({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Bt.prototype,"operationalLayerType",void 0),d([m(NJ.outFields)],Bt.prototype,"outFields",void 0),d([m({readOnly:!0})],Bt.prototype,"parsedUrl",null),d([m({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Bt.prototype,"path",void 0),d([m(z7)],Bt.prototype,"popupEnabled",void 0),d([m({type:VI,json:{name:"popupInfo",write:!0}})],Bt.prototype,"popupTemplate",void 0),d([m({readOnly:!0})],Bt.prototype,"defaultPopupTemplate",null),d([m({types:$4,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:kHe,name:"layerDefinition.drawingInfo.renderer",write:{layerContainerTypes:xl,overridePolicy:(t,e,i)=>({ignoreOrigin:i?.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,i)=>({ignoreOrigin:i?.writeLayerSchema})}}})],Bt.prototype,"renderer",null),d([Le("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Le("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Bt.prototype,"readRenderer",null),d([m()],Bt.prototype,"resourceInfo",void 0),d([m((()=>{const t=ee(KHe);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],Bt.prototype,"screenSizePerspectiveEnabled",void 0),d([m({clonable:!1})],Bt.prototype,"source",null),d([vi("source")],Bt.prototype,"castSource",null),d([Le("portal-item","source",["featureSet"]),Le("web-map","source",["featureSet"])],Bt.prototype,"readSource",null),d([m({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],Bt.prototype,"spatialReference",void 0),d([m({type:Number})],Bt.prototype,"subtypeCode",void 0),d([m({type:[rfe]})],Bt.prototype,"templates",void 0),d([Le("templates",["editFieldsInfo","creatorField","editorField","templates"])],Bt.prototype,"readTemplates",null),d([m({type:Eqe})],Bt.prototype,"timeInfo",void 0),d([m()],Bt.prototype,"title",void 0),d([Le("service","title",["name"]),Le("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Bt.prototype,"readTitle",null),d([Le("web-map","title",["layerDefinition.name","title"])],Bt.prototype,"readTitleFromWebMap",null),d([m({type:String})],Bt.prototype,"sublayerTitleMode",void 0),d([m({json:{read:!1}})],Bt.prototype,"type",void 0),d([m({type:String})],Bt.prototype,"typeIdField",void 0),d([Le("service","typeIdField"),Le("typeIdField",["layerDefinition.typeIdField"])],Bt.prototype,"readTypeIdField",null),d([m({type:[Mqe]})],Bt.prototype,"types",void 0),d([Le("service","types",["types"]),Le("types",["layerDefinition.types"])],Bt.prototype,"readTypes",null),d([m({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Bt.prototype,"visible",void 0),d([Le("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Bt.prototype,"readVisible",null),Bt=d([N("esri.layers.FeatureLayer")],Bt);const sfe=Bt,DMi=Object.freeze(Object.defineProperty({__proto__:null,default:sfe},Symbol.toStringTag,{value:"Module"}));let Ay=class extends lg{constructor(e){super(e),this.type="csv",this.refresh=CI(async i=>{await this.load();const{extent:r,timeExtent:s}=await this._connection.invoke("refresh",i);return r&&(this.sourceJSON.extent=r),s&&(this.sourceJSON.timeInfo.timeExtent=[s.start,s.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}})}load(e){const i=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(i)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}async openPorts(){return await this.load(),this._connection.openPorts()}async queryFeatures(e,i={}){await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);return Qpe.fromJSON(r)}async queryFeaturesJSON(e,i={}){return await this.load(i),this._connection.invoke("queryFeatures",e?e.toJSON():null,i)}async queryFeatureCount(e,i={}){return await this.load(i),this._connection.invoke("queryFeatureCount",e?e.toJSON():null,i)}async queryObjectIds(e,i={}){return await this.load(i),this._connection.invoke("queryObjectIds",e?e.toJSON():null,i)}async queryExtent(e,i={}){await this.load(i);const r=await this._connection.invoke("queryExtent",e?e.toJSON():null,i);return{count:r.count,extent:lr.fromJSON(r.extent)}}async querySnapping(e,i={}){return await this.load(i),this._connection.invoke("querySnapping",e,i)}async _startWorker(e){this._connection=await N$e("CSVSourceWorker",{strategy:ae("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{url:i,delimiter:r,fields:s,latitudeField:n,longitudeField:o,spatialReference:a,timeInfo:l}=this.loadOptions,c=await this._connection.invoke("load",{url:i,customParameters:this.customParameters,parsingOptions:{delimiter:r,fields:s?.map(u=>u.toJSON()),latitudeField:n,longitudeField:o,spatialReference:a?.toJSON(),timeInfo:l?.toJSON()}},{signal:e});this.locationInfo=c.locationInfo,this.sourceJSON=c.layerDefinition,this.delimiter=c.delimiter}};d([m()],Ay.prototype,"type",void 0),d([m()],Ay.prototype,"loadOptions",void 0),d([m()],Ay.prototype,"customParameters",void 0),d([m()],Ay.prototype,"locationInfo",void 0),d([m()],Ay.prototype,"sourceJSON",void 0),d([m()],Ay.prototype,"delimiter",void 0),Ay=d([N("esri.layers.graphics.sources.CSVSource")],Ay);const fZt={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0};function kMi(t){return{renderer:{type:"simple",symbol:t==="esriGeometryPoint"||t==="esriGeometryMultipoint"?Ize:t==="esriGeometryPolyline"?$ze:Nze}}}const mZt=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let gZt=1;function UMi(t,e){if(ae("esri-csp-restrictions"))return()=>({[e]:null,...t});try{let i=`this${sCe(e)} = null;`;for(const s in t)i+=`this${sCe(s)} = ${JSON.stringify(t[s])};`;const r=new Function(`
      return class AttributesClass$${gZt++} {
        constructor() {
          ${i};
        }
      }
    `)();return()=>new r}catch{return()=>({[e]:null,...t})}}function sCe(t){return mZt.test(t)?`.${t}`:`["${t}"]`}function BMi(t={}){return[{name:"New Feature",description:"",prototype:{attributes:ee(t)}}]}function yZt(t,e){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:t},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:e,supportsDelete:e,supportsEditing:e,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:e,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:fZt,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:e,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}function nCe(t,e){throw new j(e,`CSVLayer (title: ${t.title}, id: ${t.id}) cannot be saved to a portal item`)}let La=class extends sfe{constructor(...e){super(...e),this.geometryType="point",this.capabilities=yZt(!1,!1),this.delimiter=null,this.editingEnabled=!1,this.fields=null,this.latitudeField=null,this.locationType="coordinates",this.longitudeField=null,this.operationalLayerType="CSV",this.outFields=["*"],this.path=null,this.spatialReference=Je.WGS84,this.source=null,this.type="csv"}normalizeCtorArgs(e,i){return typeof e=="string"?{url:e,...i}:e}load(e){const i=e!=null?e.signal:null,r=this.loadFromPortal({supportedTypes:["CSV"],supportsData:!1},e).catch(pl).then(async()=>this.initLayerProperties(await this.createGraphicsSource(i)));return this.addResolvingPromise(r),Promise.resolve(this)}get isTable(){return this.loaded&&this.geometryType==null}readWebMapLabelsVisible(e,i){return i.showLabels!=null?i.showLabels:!!i.layerDefinition?.drawingInfo?.labelingInfo}set url(e){if(!e)return void this._set("url",e);const i=ln(e);this._set("url",i.path),i.query&&(this.customParameters={...this.customParameters,...i.query})}async createGraphicsSource(e){const i=new Ay({loadOptions:{delimiter:this.delimiter,fields:this.fields,latitudeField:this.latitudeField??void 0,longitudeField:this.longitudeField??void 0,spatialReference:this.spatialReference??void 0,timeInfo:this.timeInfo??void 0,url:this.url},customParameters:this.customParameters??void 0});return this._set("source",i),await i.load({signal:e}),this.read({locationInfo:i.locationInfo,columnDelimiter:i.delimiter},{origin:"service",url:this.parsedUrl}),i}queryFeatures(e,i){return this.load().then(()=>this.source.queryFeatures(Sh.from(e)||this.createQuery())).then(r=>{if(r?.features)for(const s of r.features)s.layer=s.sourceLayer=this;return r})}queryObjectIds(e,i){return this.load().then(()=>this.source.queryObjectIds(Sh.from(e)||this.createQuery()))}queryFeatureCount(e,i){return this.load().then(()=>this.source.queryFeatureCount(Sh.from(e)||this.createQuery()))}queryExtent(e,i){return this.load().then(()=>this.source.queryExtent(Sh.from(e)||this.createQuery()))}read(e,i){super.read(e,i),i&&i.origin==="service"&&this.revert(["latitudeField","longitudeField"],"service")}write(e,i){return super.write(e,{...i,writeLayerSchema:!0})}clone(){throw new j("csv-layer:clone",`CSVLayer (title: ${this.title}, id: ${this.id}) cannot be cloned`)}async save(e){return nCe(this,"csv-layer:save")}async saveAs(e,i){return nCe(this,"csv-layer:save-as")}async hasDataChanged(){try{const{dataChanged:e,updates:i}=await this.source.refresh(this.customParameters);return i!=null&&this.read(i,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}_verifyFields(){}_verifySource(){}_hasMemorySource(){return!1}};d([m({readOnly:!0,json:{read:!1,write:!1}})],La.prototype,"capabilities",void 0),d([m({type:[","," ",";","|","	"],json:{read:{source:"columnDelimiter"},write:{target:"columnDelimiter",ignoreOrigin:!0}}})],La.prototype,"delimiter",void 0),d([m({readOnly:!0,type:Boolean,json:{origins:{"web-scene":{read:!1,write:!1}}}})],La.prototype,"editingEnabled",void 0),d([m({json:{read:{source:"layerDefinition.fields"},write:{target:"layerDefinition.fields"}}})],La.prototype,"fields",void 0),d([m({type:Boolean,readOnly:!0})],La.prototype,"isTable",null),d([Le("web-map","labelsVisible",["layerDefinition.drawingInfo.labelingInfo","showLabels"])],La.prototype,"readWebMapLabelsVisible",null),d([m({type:String,json:{read:{source:"locationInfo.latitudeFieldName"},write:{target:"locationInfo.latitudeFieldName",ignoreOrigin:!0}}})],La.prototype,"latitudeField",void 0),d([m({type:["show","hide"]})],La.prototype,"listMode",void 0),d([m({type:["coordinates"],json:{read:{source:"locationInfo.locationType"},write:{target:"locationInfo.locationType",ignoreOrigin:!0,isRequired:!0}}})],La.prototype,"locationType",void 0),d([m({type:String,json:{read:{source:"locationInfo.longitudeFieldName"},write:{target:"locationInfo.longitudeFieldName",ignoreOrigin:!0}}})],La.prototype,"longitudeField",void 0),d([m({type:["CSV"]})],La.prototype,"operationalLayerType",void 0),d([m()],La.prototype,"outFields",void 0),d([m({type:String,json:{origins:{"web-scene":{read:!1,write:!1}},read:!1,write:!1}})],La.prototype,"path",void 0),d([m({json:{read:!1},cast:null,type:Ay,readOnly:!0})],La.prototype,"source",void 0),d([m({json:{read:!1},value:"csv",readOnly:!0})],La.prototype,"type",void 0),d([m({json:{read:bq,write:{isRequired:!0,ignoreOrigin:!0,writer:Bv}}})],La.prototype,"url",null),La=d([N("esri.layers.CSVLayer")],La);const Oqe=La,VMi=Object.freeze(Object.defineProperty({__proto__:null,default:Oqe},Symbol.toStringTag,{value:"Module"}));var aae;let l2=aae=class extends we{constructor(){super(...arguments),this.age=null,this.ageReceived=null,this.displayCount=null,this.maxObservations=1}clone(){return new aae({age:this.age,ageReceived:this.ageReceived,displayCount:this.displayCount,maxObservations:this.maxObservations})}};d([m({type:Number,json:{write:!0}})],l2.prototype,"age",void 0),d([m({type:Number,json:{write:!0}})],l2.prototype,"ageReceived",void 0),d([m({type:Number,json:{write:!0}})],l2.prototype,"displayCount",void 0),d([m({type:Number,json:{write:!0}})],l2.prototype,"maxObservations",void 0),l2=aae=d([N("esri.layers.support.PurgeOptions")],l2);const Iqe=l2,oCe=Aqe();function aCe(t,e){return new j("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}let Cr=class extends _qe(JHe(qHe(Cqe(Tqe(Sqe(HHe(vqe(wqe(jq(WHe(ms(Gq)))))))))))){constructor(...t){super(...t),this.copyright=null,this.definitionExpression=null,this.displayField=null,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.geometryDefinition=null,this.geometryType=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.maxReconnectionAttempts=0,this.maxReconnectionInterval=20,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.operationalLayerType="ArcGISStreamLayer",this.outFields=["*"],this.popupEnabled=!0,this.popupTemplate=null,this.purgeOptions=new Iqe,this.refreshInterval=0,this.screenSizePerspectiveEnabled=!0,this.sourceJSON=null,this.spatialReference=Je.WGS84,this.type="stream",this.url=null,this.updateInterval=300,this.useViewTime=!0,this.webSocketUrl=null,this._debouncedSaveOperations=CI(async(e,i,r)=>{const{save:s,saveAs:n}=await ye(()=>import("./streamLayerUtils-9763082c.js"),["./streamLayerUtils-9763082c.js","./utils-a5240654.js"],import.meta.url);switch(e){case wh.SAVE:return s(this,i);case wh.SAVE_AS:return n(this,r,i)}})}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}load(t){if(!("WebSocket"in globalThis))return this.addResolvingPromise(Promise.reject(new j("stream-layer:websocket-unsupported","WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."))),Promise.resolve(this);const e=t!=null?t.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Stream Service","Feed"]},t).catch(pl).then(()=>this._fetchService(e))),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(t){const e=this._normalizeFeatureReduction(t);this._set("featureReduction",e)}set renderer(t){Gj(t,this.fieldsIndex),this._set("renderer",t)}readRenderer(t,e,i){e=e.layerDefinition||e;const r=e.drawingInfo?.renderer;if(r){const s=_I(r,e,i)||void 0;return s||oe.getLogger(this).error("Failed to create renderer",{rendererDefinition:e.drawingInfo.renderer,layer:this,context:i}),s}return G7(e,i)}async connect(t){const[{createConnection:e}]=await Promise.all([ye(()=>import("./createConnection-5531d4b4.js"),["./createConnection-5531d4b4.js","./query-f1663770.js","./normalizeUtils-050de560.js","./normalizeUtilsCommon-6ab3a73c.js","./pbfQueryUtils-ffe030d9.js","./pbf-b4a86cc9.js"],import.meta.url),this.load()]),i=this.geometryType?fF.toJSON(this.geometryType):null,{customParameters:r=null,definitionExpression:s=null,geometryDefinition:n=null,maxReconnectionAttempts:o=0,maxReconnectionInterval:a=20,spatialReference:l=this.spatialReference}=t||this.createConnectionParameters(),c=e(this.parsedUrl,this.spatialReference,l,i,s,n,o,a,r??void 0),u=Xw([this.on("send-message-to-socket",h=>c.sendMessageToSocket(h)),this.on("send-message-to-client",h=>c.sendMessageToClient(h))]);return c.once("destroy",u.remove),c}createConnectionParameters(){return{spatialReference:this.spatialReference,customParameters:this.customParameters,definitionExpression:this.definitionExpression,geometryDefinition:this.geometryDefinition,maxReconnectionAttempts:this.maxReconnectionAttempts,maxReconnectionInterval:this.maxReconnectionInterval}}createPopupTemplate(t){return Pqe(this,t)}createQuery(){const t=new Sh;return t.returnGeometry=!0,t.outFields=["*"],t.where=this.definitionExpression||"1=1",t}getFieldDomain(t,e){if(!this.fields)return null;let i=null;return this.fields.some(r=>(r.name===t&&(i=r.domain),!!i)),i}getField(t){return this.fieldsIndex.get(t)}serviceSupportsSpatialReference(t){return!0}sendMessageToSocket(t){this.emit("send-message-to-socket",t)}sendMessageToClient(t){this.emit("send-message-to-client",t)}async save(t){return this._debouncedSaveOperations(wh.SAVE,t)}async saveAs(t,e){return this._debouncedSaveOperations(wh.SAVE_AS,e,t)}write(t,e){const i=e?.messages;return this.webSocketUrl?(i?.push(aCe(this,"using a custom websocket connection cannot be written to web scenes and web maps")),null):this.parsedUrl?super.write(t,e):(i?.push(aCe(this,"using a client-side only connection without a url cannot be written to web scenes and web maps")),null)}async _fetchService(t){if(!this.webSocketUrl&&this.parsedUrl){if(!this.sourceJSON){const{data:e}=await qi(this.parsedUrl.path,{query:{f:"json",...this.customParameters,...this.parsedUrl.query},responseType:"json",signal:t});this.sourceJSON=e}}else{if(!this.timeInfo?.trackIdField)throw new j("stream-layer:missing-metadata","The stream layer trackIdField must be specified.");if(!this.objectIdField){const e=this.fields.find(i=>i.type==="oid")?.name;if(!e)throw new j("stream-layer:missing-metadata","The stream layer objectIdField must be specified.");this.objectIdField=e}if(!this.fields)throw new j("stream-layer:missing-metadata","The stream layer fields must be specified.");if(this.fields.some(e=>e.name===this.objectIdField)||this.fields.push(new Xk({name:this.objectIdField,alias:this.objectIdField,type:"oid"})),!this.geometryType)throw new j("stream-layer:missing-metadata","The stream layer geometryType must be specified.");this.webSocketUrl&&(this.url=this.webSocketUrl)}return this.read(this.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}),Gj(this.renderer,this.fieldsIndex),hue(this.timeInfo,this.fieldsIndex),this.objectIdField||(this.objectIdField="__esri_stream_id__"),Rqe(this,{origin:"service"})}};d([m({type:String})],Cr.prototype,"copyright",void 0),d([m({readOnly:!0})],Cr.prototype,"defaultPopupTemplate",null),d([m({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Cr.prototype,"definitionExpression",void 0),d([m({type:String})],Cr.prototype,"displayField",void 0),d([m({type:QHe})],Cr.prototype,"elevationInfo",void 0),d([m({json:{origins:{"web-map":{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-scene":{read:!1,write:!1}}}})],Cr.prototype,"featureReduction",null),d([m(oCe.fields)],Cr.prototype,"fields",void 0),d([m(oCe.fieldsIndex)],Cr.prototype,"fieldsIndex",void 0),d([m({type:lr,json:{name:"layerDefinition.definitionGeometry",write:!0}})],Cr.prototype,"geometryDefinition",void 0),d([m({type:fF.apiValues,json:{read:{reader:fF.read}}})],Cr.prototype,"geometryType",void 0),d([m(V7)],Cr.prototype,"labelsVisible",void 0),d([m({type:[L4],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:x6},write:!0}})],Cr.prototype,"labelingInfo",void 0),d([m(tqe)],Cr.prototype,"legendEnabled",void 0),d([m({type:["show","hide"],json:{origins:{"portal-item":{read:!1,write:!1}}}})],Cr.prototype,"listMode",void 0),d([m({type:cr})],Cr.prototype,"maxReconnectionAttempts",void 0),d([m({type:cr})],Cr.prototype,"maxReconnectionInterval",void 0),d([m(sqe)],Cr.prototype,"maxScale",void 0),d([m(rqe)],Cr.prototype,"minScale",void 0),d([m({type:String})],Cr.prototype,"objectIdField",void 0),d([m({value:"ArcGISStreamLayer",type:["ArcGISStreamLayer"]})],Cr.prototype,"operationalLayerType",void 0),d([m({readOnly:!0})],Cr.prototype,"outFields",void 0),d([m(z7)],Cr.prototype,"popupEnabled",void 0),d([m({type:VI,json:{name:"popupInfo",write:!0}})],Cr.prototype,"popupTemplate",void 0),d([m({type:Iqe})],Cr.prototype,"purgeOptions",void 0),d([m({json:{read:!1,write:!1}})],Cr.prototype,"refreshInterval",void 0),d([m({types:$4,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{name:"layerDefinition.drawingInfo.renderer",types:kHe,write:!0}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],Cr.prototype,"renderer",null),d([Le("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Le("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Cr.prototype,"readRenderer",null),d([m((()=>{const t=ee(KHe);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],Cr.prototype,"screenSizePerspectiveEnabled",void 0),d([m()],Cr.prototype,"sourceJSON",void 0),d([m({type:Je,json:{origins:{service:{read:{source:"spatialReference"}}}}})],Cr.prototype,"spatialReference",void 0),d([m({json:{read:!1}})],Cr.prototype,"type",void 0),d([m(eqe)],Cr.prototype,"url",void 0),d([m({type:Number})],Cr.prototype,"updateInterval",void 0),d([m({json:{read:!1,write:!1}})],Cr.prototype,"useViewTime",void 0),d([m({type:String})],Cr.prototype,"webSocketUrl",void 0),Cr=d([N("esri.layers.StreamLayer")],Cr);const nfe=Cr,GMi=Object.freeze(Object.defineProperty({__proto__:null,default:nfe},Symbol.toStringTag,{value:"Module"})),_Zt=new Oqe({spatialReference:Je.WebMercator,url:"./Zurich_ETH_Lee_EM_active_pts_WM.csv",longitudeField:"POINT_X",latitudeField:"POINT_Y"});new nfe({url:"https://us-iot.arcgis.com/bc1qjuyagnrebxvh/bc1qjuyagnrebxvh/streams/arcgis/rest/services/Zurich__ETH_Lee_EM_activefeed_WM/StreamServer"});async function $qe(t,e=[]){const i=t.createQuery();i.returnGeometry=!0,i.orderByFields=e,i.returnZ=!0;const{features:r}=await t.queryFeatures(i);return r}function vZt(t){const e=t.geometryType;if(e==="mesh"||e==="multipatch")throw new Error("Mesh and multipatch not supported");return new nfe({objectIdField:t.objectIdField,fields:[{name:"TRACKID",alias:"TrackId",type:"long"},...t.fields],timeInfo:{trackIdField:"TRACKID"},geometryType:e,updateInterval:100,renderer:t.renderer})}function bZt(t,e){const i=t.geometryType;if(i==="mesh"||i==="multipatch")throw new Error("Mesh and multipatch not supported");return new sfe({title:`${t.title} (client-side)`,fields:t.fields,objectIdField:t.objectIdField,elevationInfo:t.elevationInfo,hasZ:t.hasZ,spatialReference:t.spatialReference,geometryType:i,popupTemplate:t.popupTemplate,source:e,renderer:t.renderer,definitionExpression:"0 < people"})}var wZt=Object.defineProperty,xZt=Object.getOwnPropertyDescriptor,c$=(t,e,i,r)=>{for(var s=r>1?void 0:r?xZt(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&wZt(e,i,s),s};const SZt=7.5;let Sx=class extends Fe{constructor(t){super(t),this.timeoutId=null}get running(){return this.timeoutId!==null}start(){this.stop();let t=0;const e=Date.now();let i=null;const r=()=>{if(t<this.features.length){const s=this.features[t],n=s.getAttribute(this.timeField);i||(i=n);const o=(n-i)/SZt,l=Date.now()-e,c=o-l;if(c<0){const u=this.receptor;u&&u.sendMessageToClient({type:"features",features:[s]}),s.getObjectId(),t++,this.timeoutId=setTimeout(r)}else this.timeoutId=setTimeout(r,c)}};this.timeoutId=setTimeout(r)}stop(){const t=this.timeoutId;t&&clearTimeout(t),this.timeoutId=null}destroy(){console.log("Destroyed...")}};c$([m({constructOnly:!0})],Sx.prototype,"timeField",2);c$([m({constructOnly:!0})],Sx.prototype,"features",2);c$([m()],Sx.prototype,"receptor",2);c$([m()],Sx.prototype,"running",1);c$([m()],Sx.prototype,"timeoutId",2);Sx=c$([N()],Sx);const DJ="esri-identity-modal",FJ={base:DJ,info:`${DJ}__info`,notice:`${DJ}__notice`},TZt="ArcGIS Online";let ld=class extends DC{constructor(t,e){super(t,e),this.container=document.createElement("div"),this.error=null,this.oAuthPrompt=!1,this.open=!1,this.signingIn=!1,this.server=null,this.resource=null,this._usernameInputNode=null,this._passwordInputNode=null,document.body.appendChild(this.container)}loadDependencies(){return A4({button:()=>ye(()=>import("./calcite-button-102b9bd3.js"),["./calcite-button-102b9bd3.js","./form-29a8328a.js","./dom-783a058e.js","./guid-076c3249.js","./interactive-c2ad4bac.js","./label-c5ecabbf.js","./component-2f26ee70.js","./loadable-e7fb2c8e.js","./t9n-e07b91d6.js","./key-3e48269c.js","./observers-c305feff.js","./icon-7bc6cd13.js","./loader-3ac12c5a.js"],import.meta.url),input:()=>ye(()=>import("./calcite-input-cd12b6e2.js"),["./calcite-input-cd12b6e2.js","./input2-8db2ac6f.js","./dom-783a058e.js","./guid-076c3249.js","./form-29a8328a.js","./interactive-c2ad4bac.js","./key-3e48269c.js","./label-c5ecabbf.js","./component-2f26ee70.js","./loadable-e7fb2c8e.js","./t9n-e07b91d6.js","./observers-c305feff.js","./icon-7bc6cd13.js"],import.meta.url),label:()=>ye(()=>import("./calcite-label-26cb4a95.js"),["./calcite-label-26cb4a95.js","./label-c5ecabbf.js","./dom-783a058e.js","./guid-076c3249.js","./component-2f26ee70.js"],import.meta.url),modal:()=>ye(()=>import("./calcite-modal-68ec9b23.js"),["./calcite-modal-68ec9b23.js","./conditionalSlot-49cb3d36.js","./observers-c305feff.js","./dom-783a058e.js","./guid-076c3249.js","./focusTrapComponent-7a3bee9c.js","./loadable-e7fb2c8e.js","./openCloseComponent-dd661b34.js","./t9n-e07b91d6.js","./key-3e48269c.js","./component-2f26ee70.js","./icon-7bc6cd13.js","./loader-3ac12c5a.js","./scrim-61a9ef2a.js"],import.meta.url),notice:()=>ye(()=>import("./calcite-notice-d61d4ff2.js"),["./calcite-notice-d61d4ff2.js","./conditionalSlot-49cb3d36.js","./observers-c305feff.js","./dom-783a058e.js","./guid-076c3249.js","./loadable-e7fb2c8e.js","./t9n-e07b91d6.js","./key-3e48269c.js","./openCloseComponent-dd661b34.js","./component-2f26ee70.js","./icon-7bc6cd13.js"],import.meta.url)})}get title(){return this.commonMessages?.auth.signIn}render(){const{open:t,title:e,messages:i,signingIn:r,oAuthPrompt:s,server:n,resource:o,error:a}=this,{info:l,oAuthInfo:c,lblItem:u,invalidUser:h,noAuthService:p,lblUser:f,lblPwd:g,lblCancel:y,lblSigning:v,lblOk:b}=i;return fr("div",{class:this.classes(FJ.base,Zje())},fr("form",{bind:this,onsubmit:this._submit},fr("calcite-modal",{bind:this,open:t,outsideCloseDisabled:!0,scale:"s",widthScale:"s",onCalciteModalClose:this._cancel,onCalciteModalOpen:this._focusUsernameInput},fr("div",{slot:"header"},e),fr("div",{slot:"content"},fr("div",{class:FJ.info},Vot(s?c:l,{server:n&&/\.arcgis\.com/i.test(n)?TZt:n,resource:`(${o||u})`})),a?fr("calcite-notice",{class:FJ.notice,icon:"exclamation-mark-triangle",kind:"danger",open:!0},fr("div",{slot:"message"},a.details?.httpStatus?h:p)):null,s?null:[fr("calcite-label",null,f,fr("calcite-input",{afterCreate:w=>this._usernameInputNode=w,autocomplete:"off",bind:this,name:"username",required:!0,spellcheck:!1,type:"text",value:""})),fr("calcite-label",null,g,fr("calcite-input",{afterCreate:w=>this._passwordInputNode=w,bind:this,name:"password",required:!0,type:"password",value:""}))]),fr("calcite-button",{appearance:"outline",bind:this,onclick:this._cancel,slot:"secondary",type:"button",width:"full"},y),fr("calcite-button",{loading:!!r,slot:"primary",type:"submit",width:"full"},r?v:b))))}_focusUsernameInput(){requestAnimationFrame(()=>{this._usernameInputNode?.setFocus()})}_cancel(){this._set("signingIn",!1),this.open=!1,this._usernameInputNode&&(this._usernameInputNode.value=""),this._passwordInputNode&&(this._passwordInputNode.value=""),this.emit("cancel")}_submit(t){t.preventDefault(),this._set("signingIn",!0);const e=this.oAuthPrompt?{}:{username:this._usernameInputNode?.value,password:this._passwordInputNode?.value};this.emit("submit",e)}};d([m({readOnly:!0})],ld.prototype,"container",void 0),d([m(),iC("esri/t9n/common")],ld.prototype,"commonMessages",void 0),d([m()],ld.prototype,"error",void 0),d([m(),iC("esri/identity/t9n/identity")],ld.prototype,"messages",void 0),d([m()],ld.prototype,"oAuthPrompt",void 0),d([m()],ld.prototype,"open",void 0),d([m()],ld.prototype,"signingIn",void 0),d([m()],ld.prototype,"server",void 0),d([m({readOnly:!0})],ld.prototype,"title",null),d([m()],ld.prototype,"resource",void 0),ld=d([N("esri.identity.IdentityModal")],ld);const lCe=ld,kJ="esriJSAPIOAuth";class lae{constructor(e,i){this.oAuthInfo=null,this.storage=null,this.appId=null,this.codeVerifier=null,this.expires=null,this.refreshToken=null,this.ssl=null,this.stateUID=null,this.token=null,this.userId=null,this.oAuthInfo=e,this.storage=i,this._init()}isValid(){let e=!1;if(this.oAuthInfo&&this.userId&&(this.refreshToken||this.token)){if(this.expires==null&&this.refreshToken)e=!0;else if(this.expires){const i=Date.now();this.expires>i&&(this.expires-i)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(e=!0)}}return e}save(){if(!this.storage)return!1;const e=this._load(),i=this.oAuthInfo;if(i?.authNamespace&&i.portalUrl){let r=e[i.authNamespace];r||(r=e[i.authNamespace]={}),this.appId||(this.appId=i.appId),r[i.portalUrl]={appId:this.appId,codeVerifier:this.codeVerifier,expires:this.expires,refreshToken:this.refreshToken,ssl:this.ssl,stateUID:this.stateUID,token:this.token,userId:this.userId};try{this.storage.setItem(kJ,JSON.stringify(e))}catch(s){return console.warn(s),!1}return!0}return!1}destroy(){const e=this._load(),i=this.oAuthInfo;if(i?.appId&&i?.portalUrl&&(this.expires==null||this.expires>Date.now())&&(this.refreshToken||this.token)){const r=i.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",s=new FormData;if(s.append("f","json"),s.append("auth_token",this.refreshToken||this.token),s.append("client_id",i.appId),s.append("token_type_hint",this.refreshToken?"refresh_token":"access_token"),typeof navigator.sendBeacon=="function")navigator.sendBeacon(r,s);else{const n=new XMLHttpRequest;n.open("POST",r),n.send(s)}}if(i?.authNamespace&&i.portalUrl&&this.storage){const r=e[i.authNamespace];if(r){delete r[i.portalUrl];try{this.storage.setItem(kJ,JSON.stringify(e))}catch(s){console.log(s)}}}i&&(i._oAuthCred=null,this.oAuthInfo=null)}_init(){const e=this._load(),i=this.oAuthInfo;if(i?.authNamespace&&i.portalUrl){let r=e[i.authNamespace];r&&(r=r[i.portalUrl],r&&(this.appId=r.appId,this.codeVerifier=r.codeVerifier,this.expires=r.expires,this.refreshToken=r.refreshToken,this.ssl=r.ssl,this.stateUID=r.stateUID,this.token=r.token,this.userId=r.userId))}}_load(){let e={};if(this.storage){const i=this.storage.getItem(kJ);if(i)try{e=JSON.parse(i)}catch(r){console.warn(r)}}return e}}lae.prototype.declaredClass="esri.identity.OAuthCredential";var cae;let Ul=cae=class extends we{constructor(t){super(t),this._oAuthCred=null,this.appId=null,this.authNamespace="/",this.expiration=20160,this.flowType="auto",this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl="oauth-callback.html",this.popupWindowFeatures="height=490,width=800,resizable,scrollbars,status",this.portalUrl="https://www.arcgis.com",this.preserveUrlHash=!1,this.userId=null}clone(){return cae.fromJSON(this.toJSON())}};d([m({json:{write:!0}})],Ul.prototype,"appId",void 0),d([m({json:{write:!0}})],Ul.prototype,"authNamespace",void 0),d([m({json:{write:!0}})],Ul.prototype,"expiration",void 0),d([m({json:{write:!0}})],Ul.prototype,"flowType",void 0),d([m({json:{write:!0}})],Ul.prototype,"forceLogin",void 0),d([m({json:{write:!0}})],Ul.prototype,"forceUserId",void 0),d([m({json:{write:!0}})],Ul.prototype,"locale",void 0),d([m({json:{write:!0}})],Ul.prototype,"minTimeUntilExpiration",void 0),d([m({json:{write:!0}})],Ul.prototype,"popup",void 0),d([m({json:{write:!0}})],Ul.prototype,"popupCallbackUrl",void 0),d([m({json:{write:!0}})],Ul.prototype,"popupWindowFeatures",void 0),d([m({json:{write:!0}})],Ul.prototype,"portalUrl",void 0),d([m({json:{write:!0}})],Ul.prototype,"preserveUrlHash",void 0),d([m({json:{write:!0}})],Ul.prototype,"userId",void 0),Ul=cae=d([N("esri.identity.OAuthInfo")],Ul);const uae=Ul;let cd=class extends we{constructor(t){super(t),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};d([m({json:{write:!0}})],cd.prototype,"adminTokenServiceUrl",void 0),d([m({json:{write:!0}})],cd.prototype,"currentVersion",void 0),d([m({json:{write:!0}})],cd.prototype,"hasPortal",void 0),d([m({json:{write:!0}})],cd.prototype,"hasServer",void 0),d([m({json:{write:!0}})],cd.prototype,"owningSystemUrl",void 0),d([m({json:{write:!0}})],cd.prototype,"owningTenant",void 0),d([m({json:{write:!0}})],cd.prototype,"server",void 0),d([m({json:{write:!0}})],cd.prototype,"shortLivedTokenValidity",void 0),d([m({json:{write:!0}})],cd.prototype,"tokenServiceUrl",void 0),d([m({json:{write:!0}})],cd.prototype,"webTierAuth",void 0),cd=d([N("esri.identity.ServerInfo")],cd);const UJ=cd,S6={},Nqe=t=>{const e=new gh(t.owningSystemUrl).host,i=new gh(t.server).host,r=/.+\.arcgis\.com$/i;return r.test(e)&&r.test(i)},hae=(t,e)=>!!(Nqe(t)&&e&&e.some(i=>i.test(t.server)));let T6=null,E6=null;try{T6=window.localStorage,E6=window.sessionStorage}catch{}class Lqe extends un{constructor(){super(),this._portalConfig=globalThis.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this._defaultOAuthInfo=null,this._defaultTokenValidity=60,this.dialog=null,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin=window.origin!=="null"?window.origin:window.location.origin,this._appUrlObj=ln(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthLocationParams=null,this._gwTokenUrl="/sharing/rest/generateToken",this._agsRest="/rest/services",this._agsPortal=/\/sharing(\/|$)/i,this._agsAdmin=/(https?:\/\/[^/]+\/[^/]+)\/admin\/?(\/.*)?$/i,this._adminSvcs=/\/rest\/admin\/services(\/|$)/i,this._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}],this._legacyFed=[],this._regexSDirUrl=/http.+\/rest\/services\/?/gi,this._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|KnowledgeGraphServer|MapServer|MissionServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer|VideoServer)).*/gi,this._gwUser=/http.+\/users\/([^/]+).*/i,this._gwItem=/http.+\/items\/([^/]+).*/i,this._gwGroup=/http.+\/groups\/([^/]+).*/i,this._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getPlatformSelfError=null,this._getOAuthLocationParams(),window.addEventListener("pageshow",e=>{this._pageShowHandler(e)})}registerServers(e){const i=this.serverInfos;i?(e=e.filter(r=>!this.findServerInfo(r.server)),this.serverInfos=i.concat(e)):this.serverInfos=e,e.forEach(r=>{r.owningSystemUrl&&this._portals.push(r.owningSystemUrl),r.hasPortal&&this._portals.push(r.server)})}registerOAuthInfos(e){const i=this.oAuthInfos;if(i){for(const r of e){const s=this.findOAuthInfo(r.portalUrl);s&&i.splice(i.indexOf(s),1)}this.oAuthInfos=i.concat(e)}else this.oAuthInfos=e}registerToken(e){e={...e};const i=this._sanitizeUrl(e.server),r=this._isServerRsrc(i);let s,n=this.findServerInfo(i),o=!0;n||(n=new UJ,n.server=this._getServerInstanceRoot(i),r?n.hasServer=!0:(n.tokenServiceUrl=this._getTokenSvcUrl(i),n.hasPortal=!0),this.registerServers([n])),s=this._findCredential(i),s?(delete e.server,Object.assign(s,e),o=!1):(s=new In({userId:e.userId,server:n.server??void 0,token:e.token,expires:e.expires,ssl:e.ssl,scope:r?"server":"portal"}),s.resources=[i],this.credentials.push(s)),s.emitTokenChange(!1),o||s.refreshServerTokens()}toJSON(){return nq({serverInfos:this.serverInfos.map(e=>e.toJSON()),oAuthInfos:this.oAuthInfos.map(e=>e.toJSON()),credentials:this.credentials.map(e=>e.toJSON())})}initialize(e){if(!e)return;typeof e=="string"&&(e=JSON.parse(e));const i=e.serverInfos,r=e.oAuthInfos,s=e.credentials;if(i){const n=[];i.forEach(o=>{o.server&&o.tokenServiceUrl&&n.push(o.declaredClass?o:new UJ(o))}),n.length&&this.registerServers(n)}if(r){const n=[];r.forEach(o=>{o.appId&&n.push(o.declaredClass?o:new uae(o))}),n.length&&this.registerOAuthInfos(n)}s&&s.forEach(n=>{n.server&&n.token&&n.expires&&n.expires>Date.now()&&((n=n.declaredClass?n:new In(n)).emitTokenChange(),this.credentials.push(n))})}findServerInfo(e){let i;e=this._sanitizeUrl(e);for(const r of this.serverInfos)if(this._hasSameServerInstance(r.server,e)){i=r;break}return i}findOAuthInfo(e){let i;e=this._sanitizeUrl(e);for(const r of this.oAuthInfos)if(this._hasSameServerInstance(r.portalUrl,e)){i=r;break}return i}findCredential(e,i){if(!e)return;let r;e=this._sanitizeUrl(e);const s=this._isServerRsrc(e)?"server":"portal";if(i){for(const n of this.credentials)if(this._hasSameServerInstance(n.server,e)&&i===n.userId&&n.scope===s){r=n;break}}else for(const n of this.credentials)if(this._hasSameServerInstance(n.server,e)&&this._getIdenticalSvcIdx(e,n)!==-1&&n.scope===s){r=n;break}return r}getCredential(e,i){let r,s,n=!0;i&&(r=!!i.token,s=i.error,n=i.prompt!==!1),i={...i},e=this._sanitizeUrl(e);const o=new AbortController,a=lo();if(i.signal&&oo(i.signal,()=>{o.abort()}),oo(o,()=>{a.reject(new j("identity-manager:user-aborted","ABORTED"))}),va(o))return a.promise;i.signal=o.signal;const l=this._isAdminResource(e),c=r?this.findCredential(e):null;let u;if(c&&s&&s.details&&s.details.httpStatus===498)c.destroy();else if(c)return u=new j("identity-manager:not-authorized","You are currently signed in as: '"+c.userId+"'. You do not have access to this resource: "+e,{error:s}),a.reject(u),a.promise;const h=this._findCredential(e,i);if(h)return a.resolve(h),a.promise;let p=this.findServerInfo(e);if(p)!p.hasPortal&&p.server&&p.owningSystemUrl&&this._hasSameServerInstance(p.server,p.owningSystemUrl)&&(p.hasPortal=!0),!p.hasServer&&this._isServerRsrc(e)&&(p._restInfoPms=this._getTokenSvcUrl(e),p.hasServer=!0);else{const f=this._getTokenSvcUrl(e);if(!f)return u=new j("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),a.reject(u),a.promise;p=new UJ,p.server=this._getServerInstanceRoot(e),typeof f=="string"?(p.tokenServiceUrl=f,p.hasPortal=!0):(p._restInfoPms=f,p.hasServer=!0),this.registerServers([p])}return p.hasPortal&&p._selfReq===void 0&&(n||rh(p.tokenServiceUrl,this._appOrigin)||this._gwDomains.some(f=>f.tokenServiceUrl===p.tokenServiceUrl))&&(p._selfReq={owningTenant:i?.owningTenant,selfDfd:this._getPortalSelf(p.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),e)}),this._enqueue(e,p,i,a,l)}getResourceName(e){return this._isRESTService(e)?e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(e)&&e.replace(this._gwUser,"$1")||this._gwItem.test(e)&&e.replace(this._gwItem,"$1")||this._gwGroup.test(e)&&e.replace(this._gwGroup,"$1")||""}generateToken(e,i,r){const s=this._rePortalTokenSvc.test(e.tokenServiceUrl),n=new gh(this._appOrigin),o=e.shortLivedTokenValidity;let a,l,c,u,h,p,f,g;i&&(g=this.tokenValidity||o||this._defaultTokenValidity,g>o&&o>0&&(g=o)),r&&(a=r.isAdmin,l=r.serverUrl,c=r.token,p=r.signal,f=r.ssl,e.customParameters=r.customParameters),a?u=e.adminTokenServiceUrl:(u=e.tokenServiceUrl,h=new gh(u.toLowerCase()),e.webTierAuth&&r?.serverUrl&&!f&&n.scheme==="http"&&(rh(n.uri,u,!0)||h.scheme==="https"&&n.host===h.host&&n.port==="7080"&&h.port==="7443")&&(u=u.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));const y={query:{request:"getToken",username:i?.username,password:i?.password,serverUrl:l,token:c,expiration:g,referer:a||s?this._appOrigin:null,client:a?"referer":null,f:"json",...e.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(e,r),signal:p,...r?.ioArgs};return s||(y.withCredentials=!1),qi(u,y).then(v=>{const b=v.data;if(!b?.token)return new j("identity-manager:authentication-failed","Unable to generate token");const w=e.server;return S6[w]||(S6[w]={}),i&&(S6[w][i.username]=i.password),b.validity=g,b})}isBusy(){return!!this._busy}async checkSignInStatus(e){return(await this.checkAppAccess(e,"")).credential}checkAppAccess(e,i,r){let s=!1;return this.getCredential(e,{prompt:!1}).then(n=>{let o;const a={f:"json"};if(n.scope==="portal")if(i&&(this._doPortalSignIn(e)||r?.force))o=n.server+"/sharing/rest/oauth2/validateAppAccess",a.client_id=i;else{if(!n.token)return{credential:n};o=n.server+"/sharing/rest"}else{if(!n.token)return{credential:n};o=n.server+"/rest/services"}return n.token&&(a.token=n.token),qi(o,{query:a,authMode:"anonymous"}).then(l=>{if(l.data.valid===!1)throw new j("identity-manager:not-authorized",`You are currently signed in as: '${n.userId}'.`,l.data);return s=!!l.data.viewOnlyUserTypeApp,{credential:n}}).catch(l=>{if(l.name==="identity-manager:not-authorized")throw l;const c=l.details?.httpStatus;if(c===498)throw n.destroy(),new j("identity-manager:not-authenticated","User is not signed in.");if(c===400)throw new j("identity-manager:invalid-request");return{credential:n}})}).then(n=>({credential:n.credential,viewOnly:s}))}setOAuthResponseHash(e){e&&(e.charAt(0)==="#"&&(e=e.substring(1)),this._processOAuthPopupParams(P2(e)))}setOAuthRedirectionHandler(e){this._oAuthRedirectFunc=e}setProtocolErrorHandler(e){this._protocolFunc=e}signIn(e,i,r={}){const s=lo(),n=()=>{l?.remove(),c?.remove(),this.dialog?.destroy(),this.dialog=l=c=null},o=()=>{n(),this._oAuthDfd=null,s.reject(new j("identity-manager:user-aborted","ABORTED"))};r.signal&&oo(r.signal,()=>{o()});const a=new lCe({open:!0,resource:this.getResourceName(e),server:i.server});this.dialog=a,this.emit("dialog-create");let l=a.on("cancel",o),c=a.on("submit",u=>{this.generateToken(i,u,{isAdmin:r.isAdmin,signal:r.signal}).then(h=>{n();const p=new In({userId:u.username,server:i.server??void 0,token:h.token,expires:h.expires!=null?Number(h.expires):null,ssl:!!h.ssl,isAdmin:r.isAdmin,validity:h.validity});s.resolve(p)}).catch(h=>{a.error=h,a.signingIn=!1})});return s.promise}oAuthSignIn(e,i,r,s){this._oAuthDfd=lo();const n=this._oAuthDfd;let o;s?.signal&&oo(s.signal,()=>{const p=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;p&&!p.closed?p.close():this.dialog&&u()}),n.resUrl_=e,n.sinfo_=i,n.oinfo_=r;const a=r._oAuthCred;if(a.storage&&(r.flowType==="authorization-code"||r.flowType==="auto"&&i.currentVersion>=8.4)){let p=crypto.getRandomValues(new Uint8Array(32));o=dW(p),a.codeVerifier=o,p=crypto.getRandomValues(new Uint8Array(32)),a.stateUID=dW(p),a.save()||(a.codeVerifier=o=null)}else a.codeVerifier=null;let l,c;this._getCodeChallenge(o).then(p=>{const f=!s||s.oAuthPopupConfirmation!==!1;if(!r.popup||!f)return void this._doOAuthSignIn(e,i,r,p);const g=new lCe({oAuthPrompt:!0,server:i.server,open:!0});this.dialog=g,this.emit("dialog-create"),l=g.on("cancel",u),c=g.on("submit",()=>{h(),this._doOAuthSignIn(e,i,r,p)})});const u=()=>{h(),this._oAuthDfd=null,n.reject(new j("identity-manager:user-aborted","ABORTED"))},h=()=>{l?.remove(),c?.remove(),this.dialog?.destroy(),this.dialog=null};return n.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach(e=>{e.destroy()}),this.emit("credentials-destroy")}enablePostMessageAuth(e="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=Tv(window,"message",i=>{if((i.origin===this._appOrigin||i.origin.endsWith(".arcgis.com"))&&i.data?.type==="arcgis:auth:requestCredential"){const r=i.source;this.getCredential(e).then(s=>{r.postMessage({type:"arcgis:auth:credential",credential:{expires:s.expires,server:s.server,ssl:s.ssl,token:s.token,userId:s.userId}},i.origin)}).catch(s=>{r.postMessage({type:"arcgis:auth:error",error:{name:s.name,message:s.message}},i.origin)})}})}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthLocationParams(){let e=window.location.hash;if(e){e.charAt(0)==="#"&&(e=e.substring(1));const r=P2(e);let s=!1;if(r.access_token&&r.expires_in&&r.state&&r.hasOwnProperty("username"))try{r.state=JSON.parse(r.state),r.state.portalUrl&&(this._oAuthLocationParams=r,s=!0)}catch{}else if(r.error&&r.error_description&&(console.log("IdentityManager OAuth Error: ",r.error," - ",r.error_description),r.error==="access_denied"&&(s=!0,r.state)))try{r.state=JSON.parse(r.state)}catch{}s&&(window.location.hash=r.state?.hash||"")}let i=window.location.search;if(i){i.charAt(0)==="?"&&(i=i.substring(1));const r=P2(i);let s=!1;if(r.code&&r.state)try{r.state=JSON.parse(r.state),r.state.portalUrl&&r.state.uid&&(this._oAuthLocationParams=r,s=!0)}catch{}else if(r.error&&r.error_description&&(console.log("IdentityManager OAuth Error: ",r.error," - ",r.error_description),r.error==="access_denied"&&(s=!0,r.state)))try{r.state=JSON.parse(r.state)}catch{}if(s){const n={...r};["code","error","error_description","message_code","persist","state"].forEach(l=>{delete n[l]});const o=TE(n),a=window.location.pathname+(o?`?${o}`:"")+(r.state?.hash||"");window.history.replaceState(window.history.state,"",a)}}}_getOAuthToken(e,i,r,s,n){return e=e.replace(/^http:/i,"https:"),qi(`${e}/sharing/rest/oauth2/token`,{authMode:"anonymous",method:"post",query:s&&n?{grant_type:"authorization_code",code:i,redirect_uri:s,client_id:r,code_verifier:n}:{grant_type:"refresh_token",refresh_token:i,client_id:r}}).then(o=>o.data)}async _getCodeChallenge(e){if(e&&globalThis.isSecureContext){const i=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",i);return dW(new Uint8Array(r))}return null}_pageShowHandler(e){if(e.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const i=new j("identity-manager:user-aborted","ABORTED");this._errbackFunc(i)}}_findCredential(e,i){let r,s,n,o,a=-1;const l=i?.token,c=i?.resource,u=this._isServerRsrc(e)?"server":"portal",h=this.credentials.filter(p=>this._hasSameServerInstance(p.server,e)&&p.scope===u);if(e=c||e,h.length)if(h.length===1){if(r=h[0],n=this.findServerInfo(r.server),s=n?.owningSystemUrl,o=s?this.findCredential(s,r.userId):void 0,a=this._getIdenticalSvcIdx(e,r),!l)return a===-1&&r.resources.push(e),this._addResource(e,o),r;a!==-1&&(r.resources.splice(a,1),this._removeResource(e,o))}else{let p,f;if(h.some(g=>(f=this._getIdenticalSvcIdx(e,g),f!==-1&&(p=g,n=this.findServerInfo(p.server),s=n?.owningSystemUrl,o=s?this.findCredential(s,p.userId):void 0,a=f,!0))),l)p&&(p.resources.splice(a,1),this._removeResource(e,o));else if(p)return this._addResource(e,o),p}}_findOAuthInfo(e){let i=this.findOAuthInfo(e);if(!i){for(const r of this.oAuthInfos)if(this._isIdProvider(r.portalUrl,e)){i=r;break}}return i}_addResource(e,i){i&&this._getIdenticalSvcIdx(e,i)===-1&&i.resources.push(e)}_removeResource(e,i){let r=-1;i&&(r=this._getIdenticalSvcIdx(e,i),r>-1&&i.resources.splice(r,1))}_useProxy(e,i){return i?.isAdmin&&!rh(e.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(e.tokenServiceUrl)&&String(e.currentVersion)==="10.1"&&!rh(e.tokenServiceUrl,this._appOrigin)}_getOrigin(e){const i=new gh(e);return i.scheme+"://"+i.host+(i.port!=null?":"+i.port:"")}_getServerInstanceRoot(e){const i=e.toLowerCase();let r=i.indexOf(this._agsRest);return r===-1&&this._isAdminResource(e)&&(r=this._agsAdmin.test(e)?e.replace(this._agsAdmin,"$1").length:e.search(this._adminSvcs)),r!==-1||pRe(i)||(r=i.indexOf("/sharing")),r===-1&&i.endsWith("/")&&(r=i.length-1),r>-1?e.substring(0,r):e}_hasSameServerInstance(e,i){return e.endsWith("/")&&(e=e.slice(0,-1)),e=e.toLowerCase(),i=this._getServerInstanceRoot(i).toLowerCase(),e=this._normalizeAGOLorgDomain(e),i=this._normalizeAGOLorgDomain(i),(e=e.substring(e.indexOf(":")))===(i=i.substring(i.indexOf(":")))}_normalizeAGOLorgDomain(e){const i=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,r=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,s=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return i.test(e)?e=e.replace(i,"https://www.arcgis.com"):r.test(e)?e=e.replace(r,"https://devext.arcgis.com"):s.test(e)&&(e=e.replace(s,"https://qaext.arcgis.com")),e}_sanitizeUrl(e){const i=(gr.request.proxyUrl||"").toLowerCase(),r=i?e.toLowerCase().indexOf(i+"?"):-1;return r!==-1&&(e=e.substring(r+i.length+1)),e=Dd(e),ln(e).path}_isRESTService(e){return e.includes(this._agsRest)}_isAdminResource(e){return this._agsAdmin.test(e)||this._adminSvcs.test(e)}_isServerRsrc(e){return this._isRESTService(e)||this._isAdminResource(e)}_isIdenticalService(e,i){let r=!1;if(this._isRESTService(e)&&this._isRESTService(i)){const s=this._getSuffix(e).toLowerCase(),n=this._getSuffix(i).toLowerCase();if(r=s===n,!r){const o=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;r=s.replaceAll(o,"$1")===n.replaceAll(o,"$1")}}else this._isAdminResource(e)&&this._isAdminResource(i)?r=!0:this._isServerRsrc(e)||this._isServerRsrc(i)||!this._isPortalDomain(e)||(r=!0);return r}_isPortalDomain(e){const i=new gh(e.toLowerCase()),r=this._portalConfig;let s=this._gwDomains.some(n=>n.regex.test(i.uri));return!s&&r&&(s=this._hasSameServerInstance(this._getServerInstanceRoot(r.restBaseUrl),i.uri)),s||gr.portalUrl&&(s=rh(i,gr.portalUrl,!0)),s||(s=this._portals.some(n=>this._hasSameServerInstance(n,i.uri))),s=s||this._agsPortal.test(i.path),s}_isIdProvider(e,i){let r=-1,s=-1;this._gwDomains.forEach((o,a)=>{r===-1&&o.regex.test(e)&&(r=a),s===-1&&o.regex.test(i)&&(s=a)});let n=!1;if(r>-1&&s>-1&&(r===0||r===4?s!==0&&s!==4||(n=!0):r===1?s!==1&&s!==2||(n=!0):r===2?s===2&&(n=!0):r===3&&s===3&&(n=!0)),!n){const o=this.findServerInfo(i),a=o?.owningSystemUrl;a&&Nqe(o)&&this._isPortalDomain(a)&&this._isIdProvider(e,a)&&(n=!0)}return n}_getIdenticalSvcIdx(e,i){let r=-1;for(let s=0;s<i.resources.length;s++){const n=i.resources[s];if(this._isIdenticalService(e,n)){r=s;break}}return r}_getSuffix(e){return e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")}_getTokenSvcUrl(e){let i,r,s;if(this._isRESTService(e)||this._isAdminResource(e)){const n=this._getServerInstanceRoot(e);return i=n+"/admin/generateToken",r=qi(e=n+"/rest/info",{query:{f:"json"}}).then(o=>o.data),{adminUrl:i,promise:r}}if(this._isPortalDomain(e)){let n="";if(this._gwDomains.some(o=>(o.regex.test(e)&&(n=o.tokenServiceUrl),!!n)),n||this._portals.some(o=>(this._hasSameServerInstance(o,e)&&(n=o+this._gwTokenUrl),!!n)),n||(s=e.toLowerCase().indexOf("/sharing"),s!==-1&&(n=e.substring(0,s)+this._gwTokenUrl)),n||(n=this._getOrigin(e)+this._gwTokenUrl),n){const o=new gh(e).port;/^http:\/\//i.test(e)&&o==="7080"&&(n=n.replace(/:7080/i,":7443")),n=n.replace(/http:/i,"https:")}return n}}_processOAuthResponseParams(e,i,r){const s=i._oAuthCred;if(e.code){const o=s.codeVerifier;return s.codeVerifier=null,s.stateUID=null,s.save(),this._getOAuthToken(r.server,e.code,i.appId,this._getRedirectURI(i,!0),o).then(a=>{const l=new In({userId:a.username,server:r.server??void 0,token:a.access_token,expires:Date.now()+1e3*a.expires_in,ssl:a.ssl,oAuthState:e.state,_oAuthCred:s});return i.userId=l.userId,s.storage=a.persist?T6:E6,s.refreshToken=a.refresh_token,s.token=null,s.expires=a.refresh_token_expires_in?Date.now()+1e3*a.refresh_token_expires_in:null,s.userId=l.userId,s.ssl=l.ssl,s.save(),l})}const n=new In({userId:e.username,server:r.server??void 0,token:e.access_token,expires:Date.now()+1e3*Number(e.expires_in),ssl:e.ssl==="true",oAuthState:e.state,_oAuthCred:s});return i.userId=n.userId,s.storage=e.persist?T6:E6,s.refreshToken=null,s.token=n.token,s.expires=n.expires,s.userId=n.userId,s.ssl=n.ssl,s.save(),Promise.resolve(n)}_processOAuthPopupParams(e){const i=this._oAuthDfd;if(this._oAuthDfd=null,i)if(clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle?.remove(),e.error){const r=e.error==="access_denied",s=new j(r?"identity-manager:user-aborted":"identity-manager:authentication-failed",r?"ABORTED":"OAuth: "+e.error+" - "+e.error_description);i.reject(s)}else this._processOAuthResponseParams(e,i.oinfo_,i.sinfo_).then(r=>{i.resolve(r)}).catch(r=>{i.reject(r)})}_setOAuthResponseQueryString(e){e&&(e.charAt(0)==="?"&&(e=e.substring(1)),this._processOAuthPopupParams(P2(e)))}async _exchangeToken(e,i,r){return(await qi(`${e}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:i,token:r}})).data.token}async _getPlatformSelf(e,i){if(this._getPlatformSelfError&&Date.now()-this._getPlatformSelfError[1]<1e3)throw this._getPlatformSelfError[0];e=e.replace(/^http:/i,"https:");try{const r=await qi(`${e}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":i,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json",expiration:30},withCredentials:!0});return this._getPlatformSelfError=null,r.data}catch(r){throw r.details?.messageCode==="OAUTH_0066"&&(this._getPlatformSelfError=[r,Date.now()]),r}}_getPortalSelf(e,i){let r;return this._gwDomains.some(s=>(s.regex.test(e)&&(r=s.customBaseUrl),!!r)),r?Promise.resolve({allSSL:!0,currentVersion:"8.4",customBaseUrl:r,portalMode:"multitenant",supportsOAuth:!0}):(this._appOrigin.startsWith("https:")?e=e.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(i)&&(e=e.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),qi(e,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(s=>s.data))}_doPortalSignIn(e){const i=this._portalConfig,r=window.location.href,s=this.findServerInfo(e);return!(!i&&!this._isPortalDomain(r)||!(s?s.hasPortal||s.owningSystemUrl&&this._isPortalDomain(s.owningSystemUrl):this._isPortalDomain(e))||!(this._isIdProvider(r,e)||i&&(this._hasSameServerInstance(this._getServerInstanceRoot(i.restBaseUrl),e)||this._isIdProvider(i.restBaseUrl,e))||rh(r,e,!0)))}_checkProtocol(e,i,r,s){let n=!0;const o=s?i.adminTokenServiceUrl:i.tokenServiceUrl;return o.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&Ek(o)&&(n=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:e,serverInfo:i}),!n)&&r(new j("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection.")),n}_enqueue(e,i,r,s,n,o){return s||(s=lo()),s.resUrl_=e,s.sinfo_=i,s.options_=r,s.admin_=n,s.refresh_=o,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(e),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(s)):this._xoReqs.push(s):this._doSignIn(s),s.promise}_doSignIn(e){this._busy=e,this._rejectOnPersistedPageShow=!1;const i=c=>{const u=e.options_?.resource,h=e.resUrl_,p=e.refresh_;let f=!1;this.credentials.includes(c)||(p&&this.credentials.includes(p)?(p.userId=c.userId,p.token=c.token,p.expires=c.expires,p.validity=c.validity,p.ssl=c.ssl,p.creationTime=c.creationTime,f=!0,c=p):this.credentials.push(c)),c.resources||(c.resources=[]),c.resources.includes(u||h)||c.resources.push(u||h),c.scope=this._isServerRsrc(h)?"server":"portal",c.emitTokenChange();const g=this._soReqs,y={};this._soReqs=[],g.forEach(v=>{if(!this._isIdenticalService(h,v.resUrl_)){const b=this._getSuffix(v.resUrl_);y[b]||(y[b]=!0,c.resources.push(v.resUrl_))}}),e.resolve(c),g.forEach(v=>{this._hasSameServerInstance(this._getServerInstanceRoot(h),v.resUrl_)?v.resolve(c):this._soReqs.push(v)}),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,f||this.emit("credential-create",{credential:c}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},r=c=>{e.reject(c),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},s=(c,u,h,p)=>{const f=e.sinfo_,g=!e.options_||e.options_.prompt!==!1,y=f.hasPortal&&this._findOAuthInfo(e.resUrl_);let v,b;if(c)i(new In({userId:c,server:f.server??void 0,token:h??void 0,expires:p!=null?Number(p):null,ssl:!!u}));else if(window!==window.parent&&this._appUrlObj.query?.["arcgis-auth-origin"]&&this._appUrlObj.query?.["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),e.resUrl_)){window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const w=Tv(window,"message",x=>{x.source===window.parent&&x.data&&(x.data.type==="arcgis:auth:credential"?(w.remove(),x.data.credential.expires<Date.now()?r(new j("identity-manager:credential-request-failed","Parent application's token has expired.")):i(new In(x.data.credential))):x.data.type==="arcgis:auth:error"&&(w.remove(),x.data.error.name==="tokenExpiredError"?r(new j("identity-manager:credential-request-failed","Parent application's token has expired.")):r(j.fromJSON(x.data.error))))});oo(e.options_?.signal,()=>{w.remove()})}else if(y){let w=y._oAuthCred;if(!w){const x=new lae(y,T6),S=new lae(y,E6);x.isValid()&&S.isValid()?x.expires>S.expires?(w=x,S.destroy()):(w=S,x.destroy()):w=x.isValid()?x:S,y._oAuthCred=w}if(w.isValid()){v=new In({userId:w.userId??void 0,server:f.server??void 0,token:w.token??void 0,expires:w.expires,ssl:w.ssl??void 0,_oAuthCred:w});const x=y.appId!==w.appId&&this._doPortalSignIn(e.resUrl_);x||w.refreshToken?(e._pendingDfd=w.refreshToken?this._getOAuthToken(f.server,w.refreshToken,w.appId).then(S=>(v.expires=Date.now()+1e3*S.expires_in,v.token=S.access_token,v)):Promise.resolve(v),e._pendingDfd.then(S=>x?this._exchangeToken(S.server,y.appId,S.token).then(E=>(S.token=E,S)).catch(()=>S):S).then(S=>{i(S)}).catch(()=>{w?.destroy(),s()})):i(v)}else if(this._oAuthLocationParams&&this._hasSameServerInstance(y.portalUrl,this._oAuthLocationParams.state.portalUrl)&&(this._oAuthLocationParams.access_token||this._oAuthLocationParams.code&&this._oAuthLocationParams.state.uid===w.stateUID&&w.codeVerifier)){const x=this._oAuthLocationParams;this._oAuthLocationParams=null,e._pendingDfd=this._processOAuthResponseParams(x,y,f).then(S=>{i(S)}).catch(r)}else{const x=()=>{g?e._pendingDfd=this.oAuthSignIn(e.resUrl_,f,y,e.options_).then(i,r):(b=new j("identity-manager:not-authenticated","User is not signed in."),r(b))};this._doPortalSignIn(e.resUrl_)?e._pendingDfd=this._getPlatformSelf(f.server,y.appId).then(S=>{rh(S.portalUrl,this._appOrigin,!0)?(v=new In({userId:S.username,server:f.server??void 0,expires:Date.now()+1e3*S.expires_in,token:S.token}),i(v)):x()}).catch(x):x()}}else if(g){if(this._checkProtocol(e.resUrl_,f,r,e.admin_)){let w=e.options_;e.admin_&&(w=w||{},w.isAdmin=!0),e._pendingDfd=this.signIn(e.resUrl_,f,w).then(i,r)}}else b=new j("identity-manager:not-authenticated","User is not signed in."),r(b)},n=()=>{const c=e.sinfo_,u=c.owningSystemUrl,h=e.options_;let p,f,g,y;if(h&&(p=h.token,f=h.error,g=h.prompt),y=this._findCredential(u,{token:p,resource:e.resUrl_}),!y){for(const v of this.credentials)if(this._isIdProvider(u,v.server)){y=v;break}}if(y){const v=this.findCredential(e.resUrl_,y.userId);if(v)i(v);else if(hae(c,this._legacyFed)){const b=y.toJSON();b.server=c.server,b.resources=null,i(new In(b))}else(e._pendingDfd=this.generateToken(this.findServerInfo(y.server),null,{serverUrl:e.resUrl_,token:y.token,signal:e.options_.signal,ssl:y.ssl})).then(b=>{i(new In({userId:y?.userId,server:c.server??void 0,token:b.token,expires:b.expires!=null?Number(b.expires):null,ssl:!!b.ssl,isAdmin:e.admin_,validity:b.validity}))},r)}else this._busy=null,p&&(e.options_.token=null),(e._pendingDfd=this.getCredential(u.replace(/\/?$/,"/sharing"),{resource:e.resUrl_,owningTenant:c.owningTenant,signal:e.options_.signal,token:p,error:f,prompt:g})).then(()=>{this._enqueue(e.resUrl_,e.sinfo_,e.options_,e,e.admin_)},v=>{e.resUrl_=e.sinfo_=e.refresh_=null,e.reject(v)})};this._errbackFunc=r;const o=e.sinfo_.owningSystemUrl,a=this._isServerRsrc(e.resUrl_),l=e.sinfo_._restInfoPms;l?l.promise.then(c=>{const u=e.sinfo_;if(u._restInfoPms){u.adminTokenServiceUrl=u._restInfoPms.adminUrl,u._restInfoPms=null,u.tokenServiceUrl=(_v("authInfo.tokenServicesUrl",c)||_v("authInfo.tokenServiceUrl",c)||_v("tokenServiceUrl",c))??null,u.shortLivedTokenValidity=_v("authInfo.shortLivedTokenValidity",c)??null,u.currentVersion=c.currentVersion,u.owningTenant=c.owningTenant;const h=u.owningSystemUrl=c.owningSystemUrl;h&&this._portals.push(h)}a&&u.owningSystemUrl?n():s()},()=>{e.sinfo_._restInfoPms=null;const c=new j("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");r(c)}):a&&o?n():e.sinfo_._selfReq?e.sinfo_._selfReq.selfDfd.then(c=>{const u={};let h,p,f,g;return c&&(h=c.user?.username,u.username=h,u.allSSL=c.allSSL,p=c.supportsOAuth,g=parseFloat(c.currentVersion),c.portalMode==="multitenant"&&(f=c.customBaseUrl),e.sinfo_.currentVersion=g),e.sinfo_.webTierAuth=!!h,h&&this.normalizeWebTierAuth?this.generateToken(e.sinfo_,null,{ssl:u.allSSL}).catch(()=>null).then(y=>(u.portalToken=y?.token,u.tokenExpiration=y?.expires,u)):!h&&p&&g>=4.4&&!this._findOAuthInfo(e.resUrl_)?this._generateOAuthInfo({portalUrl:e.sinfo_.server,customBaseUrl:f,owningTenant:e.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>u):u}).catch(()=>null).then(c=>{e.sinfo_._selfReq=null,c?s(c.username,c.allSSL,c.portalToken,c.tokenExpiration):s()}):s()}_generateOAuthInfo(e){let i,r=null,s=e.portalUrl;const n=e.customBaseUrl,o=e.owningTenant,a=!this._defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(a){r=window.location.href;let l=r.indexOf("?");l>-1&&(r=r.slice(0,l)),l=r.search(/\/(apps|home)\//),r=l>-1?r.slice(0,l):null}return a&&r?(this._hasTestedIfAppIsOnPortal=!0,i=qi(r+"/sharing/rest",{query:{f:"json"}}).then(()=>{this._defaultOAuthInfo=new uae({appId:"arcgisonline",popupCallbackUrl:r+"/home/oauth-callback.html"})})):i=Promise.resolve(),i.then(()=>{if(this._defaultOAuthInfo)return s=s.replace(/^http:/i,"https:"),qi(s+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:o,client_id:this._defaultOAuthInfo.appId,redirect_uri:Bc(this._defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(l=>{if(l.data.valid){const c=this._defaultOAuthInfo.clone();l.data.urlKey&&n?c.portalUrl="https://"+l.data.urlKey.toLowerCase()+"."+n:c.portalUrl=s,c.popup=window!==window.top||!(rh(s,this._appOrigin)||this._gwDomains.some(u=>u.regex.test(s)&&u.regex.test(this._appOrigin))),this.oAuthInfos.push(c)}})})}_doOAuthSignIn(e,i,r,s){const n=r._oAuthCred,o={portalUrl:r.portalUrl};!r.popup&&r.preserveUrlHash&&window.location.hash&&(o.hash=window.location.hash),n.stateUID&&(o.uid=n.stateUID);const a={client_id:r.appId,response_type:n.codeVerifier?"code":"token",state:JSON.stringify(o),expiration:r.expiration,locale:r.locale,redirect_uri:this._getRedirectURI(r,!!n.codeVerifier)};r.forceLogin&&(a.force_login=!0),r.forceUserId&&r.userId&&(a.prepopulatedusername=r.userId),!r.popup&&this._doPortalSignIn(e)&&(a.redirectToUserOrgUrl=!0),n.codeVerifier&&(a.code_challenge=s||n.codeVerifier,a.code_challenge_method=s?"S256":"plain");const l=r.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",c=l+"?"+TE(a);if(r.popup){const u=window.open(c,"esriJSAPIOAuth",r.popupWindowFeatures);if(u)u.focus(),this._oAuthDfd.oAuthWin_=u,this._oAuthIntervalId=setInterval(()=>{if(u.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle.remove();const h=this._oAuthDfd;if(h){const p=new j("identity-manager:user-aborted","ABORTED");h.reject(p)}}},500),this._oAuthOnPopupHandle=Tv(window,["arcgis:auth:hash","arcgis:auth:location:search"],h=>{h.type==="arcgis:auth:hash"?this.setOAuthResponseHash(h.detail):this._setOAuthResponseQueryString(h.detail)});else{const h=new j("identity-manager:popup-blocked","ABORTED");this._oAuthDfd.reject(h)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:a,authorizeUrl:l,resourceUrl:e,serverInfo:i,oAuthInfo:r}):window.location.href=c}_getRedirectURI(e,i){const r=window.location.href.replace(/#.*$/,"");if(e.popup)return Bc(e.popupCallbackUrl);if(i){const s=ln(r);return s.query&&["code","error","error_description","message_code","persist","state"].forEach(n=>{delete s.query[n]}),Qz(s.path,s.query)}return r}}Lqe.prototype.declaredClass="esri.identity.IdentityManagerBase";let In=class extends un.EventedAccessor{constructor(t){super(t),this._oAuthCred=null,this.tokenRefreshBuffer=2,t?._oAuthCred&&(this._oAuthCred=t._oAuthCred)}initialize(){this.resources=this.resources||[],this.creationTime==null&&(this.creationTime=Date.now())}refreshToken(){const t=Ar,e=t.findServerInfo(this.server),i=e?.owningSystemUrl,r=!!i&&this.scope==="server",s=r&&hae(e,t._legacyFed),n=e.webTierAuth,o=n&&t.normalizeWebTierAuth,a=S6[this.server],l=a?.[this.userId];let c,u=this.resources&&this.resources[0],h=r?t.findServerInfo(i):null,p={username:this.userId,password:l};if(n&&!o)return;r&&!h&&t.serverInfos.some(g=>(t._isIdProvider(i,g.server)&&(h=g),!!h));const f=h?t.findCredential(h.server,this.userId):null;if(!r||f){if(!s){if(r)c={serverUrl:u,token:f?.token,ssl:f?.ssl};else if(o)p=null,c={ssl:this.ssl};else{if(!l){let g;return u&&(u=t._sanitizeUrl(u),this._enqueued=1,g=t._enqueue(u,e,null,null,this.isAdmin,this),g.then(()=>{this._enqueued=0,this.refreshServerTokens()}).catch(()=>{this._enqueued=0})),g}this.isAdmin&&(c={isAdmin:!0})}return t.generateToken(r?h:e,r?null:p,c).then(g=>{this.token=g.token,this.expires=g.expires!=null?Number(g.expires):null,this.creationTime=Date.now(),this.validity=g.validity,this.emitTokenChange(),this.refreshServerTokens()}).catch(()=>{})}f?.refreshToken()}}refreshServerTokens(){if(this.scope==="portal"){const t=Ar;t.credentials.forEach(e=>{const i=t.findServerInfo(e.server),r=i?.owningSystemUrl;e!==this&&e.userId===this.userId&&r&&e.scope==="server"&&(t._hasSameServerInstance(this.server,r)||t._isIdProvider(r,this.server))&&(hae(i,t._legacyFed)?(e.token=this.token,e.expires=this.expires,e.creationTime=this.creationTime,e.validity=this.validity,e.emitTokenChange()):e.refreshToken())})}}emitTokenChange(t){clearTimeout(this._refreshTimer);const e=Ar,i=this.server?e.findServerInfo(this.server):null,r=i?.owningSystemUrl,s=r?e.findServerInfo(r):null;t===!1||r&&this.scope!=="portal"&&(!s?.webTierAuth||e.normalizeWebTierAuth)||this.expires==null&&this.validity==null||this._startRefreshTimer(),this.emit("token-change")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const t=Ar,e=t.credentials.indexOf(this);e>-1&&t.credentials.splice(e,1),this.emitTokenChange(),this.emit("destroy")}toJSON(){const t=nq({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),e=this.resources;return e&&e.length>0&&(t.resources=e.slice()),t}_startRefreshTimer(){clearTimeout(this._refreshTimer);const t=6e4*this.tokenRefreshBuffer,e=2**31-1;let i=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();i<0?i=0:i>e&&(i=e),this._refreshTimer=setTimeout(this.refreshToken.bind(this),i>t?i-t:i)}};d([m()],In.prototype,"creationTime",void 0),d([m()],In.prototype,"expires",void 0),d([m()],In.prototype,"isAdmin",void 0),d([m()],In.prototype,"oAuthState",void 0),d([m()],In.prototype,"resources",void 0),d([m()],In.prototype,"scope",void 0),d([m()],In.prototype,"server",void 0),d([m()],In.prototype,"ssl",void 0),d([m()],In.prototype,"token",void 0),d([m()],In.prototype,"tokenRefreshBuffer",void 0),d([m()],In.prototype,"userId",void 0),d([m()],In.prototype,"validity",void 0),In=d([N("esri.identity.Credential")],In);class Dqe extends Lqe{}Dqe.prototype.declaredClass="esri.identity.IdentityManager";const gE=new Dqe;JJe(gE);const EZt=Object.freeze(Object.defineProperty({__proto__:null,default:gE},Symbol.toStringTag,{value:"Module"}));var CZt=Object.defineProperty,MZt=Object.getOwnPropertyDescriptor,ofe=(t,e,i,r)=>{for(var s=r>1?void 0:r?MZt(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&CZt(e,i,s),s};const Fqe=new uae({appId:"KojZjH6glligLidj",popup:!0,popupCallbackUrl:`${document.location.origin}${document.location.pathname}oauth-callback-api.html`});gE.registerOAuthInfos([Fqe]);window.setOAuthResponseHash=t=>{gE.setOAuthResponseHash(t)};let ak=class extends Fe{constructor(){super(),gE.on("credential-create",t=>{const e=new Mo;e.authMode="immediate",e.load().then(()=>{this.user=e.user})})}get authenticated(){return!!this.user}signIn(){gE.getCredential(Fqe.portalUrl+"/sharing",{oAuthPopupConfirmation:!1})}signOut(){gE.destroyCredentials(),this.user=null}};ofe([m()],ak.prototype,"authenticated",1);ofe([m()],ak.prototype,"user",2);ak=ofe([N("arcgis-core-template.UserStore")],ak);const AZt=ak;/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const H7="165",RZt=0,PZt=1,OZt=2,lk=0,m1=1,MH=2,vI=0,yE=1,ck=2,AH=3,RH=4,kqe=5,pw=100,Uqe=101,Bqe=102,IZt=103,$Zt=104,zqe=200,Vqe=201,Gqe=202,jqe=203,PH=204,OH=205,Hqe=206,qqe=207,Wqe=208,Yqe=209,Xqe=210,Zqe=0,Jqe=1,Qqe=2,IH=3,Kqe=4,e9e=5,t9e=6,i9e=7,afe=0,Tx=0,NZt=1,LZt=2,DZt=3,FZt=4,kZt=6,r9e=300,uk=301,$H=302,lfe=303,cfe=304,UZt=306,NH=1e3,pP=1001,LH=1002,za=1003,dae=1004,C6=1005,yf=1006,BZt=1007,_E=1008,G2=1009,M6=1010,A6=1011,WL=1012,Im=1013,xd=1014,Rd=1015,vE=1016,zZt=1017,VZt=1018,D4=1020,s9e=35902,GZt=1021,ufe=1022,u$=1023,jZt=1024,HZt=1025,bE=1026,bI=1027,q7=1028,n9e=1029,hfe=1030,o9e=1031,a9e=1033,BJ=33776,R6=33777,P6=33778,O6=33779,cCe=35840,uCe=35841,hCe=35842,dCe=35843,pCe=36196,pae=37492,fae=37496,mae=37808,gae=37809,yae=37810,_ae=37811,vae=37812,bae=37813,wae=37814,xae=37815,Sae=37816,Tae=37817,Eae=37818,Cae=37819,Mae=37820,Aae=37821,zJ=36492,qZt=36283,fCe=36284,mCe=36285,gCe=36286,Ex=0,WZt=1,F4="",di="srgb",wg="srgb-linear",YZt="display-p3",l9e="display-p3-linear",Rae="linear",yCe="srgb",_Ce="rec709",vCe="p3",XZt=0,c2=7680,ZZt=7681,JZt=7682,QZt=7683,KZt=34055,eJt=34056,tJt=5386,iJt=512,rJt=513,sJt=514,nJt=515,oJt=516,aJt=517,lJt=518,Pae=519,c9e=512,dfe=513,u9e=514,pfe=515,h9e=516,d9e=517,p9e=518,f9e=519,DH=35044,FH=35048,Zm=2e3,aC=2001;class VC{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(i)===-1&&r[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const n=s.indexOf(i);n!==-1&&s.splice(n,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const s=r.slice(0);for(let n=0,o=s.length;n<o;n++)s[n].call(this,e);e.target=null}}}const Sc=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let bCe=1234567;const XD=Math.PI/180,hk=180/Math.PI;function Dv(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Sc[t&255]+Sc[t>>8&255]+Sc[t>>16&255]+Sc[t>>24&255]+"-"+Sc[e&255]+Sc[e>>8&255]+"-"+Sc[e>>16&15|64]+Sc[e>>24&255]+"-"+Sc[i&63|128]+Sc[i>>8&255]+"-"+Sc[i>>16&255]+Sc[i>>24&255]+Sc[r&255]+Sc[r>>8&255]+Sc[r>>16&255]+Sc[r>>24&255]).toLowerCase()}function Jl(t,e,i){return Math.max(e,Math.min(i,t))}function ffe(t,e){return(t%e+e)%e}function cJt(t,e,i,r,s){return r+(t-e)*(s-r)/(i-e)}function uJt(t,e,i){return t!==e?(i-t)/(e-t):0}function ZD(t,e,i){return(1-i)*t+i*e}function hJt(t,e,i,r){return ZD(t,e,1-Math.exp(-i*r))}function dJt(t,e=1){return e-Math.abs(ffe(t,e*2)-e)}function pJt(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))}function fJt(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(t*6-15)+10))}function mJt(t,e){return t+Math.floor(Math.random()*(e-t+1))}function gJt(t,e){return t+Math.random()*(e-t)}function yJt(t){return t*(.5-Math.random())}function _Jt(t){t!==void 0&&(bCe=t);let e=bCe+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function vJt(t){return t*XD}function bJt(t){return t*hk}function wJt(t){return(t&t-1)===0&&t!==0}function xJt(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function SJt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function TJt(t,e,i,r,s){const n=Math.cos,o=Math.sin,a=n(i/2),l=o(i/2),c=n((e+r)/2),u=o((e+r)/2),h=n((e-r)/2),p=o((e-r)/2),f=n((r-e)/2),g=o((r-e)/2);switch(s){case"XYX":t.set(a*u,l*h,l*p,a*c);break;case"YZY":t.set(l*p,a*u,l*h,a*c);break;case"ZXZ":t.set(l*h,l*p,a*u,a*c);break;case"XZX":t.set(a*u,l*g,l*f,a*c);break;case"YXY":t.set(l*f,a*u,l*g,a*c);break;case"ZYZ":t.set(l*g,l*f,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Mu(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Qi(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const m9e={DEG2RAD:XD,RAD2DEG:hk,generateUUID:Dv,clamp:Jl,euclideanModulo:ffe,mapLinear:cJt,inverseLerp:uJt,lerp:ZD,damp:hJt,pingpong:dJt,smoothstep:pJt,smootherstep:fJt,randInt:mJt,randFloat:gJt,randFloatSpread:yJt,seededRandom:_Jt,degToRad:vJt,radToDeg:bJt,isPowerOfTwo:wJt,ceilPowerOfTwo:xJt,floorPowerOfTwo:SJt,setQuaternionFromProperEuler:TJt,normalize:Qi,denormalize:Mu};class Xi{constructor(e=0,i=0){Xi.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,r=this.y,s=e.elements;return this.x=s[0]*i+s[3]*r+s[6],this.y=s[1]*i+s[4]*r+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(e)/i;return Math.acos(Jl(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,r=this.y-e.y;return i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const r=Math.cos(i),s=Math.sin(i),n=this.x-e.x,o=this.y-e.y;return this.x=n*r-o*s+e.x,this.y=n*s+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Tf{constructor(e,i,r,s,n,o,a,l,c){Tf.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,r,s,n,o,a,l,c)}set(e,i,r,s,n,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=s,u[2]=a,u[3]=i,u[4]=n,u[5]=l,u[6]=r,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(e,i,r){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const r=e.elements,s=i.elements,n=this.elements,o=r[0],a=r[3],l=r[6],c=r[1],u=r[4],h=r[7],p=r[2],f=r[5],g=r[8],y=s[0],v=s[3],b=s[6],w=s[1],x=s[4],S=s[7],E=s[2],C=s[5],R=s[8];return n[0]=o*y+a*w+l*E,n[3]=o*v+a*x+l*C,n[6]=o*b+a*S+l*R,n[1]=c*y+u*w+h*E,n[4]=c*v+u*x+h*C,n[7]=c*b+u*S+h*R,n[2]=p*y+f*w+g*E,n[5]=p*v+f*x+g*C,n[8]=p*b+f*S+g*R,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return i*o*u-i*a*c-r*n*u+r*a*l+s*n*c-s*o*l}invert(){const e=this.elements,i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,p=a*l-u*n,f=c*n-o*l,g=i*h+r*p+s*f;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/g;return e[0]=h*y,e[1]=(s*c-u*r)*y,e[2]=(a*r-s*o)*y,e[3]=p*y,e[4]=(u*i-s*l)*y,e[5]=(s*n-a*i)*y,e[6]=f*y,e[7]=(r*l-c*i)*y,e[8]=(o*i-r*n)*y,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,r,s,n,o,a){const l=Math.cos(n),c=Math.sin(n);return this.set(r*l,r*c,-r*(l*o+c*a)+o+e,-s*c,s*l,-s*(-c*o+l*a)+a+i,0,0,1),this}scale(e,i){return this.premultiply(VJ.makeScale(e,i)),this}rotate(e){return this.premultiply(VJ.makeRotation(-e)),this}translate(e,i){return this.premultiply(VJ.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,r,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,r=e.elements;for(let s=0;s<9;s++)if(i[s]!==r[s])return!1;return!0}fromArray(e,i=0){for(let r=0;r<9;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){const r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const VJ=new Tf;function EJt(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function kH(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function CJt(){const t=kH("canvas");return t.style.display="block",t}const wCe={};function g9e(t){t in wCe||(wCe[t]=!0,console.warn(t))}const xCe=new Tf().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),SCe=new Tf().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),mz={[wg]:{transfer:Rae,primaries:_Ce,toReference:t=>t,fromReference:t=>t},[di]:{transfer:yCe,primaries:_Ce,toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[l9e]:{transfer:Rae,primaries:vCe,toReference:t=>t.applyMatrix3(SCe),fromReference:t=>t.applyMatrix3(xCe)},[YZt]:{transfer:yCe,primaries:vCe,toReference:t=>t.convertSRGBToLinear().applyMatrix3(SCe),fromReference:t=>t.applyMatrix3(xCe).convertLinearToSRGB()}},MJt=new Set([wg,l9e]),qf={enabled:!0,_workingColorSpace:wg,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!MJt.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,i){if(this.enabled===!1||e===i||!e||!i)return t;const r=mz[e].toReference,s=mz[i].fromReference;return s(r(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return mz[t].primaries},getTransfer:function(t){return t===F4?Rae:mz[t].transfer}};function rO(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function GJ(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let aA;class AJt{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{aA===void 0&&(aA=kH("canvas")),aA.width=e.width,aA.height=e.height;const r=aA.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),i=aA}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=kH("canvas");i.width=e.width,i.height=e.height;const r=i.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const s=r.getImageData(0,0,e.width,e.height),n=s.data;for(let o=0;o<n.length;o++)n[o]=rO(n[o]/255)*255;return r.putImageData(s,0,0),i}else if(e.data){const i=e.data.slice(0);for(let r=0;r<i.length;r++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[r]=Math.floor(rO(i[r]/255)*255):i[r]=rO(i[r]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let RJt=0;class y9e{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:RJt++}),this.uuid=Dv(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},s=this.data;if(s!==null){let n;if(Array.isArray(s)){n=[];for(let o=0,a=s.length;o<a;o++)s[o].isDataTexture?n.push(jJ(s[o].image)):n.push(jJ(s[o]))}else n=jJ(s);r.url=n}return i||(e.images[this.uuid]=r),r}}function jJ(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?AJt.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let PJt=0;class Lu extends VC{constructor(e=Lu.DEFAULT_IMAGE,i=Lu.DEFAULT_MAPPING,r=pP,s=pP,n=yf,o=_E,a=u$,l=G2,c=Lu.DEFAULT_ANISOTROPY,u=F4){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:PJt++}),this.uuid=Dv(),this.name="",this.source=new y9e(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=s,this.magFilter=n,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Xi(0,0),this.repeat=new Xi(1,1),this.center=new Xi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Tf,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==r9e)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case NH:e.x=e.x-Math.floor(e.x);break;case pP:e.x=e.x<0?0:1;break;case LH:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case NH:e.y=e.y-Math.floor(e.y);break;case pP:e.y=e.y<0?0:1;break;case LH:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Lu.DEFAULT_IMAGE=null;Lu.DEFAULT_MAPPING=r9e;Lu.DEFAULT_ANISOTROPY=1;class Fs{constructor(e=0,i=0,r=0,s=1){Fs.prototype.isVector4=!0,this.x=e,this.y=i,this.z=r,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,r,s){return this.x=e,this.y=i,this.z=r,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,r=this.y,s=this.z,n=this.w,o=e.elements;return this.x=o[0]*i+o[4]*r+o[8]*s+o[12]*n,this.y=o[1]*i+o[5]*r+o[9]*s+o[13]*n,this.z=o[2]*i+o[6]*r+o[10]*s+o[14]*n,this.w=o[3]*i+o[7]*r+o[11]*s+o[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,r,s,n;const l=e.elements,c=l[0],u=l[4],h=l[8],p=l[1],f=l[5],g=l[9],y=l[2],v=l[6],b=l[10];if(Math.abs(u-p)<.01&&Math.abs(h-y)<.01&&Math.abs(g-v)<.01){if(Math.abs(u+p)<.1&&Math.abs(h+y)<.1&&Math.abs(g+v)<.1&&Math.abs(c+f+b-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const x=(c+1)/2,S=(f+1)/2,E=(b+1)/2,C=(u+p)/4,R=(h+y)/4,I=(g+v)/4;return x>S&&x>E?x<.01?(r=0,s=.707106781,n=.707106781):(r=Math.sqrt(x),s=C/r,n=R/r):S>E?S<.01?(r=.707106781,s=0,n=.707106781):(s=Math.sqrt(S),r=C/s,n=I/s):E<.01?(r=.707106781,s=.707106781,n=0):(n=Math.sqrt(E),r=R/n,s=I/n),this.set(r,s,n,i),this}let w=Math.sqrt((v-g)*(v-g)+(h-y)*(h-y)+(p-u)*(p-u));return Math.abs(w)<.001&&(w=1),this.x=(v-g)/w,this.y=(h-y)/w,this.z=(p-u)/w,this.w=Math.acos((c+f+b-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this.w=e.w+(i.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class xg extends VC{constructor(e=1,i=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=i,this.depth=1,this.scissor=new Fs(0,0,e,i),this.scissorTest=!1,this.viewport=new Fs(0,0,e,i);const s={width:e,height:i,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:yf,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const n=new Lu(s,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);n.flipY=!1,n.generateMipmaps=r.generateMipmaps,n.internalFormat=r.internalFormat,this.textures=[];const o=r.count;for(let a=0;a<o;a++)this.textures[a]=n.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,i,r=1){if(this.width!==e||this.height!==i||this.depth!==r){this.width=e,this.height=i,this.depth=r;for(let s=0,n=this.textures.length;s<n;s++)this.textures[s].image.width=e,this.textures[s].image.height=i,this.textures[s].image.depth=r;this.dispose()}this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,s=e.textures.length;r<s;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const i=Object.assign({},e.texture.image);return this.texture.source=new y9e(i),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class OJt extends xg{constructor(e=1,i=1,r={}){super(e,i,r),this.isWebGLRenderTarget=!0}}class IJt extends Lu{constructor(e=null,i=1,r=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:r,depth:s},this.magFilter=za,this.minFilter=za,this.wrapR=pP,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class k4{constructor(e=0,i=0,r=0,s=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=r,this._w=s}static slerpFlat(e,i,r,s,n,o,a){let l=r[s+0],c=r[s+1],u=r[s+2],h=r[s+3];const p=n[o+0],f=n[o+1],g=n[o+2],y=n[o+3];if(a===0){e[i+0]=l,e[i+1]=c,e[i+2]=u,e[i+3]=h;return}if(a===1){e[i+0]=p,e[i+1]=f,e[i+2]=g,e[i+3]=y;return}if(h!==y||l!==p||c!==f||u!==g){let v=1-a;const b=l*p+c*f+u*g+h*y,w=b>=0?1:-1,x=1-b*b;if(x>Number.EPSILON){const E=Math.sqrt(x),C=Math.atan2(E,b*w);v=Math.sin(v*C)/E,a=Math.sin(a*C)/E}const S=a*w;if(l=l*v+p*S,c=c*v+f*S,u=u*v+g*S,h=h*v+y*S,v===1-a){const E=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=E,c*=E,u*=E,h*=E}}e[i]=l,e[i+1]=c,e[i+2]=u,e[i+3]=h}static multiplyQuaternionsFlat(e,i,r,s,n,o){const a=r[s],l=r[s+1],c=r[s+2],u=r[s+3],h=n[o],p=n[o+1],f=n[o+2],g=n[o+3];return e[i]=a*g+u*h+l*f-c*p,e[i+1]=l*g+u*p+c*h-a*f,e[i+2]=c*g+u*f+a*p-l*h,e[i+3]=u*g-a*h-l*p-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,r,s){return this._x=e,this._y=i,this._z=r,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i=!0){const r=e._x,s=e._y,n=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(r/2),u=a(s/2),h=a(n/2),p=l(r/2),f=l(s/2),g=l(n/2);switch(o){case"XYZ":this._x=p*u*h+c*f*g,this._y=c*f*h-p*u*g,this._z=c*u*g+p*f*h,this._w=c*u*h-p*f*g;break;case"YXZ":this._x=p*u*h+c*f*g,this._y=c*f*h-p*u*g,this._z=c*u*g-p*f*h,this._w=c*u*h+p*f*g;break;case"ZXY":this._x=p*u*h-c*f*g,this._y=c*f*h+p*u*g,this._z=c*u*g+p*f*h,this._w=c*u*h-p*f*g;break;case"ZYX":this._x=p*u*h-c*f*g,this._y=c*f*h+p*u*g,this._z=c*u*g-p*f*h,this._w=c*u*h+p*f*g;break;case"YZX":this._x=p*u*h+c*f*g,this._y=c*f*h+p*u*g,this._z=c*u*g-p*f*h,this._w=c*u*h-p*f*g;break;case"XZY":this._x=p*u*h-c*f*g,this._y=c*f*h-p*u*g,this._z=c*u*g+p*f*h,this._w=c*u*h+p*f*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const r=i/2,s=Math.sin(r);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,r=i[0],s=i[4],n=i[8],o=i[1],a=i[5],l=i[9],c=i[2],u=i[6],h=i[10],p=r+a+h;if(p>0){const f=.5/Math.sqrt(p+1);this._w=.25/f,this._x=(u-l)*f,this._y=(n-c)*f,this._z=(o-s)*f}else if(r>a&&r>h){const f=2*Math.sqrt(1+r-a-h);this._w=(u-l)/f,this._x=.25*f,this._y=(s+o)/f,this._z=(n+c)/f}else if(a>h){const f=2*Math.sqrt(1+a-r-h);this._w=(n-c)/f,this._x=(s+o)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+h-r-a);this._w=(o-s)/f,this._x=(n+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let r=e.dot(i)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Jl(this.dot(e),-1,1)))}rotateTowards(e,i){const r=this.angleTo(e);if(r===0)return this;const s=Math.min(1,i/r);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const r=e._x,s=e._y,n=e._z,o=e._w,a=i._x,l=i._y,c=i._z,u=i._w;return this._x=r*u+o*a+s*c-n*l,this._y=s*u+o*l+n*a-r*c,this._z=n*u+o*c+r*l-s*a,this._w=o*u-r*a-s*l-n*c,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);const r=this._x,s=this._y,n=this._z,o=this._w;let a=o*e._w+r*e._x+s*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=s,this._z=n,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-i;return this._w=f*o+i*this._w,this._x=f*r+i*this._x,this._y=f*s+i*this._y,this._z=f*n+i*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),h=Math.sin((1-i)*u)/c,p=Math.sin(i*u)/c;return this._w=o*h+this._w*p,this._x=r*h+this._x*p,this._y=s*h+this._y*p,this._z=n*h+this._z*p,this._onChangeCallback(),this}slerpQuaternions(e,i,r){return this.copy(e).slerp(i,r)}random(){const e=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),r=Math.random(),s=Math.sqrt(1-r),n=Math.sqrt(r);return this.set(s*Math.sin(e),s*Math.cos(e),n*Math.sin(i),n*Math.cos(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ve{constructor(e=0,i=0,r=0){ve.prototype.isVector3=!0,this.x=e,this.y=i,this.z=r}set(e,i,r){return r===void 0&&(r=this.z),this.x=e,this.y=i,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(TCe.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(TCe.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,r=this.y,s=this.z,n=e.elements;return this.x=n[0]*i+n[3]*r+n[6]*s,this.y=n[1]*i+n[4]*r+n[7]*s,this.z=n[2]*i+n[5]*r+n[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,r=this.y,s=this.z,n=e.elements,o=1/(n[3]*i+n[7]*r+n[11]*s+n[15]);return this.x=(n[0]*i+n[4]*r+n[8]*s+n[12])*o,this.y=(n[1]*i+n[5]*r+n[9]*s+n[13])*o,this.z=(n[2]*i+n[6]*r+n[10]*s+n[14])*o,this}applyQuaternion(e){const i=this.x,r=this.y,s=this.z,n=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*s-a*r),u=2*(a*i-n*s),h=2*(n*r-o*i);return this.x=i+l*c+o*h-a*u,this.y=r+l*u+a*c-n*h,this.z=s+l*h+n*u-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,r=this.y,s=this.z,n=e.elements;return this.x=n[0]*i+n[4]*r+n[8]*s,this.y=n[1]*i+n[5]*r+n[9]*s,this.z=n[2]*i+n[6]*r+n[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const r=e.x,s=e.y,n=e.z,o=i.x,a=i.y,l=i.z;return this.x=s*l-n*a,this.y=n*o-r*l,this.z=r*a-s*o,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const r=e.dot(this)/i;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return HJ.copy(this).projectOnVector(e),this.sub(HJ)}reflect(e){return this.sub(HJ.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(e)/i;return Math.acos(Jl(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,r=this.y-e.y,s=this.z-e.z;return i*i+r*r+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,r){const s=Math.sin(i)*e;return this.x=s*Math.sin(r),this.y=Math.cos(i)*e,this.z=s*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,r){return this.x=e*Math.sin(i),this.y=r,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=r,this.z=s,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,r=Math.sqrt(1-i*i);return this.x=r*Math.cos(e),this.y=i,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const HJ=new ve,TCe=new k4;class GC{constructor(e=new ve(1/0,1/0,1/0),i=new ve(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i+=3)this.expandByPoint(Wf.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,r=e.count;i<r;i++)this.expandByPoint(Wf.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const r=Wf.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const n=r.getAttribute("position");if(i===!0&&n!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=n.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Wf):Wf.fromBufferAttribute(n,o),Wf.applyMatrix4(e.matrixWorld),this.expandByPoint(Wf);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),gz.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),gz.copy(r.boundingBox)),gz.applyMatrix4(e.matrixWorld),this.union(gz)}const s=e.children;for(let n=0,o=s.length;n<o;n++)this.expandByObject(s[n],i);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Wf),Wf.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,r;return e.normal.x>0?(i=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),i<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(P3),yz.subVectors(this.max,P3),lA.subVectors(e.a,P3),cA.subVectors(e.b,P3),uA.subVectors(e.c,P3),ib.subVectors(cA,lA),rb.subVectors(uA,cA),ZS.subVectors(lA,uA);let i=[0,-ib.z,ib.y,0,-rb.z,rb.y,0,-ZS.z,ZS.y,ib.z,0,-ib.x,rb.z,0,-rb.x,ZS.z,0,-ZS.x,-ib.y,ib.x,0,-rb.y,rb.x,0,-ZS.y,ZS.x,0];return!qJ(i,lA,cA,uA,yz)||(i=[1,0,0,0,1,0,0,0,1],!qJ(i,lA,cA,uA,yz))?!1:(_z.crossVectors(ib,rb),i=[_z.x,_z.y,_z.z],qJ(i,lA,cA,uA,yz))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Wf).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Wf).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(v_[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),v_[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),v_[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),v_[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),v_[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),v_[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),v_[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),v_[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(v_),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const v_=[new ve,new ve,new ve,new ve,new ve,new ve,new ve,new ve],Wf=new ve,gz=new GC,lA=new ve,cA=new ve,uA=new ve,ib=new ve,rb=new ve,ZS=new ve,P3=new ve,yz=new ve,_z=new ve,JS=new ve;function qJ(t,e,i,r,s){for(let n=0,o=t.length-3;n<=o;n+=3){JS.fromArray(t,n);const a=s.x*Math.abs(JS.x)+s.y*Math.abs(JS.y)+s.z*Math.abs(JS.z),l=e.dot(JS),c=i.dot(JS),u=r.dot(JS);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const $Jt=new GC,O3=new ve,WJ=new ve;class U4{constructor(e=new ve,i=-1){this.isSphere=!0,this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){const r=this.center;i!==void 0?r.copy(i):$Jt.setFromPoints(e).getCenter(r);let s=0;for(let n=0,o=e.length;n<o;n++)s=Math.max(s,r.distanceToSquared(e[n]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){const r=this.center.distanceToSquared(e);return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;O3.subVectors(e,this.center);const i=O3.lengthSq();if(i>this.radius*this.radius){const r=Math.sqrt(i),s=(r-this.radius)*.5;this.center.addScaledVector(O3,s/r),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(WJ.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(O3.copy(e.center).add(WJ)),this.expandByPoint(O3.copy(e.center).sub(WJ))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const b_=new ve,YJ=new ve,vz=new ve,sb=new ve,XJ=new ve,bz=new ve,ZJ=new ve;class NJt{constructor(e=new ve,i=new ve(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,b_)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);const r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const i=b_.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(b_.copy(this.origin).addScaledVector(this.direction,i),b_.distanceToSquared(e))}distanceSqToSegment(e,i,r,s){YJ.copy(e).add(i).multiplyScalar(.5),vz.copy(i).sub(e).normalize(),sb.copy(this.origin).sub(YJ);const n=e.distanceTo(i)*.5,o=-this.direction.dot(vz),a=sb.dot(this.direction),l=-sb.dot(vz),c=sb.lengthSq(),u=Math.abs(1-o*o);let h,p,f,g;if(u>0)if(h=o*l-a,p=o*a-l,g=n*u,h>=0)if(p>=-g)if(p<=g){const y=1/u;h*=y,p*=y,f=h*(h+o*p+2*a)+p*(o*h+p+2*l)+c}else p=n,h=Math.max(0,-(o*p+a)),f=-h*h+p*(p+2*l)+c;else p=-n,h=Math.max(0,-(o*p+a)),f=-h*h+p*(p+2*l)+c;else p<=-g?(h=Math.max(0,-(-o*n+a)),p=h>0?-n:Math.min(Math.max(-n,-l),n),f=-h*h+p*(p+2*l)+c):p<=g?(h=0,p=Math.min(Math.max(-n,-l),n),f=p*(p+2*l)+c):(h=Math.max(0,-(o*n+a)),p=h>0?n:Math.min(Math.max(-n,-l),n),f=-h*h+p*(p+2*l)+c);else p=o>0?-n:n,h=Math.max(0,-(o*p+a)),f=-h*h+p*(p+2*l)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,h),s&&s.copy(YJ).addScaledVector(vz,p),f}intersectSphere(e,i){b_.subVectors(e.center,this.origin);const r=b_.dot(this.direction),s=b_.dot(b_)-r*r,n=e.radius*e.radius;if(s>n)return null;const o=Math.sqrt(n-s),a=r-o,l=r+o;return l<0?null:a<0?this.at(l,i):this.at(a,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/i;return r>=0?r:null}intersectPlane(e,i){const r=this.distanceToPlane(e);return r===null?null:this.at(r,i)}intersectsPlane(e){const i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let r,s,n,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,p=this.origin;return c>=0?(r=(e.min.x-p.x)*c,s=(e.max.x-p.x)*c):(r=(e.max.x-p.x)*c,s=(e.min.x-p.x)*c),u>=0?(n=(e.min.y-p.y)*u,o=(e.max.y-p.y)*u):(n=(e.max.y-p.y)*u,o=(e.min.y-p.y)*u),r>o||n>s||((n>r||isNaN(r))&&(r=n),(o<s||isNaN(s))&&(s=o),h>=0?(a=(e.min.z-p.z)*h,l=(e.max.z-p.z)*h):(a=(e.max.z-p.z)*h,l=(e.min.z-p.z)*h),r>l||a>s)||((a>r||r!==r)&&(r=a),(l<s||s!==s)&&(s=l),s<0)?null:this.at(r>=0?r:s,i)}intersectsBox(e){return this.intersectBox(e,b_)!==null}intersectTriangle(e,i,r,s,n){XJ.subVectors(i,e),bz.subVectors(r,e),ZJ.crossVectors(XJ,bz);let o=this.direction.dot(ZJ),a;if(o>0){if(s)return null;a=1}else if(o<0)a=-1,o=-o;else return null;sb.subVectors(this.origin,e);const l=a*this.direction.dot(bz.crossVectors(sb,bz));if(l<0)return null;const c=a*this.direction.dot(XJ.cross(sb));if(c<0||l+c>o)return null;const u=-a*sb.dot(ZJ);return u<0?null:this.at(u/o,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class kn{constructor(e,i,r,s,n,o,a,l,c,u,h,p,f,g,y,v){kn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,r,s,n,o,a,l,c,u,h,p,f,g,y,v)}set(e,i,r,s,n,o,a,l,c,u,h,p,f,g,y,v){const b=this.elements;return b[0]=e,b[4]=i,b[8]=r,b[12]=s,b[1]=n,b[5]=o,b[9]=a,b[13]=l,b[2]=c,b[6]=u,b[10]=h,b[14]=p,b[3]=f,b[7]=g,b[11]=y,b[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new kn().fromArray(this.elements)}copy(e){const i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(e){const i=this.elements,r=e.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,r){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,i,r){return this.set(e.x,i.x,r.x,0,e.y,i.y,r.y,0,e.z,i.z,r.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,r=e.elements,s=1/hA.setFromMatrixColumn(e,0).length(),n=1/hA.setFromMatrixColumn(e,1).length(),o=1/hA.setFromMatrixColumn(e,2).length();return i[0]=r[0]*s,i[1]=r[1]*s,i[2]=r[2]*s,i[3]=0,i[4]=r[4]*n,i[5]=r[5]*n,i[6]=r[6]*n,i[7]=0,i[8]=r[8]*o,i[9]=r[9]*o,i[10]=r[10]*o,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,r=e.x,s=e.y,n=e.z,o=Math.cos(r),a=Math.sin(r),l=Math.cos(s),c=Math.sin(s),u=Math.cos(n),h=Math.sin(n);if(e.order==="XYZ"){const p=o*u,f=o*h,g=a*u,y=a*h;i[0]=l*u,i[4]=-l*h,i[8]=c,i[1]=f+g*c,i[5]=p-y*c,i[9]=-a*l,i[2]=y-p*c,i[6]=g+f*c,i[10]=o*l}else if(e.order==="YXZ"){const p=l*u,f=l*h,g=c*u,y=c*h;i[0]=p+y*a,i[4]=g*a-f,i[8]=o*c,i[1]=o*h,i[5]=o*u,i[9]=-a,i[2]=f*a-g,i[6]=y+p*a,i[10]=o*l}else if(e.order==="ZXY"){const p=l*u,f=l*h,g=c*u,y=c*h;i[0]=p-y*a,i[4]=-o*h,i[8]=g+f*a,i[1]=f+g*a,i[5]=o*u,i[9]=y-p*a,i[2]=-o*c,i[6]=a,i[10]=o*l}else if(e.order==="ZYX"){const p=o*u,f=o*h,g=a*u,y=a*h;i[0]=l*u,i[4]=g*c-f,i[8]=p*c+y,i[1]=l*h,i[5]=y*c+p,i[9]=f*c-g,i[2]=-c,i[6]=a*l,i[10]=o*l}else if(e.order==="YZX"){const p=o*l,f=o*c,g=a*l,y=a*c;i[0]=l*u,i[4]=y-p*h,i[8]=g*h+f,i[1]=h,i[5]=o*u,i[9]=-a*u,i[2]=-c*u,i[6]=f*h+g,i[10]=p-y*h}else if(e.order==="XZY"){const p=o*l,f=o*c,g=a*l,y=a*c;i[0]=l*u,i[4]=-h,i[8]=c*u,i[1]=p*h+y,i[5]=o*u,i[9]=f*h-g,i[2]=g*h-f,i[6]=a*u,i[10]=y*h+p}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(LJt,e,DJt)}lookAt(e,i,r){const s=this.elements;return Wh.subVectors(e,i),Wh.lengthSq()===0&&(Wh.z=1),Wh.normalize(),nb.crossVectors(r,Wh),nb.lengthSq()===0&&(Math.abs(r.z)===1?Wh.x+=1e-4:Wh.z+=1e-4,Wh.normalize(),nb.crossVectors(r,Wh)),nb.normalize(),wz.crossVectors(Wh,nb),s[0]=nb.x,s[4]=wz.x,s[8]=Wh.x,s[1]=nb.y,s[5]=wz.y,s[9]=Wh.y,s[2]=nb.z,s[6]=wz.z,s[10]=Wh.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const r=e.elements,s=i.elements,n=this.elements,o=r[0],a=r[4],l=r[8],c=r[12],u=r[1],h=r[5],p=r[9],f=r[13],g=r[2],y=r[6],v=r[10],b=r[14],w=r[3],x=r[7],S=r[11],E=r[15],C=s[0],R=s[4],I=s[8],F=s[12],D=s[1],z=s[5],B=s[9],Y=s[13],W=s[2],J=s[6],me=s[10],L=s[14],k=s[3],H=s[7],q=s[11],Q=s[15];return n[0]=o*C+a*D+l*W+c*k,n[4]=o*R+a*z+l*J+c*H,n[8]=o*I+a*B+l*me+c*q,n[12]=o*F+a*Y+l*L+c*Q,n[1]=u*C+h*D+p*W+f*k,n[5]=u*R+h*z+p*J+f*H,n[9]=u*I+h*B+p*me+f*q,n[13]=u*F+h*Y+p*L+f*Q,n[2]=g*C+y*D+v*W+b*k,n[6]=g*R+y*z+v*J+b*H,n[10]=g*I+y*B+v*me+b*q,n[14]=g*F+y*Y+v*L+b*Q,n[3]=w*C+x*D+S*W+E*k,n[7]=w*R+x*z+S*J+E*H,n[11]=w*I+x*B+S*me+E*q,n[15]=w*F+x*Y+S*L+E*Q,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],r=e[4],s=e[8],n=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],h=e[6],p=e[10],f=e[14],g=e[3],y=e[7],v=e[11],b=e[15];return g*(+n*l*h-s*c*h-n*a*p+r*c*p+s*a*f-r*l*f)+y*(+i*l*f-i*c*p+n*o*p-s*o*f+s*c*u-n*l*u)+v*(+i*c*h-i*a*f-n*o*h+r*o*f+n*a*u-r*c*u)+b*(-s*a*u-i*l*h+i*a*p+s*o*h-r*o*p+r*l*u)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,r){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=i,s[14]=r),this}invert(){const e=this.elements,i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],y=e[13],v=e[14],b=e[15],w=h*v*c-y*p*c+y*l*f-a*v*f-h*l*b+a*p*b,x=g*p*c-u*v*c-g*l*f+o*v*f+u*l*b-o*p*b,S=u*y*c-g*h*c+g*a*f-o*y*f-u*a*b+o*h*b,E=g*h*l-u*y*l-g*a*p+o*y*p+u*a*v-o*h*v,C=i*w+r*x+s*S+n*E;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const R=1/C;return e[0]=w*R,e[1]=(y*p*n-h*v*n-y*s*f+r*v*f+h*s*b-r*p*b)*R,e[2]=(a*v*n-y*l*n+y*s*c-r*v*c-a*s*b+r*l*b)*R,e[3]=(h*l*n-a*p*n-h*s*c+r*p*c+a*s*f-r*l*f)*R,e[4]=x*R,e[5]=(u*v*n-g*p*n+g*s*f-i*v*f-u*s*b+i*p*b)*R,e[6]=(g*l*n-o*v*n-g*s*c+i*v*c+o*s*b-i*l*b)*R,e[7]=(o*p*n-u*l*n+u*s*c-i*p*c-o*s*f+i*l*f)*R,e[8]=S*R,e[9]=(g*h*n-u*y*n-g*r*f+i*y*f+u*r*b-i*h*b)*R,e[10]=(o*y*n-g*a*n+g*r*c-i*y*c-o*r*b+i*a*b)*R,e[11]=(u*a*n-o*h*n-u*r*c+i*h*c+o*r*f-i*a*f)*R,e[12]=E*R,e[13]=(u*y*s-g*h*s+g*r*p-i*y*p-u*r*v+i*h*v)*R,e[14]=(g*a*s-o*y*s-g*r*l+i*y*l+o*r*v-i*a*v)*R,e[15]=(o*h*s-u*a*s+u*r*l-i*h*l-o*r*p+i*a*p)*R,this}scale(e){const i=this.elements,r=e.x,s=e.y,n=e.z;return i[0]*=r,i[4]*=s,i[8]*=n,i[1]*=r,i[5]*=s,i[9]*=n,i[2]*=r,i[6]*=s,i[10]*=n,i[3]*=r,i[7]*=s,i[11]*=n,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,r,s))}makeTranslation(e,i,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const r=Math.cos(i),s=Math.sin(i),n=1-r,o=e.x,a=e.y,l=e.z,c=n*o,u=n*a;return this.set(c*o+r,c*a-s*l,c*l+s*a,0,c*a+s*l,u*a+r,u*l-s*o,0,c*l-s*a,u*l+s*o,n*l*l+r,0,0,0,0,1),this}makeScale(e,i,r){return this.set(e,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,i,r,s,n,o){return this.set(1,r,n,0,e,1,o,0,i,s,1,0,0,0,0,1),this}compose(e,i,r){const s=this.elements,n=i._x,o=i._y,a=i._z,l=i._w,c=n+n,u=o+o,h=a+a,p=n*c,f=n*u,g=n*h,y=o*u,v=o*h,b=a*h,w=l*c,x=l*u,S=l*h,E=r.x,C=r.y,R=r.z;return s[0]=(1-(y+b))*E,s[1]=(f+S)*E,s[2]=(g-x)*E,s[3]=0,s[4]=(f-S)*C,s[5]=(1-(p+b))*C,s[6]=(v+w)*C,s[7]=0,s[8]=(g+x)*R,s[9]=(v-w)*R,s[10]=(1-(p+y))*R,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,i,r){const s=this.elements;let n=hA.set(s[0],s[1],s[2]).length();const o=hA.set(s[4],s[5],s[6]).length(),a=hA.set(s[8],s[9],s[10]).length();this.determinant()<0&&(n=-n),e.x=s[12],e.y=s[13],e.z=s[14],Yf.copy(this);const c=1/n,u=1/o,h=1/a;return Yf.elements[0]*=c,Yf.elements[1]*=c,Yf.elements[2]*=c,Yf.elements[4]*=u,Yf.elements[5]*=u,Yf.elements[6]*=u,Yf.elements[8]*=h,Yf.elements[9]*=h,Yf.elements[10]*=h,i.setFromRotationMatrix(Yf),r.x=n,r.y=o,r.z=a,this}makePerspective(e,i,r,s,n,o,a=Zm){const l=this.elements,c=2*n/(i-e),u=2*n/(r-s),h=(i+e)/(i-e),p=(r+s)/(r-s);let f,g;if(a===Zm)f=-(o+n)/(o-n),g=-2*o*n/(o-n);else if(a===aC)f=-o/(o-n),g=-o*n/(o-n);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=p,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=g,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,i,r,s,n,o,a=Zm){const l=this.elements,c=1/(i-e),u=1/(r-s),h=1/(o-n),p=(i+e)*c,f=(r+s)*u;let g,y;if(a===Zm)g=(o+n)*h,y=-2*h;else if(a===aC)g=n*h,y=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-p,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=y,l[14]=-g,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const i=this.elements,r=e.elements;for(let s=0;s<16;s++)if(i[s]!==r[s])return!1;return!0}fromArray(e,i=0){for(let r=0;r<16;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){const r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e[i+9]=r[9],e[i+10]=r[10],e[i+11]=r[11],e[i+12]=r[12],e[i+13]=r[13],e[i+14]=r[14],e[i+15]=r[15],e}}const hA=new ve,Yf=new kn,LJt=new ve(0,0,0),DJt=new ve(1,1,1),nb=new ve,wz=new ve,Wh=new ve,ECe=new kn,CCe=new k4;class T0{constructor(e=0,i=0,r=0,s=T0.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=r,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,r,s=this._order){return this._x=e,this._y=i,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,r=!0){const s=e.elements,n=s[0],o=s[4],a=s[8],l=s[1],c=s[5],u=s[9],h=s[2],p=s[6],f=s[10];switch(i){case"XYZ":this._y=Math.asin(Jl(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,n)):(this._x=Math.atan2(p,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Jl(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,n),this._z=0);break;case"ZXY":this._x=Math.asin(Jl(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,n));break;case"ZYX":this._y=Math.asin(-Jl(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(p,f),this._z=Math.atan2(l,n)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Jl(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,n)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-Jl(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(p,c),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,r){return ECe.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ECe,i,r)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return CCe.setFromEuler(this),this.setFromQuaternion(CCe,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}T0.DEFAULT_ORDER="XYZ";class FJt{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let kJt=0;const MCe=new ve,dA=new k4,w_=new kn,xz=new ve,I3=new ve,UJt=new ve,BJt=new k4,ACe=new ve(1,0,0),RCe=new ve(0,1,0),PCe=new ve(0,0,1),OCe={type:"added"},zJt={type:"removed"},pA={type:"childadded",child:null},JJ={type:"childremoved",child:null};class Sl extends VC{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:kJt++}),this.uuid=Dv(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Sl.DEFAULT_UP.clone();const e=new ve,i=new T0,r=new k4,s=new ve(1,1,1);function n(){r.setFromEuler(i,!1)}function o(){i.setFromQuaternion(r,void 0,!1)}i._onChange(n),r._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new kn},normalMatrix:{value:new Tf}}),this.matrix=new kn,this.matrixWorld=new kn,this.matrixAutoUpdate=Sl.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Sl.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new FJt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return dA.setFromAxisAngle(e,i),this.quaternion.multiply(dA),this}rotateOnWorldAxis(e,i){return dA.setFromAxisAngle(e,i),this.quaternion.premultiply(dA),this}rotateX(e){return this.rotateOnAxis(ACe,e)}rotateY(e){return this.rotateOnAxis(RCe,e)}rotateZ(e){return this.rotateOnAxis(PCe,e)}translateOnAxis(e,i){return MCe.copy(e).applyQuaternion(this.quaternion),this.position.add(MCe.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(ACe,e)}translateY(e){return this.translateOnAxis(RCe,e)}translateZ(e){return this.translateOnAxis(PCe,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(w_.copy(this.matrixWorld).invert())}lookAt(e,i,r){e.isVector3?xz.copy(e):xz.set(e,i,r);const s=this.parent;this.updateWorldMatrix(!0,!1),I3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?w_.lookAt(I3,xz,this.up):w_.lookAt(xz,I3,this.up),this.quaternion.setFromRotationMatrix(w_),s&&(w_.extractRotation(s.matrixWorld),dA.setFromRotationMatrix(w_),this.quaternion.premultiply(dA.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(OCe),pA.child=e,this.dispatchEvent(pA),pA.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(zJt),JJ.child=e,this.dispatchEvent(JJ),JJ.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),w_.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),w_.multiply(e.parent.matrixWorld)),e.applyMatrix4(w_),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(OCe),pA.child=e,this.dispatchEvent(pA),pA.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let r=0,s=this.children.length;r<s;r++){const o=this.children[r].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,r=[]){this[e]===i&&r.push(this);const s=this.children;for(let n=0,o=s.length;n<o;n++)s[n].getObjectsByProperty(e,i,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(I3,e,UJt),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(I3,BJt,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let r=0,s=i.length;r<s;r++){const n=i[r];(n.matrixWorldAutoUpdate===!0||e===!0)&&n.updateMatrixWorld(e)}}updateWorldMatrix(e,i){const r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const s=this.children;for(let n=0,o=s.length;n<o;n++){const a=s[n];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const i=e===void 0||typeof e=="string",r={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),s.maxGeometryCount=this._maxGeometryCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function n(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=n(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];n(e.shapes,h)}else n(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(n(e.materials,this.material[l]));s.material=a}else s.material=n(e.materials,this.material);if(this.children.length>0){s.children=[];for(let a=0;a<this.children.length;a++)s.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];s.animations.push(n(e.animations,l))}}if(i){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),h=o(e.shapes),p=o(e.skeletons),f=o(e.animations),g=o(e.nodes);a.length>0&&(r.geometries=a),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),p.length>0&&(r.skeletons=p),f.length>0&&(r.animations=f),g.length>0&&(r.nodes=g)}return r.object=s,r;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let r=0;r<e.children.length;r++){const s=e.children[r];this.add(s.clone())}return this}}Sl.DEFAULT_UP=new ve(0,1,0);Sl.DEFAULT_MATRIX_AUTO_UPDATE=!0;Sl.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Xf=new ve,x_=new ve,QJ=new ve,S_=new ve,fA=new ve,mA=new ve,ICe=new ve,KJ=new ve,eQ=new ve,tQ=new ve;class qy{constructor(e=new ve,i=new ve,r=new ve){this.a=e,this.b=i,this.c=r}static getNormal(e,i,r,s){s.subVectors(r,i),Xf.subVectors(e,i),s.cross(Xf);const n=s.lengthSq();return n>0?s.multiplyScalar(1/Math.sqrt(n)):s.set(0,0,0)}static getBarycoord(e,i,r,s,n){Xf.subVectors(s,i),x_.subVectors(r,i),QJ.subVectors(e,i);const o=Xf.dot(Xf),a=Xf.dot(x_),l=Xf.dot(QJ),c=x_.dot(x_),u=x_.dot(QJ),h=o*c-a*a;if(h===0)return n.set(0,0,0),null;const p=1/h,f=(c*l-a*u)*p,g=(o*u-a*l)*p;return n.set(1-f-g,g,f)}static containsPoint(e,i,r,s){return this.getBarycoord(e,i,r,s,S_)===null?!1:S_.x>=0&&S_.y>=0&&S_.x+S_.y<=1}static getInterpolation(e,i,r,s,n,o,a,l){return this.getBarycoord(e,i,r,s,S_)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(n,S_.x),l.addScaledVector(o,S_.y),l.addScaledVector(a,S_.z),l)}static isFrontFacing(e,i,r,s){return Xf.subVectors(r,i),x_.subVectors(e,i),Xf.cross(x_).dot(s)<0}set(e,i,r){return this.a.copy(e),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(e,i,r,s){return this.a.copy(e[i]),this.b.copy(e[r]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,i,r,s){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Xf.subVectors(this.c,this.b),x_.subVectors(this.a,this.b),Xf.cross(x_).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return qy.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return qy.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,r,s,n){return qy.getInterpolation(e,this.a,this.b,this.c,i,r,s,n)}containsPoint(e){return qy.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return qy.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const r=this.a,s=this.b,n=this.c;let o,a;fA.subVectors(s,r),mA.subVectors(n,r),KJ.subVectors(e,r);const l=fA.dot(KJ),c=mA.dot(KJ);if(l<=0&&c<=0)return i.copy(r);eQ.subVectors(e,s);const u=fA.dot(eQ),h=mA.dot(eQ);if(u>=0&&h<=u)return i.copy(s);const p=l*h-u*c;if(p<=0&&l>=0&&u<=0)return o=l/(l-u),i.copy(r).addScaledVector(fA,o);tQ.subVectors(e,n);const f=fA.dot(tQ),g=mA.dot(tQ);if(g>=0&&f<=g)return i.copy(n);const y=f*c-l*g;if(y<=0&&c>=0&&g<=0)return a=c/(c-g),i.copy(r).addScaledVector(mA,a);const v=u*g-f*h;if(v<=0&&h-u>=0&&f-g>=0)return ICe.subVectors(n,s),a=(h-u)/(h-u+(f-g)),i.copy(s).addScaledVector(ICe,a);const b=1/(v+y+p);return o=y*b,a=p*b,i.copy(r).addScaledVector(fA,o).addScaledVector(mA,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const _9e={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ob={h:0,s:0,l:0},Sz={h:0,s:0,l:0};function iQ(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*6*(2/3-i):t}class ds{constructor(e,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,r)}set(e,i,r){if(i===void 0&&r===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,i,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=di){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,qf.toWorkingColorSpace(this,i),this}setRGB(e,i,r,s=qf.workingColorSpace){return this.r=e,this.g=i,this.b=r,qf.toWorkingColorSpace(this,s),this}setHSL(e,i,r,s=qf.workingColorSpace){if(e=ffe(e,1),i=Jl(i,0,1),r=Jl(r,0,1),i===0)this.r=this.g=this.b=r;else{const n=r<=.5?r*(1+i):r+i-r*i,o=2*r-n;this.r=iQ(o,n,e+1/3),this.g=iQ(o,n,e),this.b=iQ(o,n,e-1/3)}return qf.toWorkingColorSpace(this,s),this}setStyle(e,i=di){function r(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let n;const o=s[1],a=s[2];switch(o){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,i);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,i);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=s[1],o=n.length;if(o===3)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,i);if(o===6)return this.setHex(parseInt(n,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=di){const r=_9e[e.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=rO(e.r),this.g=rO(e.g),this.b=rO(e.b),this}copyLinearToSRGB(e){return this.r=GJ(e.r),this.g=GJ(e.g),this.b=GJ(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=di){return qf.fromWorkingColorSpace(Tc.copy(this),e),Math.round(Jl(Tc.r*255,0,255))*65536+Math.round(Jl(Tc.g*255,0,255))*256+Math.round(Jl(Tc.b*255,0,255))}getHexString(e=di){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=qf.workingColorSpace){qf.fromWorkingColorSpace(Tc.copy(this),i);const r=Tc.r,s=Tc.g,n=Tc.b,o=Math.max(r,s,n),a=Math.min(r,s,n);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const h=o-a;switch(c=u<=.5?h/(o+a):h/(2-o-a),o){case r:l=(s-n)/h+(s<n?6:0);break;case s:l=(n-r)/h+2;break;case n:l=(r-s)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,i=qf.workingColorSpace){return qf.fromWorkingColorSpace(Tc.copy(this),i),e.r=Tc.r,e.g=Tc.g,e.b=Tc.b,e}getStyle(e=di){qf.fromWorkingColorSpace(Tc.copy(this),e);const i=Tc.r,r=Tc.g,s=Tc.b;return e!==di?`color(${e} ${i.toFixed(3)} ${r.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(r*255)},${Math.round(s*255)})`}offsetHSL(e,i,r){return this.getHSL(ob),this.setHSL(ob.h+e,ob.s+i,ob.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,r){return this.r=e.r+(i.r-e.r)*r,this.g=e.g+(i.g-e.g)*r,this.b=e.b+(i.b-e.b)*r,this}lerpHSL(e,i){this.getHSL(ob),e.getHSL(Sz);const r=ZD(ob.h,Sz.h,i),s=ZD(ob.s,Sz.s,i),n=ZD(ob.l,Sz.l,i);return this.setHSL(r,s,n),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const i=this.r,r=this.g,s=this.b,n=e.elements;return this.r=n[0]*i+n[3]*r+n[6]*s,this.g=n[1]*i+n[4]*r+n[7]*s,this.b=n[2]*i+n[5]*r+n[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Tc=new ds;ds.NAMES=_9e;let VJt=0;class $h extends VC{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:VJt++}),this.uuid=Dv(),this.name="",this.type="Material",this.blending=yE,this.side=lk,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=PH,this.blendDst=OH,this.blendEquation=pw,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ds(0,0,0),this.blendAlpha=0,this.depthFunc=IH,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Pae,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=c2,this.stencilZFail=c2,this.stencilZPass=c2,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const i in e){const r=e[i];if(r===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const s=this[i];if(s===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(r):s&&s.isVector3&&r&&r.isVector3?s.copy(r):this[i]=r}}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==yE&&(r.blending=this.blending),this.side!==lk&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==PH&&(r.blendSrc=this.blendSrc),this.blendDst!==OH&&(r.blendDst=this.blendDst),this.blendEquation!==pw&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==IH&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Pae&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==c2&&(r.stencilFail=this.stencilFail),this.stencilZFail!==c2&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==c2&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function s(n){const o=[];for(const a in n){const l=n[a];delete l.metadata,o.push(l)}return o}if(i){const n=s(e.textures),o=s(e.images);n.length>0&&(r.textures=n),o.length>0&&(r.images=o)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const i=e.clippingPlanes;let r=null;if(i!==null){const s=i.length;r=new Array(s);for(let n=0;n!==s;++n)r[n]=i[n].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class mfe extends $h{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ds(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new T0,this.combine=afe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const yv=GJt();function GJt(){const t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t),r=new Uint32Array(512),s=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(r[l]=0,r[l|256]=32768,s[l]=24,s[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,s[l]=-c-1,s[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,s[l]=13,s[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,s[l]=24,s[l|256]=24):(r[l]=31744,r[l|256]=64512,s[l]=13,s[l|256]=13)}const n=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,n[l]=c|u}for(let l=1024;l<2048;++l)n[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:i,baseTable:r,shiftTable:s,mantissaTable:n,exponentTable:o,offsetTable:a}}function Yh(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=Jl(t,-65504,65504),yv.floatView[0]=t;const e=yv.uint32View[0],i=e>>23&511;return yv.baseTable[i]+((e&8388607)>>yv.shiftTable[i])}function Tz(t){const e=t>>10;return yv.uint32View[0]=yv.mantissaTable[yv.offsetTable[e]+(t&1023)]+yv.exponentTable[e],yv.floatView[0]}const ia=new ve,Ez=new Xi;class lf{constructor(e,i,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=r,this.usage=DH,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Rd,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return g9e("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,r){e*=this.itemSize,r*=i.itemSize;for(let s=0,n=this.itemSize;s<n;s++)this.array[e+s]=i.array[r+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)Ez.fromBufferAttribute(this,i),Ez.applyMatrix3(e),this.setXY(i,Ez.x,Ez.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)ia.fromBufferAttribute(this,i),ia.applyMatrix3(e),this.setXYZ(i,ia.x,ia.y,ia.z);return this}applyMatrix4(e){for(let i=0,r=this.count;i<r;i++)ia.fromBufferAttribute(this,i),ia.applyMatrix4(e),this.setXYZ(i,ia.x,ia.y,ia.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)ia.fromBufferAttribute(this,i),ia.applyNormalMatrix(e),this.setXYZ(i,ia.x,ia.y,ia.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)ia.fromBufferAttribute(this,i),ia.transformDirection(e),this.setXYZ(i,ia.x,ia.y,ia.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let r=this.array[e*this.itemSize+i];return this.normalized&&(r=Mu(r,this.array)),r}setComponent(e,i,r){return this.normalized&&(r=Qi(r,this.array)),this.array[e*this.itemSize+i]=r,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=Mu(i,this.array)),i}setX(e,i){return this.normalized&&(i=Qi(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=Mu(i,this.array)),i}setY(e,i){return this.normalized&&(i=Qi(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=Mu(i,this.array)),i}setZ(e,i){return this.normalized&&(i=Qi(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=Mu(i,this.array)),i}setW(e,i){return this.normalized&&(i=Qi(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,r){return e*=this.itemSize,this.normalized&&(i=Qi(i,this.array),r=Qi(r,this.array)),this.array[e+0]=i,this.array[e+1]=r,this}setXYZ(e,i,r,s){return e*=this.itemSize,this.normalized&&(i=Qi(i,this.array),r=Qi(r,this.array),s=Qi(s,this.array)),this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=s,this}setXYZW(e,i,r,s,n){return e*=this.itemSize,this.normalized&&(i=Qi(i,this.array),r=Qi(r,this.array),s=Qi(s,this.array),n=Qi(n,this.array)),this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=s,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==DH&&(e.usage=this.usage),e}}class v9e extends lf{constructor(e,i,r){super(new Uint16Array(e),i,r)}}class b9e extends lf{constructor(e,i,r){super(new Uint32Array(e),i,r)}}class w9e extends lf{constructor(e,i,r){super(new Uint16Array(e),i,r),this.isFloat16BufferAttribute=!0}getX(e){let i=Tz(this.array[e*this.itemSize]);return this.normalized&&(i=Mu(i,this.array)),i}setX(e,i){return this.normalized&&(i=Qi(i,this.array)),this.array[e*this.itemSize]=Yh(i),this}getY(e){let i=Tz(this.array[e*this.itemSize+1]);return this.normalized&&(i=Mu(i,this.array)),i}setY(e,i){return this.normalized&&(i=Qi(i,this.array)),this.array[e*this.itemSize+1]=Yh(i),this}getZ(e){let i=Tz(this.array[e*this.itemSize+2]);return this.normalized&&(i=Mu(i,this.array)),i}setZ(e,i){return this.normalized&&(i=Qi(i,this.array)),this.array[e*this.itemSize+2]=Yh(i),this}getW(e){let i=Tz(this.array[e*this.itemSize+3]);return this.normalized&&(i=Mu(i,this.array)),i}setW(e,i){return this.normalized&&(i=Qi(i,this.array)),this.array[e*this.itemSize+3]=Yh(i),this}setXY(e,i,r){return e*=this.itemSize,this.normalized&&(i=Qi(i,this.array),r=Qi(r,this.array)),this.array[e+0]=Yh(i),this.array[e+1]=Yh(r),this}setXYZ(e,i,r,s){return e*=this.itemSize,this.normalized&&(i=Qi(i,this.array),r=Qi(r,this.array),s=Qi(s,this.array)),this.array[e+0]=Yh(i),this.array[e+1]=Yh(r),this.array[e+2]=Yh(s),this}setXYZW(e,i,r,s,n){return e*=this.itemSize,this.normalized&&(i=Qi(i,this.array),r=Qi(r,this.array),s=Qi(s,this.array),n=Qi(n,this.array)),this.array[e+0]=Yh(i),this.array[e+1]=Yh(r),this.array[e+2]=Yh(s),this.array[e+3]=Yh(n),this}}class cf extends lf{constructor(e,i,r){super(new Float32Array(e),i,r)}}let jJt=0;const dp=new kn,rQ=new Sl,gA=new ve,Xh=new GC,$3=new GC,el=new ve;class Kx extends VC{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:jJt++}),this.uuid=Dv(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(EJt(e)?b9e:v9e)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,r=0){this.groups.push({start:e,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const n=new Tf().getNormalMatrix(e);r.applyNormalMatrix(n),r.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return dp.makeRotationFromQuaternion(e),this.applyMatrix4(dp),this}rotateX(e){return dp.makeRotationX(e),this.applyMatrix4(dp),this}rotateY(e){return dp.makeRotationY(e),this.applyMatrix4(dp),this}rotateZ(e){return dp.makeRotationZ(e),this.applyMatrix4(dp),this}translate(e,i,r){return dp.makeTranslation(e,i,r),this.applyMatrix4(dp),this}scale(e,i,r){return dp.makeScale(e,i,r),this.applyMatrix4(dp),this}lookAt(e){return rQ.lookAt(e),rQ.updateMatrix(),this.applyMatrix4(rQ.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(gA).negate(),this.translate(gA.x,gA.y,gA.z),this}setFromPoints(e){const i=[];for(let r=0,s=e.length;r<s;r++){const n=e[r];i.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new cf(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new GC);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new ve(-1/0,-1/0,-1/0),new ve(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let r=0,s=i.length;r<s;r++){const n=i[r];Xh.setFromBufferAttribute(n),this.morphTargetsRelative?(el.addVectors(this.boundingBox.min,Xh.min),this.boundingBox.expandByPoint(el),el.addVectors(this.boundingBox.max,Xh.max),this.boundingBox.expandByPoint(el)):(this.boundingBox.expandByPoint(Xh.min),this.boundingBox.expandByPoint(Xh.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new U4);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new ve,1/0);return}if(e){const r=this.boundingSphere.center;if(Xh.setFromBufferAttribute(e),i)for(let n=0,o=i.length;n<o;n++){const a=i[n];$3.setFromBufferAttribute(a),this.morphTargetsRelative?(el.addVectors(Xh.min,$3.min),Xh.expandByPoint(el),el.addVectors(Xh.max,$3.max),Xh.expandByPoint(el)):(Xh.expandByPoint($3.min),Xh.expandByPoint($3.max))}Xh.getCenter(r);let s=0;for(let n=0,o=e.count;n<o;n++)el.fromBufferAttribute(e,n),s=Math.max(s,r.distanceToSquared(el));if(i)for(let n=0,o=i.length;n<o;n++){const a=i[n],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)el.fromBufferAttribute(a,c),l&&(gA.fromBufferAttribute(e,c),el.add(gA)),s=Math.max(s,r.distanceToSquared(el))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=i.position,s=i.normal,n=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new lf(new Float32Array(4*r.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let I=0;I<r.count;I++)a[I]=new ve,l[I]=new ve;const c=new ve,u=new ve,h=new ve,p=new Xi,f=new Xi,g=new Xi,y=new ve,v=new ve;function b(I,F,D){c.fromBufferAttribute(r,I),u.fromBufferAttribute(r,F),h.fromBufferAttribute(r,D),p.fromBufferAttribute(n,I),f.fromBufferAttribute(n,F),g.fromBufferAttribute(n,D),u.sub(c),h.sub(c),f.sub(p),g.sub(p);const z=1/(f.x*g.y-g.x*f.y);isFinite(z)&&(y.copy(u).multiplyScalar(g.y).addScaledVector(h,-f.y).multiplyScalar(z),v.copy(h).multiplyScalar(f.x).addScaledVector(u,-g.x).multiplyScalar(z),a[I].add(y),a[F].add(y),a[D].add(y),l[I].add(v),l[F].add(v),l[D].add(v))}let w=this.groups;w.length===0&&(w=[{start:0,count:e.count}]);for(let I=0,F=w.length;I<F;++I){const D=w[I],z=D.start,B=D.count;for(let Y=z,W=z+B;Y<W;Y+=3)b(e.getX(Y+0),e.getX(Y+1),e.getX(Y+2))}const x=new ve,S=new ve,E=new ve,C=new ve;function R(I){E.fromBufferAttribute(s,I),C.copy(E);const F=a[I];x.copy(F),x.sub(E.multiplyScalar(E.dot(F))).normalize(),S.crossVectors(C,F);const z=S.dot(l[I])<0?-1:1;o.setXYZW(I,x.x,x.y,x.z,z)}for(let I=0,F=w.length;I<F;++I){const D=w[I],z=D.start,B=D.count;for(let Y=z,W=z+B;Y<W;Y+=3)R(e.getX(Y+0)),R(e.getX(Y+1)),R(e.getX(Y+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new lf(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let p=0,f=r.count;p<f;p++)r.setXYZ(p,0,0,0);const s=new ve,n=new ve,o=new ve,a=new ve,l=new ve,c=new ve,u=new ve,h=new ve;if(e)for(let p=0,f=e.count;p<f;p+=3){const g=e.getX(p+0),y=e.getX(p+1),v=e.getX(p+2);s.fromBufferAttribute(i,g),n.fromBufferAttribute(i,y),o.fromBufferAttribute(i,v),u.subVectors(o,n),h.subVectors(s,n),u.cross(h),a.fromBufferAttribute(r,g),l.fromBufferAttribute(r,y),c.fromBufferAttribute(r,v),a.add(u),l.add(u),c.add(u),r.setXYZ(g,a.x,a.y,a.z),r.setXYZ(y,l.x,l.y,l.z),r.setXYZ(v,c.x,c.y,c.z)}else for(let p=0,f=i.count;p<f;p+=3)s.fromBufferAttribute(i,p+0),n.fromBufferAttribute(i,p+1),o.fromBufferAttribute(i,p+2),u.subVectors(o,n),h.subVectors(s,n),u.cross(h),r.setXYZ(p+0,u.x,u.y,u.z),r.setXYZ(p+1,u.x,u.y,u.z),r.setXYZ(p+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,r=e.count;i<r;i++)el.fromBufferAttribute(e,i),el.normalize(),e.setXYZ(i,el.x,el.y,el.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,h=a.normalized,p=new c.constructor(l.length*u);let f=0,g=0;for(let y=0,v=l.length;y<v;y++){a.isInterleavedBufferAttribute?f=l[y]*a.data.stride+a.offset:f=l[y]*u;for(let b=0;b<u;b++)p[g++]=c[f++]}return new lf(p,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Kx,r=this.index.array,s=this.attributes;for(const a in s){const l=s[a],c=e(l,r);i.setAttribute(a,c)}const n=this.morphAttributes;for(const a in n){const l=[],c=n[a];for(let u=0,h=c.length;u<h;u++){const p=c[u],f=e(p,r);l.push(f)}i.morphAttributes[a]=l}i.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];i.addGroup(c.start,c.count,c.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const r=this.attributes;for(const l in r){const c=r[l];e.data.attributes[l]=c.toJSON(e.data)}const s={};let n=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,p=c.length;h<p;h++){const f=c[h];u.push(f.toJSON(e.data))}u.length>0&&(s[l]=u,n=!0)}n&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(i));const s=e.attributes;for(const c in s){const u=s[c];this.setAttribute(c,u.clone(i))}const n=e.morphAttributes;for(const c in n){const u=[],h=n[c];for(let p=0,f=h.length;p<f;p++)u.push(h[p].clone(i));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const h=o[c];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const $Ce=new kn,QS=new NJt,Cz=new U4,NCe=new ve,yA=new ve,_A=new ve,vA=new ve,sQ=new ve,Mz=new ve,Az=new Xi,Rz=new Xi,Pz=new Xi,LCe=new ve,DCe=new ve,FCe=new ve,Oz=new ve,Iz=new ve;class eS extends Sl{constructor(e=new Kx,i=new mfe){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const s=i[r[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,o=s.length;n<o;n++){const a=s[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=n}}}}getVertexPosition(e,i){const r=this.geometry,s=r.attributes.position,n=r.morphAttributes.position,o=r.morphTargetsRelative;i.fromBufferAttribute(s,e);const a=this.morphTargetInfluences;if(n&&a){Mz.set(0,0,0);for(let l=0,c=n.length;l<c;l++){const u=a[l],h=n[l];u!==0&&(sQ.fromBufferAttribute(h,e),o?Mz.addScaledVector(sQ,u):Mz.addScaledVector(sQ.sub(i),u))}i.add(Mz)}return i}raycast(e,i){const r=this.geometry,s=this.material,n=this.matrixWorld;s!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),Cz.copy(r.boundingSphere),Cz.applyMatrix4(n),QS.copy(e.ray).recast(e.near),!(Cz.containsPoint(QS.origin)===!1&&(QS.intersectSphere(Cz,NCe)===null||QS.origin.distanceToSquared(NCe)>(e.far-e.near)**2))&&($Ce.copy(n).invert(),QS.copy(e.ray).applyMatrix4($Ce),!(r.boundingBox!==null&&QS.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,i,QS)))}_computeIntersections(e,i,r){let s;const n=this.geometry,o=this.material,a=n.index,l=n.attributes.position,c=n.attributes.uv,u=n.attributes.uv1,h=n.attributes.normal,p=n.groups,f=n.drawRange;if(a!==null)if(Array.isArray(o))for(let g=0,y=p.length;g<y;g++){const v=p[g],b=o[v.materialIndex],w=Math.max(v.start,f.start),x=Math.min(a.count,Math.min(v.start+v.count,f.start+f.count));for(let S=w,E=x;S<E;S+=3){const C=a.getX(S),R=a.getX(S+1),I=a.getX(S+2);s=$z(this,b,e,r,c,u,h,C,R,I),s&&(s.faceIndex=Math.floor(S/3),s.face.materialIndex=v.materialIndex,i.push(s))}}else{const g=Math.max(0,f.start),y=Math.min(a.count,f.start+f.count);for(let v=g,b=y;v<b;v+=3){const w=a.getX(v),x=a.getX(v+1),S=a.getX(v+2);s=$z(this,o,e,r,c,u,h,w,x,S),s&&(s.faceIndex=Math.floor(v/3),i.push(s))}}else if(l!==void 0)if(Array.isArray(o))for(let g=0,y=p.length;g<y;g++){const v=p[g],b=o[v.materialIndex],w=Math.max(v.start,f.start),x=Math.min(l.count,Math.min(v.start+v.count,f.start+f.count));for(let S=w,E=x;S<E;S+=3){const C=S,R=S+1,I=S+2;s=$z(this,b,e,r,c,u,h,C,R,I),s&&(s.faceIndex=Math.floor(S/3),s.face.materialIndex=v.materialIndex,i.push(s))}}else{const g=Math.max(0,f.start),y=Math.min(l.count,f.start+f.count);for(let v=g,b=y;v<b;v+=3){const w=v,x=v+1,S=v+2;s=$z(this,o,e,r,c,u,h,w,x,S),s&&(s.faceIndex=Math.floor(v/3),i.push(s))}}}}function HJt(t,e,i,r,s,n,o,a){let l;if(e.side===m1?l=r.intersectTriangle(o,n,s,!0,a):l=r.intersectTriangle(s,n,o,e.side===lk,a),l===null)return null;Iz.copy(a),Iz.applyMatrix4(t.matrixWorld);const c=i.ray.origin.distanceTo(Iz);return c<i.near||c>i.far?null:{distance:c,point:Iz.clone(),object:t}}function $z(t,e,i,r,s,n,o,a,l,c){t.getVertexPosition(a,yA),t.getVertexPosition(l,_A),t.getVertexPosition(c,vA);const u=HJt(t,e,i,r,yA,_A,vA,Oz);if(u){s&&(Az.fromBufferAttribute(s,a),Rz.fromBufferAttribute(s,l),Pz.fromBufferAttribute(s,c),u.uv=qy.getInterpolation(Oz,yA,_A,vA,Az,Rz,Pz,new Xi)),n&&(Az.fromBufferAttribute(n,a),Rz.fromBufferAttribute(n,l),Pz.fromBufferAttribute(n,c),u.uv1=qy.getInterpolation(Oz,yA,_A,vA,Az,Rz,Pz,new Xi)),o&&(LCe.fromBufferAttribute(o,a),DCe.fromBufferAttribute(o,l),FCe.fromBufferAttribute(o,c),u.normal=qy.getInterpolation(Oz,yA,_A,vA,LCe,DCe,FCe,new ve),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const h={a,b:l,c,normal:new ve,materialIndex:0};qy.getNormal(yA,_A,vA,h.normal),u.face=h}return u}class B4 extends Kx{constructor(e=1,i=1,r=1,s=1,n=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:r,widthSegments:s,heightSegments:n,depthSegments:o};const a=this;s=Math.floor(s),n=Math.floor(n),o=Math.floor(o);const l=[],c=[],u=[],h=[];let p=0,f=0;g("z","y","x",-1,-1,r,i,e,o,n,0),g("z","y","x",1,-1,r,i,-e,o,n,1),g("x","z","y",1,1,e,r,i,s,o,2),g("x","z","y",1,-1,e,r,-i,s,o,3),g("x","y","z",1,-1,e,i,r,s,n,4),g("x","y","z",-1,-1,e,i,-r,s,n,5),this.setIndex(l),this.setAttribute("position",new cf(c,3)),this.setAttribute("normal",new cf(u,3)),this.setAttribute("uv",new cf(h,2));function g(y,v,b,w,x,S,E,C,R,I,F){const D=S/R,z=E/I,B=S/2,Y=E/2,W=C/2,J=R+1,me=I+1;let L=0,k=0;const H=new ve;for(let q=0;q<me;q++){const Q=q*z-Y;for(let K=0;K<J;K++){const re=K*D-B;H[y]=re*w,H[v]=Q*x,H[b]=W,c.push(H.x,H.y,H.z),H[y]=0,H[v]=0,H[b]=C>0?1:-1,u.push(H.x,H.y,H.z),h.push(K/R),h.push(1-q/I),L+=1}}for(let q=0;q<I;q++)for(let Q=0;Q<R;Q++){const K=p+Q+J*q,re=p+Q+J*(q+1),be=p+(Q+1)+J*(q+1),Re=p+(Q+1)+J*q;l.push(K,re,Re),l.push(re,be,Re),k+=6}a.addGroup(f,k,F),f+=k,p+=L}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new B4(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function x9e(t){const e={};for(const i in t){e[i]={};for(const r in t[i]){const s=t[i][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][r]=null):e[i][r]=s.clone():Array.isArray(s)?e[i][r]=s.slice():e[i][r]=s}}return e}function qJt(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}var WJt=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,YJt=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class XJt extends $h{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=WJt,this.fragmentShader=YJt,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=x9e(e.uniforms),this.uniformsGroups=qJt(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?i.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?i.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?i.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?i.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?i.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?i.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?i.uniforms[s]={type:"m4",value:o.toArray()}:i.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const r={};for(const s in this.extensions)this.extensions[s]===!0&&(r[s]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}}class S9e extends Sl{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new kn,this.projectionMatrix=new kn,this.projectionMatrixInverse=new kn,this.coordinateSystem=Zm}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const ab=new ve,kCe=new Xi,UCe=new Xi;class Ny extends S9e{constructor(e=50,i=1,r=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=s,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const i=.5*this.getFilmHeight()/e;this.fov=hk*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(XD*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return hk*2*Math.atan(Math.tan(XD*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,i,r){ab.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(ab.x,ab.y).multiplyScalar(-e/ab.z),ab.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(ab.x,ab.y).multiplyScalar(-e/ab.z)}getViewSize(e,i){return this.getViewBounds(e,kCe,UCe),i.subVectors(UCe,kCe)}setViewOffset(e,i,r,s,n,o){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=s,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let i=e*Math.tan(XD*.5*this.fov)/this.zoom,r=2*i,s=this.aspect*r,n=-.5*s;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;n+=o.offsetX*s/l,i-=o.offsetY*r/c,s*=o.width/l,r*=o.height/c}const a=this.filmOffset;a!==0&&(n+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+s,i,i-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const bA=-90,wA=1;class T9e extends Sl{constructor(e,i,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new Ny(bA,wA,e,i);s.layers=this.layers,this.add(s);const n=new Ny(bA,wA,e,i);n.layers=this.layers,this.add(n);const o=new Ny(bA,wA,e,i);o.layers=this.layers,this.add(o);const a=new Ny(bA,wA,e,i);a.layers=this.layers,this.add(a);const l=new Ny(bA,wA,e,i);l.layers=this.layers,this.add(l);const c=new Ny(bA,wA,e,i);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,i=this.children.concat(),[r,s,n,o,a,l]=i;for(const c of i)this.remove(c);if(e===Zm)r.up.set(0,1,0),r.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),n.up.set(0,0,-1),n.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===aC)r.up.set(0,-1,0),r.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),n.up.set(0,0,1),n.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of i)this.add(c),c.updateMatrixWorld()}update(e,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[n,o,a,l,c,u]=this.children,h=e.getRenderTarget(),p=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),g=e.xr.enabled;e.xr.enabled=!1;const y=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,s),e.render(i,n),e.setRenderTarget(r,1,s),e.render(i,o),e.setRenderTarget(r,2,s),e.render(i,a),e.setRenderTarget(r,3,s),e.render(i,l),e.setRenderTarget(r,4,s),e.render(i,c),r.texture.generateMipmaps=y,e.setRenderTarget(r,5,s),e.render(i,u),e.setRenderTarget(h,p,f),e.xr.enabled=g,r.texture.needsPMREMUpdate=!0}}class E9e extends Lu{constructor(e,i,r,s,n,o,a,l,c,u){e=e!==void 0?e:[],i=i!==void 0?i:uk,super(e,i,r,s,n,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class ZJt extends OJt{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},s=[r,r,r,r,r,r];this.texture=new E9e(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:yf}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new B4(5,5,5),n=new XJt({name:"CubemapFromEquirect",uniforms:x9e(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:m1,blending:vI});n.uniforms.tEquirect.value=i;const o=new eS(s,n),a=i.minFilter;return i.minFilter===_E&&(i.minFilter=yf),new T9e(1,10,this).update(e,o),i.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,i,r,s){const n=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(i,r,s);e.setRenderTarget(n)}}const nQ=new ve,JJt=new ve,QJt=new Tf;class rw{constructor(e=new ve(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,r,s){return this.normal.set(e,i,r),this.constant=s,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,r){const s=nQ.subVectors(r,i).cross(JJt.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){const r=e.delta(nQ),s=this.normal.dot(r);if(s===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;const n=-(e.start.dot(this.normal)+this.constant)/s;return n<0||n>1?null:i.copy(e.start).addScaledVector(r,n)}intersectsLine(e){const i=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return i<0&&r>0||r<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){const r=i||QJt.getNormalMatrix(e),s=this.coplanarPoint(nQ).applyMatrix4(e),n=this.normal.applyMatrix3(r).normalize();return this.constant=-s.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const KS=new U4,Nz=new ve;class C9e{constructor(e=new rw,i=new rw,r=new rw,s=new rw,n=new rw,o=new rw){this.planes=[e,i,r,s,n,o]}set(e,i,r,s,n,o){const a=this.planes;return a[0].copy(e),a[1].copy(i),a[2].copy(r),a[3].copy(s),a[4].copy(n),a[5].copy(o),this}copy(e){const i=this.planes;for(let r=0;r<6;r++)i[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,i=Zm){const r=this.planes,s=e.elements,n=s[0],o=s[1],a=s[2],l=s[3],c=s[4],u=s[5],h=s[6],p=s[7],f=s[8],g=s[9],y=s[10],v=s[11],b=s[12],w=s[13],x=s[14],S=s[15];if(r[0].setComponents(l-n,p-c,v-f,S-b).normalize(),r[1].setComponents(l+n,p+c,v+f,S+b).normalize(),r[2].setComponents(l+o,p+u,v+g,S+w).normalize(),r[3].setComponents(l-o,p-u,v-g,S-w).normalize(),r[4].setComponents(l-a,p-h,v-y,S-x).normalize(),i===Zm)r[5].setComponents(l+a,p+h,v+y,S+x).normalize();else if(i===aC)r[5].setComponents(a,h,y,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),KS.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const i=e.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),KS.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(KS)}intersectsSprite(e){return KS.center.set(0,0,0),KS.radius=.7071067811865476,KS.applyMatrix4(e.matrixWorld),this.intersectsSphere(KS)}intersectsSphere(e){const i=this.planes,r=e.center,s=-e.radius;for(let n=0;n<6;n++)if(i[n].distanceToPoint(r)<s)return!1;return!0}intersectsBox(e){const i=this.planes;for(let r=0;r<6;r++){const s=i[r];if(Nz.x=s.normal.x>0?e.max.x:e.min.x,Nz.y=s.normal.y>0?e.max.y:e.min.y,Nz.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(Nz)<0)return!1}return!0}containsPoint(e){const i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class UH extends Kx{constructor(e=1,i=1,r=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:r,heightSegments:s};const n=e/2,o=i/2,a=Math.floor(r),l=Math.floor(s),c=a+1,u=l+1,h=e/a,p=i/l,f=[],g=[],y=[],v=[];for(let b=0;b<u;b++){const w=b*p-o;for(let x=0;x<c;x++){const S=x*h-n;g.push(S,-w,0),y.push(0,0,1),v.push(x/a),v.push(1-b/l)}}for(let b=0;b<l;b++)for(let w=0;w<a;w++){const x=w+c*b,S=w+c*(b+1),E=w+1+c*(b+1),C=w+1+c*b;f.push(x,S,C),f.push(S,E,C)}this.setIndex(f),this.setAttribute("position",new cf(g,3)),this.setAttribute("normal",new cf(y,3)),this.setAttribute("uv",new cf(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new UH(e.width,e.height,e.widthSegments,e.heightSegments)}}class gfe extends S9e{constructor(e=-1,i=1,r=1,s=-1,n=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=r,this.bottom=s,this.near=n,this.far=o,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,r,s,n,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=s,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let n=r-e,o=r+e,a=s+i,l=s-i;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=c*this.view.offsetX,o=n+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(n,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}class h$ extends Lu{constructor(e,i,r,s,n,o,a,l,c,u=bE){if(u!==bE&&u!==bI)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===bE&&(r=xd),r===void 0&&u===bI&&(r=D4),super(null,s,n,o,a,l,u,r,c),this.isDepthTexture=!0,this.image={width:e,height:i},this.magFilter=a!==void 0?a:za,this.minFilter=l!==void 0?l:za,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const i=super.toJSON(e);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}const KJt=new h$(1,1);KJt.compareFunction=pfe;class yfe extends Sl{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new T0,this.environmentIntensity=1,this.environmentRotation=new T0,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}class M9e{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=e!==void 0?e.length/i:0,this.usage=DH,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Dv()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return g9e("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,r){e*=this.stride,r*=i.stride;for(let s=0,n=this.stride;s<n;s++)this.array[e+s]=i.array[r+s];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Dv()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(i,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Dv()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const uu=new ve;class _fe{constructor(e,i,r,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=r,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,r=this.data.count;i<r;i++)uu.fromBufferAttribute(this,i),uu.applyMatrix4(e),this.setXYZ(i,uu.x,uu.y,uu.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)uu.fromBufferAttribute(this,i),uu.applyNormalMatrix(e),this.setXYZ(i,uu.x,uu.y,uu.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)uu.fromBufferAttribute(this,i),uu.transformDirection(e),this.setXYZ(i,uu.x,uu.y,uu.z);return this}getComponent(e,i){let r=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(r=Mu(r,this.array)),r}setComponent(e,i,r){return this.normalized&&(r=Qi(r,this.array)),this.data.array[e*this.data.stride+this.offset+i]=r,this}setX(e,i){return this.normalized&&(i=Qi(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=Qi(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=Qi(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=Qi(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=Mu(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=Mu(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=Mu(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=Mu(i,this.array)),i}setXY(e,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(i=Qi(i,this.array),r=Qi(r,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this}setXYZ(e,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=Qi(i,this.array),r=Qi(r,this.array),s=Qi(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=s,this}setXYZW(e,i,r,s,n){return e=e*this.data.stride+this.offset,this.normalized&&(i=Qi(i,this.array),r=Qi(r,this.array),s=Qi(s,this.array),n=Qi(n,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=s,this.data.array[e+3]=n,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)i.push(this.data.array[s+n])}return new lf(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new _fe(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)i.push(this.data.array[s+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class eQt extends $h{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ds(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class A9e extends Lu{constructor(e=null,i=1,r=1,s,n,o,a,l,c=za,u=za,h,p){super(null,o,a,l,c,u,s,n,h,p),this.isDataTexture=!0,this.image={data:e,width:i,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Oae extends lf{constructor(e,i,r,s=1){super(e,i,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const xA=new kn,BCe=new kn,Lz=[],zCe=new GC,tQt=new kn,N3=new eS,L3=new U4;class VCe extends eS{constructor(e,i,r){super(e,i),this.isInstancedMesh=!0,this.instanceMatrix=new Oae(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<r;s++)this.setMatrixAt(s,tQt)}computeBoundingBox(){const e=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new GC),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,xA),zCe.copy(e.boundingBox).applyMatrix4(xA),this.boundingBox.union(zCe)}computeBoundingSphere(){const e=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new U4),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,xA),L3.copy(e.boundingSphere).applyMatrix4(xA),this.boundingSphere.union(L3)}copy(e,i){return super.copy(e,i),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,i){i.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,i){i.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,i){const r=i.morphTargetInfluences,s=this.morphTexture.source.data.data,n=r.length+1,o=e*n+1;for(let a=0;a<r.length;a++)r[a]=s[o+a]}raycast(e,i){const r=this.matrixWorld,s=this.count;if(N3.geometry=this.geometry,N3.material=this.material,N3.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),L3.copy(this.boundingSphere),L3.applyMatrix4(r),e.ray.intersectsSphere(L3)!==!1))for(let n=0;n<s;n++){this.getMatrixAt(n,xA),BCe.multiplyMatrices(r,xA),N3.matrixWorld=BCe,N3.raycast(e,Lz);for(let o=0,a=Lz.length;o<a;o++){const l=Lz[o];l.instanceId=n,l.object=this,i.push(l)}Lz.length=0}}setColorAt(e,i){this.instanceColor===null&&(this.instanceColor=new Oae(new Float32Array(this.instanceMatrix.count*3),3)),i.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,i){i.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,i){const r=i.morphTargetInfluences,s=r.length+1;this.morphTexture===null&&(this.morphTexture=new A9e(new Float32Array(s*this.count),s,this.count,q7,Rd));const n=this.morphTexture.source.data.data;let o=0;for(let c=0;c<r.length;c++)o+=r[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=s*e;n[l]=a,n.set(r,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class R9e extends $h{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ds(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}class P9e extends $h{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ds(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class O9e extends Lu{constructor(e,i){super({width:e,height:i}),this.isFramebufferTexture=!0,this.magFilter=za,this.minFilter=za,this.generateMipmaps=!1,this.needsUpdate=!0}}class vfe extends Kx{constructor(e=1,i=32,r=16,s=0,n=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:r,phiStart:s,phiLength:n,thetaStart:o,thetaLength:a},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));const l=Math.min(o+a,Math.PI);let c=0;const u=[],h=new ve,p=new ve,f=[],g=[],y=[],v=[];for(let b=0;b<=r;b++){const w=[],x=b/r;let S=0;b===0&&o===0?S=.5/i:b===r&&l===Math.PI&&(S=-.5/i);for(let E=0;E<=i;E++){const C=E/i;h.x=-e*Math.cos(s+C*n)*Math.sin(o+x*a),h.y=e*Math.cos(o+x*a),h.z=e*Math.sin(s+C*n)*Math.sin(o+x*a),g.push(h.x,h.y,h.z),p.copy(h).normalize(),y.push(p.x,p.y,p.z),v.push(C+S,1-x),w.push(c++)}u.push(w)}for(let b=0;b<r;b++)for(let w=0;w<i;w++){const x=u[b][w+1],S=u[b][w],E=u[b+1][w],C=u[b+1][w+1];(b!==0||o>0)&&f.push(x,S,C),(b!==r-1||l<Math.PI)&&f.push(S,E,C)}this.setIndex(f),this.setAttribute("position",new cf(g,3)),this.setAttribute("normal",new cf(y,3)),this.setAttribute("uv",new cf(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vfe(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class iQt extends $h{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ds(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class I9e extends $h{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ds(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ds(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ex,this.normalScale=new Xi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new T0,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class rQt extends I9e{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Xi(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Jl(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ds(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ds(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ds(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class sQt extends $h{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ds(16777215),this.specular=new ds(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ds(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ex,this.normalScale=new Xi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new T0,this.combine=afe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nQt extends $h{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ds(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ds(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ex,this.normalScale=new Xi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class oQt extends $h{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ex,this.normalScale=new Xi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class aQt extends $h{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ds(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ds(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ex,this.normalScale=new Xi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new T0,this.combine=afe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class lQt extends $h{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ds(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ex,this.normalScale=new Xi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class $9e extends R9e{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}const GCe={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class cQt{constructor(e,i,r){const s=this;let n=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=r,this.itemStart=function(u){a++,n===!1&&s.onStart!==void 0&&s.onStart(u,o,a),n=!0},this.itemEnd=function(u){o++,s.onProgress!==void 0&&s.onProgress(u,o,a),o===a&&(n=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(u){s.onError!==void 0&&s.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,p=c.length;h<p;h+=2){const f=c[h],g=c[h+1];if(f.global&&(f.lastIndex=0),f.test(u))return g}return null}}}const uQt=new cQt;class bfe{constructor(e){this.manager=e!==void 0?e:uQt,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){const r=this;return new Promise(function(s,n){r.load(e,s,i,n)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}bfe.DEFAULT_MATERIAL_NAME="__DEFAULT";class hQt extends bfe{constructor(e){super(e)}load(e,i,r,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const n=this,o=GCe.get(e);if(o!==void 0)return n.manager.itemStart(e),setTimeout(function(){i&&i(o),n.manager.itemEnd(e)},0),o;const a=kH("img");function l(){u(),GCe.add(e,this),i&&i(this),n.manager.itemEnd(e)}function c(h){u(),s&&s(h),n.manager.itemError(e),n.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a}}class dQt extends bfe{constructor(e){super(e)}load(e,i,r,s){const n=new Lu,o=new hQt(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){n.image=a,n.needsUpdate=!0,i!==void 0&&i(n)},r,s),n}}class z4 extends Sl{constructor(e,i=1){super(),this.isLight=!0,this.type="Light",this.color=new ds(e),this.intensity=i}dispose(){}copy(e,i){return super.copy(e,i),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),i}}class pQt extends z4{constructor(e,i,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Sl.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ds(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}}const oQ=new kn,jCe=new ve,HCe=new ve;class wfe{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Xi(512,512),this.map=null,this.mapPass=null,this.matrix=new kn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new C9e,this._frameExtents=new Xi(1,1),this._viewportCount=1,this._viewports=[new Fs(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const i=this.camera,r=this.matrix;jCe.setFromMatrixPosition(e.matrixWorld),i.position.copy(jCe),HCe.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(HCe),i.updateMatrixWorld(),oQ.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(oQ),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(oQ)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class fQt extends wfe{constructor(){super(new Ny(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const i=this.camera,r=hk*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,n=e.distance||i.far;(r!==i.fov||s!==i.aspect||n!==i.far)&&(i.fov=r,i.aspect=s,i.far=n,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class N9e extends z4{constructor(e,i,r=0,s=Math.PI/3,n=0,o=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Sl.DEFAULT_UP),this.updateMatrix(),this.target=new Sl,this.distance=r,this.angle=s,this.penumbra=n,this.decay=o,this.map=null,this.shadow=new fQt}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const qCe=new kn,D3=new ve,aQ=new ve;class mQt extends wfe{constructor(){super(new Ny(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Xi(4,2),this._viewportCount=6,this._viewports=[new Fs(2,1,1,1),new Fs(0,1,1,1),new Fs(3,1,1,1),new Fs(1,1,1,1),new Fs(3,0,1,1),new Fs(1,0,1,1)],this._cubeDirections=[new ve(1,0,0),new ve(-1,0,0),new ve(0,0,1),new ve(0,0,-1),new ve(0,1,0),new ve(0,-1,0)],this._cubeUps=[new ve(0,1,0),new ve(0,1,0),new ve(0,1,0),new ve(0,1,0),new ve(0,0,1),new ve(0,0,-1)]}updateMatrices(e,i=0){const r=this.camera,s=this.matrix,n=e.distance||r.far;n!==r.far&&(r.far=n,r.updateProjectionMatrix()),D3.setFromMatrixPosition(e.matrixWorld),r.position.copy(D3),aQ.copy(r.position),aQ.add(this._cubeDirections[i]),r.up.copy(this._cubeUps[i]),r.lookAt(aQ),r.updateMatrixWorld(),s.makeTranslation(-D3.x,-D3.y,-D3.z),qCe.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(qCe)}}class gQt extends z4{constructor(e,i,r=0,s=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=s,this.shadow=new mQt}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class yQt extends wfe{constructor(){super(new gfe(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class L9e extends z4{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Sl.DEFAULT_UP),this.updateMatrix(),this.target=new Sl,this.shadow=new yQt}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class D9e extends z4{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class _Qt extends M9e{constructor(e,i,r=1){super(e,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const i=super.clone(e);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(e){const i=super.toJSON(e);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:H7}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=H7);const WCe={VERTEX:"vertex",FRAGMENT:"fragment"},es={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},vQt=["fragment","vertex"],YCe=["setup","analyze","generate"],bQt=[...vQt,"compute"],V4=["x","y","z","w"];function F9e(t,e=!1){let i="{";t.isNode===!0&&(i+=t.id);for(const{property:r,childNode:s}of BH(t))i+=","+r.slice(0,-4)+":"+s.getCacheKey(e);return i+="}",i}function*BH(t,e=!1){for(const i in t){if(i.startsWith("_")===!0)continue;const r=t[i];if(Array.isArray(r)===!0)for(let s=0;s<r.length;s++){const n=r[s];n&&(n.isNode===!0||e&&typeof n.toJSON=="function")&&(yield{property:i,index:s,childNode:n})}else if(r&&r.isNode===!0)yield{property:i,childNode:r};else if(typeof r=="object")for(const s in r){const n=r[s];n&&(n.isNode===!0||e&&typeof n.toJSON=="function")&&(yield{property:i,index:s,childNode:n})}}}function Mw(t){if(t==null)return null;const e=typeof t;return t.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":t.isVector2===!0?"vec2":t.isVector3===!0?"vec3":t.isVector4===!0?"vec4":t.isMatrix3===!0?"mat3":t.isMatrix4===!0?"mat4":t.isColor===!0?"color":t instanceof ArrayBuffer?"ArrayBuffer":null}function k9e(t,...e){const i=t?t.slice(-4):void 0;return e.length===1&&(i==="vec2"?e=[e[0],e[0]]:i==="vec3"?e=[e[0],e[0],e[0]]:i==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),t==="color"?new ds(...e):i==="vec2"?new Xi(...e):i==="vec3"?new ve(...e):i==="vec4"?new Fs(...e):i==="mat3"?new Tf(...e):i==="mat4"?new kn(...e):t==="bool"?e[0]||!1:t==="float"||t==="int"||t==="uint"?e[0]||0:t==="string"?e[0]||"":t==="ArrayBuffer"?B9e(e[0]):null}function U9e(t){let e="";const i=new Uint8Array(t);for(let r=0;r<i.length;r++)e+=String.fromCharCode(i[r]);return btoa(e)}function B9e(t){return Uint8Array.from(atob(t),e=>e.charCodeAt(0)).buffer}const XCe=new Map;let wQt=0,mi=class extends VC{constructor(e=null){super(),this.nodeType=e,this.updateType=es.NONE,this.updateBeforeType=es.NONE,this.uuid=m9e.generateUUID(),this.version=0,this._cacheKey=null,this._cacheKeyVersion=0,this.global=!1,this.isNode=!0,Object.defineProperty(this,"id",{value:wQt++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,i){return this.updateType=i,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,es.FRAME)}onRenderUpdate(e){return this.onUpdate(e,es.RENDER)}onObjectUpdate(e){return this.onUpdate(e,es.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of BH(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const i of this.getChildren())i.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=F9e(this,e),this._cacheKeyVersion=this.version),this._cacheKey}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getElementType(e){const i=this.getNodeType(e);return e.getElementType(i)}getNodeType(e){const i=e.getNodeProperties(this);return i.outputNode?i.outputNode.getNodeType(e):this.nodeType}getShared(e){const i=this.getHash(e);return e.getNodeFromHash(i)||this}setup(e){const i=e.getNodeProperties(this);let r=0;for(const s of this.getChildren())i["node"+r++]=s;return null}construct(e){return console.warn("THREE.Node: construct() is deprecated. Use setup() instead."),this.setup(e)}increaseUsage(e){const i=e.getDataFromNode(this);return i.usageCount=i.usageCount===void 0?1:i.usageCount+1,i.usageCount}analyze(e){if(this.increaseUsage(e)===1){const r=e.getNodeProperties(this);for(const s of Object.values(r))s&&s.isNode===!0&&s.build(e)}}generate(e,i){const{outputNode:r}=e.getNodeProperties(this);if(r&&r.isNode===!0)return r.build(e,i)}updateBefore(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,i=null){const r=this.getShared(e);if(this!==r)return r.build(e,i);e.addNode(this),e.addChain(this);let s=null;const n=e.getBuildStage();if(n==="setup"){this.updateReference(e);const o=e.getNodeProperties(this);if(o.initialized!==!0||e.context.tempRead===!1){const a=e.stack.nodes.length;o.initialized=!0,o.outputNode=this.setup(e),o.outputNode!==null&&e.stack.nodes.length!==a&&(o.outputNode=e.stack);for(const l of Object.values(o))l&&l.isNode===!0&&l.build(e)}}else if(n==="analyze")this.analyze(e);else if(n==="generate")if(this.generate.length===1){const a=this.getNodeType(e),l=e.getDataFromNode(this);s=l.snippet,s===void 0&&(s=this.generate(e)||"",l.snippet=s),s=e.format(s,a,i)}else s=this.generate(e,i)||"";return e.removeChain(this),s}getSerializeChildren(){return BH(this)}serialize(e){const i=this.getSerializeChildren(),r={};for(const{property:s,index:n,childNode:o}of i)n!==void 0?(r[s]===void 0&&(r[s]=Number.isInteger(n)?[]:{}),r[s][n]=o.toJSON(e.meta).uuid):r[s]=o.toJSON(e.meta).uuid;Object.keys(r).length>0&&(e.inputNodes=r)}deserialize(e){if(e.inputNodes!==void 0){const i=e.meta.nodes;for(const r in e.inputNodes)if(Array.isArray(e.inputNodes[r])){const s=[];for(const n of e.inputNodes[r])s.push(i[n]);this[r]=s}else if(typeof e.inputNodes[r]=="object"){const s={};for(const n in e.inputNodes[r]){const o=e.inputNodes[r][n];s[n]=i[o]}this[r]=s}else{const s=e.inputNodes[r];this[r]=i[s]}}}toJSON(e){const{uuid:i,type:r}=this,s=e===void 0||typeof e=="string";s&&(e={textures:{},images:{},nodes:{}});let n=e.nodes[i];n===void 0&&(n={uuid:i,type:r,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},s!==!0&&(e.nodes[n.uuid]=n),this.serialize(n),delete n.meta);function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}if(s){const a=o(e.textures),l=o(e.images),c=o(e.nodes);a.length>0&&(n.textures=a),l.length>0&&(n.images=l),c.length>0&&(n.nodes=c)}return n}};function Ue(t,e){if(typeof e!="function"||!t)throw new Error(`Node class ${t} is not a class`);if(XCe.has(t)){console.warn(`Redefinition of node class ${t}`);return}XCe.set(t,e),e.type=t}class dn extends mi{constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,i){if(e.getBuildStage()==="generate"){const s=e.getVectorType(this.getNodeType(e,i)),n=e.getDataFromNode(this);if(e.context.tempRead!==!1&&n.propertyName!==void 0)return e.format(n.propertyName,s,i);if(e.context.tempWrite!==!1&&s!=="void"&&i!=="void"&&this.hasDependencies(e)){const o=super.build(e,s),a=e.getVarFromNode(this,null,s),l=e.getPropertyName(a);return e.addLineFlowCode(`${l} = ${o}`),n.snippet=o,n.propertyName=l,e.format(n.propertyName,s,i)}}return super.build(e,i)}}Ue("TempNode",dn);class d$ extends mi{constructor(e,i){super(),this.node=e,this.indexNode=i,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const i=this.node.build(e),r=this.indexNode.build(e,"uint");return`${i}[ ${r} ]`}}Ue("ArrayElementNode",d$);class xfe extends mi{constructor(e,i){super(),this.node=e,this.convertTo=i}getNodeType(e){const i=this.node.getNodeType(e);let r=null;for(const s of this.convertTo.split("|"))(r===null||e.getTypeLength(i)===e.getTypeLength(s))&&(r=s);return r}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,i){const r=this.node,s=this.getNodeType(e),n=r.build(e,s);return e.format(n,s,i)}}Ue("ConvertNode",xfe);class z9e extends dn{constructor(e=[],i=null){super(i),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((i,r)=>i+e.getTypeLength(r.getNodeType(e)),0))}generate(e,i){const r=this.getNodeType(e),s=this.nodes,n=e.getComponentType(r),o=[];for(const l of s){let c=l.build(e);const u=e.getComponentType(l.getNodeType(e));u!==n&&(c=e.format(c,u,n)),o.push(c)}const a=`${e.getType(r)}( ${o.join(", ")} )`;return e.format(a,r,i)}}Ue("JoinNode",z9e);const xQt=V4.join("");class Iae extends mi{constructor(e,i="x"){super(),this.node=e,this.components=i,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const i of this.components)e=Math.max(V4.indexOf(i)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,i){const r=this.node,s=e.getTypeLength(r.getNodeType(e));let n=null;if(s>1){let o=null;this.getVectorLength()>=s&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const l=r.build(e,o);this.components.length===s&&this.components===xQt.slice(0,this.components.length)?n=e.format(l,o,i):n=e.format(`${l}.${this.components}`,this.getNodeType(e),i)}else n=r.build(e,i);return n}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}Ue("SplitNode",Iae);class V9e extends dn{constructor(e,i,r){super(),this.sourceNode=e,this.components=i,this.targetNode=r}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:i,components:r,targetNode:s}=this,n=this.getNodeType(e),o=e.getTypeFromLength(r.length),a=s.build(e,o),l=i.build(e,n),c=e.getTypeLength(n),u=[];for(let h=0;h<c;h++){const p=V4[h];p===r[0]?(u.push(a),h+=r.length-1):u.push(l+"."+p)}return`${e.getType(n)}( ${u.join(", ")} )`}}Ue("SetNode",V9e);class W7 extends mi{constructor(e,i=null){super(i),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?Mw(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=Mw(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=U9e(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?k9e(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}Ue("InputNode",W7);class W0 extends W7{constructor(e,i=null){super(e,i),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,i){const r=this.getNodeType(e);return e.format(this.generateConst(e),r,i)}}Ue("ConstNode",W0);let wI=null;const fP=new Map;function fe(t,e){if(fP.has(t)){console.warn(`Redefinition of node element ${t}`);return}if(typeof e!="function")throw new Error(`Node element ${t} is not a function`);fP.set(t,e)}const ZCe=t=>t.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),G9e={setup(t,e){const i=e.shift();return t(Z7(i),...e)},get(t,e,i){if(typeof e=="string"&&t[e]===void 0){if(t.isStackNode!==!0&&e==="assign")return(...r)=>(wI.assign(i,...r),i);if(fP.has(e)){const r=fP.get(e);return t.isStackNode?(...s)=>i.add(r(...s)):(...s)=>r(i,...s)}else{if(e==="self")return t;if(e.endsWith("Assign")&&fP.has(e.slice(0,e.length-6))){const r=fP.get(e.slice(0,e.length-6));return t.isStackNode?(...s)=>i.assign(s[0],r(...s)):(...s)=>i.assign(r(i,...s))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=ZCe(e),gt(new Iae(i,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=ZCe(e.slice(3).toLowerCase()),e=e.split("").sort().join(""),r=>gt(new V9e(t,e,r));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),gt(new Iae(t,e));if(/^\d+$/.test(e)===!0)return gt(new d$(i,new W0(Number(e),"uint")))}}}return Reflect.get(t,e,i)},set(t,e,i,r){return typeof e=="string"&&t[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(r[e].assign(i),!0):Reflect.set(t,e,i,r)}},lQ=new WeakMap,JCe=new WeakMap,SQt=function(t,e=null){const i=Mw(t);if(i==="node"){let r=lQ.get(t);return r===void 0&&(r=new Proxy(t,G9e),lQ.set(t,r),lQ.set(r,r)),r}else{if(e===null&&(i==="float"||i==="boolean")||i&&i!=="shader"&&i!=="string")return gt($ae(t,e));if(i==="shader")return Oe(t)}return t},TQt=function(t,e=null){for(const i in t)t[i]=gt(t[i],e);return t},EQt=function(t,e=null){const i=t.length;for(let r=0;r<i;r++)t[r]=gt(t[r],e);return t},CQt=function(t,e=null,i=null,r=null){const s=n=>gt(r!==null?Object.assign(n,r):n);return e===null?(...n)=>s(new t(...sO(n))):i!==null?(i=gt(i),(...n)=>s(new t(e,...sO(n),i))):(...n)=>s(new t(e,...sO(n)))},MQt=function(t,...e){return gt(new t(...sO(e)))};class AQt extends mi{constructor(e,i){super(),this.shaderNode=e,this.inputNodes=i}getNodeType(e){const i=e.getNodeProperties(this);return i.outputNode===null&&(i.outputNode=this.setupOutput(e)),i.outputNode.getNodeType(e)}call(e){const{shaderNode:i,inputNodes:r}=this;if(i.layout){let o=JCe.get(e.constructor);o===void 0&&(o=new WeakMap,JCe.set(e.constructor,o));let a=o.get(i);return a===void 0&&(a=gt(e.buildFunctionNode(i)),o.set(i,a)),e.currentFunctionNode!==null&&e.currentFunctionNode.includes.push(a),gt(a.call(r))}const s=i.jsFunc,n=r!==null?s(r,e.stack,e):s(e.stack,e);return gt(n)}setup(e){const{outputNode:i}=e.getNodeProperties(this);return i||this.setupOutput(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,i){const{outputNode:r}=e.getNodeProperties(this);return r===null?this.call(e).build(e,i):super.generate(e,i)}}class RQt extends mi{constructor(e){super(),this.jsFunc=e,this.layout=null}get isArrayInput(){return/^\((\s+)?\[/.test(this.jsFunc.toString())}setLayout(e){return this.layout=e,this}call(e=null){return Z7(e),gt(new AQt(this,e))}setup(){return this.call()}}const PQt=[!1,!0],OQt=[0,1,2,3],IQt=[-1,-2],j9e=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],Sfe=new Map;for(const t of PQt)Sfe.set(t,new W0(t));const Tfe=new Map;for(const t of OQt)Tfe.set(t,new W0(t,"uint"));const Efe=new Map([...Tfe].map(t=>new W0(t.value,"int")));for(const t of IQt)Efe.set(t,new W0(t,"int"));const Y7=new Map([...Efe].map(t=>new W0(t.value)));for(const t of j9e)Y7.set(t,new W0(t));for(const t of j9e)Y7.set(-t,new W0(-t));const X7={bool:Sfe,uint:Tfe,ints:Efe,float:Y7},QCe=new Map([...Sfe,...Y7]),$ae=(t,e)=>QCe.has(t)?QCe.get(t):t.isNode===!0?t:new W0(t,e),$Qt=t=>{try{return t.getNodeType()}catch{return}},zs=function(t,e=null){return(...i)=>{if((i.length===0||!["bool","float","int","uint"].includes(t)&&i.every(s=>typeof s!="object"))&&(i=[k9e(t,...i)]),i.length===1&&e!==null&&e.has(i[0]))return gt(e.get(i[0]));if(i.length===1){const s=$ae(i[0],t);return $Qt(s)===t?gt(s):gt(new xfe(s,t))}const r=i.map(s=>$ae(s));return gt(new z9e(r,t))}},KCe=t=>t&&t.value,NQt=t=>t!=null?t.nodeType||t.convertTo||(typeof t=="string"?t:null):null;function JD(t){return new Proxy(new RQt(t),G9e)}const gt=(t,e=null)=>SQt(t,e),Z7=(t,e=null)=>new TQt(t,e),sO=(t,e=null)=>new EQt(t,e),Ee=(...t)=>new CQt(...t),ot=(...t)=>new MQt(...t),Oe=t=>{const e=new JD(t),i=(...r)=>{let s;return Z7(r),r[0]&&r[0].isNode?s=[...r]:s=r[0],e.call(s)};return i.shaderNode=e,i.setLayout=r=>(e.setLayout(r),i),i};Ue("ShaderNode",JD);fe("toGlobal",t=>(t.global=!0,t));const zH=t=>{wI=t},H9e=()=>wI,xr=(...t)=>wI.if(...t);function LQt(t){return wI&&wI.add(t),t}fe("append",LQt);const $R=new zs("color"),X=new zs("float",X7.float),te=new zs("int",X7.ints),ft=new zs("uint",X7.uint),lC=new zs("bool",X7.bool),Vt=new zs("vec2"),j2=new zs("ivec2"),DQt=new zs("uvec2"),FQt=new zs("bvec2"),ne=new zs("vec3"),kQt=new zs("ivec3"),G4=new zs("uvec3"),q9e=new zs("bvec3"),Ft=new zs("vec4"),UQt=new zs("ivec4"),BQt=new zs("uvec4"),zQt=new zs("bvec4"),Cfe=new zs("mat2"),VQt=new zs("imat2"),GQt=new zs("umat2"),jQt=new zs("bmat2"),Sg=new zs("mat3"),HQt=new zs("imat3"),qQt=new zs("umat3"),WQt=new zs("bmat3"),nO=new zs("mat4"),YQt=new zs("imat4"),XQt=new zs("umat4"),ZQt=new zs("bmat4");fe("toColor",$R);fe("toFloat",X);fe("toInt",te);fe("toUint",ft);fe("toBool",lC);fe("toVec2",Vt);fe("toIvec2",j2);fe("toUvec2",DQt);fe("toBvec2",FQt);fe("toVec3",ne);fe("toIvec3",kQt);fe("toUvec3",G4);fe("toBvec3",q9e);fe("toVec4",Ft);fe("toIvec4",UQt);fe("toUvec4",BQt);fe("toBvec4",zQt);fe("toMat2",Cfe);fe("toImat2",VQt);fe("toUmat2",GQt);fe("toBmat2",jQt);fe("toMat3",Sg);fe("toImat3",HQt);fe("toUmat3",qQt);fe("toBmat3",WQt);fe("toMat4",nO);fe("toImat4",YQt);fe("toUmat4",XQt);fe("toBmat4",ZQt);const JQt=Ee(d$),QQt=(t,e)=>gt(new xfe(gt(t),e));fe("element",JQt);fe("convert",QQt);class W9e extends dn{constructor(e,i){super(),this.targetNode=e,this.sourceNode=i}hasDependencies(){return!1}getNodeType(e,i){return i!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:i}=this;if(e.isAvailable("swizzleAssign")===!1&&i.isSplitNode&&i.components.length>1){const r=e.getTypeLength(i.node.getNodeType(e));return V4.join("").slice(0,r)!==i.components}return!1}generate(e,i){const{targetNode:r,sourceNode:s}=this,n=this.needsSplitAssign(e),o=r.getNodeType(e),a=r.context({assign:!0}).build(e),l=s.build(e,o),c=s.getNodeType(e),u=e.getDataFromNode(this);let h;if(u.initialized===!0)i!=="void"&&(h=a);else if(n){const p=e.getVarFromNode(this,null,o),f=e.getPropertyName(p);e.addLineFlowCode(`${f} = ${l}`);const g=r.node.context({assign:!0}).build(e);for(let y=0;y<r.components.length;y++){const v=r.components[y];e.addLineFlowCode(`${g}.${v} = ${f}[ ${y} ]`)}i!=="void"&&(h=a)}else h=`${a} = ${l}`,(i==="void"||c==="void")&&(e.addLineFlowCode(h),i!=="void"&&(h=a));return u.initialized=!0,e.format(h,o,i)}}const KQt=Ee(W9e);Ue("AssignNode",W9e);fe("assign",KQt);class Y9e extends mi{constructor(e,i=null){super(),this.node=e,this.name=i,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const i=e.getNodeProperties(this);let r=i.varying;if(r===void 0){const s=this.name,n=this.getNodeType(e);i.varying=r=e.getVaryingFromNode(this,s,n),i.node=this.node}return r.needsInterpolation||(r.needsInterpolation=e.shaderStage==="fragment"),r}setup(e){this.setupVarying(e)}generate(e){const i=e.getNodeProperties(this),r=this.setupVarying(e);if(i.propertyName===void 0){const s=this.getNodeType(e),n=e.getPropertyName(r,WCe.VERTEX);e.flowNodeFromShaderStage(WCe.VERTEX,this.node,s,n),i.propertyName=n}return e.getPropertyName(r)}}const Ta=Ee(Y9e);fe("varying",Ta);Ue("VaryingNode",Y9e);class Mfe extends mi{constructor(e,i=null,r=null){super(i),this.defaultNode=r,this._attributeName=e}isGlobal(){return!0}getHash(e){return this.getAttributeName(e)}getNodeType(e){let i=super.getNodeType(e);if(i===null){const r=this.getAttributeName(e);if(e.hasGeometryAttribute(r)){const s=e.geometry.getAttribute(r);i=e.getTypeFromAttribute(s)}else i="float"}return i}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const i=this.getAttributeName(e),r=this.getNodeType(e);if(e.hasGeometryAttribute(i)===!0){const n=e.geometry.getAttribute(i),o=e.getTypeFromAttribute(n),a=e.getAttribute(i,o);return e.shaderStage==="vertex"?e.format(a.name,o,r):Ta(this).build(e,r)}else{console.warn(`AttributeNode: Vertex attribute "${i}" not found on geometry.`);const{defaultNode:n}=this;return n!==null?n.build(e,r):e.generateConst(r)}}}const ml=(t,e,i)=>gt(new Mfe(t,e,gt(i)));Ue("AttributeNode",Mfe);class X9e extends mi{constructor(e,i){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=i}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const i=this.callNode.build(e,"void");return i!==""&&e.addLineFlowCode(i),this.outputNode.build(e)}}const Z9e=Ee(X9e);fe("bypass",Z9e);Ue("BypassNode",X9e);let eKt=0;class Nae{constructor(){this.id=eKt++,this.nodesData=new WeakMap}getNodeData(e){return this.nodesData.get(e)}setNodeData(e,i){this.nodesData.set(e,i)}}class J9e extends mi{constructor(e,i=new Nae){super(),this.isCacheNode=!0,this.node=e,this.cache=i}getNodeType(e){return this.node.getNodeType(e)}build(e,...i){const r=e.getCache(),s=this.cache||e.globalCache;e.setCache(s);const n=this.node.build(e,...i);return e.setCache(r),n}}const VH=Ee(J9e),tKt=t=>VH(t,null);fe("cache",VH);fe("globalCache",tKt);Ue("CacheNode",J9e);class Afe extends mi{constructor(e,i={}){super(),this.isContextNode=!0,this.node=e,this.context=i}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){const i=e.getContext();e.setContext({...e.context,...this.context});const r=this.node.build(e);return e.setContext(i),r}generate(e,i){const r=e.getContext();e.setContext({...e.context,...this.context});const s=this.node.build(e,i);return e.setContext(r),s}}const p0=Ee(Afe),iKt=(t,e)=>p0(t,{label:e});fe("context",p0);fe("label",iKt);Ue("ContextNode",Afe);class E0 extends mi{constructor(e){super("uint"),this.scope=e,this.isInstanceIndexNode=!0}generate(e){const i=this.getNodeType(e),r=this.scope;let s;if(r===E0.VERTEX)s=e.getVertexIndex();else if(r===E0.INSTANCE)s=e.getInstanceIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+r);let n;return e.shaderStage==="vertex"||e.shaderStage==="compute"?n=s:n=Ta(this).build(e,i),n}}E0.VERTEX="vertex";E0.INSTANCE="instance";const rKt=ot(E0,E0.VERTEX),Q9e=ot(E0,E0.INSTANCE);Ue("IndexNode",E0);class J7{start(){}finish(){}direct(){}indirectDiffuse(){}indirectSpecular(){}ambientOcclusion(){}}class K9e extends mi{constructor(e,i=null){super(),this.node=e,this.name=i,this.isVarNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:i,name:r}=this,s=e.getVarFromNode(this,r,e.getVectorType(this.getNodeType(e))),n=e.getPropertyName(s),o=i.build(e,s.type);return e.addLineFlowCode(`${n} = ${o}`),n}}const GH=Ee(K9e);fe("temp",GH);fe("toVar",(...t)=>GH(...t).append());Ue("VarNode",K9e);class eMe{constructor(e,i,r=null){this.isNodeAttribute=!0,this.name=e,this.type=i,this.node=r}}class sKt{constructor(e,i,r,s=void 0){this.isNodeUniform=!0,this.name=e,this.type=i,this.node=r.getSelf(),this.needsUpdate=s}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class e7e{constructor(e,i){this.isNodeVar=!0,this.name=e,this.type=i}}class nKt extends e7e{constructor(e,i){super(e,i),this.needsInterpolation=!1,this.isNodeVarying=!0}}class oKt{constructor(e,i,r=""){this.name=e,this.type=i,this.code=r,Object.defineProperty(this,"isNodeCode",{value:!0})}}class aKt{constructor(){this.keywords=[],this.nodes={},this.keywordsCallback={}}getNode(e){let i=this.nodes[e];return i===void 0&&this.keywordsCallback[e]!==void 0&&(i=this.keywordsCallback[e](e),this.nodes[e]=i),i}addKeyword(e,i){return this.keywords.push(e),this.keywordsCallback[e]=i,this}parse(e){const i=this.keywords,r=new RegExp(`\\b${i.join("\\b|\\b")}\\b`,"g"),s=e.match(r),n=[];if(s!==null)for(const o of s){const a=this.getNode(o);a!==void 0&&n.indexOf(a)===-1&&n.push(a)}return n}include(e,i){const r=this.parse(i);for(const s of r)s.build(e)}}class Es extends mi{constructor(e,i=null,r=!1){super(e),this.name=i,this.varying=r,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let i;return this.varying===!0?(i=e.getVaryingFromNode(this,this.name),i.needsInterpolation=!0):i=e.getVarFromNode(this,this.name),e.getPropertyName(i)}}const so=(t,e)=>gt(new Es(t,e)),Ry=(t,e)=>gt(new Es(t,e,!0)),Sn=ot(Es,"vec4","DiffuseColor"),Aw=ot(Es,"float","Roughness"),jH=ot(Es,"float","Metalness"),Lae=ot(Es,"float","Clearcoat"),HH=ot(Es,"float","ClearcoatRoughness"),mP=ot(Es,"vec3","Sheen"),Rfe=ot(Es,"float","SheenRoughness"),Pfe=ot(Es,"float","Iridescence"),t7e=ot(Es,"float","IridescenceIOR"),i7e=ot(Es,"float","IridescenceThickness"),Dae=ot(Es,"float","AlphaT"),u2=ot(Es,"float","Anisotropy"),I6=ot(Es,"vec3","AnisotropyT"),oO=ot(Es,"vec3","AnisotropyB"),Cm=ot(Es,"color","SpecularColor"),qH=ot(Es,"float","SpecularF90"),Fae=ot(Es,"float","Shininess"),lKt=ot(Es,"vec4","Output"),aO=ot(Es,"float","dashSize"),WH=ot(Es,"float","gapSize");ot(Es,"float","pointWidth");const $6=ot(Es,"float","IOR"),kae=ot(Es,"float","Transmission"),r7e=ot(Es,"float","Thickness"),s7e=ot(Es,"float","AttenuationDistance"),n7e=ot(Es,"color","AttenuationColor"),o7e=ot(Es,"float","Dispersion");Ue("PropertyNode",Es);class Uae extends Es{constructor(e,i=null){super(e,i),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}Ue("ParameterNode",Uae);class wu extends mi{constructor(e="",i=[],r=""){super("code"),this.isCodeNode=!0,this.code=e,this.language=r,this.includes=i}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const i=this.getIncludes(e);for(const s of i)s.build(e);const r=e.getCodeFromNode(this,this.getNodeType(e));return r.code=this.code,r.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}Ee(wu);Ue("CodeNode",wu);class a7e extends wu{constructor(e="",i=[],r=""){super(e,i,r),this.keywords={}}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const i=e.getDataFromNode(this);let r=i.nodeFunction;return r===void 0&&(r=e.parser.parseFunction(this.code),i.nodeFunction=r),r}generate(e,i){super.generate(e);const r=this.getNodeFunction(e),s=r.name,n=r.type,o=e.getCodeFromNode(this,n);s!==""&&(o.name=s);const a=e.getPropertyName(o);let l=this.getNodeFunction(e).getCode(a);const c=this.keywords,u=Object.keys(c);if(u.length>0)for(const h of u){const p=new RegExp(`\\b${h}\\b`,"g"),f=c[h].build(e,"property");l=l.replace(p,f)}return o.code=l+`
`,i==="property"?a:e.format(`${a}()`,n,i)}}Ue("FunctionNode",a7e);class Ofe extends mi{constructor(e,i=!1){super("string"),this.name=e,this.version=0,this.shared=i,this.isUniformGroup=!0}set needsUpdate(e){e===!0&&this.version++}}const cKt=t=>new Ofe(t),l7e=t=>new Ofe(t,!0),uKt=l7e("frame"),hKt=l7e("render"),c7e=cKt("object");Ue("UniformGroupNode",Ofe);class tS extends W7{constructor(e,i=null){super(e,i),this.isUniformNode=!0,this.groupNode=c7e}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,i){const r=this.getSelf();return e=e.bind(r),super.onUpdate(s=>{const n=e(s,r);n!==void 0&&(this.value=n)},i)}generate(e,i){const r=this.getNodeType(e),s=this.getUniformHash(e);let n=e.getNodeFromHash(s);n===void 0&&(e.setHashNode(this,s),n=this);const o=n.getInputType(e),a=e.getUniformFromNode(n,o,e.shaderStage,e.context.label),l=e.getPropertyName(a);return e.context.label!==void 0&&delete e.context.label,e.format(l,r,i)}}const Tr=(t,e)=>{const i=NQt(e||t),r=t&&t.isNode===!0?t.node&&t.node.value||t.value:t;return gt(new tS(r,i))};Ue("UniformNode",tS);const Ef=t=>ml("uv"+(t>0?t:""),"vec2");class u7e extends mi{constructor(e,i=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=i}generate(e,i){const r=this.textureNode.build(e,"property"),s=this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${r}, ${s} )`,this.getNodeType(e),i)}}const Ife=Ee(u7e);fe("textureSize",Ife);Ue("TextureSizeNode",u7e);class Qn extends dn{constructor(e,i,r,...s){if(super(),this.op=e,s.length>0){let n=r;for(let o=0;o<s.length;o++)n=new Qn(e,n,s[o]);r=n}this.aNode=i,this.bNode=r}getNodeType(e,i){const r=this.op,s=this.aNode,n=this.bNode,o=s.getNodeType(e),a=typeof n<"u"?n.getNodeType(e):null;if(o==="void"||a==="void")return"void";if(r==="%")return o;if(r==="~"||r==="&"||r==="|"||r==="^"||r===">>"||r==="<<")return e.getIntegerType(o);if(r==="!"||r==="=="||r==="&&"||r==="||"||r==="^^")return"bool";if(r==="<"||r===">"||r==="<="||r===">="){const l=i?e.getTypeLength(i):Math.max(e.getTypeLength(o),e.getTypeLength(a));return l>1?`bvec${l}`:"bool"}else return o==="float"&&e.isMatrix(a)?a:e.isMatrix(o)&&e.isVector(a)?e.getVectorFromMatrix(o):e.isVector(o)&&e.isMatrix(a)?e.getVectorFromMatrix(a):e.getTypeLength(a)>e.getTypeLength(o)?a:o}generate(e,i){const r=this.op,s=this.aNode,n=this.bNode,o=this.getNodeType(e,i);let a=null,l=null;o!=="void"?(a=s.getNodeType(e),l=typeof n<"u"?n.getNodeType(e):null,r==="<"||r===">"||r==="<="||r===">="||r==="=="?e.isVector(a)?l=a:a=l="float":r===">>"||r==="<<"?(a=o,l=e.changeComponentType(l,"uint")):e.isMatrix(a)&&e.isVector(l)?l=e.getVectorFromMatrix(a):e.isVector(a)&&e.isMatrix(l)?a=e.getVectorFromMatrix(l):a=l=o):a=l=o;const c=s.build(e,a),u=typeof n<"u"?n.build(e,l):null,h=e.getTypeLength(i),p=e.getFunctionOperator(r);if(i!=="void")return r==="<"&&h>1?e.format(`${e.getMethod("lessThan")}( ${c}, ${u} )`,o,i):r==="<="&&h>1?e.format(`${e.getMethod("lessThanEqual")}( ${c}, ${u} )`,o,i):r===">"&&h>1?e.format(`${e.getMethod("greaterThan")}( ${c}, ${u} )`,o,i):r===">="&&h>1?e.format(`${e.getMethod("greaterThanEqual")}( ${c}, ${u} )`,o,i):r==="!"||r==="~"?e.format(`(${r}${c})`,a,i):p?e.format(`${p}( ${c}, ${u} )`,o,i):e.format(`( ${c} ${r} ${u} )`,o,i);if(a!=="void")return p?e.format(`${p}( ${c}, ${u} )`,o,i):e.format(`${c} ${r} ${u}`,o,i)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Jd=Ee(Qn,"+"),Yo=Ee(Qn,"-"),Xr=Ee(Qn,"*"),Cx=Ee(Qn,"/"),dKt=Ee(Qn,"%"),pKt=Ee(Qn,"=="),fKt=Ee(Qn,"!="),mKt=Ee(Qn,"<"),h7e=Ee(Qn,">"),gKt=Ee(Qn,"<="),yKt=Ee(Qn,">="),_Kt=Ee(Qn,"&&"),vKt=Ee(Qn,"||"),bKt=Ee(Qn,"!"),wKt=Ee(Qn,"^^"),xKt=Ee(Qn,"&"),SKt=Ee(Qn,"~"),TKt=Ee(Qn,"|"),EKt=Ee(Qn,"^"),CKt=Ee(Qn,"<<"),MKt=Ee(Qn,">>");fe("add",Jd);fe("sub",Yo);fe("mul",Xr);fe("div",Cx);fe("remainder",dKt);fe("equal",pKt);fe("notEqual",fKt);fe("lessThan",mKt);fe("greaterThan",h7e);fe("lessThanEqual",gKt);fe("greaterThanEqual",yKt);fe("and",_Kt);fe("or",vKt);fe("not",bKt);fe("xor",wKt);fe("bitAnd",xKt);fe("bitNot",SKt);fe("bitOr",TKt);fe("bitXor",EKt);fe("shiftLeft",CKt);fe("shiftRight",MKt);Ue("OperatorNode",Qn);class pe extends dn{constructor(e,i,r=null,s=null){super(),this.method=e,this.aNode=i,this.bNode=r,this.cNode=s}getInputType(e){const i=this.aNode.getNodeType(e),r=this.bNode?this.bNode.getNodeType(e):null,s=this.cNode?this.cNode.getNodeType(e):null,n=e.isMatrix(i)?0:e.getTypeLength(i),o=e.isMatrix(r)?0:e.getTypeLength(r),a=e.isMatrix(s)?0:e.getTypeLength(s);return n>o&&n>a?i:o>a?r:a>n?s:i}getNodeType(e){const i=this.method;return i===pe.LENGTH||i===pe.DISTANCE||i===pe.DOT?"float":i===pe.CROSS?"vec3":i===pe.ALL?"bool":i===pe.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):i===pe.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,i){const r=this.method,s=this.getNodeType(e),n=this.getInputType(e),o=this.aNode,a=this.bNode,l=this.cNode,c=e.renderer.isWebGLRenderer===!0;if(r===pe.TRANSFORM_DIRECTION){let u=o,h=a;e.isMatrix(u.getNodeType(e))?h=Ft(ne(h),0):u=Ft(ne(u),0);const p=Xr(u,h).xyz;return dk(p).build(e,i)}else{if(r===pe.NEGATE)return e.format("( - "+o.build(e,n)+" )",s,i);if(r===pe.ONE_MINUS)return Yo(1,o).build(e,i);if(r===pe.RECIPROCAL)return Cx(1,o).build(e,i);if(r===pe.DIFFERENCE)return ma(Yo(o,a)).build(e,i);{const u=[];return r===pe.CROSS||r===pe.MOD?u.push(o.build(e,s),a.build(e,s)):r===pe.STEP?u.push(o.build(e,e.getTypeLength(o.getNodeType(e))===1?"float":n),a.build(e,n)):c&&(r===pe.MIN||r===pe.MAX)||r===pe.MOD?u.push(o.build(e,n),a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":n)):r===pe.REFRACT?u.push(o.build(e,n),a.build(e,n),l.build(e,"float")):r===pe.MIX?u.push(o.build(e,n),a.build(e,n),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":n)):(u.push(o.build(e,n)),a!==null&&u.push(a.build(e,n)),l!==null&&u.push(l.build(e,n))),e.format(`${e.getMethod(r,s)}( ${u.join(", ")} )`,s,i)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}pe.ALL="all";pe.ANY="any";pe.EQUALS="equals";pe.RADIANS="radians";pe.DEGREES="degrees";pe.EXP="exp";pe.EXP2="exp2";pe.LOG="log";pe.LOG2="log2";pe.SQRT="sqrt";pe.INVERSE_SQRT="inversesqrt";pe.FLOOR="floor";pe.CEIL="ceil";pe.NORMALIZE="normalize";pe.FRACT="fract";pe.SIN="sin";pe.COS="cos";pe.TAN="tan";pe.ASIN="asin";pe.ACOS="acos";pe.ATAN="atan";pe.ABS="abs";pe.SIGN="sign";pe.LENGTH="length";pe.NEGATE="negate";pe.ONE_MINUS="oneMinus";pe.DFDX="dFdx";pe.DFDY="dFdy";pe.ROUND="round";pe.RECIPROCAL="reciprocal";pe.TRUNC="trunc";pe.FWIDTH="fwidth";pe.BITCAST="bitcast";pe.ATAN2="atan2";pe.MIN="min";pe.MAX="max";pe.MOD="mod";pe.STEP="step";pe.REFLECT="reflect";pe.DISTANCE="distance";pe.DIFFERENCE="difference";pe.DOT="dot";pe.CROSS="cross";pe.POW="pow";pe.TRANSFORM_DIRECTION="transformDirection";pe.MIX="mix";pe.CLAMP="clamp";pe.REFRACT="refract";pe.SMOOTHSTEP="smoothstep";pe.FACEFORWARD="faceforward";const d7e=X(1e-6);X(1e6);const tMe=X(Math.PI);X(Math.PI*2);const p7e=Ee(pe,pe.ALL),AKt=Ee(pe,pe.ANY),RKt=Ee(pe,pe.EQUALS),PKt=Ee(pe,pe.RADIANS),OKt=Ee(pe,pe.DEGREES),f7e=Ee(pe,pe.EXP),Bae=Ee(pe,pe.EXP2),m7e=Ee(pe,pe.LOG),Q7=Ee(pe,pe.LOG2),jC=Ee(pe,pe.SQRT),IKt=Ee(pe,pe.INVERSE_SQRT),p$=Ee(pe,pe.FLOOR),g7e=Ee(pe,pe.CEIL),dk=Ee(pe,pe.NORMALIZE),K7=Ee(pe,pe.FRACT),uv=Ee(pe,pe.SIN),sw=Ee(pe,pe.COS),$Kt=Ee(pe,pe.TAN),NKt=Ee(pe,pe.ASIN),LKt=Ee(pe,pe.ACOS),DKt=Ee(pe,pe.ATAN),ma=Ee(pe,pe.ABS),$fe=Ee(pe,pe.SIGN),lO=Ee(pe,pe.LENGTH),FKt=Ee(pe,pe.NEGATE),kKt=Ee(pe,pe.ONE_MINUS),UKt=Ee(pe,pe.DFDX),BKt=Ee(pe,pe.DFDY),zKt=Ee(pe,pe.ROUND),VKt=Ee(pe,pe.RECIPROCAL),y7e=Ee(pe,pe.TRUNC),GKt=Ee(pe,pe.FWIDTH);Ee(pe,pe.BITCAST);const jKt=Ee(pe,pe.ATAN2),Um=Ee(pe,pe.MIN),rc=Ee(pe,pe.MAX),HKt=Ee(pe,pe.MOD),qKt=Ee(pe,pe.STEP),WKt=Ee(pe,pe.REFLECT),YKt=Ee(pe,pe.DISTANCE),XKt=Ee(pe,pe.DIFFERENCE),f$=Ee(pe,pe.DOT),_7e=Ee(pe,pe.CROSS),i0=Ee(pe,pe.POW),v7e=Ee(pe,pe.POW,2),ZKt=Ee(pe,pe.POW,3),JKt=Ee(pe,pe.POW,4),QKt=Ee(pe,pe.TRANSFORM_DIRECTION),KKt=t=>Xr($fe(t),i0(ma(t),1/3)),eei=t=>f$(t,t),Po=Ee(pe,pe.MIX),xI=(t,e=0,i=1)=>gt(new pe(pe.CLAMP,gt(t),gt(e),gt(i))),tei=t=>xI(t),b7e=Ee(pe,pe.REFRACT),C0=Ee(pe,pe.SMOOTHSTEP),iei=Ee(pe,pe.FACEFORWARD),rei=(t,e,i)=>Po(e,i,t),sei=(t,e,i)=>C0(e,i,t);fe("all",p7e);fe("any",AKt);fe("equals",RKt);fe("radians",PKt);fe("degrees",OKt);fe("exp",f7e);fe("exp2",Bae);fe("log",m7e);fe("log2",Q7);fe("sqrt",jC);fe("inverseSqrt",IKt);fe("floor",p$);fe("ceil",g7e);fe("normalize",dk);fe("fract",K7);fe("sin",uv);fe("cos",sw);fe("tan",$Kt);fe("asin",NKt);fe("acos",LKt);fe("atan",DKt);fe("abs",ma);fe("sign",$fe);fe("length",lO);fe("lengthSq",eei);fe("negate",FKt);fe("oneMinus",kKt);fe("dFdx",UKt);fe("dFdy",BKt);fe("round",zKt);fe("reciprocal",VKt);fe("trunc",y7e);fe("fwidth",GKt);fe("atan2",jKt);fe("min",Um);fe("max",rc);fe("mod",HKt);fe("step",qKt);fe("reflect",WKt);fe("distance",YKt);fe("dot",f$);fe("cross",_7e);fe("pow",i0);fe("pow2",v7e);fe("pow3",ZKt);fe("pow4",JKt);fe("transformDirection",QKt);fe("mix",rei);fe("clamp",xI);fe("refract",b7e);fe("smoothstep",sei);fe("faceForward",iei);fe("difference",XKt);fe("saturate",tei);fe("cbrt",KKt);Ue("MathNode",pe);const nei=Oe(t=>{const{value:e}=t,{rgb:i}=e,r=i.mul(.9478672986).add(.0521327014).pow(2.4),s=i.mul(.0773993808),n=i.lessThanEqual(.04045),o=Po(r,s,n);return Ft(o,e.a)}),oei=Oe(t=>{const{value:e}=t,{rgb:i}=e,r=i.pow(.41666).mul(1.055).sub(.055),s=i.mul(12.92),n=i.lessThanEqual(.0031308),o=Po(r,s,n);return Ft(o,e.a)}),iMe=t=>{let e=null;return t===wg?e="Linear":t===di&&(e="sRGB"),e},w7e=(t,e)=>iMe(t)+"To"+iMe(e);class Nh extends dn{constructor(e,i){super("vec4"),this.method=e,this.node=i}setup(){const{method:e,node:i}=this;return e===Nh.LINEAR_TO_LINEAR?i:aei[e]({value:i})}}Nh.LINEAR_TO_LINEAR="LinearToLinear";Nh.LINEAR_TO_sRGB="LinearTosRGB";Nh.sRGB_TO_LINEAR="sRGBToLinear";const aei={[Nh.LINEAR_TO_sRGB]:oei,[Nh.sRGB_TO_LINEAR]:nei},lei=(t,e)=>gt(new Nh(w7e(wg,e),gt(t))),x7e=(t,e)=>gt(new Nh(w7e(e,wg),gt(t))),cei=Ee(Nh,Nh.LINEAR_TO_sRGB),uei=Ee(Nh,Nh.sRGB_TO_LINEAR);fe("linearTosRGB",cei);fe("sRGBToLinear",uei);fe("linearToColorSpace",lei);fe("colorSpaceToLinear",x7e);Ue("ColorSpaceNode",Nh);class S7e extends mi{constructor(e="",i="void"){super(i),this.snippet=e}generate(e,i){const r=this.getNodeType(e),s=this.snippet;if(r==="void")e.addLineFlowCode(s);else return e.format(`( ${s} )`,r,i)}}const eW=Ee(S7e);Ue("ExpressionNode",S7e);class T7e extends tS{constructor(e){super(0),this.textureNode=e,this.updateType=es.FRAME}get texture(){return this.textureNode.value}update(){const e=this.texture,i=e.images,r=i&&i.length>0?i[0]&&i[0].image||i[0]:e.image;if(r&&r.width!==void 0){const{width:s,height:n}=r;this.value=Math.log2(Math.max(s,n))}}}const hei=Ee(T7e);Ue("MaxMipLevelNode",T7e);class HC extends tS{constructor(e,i=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=i,this.levelNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=es.NONE,this.referenceNode=null,this._value=e,this.setUpdateMatrix(i===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Ef(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){const i=this.value;return Tr(i.matrix).mul(ne(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?es.FRAME:es.NONE,this}setupUV(e,i){const r=this.value;return e.isFlipY()&&(r.isRenderTargetTexture===!0||r.isFramebufferTexture===!0||r.isDepthTexture===!0)&&(i=i.setY(i.y.oneMinus())),i}setup(e){const i=e.getNodeProperties(this);let r=this.uvNode;(r===null||e.context.forceUVContext===!0)&&e.context.getUV&&(r=e.context.getUV(this)),r||(r=this.getDefaultUV()),this.updateMatrix===!0&&(r=this.getTransformedUV(r)),r=this.setupUV(e,r);let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),i.uvNode=r,i.levelNode=s,i.compareNode=this.compareNode,i.gradNode=this.gradNode,i.depthNode=this.depthNode}generateUV(e,i){return i.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,i,r,s,n,o,a){const l=this.value;let c;return s?c=e.generateTextureLevel(l,i,r,s,n):a?c=e.generateTextureGrad(l,i,r,a,n):o?c=e.generateTextureCompare(l,i,r,o,n):this.sampler===!1?c=e.generateTextureLoad(l,i,r,n):c=e.generateTexture(l,i,r,n),c}generate(e,i){const r=e.getNodeProperties(this),s=this.value;if(!s||s.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const n=super.generate(e,"property");if(i==="sampler")return n+"_sampler";if(e.isReference(i))return n;{const o=e.getDataFromNode(this);let a=o.propertyName;if(a===void 0){const{uvNode:u,levelNode:h,compareNode:p,depthNode:f,gradNode:g}=r,y=this.generateUV(e,u),v=h?h.build(e,"float"):null,b=f?f.build(e,"int"):null,w=p?p.build(e,"float"):null,x=g?[g[0].build(e,"vec2"),g[1].build(e,"vec2")]:null,S=e.getVarFromNode(this);a=e.getPropertyName(S);const E=this.generateSnippet(e,n,y,v,b,w,x);e.addLineFlowCode(`${a} = ${E}`),e.context.tempWrite!==!1&&(o.snippet=E,o.propertyName=a)}let l=a;const c=this.getNodeType(e);return e.needsColorSpaceToLinear(s)&&(l=x7e(eW(l,c),s.colorSpace).setup(e).build(e,c)),e.format(l,c,i)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){const i=this.clone();return i.uvNode=e,i.referenceNode=this,gt(i)}blur(e){const i=this.clone();return i.levelNode=e.mul(hei(i)),i.referenceNode=this,gt(i)}level(e){const i=this.clone();return i.levelNode=e,i.referenceNode=this,i}size(e){return Ife(this,e)}compare(e){const i=this.clone();return i.compareNode=gt(e),i.referenceNode=this,gt(i)}grad(e,i){const r=this.clone();return r.gradNode=[gt(e),gt(i)],r.referenceNode=this,gt(r)}depth(e){const i=this.clone();return i.depthNode=gt(e),i.referenceNode=this,gt(i)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value]}update(){const e=this.value;e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e}}const xa=Ee(HC),A2=(...t)=>xa(...t).setSampler(!1);fe("texture",xa);Ue("TextureNode",HC);class tW extends tS{constructor(e,i,r=0){super(e,i),this.isBufferNode=!0,this.bufferType=i,this.bufferCount=r}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const Nfe=(t,e,i)=>gt(new tW(t,e,i));Ue("BufferNode",tW);class dei extends d${constructor(e,i){super(e,i),this.isArrayBufferElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const i=super.generate(e),r=this.getNodeType();return e.format(i,"vec4",r)}}class E7e extends tW{constructor(e,i=null){super(null,"vec4"),this.array=e,this.elementType=i,this._elementType=null,this._elementLength=0,this.updateType=es.RENDER,this.isArrayBufferNode=!0}getElementType(){return this.elementType||this._elementType}getElementLength(){return this._elementLength}update(){const{array:e,value:i}=this,r=this.getElementLength(),s=this.getElementType();if(r===1)for(let n=0;n<e.length;n++){const o=n*4;i[o]=e[n]}else if(s==="color")for(let n=0;n<e.length;n++){const o=n*4,a=e[n];i[o]=a.r,i[o+1]=a.g,i[o+2]=a.b||0}else for(let n=0;n<e.length;n++){const o=n*4,a=e[n];i[o]=a.x,i[o+1]=a.y,i[o+2]=a.z||0,i[o+3]=a.w||0}}setup(e){const i=this.array.length;return this._elementType=this.elementType===null?Mw(this.array[0]):this.elementType,this._elementLength=e.getTypeLength(this._elementType),this.value=new Float32Array(i*4),this.bufferCount=i,super.setup(e)}element(e){return gt(new dei(this,gt(e)))}}const YH=(t,e)=>gt(new E7e(t,e));Ue("UniformsNode",E7e);class pei extends d${constructor(e,i){super(e,i),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const i=super.generate(e),r=this.referenceNode.getNodeType(),s=this.getNodeType();return e.format(i,r,s)}}class m$ extends mi{constructor(e,i,r=null,s=null){super(),this.property=e,this.uniformType=i,this.object=r,this.count=s,this.properties=e.split("."),this.reference=null,this.node=null,this.updateType=es.OBJECT}element(e){return gt(new pei(this,gt(e)))}setNodeType(e){let i=null;this.count!==null?i=Nfe(null,e,this.count):Array.isArray(this.getValueFromReference())?i=YH(null,e):e==="texture"?i=xa(null):i=Tr(null,e),this.node=i}getNodeType(e){return this.node===null&&this.updateValue(),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:i}=this;let r=e[i[0]];for(let s=1;s<i.length;s++)r=r[i[s]];return r}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Hc=(t,e,i)=>gt(new m$(t,e,i)),fei=(t,e,i,r)=>gt(new m$(t,e,r,i));Ue("ReferenceNode",m$);class C7e extends m${constructor(e,i,r=null){super(e,i,r),this.material=r}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const Sv=(t,e,i)=>gt(new C7e(t,e,i));Ue("MaterialReferenceNode",C7e);const cQ=Tr("float").onRenderUpdate(({camera:t})=>t.near),uQ=Tr("float").onRenderUpdate(({camera:t})=>t.far),mei=Tr("float").onRenderUpdate(({camera:t})=>2/(Math.log(t.far+1)/Math.LN2)),Ly=Tr("mat4").onRenderUpdate(({camera:t})=>t.projectionMatrix),g$=Tr("mat4").onRenderUpdate(({camera:t})=>t.matrixWorldInverse),M7e=Tr(new ve).onRenderUpdate(({camera:t},e)=>e.value.setFromMatrixPosition(t.matrixWorld));class Pi extends mi{constructor(e=Pi.VIEW_MATRIX,i=null){super(),this.scope=e,this.object3d=i,this.updateType=es.OBJECT,this._uniformNode=new tS(null)}getNodeType(){const e=this.scope;if(e===Pi.WORLD_MATRIX||e===Pi.VIEW_MATRIX)return"mat4";if(e===Pi.NORMAL_MATRIX)return"mat3";if(e===Pi.POSITION||e===Pi.VIEW_POSITION||e===Pi.DIRECTION||e===Pi.SCALE)return"vec3"}update(e){const i=this.object3d,r=this._uniformNode,s=this.scope;if(s===Pi.VIEW_MATRIX)r.value=i.modelViewMatrix;else if(s===Pi.NORMAL_MATRIX)r.value=i.normalMatrix;else if(s===Pi.WORLD_MATRIX)r.value=i.matrixWorld;else if(s===Pi.POSITION)r.value=r.value||new ve,r.value.setFromMatrixPosition(i.matrixWorld);else if(s===Pi.SCALE)r.value=r.value||new ve,r.value.setFromMatrixScale(i.matrixWorld);else if(s===Pi.DIRECTION)r.value=r.value||new ve,i.getWorldDirection(r.value);else if(s===Pi.VIEW_POSITION){const n=e.camera;r.value=r.value||new ve,r.value.setFromMatrixPosition(i.matrixWorld),r.value.applyMatrix4(n.matrixWorldInverse)}}generate(e){const i=this.scope;return i===Pi.WORLD_MATRIX||i===Pi.VIEW_MATRIX?this._uniformNode.nodeType="mat4":i===Pi.NORMAL_MATRIX?this._uniformNode.nodeType="mat3":(i===Pi.POSITION||i===Pi.VIEW_POSITION||i===Pi.DIRECTION||i===Pi.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Pi.VIEW_MATRIX="viewMatrix";Pi.NORMAL_MATRIX="normalMatrix";Pi.WORLD_MATRIX="worldMatrix";Pi.POSITION="position";Pi.SCALE="scale";Pi.VIEW_POSITION="viewPosition";Pi.DIRECTION="direction";Ee(Pi,Pi.DIRECTION);Ee(Pi,Pi.VIEW_MATRIX);Ee(Pi,Pi.NORMAL_MATRIX);Ee(Pi,Pi.WORLD_MATRIX);const zae=Ee(Pi,Pi.POSITION);Ee(Pi,Pi.SCALE);const A7e=Ee(Pi,Pi.VIEW_POSITION);Ue("Object3DNode",Pi);class dc extends Pi{constructor(e=dc.VIEW_MATRIX){super(e)}update(e){this.object3d=e.object,super.update(e)}}ot(dc,dc.DIRECTION);const cC=ot(dc,dc.VIEW_MATRIX).label("modelViewMatrix").temp("ModelViewMatrix"),R7e=ot(dc,dc.NORMAL_MATRIX),pk=ot(dc,dc.WORLD_MATRIX);ot(dc,dc.POSITION);ot(dc,dc.SCALE);ot(dc,dc.VIEW_POSITION);const gei=Tr(new kn).onObjectUpdate(({object:t},e)=>e.value.copy(t.matrixWorld).invert());Ue("ModelNode",dc);const XH=ml("normal","vec3",ne(0,1,0)),Tg=XH.toVar("normalLocal"),Mx=Ta(R7e.mul(Tg),"v_normalView").normalize().toVar("normalView"),Lfe=Ta(Mx.transformDirection(g$),"v_normalWorld").normalize().toVar("transformedNormalWorld"),Ho=so("vec3","transformedNormalView"),P7e=Ho.transformDirection(g$).normalize().toVar("transformedNormalWorld"),gP=so("vec3","transformedClearcoatNormalView"),rMe=new Map;class Ie extends mi{constructor(e){super(),this.scope=e}getCache(e,i){let r=rMe.get(e);return r===void 0&&(r=Sv(e,i),rMe.set(e,r)),r}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const i=e.context.material,r=this.scope;let s=null;if(r===Ie.COLOR){const n=this.getColor(r);i.map&&i.map.isTexture===!0?s=n.mul(this.getTexture("map")):s=n}else if(r===Ie.OPACITY){const n=this.getFloat(r);i.alphaMap&&i.alphaMap.isTexture===!0?s=n.mul(this.getTexture("alpha")):s=n}else if(r===Ie.SPECULAR_STRENGTH)i.specularMap&&i.specularMap.isTexture===!0?s=this.getTexture("specular").r:s=X(1);else if(r===Ie.SPECULAR_INTENSITY){const n=this.getFloat(r);i.specularMap?s=n.mul(this.getTexture(r).a):s=n}else if(r===Ie.SPECULAR_COLOR){const n=this.getColor(r);i.specularColorMap&&i.specularColorMap.isTexture===!0?s=n.mul(this.getTexture(r).rgb):s=n}else if(r===Ie.ROUGHNESS){const n=this.getFloat(r);i.roughnessMap&&i.roughnessMap.isTexture===!0?s=n.mul(this.getTexture(r).g):s=n}else if(r===Ie.METALNESS){const n=this.getFloat(r);i.metalnessMap&&i.metalnessMap.isTexture===!0?s=n.mul(this.getTexture(r).b):s=n}else if(r===Ie.EMISSIVE){const n=this.getColor(r);i.emissiveMap&&i.emissiveMap.isTexture===!0?s=n.mul(this.getTexture(r)):s=n}else if(r===Ie.NORMAL)i.normalMap?s=this.getTexture("normal").normalMap(this.getCache("normalScale","vec2")):i.bumpMap?s=this.getTexture("bump").r.bumpMap(this.getFloat("bumpScale")):s=Mx;else if(r===Ie.CLEARCOAT){const n=this.getFloat(r);i.clearcoatMap&&i.clearcoatMap.isTexture===!0?s=n.mul(this.getTexture(r).r):s=n}else if(r===Ie.CLEARCOAT_ROUGHNESS){const n=this.getFloat(r);i.clearcoatRoughnessMap&&i.clearcoatRoughnessMap.isTexture===!0?s=n.mul(this.getTexture(r).r):s=n}else if(r===Ie.CLEARCOAT_NORMAL)i.clearcoatNormalMap?s=this.getTexture(r).normalMap(this.getCache(r+"Scale","vec2")):s=Mx;else if(r===Ie.SHEEN){const n=this.getColor("sheenColor").mul(this.getFloat("sheen"));i.sheenColorMap&&i.sheenColorMap.isTexture===!0?s=n.mul(this.getTexture("sheenColor").rgb):s=n}else if(r===Ie.SHEEN_ROUGHNESS){const n=this.getFloat(r);i.sheenRoughnessMap&&i.sheenRoughnessMap.isTexture===!0?s=n.mul(this.getTexture(r).a):s=n,s=s.clamp(.07,1)}else if(r===Ie.ANISOTROPY)if(i.anisotropyMap&&i.anisotropyMap.isTexture===!0){const n=this.getTexture(r);s=Cfe(F3.x,F3.y,F3.y.negate(),F3.x).mul(n.rg.mul(2).sub(Vt(1)).normalize().mul(n.b))}else s=F3;else if(r===Ie.IRIDESCENCE_THICKNESS){const n=Hc("1","float",i.iridescenceThicknessRange);if(i.iridescenceThicknessMap){const o=Hc("0","float",i.iridescenceThicknessRange);s=n.sub(o).mul(this.getTexture(r).g).add(o)}else s=n}else if(r===Ie.TRANSMISSION){const n=this.getFloat(r);i.transmissionMap?s=n.mul(this.getTexture(r).r):s=n}else if(r===Ie.THICKNESS){const n=this.getFloat(r);i.thicknessMap?s=n.mul(this.getTexture(r).g):s=n}else if(r===Ie.IOR)s=this.getFloat(r);else{const n=this.getNodeType(e);s=this.getCache(r,n)}return s}}Ie.ALPHA_TEST="alphaTest";Ie.COLOR="color";Ie.OPACITY="opacity";Ie.SHININESS="shininess";Ie.SPECULAR="specular";Ie.SPECULAR_STRENGTH="specularStrength";Ie.SPECULAR_INTENSITY="specularIntensity";Ie.SPECULAR_COLOR="specularColor";Ie.REFLECTIVITY="reflectivity";Ie.ROUGHNESS="roughness";Ie.METALNESS="metalness";Ie.NORMAL="normal";Ie.CLEARCOAT="clearcoat";Ie.CLEARCOAT_ROUGHNESS="clearcoatRoughness";Ie.CLEARCOAT_NORMAL="clearcoatNormal";Ie.EMISSIVE="emissive";Ie.ROTATION="rotation";Ie.SHEEN="sheen";Ie.SHEEN_ROUGHNESS="sheenRoughness";Ie.ANISOTROPY="anisotropy";Ie.IRIDESCENCE="iridescence";Ie.IRIDESCENCE_IOR="iridescenceIOR";Ie.IRIDESCENCE_THICKNESS="iridescenceThickness";Ie.IOR="ior";Ie.TRANSMISSION="transmission";Ie.THICKNESS="thickness";Ie.ATTENUATION_DISTANCE="attenuationDistance";Ie.ATTENUATION_COLOR="attenuationColor";Ie.LINE_SCALE="scale";Ie.LINE_DASH_SIZE="dashSize";Ie.LINE_GAP_SIZE="gapSize";Ie.LINE_WIDTH="linewidth";Ie.LINE_DASH_OFFSET="dashOffset";Ie.POINT_WIDTH="pointWidth";Ie.DISPERSION="dispersion";const yei=ot(Ie,Ie.ALPHA_TEST),fk=ot(Ie,Ie.COLOR),_ei=ot(Ie,Ie.SHININESS),vei=ot(Ie,Ie.EMISSIVE),O7e=ot(Ie,Ie.OPACITY),bei=ot(Ie,Ie.SPECULAR),sMe=ot(Ie,Ie.SPECULAR_INTENSITY),wei=ot(Ie,Ie.SPECULAR_COLOR),xei=ot(Ie,Ie.SPECULAR_STRENGTH);ot(Ie,Ie.REFLECTIVITY);const Sei=ot(Ie,Ie.ROUGHNESS),Tei=ot(Ie,Ie.METALNESS),Eei=ot(Ie,Ie.NORMAL),Cei=ot(Ie,Ie.CLEARCOAT),Mei=ot(Ie,Ie.CLEARCOAT_ROUGHNESS),Aei=ot(Ie,Ie.CLEARCOAT_NORMAL),Rei=ot(Ie,Ie.ROTATION),Pei=ot(Ie,Ie.SHEEN),Oei=ot(Ie,Ie.SHEEN_ROUGHNESS),Iei=ot(Ie,Ie.ANISOTROPY),$ei=ot(Ie,Ie.IRIDESCENCE),Nei=ot(Ie,Ie.IRIDESCENCE_IOR),Lei=ot(Ie,Ie.IRIDESCENCE_THICKNESS),Dei=ot(Ie,Ie.TRANSMISSION),Fei=ot(Ie,Ie.THICKNESS),kei=ot(Ie,Ie.IOR),Uei=ot(Ie,Ie.ATTENUATION_DISTANCE),Bei=ot(Ie,Ie.ATTENUATION_COLOR),Vae=ot(Ie,Ie.LINE_SCALE),I7e=ot(Ie,Ie.LINE_DASH_SIZE),$7e=ot(Ie,Ie.LINE_GAP_SIZE),hQ=ot(Ie,Ie.LINE_WIDTH),nMe=ot(Ie,Ie.LINE_DASH_OFFSET),zei=ot(Ie,Ie.POINT_WIDTH),Vei=ot(Ie,Ie.DISPERSION),F3=Tr(new Xi).onReference(function(t){return t.material}).onRenderUpdate(function({material:t}){this.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation))});Ue("MaterialNode",Ie);const xu=ml("position","vec3"),Xa=xu.toVar("positionLocal"),Gae=Ta(pk.mul(Xa).xyz,"v_positionWorld"),N7e=Ta(Xa.transformDirection(pk),"v_positionWorldDirection").normalize().toVar("positionWorldDirection"),$d=Ta(cC.mul(Xa).xyz,"v_positionView"),no=Ta($d.negate(),"v_positionViewDirection").normalize().toVar("positionViewDirection");class L7e extends dn{constructor(e=null){super("vec4"),this.positionNode=e}setup(e){if(e.shaderStage==="fragment")return Ta(e.context.mvp);const i=this.positionNode||Xa;return Ly.mul(cC).mul(i)}}const jae=Ee(L7e);Ue("ModelViewProjectionNode",L7e);class D7e extends W7{constructor(e,i=null,r=0,s=0){super(e,i),this.isBufferNode=!0,this.bufferType=i,this.bufferStride=r,this.bufferOffset=s,this.usage=DH,this.instanced=!1,this.attribute=null,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const i=this.getNodeType(e),r=this.value,s=e.getTypeLength(i),n=this.bufferStride||s,o=this.bufferOffset,a=r.isInterleavedBuffer===!0?r:new M9e(r,n),l=new _fe(a,s,o);a.setUsage(this.usage),this.attribute=l,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const i=this.getNodeType(e),r=e.getBufferAttributeFromNode(this,i),s=e.getPropertyName(r);let n=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=s,n=s):n=Ta(this).build(e,i),n}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this}setInstanced(e){return this.instanced=e,this}}const iW=(t,e,i,r)=>gt(new D7e(t,e,i,r)),Gei=(t,e,i,r)=>iW(t,e,i,r).setUsage(FH),oMe=(t,e,i,r)=>iW(t,e,i,r).setInstanced(!0),aMe=(t,e,i,r)=>Gei(t,e,i,r).setInstanced(!0);fe("toAttribute",t=>iW(t.value));Ue("BufferAttributeNode",D7e);class F7e extends mi{constructor(e){super("void"),this.instanceMesh=e,this.instanceMatrixNode=null,this.instanceColorNode=null}setup(){let e=this.instanceMatrixNode;const i=this.instanceMesh;if(e===null){const l=i.instanceMatrix,c=new _Qt(l.array,16,1),u=l.usage===FH?aMe:oMe,h=[u(c,"vec4",16,0),u(c,"vec4",16,4),u(c,"vec4",16,8),u(c,"vec4",16,12)];e=nO(...h),this.instanceMatrixNode=e}const r=i.instanceColor;if(r&&this.instanceColorNode===null){const l=new Oae(r.array,3),c=r.usage===FH?aMe:oMe;this.instanceColorNode=ne(c(l,"vec3",3,0))}const s=e.mul(Xa).xyz,n=Sg(e[0].xyz,e[1].xyz,e[2].xyz),o=Tg.div(ne(n[0].dot(n[0]),n[1].dot(n[1]),n[2].dot(n[2]))),a=n.mul(o).xyz;Xa.assign(s),Tg.assign(a),this.instanceColorNode!==null&&Ry("vec3","vInstanceColor").assign(this.instanceColorNode)}}const jei=Ee(F7e);Ue("InstanceNode",F7e);const k7e=Oe((t,e)=>(e.geometry.hasAttribute("tangent")===!1&&e.geometry.computeTangents(),ml("tangent","vec4")))(),Dfe=k7e.xyz.toVar("tangentLocal"),U7e=Ta(cC.mul(Ft(Dfe,0)).xyz,"v_tangentView").normalize().toVar("tangentView");class B7e extends mi{constructor(e){super("void"),this.batchMesh=e,this.instanceColorNode=null,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(this.batchingIdNode=ml("batchId"));const i=this.batchMesh._matricesTexture,r=Ife(A2(i),0),s=X(te(this.batchingIdNode)).mul(4).toVar(),n=te(s.mod(r)),o=te(s).div(te(r)),a=nO(A2(i,j2(n,o)),A2(i,j2(n.add(1),o)),A2(i,j2(n.add(2),o)),A2(i,j2(n.add(3),o))),l=Sg(a[0].xyz,a[1].xyz,a[2].xyz);Xa.assign(a.mul(Xa));const c=Tg.div(ne(l[0].dot(l[0]),l[1].dot(l[1]),l[2].dot(l[2]))),u=l.mul(c).xyz;Tg.assign(u),e.hasGeometryAttribute("tangent")&&Dfe.mulAssign(l)}}const Hei=Ee(B7e);Ue("batch",B7e);class z7e extends mi{constructor(e,i=!1){super("void"),this.skinnedMesh=e,this.useReference=i,this.updateType=es.OBJECT,this.skinIndexNode=ml("skinIndex","uvec4"),this.skinWeightNode=ml("skinWeight","vec4");let r,s,n;i?(r=Hc("bindMatrix","mat4"),s=Hc("bindMatrixInverse","mat4"),n=fei("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(r=Tr(e.bindMatrix,"mat4"),s=Tr(e.bindMatrixInverse,"mat4"),n=Nfe(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=r,this.bindMatrixInverseNode=s,this.boneMatricesNode=n}setup(e){const{skinIndexNode:i,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:n,boneMatricesNode:o}=this,a=o.element(i.x),l=o.element(i.y),c=o.element(i.z),u=o.element(i.w),h=s.mul(Xa),p=Jd(a.mul(r.x).mul(h),l.mul(r.y).mul(h),c.mul(r.z).mul(h),u.mul(r.w).mul(h)),f=n.mul(p).xyz;let g=Jd(r.x.mul(a),r.y.mul(l),r.z.mul(c),r.w.mul(u));g=n.mul(g).mul(s);const y=g.transformDirection(Tg).xyz;Xa.assign(f),Tg.assign(y),e.hasGeometryAttribute("tangent")&&Dfe.assign(y)}generate(e,i){if(i!=="void")return Xa.build(e,i)}update(e){(this.useReference?e.object:this.skinnedMesh).skeleton.update()}}const qei=t=>gt(new z7e(t,!0));Ue("SkinningNode",z7e);class V7e extends mi{constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode("i".charCodeAt()+e)}getProperties(e){const i=e.getNodeProperties(this);if(i.stackNode!==void 0)return i;const r={};for(let s=0,n=this.params.length-1;s<n;s++){const o=this.params[s],a=o.isNode!==!0&&o.name||this.getVarName(s),l=o.isNode!==!0&&o.type||"int";r[a]=eW(a,l)}return i.returnsNode=this.params[this.params.length-1](r,e.addStack(),e),i.stackNode=e.removeStack(),i}getNodeType(e){const{returnsNode:i}=this.getProperties(e);return i?i.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const i=this.getProperties(e),r={tempWrite:!1},s=this.params,n=i.stackNode;for(let l=0,c=s.length-1;l<c;l++){const u=s[l];let h=null,p=null,f=null,g=null,y=null,v=null;u.isNode?(g="int",f=this.getVarName(l),h="0",p=u.build(e,g),y="<"):(g=u.type||"int",f=u.name||this.getVarName(l),h=u.start,p=u.end,y=u.condition,v=u.update,typeof h=="number"?h=h.toString():h&&h.isNode&&(h=h.build(e,g)),typeof p=="number"?p=p.toString():p&&p.isNode&&(p=p.build(e,g)),h!==void 0&&p===void 0?(h=h+" - 1",p="0",y=">="):p!==void 0&&h===void 0&&(h="0",y="<"),y===void 0&&(Number(h)>Number(p)?y=">=":y="<"));const b={start:h,end:p,condition:y},w=b.start,x=b.end;let S="",E="",C="";v||(g==="int"||g==="uint"?y.includes("<")?v="++":v="--":y.includes("<")?v="+= 1.":v="-= 1."),S+=e.getVar(g,f)+" = "+w,E+=f+" "+y+" "+x,C+=f+" "+v;const R=`for ( ${S}; ${E}; ${C} )`;e.addFlowCode((l===0?`
`:"")+e.tab+R+` {

`).addFlowTab()}const o=p0(n,r).build(e,"void"),a=i.returnsNode?i.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+o);for(let l=0,c=this.params.length-1;l<c;l++)e.addFlowCode((l===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),a}}const Ys=(...t)=>gt(new V7e(sO(t,"int"))).append(),G7e=()=>eW("break").append();fe("loop",(t,...e)=>Z9e(t,Ys(...e)));Ue("LoopNode",V7e);const dQ=new WeakMap,Zh=new Fs,lMe=Oe(({bufferMap:t,influence:e,stride:i,width:r,depth:s,offset:n})=>{const o=te(rKt).mul(i).add(n),a=o.div(r),l=o.sub(a.mul(r));return A2(t,j2(l,a)).depth(s).mul(e)});function Wei(t){const e=t.morphAttributes.position!==void 0,i=t.morphAttributes.normal!==void 0,r=t.morphAttributes.color!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,n=s!==void 0?s.length:0;let o=dQ.get(t);if(o===void 0||o.count!==n){let b=function(){y.dispose(),dQ.delete(t),t.removeEventListener("dispose",b)};o!==void 0&&o.texture.dispose();const a=t.morphAttributes.position||[],l=t.morphAttributes.normal||[],c=t.morphAttributes.color||[];let u=0;e===!0&&(u=1),i===!0&&(u=2),r===!0&&(u=3);let h=t.attributes.position.count*u,p=1;const f=4096;h>f&&(p=Math.ceil(h/f),h=f);const g=new Float32Array(h*p*4*n),y=new IJt(g,h,p,n);y.type=Rd,y.needsUpdate=!0;const v=u*4;for(let w=0;w<n;w++){const x=a[w],S=l[w],E=c[w],C=h*p*4*w;for(let R=0;R<x.count;R++){const I=R*v;e===!0&&(Zh.fromBufferAttribute(x,R),g[C+I+0]=Zh.x,g[C+I+1]=Zh.y,g[C+I+2]=Zh.z,g[C+I+3]=0),i===!0&&(Zh.fromBufferAttribute(S,R),g[C+I+4]=Zh.x,g[C+I+5]=Zh.y,g[C+I+6]=Zh.z,g[C+I+7]=0),r===!0&&(Zh.fromBufferAttribute(E,R),g[C+I+8]=Zh.x,g[C+I+9]=Zh.y,g[C+I+10]=Zh.z,g[C+I+11]=E.itemSize===4?Zh.w:1)}}o={count:n,texture:y,stride:u,size:new Xi(h,p)},dQ.set(t,o),t.addEventListener("dispose",b)}return o}class j7e extends mi{constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Tr(1),this.updateType=es.OBJECT}setup(e){const{geometry:i}=e,r=i.morphAttributes.position!==void 0,s=i.morphAttributes.normal!==void 0,n=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,o=n!==void 0?n.length:0,{texture:a,stride:l,size:c}=Wei(i);r===!0&&Xa.mulAssign(this.morphBaseInfluence),s===!0&&Tg.mulAssign(this.morphBaseInfluence);const u=te(c.width);Ys(o,({i:h})=>{const p=X(0).toVar();this.mesh.isInstancedMesh===!0&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?p.assign(A2(this.mesh.morphTexture,j2(te(h).add(1),te(Q9e))).r):p.assign(Hc("morphTargetInfluences","float").element(h).toVar()),r===!0&&Xa.addAssign(lMe({bufferMap:a,influence:p,stride:l,width:u,depth:h,offset:te(0)})),s===!0&&Tg.addAssign(lMe({bufferMap:a,influence:p,stride:l,width:u,depth:h,offset:te(1)}))})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((i,r)=>i+r,0)}}const Yei=Ee(j7e);Ue("MorphNode",j7e);const Xei=no.negate().reflect(Ho),Zei=Xei.transformDirection(g$).toVar("reflectVector");class H7e extends HC{constructor(e,i=null,r=null){super(e,i,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){return Zei}setUpdateMatrix(){}setupUV(e,i){const r=this.value;return e.renderer.coordinateSystem===aC||!r.isRenderTargetTexture?ne(i.x.negate(),i.yz):i}generateUV(e,i){return i.build(e,"vec3")}}const rW=Ee(H7e);fe("cubeTexture",rW);Ue("CubeTextureNode",H7e);class j4 extends mi{constructor(){super("vec3")}generate(){console.warn("Abstract function.")}}Ue("LightingNode",j4);let k3=null;class qC extends j4{constructor(e=null){super(),this.updateType=es.FRAME,this.light=e,this.rtt=null,this.shadowNode=null,this.shadowMaskNode=null,this.color=new ds,this._defaultColorNode=Tr(this.color),this.colorNode=this._defaultColorNode,this.isAnalyticLightNode=!0}getCacheKey(){return super.getCacheKey()+"-"+(this.light.id+"-"+(this.light.castShadow?"1":"0"))}getHash(){return this.light.uuid}setupShadow(e){const{object:i}=e;if(i.receiveShadow===!1)return;let r=this.shadowNode;if(r===null){k3===null&&(k3=e.createNodeMaterial(),k3.fragmentNode=Ft(0,0,0,1),k3.isShadowNodeMaterial=!0);const s=this.light.shadow,n=e.createRenderTarget(s.mapSize.width,s.mapSize.height),o=new h$;o.minFilter=za,o.magFilter=za,o.image.width=s.mapSize.width,o.image.height=s.mapSize.height,o.compareFunction=dfe,n.depthTexture=o,s.camera.updateProjectionMatrix();const a=Hc("bias","float",s),l=Hc("normalBias","float",s),c=i.material.shadowPositionNode||Gae;let u=Tr(s.matrix).mul(c.add(Lfe.mul(l)));u=u.xyz.div(u.w);const h=u.x.greaterThanEqual(0).and(u.x.lessThanEqual(1)).and(u.y.greaterThanEqual(0)).and(u.y.lessThanEqual(1)).and(u.z.lessThanEqual(1));let p=u.z.add(a);e.renderer.coordinateSystem===aC&&(p=p.mul(2).sub(1)),u=ne(u.x,u.y.oneMinus(),p),r=((v,b,w)=>xa(v,b).compare(w))(o,u.xy,u.z);const g=xa(n.texture,u),y=h.mix(1,r.mix(g.a.mix(1,g),1));this.rtt=n,this.colorNode=this.colorNode.mul(y),this.shadowNode=r,this.shadowMaskNode=y,this.updateBeforeType=es.RENDER}}setup(e){this.light.castShadow?this.setupShadow(e):this.shadowNode!==null&&this.disposeShadow()}updateShadow(e){const{rtt:i,light:r}=this,{renderer:s,scene:n,camera:o}=e,a=n.overrideMaterial;n.overrideMaterial=k3,i.setSize(r.shadow.mapSize.width,r.shadow.mapSize.height),r.shadow.updateMatrices(r),r.shadow.camera.layers.mask=o.layers.mask;const l=s.toneMapping,c=s.getRenderTarget(),u=s.getRenderObjectFunction();s.setRenderObjectFunction((h,...p)=>{h.castShadow===!0&&s.renderObject(h,...p)}),s.setRenderTarget(i),s.toneMapping=Tx,s.render(n,r.shadow.camera),s.setRenderTarget(c),s.setRenderObjectFunction(u),s.toneMapping=l,n.overrideMaterial=a}disposeShadow(){this.rtt.dispose(),this.shadowNode=null,this.shadowMaskNode=null,this.rtt=null,this.colorNode=this._defaultColorNode}updateBefore(e){const{light:i}=this;i.castShadow&&this.updateShadow(e)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}Ue("AnalyticLightNode",qC);const ZH=new WeakMap,Jei=t=>t.sort((e,i)=>e.id-i.id);class q7e extends mi{constructor(e=[]){super("vec3"),this.totalDiffuseNode=ne().temp("totalDiffuse"),this.totalSpecularNode=ne().temp("totalSpecular"),this.outgoingLightNode=ne().temp("outgoingLight"),this.lightNodes=e,this._hash=null}get hasLight(){return this.lightNodes.length>0}getHash(){if(this._hash===null){const e=[];for(const i of this.lightNodes)e.push(i.getHash());this._hash="lights-"+e.join(",")}return this._hash}analyze(e){const i=e.getDataFromNode(this);for(const r of i.nodes)r.build(e)}setup(e){const i=e.context,r=i.lightingModel;let s=this.outgoingLightNode;if(r){const{lightNodes:n,totalDiffuseNode:o,totalSpecularNode:a}=this;i.outgoingLight=s;const l=e.addStack(),c=e.getDataFromNode(this);c.nodes=l.nodes,r.start(i,l,e);for(const b of n)b.build(e);r.indirectDiffuse(i,l,e),r.indirectSpecular(i,l,e),r.ambientOcclusion(i,l,e);const{backdrop:u,backdropAlpha:h}=i,{directDiffuse:p,directSpecular:f,indirectDiffuse:g,indirectSpecular:y}=i.reflectedLight;let v=p.add(g);u!==null&&(h!==null?v=ne(h.mix(v,u)):v=ne(u),i.material.transparent=!0),o.assign(v),a.assign(f.add(y)),s.assign(o.add(a)),r.finish(i,l,e),s=s.bypass(e.removeStack())}return s}_getLightNodeById(e){for(const i of this.lightNodes)if(i.isAnalyticLightNode&&i.light.id===e)return i;return null}fromLights(e=[]){const i=[];e=Jei(e);for(const r of e){let s=this._getLightNodeById(r.id);if(s===null){const n=r.constructor,o=ZH.has(n)?ZH.get(n):qC;s=gt(new o(r))}i.push(s)}return this.lightNodes=i,this._hash=null,this}}const Qei=Ee(q7e);function y$(t,e){if(ZH.has(t)){console.warn(`Redefinition of light node ${e.type}`);return}if(typeof t!="function")throw new Error(`Light ${t.name} is not a class`);if(typeof e!="function"||!e.type)throw new Error(`Light node ${e.type} is not a class`);ZH.set(t,e)}class W7e extends j4{constructor(e=null){super(),this.aoNode=e}setup(e){const r=this.aoNode.x.sub(1).mul(1).add(1);e.context.ambientOcclusion.mulAssign(r)}}Ue("AONode",W7e);class Y7e extends Afe{constructor(e,i=null,r=null,s=null){super(e),this.lightingModel=i,this.backdropNode=r,this.backdropAlphaNode=s,this._context=null}getContext(){const{backdropNode:e,backdropAlphaNode:i}=this,r=ne().temp("directDiffuse"),s=ne().temp("directSpecular"),n=ne().temp("indirectDiffuse"),o=ne().temp("indirectSpecular"),a={directDiffuse:r,directSpecular:s,indirectDiffuse:n,indirectSpecular:o};return{radiance:ne().temp("radiance"),irradiance:ne().temp("irradiance"),iblIrradiance:ne().temp("iblIrradiance"),ambientOcclusion:X(1).temp("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:i}}setup(e){return this.context=this._context||(this._context=this.getContext()),this.context.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const X7e=Ee(Y7e);fe("lightingContext",X7e);Ue("LightingContextNode",Y7e);const Kei=t=>t.mul(k7e.w).xyz,eti=Ta(Kei(Mx.cross(U7e)),"v_bitangentView").normalize().toVar("bitangentView"),yP=Sg(U7e,eti,Mx);no.mul(yP);const tti=(()=>{let t=oO.cross(no);return t=t.cross(oO).normalize(),t=Po(t,Ho,u2.mul(Aw.oneMinus()).oneMinus().pow2().pow2()).normalize(),t})();class Ffe extends mi{constructor(e,i,r=null){super(),this.condNode=e,this.ifNode=i,this.elseNode=r}getNodeType(e){const i=this.ifNode.getNodeType(e);if(this.elseNode!==null){const r=this.elseNode.getNodeType(e);if(e.getTypeLength(r)>e.getTypeLength(i))return r}return i}generate(e,i){const r=this.getNodeType(e),s={tempWrite:!1},n=e.getDataFromNode(this);if(n.nodeProperty!==void 0)return n.nodeProperty;const{ifNode:o,elseNode:a}=this,l=i!=="void",c=l?so(r).build(e):"";n.nodeProperty=c;const u=p0(this.condNode).build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${u} ) {

`).addFlowTab();let h=p0(o,s).build(e,r);if(h&&(l?h=c+" = "+h+";":h="return "+h+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+h+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let p=p0(a,s).build(e,r);p&&(l?p=c+" = "+p+";":p="return "+p+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+p+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(c,r,i)}}const Nd=Ee(Ffe);fe("cond",Nd);Ue("CondNode",Ffe);const cMe=X(1),Hae=X(-2),Dz=X(.8),pQ=X(-1),Fz=X(.4),fQ=X(2),kz=X(.305),mQ=X(3),uMe=X(.21),iti=X(4),hMe=X(4),rti=X(16),sti=Oe(([t])=>{const e=ne(ma(t)).toVar(),i=X(-1).toVar();return xr(e.x.greaterThan(e.z),()=>{xr(e.x.greaterThan(e.y),()=>{i.assign(Nd(t.x.greaterThan(0),0,3))}).else(()=>{i.assign(Nd(t.y.greaterThan(0),1,4))})}).else(()=>{xr(e.z.greaterThan(e.y),()=>{i.assign(Nd(t.z.greaterThan(0),2,5))}).else(()=>{i.assign(Nd(t.y.greaterThan(0),1,4))})}),i}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),nti=Oe(([t,e])=>{const i=Vt().toVar();return xr(e.equal(0),()=>{i.assign(Vt(t.z,t.y).div(ma(t.x)))}).elseif(e.equal(1),()=>{i.assign(Vt(t.x.negate(),t.z.negate()).div(ma(t.y)))}).elseif(e.equal(2),()=>{i.assign(Vt(t.x.negate(),t.y).div(ma(t.z)))}).elseif(e.equal(3),()=>{i.assign(Vt(t.z.negate(),t.y).div(ma(t.x)))}).elseif(e.equal(4),()=>{i.assign(Vt(t.x.negate(),t.z).div(ma(t.y)))}).else(()=>{i.assign(Vt(t.x,t.y).div(ma(t.z)))}),Xr(.5,i.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),oti=Oe(([t])=>{const e=X(0).toVar();return xr(t.greaterThanEqual(Dz),()=>{e.assign(cMe.sub(t).mul(pQ.sub(Hae)).div(cMe.sub(Dz)).add(Hae))}).elseif(t.greaterThanEqual(Fz),()=>{e.assign(Dz.sub(t).mul(fQ.sub(pQ)).div(Dz.sub(Fz)).add(pQ))}).elseif(t.greaterThanEqual(kz),()=>{e.assign(Fz.sub(t).mul(mQ.sub(fQ)).div(Fz.sub(kz)).add(fQ))}).elseif(t.greaterThanEqual(uMe),()=>{e.assign(kz.sub(t).mul(iti.sub(mQ)).div(kz.sub(uMe)).add(mQ))}).else(()=>{e.assign(X(-2).mul(Q7(Xr(1.16,t))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),ati=Oe(([t,e])=>{const i=t.toVar();i.assign(Xr(2,i).sub(1));const r=ne(i,1).toVar();return xr(e.equal(0),()=>{r.assign(r.zyx)}).elseif(e.equal(1),()=>{r.assign(r.xzy),r.xz.mulAssign(-1)}).elseif(e.equal(2),()=>{r.x.mulAssign(-1)}).elseif(e.equal(3),()=>{r.assign(r.zyx),r.xz.mulAssign(-1)}).elseif(e.equal(4),()=>{r.assign(r.xzy),r.xy.mulAssign(-1)}).elseif(e.equal(5),()=>{r.z.mulAssign(-1)}),r}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),lti=Oe(([t,e,i,r,s,n])=>{const o=X(i),a=ne(e),l=xI(oti(o),Hae,n),c=K7(l),u=p$(l),h=ne(qae(t,a,u,r,s,n)).toVar();return xr(c.notEqual(0),()=>{const p=ne(qae(t,a,u.add(1),r,s,n)).toVar();h.assign(Po(h,p,c))}),h}),qae=Oe(([t,e,i,r,s,n])=>{const o=X(i).toVar(),a=ne(e),l=X(sti(a)).toVar(),c=X(rc(hMe.sub(o),0)).toVar();o.assign(rc(o,hMe));const u=X(Bae(o)).toVar(),h=Vt(nti(a,l).mul(u.sub(2)).add(1)).toVar();return xr(l.greaterThan(2),()=>{h.y.addAssign(u),l.subAssign(3)}),h.x.addAssign(l.mul(u)),h.x.addAssign(c.mul(Xr(3,rti))),h.y.addAssign(Xr(4,Bae(n).sub(u))),h.x.mulAssign(r),h.y.mulAssign(s),t.uv(h).grad(Vt(),Vt())}),gQ=Oe(({envMap:t,mipInt:e,outputDirection:i,theta:r,axis:s,CUBEUV_TEXEL_WIDTH:n,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const l=sw(r),c=i.mul(l).add(s.cross(i).mul(uv(r))).add(s.mul(s.dot(i).mul(l.oneMinus())));return qae(t,c,e,n,o,a)}),cti=Oe(({n:t,latitudinal:e,poleAxis:i,outputDirection:r,weights:s,samples:n,dTheta:o,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:h})=>{const p=ne(Nd(e,i,_7e(i,r))).toVar();xr(p7e(p.equals(ne(0))),()=>{p.assign(ne(r.z,0,r.x.negate()))}),p.assign(dk(p));const f=ne().toVar();return f.addAssign(s.element(te(0)).mul(gQ({theta:0,axis:p,outputDirection:r,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:h}))),Ys({start:te(1),end:t},({i:g})=>{xr(g.greaterThanEqual(n),()=>{G7e()});const y=X(o.mul(X(g))).toVar();f.addAssign(s.element(g).mul(gQ({theta:y.mul(-1),axis:p,outputDirection:r,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:h}))),f.addAssign(s.element(g).mul(gQ({theta:y,axis:p,outputDirection:r,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:h})))}),Ft(f,1)});let JH=null;const dMe=new WeakMap;function uti(t){const e=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:i,maxMip:e}}function hti(t){let e=dMe.get(t);if((e!==void 0?e.pmremVersion:-1)!==t.pmremVersion){if(t.isCubeTexture){if(t.source.data.some(r=>r===void 0))throw new Error("PMREMNode: Undefined texture in CubeTexture. Use onLoad callback or async loader");e=JH.fromCubemap(t,e)}else{if(t.image===void 0)throw new Error("PMREMNode: Undefined image in Texture. Use onLoad callback or async loader");e=JH.fromEquirectangular(t,e)}e.pmremVersion=t.pmremVersion,dMe.set(t,e)}return e.texture}class Z7e extends dn{constructor(e,i=null,r=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=i,this.levelNode=r,this._generator=null,this._texture=xa(null),this._width=Tr(0),this._height=Tr(0),this._maxMip=Tr(0),this.updateBeforeType=es.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const i=uti(e.image.height);this._texture.value=e,this._width.value=i.texelWidth,this._height.value=i.texelHeight,this._maxMip.value=i.maxMip}updateBefore(){let e=this._pmrem;const i=e?e.pmremVersion:-1,r=this._value;i!==r.pmremVersion&&(r.isPMREMTexture===!0?e=r:e=hti(r),this._pmrem=e,this.updateFromTexture(e))}setup(e){JH===null&&(JH=e.createPMREMGenerator()),this.updateBefore(e);let i=this.uvNode;i===null&&e.context.getUV&&(i=e.context.getUV(this));const r=this.value;e.renderer.coordinateSystem===Zm&&r.isPMREMTexture!==!0&&r.isRenderTargetTexture===!0&&(i=ne(i.x.negate(),i.yz));let s=this.levelNode;return s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),lti(this._texture,i,s,this._width,this._height,this._maxMip)}}const J7e=Ee(Z7e);Ue("PMREMNode",Z7e);const pMe=new WeakMap;class Q7e extends j4{constructor(e=null){super(),this.envNode=e}setup(e){let i=this.envNode;if(i.isTextureNode){let p=pMe.get(i.value);p===void 0&&(p=J7e(i.value),pMe.set(i.value,p)),i=p}const{material:r}=e,n=r.envMap?Hc("envMapIntensity","float",e.material):Hc("environmentIntensity","float",e.scene),a=r.useAnisotropy===!0||r.anisotropy>0?tti:Ho,l=p0(i,fMe(Aw,a)).mul(n),c=p0(i,dti(P7e)).mul(Math.PI).mul(n),u=VH(l);e.context.radiance.addAssign(u),e.context.iblIrradiance.addAssign(c);const h=e.context.lightingModel.clearcoatRadiance;if(h){const p=p0(i,fMe(HH,gP)).mul(n),f=VH(p);h.addAssign(f)}}}const fMe=(t,e)=>{let i=null;return{getUV:()=>(i===null&&(i=no.negate().reflect(e),i=t.mul(t).mix(i,e).normalize(),i=i.transformDirection(g$)),i),getTextureLevel:()=>t}},dti=t=>({getUV:()=>t,getTextureLevel:()=>X(1)});Ue("EnvironmentNode",Q7e);class K7e extends j4{constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}Ue("IrradianceNode",K7e);let yQ,_Q;class ws extends mi{constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===ws.VIEWPORT?"vec4":this.scope===ws.COORDINATE?"vec3":"vec2"}getUpdateType(){let e=es.NONE;return(this.scope===ws.RESOLUTION||this.scope===ws.VIEWPORT)&&(e=es.RENDER),this.updateType=e,e}update({renderer:e}){this.scope===ws.VIEWPORT?e.getViewport(_Q):e.getDrawingBufferSize(yQ)}setup(){const e=this.scope;let i=null;if(e===ws.RESOLUTION)i=Tr(yQ||(yQ=new Xi));else if(e===ws.VIEWPORT)i=Tr(_Q||(_Q=new Fs));else{i=pti.div(Wae);let r=i.x,s=i.y;/bottom/i.test(e)&&(s=s.oneMinus()),/right/i.test(e)&&(r=r.oneMinus()),i=Vt(r,s)}return i}generate(e){if(this.scope===ws.COORDINATE){let i=e.getFragCoord();if(e.isFlipY()){const r=e.getNodeProperties(Wae).outputNode.build(e);i=`${e.getType("vec3")}( ${i}.x, ${r}.y - ${i}.y, ${i}.z )`}return i}return super.generate(e)}}ws.COORDINATE="coordinate";ws.RESOLUTION="resolution";ws.VIEWPORT="viewport";ws.TOP_LEFT="topLeft";ws.BOTTOM_LEFT="bottomLeft";ws.TOP_RIGHT="topRight";ws.BOTTOM_RIGHT="bottomRight";const pti=ot(ws,ws.COORDINATE),Wae=ot(ws,ws.RESOLUTION),cO=ot(ws,ws.VIEWPORT),SI=ot(ws,ws.TOP_LEFT),fti=ot(ws,ws.BOTTOM_LEFT);ot(ws,ws.TOP_RIGHT);ot(ws,ws.BOTTOM_RIGHT);Ue("ViewportNode",ws);const U3=new Xi;class H4 extends HC{constructor(e=SI,i=null,r=null){r===null&&(r=new O9e,r.minFilter=_E),super(r,e,i),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=es.FRAME}updateBefore(e){const i=e.renderer;i.getDrawingBufferSize(U3);const r=this.value;(r.image.width!==U3.width||r.image.height!==U3.height)&&(r.image.width=U3.width,r.image.height=U3.height,r.needsUpdate=!0);const s=r.generateMipmaps;r.generateMipmaps=this.generateMipmaps,i.copyFramebufferToTexture(r),r.generateMipmaps=s}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const mti=Ee(H4),eWe=Ee(H4,null,null,{generateMipmaps:!0});fe("viewportTexture",mti);fe("viewportMipTexture",eWe);Ue("ViewportTextureNode",H4);let vQ=null;class tWe extends H4{constructor(e=SI,i=null){vQ===null&&(vQ=new h$),super(e,i,vQ)}}const iWe=Ee(tWe);fe("viewportDepthTexture",iWe);Ue("ViewportDepthTextureNode",tWe);class sc extends mi{constructor(e,i=null){super("float"),this.scope=e,this.valueNode=i,this.isViewportDepthNode=!0}generate(e){const{scope:i}=this;return i===sc.DEPTH_PIXEL?e.getFragDepth():super.generate(e)}setup(){const{scope:e}=this;let i=null;if(e===sc.DEPTH)i=Yae($d.z,cQ,uQ);else if(e===sc.DEPTH_TEXTURE){const r=this.valueNode||iWe(),s=rWe(r,cQ,uQ);i=Yae(s,cQ,uQ)}else e===sc.DEPTH_PIXEL&&this.valueNode!==null&&(i=sWe().assign(this.valueNode));return i}}const Yae=(t,e,i)=>t.add(e).div(e.sub(i)),rWe=(t,e,i)=>e.mul(i).div(i.sub(e).mul(t).sub(i));sc.DEPTH="depth";sc.DEPTH_TEXTURE="depthTexture";sc.DEPTH_PIXEL="depthPixel";const sWe=Ee(sc,sc.DEPTH_PIXEL);ot(sc,sc.DEPTH);Ee(sc,sc.DEPTH_TEXTURE);const nWe=ot(sc,sc.DEPTH_PIXEL);nWe.assign=t=>sWe(t);Ue("ViewportDepthNode",sc);class Ax extends mi{constructor(e=Ax.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const i=e.clippingContext,{localClipIntersection:r,localClippingCount:s,globalClippingCount:n}=i,o=n+s,a=r?o-s:o;return this.scope===Ax.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(i.planes,o,a):this.setupDefault(i.planes,o,a)}setupAlphaToCoverage(e,i,r){return Oe(()=>{const s=YH(e),n=so("float","distanceToPlane"),o=so("float","distanceToGradient"),a=so("float","clipOpacity");a.assign(1);let l;if(Ys(r,({i:c})=>{l=s.element(c),n.assign($d.dot(l.xyz).negate().add(l.w)),o.assign(n.fwidth().div(2)),a.mulAssign(C0(o.negate(),o,n)),a.equal(0).discard()}),r<i){const c=so("float","unionclipOpacity");c.assign(1),Ys({start:r,end:i},({i:u})=>{l=s.element(u),n.assign($d.dot(l.xyz).negate().add(l.w)),o.assign(n.fwidth().div(2)),c.mulAssign(C0(o.negate(),o,n).oneMinus())}),a.mulAssign(c.oneMinus())}Sn.a.mulAssign(a),Sn.a.equal(0).discard()})()}setupDefault(e,i,r){return Oe(()=>{const s=YH(e);let n;if(Ys(r,({i:o})=>{n=s.element(o),$d.dot(n.xyz).greaterThan(n.w).discard()}),r<i){const o=so("bool","clipped");o.assign(!0),Ys({start:r,end:i},({i:a})=>{n=s.element(a),o.assign($d.dot(n.xyz).greaterThan(n.w).and(o))}),o.discard()}})()}}Ax.ALPHA_TO_COVERAGE="alphaToCoverage";Ax.DEFAULT="default";const gti=()=>gt(new Ax),yti=()=>gt(new Ax(Ax.ALPHA_TO_COVERAGE));class oWe extends mi{constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:i,material:r}=e;return i.coordinateSystem===Zm&&r.side===m1?"false":e.getFrontFacing()}}const _ti=ot(oWe),QH=X(_ti).mul(2).sub(1);Ue("FrontFacingNode",oWe);const Xae=new Map;class Ea extends $h{constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!0,this.normals=!0,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.depthNode=null,this.shadowNode=null,this.shadowPositionNode=null,this.outputNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+F9e(this)}build(e){this.setup(e)}setup(e){e.addStack(),e.stack.outputNode=this.vertexNode||this.setupPosition(e),e.addFlow("vertex",e.removeStack()),e.addStack();let i;const r=this.setupClipping(e);if(this.depthWrite===!0&&this.setupDepth(e),this.fragmentNode===null){this.normals===!0&&this.setupNormal(e),this.setupDiffuseColor(e),this.setupVariants(e);const s=this.setupLighting(e);r!==null&&e.stack.add(r);const n=Ft(s,Sn.a).max(0);i=this.setupOutput(e,n),lKt.assign(i),this.outputNode!==null&&(i=this.outputNode)}else{let s=this.fragmentNode;s.isOutputStructNode!==!0&&(s=Ft(s)),i=this.setupOutput(e,s)}e.stack.outputNode=i,e.addFlow("fragment",e.removeStack())}setupClipping(e){if(e.clippingContext===null)return null;const{globalClippingCount:i,localClippingCount:r}=e.clippingContext;let s=null;return(i||r)&&(this.alphaToCoverage?s=yti():e.stack.add(gti())),s}setupDepth(e){const{renderer:i}=e;let r=this.depthNode;r===null&&i.logarithmicDepthBuffer===!0&&(r=jae().w.add(1).log2().mul(mei).mul(.5)),r!==null&&nWe.assign(r).append()}setupPosition(e){const{object:i}=e,r=i.geometry;if(e.addStack(),(r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color)&&Yei(i).append(),i.isSkinnedMesh===!0&&qei(i).append(),this.displacementMap){const n=Sv("displacementMap","texture"),o=Sv("displacementScale","float"),a=Sv("displacementBias","float");Xa.addAssign(Tg.normalize().mul(n.x.mul(o).add(a)))}i.isBatchedMesh&&Hei(i).append(),i.instanceMatrix&&i.instanceMatrix.isInstancedBufferAttribute===!0&&e.isAvailable("instance")===!0&&jei(i).append(),this.positionNode!==null&&Xa.assign(this.positionNode);const s=jae();return e.context.vertex=e.removeStack(),e.context.mvp=s,s}setupDiffuseColor({object:e,geometry:i}){let r=this.colorNode?Ft(this.colorNode):fk;this.vertexColors===!0&&i.hasAttribute("color")&&(r=Ft(r.xyz.mul(ml("color","vec3")),r.a)),e.instanceColor&&(r=Ry("vec3","vInstanceColor").mul(r)),Sn.assign(r);const s=this.opacityNode?X(this.opacityNode):O7e;if(Sn.a.assign(Sn.a.mul(s)),this.alphaTestNode!==null||this.alphaTest>0){const n=this.alphaTestNode!==null?X(this.alphaTestNode):yei;Sn.a.lessThanEqual(n).discard()}}setupVariants(){}setupNormal(){if(this.flatShading===!0){const e=$d.dFdx().cross($d.dFdy()).normalize();Ho.assign(e.mul(QH))}else{const e=this.normalNode?ne(this.normalNode):Eei;Ho.assign(e.mul(QH))}}getEnvNode(e){let i=null;return this.envNode?i=this.envNode:this.envMap?i=this.envMap.isCubeTexture?rW(this.envMap):xa(this.envMap):e.environmentNode&&(i=e.environmentNode),i}setupLights(e){const i=this.getEnvNode(e),r=[];if(i&&r.push(new Q7e(i)),e.material.lightMap&&r.push(new K7e(Sv("lightMap","texture"))),this.aoNode!==null||e.material.aoMap){const n=this.aoNode!==null?this.aoNode:xa(e.material.aoMap);r.push(new W7e(n))}let s=this.lightsNode||e.lightsNode;return r.length>0&&(s=Qei([...s.lightNodes,...r])),s}setupLightingModel(){}setupLighting(e){const{material:i}=e,{backdropNode:r,backdropAlphaNode:s,emissiveNode:n}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let l=Sn.rgb;if(a&&a.hasLight!==!1){const c=this.setupLightingModel(e);l=X7e(a,c,r,s)}else r!==null&&(l=ne(s!==null?Po(l,r,s):r));return(n&&n.isNode===!0||i.emissive&&i.emissive.isColor===!0)&&(l=l.add(ne(n||vei))),l}setupOutput(e,i){const r=e.fogNode;return r&&(i=Ft(r.mix(i.rgb,r.colorNode),i.a)),i}setDefaultValues(e){for(const r in e){const s=e[r];this[r]===void 0&&(this[r]=s,s&&s.clone&&(this[r]=s.clone()))}const i=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const r in i)Object.getOwnPropertyDescriptor(this.constructor.prototype,r)===void 0&&i[r].get!==void 0&&Object.defineProperty(this.constructor.prototype,r,i[r])}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{},nodes:{}});const r=$h.prototype.toJSON.call(this,e),s=BH(this);r.inputNodes={};for(const{property:o,childNode:a}of s)r.inputNodes[o]=a.toJSON(e).uuid;function n(o){const a=[];for(const l in o){const c=o[l];delete c.metadata,a.push(c)}return a}if(i){const o=n(e.textures),a=n(e.images),l=n(e.nodes);o.length>0&&(r.textures=o),a.length>0&&(r.images=a),l.length>0&&(r.nodes=l)}return r}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.depthNode=e.depthNode,this.shadowNode=e.shadowNode,this.shadowPositionNode=e.shadowPositionNode,this.outputNode=e.outputNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}static fromMaterial(e){if(e.isNodeMaterial===!0)return e;const i=e.type.replace("Material","NodeMaterial"),r=kfe(i);if(r===void 0)throw new Error(`NodeMaterial: Material "${e.type}" is not compatible.`);for(const s in e)r[s]=e[s];return r}}function Pl(t,e){if(typeof e!="function"||!t)throw new Error(`Node material ${t} is not a class`);if(Xae.has(t)){console.warn(`Redefinition of node material ${t}`);return}Xae.set(t,e),e.type=t}function kfe(t){const e=Xae.get(t);if(e!==void 0)return new e}Pl("NodeMaterial",Ea);class WC{constructor(e,i){this.name=e,this.value=i,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class vti extends WC{constructor(e,i=0){super(e,i),this.isFloatUniform=!0,this.boundary=4,this.itemSize=1}}class bti extends WC{constructor(e,i=new Xi){super(e,i),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class wti extends WC{constructor(e,i=new ve){super(e,i),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class xti extends WC{constructor(e,i=new Fs){super(e,i),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class Sti extends WC{constructor(e,i=new ds){super(e,i),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class Tti extends WC{constructor(e,i=new Tf){super(e,i),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class Eti extends WC{constructor(e,i=new kn){super(e,i),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class Cti extends vti{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Mti extends bti{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Ati extends wti{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Rti extends xti{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Pti extends Sti{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Oti extends Tti{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Iti extends Eti{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class aWe extends mi{constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}if(e,i){const r=new JD(i);return this._currentCond=Nd(e,r),this.add(this._currentCond)}elseif(e,i){const r=new JD(i),s=Nd(e,r);return this._currentCond.elseNode=s,this._currentCond=s,this}else(e){return this._currentCond.elseNode=new JD(e),this}build(e,...i){const r=H9e();zH(this);for(const s of this.nodes)s.build(e,"void");return zH(r),this.outputNode?this.outputNode.build(e,...i):super.build(e,...i)}}const bQ=Ee(aWe);Ue("StackNode",aWe);class lWe extends dn{constructor(e=N7e){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,i=e.z.atan2(e.x).mul(1/(Math.PI*2)).add(.5),r=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Vt(i,r)}}const cWe=Ee(lWe);Ue("EquirectUVNode",lWe);class $ti extends ZJt{constructor(e=1,i={}){super(e,i),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,i){const r=i.minFilter,s=i.generateMipmaps;i.generateMipmaps=!0,this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const n=new B4(5,5,5),o=cWe(N7e),a=kfe("MeshBasicNodeMaterial");a.colorNode=xa(i,o,0),a.side=m1,a.blending=vI;const l=new eS(n,a),c=new yfe;return c.add(l),i.minFilter===_E&&(i.minFilter=yf),new T9e(1,10,this).update(e,c),i.minFilter=r,i.currentGenerateMipmaps=s,l.geometry.dispose(),l.material.dispose(),this}}const Nti=$ti;class Qv{constructor(){this.weakMap=new WeakMap}get(e){let i=this.weakMap;for(let r=0;r<e.length;r++)if(i=i.get(e[r]),i===void 0)return;return i.get(e[e.length-1])}set(e,i){let r=this.weakMap;for(let s=0;s<e.length;s++){const n=e[s];r.has(n)===!1&&r.set(n,new WeakMap),r=r.get(n)}return r.set(e[e.length-1],i)}delete(e){let i=this.weakMap;for(let r=0;r<e.length;r++)if(i=i.get(e[r]),i===void 0)return!1;return i.delete(e[e.length-1])}}const _P=4,mMe=[.125,.215,.35,.446,.526,.582],R2=20,wQ=new gfe(-1,1,1,-1,0,1),Lti=new Ny(90,1),gMe=new ds;let xQ=null,SQ=0,TQ=0;const h2=(1+Math.sqrt(5))/2,SA=1/h2,yMe=[new ve(-h2,SA,0),new ve(h2,SA,0),new ve(-SA,0,h2),new ve(SA,0,h2),new ve(0,h2,-SA),new ve(0,h2,SA),new ve(-1,1,-1),new ve(1,1,-1),new ve(-1,1,1),new ve(1,1,1)],Dti=[3,1,5,0,4,2],EQ=ati(Ef(),ml("faceIndex")).normalize(),Ufe=ne(EQ.x,EQ.y.negate(),EQ.z);class Fti{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}fromScene(e,i=0,r=.1,s=100){xQ=this._renderer.getRenderTarget(),SQ=this._renderer.getActiveCubeFace(),TQ=this._renderer.getActiveMipmapLevel(),this._setSize(256);const n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,r,s,n),i>0&&this._blur(n,0,0,i),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=vMe(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=bMe(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(xQ,SQ,TQ),e.scissorTest=!1,Uz(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===uk||e.mapping===$H?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),xQ=this._renderer.getRenderTarget(),SQ=this._renderer.getActiveCubeFace(),TQ=this._renderer.getActiveMipmapLevel();const r=i||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,r={magFilter:yf,minFilter:yf,generateMipmaps:!1,type:vE,format:u$,colorSpace:wg},s=_Me(e,i,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_Me(e,i,r);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=kti(n)),this._blurMaterial=Uti(n,e,i)}return s}_compileMaterial(e){const i=this._lodMeshes[0];i.material=e,this._renderer.compile(i,wQ)}_sceneToCubeUV(e,i,r,s){const n=Lti;n.near=i,n.far=r;const o=[-1,1,-1,-1,-1,-1],a=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear;l.getClearColor(gMe),l.autoClear=!1;let u=this._backgroundBox;if(u===null){const f=new mfe({name:"PMREM.Background",side:m1,depthWrite:!1,depthTest:!1});u=new eS(new B4,f)}let h=!1;const p=e.background;p?p.isColor&&(u.material.color.copy(p),e.background=null,h=!0):(u.material.color.copy(gMe),h=!0),l.setRenderTarget(s),l.clear(),h&&l.render(u,n);for(let f=0;f<6;f++){const g=f%3;g===0?(n.up.set(0,o[f],0),n.lookAt(a[f],0,0)):g===1?(n.up.set(0,0,o[f]),n.lookAt(0,a[f],0)):(n.up.set(0,o[f],0),n.lookAt(0,0,a[f]));const y=this._cubeSize;Uz(s,g*y,f>2?y:0,y,y),l.render(e,n)}l.autoClear=c,e.background=p}_textureToCubeUV(e,i){const r=this._renderer,s=e.mapping===uk||e.mapping===$H;s?this._cubemapMaterial===null&&(this._cubemapMaterial=vMe(e)):this._equirectMaterial===null&&(this._equirectMaterial=bMe(e));const n=s?this._cubemapMaterial:this._equirectMaterial;n.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=n;const a=this._cubeSize;Uz(i,0,0,3*a,2*a),r.setRenderTarget(i),r.render(o,wQ)}_applyPMREM(e){const i=this._renderer,r=i.autoClear;i.autoClear=!1;const s=this._lodPlanes.length;for(let n=1;n<s;n++){const o=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),a=yMe[(s-n-1)%yMe.length];this._blur(e,n-1,n,o,a)}i.autoClear=r}_blur(e,i,r,s,n){const o=this._pingPongRenderTarget;this._halfBlur(e,o,i,r,s,"latitudinal",n),this._halfBlur(o,e,r,r,s,"longitudinal",n)}_halfBlur(e,i,r,s,n,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=this._lodMeshes[s];h.material=c;const p=c.uniforms,f=this._sizeLods[r]-1,g=isFinite(n)?Math.PI/(2*f):2*Math.PI/(2*R2-1),y=n/g,v=isFinite(n)?1+Math.floor(u*y):R2;v>R2&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${R2}`);const b=[];let w=0;for(let R=0;R<R2;++R){const I=R/y,F=Math.exp(-I*I/2);b.push(F),R===0?w+=F:R<v&&(w+=2*F)}for(let R=0;R<b.length;R++)b[R]=b[R]/w;e.texture.frame=(e.texture.frame||0)+1,p.envMap.value=e.texture,p.samples.value=v,p.weights.array=b,p.latitudinal.value=o==="latitudinal"?1:0,a&&(p.poleAxis.value=a);const{_lodMax:x}=this;p.dTheta.value=g,p.mipInt.value=x-r;const S=this._sizeLods[s],E=3*S*(s>x-_P?s-x+_P:0),C=4*(this._cubeSize-S);Uz(i,E,C,3*S,2*S),l.setRenderTarget(i),l.render(h,wQ)}}function kti(t){const e=[],i=[],r=[],s=[];let n=t;const o=t-_P+1+mMe.length;for(let a=0;a<o;a++){const l=Math.pow(2,n);i.push(l);let c=1/l;a>t-_P?c=mMe[a-t+_P-1]:a===0&&(c=0),r.push(c);const u=1/(l-2),h=-u,p=1+u,f=[h,h,p,h,p,p,h,h,p,p,h,p],g=6,y=6,v=3,b=2,w=1,x=new Float32Array(v*y*g),S=new Float32Array(b*y*g),E=new Float32Array(w*y*g);for(let R=0;R<g;R++){const I=R%3*2/3-1,F=R>2?0:-1,D=[I,F,0,I+2/3,F,0,I+2/3,F+1,0,I,F,0,I+2/3,F+1,0,I,F+1,0],z=Dti[R];x.set(D,v*y*z),S.set(f,b*y*z);const B=[z,z,z,z,z,z];E.set(B,w*y*z)}const C=new Kx;C.setAttribute("position",new lf(x,v)),C.setAttribute("uv",new lf(S,b)),C.setAttribute("faceIndex",new lf(E,w)),e.push(C),s.push(new eS(C,null)),n>_P&&n--}return{lodPlanes:e,sizeLods:i,sigmas:r,lodMeshes:s}}function _Me(t,e,i){const r=new xg(t,e,i);return r.texture.mapping=UZt,r.texture.name="PMREM.cubeUv",r.texture.isPMREMTexture=!0,r.scissorTest=!0,r}function Uz(t,e,i,r,s){const n=t.height-s-i;t.viewport.set(e,n,r,s),t.scissor.set(e,n,r,s)}function Bfe(){const t=new Ea;return t.depthTest=!1,t.depthWrite=!1,t.blending=vI,t}function Uti(t,e,i){const r=YH(new Array(R2).fill(0)),s=Tr(new ve(0,1,0)),n=Tr(0),o=X(R2),a=Tr(0),l=Tr(1),c=xa(null),u=Tr(0),h=X(1/e),p=X(1/i),f=X(t),g={n:o,latitudinal:a,weights:r,poleAxis:s,outputDirection:Ufe,dTheta:n,samples:l,envMap:c,mipInt:u,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:f},y=Bfe();return y.uniforms=g,y.fragmentNode=cti({...g,latitudinal:a.equal(1)}),y}function vMe(t){const e=Bfe();return e.fragmentNode=rW(t,Ufe),e}function bMe(t){const e=Bfe();return e.fragmentNode=xa(t,cWe(Ufe),0),e}const Bti=Fti,wMe=new Qv,zti=new Map([[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),Vti=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),Bz=t=>(t=Number(t),t+(t%1?"":".0"));class uWe{constructor(e,i,r,s=null,n=null){this.object=e,this.material=n||e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=i,this.parser=r,this.scene=s,this.nodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.hashNodes={},this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:[],fragment:[],compute:[]},this.bindingsOffset={vertex:0,fragment:0,compute:0},this.bindingsArray=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=bQ(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={keywords:new aKt,material:this.material},this.cache=new Nae,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null}createRenderTarget(e,i,r){return new xg(e,i,r)}createCubeRenderTarget(e,i){return new Nti(e,i)}createPMREMGenerator(){return new Bti(this.renderer)}includes(e){return this.nodes.includes(e)}_getSharedBindings(e){const i=[];for(const r of e)if(r.shared===!0){const s=r.getNodes();let n=wMe.get(s);n===void 0&&(wMe.set(s,r),n=r),i.push(n)}else i.push(r);return i}getBindings(){let e=this.bindingsArray;if(e===null){const i=this.bindings;this.bindingsArray=e=this._getSharedBindings(this.material!==null?[...i.vertex,...i.fragment]:i.compute)}return e}setHashNode(e,i){this.hashNodes[i]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}buildUpdateNodes(){for(const e of this.nodes){const i=e.getUpdateType(),r=e.getUpdateBeforeType();i!==es.NONE&&this.updateNodes.push(e.getSelf()),r!==es.NONE&&this.updateBeforeNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,i){return this.flowNodes[e].push(i),i}setContext(e){this.context=e}getContext(){return this.context}setCache(e){this.cache=e}getCache(){return this.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateConst(e,i=null){if(i===null&&(e==="float"||e==="int"||e==="uint"?i=0:e==="bool"?i=!1:e==="color"?i=new ds:e==="vec2"?i=new Xi:e==="vec3"?i=new ve:e==="vec4"&&(i=new Fs)),e==="float")return Bz(i);if(e==="int")return`${Math.round(i)}`;if(e==="uint")return i>=0?`${Math.round(i)}u`:"0u";if(e==="bool")return i?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${Bz(i.r)}, ${Bz(i.g)}, ${Bz(i.b)} )`;const r=this.getTypeLength(e),s=this.getComponentType(e),n=o=>this.generateConst(s,o);if(r===2)return`${this.getType(e)}( ${n(i.x)}, ${n(i.y)} )`;if(r===3)return`${this.getType(e)}( ${n(i.x)}, ${n(i.y)}, ${n(i.z)} )`;if(r===4)return`${this.getType(e)}( ${n(i.x)}, ${n(i.y)}, ${n(i.z)}, ${n(i.w)} )`;if(r>4&&i&&(i.isMatrix3||i.isMatrix4))return`${this.getType(e)}( ${i.elements.map(n).join(", ")} )`;if(r>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,i){const r=this.attributes;for(const n of r)if(n.name===e)return n;const s=new eMe(e,i);return r.push(s),s}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"}needsColorSpaceToLinear(){return!1}getComponentTypeFromTexture(e){const i=e.type;if(e.isDataTexture){if(i===Im)return"int";if(i===xd)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const i=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return i===null?null:i[1]==="b"?"bool":i[1]==="i"?"int":i[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,i="float"){if(e===1)return i;const r=zti.get(e);return(i==="float"?"":i[0])+r}getTypeFromArray(e){return Vti.get(e.constructor)}getTypeFromAttribute(e){let i=e;e.isInterleavedBufferAttribute&&(i=e.data);const r=i.array,s=e.itemSize,n=e.normalized;let o;return!(e instanceof w9e)&&n!==!0&&(o=this.getTypeFromArray(r)),this.getTypeFromLength(s,o)}getTypeLength(e){const i=this.getVectorType(e),r=/vec([2-4])/.exec(i);return r!==null?Number(r[1]):i==="float"||i==="bool"||i==="int"||i==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,i){return this.getTypeFromLength(this.getTypeLength(e),i)}getIntegerType(e){const i=this.getComponentType(e);return i==="int"||i==="uint"?e:this.changeComponentType(e,"int")}addStack(){return this.stack=bQ(this.stack),this.stacks.push(H9e()||this.stack),zH(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,zH(this.stacks.pop()),e}getDataFromNode(e,i=this.shaderStage,r=null){r=r===null?e.isGlobal(this)?this.globalCache:this.cache:r;let s=r.getNodeData(e);return s===void 0&&(s={},r.setNodeData(e,s)),s[i]===void 0&&(s[i]={}),s[i]}getNodeProperties(e,i="any"){const r=this.getDataFromNode(e,i);return r.properties||(r.properties={outputNode:null})}getBufferAttributeFromNode(e,i){const r=this.getDataFromNode(e);let s=r.bufferAttribute;if(s===void 0){const n=this.uniforms.index++;s=new eMe("nodeAttribute"+n,i,e),this.bufferAttributes.push(s),r.bufferAttribute=s}return s}getStructTypeFromNode(e,i=this.shaderStage){const r=this.getDataFromNode(e,i);if(r.structType===void 0){const s=this.structs.index++;e.name=`StructType${s}`,this.structs[i].push(e),r.structType=e}return e}getUniformFromNode(e,i,r=this.shaderStage,s=null){const n=this.getDataFromNode(e,r,this.globalCache);let o=n.uniform;if(o===void 0){const a=this.uniforms.index++;o=new sKt(s||"nodeUniform"+a,i,e),this.uniforms[r].push(o),n.uniform=o}return o}getVarFromNode(e,i=null,r=e.getNodeType(this),s=this.shaderStage){const n=this.getDataFromNode(e,s);let o=n.variable;if(o===void 0){const a=this.vars[s]||(this.vars[s]=[]);i===null&&(i="nodeVar"+a.length),o=new e7e(i,r),a.push(o),n.variable=o}return o}getVaryingFromNode(e,i=null,r=e.getNodeType(this)){const s=this.getDataFromNode(e,"any");let n=s.varying;if(n===void 0){const o=this.varyings,a=o.length;i===null&&(i="nodeVarying"+a),n=new nKt(i,r),o.push(n),s.varying=n}return n}getCodeFromNode(e,i,r=this.shaderStage){const s=this.getDataFromNode(e);let n=s.code;if(n===void 0){const o=this.codes[r]||(this.codes[r]=[]),a=o.length;n=new oKt("nodeCode"+a,i),o.push(n),s.code=n}return n}addLineFlowCode(e){return e===""?this:(e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const i=e.getNodeType(this),r=this.flowChildNode(e,i);return this.flowsData.set(e,r),r}buildFunctionNode(e){const i=new a7e,r=this.currentFunctionNode;return this.currentFunctionNode=i,i.code=this.buildFunctionCode(e),this.currentFunctionNode=r,i}flowShaderNode(e){const i=e.layout;let r;if(e.isArrayInput){r=[];for(const o of i.inputs)r.push(new Uae(o.type,o.name))}else{r={};for(const o of i.inputs)r[o.name]=new Uae(o.type,o.name)}e.layout=null;const s=e.call(r),n=this.flowStagesNode(s,i.type);return e.layout=i,n}flowStagesNode(e,i=null){const r=this.flow,s=this.vars,n=this.cache,o=this.buildStage,a=this.stack,l={code:""};this.flow=l,this.vars={},this.cache=new Nae,this.stack=bQ();for(const c of YCe)this.setBuildStage(c),l.result=e.build(this,i);return l.vars=this.getVars(this.shaderStage),this.flow=r,this.vars=s,this.cache=n,this.stack=a,this.setBuildStage(o),l}getFunctionOperator(){return null}flowChildNode(e,i=null){const r=this.flow,s={code:""};return this.flow=s,s.result=e.build(this,i),this.flow=r,s}flowNodeFromShaderStage(e,i,r=null,s=null){const n=this.shaderStage;this.setShaderStage(e);const o=this.flowChildNode(i,r);return s!==null&&(o.code+=`${this.tab+s} = ${o.result};
`),this.flowCode[e]=this.flowCode[e]+o.code,this.setShaderStage(n),o}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,i){return`${this.getType(e)} ${i}`}getVars(e){let i="";const r=this.vars[e];if(r!==void 0)for(const s of r)i+=`${this.getVar(s.type,s.name)}; `;return i}getUniforms(){console.warn("Abstract function.")}getCodes(e){const i=this.codes[e];let r="";if(i!==void 0)for(const s of i)r+=s.code+`
`;return r}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:i}=this;i!==null?Ea.fromMaterial(i).build(this):this.addFlow("compute",e);for(const r of YCe){this.setBuildStage(r),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of bQt){this.setShaderStage(s);const n=this.flowNodes[s];for(const o of n)r==="generate"?this.flowNode(o):o.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,i){if(i==="float")return new Cti(e);if(i==="vec2")return new Mti(e);if(i==="vec3")return new Ati(e);if(i==="vec4")return new Rti(e);if(i==="color")return new Pti(e);if(i==="mat3")return new Oti(e);if(i==="mat4")return new Iti(e);throw new Error(`Uniform "${i}" not declared.`)}createNodeMaterial(e="NodeMaterial"){return kfe(e)}format(e,i,r){if(i=this.getVectorType(i),r=this.getVectorType(r),i===r||r===null||this.isReference(r))return e;const s=this.getTypeLength(i),n=this.getTypeLength(r);return s>4||n>4||n===0?e:s===n?`${this.getType(r)}( ${e} )`:s>n?this.format(`${e}.${"xyz".slice(0,n)}`,this.getTypeFromLength(n,this.getComponentType(i)),r):n===4&&s>1?`${this.getType(r)}( ${this.format(e,i,"vec3")}, 1.0 )`:s===2?`${this.getType(r)}( ${this.format(e,i,"vec2")}, 0.0 )`:(s===1&&n>1&&i[0]!==r[0]&&(e=`${this.getType(this.getComponentType(r))}( ${e} )`),`${this.getType(r)}( ${e} )`)}getSignature(){return`// Three.js r${H7} - NodeMaterial System
`}}class xMe{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.startTime=null,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,i){let r=e.get(i);return r===void 0&&(r={renderMap:new WeakMap,frameMap:new WeakMap},e.set(i,r)),r}updateBeforeNode(e){const i=e.getUpdateBeforeType(),r=e.updateReference(this);if(i===es.FRAME){const{frameMap:s}=this._getMaps(this.updateBeforeMap,r);s.get(r)!==this.frameId&&e.updateBefore(this)!==!1&&s.set(r,this.frameId)}else if(i===es.RENDER){const{renderMap:s}=this._getMaps(this.updateBeforeMap,r);s.get(r)!==this.renderId&&e.updateBefore(this)!==!1&&s.set(r,this.renderId)}else i===es.OBJECT&&e.updateBefore(this)}updateNode(e){const i=e.getUpdateType(),r=e.updateReference(this);if(i===es.FRAME){const{frameMap:s}=this._getMaps(this.updateMap,r);s.get(r)!==this.frameId&&e.update(this)!==!1&&s.set(r,this.frameId)}else if(i===es.RENDER){const{renderMap:s}=this._getMaps(this.updateMap,r);s.get(r)!==this.renderId&&e.update(this)!==!1&&s.set(r,this.renderId)}else i===es.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class zfe{constructor(e,i,r=null,s="",n=!1){this.type=e,this.name=i,this.count=r,this.qualifier=s,this.isConst=n}}zfe.isNodeFunctionInput=!0;class hWe extends mi{constructor(e){super(),this.types=e,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}Ue("StructTypeNode",hWe);class dWe extends mi{constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}setup(e){super.setup(e);const i=this.members,r=[];for(let s=0;s<i.length;s++)r.push(i[s].getNodeType(e));this.nodeType=e.getStructTypeFromNode(new hWe(r)).name}generate(e,i){const r=e.getOutputStructName(),s=this.members,n=r!==""?r+".":"";for(let o=0;o<s.length;o++){const a=s[o].build(e,i);e.addLineFlowCode(`${n}m${o} = ${a}`)}return r}}Ee(dWe);Ue("OutputStructNode",dWe);class pWe extends mi{constructor(e){super(),this.seedNode=e}setup(){const e=this.seedNode.toUint().mul(747796405).add(2891336453),i=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return i.shiftRight(22).bitXor(i).toFloat().mul(1/2**32)}}const Gti=Ee(pWe);fe("hash",Gti);Ue("HashNode",pWe);const Zae=(t,e)=>i0(Xr(4,t.mul(Yo(1,t))),e),jti=(t,e)=>t.lessThan(.5)?Zae(t.mul(2),e).div(2):Yo(1,Zae(Xr(Yo(1,t),2),e).div(2)),Hti=(t,e,i)=>i0(Cx(i0(t,e),Jd(i0(t,e),i0(Yo(1,t),i))),1/e),qti=(t,e)=>uv(tMe.mul(e.mul(t).sub(1))).div(tMe.mul(e.mul(t).sub(1)));fe("parabola",Zae);fe("gain",jti);fe("pcurve",Hti);fe("sinc",qti);const Dy=Oe(([t])=>t.fract().sub(.5).abs()),fWe=Oe(([t])=>ne(Dy(t.z.add(Dy(t.y.mul(1)))),Dy(t.z.add(Dy(t.x.mul(1)))),Dy(t.y.add(Dy(t.x.mul(1)))))),Wti=Oe(([t,e,i])=>{const r=ne(t).toVar(),s=X(1.4).toVar(),n=X(0).toVar(),o=ne(r).toVar();return Ys({start:X(0),end:X(3),type:"float",condition:"<="},()=>{const a=ne(fWe(o.mul(2))).toVar();r.addAssign(a.add(i.mul(X(.1).mul(e)))),o.mulAssign(1.8),s.mulAssign(1.5),r.mulAssign(1.2);const l=X(Dy(r.z.add(Dy(r.x.add(Dy(r.y)))))).toVar();n.addAssign(l.div(s)),o.addAssign(.14)}),n});Dy.setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]});fWe.setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]});Wti.setLayout({name:"triNoise3D",type:"float",inputs:[{name:"p",type:"vec3"},{name:"spd",type:"float"},{name:"time",type:"float"}]});let CQ;class mWe extends Ffe{constructor(e){CQ=CQ||eW("discard"),super(e,CQ)}}const Yti=Ee(mWe),Xti=t=>Yti(t).append();fe("discard",Xti);Ue("DiscardNode",mWe);class gWe extends mi{constructor(e=[],...i){super(),this.functionNodes=e,this.parametersNodes=i,this._candidateFnCall=null}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(e){const i=this.parametersNodes;let r=this._candidateFnCall;if(r===null){let s=null,n=-1;for(const o of this.functionNodes){const l=o.shaderNode.layout;if(l===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const c=l.inputs;if(i.length===c.length){let u=0;for(let h=0;h<i.length;h++){const p=i[h],f=c[h];p.getNodeType(e)===f.type?u++:u=0}u>n&&(s=o,n=u)}}this._candidateFnCall=r=s(...i)}return r}}const Zti=Ee(gWe),Cf=t=>(...e)=>Zti(t,...e);Ue("FunctionOverloadingNode",gWe);class yWe extends dn{constructor(){super("vec2")}setup(){const e=ne(no.z,0,no.x.negate()).normalize(),i=no.cross(e);return Vt(e.dot(Ho),i.dot(Ho)).mul(.495).add(.5)}}const Jti=ot(yWe);Ue("MatcapUVNode",yWe);class Th extends tS{constructor(e=Th.LOCAL,i=1,r=0){super(r),this.scope=e,this.scale=i,this.updateType=es.FRAME}update(e){const i=this.scope,r=this.scale;i===Th.LOCAL?this.value+=e.deltaTime*r:i===Th.DELTA?this.value=e.deltaTime*r:i===Th.FRAME?this.value=e.frameId:this.value=e.time*r}serialize(e){super.serialize(e),e.scope=this.scope,e.scale=this.scale}deserialize(e){super.deserialize(e),this.scope=e.scope,this.scale=e.scale}}Th.LOCAL="local";Th.GLOBAL="global";Th.DELTA="delta";Th.FRAME="frame";const _We=(t,e=0)=>gt(new Th(Th.LOCAL,t,e));ot(Th,Th.FRAME).toUint();Ue("TimerNode",Th);class Va extends mi{constructor(e=Va.SINE,i=_We()){super(),this.method=e,this.timeNode=i}getNodeType(e){return this.timeNode.getNodeType(e)}setup(){const e=this.method,i=gt(this.timeNode);let r=null;return e===Va.SINE?r=i.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5):e===Va.SQUARE?r=i.fract().round():e===Va.TRIANGLE?r=i.add(.5).fract().mul(2).sub(1).abs():e===Va.SAWTOOTH&&(r=i.fract()),r}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Va.SINE="sine";Va.SQUARE="square";Va.TRIANGLE="triangle";Va.SAWTOOTH="sawtooth";Ee(Va,Va.SINE);Ee(Va,Va.SQUARE);Ee(Va,Va.TRIANGLE);Ee(Va,Va.SAWTOOTH);Ue("OscNode",Va);class M0 extends dn{constructor(e,i){super(),this.scope=e,this.node=i}getNodeType(e){return this.node.getNodeType(e)}setup(){const{scope:e,node:i}=this;let r=null;return e===M0.DIRECTION_TO_COLOR?r=i.mul(.5).add(.5):e===M0.COLOR_TO_DIRECTION&&(r=i.mul(2).sub(1)),r}}M0.DIRECTION_TO_COLOR="directionToColor";M0.COLOR_TO_DIRECTION="colorToDirection";const vWe=Ee(M0,M0.DIRECTION_TO_COLOR),Qti=Ee(M0,M0.COLOR_TO_DIRECTION);fe("directionToColor",vWe);fe("colorToDirection",Qti);Ue("PackingNode",M0);class Vfe extends mi{constructor(e,i,r,s=X(0),n=X(1)){super(),this.node=e,this.inLowNode=i,this.inHighNode=r,this.outLowNode=s,this.outHighNode=n,this.doClamp=!0}setup(){const{node:e,inLowNode:i,inHighNode:r,outLowNode:s,outHighNode:n,doClamp:o}=this;let a=e.sub(i).div(r.sub(i));return o===!0&&(a=a.clamp()),a.mul(n.sub(s)).add(s)}}const Kti=Ee(Vfe,null,null,{doClamp:!1}),eii=Ee(Vfe);fe("remap",Kti);fe("remapClamp",eii);Ue("RemapNode",Vfe);class bWe extends dn{constructor(e,i,r=Vt(.5)){super("vec2"),this.uvNode=e,this.rotationNode=i,this.centerNode=r}setup(){const{uvNode:e,rotationNode:i,centerNode:r}=this;return e.sub(r).rotate(i).add(r)}}const tii=Ee(bWe);fe("rotateUV",tii);Ue("RotateUVNode",bWe);class wWe extends dn{constructor(e,i){super(),this.positionNode=e,this.rotationNode=i}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:i,positionNode:r}=this;if(this.getNodeType(e)==="vec2"){const n=i.cos(),o=i.sin();return Cfe(n,o,o.negate(),n).mul(r)}else{const n=i,o=nO(Ft(1,0,0,0),Ft(0,sw(n.x),uv(n.x).negate(),0),Ft(0,uv(n.x),sw(n.x),0),Ft(0,0,0,1)),a=nO(Ft(sw(n.y),0,uv(n.y),0),Ft(0,1,0,0),Ft(uv(n.y).negate(),0,sw(n.y),0),Ft(0,0,0,1)),l=nO(Ft(sw(n.z),uv(n.z).negate(),0,0),Ft(uv(n.z),sw(n.z),0,0),Ft(0,0,1,0),Ft(0,0,0,1));return o.mul(a).mul(l).mul(Ft(r,1)).xyz}}}const iii=Ee(wWe);fe("rotate",iii);Ue("RotateNode",wWe);class xWe extends mi{constructor(e,i=Ef(),r=X(0)){super("vec2"),this.countNode=e,this.uvNode=i,this.frameNode=r}setup(){const{frameNode:e,uvNode:i,countNode:r}=this,{width:s,height:n}=r,o=e.mod(s.mul(n)).floor(),a=o.mod(s),l=n.sub(o.add(1).div(s).ceil()),c=r.reciprocal(),u=Vt(a,l);return i.add(u).mul(c)}}Ee(xWe);Ue("SpriteSheetUVNode",xWe);class SWe extends d${constructor(e,i){super(e,i),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}setup(e){return e.isAvailable("storageBuffer")===!1&&!this.node.instanceIndex&&this.node.bufferObject===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,i){let r;const s=e.context.assign;if(e.isAvailable("storageBuffer")===!1){const{node:n}=this;!n.instanceIndex&&this.node.bufferObject===!0&&s!==!0?r=e.generatePBO(this):r=n.build(e)}else r=super.generate(e);if(s!==!0){const n=this.getNodeType(e);r=e.format(r,n,i)}return r}}const TWe=Ee(SWe);fe("storageElement",TWe);Ue("StorageArrayElementNode",SWe);class EWe extends mi{constructor(e,i=null,r=null,s=X(1),n=Xa,o=Tg){super("vec4"),this.textureXNode=e,this.textureYNode=i,this.textureZNode=r,this.scaleNode=s,this.positionNode=n,this.normalNode=o}setup(){const{textureXNode:e,textureYNode:i,textureZNode:r,scaleNode:s,positionNode:n,normalNode:o}=this;let a=o.abs().normalize();a=a.div(a.dot(ne(1)));const l=n.yz.mul(s),c=n.zx.mul(s),u=n.xy.mul(s),h=e.value,p=i!==null?i.value:h,f=r!==null?r.value:h,g=xa(h,l).mul(a.x),y=xa(p,c).mul(a.y),v=xa(f,u).mul(a.z);return Jd(g,y,v)}}const rii=Ee(EWe),sii=(...t)=>rii(...t);fe("triplanarTexture",sii);Ue("TriplanarTexturesNode",EWe);new rw;new ve;new ve;new ve;new kn;new ve(0,0,-1);new Fs;new ve;new ve;new Fs;new Xi;new xg;Vt(SI.x.oneMinus(),SI.y);class nii extends Mfe{constructor(e=0){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const i=this.getAttributeName(e),r=e.hasGeometryAttribute(i);let s;return r===!0?s=super.generate(e):s=e.generateConst(this.nodeType,new Fs(1,1,1,1)),s}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}Ue("VertexColorNode",nii);class CWe extends m${constructor(e,i,r=null){super(e,i,r),this.renderer=r}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const oii=(t,e,i)=>gt(new CWe(t,e,i));Ue("RendererReferenceNode",CWe);const sW=1/6,MWe=t=>Xr(sW,Xr(t,Xr(t,t.negate().add(3)).sub(3)).add(1)),Jae=t=>Xr(sW,Xr(t,Xr(t,Xr(3,t).sub(6))).add(4)),AWe=t=>Xr(sW,Xr(t,Xr(t,Xr(-3,t).add(3)).add(3)).add(1)),Qae=t=>Xr(sW,i0(t,3)),SMe=t=>MWe(t).add(Jae(t)),TMe=t=>AWe(t).add(Qae(t)),EMe=t=>Jd(-1,Jae(t).div(MWe(t).add(Jae(t)))),CMe=t=>Jd(1,Qae(t).div(AWe(t).add(Qae(t)))),MMe=(t,e,i)=>{const r=t.uvNode,s=Xr(r,e.zw).add(.5),n=p$(s),o=K7(s),a=SMe(o.x),l=TMe(o.x),c=EMe(o.x),u=CMe(o.x),h=EMe(o.y),p=CMe(o.y),f=Vt(n.x.add(c),n.y.add(h)).sub(.5).mul(e.xy),g=Vt(n.x.add(u),n.y.add(h)).sub(.5).mul(e.xy),y=Vt(n.x.add(c),n.y.add(p)).sub(.5).mul(e.xy),v=Vt(n.x.add(u),n.y.add(p)).sub(.5).mul(e.xy),b=SMe(o.y).mul(Jd(a.mul(t.uv(f).level(i)),l.mul(t.uv(g).level(i)))),w=TMe(o.y).mul(Jd(a.mul(t.uv(y).level(i)),l.mul(t.uv(v).level(i))));return b.add(w)},aii=(t,e)=>{const i=Vt(t.size(te(e))),r=Vt(t.size(te(e.add(1)))),s=Cx(1,i),n=Cx(1,r),o=MMe(t,Ft(s,i),p$(e)),a=MMe(t,Ft(n,r),g7e(e));return K7(e).mix(o,a)};class RWe extends dn{constructor(e,i=X(3)){super("vec4"),this.textureNode=e,this.blurNode=i}setup(){return aii(this.textureNode,this.blurNode)}}const lii=Ee(RWe);fe("bicubic",lii);Ue("TextureBicubicNode",RWe);class PWe extends mi{constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}ot(PWe);Ue("PointUVNode",PWe);class ng extends mi{constructor(e=ng.BACKGROUND_BLURRINESS,i=null){super(),this.scope=e,this.scene=i}setup(e){const i=this.scope,r=this.scene!==null?this.scene:e.scene;let s;return i===ng.BACKGROUND_BLURRINESS?s=Hc("backgroundBlurriness","float",r):i===ng.BACKGROUND_INTENSITY?s=Hc("backgroundIntensity","float",r):console.error("THREE.SceneNode: Unknown scope:",i),s}}ng.BACKGROUND_BLURRINESS="backgroundBlurriness";ng.BACKGROUND_INTENSITY="backgroundIntensity";const cii=ot(ng,ng.BACKGROUND_BLURRINESS),AMe=ot(ng,ng.BACKGROUND_INTENSITY);Ue("SceneNode",ng);class uii extends tW{constructor(e,i,r=0){super(e,i,r),this.isStorageBufferNode=!0,this.bufferObject=!1,this._attribute=null,this._varying=null,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getInputType(){return"storageBuffer"}element(e){return TWe(this,e)}setBufferObject(e){return this.bufferObject=e,this}generate(e){if(e.isAvailable("storageBuffer"))return super.generate(e);const i=this.getNodeType(e);this._attribute===null&&(this._attribute=iW(this.value),this._varying=Ta(this._attribute));const r=this._varying.build(e,i);return e.registerTransform(r,this._attribute),r}}Ue("StorageBufferNode",uii);const vP={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},Ll={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},zl={Store:"store",Discard:"discard"},ca={Load:"load",Clear:"clear"},MQ={CCW:"ccw",CW:"cw"},AQ={None:"none",Front:"front",Back:"back"},TI={Uint16:"uint16",Uint32:"uint32"},ie={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10uFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Stencil8:"stencil8",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},RQ={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},KH={Linear:"linear",Nearest:"nearest"},$i={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDstColor:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},eT={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},RMe={None:0,Red:1,Green:2,Blue:4,Alpha:8,All:15},lb={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},hii={Uniform:"uniform",Storage:"storage",ReadOnlyStorage:"read-only-storage"},Kae={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},zz={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},PMe={OneD:"1d",TwoD:"2d",ThreeD:"3d"},Vp={OneD:"1d",TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",CubeArray:"cube-array",ThreeD:"3d"},dii={All:"all",StencilOnly:"stencil-only",DepthOnly:"depth-only"},Vz={Vertex:"vertex",Instance:"instance"},YL={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable"};class OWe extends HC{constructor(e,i,r=null){super(e,i),this.storeNode=r,this.isStorageTextureNode=!0,this.access=Kae.WriteOnly}getInputType(){return"storageTexture"}setup(e){super.setup(e);const i=e.getNodeProperties(this);i.storeNode=this.storeNode}setAccess(e){return this.access=e,this}generate(e,i){let r;return this.storeNode!==null?r=this.generateStore(e):r=super.generate(e,i),r}generateStore(e){const i=e.getNodeProperties(this),{uvNode:r,storeNode:s}=i,n=super.generate(e,"property"),o=r.build(e,"uvec2"),a=s.build(e,"vec4"),l=e.generateTextureStore(e,n,o,a);e.addLineFlowCode(l)}}Ee(OWe);Ue("StorageTextureNode",OWe);const pii=Oe(({texture:t,uv:e})=>{const r=ne().temp();return xr(e.x.lessThan(1e-4),()=>{r.assign(ne(1,0,0))}).elseif(e.y.lessThan(1e-4),()=>{r.assign(ne(0,1,0))}).elseif(e.z.lessThan(1e-4),()=>{r.assign(ne(0,0,1))}).elseif(e.x.greaterThan(1-1e-4),()=>{r.assign(ne(-1,0,0))}).elseif(e.y.greaterThan(1-1e-4),()=>{r.assign(ne(0,-1,0))}).elseif(e.z.greaterThan(1-1e-4),()=>{r.assign(ne(0,0,-1))}).else(()=>{const n=t.uv(e.add(ne(-.01,0,0))).r.sub(t.uv(e.add(ne(.01,0,0))).r),o=t.uv(e.add(ne(0,-.01,0))).r.sub(t.uv(e.add(ne(0,.01,0))).r),a=t.uv(e.add(ne(0,0,-.01))).r.sub(t.uv(e.add(ne(0,0,.01))).r);r.assign(ne(n,o,a))}),r.normalize()});class IWe extends HC{constructor(e,i=null,r=null){super(e,i,r),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return ne(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,i){return i}generateUV(e,i){return i.build(e,"vec3")}normal(e){return pii({texture:this,uv:e})}}const fii=Ee(IWe);Ue("Texture3DNode",IWe);class mii extends m${constructor(e,i,r=null){super(e,i,r),this.userData=r}update(e){this.reference=this.userData!==null?this.userData:e.object.userData,super.update(e)}}Ue("UserDataNode",mii);const gii=Oe(({base:t,blend:e})=>{const i=r=>e[r].lessThan(d7e).cond(e[r],t[r].oneMinus().div(e[r]).oneMinus().max(0));return ne(i("x"),i("y"),i("z"))}).setLayout({name:"burnColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),yii=Oe(({base:t,blend:e})=>{const i=r=>e[r].equal(1).cond(e[r],t[r].div(e[r].oneMinus()).max(0));return ne(i("x"),i("y"),i("z"))}).setLayout({name:"dodgeColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),_ii=Oe(({base:t,blend:e})=>{const i=r=>t[r].oneMinus().mul(e[r].oneMinus()).oneMinus();return ne(i("x"),i("y"),i("z"))}).setLayout({name:"screenColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),vii=Oe(({base:t,blend:e})=>{const i=r=>t[r].lessThan(.5).cond(t[r].mul(e[r],2),t[r].oneMinus().mul(e[r].oneMinus()).oneMinus());return ne(i("x"),i("y"),i("z"))}).setLayout({name:"overlayColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]});class bl extends dn{constructor(e,i,r){super(),this.blendMode=e,this.baseNode=i,this.blendNode=r}setup(){const{blendMode:e,baseNode:i,blendNode:r}=this,s={base:i,blend:r};let n=null;return e===bl.BURN?n=gii(s):e===bl.DODGE?n=yii(s):e===bl.SCREEN?n=_ii(s):e===bl.OVERLAY&&(n=vii(s)),n}}bl.BURN="burn";bl.DODGE="dodge";bl.SCREEN="screen";bl.OVERLAY="overlay";const bii=Ee(bl,bl.BURN),wii=Ee(bl,bl.DODGE),xii=Ee(bl,bl.OVERLAY),Sii=Ee(bl,bl.SCREEN);fe("burn",bii);fe("dodge",wii);fe("overlay",xii);fe("screen",Sii);Ue("BlendModeNode",bl);const Tii=Oe(({textureNode:t,bumpScale:e})=>{const i=s=>t.cache().context({getUV:n=>s(n.uvNode||Ef()),forceUVContext:!0}),r=X(i(s=>s));return Vt(X(i(s=>s.add(s.dFdx()))).sub(r),X(i(s=>s.add(s.dFdy()))).sub(r)).mul(e)}),Eii=Oe(t=>{const{surf_pos:e,surf_norm:i,dHdxy:r}=t,s=e.dFdx().normalize(),n=e.dFdy().normalize(),o=i,a=n.cross(o),l=o.cross(s),c=s.dot(a).mul(QH),u=c.sign().mul(r.x.mul(a).add(r.y.mul(l)));return c.abs().mul(i).sub(u).normalize()});class $We extends dn{constructor(e,i=null){super("vec3"),this.textureNode=e,this.scaleNode=i}setup(){const e=this.scaleNode!==null?this.scaleNode:1,i=Tii({textureNode:this.textureNode,bumpScale:e});return Eii({surf_pos:$d,surf_norm:Mx,dHdxy:i})}}const Cii=Ee($We);fe("bumpMap",Cii);Ue("BumpMapNode",$We);const Mii=Oe(({color:t,adjustment:e})=>e.mix(NWe(t.rgb),t.rgb)),Aii=Oe(({color:t,adjustment:e})=>{const i=Jd(t.r,t.g,t.b).div(3),r=t.r.max(t.g.max(t.b)),s=r.sub(i).mul(e).mul(-3);return Po(t.rgb,r,s)}),Rii=Oe(({color:t,adjustment:e})=>{const i=ne(.57735,.57735,.57735),r=e.cos();return ne(t.rgb.mul(r).add(i.cross(t.rgb).mul(e.sin()).add(i.mul(f$(i,t.rgb).mul(r.oneMinus())))))});class Ah extends dn{constructor(e,i,r=X(1)){super("vec3"),this.method=e,this.colorNode=i,this.adjustmentNode=r}setup(){const{method:e,colorNode:i,adjustmentNode:r}=this,s={color:i,adjustment:r};let n=null;return e===Ah.SATURATION?n=Mii(s):e===Ah.VIBRANCE?n=Aii(s):e===Ah.HUE?n=Rii(s):console.error(`${this.type}: Method "${this.method}" not supported!`),n}}Ah.SATURATION="saturation";Ah.VIBRANCE="vibrance";Ah.HUE="hue";const Pii=Ee(Ah,Ah.SATURATION),Oii=Ee(Ah,Ah.VIBRANCE),Iii=Ee(Ah,Ah.HUE),$ii=ne(.2125,.7154,.0721),NWe=(t,e=$ii)=>f$(t,e),LWe=(t,e)=>Po(ne(0),t,NWe(t).sub(e).max(0));fe("saturation",Pii);fe("vibrance",Oii);fe("hue",Iii);fe("threshold",LWe);Ue("ColorAdjustmentNode",Ah);const Nii=Oe(t=>{const{eye_pos:e,surf_norm:i,mapN:r,uv:s}=t,n=e.dFdx(),o=e.dFdy(),a=s.dFdx(),l=s.dFdy(),c=i,u=o.cross(c),h=c.cross(n),p=u.mul(a.x).add(h.mul(l.x)),f=u.mul(a.y).add(h.mul(l.y)),g=p.dot(p).max(f.dot(f)),y=QH.mul(g.inverseSqrt());return Jd(p.mul(r.x,y),f.mul(r.y,y),c.mul(r.z)).normalize()});class DWe extends dn{constructor(e,i=null){super("vec3"),this.node=e,this.scaleNode=i,this.normalMapType=Ex}setup(e){const{normalMapType:i,scaleNode:r}=this;let s=this.node.mul(2).sub(1);r!==null&&(s=ne(s.xy.mul(r),s.z));let n=null;return i===WZt?n=R7e.mul(s).normalize():i===Ex&&(e.hasGeometryAttribute("tangent")===!0?n=yP.mul(s).normalize():n=Nii({eye_pos:$d,surf_norm:Mx,mapN:s,uv:Ef()})),n}}const Lii=Ee(DWe);fe("normalMap",Lii);Ue("NormalMapNode",DWe);class FWe extends dn{constructor(e,i){super(),this.sourceNode=e,this.stepsNode=i}setup(){const{sourceNode:e,stepsNode:i}=this;return e.mul(i).floor().div(i)}}const Dii=Ee(FWe);fe("posterize",Dii);Ue("PosterizeNode",FWe);const Fii=Oe(({color:t,exposure:e})=>t.mul(e).clamp()),kii=Oe(({color:t,exposure:e})=>(t=t.mul(e),t.div(t.add(1)).clamp())),Uii=Oe(({color:t,exposure:e})=>{t=t.mul(e),t=t.sub(.004).max(0);const i=t.mul(t.mul(6.2).add(.5)),r=t.mul(t.mul(6.2).add(1.7)).add(.06);return i.div(r).pow(2.2)}),Bii=Oe(({color:t})=>{const e=t.mul(t.add(.0245786)).sub(90537e-9),i=t.mul(t.add(.432951).mul(.983729)).add(.238081);return e.div(i)}),zii=Oe(({color:t,exposure:e})=>{const i=Sg(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=Sg(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return t=t.mul(e).div(.6),t=i.mul(t),t=Bii({color:t}),t=r.mul(t),t.clamp()}),Vii=Sg(ne(1.6605,-.1246,-.0182),ne(-.5876,1.1329,-.1006),ne(-.0728,-.0083,1.1187)),Gii=Sg(ne(.6274,.0691,.0164),ne(.3293,.9195,.088),ne(.0433,.0113,.8956)),jii=Oe(([t])=>{const e=ne(t).toVar(),i=ne(e.mul(e)).toVar(),r=ne(i.mul(i)).toVar();return X(15.5).mul(r.mul(i)).sub(Xr(40.14,r.mul(e))).add(Xr(31.96,r).sub(Xr(6.868,i.mul(e))).add(Xr(.4298,i).add(Xr(.1191,e).sub(.00232))))}),Hii=Oe(({color:t,exposure:e})=>{const i=ne(t).toVar(),r=Sg(ne(.856627153315983,.137318972929847,.11189821299995),ne(.0951212405381588,.761241990602591,.0767994186031903),ne(.0482516061458583,.101439036467562,.811302368396859)),s=Sg(ne(1.1271005818144368,-.1413297634984383,-.14132976349843826),ne(-.11060664309660323,1.157823702216272,-.11060664309660294),ne(-.016493938717834573,-.016493938717834257,1.2519364065950405)),n=X(-12.47393),o=X(4.026069);return i.mulAssign(e),i.assign(Gii.mul(i)),i.assign(r.mul(i)),i.assign(rc(i,1e-10)),i.assign(Q7(i)),i.assign(i.sub(n).div(o.sub(n))),i.assign(xI(i,0,1)),i.assign(jii(i)),i.assign(s.mul(i)),i.assign(i0(rc(ne(0),i),ne(2.2))),i.assign(Vii.mul(i)),i.assign(xI(i,0,1)),i}),qii={[NZt]:Fii,[LZt]:kii,[DZt]:Uii,[FZt]:zii,[kZt]:Hii};class kWe extends dn{constructor(e=Tx,i=Yii,r=null){super("vec3"),this.toneMapping=e,this.exposureNode=i,this.colorNode=r}getCacheKey(){let e=super.getCacheKey();return e="{toneMapping:"+this.toneMapping+",nodes:"+e+"}",e}setup(e){const i=this.colorNode||e.context.color,r=this.toneMapping;if(r===Tx)return i;const s={exposure:this.exposureNode,color:i},n=qii[r];let o=null;return n?o=n(s):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",r),o=i),o}}const Wii=(t,e,i)=>gt(new kWe(t,gt(e),gt(i))),Yii=oii("toneMappingExposure","float");fe("toneMapping",(t,e,i)=>Wii(e,i,t));Ue("ToneMappingNode",kWe);let PQ=null;class UWe extends H4{constructor(e=SI,i=null){PQ===null&&(PQ=new O9e),super(e,i,PQ)}updateReference(){return this}}const Xii=Ee(UWe);fe("viewportSharedTexture",Xii);Ue("ViewportSharedTextureNode",UWe);const Zii=new Xi;class ele extends HC{constructor(e,i){super(i),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class q4 extends dn{constructor(e,i,r){super("vec4"),this.scope=e,this.scene=i,this.camera=r,this._pixelRatio=1,this._width=1,this._height=1;const s=new h$;s.isRenderTargetTexture=!0,s.name="PostProcessingDepth";const n=new xg(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:vE});n.texture.name="PostProcessing",n.depthTexture=s,this.renderTarget=n,this.updateBeforeType=es.FRAME,this._textureNode=gt(new ele(this,n.texture)),this._depthTextureNode=gt(new ele(this,s)),this._depthNode=null,this._viewZNode=null,this._cameraNear=Tr(0),this._cameraFar=Tr(0),this.isPassNode=!0}isGlobal(){return!0}getTextureNode(){return this._textureNode}getTextureDepthNode(){return this._depthTextureNode}getViewZNode(){if(this._viewZNode===null){const e=this._cameraNear,i=this._cameraFar;this._viewZNode=rWe(this._depthTextureNode,e,i)}return this._viewZNode}getDepthNode(){if(this._depthNode===null){const e=this._cameraNear,i=this._cameraFar;this._depthNode=Yae(this.getViewZNode(),e,i)}return this._depthNode}setup(){return this.scope===q4.COLOR?this.getTextureNode():this.getDepthNode()}updateBefore(e){const{renderer:i}=e,{scene:r,camera:s}=this;this._pixelRatio=i.getPixelRatio();const n=i.getSize(Zii);this.setSize(n.width,n.height);const o=i.toneMapping,a=i.toneMappingNode,l=i.getRenderTarget();this._cameraNear.value=s.near,this._cameraFar.value=s.far,i.toneMapping=Tx,i.toneMappingNode=null,i.setRenderTarget(this.renderTarget),i.render(r,s),i.toneMapping=o,i.toneMappingNode=a,i.setRenderTarget(l)}setSize(e,i){this._width=e,this._height=i;const r=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget.setSize(r,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}q4.COLOR="color";q4.DEPTH="depth";const Gfe=(t,e)=>gt(new ele(t,e));Ue("PassNode",q4);const OQ=new gfe(-1,1,1,-1,0,1);class Jii extends Kx{constructor(e=!1){super();const i=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new cf([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new cf(i,2))}}const Qii=new Jii;class Kii extends eS{constructor(e=null){super(Qii,e),this.camera=OQ}renderAsync(e){return e.renderAsync(this,OQ)}render(e){e.render(this,OQ)}}const W4=Kii,OMe=new W4,IMe=new W4;class eri extends dn{constructor(e,i=2){super("vec4"),this.textureNode=e,this.sigma=i,this.directionNode=Vt(1),this._invSize=Tr(new Xi),this._passDirection=Tr(new Xi),this._horizontalRT=new xg,this._horizontalRT.texture.name="GaussianBlurNode.horizontal",this._verticalRT=new xg,this._verticalRT.texture.name="GaussianBlurNode.vertical",this._textureNode=Gfe(this,this._verticalRT.texture),this.updateBeforeType=es.RENDER,this.resolution=new Xi(1,1)}setSize(e,i){e=Math.max(Math.round(e*this.resolution.x),1),i=Math.max(Math.round(i*this.resolution.y),1),this._invSize.value.set(1/e,1/i),this._horizontalRT.setSize(e,i),this._verticalRT.setSize(e,i)}updateBefore(e){const{renderer:i}=e,r=this.textureNode,s=r.value,n=i.getRenderTarget(),o=r.value;OMe.material=this._material,IMe.material=this._material,this.setSize(s.image.width,s.image.height);const a=s.type;this._horizontalRT.texture.type=a,this._verticalRT.texture.type=a,i.setRenderTarget(this._horizontalRT),this._passDirection.value.set(1,0),OMe.render(i),r.value=this._horizontalRT.texture,i.setRenderTarget(this._verticalRT),this._passDirection.value.set(0,1),IMe.render(i),i.setRenderTarget(n),r.value=o}getTextureNode(){return this._textureNode}setup(e){const i=this.textureNode;if(i.isTextureNode!==!0)return console.error("GaussianBlurNode requires a TextureNode."),Ft();const r=i.uvNode||Ef(),s=l=>i.cache().context({getUV:()=>l,forceUVContext:!0}),n=Oe(()=>{const l=3+2*this.sigma,c=this._getCoefficients(l),u=this._invSize,h=Vt(this.directionNode).mul(this._passDirection),p=X(c[0]).toVar(),f=Ft(s(r).mul(p)).toVar();for(let g=1;g<l;g++){const y=X(g),v=X(c[g]),b=Vt(h.mul(u.mul(y))).toVar(),w=Ft(s(r.add(b))),x=Ft(s(r.sub(b)));f.addAssign(w.add(x).mul(v)),p.addAssign(Xr(2,v))}return f.div(p)}),o=this._material||(this._material=e.createNodeMaterial());o.fragmentNode=n();const a=e.getNodeProperties(this);return a.textureNode=i,this._textureNode}_getCoefficients(e){const i=[];for(let r=0;r<e;r++)i.push(.39894*Math.exp(-.5*r*r/(e*e))/e);return i}}const tri=(t,e)=>gt(new eri(gt(t),e));fe("gaussianBlur",tri);const IQ=new Xi,$Me=new W4;class iri extends dn{constructor(e,i=.96){super(e),this.textureNode=e,this.textureNodeOld=xa(),this.damp=Tr(i),this._compRT=new xg,this._compRT.texture.name="AfterImageNode.comp",this._oldRT=new xg,this._oldRT.texture.name="AfterImageNode.old",this._textureNode=Gfe(this,this._compRT.texture),this.updateBeforeType=es.RENDER}getTextureNode(){return this._textureNode}setSize(e,i){this._compRT.setSize(e,i),this._oldRT.setSize(e,i)}updateBefore(e){const{renderer:i}=e,r=this.textureNode,n=r.value.type;this._compRT.texture.type=n,this._oldRT.texture.type=n,i.getDrawingBufferSize(IQ),this.setSize(IQ.x,IQ.y);const o=i.toneMapping,a=i.toneMappingNode,l=i.getRenderTarget(),c=r.value;this.textureNodeOld.value=this._oldRT.texture,i.toneMapping=Tx,i.toneMappingNode=null,i.setRenderTarget(this._compRT),$Me.render(i);const u=this._oldRT;this._oldRT=this._compRT,this._compRT=u,i.toneMapping=o,i.toneMappingNode=a,i.setRenderTarget(l),r.value=c}setup(e){const i=this.textureNode,r=this.textureNodeOld;if(i.isTextureNode!==!0)return console.error("AfterImageNode requires a TextureNode."),Ft();const s=i.uvNode||Ef();r.uvNode=s;const n=u=>i.cache().context({getUV:()=>u,forceUVContext:!0}),o=Oe(([u,h])=>{const p=X(h).toVar(),f=Ft(u).toVar();return rc($fe(f.sub(p)),0)}),a=Oe(()=>{const u=Ft(r),h=Ft(n(s));return u.mulAssign(this.damp.mul(o(u,.1))),rc(h,u)}),l=this._materialComposed||(this._materialComposed=e.createNodeMaterial());l.fragmentNode=a(),$Me.material=l;const c=e.getNodeProperties(this);return c.textureNode=i,this._textureNode}}const rri=(t,e)=>gt(new iri(gt(t),e));fe("afterImage",rri);const NMe=new W4;class sri extends dn{constructor(e,i,r,s){super("vec4"),this.textureNode=e,this.tresholdNode=i,this.scaleNode=r,this.colorNode=ne(.1,0,1),this.samples=s,this.resolution=new Xi(1,1),this._renderTarget=new xg,this._renderTarget.texture.name="anamorphic",this._invSize=Tr(new Xi),this._textureNode=Gfe(this,this._renderTarget.texture),this.updateBeforeType=es.RENDER}getTextureNode(){return this._textureNode}setSize(e,i){this._invSize.value.set(1/e,1/i),e=Math.max(Math.round(e*this.resolution.x),1),i=Math.max(Math.round(i*this.resolution.y),1),this._renderTarget.setSize(e,i)}updateBefore(e){const{renderer:i}=e,r=this.textureNode,s=r.value;this._renderTarget.texture.type=s.type;const n=i.getRenderTarget(),o=r.value;NMe.material=this._material,this.setSize(s.image.width,s.image.height),i.setRenderTarget(this._renderTarget),NMe.render(i),i.setRenderTarget(n),r.value=o}setup(e){const i=this.textureNode;if(i.isTextureNode!==!0)return console.error("AnamorphNode requires a TextureNode."),Ft();const r=i.uvNode||Ef(),s=l=>i.cache().context({getUV:()=>l,forceUVContext:!0}),n=Oe(()=>{const l=this.samples,c=Math.floor(l/2),u=ne(0).toVar();return Ys({start:-c,end:c},({i:h})=>{const p=X(h).abs().div(c).oneMinus(),f=Vt(r.x.add(this._invSize.x.mul(h).mul(this.scaleNode)),r.y),g=s(f),y=LWe(g,this.tresholdNode).mul(p);u.addAssign(y)}),u.mul(this.colorNode)}),o=this._material||(this._material=e.createNodeMaterial());o.fragmentNode=n();const a=e.getNodeProperties(this);return a.textureNode=i,this._textureNode}}const nri=(t,e=.9,i=3,r=32)=>gt(new sri(gt(t),gt(e),gt(i),r));fe("anamorphic",nri);class BWe extends dn{constructor(e=null,i={}){super(),this.functionNode=e,this.parameters=i}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const i=[],r=this.functionNode,s=r.getInputs(e),n=this.parameters;if(Array.isArray(n))for(let a=0;a<n.length;a++){const l=s[a],c=n[a];i.push(c.build(e,l.type))}else for(const a of s){const l=n[a.name];if(l!==void 0)i.push(l.build(e,a.type));else throw new Error(`FunctionCallNode: Input '${a.name}' not found in FunctionNode.`)}return`${r.build(e,"property")}( ${i.join(", ")} )`}}const ori=(t,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?sO(e):Z7(e[0]),gt(new BWe(gt(t),e)));fe("call",ori);Ue("FunctionCallNode",BWe);class zWe extends mi{constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new VC,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:X()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=U9e(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let i=null;e.value!==null&&(e.inputType==="ArrayBuffer"?i=B9e(e.value):e.inputType==="Texture"?i=e.meta.textures[e.value]:i=e.meta.nodes[e.value]||null),this.value=i,this.inputType=e.inputType,this.outputType=e.outputType}}const N6=Ee(zWe);fe("scriptableValue",N6);Ue("ScriptableValueNode",zWe);class VWe extends Map{get(e,i=null,...r){if(this.has(e))return super.get(e);if(i!==null){const s=i(...r);return this.set(e,s),s}}}class ari{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const i=this.parameters[e];return i?i.getValue():null}}const $Q=new VWe;class GWe extends mi{constructor(e=null,i={}){super(),this.codeNode=e,this.parameters=i,this._local=new VWe,this._output=N6(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,i){return this._local.set(e,i)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const i of this.getLayout())if(i.inputType&&(i.id===e||i.name===e))return i}getOutputLayout(e){for(const i of this.getLayout())if(i.outputType&&(i.id===e||i.name===e))return i}setOutput(e,i){const r=this._outputs;return r[e]===void 0?r[e]=N6(i):r[e].value=i,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,i){const r=this.parameters;return i&&i.isScriptableNode?(this.deleteParameter(e),r[e]=i,r[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):i&&i.isScriptableValueNode?(this.deleteParameter(e),r[e]=i,r[e].events.addEventListener("refresh",this.onRefresh)):r[e]===void 0?(r[e]=N6(i),r[e].events.addEventListener("refresh",this.onRefresh)):r[e].value=i,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let i=this.parameters[e];return i&&(i.isScriptableNode&&(i=i.getDefaultOutput()),i.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...i){const s=this.getObject()[e];if(typeof s=="function")return s(...i)}async callAsync(e,...i){const s=this.getObject()[e];if(typeof s=="function")return s.constructor.name==="AsyncFunction"?await s(...i):s(...i)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),i=(c,u)=>this.setOutput(c,u),r=new ari(this),s=$Q.get("THREE"),n=$Q.get("TSL"),o=this.getMethod(this.codeNode),a=[r,this._local,$Q,e,i,s,n];this._object=o(...a);const l=this._object.layout;if(l&&(l.cache===!1&&this._local.clear(),this._output.outputType=l.outputType||null,Array.isArray(l.elements)))for(const c of l.elements){const u=c.id||c.name;c.inputType&&(this.getParameter(u)===void 0&&this.setParameter(u,null),this.getParameter(u).inputType=c.inputType),c.outputType&&(this.getOutput(u)===void 0&&this.setOutput(u,null),this.getOutput(u).outputType=c.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const i in this.parameters){let r=this.parameters[i];r.isScriptableNode&&(r=r.getDefaultOutput()),r.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:X()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],r=["layout","init","main","dispose"].join(", "),s="var "+r+`; var output = {};
`,n=`
return { ...output, `+r+" };",o=s+this.codeNode.code+n;return this._method=new Function(...e,o),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const lri=Ee(GWe);fe("scriptable",lri);Ue("ScriptableNode",GWe);class nW extends mi{constructor(e,i){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=i}getViewZNode(e){let i;const r=e.context.getViewZ;return r!==void 0&&(i=r(this)),(i||$d.z).negate()}setup(){return this.factorNode}}const cri=Ee(nW);fe("fog",cri);Ue("FogNode",nW);class jWe extends nW{constructor(e,i,r){super(e),this.isFogRangeNode=!0,this.nearNode=i,this.farNode=r}setup(e){const i=this.getViewZNode(e);return C0(this.nearNode,this.farNode,i)}}const HWe=Ee(jWe);fe("rangeFog",HWe);Ue("FogRangeNode",jWe);class qWe extends nW{constructor(e,i){super(e),this.isFogExp2Node=!0,this.densityNode=i}setup(e){const i=this.getViewZNode(e),r=this.densityNode;return r.mul(r,i,i).negate().exp().oneMinus()}}const WWe=Ee(qWe);fe("densityFog",WWe);Ue("FogExp2Node",qWe);let tT=null,iT=null;class YWe extends mi{constructor(e=X(),i=X()){super(),this.minNode=e,this.maxNode=i}getVectorLength(e){const i=e.getTypeLength(Mw(this.minNode.value)),r=e.getTypeLength(Mw(this.maxNode.value));return i>r?i:r}getNodeType(e){return e.object.isInstancedMesh===!0?e.getTypeFromLength(this.getVectorLength(e)):"float"}setup(e){const i=e.object;let r=null;if(i.isInstancedMesh===!0){const s=this.minNode.value,n=this.maxNode.value,o=e.getTypeLength(Mw(s)),a=e.getTypeLength(Mw(n));tT=tT||new Fs,iT=iT||new Fs,tT.setScalar(0),iT.setScalar(0),o===1?tT.setScalar(s):s.isColor?tT.set(s.r,s.g,s.b):tT.set(s.x,s.y,s.z||0,s.w||0),a===1?iT.setScalar(n):n.isColor?iT.set(n.r,n.g,n.b):iT.set(n.x,n.y,n.z||0,n.w||0);const l=4,c=l*i.count,u=new Float32Array(c);for(let p=0;p<c;p++){const f=p%l,g=tT.getComponent(f),y=iT.getComponent(f);u[p]=m9e.lerp(g,y,Math.random())}const h=this.getNodeType(e);r=Nfe(u,"vec4",i.count).element(Q9e).convert(h)}else r=X(0);return r}}const B3=Ee(YWe);Ue("RangeNode",YWe);class XWe extends mi{constructor(e,i,r=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=i,this.workgroupSize=r,this.dispatchCount=0,this.version=1,this.updateBeforeType=es.OBJECT,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}updateDispatchCount(){const{count:e,workgroupSize:i}=this;let r=i[0];for(let s=1;s<i.length;s++)r*=i[s];this.dispatchCount=Math.ceil(e/r)}onInit(){}updateBefore({renderer:e}){e.compute(this)}generate(e){const{shaderStage:i}=e;if(i==="compute"){const r=this.computeNode.build(e,"void");r!==""&&e.addLineFlowCode(r)}}}const uri=(t,e,i)=>gt(new XWe(gt(t),e,i));fe("compute",uri);Ue("ComputeNode",XWe);class uC extends mi{constructor(e=uC.TARGET_DIRECTION,i=null){super(),this.scope=e,this.light=i}setup(){const{scope:e,light:i}=this;let r=null;return e===uC.TARGET_DIRECTION&&(r=g$.transformDirection(zae(i).sub(zae(i.target)))),r}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}uC.TARGET_DIRECTION="targetDirection";const ZWe=Ee(uC,uC.TARGET_DIRECTION);Ue("LightNode",uC);const JWe=Oe(t=>{const{lightDistance:e,cutoffDistance:i,decayExponent:r}=t,s=e.pow(r).max(.01).reciprocal();return i.greaterThan(0).cond(s.mul(e.div(i).pow4().oneMinus().clamp().pow2()),s)});class QWe extends qC{constructor(e=null){super(e),this.cutoffDistanceNode=Tr(0),this.decayExponentNode=Tr(0)}update(e){const{light:i}=this;super.update(e),this.cutoffDistanceNode.value=i.distance,this.decayExponentNode.value=i.decay}setup(e){const{colorNode:i,cutoffDistanceNode:r,decayExponentNode:s,light:n}=this,o=e.context.lightingModel,a=A7e(n).sub($d),l=a.normalize(),c=a.length(),u=JWe({lightDistance:c,cutoffDistance:r,decayExponent:s}),h=i.mul(u),p=e.context.reflectedLight;o.direct({lightDirection:l,lightColor:h,reflectedLight:p,shadowMask:this.shadowMaskNode},e.stack,e)}}Ue("PointLightNode",QWe);y$(gQt,QWe);class KWe extends qC{constructor(e=null){super(e)}setup(e){super.setup(e);const i=e.context.lightingModel,r=this.colorNode,s=ZWe(this.light),n=e.context.reflectedLight;i.direct({lightDirection:s,lightColor:r,reflectedLight:n,shadowMask:this.shadowMaskNode},e.stack,e)}}Ue("DirectionalLightNode",KWe);y$(L9e,KWe);class jfe extends qC{constructor(e=null){super(e),this.coneCosNode=Tr(0),this.penumbraCosNode=Tr(0),this.cutoffDistanceNode=Tr(0),this.decayExponentNode=Tr(0)}update(e){super.update(e);const{light:i}=this;this.coneCosNode.value=Math.cos(i.angle),this.penumbraCosNode.value=Math.cos(i.angle*(1-i.penumbra)),this.cutoffDistanceNode.value=i.distance,this.decayExponentNode.value=i.decay}getSpotAttenuation(e){const{coneCosNode:i,penumbraCosNode:r}=this;return C0(i,r,e)}setup(e){super.setup(e);const i=e.context.lightingModel,{colorNode:r,cutoffDistanceNode:s,decayExponentNode:n,light:o}=this,a=A7e(o).sub($d),l=a.normalize(),c=l.dot(ZWe(o)),u=this.getSpotAttenuation(c),h=a.length(),p=JWe({lightDistance:h,cutoffDistance:s,decayExponent:n}),f=r.mul(u).mul(p),g=e.context.reflectedLight;i.direct({lightDirection:l,lightColor:f,reflectedLight:g,shadowMask:this.shadowMaskNode},e.stack,e)}}Ue("SpotLightNode",jfe);y$(N9e,jfe);class hri extends N9e{constructor(e,i,r,s,n,o){super(e,i,r,s,n,o),this.iesMap=null}copy(e,i){return super.copy(e,i),this.iesMap=e.iesMap,this}}const dri=hri;class eYe extends jfe{getSpotAttenuation(e){const i=this.light.iesMap;let r=null;if(i&&i.isTexture===!0){const s=e.acos().mul(1/Math.PI);r=xa(i,Vt(s,0),0).r}else r=super.getSpotAttenuation(e);return r}}Ue("IESSpotLightNode",eYe);y$(dri,eYe);class tYe extends qC{constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}Ue("AmbientLightNode",tYe);y$(D9e,tYe);class iYe extends qC{constructor(e=null){super(e),this.lightPositionNode=zae(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Tr(new ds)}update(e){const{light:i}=this;super.update(e),this.lightPositionNode.object3d=i,this.groundColorNode.value.copy(i.groundColor).multiplyScalar(i.intensity)}setup(e){const{colorNode:i,groundColorNode:r,lightDirectionNode:s}=this,o=Mx.dot(s).mul(.5).add(.5),a=Po(r,i,o);e.context.irradiance.addAssign(a)}}Ue("HemisphereLightNode",iYe);y$(pQt,iYe);const pri=Oe(t=>{const e=t.uv.mul(2),i=e.x.floor(),r=e.y.floor();return i.add(r).mod(2).sign()});class rYe extends dn{constructor(e=Ef()){super("float"),this.uvNode=e}setup(){return pri({uv:this.uvNode})}}const fri=Ee(rYe);fe("checker",fri);Ue("CheckerNode",rYe);const mri=new P9e;class gri extends Ea{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.pointWidth=1,this.pointColorNode=null,this.setDefaultValues(mri),this.setupShaders(),this.setValues(e)}setupShaders(){const e=this.alphaToCoverage,i=this.useColor;this.vertexNode=Oe(()=>{Ta(Vt(),"vUv").assign(Ef());const r=ml("instancePosition"),s=so("vec4","mvPos");s.assign(cC.mul(Ft(r,1)));const n=cO.z.div(cO.w),o=Ly.mul(s),a=so("vec2","offset");return a.assign(xu.xy),a.assign(a.mul(zei)),a.assign(a.div(cO.z)),a.y.assign(a.y.mul(n)),a.assign(a.mul(o.w)),o.assign(o.add(Ft(a,0,0))),o})(),this.fragmentNode=Oe(()=>{const r=Ta(Vt(),"vUv"),s=so("float","alpha");s.assign(1);const n=r.x,o=r.y,a=n.mul(n).add(o.mul(o));if(e){const c=so("float","dlen");c.assign(a.fwidth()),s.assign(C0(c.oneMinus(),c.add(1),a).oneMinus())}else a.greaterThan(1).discard();let l;return this.pointColorNode?l=this.pointColorNode:i?l=ml("instanceColor").mul(fk):l=fk,Ft(l,s)})(),this.needsUpdate=!0}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.setupShaders())}}Pl("InstancedPointsNodeMaterial",gri);const yri=new R9e;class _ri extends Ea{constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(yri),this.setValues(e)}}Pl("LineBasicNodeMaterial",_ri);const vri=new $9e;class bri extends Ea{constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(vri),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode,i=this.dashScaleNode?X(this.dashScaleNode):Vae,r=this.dashSizeNode?X(this.dashSizeNode):I7e,s=this.dashSizeNode?X(this.dashGapNode):$7e;aO.assign(r),WH.assign(s);const n=Ta(ml("lineDistance").mul(i));(e?n.add(e):n).mod(aO.add(WH)).greaterThan(aO).discard()}}Pl("LineDashedNodeMaterial",bri);const wri=new $9e;class xri extends Ea{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.setDefaultValues(wri),this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.useDash=e.dashed,this.useWorldUnits=!1,this.dashOffset=0,this.lineWidth=1,this.lineColorNode=null,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setup(e){this.setupShaders(),super.setup(e)}setupShaders(){const e=this.alphaToCoverage,i=this.useColor,r=this.dashed,s=this.worldUnits,n=Oe(({start:a,end:l})=>{const c=Ly.element(2).element(2),p=Ly.element(3).element(2).mul(-.5).div(c).sub(a.z).div(l.z.sub(a.z));return Ft(Po(a.xyz,l.xyz,p),l.w)});this.vertexNode=Oe(()=>{Ry("vec2","vUv").assign(Ef());const a=ml("instanceStart"),l=ml("instanceEnd"),c=so("vec4","start"),u=so("vec4","end");c.assign(cC.mul(Ft(a,1))),u.assign(cC.mul(Ft(l,1))),s&&(Ry("vec3","worldStart").assign(c.xyz),Ry("vec3","worldEnd").assign(u.xyz));const h=cO.z.div(cO.w),p=Ly.element(2).element(3).equal(-1);xr(p,()=>{xr(c.z.lessThan(0).and(u.z.greaterThan(0)),()=>{u.assign(n({start:c,end:u}))}).elseif(u.z.lessThan(0).and(c.z.greaterThanEqual(0)),()=>{c.assign(n({start:u,end:c}))})});const f=Ly.mul(c),g=Ly.mul(u),y=f.xyz.div(f.w),v=g.xyz.div(g.w),b=v.xy.sub(y.xy).temp();b.x.assign(b.x.mul(h)),b.assign(b.normalize());const w=GH(Ft());if(s){const x=u.xyz.sub(c.xyz).normalize(),S=Po(c.xyz,u.xyz,.5).normalize(),E=x.cross(S).normalize(),C=x.cross(E),R=Ry("vec4","worldPos");R.assign(xu.y.lessThan(.5).cond(c,u));const I=hQ.mul(.5);R.addAssign(Ft(xu.x.lessThan(0).cond(E.mul(I),E.mul(I).negate()),0)),r||(R.addAssign(Ft(xu.y.lessThan(.5).cond(x.mul(I).negate(),x.mul(I)),0)),R.addAssign(Ft(C.mul(I),0)),xr(xu.y.greaterThan(1).or(xu.y.lessThan(0)),()=>{R.subAssign(Ft(C.mul(2).mul(I),0))})),w.assign(Ly.mul(R));const F=GH(ne());F.assign(xu.y.lessThan(.5).cond(y,v)),w.z.assign(F.z.mul(w.w))}else{const x=so("vec2","offset");x.assign(Vt(b.y,b.x.negate())),b.x.assign(b.x.div(h)),x.x.assign(x.x.div(h)),x.assign(xu.x.lessThan(0).cond(x.negate(),x)),xr(xu.y.lessThan(0),()=>{x.assign(x.sub(b))}).elseif(xu.y.greaterThan(1),()=>{x.assign(x.add(b))}),x.assign(x.mul(hQ)),x.assign(x.div(cO.w)),w.assign(xu.y.lessThan(.5).cond(f,g)),x.assign(x.mul(w.w)),w.assign(w.add(Ft(x,0,0)))}return w})();const o=Oe(({p1:a,p2:l,p3:c,p4:u})=>{const h=a.sub(c),p=u.sub(c),f=l.sub(a),g=h.dot(p),y=p.dot(f),v=h.dot(f),b=p.dot(p),x=f.dot(f).mul(b).sub(y.mul(y)),E=g.mul(y).sub(v.mul(b)).div(x).clamp(),C=g.add(y.mul(E)).div(b).clamp();return Vt(E,C)});this.fragmentNode=Oe(()=>{const a=Ry("vec2","vUv");if(r){const u=this.offsetNode?X(this.offsetNodeNode):nMe,h=this.dashScaleNode?X(this.dashScaleNode):Vae,p=this.dashSizeNode?X(this.dashSizeNode):I7e,f=this.dashSizeNode?X(this.dashGapNode):$7e;aO.assign(p),WH.assign(f);const g=ml("instanceDistanceStart"),y=ml("instanceDistanceEnd"),v=xu.y.lessThan(.5).cond(h.mul(g),Vae.mul(y)),b=Ta(v.add(nMe)),w=u?b.add(u):b;a.y.lessThan(-1).or(a.y.greaterThan(1)).discard(),w.mod(aO.add(WH)).greaterThan(aO).discard()}const l=so("float","alpha");if(l.assign(1),s){const u=Ry("vec3","worldStart"),h=Ry("vec3","worldEnd"),p=Ry("vec4","worldPos").xyz.normalize().mul(1e5),f=h.sub(u),g=o({p1:u,p2:h,p3:ne(0,0,0),p4:p}),y=u.add(f.mul(g.x)),v=p.mul(g.y),x=y.sub(v).length().div(hQ);if(!r)if(e){const S=x.fwidth();l.assign(C0(S.negate().add(.5),S.add(.5),x).oneMinus())}else x.greaterThan(.5).discard()}else if(e){const u=a.x,h=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1)),p=u.mul(u).add(h.mul(h)),f=so("float","dlen");f.assign(p.fwidth()),xr(a.y.abs().greaterThan(1),()=>{l.assign(C0(f.oneMinus(),f.add(1),p).oneMinus())})}else xr(a.y.abs().greaterThan(1),()=>{const u=a.x,h=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1));u.mul(u).add(h.mul(h)).greaterThan(1).discard()});let c;if(this.lineColorNode)c=this.lineColorNode;else if(i){const u=ml("instanceColorStart"),h=ml("instanceColorEnd");c=xu.y.lessThan(.5).cond(u,h).mul(fk)}else c=fk;return Ft(c,l)})()}get worldUnits(){return this.useWorldUnits}set worldUnits(e){this.useWorldUnits!==e&&(this.useWorldUnits=e,this.needsUpdate=!0)}get dashed(){return this.useDash}set dashed(e){this.useDash!==e&&(this.useDash=e,this.needsUpdate=!0)}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.needsUpdate=!0)}}Pl("Line2NodeMaterial",xri);const Sri=new oQt;class Tri extends Ea{constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(Sri),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?X(this.opacityNode):O7e;Sn.assign(Ft(vWe(Ho),e))}}Pl("MeshNormalNodeMaterial",Tri);const Eri=new mfe;class Cri extends Ea{constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(Eri),this.setValues(e)}}Pl("MeshBasicNodeMaterial",Cri);const mk=Oe(({f0:t,f90:e,dotVH:i})=>{const r=i.mul(-5.55473).sub(6.98316).mul(i).exp2();return t.mul(r.oneMinus()).add(e.mul(r))}),EI=Oe(t=>t.diffuseColor.mul(1/Math.PI)),Mri=()=>X(.25),Ari=Oe(({dotNH:t})=>Fae.mul(X(.5)).add(1).mul(X(1/Math.PI)).mul(t.pow(Fae))),Rri=Oe(({lightDirection:t})=>{const e=t.add(no).normalize(),i=Ho.dot(e).clamp(),r=no.dot(e).clamp(),s=mk({f0:Cm,f90:1,dotVH:r}),n=Mri(),o=Ari({dotNH:i});return s.mul(n).mul(o)});class sYe extends J7{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:i,reflectedLight:r}){const n=Ho.dot(e).clamp().mul(i);r.directDiffuse.addAssign(n.mul(EI({diffuseColor:Sn.rgb}))),this.specular===!0&&r.directSpecular.addAssign(n.mul(Rri({lightDirection:e})).mul(xei))}indirectDiffuse({irradiance:e,reflectedLight:i}){i.indirectDiffuse.addAssign(e.mul(EI({diffuseColor:Sn})))}}const Pri=new aQt;class Ori extends Ea{constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Pri),this.setValues(e)}setupLightingModel(){return new sYe(!1)}}Pl("MeshLambertNodeMaterial",Ori);const Iri=new sQt;class $ri extends Ea{constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(Iri),this.setValues(e)}setupLightingModel(){return new sYe}setupVariants(){const e=(this.shininessNode?X(this.shininessNode):_ei).max(1e-4);Fae.assign(e);const i=this.specularNode||bei;Cm.assign(i)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}Pl("MeshPhongNodeMaterial",$ri);const Nri=Oe(()=>{const t=XH.dFdx().abs().max(XH.dFdy().abs());return t.x.max(t.y).max(t.z)}),nYe=Oe(t=>{const{roughness:e}=t,i=Nri();let r=e.max(.0525);return r=r.add(i),r=r.min(1),r}),Lri=Oe(({alpha:t,dotNL:e,dotNV:i})=>{const r=t.pow2(),s=e.mul(r.add(r.oneMinus().mul(i.pow2())).sqrt()),n=i.mul(r.add(r.oneMinus().mul(e.pow2())).sqrt());return Cx(.5,s.add(n).max(d7e))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),Dri=Oe(({alphaT:t,alphaB:e,dotTV:i,dotBV:r,dotTL:s,dotBL:n,dotNV:o,dotNL:a})=>{const l=a.mul(ne(t.mul(i),e.mul(r),o).length()),c=o.mul(ne(t.mul(s),e.mul(n),a).length());return Cx(.5,l.add(c)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),Fri=Oe(({alpha:t,dotNH:e})=>{const i=t.pow2(),r=e.pow2().mul(i.oneMinus()).oneMinus();return i.div(r.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),kri=X(1/Math.PI),Uri=Oe(({alphaT:t,alphaB:e,dotNH:i,dotTH:r,dotBH:s})=>{const n=t.mul(e),o=ne(e.mul(r),t.mul(s),n.mul(i)),a=o.dot(o),l=n.div(a);return kri.mul(n.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),LMe=Oe(t=>{const{lightDirection:e,f0:i,f90:r,roughness:s,f:n,USE_IRIDESCENCE:o,USE_ANISOTROPY:a}=t,l=t.normalView||Ho,c=s.pow2(),u=e.add(no).normalize(),h=l.dot(e).clamp(),p=l.dot(no).clamp(),f=l.dot(u).clamp(),g=no.dot(u).clamp();let y=mk({f0:i,f90:r,dotVH:g}),v,b;if(KCe(o)&&(y=Pfe.mix(y,n)),KCe(a)){const w=I6.dot(e),x=I6.dot(no),S=I6.dot(u),E=oO.dot(e),C=oO.dot(no),R=oO.dot(u);v=Dri({alphaT:Dae,alphaB:c,dotTV:x,dotBV:C,dotTL:w,dotBL:E,dotNV:p,dotNL:h}),b=Uri({alphaT:Dae,alphaB:c,dotNH:f,dotTH:S,dotBH:R})}else v=Lri({alpha:c,dotNL:h,dotNV:p}),b=Fri({alpha:c,dotNH:f});return y.mul(v).mul(b)}),oYe=Oe(({roughness:t,dotNV:e})=>{const i=Ft(-1,-.0275,-.572,.022),r=Ft(1,.0425,1.04,-.04),s=t.mul(i).add(r),n=s.x.mul(s.x).min(e.mul(-9.28).exp2()).mul(s.x).add(s.y);return Vt(-1.04,1.04).mul(n).add(s.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),aYe=Oe(t=>{const{dotNV:e,specularColor:i,specularF90:r,roughness:s}=t,n=oYe({dotNV:e,roughness:s});return i.mul(n.x).add(r.mul(n.y))}),Bri=Oe(({f:t,f90:e,dotVH:i})=>{const r=i.oneMinus().saturate(),s=r.mul(r),n=r.mul(s,s).clamp(0,.9999);return t.sub(ne(e).mul(n)).div(n.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),zri=Oe(({roughness:t,dotNH:e})=>{const i=t.pow2(),r=X(1).div(i),n=e.pow2().oneMinus().max(.0078125);return X(2).add(r).mul(n.pow(r.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Vri=Oe(({dotNV:t,dotNL:e})=>X(1).div(X(4).mul(e.add(t).sub(e.mul(t))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),Gri=Oe(({lightDirection:t})=>{const e=t.add(no).normalize(),i=Ho.dot(t).clamp(),r=Ho.dot(no).clamp(),s=Ho.dot(e).clamp(),n=zri({roughness:Rfe,dotNH:s}),o=Vri({dotNV:r,dotNL:i});return mP.mul(n).mul(o)}),DMe=Oe(([t,e,i,r,s])=>{const n=ne(b7e(e.negate(),dk(t),Cx(1,r))),o=ne(lO(s[0].xyz),lO(s[1].xyz),lO(s[2].xyz));return dk(n).mul(i.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),jri=Oe(([t,e])=>t.mul(xI(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),Hri=eWe(),FMe=Oe(([t,e,i])=>{const r=Hri.uv(t),s=Q7(X(Wae.x)).mul(jri(e,i));return r.bicubic(s)}),kMe=Oe(([t,e,i])=>(xr(i.notEqual(0),()=>{const r=m7e(e).negate().div(i);return f7e(r.negate().mul(t))}),ne(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),qri=Oe(([t,e,i,r,s,n,o,a,l,c,u,h,p,f,g])=>{let y,v;if(g){y=Ft().toVar(),v=ne().toVar();const E=u.sub(1).mul(g.mul(.025)),C=ne(u.sub(E),u,u.add(E));Ys({start:0,end:3},({i:R})=>{const I=C.element(R),F=DMe(t,e,h,I,a),D=o.add(F),z=c.mul(l.mul(Ft(D,1))),B=Vt(z.xy.div(z.w)).toVar();B.addAssign(1),B.divAssign(2),B.assign(Vt(B.x,B.y.oneMinus()));const Y=FMe(B,i,I);y.element(R).assign(Y.element(R)),y.a.addAssign(Y.a),v.element(R).assign(r.element(R).mul(kMe(lO(F),p,f).element(R)))}),y.a.divAssign(3)}else{const E=DMe(t,e,h,u,a),C=o.add(E),R=c.mul(l.mul(Ft(C,1))),I=Vt(R.xy.div(R.w)).toVar();I.addAssign(1),I.divAssign(2),I.assign(Vt(I.x,I.y.oneMinus())),y=FMe(I,i,u),v=r.mul(kMe(lO(E),p,f))}const b=v.rgb.mul(y.rgb),w=t.dot(e).clamp(),x=ne(aYe({dotNV:w,specularColor:s,specularF90:n,roughness:i})),S=v.r.add(v.g,v.b).div(3);return Ft(x.oneMinus().mul(b),y.a.oneMinus().mul(S).oneMinus())}),Wri=Sg(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Yri=t=>{const e=t.sqrt();return ne(1).add(e).div(ne(1).sub(e))},UMe=(t,e)=>t.sub(e).div(t.add(e)).pow2(),Xri=(t,e)=>{const i=t.mul(2*Math.PI*1e-9),r=ne(54856e-17,44201e-17,52481e-17),s=ne(1681e3,1795300,2208400),n=ne(43278e5,93046e5,66121e5),o=X(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(i.mul(2239900).add(e.x).cos()).mul(i.pow2().mul(-45282e5).exp());let a=r.mul(n.mul(2*Math.PI).sqrt()).mul(s.mul(i).add(e).cos()).mul(i.pow2().negate().mul(n).exp());return a=ne(a.x.add(o),a.y,a.z).div(10685e-11),Wri.mul(a)},Zri=Oe(({outsideIOR:t,eta2:e,cosTheta1:i,thinFilmThickness:r,baseF0:s})=>{const n=Po(t,e,C0(0,.03,r)),o=t.div(n).pow2().mul(X(1).sub(i.pow2())),l=X(1).sub(o).sqrt(),c=UMe(n,t),u=mk({f0:c,f90:1,dotVH:i}),h=u.oneMinus(),p=n.lessThan(t).cond(Math.PI,0),f=X(Math.PI).sub(p),g=Yri(s.clamp(0,.9999)),y=UMe(g,n.toVec3()),v=mk({f0:y,f90:1,dotVH:l}),b=ne(g.x.lessThan(n).cond(Math.PI,0),g.y.lessThan(n).cond(Math.PI,0),g.z.lessThan(n).cond(Math.PI,0)),w=n.mul(r,l,2),x=ne(f).add(b),S=u.mul(v).clamp(1e-5,.9999),E=S.sqrt(),C=h.pow2().mul(v).div(ne(1).sub(S));let I=u.add(C),F=C.sub(h);for(let D=1;D<=2;++D){F=F.mul(E);const z=Xri(X(D).mul(w),X(D).mul(x)).mul(2);I=I.add(F.mul(z))}return I.max(ne(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),Jri=Oe(({normal:t,viewDir:e,roughness:i})=>{const r=t.dot(e).saturate(),s=i.pow2(),n=Nd(i.lessThan(.25),X(-339.2).mul(s).add(X(161.4).mul(i)).sub(25.9),X(-8.48).mul(s).add(X(14.3).mul(i)).sub(9.95)),o=Nd(i.lessThan(.25),X(44).mul(s).sub(X(23.7).mul(i)).add(3.26),X(1.97).mul(s).sub(X(3.27).mul(i)).add(.72));return Nd(i.lessThan(.25),0,X(.1).mul(i).sub(.025)).add(n.mul(r).add(o).exp()).mul(1/Math.PI).saturate()}),NQ=ne(.04),LQ=X(1);class Hfe extends J7{constructor(e=!1,i=!1,r=!1,s=!1,n=!1,o=!1){super(),this.clearcoat=e,this.sheen=i,this.iridescence=r,this.anisotropy=s,this.transmission=n,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=ne().temp("clearcoatRadiance"),this.clearcoatSpecularDirect=ne().temp("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=ne().temp("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=ne().temp("sheenSpecularDirect"),this.sheenSpecularIndirect=ne().temp("sheenSpecularIndirect")),this.iridescence===!0){const i=Ho.dot(no).clamp();this.iridescenceFresnel=Zri({outsideIOR:X(1),eta2:t7e,cosTheta1:i,thinFilmThickness:i7e,baseF0:Cm}),this.iridescenceF0=Bri({f:this.iridescenceFresnel,f90:1,dotVH:i})}if(this.transmission===!0){const i=Gae,r=M7e.sub(Gae).normalize(),s=P7e;e.backdrop=qri(s,r,Aw,Sn,Cm,qH,i,pk,g$,Ly,$6,r7e,n7e,s7e,this.dispersion?o7e:null),e.backdropAlpha=kae,Sn.a.mulAssign(Po(1,e.backdrop.a,kae))}}computeMultiscattering(e,i,r){const s=Ho.dot(no).clamp(),n=oYe({roughness:Aw,dotNV:s}),a=(this.iridescenceF0?Pfe.mix(Cm,this.iridescenceF0):Cm).mul(n.x).add(r.mul(n.y)),c=n.x.add(n.y).oneMinus(),u=Cm.add(Cm.oneMinus().mul(.047619)),h=a.mul(u).div(c.mul(u).oneMinus());e.addAssign(a),i.addAssign(h.mul(c))}direct({lightDirection:e,lightColor:i,reflectedLight:r}){const n=Ho.dot(e).clamp().mul(i);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(n.mul(Gri({lightDirection:e}))),this.clearcoat===!0){const a=gP.dot(e).clamp().mul(i);this.clearcoatSpecularDirect.addAssign(a.mul(LMe({lightDirection:e,f0:NQ,f90:LQ,roughness:HH,normalView:gP})))}r.directDiffuse.addAssign(n.mul(EI({diffuseColor:Sn.rgb}))),r.directSpecular.addAssign(n.mul(LMe({lightDirection:e,f0:Cm,f90:1,roughness:Aw,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}indirectDiffuse({irradiance:e,reflectedLight:i}){i.indirectDiffuse.addAssign(e.mul(EI({diffuseColor:Sn})))}indirectSpecular({radiance:e,iblIrradiance:i,reflectedLight:r}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(i.mul(mP,Jri({normal:Ho,viewDir:no,roughness:Rfe}))),this.clearcoat===!0){const c=gP.dot(no).clamp(),u=aYe({dotNV:c,specularColor:NQ,specularF90:LQ,roughness:HH});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(u))}const s=ne().temp("singleScattering"),n=ne().temp("multiScattering"),o=i.mul(1/Math.PI);this.computeMultiscattering(s,n,qH);const a=s.add(n),l=Sn.mul(a.r.max(a.g).max(a.b).oneMinus());r.indirectSpecular.addAssign(e.mul(s)),r.indirectSpecular.addAssign(n.mul(o)),r.indirectDiffuse.addAssign(l.mul(o))}ambientOcclusion({ambientOcclusion:e,reflectedLight:i}){const s=Ho.dot(no).clamp().add(e),n=Aw.mul(-16).oneMinus().negate().exp2(),o=e.sub(s.pow(n).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),i.indirectDiffuse.mulAssign(e),i.indirectSpecular.mulAssign(o)}finish(e){const{outgoingLight:i}=e;if(this.clearcoat===!0){const r=gP.dot(no).clamp(),s=mk({dotVH:r,f0:NQ,f90:LQ}),n=i.mul(Lae.mul(s).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Lae));i.assign(n)}if(this.sheen===!0){const r=mP.r.max(mP.g).max(mP.b).mul(.157).oneMinus(),s=i.mul(r).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);i.assign(s)}}}const Qri=new I9e;class lYe extends Ea{constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(Qri),this.setValues(e)}setupLightingModel(){return new Hfe}setupSpecular(){const e=Po(ne(.04),Sn.rgb,jH);Cm.assign(e),qH.assign(1)}setupVariants(){const e=this.metalnessNode?X(this.metalnessNode):Tei;jH.assign(e);let i=this.roughnessNode?X(this.roughnessNode):Sei;i=nYe({roughness:i}),Aw.assign(i),this.setupSpecular(),Sn.assign(Ft(Sn.rgb.mul(e.oneMinus()),Sn.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}Pl("MeshStandardNodeMaterial",lYe);const Kri=new rQt;class cYe extends lYe{constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(Kri),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?X(this.iorNode):kei;$6.assign(e),Cm.assign(Po(Um(v7e($6.sub(1).div($6.add(1))).mul(wei),ne(1)).mul(sMe),Sn.rgb,jH)),qH.assign(Po(sMe,1,jH))}setupLightingModel(){return new Hfe(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const i=this.clearcoatNode?X(this.clearcoatNode):Cei,r=this.clearcoatRoughnessNode?X(this.clearcoatRoughnessNode):Mei;Lae.assign(i),HH.assign(nYe({roughness:r}))}if(this.useSheen){const i=this.sheenNode?ne(this.sheenNode):Pei,r=this.sheenRoughnessNode?X(this.sheenRoughnessNode):Oei;mP.assign(i),Rfe.assign(r)}if(this.useIridescence){const i=this.iridescenceNode?X(this.iridescenceNode):$ei,r=this.iridescenceIORNode?X(this.iridescenceIORNode):Nei,s=this.iridescenceThicknessNode?X(this.iridescenceThicknessNode):Lei;Pfe.assign(i),t7e.assign(r),i7e.assign(s)}if(this.useAnisotropy){const i=(this.anisotropyNode?Vt(this.anisotropyNode):Iei).toVar();u2.assign(i.length()),xr(u2.equal(0),()=>{i.assign(Vt(1,0))}).else(()=>{i.divAssign(u2),u2.assign(u2.saturate())}),Dae.assign(u2.pow2().mix(Aw.pow2(),1)),I6.assign(yP[0].mul(i.x).add(yP[1].mul(i.y))),oO.assign(yP[1].mul(i.x).sub(yP[0].mul(i.y)))}if(this.useTransmission){const i=this.transmissionNode?X(this.transmissionNode):Dei,r=this.thicknessNode?X(this.thicknessNode):Fei,s=this.attenuationDistanceNode?X(this.attenuationDistanceNode):Uei,n=this.attenuationColorNode?ne(this.attenuationColorNode):Bei;if(kae.assign(i),r7e.assign(r),s7e.assign(s),n7e.assign(n),this.useDispersion){const o=this.dispersionNode?X(this.dispersionNode):Vei;o7e.assign(o)}}}setupNormal(e){super.setupNormal(e);const i=this.clearcoatNormalNode?ne(this.clearcoatNormalNode):Aei;gP.assign(i)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}Pl("MeshPhysicalNodeMaterial",cYe);class esi extends Hfe{constructor(e,i,r,s){super(e,i,r),this.useSSS=s}direct({lightDirection:e,lightColor:i,reflectedLight:r},s,n){if(this.useSSS===!0){const o=n.material,{thicknessColorNode:a,thicknessDistortionNode:l,thicknessAmbientNode:c,thicknessAttenuationNode:u,thicknessPowerNode:h,thicknessScaleNode:p}=o,f=e.add(Ho.mul(l)).normalize(),g=X(no.dot(f.negate()).saturate().pow(h).mul(p)),y=ne(g.add(c).mul(a));r.directDiffuse.addAssign(y.mul(u.mul(i)))}super.direct({lightDirection:e,lightColor:i,reflectedLight:r},s,n)}}class tsi extends cYe{constructor(e){super(e),this.thicknessColorNode=null,this.thicknessDistortionNode=X(.1),this.thicknessAmbientNode=X(0),this.thicknessAttenuationNode=X(.1),this.thicknessPowerNode=X(2),this.thicknessScaleNode=X(10)}get useSSS(){return this.thicknessColorNode!==null}setupLightingModel(){return new esi(this.useClearcoat,this.useSheen,this.useIridescence,this.useSSS)}copy(e){return this.thicknessColorNode=e.thicknessColorNode,this.thicknessDistortionNode=e.thicknessDistortionNode,this.thicknessAmbientNode=e.thicknessAmbientNode,this.thicknessAttenuationNode=e.thicknessAttenuationNode,this.thicknessPowerNode=e.thicknessPowerNode,this.thicknessScaleNode=e.thicknessScaleNode,super.copy(e)}}Pl("MeshSSSNodeMaterial",tsi);const isi=Oe(({normal:t,lightDirection:e,builder:i})=>{const r=t.dot(e),s=Vt(r.mul(.5).add(.5),0);if(i.material.gradientMap){const n=Sv("gradientMap","texture").context({getUV:()=>s});return ne(n.r)}else{const n=s.fwidth().mul(.5);return Po(ne(.7),ne(1),C0(X(.7).sub(n.x),X(.7).add(n.x),s.x))}});class rsi extends J7{direct({lightDirection:e,lightColor:i,reflectedLight:r},s,n){const o=isi({normal:XH,lightDirection:e,builder:n}).mul(i);r.directDiffuse.addAssign(o.mul(EI({diffuseColor:Sn.rgb})))}indirectDiffuse({irradiance:e,reflectedLight:i}){i.indirectDiffuse.addAssign(e.mul(EI({diffuseColor:Sn})))}}const ssi=new nQt;class nsi extends Ea{constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(ssi),this.setValues(e)}setupLightingModel(){return new rsi}}Pl("MeshToonNodeMaterial",nsi);const osi=new lQt;class asi extends Ea{constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.lights=!1,this.setDefaultValues(osi),this.setValues(e)}setupVariants(e){const i=Jti;let r;e.material.matcap?r=Sv("matcap","texture").context({getUV:()=>i}):r=ne(Po(.2,.8,i.y)),Sn.rgb.mulAssign(r.rgb)}}Pl("MeshMatcapNodeMaterial",asi);const lsi=new P9e;class csi extends Ea{constructor(e){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.normals=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(lsi),this.setValues(e)}copy(e){return this.sizeNode=e.sizeNode,super.copy(e)}}Pl("PointsNodeMaterial",csi);const usi=new eQt;class tle extends Ea{constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this.normals=!1,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(usi),this.setValues(e)}setupPosition({object:e,context:i}){const{positionNode:r,rotationNode:s,scaleNode:n}=this,o=Xa;let a=cC.mul(ne(r||0)),l=Vt(pk[0].xyz.length(),pk[1].xyz.length());n!==null&&(l=l.mul(n));let c=o.xy;e.center&&e.center.isVector2===!0&&(c=c.sub(Tr(e.center).sub(.5))),c=c.mul(l);const u=X(s||Rei),h=c.rotate(u);a=Ft(a.xy.add(h),a.zw);const p=Ly.mul(a);return i.vertex=o,p}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}}Pl("SpriteNodeMaterial",tle);class hsi extends J7{constructor(){super(),this.shadowNode=X(1).toVar("shadowMask")}direct({shadowMask:e}){this.shadowNode.mulAssign(e)}finish(e){Sn.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(Sn.rgb)}}const dsi=new iQt;class psi extends Ea{constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(dsi),this.setValues(e)}setupLightingModel(){return new hsi}}Pl("ShadowNodeMaterial",psi);class fsi extends Ea{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.isVolumeNodeMaterial=!0,this.testNode=null,this.setValues(e)}setup(e){const i=fii(this.map,null,0),r=Oe(({orig:s,dir:n})=>{const o=ne(-.5),a=ne(.5),l=n.reciprocal(),c=o.sub(s).mul(l),u=a.sub(s).mul(l),h=Um(c,u),p=rc(c,u),f=rc(h.x,rc(h.y,h.z)),g=Um(p.x,Um(p.y,p.z));return Vt(f,g)});this.fragmentNode=Oe(()=>{const s=Ta(ne(gei.mul(Ft(M7e,1)))),o=Ta(xu.sub(s)).normalize(),a=so("vec2","bounds").assign(r({orig:s,dir:o}));a.x.greaterThan(a.y).discard(),a.assign(Vt(rc(a.x,0),a.y));const l=so("vec3","p").assign(s.add(a.x.mul(o))),c=so("vec3","inc").assign(ne(o.abs().reciprocal())),u=so("float","delta").assign(Um(c.x,Um(c.y,c.z)));u.divAssign(Sv("steps","float"));const h=so("vec4","ac").assign(Ft(Sv("base","color"),0));return Ys({type:"float",start:a.x,end:a.y,update:"+= delta"},()=>{const p=so("float","d").assign(i.uv(l.add(.5)).r);this.testNode!==null?this.testNode({map:i,mapValue:p,probe:l,finalColor:h}).append():(h.a.assign(1),G7e()),l.addAssign(o.mul(u))}),h.a.equal(0).discard(),Ft(h)})(),super.setup(e)}}Pl("VolumeNodeMaterial",fsi);class uYe{parseFunction(){console.warn("Abstract function.")}}class qfe{constructor(e,i,r="",s=""){this.type=e,this.inputs=i,this.name=r,this.presicion=s}getCode(){console.warn("Abstract function.")}}qfe.isNodeFunction=!0;const msi=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,gsi=/[a-z_0-9]+/ig,BMe="#pragma main",ysi=t=>{t=t.trim();const e=t.indexOf(BMe),i=e!==-1?t.slice(e+BMe.length):t,r=i.match(msi);if(r!==null&&r.length===5){const s=r[4],n=[];let o=null;for(;(o=gsi.exec(s))!==null;)n.push(o);const a=[];let l=0;for(;l<n.length;){const g=n[l][0]==="const";g===!0&&l++;let y=n[l][0];y==="in"||y==="out"||y==="inout"?l++:y="";const v=n[l++][0];let b=Number.parseInt(n[l][0]);Number.isNaN(b)===!1?l++:b=null;const w=n[l++][0];a.push(new zfe(v,w,b,y,g))}const c=i.substring(r[0].length),u=r[3]!==void 0?r[3]:"",h=r[2],p=r[1]!==void 0?r[1]:"",f=e!==-1?t.slice(0,e):"";return{type:h,inputs:a,name:u,presicion:p,inputsCode:s,blockCode:c,headerCode:f}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class _si extends qfe{constructor(e){const{type:i,inputs:r,name:s,presicion:n,inputsCode:o,blockCode:a,headerCode:l}=ysi(e);super(i,r,s,n),this.inputsCode=o,this.blockCode=a,this.headerCode=l}getCode(e=this.name){let i;const r=this.blockCode;if(r!==""){const{type:s,inputsCode:n,headerCode:o,presicion:a}=this;let l=`${s} ${e} ( ${n.trim()} )`;a!==""&&(l=`${a} ${l}`),i=o+l+r}else i="";return i}}class vsi extends uYe{parseFunction(e){return new _si(e)}}const uO=Oe(([t,e,i])=>{const r=X(i).toVar(),s=X(e).toVar(),n=lC(t).toVar();return Nd(n,s,r)}),gk=Oe(([t,e])=>{const i=lC(e).toVar(),r=X(t).toVar();return Nd(i,r.negate(),r)}),Co=Oe(([t])=>{const e=X(t).toVar();return te(p$(e))}),Un=Oe(([t,e])=>{const i=X(t).toVar();return e.assign(Co(i)),i.sub(X(e))}),hYe=Oe(([t,e,i,r,s,n])=>{const o=X(n).toVar(),a=X(s).toVar(),l=X(r).toVar(),c=X(i).toVar(),u=X(e).toVar(),h=X(t).toVar(),p=X(Yo(1,a)).toVar();return Yo(1,o).mul(h.mul(p).add(u.mul(a))).add(o.mul(c.mul(p).add(l.mul(a))))}),dYe=Oe(([t,e,i,r,s,n])=>{const o=X(n).toVar(),a=X(s).toVar(),l=ne(r).toVar(),c=ne(i).toVar(),u=ne(e).toVar(),h=ne(t).toVar(),p=X(Yo(1,a)).toVar();return Yo(1,o).mul(h.mul(p).add(u.mul(a))).add(o.mul(c.mul(p).add(l.mul(a))))}),pYe=Cf([hYe,dYe]),fYe=Oe(([t,e,i,r,s,n,o,a,l,c,u])=>{const h=X(u).toVar(),p=X(c).toVar(),f=X(l).toVar(),g=X(a).toVar(),y=X(o).toVar(),v=X(n).toVar(),b=X(s).toVar(),w=X(r).toVar(),x=X(i).toVar(),S=X(e).toVar(),E=X(t).toVar(),C=X(Yo(1,f)).toVar(),R=X(Yo(1,p)).toVar();return X(Yo(1,h)).toVar().mul(R.mul(E.mul(C).add(S.mul(f))).add(p.mul(x.mul(C).add(w.mul(f))))).add(h.mul(R.mul(b.mul(C).add(v.mul(f))).add(p.mul(y.mul(C).add(g.mul(f))))))}),mYe=Oe(([t,e,i,r,s,n,o,a,l,c,u])=>{const h=X(u).toVar(),p=X(c).toVar(),f=X(l).toVar(),g=ne(a).toVar(),y=ne(o).toVar(),v=ne(n).toVar(),b=ne(s).toVar(),w=ne(r).toVar(),x=ne(i).toVar(),S=ne(e).toVar(),E=ne(t).toVar(),C=X(Yo(1,f)).toVar(),R=X(Yo(1,p)).toVar();return X(Yo(1,h)).toVar().mul(R.mul(E.mul(C).add(S.mul(f))).add(p.mul(x.mul(C).add(w.mul(f))))).add(h.mul(R.mul(b.mul(C).add(v.mul(f))).add(p.mul(y.mul(C).add(g.mul(f))))))}),gYe=Cf([fYe,mYe]),yYe=Oe(([t,e,i])=>{const r=X(i).toVar(),s=X(e).toVar(),n=ft(t).toVar(),o=ft(n.bitAnd(ft(7))).toVar(),a=X(uO(o.lessThan(ft(4)),s,r)).toVar(),l=X(Xr(2,uO(o.lessThan(ft(4)),r,s))).toVar();return gk(a,lC(o.bitAnd(ft(1)))).add(gk(l,lC(o.bitAnd(ft(2)))))}),_Ye=Oe(([t,e,i,r])=>{const s=X(r).toVar(),n=X(i).toVar(),o=X(e).toVar(),a=ft(t).toVar(),l=ft(a.bitAnd(ft(15))).toVar(),c=X(uO(l.lessThan(ft(8)),o,n)).toVar(),u=X(uO(l.lessThan(ft(4)),n,uO(l.equal(ft(12)).or(l.equal(ft(14))),o,s))).toVar();return gk(c,lC(l.bitAnd(ft(1)))).add(gk(u,lC(l.bitAnd(ft(2)))))}),hl=Cf([yYe,_Ye]),vYe=Oe(([t,e,i])=>{const r=X(i).toVar(),s=X(e).toVar(),n=G4(t).toVar();return ne(hl(n.x,s,r),hl(n.y,s,r),hl(n.z,s,r))}),bYe=Oe(([t,e,i,r])=>{const s=X(r).toVar(),n=X(i).toVar(),o=X(e).toVar(),a=G4(t).toVar();return ne(hl(a.x,o,n,s),hl(a.y,o,n,s),hl(a.z,o,n,s))}),Fp=Cf([vYe,bYe]),wYe=Oe(([t])=>{const e=X(t).toVar();return Xr(.6616,e)}),xYe=Oe(([t])=>{const e=X(t).toVar();return Xr(.982,e)}),SYe=Oe(([t])=>{const e=ne(t).toVar();return Xr(.6616,e)}),TYe=Cf([wYe,SYe]),EYe=Oe(([t])=>{const e=ne(t).toVar();return Xr(.982,e)}),CYe=Cf([xYe,EYe]),ch=Oe(([t,e])=>{const i=te(e).toVar(),r=ft(t).toVar();return r.shiftLeft(i).bitOr(r.shiftRight(te(32).sub(i)))}),MYe=Oe(([t,e,i])=>{t.subAssign(i),t.bitXorAssign(ch(i,te(4))),i.addAssign(e),e.subAssign(t),e.bitXorAssign(ch(t,te(6))),t.addAssign(i),i.subAssign(e),i.bitXorAssign(ch(e,te(8))),e.addAssign(t),t.subAssign(i),t.bitXorAssign(ch(i,te(16))),i.addAssign(e),e.subAssign(t),e.bitXorAssign(ch(t,te(19))),t.addAssign(i),i.subAssign(e),i.bitXorAssign(ch(e,te(4))),e.addAssign(t)}),_$=Oe(([t,e,i])=>{const r=ft(i).toVar(),s=ft(e).toVar(),n=ft(t).toVar();return r.bitXorAssign(s),r.subAssign(ch(s,te(14))),n.bitXorAssign(r),n.subAssign(ch(r,te(11))),s.bitXorAssign(n),s.subAssign(ch(n,te(25))),r.bitXorAssign(s),r.subAssign(ch(s,te(16))),n.bitXorAssign(r),n.subAssign(ch(r,te(4))),s.bitXorAssign(n),s.subAssign(ch(n,te(14))),r.bitXorAssign(s),r.subAssign(ch(s,te(24))),r}),nc=Oe(([t])=>{const e=ft(t).toVar();return X(e).div(X(ft(te(4294967295))))}),og=Oe(([t])=>{const e=X(t).toVar();return e.mul(e.mul(e.mul(e.mul(e.mul(6).sub(15)).add(10))))}),AYe=Oe(([t])=>{const e=te(t).toVar(),i=ft(ft(1)).toVar(),r=ft(ft(te(3735928559)).add(i.shiftLeft(ft(2)).add(ft(13)))).toVar();return _$(r.add(ft(e)),r,r)}),RYe=Oe(([t,e])=>{const i=te(e).toVar(),r=te(t).toVar(),s=ft(ft(2)).toVar(),n=ft().toVar(),o=ft().toVar(),a=ft().toVar();return n.assign(o.assign(a.assign(ft(te(3735928559)).add(s.shiftLeft(ft(2)).add(ft(13)))))),n.addAssign(ft(r)),o.addAssign(ft(i)),_$(n,o,a)}),PYe=Oe(([t,e,i])=>{const r=te(i).toVar(),s=te(e).toVar(),n=te(t).toVar(),o=ft(ft(3)).toVar(),a=ft().toVar(),l=ft().toVar(),c=ft().toVar();return a.assign(l.assign(c.assign(ft(te(3735928559)).add(o.shiftLeft(ft(2)).add(ft(13)))))),a.addAssign(ft(n)),l.addAssign(ft(s)),c.addAssign(ft(r)),_$(a,l,c)}),OYe=Oe(([t,e,i,r])=>{const s=te(r).toVar(),n=te(i).toVar(),o=te(e).toVar(),a=te(t).toVar(),l=ft(ft(4)).toVar(),c=ft().toVar(),u=ft().toVar(),h=ft().toVar();return c.assign(u.assign(h.assign(ft(te(3735928559)).add(l.shiftLeft(ft(2)).add(ft(13)))))),c.addAssign(ft(a)),u.addAssign(ft(o)),h.addAssign(ft(n)),MYe(c,u,h),c.addAssign(ft(s)),_$(c,u,h)}),IYe=Oe(([t,e,i,r,s])=>{const n=te(s).toVar(),o=te(r).toVar(),a=te(i).toVar(),l=te(e).toVar(),c=te(t).toVar(),u=ft(ft(5)).toVar(),h=ft().toVar(),p=ft().toVar(),f=ft().toVar();return h.assign(p.assign(f.assign(ft(te(3735928559)).add(u.shiftLeft(ft(2)).add(ft(13)))))),h.addAssign(ft(c)),p.addAssign(ft(l)),f.addAssign(ft(a)),MYe(h,p,f),h.addAssign(ft(o)),p.addAssign(ft(n)),_$(h,p,f)}),Rs=Cf([AYe,RYe,PYe,OYe,IYe]),$Ye=Oe(([t,e])=>{const i=te(e).toVar(),r=te(t).toVar(),s=ft(Rs(r,i)).toVar(),n=G4().toVar();return n.x.assign(s.bitAnd(te(255))),n.y.assign(s.shiftRight(te(8)).bitAnd(te(255))),n.z.assign(s.shiftRight(te(16)).bitAnd(te(255))),n}),NYe=Oe(([t,e,i])=>{const r=te(i).toVar(),s=te(e).toVar(),n=te(t).toVar(),o=ft(Rs(n,s,r)).toVar(),a=G4().toVar();return a.x.assign(o.bitAnd(te(255))),a.y.assign(o.shiftRight(te(8)).bitAnd(te(255))),a.z.assign(o.shiftRight(te(16)).bitAnd(te(255))),a}),kp=Cf([$Ye,NYe]),LYe=Oe(([t])=>{const e=Vt(t).toVar(),i=te().toVar(),r=te().toVar(),s=X(Un(e.x,i)).toVar(),n=X(Un(e.y,r)).toVar(),o=X(og(s)).toVar(),a=X(og(n)).toVar(),l=X(pYe(hl(Rs(i,r),s,n),hl(Rs(i.add(te(1)),r),s.sub(1),n),hl(Rs(i,r.add(te(1))),s,n.sub(1)),hl(Rs(i.add(te(1)),r.add(te(1))),s.sub(1),n.sub(1)),o,a)).toVar();return TYe(l)}),DYe=Oe(([t])=>{const e=ne(t).toVar(),i=te().toVar(),r=te().toVar(),s=te().toVar(),n=X(Un(e.x,i)).toVar(),o=X(Un(e.y,r)).toVar(),a=X(Un(e.z,s)).toVar(),l=X(og(n)).toVar(),c=X(og(o)).toVar(),u=X(og(a)).toVar(),h=X(gYe(hl(Rs(i,r,s),n,o,a),hl(Rs(i.add(te(1)),r,s),n.sub(1),o,a),hl(Rs(i,r.add(te(1)),s),n,o.sub(1),a),hl(Rs(i.add(te(1)),r.add(te(1)),s),n.sub(1),o.sub(1),a),hl(Rs(i,r,s.add(te(1))),n,o,a.sub(1)),hl(Rs(i.add(te(1)),r,s.add(te(1))),n.sub(1),o,a.sub(1)),hl(Rs(i,r.add(te(1)),s.add(te(1))),n,o.sub(1),a.sub(1)),hl(Rs(i.add(te(1)),r.add(te(1)),s.add(te(1))),n.sub(1),o.sub(1),a.sub(1)),l,c,u)).toVar();return CYe(h)}),bsi=Cf([LYe,DYe]),FYe=Oe(([t])=>{const e=Vt(t).toVar(),i=te().toVar(),r=te().toVar(),s=X(Un(e.x,i)).toVar(),n=X(Un(e.y,r)).toVar(),o=X(og(s)).toVar(),a=X(og(n)).toVar(),l=ne(pYe(Fp(kp(i,r),s,n),Fp(kp(i.add(te(1)),r),s.sub(1),n),Fp(kp(i,r.add(te(1))),s,n.sub(1)),Fp(kp(i.add(te(1)),r.add(te(1))),s.sub(1),n.sub(1)),o,a)).toVar();return TYe(l)}),kYe=Oe(([t])=>{const e=ne(t).toVar(),i=te().toVar(),r=te().toVar(),s=te().toVar(),n=X(Un(e.x,i)).toVar(),o=X(Un(e.y,r)).toVar(),a=X(Un(e.z,s)).toVar(),l=X(og(n)).toVar(),c=X(og(o)).toVar(),u=X(og(a)).toVar(),h=ne(gYe(Fp(kp(i,r,s),n,o,a),Fp(kp(i.add(te(1)),r,s),n.sub(1),o,a),Fp(kp(i,r.add(te(1)),s),n,o.sub(1),a),Fp(kp(i.add(te(1)),r.add(te(1)),s),n.sub(1),o.sub(1),a),Fp(kp(i,r,s.add(te(1))),n,o,a.sub(1)),Fp(kp(i.add(te(1)),r,s.add(te(1))),n.sub(1),o,a.sub(1)),Fp(kp(i,r.add(te(1)),s.add(te(1))),n,o.sub(1),a.sub(1)),Fp(kp(i.add(te(1)),r.add(te(1)),s.add(te(1))),n.sub(1),o.sub(1),a.sub(1)),l,c,u)).toVar();return CYe(h)}),wsi=Cf([FYe,kYe]),xsi=Oe(([t])=>{const e=X(t).toVar(),i=te(Co(e)).toVar();return nc(Rs(i))}),Ssi=Oe(([t])=>{const e=Vt(t).toVar(),i=te(Co(e.x)).toVar(),r=te(Co(e.y)).toVar();return nc(Rs(i,r))}),Tsi=Oe(([t])=>{const e=ne(t).toVar(),i=te(Co(e.x)).toVar(),r=te(Co(e.y)).toVar(),s=te(Co(e.z)).toVar();return nc(Rs(i,r,s))}),Esi=Oe(([t])=>{const e=Ft(t).toVar(),i=te(Co(e.x)).toVar(),r=te(Co(e.y)).toVar(),s=te(Co(e.z)).toVar(),n=te(Co(e.w)).toVar();return nc(Rs(i,r,s,n))}),UYe=Oe(([t])=>{const e=X(t).toVar(),i=te(Co(e)).toVar();return ne(nc(Rs(i,te(0))),nc(Rs(i,te(1))),nc(Rs(i,te(2))))}),BYe=Oe(([t])=>{const e=Vt(t).toVar(),i=te(Co(e.x)).toVar(),r=te(Co(e.y)).toVar();return ne(nc(Rs(i,r,te(0))),nc(Rs(i,r,te(1))),nc(Rs(i,r,te(2))))}),zYe=Oe(([t])=>{const e=ne(t).toVar(),i=te(Co(e.x)).toVar(),r=te(Co(e.y)).toVar(),s=te(Co(e.z)).toVar();return ne(nc(Rs(i,r,s,te(0))),nc(Rs(i,r,s,te(1))),nc(Rs(i,r,s,te(2))))}),VYe=Oe(([t])=>{const e=Ft(t).toVar(),i=te(Co(e.x)).toVar(),r=te(Co(e.y)).toVar(),s=te(Co(e.z)).toVar(),n=te(Co(e.w)).toVar();return ne(nc(Rs(i,r,s,n,te(0))),nc(Rs(i,r,s,n,te(1))),nc(Rs(i,r,s,n,te(2))))}),GYe=Cf([UYe,BYe,zYe,VYe]),eq=Oe(([t,e,i,r])=>{const s=X(r).toVar(),n=X(i).toVar(),o=te(e).toVar(),a=ne(t).toVar(),l=X(0).toVar(),c=X(1).toVar();return Ys({start:te(0),end:o},({i:u})=>{l.addAssign(c.mul(bsi(a))),c.mulAssign(s),a.mulAssign(n)}),l}),jYe=Oe(([t,e,i,r])=>{const s=X(r).toVar(),n=X(i).toVar(),o=te(e).toVar(),a=ne(t).toVar(),l=ne(0).toVar(),c=X(1).toVar();return Ys({start:te(0),end:o},({i:u})=>{l.addAssign(c.mul(wsi(a))),c.mulAssign(s),a.mulAssign(n)}),l}),Csi=Oe(([t,e,i,r])=>{const s=X(r).toVar(),n=X(i).toVar(),o=te(e).toVar(),a=ne(t).toVar();return Vt(eq(a,o,n,s),eq(a.add(ne(te(19),te(193),te(17))),o,n,s))}),Msi=Oe(([t,e,i,r])=>{const s=X(r).toVar(),n=X(i).toVar(),o=te(e).toVar(),a=ne(t).toVar(),l=ne(jYe(a,o,n,s)).toVar(),c=X(eq(a.add(ne(te(19),te(193),te(17))),o,n,s)).toVar();return Ft(l,c)}),HYe=Oe(([t,e,i,r,s,n,o])=>{const a=te(o).toVar(),l=X(n).toVar(),c=te(s).toVar(),u=te(r).toVar(),h=te(i).toVar(),p=te(e).toVar(),f=Vt(t).toVar(),g=ne(GYe(Vt(p.add(u),h.add(c)))).toVar(),y=Vt(g.x,g.y).toVar();y.subAssign(.5),y.mulAssign(l),y.addAssign(.5);const v=Vt(Vt(X(p),X(h)).add(y)).toVar(),b=Vt(v.sub(f)).toVar();return xr(a.equal(te(2)),()=>ma(b.x).add(ma(b.y))),xr(a.equal(te(3)),()=>rc(ma(b.x),ma(b.y))),f$(b,b)}),qYe=Oe(([t,e,i,r,s,n,o,a,l])=>{const c=te(l).toVar(),u=X(a).toVar(),h=te(o).toVar(),p=te(n).toVar(),f=te(s).toVar(),g=te(r).toVar(),y=te(i).toVar(),v=te(e).toVar(),b=ne(t).toVar(),w=ne(GYe(ne(v.add(f),y.add(p),g.add(h)))).toVar();w.subAssign(.5),w.mulAssign(u),w.addAssign(.5);const x=ne(ne(X(v),X(y),X(g)).add(w)).toVar(),S=ne(x.sub(b)).toVar();return xr(c.equal(te(2)),()=>ma(S.x).add(ma(S.y).add(ma(S.z)))),xr(c.equal(te(3)),()=>rc(rc(ma(S.x),ma(S.y)),ma(S.z))),f$(S,S)}),v$=Cf([HYe,qYe]),Asi=Oe(([t,e,i])=>{const r=te(i).toVar(),s=X(e).toVar(),n=Vt(t).toVar(),o=te().toVar(),a=te().toVar(),l=Vt(Un(n.x,o),Un(n.y,a)).toVar(),c=X(1e6).toVar();return Ys({start:-1,end:te(1),name:"x",condition:"<="},({x:u})=>{Ys({start:-1,end:te(1),name:"y",condition:"<="},({y:h})=>{const p=X(v$(l,u,h,o,a,s,r)).toVar();c.assign(Um(c,p))})}),xr(r.equal(te(0)),()=>{c.assign(jC(c))}),c}),Rsi=Oe(([t,e,i])=>{const r=te(i).toVar(),s=X(e).toVar(),n=Vt(t).toVar(),o=te().toVar(),a=te().toVar(),l=Vt(Un(n.x,o),Un(n.y,a)).toVar(),c=Vt(1e6,1e6).toVar();return Ys({start:-1,end:te(1),name:"x",condition:"<="},({x:u})=>{Ys({start:-1,end:te(1),name:"y",condition:"<="},({y:h})=>{const p=X(v$(l,u,h,o,a,s,r)).toVar();xr(p.lessThan(c.x),()=>{c.y.assign(c.x),c.x.assign(p)}).elseif(p.lessThan(c.y),()=>{c.y.assign(p)})})}),xr(r.equal(te(0)),()=>{c.assign(jC(c))}),c}),Psi=Oe(([t,e,i])=>{const r=te(i).toVar(),s=X(e).toVar(),n=Vt(t).toVar(),o=te().toVar(),a=te().toVar(),l=Vt(Un(n.x,o),Un(n.y,a)).toVar(),c=ne(1e6,1e6,1e6).toVar();return Ys({start:-1,end:te(1),name:"x",condition:"<="},({x:u})=>{Ys({start:-1,end:te(1),name:"y",condition:"<="},({y:h})=>{const p=X(v$(l,u,h,o,a,s,r)).toVar();xr(p.lessThan(c.x),()=>{c.z.assign(c.y),c.y.assign(c.x),c.x.assign(p)}).elseif(p.lessThan(c.y),()=>{c.z.assign(c.y),c.y.assign(p)}).elseif(p.lessThan(c.z),()=>{c.z.assign(p)})})}),xr(r.equal(te(0)),()=>{c.assign(jC(c))}),c}),Osi=Oe(([t,e,i])=>{const r=te(i).toVar(),s=X(e).toVar(),n=ne(t).toVar(),o=te().toVar(),a=te().toVar(),l=te().toVar(),c=ne(Un(n.x,o),Un(n.y,a),Un(n.z,l)).toVar(),u=X(1e6).toVar();return Ys({start:-1,end:te(1),name:"x",condition:"<="},({x:h})=>{Ys({start:-1,end:te(1),name:"y",condition:"<="},({y:p})=>{Ys({start:-1,end:te(1),name:"z",condition:"<="},({z:f})=>{const g=X(v$(c,h,p,f,o,a,l,s,r)).toVar();u.assign(Um(u,g))})})}),xr(r.equal(te(0)),()=>{u.assign(jC(u))}),u}),Isi=Oe(([t,e,i])=>{const r=te(i).toVar(),s=X(e).toVar(),n=ne(t).toVar(),o=te().toVar(),a=te().toVar(),l=te().toVar(),c=ne(Un(n.x,o),Un(n.y,a),Un(n.z,l)).toVar(),u=Vt(1e6,1e6).toVar();return Ys({start:-1,end:te(1),name:"x",condition:"<="},({x:h})=>{Ys({start:-1,end:te(1),name:"y",condition:"<="},({y:p})=>{Ys({start:-1,end:te(1),name:"z",condition:"<="},({z:f})=>{const g=X(v$(c,h,p,f,o,a,l,s,r)).toVar();xr(g.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(g)}).elseif(g.lessThan(u.y),()=>{u.y.assign(g)})})})}),xr(r.equal(te(0)),()=>{u.assign(jC(u))}),u}),$si=Oe(([t,e,i])=>{const r=te(i).toVar(),s=X(e).toVar(),n=ne(t).toVar(),o=te().toVar(),a=te().toVar(),l=te().toVar(),c=ne(Un(n.x,o),Un(n.y,a),Un(n.z,l)).toVar(),u=ne(1e6,1e6,1e6).toVar();return Ys({start:-1,end:te(1),name:"x",condition:"<="},({x:h})=>{Ys({start:-1,end:te(1),name:"y",condition:"<="},({y:p})=>{Ys({start:-1,end:te(1),name:"z",condition:"<="},({z:f})=>{const g=X(v$(c,h,p,f,o,a,l,s,r)).toVar();xr(g.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(g)}).elseif(g.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(g)}).elseif(g.lessThan(u.z),()=>{u.z.assign(g)})})})}),xr(r.equal(te(0)),()=>{u.assign(jC(u))}),u});uO.setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]});gk.setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]});Co.setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]});hYe.setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]});dYe.setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]});fYe.setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});mYe.setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});yYe.setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]});_Ye.setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});vYe.setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]});bYe.setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});wYe.setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]});xYe.setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]});SYe.setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});EYe.setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});ch.setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]});_$.setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]});nc.setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]});og.setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]});AYe.setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]});RYe.setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});PYe.setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});OYe.setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]});IYe.setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]});$Ye.setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});NYe.setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});LYe.setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]});DYe.setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]});FYe.setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]});kYe.setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]});xsi.setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]});Ssi.setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]});Tsi.setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]});Esi.setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]});UYe.setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]});BYe.setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]});zYe.setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]});VYe.setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]});eq.setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});jYe.setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Csi.setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Msi.setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});HYe.setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});qYe.setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Asi.setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Rsi.setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Psi.setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Osi.setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Isi.setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});$si.setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});const Nsi=Oe(([t])=>{const e=ne(t).toVar(),i=X(e.x).toVar(),r=X(e.y).toVar(),s=X(e.z).toVar();xr(r.lessThan(1e-4),()=>ne(s,s,s)).else(()=>{i.assign(Xr(6,i.sub(p$(i))));const n=te(y7e(i)).toVar(),o=X(i.sub(X(n))).toVar(),a=X(s.mul(Yo(1,r))).toVar(),l=X(s.mul(Yo(1,r.mul(o)))).toVar(),c=X(s.mul(Yo(1,r.mul(Yo(1,o))))).toVar();return xr(n.equal(te(0)),()=>ne(s,c,a)).elseif(n.equal(te(1)),()=>ne(l,s,a)).elseif(n.equal(te(2)),()=>ne(a,s,c)).elseif(n.equal(te(3)),()=>ne(a,l,s)).elseif(n.equal(te(4)),()=>ne(c,a,s)),ne(s,a,l)})}),Lsi=Oe(([t])=>{const e=ne(t).toVar(),i=X(e.x).toVar(),r=X(e.y).toVar(),s=X(e.z).toVar(),n=X(Um(i,Um(r,s))).toVar(),o=X(rc(i,rc(r,s))).toVar(),a=X(o.sub(n)).toVar(),l=X().toVar(),c=X().toVar(),u=X().toVar();return u.assign(o),xr(o.greaterThan(0),()=>{c.assign(a.div(o))}).else(()=>{c.assign(0)}),xr(c.lessThanEqual(0),()=>{l.assign(0)}).else(()=>{xr(i.greaterThanEqual(o),()=>{l.assign(r.sub(s).div(a))}).elseif(r.greaterThanEqual(o),()=>{l.assign(Jd(2,s.sub(i).div(a)))}).else(()=>{l.assign(Jd(4,i.sub(r).div(a)))}),l.mulAssign(1/6),xr(l.lessThan(0),()=>{l.addAssign(1)})}),ne(l,c,u)});Nsi.setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]});Lsi.setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]});const Dsi=Oe(([t])=>{const e=ne(t).toVar(),i=q9e(h7e(e,ne(.04045))).toVar(),r=ne(e.div(12.92)).toVar(),s=ne(i0(rc(e.add(ne(.055)),ne(0)).div(1.055),ne(2.4))).toVar();return Po(r,s,i)});Dsi.setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]});self.GPUShaderStage===void 0&&(self.GPUShaderStage={VERTEX:1,FRAGMENT:2,COMPUTE:4});let tq=navigator.gpu!==void 0;typeof window<"u"&&tq&&(tq=await navigator.gpu.requestAdapter());class Fsi{static isAvailable(){return!!tq}static getStaticAdapter(){return tq}static getErrorMessage(){const e='Your browser does not support <a href="https://gpuweb.github.io/gpuweb/" style="color:blue">WebGPU</a> yet',i=document.createElement("div");return i.id="webgpumessage",i.style.fontFamily="monospace",i.style.fontSize="13px",i.style.fontWeight="normal",i.style.textAlign="center",i.style.background="#fff",i.style.color="#000",i.style.padding="1.5em",i.style.maxWidth="400px",i.style.margin="5em auto 0",i.innerHTML=e,i}}const ksi=Fsi;class Usi{constructor(e,i){this.nodes=e,this.info=i,this.animationLoop=null,this.requestId=null,this._init()}_init(){const e=(i,r)=>{this.requestId=self.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.animationLoop!==null&&this.animationLoop(i,r)};e()}dispose(){self.cancelAnimationFrame(this.requestId),this.requestId=null}setAnimationLoop(e){this.animationLoop=e}}const Bsi=Usi,DQ=new rw;let FQ=0;class zsi{constructor(){this.version=++FQ,this.globalClippingCount=0,this.localClippingCount=0,this.localClippingEnabled=!1,this.localClipIntersection=!1,this.planes=[],this.parentVersion=0,this.viewNormalMatrix=new Tf}projectPlanes(e,i){const r=e.length,s=this.planes;for(let n=0;n<r;n++){DQ.copy(e[n]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=s[i+n],a=DQ.normal;o.x=-a.x,o.y=-a.y,o.z=-a.z,o.w=DQ.constant}}updateGlobal(e,i){const r=e.clippingPlanes;this.viewMatrix=i.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix);let s=!1;if(Array.isArray(r)&&r.length!==0){const n=r.length;if(n!==this.globalClippingCount){const o=[];for(let a=0;a<n;a++)o.push(new Fs);this.globalClippingCount=n,this.planes=o,s=!0}this.projectPlanes(r,0)}else this.globalClippingCount!==0&&(this.globalClippingCount=0,this.planes=[],s=!0);e.localClippingEnabled!==this.localClippingEnabled&&(this.localClippingEnabled=e.localClippingEnabled,s=!0),s&&(this.version=FQ++)}update(e,i){let r=!1;if(this!==e&&e.version!==this.parentVersion&&(this.globalClippingCount=i.isShadowNodeMaterial?0:e.globalClippingCount,this.localClippingEnabled=e.localClippingEnabled,this.planes=Array.from(e.planes),this.parentVersion=e.version,this.viewMatrix=e.viewMatrix,this.viewNormalMatrix=e.viewNormalMatrix,r=!0),this.localClippingEnabled){const s=i.clippingPlanes;if(Array.isArray(s)&&s.length!==0){const n=s.length,o=this.planes,a=this.globalClippingCount;if(r||n!==this.localClippingCount){o.length=a+n;for(let l=0;l<n;l++)o[a+l]=new Fs;this.localClippingCount=n,r=!0}this.projectPlanes(s,a)}else this.localClippingCount!==0&&(this.localClippingCount=0,r=!0);this.localClipIntersection!==i.clipIntersection&&(this.localClipIntersection=i.clipIntersection,r=!0)}r&&(this.version=FQ++)}}const ile=zsi;let Vsi=0;function Gsi(t){const e=Object.keys(t);let i=Object.getPrototypeOf(t);for(;i;){const r=Object.getOwnPropertyDescriptors(i);for(const s in r)if(r[s]!==void 0){const n=r[s];n&&typeof n.get=="function"&&e.push(s)}i=Object.getPrototypeOf(i)}return e}class jsi{constructor(e,i,r,s,n,o,a,l,c){this._nodes=e,this._geometries=i,this.id=Vsi++,this.renderer=r,this.object=s,this.material=n,this.scene=o,this.camera=a,this.lightsNode=l,this.context=c,this.geometry=s.geometry,this.version=n.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.vertexBuffers=null,this.updateClipping(c.clippingContext),this.clippingContextVersion=this.clippingContext.version,this.initialNodesCacheKey=this.getNodesCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){const i=this.material;let r=this.clippingContext;Array.isArray(i.clippingPlanes)?((r===e||!r)&&(r=new ile,this.clippingContext=r),r.update(e,i)):this.clippingContext!==e&&(this.clippingContext=e)}get clippingNeedsUpdate(){return this.clippingContext.version===this.clippingContextVersion?!1:(this.clippingContextVersion=this.clippingContext.version,!0)}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getIndex(){return this._geometries.getIndex(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,i=this.geometry,r=[],s=new Set;for(const n of e){const o=n.node&&n.node.attribute?n.node.attribute:i.getAttribute(n.name);if(o===void 0)continue;r.push(o);const a=o.isInterleavedBufferAttribute?o.data:o;s.add(a)}return this.attributes=r,this.vertexBuffers=Array.from(s.values()),r}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getMaterialCacheKey(){const{object:e,material:i}=this;let r=i.customProgramCacheKey();for(const s of Gsi(i)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(s))continue;let n=i[s];if(n!==null){const o=typeof n;o==="number"?n=n!==0?"1":"0":o==="object"&&(n="{}")}r+=n+","}return r+=this.clippingContextVersion+",",e.skeleton&&(r+=e.skeleton.bones.length+","),e.morphTargetInfluences&&(r+=e.morphTargetInfluences.length+","),e.isBatchedMesh&&(r+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(r+=e._colorsTexture.uuid+",")),r}get needsUpdate(){return this.initialNodesCacheKey!==this.getNodesCacheKey()||this.clippingNeedsUpdate}getNodesCacheKey(){return this._nodes.getCacheKey(this.scene,this.lightsNode)}getCacheKey(){return this.getMaterialCacheKey()+","+this.getNodesCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}class Hsi{constructor(e,i,r,s,n,o){this.renderer=e,this.nodes=i,this.geometries=r,this.pipelines=s,this.bindings=n,this.info=o,this.chainMaps={}}get(e,i,r,s,n,o,a){const l=this.getChainMap(a),c=[e,i,o,n];let u=l.get(c);return u===void 0?(u=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,i,r,s,n,o,a),l.set(c,u)):(u.updateClipping(o.clippingContext),(u.version!==i.version||u.needsUpdate)&&(u.initialCacheKey!==u.getCacheKey()?(u.dispose(),u=this.get(e,i,r,s,n,o,a)):u.version=i.version)),u}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Qv)}dispose(){this.chainMaps={}}createRenderObject(e,i,r,s,n,o,a,l,c,u){const h=this.getChainMap(u),p=new jsi(e,i,r,s,n,o,a,l,c);return p.onDispose=()=>{this.pipelines.delete(p),this.bindings.delete(p),this.nodes.delete(p),h.delete(p.getChainArray())},p}}const qsi=Hsi;class Wsi{constructor(){this.data=new WeakMap}get(e){let i=this.data.get(e);return i===void 0&&(i={},this.data.set(e,i)),i}delete(e){let i;return this.data.has(e)&&(i=this.data.get(e),this.data.delete(e)),i}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const YC=Wsi,hO={VERTEX:1,INDEX:2,STORAGE:4},fw=16,Ysi=211,Xsi=212;class Zsi extends YC{constructor(e){super(),this.backend=e}delete(e){const i=super.delete(e);return i!==void 0&&this.backend.destroyAttribute(e),i}update(e,i){const r=this.get(e);if(r.version===void 0)i===hO.VERTEX?this.backend.createAttribute(e):i===hO.INDEX?this.backend.createIndexAttribute(e):i===hO.STORAGE&&this.backend.createStorageAttribute(e),r.version=this._getBufferAttribute(e).version;else{const s=this._getBufferAttribute(e);(r.version<s.version||s.usage===FH)&&(this.backend.updateAttribute(e),r.version=s.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}const Jsi=Zsi;function Qsi(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function WYe(t){return t.index!==null?t.index.version:t.attributes.position.version}function zMe(t){const e=[],i=t.index,r=t.attributes.position;if(i!==null){const n=i.array;for(let o=0,a=n.length;o<a;o+=3){const l=n[o+0],c=n[o+1],u=n[o+2];e.push(l,c,c,u,u,l)}}else{const n=r.array;for(let o=0,a=n.length/3-1;o<a;o+=3){const l=o+0,c=o+1,u=o+2;e.push(l,c,c,u,u,l)}}const s=new(Qsi(e)?b9e:v9e)(e,1);return s.version=WYe(t),s}class Ksi extends YC{constructor(e,i){super(),this.attributes=e,this.info=i,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const i=e.geometry;return super.has(i)&&this.get(i).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const i=e.geometry,r=this.get(i);r.initialized=!0,this.info.memory.geometries++;const s=()=>{this.info.memory.geometries--;const n=i.index,o=e.getAttributes();n!==null&&this.attributes.delete(n);for(const l of o)this.attributes.delete(l);const a=this.wireframes.get(i);a!==void 0&&this.attributes.delete(a),i.removeEventListener("dispose",s)};i.addEventListener("dispose",s)}updateAttributes(e){const i=e.getAttributes();for(const s of i)this.updateAttribute(s,hO.VERTEX);const r=this.getIndex(e);r!==null&&this.updateAttribute(r,hO.INDEX)}updateAttribute(e,i){const r=this.info.render.calls;this.attributeCall.get(e)!==r&&(this.attributes.update(e,i),this.attributeCall.set(e,r))}getIndex(e){const{geometry:i,material:r}=e;let s=i.index;if(r.wireframe===!0){const n=this.wireframes;let o=n.get(i);o===void 0?(o=zMe(i),n.set(i,o)):o.version!==WYe(i)&&(this.attributes.delete(o),o=zMe(i),n.set(i,o)),s=o}return s}}const eni=Ksi;class tni{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,computeCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,i,r){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=r*(i/3):e.isPoints?this.render.points+=r*i:e.isLineSegments?this.render.lines+=r*(i/2):e.isLine?this.render.lines+=r*(i-1):console.error("THREE.WebGPUInfo: Unknown object type.")}updateTimestamp(e,i){this[e].timestamp+=i}reset(){this.render.drawCalls=0,this.compute.computeCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0,this.render.timestamp=0,this.compute.timestamp=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}const ini=tni;class rni{constructor(e){this.cacheKey=e,this.usedTimes=0}}const YYe=rni;class sni extends YYe{constructor(e,i,r){super(e),this.vertexProgram=i,this.fragmentProgram=r}}const nni=sni;class oni extends YYe{constructor(e,i){super(e),this.computeProgram=i,this.isComputePipeline=!0}}const ani=oni;let lni=0;class cni{constructor(e,i,r=null,s=null){this.id=lni++,this.code=e,this.stage=i,this.transforms=r,this.attributes=s,this.usedTimes=0}}const kQ=cni;class uni extends YC{constructor(e,i){super(),this.backend=e,this.nodes=i,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,i){const{backend:r}=this,s=this.get(e);if(this._needsComputeUpdate(e)){const n=s.pipeline;n&&(n.usedTimes--,n.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let a=this.programs.compute.get(o.computeShader);a===void 0&&(n&&n.computeProgram.usedTimes===0&&this._releaseProgram(n.computeProgram),a=new kQ(o.computeShader,"compute",o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,a),r.createProgram(a));const l=this._getComputeCacheKey(e,a);let c=this.caches.get(l);c===void 0&&(n&&n.usedTimes===0&&this._releasePipeline(n),c=this._getComputePipeline(e,a,l,i)),c.usedTimes++,a.usedTimes++,s.version=e.version,s.pipeline=c}return s.pipeline}getForRender(e,i=null){const{backend:r}=this,s=this.get(e);if(this._needsRenderUpdate(e)){const n=s.pipeline;n&&(n.usedTimes--,n.vertexProgram.usedTimes--,n.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState();let a=this.programs.vertex.get(o.vertexShader);a===void 0&&(n&&n.vertexProgram.usedTimes===0&&this._releaseProgram(n.vertexProgram),a=new kQ(o.vertexShader,"vertex"),this.programs.vertex.set(o.vertexShader,a),r.createProgram(a));let l=this.programs.fragment.get(o.fragmentShader);l===void 0&&(n&&n.fragmentProgram.usedTimes===0&&this._releaseProgram(n.fragmentProgram),l=new kQ(o.fragmentShader,"fragment"),this.programs.fragment.set(o.fragmentShader,l),r.createProgram(l));const c=this._getRenderCacheKey(e,a,l);let u=this.caches.get(c);u===void 0?(n&&n.usedTimes===0&&this._releasePipeline(n),u=this._getRenderPipeline(e,a,l,c,i)):e.pipeline=u,u.usedTimes++,a.usedTimes++,l.usedTimes++,s.pipeline=u}return s.pipeline}delete(e){const i=this.get(e).pipeline;return i&&(i.usedTimes--,i.usedTimes===0&&this._releasePipeline(i),i.isComputePipeline?(i.computeProgram.usedTimes--,i.computeProgram.usedTimes===0&&this._releaseProgram(i.computeProgram)):(i.fragmentProgram.usedTimes--,i.vertexProgram.usedTimes--,i.vertexProgram.usedTimes===0&&this._releaseProgram(i.vertexProgram),i.fragmentProgram.usedTimes===0&&this._releaseProgram(i.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,i,r,s){r=r||this._getComputeCacheKey(e,i);let n=this.caches.get(r);return n===void 0&&(n=new ani(r,i),this.caches.set(r,n),this.backend.createComputePipeline(n,s)),n}_getRenderPipeline(e,i,r,s,n){s=s||this._getRenderCacheKey(e,i,r);let o=this.caches.get(s);return o===void 0&&(o=new nni(s,i,r),this.caches.set(s,o),e.pipeline=o,this.backend.createRenderPipeline(e,n)),o}_getComputeCacheKey(e,i){return e.id+","+i.id}_getRenderCacheKey(e,i,r){return i.id+","+r.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const i=e.code,r=e.stage;this.programs[r].delete(i)}_needsComputeUpdate(e){const i=this.get(e);return i.pipeline===void 0||i.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}const hni=uni;class dni extends YC{constructor(e,i,r,s,n,o){super(),this.backend=e,this.textures=r,this.pipelines=n,this.attributes=s,this.nodes=i,this.info=o,this.pipelines.bindings=this}getForRender(e){const i=e.getBindings(),r=this.get(e);return r.bindings!==i&&(r.bindings=i,this._init(i),this.backend.createBindings(i)),r.bindings}getForCompute(e){const i=this.get(e);if(i.bindings===void 0){const s=this.nodes.getForCompute(e).bindings;i.bindings=s,this._init(s),this.backend.createBindings(s)}return i.bindings}updateForCompute(e){this._update(e,this.getForCompute(e))}updateForRender(e){this._update(e,this.getForRender(e))}_init(e){for(const i of e)if(i.isSampledTexture)this.textures.updateTexture(i.texture);else if(i.isStorageBuffer){const r=i.attribute;this.attributes.update(r,hO.STORAGE)}}_update(e,i){const{backend:r}=this;let s=!1;for(const n of i)if(!(n.isNodeUniformsGroup&&!this.nodes.updateGroup(n))){if(n.isUniformBuffer)n.update()&&r.updateBinding(n);else if(n.isSampler)n.update();else if(n.isSampledTexture){const o=n.texture;n.needsBindingsUpdate&&(s=!0);const a=n.update();a&&this.textures.updateTexture(n.texture);const l=r.get(n.texture);if(r.isWebGPUBackend===!0&&l.texture===void 0&&l.externalTexture===void 0&&(console.error("Bindings._update: binding should be available:",n,a,n.texture,n.textureNode.value),this.textures.updateTexture(n.texture),s=!0),o.isStorageTexture===!0){const c=this.get(o);n.store===!0?c.needsMipmap=!0:o.generateMipmaps===!0&&this.textures.needsMipmaps(o)&&c.needsMipmap===!0&&(this.backend.generateMipmaps(o),c.needsMipmap=!1)}}}if(s===!0){const n=this.pipelines.getForRender(e);this.backend.updateBindings(i,n)}}}const pni=dni;function fni(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function mni(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}class gni{constructor(){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparent=[],this.bundles=[],this.lightsNode=new q7e([]),this.lightsArray=[],this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,i,r,s,n,o){let a=this.renderItems[this.renderItemsIndex];return a===void 0?(a={id:e.id,object:e,geometry:i,material:r,groupOrder:s,renderOrder:e.renderOrder,z:n,group:o},this.renderItems[this.renderItemsIndex]=a):(a.id=e.id,a.object=e,a.geometry=i,a.material=r,a.groupOrder=s,a.renderOrder=e.renderOrder,a.z=n,a.group=o),this.renderItemsIndex++,a}push(e,i,r,s,n,o){const a=this.getNextRenderItem(e,i,r,s,n,o);e.occlusionTest===!0&&this.occlusionQueryCount++,(r.transparent===!0||r.transmission>0?this.transparent:this.opaque).push(a)}unshift(e,i,r,s,n,o){const a=this.getNextRenderItem(e,i,r,s,n,o);(r.transparent===!0?this.transparent:this.opaque).unshift(a)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}getLightsNode(){return this.lightsNode.fromLights(this.lightsArray)}sort(e,i){this.opaque.length>1&&this.opaque.sort(e||fni),this.transparent.length>1&&this.transparent.sort(i||mni)}finish(){this.lightsNode.fromLights(this.lightsArray);for(let e=this.renderItemsIndex,i=this.renderItems.length;e<i;e++){const r=this.renderItems[e];if(r.id===null)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.groupOrder=null,r.renderOrder=null,r.z=null,r.group=null}}}const yni=gni;class _ni{constructor(){this.lists=new Qv}get(e,i){const r=this.lists,s=[e,i];let n=r.get(s);return n===void 0&&(n=new yni,r.set(s,n)),n}dispose(){this.lists=new Qv}}const vni=_ni;let bni=0;class wni{constructor(){this.id=bni++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new Fs,this.scissor=!1,this.scissorValue=new Fs,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.sampleCount=1,this.width=0,this.height=0,this.isRenderContext=!0}}const xni=wni;class Sni{constructor(){this.chainMaps={}}get(e,i,r=null){const s=[e,i];let n;if(r===null)n="default";else{const l=r.texture.format;n=`${r.count}:${l}:${r.samples}:${r.depthBuffer}:${r.stencilBuffer}`}const o=this.getChainMap(n);let a=o.get(s);return a===void 0&&(a=new xni,o.set(s,a)),r!==null&&(a.sampleCount=r.samples===0?1:r.samples),a}getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Qv)}dispose(){this.chainMaps={}}}const Tni=Sni,Eni=new ve;class Cni extends YC{constructor(e,i,r){super(),this.renderer=e,this.backend=i,this.info=r}updateRenderTarget(e,i=0){const r=this.get(e),s=e.samples===0?1:e.samples,n=r.depthTextureMips||(r.depthTextureMips={}),o=e.texture,a=e.textures,l=this.getSize(o),c=l.width>>i,u=l.height>>i;let h=e.depthTexture||n[i],p=!1;h===void 0&&(h=new h$,h.format=e.stencilBuffer?bI:bE,h.type=e.stencilBuffer?D4:xd,h.image.width=c,h.image.height=u,n[i]=h),(r.width!==l.width||l.height!==r.height)&&(p=!0,h.needsUpdate=!0,h.image.width=c,h.image.height=u),r.width=l.width,r.height=l.height,r.textures=a,r.depthTexture=h,r.depth=e.depthBuffer,r.stencil=e.stencilBuffer,r.renderTarget=e,r.sampleCount!==s&&(p=!0,h.needsUpdate=!0,r.sampleCount=s);const f={sampleCount:s};for(let g=0;g<a.length;g++){const y=a[g];p&&(y.needsUpdate=!0),this.updateTexture(y,f)}if(this.updateTexture(h,f),r.initialized!==!0){r.initialized=!0;const g=()=>{if(e.removeEventListener("dispose",g),a!==void 0)for(let y=0;y<a.length;y++)this._destroyTexture(a[y]);else this._destroyTexture(o);this._destroyTexture(h)};e.addEventListener("dispose",g)}}updateTexture(e,i={}){const r=this.get(e);if(r.initialized===!0&&r.version===e.version)return;const s=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,n=this.backend;if(s&&r.initialized===!0&&(n.destroySampler(e),n.destroyTexture(e)),e.isFramebufferTexture){const u=this.renderer.getRenderTarget();u?e.type=u.texture.type:e.type=G2}const{width:o,height:a,depth:l}=this.getSize(e);if(i.width=o,i.height=a,i.depth=l,i.needsMipmaps=this.needsMipmaps(e),i.levels=i.needsMipmaps?this.getMipLevels(e,o,a):1,s||e.isStorageTexture===!0)n.createSampler(e),n.createTexture(e,i);else if(r.initialized!==!0&&n.createSampler(e),e.version>0){const u=e.image;if(u===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(u.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const h=[];for(const p of e.images)h.push(p);i.images=h}else i.image=u;(r.isDefaultTexture===void 0||r.isDefaultTexture===!0)&&(n.createTexture(e,i),r.isDefaultTexture=!1),e.source.dataReady===!0&&n.updateTexture(e,i),i.needsMipmaps&&e.mipmaps.length===0&&n.generateMipmaps(e)}}else n.createDefaultTexture(e),r.isDefaultTexture=!0;if(r.initialized!==!0){r.initialized=!0,this.info.memory.textures++;const c=()=>{e.removeEventListener("dispose",c),this._destroyTexture(e),this.info.memory.textures--};e.addEventListener("dispose",c)}r.version=e.version}getSize(e,i=Eni){let r=e.images?e.images[0]:e.image;return r?(r.image!==void 0&&(r=r.image),i.width=r.width,i.height=r.height,i.depth=e.isCubeTexture?6:r.depth||1):i.width=i.height=i.depth=1,i}getMipLevels(e,i,r){let s;return e.isCompressedTexture?s=e.mipmaps.length:s=Math.floor(Math.log2(Math.max(i,r)))+1,s}needsMipmaps(e){return this.isEnvironmentTexture(e)?!0:e.isCompressedTexture===!0||e.minFilter!==za&&e.minFilter!==yf}isEnvironmentTexture(e){const i=e.mapping;return i===lfe||i===cfe||i===uk||i===$H}_destroyTexture(e){this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e)}}const Mni=Cni;class Ani extends ds{constructor(e,i,r,s=1){super(e,i,r),this.a=s}set(e,i,r,s=1){return this.a=s,super.set(e,i,r)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}const Wfe=Ani,Zf=new Wfe;class Rni extends YC{constructor(e,i){super(),this.renderer=e,this.nodes=i}update(e,i,r){const s=this.renderer,n=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(n===null)s._clearColor.getRGB(Zf,wg),Zf.a=s._clearColor.a;else if(n.isColor===!0)n.getRGB(Zf,wg),Zf.a=1,o=!0;else if(n.isNode===!0){const a=this.get(e),l=n;Zf.copy(s._clearColor);let c=a.backgroundMesh;if(c===void 0){const h=p0(Ft(l).mul(AMe),{getUV:()=>Lfe,getTextureLevel:()=>cii});let p=jae();p=p.setZ(p.w);const f=new Ea;f.side=m1,f.depthTest=!1,f.depthWrite=!1,f.fog=!1,f.vertexNode=p,f.fragmentNode=h,a.backgroundMeshNode=h,a.backgroundMesh=c=new eS(new vfe(1,32,32),f),c.frustumCulled=!1,c.onBeforeRender=function(g,y,v){this.matrixWorld.copyPosition(v.matrixWorld)}}const u=l.getCacheKey();a.backgroundCacheKey!==u&&(a.backgroundMeshNode.node=Ft(l).mul(AMe),c.material.needsUpdate=!0,a.backgroundCacheKey=u),i.unshift(c,c.geometry,c.material,0,0,null)}else console.error("THREE.Renderer: Unsupported background configuration.",n);if(s.autoClear===!0||o===!0){Zf.multiplyScalar(Zf.a);const a=r.clearColorValue;a.r=Zf.r,a.g=Zf.g,a.b=Zf.b,a.a=Zf.a,r.depthClearValue=s._clearDepth,r.stencilClearValue=s._clearStencil,r.clearColor=s.autoClearColor===!0,r.clearDepth=s.autoClearDepth===!0,r.clearStencil=s.autoClearStencil===!0}else r.clearColor=!1,r.clearDepth=!1,r.clearStencil=!1}}const Pni=Rni;class Oni{constructor(e,i,r,s,n,o,a,l=[]){this.vertexShader=e,this.fragmentShader=i,this.computeShader=r,this.transforms=l,this.nodeAttributes=s,this.bindings=n,this.updateNodes=o,this.updateBeforeNodes=a,this.usedTimes=0}createBindings(){const e=[];for(const i of this.bindings){let r=i;i.shared!==!0&&(r=i.clone()),e.push(r)}return e}}const Ini=Oni;class $ni extends YC{constructor(e,i){super(),this.renderer=e,this.backend=i,this.nodeFrame=new xMe,this.nodeBuilderCache=new Map,this.callHashCache=new Qv,this.groupsData=new Qv}updateGroup(e){const i=e.groupNode,r=i.name;if(r===c7e.name)return!0;if(r===hKt.name){const o=this.get(e),a=this.nodeFrame.renderId;return o.renderId!==a?(o.renderId=a,!0):!1}if(r===uKt.name){const o=this.get(e),a=this.nodeFrame.frameId;return o.frameId!==a?(o.frameId=a,!0):!1}const s=[i,e];let n=this.groupsData.get(s);return n===void 0&&this.groupsData.set(s,n={}),n.version!==i.version?(n.version=i.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const i=this.get(e);let r=i.nodeBuilderState;if(r===void 0){const{nodeBuilderCache:s}=this,n=this.getForRenderCacheKey(e);if(r=s.get(n),r===void 0){const o=this.backend.createNodeBuilder(e.object,this.renderer,e.scene);o.material=e.material,o.context.material=e.material,o.lightsNode=e.lightsNode,o.environmentNode=this.getEnvironmentNode(e.scene),o.fogNode=this.getFogNode(e.scene),o.clippingContext=e.clippingContext,o.build(),r=this._createNodeBuilderState(o),s.set(n,r)}r.usedTimes++,i.nodeBuilderState=r}return r}delete(e){if(e.isRenderObject){const i=this.get(e).nodeBuilderState;i.usedTimes--,i.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const i=this.get(e);let r=i.nodeBuilderState;if(r===void 0){const s=this.backend.createNodeBuilder(e,this.renderer);s.build(),r=this._createNodeBuilderState(s),i.nodeBuilderState=r}return r}_createNodeBuilderState(e){return new Ini(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.transforms)}getEnvironmentNode(e){return e.environmentNode||this.get(e).environmentNode||null}getBackgroundNode(e){return e.backgroundNode||this.get(e).backgroundNode||null}getFogNode(e){return e.fogNode||this.get(e).fogNode||null}getCacheKey(e,i){const r=[e,i],s=this.renderer.info.calls;let n=this.callHashCache.get(r);if(n===void 0||n.callId!==s){const o=this.getEnvironmentNode(e),a=this.getFogNode(e),l=[];i&&l.push(i.getCacheKey()),o&&l.push(o.getCacheKey()),a&&l.push(a.getCacheKey()),n={callId:s,cacheKey:l.join(",")},this.callHashCache.set(r,n)}return n.cacheKey}updateScene(e){this.updateEnvironment(e),this.updateFog(e),this.updateBackground(e)}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const i=this.get(e),r=e.background;if(r){if(i.background!==r){let s=null;r.isCubeTexture===!0||r.mapping===lfe||r.mapping===cfe?s=J7e(r,Lfe):r.isTexture===!0?s=xa(r,fti).setUpdateMatrix(!0):r.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",r),i.backgroundNode=s,i.background=r}}else i.backgroundNode&&(delete i.backgroundNode,delete i.background)}updateFog(e){const i=this.get(e),r=e.fog;if(r){if(i.fog!==r){let s=null;r.isFogExp2?s=WWe(Hc("color","color",r),Hc("density","float",r)):r.isFog?s=HWe(Hc("color","color",r),Hc("near","float",r),Hc("far","float",r)):console.error("WebGPUNodes: Unsupported fog configuration.",r),i.fogNode=s,i.fog=r}}else delete i.fogNode,delete i.fog}updateEnvironment(e){const i=this.get(e),r=e.environment;if(r){if(i.environment!==r){let s=null;r.isCubeTexture===!0?s=rW(r):r.isTexture===!0?s=xa(r):console.error("Nodes: Unsupported environment configuration.",r),i.environmentNode=s,i.environment=r}}else i.environmentNode&&(delete i.environmentNode,delete i.environment)}getNodeFrame(e=this.renderer,i=null,r=null,s=null,n=null){const o=this.nodeFrame;return o.renderer=e,o.scene=i,o.object=r,o.camera=s,o.material=n,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputNode(e){let i=xa(e,SI);return this.isToneMappingState&&(this.renderer.toneMappingNode?i=Ft(this.renderer.toneMappingNode.context({color:i.rgb}),i.a):this.renderer.toneMapping!==Tx&&(i=i.toneMapping(this.renderer.toneMapping))),this.renderer.currentColorSpace===di&&(i=i.linearToColorSpace(this.renderer.currentColorSpace)),i}updateBefore(e){const i=this.getNodeFrameForRender(e),r=e.getNodeBuilderState();for(const s of r.updateBeforeNodes)i.updateBeforeNode(s)}updateForCompute(e){const i=this.getNodeFrame(),r=this.getForCompute(e);for(const s of r.updateNodes)i.updateNode(s)}updateForRender(e){const i=this.getNodeFrameForRender(e),r=e.getNodeBuilderState();for(const s of r.updateNodes)i.updateNode(s)}dispose(){super.dispose(),this.nodeFrame=new xMe,this.nodeBuilderCache=new Map}}const Nni=$ni;class Lni{constructor(e,i){this.scene=e,this.camera=i}clone(){return Object.assign(new this.constructor,this)}}const Dni=Lni;class Fni{constructor(){this.lists=new Qv}get(e,i){const r=this.lists,s=[e,i];let n=r.get(s);return n===void 0&&(n=new Dni(e,i),r.set(s,n)),n}dispose(){this.lists=new Qv}}const kni=Fni,VMe=new yfe,Gz=new Xi,UQ=new Fs,BQ=new C9e,jz=new kn,z3=new ve,TA=new W4(new Ea);class Uni{constructor(e,i={}){this.isRenderer=!0;const{logarithmicDepthBuffer:r=!1,alpha:s=!0}=i;this.domElement=e.getDomElement(),this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=s,this.logarithmicDepthBuffer=r,this.outputColorSpace=di,this.toneMapping=Tx,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=!0,this.stencil=!1,this.clippingPlanes=[],this.info=new ini,this.toneMappingNode=null,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new Fs(0,0,this._width,this._height),this._scissor=new Fs(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const n=this.alpha===!0?0:1;this._clearColor=new Wfe(0,0,0,n),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.shadowMap={enabled:!1,type:null},this.xr={enabled:!1}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,i)=>{const r=this.backend;try{await r.init(this)}catch(s){i(s);return}this._nodes=new Nni(this,r),this._animation=new Bsi(this._nodes,this.info),this._attributes=new Jsi(r),this._background=new Pni(this,this._nodes),this._geometries=new eni(this._attributes,this.info),this._textures=new Mni(this,r,this.info),this._pipelines=new hni(r,this._nodes),this._bindings=new pni(r,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new qsi(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new vni,this._bundles=new kni,this._renderContexts=new Tni,this._initialized=!0,e()}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,i,r=null){this._initialized===!1&&await this.init();const s=this._nodes.nodeFrame,n=s.renderId,o=this._currentRenderContext,a=this._currentRenderObjectFunction,l=this._compilationPromises,c=e.isScene===!0?e:VMe;r===null&&(r=e);const u=this._renderTarget,h=this._renderContexts.get(r,i,u),p=this._activeMipmapLevel,f=[];this._currentRenderContext=h,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=f,s.renderId++,s.update(),h.depth=this.depth,h.stencil=this.stencil,h.clippingContext||(h.clippingContext=new ile),h.clippingContext.updateGlobal(this,i),c.onBeforeRender(this,e,i,u);const g=this._renderLists.get(e,i);if(g.begin(),this._projectObject(e,i,0,g),r!==e&&r.traverseVisible(function(w){w.isLight&&w.layers.test(i.layers)&&g.pushLight(w)}),g.finish(),u!==null){this._textures.updateRenderTarget(u,p);const w=this._textures.get(u);h.textures=w.textures,h.depthTexture=w.depthTexture}else h.textures=null,h.depthTexture=null;this._nodes.updateScene(c),this._background.update(c,g,h);const y=g.opaque,v=g.transparent,b=g.lightsNode;y.length>0&&this._renderObjects(y,i,c,b),v.length>0&&this._renderObjects(v,i,c,b),s.renderId=n,this._currentRenderContext=o,this._currentRenderObjectFunction=a,this._compilationPromises=l,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(f)}async renderAsync(e,i){this._initialized===!1&&await this.init();const r=this._renderScene(e,i);await this.backend.resolveTimestampAsync(r,"render")}_renderBundle(e,i,r){const{object:s,camera:n,renderList:o}=e,a=this._currentRenderContext,l=this.backend.get(a),c=this._bundles.get(s,n),u=this.backend.get(c);u.renderContexts===void 0&&(u.renderContexts=new Set);const h=u.renderContexts.has(a)===!1||s.needsUpdate===!0;if(u.renderContexts.add(a),h){if(l.renderObjects===void 0||s.needsUpdate===!0){const f=this._nodes.nodeFrame;l.renderObjects=[],l.renderBundles=[],l.scene=i,l.camera=n,l.renderId=f.renderId,l.registerBundlesPhase=!0}this._currentRenderBundle=c;const p=o.opaque;p.length>0&&this._renderObjects(p,n,i,r),this._currentRenderBundle=null,s.needsUpdate=!1}else{const p=this._currentRenderContext,f=this.backend.get(p);for(let g=0,y=f.renderObjects.length;g<y;g++){const v=f.renderObjects[g];this._nodes.updateBefore(v),v.object.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,v.object.matrixWorld),v.object.normalMatrix.getNormalMatrix(v.object.modelViewMatrix),this._nodes.updateForRender(v),this._bindings.updateForRender(v),this.backend.draw(v,this.info)}}}render(e,i){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,i);this._renderScene(e,i)}_getFrameBufferTarget(){const{currentColorSpace:e}=this;if((this._renderTarget===null&&(this.toneMapping!==Tx||this.toneMappingNode!==null))===!1&&(e!==wg&&e!==F4)===!1)return null;const{width:s,height:n}=this.getDrawingBufferSize(Gz),{depth:o,stencil:a}=this;let l=this._frameBufferTarget;return l===null&&(l=new xg(s,n,{depthBuffer:o,stencilBuffer:a,type:vE,format:u$,colorSpace:wg,generateMipmaps:!1,minFilter:yf,magFilter:yf,samples:this.backend.parameters.antialias?4:0}),l.isPostProcessingRenderTarget=!0,this._frameBufferTarget=l),l.depthBuffer=o,l.stencilBuffer=a,l.setSize(s,n),l.viewport.copy(this._viewport),l.scissor.copy(this._scissor),l.viewport.multiplyScalar(this._pixelRatio),l.scissor.multiplyScalar(this._pixelRatio),l.scissorTest=this._scissorTest,l}_renderScene(e,i,r=!0){const s=r?this._getFrameBufferTarget():null,n=this._nodes.nodeFrame,o=n.renderId,a=this._currentRenderContext,l=this._currentRenderObjectFunction,c=e.isScene===!0?e:VMe,u=this._renderTarget,h=this._activeCubeFace,p=this._activeMipmapLevel;let f;s!==null?(f=s,this.setRenderTarget(f)):f=u;const g=this._renderContexts.get(e,i,f);this._currentRenderContext=g,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,n.renderId=this.info.calls;const y=this.coordinateSystem;i.coordinateSystem!==y&&(i.coordinateSystem=y,i.updateProjectionMatrix()),e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),i.parent===null&&i.matrixWorldAutoUpdate===!0&&i.updateMatrixWorld();let v=this._viewport,b=this._scissor,w=this._pixelRatio;f!==null&&(v=f.viewport,b=f.scissor,w=1),this.getDrawingBufferSize(Gz),UQ.set(0,0,Gz.width,Gz.height);const x=v.minDepth===void 0?0:v.minDepth,S=v.maxDepth===void 0?1:v.maxDepth;g.viewportValue.copy(v).multiplyScalar(w).floor(),g.viewportValue.width>>=p,g.viewportValue.height>>=p,g.viewportValue.minDepth=x,g.viewportValue.maxDepth=S,g.viewport=g.viewportValue.equals(UQ)===!1,g.scissorValue.copy(b).multiplyScalar(w).floor(),g.scissor=this._scissorTest&&g.scissorValue.equals(UQ)===!1,g.scissorValue.width>>=p,g.scissorValue.height>>=p,g.clippingContext||(g.clippingContext=new ile),g.clippingContext.updateGlobal(this,i),c.onBeforeRender(this,e,i,f),jz.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),BQ.setFromProjectionMatrix(jz,y);const E=this._renderLists.get(e,i);if(E.begin(),this._projectObject(e,i,0,E),E.finish(),this.sortObjects===!0&&E.sort(this._opaqueSort,this._transparentSort),f!==null){this._textures.updateRenderTarget(f,p);const D=this._textures.get(f);g.textures=D.textures,g.depthTexture=D.depthTexture,g.width=D.width,g.height=D.height,g.renderTarget=f,g.depth=f.depthBuffer,g.stencil=f.stencilBuffer}else g.textures=null,g.depthTexture=null,g.width=this.domElement.width,g.height=this.domElement.height,g.depth=this.depth,g.stencil=this.stencil;g.width>>=p,g.height>>=p,g.activeCubeFace=h,g.activeMipmapLevel=p,g.occlusionQueryCount=E.occlusionQueryCount,this._nodes.updateScene(c),this._background.update(c,E,g),this.backend.beginRender(g);const C=E.opaque,R=E.transparent,I=E.bundles,F=E.lightsNode;return I.length>0&&this._renderBundles(I,c,F),C.length>0&&this._renderObjects(C,i,c,F),R.length>0&&this._renderObjects(R,i,c,F),this.backend.finishRender(g),n.renderId=o,this._currentRenderContext=a,this._currentRenderObjectFunction=l,s!==null&&(this.setRenderTarget(u,h,p),TA.material.fragmentNode=this._nodes.getOutputNode(f.texture),this._renderScene(TA,TA.camera,!1)),c.onAfterRender(this,e,i,f),g}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio=e,this.setSize(this._width,this._height,!1)}setDrawingBufferSize(e,i,r){this._width=e,this._height=i,this._pixelRatio=r,this.domElement.width=Math.floor(e*r),this.domElement.height=Math.floor(i*r),this.setViewport(0,0,e,i),this._initialized&&this.backend.updateSize()}setSize(e,i,r=!0){this._width=e,this._height=i,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(i*this._pixelRatio),r===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=i+"px"),this.setViewport(0,0,e,i),this._initialized&&this.backend.updateSize()}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const i=this._scissor;return e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height,e}setScissor(e,i,r,s){const n=this._scissor;e.isVector4?n.copy(e):n.set(e,i,r,s)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,i,r,s,n=0,o=1){const a=this._viewport;e.isVector4?a.copy(e):a.set(e,i,r,s),a.minDepth=n,a.maxDepth=o}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,i=1){this._clearColor.set(e),this._clearColor.a=i}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const i=this._currentRenderContext;return i&&this.backend.isOccluded(i,e)}clear(e=!0,i=!0,r=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,i,r);const s=this._renderTarget||this._getFrameBufferTarget();let n=null;s!==null&&(this._textures.updateRenderTarget(s),n=this._textures.get(s)),this.backend.clear(e,i,r,n),s!==null&&this._renderTarget===null&&(TA.material.fragmentNode=this._nodes.getOutputNode(s.texture),this._renderScene(TA,TA.camera,!1))}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,i=!0,r=!0){this._initialized===!1&&await this.init(),this.clear(e,i,r)}clearColorAsync(){return this.clearAsync(!0,!1,!1)}clearDepthAsync(){return this.clearAsync(!1,!0,!1)}clearStencilAsync(){return this.clearAsync(!1,!1,!0)}get currentColorSpace(){const e=this._renderTarget;if(e!==null){const i=e.texture;return(Array.isArray(i)?i[0]:i).colorSpace}return this.outputColorSpace}dispose(){this.info.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,i=0,r=0){this._renderTarget=e,this._activeCubeFace=i,this._activeMipmapLevel=r}getRenderTarget(){return this._renderTarget}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}async computeAsync(e){this._initialized===!1&&await this.init();const i=this._nodes.nodeFrame,r=i.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.computeCalls++,i.renderId=this.info.calls;const s=this.backend,n=this._pipelines,o=this._bindings,a=this._nodes,l=Array.isArray(e)?e:[e];if(l[0]===void 0||l[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");s.beginCompute(e);for(const c of l){if(n.has(c)===!1){const p=()=>{c.removeEventListener("dispose",p),n.delete(c),o.delete(c),a.delete(c)};c.addEventListener("dispose",p),c.onInit({renderer:this})}a.updateForCompute(c),o.updateForCompute(c);const u=o.getForCompute(c),h=n.getForCompute(c,u);s.compute(e,c,u,h)}s.finishCompute(e),await this.backend.resolveTimestampAsync(e,"compute"),i.renderId=r}async hasFeatureAsync(e){return this._initialized===!1&&await this.init(),this.backend.hasFeature(e)}hasFeature(e){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}copyFramebufferToTexture(e){const i=this._currentRenderContext;this._textures.updateTexture(e),this.backend.copyFramebufferToTexture(e,i)}copyTextureToTexture(e,i,r=null,s=null,n=0){this._textures.updateTexture(e),this._textures.updateTexture(i),this.backend.copyTextureToTexture(e,i,r,s,n)}readRenderTargetPixelsAsync(e,i,r,s,n,o=0){return this.backend.copyTextureToBuffer(e.textures[o],i,r,s,n)}_projectObject(e,i,r,s){if(e.visible===!1)return;if(e.layers.test(i.layers)){if(e.isGroup)r=e.renderOrder;else if(e.isLOD)e.autoUpdate===!0&&e.update(i);else if(e.isLight)s.pushLight(e);else if(e.isSprite){if(!e.frustumCulled||BQ.intersectsSprite(e)){this.sortObjects===!0&&z3.setFromMatrixPosition(e.matrixWorld).applyMatrix4(jz);const a=e.geometry,l=e.material;l.visible&&s.push(e,a,l,r,z3.z,null)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||BQ.intersectsObject(e))){const a=e.geometry,l=e.material;if(this.sortObjects===!0&&(a.boundingSphere===null&&a.computeBoundingSphere(),z3.copy(a.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(jz)),Array.isArray(l)){const c=a.groups;for(let u=0,h=c.length;u<h;u++){const p=c[u],f=l[p.materialIndex];f&&f.visible&&s.push(e,a,f,r,z3.z,p)}}else l.visible&&s.push(e,a,l,r,z3.z,null)}}if(e.static===!0){const a=s;s=this._renderLists.get(e,i),s.begin(),a.pushBundle({object:e,camera:i,renderList:s}),s.finish()}const o=e.children;for(let a=0,l=o.length;a<l;a++)this._projectObject(o[a],i,r,s)}_renderBundles(e,i,r){for(const s of e)this._renderBundle(s,i,r)}_renderObjects(e,i,r,s){for(let n=0,o=e.length;n<o;n++){const a=e[n],{object:l,geometry:c,material:u,group:h}=a;if(i.isArrayCamera){const p=i.cameras;for(let f=0,g=p.length;f<g;f++){const y=p[f];if(l.layers.test(y.layers)){const v=y.viewport,b=v.minDepth===void 0?0:v.minDepth,w=v.maxDepth===void 0?1:v.maxDepth,x=this._currentRenderContext.viewportValue;x.copy(v).multiplyScalar(this._pixelRatio).floor(),x.minDepth=b,x.maxDepth=w,this.backend.updateViewport(this._currentRenderContext),this._currentRenderObjectFunction(l,r,y,c,u,h,s)}}}else this._currentRenderObjectFunction(l,r,i,c,u,h,s)}}renderObject(e,i,r,s,n,o,a){let l,c,u;if(e.onBeforeRender(this,i,r,s,n,o),n.onBeforeRender(this,i,r,s,n,o),i.overrideMaterial!==null){const h=i.overrideMaterial;n.positionNode&&n.positionNode.isNode&&(l=h.positionNode,h.positionNode=n.positionNode),h.isShadowNodeMaterial&&(h.side=n.shadowSide===null?n.side:n.shadowSide,n.depthNode&&n.depthNode.isNode&&(u=h.depthNode,h.depthNode=n.depthNode),n.shadowNode&&n.shadowNode.isNode&&(c=h.fragmentNode,h.fragmentNode=n.shadowNode),this.localClippingEnabled&&(n.clipShadows?(h.clippingPlanes!==n.clippingPlanes&&(h.clippingPlanes=n.clippingPlanes,h.needsUpdate=!0),h.clipIntersection!==n.clipIntersection&&(h.clipIntersection=n.clipIntersection)):Array.isArray(h.clippingPlanes)&&(h.clippingPlanes=null,h.needsUpdate=!0))),n=h}n.transparent===!0&&n.side===MH&&n.forceSinglePass===!1?(n.side=m1,this._handleObjectFunction(e,n,i,r,a,o,"backSide"),n.side=lk,this._handleObjectFunction(e,n,i,r,a,o),n.side=MH):this._handleObjectFunction(e,n,i,r,a,o),l!==void 0&&(i.overrideMaterial.positionNode=l),u!==void 0&&(i.overrideMaterial.depthNode=u),c!==void 0&&(i.overrideMaterial.fragmentNode=c),e.onAfterRender(this,i,r,s,n,o)}_renderObjectDirect(e,i,r,s,n,o,a){const l=this._objects.get(e,i,r,s,n,this._currentRenderContext,a);if(l.drawRange=o||e.geometry.drawRange,this._nodes.updateBefore(l),e.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),this._nodes.updateForRender(l),this._geometries.updateForRender(l),this._bindings.updateForRender(l),this._pipelines.updateForRender(l),this._currentRenderBundle!==null&&this._currentRenderBundle.needsUpdate===!0){const c=this.backend.get(l);c.bundleEncoder=void 0,c.lastPipelineGPU=void 0}this.backend.draw(l,this.info),this._currentRenderBundle!==null&&this.backend.get(this._currentRenderContext).renderObjects.push(l)}_createObjectPipeline(e,i,r,s,n,o){const a=this._objects.get(e,i,r,s,n,this._currentRenderContext,o);this._nodes.updateBefore(a),this._nodes.updateForRender(a),this._geometries.updateForRender(a),this._bindings.updateForRender(a),this._pipelines.getForRender(a,this._compilationPromises)}get compute(){return this.computeAsync}get compile(){return this.compileAsync}}const Bni=Uni;class zni{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}const Yfe=zni;function Vni(t){return t+(fw-t%fw)%fw}class Gni extends Yfe{constructor(e,i=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=i}get byteLength(){return Vni(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}const XYe=Gni;class jni extends XYe{constructor(e,i=null){super(e,i),this.isUniformBuffer=!0}}const ZYe=jni;let Hni=0;class qni extends ZYe{constructor(e){super("UniformBuffer_"+Hni++,e?e.value:null),this.nodeUniform=e}get buffer(){return this.nodeUniform.value}}const JYe=qni;class Wni extends ZYe{constructor(e){super(e),this.isUniformsGroup=!0,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const i=this.uniforms.indexOf(e);return i!==-1&&this.uniforms.splice(i,1),this}get buffer(){let e=this._buffer;if(e===null){const i=this.byteLength;e=new Float32Array(new ArrayBuffer(i)),this._buffer=e}return e}get byteLength(){let e=0;for(let i=0,r=this.uniforms.length;i<r;i++){const s=this.uniforms[i],{boundary:n,itemSize:o}=s,a=e%fw,l=fw-a;a!==0&&l-n<0?e+=fw-a:a%n!==0&&(e+=a%n),s.offset=e/this.bytesPerElement,e+=o*this.bytesPerElement}return Math.ceil(e/fw)*fw}update(){let e=!1;for(const i of this.uniforms)this.updateByType(i)===!0&&(e=!0);return e}updateByType(e){if(e.isFloatUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let i=!1;const r=this.buffer,s=e.getValue(),n=e.offset;return r[n]!==s&&(r[n]=s,i=!0),i}updateVector2(e){let i=!1;const r=this.buffer,s=e.getValue(),n=e.offset;return(r[n+0]!==s.x||r[n+1]!==s.y)&&(r[n+0]=s.x,r[n+1]=s.y,i=!0),i}updateVector3(e){let i=!1;const r=this.buffer,s=e.getValue(),n=e.offset;return(r[n+0]!==s.x||r[n+1]!==s.y||r[n+2]!==s.z)&&(r[n+0]=s.x,r[n+1]=s.y,r[n+2]=s.z,i=!0),i}updateVector4(e){let i=!1;const r=this.buffer,s=e.getValue(),n=e.offset;return(r[n+0]!==s.x||r[n+1]!==s.y||r[n+2]!==s.z||r[n+4]!==s.w)&&(r[n+0]=s.x,r[n+1]=s.y,r[n+2]=s.z,r[n+3]=s.w,i=!0),i}updateColor(e){let i=!1;const r=this.buffer,s=e.getValue(),n=e.offset;return(r[n+0]!==s.r||r[n+1]!==s.g||r[n+2]!==s.b)&&(r[n+0]=s.r,r[n+1]=s.g,r[n+2]=s.b,i=!0),i}updateMatrix3(e){let i=!1;const r=this.buffer,s=e.getValue().elements,n=e.offset;return(r[n+0]!==s[0]||r[n+1]!==s[1]||r[n+2]!==s[2]||r[n+4]!==s[3]||r[n+5]!==s[4]||r[n+6]!==s[5]||r[n+8]!==s[6]||r[n+9]!==s[7]||r[n+10]!==s[8])&&(r[n+0]=s[0],r[n+1]=s[1],r[n+2]=s[2],r[n+4]=s[3],r[n+5]=s[4],r[n+6]=s[5],r[n+8]=s[6],r[n+9]=s[7],r[n+10]=s[8],i=!0),i}updateMatrix4(e){let i=!1;const r=this.buffer,s=e.getValue().elements,n=e.offset;return Yni(r,s,n)===!1&&(r.set(s,n),i=!0),i}}function Yni(t,e,i){for(let r=0,s=e.length;r<s;r++)if(t[i+r]!==e[r])return!1;return!0}const Xni=Wni;let Zni=0;class Jni extends Xni{constructor(e,i){super(e),this.id=Zni++,this.groupNode=i,this.isNodeUniformsGroup=!0}get shared(){return this.groupNode.shared}getNodes(){const e=[];for(const i of this.uniforms){const r=i.nodeUniform.node;if(!r)throw new Error("NodeUniformsGroup: Uniform has no node.");e.push(r)}return e}}const QYe=Jni;let Qni=0;class Kni extends Yfe{constructor(e,i){super(e),this.id=Qni++,this.texture=i,this.version=i?i.version:0,this.store=!1,this.isSampledTexture=!0}get needsBindingsUpdate(){const{texture:e,version:i}=this;return e.isVideoTexture?!0:i!==e.version}update(){const{texture:e,version:i}=this;return i!==e.version?(this.version=e.version,!0):!1}}class oW extends Kni{constructor(e,i,r=null){super(e,i?i.value:null),this.textureNode=i,this.access=r}get needsBindingsUpdate(){return this.textureNode.value!==this.texture||super.needsBindingsUpdate}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class KYe extends oW{constructor(e,i,r){super(e,i,r),this.isSampledCubeTexture=!0}}class eXe extends oW{constructor(e,i,r){super(e,i,r),this.isSampledTexture3D=!0}}const eoi={[pe.ATAN2]:"atan",textureDimensions:"textureSize",equals:"equal"},toi={low:"lowp",medium:"mediump",high:"highp"},ioi={instance:!0,swizzleAssign:!0},GMe=`
precision highp float;
precision highp int;
precision highp sampler3D;
precision mediump sampler2DArray;
precision lowp sampler2DShadow;
`;class roi extends uWe{constructor(e,i,r=null){super(e,i,new vsi,r),this.uniformGroups={},this.transforms=[]}getMethod(e){return eoi[e]||e}getPropertyName(e,i){return super.getPropertyName(e,i)}getOutputStructName(){return""}buildFunctionCode(e){const i=e.layout,r=this.flowShaderNode(e),s=[];for(const o of i.inputs)s.push(this.getType(o.type)+" "+o.name);return`${this.getType(i.type)} ${i.name}( ${s.join(", ")} ) {

	${r.vars}

${r.code}
	return ${r.result};

}`}setupPBO(e){const i=e.value;if(i.pbo===void 0){const r=i.array,s=i.count*i.itemSize,{itemSize:n}=i;let o=q7;n===2?o=hfe:n===3?o=ufe:n===4&&(o=u$);const a=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(s/n))));let l=Math.ceil(s/n/a);a*l*n<s&&l++;const c=a*l*n,u=new Float32Array(c);u.set(r,0),i.array=u;const h=new A9e(i.array,a,l,o,Rd);h.needsUpdate=!0,h.isPBOTexture=!0;const p=new tS(h);p.setPrecision("high"),i.pboNode=p,i.pbo=p.value,this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.label)}}generatePBO(e){const{node:i,indexNode:r}=e,s=i.value;if(this.renderer.backend.has(s)){const u=this.renderer.backend.get(s);u.pbo=s.pbo}const n=this.getUniformFromNode(s.pboNode,"texture",this.shaderStage,this.context.label),o=this.getPropertyName(n);r.increaseUsage(this);const a=r.build(this,"uint"),l=this.getDataFromNode(e);let c=l.propertyName;if(c===void 0){const u=this.getVarFromNode(e);c=this.getPropertyName(u);const h=this.getDataFromNode(i);let p=h.propertySizeName;p===void 0&&(p=c+"Size",this.getVarFromNode(i,p,"uint"),this.addLineFlowCode(`${p} = uint( textureSize( ${o}, 0 ).x )`),h.propertySizeName=p);const{itemSize:f}=s,g="."+V4.join("").slice(0,f),y=`ivec2(${a} % ${p}, ${a} / ${p})`,v=this.generateTextureLoad(null,o,y,null,"0");this.addLineFlowCode(`${c} = ${v+g}`),l.propertyName=c}return c}generateTextureLoad(e,i,r,s,n="0"){return s?`texelFetch( ${i}, ivec3( ${r}, ${s} ), ${n} )`:`texelFetch( ${i}, ${r}, ${n} )`}generateTexture(e,i,r,s){return e.isDepthTexture?`texture( ${i}, ${r} ).x`:(s&&(r=`vec3( ${r}, ${s} )`),`texture( ${i}, ${r} )`)}generateTextureLevel(e,i,r,s){return`textureLod( ${i}, ${r}, ${s} )`}generateTextureGrad(e,i,r,s){return`textureGrad( ${i}, ${r}, ${s[0]}, ${s[1]} )`}generateTextureCompare(e,i,r,s,n,o=this.shaderStage){if(o==="fragment")return`texture( ${i}, vec3( ${r}, ${s} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}getVars(e){const i=[],r=this.vars[e];if(r!==void 0)for(const s of r)i.push(`${this.getVar(s.type,s.name)};`);return i.join(`
	`)}getUniforms(e){const i=this.uniforms[e],r=[],s={};for(const o of i){let a=null,l=!1;if(o.type==="texture"){const u=o.node.value;u.compareFunction?a=`sampler2DShadow ${o.name};`:u.isDataArrayTexture===!0?a=`sampler2DArray ${o.name};`:a=`sampler2D ${o.name};`}else if(o.type==="cubeTexture")a=`samplerCube ${o.name};`;else if(o.type==="texture3D")a=`sampler3D ${o.name};`;else if(o.type==="buffer"){const u=o.node,h=this.getType(u.bufferType),p=u.bufferCount,f=p>0?p:"";a=`${u.name} {
	${h} ${o.name}[${f}];
};
`}else a=`${this.getVectorType(o.type)} ${o.name};`,l=!0;const c=o.node.precision;if(c!==null&&(a=toi[c]+" "+a),l){a="	"+a;const u=o.groupNode.name;(s[u]||(s[u]=[])).push(a)}else a="uniform "+a,r.push(a)}let n="";for(const o in s){const a=s[o];n+=this._getGLSLUniformStruct(e+"_"+o,a.join(`
`))+`
`}return n+=r.join(`
`),n}getTypeFromAttribute(e){let i=super.getTypeFromAttribute(e);if(/^[iu]/.test(i)&&e.gpuType!==Im){let r=e;e.isInterleavedBufferAttribute&&(r=e.data);const s=r.array;s instanceof Uint32Array||s instanceof Int32Array||s instanceof Uint16Array||s instanceof Int16Array||(i=i.slice(1))}return i}getAttributes(e){let i="";if(e==="vertex"||e==="compute"){const r=this.getAttributesArray();let s=0;for(const n of r)i+=`layout( location = ${s++} ) in ${n.type} ${n.name};
`}return i}getStructMembers(e){const i=[],r=e.getMemberTypes();for(let s=0;s<r.length;s++){const n=r[s];i.push(`layout( location = ${s} ) out ${n} m${s};`)}return i.join(`
`)}getStructs(e){const i=[],r=this.structs[e];if(r.length===0)return`layout( location = 0 ) out vec4 fragColor;
`;for(let s=0,n=r.length;s<n;s++){const o=r[s];let a=`
`;a+=this.getStructMembers(o),a+=`
`,i.push(a)}return i.join(`

`)}getVaryings(e){let i="";const r=this.varyings;if(e==="vertex"||e==="compute")for(const s of r){e==="compute"&&(s.needsInterpolation=!0);const n=s.type;i+=`${n==="int"||n==="uint"?"flat ":""}${s.needsInterpolation?"out":"/*out*/"} ${n} ${s.name};
`}else if(e==="fragment"){for(const s of r)if(s.needsInterpolation){const n=s.type;i+=`${n==="int"||n==="uint"?"flat ":""}in ${n} ${s.name};
`}}return i}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord"}getFragDepth(){return"gl_FragDepth"}isAvailable(e){return ioi[e]===!0}isFlipY(){return!0}registerTransform(e,i){this.transforms.push({varyingName:e,attributeNode:i})}getTransforms(){const e=this.transforms;let i="";for(let r=0;r<e.length;r++){const s=e[r],n=this.getPropertyName(s.attributeNode);i+=`${s.varyingName} = ${n};
	`}return i}_getGLSLUniformStruct(e,i){return`
layout( std140 ) uniform ${e} {
${i}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// precision
${GMe}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// precision
${GMe}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

${e.structs}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};for(const i in e){let r=`// code

`;r+=this.flowCode[i];const s=this.flowNodes[i],n=s[s.length-1];for(const a of s){const l=this.getFlowData(a),c=a.name;c&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${c}
	`),r+=`${l.code}
	`,a===n&&i!=="compute"&&(r+=`// result
	`,i==="vertex"?(r+="gl_Position = ",r+=`${l.result};`):i==="fragment"&&(a.outputNode.isOutputStructNode||(r+="fragColor = ",r+=`${l.result};`)))}const o=e[i];o.uniforms=this.getUniforms(i),o.attributes=this.getAttributes(i),o.varyings=this.getVaryings(i),o.vars=this.getVars(i),o.structs=this.getStructs(i),o.codes=this.getCodes(i),o.transforms=this.getTransforms(i),o.flow=r}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,i,r,s=null){const n=super.getUniformFromNode(e,i,r,s),o=this.getDataFromNode(e,r,this.globalCache);let a=o.uniformGPU;if(a===void 0){if(i==="texture")a=new oW(n.name,n.node),this.bindings[r].push(a);else if(i==="cubeTexture")a=new KYe(n.name,n.node),this.bindings[r].push(a);else if(i==="texture3D")a=new eXe(n.name,n.node),this.bindings[r].push(a);else if(i==="buffer"){e.name=`NodeBuffer_${e.id}`,n.name=`buffer${e.id}`;const l=new JYe(e);l.name=e.name,this.bindings[r].push(l),a=l}else{const l=e.groupNode,c=l.name,u=this.uniformGroups[r]||(this.uniformGroups[r]={});let h=u[c];h===void 0&&(h=new QYe(r+"_"+c,l),u[c]=h,this.bindings[r].push(h)),a=this.getNodeUniform(n,i),h.addUniform(a)}o.uniformGPU=a}return n}}const soi=roi;let zQ=null,VQ=null,EA=null;class noi{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null}async init(e){this.renderer=e}begin(e){}finish(e){}draw(e,i){}createProgram(e){}destroyProgram(e){}createBindings(e){}updateBindings(e){}createRenderPipeline(e){}createComputePipeline(e,i){}destroyPipeline(e){}needsRenderUpdate(e){}getRenderCacheKey(e){}createNodeBuilder(e){}createSampler(e){}createDefaultTexture(e){}createTexture(e){}copyTextureToBuffer(e,i,r,s,n){}createAttribute(e){}createIndexAttribute(e){}updateAttribute(e){}destroyAttribute(e){}getContext(){}updateSize(){}resolveTimestampAsync(e,i){}hasFeatureAsync(e){}hasFeature(e){}getInstanceCount(e){const{object:i,geometry:r}=e;return r.isInstancedBufferGeometry?r.instanceCount:i.isInstancedMesh?i.count:1}getDrawingBufferSize(){return zQ=zQ||new Xi,this.renderer.getDrawingBufferSize(zQ)}getScissor(){return VQ=VQ||new Fs,this.renderer.getScissor(VQ)}setScissorTest(e){}getClearColor(){const e=this.renderer;return EA=EA||new Wfe,e.getClearColor(EA),EA.getRGB(EA,this.renderer.currentColorSpace),EA}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:CJt(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${H7} webgpu`),this.domElement=e),e}set(e,i){this.data.set(e,i)}get(e){let i=this.data.get(e);return i===void 0&&(i={},this.data.set(e,i)),i}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}}const tXe=noi;let ooi=0;class aoi{constructor(e,i){this.buffers=[e.bufferGPU,i],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class loi{constructor(e){this.backend=e}createAttribute(e,i){const r=this.backend,{gl:s}=r,n=e.array,o=e.usage||s.STATIC_DRAW,a=e.isInterleavedBufferAttribute?e.data:e,l=r.get(a);let c=l.bufferGPU;c===void 0&&(c=this._createBuffer(s,i,n,o),l.bufferGPU=c,l.bufferType=i,l.version=a.version);let u;if(n instanceof Float32Array)u=s.FLOAT;else if(n instanceof Uint16Array)e.isFloat16BufferAttribute?u=s.HALF_FLOAT:u=s.UNSIGNED_SHORT;else if(n instanceof Int16Array)u=s.SHORT;else if(n instanceof Uint32Array)u=s.UNSIGNED_INT;else if(n instanceof Int32Array)u=s.INT;else if(n instanceof Int8Array)u=s.BYTE;else if(n instanceof Uint8Array)u=s.UNSIGNED_BYTE;else if(n instanceof Uint8ClampedArray)u=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+n);let h={bufferGPU:c,bufferType:i,type:u,byteLength:n.byteLength,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:u===s.INT||u===s.UNSIGNED_INT||u===s.UNSIGNED_SHORT||e.gpuType===Im,id:ooi++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const p=this._createBuffer(s,i,n,o);h=new aoi(h,p)}r.set(e,h)}updateAttribute(e){const i=this.backend,{gl:r}=i,s=e.array,n=e.isInterleavedBufferAttribute?e.data:e,o=i.get(n),a=o.bufferType,l=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(r.bindBuffer(a,o.bufferGPU),l.length===0)r.bufferSubData(a,0,s);else{for(let c=0,u=l.length;c<u;c++){const h=l[c];r.bufferSubData(a,h.start*s.BYTES_PER_ELEMENT,s,h.start,h.count)}n.clearUpdateRanges()}r.bindBuffer(a,null),o.version=n.version}destroyAttribute(e){const i=this.backend,{gl:r}=i;e.isInterleavedBufferAttribute&&i.delete(e.data);const s=i.get(e);r.deleteBuffer(s.bufferGPU),i.delete(e)}async getArrayBufferAsync(e){const i=this.backend,{gl:r}=i,s=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:n}=i.get(s),o=e.array,a=o.byteLength;r.bindBuffer(r.COPY_READ_BUFFER,n);const l=r.createBuffer();r.bindBuffer(r.COPY_WRITE_BUFFER,l),r.bufferData(r.COPY_WRITE_BUFFER,a,r.STREAM_READ),r.copyBufferSubData(r.COPY_READ_BUFFER,r.COPY_WRITE_BUFFER,0,0,a),await i.utils._clientWaitAsync();const c=new e.array.constructor(o.length);return r.getBufferSubData(r.COPY_WRITE_BUFFER,0,c),r.deleteBuffer(l),c.buffer}_createBuffer(e,i,r,s){const n=e.createBuffer();return e.bindBuffer(i,n),e.bufferData(i,r,s),e.bindBuffer(i,null),n}}const coi=loi;let jMe=!1,GQ,V3;class uoi{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},jMe===!1&&(this._init(this.gl),jMe=!0)}_init(e){GQ={[pw]:e.FUNC_ADD,[Uqe]:e.FUNC_SUBTRACT,[Bqe]:e.FUNC_REVERSE_SUBTRACT},V3={[zqe]:e.ZERO,[Vqe]:e.ONE,[Gqe]:e.SRC_COLOR,[PH]:e.SRC_ALPHA,[Xqe]:e.SRC_ALPHA_SATURATE,[Wqe]:e.DST_COLOR,[Hqe]:e.DST_ALPHA,[jqe]:e.ONE_MINUS_SRC_COLOR,[OH]:e.ONE_MINUS_SRC_ALPHA,[Yqe]:e.ONE_MINUS_DST_COLOR,[qqe]:e.ONE_MINUS_DST_ALPHA}}enable(e){const{enabled:i}=this;i[e]!==!0&&(this.gl.enable(e),i[e]=!0)}disable(e){const{enabled:i}=this;i[e]!==!1&&(this.gl.disable(e),i[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:i}=this;e?i.frontFace(i.CW):i.frontFace(i.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:i}=this;e!==RZt?(this.enable(i.CULL_FACE),e!==this.currentCullFace&&(e===PZt?i.cullFace(i.BACK):e===OZt?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):this.disable(i.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:i,gl:r}=this;e!==i&&(r.lineWidth(e),this.currentLineWidth=e)}setBlending(e,i,r,s,n,o,a,l){const{gl:c}=this;if(e===vI){this.currentBlendingEnabled===!0&&(this.disable(c.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(c.BLEND),this.currentBlendingEnabled=!0),e!==kqe){if(e!==this.currentBlending||l!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==pw||this.currentBlendEquationAlpha!==pw)&&(c.blendEquation(c.FUNC_ADD),this.currentBlendEquation=pw,this.currentBlendEquationAlpha=pw),l)switch(e){case yE:c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case ck:c.blendFunc(c.ONE,c.ONE);break;case AH:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case RH:c.blendFuncSeparate(c.ZERO,c.SRC_COLOR,c.ZERO,c.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case yE:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case ck:c.blendFunc(c.SRC_ALPHA,c.ONE);break;case AH:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case RH:c.blendFunc(c.ZERO,c.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=l}return}n=n||i,o=o||r,a=a||s,(i!==this.currentBlendEquation||n!==this.currentBlendEquationAlpha)&&(c.blendEquationSeparate(GQ[i],GQ[n]),this.currentBlendEquation=i,this.currentBlendEquationAlpha=n),(r!==this.currentBlendSrc||s!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||a!==this.currentBlendDstAlpha)&&(c.blendFuncSeparate(V3[r],V3[s],V3[o],V3[a]),this.currentBlendSrc=r,this.currentBlendDst=s,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=a),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:i}=this;e?this.enable(i.DEPTH_TEST):this.disable(i.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:i}=this;switch(e){case Zqe:i.depthFunc(i.NEVER);break;case Jqe:i.depthFunc(i.ALWAYS);break;case Qqe:i.depthFunc(i.LESS);break;case IH:i.depthFunc(i.LEQUAL);break;case Kqe:i.depthFunc(i.EQUAL);break;case e9e:i.depthFunc(i.GEQUAL);break;case t9e:i.depthFunc(i.GREATER);break;case i9e:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}this.currentDepthFunc=e}}setStencilTest(e){const{gl:i}=this;e?this.enable(i.STENCIL_TEST):this.disable(i.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,i,r){(this.currentStencilFunc!==e||this.currentStencilRef!==i||this.currentStencilFuncMask!==r)&&(this.gl.stencilFunc(e,i,r),this.currentStencilFunc=e,this.currentStencilRef=i,this.currentStencilFuncMask=r)}setStencilOp(e,i,r){(this.currentStencilFail!==e||this.currentStencilZFail!==i||this.currentStencilZPass!==r)&&(this.gl.stencilOp(e,i,r),this.currentStencilFail=e,this.currentStencilZFail=i,this.currentStencilZPass=r)}setMaterial(e,i){const{gl:r}=this;e.side===MH?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let s=e.side===m1;i&&(s=!s),this.setFlipSided(s),e.blending===yE&&e.transparent===!1?this.setBlending(vI):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const n=e.stencilWrite;this.setStencilTest(n),n&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE)}setPolygonOffset(e,i,r){const{gl:s}=this;e?(this.enable(s.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==i||this.currentPolygonOffsetUnits!==r)&&(s.polygonOffset(i,r),this.currentPolygonOffsetFactor=i,this.currentPolygonOffsetUnits=r)):this.disable(s.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}bindFramebuffer(e,i){const{gl:r,currentBoundFramebuffers:s}=this;return s[e]!==i?(r.bindFramebuffer(e,i),s[e]=i,e===r.DRAW_FRAMEBUFFER&&(s[r.FRAMEBUFFER]=i),e===r.FRAMEBUFFER&&(s[r.DRAW_FRAMEBUFFER]=i),!0):!1}drawBuffers(e,i){const{gl:r}=this;let s=[],n=!1;if(e.textures!==null){s=this.currentDrawbuffers.get(i),s===void 0&&(s=[],this.currentDrawbuffers.set(i,s));const o=e.textures;if(s.length!==o.length||s[0]!==r.COLOR_ATTACHMENT0){for(let a=0,l=o.length;a<l;a++)s[a]=r.COLOR_ATTACHMENT0+a;s.length=o.length,n=!0}}else s[0]!==r.BACK&&(s[0]=r.BACK,n=!0);n&&r.drawBuffers(s)}activeTexture(e){const{gl:i,currentTextureSlot:r,maxTextures:s}=this;e===void 0&&(e=i.TEXTURE0+s-1),r!==e&&(i.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,i,r){const{gl:s,currentTextureSlot:n,currentBoundTextures:o,maxTextures:a}=this;r===void 0&&(n===null?r=s.TEXTURE0+a-1:r=n);let l=o[r];l===void 0&&(l={type:void 0,texture:void 0},o[r]=l),(l.type!==e||l.texture!==i)&&(n!==r&&(s.activeTexture(r),this.currentTextureSlot=r),s.bindTexture(e,i),l.type=e,l.texture=i)}unbindTexture(){const{gl:e,currentTextureSlot:i,currentBoundTextures:r}=this,s=r[i];s!==void 0&&s.type!==void 0&&(e.bindTexture(s.type,null),s.type=void 0,s.texture=void 0)}}const hoi=uoi;class doi{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,i=F4){const{gl:r,extensions:s}=this;let n;if(e===G2)return r.UNSIGNED_BYTE;if(e===zZt)return r.UNSIGNED_SHORT_4_4_4_4;if(e===VZt)return r.UNSIGNED_SHORT_5_5_5_1;if(e===s9e)return r.UNSIGNED_INT_5_9_9_9_REV;if(e===M6)return r.BYTE;if(e===A6)return r.SHORT;if(e===WL)return r.UNSIGNED_SHORT;if(e===Im)return r.INT;if(e===xd)return r.UNSIGNED_INT;if(e===Rd)return r.FLOAT;if(e===vE)return r.HALF_FLOAT;if(e===GZt)return r.ALPHA;if(e===ufe)return r.RGB;if(e===u$)return r.RGBA;if(e===jZt)return r.LUMINANCE;if(e===HZt)return r.LUMINANCE_ALPHA;if(e===bE)return r.DEPTH_COMPONENT;if(e===bI)return r.DEPTH_STENCIL;if(e===q7)return r.RED;if(e===n9e)return r.RED_INTEGER;if(e===hfe)return r.RG;if(e===o9e)return r.RG_INTEGER;if(e===a9e)return r.RGBA_INTEGER;if(e===BJ||e===R6||e===P6||e===O6)if(i===di)if(n=s.get("WEBGL_compressed_texture_s3tc_srgb"),n!==null){if(e===BJ)return n.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===R6)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===P6)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===O6)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(n=s.get("WEBGL_compressed_texture_s3tc"),n!==null){if(e===BJ)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===R6)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===P6)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===O6)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===cCe||e===uCe||e===hCe||e===dCe)if(n=s.get("WEBGL_compressed_texture_pvrtc"),n!==null){if(e===cCe)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===uCe)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===hCe)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===dCe)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===pCe||e===pae||e===fae)if(n=s.get("WEBGL_compressed_texture_etc"),n!==null){if(e===pCe||e===pae)return i===di?n.COMPRESSED_SRGB8_ETC2:n.COMPRESSED_RGB8_ETC2;if(e===fae)return i===di?n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:n.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===mae||e===gae||e===yae||e===_ae||e===vae||e===bae||e===wae||e===xae||e===Sae||e===Tae||e===Eae||e===Cae||e===Mae||e===Aae)if(n=s.get("WEBGL_compressed_texture_astc"),n!==null){if(e===mae)return i===di?n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:n.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===gae)return i===di?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:n.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===yae)return i===di?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:n.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===_ae)return i===di?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:n.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===vae)return i===di?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:n.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===bae)return i===di?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:n.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===wae)return i===di?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:n.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===xae)return i===di?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:n.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===Sae)return i===di?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:n.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===Tae)return i===di?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:n.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===Eae)return i===di?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:n.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Cae)return i===di?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:n.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===Mae)return i===di?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:n.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===Aae)return i===di?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:n.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===zJ)if(n=s.get("EXT_texture_compression_bptc"),n!==null){if(e===zJ)return i===di?n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:n.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===qZt||e===fCe||e===mCe||e===gCe)if(n=s.get("EXT_texture_compression_rgtc"),n!==null){if(e===zJ)return n.COMPRESSED_RED_RGTC1_EXT;if(e===fCe)return n.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===mCe)return n.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===gCe)return n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===D4?r.UNSIGNED_INT_24_8:r[e]!==void 0?r[e]:null}_clientWaitAsync(){const{gl:e}=this,i=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((r,s)=>{function n(){const o=e.clientWaitSync(i,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED){e.deleteSync(i),s();return}if(o===e.TIMEOUT_EXPIRED){requestAnimationFrame(n);return}e.deleteSync(i),r()}n()})}}const poi=doi;let HMe=!1,Hz,jQ,qMe;class foi{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},HMe===!1&&(this._init(this.gl),HMe=!0)}_init(e){Hz={[NH]:e.REPEAT,[pP]:e.CLAMP_TO_EDGE,[LH]:e.MIRRORED_REPEAT},jQ={[za]:e.NEAREST,[dae]:e.NEAREST_MIPMAP_NEAREST,[C6]:e.NEAREST_MIPMAP_LINEAR,[yf]:e.LINEAR,[BZt]:e.LINEAR_MIPMAP_NEAREST,[_E]:e.LINEAR_MIPMAP_LINEAR},qMe={[c9e]:e.NEVER,[f9e]:e.ALWAYS,[dfe]:e.LESS,[pfe]:e.LEQUAL,[u9e]:e.EQUAL,[p9e]:e.GEQUAL,[h9e]:e.GREATER,[d9e]:e.NOTEQUAL}}filterFallback(e){const{gl:i}=this;return e===za||e===dae||e===C6?i.NEAREST:i.LINEAR}getGLTextureType(e){const{gl:i}=this;let r;return e.isCubeTexture===!0?r=i.TEXTURE_CUBE_MAP:e.isDataArrayTexture===!0?r=i.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?r=i.TEXTURE_3D:r=i.TEXTURE_2D,r}getInternalFormat(e,i,r,s,n=!1){const{gl:o,extensions:a}=this;if(e!==null){if(o[e]!==void 0)return o[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let l=i;return i===o.RED&&(r===o.FLOAT&&(l=o.R32F),r===o.HALF_FLOAT&&(l=o.R16F),r===o.UNSIGNED_BYTE&&(l=o.R8),r===o.UNSIGNED_SHORT&&(l=o.R16),r===o.UNSIGNED_INT&&(l=o.R32UI),r===o.BYTE&&(l=o.R8I),r===o.SHORT&&(l=o.R16I),r===o.INT&&(l=o.R32I)),i===o.RED_INTEGER&&(r===o.UNSIGNED_BYTE&&(l=o.R8UI),r===o.UNSIGNED_SHORT&&(l=o.R16UI),r===o.UNSIGNED_INT&&(l=o.R32UI),r===o.BYTE&&(l=o.R8I),r===o.SHORT&&(l=o.R16I),r===o.INT&&(l=o.R32I)),i===o.RG&&(r===o.FLOAT&&(l=o.RG32F),r===o.HALF_FLOAT&&(l=o.RG16F),r===o.UNSIGNED_BYTE&&(l=o.RG8),r===o.UNSIGNED_SHORT&&(l=o.RG16),r===o.UNSIGNED_INT&&(l=o.RG32UI),r===o.BYTE&&(l=o.RG8I),r===o.SHORT&&(l=o.RG16I),r===o.INT&&(l=o.RG32I)),i===o.RGB&&(r===o.FLOAT&&(l=o.RGB32F),r===o.HALF_FLOAT&&(l=o.RGB16F),r===o.UNSIGNED_BYTE&&(l=o.RGB8),r===o.UNSIGNED_SHORT&&(l=o.RGB16),r===o.UNSIGNED_INT&&(l=o.RGB32UI),r===o.BYTE&&(l=o.RGB8I),r===o.SHORT&&(l=o.RGB16I),r===o.INT&&(l=o.RGB32I),r===o.UNSIGNED_BYTE&&(l=s===di&&n===!1?o.SRGB8:o.RGB8),r===o.UNSIGNED_SHORT_5_6_5&&(l=o.RGB565),r===o.UNSIGNED_SHORT_5_5_5_1&&(l=o.RGB5_A1),r===o.UNSIGNED_SHORT_4_4_4_4&&(l=o.RGB4),r===o.UNSIGNED_INT_5_9_9_9_REV&&(l=o.RGB9_E5)),i===o.RGBA&&(r===o.FLOAT&&(l=o.RGBA32F),r===o.HALF_FLOAT&&(l=o.RGBA16F),r===o.UNSIGNED_BYTE&&(l=o.RGBA8),r===o.UNSIGNED_SHORT&&(l=o.RGBA16),r===o.UNSIGNED_INT&&(l=o.RGBA32UI),r===o.BYTE&&(l=o.RGBA8I),r===o.SHORT&&(l=o.RGBA16I),r===o.INT&&(l=o.RGBA32I),r===o.UNSIGNED_BYTE&&(l=s===di&&n===!1?o.SRGB8_ALPHA8:o.RGBA8),r===o.UNSIGNED_SHORT_4_4_4_4&&(l=o.RGBA4),r===o.UNSIGNED_SHORT_5_5_5_1&&(l=o.RGB5_A1)),i===o.DEPTH_COMPONENT&&(r===o.UNSIGNED_INT&&(l=o.DEPTH24_STENCIL8),r===o.FLOAT&&(l=o.DEPTH_COMPONENT32F)),i===o.DEPTH_STENCIL&&r===o.UNSIGNED_INT_24_8&&(l=o.DEPTH24_STENCIL8),(l===o.R16F||l===o.R32F||l===o.RG16F||l===o.RG32F||l===o.RGBA16F||l===o.RGBA32F)&&a.get("EXT_color_buffer_float"),l}setTextureParameters(e,i){const{gl:r,extensions:s,backend:n}=this,{currentAnisotropy:o}=n.get(i);r.texParameteri(e,r.TEXTURE_WRAP_S,Hz[i.wrapS]),r.texParameteri(e,r.TEXTURE_WRAP_T,Hz[i.wrapT]),(e===r.TEXTURE_3D||e===r.TEXTURE_2D_ARRAY)&&r.texParameteri(e,r.TEXTURE_WRAP_R,Hz[i.wrapR]),r.texParameteri(e,r.TEXTURE_MAG_FILTER,jQ[i.magFilter]);const a=!i.isVideoTexture&&i.minFilter===yf?_E:i.minFilter;if(r.texParameteri(e,r.TEXTURE_MIN_FILTER,jQ[a]),i.compareFunction&&(r.texParameteri(e,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(e,r.TEXTURE_COMPARE_FUNC,qMe[i.compareFunction])),s.has("EXT_texture_filter_anisotropic")===!0){if(i.magFilter===za||i.minFilter!==C6&&i.minFilter!==_E||i.type===Rd&&s.has("OES_texture_float_linear")===!1)return;if(i.anisotropy>1||o!==i.anisotropy){const l=s.get("EXT_texture_filter_anisotropic");r.texParameterf(e,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,n.getMaxAnisotropy())),n.get(i).currentAnisotropy=i.anisotropy}}}createDefaultTexture(e){const{gl:i,backend:r,defaultTextures:s}=this,n=this.getGLTextureType(e);let o=s[n];o===void 0&&(o=i.createTexture(),r.state.bindTexture(n,o),i.texParameteri(n,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(n,i.TEXTURE_MAG_FILTER,i.NEAREST),s[n]=o),r.set(e,{textureGPU:o,glTextureType:n,isDefault:!0})}createTexture(e,i){const{gl:r,backend:s}=this,{levels:n,width:o,height:a,depth:l}=i,c=s.utils.convert(e.format,e.colorSpace),u=s.utils.convert(e.type),h=this.getInternalFormat(e.internalFormat,c,u,e.colorSpace,e.isVideoTexture),p=r.createTexture(),f=this.getGLTextureType(e);s.state.bindTexture(f,p),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,e.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),this.setTextureParameters(f,e),e.isDataArrayTexture?r.texStorage3D(r.TEXTURE_2D_ARRAY,n,h,o,a,l):e.isData3DTexture?r.texStorage3D(r.TEXTURE_3D,n,h,o,a,l):e.isVideoTexture||r.texStorage2D(f,n,h,o,a),s.set(e,{textureGPU:p,glTextureType:f,glFormat:c,glType:u,glInternalFormat:h})}copyBufferToTexture(e,i){const{gl:r,backend:s}=this,{textureGPU:n,glTextureType:o,glFormat:a,glType:l}=s.get(i),{width:c,height:u}=i.source.data;r.bindBuffer(r.PIXEL_UNPACK_BUFFER,e),s.state.bindTexture(o,n),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.texSubImage2D(o,0,0,0,c,u,a,l,0),r.bindBuffer(r.PIXEL_UNPACK_BUFFER,null),s.state.unbindTexture()}updateTexture(e,i){const{gl:r}=this,{width:s,height:n}=i,{textureGPU:o,glTextureType:a,glFormat:l,glType:c,glInternalFormat:u}=this.backend.get(e);if(e.isRenderTargetTexture||o===void 0)return;const h=p=>p.isDataTexture?p.image.data:p instanceof ImageBitmap||p instanceof OffscreenCanvas||p instanceof HTMLImageElement||p instanceof HTMLCanvasElement?p:p.data;if(this.backend.state.bindTexture(a,o),e.isCompressedTexture){const p=e.mipmaps;for(let f=0;f<p.length;f++){const g=p[f];if(e.isCompressedArrayTexture){const y=i.image;e.format!==r.RGBA?l!==null?r.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,f,0,0,0,g.width,g.height,y.depth,l,g.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texSubImage3D(r.TEXTURE_2D_ARRAY,f,0,0,0,g.width,g.height,y.depth,l,c,g.data)}else l!==null?r.compressedTexSubImage2D(r.TEXTURE_2D,f,0,0,g.width,g.height,l,g.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const p=i.images;for(let f=0;f<6;f++){const g=h(p[f]);r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,0,0,s,n,l,c,g)}}else if(e.isDataArrayTexture){const p=i.image;r.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,l,c,p.data)}else if(e.isData3DTexture){const p=i.image;r.texSubImage3D(r.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,l,c,p.data)}else if(e.isVideoTexture)e.update(),r.texImage2D(a,0,u,l,c,i.image);else{const p=h(i.image);r.texSubImage2D(a,0,0,0,s,n,l,c,p)}}generateMipmaps(e){const{gl:i,backend:r}=this,{textureGPU:s,glTextureType:n}=r.get(e);r.state.bindTexture(n,s),i.generateMipmap(n)}deallocateRenderBuffers(e){const{gl:i,backend:r}=this;if(e){const s=r.get(e);if(s.renderBufferStorageSetup=void 0,s.framebuffer&&(i.deleteFramebuffer(s.framebuffer),s.framebuffer=void 0),s.depthRenderbuffer&&(i.deleteRenderbuffer(s.depthRenderbuffer),s.depthRenderbuffer=void 0),s.stencilRenderbuffer&&(i.deleteRenderbuffer(s.stencilRenderbuffer),s.stencilRenderbuffer=void 0),s.msaaFrameBuffer&&(i.deleteFramebuffer(s.msaaFrameBuffer),s.msaaFrameBuffer=void 0),s.msaaRenderbuffers){for(let n=0;n<s.msaaRenderbuffers.length;n++)i.deleteRenderbuffer(s.msaaRenderbuffers[n]);s.msaaRenderbuffers=void 0}}}destroyTexture(e){const{gl:i,backend:r}=this,{textureGPU:s,renderTarget:n}=r.get(e);this.deallocateRenderBuffers(n),i.deleteTexture(s),r.delete(e)}copyTextureToTexture(e,i,r=null,s=null,n=0){const{gl:o,backend:a}=this,{state:l}=this.backend,{textureGPU:c,glTextureType:u,glType:h,glFormat:p}=a.get(i);let f,g,y,v,b,w;r!==null?(f=r.max.x-r.min.x,g=r.max.y-r.min.y,y=r.min.x,v=r.min.y):(f=e.image.width,g=e.image.height,y=0,v=0),s!==null?(b=s.x,w=s.y):(b=0,w=0),l.bindTexture(u,c),o.pixelStorei(o.UNPACK_ALIGNMENT,i.unpackAlignment),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,i.unpackAlignment);const x=o.getParameter(o.UNPACK_ROW_LENGTH),S=o.getParameter(o.UNPACK_IMAGE_HEIGHT),E=o.getParameter(o.UNPACK_SKIP_PIXELS),C=o.getParameter(o.UNPACK_SKIP_ROWS),R=o.getParameter(o.UNPACK_SKIP_IMAGES),I=e.isCompressedTexture?e.mipmaps[n]:e.image;o.pixelStorei(o.UNPACK_ROW_LENGTH,I.width),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,I.height),o.pixelStorei(o.UNPACK_SKIP_PIXELS,y),o.pixelStorei(o.UNPACK_SKIP_ROWS,v),e.isDataTexture?o.texSubImage2D(o.TEXTURE_2D,n,b,w,f,g,p,h,I.data):e.isCompressedTexture?o.compressedTexSubImage2D(o.TEXTURE_2D,n,b,w,I.width,I.height,p,I.data):o.texSubImage2D(o.TEXTURE_2D,n,b,w,p,h,I),o.pixelStorei(o.UNPACK_ROW_LENGTH,x),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,S),o.pixelStorei(o.UNPACK_SKIP_PIXELS,E),o.pixelStorei(o.UNPACK_SKIP_ROWS,C),o.pixelStorei(o.UNPACK_SKIP_IMAGES,R),n===0&&i.generateMipmaps&&o.generateMipmap(o.TEXTURE_2D),l.unbindTexture()}copyFramebufferToTexture(e,i){const{gl:r}=this,{state:s}=this.backend,{textureGPU:n}=this.backend.get(e),o=e.image.width,a=e.image.height;if(e.isDepthTexture===!0||i.renderTarget&&i.renderTarget.samples>0){let c,u;e.isDepthTexture===!0?(c=r.DEPTH_BUFFER_BIT,u=r.DEPTH_ATTACHMENT,i.stencil&&(c|=r.STENCIL_BUFFER_BIT)):(c=r.COLOR_BUFFER_BIT,u=r.COLOR_ATTACHMENT0);const h=r.createFramebuffer();s.bindFramebuffer(r.DRAW_FRAMEBUFFER,h),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,u,r.TEXTURE_2D,n,0),r.blitFramebuffer(0,0,o,a,0,0,o,a,c,r.NEAREST),r.deleteFramebuffer(h)}else s.bindTexture(r.TEXTURE_2D,n),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,0,0,o,a),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(i)}setupRenderBufferStorage(e,i){const{gl:r}=this,s=i.renderTarget,{samples:n,depthTexture:o,depthBuffer:a,stencilBuffer:l,width:c,height:u}=s;if(r.bindRenderbuffer(r.RENDERBUFFER,e),a&&!l){let h=r.DEPTH_COMPONENT24;n>0?(o&&o.isDepthTexture&&o.type===r.FLOAT&&(h=r.DEPTH_COMPONENT32F),r.renderbufferStorageMultisample(r.RENDERBUFFER,n,h,c,u)):r.renderbufferStorage(r.RENDERBUFFER,h,c,u),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e)}else a&&l&&(n>0?r.renderbufferStorageMultisample(r.RENDERBUFFER,n,r.DEPTH24_STENCIL8,c,u):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,c,u),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e))}async copyTextureToBuffer(e,i,r,s,n){const{backend:o,gl:a}=this,{textureGPU:l,glFormat:c,glType:u}=this.backend.get(e),h=a.createFramebuffer();a.bindFramebuffer(a.READ_FRAMEBUFFER,h),a.framebufferTexture2D(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,l,0);const p=this._getTypedArrayType(u),f=this._getBytesPerTexel(c),y=s*n*f,v=a.createBuffer();a.bindBuffer(a.PIXEL_PACK_BUFFER,v),a.bufferData(a.PIXEL_PACK_BUFFER,y,a.STREAM_READ),a.readPixels(i,r,s,n,c,u,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),await o.utils._clientWaitAsync();const b=new p(y/p.BYTES_PER_ELEMENT);return a.bindBuffer(a.PIXEL_PACK_BUFFER,v),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,b),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteFramebuffer(h),b}_getTypedArrayType(e){const{gl:i}=this;if(e===i.UNSIGNED_BYTE)return Uint8Array;if(e===i.UNSIGNED_SHORT_4_4_4_4||e===i.UNSIGNED_SHORT_5_5_5_1||e===i.UNSIGNED_SHORT_5_6_5||e===i.UNSIGNED_SHORT)return Uint16Array;if(e===i.UNSIGNED_INT)return Uint32Array;if(e===i.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e){const{gl:i}=this;if(e===i.RGBA)return 4;if(e===i.RGB)return 3;if(e===i.ALPHA)return 1}}const moi=foi;class goi{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let i=this.extensions[e];return i===void 0&&(i=this.gl.getExtension(e)),i}has(e){return this.availableExtensions.includes(e)}}const yoi=goi;class _oi{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,i=this.backend.extensions;if(i.has("EXT_texture_filter_anisotropic")===!0){const r=i.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const voi=_oi,WMe={WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};class boi{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,i){const{gl:r,mode:s,object:n,type:o,info:a,index:l}=this;l!==0?r.drawElements(s,i,o,e):r.drawArrays(s,e,i),a.update(n,i,s,1)}renderInstances(e,i,r){const{gl:s,mode:n,type:o,index:a,object:l,info:c}=this;r!==0&&(a!==0?s.drawElementsInstanced(n,i,o,e,r):s.drawArraysInstanced(n,e,i,r),c.update(l,i,n,r))}renderMultiDraw(e,i,r){const{extensions:s,mode:n,object:o,info:a}=this;if(r===0)return;const l=s.get("WEBGL_multi_draw");if(l===null)for(let c=0;c<r;c++)this.render(e[c],i[c]);else{this.index!==0?l.multiDrawElementsWEBGL(n,i,0,this.type,e,0,r):l.multiDrawArraysWEBGL(n,e,0,i,0,r);let c=0;for(let u=0;u<r;u++)c+=i[u];a.update(o,c,n,1)}}renderMultiDrawInstances(e,i,r,s){const{extensions:n,mode:o,object:a,info:l}=this;if(r===0)return;const c=n.get("WEBGL_multi_draw");if(c===null)for(let u=0;u<r;u++)this.renderInstances(e[u],i[u],s[u]);else{this.index!==0?c.multiDrawElementsInstancedWEBGL(o,i,0,this.type,e,0,s,0,r):c.multiDrawArraysInstancedWEBGL(o,e,0,i,0,s,0,r);let u=0;for(let h=0;h<r;h++)u+=i[h];for(let h=0;h<s.length;h++)l.update(a,u,o,s[h])}}}class woi extends tXe{constructor(e={}){super(e),this.isWebGLBackend=!0}init(e){super.init(e);const i=this.parameters,r=i.context!==void 0?i.context:e.domElement.getContext("webgl2");this.gl=r,this.extensions=new yoi(this),this.capabilities=new voi(this),this.attributeUtils=new coi(this),this.textureUtils=new moi(this),this.bufferRenderer=new boi(this),this.state=new hoi(this),this.utils=new poi(this),this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.trackTimestamp=i.trackTimestamp===!0,this.extensions.get("EXT_color_buffer_float"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this._currentContext=null}get coordinateSystem(){return Zm}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const i=this.get(e);if(this.queryRunning){i.queryQueue||(i.queryQueue=[]),i.queryQueue.push(e);return}i.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),i.activeQuery=null),i.activeQuery=this.gl.createQuery(),i.activeQuery!==null&&(this.gl.beginQuery(this.disjoint.TIME_ELAPSED_EXT,i.activeQuery),this.queryRunning=!0)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const i=this.get(e);if(i.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),i.gpuQueries||(i.gpuQueries=[]),i.gpuQueries.push({query:i.activeQuery}),i.activeQuery=null,this.queryRunning=!1,i.queryQueue&&i.queryQueue.length>0)){const r=i.queryQueue.shift();this.initTimestampQuery(r)}}async resolveTimestampAsync(e,i="render"){if(!this.disjoint||!this.trackTimestamp)return;const r=this.get(e);r.gpuQueries||(r.gpuQueries=[]);for(let s=0;s<r.gpuQueries.length;s++){const n=r.gpuQueries[s],o=this.gl.getQueryParameter(n.query,this.gl.QUERY_RESULT_AVAILABLE),a=this.gl.getParameter(this.disjoint.GPU_DISJOINT_EXT);if(o&&!a){const l=this.gl.getQueryParameter(n.query,this.gl.QUERY_RESULT),c=Number(l)/1e6;this.gl.deleteQuery(n.query),r.gpuQueries.splice(s,1),s--,this.renderer.info.updateTimestamp(i,c)}}}getContext(){return this.gl}beginRender(e){const{gl:i}=this,r=this.get(e);if(this.initTimestampQuery(e),r.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1),e.viewport?this.updateViewport(e):i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),e.scissor){const{x:n,y:o,width:a,height:l}=e.scissorValue;i.scissor(n,o,a,l)}const s=e.occlusionQueryCount;s>0&&(r.currentOcclusionQueries=r.occlusionQueries,r.currentOcclusionQueryObjects=r.occlusionQueryObjects,r.lastOcclusionObject=null,r.occlusionQueries=new Array(s),r.occlusionQueryObjects=new Array(s),r.occlusionQueryIndex=0)}finishRender(e){const{gl:i,state:r}=this,n=this.get(e).previousContext,o=e.textures;if(o!==null)for(let l=0;l<o.length;l++){const c=o[l];c.generateMipmaps&&this.generateMipmaps(c)}if(this._currentContext=n,e.textures!==null&&e.renderTarget){const l=this.get(e.renderTarget),{samples:c}=e.renderTarget,u=l.framebuffer,h=i.COLOR_BUFFER_BIT;if(c>0){const p=l.msaaFrameBuffer,f=e.textures;r.bindFramebuffer(i.READ_FRAMEBUFFER,p),r.bindFramebuffer(i.DRAW_FRAMEBUFFER,u);for(let g=0;g<f.length;g++)i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,h,i.NEAREST),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,l.invalidationArray)}}if(n!==null)if(this._setFramebuffer(n),n.viewport)this.updateViewport(n);else{const l=this.gl;l.viewport(0,0,l.drawingBufferWidth,l.drawingBufferHeight)}const a=e.occlusionQueryCount;if(a>0){const l=this.get(e);if(a>l.occlusionQueryIndex){const{gl:c}=this;c.endQuery(c.ANY_SAMPLES_PASSED)}this.resolveOccludedAsync(e)}this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const i=this.get(e),{currentOcclusionQueries:r,currentOcclusionQueryObjects:s}=i;if(r&&s){const n=new WeakSet,{gl:o}=this;i.currentOcclusionQueryObjects=null,i.currentOcclusionQueries=null;const a=()=>{let l=0;for(let c=0;c<r.length;c++){const u=r[c];u!==null&&o.getQueryParameter(u,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(u,o.QUERY_RESULT)>0&&n.add(s[c]),r[c]=null,o.deleteQuery(u),l++)}l<r.length?requestAnimationFrame(a):i.occluded=n};a()}}isOccluded(e,i){const r=this.get(e);return r.occluded&&r.occluded.has(i)}updateViewport(e){const i=this.gl,{x:r,y:s,width:n,height:o}=e.viewportValue;i.viewport(r,s,n,o)}setScissorTest(e){const i=this.gl;e?i.enable(i.SCISSOR_TEST):i.disable(i.SCISSOR_TEST)}clear(e,i,r,s=null,n=!0){const{gl:o}=this;s===null&&(s={textures:null,clearColorValue:this.getClearColor()});let a=0;if(e&&(a|=o.COLOR_BUFFER_BIT),i&&(a|=o.DEPTH_BUFFER_BIT),r&&(a|=o.STENCIL_BUFFER_BIT),a!==0){const l=s.clearColorValue||this.getClearColor();if(i&&this.state.setDepthMask(!0),s.textures===null)o.clearColor(l.r,l.g,l.b,l.a),o.clear(a);else{if(n&&this._setFramebuffer(s),e)for(let c=0;c<s.textures.length;c++)o.clearBufferfv(o.COLOR,c,[l.r,l.g,l.b,l.a]);i&&r?o.clearBufferfi(o.DEPTH_STENCIL,0,1,0):i?o.clearBufferfv(o.DEPTH,0,[1]):r&&o.clearBufferiv(o.STENCIL,0,[0])}}}beginCompute(e){const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,i,r,s){const n=this.gl;this.discard||(n.enable(n.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:o,transformBuffers:a,attributes:l}=this.get(s),c=this._getVaoKey(null,l),u=this.vaoCache[c];u===void 0?this._createVao(null,l):n.bindVertexArray(u),n.useProgram(o),this._bindUniforms(r);const h=this._getTransformFeedback(a);n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,h),n.beginTransformFeedback(n.POINTS),l[0].isStorageInstancedBufferAttribute?n.drawArraysInstanced(n.POINTS,0,1,i.count):n.drawArrays(n.POINTS,0,i.count),n.endTransformFeedback(),n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,null);for(let p=0;p<a.length;p++){const f=a[p];f.pbo&&this.textureUtils.copyBufferToTexture(f.transformBuffer,f.pbo),f.switchBuffers()}}finishCompute(e){const i=this.gl;this.discard=!1,i.disable(i.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e)}draw(e,i){const{object:r,pipeline:s,material:n,context:o}=e,{programGPU:a}=this.get(s),{gl:l,state:c}=this,u=this.get(o);this._bindUniforms(e.getBindings());const h=r.isMesh&&r.matrixWorld.determinant()<0;c.setMaterial(n,h),l.useProgram(a);let p=e.staticVao;if(p===void 0){const E=this._getVaoKey(e.getIndex(),e.getAttributes());if(p=this.vaoCache[E],p===void 0){let C;({vaoGPU:p,staticVao:C}=this._createVao(e.getIndex(),e.getAttributes())),C&&(e.staticVao=p)}}l.bindVertexArray(p);const f=e.getIndex(),g=e.geometry,y=e.drawRange,v=y.start,b=u.lastOcclusionObject;if(b!==r&&b!==void 0){if(b!==null&&b.occlusionTest===!0&&(l.endQuery(l.ANY_SAMPLES_PASSED),u.occlusionQueryIndex++),r.occlusionTest===!0){const E=l.createQuery();l.beginQuery(l.ANY_SAMPLES_PASSED,E),u.occlusionQueries[u.occlusionQueryIndex]=E,u.occlusionQueryObjects[u.occlusionQueryIndex]=r}u.lastOcclusionObject=r}const w=this.bufferRenderer;r.isPoints?w.mode=l.POINTS:r.isLineSegments?w.mode=l.LINES:r.isLine?w.mode=l.LINE_STRIP:r.isLineLoop?w.mode=l.LINE_LOOP:n.wireframe===!0?(c.setLineWidth(n.wireframeLinewidth*this.renderer.getPixelRatio()),w.mode=l.LINES):w.mode=l.TRIANGLES;let x;if(w.object=r,f!==null){const E=this.get(f),C=y.count!==1/0?y.count:f.count;w.index=f.count,w.type=E.type,x=C}else w.index=0,x=y.count!==1/0?y.count:g.attributes.position.count;const S=this.getInstanceCount(e);r.isBatchedMesh?r._multiDrawInstances!==null?w.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances):w.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount):S>1?w.renderInstances(v,x,S):w.render(v,x),l.bindVertexArray(null)}needsRenderUpdate(){return!1}getRenderCacheKey(e){return e.id}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,i){this.textureUtils.createTexture(e,i)}updateTexture(e,i){this.textureUtils.updateTexture(e,i)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}copyTextureToBuffer(e,i,r,s,n){return this.textureUtils.copyTextureToBuffer(e,i,r,s,n)}createSampler(){}destroySampler(){}createNodeBuilder(e,i,r=null){return new soi(e,i,r)}createProgram(e){const i=this.gl,{stage:r,code:s}=e,n=r==="fragment"?i.createShader(i.FRAGMENT_SHADER):i.createShader(i.VERTEX_SHADER);i.shaderSource(n,s),i.compileShader(n),this.set(e,{shaderGPU:n})}destroyProgram(){console.warn("Abstract class.")}createRenderPipeline(e,i){const r=this.gl,s=e.pipeline,{fragmentProgram:n,vertexProgram:o}=s,a=r.createProgram(),l=this.get(n).shaderGPU,c=this.get(o).shaderGPU;if(r.attachShader(a,l),r.attachShader(a,c),r.linkProgram(a),this.set(s,{programGPU:a,fragmentShader:l,vertexShader:c}),i!==null&&this.parallel){const u=new Promise(h=>{const p=this.parallel,f=()=>{r.getProgramParameter(a,p.COMPLETION_STATUS_KHR)?(this._completeCompile(e,s),h()):requestAnimationFrame(f)};f()});i.push(u);return}this._completeCompile(e,s)}_completeCompile(e,i){const r=this.gl,s=this.get(i),{programGPU:n,fragmentShader:o,vertexShader:a}=s;r.getProgramParameter(n,r.LINK_STATUS)===!1&&(console.error("THREE.WebGLBackend:",r.getProgramInfoLog(n)),console.error("THREE.WebGLBackend:",r.getShaderInfoLog(o)),console.error("THREE.WebGLBackend:",r.getShaderInfoLog(a))),r.useProgram(n),this._setupBindings(e.getBindings(),n),this.set(i,{programGPU:n})}createComputePipeline(e,i){const r=this.gl,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:n}=e,o=r.createProgram(),a=this.get(s).shaderGPU,l=this.get(n).shaderGPU,c=n.transforms,u=[],h=[];for(let y=0;y<c.length;y++){const v=c[y];u.push(v.varyingName),h.push(v.attributeNode)}r.attachShader(o,a),r.attachShader(o,l),r.transformFeedbackVaryings(o,u,r.SEPARATE_ATTRIBS),r.linkProgram(o),r.getProgramParameter(o,r.LINK_STATUS)===!1&&(console.error("THREE.WebGLBackend:",r.getProgramInfoLog(o)),console.error("THREE.WebGLBackend:",r.getShaderInfoLog(a)),console.error("THREE.WebGLBackend:",r.getShaderInfoLog(l))),r.useProgram(o),this.createBindings(i),this._setupBindings(i,o);const p=n.attributes,f=[],g=[];for(let y=0;y<p.length;y++){const v=p[y].node.attribute;f.push(v),this.has(v)||this.attributeUtils.createAttribute(v,r.ARRAY_BUFFER)}for(let y=0;y<h.length;y++){const v=h[y].attribute;this.has(v)||this.attributeUtils.createAttribute(v,r.ARRAY_BUFFER);const b=this.get(v);g.push(b)}this.set(e,{programGPU:o,transformBuffers:g,attributes:f})}createBindings(e){this.updateBindings(e)}updateBindings(e){const{gl:i}=this;let r=0,s=0;for(const n of e)if(n.isUniformsGroup||n.isUniformBuffer){const o=i.createBuffer(),a=n.buffer;i.bindBuffer(i.UNIFORM_BUFFER,o),i.bufferData(i.UNIFORM_BUFFER,a,i.DYNAMIC_DRAW),i.bindBufferBase(i.UNIFORM_BUFFER,r,o),this.set(n,{index:r++,bufferGPU:o})}else if(n.isSampledTexture){const{textureGPU:o,glTextureType:a}=this.get(n.texture);this.set(n,{index:s++,textureGPU:o,glTextureType:a})}}updateBinding(e){const i=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const s=this.get(e).bufferGPU,n=e.buffer;i.bindBuffer(i.UNIFORM_BUFFER,s),i.bufferData(i.UNIFORM_BUFFER,n,i.DYNAMIC_DRAW)}}createIndexAttribute(e){const i=this.gl;this.attributeUtils.createAttribute(e,i.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const i=this.gl;this.attributeUtils.createAttribute(e,i.ARRAY_BUFFER)}createStorageAttribute(e){}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){}hasFeature(e){const i=Object.keys(WMe).filter(s=>WMe[s]===e),r=this.extensions;for(let s=0;s<i.length;s++)if(r.has(i[s]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,i,r,s){this.textureUtils.copyTextureToTexture(e,i,r,s)}copyFramebufferToTexture(e,i){this.textureUtils.copyFramebufferToTexture(e,i)}_setFramebuffer(e){const{gl:i,state:r}=this;let s=null;if(e.textures!==null){const n=e.renderTarget,o=this.get(n),{samples:a,depthBuffer:l,stencilBuffer:c}=n,u=this.renderer._activeCubeFace,h=n.isWebGLCubeRenderTarget===!0;let p=o.msaaFrameBuffer,f=o.depthRenderbuffer,g;if(h?(o.cubeFramebuffers===void 0&&(o.cubeFramebuffers=[]),g=o.cubeFramebuffers[u]):g=o.framebuffer,g===void 0){g=i.createFramebuffer(),r.bindFramebuffer(i.FRAMEBUFFER,g);const y=e.textures;if(h){o.cubeFramebuffers[u]=g;const{textureGPU:v}=this.get(y[0]);i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+u,v,0)}else{for(let v=0;v<y.length;v++){const b=y[v],w=this.get(b);w.renderTarget=e.renderTarget;const x=i.COLOR_ATTACHMENT0+v;i.framebufferTexture2D(i.FRAMEBUFFER,x,i.TEXTURE_2D,w.textureGPU,0)}o.framebuffer=g,r.drawBuffers(e,g)}if(e.depthTexture!==null){const v=this.get(e.depthTexture),b=c?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;i.framebufferTexture2D(i.FRAMEBUFFER,b,i.TEXTURE_2D,v.textureGPU,0)}}if(a>0){if(p===void 0){const y=[];p=i.createFramebuffer(),r.bindFramebuffer(i.FRAMEBUFFER,p);const v=[],b=e.textures;for(let w=0;w<b.length;w++){if(v[w]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,v[w]),y.push(i.COLOR_ATTACHMENT0+w),l){const E=c?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;y.push(E)}const x=e.textures[w],S=this.get(x);i.renderbufferStorageMultisample(i.RENDERBUFFER,a,S.glInternalFormat,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+w,i.RENDERBUFFER,v[w])}if(o.msaaFrameBuffer=p,o.msaaRenderbuffers=v,f===void 0){f=i.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(f,e),o.depthRenderbuffer=f;const w=c?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;y.push(w)}o.invalidationArray=y}s=o.msaaFrameBuffer}else s=g}r.bindFramebuffer(i.FRAMEBUFFER,s)}_getVaoKey(e,i){let r=[];if(e!==null){const s=this.get(e);r+=":"+s.id}for(let s=0;s<i.length;s++){const n=this.get(i[s]);r+=":"+n.id}return r}_createVao(e,i){const{gl:r}=this,s=r.createVertexArray();let n="",o=!0;if(r.bindVertexArray(s),e!==null){const a=this.get(e);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a.bufferGPU),n+=":"+a.id}for(let a=0;a<i.length;a++){const l=i[a],c=this.get(l);n+=":"+c.id,r.bindBuffer(r.ARRAY_BUFFER,c.bufferGPU),r.enableVertexAttribArray(a),(l.isStorageBufferAttribute||l.isStorageInstancedBufferAttribute)&&(o=!1);let u,h;l.isInterleavedBufferAttribute===!0?(u=l.data.stride*c.bytesPerElement,h=l.offset*c.bytesPerElement):(u=0,h=0),c.isInteger?r.vertexAttribIPointer(a,l.itemSize,c.type,u,h):r.vertexAttribPointer(a,l.itemSize,c.type,l.normalized,u,h),l.isInstancedBufferAttribute&&!l.isInterleavedBufferAttribute?r.vertexAttribDivisor(a,l.meshPerAttribute):l.isInterleavedBufferAttribute&&l.data.isInstancedInterleavedBuffer&&r.vertexAttribDivisor(a,l.data.meshPerAttribute)}return r.bindBuffer(r.ARRAY_BUFFER,null),this.vaoCache[n]=s,{vaoGPU:s,staticVao:o}}_getTransformFeedback(e){let i="";for(let n=0;n<e.length;n++)i+=":"+e[n].id;let r=this.transformFeedbackCache[i];if(r!==void 0)return r;const s=this.gl;r=s.createTransformFeedback(),s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,r);for(let n=0;n<e.length;n++){const o=e[n];s.bindBufferBase(s.TRANSFORM_FEEDBACK_BUFFER,n,o.transformBuffer)}return s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[i]=r,r}_setupBindings(e,i){const r=this.gl;for(const s of e){const o=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const a=r.getUniformBlockIndex(i,s.name);r.uniformBlockBinding(i,a,o)}else if(s.isSampledTexture){const a=r.getUniformLocation(i,s.name);r.uniform1i(a,o)}}}_bindUniforms(e){const{gl:i,state:r}=this;for(const s of e){const n=this.get(s),o=n.index;s.isUniformsGroup||s.isUniformBuffer?i.bindBufferBase(i.UNIFORM_BUFFER,o,n.bufferGPU):s.isSampledTexture&&r.bindTexture(n.glTextureType,n.textureGPU,i.TEXTURE0+o)}}}const YMe=woi;class xoi extends Yfe{constructor(e,i){super(e),this.texture=i,this.version=i?i.version:0,this.isSampler=!0}}const Soi=xoi;class Toi extends Soi{constructor(e,i){super(e,i?i.value:null),this.textureNode=i}update(){this.texture=this.textureNode.value}}const Eoi=Toi;class Coi extends XYe{constructor(e,i){super(e,i?i.array:null),this.attribute=i,this.isStorageBuffer=!0}}const Moi=Coi;let Aoi=0;class Roi extends Moi{constructor(e){super("StorageBuffer_"+Aoi++,e?e.value:null),this.nodeUniform=e}get buffer(){return this.nodeUniform.value}}const Poi=Roi;class Ooi{constructor(e){this.device=e;const i=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,s=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:KH.Linear}),this.flipYSampler=e.createSampler({minFilter:KH.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:i}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:r}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:s})}getTransferPipeline(e){let i=this.transferPipelines[e];return i===void 0&&(i=this.device.createRenderPipeline({vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:vP.TriangleStrip,stripIndexFormat:TI.Uint32},layout:"auto"}),this.transferPipelines[e]=i),i}getFlipYPipeline(e){let i=this.flipYPipelines[e];return i===void 0&&(i=this.device.createRenderPipeline({vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:vP.TriangleStrip,stripIndexFormat:TI.Uint32},layout:"auto"}),this.flipYPipelines[e]=i),i}flipY(e,i,r=0){const s=i.format,{width:n,height:o}=i.size,a=this.getTransferPipeline(s),l=this.getFlipYPipeline(s),c=this.device.createTexture({size:{width:n,height:o,depthOrArrayLayers:1},format:s,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),u=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Vp.TwoD,baseArrayLayer:r}),h=c.createView({baseMipLevel:0,mipLevelCount:1,dimension:Vp.TwoD,baseArrayLayer:0}),p=this.device.createCommandEncoder({}),f=(g,y,v)=>{const b=g.getBindGroupLayout(0),w=this.device.createBindGroup({layout:b,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:y}]}),x=p.beginRenderPass({colorAttachments:[{view:v,loadOp:ca.Clear,storeOp:zl.Store,clearValue:[0,0,0,0]}]});x.setPipeline(g),x.setBindGroup(0,w),x.draw(4,1,0,0),x.end()};f(a,u,h),f(l,h,u),this.device.queue.submit([p.finish()]),c.destroy()}generateMipmaps(e,i,r=0){const s=this.getTransferPipeline(i.format),n=this.device.createCommandEncoder({}),o=s.getBindGroupLayout(0);let a=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Vp.TwoD,baseArrayLayer:r});for(let l=1;l<i.mipLevelCount;l++){const c=this.device.createBindGroup({layout:o,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:a}]}),u=e.createView({baseMipLevel:l,mipLevelCount:1,dimension:Vp.TwoD,baseArrayLayer:r}),h=n.beginRenderPass({colorAttachments:[{view:u,loadOp:ca.Clear,storeOp:zl.Store,clearValue:[0,0,0,0]}]});h.setPipeline(s),h.setBindGroup(0,c),h.draw(4,1,0,0),h.end(),a=u}this.device.queue.submit([n.finish()])}}const Ioi=Ooi,$oi={[c9e]:"never",[dfe]:"less",[u9e]:"equal",[pfe]:"less-equal",[h9e]:"greater",[p9e]:"greater-equal",[f9e]:"always",[d9e]:"not-equal"},Noi=[0,1,3,2,4,5];class Loi{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.colorBuffer=null,this.depthTexture=new h$,this.depthTexture.name="depthBuffer"}createSampler(e){const i=this.backend,r=i.device,s=i.get(e),n={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:e.anisotropy};e.isDepthTexture&&e.compareFunction!==null&&(n.compare=$oi[e.compareFunction]),s.sampler=r.createSampler(n)}createDefaultTexture(e){let i;const r=rle(e);e.isCubeTexture?i=this._getDefaultCubeTextureGPU(r):i=this._getDefaultTextureGPU(r),this.backend.get(e).texture=i}createTexture(e,i={}){const r=this.backend,s=r.get(e);if(s.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");i.needsMipmaps===void 0&&(i.needsMipmaps=!1),i.levels===void 0&&(i.levels=1),i.depth===void 0&&(i.depth=1);const{width:n,height:o,depth:a,levels:l}=i,c=this._getDimension(e),u=e.internalFormat||i.format||rle(e,r.device);let h=i.sampleCount!==void 0?i.sampleCount:1;h>1&&(h=Math.pow(2,Math.floor(Math.log2(h))),h===2&&(h=4));const p=e.isRenderTargetTexture?1:h;let f=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(f|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&(f|=GPUTextureUsage.RENDER_ATTACHMENT);const g={label:e.name,size:{width:n,height:o,depthOrArrayLayers:a},mipLevelCount:l,sampleCount:p,dimension:c,format:u,usage:f};if(e.isVideoTexture){const y=e.source.data,v=new VideoFrame(y);g.size.width=v.displayWidth,g.size.height=v.displayHeight,v.close(),s.externalTexture=y}else{if(u===void 0)return console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);s.texture=r.device.createTexture(g)}if(e.isRenderTargetTexture&&h>1){const y=Object.assign({},g);y.label=y.label+"-msaa",y.sampleCount=h,s.msaaTexture=r.device.createTexture(y)}s.initialized=!0,s.textureDescriptorGPU=g}destroyTexture(e){const i=this.backend,r=i.get(e);r.texture.destroy(),r.msaaTexture!==void 0&&r.msaaTexture.destroy(),i.delete(e)}destroySampler(e){const r=this.backend.get(e);delete r.sampler}generateMipmaps(e){const i=this.backend.get(e);if(e.isCubeTexture)for(let r=0;r<6;r++)this._generateMipmaps(i.texture,i.textureDescriptorGPU,r);else this._generateMipmaps(i.texture,i.textureDescriptorGPU)}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:i,height:r}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:i,height:r,depthOrArrayLayers:1},sampleCount:e.parameters.sampleCount,format:ie.BGRA8Unorm,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,i=!1){const r=this.backend,{width:s,height:n}=r.getDrawingBufferSize(),o=this.depthTexture,a=r.get(o).texture;let l,c;if(i?(l=bI,c=D4):e&&(l=bE,c=xd),a!==void 0){if(o.image.width===s&&o.image.height===n&&o.format===l&&o.type===c)return a;this.destroyTexture(o)}return o.name="depthBuffer",o.format=l,o.type=c,o.image.width=s,o.image.height=n,this.createTexture(o,{sampleCount:r.parameters.sampleCount,width:s,height:n}),r.get(o).texture}updateTexture(e,i){const r=this.backend.get(e),{textureDescriptorGPU:s}=r;if(!(e.isRenderTargetTexture||s===void 0)){if(e.isDataTexture)this._copyBufferToTexture(i.image,r.texture,s,0,e.flipY);else if(e.isDataArrayTexture||e.isData3DTexture)for(let n=0;n<i.image.depth;n++)this._copyBufferToTexture(i.image,r.texture,s,n,e.flipY,n);else if(e.isCompressedTexture)this._copyCompressedBufferToTexture(e.mipmaps,r.texture,s);else if(e.isCubeTexture)this._copyCubeMapToTexture(i.images,r.texture,s,e.flipY);else if(e.isVideoTexture){const n=e.source.data;r.externalTexture=n}else this._copyImageToTexture(i.image,r.texture,s,0,e.flipY);r.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,i,r,s,n){const o=this.backend.device,a=this.backend.get(e),l=a.texture,c=a.textureDescriptorGPU.format,u=this._getBytesPerTexel(c);let h=s*u;h=Math.ceil(h/256)*256;const p=o.createBuffer({size:s*n*u,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),f=o.createCommandEncoder();f.copyTextureToBuffer({texture:l,origin:{x:i,y:r}},{buffer:p,bytesPerRow:h},{width:s,height:n});const g=this._getTypedArrayType(c);o.queue.submit([f.finish()]),await p.mapAsync(GPUMapMode.READ);const y=p.getMappedRange();return new g(y)}_isEnvironmentTexture(e){const i=e.mapping;return i===lfe||i===cfe||i===uk||i===$H}_getDefaultTextureGPU(e){let i=this.defaultTexture[e];if(i===void 0){const r=new Lu;r.minFilter=za,r.magFilter=za,this.createTexture(r,{width:1,height:1,format:e}),this.defaultTexture[e]=i=r}return this.backend.get(i).texture}_getDefaultCubeTextureGPU(e){let i=this.defaultTexture[e];if(i===void 0){const r=new E9e;r.minFilter=za,r.magFilter=za,this.createTexture(r,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=i=r}return this.backend.get(i).texture}_copyCubeMapToTexture(e,i,r,s){for(let n=0;n<6;n++){const o=e[n],a=s===!0?Noi[n]:n;o.isDataTexture?this._copyBufferToTexture(o.image,i,r,a,s):this._copyImageToTexture(o,i,r,a,s)}}_copyImageToTexture(e,i,r,s,n){this.backend.device.queue.copyExternalImageToTexture({source:e},{texture:i,mipLevel:0,origin:{x:0,y:0,z:s}},{width:e.width,height:e.height,depthOrArrayLayers:1}),n===!0&&this._flipY(i,r,s)}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new Ioi(this.backend.device)),e}_generateMipmaps(e,i,r=0){this._getPassUtils().generateMipmaps(e,i,r)}_flipY(e,i,r=0){this._getPassUtils().flipY(e,i,r)}_copyBufferToTexture(e,i,r,s,n,o=0){const a=this.backend.device,l=e.data,c=this._getBytesPerTexel(r.format),u=e.width*c;a.queue.writeTexture({texture:i,mipLevel:0,origin:{x:0,y:0,z:s}},l,{offset:e.width*e.height*c*o,bytesPerRow:u},{width:e.width,height:e.height,depthOrArrayLayers:1}),n===!0&&this._flipY(i,r,s)}_copyCompressedBufferToTexture(e,i,r){const s=this.backend.device,n=this._getBlockData(r.format);for(let o=0;o<e.length;o++){const a=e[o],l=a.width,c=a.height,u=Math.ceil(l/n.width)*n.byteLength;s.queue.writeTexture({texture:i,mipLevel:o},a.data,{offset:0,bytesPerRow:u},{width:Math.ceil(l/n.width)*n.width,height:Math.ceil(c/n.width)*n.width,depthOrArrayLayers:1})}}_getBlockData(e){if(e===ie.BC1RGBAUnorm||e===ie.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===ie.BC2RGBAUnorm||e===ie.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ie.BC3RGBAUnorm||e===ie.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ie.BC4RUnorm||e===ie.BC4RSNorm)return{byteLength:8,width:4,height:4};if(e===ie.BC5RGUnorm||e===ie.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===ie.BC6HRGBUFloat||e===ie.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===ie.BC7RGBAUnorm||e===ie.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ie.ETC2RGB8Unorm||e===ie.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ie.ETC2RGB8A1Unorm||e===ie.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ie.ETC2RGBA8Unorm||e===ie.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ie.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===ie.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===ie.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===ie.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===ie.ASTC4x4Unorm||e===ie.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ie.ASTC5x4Unorm||e===ie.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===ie.ASTC5x5Unorm||e===ie.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===ie.ASTC6x5Unorm||e===ie.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===ie.ASTC6x6Unorm||e===ie.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===ie.ASTC8x5Unorm||e===ie.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===ie.ASTC8x6Unorm||e===ie.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===ie.ASTC8x8Unorm||e===ie.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===ie.ASTC10x5Unorm||e===ie.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===ie.ASTC10x6Unorm||e===ie.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===ie.ASTC10x8Unorm||e===ie.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===ie.ASTC10x10Unorm||e===ie.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===ie.ASTC12x10Unorm||e===ie.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===ie.ASTC12x12Unorm||e===ie.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let i=RQ.ClampToEdge;return e===NH?i=RQ.Repeat:e===LH&&(i=RQ.MirrorRepeat),i}_convertFilterMode(e){let i=KH.Linear;return(e===za||e===dae||e===C6)&&(i=KH.Nearest),i}_getBytesPerTexel(e){if(e===ie.R8Unorm||e===ie.R8Snorm||e===ie.R8Uint||e===ie.R8Sint)return 1;if(e===ie.R16Uint||e===ie.R16Sint||e===ie.R16Float||e===ie.RG8Unorm||e===ie.RG8Snorm||e===ie.RG8Uint||e===ie.RG8Sint)return 2;if(e===ie.R32Uint||e===ie.R32Sint||e===ie.R32Float||e===ie.RG16Uint||e===ie.RG16Sint||e===ie.RG16Float||e===ie.RGBA8Unorm||e===ie.RGBA8UnormSRGB||e===ie.RGBA8Snorm||e===ie.RGBA8Uint||e===ie.RGBA8Sint||e===ie.BGRA8Unorm||e===ie.BGRA8UnormSRGB||e===ie.RGB9E5UFloat||e===ie.RGB10A2Unorm||e===ie.RG11B10UFloat||e===ie.Depth32Float||e===ie.Depth24Plus||e===ie.Depth24PlusStencil8||e===ie.Depth32FloatStencil8)return 4;if(e===ie.RG32Uint||e===ie.RG32Sint||e===ie.RG32Float||e===ie.RGBA16Uint||e===ie.RGBA16Sint||e===ie.RGBA16Float)return 8;if(e===ie.RGBA32Uint||e===ie.RGBA32Sint||e===ie.RGBA32Float)return 16}_getTypedArrayType(e){if(e===ie.R8Uint)return Uint8Array;if(e===ie.R8Sint)return Int8Array;if(e===ie.R8Unorm)return Uint8Array;if(e===ie.R8Snorm)return Int8Array;if(e===ie.RG8Uint)return Uint8Array;if(e===ie.RG8Sint)return Int8Array;if(e===ie.RG8Unorm)return Uint8Array;if(e===ie.RG8Snorm)return Int8Array;if(e===ie.RGBA8Uint)return Uint8Array;if(e===ie.RGBA8Sint)return Int8Array;if(e===ie.RGBA8Unorm)return Uint8Array;if(e===ie.RGBA8Snorm)return Int8Array;if(e===ie.R16Uint)return Uint16Array;if(e===ie.R16Sint)return Int16Array;if(e===ie.RG16Uint)return Uint16Array;if(e===ie.RG16Sint)return Int16Array;if(e===ie.RGBA16Uint)return Uint16Array;if(e===ie.RGBA16Sint)return Int16Array;if(e===ie.R16Float||e===ie.RG16Float||e===ie.RGBA16Float)return Float32Array;if(e===ie.R32Uint)return Uint32Array;if(e===ie.R32Sint)return Int32Array;if(e===ie.R32Float)return Float32Array;if(e===ie.RG32Uint)return Uint32Array;if(e===ie.RG32Sint)return Int32Array;if(e===ie.RG32Float)return Float32Array;if(e===ie.RGBA32Uint)return Uint32Array;if(e===ie.RGBA32Sint)return Int32Array;if(e===ie.RGBA32Float)return Float32Array;if(e===ie.BGRA8Unorm||e===ie.BGRA8UnormSRGB)return Uint8Array;if(e===ie.RGB10A2Unorm||e===ie.RGB9E5UFloat||e===ie.RG11B10UFloat)return Uint32Array;if(e===ie.Depth32Float)return Float32Array;if(e===ie.Depth24Plus||e===ie.Depth24PlusStencil8)return Uint32Array;if(e===ie.Depth32FloatStencil8)return Float32Array}_getDimension(e){let i;return e.isData3DTexture?i=PMe.ThreeD:i=PMe.TwoD,i}}function rle(t,e=null){const i=t.format,r=t.type,s=t.colorSpace;let n;if(t.isFramebufferTexture===!0&&t.type===G2)n=ie.BGRA8Unorm;else if(t.isCompressedTexture===!0)switch(i){case R6:n=s===di?ie.BC1RGBAUnormSRGB:ie.BC1RGBAUnorm;break;case P6:n=s===di?ie.BC2RGBAUnormSRGB:ie.BC2RGBAUnorm;break;case O6:n=s===di?ie.BC3RGBAUnormSRGB:ie.BC3RGBAUnorm;break;case pae:n=s===di?ie.ETC2RGB8UnormSRGB:ie.ETC2RGB8Unorm;break;case fae:n=s===di?ie.ETC2RGBA8UnormSRGB:ie.ETC2RGBA8Unorm;break;case mae:n=s===di?ie.ASTC4x4UnormSRGB:ie.ASTC4x4Unorm;break;case gae:n=s===di?ie.ASTC5x4UnormSRGB:ie.ASTC5x4Unorm;break;case yae:n=s===di?ie.ASTC5x5UnormSRGB:ie.ASTC5x5Unorm;break;case _ae:n=s===di?ie.ASTC6x5UnormSRGB:ie.ASTC6x5Unorm;break;case vae:n=s===di?ie.ASTC6x6UnormSRGB:ie.ASTC6x6Unorm;break;case bae:n=s===di?ie.ASTC8x5UnormSRGB:ie.ASTC8x5Unorm;break;case wae:n=s===di?ie.ASTC8x6UnormSRGB:ie.ASTC8x6Unorm;break;case xae:n=s===di?ie.ASTC8x8UnormSRGB:ie.ASTC8x8Unorm;break;case Sae:n=s===di?ie.ASTC10x5UnormSRGB:ie.ASTC10x5Unorm;break;case Tae:n=s===di?ie.ASTC10x6UnormSRGB:ie.ASTC10x6Unorm;break;case Eae:n=s===di?ie.ASTC10x8UnormSRGB:ie.ASTC10x8Unorm;break;case Cae:n=s===di?ie.ASTC10x10UnormSRGB:ie.ASTC10x10Unorm;break;case Mae:n=s===di?ie.ASTC12x10UnormSRGB:ie.ASTC12x10Unorm;break;case Aae:n=s===di?ie.ASTC12x12UnormSRGB:ie.ASTC12x12Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",i)}else switch(i){case u$:switch(r){case M6:n=ie.RGBA8Snorm;break;case A6:n=ie.RGBA16Sint;break;case WL:n=ie.RGBA16Uint;break;case xd:n=ie.RGBA32Uint;break;case Im:n=ie.RGBA32Sint;break;case G2:n=s===di?ie.RGBA8UnormSRGB:ie.RGBA8Unorm;break;case vE:n=ie.RGBA16Float;break;case Rd:n=ie.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",r)}break;case ufe:switch(r){case s9e:n=ie.RGB9E5UFloat;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",r)}break;case q7:switch(r){case M6:n=ie.R8Snorm;break;case A6:n=ie.R16Sint;break;case WL:n=ie.R16Uint;break;case xd:n=ie.R32Uint;break;case Im:n=ie.R32Sint;break;case G2:n=ie.R8Unorm;break;case vE:n=ie.R16Float;break;case Rd:n=ie.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",r)}break;case hfe:switch(r){case M6:n=ie.RG8Snorm;break;case A6:n=ie.RG16Sint;break;case WL:n=ie.RG16Uint;break;case xd:n=ie.RG32Uint;break;case Im:n=ie.RG32Sint;break;case G2:n=ie.RG8Unorm;break;case vE:n=ie.RG16Float;break;case Rd:n=ie.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",r)}break;case bE:switch(r){case WL:n=ie.Depth16Unorm;break;case xd:n=ie.Depth24Plus;break;case Rd:n=ie.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",r)}break;case bI:switch(r){case D4:n=ie.Depth24PlusStencil8;break;case Rd:e&&e.features.has(YL.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),n=ie.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",r)}break;case n9e:switch(r){case Im:n=ie.R32Sint;break;case xd:n=ie.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",r)}break;case o9e:switch(r){case Im:n=ie.RG32Sint;break;case xd:n=ie.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",r)}break;case a9e:switch(r){case Im:n=ie.RGBA32Sint;break;case xd:n=ie.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",r)}break;default:console.error("WebGPURenderer: Unsupported texture format.",i)}return n}const Doi=Loi,Foi=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+)?/i,koi=/[a-z_0-9]+|<(.*?)>+/ig,Uoi={f32:"float"},Boi=t=>{t=t.trim();const e=t.match(Foi);if(e!==null&&e.length===4){const i=e[2],r=[];let s=null;for(;(s=koi.exec(i))!==null;)r.push(s);const n=[];let o=0;for(;o<r.length;){const u=r[o++][0];let h=r[o++][0];h=Uoi[h]||h,o<r.length&&r[o][0].startsWith("<")===!0&&o++,n.push(new zfe(h,u))}const a=t.substring(e[0].length),l=e[1]!==void 0?e[1]:"";return{type:e[3]||"void",inputs:n,name:l,inputsCode:i,blockCode:a}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class zoi extends qfe{constructor(e){const{type:i,inputs:r,name:s,inputsCode:n,blockCode:o}=Boi(e);super(i,r,s),this.inputsCode=n,this.blockCode=o}getCode(e=this.name){const i=this.type!=="void"?"-> "+this.type:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${i}`+this.blockCode}}const Voi=zoi;class Goi extends uYe{parseFunction(e){return new Voi(e)}}const joi=Goi,CA=self.GPUShaderStage,qz={vertex:CA?CA.VERTEX:1,fragment:CA?CA.FRAGMENT:2,compute:CA?CA.COMPUTE:4},Hoi={instance:!0,storageBuffer:!0},qoi={"^^":"threejs_xor"},Woi={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",imat2:"mat2x2<i32>",umat2:"mat2x2<u32>",bmat2:"mat2x2<bool>",mat3:"mat3x3<f32>",imat3:"mat3x3<i32>",umat3:"mat3x3<u32>",bmat3:"mat3x3<bool>",mat4:"mat4x4<f32>",imat4:"mat4x4<i32>",umat4:"mat4x4<u32>",bmat4:"mat4x4<bool>"},Yoi={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"threejs_mod_float",mod_vec2:"threejs_mod_vec2",mod_vec3:"threejs_mod_vec3",mod_vec4:"threejs_mod_vec4",equals_bool:"threejs_equals_bool",equals_bvec2:"threejs_equals_bvec2",equals_bvec3:"threejs_equals_bvec3",equals_bvec4:"threejs_equals_bvec4",lessThanEqual:"threejs_lessThanEqual",greaterThan:"threejs_greaterThan",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"},XMe={threejs_xor:new wu(`
fn threejs_xor( a : bool, b : bool ) -> bool {

	return ( a || b ) && !( a && b );

}
`),lessThanEqual:new wu(`
fn threejs_lessThanEqual( a : vec3<f32>, b : vec3<f32> ) -> vec3<bool> {

	return vec3<bool>( a.x <= b.x, a.y <= b.y, a.z <= b.z );

}
`),greaterThan:new wu(`
fn threejs_greaterThan( a : vec3<f32>, b : vec3<f32> ) -> vec3<bool> {

	return vec3<bool>( a.x > b.x, a.y > b.y, a.z > b.z );

}
`),mod_float:new wu("fn threejs_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new wu("fn threejs_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new wu("fn threejs_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new wu("fn threejs_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new wu("fn threejs_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new wu("fn threejs_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new wu("fn threejs_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new wu("fn threejs_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping:new wu(`
fn threejs_repeatWrapping( uv : vec2<f32>, dimension : vec2<u32> ) -> vec2<u32> {

	let uvScaled = vec2<u32>( uv * vec2<f32>( dimension ) );

	return ( ( uvScaled % dimension ) + dimension ) % dimension;

}
`)};class Xoi extends uWe{constructor(e,i,r=null){super(e,i,new joi,r),this.uniformGroups={},this.builtins={}}needsColorSpaceToLinear(e){return e.isVideoTexture===!0&&e.colorSpace!==F4}_generateTextureSample(e,i,r,s,n=this.shaderStage){return n==="fragment"?s?`textureSample( ${i}, ${i}_sampler, ${r}, ${s} )`:`textureSample( ${i}, ${i}_sampler, ${r} )`:this.generateTextureLod(e,i,r)}_generateVideoSample(e,i,r=this.shaderStage){if(r==="fragment")return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${i}.x, 1.0 - ${i}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${r} shader.`)}_generateTextureSampleLevel(e,i,r,s,n,o=this.shaderStage){return o==="fragment"&&this.isUnfilterable(e)===!1?`textureSampleLevel( ${i}, ${i}_sampler, ${r}, ${s} )`:this.generateTextureLod(e,i,r,s)}generateTextureLod(e,i,r,s="0"){this._include("repeatWrapping");const n=`textureDimensions( ${i}, 0 )`;return`textureLoad( ${i}, threejs_repeatWrapping( ${r}, ${n} ), i32( ${s} ) )`}generateTextureLoad(e,i,r,s,n="0u"){return s?`textureLoad( ${i}, ${r}, ${s}, ${n} )`:`textureLoad( ${i}, ${r}, ${n} )`}generateTextureStore(e,i,r,s){return`textureStore( ${i}, ${r}, ${s} )`}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||e.isDataTexture===!0&&e.type===Rd}generateTexture(e,i,r,s,n=this.shaderStage){let o=null;return e.isVideoTexture===!0?o=this._generateVideoSample(i,r,n):this.isUnfilterable(e)?o=this.generateTextureLod(e,i,r,"0",s,n):o=this._generateTextureSample(e,i,r,s,n),o}generateTextureGrad(e,i,r,s,n,o=this.shaderStage){if(o==="fragment")return`textureSampleGrad( ${i}, ${i}_sampler, ${r},  ${s[0]}, ${s[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${o} shader.`)}generateTextureCompare(e,i,r,s,n,o=this.shaderStage){if(o==="fragment")return`textureSampleCompare( ${i}, ${i}_sampler, ${r}, ${s} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}generateTextureLevel(e,i,r,s,n,o=this.shaderStage){let a=null;return e.isVideoTexture===!0?a=this._generateVideoSample(i,r,o):a=this._generateTextureSampleLevel(e,i,r,s,n,o),a}getPropertyName(e,i=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(i==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const r=e.name,s=e.type;return s==="texture"||s==="cubeTexture"||s==="storageTexture"||s==="texture3D"?r:s==="buffer"||s==="storageBuffer"?`NodeBuffer_${e.id}.${r}`:e.groupNode.name+"."+r}return super.getPropertyName(e)}getOutputStructName(){return"output"}_getUniformGroupCount(e){return Object.keys(this.uniforms[e]).length}getFunctionOperator(e){const i=qoi[e];return i!==void 0?(this._include(i),i):null}getStorageAccess(e){if(e.isStorageTextureNode)switch(e.access){case Kae.ReadOnly:return"read";case Kae.WriteOnly:return"write";default:return"read_write"}else return"read_write"}getUniformFromNode(e,i,r,s=null){const n=super.getUniformFromNode(e,i,r,s),o=this.getDataFromNode(e,r,this.globalCache);if(o.uniformGPU===void 0){let a;const l=this.bindings[r];if(i==="texture"||i==="cubeTexture"||i==="storageTexture"||i==="texture3D"){let c=null;if(i==="texture"||i==="storageTexture"?c=new oW(n.name,n.node,e.access?e.access:null):i==="cubeTexture"?c=new KYe(n.name,n.node,e.access?e.access:null):i==="texture3D"&&(c=new eXe(n.name,n.node,e.access?e.access:null)),c.store=e.isStorageTextureNode===!0,c.setVisibility(qz[r]),r==="fragment"&&this.isUnfilterable(e.value)===!1&&c.store===!1){const u=new Eoi(`${n.name}_sampler`,n.node);u.setVisibility(qz[r]),l.push(u,c),a=[u,c]}else l.push(c),a=[c]}else if(i==="buffer"||i==="storageBuffer"){const c=i==="storageBuffer"?Poi:JYe,u=new c(e);u.setVisibility(qz[r]),l.push(u),a=u}else{const c=e.groupNode,u=c.name,h=this.uniformGroups[r]||(this.uniformGroups[r]={});let p=h[u];p===void 0&&(p=new QYe(u,c),p.setVisibility(qz[r]),h[u]=p,l.push(p)),a=this.getNodeUniform(n,i),p.addUniform(a)}o.uniformGPU=a,r==="vertex"&&(this.bindingsOffset.fragment=l.length)}return n}isReference(e){return super.isReference(e)||e==="texture_2d"||e==="texture_cube"||e==="texture_depth_2d"||e==="texture_storage_2d"||e==="texture_3d"}getBuiltin(e,i,r,s=this.shaderStage){const n=this.builtins[s]||(this.builtins[s]=new Map);return n.has(e)===!1&&n.set(e,{name:e,property:i,type:r}),i}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const i=e.layout,r=this.flowShaderNode(e),s=[];for(const o of i.inputs)s.push(o.name+" : "+this.getType(o.type));return`fn ${i.name}( ${s.join(", ")} ) -> ${this.getType(i.type)} {
${r.vars}
${r.code}
	return ${r.result};

}`}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xyz"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}isFlipY(){return!1}getBuiltins(e){const i=[],r=this.builtins[e];if(r!==void 0)for(const{name:s,property:n,type:o}of r.values())i.push(`@builtin( ${s} ) ${n} : ${o}`);return i.join(`,
	`)}getAttributes(e){const i=[];if(e==="compute"&&this.getBuiltin("global_invocation_id","id","vec3<u32>","attribute"),e==="vertex"||e==="compute"){const r=this.getBuiltins("attribute");r&&i.push(r);const s=this.getAttributesArray();for(let n=0,o=s.length;n<o;n++){const a=s[n],l=a.name,c=this.getType(a.type);i.push(`@location( ${n} ) ${l} : ${c}`)}}return i.join(`,
	`)}getStructMembers(e){const i=[],r=e.getMemberTypes();for(let n=0;n<r.length;n++){const o=r[n];i.push(`	@location( ${n} ) m${n} : ${o}<f32>`)}const s=this.getBuiltins("output");return s&&i.push(s),i.join(`,
`)}getStructs(e){const i=[],r=this.structs[e];for(let s=0,n=r.length;s<n;s++){const o=r[s],a=o.name;let l=`struct ${a} {
`;l+=this.getStructMembers(o),l+=`
}`,i.push(l),i.push(`
var<private> output : ${a};

`)}return i.join(`

`)}getVar(e,i){return`var ${i} : ${this.getType(e)}`}getVars(e){const i=[],r=this.vars[e];if(r!==void 0)for(const s of r)i.push(`	${this.getVar(s.type,s.name)};`);return`
${i.join(`
`)}
`}getVaryings(e){const i=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const n=this.varyings,o=this.vars[e];for(let a=0;a<n.length;a++){const l=n[a];if(l.needsInterpolation){let c=`@location( ${a} )`;/^(int|uint|ivec|uvec)/.test(l.type)&&(c+=" @interpolate( flat )"),i.push(`${c} ${l.name} : ${this.getType(l.type)}`)}else e==="vertex"&&o.includes(l)===!1&&o.push(l)}}const r=this.getBuiltins(e);r&&i.push(r);const s=i.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+s):s}getUniforms(e){const i=this.uniforms[e],r=[],s=[],n=[],o={};let a=this.bindingsOffset[e];for(const c of i)if(c.type==="texture"||c.type==="cubeTexture"||c.type==="storageTexture"||c.type==="texture3D"){const u=c.node.value;e==="fragment"&&this.isUnfilterable(u)===!1&&c.node.isStorageTextureNode!==!0&&(u.isDepthTexture===!0&&u.compareFunction!==null?r.push(`@binding( ${a++} ) @group( 0 ) var ${c.name}_sampler : sampler_comparison;`):r.push(`@binding( ${a++} ) @group( 0 ) var ${c.name}_sampler : sampler;`));let h;if(u.isCubeTexture===!0)h="texture_cube<f32>";else if(u.isDataArrayTexture===!0)h="texture_2d_array<f32>";else if(u.isDepthTexture===!0)h="texture_depth_2d";else if(u.isVideoTexture===!0)h="texture_external";else if(u.isData3DTexture===!0)h="texture_3d<f32>";else if(c.node.isStorageTextureNode===!0){const p=rle(u),f=this.getStorageAccess(c.node);h=`texture_storage_2d<${p}, ${f}>`}else h=`texture_2d<${this.getComponentTypeFromTexture(u).charAt(0)}32>`;r.push(`@binding( ${a++} ) @group( 0 ) var ${c.name} : ${h};`)}else if(c.type==="buffer"||c.type==="storageBuffer"){const u=c.node,h=this.getType(u.bufferType),p=u.bufferCount,f=p>0?", "+p:"",g=`	${c.name} : array< ${h}${f} >
`,y=u.isStorageBufferNode?"storage,read_write":"uniform";s.push(this._getWGSLStructBinding("NodeBuffer_"+u.id,g,y,a++))}else{const u=this.getType(this.getVectorType(c.type)),h=c.groupNode.name;(o[h]||(o[h]={index:a++,snippets:[]})).snippets.push(`	${c.name} : ${u}`)}for(const c in o){const u=o[c];n.push(this._getWGSLStructBinding(c,u.snippets.join(`,
`),"uniform",u.index))}let l=r.join(`
`);return l+=s.join(`
`),l+=n.join(`
`),l}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};for(const i in e){const r=e[i];r.uniforms=this.getUniforms(i),r.attributes=this.getAttributes(i),r.varyings=this.getVaryings(i),r.structs=this.getStructs(i),r.vars=this.getVars(i),r.codes=this.getCodes(i);let s=`// code

`;s+=this.flowCode[i];const n=this.flowNodes[i],o=n[n.length-1],a=o.outputNode,l=a!==void 0&&a.isOutputStructNode===!0;for(const c of n){const u=this.getFlowData(c),h=c.name;if(h&&(s.length>0&&(s+=`
`),s+=`	// flow -> ${h}
	`),s+=`${u.code}
	`,c===o&&i!=="compute"){if(s+=`// result

	`,i==="vertex")s+=`varyings.Vertex = ${u.result};`;else if(i==="fragment")if(l)r.returnType=a.nodeType,s+=`return ${u.result};`;else{let p="	@location(0) color: vec4<f32>";const f=this.getBuiltins("output");f&&(p+=`,
	`+f),r.returnType="OutputStruct",r.structs+=this._getWGSLStruct("OutputStruct",p),r.structs+=`
var<private> output : OutputStruct;

`,s+=`output.color = ${u.result};

	return output;`}}}r.flow=s}this.material!==null?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,i=null){let r;return i!==null&&(r=this._getWGSLMethod(e+"_"+i)),r===void 0&&(r=this._getWGSLMethod(e)),r||e}getType(e){return Woi[e]||e}isAvailable(e){return Hoi[e]===!0}_getWGSLMethod(e){return XMe[e]!==void 0&&this._include(e),Yoi[e]}_include(e){const i=XMe[e];return i.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(i),i}_getWGSLVertexCode(e){return`${this.getSignature()}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}

// uniforms
${e.uniforms}

// structs
${e.structs}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,i){return`${this.getSignature()}
// system
var<private> instanceIndex : u32;

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${i} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = id.x;

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,i){return`
struct ${e} {
${i}
};`}_getWGSLStructBinding(e,i,r,s=0,n=0){const o=e+"Struct";return`${this._getWGSLStruct(o,i)}
@binding( ${s} ) @group( ${n} )
var<${r}> ${e} : ${o};`}}const Zoi=Xoi;class Joi{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let i;return e.depthTexture!==null?i=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?i=ie.Depth24PlusStencil8:e.depth&&(i=ie.Depth24Plus),i}getTextureFormatGPU(e){return this.backend.get(e).texture.format}getCurrentColorFormat(e){let i;return e.textures!==null?i=this.getTextureFormatGPU(e.textures[0]):i=ie.BGRA8Unorm,i}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,i){if(e.isPoints)return vP.PointList;if(e.isLineSegments||e.isMesh&&i.wireframe===!0)return vP.LineList;if(e.isLine)return vP.LineStrip;if(e.isMesh)return vP.TriangleList}getSampleCount(e){return e.textures!==null?e.sampleCount:this.backend.parameters.sampleCount}}const Qoi=Joi,Koi=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),eai=new Map([[w9e,["float16"]]]),tai=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class iai{constructor(e){this.backend=e}createAttribute(e,i){const r=this._getBufferAttribute(e),s=this.backend,n=s.get(r);let o=n.buffer;if(o===void 0){const a=s.device;let l=r.array;if(e.normalized===!1&&(l.constructor===Int16Array||l.constructor===Uint16Array)){const u=new Uint32Array(l.length);for(let h=0;h<l.length;h++)u[h]=l[h];l=u}if(r.array=l,(r.isStorageBufferAttribute||r.isStorageInstancedBufferAttribute)&&r.itemSize===3){l=new l.constructor(r.count*4);for(let u=0;u<r.count;u++)l.set(r.array.subarray(u*3,u*3+3),u*4);r.itemSize=4,r.array=l}const c=l.byteLength+(4-l.byteLength%4)%4;o=a.createBuffer({label:r.name,size:c,usage:i,mappedAtCreation:!0}),new l.constructor(o.getMappedRange()).set(l),o.unmap(),n.buffer=o}}updateAttribute(e){const i=this._getBufferAttribute(e),r=this.backend,s=r.device,n=r.get(i).buffer,o=i.array,a=i.updateRanges;if(a.length===0)s.queue.writeBuffer(n,0,o,0);else{for(let l=0,c=a.length;l<c;l++){const u=a[l];s.queue.writeBuffer(n,0,o,u.start*o.BYTES_PER_ELEMENT,u.count*o.BYTES_PER_ELEMENT)}i.clearUpdateRanges()}}createShaderVertexBuffers(e){const i=e.getAttributes(),r=new Map;for(let s=0;s<i.length;s++){const n=i[s],o=n.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(n);let l=r.get(a);if(l===void 0){let h,p;n.isInterleavedBufferAttribute===!0?(h=n.data.stride*o,p=n.data.isInstancedInterleavedBuffer?Vz.Instance:Vz.Vertex):(h=n.itemSize*o,p=n.isInstancedBufferAttribute?Vz.Instance:Vz.Vertex),n.normalized===!1&&(n.array.constructor===Int16Array||n.array.constructor===Uint16Array)&&(h=4),l={arrayStride:h,attributes:[],stepMode:p},r.set(a,l)}const c=this._getVertexFormat(n),u=n.isInterleavedBufferAttribute===!0?n.offset*o:0;l.attributes.push({shaderLocation:s,offset:u,format:c})}return Array.from(r.values())}destroyAttribute(e){const i=this.backend;i.get(this._getBufferAttribute(e)).buffer.destroy(),i.delete(e)}async getArrayBufferAsync(e){const i=this.backend,r=i.device,s=i.get(this._getBufferAttribute(e)),n=s.buffer,o=n.size;let a=s.readBuffer,l=!0;a===void 0&&(a=r.createBuffer({label:e.name,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),l=!1,s.readBuffer=a);const c=r.createCommandEncoder({});c.copyBufferToBuffer(n,0,a,0,o),l&&a.unmap();const u=c.finish();return r.queue.submit([u]),await a.mapAsync(GPUMapMode.READ),a.getMappedRange()}_getVertexFormat(e){const{itemSize:i,normalized:r}=e,s=e.array.constructor,n=e.constructor;let o;if(i==1)o=tai.get(s);else{const l=(eai.get(n)||Koi.get(s))[r?1:0];if(l){const c=s.BYTES_PER_ELEMENT*i,h=Math.floor((c+3)/4)*4/s.BYTES_PER_ELEMENT;if(h%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${l}x${h}`}}return o||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),o}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}const rai=iai;class sai{constructor(e){this.backend=e}createBindingsLayout(e){const r=this.backend.device,s=[];let n=0;for(const o of e){const a={binding:n++,visibility:o.visibility};if(o.isUniformBuffer||o.isStorageBuffer){const l={};o.isStorageBuffer&&(l.type=hii.Storage),a.buffer=l}else if(o.isSampler){const l={};o.texture.isDepthTexture&&o.texture.compareFunction!==null&&(l.type="comparison"),a.sampler=l}else if(o.isSampledTexture&&o.texture.isVideoTexture)a.externalTexture={};else if(o.isSampledTexture&&o.store){const l=this.backend.get(o.texture).texture.format,c=o.access;a.storageTexture={format:l,access:c}}else if(o.isSampledTexture){const l={};if(o.texture.isDepthTexture)l.sampleType=zz.Depth;else if(o.texture.isDataTexture){const c=o.texture.type;c===Im?l.sampleType=zz.SInt:c===xd?l.sampleType=zz.UInt:c===Rd&&(l.sampleType=zz.UnfilterableFloat)}o.isSampledCubeTexture?l.viewDimension=Vp.Cube:o.texture.isDataArrayTexture?l.viewDimension=Vp.TwoDArray:o.isSampledTexture3D&&(l.viewDimension=Vp.ThreeD),a.texture=l}else console.error(`WebGPUBindingUtils: Unsupported binding "${o}".`);s.push(a)}return r.createBindGroupLayout({entries:s})}createBindings(e){const r=this.backend.get(e),s=this.createBindingsLayout(e),n=this.createBindGroup(e,s);r.layout=s,r.group=n,r.bindings=e}updateBinding(e){const i=this.backend,r=i.device,s=e.buffer,n=i.get(e).buffer;r.queue.writeBuffer(n,0,s,0)}createBindGroup(e,i){const r=this.backend,s=r.device;let n=0;const o=[];for(const a of e){if(a.isUniformBuffer){const l=r.get(a);if(l.buffer===void 0){const c=a.byteLength,u=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,h=s.createBuffer({label:"bindingBuffer_"+a.name,size:c,usage:u});l.buffer=h}o.push({binding:n,resource:{buffer:l.buffer}})}else if(a.isStorageBuffer){const l=r.get(a);if(l.buffer===void 0){const c=a.attribute;l.buffer=r.get(c).buffer}o.push({binding:n,resource:{buffer:l.buffer}})}else if(a.isSampler){const l=r.get(a.texture);o.push({binding:n,resource:l.sampler})}else if(a.isSampledTexture){const l=r.get(a.texture);let c;a.isSampledCubeTexture?c=Vp.Cube:a.isSampledTexture3D?c=Vp.ThreeD:a.texture.isDataArrayTexture?c=Vp.TwoDArray:c=Vp.TwoD;let u;if(l.externalTexture!==void 0)u=s.importExternalTexture({source:l.externalTexture});else{const h=dii.All;u=l.texture.createView({aspect:h,dimension:c,mipLevelCount:a.store?1:l.mipLevelCount})}o.push({binding:n,resource:u})}n++}return s.createBindGroup({layout:i,entries:o})}}const nai=sai;class oai{constructor(e){this.backend=e}_getSampleCount(e){let i=this.backend.utils.getSampleCount(e);return i>1&&(i=Math.pow(2,Math.floor(Math.log2(i))),i===2&&(i=4)),i}createRenderPipeline(e,i){const{object:r,material:s,geometry:n,pipeline:o}=e,{vertexProgram:a,fragmentProgram:l}=o,c=this.backend,u=c.device,h=c.utils,p=c.get(o),f=c.get(e.getBindings()),g=c.attributeUtils.createShaderVertexBuffers(e);let y;s.transparent===!0&&s.blending!==vI&&(y=this._getBlending(s));let v={};s.stencilWrite===!0&&(v={compare:this._getStencilCompare(s),failOp:this._getStencilOperation(s.stencilFail),depthFailOp:this._getStencilOperation(s.stencilZFail),passOp:this._getStencilOperation(s.stencilZPass)});const b=this._getColorWriteMask(s),w=[];if(e.context.textures!==null){const D=e.context.textures;for(let z=0;z<D.length;z++){const B=h.getTextureFormatGPU(D[z]);w.push({format:B,blend:y,writeMask:b})}}else{const D=h.getCurrentColorFormat(e.context);w.push({format:D,blend:y,writeMask:b})}const x=c.get(a).module,S=c.get(l).module,E=this._getPrimitiveState(r,n,s),C=this._getDepthCompare(s),R=h.getCurrentDepthStencilFormat(e.context),I=this._getSampleCount(e.context),F={label:"renderPipeline",vertex:Object.assign({},x,{buffers:g}),fragment:Object.assign({},S,{targets:w}),primitive:E,depthStencil:{format:R,depthWriteEnabled:s.depthWrite,depthCompare:C,stencilFront:v,stencilBack:{},stencilReadMask:s.stencilFuncMask,stencilWriteMask:s.stencilWriteMask},multisample:{count:I,alphaToCoverageEnabled:s.alphaToCoverage},layout:u.createPipelineLayout({bindGroupLayouts:[f.layout]})};if(i===null)p.pipeline=u.createRenderPipeline(F);else{const D=new Promise(z=>{u.createRenderPipelineAsync(F).then(B=>{p.pipeline=B,z()})});i.push(D)}}createBundleEncoder(e,i){const r=this.backend,{utils:s,device:n}=r,o=r.get(e),a=r.get(i),l=s.getCurrentDepthStencilFormat(e),c=s.getCurrentColorFormat(e),u=this._getSampleCount(i.context),h={label:"renderBundleEncoder",colorFormats:[c],depthStencilFormat:l,sampleCount:u},p=n.createRenderBundleEncoder(h);return a.bundleEncoder=p,o.currentSets={attributes:{}},o._renderBundleViewport=e.width+"_"+e.height,p}createComputePipeline(e,i){const r=this.backend,s=r.device,n=r.get(e.computeProgram).module,o=r.get(e),a=r.get(i);o.pipeline=s.createComputePipeline({compute:n,layout:s.createPipelineLayout({bindGroupLayouts:[a.layout]})})}_getBlending(e){let i,r;const s=e.blending,n=e.blendSrc,o=e.blendDst,a=e.blendEquation;if(s===kqe){const l=e.blendSrcAlpha!==null?e.blendSrcAlpha:n,c=e.blendDstAlpha!==null?e.blendDstAlpha:o,u=e.blendEquationAlpha!==null?e.blendEquationAlpha:a;i={srcFactor:this._getBlendFactor(n),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(a)},r={srcFactor:this._getBlendFactor(l),dstFactor:this._getBlendFactor(c),operation:this._getBlendOperation(u)}}else{const l=e.premultipliedAlpha,c=(u,h,p,f)=>{i={srcFactor:u,dstFactor:h,operation:eT.Add},r={srcFactor:p,dstFactor:f,operation:eT.Add}};if(l)switch(s){case yE:c($i.SrcAlpha,$i.OneMinusSrcAlpha,$i.One,$i.OneMinusSrcAlpha);break;case ck:c($i.SrcAlpha,$i.One,$i.One,$i.One);break;case AH:c($i.Zero,$i.OneMinusSrc,$i.Zero,$i.One);break;case RH:c($i.Zero,$i.Src,$i.Zero,$i.SrcAlpha);break}else switch(s){case yE:c($i.SrcAlpha,$i.OneMinusSrcAlpha,$i.One,$i.OneMinusSrcAlpha);break;case ck:c($i.SrcAlpha,$i.One,$i.SrcAlpha,$i.One);break;case AH:c($i.Zero,$i.OneMinusSrc,$i.Zero,$i.One);break;case RH:c($i.Zero,$i.Src,$i.Zero,$i.Src);break}}if(i!==void 0&&r!==void 0)return{color:i,alpha:r};console.error("THREE.WebGPURenderer: Invalid blending: ",s)}_getBlendFactor(e){let i;switch(e){case zqe:i=$i.Zero;break;case Vqe:i=$i.One;break;case Gqe:i=$i.Src;break;case jqe:i=$i.OneMinusSrc;break;case PH:i=$i.SrcAlpha;break;case OH:i=$i.OneMinusSrcAlpha;break;case Wqe:i=$i.Dst;break;case Yqe:i=$i.OneMinusDstColor;break;case Hqe:i=$i.DstAlpha;break;case qqe:i=$i.OneMinusDstAlpha;break;case Xqe:i=$i.SrcAlphaSaturated;break;case Ysi:i=$i.Constant;break;case Xsi:i=$i.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return i}_getStencilCompare(e){let i;const r=e.stencilFunc;switch(r){case iJt:i=Ll.Never;break;case Pae:i=Ll.Always;break;case rJt:i=Ll.Less;break;case nJt:i=Ll.LessEqual;break;case sJt:i=Ll.Equal;break;case lJt:i=Ll.GreaterEqual;break;case oJt:i=Ll.Greater;break;case aJt:i=Ll.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",r)}return i}_getStencilOperation(e){let i;switch(e){case c2:i=lb.Keep;break;case XZt:i=lb.Zero;break;case ZZt:i=lb.Replace;break;case tJt:i=lb.Invert;break;case JZt:i=lb.IncrementClamp;break;case QZt:i=lb.DecrementClamp;break;case KZt:i=lb.IncrementWrap;break;case eJt:i=lb.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",i)}return i}_getBlendOperation(e){let i;switch(e){case pw:i=eT.Add;break;case Uqe:i=eT.Subtract;break;case Bqe:i=eT.ReverseSubtract;break;case IZt:i=eT.Min;break;case $Zt:i=eT.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return i}_getPrimitiveState(e,i,r){const s={},n=this.backend.utils;switch(s.topology=n.getPrimitiveTopology(e,r),i.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(s.stripIndexFormat=i.index.array instanceof Uint16Array?TI.Uint16:TI.Uint32),r.side){case lk:s.frontFace=MQ.CCW,s.cullMode=AQ.Back;break;case m1:s.frontFace=MQ.CCW,s.cullMode=AQ.Front;break;case MH:s.frontFace=MQ.CCW,s.cullMode=AQ.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",r.side);break}return s}_getColorWriteMask(e){return e.colorWrite===!0?RMe.All:RMe.None}_getDepthCompare(e){let i;if(e.depthTest===!1)i=Ll.Always;else{const r=e.depthFunc;switch(r){case Zqe:i=Ll.Never;break;case Jqe:i=Ll.Always;break;case Qqe:i=Ll.Less;break;case IH:i=Ll.LessEqual;break;case Kqe:i=Ll.Equal;break;case e9e:i=Ll.GreaterEqual;break;case t9e:i=Ll.Greater;break;case i9e:i=Ll.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",r)}}return i}}const aai=oai;class lai extends tXe{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.antialias=e.antialias===!0,this.parameters.antialias===!0?this.parameters.sampleCount=e.sampleCount===void 0?4:e.sampleCount:this.parameters.sampleCount=1,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.trackTimestamp=e.trackTimestamp===!0,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new Qoi(this),this.attributeUtils=new rai(this),this.bindingUtils=new nai(this),this.pipelineUtils=new aai(this),this.textureUtils=new Doi(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const i=this.parameters;let r;if(i.device===void 0){const o={powerPreference:i.powerPreference},a=await navigator.gpu.requestAdapter(o);if(a===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const l=Object.values(YL),c=[];for(const h of l)a.features.has(h)&&c.push(h);const u={requiredFeatures:c,requiredLimits:i.requiredLimits};r=await a.requestDevice(u)}else r=i.device;const s=i.context!==void 0?i.context:e.domElement.getContext("webgpu");this.device=r,this.context=s;const n=i.alpha?"premultiplied":"opaque";this.context.configure({device:this.device,format:ie.BGRA8Unorm,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:n}),this.updateSize()}get coordinateSystem(){return aC}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;const i=this.parameters.antialias;if(e===null){const s=this.renderer;e={colorAttachments:[{view:null}],depthStencilAttachment:{view:this.textureUtils.getDepthBuffer(s.depth,s.stencil).createView()}};const n=e.colorAttachments[0];i===!0?n.view=this.colorBuffer.createView():n.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const r=e.colorAttachments[0];return i===!0?r.resolveTarget=this.context.getCurrentTexture().createView():r.view=this.context.getCurrentTexture().createView(),e}_getRenderPassDescriptor(e){const i=e.renderTarget,r=this.get(i);let s=r.descriptors;s===void 0&&(s=[],r.descriptors=s),(r.width!==i.width||r.height!==i.height||r.activeMipmapLevel!==i.activeMipmapLevel||r.samples!==i.samples)&&(s.length=0);let n=s[e.activeCubeFace];if(n===void 0){const o=e.textures,a=[];for(let u=0;u<o.length;u++){const h=this.get(o[u]),p=h.texture.createView({baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,dimension:Vp.TwoD});let f,g;h.msaaTexture!==void 0?(f=h.msaaTexture.createView(),g=p):(f=p,g=void 0),a.push({view:f,resolveTarget:g,loadOp:ca.Load,storeOp:zl.Store})}const c={view:this.get(e.depthTexture).texture.createView()};n={colorAttachments:a,depthStencilAttachment:c},s[e.activeCubeFace]=n,r.width=i.width,r.height=i.height,r.samples=i.samples,r.activeMipmapLevel=i.activeMipmapLevel}return n}beginRender(e){const i=this.get(e),r=this.device,s=e.occlusionQueryCount;let n;s>0&&(i.currentOcclusionQuerySet&&i.currentOcclusionQuerySet.destroy(),i.currentOcclusionQueryBuffer&&i.currentOcclusionQueryBuffer.destroy(),i.currentOcclusionQuerySet=i.occlusionQuerySet,i.currentOcclusionQueryBuffer=i.occlusionQueryBuffer,i.currentOcclusionQueryObjects=i.occlusionQueryObjects,n=r.createQuerySet({type:"occlusion",count:s}),i.occlusionQuerySet=n,i.occlusionQueryIndex=0,i.occlusionQueryObjects=new Array(s),i.lastOcclusionObject=null);let o;e.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(e),this.initTimestampQuery(e,o),o.occlusionQuerySet=n;const a=o.depthStencilAttachment;if(e.textures!==null){const u=o.colorAttachments;for(let h=0;h<u.length;h++){const p=u[h];e.clearColor?(p.clearValue=e.clearColorValue,p.loadOp=ca.Clear,p.storeOp=zl.Store):(p.loadOp=ca.Load,p.storeOp=zl.Store)}}else{const u=o.colorAttachments[0];e.clearColor?(u.clearValue=e.clearColorValue,u.loadOp=ca.Clear,u.storeOp=zl.Store):(u.loadOp=ca.Load,u.storeOp=zl.Store)}e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=ca.Clear,a.depthStoreOp=zl.Store):(a.depthLoadOp=ca.Load,a.depthStoreOp=zl.Store)),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=ca.Clear,a.stencilStoreOp=zl.Store):(a.stencilLoadOp=ca.Load,a.stencilStoreOp=zl.Store));const l=r.createCommandEncoder({label:"renderContext_"+e.id}),c=l.beginRenderPass(o);if(i.descriptor=o,i.encoder=l,i.currentPass=c,i.currentSets={attributes:{}},e.viewport&&this.updateViewport(e),e.scissor){const{x:u,y:h,width:p,height:f}=e.scissorValue;c.setScissorRect(u,e.height-f-h,p,f)}}finishRender(e){const i=this.get(e),r=e.occlusionQueryCount;if(i.renderBundles!==void 0&&i.renderBundles.length>0&&(i.registerBundlesPhase=!1,i.currentPass.executeBundles(i.renderBundles)),r>i.occlusionQueryIndex&&i.currentPass.endOcclusionQuery(),i.currentPass.end(),r>0){const s=r*8;let n=this.occludedResolveCache.get(s);n===void 0&&(n=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(s,n));const o=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});i.encoder.resolveQuerySet(i.occlusionQuerySet,0,r,n,0),i.encoder.copyBufferToBuffer(n,0,o,0,s),i.occlusionQueryBuffer=o,this.resolveOccludedAsync(e)}if(this.prepareTimestampBuffer(e,i.encoder),this.device.queue.submit([i.encoder.finish()]),e.textures!==null){const s=e.textures;for(let n=0;n<s.length;n++){const o=s[n];o.generateMipmaps===!0&&this.textureUtils.generateMipmaps(o)}}}isOccluded(e,i){const r=this.get(e);return r.occluded&&r.occluded.has(i)}async resolveOccludedAsync(e){const i=this.get(e),{currentOcclusionQueryBuffer:r,currentOcclusionQueryObjects:s}=i;if(r&&s){const n=new WeakSet;i.currentOcclusionQueryObjects=null,i.currentOcclusionQueryBuffer=null,await r.mapAsync(GPUMapMode.READ);const o=r.getMappedRange(),a=new BigUint64Array(o);for(let l=0;l<s.length;l++)a[l]!==0n&&n.add(s[l]);r.destroy(),i.occluded=n}}updateViewport(e){const{currentPass:i}=this.get(e),{x:r,y:s,width:n,height:o,minDepth:a,maxDepth:l}=e.viewportValue;i.setViewport(r,e.height-o-s,n,o,a,l)}clear(e,i,r,s=null){const n=this.device,o=this.renderer;let a=[],l,c,u,h;if(e){const g=this.getClearColor();c={r:g.r,g:g.g,b:g.b,a:g.a}}if(s===null){u=o.depth,h=o.stencil;const g=this._getDefaultRenderPassDescriptor();if(e){a=g.colorAttachments;const y=a[0];y.clearValue=c,y.loadOp=ca.Clear,y.storeOp=zl.Store}(u||h)&&(l=g.depthStencilAttachment)}else{if(u=s.depth,h=s.stencil,e)for(const g of s.textures){const y=this.get(g),v=y.texture.createView();let b,w;y.msaaTexture!==void 0?(b=y.msaaTexture.createView(),w=v):(b=v,w=void 0),a.push({view:b,resolveTarget:w,clearValue:c,loadOp:ca.Clear,storeOp:zl.Store})}(u||h)&&(l={view:this.get(s.depthTexture).texture.createView()})}u&&(i?(l.depthLoadOp=ca.Clear,l.depthClearValue=o.getClearDepth(),l.depthStoreOp=zl.Store):(l.depthLoadOp=ca.Load,l.depthStoreOp=zl.Store)),h&&(r?(l.stencilLoadOp=ca.Clear,l.stencilClearValue=o.getClearStencil(),l.stencilStoreOp=zl.Store):(l.stencilLoadOp=ca.Load,l.stencilStoreOp=zl.Store));const p=n.createCommandEncoder({});p.beginRenderPass({colorAttachments:a,depthStencilAttachment:l}).end(),n.queue.submit([p.finish()])}beginCompute(e){const i=this.get(e),r={};this.initTimestampQuery(e,r),i.cmdEncoderGPU=this.device.createCommandEncoder(),i.passEncoderGPU=i.cmdEncoderGPU.beginComputePass(r)}compute(e,i,r,s){const{passEncoderGPU:n}=this.get(e),o=this.get(s).pipeline;n.setPipeline(o);const a=this.get(r).group;n.setBindGroup(0,a),n.dispatchWorkgroups(i.dispatchCount)}finishCompute(e){const i=this.get(e);i.passEncoderGPU.end(),this.prepareTimestampBuffer(e,i.cmdEncoderGPU),this.device.queue.submit([i.cmdEncoderGPU.finish()])}draw(e,i){const{object:r,geometry:s,context:n,pipeline:o}=e,a=this.get(e.getBindings()),l=this.get(n),c=this.get(o).pipeline,u=l.currentSets,h=this.get(e),{bundleEncoder:p,renderBundle:f,lastPipelineGPU:g}=h,y=this.get(n);if(y.registerBundlesPhase===!0&&p!==void 0&&g===c){y.renderBundles.push(f);return}const v=this.renderer._currentRenderBundle?this.createBundleEncoder(n,e):l.currentPass;u.pipeline!==c&&(v.setPipeline(c),u.pipeline=c);const b=a.group;v.setBindGroup(0,b);const w=e.getIndex(),x=w!==null;if(x===!0&&u.index!==w){const I=this.get(w).buffer,F=w.array instanceof Uint16Array?TI.Uint16:TI.Uint32;v.setIndexBuffer(I,F),u.index=w}const S=e.getVertexBuffers();for(let I=0,F=S.length;I<F;I++){const D=S[I];if(u.attributes[I]!==D){const z=this.get(D).buffer;v.setVertexBuffer(I,z),u.attributes[I]=D}}if(l.occlusionQuerySet!==void 0){const I=l.lastOcclusionObject;I!==r&&(I!==null&&I.occlusionTest===!0&&(v.endOcclusionQuery(),l.occlusionQueryIndex++),r.occlusionTest===!0&&(v.beginOcclusionQuery(l.occlusionQueryIndex),l.occlusionQueryObjects[l.occlusionQueryIndex]=r),l.lastOcclusionObject=r)}const E=e.drawRange,C=E.start,R=this.getInstanceCount(e);if(R!==0){if(x===!0){const I=E.count!==1/0?E.count:w.count;v.drawIndexed(I,R,C,0,0),i.update(r,I,R)}else{const I=s.attributes.position,F=E.count!==1/0?E.count:I.count;v.draw(F,R,C,0),i.update(r,F,R)}if(this.renderer._currentRenderBundle){const I=v.finish();h.lastPipelineGPU=c,h.renderBundle=I,h.bundleEncoder=v}}}needsRenderUpdate(e){const i=this.get(e),{object:r,material:s}=e,n=this.utils,o=n.getSampleCount(e.context),a=n.getCurrentColorSpace(e.context),l=n.getCurrentColorFormat(e.context),c=n.getCurrentDepthStencilFormat(e.context),u=n.getPrimitiveTopology(r,s);let h=!1;return(i.material!==s||i.materialVersion!==s.version||i.transparent!==s.transparent||i.blending!==s.blending||i.premultipliedAlpha!==s.premultipliedAlpha||i.blendSrc!==s.blendSrc||i.blendDst!==s.blendDst||i.blendEquation!==s.blendEquation||i.blendSrcAlpha!==s.blendSrcAlpha||i.blendDstAlpha!==s.blendDstAlpha||i.blendEquationAlpha!==s.blendEquationAlpha||i.colorWrite!==s.colorWrite||i.depthWrite!==s.depthWrite||i.depthTest!==s.depthTest||i.depthFunc!==s.depthFunc||i.stencilWrite!==s.stencilWrite||i.stencilFunc!==s.stencilFunc||i.stencilFail!==s.stencilFail||i.stencilZFail!==s.stencilZFail||i.stencilZPass!==s.stencilZPass||i.stencilFuncMask!==s.stencilFuncMask||i.stencilWriteMask!==s.stencilWriteMask||i.side!==s.side||i.alphaToCoverage!==s.alphaToCoverage||i.sampleCount!==o||i.colorSpace!==a||i.colorFormat!==l||i.depthStencilFormat!==c||i.primitiveTopology!==u||i.clippingContextVersion!==e.clippingContextVersion)&&(i.material=s,i.materialVersion=s.version,i.transparent=s.transparent,i.blending=s.blending,i.premultipliedAlpha=s.premultipliedAlpha,i.blendSrc=s.blendSrc,i.blendDst=s.blendDst,i.blendEquation=s.blendEquation,i.blendSrcAlpha=s.blendSrcAlpha,i.blendDstAlpha=s.blendDstAlpha,i.blendEquationAlpha=s.blendEquationAlpha,i.colorWrite=s.colorWrite,i.depthWrite=s.depthWrite,i.depthTest=s.depthTest,i.depthFunc=s.depthFunc,i.stencilWrite=s.stencilWrite,i.stencilFunc=s.stencilFunc,i.stencilFail=s.stencilFail,i.stencilZFail=s.stencilZFail,i.stencilZPass=s.stencilZPass,i.stencilFuncMask=s.stencilFuncMask,i.stencilWriteMask=s.stencilWriteMask,i.side=s.side,i.alphaToCoverage=s.alphaToCoverage,i.sampleCount=o,i.colorSpace=a,i.colorFormat=l,i.depthStencilFormat=c,i.primitiveTopology=u,i.clippingContextVersion=e.clippingContextVersion,h=!0),h}getRenderCacheKey(e){const{object:i,material:r}=e,s=this.utils,n=e.context;return[r.transparent,r.blending,r.premultipliedAlpha,r.blendSrc,r.blendDst,r.blendEquation,r.blendSrcAlpha,r.blendDstAlpha,r.blendEquationAlpha,r.colorWrite,r.depthWrite,r.depthTest,r.depthFunc,r.stencilWrite,r.stencilFunc,r.stencilFail,r.stencilZFail,r.stencilZPass,r.stencilFuncMask,r.stencilWriteMask,r.side,s.getSampleCount(n),s.getCurrentColorSpace(n),s.getCurrentColorFormat(n),s.getCurrentDepthStencilFormat(n),s.getPrimitiveTopology(i,r),e.clippingContextVersion].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,i){this.textureUtils.createTexture(e,i)}updateTexture(e,i){this.textureUtils.updateTexture(e,i)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}copyTextureToBuffer(e,i,r,s,n){return this.textureUtils.copyTextureToBuffer(e,i,r,s,n)}initTimestampQuery(e,i){if(!this.hasFeature(YL.TimestampQuery)||!this.trackTimestamp)return;const r=this.get(e);if(!r.timeStampQuerySet){const s=this.device.createQuerySet({type:"timestamp",count:2});Object.assign(i,{timestampWrites:{querySet:s,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}),r.timeStampQuerySet=s}}prepareTimestampBuffer(e,i){if(!this.hasFeature(YL.TimestampQuery)||!this.trackTimestamp)return;const r=this.get(e),s=2*BigInt64Array.BYTES_PER_ELEMENT,n=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),o=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});i.resolveQuerySet(r.timeStampQuerySet,0,2,n,0),i.copyBufferToBuffer(n,0,o,0,s),r.currentTimestampQueryBuffer=o}async resolveTimestampAsync(e,i="render"){if(!this.hasFeature(YL.TimestampQuery)||!this.trackTimestamp)return;const r=this.get(e),{currentTimestampQueryBuffer:s}=r;if(s===void 0)return;const n=s;try{await n.mapAsync(GPUMapMode.READ);const o=new BigUint64Array(n.getMappedRange()),a=Number(o[1]-o[0])/1e6;this.renderer.info.updateTimestamp(i,a)}catch(o){console.error(`Error mapping buffer: ${o}`)}finally{n.unmap()}}createNodeBuilder(e,i,r=null){return new Zoi(e,i,r)}createProgram(e){const i=this.get(e);i.module={module:this.device.createShaderModule({code:e.code,label:e.stage}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,i){this.pipelineUtils.createRenderPipeline(e,i)}createComputePipeline(e,i){this.pipelineUtils.createComputePipeline(e,i)}createBundleEncoder(e,i){return this.pipelineUtils.createBundleEncoder(e,i)}createBindings(e){this.bindingUtils.createBindings(e)}updateBindings(e){this.bindingUtils.createBindings(e)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,i,r=null,s=null,n=0){let o=0,a=0;s!==null&&(o=s.x,a=s.y);const l=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+i.id}),c=this.get(e).texture,u=this.get(i).texture;l.copyTextureToTexture({texture:c,mipLevel:n,origin:{x:0,y:0,z:0}},{texture:u,mipLevel:n,origin:{x:o,y:a,z:0}},[e.image.width,e.image.height]),this.device.queue.submit([l.finish()])}copyFramebufferToTexture(e,i){const r=this.get(i),{encoder:s,descriptor:n}=r;let o=null;i.renderTarget?e.isDepthTexture?o=this.get(i.depthTexture).texture:o=this.get(i.textures[0]).texture:e.isDepthTexture?o=this.textureUtils.getDepthBuffer(i.depth,i.stencil):o=this.context.getCurrentTexture();const a=this.get(e).texture;if(o.format!==a.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",o.format,a.format);return}r.currentPass.end(),s.copyTextureToTexture({texture:o,origin:{x:0,y:0,z:0}},{texture:a},[e.image.width,e.image.height]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e),n.colorAttachments[0].loadOp=ca.Load,i.depth&&(n.depthStencilAttachment.depthLoadOp=ca.Load),i.stencil&&(n.depthStencilAttachment.stencilLoadOp=ca.Load),r.currentPass=s.beginRenderPass(n),r.currentSets={attributes:{}}}}const cai=lai;class uai extends Bni{constructor(e={}){let i;e.forceWebGL?i=YMe:ksi.isAvailable()?i=cai:(i=YMe,console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."));const r=new i(e);super(r,e),this.isWebGPURenderer=!0}}const hai=uai;var dai=Object.defineProperty,pai=Object.getOwnPropertyDescriptor,fai=(t,e,i,r)=>{for(var s=r>1?void 0:r?pai(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&dai(e,i,s),s};let sle=class extends e${constructor(){super(...arguments),this._scene=new yfe,this._camera=new Ny,this._ambient=new D9e(16777215,.5),this._sun=new L9e(16777215,.5),this._smoke=new dQt().load("textures/opengameart/smoke1.png")}initialize(){this.consumes.required.push("transparent-color"),this.produces="disabled",this._renderer=new hai({forceWebGL:!0,context:this.gl,premultipliedAlpha:!1}),this._renderer.autoClearDepth=this._renderer.autoClearStencil=this._renderer.autoClearColor=!1;var t=this._renderer.setRenderTarget.bind(this._renderer);const e=this;this._renderer.setRenderTarget=function(i){t(i),i==null&&e.bindRenderTarget()},this._scene.add(this._ambient),this._scene.add(this._sun),this._renderer.init(),this._renderer.autoClear=!1}render(t){const e=this.camera.viewport,i=this.camera;this._camera.position.set(i.eye[0],i.eye[1],i.eye[2]),this._camera.up.set(i.up[0],i.up[1],i.up[2]),this._camera.lookAt(new ve(i.center[0],i.center[1],i.center[2])),this._camera.projectionMatrix.fromArray(i.projectionMatrix);const r=this.sunLight;this._sun.position.set(r.direction[0],r.direction[1],r.direction[2]),this._sun.intensity=r.diffuse.intensity,this._sun.color=new ds(r.diffuse.color[0],r.diffuse.color[1],r.diffuse.color[2]),this._ambient.intensity=r.ambient.intensity,this._ambient.color=new ds(r.ambient.color[0],r.ambient.color[1],r.ambient.color[2]),this._renderer.setDrawingBufferSize(e[2],e[3],window.devicePixelRatio);const s=this.bindRenderTarget();return this.resetWebGLState(),this._renderer._renderScene(this._scene,this._camera,!1),this.requestRender(),s}resetWebGLState(){const t=this.gl;t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ONE),t.depthFunc(t.LEQUAL);const e=this._renderer.backend.state;for(const i in e.currentBoundTextures){const r=e.currentBoundTextures[i];typeof r=="object"&&"texture"in r&&"type"in r&&(t.activeTexture(Number(i)),t.bindTexture(r.type,r.texture))}for(const i in e.enabled)!!e.enabled[i]?t.enable(Number(i)):t.disable(Number(i))}addFire(t){var e=[0,0,0];if(!g6t(this.view,[t.x,t.y,t.z??0],0,t.spatialReference,e,0,1))return;const i=B3(.1,1),r=B3(new ve(-2*Dl,-2*Dl,3*Dl),new ve(2*Dl,2*Dl,5*Dl)),s=_We(.2,1),n=s.mul(i).mod(1),o=B3(.3*Dl,2*Dl),a=B3(.1*Dl,4*Dl),l=n.div(i),c=Xa.y.oneMinus().max(.2),h=xa(this._smoke,Ef().rotateUV(s.mul(a))).a.mul(l.oneMinus()),p=Po($R(2888961),$R(2236962),Xa.y.mul(3).clamp()),f=new tle;f.colorNode=Po($R(15891724),p,l.mul(2.5).min(1)).mul(c),f.opacityNode=h,f.positionNode=r.mul(n),f.scaleNode=o.mul(n.max(.3)),f.depthWrite=!1,f.transparent=!0;const g=new VCe(new UH(1,1),f,2e3);g.scale.setScalar(400),g.position.x=e[0],g.position.y=e[1],g.position.z=e[2]+100*Dl,this._scene.add(g);const y=new tle;y.colorNode=Po($R(12005143),$R(12005143),l),y.positionNode=B3(new ve(-1*Dl,-1*Dl,1*Dl),new ve(1*Dl,1*Dl,2*Dl)).mul(n),y.scaleNode=f.scaleNode,y.opacityNode=h,y.blending=ck,y.transparent=!0,y.depthWrite=!1;const v=new VCe(new UH(1,1),y,100);v.scale.setScalar(400),v.position.x=e[0],v.position.y=e[1],v.position.z=e[2],v.renderOrder=1,this._scene.add(v),this.produces="transparent-color"}};sle=fai([N("UC2024-real-time-occupancy.stores.FireRenderNode")],sle);const Dl=.01;var mai=Object.defineProperty,gai=Object.getOwnPropertyDescriptor,Y4=(t,e,i,r)=>{for(var s=r>1?void 0:r?gai(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&mai(e,i,s),s};async function yai(t){const e=await $qe(_Zt,["start_time"]),i=new Sx({timeField:"start_time",features:e});return i.receptor=vZt(t),i}let hC=class extends Fe{constructor(t){super(t),this.userStore=new AZt,this._fires=null;const e=t.view;e.when(async()=>{this._fires=new sle({view:e}),this._addEventHandlers(),await this.map.loadAll();const i=this.map.allLayers.find(({title:n})=>n==="Lee building - occupancy"),r=await yai(i);r.start(),this.player=r;const s=r.receptor;this.map.add(s),this.view.whenLayerView(s).then(n=>this.addStream(n))})}async addStream(t){const e=this.map.allLayers.find(({title:n})=>n==="Lee building - occupancy"),i=await $qe(e),r=bZt(e,i),s=new Map;i.forEach(n=>{s.set(n.attributes.NAME,n)}),e.visible=!1,t.layer.visible=!1,this.map.add(r),t.on("data-received",async n=>{const o=n.attributes.NAME,a=s.get(o);a?(a.attributes={...a.attributes,...n.attributes},await r.applyEdits({updateFeatures:[a]})):console.log("No room found for "+o)})}_addEventHandlers(){const t=this.map.presentation.slides;let e=!1;window.onkeydown=i=>{if(i.key==="Shift")e=!0,this.view.popupEnabled=!1;else{const r=Number.parseInt(i.key);if(0<r&&r<=t.length){const s=t.getItemAt(r-1);this.view.goTo(s.viewpoint,{})}}},window.onkeyup=i=>{i.key==="Shift"&&(e=!1,this.view.popupEnabled=!0)},this.view.on("immediate-click",async i=>{if(e){const r=await this.view.hitTest(i),s=r.results.find(n=>n.type==="graphic");s?this._fires.addFire(s.mapPoint):r.ground.mapPoint&&this._fires.addFire(r.ground.mapPoint)}})}};Y4([m({aliasOf:"view.map"})],hC.prototype,"map",2);Y4([m({constructOnly:!0})],hC.prototype,"view",2);Y4([m({constructOnly:!0})],hC.prototype,"userStore",2);Y4([m()],hC.prototype,"player",2);hC=Y4([N("arcgis-core-template.AppStore")],hC);const _ai=hC;console.log(`Using ArcGIS Maps SDK for JavaScript v${mq}`);vqt("https://js.arcgis.com/calcite-components/2.8.5/assets");const vai=new URLSearchParams(document.location.search.slice(1)),bai=vai.get("webscene")||"c43ea7331abe4c91a0e36646b39c1ceb",wai=new Aot({portalItem:{id:bai}}),iXe=new mqt({container:"viewDiv",map:wai});window.view=iXe;const xai=new _ai({view:iXe});new oWt({container:"app",store:xai});export{uzt as $,Ey as A,K5t as B,hH as C,S8 as D,hje as E,Kxt as F,NGt as G,BGt as H,VGt as I,jGt as J,f2t as K,S2t as L,AGt as M,tde as N,Tpe as O,WGt as P,wje as Q,XGt as R,iyt as S,Tje as T,JGt as U,zVt as V,_Fe as W,y0t as X,L2t as Y,z2t as Z,o6e as _,sFe as a,FI as a$,czt as a0,vpe as a1,hzt as a2,tAt as a3,U8 as a4,P7 as a5,$6t as a6,Fje as a7,X6t as a8,Oje as a9,ye as aA,zt as aB,Le as aC,$x as aD,eqe as aE,Gq as aF,Fu as aG,zSi as aH,aue as aI,va as aJ,oe as aK,Du as aL,zw as aM,Jxi as aN,Ole as aO,ct as aP,_e as aQ,Mr as aR,y0 as aS,ae as aT,yse as aU,sCi as aV,fg as aW,HUt as aX,Sr as aY,P0 as aZ,qc as a_,D6t as aa,O$t as ab,R3t as ac,CDt as ad,HDt as ae,wFt as af,UDt as ag,Mv as ah,Ir as ai,d as aj,m as ak,Ix as al,N as am,pce as an,Ge as ao,rye as ap,Fe as aq,HHe as ar,vqe as as,wqe as at,jq as au,yi as av,j as aw,pl as ax,qi as ay,TE as az,f0t as b,Qpe as b$,Y2 as b0,Mo as b1,Ar as b2,Gx as b3,Ke as b4,Yy as b5,Rue as b6,qLe as b7,Hft as b8,MC as b9,N$e as bA,KMe as bB,Ck as bC,Jt as bD,tne as bE,vF as bF,oq as bG,qQe as bH,ko as bI,WQe as bJ,YQe as bK,XQe as bL,$e as bM,tpi as bN,fce as bO,kli as bP,Uli as bQ,fLe as bR,Vhi as bS,Ghi as bT,xci as bU,wst as bV,ex as bW,Eci as bX,Tci as bY,Kw as bZ,Sci as b_,HI as ba,Wt as bb,CD as bc,HWt as bd,En as be,n_i as bf,o_i as bg,DSt as bh,er as bi,qv as bj,Sh as bk,Pyi as bl,q1i as bm,Uhi as bn,due as bo,ci as bp,qQ as bq,JMe as br,s4 as bs,$t as bt,Dq as bu,PI as bv,lr as bw,Je as bx,$V as by,yme as bz,GFe as c,qw as c$,S4t as c0,zc as c1,Tl as c2,dnt as c3,SO as c4,Wci as c5,FSi as c6,w8t as c7,nCi as c8,npe as c9,UKe as cA,pO as cB,BKe as cC,yqe as cD,Yq as cE,uf as cF,gli as cG,XJe as cH,Xli as cI,pq as cJ,Rbi as cK,tet as cL,M as cM,Dc as cN,Wyt as cO,Be as cP,mY as cQ,Fn as cR,Qpi as cS,Kpi as cT,Uj as cU,T_e as cV,stt as cW,Ao as cX,Ne as cY,GPe as cZ,Qd as c_,Yi as ca,OMi as cb,Mk as cc,un as cd,qa as ce,Wi as cf,Pk as cg,M4t as ch,m0 as ci,CQe as cj,Nt as ck,we as cl,Ve as cm,ent as cn,ee as co,rH as cp,T3e as cq,ni as cr,YAe as cs,lq as ct,bq as cu,$E as cv,oF as cw,Pst as cx,yw as cy,Fd as cz,d_t as d,$ue as d$,NQe as d0,Cv as d1,O0i as d2,eMi as d3,eye as d4,Bpt as d5,hx as d6,Yn as d7,tMi as d8,ur as d9,nt as dA,s0 as dB,Qr as dC,Zz as dD,Oo as dE,Rx as dF,hdi as dG,J0i as dH,li as dI,Bs as dJ,Pw as dK,Hd as dL,Qdt as dM,Gui as dN,X6 as dO,cg as dP,AO as dQ,Z2 as dR,Nm as dS,Lm as dT,eit as dU,Utt as dV,kdt as dW,Xw as dX,Dw as dY,By as dZ,bm as d_,hbi as da,us as db,rci as dc,aCt as dd,Ha as de,Xd as df,Bd as dg,c3t as dh,Or as di,$k as dj,lx as dk,wx as dl,Gse as dm,jse as dn,d3t as dp,u3t as dq,p3t as dr,h3t as ds,cVe as dt,a7 as du,hVe as dv,Gme as dw,ps as dx,lc as dy,Me as dz,rvt as e,KR as e$,xgt as e0,vt as e1,bo as e2,RDe as e3,Ed as e4,Nhi as e5,Ypt as e6,Wmi as e7,DF as e8,Ymi as e9,$m as eA,cci as eB,Eui as eC,bhe as eD,vC as eE,sxi as eF,De as eG,ge as eH,Hs as eI,YIe as eJ,mr as eK,Lui as eL,zk as eM,Pui as eN,xe as eO,ce as eP,Te as eQ,Bui as eR,cx as eS,bs as eT,M9 as eU,Eg as eV,pr as eW,l3e as eX,ga as eY,RP as eZ,Kp as e_,hs as ea,wa as eb,pg as ec,yt as ed,Se as ee,ue as ef,dF as eg,Obi as eh,Ut as ei,OYt as ej,DI as ek,IO as el,Nx as em,Xc as en,vK as eo,$n as ep,_K as eq,wK as er,sj as es,WIe as et,KKe as eu,nx as ev,Wy as ew,pf as ex,Ya as ey,jo as ez,fvt as f,QVt as f$,cI as f0,nmi as f1,nE as f2,S0t as f3,gfi as f4,ffi as f5,mfi as f6,O as f7,Cde as f8,Aui as f9,HQ as fA,Zci as fB,gnt as fC,cee as fD,dye as fE,Kli as fF,mnt as fG,hye as fH,znt as fI,mye as fJ,_Mi as fK,yMi as fL,lo as fM,ret as fN,Zw as fO,iui as fP,jhi as fQ,Ak as fR,Uv as fS,snt as fT,_li as fU,ln as fV,Qli as fW,Eh as fX,Pai as fY,P2i as fZ,lGt as f_,GMt as fa,jMt as fb,iI as fc,Id as fd,iTt as fe,E8 as ff,tt as fg,Fre as fh,bde as fi,jr as fj,Yxe as fk,co as fl,mC as fm,Zn as fn,dt as fo,Dx as fp,rxi as fq,Gt as fr,Iq as fs,t8e as ft,dCi as fu,pCi as fv,mCi as fw,rHt as fx,q8t as fy,oye as fz,oEt as g,qze as g$,X6e as g0,I2i as g1,uGt as g2,y_t as g3,Zfi as g4,J$t as g5,zRe as g6,PHe as g7,Sce as g8,Mpt as g9,Ts as gA,Gie as gB,Lw as gC,oh as gD,fh as gE,Nai as gF,BJe as gG,rh as gH,Mle as gI,AXe as gJ,kk as gK,Xk as gL,fF as gM,Hci as gN,kr as gO,f0 as gP,cle as gQ,Yci as gR,Rqe as gS,h$e as gT,Yai as gU,x4t as gV,T4t as gW,SE as gX,hCi as gY,uCi as gZ,gCi as g_,zhi as ga,kMi as gb,BMi as gc,UMi as gd,ZEt as ge,JEt as gf,rce as gg,L5e as gh,H0i as gi,j0i as gj,hpt as gk,pue as gl,nI as gm,Ih as gn,zpt as go,qhi as gp,Upt as gq,Hhi as gr,Bm as gs,Uet as gt,Bc as gu,Qz as gv,q0i as gw,$Et as gx,G3 as gy,pNe as gz,e_t as h,j1i as h$,HV as h0,Pft as h1,Tk as h2,ms as h3,qHe as h4,Sqe as h5,Tqe as h6,gr as h7,DYt as h8,tqe as h9,Qw as hA,Cqe as hB,Vui as hC,zme as hD,wl as hE,sZt as hF,bj as hG,cr as hH,sfe as hI,Iw as hJ,Wst as hK,X2 as hL,VK as hM,ja as hN,pD as hO,QHe as hP,Gee as hQ,Mm as hR,s$e as hS,vi as hT,dC as hU,Vv as hV,Tai as hW,ott as hX,axi as hY,IAe as hZ,QQ as h_,pc as ha,Kd as hb,Yk as hc,$0 as hd,Cst as he,Est as hf,Ntt as hg,CI as hh,nge as hi,rui as hj,Nle as hk,wh as hl,oc as hm,wnt as hn,WHe as ho,SYt as hp,El as hq,jRe as hr,xPe as hs,SPe as ht,Vi as hu,hxi as hv,lxi as hw,uxi as hx,NYt as hy,F6 as hz,J5e as i,exi as i$,QD as i0,lp as i1,mli as i2,bli as i3,pz as i4,NEe as i5,Tmi as i6,Px as i7,Lh as i8,tpe as i9,lle as iA,Cai as iB,Eai as iC,FTt as iD,Eo as iE,WTt as iF,Qle as iG,Mht as iH,Alt as iI,vMi as iJ,tee as iK,lg as iL,Pqe as iM,kHe as iN,z7 as iO,VI as iP,Aqe as iQ,_ce as iR,Ust as iS,rn as iT,le as iU,K3 as iV,Q2 as iW,br as iX,$W as iY,Ayi as iZ,Myi as i_,kGe as ia,q3 as ib,JL as ic,knt as id,KD as ie,Kl as ig,Au as ih,rmi as ii,Nq as ij,qo as ik,qs as il,gq as im,ts as io,oo as ip,zv as iq,Is as ir,xx as is,Di as it,jd as iu,io as iv,BK as iw,$r as ix,YTt as iy,ale as iz,NBe as j,FOt as j$,Rj as j0,_x as j1,u4 as j2,Ga as j3,xC as j4,Gi as j5,UO as j6,Sut as j7,Jce as j8,lOe as j9,CYt as jA,eF as jB,w7 as jC,vm as jD,GIe as jE,U1e as jF,NR as jG,aee as jH,L0i as jI,IEt as jJ,sci as jK,I0i as jL,Ld as jM,l1i as jN,Tse as jO,Ese as jP,Bn as jQ,qm as jR,Mui as jS,Dlt as jT,xE as jU,SGe as jV,sbi as jW,qRt as jX,zvi as jY,rP as jZ,ZX as j_,Kmt as ja,oI as jb,Tke as jc,Bli as jd,ao as je,Xl as jf,qat as jg,Ql as jh,Fui as ji,E_t as jj,Zr as jk,Gp as jl,DE as jm,qUt as jn,yhi as jo,aq as jp,Pdt as jq,bge as jr,Jst as js,sD as jt,vli as ju,nXt as jv,vYt as jw,gMi as jx,MYt as jy,mMi as jz,LAt as k,fZe as k$,VT as k0,nnt as k1,bce as k2,ant as k3,lnt as k4,Unt as k5,yZt as k6,HXt as k7,_qe as k8,JHe as k9,Zpe as kA,RHe as kB,Dze as kC,Ide as kD,Lze as kE,CXt as kF,PYt as kG,oXt as kH,VYt as kI,GYt as kJ,jYt as kK,qYt as kL,WYt as kM,YYt as kN,XYt as kO,ZYt as kP,JYt as kQ,QYt as kR,KYt as kS,eXt as kT,Eqe as kU,hq as kV,LYt as kW,efe as kX,MRe as kY,Gd as kZ,Ww as k_,Gj as ka,hue as kb,V7 as kc,L4 as kd,x6 as ke,Woe as kf,$4 as kg,KHe as kh,rfe as ki,GE as kj,adi as kk,bGe as kl,SKe as km,xge as kn,Mqe as ko,gh as kp,HJe as kq,g0 as kr,Dd as ks,AI as kt,l$ as ku,tXt as kv,_Yt as kw,rqe as kx,sqe as ky,p1 as kz,WCt as l,AF as l$,Ixi as l0,E4t as l1,AE as l2,V0i as l3,tr as l4,Pu as l5,ec as l6,T as l7,Wn as l8,V0 as l9,Yde as lA,Ce as lB,lE as lC,Ov as lD,J9 as lE,C3t as lF,Gue as lG,QI as lH,Tt as lI,P9 as lJ,dyi as lK,Yxt as lL,$he as lM,Q$t as lN,Qfi as lO,dj as lP,aI as lQ,Pd as lR,uci as lS,ake as lT,mKe as lU,_O as lV,k0i as lW,a4t as lX,Hk as lY,A0 as lZ,PDe as l_,Et as la,et as lb,mt as lc,B0 as ld,x8 as le,G as lf,ir as lg,Zd as lh,ke as li,V as lj,ns as lk,hr as ll,dr as lm,ti as ln,c1 as lo,C9 as lp,Yx as lq,Oh as lr,Z9 as ls,u1 as lt,fi as lu,x0 as lv,bx as lw,Xx as lx,K9 as ly,$u as lz,KE as m,QHt as m$,IPe as m0,_l as m1,Br as m2,Iui as m3,jat as m4,Xn as m5,rBe as m6,Zx as m7,Bk as m8,Q1i as m9,qIe as mA,k0e as mB,vci as mC,HO as mD,ddi as mE,Tn as mF,Oai as mG,kI as mH,Xci as mI,uqe as mJ,gle as mK,jE as mL,YA as mM,zYt as mN,LMi as mO,dXt as mP,pXt as mQ,Ti as mR,tc as mS,qci as mT,bJe as mU,_Ae as mV,Li as mW,Yr as mX,h4 as mY,_xi as mZ,_Ci as m_,Bse as ma,$8 as mb,an as mc,RXe as md,hUe as me,dle as mf,Sj as mg,ahe as mh,Lr as mi,Hm as mj,Us as mk,MIe as ml,St as mm,zr as mn,D4t as mo,Xe as mp,Zlt as mq,Sw as mr,bn as ms,eue as mt,gxi as mu,KV as mv,bqe as mw,cXt as mx,Nr as my,Sa as mz,zyt as n,k5e as n$,vCi as n0,vf as n1,Gk as n2,_C as n3,ac as n4,pj as n5,uat as n6,ks as n7,DVt as n8,Vo as n9,kci as nA,Bci as nB,Uci as nC,hf as nD,oxi as nE,Av as nF,cc as nG,fs as nH,Ct as nI,Xt as nJ,_i as nK,Gr as nL,kE as nM,jt as nN,x8t as nO,zli as nP,egt as nQ,k_e as nR,xVe as nS,TVe as nT,ubi as nU,ND as nV,LD as nW,lVe as nX,$Nt as nY,Z$t as nZ,nCt as n_,f2i as na,Rv as nb,_g as nc,uc as nd,t4 as ne,Zo as nf,$9 as ng,L9 as nh,PC as ni,mvi as nj,ZFe as nk,D9 as nl,N9 as nm,GRe as nn,Rk as no,Oq as np,TW as nq,xue as nr,B7 as ns,OI as nt,qd as nu,xj as nv,Bst as nw,zst as nx,cye as ny,jUt as nz,BBt as o,Ou as o$,lCt as o0,aNt as o1,n3t as o2,o3t as o3,cNt as o4,sNt as o5,nNt as o6,a3t as o7,lNt as o8,oCt as o9,Pce as oA,$Pe as oB,Ud as oC,rbi as oD,cCi as oE,U as oF,$li as oG,_v as oH,fCi as oI,ox as oJ,Rai as oK,DAe as oL,tli as oM,eli as oN,Y0i as oO,W0i as oP,vZe as oQ,_Ze as oR,tAe as oS,pXe as oT,mci as oU,F0i as oV,iUe as oW,IYt as oX,Lhi as oY,Dhi as oZ,khi as o_,oNt as oa,ff as ob,YP as oc,IM as od,$Ae as oe,Xai as of,gC as og,Jlt as oh,VE as oi,yOt as oj,Cgt as ok,To as ol,EQe as om,kYt as on,Bhi as oo,Fhi as op,gme as oq,i1 as or,wk as os,hy as ot,bC as ou,Hmi as ov,Gv as ow,Wr as ox,kce as oy,Ph as oz,Zue as p,oAe as p$,Whi as p0,OEt as p1,lue as p2,ax as p3,uMi as p4,TYt as p5,EYt as p6,$Yt as p7,RXt as p8,jXt as p9,aD as pA,Rgt as pB,qp as pC,Ni as pD,ici as pE,Sq as pF,Aci as pG,R0 as pH,yli as pI,OAe as pJ,ift as pK,$O as pL,lXt as pM,cxi as pN,Hw as pO,HEe as pP,xO as pQ,Mmi as pR,Rmi as pS,Cke as pT,o4t as pU,n4t as pV,nUe as pW,bF as pX,imi as pY,LO as pZ,USt as p_,eZt as pa,d3e as pb,ult as pc,b8t as pd,Tu as pe,JKe as pf,hot as pg,Ami as ph,Ki as pi,Ch as pj,Xs as pk,qx as pl,jx as pm,pi as pn,hpi as po,gdt as pp,$c as pq,tue as pr,MF as ps,ppi as pt,api as pu,Nie as pv,cpi as pw,aPe as px,tci as py,hPe as pz,bGt as q,V_e as q$,Jv as q0,bRe as q1,Ale as q2,fli as q3,VRe as q4,Rme as q5,lPe as q6,ZCi as q7,AWt as q8,dVe as q9,Rl as qA,xh as qB,Fi as qC,is as qD,vke as qE,ohe as qF,Cui as qG,jxt as qH,Yd as qI,wat as qJ,Za as qK,Z0e as qL,wF as qM,EO as qN,lci as qO,Ibt as qP,Uce as qQ,LPe as qR,TO as qS,n3e as qT,flt as qU,Ls as qV,t9 as qW,X0e as qX,df as qY,oht as qZ,vat as q_,DLe as qa,Yw as qb,l3t as qc,Tle as qd,s1 as qe,lbi as qf,ntt as qg,bv as qh,FPe as qi,Cet as qj,Zpi as qk,Ace as ql,cbi as qm,Jpi as qn,l_i as qo,gAe as qp,N0 as qq,d4 as qr,Qt as qs,Ps as qt,os as qu,k0 as qv,Dh as qw,Vr as qx,wr as qy,Zc as qz,rje as r,Vd as r$,W_t as r0,upi as r1,omi as r2,ami as r3,q_t as r4,smi as r5,Rw as r6,lpi as r7,$hi as r8,wli as r9,Vm as rA,cdi as rB,dpi as rC,Vhe as rD,CF as rE,NE as rF,Uui as rG,C7 as rH,$j as rI,l4t as rJ,bAt as rK,bxi as rL,r4t as rM,xxi as rN,wxi as rO,Zq as rP,gci as rQ,Y0e as rR,ixi as rS,nxi as rT,ldi as rU,Sft as rV,o8 as rW,pdi as rX,pyi as rY,UFe as rZ,WUe as r_,wlt as ra,CMi as rb,Yc as rc,eO as rd,yWt as re,aE as rf,Kr as rg,Tyi as rh,Oce as ri,aci as rj,Xo as rk,Rui as rl,Xj as rm,yci as rn,Qde as ro,O0 as rp,yce as rq,lNe as rr,yg as rs,XO as rt,Ba as ru,Q9 as rv,xY as rw,AUe as rx,z4e as ry,Nhe as rz,SGt as s,NPe as s$,NK as s0,Cg as s1,Wx as s2,zo as s3,mg as s4,At as s5,Uw as s6,Ds as s7,$Le as s8,wue as s9,G0i as sA,O5e as sB,$5e as sC,R5e as sD,vq as sE,eV as sF,j1e as sG,uCt as sH,P0i as sI,xOe as sJ,bci as sK,nOe as sL,pci as sM,bKe as sN,MKe as sO,N5e as sP,kle as sQ,jli as sR,OBe as sS,fZt as sT,MAt as sU,uq as sV,_h as sW,ule as sX,TPe as sY,jet as sZ,ttt as s_,v9 as sa,dxi as sb,uot as sc,Jwi as sd,Hy as se,Jse as sf,lDe as sg,IN as sh,o3e as si,$ui as sj,JRe as sk,Nui as sl,Oui as sm,Gat as sn,dx as so,aj as sp,l0 as sq,Cl as sr,TLe as ss,bMi as st,sht as su,cat as sv,Yut as sw,Z0i as sx,k1e as sy,Q0i as sz,K6e as t,O1i as t$,pF as t0,c3e as t1,fye as t2,tx as t3,Ndi as t4,Kat as t5,YT as t6,oA as t7,fmt as t8,UUe as t9,k4t as tA,PSe as tB,UYt as tC,eAe as tD,nle as tE,Eke as tF,Fli as tG,Dli as tH,zvt as tI,QMt as tJ,$$t as tK,JE as tL,hAe as tM,cXe as tN,b0e as tO,fxi as tP,vB as tQ,cBe as tR,zci as tS,Kfi as tT,DO as tU,jI as tV,Td as tW,V5e as tX,G5e as tY,Oyi as tZ,Nw as t_,Khe as ta,Uyt as tb,pVe as tc,ARe as td,S3e as te,wse as tf,Pbi as tg,zE as th,Flt as ti,Jyi as tj,s7 as tk,Ali as tl,xk as tm,Wai as tn,RF as to,CE as tp,rx as tq,Cyi as tr,TFe as ts,fNe as tt,Sat as tu,lF as tv,xw as tw,Clt as tx,SFe as ty,_Ge as tz,LFe as u,_0i as u$,opi as u0,Jk as u1,fgt as u2,Sm as u3,LSe as u4,D1i as u5,$1i as u6,N1i as u7,L1i as u8,pne as u9,rI as uA,VUe as uB,qyi as uC,o0 as uD,Hyi as uE,hn as uF,T2i as uG,Hv as uH,yr as uI,pE as uJ,Y6e as uK,Hhe as uL,CBe as uM,WVt as uN,fGt as uO,S1e as uP,E7 as uQ,zTt as uR,S2i as uS,Tne as uT,Ene as uU,NM as uV,pLt as uW,$Ft as uX,gEt as uY,fEt as uZ,zgt as u_,Gf as ua,Om as ub,ql as uc,M1i as ud,ISi as ue,$de as uf,cH as ug,E1i as uh,A1i as ui,Fze as uj,C1i as uk,lh as ul,hh as um,mne as un,lH as uo,gne as up,fne as uq,P1i as ur,wRt as us,I1i as ut,KRt as uu,Evi as uv,DSe as uw,u_t as ux,h_t as uy,bf as uz,t0t as v,Wpe as v$,y0i as v0,jv as v1,t_i as v2,fa as v3,yl as v4,Cxi as v5,Wa as v6,nli as v7,wd as v8,oz as v9,Ili as vA,U0i as vB,_ci as vC,Aai as vD,QSi as vE,fci as vF,dmt as vG,B0i as vH,ph as vI,Vx as vJ,CC as vK,qai as vL,mWt as vM,d2t as vN,ud as vO,z0 as vP,U0 as vQ,ss as vR,Pv as vS,KCi as vT,VEt as vU,OC as vV,ej as vW,a$ as vX,qpe as vY,uWt as vZ,hWt as v_,z0i as va,uye as vb,N0i as vc,wTt as vd,b9 as ve,Ibi as vf,RC as vg,NFt as vh,Dn as vi,ZFt as vj,k$e as vk,$De as vl,Qq as vm,BE as vn,Kv as vo,Lce as vp,$w as vq,Kq as vr,a3e as vs,Dui as vt,Igt as vu,dci as vv,RUt as vw,ont as vx,CXe as vy,PKe as vz,mFe as w,Vli as w$,CHe as w0,V1i as w1,wCt as w2,G1i as w3,j5e as w4,CH as w5,cli as w6,xHe as w7,qD as w8,vdi as w9,Z3 as wA,_Re as wB,Xui as wC,xGe as wD,ba as wE,Ngt as wF,kui as wG,uj as wH,r3e as wI,Olt as wJ,ug as wK,bO as wL,Tlt as wM,Hce as wN,IDe as wO,Mci as wP,Jli as wQ,oci as wR,Pgt as wS,pat as wT,T9 as wU,ix as wV,Mst as wW,tgt as wX,dO as wY,sKe as wZ,rKe as w_,bdi as wa,wdi as wb,Jm as wc,_I as wd,wet as we,p9 as wf,Cci as wg,cj as wh,Tq as wi,vSi as wj,LSi as wk,xUt as wl,c1i as wm,gg as wn,h1i as wo,eci as wp,hw as wq,c5e as wr,rne as ws,Iy as wt,u1i as wu,uw as wv,p5t as ww,f5t as wx,pgt as wy,H2 as wz,eje as x,Lli as x$,pmt as x0,qZe as x1,Vot as x2,Xpt as x3,_ui as x4,iC as x5,DC as x6,A4 as x7,fr as x8,af as x9,JQe as xA,Sy as xB,P$t as xC,R$t as xD,DRe as xE,LRe as xF,xK as xG,vui as xH,ePe as xI,ZQe as xJ,dOt as xK,Wut as xL,hci as xM,Btt as xN,QRe as xO,Qdi as xP,rpi as xQ,ipi as xR,spi as xS,tPe as xT,npi as xU,Omi as xV,Vvt as xW,mZe as xX,Kai as xY,HQe as xZ,Nli as x_,Wui as xa,qui as xb,Qct as xc,Jct as xd,mue as xe,p6 as xf,B1i as xg,rq as xh,Qpt as xi,Vmt as xj,P8t as xk,Jpt as xl,qj as xm,Yj as xn,TF as xo,Iai as xp,_0 as xq,wCi as xr,s0e as xs,H1i as xt,z1i as xu,_ue as xv,nft as xw,oft as xx,lqt as xy,rCi as xz,mD as y,QPt as y$,O8t as y0,Tv as y1,UAe as y2,e4t as y3,Kkt as y4,IXe as y5,Dai as y6,t4t as y7,udi as y8,$q as y9,iPt as yA,Ro as yB,Nk as yC,tf as yD,Ky as yE,p1i as yF,d1i as yG,R1i as yH,ar as yI,Ajt as yJ,Sai as yK,sOt as yL,Vvi as yM,v1i as yN,b1i as yO,g1i as yP,m1i as yQ,o1i as yR,a1i as yS,oli as yT,jbe as yU,uOt as yV,oLe as yW,jSt as yX,tTt as yY,Tft as yZ,LE as y_,i4t as ya,Pmi as yb,epi as yc,Mce as yd,U1i as ye,bh as yf,ilt as yg,jvt as yh,Iet as yi,vgt as yj,bgt as yk,Kdi as yl,txi as ym,T1i as yn,y1i as yo,_1i as yp,km as yq,ROt as yr,Cze as ys,$Ot as yt,gOt as yu,fOt as yv,mui as yw,n1i as yx,F1i as yy,rOt as yz,_Gt as z,K0i as z0,xX as z1,SX as z2,Fle as z3,f1i as z4,Fwe as z5,eme as z6,X0i as z7,Uot as z8,oMi as z9,nMi as za,Vci as zb,jci as zc,s_i as zd,dbi as ze,Abi as zf,SMi as zg,DMi as zh,VMi as zi,GMi as zj};
