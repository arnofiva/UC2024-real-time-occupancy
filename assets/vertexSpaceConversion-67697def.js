import{da as I,cZ as K,db as L,dc as V,dd as x,de as N,df as $,dg as w,dh as m,di as y,dj as j,cX as h,dk as X,dl as E,dm as B,dn as k,dp as Z,dq as D,dr as H,ds as J,dt as P,du as q,dv as Q,dw as W,bI as _,cY as S,dx as nn,cM as tn,aK as en,dy as b,dz as rn,dA as on}from"./index-918e6eaf.js";const g=()=>en.getLogger("esri.geometry.support.meshUtils.vertexSpaceConversion");function xn(n,t,{vertexSpace:e,spatialReference:o}){if(e.type==="georeferenced"){const c=n;if(!b(t,c,o))return!1;const{origin:u}=e;return rn(n,c,u),!0}const r=$(o),a=n;if(!b(t,a,r))return!1;const{origin:l}=e,i=M;if(!w(o,l,i,r))return!1;const s=h(M,i);return s!=null&&(on(n,a,s),!0)}function wn(n,t,e){const{vertexSpace:o,transform:r,vertexAttributes:a}=n,l=R(n.spatialReference,e,p.SOURCE|p.TARGET);if(I(o,t)&&(!r||K(r.localMatrix,L))&&V(l,1)){const{position:i,normal:s,tangent:c}=a,u=e?.allowBufferReuse;return{position:u?i:i.slice(),normal:u?s:s?.slice(),tangent:u?c:c?.slice()}}switch(n.vertexSpace.type){case"local":return t.type==="local"?cn(n,n.vertexSpace,t.origin,e):ln(n,n.vertexSpace,t.origin,e);case"georeferenced":return t.type==="local"?sn(n,n.vertexSpace,t.origin,e):an(n,n.vertexSpace,t.origin,e)}}function an({vertexAttributes:n,transform:t,spatialReference:e},{origin:o},r,a){const{position:l,normal:i,tangent:s}=t?F(n,t.localMatrix):n,c=new Float64Array(l.length);let u=l;if(o&&(u=x(c,u,o)),r){const A=N(Y,r);u=x(c,u,A)}R(e,a,p.NONE);const d=a?.allowBufferReuse;return{position:u!==n.position||d?u:u.slice(),normal:i!==n.normal||d?i:i?.slice(),tangent:s!==n.tangent||d?s:s?.slice()}}function ln({spatialReference:n,vertexAttributes:t,transform:e},{origin:o},r,a){const l=$(n);if(!w(n,o,f,l))return m(g(),n,l),null;e&&y(f,f,e.localMatrix),z(f,n,a,p.SOURCE);const i=new Float64Array(t.position.length),s=fn(t.position,f,n,i);if(!s)return null;const c=gn(s,i,t.normal,f,n);if(t.normal&&!c)return null;const u=pn(s,i,t.tangent,f,n);if(t.tangent&&!u)return null;if(r){const d=N(Y,r);x(s,s,d)}return{position:s,normal:c,tangent:u}}function sn({vertexAttributes:n,spatialReference:t,transform:e},{origin:o},r,a){const l=$(t);if(!w(t,r,f,l))return m(g(),t,l),null;const i=1/R(t,a,p.TARGET);j(f,f,[i,i,i]);const s=h(v,f),{position:c,normal:u,tangent:d}=un(n,o,e),A=new Float64Array(c.length),T=dn(c,t,s,A);if(!T)return null;const O=X(An,s),U=mn(u,c,A,t,O,u!==n.normal?u:void 0);if(!U&&u)return null;const G=$n(d,c,A,t,O,d!==n.tangent?d:void 0);return!G&&d?null:{position:T,normal:U,tangent:G}}function un(n,t,e){if(!t)return n;if(!e){const{position:r,normal:a,tangent:l}=n;return{position:x(new Float64Array(r.length),r,t),tangent:l,normal:a}}const o=F(n,e.localMatrix);return x(o.position,o.position,t),o}function cn({vertexAttributes:n,spatialReference:t,transform:e},{origin:o},r,a){const l=$(t);if(!w(t,o,f,l))return m(g(),t,l),null;if(e&&y(f,f,e.localMatrix),!w(t,r,v,l))return m(g(),l,t),null;h(v,v);const i=y(f,v,f);return z(i,t,a,p.SOURCE|p.TARGET),F(n,i)}function F(n,t){const e=new Float64Array(n.position.length);E(e,n.position,t);const o=n.normal?new Float32Array(n.normal.length):null,r=n.tangent?new Float32Array(n.tangent.length):null;return o&&n.normal&&B(n.normal,o,t),r&&n.tangent&&k(n.tangent,r,t),{position:e,normal:o,tangent:r}}function fn(n,t,e,o){E(o,n,t);const r=new Float64Array(n.length);return Z(o,r,e)?r:(m(g(),$(e),e),null)}function gn(n,t,e,o,r){if(e==null)return null;const a=new Float32Array(e.length);return B(e,a,o),D(a,n,t,r,a)?a:(m(g(),$(r),r),null)}function pn(n,t,e,o,r){if(e==null)return null;const a=new Float32Array(e.length);return k(e,a,o),H(a,n,t,r,a)?a:(m(g(),$(r),r),null)}function z(n,t,e,o){const r=R(t,e,o);r!==1&&j(n,n,[r,r,r])}function R(n,t,e){const o=!!(e&p.SOURCE),r=!!(e&p.TARGET),a=t?.sourceUnit,l=t?.targetUnit;if(!a&&!l)return 1;let i=C(a,n);!o&&a&&i!==1&&(g().warn("source unit conversion not supported"),i=1);let s=1/C(l,n);return!r&&l&&s!==1&&(g().warn("target unit conversion not supported"),s=1),i*s}function dn(n,t,e,o){const r=J(n,t,o);if(!r)return m(g(),t,$(t)),null;const a=new Float64Array(r.length);return E(a,r,e),a}function mn(n,t,e,o,r,a){if(n==null)return null;const l=a??new Float32Array(n.length);return P(n,t,e,o,l)?(q(l,l,r),l):(m(g(),o,$(o)),null)}function $n(n,t,e,o,r,a){if(n==null)return null;const l=a??new Float32Array(n.length);return Q(n,t,e,o,l)?(q(l,l,r,4),l):(m(g(),o,$(o)),null)}function C(n,t){if(n==null)return 1;const e=W(t);return 1/_(e,"meters",n)}const f=S(),v=S(),An=nn(),Y=tn(),M=S();var p;(function(n){n[n.NONE=0]="NONE",n[n.SOURCE=1]="SOURCE",n[n.TARGET=2]="TARGET"})(p||(p={}));export{wn as M,xn as N,C as X};
