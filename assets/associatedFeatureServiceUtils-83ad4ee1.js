import{aA as t,dt as L,av as s,dA as f,dB as T,aw as m,ax as y,gh as A}from"./index-6a39f5fd.js";const R={BingMapsLayer:async()=>(await t(()=>import("./BingMapsLayer-0eae5f1d.js"),["./BingMapsLayer-0eae5f1d.js","./index-6a39f5fd.js","./index-c3d91843.css","./imageBitmapUtils-7a666dcd.js"],import.meta.url)).default,BuildingSceneLayer:async()=>(await t(()=>import("./BuildingSceneLayer-9cad4f73.js"),["./BuildingSceneLayer-9cad4f73.js","./index-6a39f5fd.js","./index-c3d91843.css","./BuildingComponentSublayer-9ce44d5c.js","./capabilities-c607cf72.js","./I3SIndexInfo-69ba1964.js","./I3SLayerDefinitions-264d8d41.js","./I3SUtil-e9718971.js","./I3SBinaryReader-57cb919e.js","./popupUtils-8edf03a3.js","./BuildingGroupSublayer-89b5b14b.js","./SceneService-08b737d0.js","./elevationInfoUtils-d136536c.js"],import.meta.url)).default,CSVLayer:async()=>(await t(()=>import("./CSVLayer-bded551a.js"),["./CSVLayer-bded551a.js","./index-6a39f5fd.js","./index-c3d91843.css","./clientSideDefaults-54e3531a.js","./QueryEngineCapabilities-85c4f1d0.js"],import.meta.url)).default,DimensionLayer:async()=>(await t(()=>import("./DimensionLayer-be40d7c2.js"),["./DimensionLayer-be40d7c2.js","./index-6a39f5fd.js","./index-c3d91843.css","./Analysis-6ca7f24a.js","./LengthDimension-df977551.js"],import.meta.url)).default,ElevationLayer:async()=>(await t(()=>import("./ElevationLayer-02410ff2.js"),["./ElevationLayer-02410ff2.js","./index-6a39f5fd.js","./index-c3d91843.css","./ArcGISCachedService-e41e5055.js","./TileInfoTilemapCache-1fc67502.js","./TilemapCache-84f25708.js"],import.meta.url)).default,FeatureLayer:async()=>(await t(()=>import("./index-6a39f5fd.js").then(e=>e.xU),["./index-6a39f5fd.js","./index-c3d91843.css"],import.meta.url)).default,GeoJSONLayer:async()=>(await t(()=>import("./GeoJSONLayer-4b0b97e2.js"),["./GeoJSONLayer-4b0b97e2.js","./index-6a39f5fd.js","./index-c3d91843.css","./clientSideDefaults-54e3531a.js","./QueryEngineCapabilities-85c4f1d0.js"],import.meta.url)).default,GeoRSSLayer:async()=>(await t(()=>import("./GeoRSSLayer-27e165aa.js"),["./GeoRSSLayer-27e165aa.js","./index-6a39f5fd.js","./index-c3d91843.css"],import.meta.url)).default,GroupLayer:async()=>(await t(()=>import("./GroupLayer-54d89dc2.js"),["./GroupLayer-54d89dc2.js","./index-6a39f5fd.js","./index-c3d91843.css"],import.meta.url)).default,ImageryLayer:async()=>(await t(()=>import("./ImageryLayer-81a629ed.js"),["./ImageryLayer-81a629ed.js","./index-6a39f5fd.js","./index-c3d91843.css","./ImageHistogramParameters-0d9279fd.js","./dataUtils-98b25070.js","./generateRendererUtils-d32e46bc.js","./imageBitmapUtils-7a666dcd.js","./executeQueryJSON-0c15fd15.js","./query-549555fc.js","./pbfQueryUtils-da01cf7e.js","./pbf-b8e7c3b5.js","./AttachmentInfo-b9074a04.js","./executeForIds-61f67821.js"],import.meta.url)).default,ImageryTileLayer:async()=>(await t(()=>import("./ImageryTileLayer-98d4eb03.js"),["./ImageryTileLayer-98d4eb03.js","./index-6a39f5fd.js","./index-c3d91843.css","./ImageHistogramParameters-0d9279fd.js","./dataUtils-98b25070.js","./generateRendererUtils-d32e46bc.js","./rasterProjectionHelper-b41f1043.js","./utils-1793f5c6.js","./TilemapCache-84f25708.js"],import.meta.url)).default,IntegratedMeshLayer:async()=>(await t(()=>import("./IntegratedMeshLayer-5e9ec08b.js"),["./IntegratedMeshLayer-5e9ec08b.js","./index-6a39f5fd.js","./index-c3d91843.css","./persistable-214e7c30.js","./resourceExtension-478f4a5c.js","./SceneService-08b737d0.js","./I3SIndexInfo-69ba1964.js","./I3SLayerDefinitions-264d8d41.js","./SceneModification-7d9129a6.js","./elevationInfoUtils-d136536c.js"],import.meta.url)).default,KMLLayer:async()=>(await t(()=>import("./KMLLayer-2c513a7e.js"),["./KMLLayer-2c513a7e.js","./index-6a39f5fd.js","./index-c3d91843.css"],import.meta.url)).default,LineOfSightLayer:async()=>(await t(()=>import("./LineOfSightLayer-b561cffc.js"),["./LineOfSightLayer-b561cffc.js","./index-6a39f5fd.js","./index-c3d91843.css","./Analysis-6ca7f24a.js","./LineOfSightAnalysisTarget-8126a2b9.js","./persistable-214e7c30.js","./resourceExtension-478f4a5c.js","./elevationInfoUtils-d136536c.js"],import.meta.url)).default,LinkChartLayer:async()=>(await t(()=>import("./LinkChartLayer-cc7320a8.js"),["./LinkChartLayer-cc7320a8.js","./index-6a39f5fd.js","./index-c3d91843.css","./geohashUtils-77d8429b.js","./FeatureStore-acc744e6.js","./BoundsStore-a82611a0.js","./PooledRBush-9433f3c7.js","./quickselect-cab99df7.js","./QueryEngine-c6786e0f.js","./WhereClause-802159fe.js","./TimeOnly-6cba65ec.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-2f43b23e.js","./utils-03a91e6b.js","./generateRendererUtils-d32e46bc.js","./optimizedFeatureQueryEngineAdapter-076ccf9b.js","./clientSideDefaults-54e3531a.js"],import.meta.url)).default,MapImageLayer:async()=>(await t(()=>import("./MapImageLayer-86f5531b.js"),["./MapImageLayer-86f5531b.js","./index-6a39f5fd.js","./index-c3d91843.css","./SublayersOwner-cb8af827.js","./QueryTask-3381541c.js","./executeForIds-61f67821.js","./query-549555fc.js","./pbfQueryUtils-da01cf7e.js","./pbf-b8e7c3b5.js","./executeQueryJSON-0c15fd15.js","./executeQueryPBF-04f577d8.js","./sublayerUtils-4cdcbb59.js","./ExportImageParameters-688f2f87.js","./floorFilterUtils-73949d2d.js","./imageBitmapUtils-7a666dcd.js"],import.meta.url)).default,MapNotesLayer:async()=>(await t(()=>import("./MapNotesLayer-723b4b73.js"),["./MapNotesLayer-723b4b73.js","./index-6a39f5fd.js","./index-c3d91843.css","./objectIdUtils-967fafff.js"],import.meta.url)).default,MediaLayer:async()=>(await t(()=>import("./MediaLayer-8d530a22.js"),["./MediaLayer-8d530a22.js","./index-6a39f5fd.js","./index-c3d91843.css","./MediaElementView-0580c04a.js","./normalizeUtilsSync-2e3c6e1e.js","./resourceExtension-478f4a5c.js","./BoundsStore-a82611a0.js","./PooledRBush-9433f3c7.js","./quickselect-cab99df7.js"],import.meta.url)).default,OGCFeatureLayer:async()=>(await t(()=>import("./OGCFeatureLayer-4a0d7927.js"),["./OGCFeatureLayer-4a0d7927.js","./index-6a39f5fd.js","./index-c3d91843.css","./ogcFeatureUtils-f7b9cf68.js","./geojson-c74452f6.js","./date-430969b3.js","./clientSideDefaults-54e3531a.js","./QueryEngineCapabilities-85c4f1d0.js"],import.meta.url)).default,OpenStreetMapLayer:async()=>(await t(()=>import("./OpenStreetMapLayer-feeb6001.js"),["./OpenStreetMapLayer-feeb6001.js","./index-6a39f5fd.js","./index-c3d91843.css","./WebTileLayer-b857b6dc.js","./imageBitmapUtils-7a666dcd.js"],import.meta.url)).default,OrientedImageryLayer:async()=>(await t(()=>import("./OrientedImageryLayer-3187b7a3.js"),["./OrientedImageryLayer-3187b7a3.js","./index-6a39f5fd.js","./index-c3d91843.css"],import.meta.url)).default,PointCloudLayer:async()=>(await t(()=>import("./PointCloudLayer-6a41250f.js"),["./PointCloudLayer-6a41250f.js","./index-6a39f5fd.js","./index-c3d91843.css","./SceneService-08b737d0.js","./I3SIndexInfo-69ba1964.js","./PointCloudUniqueValueRenderer-d9f5ab54.js","./elevationInfoUtils-d136536c.js"],import.meta.url)).default,RouteLayer:async()=>(await t(()=>import("./RouteLayer-c5d88e44.js"),["./RouteLayer-c5d88e44.js","./index-6a39f5fd.js","./index-c3d91843.css","./Stop-cdb04a16.js"],import.meta.url)).default,SceneLayer:async()=>(await t(()=>import("./SceneLayer-4e0be9c0.js"),["./SceneLayer-4e0be9c0.js","./index-6a39f5fd.js","./index-c3d91843.css","./SceneService-08b737d0.js","./I3SIndexInfo-69ba1964.js","./capabilities-c607cf72.js","./I3SLayerDefinitions-264d8d41.js","./persistable-214e7c30.js","./resourceExtension-478f4a5c.js","./elevationInfoUtils-d136536c.js","./I3SUtil-e9718971.js","./I3SBinaryReader-57cb919e.js","./popupUtils-8edf03a3.js"],import.meta.url)).default,StreamLayer:async()=>(await t(()=>import("./index-6a39f5fd.js").then(e=>e.xV),["./index-6a39f5fd.js","./index-c3d91843.css"],import.meta.url)).default,SubtypeGroupLayer:async()=>(await t(()=>import("./SubtypeGroupLayer-63ed0a54.js"),["./SubtypeGroupLayer-63ed0a54.js","./index-6a39f5fd.js","./index-c3d91843.css"],import.meta.url)).default,TileLayer:async()=>(await t(()=>import("./TileLayer-dda72903.js"),["./TileLayer-dda72903.js","./index-6a39f5fd.js","./index-c3d91843.css","./ArcGISCachedService-e41e5055.js","./TileInfoTilemapCache-1fc67502.js","./TilemapCache-84f25708.js","./SublayersOwner-cb8af827.js","./QueryTask-3381541c.js","./executeForIds-61f67821.js","./query-549555fc.js","./pbfQueryUtils-da01cf7e.js","./pbf-b8e7c3b5.js","./executeQueryJSON-0c15fd15.js","./executeQueryPBF-04f577d8.js","./sublayerUtils-4cdcbb59.js","./imageBitmapUtils-7a666dcd.js"],import.meta.url)).default,UnknownLayer:async()=>(await t(()=>import("./UnknownLayer-53137d61.js"),["./UnknownLayer-53137d61.js","./index-6a39f5fd.js","./index-c3d91843.css"],import.meta.url)).default,UnsupportedLayer:async()=>(await t(()=>import("./UnsupportedLayer-f455a228.js"),["./UnsupportedLayer-f455a228.js","./index-6a39f5fd.js","./index-c3d91843.css"],import.meta.url)).default,VectorTileLayer:async()=>(await t(()=>import("./VectorTileLayer-c2379890.js"),["./VectorTileLayer-c2379890.js","./index-6a39f5fd.js","./index-c3d91843.css","./ArcGISCachedService-e41e5055.js","./TileInfoTilemapCache-1fc67502.js","./TilemapCache-84f25708.js","./jsonContext-e3b5f1a6.js","./StyleRepository-7a559ad6.js","./TileClipper-ae6eca9e.js","./definitions-20e80198.js"],import.meta.url)).default,VoxelLayer:async()=>(await t(()=>import("./VoxelLayer-521ca5e3.js"),["./VoxelLayer-521ca5e3.js","./index-6a39f5fd.js","./index-c3d91843.css","./SceneService-08b737d0.js","./I3SIndexInfo-69ba1964.js","./persistable-214e7c30.js","./resourceExtension-478f4a5c.js"],import.meta.url)).default,WFSLayer:async()=>(await t(()=>import("./WFSLayer-974d6645.js"),["./WFSLayer-974d6645.js","./index-6a39f5fd.js","./index-c3d91843.css","./clientSideDefaults-54e3531a.js","./QueryEngineCapabilities-85c4f1d0.js","./wfsUtils-d6930983.js","./geojson-c74452f6.js","./date-430969b3.js","./xmlUtils-444cb4c0.js"],import.meta.url)).default,WMSLayer:async()=>(await t(()=>import("./WMSLayer-3c805587.js"),["./WMSLayer-3c805587.js","./index-6a39f5fd.js","./index-c3d91843.css","./crsUtils-3bab3d8c.js","./ExportWMSImageParameters-f7877351.js","./imageBitmapUtils-7a666dcd.js"],import.meta.url)).default,WMTSLayer:async()=>(await t(()=>import("./WMTSLayer-4db0c3c8.js"),["./WMTSLayer-4db0c3c8.js","./index-6a39f5fd.js","./index-c3d91843.css","./WebTileLayer-b857b6dc.js","./imageBitmapUtils-7a666dcd.js","./TileInfoTilemapCache-1fc67502.js","./crsUtils-3bab3d8c.js","./xmlUtils-444cb4c0.js"],import.meta.url)).default,WebTileLayer:async()=>(await t(()=>import("./WebTileLayer-b857b6dc.js").then(e=>e.W),["./WebTileLayer-b857b6dc.js","./index-6a39f5fd.js","./index-c3d91843.css","./imageBitmapUtils-7a666dcd.js"],import.meta.url)).default};async function h(e,i){const r=L(e);if(!r)throw new s("invalid-url","Invalid scene service url");const a={...i,sceneServerUrl:r.url.path,layerId:r.sublayer??void 0};if(a.sceneLayerItem??(a.sceneLayerItem=await D(a)),a.sceneLayerItem==null)return p(a.sceneServerUrl.replace("/SceneServer","/FeatureServer"),a);const o=await V(a);if(!o?.url)throw new s("related-service-not-found","Could not find feature service through portal item relationship");const _=await p(o.url,a);return _.portalItem=o,_}async function D(e){const i=(await E(e)).serviceItemId;if(!i)return null;const r=new f({id:i,apiKey:e.apiKey}),a=await O(e);a!=null&&(r.portal=new T({url:a}));try{return r.load({signal:e.signal})}catch(o){return m(o),null}}async function E(e){if(e.rootDocument)return e.rootDocument;const i={query:{f:"json",token:e.apiKey},responseType:"json",signal:e.signal};try{const r=await y(e.sceneServerUrl,i);e.rootDocument=r.data}catch{e.rootDocument={}}return e.rootDocument}async function O(e){const i=A?.findServerInfo(e.sceneServerUrl);if(i?.owningSystemUrl)return i.owningSystemUrl;const r=e.sceneServerUrl.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const a=(await y(r,{query:{f:"json"},responseType:"json",signal:e.signal})).data.owningSystemUrl;if(a)return a}catch(a){m(a)}return null}async function p(e,i){const r=L(e);if(!r)throw new s("invalid-feature-service-url","Invalid feature service url");const a=r.url.path,o=i.layerId;if(o==null)return{serverUrl:a};const _=E(i),d=n=>{const I={query:{f:"json"},responseType:"json",authMode:n,signal:i.signal};return y(a,I)},v=d("anonymous").catch(()=>d("no-prompt")),[c,w]=await Promise.all([v,_]),l=w?.layers,u=c.data&&c.data.layers;if(!Array.isArray(u))throw new Error("expected layers array");if(Array.isArray(l)){for(let n=0;n<Math.min(l.length,u.length);n++)if(l[n].id===o)return{serverUrl:a,layerId:u[n].id}}else if(o!=null&&o<u.length)return{serverUrl:a,layerId:u[o].id};throw new Error("could not find matching associated sublayer")}async function V({sceneLayerItem:e,signal:i}){if(!e)return null;try{const r=(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:i})).find(o=>o.type==="Feature Service")||null;if(!r)return null;const a=new f({portal:r.portal,id:r.id});return await a.load(),a}catch(r){return m(r),null}}export{R as a,h as l};
