(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();const kPe="modulepreload",zPe=function(t,e){return new URL(t,e).href},mte={},ke=function(e,i,r){if(!i||i.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(i.map(s=>{if(s=zPe(s,r),s in mte)return;mte[s]=!0;const a=s.endsWith(".css"),u=a?'[rel="stylesheet"]':"";if(!!r)for(let b=n.length-1;b>=0;b--){const S=n[b];if(S.href===s&&(!a||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${u}`))return;const y=document.createElement("link");if(y.rel=a?"stylesheet":kPe,a||(y.as="script",y.crossOrigin=""),y.href=s,document.head.appendChild(y),a)return new Promise((b,S)=>{y.addEventListener("load",b),y.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})};function _(t,e,i,r){var n,s=arguments.length,a=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(t,e,i,r);else for(var u=t.length-1;u>=0;u--)(n=t[u])&&(a=(s<3?n(a):s>3?n(e,i,a):n(e,i))||a);return s>3&&a&&Object.defineProperty(e,i,a),a}function G4t(t,e,i,r){function n(s){return s instanceof i?s:new i(function(a){a(s)})}return new(i||(i=Promise))(function(s,a){function u(b){try{y(r.next(b))}catch(S){a(S)}}function p(b){try{y(r.throw(b))}catch(S){a(S)}}function y(b){b.done?s(b.value):n(b.value).then(u,p)}y((r=r.apply(t,e||[])).next())})}let Ry;function Me(t){return typeof Ry[t]=="function"?Ry[t]=Ry[t](globalThis):Ry[t]}Ry=globalThis.dojoConfig?.has||globalThis.esriConfig?.has?{...globalThis.dojoConfig?.has,...globalThis.esriConfig?.has}:{},Me.add=(t,e,i,r)=>((r||Ry[t]===void 0)&&(Ry[t]=e),i&&Me(t)),Me.cache=Ry,Me.add("big-integer-warning-enabled",!0),Me.add("esri-deprecation-warnings",!0),Me.add("esri-tests-disable-screenshots",!1),Me.add("esri-tests-use-full-window",!1),Me.add("esri-tests-post-to-influx",!0),(()=>{Me.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(Me.add("host-browser",t),Me.add("host-node",typeof globalThis.process=="object"&&globalThis.process.versions?.node&&globalThis.process.versions.v8),Me.add("dom",t),Me("host-browser")){const e=navigator,i=e.userAgent,r=e.appVersion,n=parseFloat(r);if(Me.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),Me.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),Me.add("khtml",r.includes("Konqueror")?n:void 0),Me.add("edge",parseFloat(i.split("Edge/")[1])||void 0),Me.add("opr",parseFloat(i.split("OPR/")[1])||void 0),Me.add("webkit",!Me("wp")&&!Me("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),Me.add("chrome",!Me("edge")&&!Me("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),Me.add("android",!Me("wp")&&parseFloat(i.split("Android ")[1])||void 0),Me.add("safari",!r.includes("Safari")||Me("wp")||Me("chrome")||Me("android")||Me("edge")||Me("opr")?void 0:parseFloat(r.split("Version/")[1])),Me.add("mac",r.includes("Macintosh")),!Me("wp")&&/(iPhone|iPod|iPad)/.test(i)){const s=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",u=parseFloat(a.replace(/_/,".").replaceAll("_",""));Me.add(s,u),Me.add("ios",u)}Me("webkit")||(!i.includes("Gecko")||Me("wp")||Me("khtml")||Me("edge")||Me.add("mozilla",n),Me("mozilla")&&Me.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&Me.add("esri-mobile",e),i&&Me.add("esri-iPhone",i),Me.add("esri-geolocation",!!navigator.geolocation)}Me.add("esri-wasm","WebAssembly"in globalThis),Me.add("esri-performance-mode-frames-between-render",20),Me.add("esri-force-performance-mode",!1),Me.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),Me.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),Me.add("esri-atomics","Atomics"in globalThis),Me.add("esri-workers","Worker"in globalThis),Me.add("web-feat:cache","caches"in globalThis),Me.add("esri-workers-arraybuffer-transfer",!Me("safari")||Number(Me("safari"))>=12),Me.add("workers-pool-size",8),Me.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),Me.add("featurelayer-simplify-payload-size-factors",[1,1,4]),Me.add("featurelayer-animation-enabled",!0),Me.add("featurelayer-snapshot-enabled",!0),Me.add("featurelayer-snapshot-point-min-threshold",8e4),Me.add("featurelayer-snapshot-point-max-threshold",4e5),Me.add("featurelayer-snapshot-point-coverage",.1),Me.add("featurelayer-advanced-symbols",!1),Me.add("featurelayer-pbf",!0),Me.add("featurelayer-pbf-statistics",!1),Me.add("feature-layers-workers",!0),Me.add("feature-polyline-generalization-factor",1),Me.add("mapview-transitions-duration",200),Me.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),Me.add("mapserver-pbf-version-support",10.81),Me.add("mapservice-popup-identify-max-tolerance",20),Me.add("heatmap-allow-raster-fallback",!1),Me.add("heatmap-force-raster",!1),Me("host-webworker")||Me("host-browser")&&(Me.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),Me.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{Me.add("esri-image-decode",!0,!0,!0)}).catch(()=>{Me.add("esri-image-decode",!1,!0,!0)})}return!1}),Me.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();let TA=class $_{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*$_._m}getInt(){return this._seed=($_._a*this._seed+$_._c)%$_._m,this._seed}getFloat(){return this.getInt()/($_._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/$_._m*r}};TA._m=2147483647,TA._a=48271,TA._c=0;const pD=1.5,UPe=1/pD,jPe=.5;function fD(t,e){return e?t.filter((i,r,n)=>n.findIndex(e.bind(null,i))===r):Array.from(new Set(t))}function bg(t,e,i){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function iJ(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function BPe(t,e,i){let r,n;return i?(r=e.filter(s=>!t.some(a=>i(a,s))),n=t.filter(s=>!e.some(a=>i(a,s)))):(r=e.filter(s=>!t.includes(s)),n=t.filter(s=>!e.includes(s))),{added:r,removed:n}}function VPe(t){return t&&typeof t.length=="number"}function H4t(t,e){const i=t.length;if(i===0)return[];const r=[];for(let n=0;n<i;n+=e)r.push(t.slice(n,n+e));return r}const GPe=!!Array.prototype.fill;function q4t(t,e){if(GPe)return new Array(t).fill(e);const i=new Array(t);for(let r=0;r<t;r++)i[r]=e;return i}function HPe(t,e){e===void 0&&(e=t,t=0);const i=new Array(e-t);for(let r=t;r<e;r++)i[r-t]=r;return i}function qPe(t,e,i){const r=t.length;let n=0,s=r-1;for(;n<s;){const u=n+Math.floor((s-n)/2);e>t[u]?n=u+1:s=u}const a=t[n];return i?e>=t[r-1]?-1:a===e?n:n-1:a===e?n:-1}let Yfe=class{constructor(){this.last=0}};const Zfe=new Yfe;function dj(t,e,i,r){r=r||Zfe;const n=Math.max(0,r.last-10);for(let a=n;a<i;++a)if(t[a]===e)return r.last=a,a;const s=Math.min(n,i);for(let a=0;a<s;++a)if(t[a]===e)return r.last=a,a;return-1}function A4(t,e,i,r){const n=i??t.length,s=dj(t,e,n,r);if(s!==-1)return t[s]=t[n-1],i==null&&t.pop(),e}const yd=new Set;function WPe(t,e,i=t.length,r=e.length,n,s){if(r===0||i===0)return i;yd.clear();for(let u=0;u<r;++u)yd.add(e[u]);n=n||Zfe;const a=Math.max(0,n.last-10);for(let u=a;u<i;++u)if(yd.has(t[u])&&(s?.push(t[u]),yd.delete(t[u]),t[u]=t[i-1],--i,--u,yd.size===0||i===0))return yd.clear(),i;for(let u=0;u<a;++u)if(yd.has(t[u])&&(s?.push(t[u]),yd.delete(t[u]),t[u]=t[i-1],--i,--u,yd.size===0||i===0))return yd.clear(),i;return yd.clear(),i}function XPe(t,e){let i=0;for(let r=0;r<t.length;++r){const n=t[r];e(n,r)&&(t[i]=n,i++)}t.length=i}function JPe(t){return t?(gte.seed=t,()=>gte.getFloat()):Math.random}function X4t(t,e){const i=JPe(e);for(let r=t.length-1;r>0;r--){const n=Math.floor(i()*(r+1)),s=t[r];t[r]=t[n],t[n]=s}return t}const gte=new TA;function rJ(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function J4t(t,e){const i=new Map,r=t.length;for(let n=0;n<r;n++){const s=t[n],a=e(s,n,t),u=i.get(a);u?u.push(s):i.set(a,[s])}return i}function gw(t,e){return t!=null}const YPe=[];function Kfe(t){return 32+t.length}function nJ(){return 16}function Qfe(t){if(!t)return 0;let e=i0e;for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];switch(typeof r){case"string":e+=Kfe(r);break;case"number":e+=nJ();break;case"boolean":e+=4}}return e}function e0e(t){if(!t)return 0;if(Array.isArray(t))return ZPe(t);let e=i0e;for(const i in t)t.hasOwnProperty(i)&&(e+=t0e(t[i]));return e}function ZPe(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let i=r0e;for(let r=0;r<e;r++)i+=t0e(t[r]);return i}function t0e(t){switch(typeof t){case"object":return e0e(t);case"string":return Kfe(t);case"number":return nJ();case"boolean":return 4;default:return 8}}function KPe(t,e){return r0e+t.length*e}const i0e=32,r0e=32;function BC(t){return t instanceof ArrayBuffer}function sJ(t){return t?.constructor?.name==="Int8Array"}function My(t){return t?.constructor?.name==="Uint8Array"}function n0e(t){return t?.constructor?.name==="Uint8ClampedArray"}function oJ(t){return t?.constructor?.name==="Int16Array"}function mD(t){return t?.constructor?.name==="Uint16Array"}function aJ(t){return t?.constructor?.name==="Int32Array"}function gD(t){return t?.constructor?.name==="Uint32Array"}function nE(t){return t?.constructor?.name==="Float32Array"}function sE(t){return t?.constructor?.name==="Float64Array"}function Zh(t){return!("buffer"in t)}function rv(...t){return t.reduce((e,i)=>e+(i?Zh(i)?KPe(i,nJ()):i.byteLength+s0e:0),0)}const s0e=145,Yu=1024;function QPe(t){return sE(t)||nE(t)||aJ(t)||oJ(t)||sJ(t)}function e9e(t){return sE(t)||nE(t)}function t9e(t){return sE(t)?179769e303:nE(t)?3402823e32:gD(t)?4294967295:mD(t)?65535:My(t)||n0e(t)?255:aJ(t)?2147483647:oJ(t)?32767:sJ(t)?127:256}function yD(t,e){let i;if(e)for(i in t)t.hasOwnProperty(i)&&(t[i]===void 0?delete t[i]:t[i]instanceof Object&&yD(t[i],!0));else for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function Ce(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=l0e(t);if(e!=null)return e;if(E6(t))return t.clone();if(o0e(t))return t.map(Ce);if(a0e(t))return t.clone();const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=Ce(t[r]);return i}function pj(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=l0e(t);if(e!=null)return e;if(o0e(t)){let i=!0;const r=t.map(n=>{const s=pj(n);return n!=null&&s==null&&(i=!1),s});return i?r:null}if(E6(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!a0e(t)){const i=new(Object.getPrototypeOf(t)).constructor;for(const r of Object.getOwnPropertyNames(t)){const n=t[r],s=pj(n);if(n!=null&&s==null)return null;i[r]=s}return i}return null}function E6(t){return typeof t.clone=="function"}function o0e(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function a0e(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function yte(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function l0e(t){if(sJ(t)||My(t)||n0e(t)||oJ(t)||mD(t)||aJ(t)||gD(t)||nE(t)||sE(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,Ce(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(Ce(i));return e}return null}function lJ(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof t?.getTime=="function"&&typeof e?.getTime=="function"&&t.getTime()===e.getTime()||!1}function c0e(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&bg(t,e):t instanceof Set?e instanceof Set&&r9e(t,e):t instanceof Map?e instanceof Map&&n9e(t,e):!!yte(t)&&yte(e)&&i9e(t,e))}function i9e(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function r9e(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function n9e(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const n=e.get(i);if(n!==r||n===void 0&&!e.has(i))return!1}return!0}function cJ(t,e,i=!1){return h0e(t,e,i)}function tg(t,e){if(e!=null)return e[t]||u0e(t.split("."),!1,e)}function bl(t,e,i){const r=t.split("."),n=r.pop(),s=u0e(r,!0,i);s&&n&&(s[n]=e)}function u0e(t,e,i){let r=i;for(const n of t){if(r==null)return;if(!(n in r)){if(!e)return;r[n]={}}r=r[n]}return r}function h0e(t,e,i){return e?Object.keys(e).reduce((r,n)=>{let s=r[n],a=e[n];return s===a?r:s===void 0?(r[n]=Ce(a),r):(Array.isArray(a)||Array.isArray(r)?(s=s?Array.isArray(s)?r[n]=s.concat():r[n]=[s]:r[n]=[],a&&(Array.isArray(a)||(a=[a]),i?a.forEach(u=>{s.includes(u)||s.push(u)}):r[n]=a.concat())):a&&typeof a=="object"?r[n]=h0e(s,a,i):r.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(r[n]=a),r)},t||{}):t}const vr={apiKey:void 0,applicationName:"",applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(cJ(vr,globalThis.esriConfig,!0),delete vr.has),!vr.assetsPath){{const t="4.28";vr.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}vr.defaultAssetsPath=vr.assetsPath}const s9e=/\{([^\}]+)\}/g;function vte(t){return t??""}function vD(t,e){return e?t.replaceAll(s9e,typeof e=="object"?(i,r)=>vte(tg(r,e)):(i,r)=>vte(e(r))):t}function Y4t(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>e&&e.includes(i)?i:`\\${i}`)}function uJ(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}function Z4t(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}function K4t(t,e){return new RegExp(`{${e}}`,"ig").test(t)}const _te={info:0,warn:1,error:2,none:3};let Ee=class el{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,el._loggers.set(this.module,this);const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=el.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(e=new Map){const i=el._loggers;return el._loggers=e,i},set throttlingDisabled(e){el._throttlingDisabled=e}}}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,el._loggers.get(e)||new el({module:e})}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!el._throttlingDisabled){const n=this._argsToKey(r),s=this._loggedMessages[e].get(n);if(i==="once"&&s!=null||i==="oncePerTick"&&s&&s>=el._tickCounter)return;this._loggedMessages[e].set(n,el._tickCounter),el._scheduleTickCounterIncrement()}for(const n of vr.log.interceptors)if(n(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;r!=null;){const n=r[e];if(n!=null)return n;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,i,...r){console[e](`[${i}]`,...r)}_matchLevel(e){const i=vr.log.level||"warn";return _te[this._parentWithMember("level",i)]<=_te[e]}_argsToKey(...e){return uJ(JSON.stringify(e,(r,n)=>typeof n!="object"||Array.isArray(n)?n:"[Object]"))}static _scheduleTickCounterIncrement(){el._tickCounterScheduled||(el._tickCounterScheduled=!0,Promise.resolve().then(()=>{el._tickCounter++,el._tickCounterScheduled=!1}))}};Ee._loggers=new Map,Ee._tickCounter=0,Ee._tickCounterScheduled=!1,Ee._throttlingDisabled=!1;function o9e(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>r===""?"$":(tg(r,e)??"").toString())}let d0e=class{constructor(e,i,r){this.name=e,this.details=r,this.message=(i&&o9e(i,r))??""}toString(){return"["+this.name+"]: "+this.message}},de=class p0e extends d0e{constructor(e,i,r){super(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return Ce(i)}catch{return"[object]"}}))}}catch(e){throw Ee.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new p0e(e.name,e.message,e.details)}};de.prototype.type="error";const bte=new Set;function a9e(t,e,i=!1){i&&bte.has(e)||(i&&bte.add(e),t.warn(`ðŸ›‘ DEPRECATED - ${e}`))}function f0e(t,e,i={}){if(Me("esri-deprecation-warnings")){const{moduleName:r}=i;rS(t,`Function: ${(r?r+"::":"")+e+"()"}`,i)}}function fp(t,e,i={}){if(Me("esri-deprecation-warnings")){const{moduleName:r}=i;rS(t,`Property: ${(r?r+"::":"")+e}`,i)}}function rS(t,e,i={}){if(Me("esri-deprecation-warnings")){const{replacement:r,version:n,see:s,warnOnce:a}=i;let u=e;r&&(u+=`
	ðŸ› ï¸ Replacement: ${r}`),n&&(u+=`
	âš™ï¸ Version: ${n}`),s&&(u+=`
	ðŸ”— See ${s} for more details.`),a9e(t,u,a)}}function eOt(t){const e=[];return function*(){yield*e;for(const i of t)e.push(i),yield i}}function l9e(t,e){for(const i of t)if(i!=null&&e(i))return i}function fj(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let Dg=class mj{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(fj(e)){const r=this._getOrCreateGroup(i);for(const n of e)this._isHandle(n)&&r.push(n)}else this._isHandle(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&fj(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&(!!e.remove||e instanceof mj)}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(this._ensureGroupKey(e),i),i}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){for(const i of e)i instanceof mj?i.removeAll():i.remove()}};function _D(t,e){if(t==null)throw new Error(e??"value is None")}function ct(t){return t?.destroy(),null}function jt(t){return t?.dispose(),null}function nn(t){return t?.remove(),null}function Vc(t){return t?.abort(),null}function Gi(t){return t?.release(),null}function c9e(t,e,i){return t!=null&&e!=null?i!=null?i(t,e):t.equals(e):t===e}function wte(t,e){return t?.[e]}const m0e=Symbol("Accessor-beforeDestroy"),u9e={remove:()=>{}};function Sr(t){return t?{remove(){t&&(t(),t=void 0)}}:u9e}function h9e(t){t.forEach(e=>e?.remove())}function nv(t){return Sr(()=>h9e(t))}function g0e(t){return Sr(t!=null?()=>t.destroy():void 0)}function Ql(t){return t.__accessor__??null}function d9e(t,e){return t?.metadatas?.[e]!=null}function sI(t,e,i){return i?C6(t,e,{policy:i,path:""}):C6(t,e,null)}function C6(t,e,i){return e?Object.keys(e).reduce((r,n)=>{const s=n;let a=null,u="merge";if(i&&(a=i.path?`${i.path}.${n}`:n,u=i.policy(a)),u==="replace"||u==="replace-arrays"&&Array.isArray(r[s]))return r[s]=e[s],r;if(r[s]===void 0)return r[s]=Ce(e[s]),r;let p=r[s],y=e[s];if(p===y)return r;if(Array.isArray(y)||Array.isArray(r))p=p?Array.isArray(p)?r[s]=p.concat():r[s]=[p]:r[s]=[],y&&(Array.isArray(y)||(y=[y]),y.forEach(b=>{p.includes(b)||p.push(b)}));else if(y&&typeof y=="object")if(i){const b=i.path;i.path=a,r[s]=C6(p,y,i),i.path=b}else r[s]=C6(p,y,null);else r.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(r[s]=y);return r},t||{}):t}function y0e(t){return Array.isArray(t)?t:t.split(".")}function xte(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function p9e(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...xte(i));return e}return xte(t)}function v0e(t,e,i,r){const n=p9e(e);if(n.length!==1){const s=n.map(a=>r(t,a,i));return nv(s)}return r(t,n[0],i)}function _0e(t,e){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(e)?e[n]:e.at(n)}const r=Ql(e);return d9e(r,i)?r.get(i):e[i]}function b0e(t,e,i){if(t==null)return t;const r=_0e(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:b0e(r,e,i+1)}function DO(t,e,i=0){return typeof e!="string"||e.includes(".")?b0e(t,y0e(e),i):_0e(e,t)}function xp(t,e){return DO(t,e)}function Tte(t,e){return DO(e,t)!==void 0}function NO(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=Ce(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function bD(t,e){const i=NO(t);let r=i[e];return r||(r=i[e]={}),r}function f9e(t,e){return sI(t,e,g9e)}const m9e=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function g9e(t){return m9e.test(t)?"replace":"merge"}function y9e(t){return t?.release&&typeof t.release=="function"}function v9e(t){return t?.acquire&&typeof t.acquire=="function"}let Ua=class gj{constructor(e,i,r,n=1,s=0){if(this._ctor=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=n,this._pool=new Array(s),this._initialSize=s,this._ctor)for(let a=0;a<s;a++)this._pool[a]=new this._ctor;this.allocationSize=Math.max(n,1)}destroy(){this.prune(0)}acquire(...e){let i;if(gj.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let n=0;n<r;n++)this._pool[n]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):v9e(i)&&i.acquire(...e),i}release(e){e&&!gj.test.disabled&&(this._releaseFunction?this._releaseFunction(e):y9e(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};Ua.test={disabled:!1};var Km;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(Km||(Km={}));let _9e=class{constructor(e,i){this._observers=e,this._observer=i}remove(){rJ(this._observers,this._observer)}},w0e=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return b9e;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,n=!1;const s=i.length;for(let a=0;a<s;++a){const u=i[a];if(u.destroyed)n=!0;else if(u===e){r=!0;break}}return r||(i.push(e),n&&this._removeDestroyedObservers()),new _9e(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let n=0;n<i;++n){for(;n+r<i&&e[n+r].destroyed;)++r;if(r>0){if(!(n+r<i))break;e[n]=e[n+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const b9e=Sr();var cr;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(cr||(cr={}));const yj=cr.USER+1;function Py(t){switch(t){case"defaults":return cr.DEFAULTS;case"service":return cr.SERVICE;case"portal-item":return cr.PORTAL_ITEM;case"web-scene":return cr.WEB_SCENE;case"web-map":return cr.WEB_MAP;case"link-chart":return cr.LINK_CHART;case"user":return cr.USER;default:return null}}function A6(t){switch(t){case cr.DEFAULTS:return"defaults";case cr.SERVICE:return"service";case cr.PORTAL_ITEM:return"portal-item";case cr.WEB_SCENE:return"web-scene";case cr.WEB_MAP:return"web-map";case cr.LINK_CHART:return"link-chart";case cr.USER:return"user"}}function w9e(t){return A6(t)}var fn;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(fn||(fn={}));const O6={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},VC=[];let SA=O6;function di(t){SA.onObservableAccessed(t)}let oI=!1,aI=!1;function wg(t,e,i){if(oI)return hJ(t,e,i);x0e(t);const r=e.call(i);return T0e(),r}function x9e(t,e){return wg(O6,t,e)}function hJ(t,e,i){const r=oI;oI=!0,x0e(t);let n=null;try{n=e.call(i)}catch(s){aI&&Ee.getLogger("esri.core.accessorSupport.tracking").error(s)}return T0e(),oI=r,n}function x0e(t){SA=t,VC.push(t)}function T0e(){const t=VC.length;if(t>1){const e=VC.pop();SA=VC[t-2],e.onTrackingEnd()}else if(t===1){const e=VC.pop();SA=O6,e.onTrackingEnd()}else SA=O6}function S0e(t,e){if(e.flags&fn.DepTrackingInitialized)return;const i=aI;aI=!1,e.flags&fn.AutoTracked?hJ(e,e.metadata.get,t):E0e(t,e),aI=i}const T9e=[];function E0e(t,e){e.flags&fn.ExplicitlyTracking||(e.flags|=fn.ExplicitlyTracking,hJ(e,()=>{const i=e.metadata.dependsOn||T9e;for(const r of i)if(typeof r!="string"||r.includes(".")){const n=y0e(r);for(let s=0,a=t;s<n.length&&a!=null&&typeof a=="object";++s)a=Ste(a,n[s],s!==n.length-1)}else Ste(t,r,!1)}),e.flags&=~fn.ExplicitlyTracking)}function Ste(t,e,i){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.at(s)}const n=Ql(t);if(n){const s=n.propertiesByName.get(r);s&&(di(s),S0e(t,s))}return i?t[r]:void 0}let Ete=class extends w0e{constructor(e,i){super(),this.propertyName=e,this.metadata=i,this._accessed=null,this._handles=null,this.flags=0,this.flags=fn.Dirty|(i.nonNullable?fn.NonNullable:0)|(i.hasOwnProperty("value")?fn.HasDefaultValue:0)|(i.get===void 0?fn.DepTrackingInitialized:0)|(i.dependsOn===void 0?fn.AutoTracked:0)}destroy(){this.flags&fn.Dirty&&this.onCommitted(),super.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){di(this);const i=e.store,r=this.propertyName,n=this.flags,s=i.get(r);if(n&fn.Computing||~n&fn.Dirty&&i.has(r))return s;this.flags|=fn.Computing;const a=e.host;let u;n&fn.AutoTracked?u=wg(this,this.metadata.get,a):(E0e(a,this),u=this.metadata.get.call(a)),i.set(r,u,cr.COMPUTED);const p=i.get(r);return p===s?this.flags&=~fn.Dirty:x9e(this.commit,this),this.flags&=~fn.Computing,p}onObservableAccessed(e){if(e===this)return;let i=this._accessed;if(i==null)i=[],this._accessed=i;else if(i.includes(e))return;i.push(e)}onTrackingEnd(){this._clearObservationHandles(),this.flags|=fn.DepTrackingInitialized;const e=this._accessed;if(e==null||e.length===0)return;let i=this._handles;i==null&&(i=[],this._handles=i);for(let r=0;r<e.length;++r)i.push(e[r].observe(this));e.length=0}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~fn.Dirty,this.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let i=0;i<e.length;++i)e[i].remove();e.length=0}}onInvalidated(){~this.flags&fn.Overriden&&(this.flags|=fn.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}},S9e=class C0e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new C0e;return this._values.forEach((r,n)=>{e&&e.has(n)||i.set(n,Ce(r))}),i}get(e){return this._values.get(e)}originOf(){return cr.USER}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function qR(t,e,i){return t!==void 0}function Cte(t,e,i,r){return t!==void 0&&(!(i==null&&t.flags&fn.NonNullable)||(r.lifecycle,Km.INITIALIZING,!1))}function E9e(t){return t&&typeof t.destroy=="function"}Ee.getLogger("esri.core.accessorSupport.Properties");let C9e=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=Km.INITIALIZING,this.store=new S9e,this._origin=cr.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const n=new Ete(r,i[r]);this.propertiesByName.set(r,n)}this.metadatas=i}initialize(){this.lifecycle=Km.CONSTRUCTING}constructed(){this.lifecycle=Km.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,i]of this.propertiesByName){if(i.metadata.autoDestroy){const r=this.internalGet(e);r&&E9e(r)&&(r.destroy(),~i.flags&fn.NonNullable&&this._internalSet(i,null))}i.destroy()}}get initialized(){return this.lifecycle!==Km.INITIALIZING}get(e){const i=this.propertiesByName.get(e);if(i.metadata.get)return i.getComputed(this);di(i);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.propertiesByName.get(e);if(r!==void 0&&r.flags&fn.HasDefaultValue)return"defaults"}return A6(i)}has(e){return!!this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const i=this.propertiesByName.get(e);if(qR(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.propertiesByName.get(e);qR(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const n=this.propertiesByName.get(i);if(!qR(n))return"";const s=new Set,a=wg({onObservableAccessed:p=>s.add(p),onTrackingEnd:()=>{}},()=>n.metadata.get?.call(e));let u=`${r}${e.declaredClass.split(".").pop()}.${i}: ${a}
`;if(s.size===0)return u;r+="  ";for(const p of s)p instanceof Ete&&(u+=`${r}${p.propertyName}: undefined
`);return u}setAtOrigin(e,i,r){const n=this.propertiesByName.get(e);if(qR(n))return this._setAtOrigin(n,i,r)}isOverridden(e){const i=this.propertiesByName.get(e);return i!==void 0&&!!(i.flags&fn.Overriden)}clearOverride(e){const i=this.propertiesByName.get(e);i&&i.flags&fn.Overriden&&(i.flags&=~fn.Overriden,i.notifyChange())}override(e,i){const r=this.propertiesByName.get(e);if(!Cte(r,e,i,this))return;const n=r.metadata.cast;if(n){const s=this._cast(n,i),{valid:a,value:u}=s;if(JN.release(s),!a)return;i=u}r.flags|=fn.Overriden,this._internalSet(r,i)}set(e,i){const r=this.propertiesByName.get(e);if(!Cte(r,e,i,this))return;const n=r.metadata.cast;if(n){const a=this._cast(n,i),{valid:u,value:p}=a;if(JN.release(a),!u)return;i=p}const s=r.metadata.set;s?s.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=Py(e)}getDefaultOrigin(){return A6(this._origin)}notifyChange(e){const i=this.propertiesByName.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.propertiesByName.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.propertiesByName.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==Km.INITIALIZING?this._origin:cr.DEFAULTS;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const n=this.store,s=e.propertyName;n.has(s,r)&&lJ(i,n.get(s))&&~e.flags&fn.Overriden&&r===n.originOf(s)||(e.invalidate(),n.set(s,i,r),e.commit(),S0e(this.host,e))}_cast(e,i){const r=JN.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},A9e=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const JN=new Ua(A9e);function R6(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))R6(t,r,e[r]);else{if(e.includes(".")){const n=e.split("."),s=n.splice(-1,1)[0];return void R6(xp(t,n),s,i)}const r=t.__accessor__;r!=null&&O9e(e,r),t[e]=i}}function O9e(t,e){if(Me("esri-unknown-property-errors")&&!R9e(t,e))throw new de("set:unknown-property",M9e(t,e))}function R9e(t,e){return e.metadatas[t]!=null}function M9e(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let P9e;function I9e(){return P9e}var Ate;(function(t){t[t.Ignore=0]="Ignore",t[t.Destroy=1]="Destroy",t[t.ThrowError=2]="ThrowError"})(Ate||(Ate={}));function $9e(t){t.length=0}let Rc=class{constructor(e=50,i=50){this._pool=new Ua(Array,void 0,$9e,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return YN.acquire()}static release(e){return YN.release(e)}static prune(){YN.prune()}};const YN=new Rc(100);let A0e=class extends Ua{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const WR=[];function nS(t){WR.push(t),WR.length===1&&queueMicrotask(()=>{const e=WR.slice();WR.length=0;for(const i of e)i()})}let ig=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var vj;(function(t){const e=(s,a,u,p)=>{let y=a,b=a;const S=u>>>1,C=s[y-1];for(;b<=S;){b=y<<1,b<u&&p(s[b-1],s[b])<0&&++b;const O=s[b-1];if(p(O,C)<=0)break;s[y-1]=O,y=b}s[y-1]=C},i=(s,a)=>s<a?-1:s>a?1:0;function r(s,a,u,p){a===void 0&&(a=0),u===void 0&&(u=s.length),p===void 0&&(p=i);for(let b=u>>>1;b>a;b--)e(s,b,u,p);const y=a+1;for(let b=u-1;b>a;b--){const S=s[a];s[a]=s[b],s[b]=S,e(s,y,b,p)}}function*n(s,a,u,p){a===void 0&&(a=0),u===void 0&&(u=s.length),p===void 0&&(p=i);for(let b=u>>>1;b>a;b--)e(s,b,u,p),yield;const y=a+1;for(let b=u-1;b>a;b--){const S=s[a];s[a]=s[b],s[b]=S,e(s,y,b,p),yield}}t.sort=r,t.iterableSort=n})(vj||(vj={}));const Ote=vj,L9e=1.5,D9e=1.1;let xi=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new Yfe,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>Rte(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const n=this.data[r];e(n)&&i.push(n)}return i}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,Rte(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=dj(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(dj(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=WPe(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){Ote.sort(this.data,0,this.length,e)}iterableSort(e){return Ote.iterableSort(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){for(let r=0;r<this.length;++r){const n=this.data[r];if(e.call(i,n,r))return n}}filterInPlace(e,i){let r=0;for(let n=0;n<this._length;++n){const s=this.data[n];e.call(i,s,n,this.data)&&(this.data[n]=this.data[r],this.data[r]=s,r++)}if(this._deallocator)for(let n=r;n<this._length;n++)this.data[n]=this._deallocator(this.data[n]);return this._length=r,this._shrink(),this}forAll(e,i){const r=this.length,n=this.data;for(let s=0;s<r;++s)e.call(i,n[s],s,n)}forEach(e,i){for(let r=0;r<this.length;++r)e.call(i,this.data[r],r,this.data)}map(e,i){const r=new Array(this.length);for(let n=0;n<this.length;++n)r[n]=e.call(i,this.data[n],n,this.data);return r}reduce(e,i){let r=i;for(let n=0;n<this.length;++n)r=e(r,this.data[n],n,this.data);return r}has(e){const i=this.length,r=this.data;for(let n=0;n<i;++n)if(r[n]===e)return!0;return!1}};function Rte(t){t.data.length>L9e*t.length&&(t.data.length=Math.floor(t.length*D9e))}function N9e(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return Sr(()=>t.clearTimeout(r))}}}const FO=N9e(globalThis);function wD(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function lg(t,e,i){if(!wD(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,i);if(Array.isArray(e)){const r=e.slice();for(const n of r)t.addEventListener(n,i);return Sr(()=>{for(const n of r)t.removeEventListener(n,i)})}return t.addEventListener(e,i),Sr(()=>t.removeEventListener(e,i))}function O0e(t,e,i){if(!wD(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=lg(t,e,n=>{r.remove(),i.call(t,n)});return r}const F9e={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function k9e({key:t}){return F9e[t]||t}function or(t="Aborted"){return new de("AbortError",t)}function oi(t,e="Aborted"){if(Ms(t))throw or(e)}function xD(t){return t!=null?"aborted"in t?t:t.signal:t}function Ms(t){const e=xD(t);return e!=null&&e.aborted}function $a(t){if(qn(t))throw t}function Mte(t){if(!qn(t))throw t}function qs(t,e){const i=xD(t);if(i!=null){if(!i.aborted)return O0e(i,"abort",()=>e());e()}}function kO(t,e){const i=xD(t);if(i!=null)return oi(i),O0e(i,"abort",()=>e(or()))}function R0e(t,e){return xD(e)==null?t:new Promise((i,r)=>{let n=qs(e,()=>r(or()));const s=()=>{n=nn(n)};t.then(s,s),t.then(i,r)})}function qn(t){return t?.name==="AbortError"}async function O4(t){try{return await t}catch(e){if(!qn(e))throw e;return}}async function uOt(t,e=Ee.getLogger("esri")){try{return await t}catch(i){qn(i)||e.error(i)}}async function zO(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(a=>t[a]),n=await zO(r),s={};return i.map((a,u)=>s[a]=n[u]),s}const e=t;return Promise.allSettled(e).then(i=>Array.from(e,(r,n)=>{const s=i[n];return s.status==="fulfilled"?{promise:r,value:s.value}:{promise:r,error:s.reason}}))}async function z9e(t){return(await zO(t)).filter(e=>!!e.value).map(e=>e.value)}async function Pte(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function U9e(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function R4(t,e=void 0,i){const r=new AbortController;return qs(i,()=>r.abort()),new Promise((n,s)=>{let a=setTimeout(()=>{a=0,n(e)},t);qs(r,()=>{a&&(clearTimeout(a),s(or()))})})}function Yc(t){return t&&typeof t.then=="function"}function _j(t){return Yc(t)?t:Promise.resolve(t)}function oE(t,e=-1){let i,r,n,s,a=null;const u=(...p)=>{if(i){r=p,s&&s.reject(or()),s=Ys();const C=s.promise;if(a){const O=a;a=null,O.abort()}return C}if(n=s||Ys(),s=null,e>0){const C=new AbortController;i=_j(t(...p,C.signal));const O=i;R4(e).then(()=>{i===O&&(s?C.abort():a=C)})}else i=1,i=_j(t(...p));const y=()=>{const C=r;r=n=i=a=null,C!=null&&u(...C)},b=i,S=n;return b.then(y,y),b.then(S.resolve,S.reject),S.promise};return u}function Ys(){let t,e;const i=new Promise((n,s)=>{t=n,e=s}),r=n=>{t(n)};return r.resolve=n=>t(n),r.reject=n=>e(n),r.timeout=(n,s)=>FO.setTimeout(()=>r.reject(s),n),r.promise=i,r}function hOt(t,e){return t.then(e,e)}async function Ite(t){await Promise.resolve(),oi(t)}function dOt(t){return t}function M0e(t){return 1e3*t}function pOt(t){return t}function dJ(t){return .001*t}let j9e=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},B9e=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},bj=0,wj=0;const FE={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},xj=["prepare","preRender","render","postRender","update","finish"],Tj=[],I2=new xi;let V9e=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const M6={frameTasks:I2,willDispatch:!1,clearFrameTasks:G9e,dispatch:$0e,executeFrameTasks:q9e};function yw(t){const e=new B9e(t);return Tj.push(e),M6.willDispatch||(M6.willDispatch=!0,nS($0e)),e}function $2(t){const e=new j9e(t);return I2.push(e),P6==null&&(bj=performance.now(),P6=requestAnimationFrame(P0e)),new V9e(e)}let P6=null;function G9e(t=!1){I2.forAll(e=>{e.removed=!0}),t&&I0e()}function H9e(t){wj=Math.max(0,t)}function P0e(){const t=performance.now();P6=null,P6=I2.length>0?requestAnimationFrame(P0e):null,M6.executeFrameTasks(t)}function q9e(t){const e=t-bj;bj=t;const i=wj>0?wj:1e3/60,r=Math.max(0,e-i);FE.time=t,FE.frameDuration=i-r;for(let n=0;n<xj.length;n++){const s=performance.now(),a=xj[n];I2.forAll(u=>{u.paused||u.removed||(n===0&&u.ticks++,u.phases[a]&&(FE.elapsedFrameTime=performance.now()-t,FE.deltaTime=u.ticks===0?0:e,u.phases[a]?.call(u,FE)))}),W9e[n].record(performance.now()-s)}I0e(),X9e.record(performance.now()-t)}const XR=new xi;function I0e(){I2.forAll(t=>{t.removed&&XR.push(t)}),I2.removeUnorderedMany(XR.data,XR.length),XR.clear()}function $0e(){for(;Tj.length;){const t=Tj.shift();t.isActive&&t.callback()}M6.willDispatch=!1}function yOt(t=1,e){const i=Ys(),r=()=>{Ms(e)?i.reject(or()):t===0?i():(--t,nS(()=>r()))};return r(),i.promise}const W9e=xj.map(t=>new ig(t)),X9e=new ig("total");function lI(t,e){for(const i of t.entries())if(e(i[0]))return!0;return!1}function $te(t,e){if(!e)return t;for(const i of e)t.add(i);return t}function J9e(t,e){const i=new Set;return $te(i,t),$te(i,e),i}function vOt(t,e){const i=new Set;for(const r of e)t.has(r)&&i.add(r);return i}function _Ot(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const i of t)if(!e.has(i))return!1;return!0}function bOt(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function wOt(t,e){const i=new Set(t);for(const r of e)i.delete(r);return i}let Y9e=0;const Z9e=0;function zu(){return++Y9e}let TD=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new K9e(e),Lte.register(this,new WeakRef(this._observerObject),this)}destroy(){Lte.unregister(this._observerObject),this._accessed.length=0,this._observerObject?.destroy(),this.clear()}onObservableAccessed(e){const i=this._accessed;i.includes(e)||i.push(e)}onTrackingEnd(){const e=this._handles,i=this._accessed,r=this._observerObject;for(let n=0;n<i.length;++n)e.push(i[n].observe(r));i.length=0}clear(){const e=this._handles;for(let i=0;i<e.length;++i)e[i].remove();e.length=0}},K9e=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=Q9e}};const Lte=new FinalizationRegistry(t=>{t.deref()?.destroy()});function Q9e(){}let OT=!1;const I6=[];function L0e(t,e){let i=new TD(s),r=null,n=!1;function s(){if(!i||n)return;if(OT)return void F0e(s);const u=r;i.clear(),OT=!0,n=!0,r=wg(i,t),n=!1,OT=!1,e(r,u),k0e()}function a(){i&&(i.destroy(),i=null,r=null)}return n=!0,r=wg(i,t),n=!1,Sr(a)}function D0e(t,e){let i=new TD(n),r=null;function n(){e(r,a)}function s(){i&&(i.destroy(),i=null),r=null}function a(){return i?(i.clear(),r=wg(i,t),r):null}return a(),Sr(s)}function N0e(t){let e=new TD(r),i=!1;function r(){e&&!i&&(OT?F0e(r):(e.clear(),OT=!0,i=!0,wg(e,t),i=!1,OT=!1,k0e()))}function n(){e&&(e.destroy(),e=null)}return i=!0,wg(e,t),i=!1,Sr(n)}function F0e(t){I6.includes(t)||I6.unshift(t)}function k0e(){for(;I6.length;)I6.pop()()}var EA;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(EA||(EA={}));let M4=class{constructor(){this.uid=zu(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,n,s){return this.pool.acquire(EA.Untracked,e,i,r,n,s,lJ)}static acquireTracked(e,i,r,n){return this.pool.acquire(EA.Tracked,e,i,r,null,null,n)}notify(e,i){this.type===EA.Untracked?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i,void 0,void 0)}acquire(e,i,r,n,s,a,u){this.uid=zu(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=n,this.target=s,this.path=a,this.equals=u}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=zu(),this.removed=!0}};M4.pool=new A0e(M4);const cI=new Rc,cg=new Set;let $6;function L6(t){cg.delete(t),cg.add(t),$6||($6=yw(iIe))}function eIe(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function tIe(t){for(const e of cg.values())e.target===t&&(e.removed=!0)}function iIe(){let t=10;for(;$6&&t--;){$6=null;const e=rIe(),i=cI.acquire();for(const r of e){const n=r.uid;eIe(r),n===r.uid&&r.removed&&i.push(r)}for(const r of cg)r.removed&&(i.push(r),cg.delete(r));for(const r of i)M4.pool.release(r);cI.release(i),cI.release(e),Sj.forEach(r=>r())}}function rIe(){const t=cI.acquire();t.length=cg.size;let e=0;for(const i of cg)t[e]=i,++e;return cg.clear(),t}const Sj=new Set;function z0e(t){return Sj.add(t),Sr(()=>Sj.delete(t))}function nIe(t,e,i){let r=v0e(t,e,i,(n,s,a)=>{let u,p,y=D0e(()=>DO(n,s),(b,S)=>{n.__accessor__.destroyed||u&&u.uid!==p?r.remove():(u||(u=M4.acquireUntracked(b,a,S,n,s),p=u.uid),L6(u))});return Sr(()=>{y.remove(),u&&(u.uid!==p||u.removed||(u.removed=!0,L6(u)),u=null),r=y=null})});return r}function sIe(t,e,i){const r=v0e(t,e,i,(n,s,a)=>{let u=!1;return L0e(()=>DO(n,s),(p,y)=>{n.__accessor__.destroyed?r.remove():u||(u=!0,lJ(y,p)||a.call(n,p,y,s,n),u=!1)})});return r}function oIe(t,e,i,r=!1){return!t.__accessor__||t.__accessor__.destroyed?Sr():r?sIe(t,e,i):nIe(t,e,i)}function aIe(t,e,i){let r,n,s=D0e(t,(a,u)=>{r&&r.uid!==n?s.remove():(r||(r=M4.acquireTracked(a,e,u,i),n=r.uid),L6(r))});return Sr(()=>{s.remove(),r&&(r.uid!==n||r.removed||(r.removed=!0,L6(r)),r=null),s=null})}function lIe(t,e,i){let r=!1;return L0e(t,(n,s)=>{r||(r=!0,i(s,n)||e(n,s),r=!1)})}function cIe(t,e,i=!1,r=c0e){return i?lIe(t,e,r):aIe(t,e,r)}function Dte(t){return lI(cg,e=>e.oldValue===t)}function Iu(t,e){for(const[i,r]of t)if(e(r,i))return!0;return!1}function EOt(t,e){for(const[i,r]of t)if(e(r,i))return r;return null}function U0e(t,e,i){const r=t.get(e);if(r!==void 0)return r;const n=i();return t.set(e,n),n}const RT=Ee.getLogger("esri.core.accessorSupport.ensureTypes");function uIe(t){return t==null?t:new Date(t)}function hIe(t){return t==null?t:!!t}function UO(t){return t==null?t:t.toString()}function $h(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function pJ(t){return t==null?t:Math.round(parseFloat(t))}function j0e(t){return t?.constructor&&t.constructor.__accessorMetadata__!==void 0}function D6(t,e){return e!=null&&t&&!(e instanceof t)}function B0e(t){return t&&"isCollection"in t}function Nte(t){return t?.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function dIe(t,e){if(!e?.constructor||!B0e(e.constructor))return Ej(t,e)?e:new t(e);const i=Nte(t.prototype.itemType),r=Nte(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(Ej(t,e),e):new t(e):e}function Ej(t,e){return!!j0e(e)&&(RT.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+SD(t)+"'"),!0)}function L2(t,e){return e==null?e:B0e(t)?dIe(t,e):D6(t,e)?Ej(t,e)?e:new t(e):e}function SD(t){return t?.prototype?.declaredClass||"unknown"}const pIe=new WeakMap;function fIe(t){switch(t){case Number:return $h;case Wr:return pJ;case Boolean:return hIe;case String:return UO;case Date:return uIe;default:return U0e(pIe,t,()=>L2.bind(null,t))}}function os(t,e){const i=fIe(t);return arguments.length===1?i:i(e)}function P4(t,e,i){return arguments.length===1?P4.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function mIe(t,e){return arguments.length===1?P4(i=>os(t,i)):P4(i=>os(t,i),e)}function V0e(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>V0e(t,e-1,r)):t(i)}function N6(t,e,i){if(arguments.length===2)return s=>N6(t,e,s);if(!i)return i;i=V0e(t,e,i);let r=e,n=i;for(;r>0&&Array.isArray(n);)r--,n=n[0];if(n!==void 0)for(let s=0;s<r;s++)i=[i];return i}function gIe(t,e,i){return arguments.length===2?N6(r=>os(t,r),e):N6(r=>os(t,r),e,i)}function G0e(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function Cj(t,e){if(arguments.length===2)return Cj(t).call(null,e);const i=new Set,r=t.filter(u=>typeof u!="function"),n=t.filter(u=>typeof u=="function");for(const u of t)typeof u!="string"&&typeof u!="number"||i.add(u);let s=null,a=null;return(u,p)=>{if(u==null)return u;const y=typeof u,b=y==="string"||y==="number";return b&&(i.has(u)||n.some(S=>y==="string"&&S===String||y==="number"&&S===Number))||y==="object"&&n.some(S=>!D6(u,S))?u:(b&&r.length?(s||(s=r.map(S=>typeof S=="string"?`'${S}'`:`${S}`).join(", ")),RT.error("Accessor#set",`'${u}' is not a valid value for this property, only the following values are valid: ${s}`)):typeof u=="object"&&n.length?(a||(a=n.map(S=>SD(S)).join(", ")),RT.error("Accessor#set",`'${u}' is not a valid value for this property, value must be one of ${a}`)):RT.error("Accessor#set",`'${u}' is not a valid value for this property`),p&&(p.valid=!1),null)}}function Pp(t,e){if(arguments.length===2)return Pp(t).call(null,e);const i={},r=[],n=[];for(const p in t.typeMap){const y=t.typeMap[p];i[p]=os(y),r.push(SD(y)),n.push(p)}const s=()=>`'${r.join("', '")}'`,a=()=>`'${n.join("', '")}'`,u=typeof t.key=="string"?p=>p[t.key]:t.key;return p=>{if(t.base&&!D6(t.base,p)||p==null)return p;const y=u(p)||t.defaultKeyValue,b=i[y];if(!b)return RT.error("Accessor#set",`Invalid property value, value needs to be one of ${s()}, or a plain object that can autocast (having .type = ${a()})`),null;if(!D6(t.typeMap[y],p))return p;if(typeof t.key=="string"&&!j0e(p)){const S={};for(const C in p)C!==t.key&&(S[C]=p[C]);return b(S)}return b(p)}}let Wr=class{};const AOt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function yIe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function H0e(t){switch(t.type){case"native":return os(t.value);case"array":return P4(H0e(t.value));case"one-of":return vIe(t);default:return null}}function vIe(t){let e=null;return(i,r)=>Oj(i,t)?i:(e==null&&(e=Aj(t)),RT.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function Aj(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Wr:return"integer";case Date:return"date";default:return SD(t.value)}case"array":return`array of ${Aj(t.value)}`;case"one-of":{const e=t.values.map(i=>Aj(i));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function Oj(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Wr:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!Oj(i,e.value));case"one-of":return e.values.some(i=>Oj(t,i))}}function T(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),n=bD(e,i);r&&(r.get||r.set?(n.get=r.get||n.get,n.set=r.set||n.set):"value"in r&&("value"in t&&Ee.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),n.value=t.value=r.value)),t.readOnly!=null&&(n.readOnly=t.readOnly);const s=t.aliasOf;if(s){const p=typeof s=="string"?s:s.source,y=typeof s=="string"?null:s.overridable===!0;let b;n.dependsOn=[p],n.get=function(){let S=xp(this,p);if(typeof S=="function"){b||(b=p.split(".").slice(0,-1).join("."));const C=xp(this,b);C&&(S=S.bind(C))}return S},n.readOnly||(n.set=y?function(S){this._override(i,S)}:function(S){R6(this,p,S)})}const a=t.type,u=t.types;n.cast||(a?n.cast=_Ie(a):u&&(Array.isArray(u)?n.cast=P4(Pp(u[0])):n.cast=Pp(u))),f9e(n,t),t.range&&(n.cast=bIe(n.cast,t.range))}}function q0e(t,e,i){const r=bD(t,i);r.json||(r.json={});let n=r.json;return e!==void 0&&(n.origins||(n.origins={}),n.origins[e]||(n.origins[e]={}),n=n.origins[e]),n}function _Ie(t){let e=0,i=t;if(yIe(t))return H0e(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(G0e(r))return e===0?Cj(r):N6(Cj(r),e);if(e===1)return mIe(r);if(e>1)return gIe(r,e);const n=t;return n.from?n.from:os(n)}function bIe(t,e){return i=>{let r=+t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}function wIe(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const n=e[r];i[r].forEach(s=>{e[s]=n}),delete e[r]}}}let T0=class extends d0e{constructor(e,i,r){super(e,i,r)}};T0.prototype.type="warning";function W0e(t){return!!t&&t.prototype?.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const Rj=Ee.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function Fte(t,e,i){t&&(!i&&!e.read||e.read?.reader||e.read?.enabled===!1||SIe(t)&&bl("read.reader",aE(t),e))}function aE(t){const e=t.ndimArray??0;if(e>1)return TIe(t);if(e===1)return kte(t);if("type"in t&&J0e(t.type)){const i=t.type.prototype?.itemType?.Type,r=kte(typeof i=="function"?{type:i}:{types:i});return(n,s,a)=>{const u=r(n,s,a);return u&&new t.type(u)}}return fJ(t)}function fJ(t){return"type"in t?xIe(t.type):EIe(t.types)}function xIe(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const n=typeof e;if(n!=="object")return void Rj.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${n}'`);const s=new t;return s.read(e,r),s}:t.fromJSON}function X0e(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(n=>X0e(t,n,i,r-1)):t(e,void 0,i)}function TIe(t){const e=fJ(t),i=X0e.bind(null,e),r=t.ndimArray??0;return(n,s,a)=>{if(n==null)return n;n=i(n,a,r);let u=r,p=n;for(;u>0&&Array.isArray(p);)u--,p=p[0];if(p!==void 0)for(let y=0;y<u;y++)n=[n];return n}}function kte(t){const e=fJ(t);return(i,r,n)=>{if(i==null)return i;if(Array.isArray(i)){const a=[];for(const u of i){const p=e(u,void 0,n);p!==void 0&&a.push(p)}return a}const s=e(i,void 0,n);return s!==void 0?[s]:void 0}}function J0e(t){if(!W0e(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?mJ(e.Type):Y0e(e.Type))}function SIe(t){return"types"in t?Y0e(t.types):mJ(t.type)}function mJ(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||J0e(t))}function Y0e(t){for(const e in t.typeMap)if(!mJ(t.typeMap[e]))return!1;return!0}function EIe(t){let e=null;const i=t.errorContext??"type",r=t.validate;return(n,s,a)=>{if(n==null)return n;const u=typeof n;if(u!=="object")return void Rj.error(`Expected JSON value of type 'object' to deserialize, but got '${u}'`);e||(e=CIe(t));const p=t.key;if(typeof p!="string")return;const y=n[p],b=y?e[y]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!b){const C=`Type '${y||"unknown"}' is not supported`;return a?.messages&&n&&a.messages.push(new T0(`${i}:unsupported`,C,{definition:n,context:a})),void Rj.error(C)}const S=new b;return S.read(n,a),r?r(S):S}}function CIe(t){const e={};for(const i in t.typeMap){const r=t.typeMap[i],n=NO(r.prototype);if(typeof t.key=="function")continue;const s=n[t.key];if(!s)continue;s.json?.type&&Array.isArray(s.json.type)&&s.json.type.length===1&&typeof s.json.type[0]=="string"&&(e[s.json.type[0]]=r);const a=s.json?.write;if(!a?.writer){e[i]=r;continue}const u=a.target,p=typeof u=="string"?u:t.key,y={};a.writer(i,y,p),y[p]&&(e[y[p]]=r)}return e}function AIe(t){if(t.json||(t.json={}),Ute(t.json),jte(t.json),zte(t.json),t.json.origins)for(const e in t.json.origins)Ute(t.json.origins[e]),jte(t.json.origins[e]),zte(t.json.origins[e]);return!0}function zte(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function Ute(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function jte(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function Bte(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=t?.ndimArray??0;t&&(i===1||"type"in t&&W0e(t.type))?e.write.writer=MIe:i>1?e.write.writer=PIe(i):e.types?Array.isArray(e.types)?e.write.writer=RIe(e.types[0]):e.write.writer=OIe(e.types):e.write.writer=I4}function OIe(t){return(e,i,r,n)=>e?Z0e(e,t,n)?I4(e,i,r,n):void 0:I4(e,i,r,n)}function Z0e(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i?.messages){const r=e.errorContext??"type",n=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new de(`${r}:unsupported`,n,{definition:t,context:i})),Ee.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(n)}return!1}function RIe(t){return(e,i,r,n)=>!e||!Array.isArray(e)?I4(e,i,r,n):I4(e.filter(s=>Z0e(s,t,n)),i,r,n)}function I4(t,e,i,r){bl(i,F6(t,r),e)}function F6(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?k6(t):t}function k6(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function MIe(t,e,i,r){let n;t===null?n=null:t&&typeof t.map=="function"?(n=t.map(s=>F6(s,r)),typeof n.toArray=="function"&&(n=n.toArray())):n=[F6(t,r)],bl(i,n,e)}function K0e(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>K0e(r,e,i-1)):F6(t,e)}function PIe(t){return(e,i,r,n)=>{let s;if(e===null)s=null;else{s=K0e(e,n,t);let a=t,u=s;for(;a>0&&Array.isArray(u);)a--,u=u[0];if(u!==void 0)for(let p=0;p<a;p++)s=[s]}bl(r,s,i)}}function IIe(t,e){return gJ(t,"any",e?.origin)}function Mj(t,e){return gJ(t,"read",e?.origin)}function Q0e(t,e){return gJ(t,"write",e?.origin)}function gJ(t,e,i){let r=t?.json;if(r?.origins&&i){let n;n=i==="link-chart"?r.origins[i]&&(e==="any"||e in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],n&&(e==="any"||e in n)&&(r=n)}return r}function $Ie(t){const e=LIe(t);if(t.json.origins)for(const i in t.json.origins){const r=t.json.origins[i],n=r.types?DIe(r):e;Fte(n,r,!1),r.types&&!r.write&&t.json.write&&t.json.write.enabled&&(r.write={...t.json.write}),Bte(n,r)}Fte(e,t.json,!0),Bte(e,t.json)}function LIe(t){return t.json.types?Pj(t.json):t.type?eme(t):Pj(t)}function DIe(t){return t.type?eme(t):Pj(t)}function eme(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!G0e(i);)i=i[0],e++;return{type:i,ndimArray:e}}function Pj(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function NIe(t){AIe(t)&&(wIe(t),$Ie(t))}const ZN=new Set,KN=new Set;function Z(t){return e=>{t??(t="esri.core.Accessor"),e.prototype.declaredClass=t,kIe(e);const i=[],r=[];let n=e.prototype;for(;n;)n.hasOwnProperty("initialize")&&!ZN.has(n.initialize)&&(ZN.add(n.initialize),i.push(n.initialize)),n.hasOwnProperty("destroy")&&!KN.has(n.destroy)&&(KN.add(n.destroy),r.push(n.destroy)),n=Object.getPrototypeOf(n);ZN.clear(),KN.clear();const s=class extends e{constructor(...u){if(super(...u),this.constructor===s&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let p=i.length-1;p>=0;p--)i[p].call(this)}}),r.length){let p=!1;const y=this[m0e];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!p){p=!0,y.call(this);for(let b=0;b<r.length;b++)r[b].call(this)}}})}this.postscript(...u)}}};s.__accessorMetadata__=NO(e.prototype),s.prototype.declaredClass=t;const a=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(s,"name",{value:a,configurable:!0}),s}}function FIe(t,e){return e.get==null?function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r===void 0)return;di(r);const n=i.store;return n.has(t)?n.get(t):r.metadata.value}:function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r!==void 0)return r.getComputed(i)}}function kIe(t){const e=t.prototype,i=NO(e),r={};for(const n of Object.getOwnPropertyNames(i)){const s=i[n];NIe(s),r[n]={enumerable:!0,configurable:!0,get:FIe(n,s),set(a){const u=this.__accessor__;if(u!==void 0){if(!Object.isFrozen(this)){if(u.initialized&&s.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${n}' of ${this.declaredClass}`);if(u.lifecycle===Km.CONSTRUCTED&&s.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${n}' of ${this.declaredClass}`);u.set(n,a)}}else Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:a})}}}Object.defineProperties(t.prototype,r)}var tme,ime;function zIe(t){if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return t.constructor?.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const F1=Symbol("Accessor-Handles"),Ij=Symbol("Accessor-Initialized");let Ke=class rme{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:n}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const s=this;class a extends s{constructor(...p){super(...p),this.inherited=null,n&&n.apply(this,p)}}NO(a.prototype);for(const u in e){const p=e[u];a.prototype[u]=typeof p=="function"?function(...y){const b=this.inherited;let S;this.inherited=function(...C){if(s.prototype[u])return s.prototype[u].apply(this,C)};try{S=p.apply(this,y)}catch(C){throw this.inherited=b,C}return this.inherited=b,S}:e[u]}for(const u in i){const p=zIe(i[u]);T(p)(a.prototype,u)}return Z(r)(a)}constructor(...e){if(this[tme]=null,this[ime]=!1,this.constructor===rme)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const i=new C9e(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:i}),e.length>0&&this.normalizeCtorArgs&&(i.ctorArgs=this.normalizeCtorArgs.apply(this,e))}postscript(e){const i=this.__accessor__,r=i.ctorArgs||e;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize(),this[Ij]=!0}initialize(){}[m0e](){this[F1]=ct(this[F1])}destroy(){this.destroyed||(tIe(this),this.__accessor__.destroy(),I9e()?.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[Ij]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){xp(this,e)}get(e){return f0e(Ee.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),xp(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return R6(this,e,i),this}watch(e,i,r){return oIe(this,e,i,r)}addHandles(e,i){if(this.destroyed){const n=Array.isArray(e)?e:[e];for(const s of n)s.remove();return}let r=this[F1];r==null&&(r=this[F1]=new Dg),r.add(e,i)}removeHandles(e){const i=this[F1];i?.remove(e)}removeAllHandles(){const e=this[F1];e?.removeAll()}hasHandles(e){const i=this[F1];return i!=null&&i.has(e)}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}};tme=F1,ime=Ij;let UIe=class nme{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new nme;return this._values.forEach((r,n)=>{e&&e.has(n)||i.set(n,Ce(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||r?.origin===i?r?.value:void 0}originOf(e){return this._values.get(e)?.origin??cr.USER}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>this._values.get(r)?.origin===e)}set(e,i,r){if((r=this._normalizeOrigin(r))===cr.DEFAULTS){const n=this._values.get(e);if(n?.origin!=null&&n.origin>r)return}this._values.set(e,new jIe(i,r))}delete(e,i){(i=this._normalizeOrigin(i))!=null&&this._values.get(e)?.origin!==i||this._values.delete(e)}has(e,i){return(i=this._normalizeOrigin(i))!=null?this._values.get(e)?.origin===i:this._values.has(e)}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===cr.DEFAULTS?e:cr.USER}},jIe=class{constructor(e,i){this.value=e,this.origin=i}};function sme(t,e,i){e.keys().forEach(n=>{i.set(n,e.get(n),cr.DEFAULTS)});const r=t.metadatas;Object.keys(r).forEach(n=>{t.internalGet(n)&&i.set(n,t.internalGet(n),cr.DEFAULTS)})}function BIe(t,e,i){if(!t?.read||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.indexOf(e)===0&&Tte(r,i))return!0}else for(const n of r)if(n===e||n.includes(".")&&n.indexOf(e)===0&&Tte(n,i))return!0;return!1}function VIe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function GIe(t,e,i,r,n){let s=Mj(e[i],n);VIe(s)&&(t[i]=!0);for(const a of Object.getOwnPropertyNames(e))s=Mj(e[a],n),BIe(s,i,r)&&(t[a]=!0)}function HIe(t,e,i,r){const n=i.metadatas,s=IIe(n[e],r),a=s?.default;if(a===void 0)return;const u=typeof a=="function"?a.call(t,e,r):a;u!==void 0&&i.set(e,u)}const ome={origin:"service"};function ame(t,e,i=ome){if(!e||typeof e!="object")return;const r=Ql(t),n=r.metadatas,s={};for(const a of Object.getOwnPropertyNames(e))GIe(s,n,a,e,i);r.setDefaultOrigin(i.origin);for(const a of Object.getOwnPropertyNames(s)){const u=Mj(n[a],i).read,p=u?.source;let y;y=p&&typeof p=="string"?DO(e,p):e[a],u?.reader&&(y=u.reader.call(t,y,e,i)),y!==void 0&&r.set(a,y)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const a of Object.getOwnPropertyNames(n))s[a]||HIe(t,a,r,i)}r.setDefaultOrigin("user")}function lme(t,e,i,r=ome){const n={...r,messages:[]};i(n),n.messages?.forEach(s=>{s.type!=="warning"||t.loaded?r?.messages&&r.messages.push(s):t.loadWarnings.push(s)})}function qIe(t,e,i,r,n){const s={};return e.write?.writer?.call(t,r,s,i,n),s}function cme(t,e,i,r,n,s){if(!r?.write)return!1;const a=xp(t,i);if(!n&&r.write.overridePolicy){const u=r.write.overridePolicy.call(t,a,i,s??void 0);u!==void 0&&(n=u)}if(n||(n=r.write),!n||n.enabled===!1||n.layerContainerTypes&&s?.layerContainerType&&!n.layerContainerTypes.includes(s.layerContainerType))return!1;if((a===null&&!n.allowNull&&!n.writerEnsuresNonNull||a===void 0)&&n.isRequired){const u=new de("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return u&&s?.messages?s.messages.push(u):u&&!s&&Ee.getLogger("esri.core.accessorSupport.write").error(u.name,u.message),!1}return!(a===void 0||a===null&&!n.allowNull&&!n.writerEnsuresNonNull||!n.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(i)===cr.DEFAULTS)&&WIe(t,i,s,r,a)||!n.ignoreOrigin&&s?.origin&&e.store.multipleOriginsSupported&&e.store.originOf(i)<Py(s.origin))}function WIe(t,e,i,r,n){const s=r.default;if(s===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(n);if(typeof s=="function"){if(Array.isArray(n)){const a=s.call(t,e,i??void 0);return bg(a,n)}return!1}return s===n}function XIe(t,e,i,r){const n=Ql(t),s=n.metadatas,a=Q0e(s[e],r);return!!a&&cme(t,n,e,a,i,r)}function ume(t,e,i){if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return sI(e,t.toJSON(i));const r=Ql(t),n=r.metadatas;for(const s in n){const a=Q0e(n[s],i);if(!cme(t,r,s,a,void 0,i))continue;const u=xp(t,s),p=qIe(t,a,a.write&&typeof a.write.target=="string"?a.write.target:s,u,i);Object.keys(p).length>0&&(e=sI(e,p),i?.resources?.pendingOperations?.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>sI(e,p,()=>"replace-arrays"))),i?.writtenProperties&&i.writtenProperties.push({target:t,propName:s,oldOrigin:w9e(r.store.originOf(s)),newOrigin:i.origin}))}return e}const jO=t=>{let e=class extends t{constructor(...i){super(...i);const r=Ql(this),n=r.store,s=new UIe;r.store=s,sme(r,n,s)}read(i,r){ame(this,i,r)}write(i,r){return ume(this,i??{},r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return JIe.call(this,i,r)}};return e=_([Z("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function JIe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}function z6(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}let Ne=class extends jO(Ke){};Ne=_([Z("esri.core.JSONSupport")],Ne);const YIe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,ZIe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function Vte(t){const e=t?.match(YIe);if(!e)return null;const[,i,r,n]=e;if(!i)return null;let s=null,a=null,u=null;const{devext:p,qaext:y,www:b}=ZIe;if(r)if(s=i,n)switch(n.toLowerCase()){case"devext":({customBaseUrl:a,portalHostname:u}=p);break;case"qa":({customBaseUrl:a,portalHostname:u}=y);break;default:return null}else({customBaseUrl:a,portalHostname:u}=b);else switch(i.toLowerCase()){case"devext":({customBaseUrl:a,portalHostname:u}=p);break;case"qaext":({customBaseUrl:a,portalHostname:u}=y);break;case"www":({customBaseUrl:a,portalHostname:u}=b);break;default:return null}return{customBaseUrl:a,isPortal:!1,portalHostname:u,urlKey:s}}function hme(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function dme(t){const e=atob(t),i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i.buffer}function KIe(t){const e=new Uint8Array(t);let i="";for(let r=0;r<e.length;r++)i+=String.fromCharCode(e[r]);return btoa(i)}const QIe=Ee.getLogger("esri.core.urlUtils"),lE=vr.request,Gte="esri/config: esriConfig.request.proxyUrl is not set.",pme=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,fme=/^\s*http:/i,e$e=/^\s*https:/i,t$e=/^\s*file:/i,i$e=/:\d+$/,r$e=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,n$e=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),s$e=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let Pc=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(n$e);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(s$e),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const JR={},o$e=new Pc(vr.applicationUrl);let pl=o$e;const a$e=l$e();let yJ=a$e;const vJ=()=>pl,IOt=()=>yJ;function l$e(){const t=pl.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${pl.scheme}://${pl.host}${pl.port!=null?`:${pl.port}`:""}`}${e}`}function Nn(t){if(!t)return null;const e={path:null,query:null},i=new Pc(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.substring(0,r),e.query=e2(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.substring(0,e.path.length-(i.fragment.length+1)))),e}function e2(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const n=r.indexOf("=");let s,a;n<0?(s=decodeURIComponent(r),a=""):(s=decodeURIComponent(r.slice(0,n)),a=decodeURIComponent(r.slice(n+1)));let u=i[s];typeof u=="string"&&(u=i[s]=[u]),Array.isArray(u)?u.push(a):i[s]=a}return i}function D2(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(e(i,t[i]))).join("&"):Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const n=encodeURIComponent(i)+"=",s=e?.[i];return s?n+encodeURIComponent(s(r)):Array.isArray(r)?r.map(a=>z6(a)?n+encodeURIComponent(JSON.stringify(a)):n+encodeURIComponent(a)).join("&"):z6(r)?n+encodeURIComponent(JSON.stringify(r)):n+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function c$e(t=!1){let e,i=lE.proxyUrl;if(typeof t=="string"){e=m$e(t);const r=BO(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw QIe.warn(Gte),new de("urlutils:proxy-not-set",Gte);return e&&$j()&&(i=SJ(i)),Nn(i)}function $Ot(t){const e=BO(t);let i,r;if(e){const n=_J(e.proxyUrl);i=n.path,r=n.query?e2(n.query):null}if(i){const n=Nn(t);t=i+"?"+n.path;const s=D2({...r,...n.query});s&&(t=`${t}?${s}`)}return t}const kE={path:"",query:""};function _J(t){const e=t.indexOf("?");return e!==-1?(kE.path=t.slice(0,e),kE.query=t.slice(e+1)):(kE.path=t,kE.query=null),kE}function mme(t){return t=(t=j6(t=b$e(t=_J(t).path),!0)).toLowerCase()}function u$e(t){const e={proxyUrl:t.proxyUrl,urlPrefix:mme(t.urlPrefix)},i=lE.proxyRules,r=e.urlPrefix;let n=i.length;for(let s=0;s<i.length;s++){const a=i[s].urlPrefix;if(r.indexOf(a)===0){if(r.length===a.length)return-1;n=s;break}a.indexOf(r)===0&&(n=s+1)}return i.splice(n,0,e),n}function BO(t){const e=lE.proxyRules,i=mme(t);for(let r=0;r<e.length;r++)if(i.indexOf(e[r].urlPrefix)===0)return e[r]}function h$e(t,e){if(!t||!e)return!1;t=U6(t),e=U6(e);const i=Vte(t),r=Vte(e);return i!=null&&r!=null?i.portalHostname===r.portalHostname:i==null&&r==null&&Tc(t,e,!0)}function gme(t,e){return t=U6(t),e=U6(e),j6(t)===j6(e)}function U6(t){const e=(t=Uu(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function yme(t){const e=r=>r==null||r instanceof RegExp&&r.test(t)||typeof r=="string"&&t.startsWith(r),i=lE.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(e))return r}else if(e(r.urls))return r}return null}function Tc(t,e,i=!1){if(!t||!e)return!1;const r=Dj(t),n=Dj(e);return!(!i&&r.scheme!==n.scheme)&&r.host!=null&&n.host!=null&&r.host.toLowerCase()===n.host.toLowerCase()&&r.port===n.port}function bJ(t){if(typeof t=="string"){if(!ju(t))return!0;t=Dj(t)}if(Tc(t,pl))return!0;const e=lE.trustedServers||[];for(let i=0;i<e.length;i++){const r=d$e(e[i]);for(let n=0;n<r.length;n++)if(Tc(t,r[n]))return!0}return!1}function d$e(t){return JR[t]||(TJ(t)||S0(t)?JR[t]=[new Pc(fl(t))]:JR[t]=[new Pc(`http://${t}`),new Pc(`https://${t}`)]),JR[t]}function fl(t,e=yJ,i){return S0(t)?i&&i.preserveProtocolRelative?t:pl.scheme==="http"&&pl.authority===Tp(t).slice(2)?`http:${t}`:`https:${t}`:TJ(t)?t:Kh(t[0]==="/"?_$e(e):e,t)}function wJ(t,e=yJ,i){if(t==null||!ju(t))return t;const r=Uu(t),n=r.toLowerCase(),s=Uu(e).toLowerCase().replace(/\/+$/,""),a=i?Uu(i).toLowerCase().replace(/\/+$/,""):null;if(a&&s.indexOf(a)!==0)return t;const u=(S,C,O)=>(O=S.indexOf(C,O))===-1?S.length:O;let p=u(n,"/",n.indexOf("//")+2),y=-1;for(;n.slice(0,p+1)===s.slice(0,p)+"/"&&(y=p+1,p!==n.length);)p=u(n,"/",p+1);if(y===-1||a&&y<a.length)return t;t=r.slice(y);const b=s.slice(y-1).replaceAll(/[^/]+/g,"").length;if(b>0)for(let S=0;S<b;S++)t=`../${t}`;else t=`./${t}`;return t}function Uu(t){return t=T$e(t=x$e(t=w$e(t=fl(t=t.trim()))))}function Kh(...t){const e=t.filter(gw);if(!e?.length)return;const i=[];if(ju(e[0])){const n=e[0],s=n.indexOf("//");s!==-1&&(i.push(n.slice(0,s+1)),y$e(e[0])&&(i[0]+="/"),e[0]=n.slice(s+2))}else e[0][0]==="/"&&i.push("");const r=e.reduce((n,s)=>s?n.concat(s.split("/")):n,[]);for(let n=0;n<r.length;n++){const s=r[n];s===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!s&&n===r.length-1||s&&(s!=="."||i.length===0))&&i.push(s)}return i.join("/")}function Tp(t,e=!1){if(t==null||sS(t)||$0(t))return null;let i=t.indexOf("://");if(i===-1&&S0(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=j6(t,!0)),t}function ju(t){return S0(t)||TJ(t)}function sS(t){return t!=null&&t.slice(0,5)==="blob:"}function $0(t){return t!=null&&t.slice(0,5)==="data:"}function xJ(t){const e=sv(t);return e&&e.isBase64?dme(e.data):null}function QN(t){return KIe(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const p$e=/^data:(.*?)(;base64)?,(.*)$/;function sv(t){const e=t.match(p$e);if(!e)return null;const[,i,r,n]=e;return{mediaType:i,isBase64:!!r,data:n}}function vme(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function LOt(t){return(await fetch(t)).blob()}function DOt(t){const e=xJ(t);if(!e)return null;const i=sv(t);return new Blob([e],{type:i.mediaType})}function NOt(t,e){f$e(t,e)}function f$e(t,e){if(!t)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(t);return i.download=e,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function S0(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function TJ(t){return t!=null&&pme.test(t)}function m$e(t){return t!=null&&e$e.test(t)||pl.scheme==="https"&&S0(t)}function g$e(t){return t!=null&&fme.test(t)||pl.scheme==="http"&&S0(t)}function y$e(t){return t!=null&&t$e.test(t)}function SJ(t){return S0(t)?`https:${t}`:t.replace(fme,"https:")}function v$e(){return pl.scheme==="http"}function $j(){return pl.scheme==="https"}function j6(t,e=!1){return S0(t)?t.slice(2):(t=t.replace(pme,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function _$e(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function EJ(t){let e=0;if(ju(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function FOt(t,e){if(!t)return"";const i=Nn(t).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!e?.length)return r;const n=new RegExp(`.(${e.join("|")})$`,"ig");return r.replace(n,"")}function b$e(t){return t.endsWith("/")?t:`${t}/`}function _me(t){return t.replace(/\/+$/,"")}function w$e(t){if(/^https?:\/\//i.test(t)){const e=_J(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function x$e(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function T$e(t){const e=lE.httpsDomains;if(!g$e(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),i$e.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return v$e()&&r===pl.authority&&!r$e.test(t)||($j()&&r===pl.authority||e&&e.some(n=>r===n||r.endsWith(`.${n}`))||$j()&&!BO(t))&&(t=SJ(t)),t}function Lj(t,e,i){if(!(e&&i&&t&&ju(t)))return t;const r=t.indexOf("//"),n=t.indexOf("/",r+2),s=t.indexOf(":",r+2),a=Math.min(n<0?t.length:n,s<0?t.length:s);return t.slice(r+2,a).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(a)}`}function Dj(t){return typeof t=="string"?new Pc(fl(t)):(t.scheme||(t.scheme=pl.scheme),t)}function bme(t){return E$e.test(t)}function wme(t,e){const i=Nn(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function CJ(t,e,i){const r=Nn(t),n=r.query||{};return n[e]=String(i),`${r.path}?${D2(n)}`}function uI(t,e){if(!e)return t;const i=Nn(t),r=i.query||{};for(const[s,a]of Object.entries(e))a!=null&&(r[s]=a);const n=D2(r);return n?`${i.path}?${n}`:i.path}function S$e(t){if(t==null)return null;const e=t.match(xme);return e?e[2]:null}function Hte(t){if(t==null)return null;const e=t.match(xme);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function kOt(t){return typeof t=="string"?sv(t)??{data:t}:new Promise((e,i)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(sv(r.result)),r.onerror=n=>i(n)})}const xme=/([^.]*)\.([^\/]*)$/,E$e=/(^data:image\/svg|\.svg$)/i,Tme="20231030",Sme="3a1dbcf6ca66ff827c68b22ba716b8223f3d53ec";Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const Eme="4.28";let Ii,ED=Eme;ED="4.28.4";function C$e(t){Ii=t}function zOt(t){const e=Ii?.findCredential(t);return e?.token?CJ(t,"token",e.token):t}Me("host-webworker");const A$e=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function AJ(t){const e=Tp(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!A$e.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function Cme(t,e,i=!1,r){return new Promise((n,s)=>{if(Ms(r))return void s(qte());let a=()=>{y(),s(new Error(`Unable to load ${e}`))},u=()=>{const b=t;y(),n(b)},p=()=>{if(!t)return;const b=t;y(),b.src="",s(qte())};const y=()=>{Me("esri-image-decode")||(t.removeEventListener("error",a),t.removeEventListener("load",u)),a=null,u=null,t=null,r?.removeEventListener("abort",p),p=null,i&&URL.revokeObjectURL(e)};r?.addEventListener("abort",p),Me("esri-image-decode")?t.decode().then(u,a):(t.addEventListener("error",a),t.addEventListener("load",u))})}function qte(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const Ame="Timeout exceeded";function O$e(){return new Error(Ame)}function UOt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===Ame}function R$e(t){vr.request.crossOriginNoCorsDomains||(vr.request.crossOriginNoCorsDomains={});const e=vr.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[Tp(i)??""]=0:(e[Tp("http://"+i)??""]=0,e[Tp("https://"+i)??""]=0)}function M$e(t){const e=vr.request.crossOriginNoCorsDomains;if(e){let i=Tp(t);if(i)return i=i.toLowerCase(),!Tc(i,vJ())&&e[i]<Date.now()-36e5}return!1}async function P$e(t){const e=vr.request.crossOriginNoCorsDomains,i=Tp(t);e&&i&&(e[i.toLowerCase()]=Date.now());const r=Nn(t);t=r.path,r.query?.f==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function ir(t,e){t instanceof URL&&(t=t.toString()),e?.query instanceof URLSearchParams&&(e.query=e2(e.query.toString().replaceAll("+"," ")));const i=$0(t),r=sS(t);r||i||(t=Uu(t));const n={url:t,requestOptions:{...e}};let s=yme(t);if(s){const y=await z$e(s,n);if(y!=null)return{data:y,getHeader:OJ,httpStatus:200,requestOptions:n.requestOptions,url:n.url};s.after||s.error||(s=null)}if(t=n.url,(e=n.requestOptions).responseType==="image"&&(Me("host-webworker")||Me("host-node")))throw d0("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),n);if(e.method==="head"){if(e.body)throw d0("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),n);if(i||r)throw d0("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),n)}if(await N$e(),B6)return B6.execute(t,e);const a=new AbortController;qs(e,()=>a.abort());const u={controller:a,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:s,params:n,redoRequest:!1,useIdentity:ip.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},p=await j$e(u);return s?.after?.(p),p}let B6;const ip=vr.request,Ome="FormData"in globalThis,I$e=new Set([499,498,403,401]),$$e=new Set(["COM_0056","COM_0057","SB_0008"]),L$e=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],OJ=()=>null,V6=Symbol();function D$e(t){const e=Tp(t);e&&!ir._corsServers.includes(e)&&ir._corsServers.push(e)}function Wte(t){const e=Tp(t);return!e||e.endsWith(".arcgis.com")||ir._corsServers.includes(e)||bJ(e)}function d0(t,e,i,r){let n="Error";const s={url:i.url,requestOptions:i.requestOptions,getHeader:OJ,ssl:!1};if(e instanceof de)return e.details?(e.details=Ce(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=s,e;if(e){const a=r&&(y=>r.headers.get(y)),u=r?.status,p=e.message;p&&(n=p),a&&(s.getHeader=a),s.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||u||0,s.subCode=e.subcode,s.messageCode=e.messageCode,typeof e.details=="string"?s.messages=[e.details]:s.messages=e.details,s.raw=V6 in e?e[V6]:e}return qn(e)?or():new de(t,n,s)}async function N$e(){Me("host-webworker")?B6||(B6=await ke(()=>import("./request-158d7972.js"),[],import.meta.url)):ir._abortableFetch||(ir._abortableFetch=globalThis.fetch.bind(globalThis))}async function Nj(){Ii||await ke(()=>Promise.resolve().then(()=>I4t),void 0,import.meta.url)}async function F$e(t){const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,n=i.body;let s=null,a=null;if(Ome&&"HTMLFormElement"in globalThis&&(n instanceof FormData?s=n:n instanceof HTMLFormElement&&(s=new FormData(n))),typeof n=="string"&&(a=n),t.fetchOptions={cache:i.cacheBust&&!("polyfill"in ir._abortableFetch)?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:ip.priority,redirect:"follow",signal:r},(s||a)&&(t.fetchOptions.body=s||a),i.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||i.query?.token||s?.get("token")),!t.hasToken&&vr.apiKey&&AJ(e)&&(i.query||(i.query={}),i.query.token=vr.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!Rme(e)&&!Ms(r)){let u;i.authMode==="immediate"?(await Nj(),u=await Ii.getCredential(e,{signal:r}),t.credential=u):i.authMode==="no-prompt"?(await Nj(),u=await Ii.getCredential(e,{prompt:!1,signal:r}).catch(()=>{}),t.credential=u):Ii&&(u=Ii.findCredential(e)),u&&(t.credentialToken=u.token,t.useSSL=!!u.ssl)}}function Rme(t){return L$e.some(e=>e.test(t))}async function k$e(t){let e=t.params.url;const i=t.params.requestOptions,r=t.fetchOptions??{},n=sS(e)||$0(e),s=i.responseType||"json",a=n?0:i.timeout!=null?i.timeout:ip.timeout;let u=!1;if(!n){t.useSSL&&(e=SJ(e)),i.cacheBust&&r.cache==="default"&&(e=CJ(e,"request.preventCache",Date.now()));let C={...i.query};t.credentialToken&&(C.token=t.credentialToken);let O=D2(C);Me("esri-url-encodes-apostrophe")&&(O=O.replaceAll("'","%27"));const P=e.length+1+O.length;let $;u=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||P>ip.maxUrlLength;const N=i.useProxy||!!BO(e);if(N){const z=c$e(e);$=z.path,!u&&$.length+1+P>ip.maxUrlLength&&(u=!0),z.query&&(C={...z.query,...C})}if(r.method==="HEAD"&&(u||N)){if(u)throw P>ip.maxUrlLength?d0("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):d0("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(N)throw d0("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}u?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?e=uI(e,C):(r.body=D2(C),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):e=uI(e,C),N&&(t.useProxy=!0,e=`${$}?${e}`),C.token&&Ome&&r.body instanceof FormData&&!hme(e)&&r.body.set("token",C.token),i.hasOwnProperty("withCredentials")?t.withCredentials=i.withCredentials:Tc(e,vJ())||(bJ(e)||Ii&&Ii.findServerInfo(e)?.webTierAuth)&&(t.withCredentials=!0),t.withCredentials&&(r.credentials="include",M$e(e)&&await P$e(u?uI(e,C):e))}let p,y,b=0,S=!1;a>0&&(b=setTimeout(()=>{S=!0,t.controller.abort()},a));try{if(i.responseType==="native-request-init")y=r,y.url=e;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||u||U$e(i.headers)||!n&&!t.useProxy&&ip.proxyUrl&&!Wte(e)){if(p=await ir._abortableFetch(e,r),t.useProxy||D$e(e),i.responseType==="native")y=p;else if(r.method!=="HEAD")if(p.ok){switch(s){case"array-buffer":y=await p.arrayBuffer();break;case"blob":case"image":y=await p.blob();break;default:y=await p.text()}if(b&&(clearTimeout(b),b=0),s==="json"||s==="xml"||s==="document")if(y)switch(s){case"json":y=JSON.parse(y);break;case"xml":y=Xte(y,"application/xml");break;case"document":y=Xte(y,"text/html")}else y=null;if(y){if(s==="array-buffer"||s==="blob"){const C=p.headers.get("Content-Type");if(C&&/application\/json|text\/plain/i.test(C)&&y[s==="blob"?"size":"byteLength"]<=750)try{const O=await new Response(y).json();O.error&&(y=O)}catch{}}s==="image"&&y instanceof Blob&&(y=await Jte(URL.createObjectURL(y),t,!0))}}else{y=await p.text();try{y=JSON.parse(y)}catch{}}}else y=await Jte(e,t)}catch(C){if(C.name==="AbortError")throw S?O$e():or("Request canceled");if(!(!p&&C instanceof TypeError&&ip.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||t.useProxy||Wte(e))throw C;t.redoRequest=!0,u$e({proxyUrl:ip.proxyUrl,urlPrefix:Tp(e)??""})}finally{b&&clearTimeout(b)}return[p,y]}async function z$e(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(n){i=d0("request:interceptor",n,e)}if((r instanceof Error||r instanceof de)&&(i=d0("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function U$e(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function Xte(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function j$e(t){let e,i;await F$e(t);try{do[e,i]=await k$e(t);while(!await B$e(t,e,i))}catch(s){const a=d0("request:server",s,t.params,e);throw a.details.ssl=t.useSSL,t.interceptor?.error&&t.interceptor.error(a),a}const r=t.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&i.user?.username&&!bJ(r)){const s=Tp(r,!0);s&&ip.trustedServers.push(s)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&R$e(i.authorizedCrossOriginNoCorsDomains)}const n=t.credential;if(n&&Ii){let a=Ii.findServerInfo(n.server)?.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const u=Ii.findCredential(a,n.userId);u&&Ii._getIdenticalSvcIdx(a,u)===-1&&u.resources.unshift(a)}}return{data:i,getHeader:e?s=>e?.headers.get(s):OJ,httpStatus:e?.status??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function B$e(t,e,i){if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let n,s;if(i&&(i.error?n=i.error:i.status==="error"&&Array.isArray(i.messages)&&(n={...i},n[V6]=i,n.details=i.messages)),!n&&!e.ok)throw n=new Error(`Unable to load ${e.url} status: ${e.status}`),n[V6]=i,n;let a,u=null;n&&(s=Number(n.code),u=n.hasOwnProperty("subcode")?Number(n.subcode):null,a=n.messageCode,a=a?.toUpperCase());const p=r.authMode;if(s===403&&(u===4||n.message?.toLowerCase().includes("ssl")&&!n.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(p!=="no-prompt"||s===498)&&s!==void 0&&I$e.has(s)&&!Rme(t.params.url)&&(s!==403||(!a||!$$e.has(a))&&(u==null||u===2&&t.credentialToken))){await Nj();try{const y=await Ii.getCredential(t.params.url,{error:d0("request:server",n,t.params),prompt:p!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=y,t.credentialToken=y.token,t.useSSL=t.useSSL||y.ssl,!1}catch(y){if(p==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;n=y}}if(n)throw n;return!0}function Jte(t,e,i=!1){const r=e.controller.signal,n=new Image;return e.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.fetchPriority=ip.priority,n.src=t,Cme(n,t,i,r)}ir._abortableFetch=null,ir._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];let hI=class Mme{constructor(){this._emitter=new Mme.EventEmitter(this)}emit(e,i){return this._emitter.emit(e,i)}on(e,i){return this._emitter.on(e,i)}once(e,i){return this._emitter.once(e,i)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(n=null){this._target=n,this._listenersMap=null}clear(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clear()}emit(n,s){let a=this._listenersMap?.get(n);if(!a)return!1;const u=this._target||this;let p=!1;for(const y of a.slice()){const b="deref"in y?y.deref():y;b?b?.call(u,s):p=!0}return p&&(a=a.filter(y=>!("deref"in y)||y.deref()!=null),this._listenersMap.set(n,a)),a.length>0}on(n,s){if(Array.isArray(n)){const u=n.map(p=>this.on(p,s));return nv(u)}if(n.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const a=this._listenersMap.get(n)||[];return a.push(s),this._listenersMap.set(n,a),Sr(()=>{const u=this._listenersMap?.get(n),p=u?.indexOf(s)??-1;p>=0&&u.splice(p,1)})}once(n,s){const a=this.on(n,u=>{a.remove(),("deref"in s?s.deref():s)?.call(null,u)});return a}hasEventListener(n){const s=this._listenersMap?.get(n);return s!=null&&s.length>0}}t.EventEmitter=e,t.EventedMixin=r=>{let n=class extends r{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(s,a){return this._emitter.emit(s,a)}on(s,a){return this._emitter.on(s,a)}once(s,a){return this._emitter.once(s,a)}hasEventListener(s){return this._emitter.hasEventListener(s)}};return n=_([Z("esri.core.Evented")],n),n};let i=class extends Ke{constructor(){super(...arguments),this._emitter=new hI.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,n){return this._emitter.emit(r,n)}on(r,n){return this._emitter.on(r,n)}once(r,n){return this._emitter.once(r,n)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=_([Z("esri.core.Evented")],i),t.EventedAccessor=i})(hI||(hI={}));const Xn=hI;var Hr;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(Hr||(Hr={}));function RJ(t){return(e,i)=>{e[i]=t}}let VO=class extends w0e{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var Jm;let V$e=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},G$e=class{constructor(e,i,r,n,s){this.target=e,this.added=i,this.removed=r,this.start=n,this.deleteCount=s}};const ih=new Ua(V$e,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function eF(t){return t?t instanceof Nb?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function tF(t){if(t?.length)return t[0]}function H$e(t,e,i,r){const n=Math.min(t.length-i,e.length-r);let s=0;for(;s<n&&t[i+s]===e[r+s];)s++;return s}function Pme(t,e,i,r){e&&e.forEach((n,s,a)=>{t.push(n),Pme(t,i.call(r,n,s,a),i,r)})}const Qg=new Set,e1=new Set,t1=new Set,iF=new Map;let q$e=0,Nb=Jm=class extends Xn.EventedAccessor{static isCollection(t){return t!=null&&t instanceof Jm}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new VO,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:q$e++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Jm?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return di(this._observable),this._items}set items(t){this._emitBeforeChanges(Hr.ADD)||(this._splice(0,this.length,eF(t)),this._emitAfterChanges(Hr.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),Sr(()=>{r.removed=!0,i.splice(i.indexOf(r),1)})}return this._emitter.on(t,e)}once(t,e){const i="deref"in e?()=>e.deref():()=>e,r=this.on(t,n=>{i()?.call(null,n),r.remove()});return r}add(t,e){if(di(this._observable),this._emitBeforeChanges(Hr.ADD))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(Hr.ADD),this}addMany(t,e=this._items.length){if(di(this._observable),!t?.length)return this;if(this._emitBeforeChanges(Hr.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,eF(t)),this._emitAfterChanges(Hr.ADD),this}at(t){if(di(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(di(this._observable),!this.length||this._emitBeforeChanges(Hr.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(Hr.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return di(this._observable),this._createNewInstance({items:this._items.map(Ce)})}concat(...t){di(this._observable);const e=t.map(eF);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(di(this._observable),!this.length||this._emitBeforeChanges(Hr.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let n=0;n<r;n++)t.call(e,i[n],n,i);this._emitAfterChanges(Hr.REMOVE)}every(t,e){return di(this._observable),this._items.every(t,e)}filter(t,e){let i;return di(this._observable),i=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:i})}find(t,e){return di(this._observable),this._items.find(t,e)}findIndex(t,e){return di(this._observable),this._items.findIndex(t,e)}flatten(t,e){di(this._observable);const i=[];return Pme(i,this,t,e),new Jm(i)}forEach(t,e){return di(this._observable),this._items.forEach(t,e)}getItemAt(t){return di(this._observable),this._items[t]}getNextIndex(t){di(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return di(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return di(this._observable),this._items.indexOf(t,e)}join(t=","){return di(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return di(this._observable),this._items.lastIndexOf(t,e)}map(t,e){di(this._observable);const i=this._items.map(t,e);return new Jm({items:i})}reorder(t,e=this.length-1){di(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(Hr.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(Hr.MOVE)}return t}}pop(){if(di(this._observable),!this.length||this._emitBeforeChanges(Hr.REMOVE))return;const t=tF(this._splice(this.length-1,1));return this._emitAfterChanges(Hr.REMOVE),t}push(...t){return di(this._observable),this._emitBeforeChanges(Hr.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(Hr.ADD)),this.length}reduce(t,e){di(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){di(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return di(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(di(this._observable),t<0||t>=this.length||this._emitBeforeChanges(Hr.REMOVE))return;const e=tF(this._splice(t,1));return this._emitAfterChanges(Hr.REMOVE),e}removeMany(t){if(di(this._observable),!t?.length||this._emitBeforeChanges(Hr.REMOVE))return[];const e=t instanceof Jm?t.toArray():t,i=this._items,r=[],n=e.length;for(let s=0;s<n;s++){const a=e[s],u=i.indexOf(a);if(u>-1){const p=1+H$e(e,i,s+1,u+1),y=this._splice(u,p);y&&y.length>0&&r.push.apply(r,y),s+=p-1}}return this._emitAfterChanges(Hr.REMOVE),r}reverse(){if(di(this._observable),this._emitBeforeChanges(Hr.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(Hr.MOVE),this}shift(){if(di(this._observable),!this.length||this._emitBeforeChanges(Hr.REMOVE))return;const t=tF(this._splice(0,1));return this._emitAfterChanges(Hr.REMOVE),t}slice(t=0,e=this.length){return di(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return di(this._observable),this._items.some(t,e)}sort(t){if(di(this._observable),!this.length||this._emitBeforeChanges(Hr.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(Hr.MOVE),this}splice(t,e,...i){di(this._observable);const r=(e?Hr.REMOVE:0)|(i.length?Hr.ADD:0);if(this._emitBeforeChanges(r))return[];const n=this._splice(t,e,i)||[];return this._emitAfterChanges(r),n}toArray(){return di(this._observable),this._items.slice()}toJSON(){return di(this._observable),this.toArray()}toLocaleString(){return di(this._observable),this._items.toLocaleString()}toString(){return di(this._observable),this._items.toString()}unshift(...t){return di(this._observable),!t.length||this._emitBeforeChanges(Hr.ADD)||(this._splice(0,0,t),this._emitAfterChanges(Hr.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,n=this.itemType;let s,a;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=yw(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(a=r.splice(t,e),this.hasEventListener("before-remove")){const u=ih.acquire();u.target=this,u.cancellable=!0;for(let p=0,y=a.length;p<y;p++)s=a[p],u.reset(s),this.emit("before-remove",u),u.defaultPrevented&&(a.splice(p,1),r.splice(t,0,s),t+=1,p-=1,y-=1);ih.release(u)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const u=ih.acquire();u.target=this,u.cancellable=!1;const p=a.length;for(let y=0;y<p;y++)u.reset(a[y]),this.emit("after-remove",u);ih.release(u)}}if(i?.length){if(n){const b=[];for(const S of i){const C=n.ensureType(S);C==null&&S!=null||b.push(C)}i=b}const u=this.hasEventListener("before-add"),p=this.hasEventListener("after-add"),y=t===this.length;if(u||p){const b=ih.acquire();b.target=this,b.cancellable=!0;const S=ih.acquire();S.target=this,S.cancellable=!1;for(const C of i)u?(b.reset(C),this.emit("before-add",b),b.defaultPrevented||(y?r.push(C):r.splice(t++,0,C),this._set("length",r.length),p&&(S.reset(C),this.emit("after-add",S)))):(y?r.push(C):r.splice(t++,0,C),this._set("length",r.length),S.reset(C),this.emit("after-add",S));ih.release(S),ih.release(b)}else{if(y)for(const b of i)r.push(b);else r.splice(t,0,...i);this._set("length",r.length)}}if((i?.length||a?.length)&&this._notifyChangeEvent(i,a),this.hasEventListener("after-splice")){const u=new G$e(this,i,a,t,e);this.emit("after-splice",u)}return a}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=ih.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,ih.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=ih.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),ih.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;Qg.clear(),e1.clear(),t1.clear();for(const{added:p,removed:y}of i){if(p)if(t1.size===0&&e1.size===0)for(const b of p)Qg.add(b);else for(const b of p)e1.has(b)?(t1.add(b),e1.delete(b)):t1.has(b)||Qg.add(b);if(y)if(t1.size===0&&Qg.size===0)for(const b of y)e1.add(b);else for(const b of y)Qg.has(b)?Qg.delete(b):(t1.delete(b),e1.add(b))}const r=Rc.acquire();Qg.forEach(p=>{r.push(p)});const n=Rc.acquire();e1.forEach(p=>{n.push(p)});const s=this._items,a=e.items,u=Rc.acquire();if(t1.forEach(p=>{a.indexOf(p)!==s.indexOf(p)&&u.push(p)}),e.listeners&&(r.length||n.length||u.length)){const p={target:this,added:r,removed:n,moved:u},y=e.listeners.length;for(let b=0;b<y;b++){const S=e.listeners[b];S.removed||S.callback.call(this,p)}}Rc.release(r),Rc.release(n),Rc.release(u)}Qg.clear(),e1.clear(),t1.clear()}};Nb.ofType=t=>{if(!t)return Jm;if(iF.has(t))return iF.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const n=t.typeMap[r].prototype.declaredClass;e?e+=` | ${n}`:e=n}let i=class extends Jm{};return _([RJ({Type:t,ensureType:typeof t=="function"?os(t):Pp(t)})],i.prototype,"itemType",void 0),i=_([Z(`esri.core.Collection<${e}>`)],i),iF.set(t,i),i},_([T()],Nb.prototype,"length",void 0),_([T()],Nb.prototype,"items",null),Nb=Jm=_([Z("esri.core.Collection")],Nb);const Dt=Nb;function xg(t,e,i=Dt){return e||(e=new i),e===t||(e.removeAll(),W$e(t)?e.addMany(t):t&&e.add(t)),e}function MJ(t){return t}function W$e(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}var fy;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(fy||(fy={}));let X$e=class{constructor(){this._resolver=Ys(),this._status=fy.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=fy.RESOLVED,this._cleanUp()},()=>{this._status=fy.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===fy.RESOLVED}isRejected(){return this._status===fy.REJECTED}isFulfilled(){return this._status!==fy.PENDING}abort(){this._resolver.reject(or())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=Ys(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},n=>{this.isFulfilled()||this._allPromise!==r||qn(n)||this._resolver.reject(n)}),e.resolve()}};const GO=t=>{let e=class extends t{constructor(...i){super(...i),this._promiseProps=new X$e,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return this._promiseProps.promise.then(()=>this).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=_([Z("esri.core.Promise")],e),e};let G6=class extends GO(Ke){};G6=_([Z("esri.core.Promise")],G6);const J$e="not-loaded",Y$e="loading",Z$e="failed",Yte="loaded",Ime=t=>{let e=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const n=this.load.bind(this);this.load=s=>{const a=new Promise((u,p)=>{const y=kO(s,p);this.destroyed&&p(new de("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(u,p).finally(()=>{y&&y.remove()})});if(this.loadStatus===J$e){this._set("loadStatus",Y$e);const u=this._loadController=new AbortController;n({signal:u.signal})}return r(),a}})),this.when(()=>{this._set("loadStatus",Yte),this._loadController=null},r=>{this._set("loadStatus",Z$e),this._set("loadError",r),this._loadController=null})}destroy(){this._loadController&&(this._loadController=Vc(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===Yte}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new de("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return _([T({readOnly:!0})],e.prototype,"loaded",null),_([T({readOnly:!0})],e.prototype,"loadError",void 0),_([T({clonable:!1})],e.prototype,"loadStatus",void 0),_([T({type:[T0],readOnly:!0})],e.prototype,"loadWarnings",null),e=_([Z("esri.core.Loadable")],e),e};let GC=class extends Ime(G6){};GC=_([Z("esri.core.Loadable")],GC),function(t){function e(i){return!(!i||!i.load)}t.LoadableMixin=Ime,t.isLoadable=e}(GC||(GC={}));const Ip=GC;function CD(t,e,i){return zO(t.map((r,n)=>e.apply(i,[r,n])))}async function K$e(t,e,i){return(await zO(t.map((r,n)=>e.apply(i,[r,n])))).map(r=>r.value)}function PJ(t){return{ok:!0,value:t}}function IJ(t){return{ok:!1,error:t}}function Q$e(t){return t!=null&&t.ok===!0?t.value:null}function e6e(t){return t!=null&&t.ok===!1?t.error:null}async function Gc(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return PJ(await t)}catch(e){return IJ(e)}}async function t6e(t){try{return PJ(await t)}catch(e){return $a(e),IJ(e)}}function WOt(t){if(t.ok===!0)return t.value;throw t.error}function Pv(t,e){return new k1(t,e)}let k1=class extends Ke{get value(){return Q$e(this._result)}get error(){return e6e(this._result)}get finished(){return this._result!=null}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=Vc(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(n=>{this._result=PJ(n),this._cleanup()},n=>{this._result=IJ(n),this._cleanup()}),this._abortHandle=qs(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=nn(this._abortHandle),this._abortController=null}};_([T()],k1.prototype,"value",null),_([T()],k1.prototype,"error",null),_([T()],k1.prototype,"finished",null),_([T()],k1.prototype,"promise",void 0),_([T()],k1.prototype,"_result",void 0),k1=_([Z("esri.core.asyncUtils.ReactiveTask")],k1);async function $J(t,e){return await t.load(),i6e(t,e)}async function i6e(t,e){const i=[],r=(...s)=>{for(const a of s)a!=null&&(Array.isArray(a)?r(...a):Dt.isCollection(a)?a.forEach(u=>r(u)):Ip.isLoadable(a)&&i.push(a))};e(r);let n=null;if(await K$e(i,async s=>{const a=await Gc(r6e(s)?s.loadAll():s.load());a.ok!==!1||n||(n=a)}),n)throw n.error;return t}function r6e(t){return"loadAll"in t&&typeof t.loadAll=="function"}function ot(t,e,i){let r,n;return e===void 0?(n=t,r=[void 0]):typeof e!="string"?(n=t,r=[void 0],i=e):(n=e,r=Array.isArray(t)?t:[t]),(s,a)=>{const u=s.constructor.prototype;for(const p of r){const y=q0e(s,p,n);y.write&&typeof y.write=="object"||(y.write={}),i&&(y.write.target=i),y.write.writer=u[a]}}}let br=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,n,s)=>{const a=this.toJSON(r);a!==void 0&&bl(s,a,n)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const i={};for(const r in e)i[e[r]]=r;return i}_getKeysSorted(e){const i=[];for(const r in e)i.push(r);return i.sort(),i}};function Tl(){return function(t,e){return new br(t,{ignoreUnknown:!0,...e})}}let LJ=class{constructor(e,i,r,n){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r;const s=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*s,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=n||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const ur=new LJ(6378137,1/298.257223563,3e5,.006694379990137799),p0=new LJ(3396190,1/169.8944472236118,23e4),Tg=new LJ(1737400,0,0),n6e=Ee.getLogger("esri.assets");function s6e(t,e){return ir(Kr(t),e)}function Kr(t){if(!vr.assetsPath)throw n6e.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new de("assets:path-not-set","config.assetsPath is not set");return Kh(vr.assetsPath,t)}let rF,Re=null;function $me(){return!!Re}function o6e(){return!!Me("esri-wasm")}function Lme(){return rF||(rF=ke(()=>import("./pe-wasm-834c2ac5.js"),[],import.meta.url).then(t=>t.p).then(({default:t})=>t({locateFile:e=>Kr(`esri/geometry/support/${e}`)})).then(t=>{Nme(t)}),rF)}var Fj,fs,kj;(function(t){function e(s,a,u){Re.ensureCache.prepare();const p=Fb(u),y=u===p,b=Re.ensureFloat64(p),S=Re._pe_geog_to_proj(Re.getPointer(s),a,b);return S&&Ty(u,a,b,y),S}function i(s,a,u,p){switch(p){case fs.PE_TRANSFORM_P_TO_G:return r(s,a,u);case fs.PE_TRANSFORM_G_TO_P:return e(s,a,u)}return 0}function r(s,a,u){return n(s,a,u,0)}function n(s,a,u,p){Re.ensureCache.prepare();const y=Fb(u),b=u===y,S=Re.ensureFloat64(y),C=Re._pe_proj_to_geog_center(Re.getPointer(s),a,S,p);return C&&Ty(u,a,S,b),C}t.geogToProj=e,t.projGeog=i,t.projToGeog=r,t.projToGeogCenter=n})(Fj||(Fj={})),function(t){function e(){t.PE_BUFFER_MAX=Re.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=Re.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=Re.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=Re.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=Re.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=Re.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=Re.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=Re.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=Re.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=Re.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=Re.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=Re.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=Re.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=Re.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=Re.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=Re.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=Re.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=Re.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=Re.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=Re.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_STR_FMT_WKT=Re.PeDefs.prototype.PE_STR_FMT_WKT,t.PE_STR_FMT_WKT2=Re.PeDefs.prototype.PE_STR_FMT_WKT2,t.PE_PARM_X0=Re.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=Re.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=Re.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=Re.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=Re.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=Re.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=Re.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=Re.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=Re.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=Re.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(fs||(fs={})),function(t){const e={},i={},r=O=>{if(O){const P=O.getType();switch(P){case fs.PE_TYPE_GEOGCS:O=Re.castObject(O,Re.PeGeogcs);break;case fs.PE_TYPE_PROJCS:O=Re.castObject(O,Re.PeProjcs);break;case fs.PE_TYPE_GEOGTRAN:O=Re.castObject(O,Re.PeGeogtran);break;default:P&fs.PE_TYPE_UNIT&&(O=Re.castObject(O,Re.PeUnit))}}return O};function n(){Re.PeFactory.prototype.initialize(null)}function s(O){return a(fs.PE_TYPE_COORDSYS,O)}function a(O,P){let $=null,N=e[O];if(N||(N={},e[O]=N),N.hasOwnProperty(String(P)))$=N[P];else{const z=Re.PeFactory.prototype.factoryByType(O,P);Re.compare(z,Re.NULL)||($=z,N[P]=$)}return $=r($),$}function u(O,P){let $=null,N=i[O];if(N||(N={},i[O]=N),N.hasOwnProperty(P))$=N[P];else{const z=Re.PeFactory.prototype.fromString(O,P);Re.compare(z,Re.NULL)||($=z,N[P]=$)}return $=r($),$}function p(O){return a(fs.PE_TYPE_GEOGCS,O)}function y(O){return a(fs.PE_TYPE_GEOGTRAN,O)}function b(O){return Re.PeFactory.prototype.getCode(O)}function S(O){return a(fs.PE_TYPE_PROJCS,O)}function C(O){return a(fs.PE_TYPE_UNIT,O)}t.initialize=n,t.coordsys=s,t.factoryByType=a,t.fromString=u,t.geogcs=p,t.geogtran=y,t.getCode=b,t.projcs=S,t.unit=C}(kj||(kj={}));let Dme=null;var H6,zj,Uj,jj,q6,Bj,W6,X6,Vj;function Nme(t){function e(s,a,u){s[a]=u(s[a])}Re=t,fs.init(),H6.init(),q6.init(),W6.init(),X6.init(),Dme=class extends Re.PeGCSExtent{destroy(){Re.destroy(this)}};const i=[Re.PeDatum,Re.PeGeogcs,Re.PeGeogtran,Re.PeObject,Re.PeParameter,Re.PePrimem,Re.PeProjcs,Re.PeSpheroid,Re.PeUnit];for(const s of i)e(s.prototype,"getName",a=>function(){return a.call(this,new Array(fs.PE_NAME_MAX))});for(const s of[Re.PeGeogtran,Re.PeProjcs])e(s.prototype,"getParameters",a=>function(){const u=new Array(fs.PE_PARM_MAX);let p=a.call(this);for(let y=0;y<u.length;y++){const b=Re.getValue(p,"*");u[y]=b?Re.wrapPointer(b,Re.PeParameter):null,p+=Int32Array.BYTES_PER_ELEMENT}return u});e(Re.PeHorizon.prototype,"getCoord",s=>function(){const a=this.getSize();if(!a)return null;const u=[];return Ty(u,a,s.call(this)),u}),e(Re.PeGTlistExtendedEntry.prototype,"getEntries",s=>{const a=Re._pe_getPeGTlistExtendedGTsSize();return function(){let u=null;const p=s.call(this);if(!Re.compare(p,Re.NULL)){u=[p];const y=this.getSteps();if(y>1){const b=Re.getPointer(p);for(let S=1;S<y;S++)u.push(Re.wrapPointer(b+a*S,Re.PeGTlistExtendedGTs))}}return u}});const r=Re._pe_getPeHorizonSize(),n=s=>function(){let a=this._cache;if(a||(a=new Map,this._cache=a),a.has(s))return a.get(s);let u=null;const p=s.call(this);if(!Re.compare(p,Re.NULL)){u=[p];const y=p.getNump();if(y>1){const b=Re.getPointer(p);for(let S=1;S<y;S++)u.push(Re.wrapPointer(b+r*S,Re.PeHorizon))}}return a.set(s,u),u};e(Re.PeProjcs.prototype,"horizonGcsGenerate",n),e(Re.PeProjcs.prototype,"horizonPcsGenerate",n),Re.PeObject.prototype.toString=function(s=fs.PE_STR_OPTS_NONE){Re.ensureCache.prepare();const a=Re.getPointer(this),u=Re.ensureInt8(new Array(fs.PE_BUFFER_MAX));return Re.UTF8ToString(Re._pe_object_to_string_ext(a,s,u))}}function Y0(t){if(!t)return;const e=Re.getClass(t);if(!e)return;const i=Re.getCache(e);if(!i)return;const r=Re.getPointer(t);r&&delete i[r]}function YR(t,e){const i=[],r=new Array(e);for(let n=0;n<t;n++)i.push(Re.ensureInt8(r));return i}function Fb(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(i=>{e.push(i[0],i[1])})):e=t,e}function Ty(t,e,i,r=!1){if(r)for(let n=0;n<2*e;n++)t[n]=Re.getValue(i+n*Float64Array.BYTES_PER_ELEMENT,"double");else{const n=t.length===0;for(let s=0;s<e;s++)n&&(t[s]=new Array(2)),t[s][0]=Re.getValue(i,"double"),t[s][1]=Re.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function i(){t.PE_GTLIST_OPTS_COMMON=Re.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=Re._pe_getPeGTlistExtendedEntrySize()}function r(n,s,a,u,p,y){let b=null;const S=new Re.PeInteger(y);try{const C=Re.PeGTlistExtended.prototype.getGTlist(n,s,a,u,p,S);if((y=S.val)&&(b=[C],y>1)){const O=Re.getPointer(C);for(let P=1;P<y;P++)b.push(Re.wrapPointer(O+e*P,Re.PeGTlistExtendedEntry))}}finally{Re.destroy(S)}return b}t.init=i,t.getGTlist=r})(H6||(H6={})),function(t){function e(i){if(i?.length){for(const r of i)Y0(r),r.getEntries().forEach(n=>{Y0(n);const s=n.getGeogtran();Y0(s),s.getParameters().forEach(Y0),[s.getGeogcs1(),s.getGeogcs2()].forEach(a=>{Y0(a);const u=a.getDatum();Y0(u),Y0(u.getSpheroid()),Y0(a.getPrimem()),Y0(a.getUnit())})});Re.PeGTlistExtendedEntry.prototype.Delete(i[0])}}t.destroy=e}(zj||(zj={})),function(t){function e(i,r,n,s,a){Re.ensureCache.prepare();const u=Fb(n),p=n===u,y=Re.ensureFloat64(u);let b=0;s&&(b=Re.ensureFloat64(s));const S=Re._pe_geog_to_geog(Re.getPointer(i),r,y,b,a);return S&&Ty(n,r,y,p),S}t.geogToGeog=e}(Uj||(Uj={})),function(t){const e=(y,b,S,C,O,P)=>{let $,N;switch(Re.ensureCache.prepare(),y){case"dd":$=Re._pe_geog_to_dd,N=fs.PE_DD_MAX;break;case"ddm":$=Re._pe_geog_to_ddm,N=fs.PE_DDM_MAX;break;case"dms":$=Re._pe_geog_to_dms,N=fs.PE_DMS_MAX}let z=0;b&&(z=Re.getPointer(b));const U=Fb(C),j=Re.ensureFloat64(U),G=YR(S,N),q=$(z,S,j,O,Re.ensureInt32(G));if(q)for(let W=0;W<S;W++)P[W]=Re.UTF8ToString(G[W]);return q},i=(y,b,S,C,O)=>{let P;switch(Re.ensureCache.prepare(),y){case"dd":P=Re._pe_dd_to_geog;break;case"ddm":P=Re._pe_ddm_to_geog;break;case"dms":P=Re._pe_dms_to_geog}let $=0;b&&($=Re.getPointer(b));const N=C.map(G=>Re.ensureString(G)),z=Re.ensureInt32(N),U=Re.ensureFloat64(new Array(2*S)),j=P($,S,z,U);return j&&Ty(O,S,U),j};function r(y,b,S,C,O){return e("dms",y,b,S,C,O)}function n(y,b,S,C){return i("dms",y,b,S,C)}function s(y,b,S,C,O){return e("ddm",y,b,S,C,O)}function a(y,b,S,C){return i("ddm",y,b,S,C)}function u(y,b,S,C,O){return e("dd",y,b,S,C,O)}function p(y,b,S,C){return i("dd",y,b,S,C)}t.geogToDms=r,t.dmsToGeog=n,t.geogToDdm=s,t.ddmToGeog=a,t.geogToDd=u,t.ddToGeog=p}(jj||(jj={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=Re.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=Re.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=Re.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=Re.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=Re.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(n,s,a,u,p,y,b){Re.ensureCache.prepare();let S=0;n&&(S=Re.getPointer(n));const C=Fb(a),O=Re.ensureFloat64(C),P=YR(s,fs.PE_MGRS_MAX),$=Re.ensureInt32(P),N=Re._pe_geog_to_mgrs_extended(S,s,O,u,p,y,$);if(N)for(let z=0;z<s;z++)b[z]=Re.UTF8ToString(P[z]);return N}function r(n,s,a,u,p){Re.ensureCache.prepare();let y=0;n&&(y=Re.getPointer(n));const b=a.map(P=>Re.ensureString(P)),S=Re.ensureInt32(b),C=Re.ensureFloat64(new Array(2*s)),O=Re._pe_mgrs_to_geog_extended(y,s,S,u,C);return O&&Ty(p,s,C),O}t.init=e,t.geogToMgrsExtended=i,t.mgrsToGeogExtended=r}(q6||(q6={})),function(t){function e(r,n,s,a,u,p,y){Re.ensureCache.prepare();let b=0;r&&(b=Re.getPointer(r));const S=Fb(s),C=Re.ensureFloat64(S),O=YR(n,fs.PE_MGRS_MAX),P=Re.ensureInt32(O),$=Re._pe_geog_to_usng(b,n,C,a,u,p,P);if($)for(let N=0;N<n;N++)y[N]=Re.UTF8ToString(O[N]);return $}function i(r,n,s,a){Re.ensureCache.prepare();let u=0;r&&(u=Re.getPointer(r));const p=s.map(C=>Re.ensureString(C)),y=Re.ensureInt32(p),b=Re.ensureFloat64(new Array(2*n)),S=Re._pe_usng_to_geog(u,n,y,b);return S&&Ty(a,n,b),S}t.geogToUsng=e,t.usngToGeog=i}(Bj||(Bj={})),function(t){function e(){t.PE_UTM_OPTS_NONE=Re.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=Re.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=Re.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(n,s,a,u,p){Re.ensureCache.prepare();let y=0;n&&(y=Re.getPointer(n));const b=Fb(a),S=Re.ensureFloat64(b),C=YR(s,fs.PE_UTM_MAX),O=Re.ensureInt32(C),P=Re._pe_geog_to_utm(y,s,S,u,O);if(P)for(let $=0;$<s;$++)p[$]=Re.UTF8ToString(C[$]);return P}function r(n,s,a,u,p){Re.ensureCache.prepare();let y=0;n&&(y=Re.getPointer(n));const b=a.map(P=>Re.ensureString(P)),S=Re.ensureInt32(b),C=Re.ensureFloat64(new Array(2*s)),O=Re._pe_utm_to_geog(y,s,S,u,C);return O&&Ty(p,s,C),O}t.init=e,t.geogToUtm=i,t.utmToGeog=r}(W6||(W6={})),function(t){const e=new Map;function i(){t.PE_PCSINFO_OPTION_NONE=Re.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=Re.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=Re.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=Re.PePCSInfo.prototype.PE_POLE_POINT}function r(n,s=t.PE_PCSINFO_OPTION_DOMAIN){let a=null,u=null;return e.has(n)&&(u=e.get(n),u[s]&&(a=u[s])),a||(a=Re.PePCSInfo.prototype.generate(n,s),u||(u=[],e.set(n,u)),u[s]=a),a}t.init=i,t.generate=r}(X6||(X6={})),function(t){function e(){return Re.PeVersion.prototype.version_string()}t.versionString=e}(Vj||(Vj={}));const a6e=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return Fj},get PeDefs(){return fs},get PeFactory(){return kj},get PeGCSExtent(){return Dme},get PeGTTransformations(){return Uj},get PeGTlistExtended(){return H6},get PeGTlistExtendedEntry(){return zj},get PeNotationDms(){return jj},get PeNotationMgrs(){return q6},get PeNotationUsng(){return Bj},get PeNotationUtm(){return W6},get PePCSInfo(){return X6},get PeVersion(){return Vj},_init:Nme,get _pe(){return Re},isLoaded:$me,isSupported:o6e,load:Lme},Symbol.toStringTag,{value:"Module"}));var jh;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(jh||(jh={}));let R;const ie={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(R=2e3;R<=2045;R++)ie[R]=0;for(R=2056;R<=2065;R++)ie[R]=0;for(R=2067;R<=2135;R++)ie[R]=0;for(R=2137;R<=2154;R++)ie[R]=0;for(R=2161;R<=2170;R++)ie[R]=0;for(R=2172;R<=2193;R++)ie[R]=0;for(R=2195;R<=2198;R++)ie[R]=0;for(R=2200;R<=2203;R++)ie[R]=0;for(R=2205;R<=2217;R++)ie[R]=0;for(R=2222;R<=2224;R++)ie[R]=1;for(R=2225;R<=2250;R++)ie[R]=2;for(R=2251;R<=2253;R++)ie[R]=1;for(R=2257;R<=2264;R++)ie[R]=2;for(R=2274;R<=2279;R++)ie[R]=2;for(R=2280;R<=2282;R++)ie[R]=1;for(R=2283;R<=2289;R++)ie[R]=2;for(R=2290;R<=2292;R++)ie[R]=0;for(R=2308;R<=2313;R++)ie[R]=0;for(R=2315;R<=2491;R++)ie[R]=0;for(R=2494;R<=2866;R++)ie[R]=0;for(R=2867;R<=2869;R++)ie[R]=1;for(R=2870;R<=2888;R++)ie[R]=2;for(R=2891;R<=2895;R++)ie[R]=2;for(R=2896;R<=2898;R++)ie[R]=1;for(R=2902;R<=2908;R++)ie[R]=2;for(R=2915;R<=2920;R++)ie[R]=2;for(R=2921;R<=2923;R++)ie[R]=1;for(R=2924;R<=2930;R++)ie[R]=2;for(R=2931;R<=2962;R++)ie[R]=0;for(R=2964;R<=2968;R++)ie[R]=2;for(R=2969;R<=2973;R++)ie[R]=0;for(R=2975;R<=2991;R++)ie[R]=0;for(R=2995;R<=3051;R++)ie[R]=0;for(R=3054;R<=3079;R++)ie[R]=0;for(R=3081;R<=3088;R++)ie[R]=0;for(R=3092;R<=3101;R++)ie[R]=0;for(R=3106;R<=3138;R++)ie[R]=0;for(R=3146;R<=3151;R++)ie[R]=0;for(R=3153;R<=3166;R++)ie[R]=0;for(R=3168;R<=3172;R++)ie[R]=0;for(R=3174;R<=3203;R++)ie[R]=0;for(R=3294;R<=3358;R++)ie[R]=0;for(R=3367;R<=3403;R++)ie[R]=0;for(R=3408;R<=3416;R++)ie[R]=0;for(R=3417;R<=3438;R++)ie[R]=2;for(R=3441;R<=3446;R++)ie[R]=2;for(R=3447;R<=3450;R++)ie[R]=0;for(R=3451;R<=3459;R++)ie[R]=2;for(R=3460;R<=3478;R++)ie[R]=0;for(R=3554;R<=3559;R++)ie[R]=0;for(R=3560;R<=3570;R++)ie[R]=2;for(R=3571;R<=3581;R++)ie[R]=0;for(R=3594;R<=3597;R++)ie[R]=0;for(R=3601;R<=3604;R++)ie[R]=0;for(R=3637;R<=3639;R++)ie[R]=0;for(R=3665;R<=3667;R++)ie[R]=0;for(R=3693;R<=3695;R++)ie[R]=0;for(R=3701;R<=3727;R++)ie[R]=0;for(R=3728;R<=3739;R++)ie[R]=2;for(R=3740;R<=3751;R++)ie[R]=0;for(R=3753;R<=3760;R++)ie[R]=2;for(R=3761;R<=3773;R++)ie[R]=0;for(R=3775;R<=3777;R++)ie[R]=0;for(R=3779;R<=3781;R++)ie[R]=0;for(R=3783;R<=3785;R++)ie[R]=0;for(R=3788;R<=3791;R++)ie[R]=0;for(R=3797;R<=3802;R++)ie[R]=0;for(R=3814;R<=3816;R++)ie[R]=0;for(R=3825;R<=3829;R++)ie[R]=0;for(R=3832;R<=3841;R++)ie[R]=0;for(R=3844;R<=3852;R++)ie[R]=0;for(R=3873;R<=3885;R++)ie[R]=0;for(R=3890;R<=3893;R++)ie[R]=0;for(R=3907;R<=3912;R++)ie[R]=0;for(R=3942;R<=3950;R++)ie[R]=0;for(R=3968;R<=3970;R++)ie[R]=0;for(R=3973;R<=3976;R++)ie[R]=0;for(R=3986;R<=3989;R++)ie[R]=0;for(R=3994;R<=3997;R++)ie[R]=0;for(R=4048;R<=4051;R++)ie[R]=0;for(R=4056;R<=4063;R++)ie[R]=0;for(R=4093;R<=4096;R++)ie[R]=0;for(R=4390;R<=4398;R++)ie[R]=0;for(R=4399;R<=4413;R++)ie[R]=2;for(R=4418;R<=4433;R++)ie[R]=2;for(R=4455;R<=4457;R++)ie[R]=2;for(R=4484;R<=4489;R++)ie[R]=0;for(R=4491;R<=4554;R++)ie[R]=0;for(R=4568;R<=4589;R++)ie[R]=0;for(R=4652;R<=4656;R++)ie[R]=0;for(R=4766;R<=4800;R++)ie[R]=0;for(R=5014;R<=5016;R++)ie[R]=0;for(R=5069;R<=5072;R++)ie[R]=0;for(R=5105;R<=5130;R++)ie[R]=0;for(R=5167;R<=5188;R++)ie[R]=0;for(R=5253;R<=5259;R++)ie[R]=0;for(R=5269;R<=5275;R++)ie[R]=0;for(R=5292;R<=5311;R++)ie[R]=0;for(R=5329;R<=5331;R++)ie[R]=0;for(R=5343;R<=5349;R++)ie[R]=0;for(R=5355;R<=5357;R++)ie[R]=0;for(R=5387;R<=5389;R++)ie[R]=0;for(R=5459;R<=5463;R++)ie[R]=0;for(R=5479;R<=5482;R++)ie[R]=0;for(R=5518;R<=5520;R++)ie[R]=0;for(R=5530;R<=5539;R++)ie[R]=0;for(R=5550;R<=5552;R++)ie[R]=0;for(R=5562;R<=5583;R++)ie[R]=0;for(R=5623;R<=5625;R++)ie[R]=2;for(R=5631;R<=5639;R++)ie[R]=0;for(R=5649;R<=5653;R++)ie[R]=0;for(R=5663;R<=5680;R++)ie[R]=0;for(R=5682;R<=5685;R++)ie[R]=0;for(R=5875;R<=5877;R++)ie[R]=0;for(R=5896;R<=5899;R++)ie[R]=0;for(R=5921;R<=5940;R++)ie[R]=0;for(R=6050;R<=6125;R++)ie[R]=0;for(R=6244;R<=6275;R++)ie[R]=0;for(R=6328;R<=6348;R++)ie[R]=0;for(R=6350;R<=6356;R++)ie[R]=0;for(R=6366;R<=6372;R++)ie[R]=0;for(R=6381;R<=6387;R++)ie[R]=0;for(R=6393;R<=6404;R++)ie[R]=0;for(R=6480;R<=6483;R++)ie[R]=0;for(R=6511;R<=6514;R++)ie[R]=0;for(R=6579;R<=6581;R++)ie[R]=0;for(R=6619;R<=6624;R++)ie[R]=0;for(R=6625;R<=6627;R++)ie[R]=2;for(R=6628;R<=6632;R++)ie[R]=0;for(R=6634;R<=6637;R++)ie[R]=0;for(R=6669;R<=6692;R++)ie[R]=0;for(R=6707;R<=6709;R++)ie[R]=0;for(R=6720;R<=6723;R++)ie[R]=0;for(R=6732;R<=6738;R++)ie[R]=0;for(R=6931;R<=6933;R++)ie[R]=0;for(R=6956;R<=6959;R++)ie[R]=0;for(R=7005;R<=7007;R++)ie[R]=0;for(R=7057;R<=7070;R++)ie[R]=2;for(R=7074;R<=7082;R++)ie[R]=0;for(R=7109;R<=7118;R++)ie[R]=0;for(R=7119;R<=7127;R++)ie[R]=1;for(R=7374;R<=7376;R++)ie[R]=0;for(R=7528;R<=7586;R++)ie[R]=0;for(R=7587;R<=7645;R++)ie[R]=2;for(R=7692;R<=7696;R++)ie[R]=0;for(R=7755;R<=7787;R++)ie[R]=0;for(R=7791;R<=7795;R++)ie[R]=0;for(R=7799;R<=7801;R++)ie[R]=0;for(R=7803;R<=7805;R++)ie[R]=0;for(R=7825;R<=7831;R++)ie[R]=0;for(R=7845;R<=7859;R++)ie[R]=0;for(R=8013;R<=8032;R++)ie[R]=0;for(R=8065;R<=8068;R++)ie[R]=1;for(R=8518;R<=8529;R++)ie[R]=2;for(R=8533;R<=8536;R++)ie[R]=2;for(R=8538;R<=8540;R++)ie[R]=2;for(R=8677;R<=8679;R++)ie[R]=0;for(R=8836;R<=8840;R++)ie[R]=0;for(R=8857;R<=8859;R++)ie[R]=0;for(R=8908;R<=8910;R++)ie[R]=0;for(R=9154;R<=9159;R++)ie[R]=0;for(R=9205;R<=9218;R++)ie[R]=0;for(R=9271;R<=9273;R++)ie[R]=0;for(R=9295;R<=9297;R++)ie[R]=0;for(R=9356;R<=9360;R++)ie[R]=0;for(R=9404;R<=9407;R++)ie[R]=0;for(R=9476;R<=9482;R++)ie[R]=0;for(R=9487;R<=9494;R++)ie[R]=0;for(R=9697;R<=9699;R++)ie[R]=0;for(R=9821;R<=9865;R++)ie[R]=0;for(R=10285;R<=10291;R++)ie[R]=0;for(R=10314;R<=10317;R++)ie[R]=0;for(R=10448;R<=10465;R++)ie[R]=0;for(R=11114;R<=11118;R++)ie[R]=0;for(R=20004;R<=20032;R++)ie[R]=0;for(R=20047;R<=20049;R++)ie[R]=0;for(R=20062;R<=20092;R++)ie[R]=0;for(R=20135;R<=20138;R++)ie[R]=0;for(R=20248;R<=20258;R++)ie[R]=0;for(R=20348;R<=20358;R++)ie[R]=0;for(R=20436;R<=20440;R++)ie[R]=0;for(R=20822;R<=20824;R++)ie[R]=0;for(R=20904;R<=20932;R++)ie[R]=0;for(R=20934;R<=20936;R++)ie[R]=0;for(R=21004;R<=21032;R++)ie[R]=0;for(R=21035;R<=21037;R++)ie[R]=0;for(R=21095;R<=21097;R++)ie[R]=0;for(R=21148;R<=21150;R++)ie[R]=0;for(R=21207;R<=21264;R++)ie[R]=0;for(R=21307;R<=21364;R++)ie[R]=0;for(R=21413;R<=21423;R++)ie[R]=0;for(R=21453;R<=21463;R++)ie[R]=0;for(R=21473;R<=21483;R++)ie[R]=0;for(R=21780;R<=21782;R++)ie[R]=0;for(R=21891;R<=21894;R++)ie[R]=0;for(R=21896;R<=21899;R++)ie[R]=0;for(R=22171;R<=22177;R++)ie[R]=0;for(R=22181;R<=22187;R++)ie[R]=0;for(R=22191;R<=22197;R++)ie[R]=0;for(R=22207;R<=22222;R++)ie[R]=0;for(R=22229;R<=22232;R++)ie[R]=0;for(R=22234;R<=22236;R++)ie[R]=0;for(R=22243;R<=22250;R++)ie[R]=0;for(R=22262;R<=22265;R++)ie[R]=0;for(R=22307;R<=22322;R++)ie[R]=0;for(R=22348;R<=22357;R++)ie[R]=0;for(R=22407;R<=22422;R++)ie[R]=0;for(R=22462;R<=22465;R++)ie[R]=0;for(R=22521;R<=22525;R++)ie[R]=0;for(R=22607;R<=22622;R++)ie[R]=0;for(R=22641;R<=22646;R++)ie[R]=0;for(R=22648;R<=22657;R++)ie[R]=0;for(R=22707;R<=22722;R++)ie[R]=0;for(R=22762;R<=22765;R++)ie[R]=0;for(R=22807;R<=22822;R++)ie[R]=0;for(R=22991;R<=22994;R++)ie[R]=0;for(R=23028;R<=23038;R++)ie[R]=0;for(R=23301;R<=23333;R++)ie[R]=2;for(R=23830;R<=23853;R++)ie[R]=0;for(R=23866;R<=23872;R++)ie[R]=0;for(R=23877;R<=23884;R++)ie[R]=0;for(R=23886;R<=23894;R++)ie[R]=0;for(R=23946;R<=23948;R++)ie[R]=0;for(R=24311;R<=24313;R++)ie[R]=0;for(R=24342;R<=24347;R++)ie[R]=0;for(R=24370;R<=24374;R++)ie[R]=10;for(R=24375;R<=24381;R++)ie[R]=0;for(R=24718;R<=24721;R++)ie[R]=0;for(R=24817;R<=24821;R++)ie[R]=0;for(R=24877;R<=24882;R++)ie[R]=0;for(R=24891;R<=24893;R++)ie[R]=0;for(R=25391;R<=25395;R++)ie[R]=0;for(R=25828;R<=25838;R++)ie[R]=0;for(R=26191;R<=26195;R++)ie[R]=0;for(R=26391;R<=26393;R++)ie[R]=0;for(R=26701;R<=26722;R++)ie[R]=0;for(R=26729;R<=26799;R++)ie[R]=2;for(R=26801;R<=26803;R++)ie[R]=2;for(R=26811;R<=26813;R++)ie[R]=2;for(R=26847;R<=26870;R++)ie[R]=2;for(R=26891;R<=26899;R++)ie[R]=0;for(R=26901;R<=26923;R++)ie[R]=0;for(R=26929;R<=26946;R++)ie[R]=0;for(R=26948;R<=26998;R++)ie[R]=0;for(R=27037;R<=27040;R++)ie[R]=0;for(R=27205;R<=27232;R++)ie[R]=0;for(R=27258;R<=27260;R++)ie[R]=0;for(R=27391;R<=27398;R++)ie[R]=0;for(R=27561;R<=27564;R++)ie[R]=0;for(R=27571;R<=27574;R++)ie[R]=0;for(R=27581;R<=27584;R++)ie[R]=0;for(R=27591;R<=27594;R++)ie[R]=0;for(R=28191;R<=28193;R++)ie[R]=0;for(R=28348;R<=28358;R++)ie[R]=0;for(R=28402;R<=28432;R++)ie[R]=0;for(R=28462;R<=28492;R++)ie[R]=0;for(R=29118;R<=29122;R++)ie[R]=0;for(R=29168;R<=29172;R++)ie[R]=0;for(R=29177;R<=29185;R++)ie[R]=0;for(R=29187;R<=29195;R++)ie[R]=0;for(R=29900;R<=29903;R++)ie[R]=0;for(R=30161;R<=30179;R++)ie[R]=0;for(R=30491;R<=30494;R++)ie[R]=0;for(R=30729;R<=30732;R++)ie[R]=0;for(R=31251;R<=31259;R++)ie[R]=0;for(R=31265;R<=31268;R++)ie[R]=0;for(R=31275;R<=31279;R++)ie[R]=0;for(R=31281;R<=31297;R++)ie[R]=0;for(R=31461;R<=31469;R++)ie[R]=0;for(R=31491;R<=31495;R++)ie[R]=0;for(R=31917;R<=31922;R++)ie[R]=0;for(R=31965;R<=32e3;R++)ie[R]=0;for(R=32001;R<=32003;R++)ie[R]=2;for(R=32005;R<=32031;R++)ie[R]=2;for(R=32033;R<=32060;R++)ie[R]=2;for(R=32064;R<=32067;R++)ie[R]=2;for(R=32074;R<=32077;R++)ie[R]=2;for(R=32081;R<=32086;R++)ie[R]=0;for(R=32107;R<=32130;R++)ie[R]=0;for(R=32133;R<=32159;R++)ie[R]=0;for(R=32164;R<=32167;R++)ie[R]=2;for(R=32180;R<=32199;R++)ie[R]=0;for(R=32201;R<=32260;R++)ie[R]=0;for(R=32301;R<=32360;R++)ie[R]=0;for(R=32401;R<=32460;R++)ie[R]=0;for(R=32501;R<=32560;R++)ie[R]=0;for(R=32601;R<=32662;R++)ie[R]=0;for(R=32664;R<=32667;R++)ie[R]=2;for(R=32701;R<=32761;R++)ie[R]=0;for(R=53001;R<=53004;R++)ie[R]=0;for(R=53008;R<=53019;R++)ie[R]=0;for(R=53021;R<=53032;R++)ie[R]=0;for(R=53034;R<=53037;R++)ie[R]=0;for(R=53042;R<=53046;R++)ie[R]=0;for(R=53074;R<=53080;R++)ie[R]=0;for(R=54001;R<=54004;R++)ie[R]=0;for(R=54008;R<=54019;R++)ie[R]=0;for(R=54021;R<=54032;R++)ie[R]=0;for(R=54034;R<=54037;R++)ie[R]=0;for(R=54042;R<=54046;R++)ie[R]=0;for(R=54048;R<=54053;R++)ie[R]=0;for(R=54074;R<=54080;R++)ie[R]=0;for(R=54098;R<=54101;R++)ie[R]=0;for(R=102001;R<=102040;R++)ie[R]=0;for(R=102042;R<=102063;R++)ie[R]=0;for(R=102065;R<=102067;R++)ie[R]=0;for(R=102070;R<=102117;R++)ie[R]=0;for(R=102122;R<=102216;R++)ie[R]=0;for(R=102221;R<=102377;R++)ie[R]=0;for(R=102382;R<=102388;R++)ie[R]=0;for(R=102389;R<=102398;R++)ie[R]=2;for(R=102399;R<=102444;R++)ie[R]=0;for(R=102445;R<=102447;R++)ie[R]=2;for(R=102448;R<=102458;R++)ie[R]=0;for(R=102459;R<=102468;R++)ie[R]=2;for(R=102469;R<=102499;R++)ie[R]=0;for(R=102500;R<=102519;R++)ie[R]=1;for(R=102520;R<=102524;R++)ie[R]=0;for(R=102525;R<=102529;R++)ie[R]=2;for(R=102530;R<=102588;R++)ie[R]=0;for(R=102590;R<=102598;R++)ie[R]=0;for(R=102601;R<=102603;R++)ie[R]=0;for(R=102605;R<=102628;R++)ie[R]=0;for(R=102629;R<=102646;R++)ie[R]=2;for(R=102648;R<=102700;R++)ie[R]=2;for(R=102701;R<=102703;R++)ie[R]=0;for(R=102707;R<=102730;R++)ie[R]=2;for(R=102733;R<=102758;R++)ie[R]=2;for(R=102767;R<=102900;R++)ie[R]=0;for(R=102901;R<=102933;R++)ie[R]=2;for(R=102934;R<=102950;R++)ie[R]=13;for(R=102951;R<=102955;R++)ie[R]=0;for(R=102961;R<=102963;R++)ie[R]=0;for(R=102965;R<=102969;R++)ie[R]=0;for(R=102971;R<=102973;R++)ie[R]=0;for(R=102975;R<=102989;R++)ie[R]=0;for(R=102990;R<=102992;R++)ie[R]=1;for(R=102997;R<=103002;R++)ie[R]=0;for(R=103003;R<=103008;R++)ie[R]=2;for(R=103009;R<=103011;R++)ie[R]=0;for(R=103012;R<=103014;R++)ie[R]=2;for(R=103019;R<=103021;R++)ie[R]=0;for(R=103022;R<=103024;R++)ie[R]=2;for(R=103029;R<=103031;R++)ie[R]=0;for(R=103032;R<=103034;R++)ie[R]=2;for(R=103065;R<=103068;R++)ie[R]=0;for(R=103074;R<=103076;R++)ie[R]=0;for(R=103077;R<=103079;R++)ie[R]=1;for(R=103080;R<=103082;R++)ie[R]=0;for(R=103083;R<=103085;R++)ie[R]=2;for(R=103090;R<=103093;R++)ie[R]=0;for(R=103097;R<=103099;R++)ie[R]=0;for(R=103100;R<=103102;R++)ie[R]=2;for(R=103107;R<=103109;R++)ie[R]=0;for(R=103110;R<=103112;R++)ie[R]=2;for(R=103113;R<=103116;R++)ie[R]=0;for(R=103117;R<=103120;R++)ie[R]=2;for(R=103153;R<=103157;R++)ie[R]=0;for(R=103158;R<=103162;R++)ie[R]=2;for(R=103163;R<=103165;R++)ie[R]=0;for(R=103166;R<=103168;R++)ie[R]=1;for(R=103169;R<=103171;R++)ie[R]=2;for(R=103186;R<=103188;R++)ie[R]=0;for(R=103189;R<=103191;R++)ie[R]=2;for(R=103192;R<=103195;R++)ie[R]=0;for(R=103196;R<=103199;R++)ie[R]=2;for(R=103200;R<=103224;R++)ie[R]=0;for(R=103225;R<=103227;R++)ie[R]=1;for(R=103232;R<=103237;R++)ie[R]=0;for(R=103238;R<=103243;R++)ie[R]=2;for(R=103244;R<=103246;R++)ie[R]=0;for(R=103247;R<=103249;R++)ie[R]=2;for(R=103254;R<=103256;R++)ie[R]=0;for(R=103257;R<=103259;R++)ie[R]=2;for(R=103264;R<=103266;R++)ie[R]=0;for(R=103267;R<=103269;R++)ie[R]=2;for(R=103300;R<=103375;R++)ie[R]=0;for(R=103381;R<=103383;R++)ie[R]=0;for(R=103384;R<=103386;R++)ie[R]=1;for(R=103387;R<=103389;R++)ie[R]=0;for(R=103390;R<=103392;R++)ie[R]=2;for(R=103397;R<=103399;R++)ie[R]=0;for(R=103400;R<=103471;R++)ie[R]=2;for(R=103476;R<=103478;R++)ie[R]=0;for(R=103479;R<=103481;R++)ie[R]=2;for(R=103486;R<=103488;R++)ie[R]=0;for(R=103489;R<=103491;R++)ie[R]=2;for(R=103492;R<=103495;R++)ie[R]=0;for(R=103496;R<=103499;R++)ie[R]=2;for(R=103528;R<=103543;R++)ie[R]=0;for(R=103544;R<=103548;R++)ie[R]=2;for(R=103549;R<=103551;R++)ie[R]=0;for(R=103552;R<=103554;R++)ie[R]=1;for(R=103555;R<=103557;R++)ie[R]=2;for(R=103558;R<=103560;R++)ie[R]=0;for(R=103571;R<=103573;R++)ie[R]=0;for(R=103574;R<=103576;R++)ie[R]=2;for(R=103577;R<=103580;R++)ie[R]=0;for(R=103581;R<=103583;R++)ie[R]=2;for(R=103595;R<=103694;R++)ie[R]=0;for(R=103696;R<=103699;R++)ie[R]=0;for(R=103700;R<=103793;R++)ie[R]=2;for(R=103794;R<=103890;R++)ie[R]=0;for(R=103891;R<=103896;R++)ie[R]=2;for(R=103900;R<=103971;R++)ie[R]=2;for(R=103972;R<=103977;R++)ie[R]=0;for(R=112e3;R<=112101;R++)ie[R]=0;const l6e={102113:!0,102100:!0,3857:!0,3785:!0},c6e={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},Zte='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',ZR=[-20037508342788905e-9,20037508342788905e-9],KR=[-20037508342787e-6,20037508342787e-6],Fme={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:ZR,origin:KR,dx:1e-5},102100:{wkTemplate:Zte,valid:ZR,origin:KR,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:ZR,origin:KR,dx:1e-5},3857:{wkTemplate:Zte,valid:ZR,origin:KR,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Wn(t,e){if(t===e)return!0;if(t==null||e==null)return!1;if(t.wkid!=null||e.wkid!=null)return t.wkid===e.wkid||N2(t)&&N2(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid;const i=t.wkt2??t.wkt,r=e.wkt2??e.wkt;return!(!i||!r)&&i.toUpperCase()===r.toUpperCase()}function Sp(t){return Fa(t)&&t.wkid&&Fme[t.wkid]||null}function J6(t){if(!t)return;if(t.wkid)return String(t.wkid);const e=t.wkt||t.wkt2;return JSON.stringify(e?{wkt:e}:{})}function DJ(t){if(!Fa(t))return!1;if(t.wkid)return ie[t.wkid]==null;const e=t.wkt2||t.wkt;return!!e&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(e)}function oS(t){return!(L0(t)||D0(t))}function $4(t){return Fa(t)&&t.wkid===4326}function ZOt(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function kme(t){return Fa(t)&&t.wkid===jh.CGCS2000}function N2(t){return Fa(t)&&t.wkid!=null&&l6e[t.wkid]===!0}function NJ(t){return Fa(t)&&t.wkid===32662}function FJ(t){return t===jh.GCSMARS2000||t===jh.GCSMARS2000_SPHERE}function L0(t){return Fa(t)&&t.wkid!=null&&FJ(t.wkid)}function kJ(t){return t===jh.GCSMOON2000}function D0(t){return Fa(t)&&t.wkid!=null&&kJ(t.wkid)}function u6e(t){return Fa(t)&&t.wkid!=null&&c6e[t.wkid]===!0}function Fa(t){return t!=null&&(t.wkid!=null&&t.wkid>=2e3||t.wkt2!=null||t.wkt!=null)}const h6e={wkid:4326,wkt:vD(Fme[4326].wkTemplate,{Central_Meridian:"0.0"})},d6e={wkid:102100,latestWkid:3857},p6e={wkid:32662};function zJ(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const zme=zJ(ur),AD=zJ(p0),OD=zJ(Tg),Ume={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${ur.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function Mr(t){return t!=null&&(L0(t)||Wn(t,AD))?p0:t!=null&&(D0(t)||Wn(t,OD))?Tg:ur}function KOt(t){return FJ(t)?p0:kJ(t)?Tg:ur}function Y6(t){return Wn(t,zme)}function ov(t){return Y6(t)||Wn(t,AD)||Wn(t,OD)}const UJ=39.37,f6e=ur.radius*Math.PI/200,jme=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,d2=ie,Bme=/UNIT\[([^\]]+)]/i,m6e=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),g6e=Tl()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Yp=t=>t*t,i1=t=>t*t*t,L4={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Yp(.001)},"square-centimeters":{inBaseUnits:Yp(.01)},"square-decimeters":{inBaseUnits:Yp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Yp(1e3)},"square-inches":{inBaseUnits:Yp(.0254)},"square-feet":{inBaseUnits:Yp(.3048)},"square-yards":{inBaseUnits:Yp(.9144)},"square-miles":{inBaseUnits:Yp(1609.344)},"square-us-feet":{inBaseUnits:Yp(1200/3937)},acres:{inBaseUnits:.0015625*Yp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*i1(.001)},"cubic-centimeters":{inBaseUnits:1e3*i1(.01)},"cubic-decimeters":{inBaseUnits:1e3*i1(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*i1(1e3)},"cubic-inches":{inBaseUnits:1e3*i1(.0254)},"cubic-feet":{inBaseUnits:1e3*i1(.3048)},"cubic-yards":{inBaseUnits:1e3*i1(.9144)},"cubic-miles":{inBaseUnits:1e3*i1(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},y6e=(()=>{const t={};for(const e in L4)for(const i in L4[e].units)t[i]=e;return t})();function v6e(t,e,i){return t*L4[i].units[e].inBaseUnits}function _6e(t,e,i){return t/L4[i].units[e].inBaseUnits}const b6e=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function Gj(t){const e=y6e[t];if(!e)throw new Error("unknown type");return e}function Kte(t,e=null){return e=e||Gj(t),L4[e].baseUnit===t}function Go(t,e,i){if(e===i)return t;const r=Gj(e);if(r!==Gj(i))throw new Error("incompatible units");const n=Kte(e,r)?t:v6e(t,e,r);return Kte(i,r)?n:_6e(n,i,r)}function QOt(t,e,i){switch(i){case"metric":return w6e(t,e);case"imperial":return T6e(t,e);default:return i}}function eRt(t,e,i){switch(i){case"metric":return x6e(t,e);case"imperial":return S6e(t,e);default:return i}}function w6e(t,e){const i=Go(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function x6e(t,e){const i=Go(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function T6e(t,e){const i=Go(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function S6e(t,e){const i=Go(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function tRt(t,e){const i=Go(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function iRt(t,e){const i=Go(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function E6e(t,e,i){return Go(t,e,"meters")/(i*Math.PI/180)}function Vme(t){return g6e.fromJSON(t.toLowerCase())||null}function aS(t){if(t!=null&&!oS(t))return 1;const e=Va(t);return e>1e5?1:e}function C6e(t){return Va(t)>=Mr(t).metersPerDegree?"meters":RD(t)}function Va(t,e=ur.metersPerDegree){return A6e(t,!0)??e}function A6e(t,e=!1){const i=t?.wkid??null,r=t?.wkt2??t?.wkt??null;let n=null;if(i){if(FJ(i))return p0.metersPerDegree;if(kJ(i))return Tg.metersPerDegree;n=d2.values[d2[i]],!n&&e&&m6e.has(i)&&(n=f6e)}else r&&(qme(r)?n=Qte(jme.exec(r),n):Hme(r)&&(n=Qte(Bme.exec(r),n)));return n}function Hj(t){return DJ(t)?1:Va(t)}function Qte(t,e){return t?.[1]?Gme(t[1]):e}function Gme(t){return parseFloat(t.split(",")[1])}function RD(t){const e=t?.wkid??null,i=t?.wkt2??t?.wkt??null;let r=null;if(e)r=d2.units[d2[e]];else if(i){const n=qme(i)?jme:Hme(i)?Bme:null;if(n){const s=n.exec(i);s?.[1]&&(r=R6e(s[1]))}}return r!=null?Vme(r):null}function rRt(t){const e=RD(t);return e!=null&&b6e.includes(e)?e:null}function Hme(t){return/^GEOCCS/i.test(t)}function qme(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const O6e=1e-7;function R6e(t){let i=/[\\"']{1}([^\\"']+)/.exec(t)?.[1];if(!i||!d2.units.includes(i)){const r=Gme(t);i=null;const n=d2.values;for(let s=0;s<n.length;++s)if(Math.abs(r-n[s])<O6e){i=d2.units[s];break}}return i}function nRt(t){const e=RD(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const M6e={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},P6e={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},I6e={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},$6e=Tl()(M6e),L6e=Tl()(P6e),sRt=Tl()(I6e);var _f;let Yr=_f=class extends Ne{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return _f.WebMercator;if(t.wkid===4326)return _f.WGS84}const e=new _f;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return $4(this)}get isWebMercator(){return N2(this)}get isGeographic(){return DJ(this)}get isWrappable(){return u6e(this)}get metersPerUnit(){return Va(this)}get unit(){return RD(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===_f.WGS84)return _f.WGS84;if(this===_f.WebMercator)return _f.WebMercator;const t=new _f;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(t.wkt=this.wkt),this.wkt2!=null&&(t.wkt2=this.wkt2)),this.imageCoordinateSystem&&(t.imageCoordinateSystem=Ce(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:i}=t.imageCoordinateSystem,{geodataXform:r}=t.imageCoordinateSystem,n=this.imageCoordinateSystem;return e==null||r?JSON.stringify(n)===JSON.stringify(t.imageCoordinateSystem):i?n.id===e&&n.referenceServiceName===i:n.id===e}return Wn(this,t)}toJSON(t){return this.write(void 0,t)}};Yr.GCS_NAD_1927=null,Yr.WGS84=null,Yr.WebMercator=null,Yr.PlateCarree=null,_([T({readOnly:!0})],Yr.prototype,"isWGS84",null),_([T({readOnly:!0})],Yr.prototype,"isWebMercator",null),_([T({readOnly:!0})],Yr.prototype,"isGeographic",null),_([T({readOnly:!0})],Yr.prototype,"isWrappable",null),_([T({type:Wr,json:{write:!0}})],Yr.prototype,"latestWkid",void 0),_([T({readOnly:!0})],Yr.prototype,"metersPerUnit",null),_([T({readOnly:!0})],Yr.prototype,"unit",null),_([T({type:Wr,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],Yr.prototype,"wkid",void 0),_([T({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],Yr.prototype,"wkt",void 0),_([ot("wkt"),ot("web-scene","wkt")],Yr.prototype,"writeWkt",null),_([T({type:String,json:{write:!1}})],Yr.prototype,"wkt2",void 0),_([T({type:Wr,json:{write:!0}})],Yr.prototype,"vcsWkid",void 0),_([T({type:Wr,json:{write:!0}})],Yr.prototype,"latestVcsWkid",void 0),_([T()],Yr.prototype,"imageCoordinateSystem",void 0),Yr=_f=_([Z("esri.geometry.SpatialReference")],Yr),Yr.prototype.toJSON.isDefaultToJSON=!0,Yr.GCS_NAD_1927=new Yr({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Yr.WGS84=new Yr(h6e),Yr.WebMercator=new Yr(d6e),Yr.PlateCarree=new Yr(p6e),Object.freeze&&(Object.freeze(Yr.GCS_NAD_1927),Object.freeze(Yr.WGS84),Object.freeze(Yr.WebMercator));const dt=Yr;function rt(t,e,i){let r,n;return e===void 0||Array.isArray(e)?(n=t,i=e,r=[void 0]):(n=e,r=Array.isArray(t)?t:[t]),(s,a)=>{const u=s.constructor.prototype;r.forEach(p=>{const y=q0e(s,p,n);y.read&&typeof y.read=="object"||(y.read={}),y.read.reader=u[a],i&&(y.read.source=(y.read.source||[]).concat(i))})}}let bf=class extends Ne{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=dt.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof dt)return e;if(e!=null){const r=new dt;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};_([T()],bf.prototype,"type",void 0),_([T({readOnly:!0})],bf.prototype,"cache",null),_([T({readOnly:!0})],bf.prototype,"extent",null),_([T({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],bf.prototype,"hasM",void 0),_([T({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],bf.prototype,"hasZ",void 0),_([T({type:dt,json:{write:!0},value:dt.WGS84})],bf.prototype,"spatialReference",void 0),_([rt("spatialReference")],bf.prototype,"readSpatialReference",null),bf=_([Z("esri.geometry.Geometry")],bf);const Iv=bf,D6e=Object.prototype.toString;function N6e(t){const e="__accessorMetadata__"in t?os(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return F6e.apply(this,i)}}function F6e(t,e,i,r){bD(t,e).cast=r}function k6e(t){return(e,i)=>{bD(e,t).cast=e[i]}}function Fi(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&D6e.call(t[0])==="[object Function]"?N6e(t[0]):t.length===1&&typeof t[0]=="string"?k6e(t[0]):void 0}function z6e(t,e){const i=t.x-e.x,r=t.y-e.y,n=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(i*i+r*r+n*n)}const U6e=57.29577951308232,j6e=.017453292519943;function eie(t){return t*U6e}function tie(t){return t*j6e}function iie(t){return t/ur.radius}function Z6(t){return Math.PI/2-2*Math.atan(Math.exp(-t/ur.radius))}function qj(t){return t.wkid!=null||t.wkt!=null}const nF=[0,0];function K6(t,e,i,r,n){const s=t,a=n;if(a.spatialReference=i,"x"in s&&"x"in a)[a.x,a.y]=e(s.x,s.y,nF,r);else if("xmin"in s&&"xmin"in a)[a.xmin,a.ymin]=e(s.xmin,s.ymin,nF,r),[a.xmax,a.ymax]=e(s.xmax,s.ymax,nF,r);else if("paths"in s&&"paths"in a||"rings"in s&&"rings"in a){const u="paths"in s?s.paths:s.rings,p=[];let y;for(let b=0;b<u.length;b++){const S=u[b];y=[],p.push(y);for(let C=0;C<S.length;C++)y.push(e(S[C][0],S[C][1],[0,0],r)),S[C].length>2&&y[C].push(S[C][2]),S[C].length>3&&y[C].push(S[C][3])}"paths"in a?a.paths=p:a.rings=p}else if("points"in s&&"points"in a){const u=s.points,p=[];for(let y=0;y<u.length;y++)p[y]=e(u[y][0],u[y][1],[0,0],r),u[y].length>2&&p[y].push(u[y][2]),u[y].length>3&&p[y].push(u[y][3]);a.points=p}return n}function CA(t,e){const i=t&&(qj(t)?t:t.spatialReference),r=e&&(qj(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!Wn(r,i)||N2(r)&&$4(i)||N2(i)&&$4(r))}function HO(t,e){if(t==null)return null;const i=t.spatialReference,r=e&&(qj(e)?e:e.spatialReference);return CA(i,r)?Wn(i,r)?Ce(t):N2(r)?K6(t,oT,dt.WebMercator,!1,Ce(t)):$4(r)?K6(t,AA,dt.WGS84,!1,Ce(t)):null:null}function oT(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=tie(e);return i[0]=tie(t)*ur.radius,i[1]=ur.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function AA(t,e,i=[0,0],r=!1){const n=eie(t/ur.radius);return i[0]=r?n:n-360*Math.floor((n+180)/360),i[1]=eie(Math.PI/2-2*Math.atan(Math.exp(-e/ur.radius))),i}function Xy(t,e=!1,i=Ce(t)){return K6(t,oT,dt.WebMercator,e,i)}function aT(t,e=!1,i=Ce(t)){return K6(t,AA,dt.WGS84,e,i)}var dI;const zE=[0,0];function rie(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Ll=dI=class extends Iv{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,n){let s;if(Array.isArray(t))s=t,n=e,t=s[0],e=s[1],i=s[2],r=s[3];else if(t&&typeof t=="object"){if(s=t,t=s.x!=null?s.x:s.longitude,e=s.y!=null?s.y:s.latitude,i=s.z,r=s.m,(n=s.spatialReference)&&n.declaredClass!=="esri.geometry.SpatialReference"&&(n=new dt(n)),s.longitude!=null||s.latitude!=null){if(s.longitude==null)Ee.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(s.latitude==null)Ee.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!s.declaredClass&&n&&n.isWebMercator){const u=oT(s.longitude,s.latitude,zE);t=u[0],e=u[1]}}}else rie(i)?(n=i,i=null):rie(r)&&(n=r,r=null);const a={x:t,y:e};return a.x==null&&a.y!=null?Ee.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):a.y==null&&a.x!=null&&Ee.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),n!=null&&(a.spatialReference=n),i!=null&&(a.z=i),r!=null&&(a.m=r),a}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:i}=this;if(t){if(t.isWebMercator)return AA(e,i,zE)[1];if(t.isGeographic)return i}return null}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",oT(i,t,zE)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:i}=this;if(i){if(i.isWebMercator)return AA(t,e,zE)[0];if(i.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",oT(t,e,zE)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new dI;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return dI.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:i,z:r,m:n,spatialReference:s}=this,{z:a,m:u}=t;let{x:p,y,spatialReference:b}=t;if(!s.equals(b))if(s.isWebMercator&&b.isWGS84)[p,y]=oT(p,y),b=s;else{if(!s.isWGS84||!b.isWebMercator)return!1;[p,y]=AA(p,y),b=s}return e===p&&i===y&&r===a&&n===u&&s.wkid===b.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=Sp(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,n=2*r;let s;return e>r?(s=Math.ceil(Math.abs(e-r)/n),e-=s*n):e<i&&(s=Math.ceil(Math.abs(e-i)/n),e+=s*n),this._set("x",e),this}distance(t){return z6e(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};_([T({readOnly:!0})],Ll.prototype,"cache",null),_([T({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ll.prototype,"hasM",null),_([T({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ll.prototype,"hasZ",null),_([T({type:Number})],Ll.prototype,"latitude",null),_([T({type:Number})],Ll.prototype,"longitude",null),_([T({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Fi(t=>isNaN(t)?t:$h(t))],Ll.prototype,"x",void 0),_([ot("x")],Ll.prototype,"writeX",null),_([rt("x")],Ll.prototype,"readX",null),_([T({type:Number,json:{write:!0}})],Ll.prototype,"y",void 0),_([T({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ll.prototype,"z",void 0),_([T({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ll.prototype,"m",void 0),Ll=dI=_([Z("esri.geometry.Point")],Ll),Ll.prototype.toJSON.isDefaultToJSON=!0;const Wt=Ll,sF=[0,0];function jJ(t,e){return e!=null&&al(t,e.x,e.y,e.z)}function aRt(t,e){if(!e.points||e.points.length)return!1;for(const i of e.points)if(!lS(t,i))return!1;return!0}function B6e(t,e){const{xmin:i,ymin:r,zmin:n,xmax:s,ymax:a,zmax:u}=e;return t.hasZ&&e.hasZ?al(t,i,r,n)&&al(t,i,a,n)&&al(t,s,a,n)&&al(t,s,r,n)&&al(t,i,r,u)&&al(t,i,a,u)&&al(t,s,a,u)&&al(t,s,r,u):al(t,i,r)&&al(t,i,a)&&al(t,s,a)&&al(t,s,r)}function lS(t,e){return al(t,e[0],e[1])}function V6e(t,e){return al(t,e[0],e[1],e[2])}function al(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function G6e(t,e){return sF[1]=e.y,sF[0]=e.x,H6e(t,sF)}function H6e(t,e){return Wme(t.rings,e)}function Wme(t,e){if(!t)return!1;if(q6e(t))return nie(!1,t,e);let i=!1;for(let r=0,n=t.length;r<n;r++)i=nie(i,t[r],e);return i}function q6e(t){return!Array.isArray(t[0][0])}function nie(t,e,i){const[r,n]=i;let s=t,a=0;for(let u=0,p=e.length;u<p;u++){a++,a===p&&(a=0);const[y,b]=e[u],[S,C]=e[a];(b<n&&C>=n||C<n&&b>=n)&&y+(n-b)/(C-b)*(S-y)<r&&(s=!s)}return s}function W6e(t,e){return jJ(t,e)}function X6e(t,e){const i=t.hasZ&&e.hasZ;let r,n,s;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(n=e.ymin,t.ymax<n)return!1}else if(n=t.ymin,e.ymax<n)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(s=e.zmin,t.zmax<s)return!1}else if(s=t.zmin,e.zmax<s)return!1}return!0}function J6e(t,e){const{points:i,hasZ:r}=e,n=r?V6e:lS;for(const s of i)if(n(t,s))return!0;return!1}const F2=[0,0],k2=[0,0],z2=[0,0],U2=[0,0],Y6e=[F2,k2,z2,U2],Xme=[[z2,F2],[F2,k2],[k2,U2],[U2,z2]];function Z6e(t,e){return K6e(t,e.rings)}function K6e(t,e){F2[0]=t.xmin,F2[1]=t.ymax,k2[0]=t.xmax,k2[1]=t.ymax,z2[0]=t.xmin,z2[1]=t.ymin,U2[0]=t.xmax,U2[1]=t.ymin;for(const i of Y6e)if(Wme(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(lS(t,r))return!0;for(let n=1;n<i.length;n++){const s=i[n];if(lS(t,s)||Jme(r,s,Xme))return!0;r=s}}return!1}function Q6e(t,e){F2[0]=t.xmin,F2[1]=t.ymax,k2[0]=t.xmax,k2[1]=t.ymax,z2[0]=t.xmin,z2[1]=t.ymin,U2[0]=t.xmax,U2[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let n=r[0];if(lS(t,n))return!0;for(let s=1;s<r.length;s++){const a=r[s];if(lS(t,a)||Jme(n,a,Xme))return!0;n=a}}return!1}const ea=[0,0];function eLe(t){for(let e=0;e<t.length;e++){const i=t[e];for(let n=0;n<i.length-1;n++){const s=i[n],a=i[n+1];for(let u=e+1;u<t.length;u++)for(let p=0;p<t[u].length-1;p++){const y=t[u][p],b=t[u][p+1];if(Wj(s,a,y,b,ea)&&!(ea[0]===s[0]&&ea[1]===s[1]||ea[0]===y[0]&&ea[1]===y[1]||ea[0]===a[0]&&ea[1]===a[1]||ea[0]===b[0]&&ea[1]===b[1]))return!0}}const r=i.length;if(!(r<=4))for(let n=0;n<r-3;n++){let s=r-1;n===0&&(s=r-2);const a=i[n],u=i[n+1];for(let p=n+2;p<s;p++){const y=i[p],b=i[p+1];if(Wj(a,u,y,b,ea)&&!(ea[0]===a[0]&&ea[1]===a[1]||ea[0]===y[0]&&ea[1]===y[1]||ea[0]===u[0]&&ea[1]===u[1]||ea[0]===b[0]&&ea[1]===b[1]))return!0}}}return!1}function Jme(t,e,i){for(let r=0;r<i.length;r++)if(Wj(t,e,i[r][0],i[r][1]))return!0;return!1}function Wj(t,e,i,r,n){const[s,a]=t,[u,p]=e,[y,b]=i,[S,C]=r,O=S-y,P=s-y,$=u-s,N=C-b,z=a-b,U=p-a,j=N*$-O*U;if(j===0)return!1;const G=(O*z-N*P)/j,q=($*z-U*P)/j;return G>=0&&G<=1&&q>=0&&q<=1&&(n&&(n[0]=s+G*(u-s),n[1]=a+G*(p-a)),!0)}function tLe(t){switch(t){case"esriGeometryEnvelope":case"extent":return X6e;case"esriGeometryMultipoint":case"multipoint":return J6e;case"esriGeometryPoint":case"point":return W6e;case"esriGeometryPolygon":case"polygon":return Z6e;case"esriGeometryPolyline":case"polyline":return Q6e}}var ph;function iLe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function r1(t,e,i){return e==null?i:i==null?e:t(e,i)}let Do=ph=class extends Iv{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,n){return iLe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?dt.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:n??dt.WGS84}}static fromBounds(t,e){return new ph({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new ph({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new Wt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new ph;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&CA(e,i)&&(t=e.isWebMercator?Xy(t):aT(t,!0)),t.type==="point"?jJ(this,t):t.type==="extent"&&B6e(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&CA(e,i)&&(t=e.isWebMercator?Xy(t):aT(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const n=(this.zmax-this.zmin)*e;this.zmin+=n,this.zmax-=n}if(this.hasM){const n=(this.mmax-this.mmin)*e;this.mmin+=n,this.mmax-=n}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!Wn(e,i)&&CA(e,i)&&(t=e.isWebMercator?Xy(t):aT(t,!0)),tLe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=r1(Math.min,this.zmin,t.zmin),this.zmax=r1(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=r1(Math.min,this.mmin,t.mmin),this.mmax=r1(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=r1(Math.max,this.zmin,t.zmin),this.zmax=r1(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=r1(Math.max,this.mmin,t.mmin),this.mmax=r1(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=Sp(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?aT(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=this._normalizeX(r.x,t).x),this.spatialReference=new dt(vD((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,n=this.xmin,s=this.xmax;return n>=i&&n<=r&&s>=i&&s<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const n=i??Sp(r);if(n==null)return this;const s=this._getParts(n).map(p=>p.extent);if(s.length<2)return s[0]||this;if(s.length>2)return t?this._shiftCM(n):this.set({xmin:n.valid[0],xmax:n.valid[1]});if(t)return this._shiftCM(n);if(e)return s;let a=!0,u=!0;return s.forEach(p=>{p.hasZ||(a=!1),p.hasM||(u=!1)}),{rings:s.map(p=>{const y=[[p.xmin,p.ymin],[p.xmin,p.ymax],[p.xmax,p.ymax],[p.xmax,p.ymin],[p.xmin,p.ymin]];if(a){const b=(p.zmax-p.zmin)/2;for(let S=0;S<y.length;S++)y[S].push(b)}if(u){const b=(p.mmax-p.mmin)/2;for(let S=0;S<y.length;S++)y[S].push(b)}return y}),hasZ:a,hasM:u,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:n,ymax:s,spatialReference:a}=this,u=this.width,p=this.xmin,y=this.xmax;let b;t=t||Sp(a);const[S,C]=t.valid;b=this._normalizeX(this.xmin,t);const O=b.x,P=b.frameId;b=this._normalizeX(this.xmax,t);const $=b.x,N=b.frameId,z=O===$&&u>0;if(u>2*C){const U=new ph(p<y?O:$,n,C,s,a),j=new ph(S,n,p<y?$:O,s,a),G=new ph(0,n,C,s,a),q=new ph(S,n,0,s,a),W=[],K=[];U.contains(G)&&W.push(P),U.contains(q)&&K.push(P),j.contains(G)&&W.push(N),j.contains(q)&&K.push(N);for(let se=P+1;se<N;se++)W.push(se),K.push(se);e.push({extent:U,frameIds:[P]},{extent:j,frameIds:[N]},{extent:G,frameIds:W},{extent:q,frameIds:K})}else O>$||z?e.push({extent:new ph(O,n,C,s,a),frameIds:[P]},{extent:new ph(S,n,$,s,a),frameIds:[N]}):e.push({extent:new ph(O,n,$,s,a),frameIds:[P]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const n={};i&&(n.zmin=this.zmin,n.zmax=this.zmax),r&&(n.mmin=this.mmin,n.mmax=this.mmax);for(let s=0;s<e.length;s++)e[s].extent.set(n)}return e}_normalizeX(t,e){const[i,r]=e.valid,n=2*r;let s,a=0;return t>r?(s=Math.ceil(Math.abs(t-r)/n),t-=s*n,a=s):t<i&&(s=Math.ceil(Math.abs(t-i)/n),t+=s*n,a=-s),{x:t,frameId:a}}};_([T({readOnly:!0})],Do.prototype,"cache",null),_([T({readOnly:!0})],Do.prototype,"center",null),_([T({readOnly:!0})],Do.prototype,"extent",null),_([T({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Do.prototype,"hasM",null),_([T({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Do.prototype,"hasZ",null),_([T({readOnly:!0})],Do.prototype,"height",null),_([T({readOnly:!0})],Do.prototype,"width",null),_([T({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Do.prototype,"xmin",void 0),_([T({type:Number,json:{write:!0}})],Do.prototype,"ymin",void 0),_([T({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Do.prototype,"mmin",void 0),_([T({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Do.prototype,"zmin",void 0),_([T({type:Number,json:{write:!0}})],Do.prototype,"xmax",void 0),_([T({type:Number,json:{write:!0}})],Do.prototype,"ymax",void 0),_([T({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Do.prototype,"mmax",void 0),_([T({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Do.prototype,"zmax",void 0),Do=ph=_([Z("esri.geometry.Extent")],Do),Do.prototype.toJSON.isDefaultToJSON=!0;const rr=Do;let OA;const rLe=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale;function Yme(){return rLe??globalThis.navigator?.language??"en"}function Bu(){return OA===void 0&&(OA=Yme()),OA}function nLe(t=Bu()){return/^([a-zA-Z]{2,3})(?:[_\-]\w+)*$/.exec(t)?.[1].toLowerCase()}const RA=[];function BJ(t){return RA.push(t),Sr(()=>RA.splice(RA.indexOf(t),1))}const Xj=[];function VJ(t){return Xj.push(t),Sr(()=>RA.splice(Xj.indexOf(t),1))}function sLe(){const t=Yme();OA!==t&&(OA=t,[...Xj].forEach(e=>{e.call(null,t)}),[...RA].forEach(e=>{e.call(null,t)}))}globalThis.addEventListener?.("languagechange",sLe);let QR;function oLe(t){return QR&&!QR.destroyed||(QR=t()),QR}var Jj;const aLe=new br({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let fh=Jj=class extends Ke{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new Jj({categories:this.categories?Ce(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(a=>Array.isArray(a)?JSON.stringify(a):a));let r="";if(this.extent){const a=HO(this.extent,dt.WGS84);a!=null&&(r=`${a.xmin},${a.ymin},${a.xmax},${a.ymax}`)}let n=this.query;!this.disableExtraQuery&&t.extraQuery&&(n="("+n+")"+t.extraQuery);const s={categories:i,bbox:r,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map(a=>aLe.toJSON(a.trim())).join(","),s.sortOrder=this.sortOrder),{query:{...e,...s}}}};_([T()],fh.prototype,"categories",void 0),_([T()],fh.prototype,"disableExtraQuery",void 0),_([T({type:rr})],fh.prototype,"extent",void 0),_([T()],fh.prototype,"filter",void 0),_([T()],fh.prototype,"num",void 0),_([T()],fh.prototype,"query",void 0),_([T()],fh.prototype,"sortField",void 0),_([T()],fh.prototype,"sortOrder",null),_([T()],fh.prototype,"start",void 0),fh=Jj=_([Z("esri.portal.PortalQueryParams")],fh);const e0=fh;var Yj;let po=Yj=class extends Ne{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e&&this.portal?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){const t=this.portal?.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const i=e.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):i})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new de("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new Yj;return e.sourceJSON=t,e.read(t),e}queryItems(t,e){let i=os(e0,t);const r=this.portal;return parseFloat(r.currentVersion)>5?(i=i||new e0,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",e)):(i=i?i.clone():new e0,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,e))}_fetchCategorySchemaSet(t,e){const i=this.portal;return i.fetchSelf(i.authMode,!0,e).then(r=>{const n=r.contentCategorySetsGroupQuery;if(n){const s=new e0;return s.disableExtraQuery=!0,s.num=1,s.query=n,i.queryGroups(s,e)}throw new de("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const n=r.results[0],s=new e0;return s.num=1,s.query=`typekeywords:"${t}"`,n.queryItems(s,e)}throw new de("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",e).then(n=>{const s=n?.categorySchema;return s?.length?s:[]}):[])}};_([T()],po.prototype,"access",void 0),_([T({type:Date})],po.prototype,"created",void 0),_([T()],po.prototype,"description",void 0),_([T()],po.prototype,"id",void 0),_([T()],po.prototype,"isInvitationOnly",void 0),_([T({type:Date})],po.prototype,"modified",void 0),_([T()],po.prototype,"owner",void 0),_([T()],po.prototype,"portal",void 0),_([T()],po.prototype,"snippet",void 0),_([T()],po.prototype,"sortField",void 0),_([T()],po.prototype,"sortOrder",void 0),_([T()],po.prototype,"sourceJSON",void 0),_([T()],po.prototype,"tags",void 0),_([T()],po.prototype,"thumbnail",void 0),_([T({readOnly:!0})],po.prototype,"thumbnailUrl",null),_([T()],po.prototype,"title",void 0),_([T({readOnly:!0})],po.prototype,"url",null),po=Yj=_([Z("esri.portal.PortalGroup")],po);const Zj=po;let L_=class extends Ke{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};_([T()],L_.prototype,"nextQueryParams",void 0),_([T()],L_.prototype,"queryParams",void 0),_([T()],L_.prototype,"results",void 0),_([T()],L_.prototype,"total",void 0),L_=_([Z("esri.portal.PortalQueryResult")],L_);const lLe=L_;let mm=class extends Ne{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new de("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};_([T({type:Date})],mm.prototype,"created",void 0),_([T()],mm.prototype,"id",void 0),_([T()],mm.prototype,"portal",void 0),_([T()],mm.prototype,"title",void 0),_([T({readOnly:!0})],mm.prototype,"url",null),_([T()],mm.prototype,"username",void 0),mm=_([Z("esri.portal.PortalFolder")],mm);const cLe=mm;var Kj;let Yn=Kj=class extends Ne{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.portal?.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.portal?.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,i=t?.data,r=t?.folder,n={method:"post"};e&&(n.query=e.createPostQuery(),i!=null&&(typeof i=="string"?n.query.text=i:typeof i=="object"&&(n.query.text=JSON.stringify(i))));let s=this.userContentUrl;return r&&(s+="/"+(typeof r=="string"?r:r.id)),this.portal.request(s+"/addItem",n).then(a=>(e.id=a.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",i=t.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal.request(e,r).then(()=>{t.forEach(n=>{n.id=null,n.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const n=cLe.fromJSON(r);return n.portal=this.portal,n}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=Zj.fromJSON(i);return r.portal=this.portal,r}):[],e})}fetchItems(t){const e=t??{};let i,r=this.userContentUrl??"";return e.folder&&(r+="/"+e.folder.id),ke(()=>Promise.resolve().then(()=>Zme),void 0,import.meta.url).then(({default:n})=>{i=n;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(r,{query:s})}).then(n=>{let s;return n?.items?(s=n.items.map(a=>{const u=i.fromJSON(a);return u.portal=this.portal,u}),Promise.all(s.map(a=>a.load())).catch(a=>a).then(()=>({items:s,nextStart:n.nextStart,total:n.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new Zj({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new de("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new de("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new Kj;return e.sourceJSON=t,e.read(t),e}};_([T()],Yn.prototype,"access",void 0),_([T({type:Date})],Yn.prototype,"created",void 0),_([T()],Yn.prototype,"culture",void 0),_([T()],Yn.prototype,"description",void 0),_([T()],Yn.prototype,"email",void 0),_([T()],Yn.prototype,"favGroupId",void 0),_([T()],Yn.prototype,"fullName",void 0),_([T({type:Date})],Yn.prototype,"modified",void 0),_([T()],Yn.prototype,"orgId",void 0),_([T()],Yn.prototype,"portal",void 0),_([T()],Yn.prototype,"preferredView",void 0),_([T()],Yn.prototype,"privileges",void 0),_([T()],Yn.prototype,"region",void 0),_([T()],Yn.prototype,"role",void 0),_([T()],Yn.prototype,"roleId",void 0),_([T()],Yn.prototype,"sourceJSON",void 0),_([T()],Yn.prototype,"thumbnail",void 0),_([T({readOnly:!0})],Yn.prototype,"thumbnailUrl",null),_([T()],Yn.prototype,"units",void 0),_([T({readOnly:!0})],Yn.prototype,"userContentUrl",null),_([T({readOnly:!0})],Yn.prototype,"url",null),_([T()],Yn.prototype,"username",void 0),_([T()],Yn.prototype,"userType",void 0),Yn=Kj=_([Z("esri.portal.PortalUser")],Yn);const GJ=Yn;var gm;let eM;const sie={PortalGroup:()=>Promise.resolve({default:Zj}),PortalItem:()=>ke(()=>Promise.resolve().then(()=>Zme),void 0,import.meta.url),PortalUser:()=>Promise.resolve({default:GJ})};let ft=gm=class extends jO(Ip){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=vr.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){oie.unregister(this),this.defaultBasemap=ct(this.defaultBasemap),this.defaultDevBasemap=ct(this.defaultDevBasemap),this.defaultVectorBasemap=ct(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=nn(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)vr.request.trustedServers.includes(e)||vr.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=this.user?.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=GJ.fromJSON(t),e.portal=this),e}load(t){const e=ke(()=>Promise.resolve().then(()=>FLe),void 0,import.meta.url).then(({default:i})=>{oi(t),eM=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{if(Ii){const r=Ii;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==gm.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=r.on("credential-create",uLe(new WeakRef(this))),oie.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await ke(()=>import("./ElevationLayer-d951f11e.js"),["./ElevationLayer-d951f11e.js","./ArcGISCachedService-4a34c99d.js","./TileInfoTilemapCache-686e3956.js","./TilemapCache-0c96136b.js"],import.meta.url)).default;return t?t.map(i=>new e({id:i.id,url:i.url})):[]}async fetchBasemaps(t,e){const i=await this._fetchBasemaps(t,e);if(e?.include3d===!0&&this.use3dBasemaps!==!1){const r=await this._fetchBasemaps3D(t,e);i.unshift(...r)}return i}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):Ms(t)?Promise.reject(or()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,i=new e0;if(i.num=100,i.sortField="title",e&&e.length){const r=[];for(const n of e)r.push(`(title:"${n.title}" AND owner:${n.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,t).then(n=>n.results)}return Ms(t)?Promise.reject(or()):Promise.resolve([])}fetchRegions(t){const e=this.user?.culture||this.culture||Bu();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){const e=this.user?.culture||this.culture||Bu();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return oLe(()=>new gm)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,i){const r=this.restUrl+"/portals/self",n={authMode:t,query:{culture:Bu().toLowerCase()},...i};return n.authMode==="auto"&&(n.authMode="no-prompt"),e&&(n.query.default=!0),this.request(r,n)}queryPortal(t,e,i,r){const n=os(e0,e),s=a=>this.request(this.restUrl+t,{...n.toRequestOptions(this),...r}).then(u=>{const p=n.clone();return p.start=u.nextStart,new lLe({nextQueryParams:p,queryParams:n,total:u.total,results:gm._resultsToTypedArray(a,{portal:this},u,r)})}).then(u=>Promise.all(u.results.map(p=>typeof p.when=="function"?p.when():u)).then(()=>u,p=>($a(p),u)));return i&&sie[i]?sie[i]().then(({default:a})=>(oi(r),s(a))):s()}signIn(){if(this.authMode===gm.AUTH_MODE_ANONYMOUS)return Promise.reject(new de("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return Ii?Ii.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential?.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,i){return this.request(t,e).then(r=>{const n=gm._resultsToTypedArray(i,{portal:this},r);return Promise.all(n.map(s=>typeof s.when=="function"?s.when():r)).then(()=>n,()=>n)})}request(t,e={}){const i={f:"json",...e.query},{authMode:r=this.authMode===gm.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:n=null,cacheBust:s=!1,method:a="auto",responseType:u="json",signal:p}=e,y={authMode:r,body:n,cacheBust:s,method:a,query:i,responseType:u,timeout:0,signal:p};return ir(this._normalizeSSL(t),y).then(b=>b.data)}toJSON(){throw new de("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new gm({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new de("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const i=new e0;i.query=t||(vr.apiKey&&AJ(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0;const r=await this.queryGroups(i,e);if(!r.total)return[];const n=r.results[0];i.num=100,i.query='type:"Web Map" -type:"Web Application"',i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc";const s=await n.queryItems(i,e);return s.total?s.results.filter(a=>a.type==="Web Map").map(a=>new eM({portalItem:a})):[]}async _fetchBasemaps3D(t,e){const i=t||this.basemapGalleryGroupQuery3D;if(!i)return[];const r=new e0({query:i,disableExtraQuery:!0}),n=await this.queryGroups(r,e);if(!n.total)return[];const s=n.results[0];r.num=100,r.query='type:"Web Scene"',r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc";const a=await s.queryItems(r,e);return a.total?a.results.filter(u=>u.type==="Web Scene").map(u=>new eM({portalItem:u})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=eM.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,i,r){let n=[];if(i){const s=r!=null?r.signal:null;n=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||e)&&(n=n.map(a=>{const u=Object.assign(t?t.fromJSON(a):a,e);return typeof u.load=="function"&&u.load(s),u}))}else n=[];return n}};ft.AUTH_MODE_ANONYMOUS="anonymous",ft.AUTH_MODE_AUTO="auto",ft.AUTH_MODE_IMMEDIATE="immediate",_([T()],ft.prototype,"access",void 0),_([T()],ft.prototype,"allSSL",void 0),_([T()],ft.prototype,"authMode",void 0),_([T()],ft.prototype,"authorizedCrossOriginDomains",void 0),_([rt("authorizedCrossOriginDomains")],ft.prototype,"readAuthorizedCrossOriginDomains",null),_([T()],ft.prototype,"basemapGalleryGroupQuery",void 0),_([T({json:{name:"3DBasemapGalleryGroupQuery"}})],ft.prototype,"basemapGalleryGroupQuery3D",void 0),_([T()],ft.prototype,"bingKey",void 0),_([T()],ft.prototype,"canListApps",void 0),_([T()],ft.prototype,"canListData",void 0),_([T()],ft.prototype,"canListPreProvisionedItems",void 0),_([T()],ft.prototype,"canProvisionDirectPurchase",void 0),_([T()],ft.prototype,"canSearchPublic",void 0),_([T()],ft.prototype,"canShareBingPublic",void 0),_([T()],ft.prototype,"canSharePublic",void 0),_([T()],ft.prototype,"canSignInArcGIS",void 0),_([T()],ft.prototype,"canSignInIDP",void 0),_([T()],ft.prototype,"colorSetsGroupQuery",void 0),_([T()],ft.prototype,"commentsEnabled",void 0),_([T({type:Date})],ft.prototype,"created",void 0),_([T()],ft.prototype,"credential",void 0),_([T()],ft.prototype,"culture",void 0),_([T()],ft.prototype,"currentVersion",void 0),_([T()],ft.prototype,"customBaseUrl",void 0),_([T()],ft.prototype,"defaultBasemap",void 0),_([rt("defaultBasemap")],ft.prototype,"readDefaultBasemap",null),_([T()],ft.prototype,"defaultDevBasemap",void 0),_([rt("defaultDevBasemap")],ft.prototype,"readDefaultDevBasemap",null),_([T({type:rr})],ft.prototype,"defaultExtent",void 0),_([T()],ft.prototype,"defaultVectorBasemap",void 0),_([rt("defaultVectorBasemap")],ft.prototype,"readDefaultVectorBasemap",null),_([T()],ft.prototype,"description",void 0),_([T()],ft.prototype,"devBasemapGalleryGroupQuery",void 0),_([T()],ft.prototype,"eueiEnabled",void 0),_([T({readOnly:!0})],ft.prototype,"extraQuery",null),_([T()],ft.prototype,"featuredGroups",void 0),_([T()],ft.prototype,"featuredItemsGroupQuery",void 0),_([T()],ft.prototype,"galleryTemplatesGroupQuery",void 0),_([T()],ft.prototype,"livingAtlasGroupQuery",void 0),_([T()],ft.prototype,"hasCategorySchema",void 0),_([T()],ft.prototype,"helpBase",void 0),_([T()],ft.prototype,"helperServices",void 0),_([T()],ft.prototype,"helpMap",void 0),_([T()],ft.prototype,"homePageFeaturedContent",void 0),_([T()],ft.prototype,"homePageFeaturedContentCount",void 0),_([T()],ft.prototype,"httpPort",void 0),_([T()],ft.prototype,"httpsPort",void 0),_([T()],ft.prototype,"id",void 0),_([T()],ft.prototype,"ipCntryCode",void 0),_([T({readOnly:!0})],ft.prototype,"isOrganization",null),_([T()],ft.prototype,"isPortal",void 0),_([T()],ft.prototype,"isReadOnly",void 0),_([T({readOnly:!0})],ft.prototype,"itemPageUrl",null),_([T()],ft.prototype,"layerTemplatesGroupQuery",void 0),_([T()],ft.prototype,"maxTokenExpirationMinutes",void 0),_([T({type:Date})],ft.prototype,"modified",void 0),_([T()],ft.prototype,"name",void 0),_([T()],ft.prototype,"portalHostname",void 0),_([T()],ft.prototype,"portalMode",void 0),_([T()],ft.prototype,"portalProperties",void 0),_([T()],ft.prototype,"region",void 0),_([T({readOnly:!0})],ft.prototype,"restUrl",null),_([T()],ft.prototype,"rotatorPanels",void 0),_([T()],ft.prototype,"showHomePageDescription",void 0),_([T()],ft.prototype,"sourceJSON",void 0),_([T()],ft.prototype,"staticImagesUrl",void 0),_([T({json:{name:"2DStylesGroupQuery"}})],ft.prototype,"stylesGroupQuery2d",void 0),_([T({json:{name:"stylesGroupQuery"}})],ft.prototype,"stylesGroupQuery3d",void 0),_([T()],ft.prototype,"supportsHostedServices",void 0),_([T()],ft.prototype,"symbolSetsGroupQuery",void 0),_([T()],ft.prototype,"templatesGroupQuery",void 0),_([T()],ft.prototype,"thumbnail",void 0),_([T({readOnly:!0})],ft.prototype,"thumbnailUrl",null),_([T()],ft.prototype,"units",void 0),_([T()],ft.prototype,"url",void 0),_([T()],ft.prototype,"urlKey",void 0),_([rt("urlKey")],ft.prototype,"readUrlKey",null),_([T()],ft.prototype,"user",void 0),_([rt("user")],ft.prototype,"readUser",null),_([T()],ft.prototype,"use3dBasemaps",void 0),_([T()],ft.prototype,"useStandardizedQuery",void 0),_([T()],ft.prototype,"useVectorBasemaps",void 0),_([T()],ft.prototype,"vectorBasemapGalleryGroupQuery",void 0),ft=gm=_([Z("esri.portal.Portal")],ft);const Zs=ft,oie=new FinalizationRegistry(t=>{t.remove()});function uLe(t){const e=Ii;return()=>{const i=t.deref();i&&e.findCredential(i.restUrl)&&i.signIn().catch(()=>{})}}let ym=class extends Ke{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e?.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&ju(e)?Ee.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.cdnUrl;if(r==null)throw new de("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:i?.signal})}async update(e,i){const{addOrUpdateResource:r}=await ke(()=>Promise.resolve().then(()=>YC),void 0,import.meta.url);return r(this,"update",e,i)}hasPath(){return this.path!=null}_normalizePath(e,i){return e==null?e:(e=e.replace(/^\/+/,""),i!=null&&ju(e)&&(e=wJ(e,i.itemUrl)),e?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};_([T()],ym.prototype,"portalItem",void 0),_([T({type:String,value:null})],ym.prototype,"path",null),_([Fi("path")],ym.prototype,"_castPath",null),_([T({type:String,readOnly:!0})],ym.prototype,"url",null),_([T({type:String,readOnly:!0})],ym.prototype,"cdnUrl",null),_([T({type:String,readOnly:!0})],ym.prototype,"itemRelativeUrl",null),ym=_([Z("esri.portal.PortalItemResource")],ym);const hLe=ym;let HC=class extends Ke{constructor(e){super(e),this.created=null,this.rating=null}};_([T()],HC.prototype,"created",void 0),_([T()],HC.prototype,"rating",void 0),HC=_([Z("esri.portal.PortalRating")],HC);const oF=HC;var D_;const dLe=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),pLe=new Set(["KML","GeoJson","CSV"]);let qi=D_=class extends jO(Ip){static from(t){return L2(D_,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?i="Locator":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?i=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"?i="Insights Report":t==="Excalibur Imagery Project"&&(i="Excalibur Project"),i}readExtent(t){return t&&t.length?new rr(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type?.toLowerCase()||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let n,s=!1,a=!1,u=!1,p=!1,y=!1,b=!1,S=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(s=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(a=e.includes("Table"),u=e.includes("Route Layer"),p=e.includes("Markup"),y=e.includes("Spatiotemporal"),b=e.includes("UtilityNetwork"),n=y&&a?"spatiotemporaltable":a?"table":u?"routelayer":p?"markup":y?"spatiotemporal":s?"featureshosted":b?"utilitynetwork":"features"):n=t==="map service"||t==="wms"||t==="wmts"?s||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?n="maps":t==="web scene"?n=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?n="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?n="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?n="mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?n="datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?n="appsgray":t==="360 vr experience"?n="360vr":t==="arcgis pro add in"||t==="arcgis pro configuration"?n="addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?n="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?n="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?n="layersgray":t==="scene package"?n="scenepackage":t==="3dtiles package"?n="3dtileslayerpackage":t==="mobile scene package"?n="mobilescenepackage":t==="tile package"||t==="compact tile package"?n="tilepackage":t==="task file"?n="taskfile":t==="report template"?n="report-template":t==="statistical data collection"?n="statisticaldatacollection":t==="insights workbook"?n="workbook":t==="insights model"?n="insightsmodel":t==="insights page"?n="insightspage":t==="insights theme"?n="insightstheme":t==="hub initiative"?n="hubinitiative":t==="hubpage"?n="hubpage":t==="hub event"?n="hubevent":t==="hub site application"?n="hubsite":t==="hub project"?n="hubproject":t==="relational database connection"?n="relationaldatabaseconnection":t==="big data file share"?n="datastorecollection":t==="image collection"?n="imagecollection":t==="style"?n="style":t==="desktop style"?n="desktopstyle":t==="dashboard"?n="dashboard":t==="raster function template"?n="rasterprocessingtemplate":t==="vector tile package"?n="vectortilepackage":t==="ortho mapping project"?n="orthomappingproject":t==="ortho mapping template"?n="orthomappingtemplate":t==="solution"?n="solutions":t==="geopackage"?n="geopackage":t==="deep learning package"?n="deeplearningpackage":t==="real time analytic"?n="realtimeanalytics":t==="big data analytic"?n="bigdataanalytics":t==="feed"?n="feed":t==="excalibur imagery project"?n="excaliburimageryproject":t==="notebook"?n="notebook":t==="storymap"?n="storymap":t==="survey123 add in"?n="survey123addin":t==="mission"?n="mission":t==="mission report"?n="missionreport":t==="mission template"?n="missiontemplate":t==="quickcapture project"?n="quickcaptureproject":t==="pro report"?n="proreport":t==="pro report template"?n="proreporttemplate":t==="urban model"?n="urbanmodel":t==="web experience"?n="experiencebuilder":t==="web experience template"?n="webexperiencetemplate":t==="experience builder widget"?n="experiencebuilderwidget":t==="experience builder widget package"?n="experiencebuilderwidgetpackage":t==="workflow"?n="workflow":t==="insights script"?n="insightsscript":t==="kernel gateway connection"?n="kernelgatewayconnection":t==="hub initiative template"?n="hubinitiativetemplate":t==="storymap theme"?n="storymaptheme":t==="knowledge graph"?n="knowledgegraph":t==="knowledge studio project"?n="knowledgestudio":t==="native application"?n="nativeapp":t==="native application installer"?n="nativeappinstaller":t==="link chart"?n="linkchart":t==="investigation"?n="investigation":t==="ogcfeatureserver"?n="features":t==="pro project"?n="proproject":t==="insights workbook package"?n="insightsworkbookpackage":t==="apache parquet"?n="apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?n="notebookcodesnippets":t==="suitability model"?n="suitabilitymodel":t==="esri classifier definition"?n="classifierdefinition":t==="esri classification schema"?n="classificationschema":t==="insights data engineering workbook"?n="dataengineeringworkbook":t==="insights data engineering model"?n="dataengineeringmodel":t==="deep learning studio project"?n="deeplearningproject":t==="discussion"?n="discussion":t==="allsource project"?n="allsourceproject":t==="api key"?n="apikey":t==="data pipeline"?n="datapipelines":t==="group layer"?(S=e.includes("Map"),n=S?"layergroup2d":"layergroup"):n=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":"maps",n?Kr(i+n+r+".png"):null}get isLayer(){return this.type!=null&&dLe.has(this.type)}get itemCdnUrl(){let t=this.itemUrl;return t&&Ii&&!Ii.findCredential(t)&&(t=Ii._normalizeAGOLorgDomain(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}get itemPageUrl(){const t=this.portal?.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){const t=this.portal?.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){const t=this.itemUrl,e=this.thumbnail;return t&&e?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`)??null:null}get userItemUrl(){const t=this.portal?.restUrl;if(!t)return null;const e=this.owner||this.portal?.user?.username;return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=Zs.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof oF&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new oF({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:Ce(this.applicationProxies),avgRating:this.avgRating,categories:Ce(this.categories),created:Ce(this.created),culture:this.culture,description:this.description,extent:Ce(this.extent),groupCategories:Ce(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:Ce(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:Ce(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Ce(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Ce(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new D_({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=t[i]?.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new oF(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},D_)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t?.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new de("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new de("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await e.signIn();const{copyResources:r,folder:n,tags:s,title:a}=t||{},u={method:"post",query:{copyPrivateResources:r==="all",folder:typeof n=="string"?n:n?.id,includeResources:!!r,tags:s?.join(","),title:a}},{itemId:p}=await e.request(`${i}/copy`,u);return new D_({id:p,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")$0(e)?r.query={data:e}:r.query={url:fl(e)},i!=null&&(r.query.filename=i);else{const n=new FormData;i!=null?n.append("file",e,i):n.append("file",e),r.body=n}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new de("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:i}=await ke(()=>Promise.resolve().then(()=>YC),void 0,import.meta.url);return i(this,t,e)}async addResource(t,e,i){const{addOrUpdateResource:r}=await ke(()=>Promise.resolve().then(()=>YC),void 0,import.meta.url);return t.portalItem=this,r(t,"add",e,i)}async removeResource(t,e){const{removeResource:i}=await ke(()=>Promise.resolve().then(()=>YC),void 0,import.meta.url);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new de("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await ke(()=>Promise.resolve().then(()=>YC),void 0,import.meta.url);return e(this,t)}resourceFromPath(t){return new hLe({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:Ce(this.categories),created:this.created?.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Ce(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Ce(this.typeKeywords),url:this.url};return yD(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new D_({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};_([T({type:["private","shared","org","public"]})],qi.prototype,"access",void 0),_([T()],qi.prototype,"accessInformation",void 0),_([T({type:String})],qi.prototype,"apiKey",void 0),_([T({json:{read:{source:"appProxies"}}})],qi.prototype,"applicationProxies",void 0),_([T()],qi.prototype,"avgRating",void 0),_([T()],qi.prototype,"categories",void 0),_([T({type:Date})],qi.prototype,"created",void 0),_([T()],qi.prototype,"culture",void 0),_([T()],qi.prototype,"description",void 0),_([T({readOnly:!0})],qi.prototype,"displayName",null),_([T({type:rr})],qi.prototype,"extent",void 0),_([rt("extent")],qi.prototype,"readExtent",null),_([T()],qi.prototype,"groupCategories",void 0),_([T({readOnly:!0})],qi.prototype,"iconUrl",null),_([T()],qi.prototype,"id",void 0),_([T({readOnly:!0})],qi.prototype,"isLayer",null),_([T({type:Boolean,readOnly:!0})],qi.prototype,"isOrgItem",void 0),_([T()],qi.prototype,"itemControl",void 0),_([T({readOnly:!0})],qi.prototype,"itemPageUrl",null),_([T({readOnly:!0})],qi.prototype,"itemUrl",null),_([T()],qi.prototype,"licenseInfo",void 0),_([T({type:Date})],qi.prototype,"modified",void 0),_([T()],qi.prototype,"name",void 0),_([T()],qi.prototype,"numComments",void 0),_([T()],qi.prototype,"numRatings",void 0),_([T()],qi.prototype,"numViews",void 0),_([T()],qi.prototype,"owner",void 0),_([T()],qi.prototype,"ownerFolder",void 0),_([T({type:Zs})],qi.prototype,"portal",void 0),_([T()],qi.prototype,"screenshots",void 0),_([T()],qi.prototype,"size",void 0),_([T()],qi.prototype,"snippet",void 0),_([T()],qi.prototype,"sourceJSON",void 0),_([T({type:String})],qi.prototype,"sourceUrl",void 0),_([T({type:String})],qi.prototype,"spatialReference",void 0),_([T()],qi.prototype,"tags",void 0),_([T()],qi.prototype,"thumbnail",void 0),_([T({readOnly:!0})],qi.prototype,"thumbnailUrl",null),_([T()],qi.prototype,"title",void 0),_([T()],qi.prototype,"type",void 0),_([T()],qi.prototype,"typeKeywords",void 0),_([T({type:String,json:{read(t,e){if(pLe.has(e.type)){const i=this.portal?.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],qi.prototype,"url",void 0),_([T({readOnly:!0})],qi.prototype,"userItemUrl",null),qi=D_=_([Z("esri.portal.PortalItem")],qi);const p2=qi,Zme=Object.freeze(Object.defineProperty({__proto__:null,default:p2},Symbol.toStringTag,{value:"Module"})),aie=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,fLe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function lie(t){return t in fLe}const qC=[],MT=new Map;function cie(t){for(const e of MT.keys())Kme(t.pattern,e)&&MT.delete(e)}function mLe(t){return qC.includes(t)||(cie(t),qC.unshift(t)),Sr(()=>{const e=qC.indexOf(t);e>-1&&(qC.splice(e,1),cie(t))})}async function HJ(t){const e=Bu();MT.has(t)||MT.set(t,yLe(t,e));const i=MT.get(t);return i&&await vLe.add(i),i}function gLe(t){if(!aie.test(t))return null;const e=aie.exec(t);if(e===null)return null;const[,i,r]=e,n=i+(r?"-"+r.toUpperCase():"");return lie(n)?n:lie(i)?i:null}async function yLe(t,e){const i=[];for(const r of qC)if(Kme(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(n){i.push(n)}throw i.length?new de("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new de("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function Kme(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}VJ(()=>{MT.clear()});const vLe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=Ys())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function _Le(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,i=await HJ("esri/t9n/basemaps");return i[t]||i[e]}const Qj={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return Kr("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return Kr("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return Kr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return Kr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return Kr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return Kr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return Kr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return Kr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return Kr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return Kr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return Kr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return Kr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},bLe=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let rx=class extends Ke{constructor(e){super(e),this.id=null,this.language=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps"}getLanguageParamValue(){if(this.language)return this.language;const e=Bu().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const i=nLe(e);return i==="pt"?"pt-BR":i&&bLe.has(i)?i:"global"}};_([T()],rx.prototype,"id",void 0),_([T()],rx.prototype,"language",void 0),_([T()],rx.prototype,"serviceUrl",void 0),rx=_([Z("esri.support.BasemapStyle")],rx);const wLe=rx;function pRt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function fRt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function MA(t){const e=t?.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function cS(t){return t!=null&&"type"in t&&t.type==="group"}const mRt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function Qme(t){const e=t?.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function uie(t){return t?.type==="voxel"}function hie(t){return t?.type==="imagery-tile"}function pI(t){return t?.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function MD(t){return t?.type==="feature"&&!t.url&&t.source?.type==="memory"}function gRt(t){return(t?.type==="feature"||t?.type==="subtype-group")&&t.source?.type==="feature-layer"}function xLe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function ege(t,e){const i=Ii?.findServerInfo(t);if(i?.currentVersion!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const n=`${t.substring(0,r)}/rest/info`,s=e!=null?e.signal:null,{data:a}=await ir(n,{query:{f:"json"},responseType:"json",signal:s});return a?.owningSystemUrl||null}function TLe(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function SLe(t){return TLe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function ELe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function CLe(t){return!!ELe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const ALe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),OLe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function RLe(t){return t.layerContainerType==="basemap"?ALe:t.layerContainerType==="operational-layers"?OLe:null}function MLe(t,e){if(e.restrictedWebMapWriting){const i=RLe(e);return i==null||i.has(t.type)&&!MD(t)}return!0}function PLe(t,e){if(e)if(MD(t)){const i=tg("featureCollection.layers",e),r=i?.[0]?.layerDefinition;r&&die(t,r)}else t.type!=="group"&&die(t,e)}function die(t,e){"maxScale"in t&&(e.maxScale=k6(t.maxScale)??void 0),"minScale"in t&&(e.minScale=k6(t.minScale)??void 0)}function ILe(t,e){if(PLe(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=k6(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(MD(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function pie(t,e,i){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return i?.messages&&i.messages.push(new de("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(MD(t)&&!t.isTable)e=t.resourceInfo;else if(MLe(t,i)){const r={};return t.write(r,i)?r:null}return e!=null&&ILe(t,e=Ce(e)),e}var WC;let $Le=0;const LLe="esri.Basemap";let hu=WC=class extends jO(Ip){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+$Le++,this.baseLayers=new Dt,this.referenceLayers=new Dt;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&Ee.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.addHandles([this.baseLayers.on("after-add",r=>e(r.item)),this.referenceLayers.on("after-add",r=>e(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{Ee.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.toArray();for(const i of t)i.destroy();const e=this.referenceLayers.toArray();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=ct(this.portalItem)}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",xg(t,this._get("baseLayers")))}_writeBaseLayers(t,e,i){const r=[];t&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(n=>{const s=pie(n,i.webmap?i.webmap.getLayerJSONFromResourceInfo(n):null,i);s!=null&&r.push(s)}),this.referenceLayers.forEach(n=>{const s=pie(n,i.webmap?i.webmap.getLayerJSONFromResourceInfo(n):null,i);s!=null&&(n.type!=="scene"&&(s.isReference=!0),r.push(s))})),e.baseMapLayers=r}set referenceLayers(t){this._set("referenceLayers",xg(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return $J(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>E6(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>E6(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new WC({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e?.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=Ce(i);return r.url&&S0(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&S0(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:i,style:r}=this;oi(t);const n=[];if(e){const s=e.context?e.context.url:null;if(n.push(this._loadLayersFromJSON(e.data,s,t)),e.data.id&&!e.data.title){const a=e.data.id;n.push(_Le(a).then(u=>{u&&this.read({title:u},e.context)}))}}else i?n.push(this._loadFromItem(i,t)):r&&n.push(this._loadFromStylesService(r,t));await Promise.all(n)}async _loadLayersFromJSON(t,e,i){const r=this.resourceInfo?.context,n=this.portalItem?.portal||r?.portal||null,s=NLe[r?.origin||""]??"web-map",{populateOperationalLayers:a}=await ke(()=>import("./layersCreator-38f71b2f.js"),["./layersCreator-38f71b2f.js","./portalLayers-7555fcdb.js","./associatedFeatureServiceUtils-c90a3355.js","./requestPresets-5652178e.js"],import.meta.url),u=[];if(oi(i),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const p={context:{...r,origin:s,url:e,portal:n,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},y=C=>s==="web-scene"&&C.layerType==="ArcGISSceneServiceLayer"||C.isReference,b=a(this.baseLayers,t.baseMapLayers.filter(C=>!y(C)),p);u.push(b);const S=a(this.referenceLayers,t.baseMapLayers.filter(y),p);u.push(S)}await Promise.allSettled(u)}async _loadFromItem(t,e){const i=await t.load(e),r=await i.fetchData("json",e),n=Nn(t.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:DLe[t.type||""]??"web-map",portal:t.portal||Zs.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||Zs.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}async _loadFromStylesService(t,e){const i=`${t.serviceUrl}/${t.id}`,r=(await ir(i,{query:{language:t.getLanguageParamValue()},signal:e?.signal})).data;if(r.baseMap&&Array.isArray(r.baseMap.baseMapLayers)){for(const s of r.baseMap.baseMapLayers)if(!s.customParameters&&s.styleUrl?.includes("?")){const a=Nn(s.styleUrl);a.query&&(s.styleUrl=a.path,s.customParameters=a.query)}}const n=Nn(i);return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:"web-map",url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}static fromId(t){const e=Qj[t];return e?e.itemId?new WC({portalItem:{id:e.itemId,portal:{url:"https://www.arcgis.com"}}}):WC.fromJSON(e,{origin:e.is3d?"web-scene":"web-map"}):null}};_([T({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Dt}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],hu.prototype,"baseLayers",null),_([T({type:String,json:{origins:{"web-scene":{write:!0}}}})],hu.prototype,"id",void 0),_([T({type:p2})],hu.prototype,"portalItem",void 0),_([T()],hu.prototype,"referenceLayers",null),_([T({readOnly:!0})],hu.prototype,"resourceInfo",void 0),_([T({type:dt})],hu.prototype,"spatialReference",void 0),_([T({type:wLe})],hu.prototype,"style",void 0),_([T()],hu.prototype,"thumbnailUrl",void 0),_([T({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],hu.prototype,"title",void 0),_([ot("title")],hu.prototype,"writeTitle",null),hu=WC=_([Z(LLe)],hu);const DLe={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},NLe={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},PT=hu,FLe=Object.freeze(Object.defineProperty({__proto__:null,default:PT},Symbol.toStringTag,{value:"Module"})),Q6={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function tge(t){return!!Q6[t]||!!Q6[t.toLowerCase()]}function qJ(t){return Q6[t]??Q6[t.toLowerCase()]}function kLe(t){return[...qJ(t)]}function aF(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function ige(t,e,i,r=1){const n=(t%360+360)%360/360,s=i<=.5?i*(e+1):i+e-i*e,a=2*i-s;return[Math.round(255*aF(a,s,n+1/3)),Math.round(255*aF(a,s,n)),Math.round(255*aF(a,s,n-1/3)),r]}function zLe(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,n=e?1:17,s=e?t.length===9:t.length===5;let a=+("0x"+t.substr(1));if(isNaN(a))return null;const u=[0,0,0,1];let p;return s&&(p=a&r,a>>=i,u[3]=n*p/255),p=a&r,a>>=i,u[2]=n*p,p=a&r,a>>=i,u[1]=n*p,p=a&r,a>>=i,u[0]=n*p,u}function H(){return[0,0,0]}function An(t){return[t[0],t[1],t[2]]}function st(t,e,i){return[t,e,i]}function Ma(t,e=H()){const i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function rge(t,e){return new Float64Array(t,e,3)}function nge(){return H()}function sge(){return st(1,1,1)}function oge(){return st(1,0,0)}function age(){return st(0,1,0)}function WJ(){return st(0,0,1)}const Mo=nge(),rg=sge(),lge=oge(),cge=age(),XJ=WJ();Object.freeze(Object.defineProperty({__proto__:null,ONES:rg,UNIT_X:lge,UNIT_Y:cge,UNIT_Z:XJ,ZEROS:Mo,clone:An,create:H,createView:rge,fromArray:Ma,fromValues:st,ones:sge,unitX:oge,unitY:age,unitZ:WJ,zeros:nge},Symbol.toStringTag,{value:"Module"}));let JJ=1e-6;function Ko(){return JJ}function ULe(t){JJ=t}const qO=Math.random,jLe=Math.PI/180,BLe=180/Math.PI;function PD(t){return t*jLe}function VLe(t){return t*BLe}function GLe(t,e){return Math.abs(t-e)<=JJ*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:qO,equals:GLe,getEpsilon:Ko,setEpsilon:ULe,toDegree:VLe,toRadian:PD},Symbol.toStringTag,{value:"Module"}));function Qe(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function Ie(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function $e(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function Ue(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Be(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function ID(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function eL(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function HLe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function uge(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function uS(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function tL(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function $D(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function hge(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function qLe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Pe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Xl(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function un(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)}function ao(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function ha(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function ka(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function WLe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function We(t,e){const i=e[0],r=e[1],n=e[2];let s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}function He(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function qt(t,e,i){const r=e[0],n=e[1],s=e[2],a=i[0],u=i[1],p=i[2];return t[0]=n*p-s*u,t[1]=s*a-r*p,t[2]=r*u-n*a,t}function Ir(t,e,i,r){const n=e[0],s=e[1],a=e[2];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=a+r*(i[2]-a),t}function XLe(t,e,i,r,n,s){const a=s*s,u=a*(2*s-3)+1,p=a*(s-2)+s,y=a*(s-1),b=a*(3-2*s);return t[0]=e[0]*u+i[0]*p+r[0]*y+n[0]*b,t[1]=e[1]*u+i[1]*p+r[1]*y+n[1]*b,t[2]=e[2]*u+i[2]*p+r[2]*y+n[2]*b,t}function JLe(t,e,i,r,n,s){const a=1-s,u=a*a,p=s*s,y=u*a,b=3*s*u,S=3*p*a,C=p*s;return t[0]=e[0]*y+i[0]*b+r[0]*S+n[0]*C,t[1]=e[1]*y+i[1]*b+r[1]*S+n[1]*C,t[2]=e[2]*y+i[2]*b+r[2]*S+n[2]*C,t}function YLe(t,e){e=e||1;const i=qO,r=2*i()*Math.PI,n=2*i()-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*s,t[1]=Math.sin(r)*s,t[2]=n*e,t}function wt(t,e,i){const r=e[0],n=e[1],s=e[2];return t[0]=i[0]*r+i[4]*n+i[8]*s+i[12],t[1]=i[1]*r+i[5]*n+i[9]*s+i[13],t[2]=i[2]*r+i[6]*n+i[10]*s+i[14],t}function Lc(t,e,i){const r=e[0],n=e[1],s=e[2];return t[0]=r*i[0]+n*i[3]+s*i[6],t[1]=r*i[1]+n*i[4]+s*i[7],t[2]=r*i[2]+n*i[5]+s*i[8],t}function f0(t,e,i){const r=i[0],n=i[1],s=i[2],a=i[3],u=e[0],p=e[1],y=e[2];let b=n*y-s*p,S=s*u-r*y,C=r*p-n*u,O=n*C-s*S,P=s*b-r*C,$=r*S-n*b;const N=2*a;return b*=N,S*=N,C*=N,O*=2,P*=2,$*=2,t[0]=u+b+O,t[1]=p+S+P,t[2]=y+C+$,t}function ZLe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0],s[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),s[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function KLe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),s[1]=n[1],s[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function QLe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),s[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),s[2]=n[2],t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function dge(t,e){Ie(tM,t),Ie(iM,e),We(tM,tM),We(iM,iM);const i=He(tM,iM);return i>1?0:i<-1?Math.PI:Math.acos(i)}const tM=H(),iM=H();function e8e(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function pa(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function j2(t,e){if(t===e)return!0;const i=t[0],r=t[1],n=t[2],s=e[0],a=e[1],u=e[2],p=Ko();return Math.abs(i-s)<=p*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=p*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-u)<=p*Math.max(1,Math.abs(n),Math.abs(u))}function Ng(t,e,i){const r=i[0]-e[0],n=i[1]-e[1],s=i[2]-e[2];let a=r*r+n*n+s*s;return a>0?(a=1/Math.sqrt(a),t[0]=r*a,t[1]=n*a,t[2]=s*a,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Ao=Be,t8e=ID,i8e=eL,WO=un,LD=ao,Sc=Qe,eB=ha,fie=Object.freeze(Object.defineProperty({__proto__:null,abs:uS,add:Ue,angle:dge,bezier:JLe,ceil:HLe,copy:Ie,cross:qt,direction:Ng,dist:WO,distance:un,div:i8e,divide:eL,dot:He,equals:j2,exactEquals:pa,floor:uge,hermite:XLe,inverse:WLe,len:Sc,length:Qe,lerp:Ir,max:hge,min:$D,mul:t8e,multiply:ID,negate:ka,normalize:We,random:YLe,rotateX:ZLe,rotateY:KLe,rotateZ:QLe,round:qLe,scale:Pe,scaleAndAdd:Xl,set:$e,sign:tL,sqrDist:LD,sqrLen:eB,squaredDistance:ao,squaredLength:ha,str:e8e,sub:Ao,subtract:Be,transformMat3:Lc,transformMat4:wt,transformQuat:f0},Symbol.toStringTag,{value:"Module"}));function mp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function _n(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function YJ(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function pge(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function fge(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function mge(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function r8e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function n8e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function s8e(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function o8e(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function a8e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function B2(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function l8e(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function gge(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(i*i+r*r+n*n+s*s)}function iL(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return i*i+r*r+n*n+s*s}function ZJ(t){const e=t[0],i=t[1],r=t[2],n=t[3];return Math.sqrt(e*e+i*i+r*r+n*n)}function KJ(t){const e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n}function c8e(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function u8e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function yge(t,e){const i=e[0],r=e[1],n=e[2],s=e[3];let a=i*i+r*r+n*n+s*s;return a>0&&(a=1/Math.sqrt(a),t[0]=i*a,t[1]=r*a,t[2]=n*a,t[3]=s*a),t}function vge(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function DD(t,e,i,r){const n=e[0],s=e[1],a=e[2],u=e[3];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=a+r*(i[2]-a),t[3]=u+r*(i[3]-u),t}function h8e(t,e){const i=qO;let r,n,s,a,u,p;e=e||1;do r=2*i()-1,n=2*i()-1,u=r*r+n*n;while(u>=1);do s=2*i()-1,a=2*i()-1,p=s*s+a*a;while(p>=1);const y=Math.sqrt((1-u)/p);return t[0]=e*r,t[1]=e*n,t[2]=e*s*y,t[3]=e*a*y,t}function Nu(t,e,i){const r=e[0],n=e[1],s=e[2],a=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*s+i[12]*a,t[1]=i[1]*r+i[5]*n+i[9]*s+i[13]*a,t[2]=i[2]*r+i[6]*n+i[10]*s+i[14]*a,t[3]=i[3]*r+i[7]*n+i[11]*s+i[15]*a,t}function d8e(t,e,i){const r=e[0],n=e[1],s=e[2],a=i[0],u=i[1],p=i[2],y=i[3],b=y*r+u*s-p*n,S=y*n+p*r-a*s,C=y*s+a*n-u*r,O=-a*r-u*n-p*s;return t[0]=b*y+O*-a+S*-p-C*-u,t[1]=S*y+O*-u+C*-a-b*-p,t[2]=C*y+O*-p+b*-u-S*-a,t[3]=e[3],t}function p8e(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function IT(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function V2(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],a=e[0],u=e[1],p=e[2],y=e[3],b=Ko();return Math.abs(i-a)<=b*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-u)<=b*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-p)<=b*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-y)<=b*Math.max(1,Math.abs(s),Math.abs(y))}const f8e=pge,m8e=fge,g8e=mge,y8e=gge,v8e=iL,_8e=ZJ,b8e=KJ,_ge=Object.freeze(Object.defineProperty({__proto__:null,add:YJ,ceil:r8e,copy:mp,dist:y8e,distance:gge,div:g8e,divide:mge,dot:vge,equals:V2,exactEquals:IT,floor:n8e,inverse:u8e,len:_8e,length:ZJ,lerp:DD,max:o8e,min:s8e,mul:m8e,multiply:fge,negate:c8e,normalize:yge,random:h8e,round:a8e,scale:B2,scaleAndAdd:l8e,set:_n,sqrDist:v8e,sqrLen:b8e,squaredDistance:iL,squaredLength:KJ,str:p8e,sub:f8e,subtract:pge,transformMat4:Nu,transformQuat:d8e},Symbol.toStringTag,{value:"Module"})),mie=new Float32Array(1);function bge(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function Je(t,e,i){return Math.min(Math.max(t,e),i)}function G2(t){return(t&t-1)==0}function yRt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function vRt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function si(t,e,i){return t+(e-t)*i}function _Rt(t,e,i,r,n){return si(r,n,(t-e)/(i-e))}function gi(t){return t*Math.PI/180}function wl(t){return 180*t/Math.PI}function tB(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function co(t){return Math.acos(Je(t,-1,1))}function Qh(t){return Math.asin(Je(t,-1,1))}function Jy(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}const rL=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function iB(t){return rL.setFloat64(0,t),rL.getBigInt64(0)}function w8e(t){return rL.setBigInt64(0,t),rL.getFloat64(0)}const fI=BigInt("1000000"),x8e=wge(1);function wge(t){const e=iB(t=Math.abs(t)),i=w8e(e<=fI?fI:e-fI);return Math.abs(t-i)}function bRt(t,e,i=x8e){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(i!=null&&wge(Math.min(Math.abs(t),Math.abs(e)))<i)return Math.abs(t-e)<=i;const r=iB(t),n=iB(e);return r<0!=n<0?!1:!((r<n?n-r:r-n)>fI)}function T8e(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),n=Math.abs(t),s=Math.abs(e);if(t===0||e===0||n<1e-12&&s<1e-12){if(r>.01*i)return!1}else if(r/(n+s)>i)return!1;return!0}function S8e(t){return xge(Math.max(-rB,Math.min(t,rB)))}function xge(t){return mie[0]=t,mie[0]}function D4(t,e,i){const r=Je((i-t)/(e-t),0,1);return r*r*(3-2*r)}function gie(t,e){const i=Qe(t),r=Qh(t[2]/i),n=Math.atan2(t[1]/i,t[0]/i);return $e(e,i,r,n),e}function wRt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(Jy(e,1)&&Jy(i,1)&&Jy(r,1))}function E8e(t,e){return(t%e+e)%e}const rB=xge(34028234663852886e22);function rM(t){return Je(pJ(t),0,255)}function nM(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}function sM(t,e){const i=t.toString(16).padStart(2,"0");return e?i.substring(0,1):i}let mI=class No{static blendColors(e,i,r,n=new No){return n.r=Math.round(e.r+(i.r-e.r)*r),n.g=Math.round(e.g+(i.g-e.g)*r),n.b=Math.round(e.b+(i.b-e.b)*r),n.a=e.a+(i.a-e.a)*r,n._sanitize()}static fromRgb(e,i){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const n=r[2].split(/\s*,\s*/),s=r[1];if(s==="rgb"&&n.length===3||s==="rgba"&&n.length===4){const a=n[0];if(a.charAt(a.length-1)==="%"){const u=n.map(p=>2.56*parseFloat(p));return n.length===4&&(u[3]=parseFloat(n[3])),No.fromArray(u,i)}return No.fromArray(n.map(u=>parseFloat(u)),i)}if(s==="hsl"&&n.length===3||s==="hsla"&&n.length===4)return No.fromArray(ige(parseFloat(n[0]),parseFloat(n[1])/100,parseFloat(n[2])/100,parseFloat(n[3])),i)}return null}static fromHex(e,i=new No){if(e[0]!=="#"||isNaN(+`0x${e.substring(1)}`))return null;switch(e.length){case 4:case 5:{const r=parseInt(e.substring(1,2),16),n=parseInt(e.substring(2,3),16),s=parseInt(e.substring(3,4),16),a=e.length===5?15:parseInt(e.substring(4),16);return No.fromArray([r+16*r,n+16*n,s+16*s,(a+16*a)/255],i)}case 7:case 9:{const r=parseInt(e.substring(1,3),16),n=parseInt(e.substring(3,5),16),s=parseInt(e.substring(5,7),16),a=e.length===7?255:parseInt(e.substring(7),16);return No.fromArray([r,n,s,a/255],i)}default:return null}}static fromArray(e,i=new No){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=tge(e)?qJ(e):null;return r&&No.fromArray(r,i)||No.fromRgb(e,i)||No.fromHex(e,i)}static fromJSON(e){return e!=null?new No([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?No.fromString(e,this):Array.isArray(e)?No.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof No||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const i=e?.capitalize??!1,r=e?.digits??6,n=r===3||r===4,s=r===4||r===8,a=`#${sM(this.r,n)}${sM(this.g,n)}${sM(this.b,n)}${s?sM(Math.round(255*this.a),n):""}`;return i?a.toUpperCase():a}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=No.AlphaMode.ALWAYS){const i=rM(this.r),r=rM(this.g),n=rM(this.b);return e===No.AlphaMode.ALWAYS||this.a!==1?[i,r,n,rM(255*this.a)]:[i,r,n]}clone(){return new No(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(nM(this.r,0,255)),this.g=Math.round(nM(this.g,0,255)),this.b=Math.round(nM(this.b,0,255)),this.a=nM(this.a,0,1),this}_set(e,i,r,n){this.r=e,this.g=i,this.b=r,this.a=n}};mI.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(mI||(mI={}));const mt=mI;function xRt(t){}function C8e(t){return()=>t}function Bt(t,e={}){const i=t instanceof br?t:new br(t,e),r={type:e?.ignoreUnknown??1?i.apiValues:String,json:{type:i.jsonValues,read:!e?.readOnly&&{reader:i.read},write:{writer:i.write}}};return e?.readOnly!==void 0&&(r.readOnly=!!e.readOnly),e?.default!==void 0&&(r.json.default=e.default),e?.name!==void 0&&(r.json.name=e.name),e?.nonNullable!==void 0&&(r.nonNullable=e.nonNullable),T(r)}var nB;let gI=nB=class extends Ne{constructor(t){super(t),this.type="none"}clone(){return new nB({type:this.type})}};_([Bt({none:"none",stayAbove:"stay-above"})],gI.prototype,"type",void 0),gI=nB=_([Z("esri.ground.NavigationConstraint")],gI);function XO(t){const e=pJ(100*(1-t));return Math.max(0,Math.min(e,100))}function hS(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var sB;let vm=sB=class extends jO(Ip){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Dt;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&Ee.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{qn(t)||Ee.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)ct(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",xg(t,this._get("layers")))}writeLayers(t,e,i,r){const n=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(s=>{if("write"in s){const a={};C8e(s)().write(a,r)&&n.push(a)}else r?.messages&&r.messages.push(new de("layer:unsupported",`Layers (${s.title}, ${s.id}) of type '${s.declaredClass}' cannot be persisted in the ground`,{layer:s}))})),e.layers=n}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return $J(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e?.signal});const{ElevationQuery:i}=await ke(()=>import("./ElevationQuery-ed44ef61.js"),[],import.meta.url);oi(e);const r=new i,n=this.layers.filter(yie).toArray();return r.queryAll(n,t,e)}async createElevationSampler(t,e){await this.load({signal:e?.signal});const{ElevationQuery:i}=await ke(()=>import("./ElevationQuery-ed44ef61.js"),[],import.meta.url);oi(e);const r=new i,n=this.layers.filter(yie).toArray();return r.createSamplerAll(n,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:Ce(this.surfaceColor),navigationConstraint:Ce(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new sB({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,i){const r=e?.origin||"web-scene",n=e?.portal||null,s=e?.url||null,{populateOperationalLayers:a}=await ke(()=>import("./layersCreator-38f71b2f.js"),["./layersCreator-38f71b2f.js","./portalLayers-7555fcdb.js","./associatedFeatureServiceUtils-c90a3355.js","./requestPresets-5652178e.js"],import.meta.url);oi(i);const u=[];if(t.layers&&Array.isArray(t.layers)){const p={context:{origin:r,url:s,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};u.push(a(this.layers,t.layers,p))}await Promise.allSettled(u)}};function A8e(t){return t&&"createElevationSampler"in t}function yie(t){return t.type==="elevation"||A8e(t)}_([T({json:{read:!1}})],vm.prototype,"layers",null),_([ot("layers")],vm.prototype,"writeLayers",null),_([T({readOnly:!0})],vm.prototype,"resourceInfo",void 0),_([T({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Wr,read:{reader:hS,source:"transparency"},write:{writer:(t,e)=>{e.transparency=XO(t)},target:"transparency"}}})],vm.prototype,"opacity",void 0),_([T({type:mt,json:{type:[Wr],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],vm.prototype,"surfaceColor",void 0),_([T({type:gI,json:{write:!0}})],vm.prototype,"navigationConstraint",void 0),vm=sB=_([Z("esri.Ground")],vm);const N4=vm;let nx=class extends Dt{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(N0e(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let i=0;for(const r of e)r!=null&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(e){return new Dt(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction??(n=>!!n);for(const n of i)if(n){if(r(n)){const s=this.indexOf(n,e);s>=0?s!==e&&this.reorder(n,e):this.add(n,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(n);if(Array.isArray(s))for(const a of s)e=this._processCollection(e,a);else e=this._processCollection(e,s)}}return e}};_([T()],nx.prototype,"getCollections",void 0),_([T()],nx.prototype,"getChildrenFunction",void 0),_([T()],nx.prototype,"itemFilterFunction",void 0),nx=_([Z("esri.core.CollectionFlattener")],nx);const F4=nx,O8e=[["binary","application/octet-stream","bin",""]];function SRt(t,e){return Ege(e.name,t?.supportedFormats??[])!=null}function ERt(t,e){if(!t)return!1;const i=R8e(e,t.supportedFormats??[]);return i!=null&&t.editFormats.includes(i)}function Tge(t,e){return eY(P8e(t,e))}function Sge(t,e){return eY(Ege(t,e))}function CRt(t,e){return Cge(M8e(t,e))}function R8e(t,e){return Sge(t.name,e)??Tge(t.type,e)}function QJ(t){return[...O8e,...t]}function M8e(t,e){return QJ(e).find(i=>eY(i)===t)}function P8e(t,e){const i=t.toLowerCase();return QJ(e).find(r=>Cge(r)===i)}function Ege(t,e){const i=t.toLowerCase();return QJ(e).find(r=>I8e(r).some(n=>i.endsWith(n)))}function eY(t){return t?.[0]}function Cge(t){return t?.[1].toLowerCase()}function I8e(t){return t?.[2].split(",").map(e=>e.toLowerCase())??[]}function ARt(t){return t.tables?.find(e=>e.role==="assetMaps")}function $8e(t){return!(!(t&&typeof t=="object"&&"loaded"in t&&t.loaded&&SLe(t)?.operations?.supportsEditing&&"type"in t)||"editingEnabled"in t&&!CLe(t)||t.type==="scene"&&!L8e(t))}function L8e(t){const{associatedLayer:e}=t,i=e?.infoFor3D;if(!i)return!0;const{supportedFormats:r,queryFormats:n}=i,s=Tge("model/gltf-binary",r)??Sge("glb",r);if(!(s!=null&&n.includes(s)))return Ee.getLogger("esri.layers.support.editableLayers").warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) is not editable because it does not support GLB queries.`),!1;const a=t.spatialReference,u=e.spatialReference;if(!Wn(a,u))return Ee.getLogger("esri.layers.support.editableLayers").warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) is not editable because its spatial reference (wkid:${a.wkid}) is different from its associated FeatureLayer's spatial reference (wkid:${u.wkid}).`),!1;const p=e.sourceJSON.sourceSpatialReference;return!(p!=null&&!Wn(p,u))||(Ee.getLogger("esri.layers.support.editableLayers").warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) is not editable because the spatial reference of its associated FeatureLayer's service (wkid:${u.wkid}) is different from its source spatial reference (wkid:${p.wkid}).`),!1)}const D8e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,N8e="screenUtils.toPt: input not recognized!",Age=96;function Xo(t){return t?t/72*Age:0}function ed(t){return t?72*t/Age:0}function Br(t){if(typeof t=="string"){const e=t.match(D8e);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),n=t.charAt(0)==="-",s=r==="px"?ed(i):i;return n?-s:s}return console.warn(N8e),null}return t}function td(t=0,e=0){return{x:t,y:e}}function Dn(t=0,e=0){return[t,e]}function Oge(t=0,e=0){return[t,e]}function fa(t=0,e=0,i=0){return[t,e,i]}function ORt(t){return t}function RRt(t){return t}function MRt(t){return t}function pp(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function ND(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function F8e(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function k8e(t,e,i,r,n,s,a,u,p,y,b,S,C,O,P,$){const N=new Float32Array(16);return N[0]=t,N[1]=e,N[2]=i,N[3]=r,N[4]=n,N[5]=s,N[6]=a,N[7]=u,N[8]=p,N[9]=y,N[10]=b,N[11]=S,N[12]=C,N[13]=O,N[14]=P,N[15]=$,N}function z8e(t,e){return new Float32Array(t,e,16)}const U8e=ND();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:U8e,clone:F8e,create:ND,createView:z8e,fromValues:k8e},Symbol.toStringTag,{value:"Module"}));function bs(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function N0(t,e,i,r,n,s,a,u,p,y,b,S,C,O,P,$,N){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=a,t[6]=u,t[7]=p,t[8]=y,t[9]=b,t[10]=S,t[11]=C,t[12]=O,t[13]=P,t[14]=$,t[15]=N,t}function id(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Hc(t,e){if(t===e){const i=e[1],r=e[2],n=e[3],s=e[6],a=e[7],u=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=n,t[13]=a,t[14]=u}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function cE(t,e){return Ps(t,e)||id(t),t}function Ps(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],u=e[5],p=e[6],y=e[7],b=e[8],S=e[9],C=e[10],O=e[11],P=e[12],$=e[13],N=e[14],z=e[15],U=i*u-r*a,j=i*p-n*a,G=i*y-s*a,q=r*p-n*u,W=r*y-s*u,K=n*y-s*p,se=b*$-S*P,ae=b*N-C*P,le=b*z-O*P,me=S*N-C*$,ne=S*z-O*$,pe=C*z-O*N;let ge=U*pe-j*ne+G*me+q*le-W*ae+K*se;return ge?(ge=1/ge,t[0]=(u*pe-p*ne+y*me)*ge,t[1]=(n*ne-r*pe-s*me)*ge,t[2]=($*K-N*W+z*q)*ge,t[3]=(C*W-S*K-O*q)*ge,t[4]=(p*le-a*pe-y*ae)*ge,t[5]=(i*pe-n*le+s*ae)*ge,t[6]=(N*G-P*K-z*j)*ge,t[7]=(b*K-C*G+O*j)*ge,t[8]=(a*ne-u*le+y*se)*ge,t[9]=(r*le-i*ne-s*se)*ge,t[10]=(P*W-$*G+z*U)*ge,t[11]=(S*G-b*W-O*U)*ge,t[12]=(u*ae-a*me-p*se)*ge,t[13]=(i*me-r*ae+n*se)*ge,t[14]=($*j-P*q-N*U)*ge,t[15]=(b*q-S*j+C*U)*ge,t):null}function j8e(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],u=e[5],p=e[6],y=e[7],b=e[8],S=e[9],C=e[10],O=e[11],P=e[12],$=e[13],N=e[14],z=e[15];return t[0]=u*(C*z-O*N)-S*(p*z-y*N)+$*(p*O-y*C),t[1]=-(r*(C*z-O*N)-S*(n*z-s*N)+$*(n*O-s*C)),t[2]=r*(p*z-y*N)-u*(n*z-s*N)+$*(n*y-s*p),t[3]=-(r*(p*O-y*C)-u*(n*O-s*C)+S*(n*y-s*p)),t[4]=-(a*(C*z-O*N)-b*(p*z-y*N)+P*(p*O-y*C)),t[5]=i*(C*z-O*N)-b*(n*z-s*N)+P*(n*O-s*C),t[6]=-(i*(p*z-y*N)-a*(n*z-s*N)+P*(n*y-s*p)),t[7]=i*(p*O-y*C)-a*(n*O-s*C)+b*(n*y-s*p),t[8]=a*(S*z-O*$)-b*(u*z-y*$)+P*(u*O-y*S),t[9]=-(i*(S*z-O*$)-b*(r*z-s*$)+P*(r*O-s*S)),t[10]=i*(u*z-y*$)-a*(r*z-s*$)+P*(r*y-s*u),t[11]=-(i*(u*O-y*S)-a*(r*O-s*S)+b*(r*y-s*u)),t[12]=-(a*(S*N-C*$)-b*(u*N-p*$)+P*(u*C-p*S)),t[13]=i*(S*N-C*$)-b*(r*N-n*$)+P*(r*C-n*S),t[14]=-(i*(u*N-p*$)-a*(r*N-n*$)+P*(r*p-n*u)),t[15]=i*(u*C-p*S)-a*(r*C-n*S)+b*(r*p-n*u),t}function B8e(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],a=t[5],u=t[6],p=t[7],y=t[8],b=t[9],S=t[10],C=t[11],O=t[12],P=t[13],$=t[14],N=t[15];return(e*a-i*s)*(S*N-C*$)-(e*u-r*s)*(b*N-C*P)+(e*p-n*s)*(b*$-S*P)+(i*u-r*a)*(y*N-C*O)-(i*p-n*a)*(y*$-S*O)+(r*p-n*u)*(y*P-b*O)}function Rr(t,e,i){const r=e[0],n=e[1],s=e[2],a=e[3],u=e[4],p=e[5],y=e[6],b=e[7],S=e[8],C=e[9],O=e[10],P=e[11],$=e[12],N=e[13],z=e[14],U=e[15];let j=i[0],G=i[1],q=i[2],W=i[3];return t[0]=j*r+G*u+q*S+W*$,t[1]=j*n+G*p+q*C+W*N,t[2]=j*s+G*y+q*O+W*z,t[3]=j*a+G*b+q*P+W*U,j=i[4],G=i[5],q=i[6],W=i[7],t[4]=j*r+G*u+q*S+W*$,t[5]=j*n+G*p+q*C+W*N,t[6]=j*s+G*y+q*O+W*z,t[7]=j*a+G*b+q*P+W*U,j=i[8],G=i[9],q=i[10],W=i[11],t[8]=j*r+G*u+q*S+W*$,t[9]=j*n+G*p+q*C+W*N,t[10]=j*s+G*y+q*O+W*z,t[11]=j*a+G*b+q*P+W*U,j=i[12],G=i[13],q=i[14],W=i[15],t[12]=j*r+G*u+q*S+W*$,t[13]=j*n+G*p+q*C+W*N,t[14]=j*s+G*y+q*O+W*z,t[15]=j*a+G*b+q*P+W*U,t}function ec(t,e,i){const r=i[0],n=i[1],s=i[2];if(e===t)t[12]=e[0]*r+e[4]*n+e[8]*s+e[12],t[13]=e[1]*r+e[5]*n+e[9]*s+e[13],t[14]=e[2]*r+e[6]*n+e[10]*s+e[14],t[15]=e[3]*r+e[7]*n+e[11]*s+e[15];else{const a=e[0],u=e[1],p=e[2],y=e[3],b=e[4],S=e[5],C=e[6],O=e[7],P=e[8],$=e[9],N=e[10],z=e[11];t[0]=a,t[1]=u,t[2]=p,t[3]=y,t[4]=b,t[5]=S,t[6]=C,t[7]=O,t[8]=P,t[9]=$,t[10]=N,t[11]=z,t[12]=a*r+b*n+P*s+e[12],t[13]=u*r+S*n+$*s+e[13],t[14]=p*r+C*n+N*s+e[14],t[15]=y*r+O*n+z*s+e[15]}return t}function JO(t,e,i){const r=i[0],n=i[1],s=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Dc(t,e,i,r){let n,s,a,u,p,y,b,S,C,O,P,$,N,z,U,j,G,q,W,K,se,ae,le,me,ne=r[0],pe=r[1],ge=r[2],ve=Math.sqrt(ne*ne+pe*pe+ge*ge);return ve<Ko()?null:(ve=1/ve,ne*=ve,pe*=ve,ge*=ve,n=Math.sin(i),s=Math.cos(i),a=1-s,u=e[0],p=e[1],y=e[2],b=e[3],S=e[4],C=e[5],O=e[6],P=e[7],$=e[8],N=e[9],z=e[10],U=e[11],j=ne*ne*a+s,G=pe*ne*a+ge*n,q=ge*ne*a-pe*n,W=ne*pe*a-ge*n,K=pe*pe*a+s,se=ge*pe*a+ne*n,ae=ne*ge*a+pe*n,le=pe*ge*a-ne*n,me=ge*ge*a+s,t[0]=u*j+S*G+$*q,t[1]=p*j+C*G+N*q,t[2]=y*j+O*G+z*q,t[3]=b*j+P*G+U*q,t[4]=u*W+S*K+$*se,t[5]=p*W+C*K+N*se,t[6]=y*W+O*K+z*se,t[7]=b*W+P*K+U*se,t[8]=u*ae+S*le+$*me,t[9]=p*ae+C*le+N*me,t[10]=y*ae+O*le+z*me,t[11]=b*ae+P*le+U*me,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function dS(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[4],a=e[5],u=e[6],p=e[7],y=e[8],b=e[9],S=e[10],C=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+y*r,t[5]=a*n+b*r,t[6]=u*n+S*r,t[7]=p*n+C*r,t[8]=y*n-s*r,t[9]=b*n-a*r,t[10]=S*n-u*r,t[11]=C*n-p*r,t}function FD(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[0],a=e[1],u=e[2],p=e[3],y=e[8],b=e[9],S=e[10],C=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-y*r,t[1]=a*n-b*r,t[2]=u*n-S*r,t[3]=p*n-C*r,t[8]=s*r+y*n,t[9]=a*r+b*n,t[10]=u*r+S*n,t[11]=p*r+C*n,t}function pS(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[0],a=e[1],u=e[2],p=e[3],y=e[4],b=e[5],S=e[6],C=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+y*r,t[1]=a*n+b*r,t[2]=u*n+S*r,t[3]=p*n+C*r,t[4]=y*n-s*r,t[5]=b*n-a*r,t[6]=S*n-u*r,t[7]=C*n-p*r,t}function YO(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function V8e(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Zu(t,e,i){if(e===0)return id(t);let r,n,s,a=i[0],u=i[1],p=i[2],y=Math.sqrt(a*a+u*u+p*p);return y<Ko()?null:(y=1/y,a*=y,u*=y,p*=y,r=Math.sin(e),n=Math.cos(e),s=1-n,t[0]=a*a*s+n,t[1]=u*a*s+p*r,t[2]=p*a*s-u*r,t[3]=0,t[4]=a*u*s-p*r,t[5]=u*u*s+n,t[6]=p*u*s+a*r,t[7]=0,t[8]=a*p*s+u*r,t[9]=u*p*s-a*r,t[10]=p*p*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Rge(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function G8e(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Mge(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Pge(t,e,i){const r=e[0],n=e[1],s=e[2],a=e[3],u=r+r,p=n+n,y=s+s,b=r*u,S=r*p,C=r*y,O=n*p,P=n*y,$=s*y,N=a*u,z=a*p,U=a*y;return t[0]=1-(O+$),t[1]=S+U,t[2]=C-z,t[3]=0,t[4]=S-U,t[5]=1-(b+$),t[6]=P+N,t[7]=0,t[8]=C+z,t[9]=P-N,t[10]=1-(b+O),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function H8e(t,e){const i=q8e,r=-e[0],n=-e[1],s=-e[2],a=e[3],u=e[4],p=e[5],y=e[6],b=e[7],S=r*r+n*n+s*s+a*a;return S>0?(i[0]=2*(u*a+b*r+p*s-y*n)/S,i[1]=2*(p*a+b*n+y*r-u*s)/S,i[2]=2*(y*a+b*s+u*n-p*r)/S):(i[0]=2*(u*a+b*r+p*s-y*n),i[1]=2*(p*a+b*n+y*r-u*s),i[2]=2*(y*a+b*s+u*n-p*r)),Pge(t,e,i),t}const q8e=H();function nL(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Ige(t,e){const i=e[0],r=e[1],n=e[2],s=e[4],a=e[5],u=e[6],p=e[8],y=e[9],b=e[10];return t[0]=Math.sqrt(i*i+r*r+n*n),t[1]=Math.sqrt(s*s+a*a+u*u),t[2]=Math.sqrt(p*p+y*y+b*b),t}function W8e(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function $ge(t,e,i,r){const n=e[0],s=e[1],a=e[2],u=e[3],p=n+n,y=s+s,b=a+a,S=n*p,C=n*y,O=n*b,P=s*y,$=s*b,N=a*b,z=u*p,U=u*y,j=u*b,G=r[0],q=r[1],W=r[2];return t[0]=(1-(P+N))*G,t[1]=(C+j)*G,t[2]=(O-U)*G,t[3]=0,t[4]=(C-j)*q,t[5]=(1-(S+N))*q,t[6]=($+z)*q,t[7]=0,t[8]=(O+U)*W,t[9]=($-z)*W,t[10]=(1-(S+P))*W,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function X8e(t,e,i,r,n){const s=e[0],a=e[1],u=e[2],p=e[3],y=s+s,b=a+a,S=u+u,C=s*y,O=s*b,P=s*S,$=a*b,N=a*S,z=u*S,U=p*y,j=p*b,G=p*S,q=r[0],W=r[1],K=r[2],se=n[0],ae=n[1],le=n[2],me=(1-($+z))*q,ne=(O+G)*q,pe=(P-j)*q,ge=(O-G)*W,ve=(1-(C+z))*W,Se=(N+U)*W,ee=(P+j)*K,re=(N-U)*K,fe=(1-(C+$))*K;return t[0]=me,t[1]=ne,t[2]=pe,t[3]=0,t[4]=ge,t[5]=ve,t[6]=Se,t[7]=0,t[8]=ee,t[9]=re,t[10]=fe,t[11]=0,t[12]=i[0]+se-(me*se+ge*ae+ee*le),t[13]=i[1]+ae-(ne*se+ve*ae+re*le),t[14]=i[2]+le-(pe*se+Se*ae+fe*le),t[15]=1,t}function J8e(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],a=i+i,u=r+r,p=n+n,y=i*a,b=r*a,S=r*u,C=n*a,O=n*u,P=n*p,$=s*a,N=s*u,z=s*p;return t[0]=1-S-P,t[1]=b+z,t[2]=C-N,t[3]=0,t[4]=b-z,t[5]=1-y-P,t[6]=O+$,t[7]=0,t[8]=C+N,t[9]=O-$,t[10]=1-y-S,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Lge(t,e,i,r,n,s,a){const u=1/(i-e),p=1/(n-r),y=1/(s-a);return t[0]=2*s*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*p,t[6]=0,t[7]=0,t[8]=(i+e)*u,t[9]=(n+r)*p,t[10]=(a+s)*y,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*s*2*y,t[15]=0,t}function Y8e(t,e,i,r,n){const s=1/Math.tan(e/2);let a;return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(a=1/(r-n),t[10]=(n+r)*a,t[14]=2*n*r*a):(t[10]=-1,t[14]=-2*r),t}function Z8e(t,e,i,r){const n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),u=Math.tan(e.rightDegrees*Math.PI/180),p=2/(a+u),y=2/(n+s);return t[0]=p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=y,t[6]=0,t[7]=0,t[8]=-(a-u)*p*.5,t[9]=(n-s)*y*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function Dge(t,e,i,r,n,s,a){const u=1/(e-i),p=1/(r-n),y=1/(s-a);return t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*y,t[11]=0,t[12]=(e+i)*u,t[13]=(n+r)*p,t[14]=(a+s)*y,t[15]=1,t}function kD(t,e,i,r){const n=e[0],s=e[1],a=e[2];let u=n-i[0],p=s-i[1],y=a-i[2];const b=Ko();if(Math.abs(u)<b&&Math.abs(p)<b&&Math.abs(y)<b)return void id(t);let S=1/Math.sqrt(u*u+p*p+y*y);u*=S,p*=S,y*=S;const C=r[0],O=r[1],P=r[2];let $=O*y-P*p,N=P*u-C*y,z=C*p-O*u;S=Math.sqrt($*$+N*N+z*z),S?(S=1/S,$*=S,N*=S,z*=S):($=0,N=0,z=0);let U=p*z-y*N,j=y*$-u*z,G=u*N-p*$;S=Math.sqrt(U*U+j*j+G*G),S?(S=1/S,U*=S,j*=S,G*=S):(U=0,j=0,G=0),t[0]=$,t[1]=U,t[2]=u,t[3]=0,t[4]=N,t[5]=j,t[6]=p,t[7]=0,t[8]=z,t[9]=G,t[10]=y,t[11]=0,t[12]=-($*n+N*s+z*a),t[13]=-(U*n+j*s+G*a),t[14]=-(u*n+p*s+y*a),t[15]=1}function Nge(t,e,i,r){const n=e[0],s=e[1],a=e[2],u=r[0],p=r[1],y=r[2];let b=n-i[0],S=s-i[1],C=a-i[2],O=b*b+S*S+C*C;O>0&&(O=1/Math.sqrt(O),b*=O,S*=O,C*=O);let P=p*C-y*S,$=y*b-u*C,N=u*S-p*b;return O=P*P+$*$+N*N,O>0&&(O=1/Math.sqrt(O),P*=O,$*=O,N*=O),t[0]=P,t[1]=$,t[2]=N,t[3]=0,t[4]=S*N-C*$,t[5]=C*P-b*N,t[6]=b*$-S*P,t[7]=0,t[8]=b,t[9]=S,t[10]=C,t[11]=0,t[12]=n,t[13]=s,t[14]=a,t[15]=1,t}function K8e(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Q8e(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function eDe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function Fge(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function tDe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function iDe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function tY(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function zD(t,e){if(t===e)return!0;const i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],u=t[5],p=t[6],y=t[7],b=t[8],S=t[9],C=t[10],O=t[11],P=t[12],$=t[13],N=t[14],z=t[15],U=e[0],j=e[1],G=e[2],q=e[3],W=e[4],K=e[5],se=e[6],ae=e[7],le=e[8],me=e[9],ne=e[10],pe=e[11],ge=e[12],ve=e[13],Se=e[14],ee=e[15],re=Ko();return Math.abs(i-U)<=re*Math.max(1,Math.abs(i),Math.abs(U))&&Math.abs(r-j)<=re*Math.max(1,Math.abs(r),Math.abs(j))&&Math.abs(n-G)<=re*Math.max(1,Math.abs(n),Math.abs(G))&&Math.abs(s-q)<=re*Math.max(1,Math.abs(s),Math.abs(q))&&Math.abs(a-W)<=re*Math.max(1,Math.abs(a),Math.abs(W))&&Math.abs(u-K)<=re*Math.max(1,Math.abs(u),Math.abs(K))&&Math.abs(p-se)<=re*Math.max(1,Math.abs(p),Math.abs(se))&&Math.abs(y-ae)<=re*Math.max(1,Math.abs(y),Math.abs(ae))&&Math.abs(b-le)<=re*Math.max(1,Math.abs(b),Math.abs(le))&&Math.abs(S-me)<=re*Math.max(1,Math.abs(S),Math.abs(me))&&Math.abs(C-ne)<=re*Math.max(1,Math.abs(C),Math.abs(ne))&&Math.abs(O-pe)<=re*Math.max(1,Math.abs(O),Math.abs(pe))&&Math.abs(P-ge)<=re*Math.max(1,Math.abs(P),Math.abs(ge))&&Math.abs($-ve)<=re*Math.max(1,Math.abs($),Math.abs(ve))&&Math.abs(N-Se)<=re*Math.max(1,Math.abs(N),Math.abs(Se))&&Math.abs(z-ee)<=re*Math.max(1,Math.abs(z),Math.abs(ee))}function iY(t){const e=Ko(),i=t[0],r=t[1],n=t[2],s=t[4],a=t[5],u=t[6],p=t[8],y=t[9],b=t[10];return Math.abs(1-(i*i+s*s+p*p))<=e&&Math.abs(1-(r*r+a*a+y*y))<=e&&Math.abs(1-(n*n+u*u+b*b))<=e}function UD(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const rDe=Rr,nDe=Fge;Object.freeze(Object.defineProperty({__proto__:null,add:eDe,adjoint:j8e,copy:bs,determinant:B8e,equals:zD,exactEquals:tY,frob:Q8e,fromQuat:J8e,fromQuat2:H8e,fromRotation:Zu,fromRotationTranslation:Pge,fromRotationTranslationScale:$ge,fromRotationTranslationScaleOrigin:X8e,fromScaling:V8e,fromTranslation:YO,fromXRotation:Rge,fromYRotation:G8e,fromZRotation:Mge,frustum:Lge,getRotation:W8e,getScaling:Ige,getTranslation:nL,hasIdentityRotation:UD,identity:id,invert:Ps,invertOrIdentity:cE,isOrthoNormal:iY,lookAt:kD,mul:rDe,multiply:Rr,multiplyScalar:tDe,multiplyScalarAndAdd:iDe,ortho:Dge,perspective:Y8e,perspectiveFromFieldOfView:Z8e,rotate:Dc,rotateX:dS,rotateY:FD,rotateZ:pS,scale:JO,set:N0,str:K8e,sub:nDe,subtract:Fge,targetTo:Nge,translate:ec,transpose:Hc},Symbol.toStringTag,{value:"Module"}));const sDe=(t,e)=>{const i=N0(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Hc(i,i)},oDe=(t,e)=>{const i=N0(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Hc(i,i)},aDe=(t,e)=>{const i=1-e,r=N0(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Hc(r,r)},lDe=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),n=N0(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Hc(n,n)},cDe=(t,e)=>{const i=1-2*e,r=N0(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return Hc(r,r)},uDe=(t,e)=>{const i=N0(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Hc(i,i)},hDe=(t,e)=>{const i=1-e,r=N0(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Hc(r,r)};let kge=class zge{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=Ac(e.strength,i.strength,r),this.radius=Ac(e.radius,i.radius,r),this.threshold=Ac(e.threshold,i.threshold,r)}clone(){return new zge(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:PA(this.radius),strength:this.strength,threshold:this.threshold}}},Uge=class jge{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(Ac(e.radius,i.radius,r))}clone(){return new jge(this.radius)}toJSON(){return{type:"blur",radius:PA(this.radius)}}},oB=class Bge{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=Ac(e.amount,i.amount,r),this._updateMatrix()}clone(){return new Bge(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||ND();switch(this.type){case"brightness":this._colorMatrix=sDe(e,this.amount);break;case"contrast":this._colorMatrix=oDe(e,this.amount);break;case"grayscale":this._colorMatrix=aDe(e,this.amount);break;case"invert":this._colorMatrix=cDe(e,this.amount);break;case"saturate":this._colorMatrix=uDe(e,this.amount);break;case"sepia":this._colorMatrix=hDe(e,this.amount)}}},Vge=class Gge{constructor(e,i,r,n){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=n,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=Ac(e.offsetX,i.offsetX,r),this.offsetY=Ac(e.offsetY,i.offsetY,r),this.blurRadius=Ac(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(Ac(e.color[0],i.color[0],r)),this.color[1]=Math.round(Ac(e.color[1],i.color[1],r)),this.color[2]=Math.round(Ac(e.color[2],i.color[2],r)),this.color[3]=Ac(e.color[3],i.color[3],r)}clone(){return new Gge(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:PA(this.offsetX),yoffset:PA(this.offsetY),blurRadius:PA(this.blurRadius),color:e}}},Hge=class qge{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=Ac(e.angle,i.angle,r),this._updateMatrix()}clone(){return new qge(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||ND();this._colorMatrix=lDe(e,this.angle)}},Wge=class Xge{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=Ac(e.amount,i.amount,r)}clone(){return new Xge(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function Ac(t,e,i){return t+(e-t)*i}function PA(t){return Math.round(1e3*ed(t))/1e3}function dDe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new oB(t.type,0);case"saturate":case"brightness":case"contrast":return new oB(t.type,1);case"opacity":return new Wge(1);case"hue-rotate":return new Hge(0);case"blur":return new Uge(0);case"drop-shadow":return new Vge(0,0,0,[...qJ("transparent")]);case"bloom":return new kge(0,0,1)}}function pDe(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,n)=>r.type===i[n].type)}function fDe(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let n=r.length;n<i.length;n++)r.push(dDe(i[n]))}function mDe(t){const e=t[0];return!!e&&"type"in e}function gDe(t,e){return JSON.stringify(t??null)===JSON.stringify(e??null)}const vie=Ee.getLogger("esri.support.basemapUtils");function yDe(){return{}}function vDe(t){for(const e in t){const i=t[e];ct(i),delete t[e]}}function rY(t,e){let i;if(typeof t=="string"){const r=t in Qj,n=!r&&t.includes("/");if(!r&&!n){const s=Object.entries(Qj).filter(([a,u])=>vr.apiKey&&!u.classic||!vr.apiKey&&(u.classic||u.is3d)).map(([a])=>`"${a}"`).sort().join(", ");return vie.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${s}`),null}e&&(i=e[t]),i||(i=r?PT.fromId(t):new PT({style:{id:t}}),e&&(e[t]=i))}else i=os(PT,t);return i?.destroyed&&(vie.warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function PRt(t,e){return t.basemap?.referenceLayers?.some(i=>i.uid===e)||t.basemap?.baseLayers?.some(i=>i.uid===e)}function _De(t,e=null){const i=rY(t);if(!i)return null;const r=i.clone();return e&&(r.baseLayers=_ie(r.baseLayers,e.baseLayers),r.referenceLayers=_ie(r.referenceLayers,e.referenceLayers)),r}function _ie(t,e){const i=new Dt;return t.forEach(r=>{const n=e.find(s=>s.type!=="scene"&&xDe(xie(r),xie(s)))||r;i.includes(n)?i.push(r):i.push(n)}),i}function bie(t){return!!t?.baseLayers.concat(t.referenceLayers).some(bDe)}function bDe(t){if(wie(t.url))return!0;if(t.type==="vector-tile")for(const e in t.sourceNameToSource){const i=t.sourceNameToSource[e];if(wie(i?.sourceUrl))return!0}return!1}const wDe=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function wie(t){if(!t)return!1;const e=new Pc(fl(t));return!!e.authority&&wDe.test(e.authority)}function xie(t){return{type:t.type,effect:"effect"in t?t.effect:void 0,url:TDe("urlTemplate"in t&&t.urlTemplate||t.url||"styleUrl"in t&&t.styleUrl||""),minScale:"minScale"in t&&t.minScale!=null?t.minScale:0,maxScale:"maxScale"in t&&t.maxScale!=null?t.maxScale:0,opacity:t.opacity!=null?t.opacity:1,visible:t.visible==null||!!t.visible,sublayers:t.type!=="map-image"&&t.type!=="wms"||t.sublayers==null?void 0:t.sublayers?.map(e=>({id:e.id,visible:e.visible})),activeLayerId:t.type==="wmts"?t.activeLayer?.id:void 0}}function xDe(t,e){if(t.type!==e.type||t.url!==e.url||t.minScale!==e.minScale||t.maxScale!==e.maxScale||t.visible!==e.visible||t.opacity!==e.opacity||!gDe(t.effect,e.effect))return!1;if(t.activeLayerId!=null||e.activeLayerId!=null)return t.activeLayerId===e.activeLayerId;if(t.sublayers!=null||e.sublayers!=null){if(t.sublayers==null||e.sublayers==null||t.sublayers.length!==e.sublayers.length)return!1;for(let i=0;i<t.sublayers.length;i++){const r=t.sublayers.at(i),n=e.sublayers.at(i);if(r?.id!==n?.id||r?.visible!==n?.visible)return!1}}return!0}function TDe(t){return t?Uu(t).replace(/^\s*https?:/i,"").toLowerCase():""}function SDe(t){return new F4({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}function lF(t){for(const e of t.values())e?.destroy();t.clear()}const Tie={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function EDe(t){let e=null;if(typeof t=="string")if(t in Tie){const i=Tie[t];e=new N4({resourceInfo:{data:{layers:[i]}}})}else Ee.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=os(N4,t);return e}function fS(t,e,i=!1){let{hasM:r,hasZ:n}=t;Array.isArray(e)?e.length!==4||r||n?e.length===3&&i&&!r?(n=!0,r=!1):e.length===3&&r&&n&&(r=!1,n=!1):(r=!0,n=!0):(n=!n&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!n||e.hasZ)),t.hasZ=n,t.hasM=r}var aB;function Sie(t){return(e,i)=>e==null?i:i==null?e:t(e,i)}function CDe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let z1=aB=class extends Iv{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const i={};Array.isArray(t)?(i.points=t,i.spatialReference=e):CDe(t)?i.spatialReference=t:(t.points&&(i.points=t.points),t.spatialReference&&(i.spatialReference=t.spatialReference),t.hasZ&&(i.hasZ=t.hasZ),t.hasM&&(i.hasM=t.hasM));const r=i.points?.[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new rr,i=this.hasZ,r=this.hasM,n=i?3:2,s=t[0],a=Sie(Math.min),u=Sie(Math.max);let p,y,b,S,[C,O]=s,[P,$]=s;for(let N=0,z=t.length;N<z;N++){const U=t[N],[j,G]=U;if(C=a(C,j),O=a(O,G),P=u(P,j),$=u($,G),i&&U.length>2){const q=U[2];p=a(p,q),b=u(b,q)}if(r&&U.length>n){const q=U[n];y=a(y,q),S=u(S,q)}}return e.xmin=C,e.ymin=O,e.xmax=P,e.ymax=$,e.spatialReference=this.spatialReference,i?(e.zmin=p,e.zmax=b):(e.zmin=void 0,e.zmax=void 0),r?(e.mmin=y,e.mmax=S):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=Ce(this.points)}addPoint(t){return fS(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:Ce(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new aB(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new Wt(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new Wt(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(fS(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};_([T({readOnly:!0})],z1.prototype,"cache",null),_([T()],z1.prototype,"extent",null),_([T({type:[[Number]],json:{write:{isRequired:!0}}})],z1.prototype,"points",void 0),_([ot("points")],z1.prototype,"writePoints",null),z1=aB=_([Z("esri.geometry.Multipoint")],z1),z1.prototype.toJSON.isDefaultToJSON=!0;const vw=z1;function IRt(t){const e=[];for(t.reset();t.nextPath();){const i=[];for(;t.nextPoint();)i.push([t.x,t.y]);e.push(i)}return t.reset(),e}function ADe(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}var $n;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})($n||($n={}));function jD(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const n=t[2]-e[2];return Math.sqrt(i*i+r*r+n*n)}return Math.sqrt(i*i+r*r)}function Jge(t,e,i){const r=t[0]+i*(e[0]-t[0]),n=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,n,t[2]+i*(e[2]-t[2])]:[r,n]}function $Rt(t,e,i,r){const[n,s]=e,[a,u]=i,[p,y]=r,b=p-a,S=y-u,C=b*b+S*S,O=(n-a)*b+(s-u)*S,P=Math.min(1,Math.max(0,O/C));return t[0]=a+b*P,t[1]=u+S*P,t}function Yge(t,e){return Jge(t,e,.5)}function Zge(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=jD(t[r],t[r+1]);return i}function Kge(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let n=0;n<i-1;++n){const s=jD(t[n],t[n+1]);if(e-r<s){const a=(e-r)/s;return Jge(t[n],t[n+1],a)}r+=s}return t[i-1]}function yI(t,e=$n.X,i=$n.Y){let r=0;const n=t.length;let s=t[0];for(let a=0;a<n-1;a++){const u=t[a+1];r+=(u[e]-s[e])*(u[i]+s[i]),s=u}return r>=0}function ODe(t){const e=t.length;return e>2&&bg(t[0],t[e-1])}function LRt(t){if("rings"in t)for(const e of t.rings)ODe(e)||e.push(e[0].slice())}function DRt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function RDe(t){return t?Qge(t.rings,t.hasZ??!1):null}function Qge(t,e){if(!t?.length)return null;const i=[],r=[],n=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let s=0,a=t.length;s<a;s++){const u=e1e(t[s],e,n);u&&r.push(u)}if(r.sort((s,a)=>{let u=s[2]-a[2];return u===0&&e&&(u=s[4]-a[4]),u}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||e&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){const s=t[0]&&t[0].length?MDe(t[0],e):null;if(!s)return null;i[0]=s[0],i[1]=s[1],e&&s.length>2&&(i[2]=s[2])}return i}function e1e(t,e,i){let r=0,n=0,s=0,a=0,u=0;const p=t.length?t[0][0]:0,y=t.length?t[0][1]:0,b=t.length&&e?t[0][2]:0;for(let C=0;C<t.length;C++){const O=t[C],P=t[(C+1)%t.length],[$,N,z]=O,U=$-p,j=N-y,[G,q,W]=P,K=G-p,se=q-y,ae=U*se-K*j;if(a+=ae,r+=(U+K)*ae,n+=(j+se)*ae,e&&O.length>2&&P.length>2){const le=z-b,me=W-b,ne=U*me-K*le;s+=(le+me)*ne,u+=ne}$<i[0]&&(i[0]=$),$>i[1]&&(i[1]=$),N<i[2]&&(i[2]=N),N>i[3]&&(i[3]=N),e&&(z<i[4]&&(i[4]=z),z>i[5]&&(i[5]=z))}if(a>0&&(a*=-1),u>0&&(u*=-1),!a)return null;a*=.5,u*=.5;const S=[r/(6*a)+p,n/(6*a)+y,a];return e&&(i[4]===i[5]||u===0?(S[3]=(i[4]+i[5])/2,S[4]=0):(S[3]=s/(6*u)+b,S[4]=u)),S}function NRt(t,e){let i=0,r=0,n=0;t.nextPoint();const s=t.pathSize?t.x:0,a=t.pathSize?t.y:0;for(let u=0;u<t.pathSize;u++){t.seekInPath(u);const p=[t.x,t.y];t.seekInPath((u+1)%t.pathSize);const y=[t.x,t.y],[b,S]=p,C=b-s,O=S-a,[P,$]=y,N=P-s,z=$-a,U=C*z-N*O;n+=U,i+=(C+N)*U,r+=(O+z)*U,b<e[0]&&(e[0]=b),b>e[1]&&(e[1]=b),S<e[2]&&(e[2]=S),S>e[3]&&(e[3]=S)}return n>0&&(n*=-1),n?(n*=.5,[i/(6*n)+s,r/(6*n)+a,n]):null}function MDe(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let n=0,s=0,a=0,u=0;for(let p=0,y=t.length;p<y-1;p++){const b=t[p],S=t[p+1];if(b&&S){i[0]=b[0],i[1]=b[1],r[0]=S[0],r[1]=S[1],e&&b.length>2&&S.length>2&&(i[2]=b[2],r[2]=S[2]);const C=jD(i,r);if(C){n+=C;const O=Yge(b,S);s+=C*O[0],a+=C*O[1],e&&O.length>2&&(u+=C*O[2])}}}return n>0?e?[s/n,a/n,u/n]:[s/n,a/n]:t.length?t[0]:null}function PDe(t){const{hasZ:e,totalSize:i}=t;if(i===0)return null;const r=[],n=[],s=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const a=e1e(ADe(t),t.hasZ,s);a&&n.push(a)}if(n.sort((a,u)=>{let p=a[2]-u[2];return p===0&&e&&(p=a[4]-u[4]),p}),n.length&&(r[0]=n[0][0],r[1]=n[0][1],e&&(r[2]=n[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||e&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){t.reset(),t.nextPath();const a=t.pathSize?IDe(t):null;if(!a)return null;r[0]=a[0],r[1]=a[1],e&&a.length>2&&(r[2]=a[2])}return r}function IDe(t){const{hasZ:e}=t,i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let n=0,s=0,a=0,u=0;if(t.nextPoint()){let p=t.x,y=t.y,b=t.z;for(;t.nextPoint();){const S=t.x,C=t.y,O=t.z;i[0]=p,i[1]=y,r[0]=S,r[1]=C,e&&(i[2]=b,r[2]=O);const P=jD(i,r);if(P){n+=P;const $=Yge(i,r);s+=P*$[0],a+=P*$[1],e&&$.length>2&&(u+=P*$[2])}p=S,y=C,b=O}}return n>0?e?[s/n,a/n,u/n]:[s/n,a/n]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const $De=1e-6;function FRt(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<$De){const n=PDe(t);return n?[n[0],n[1]]:null}const i=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const r=[t.x,t.y];for(t.reset();t.nextPath();)DDe(i,r,t);return i[0]*=1/e,i[1]*=1/e,i[0]+=r[0],i[1]+=r[1],i}const LDe=1/3;function DDe(t,e,i){if(!t||!i||i.pathSize<3)return null;i.nextPoint();const r=i.x,n=i.y;i.nextPoint();let s,a=i.x-r,u=i.y-n,p=0,y=0;for(;i.nextPoint();)p=i.x-r,y=i.y-n,s=.5*LDe*(p*u-y*a),t[0]+=s*(a+p),t[1]+=s*(u+y),a=p,u=y;const b=i.getCurrentRingArea(),S=[r,n];return S[0]-=e[0],S[1]-=e[1],S[0]*=b,S[1]*=b,t[0]+=S[0],t[1]+=S[1],t}function Di(t=zDe){return[t[0],t[1],t[2],t[3]]}function kRt(t){return[t[0],t[1],t[2],t[3]]}function Sg(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function nY(t,e,i,r,n=Di()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function t1e(t,e=Di()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function BD(t,e){return new rr({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function sY(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Yy(t,e,i){if(e!=null)if("length"in e)uB(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}else Sg(i,t)}function cF(t,e,i=t){const r=e.length;let n=t[0],s=t[1],a=t[2],u=t[3];for(let p=0;p<r;p++){const y=e[p];n=Math.min(n,y[0]),s=Math.min(s,y[1]),a=Math.max(a,y[0]),u=Math.max(u,y[1])}return i[0]=n,i[1]=s,i[2]=a,i[3]=u,i}function lB(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function Na(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function Jl(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function zRt(t){return Na(t)*Jl(t)}function sL(t){return Na(t)>0&&Jl(t)>0}function oY(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function i1e(t,e){return VD(t,e[0],e[1])}function Eie(t,e){const i=e[3],r=.5*(t[0]+t[2]),n=Math.abs(e[0]-r),s=.5*(t[2]-t[0]);if(n>i+s)return!1;const a=.5*(t[1]+t[3]),u=.5*(t[3]-t[1]),p=Math.abs(e[1]-a);if(p>i+u)return!1;if(n<s||p<u)return!0;const y=n-s,b=p-u;return y*y+b*b<=i*i}function URt(t,e,i){const r=t[0],n=t[1],s=t[2],a=t[3],{x:u,y:p}=e,{x:y,y:b}=i,S=(N,z)=>(b-p)*N+(u-y)*z+(y*p-u*b)<0,C=S(r,a),O=S(s,a),P=S(s,n),$=S(r,n);return!(C===O&&O===P&&P===$&&$===C||u<r&&y<r||u>s&&y>s||p>a&&b>a||p<n&&b<n)}function jRt(t,e){return VD(t,e.x,e.y)}function VD(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function NDe(t,e,i){return e[0]>=t[0]-i&&e[1]>=t[1]-i&&e[0]<=t[2]+i&&e[1]<=t[3]+i}function GD(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function Cie(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function cB(t,e,i){if(e==null)return Sg(i,t);const r=e[0],n=e[1],s=e[2],a=e[3];return i[0]=Je(t[0],r,s),i[1]=Je(t[1],n,a),i[2]=Je(t[2],r,s),i[3]=Je(t[3],n,a),i}function FDe(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,n=Math.max(Math.abs(e[0]-i)-Na(t)/2,0),s=Math.max(Math.abs(e[1]-r)-Jl(t)/2,0);return Math.sqrt(n*n+s*s)}function oL(t,e,i,r=t){return r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function rd(t){return t?Sg(t,hB):Di(hB)}function uB(t){return t!=null&&t.length===4}function kDe(t){return!(Na(t)!==0&&isFinite(t[0])||Jl(t)!==0&&isFinite(t[1]))}function f2(t,e){return uB(t)&&uB(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const BRt=[-1/0,-1/0,1/0,1/0],hB=[1/0,1/0,-1/0,-1/0],zDe=[0,0,0,0];function r1e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function n1e(t){return t.points!==void 0}function s1e(t){return t.x!==void 0&&t.y!==void 0}function o1e(t){return t.paths!==void 0}function a1e(t){return t.rings!==void 0}function l1e(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const Iy=l1e(Math.min),$y=l1e(Math.max);function VRt(t,e){return o1e(e)?mS(t,e.paths,!1,!1):a1e(e)?mS(t,e.rings,!1,!1):n1e(e)?aY(t,e.points,!1,!1,!1,!1):r1e(e)?c1e(t,e):(s1e(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function GRt(t){let e,i,r,n;for(t.reset(),e=r=1/0,i=n=-1/0;t.nextPath();){const s=UDe(t);e=Math.min(s[0],e),r=Math.min(s[1],r),i=Math.max(s[2],i),n=Math.max(s[3],n)}return Di([e,r,i,n])}function UDe(t){let e,i,r,n;for(e=r=1/0,i=n=-1/0;t.nextPoint();)e=Math.min(t.x,e),r=Math.min(t.y,r),i=Math.max(t.x,i),n=Math.max(t.y,n);return Di([e,r,i,n])}function HRt(t,e){return o1e(e)?mS(t,e.paths,!0,!1):a1e(e)?mS(t,e.rings,!0,!1):n1e(e)?aY(t,e.points,!0,!1,!0,!1):r1e(e)?c1e(t,e,!0,!1,!0,!1):(s1e(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function mS(t,e,i,r){const n=i?3:2;if(!e.length||!e[0].length)return null;let s,a,u,p,[y,b]=e[0][0],[S,C]=e[0][0];for(let O=0;O<e.length;O++){const P=e[O];for(let $=0;$<P.length;$++){const N=P[$],[z,U]=N;if(y=Iy(y,z),b=Iy(b,U),S=$y(S,z),C=$y(C,U),i&&N.length>2){const j=N[2];s=Iy(s,j),a=$y(a,j)}if(r&&N.length>n){const j=N[n];u=Iy(s,j),p=$y(a,j)}}}return i?r?(t[0]=y,t[1]=b,t[2]=s,t[3]=u,t[4]=S,t[5]=C,t[6]=a,t[7]=p,t.length=8,t):(t[0]=y,t[1]=b,t[2]=s,t[3]=S,t[4]=C,t[5]=a,t.length=6,t):r?(t[0]=y,t[1]=b,t[2]=u,t[3]=S,t[4]=C,t[5]=p,t.length=6,t):(t[0]=y,t[1]=b,t[2]=S,t[3]=C,t.length=4,t)}function c1e(t,e,i,r,n,s){const a=e.xmin,u=e.xmax,p=e.ymin,y=e.ymax;let b=e.zmin,S=e.zmax,C=e.mmin,O=e.mmax;return n?(b=b||0,S=S||0,s?(C=C||0,O=O||0,t[0]=a,t[1]=p,t[2]=b,t[3]=C,t[4]=u,t[5]=y,t[6]=S,t[7]=O,t):(t[0]=a,t[1]=p,t[2]=b,t[3]=u,t[4]=y,t[5]=S,t)):s?(C=C||0,O=O||0,t[0]=a,t[1]=p,t[2]=C,t[3]=u,t[4]=y,t[5]=O,t):(t[0]=a,t[1]=p,t[2]=u,t[3]=y,t)}function aY(t,e,i,r,n,s){const a=i?3:2,u=r&&s,p=i&&n;if(!e.length||!e[0].length)return null;let y,b,S,C,[O,P]=e[0],[$,N]=e[0];for(let z=0;z<e.length;z++){const U=e[z],[j,G]=U;if(O=Iy(O,j),P=Iy(P,G),$=$y($,j),N=$y(N,G),p&&U.length>2){const q=U[2];y=Iy(y,q),b=$y(b,q)}if(u&&U.length>a){const q=U[a];S=Iy(y,q),C=$y(b,q)}}return n?(y=y||0,b=b||0,s?(S=S||0,C=C||0,t[0]=O,t[1]=P,t[2]=y,t[3]=S,t[4]=$,t[5]=N,t[6]=b,t[7]=C,t):(t[0]=O,t[1]=P,t[2]=y,t[3]=$,t[4]=N,t[5]=b,t)):s?(S=S||0,C=C||0,t[0]=O,t[1]=P,t[2]=S,t[3]=$,t[4]=N,t[5]=C,t):(t[0]=O,t[1]=P,t[2]=$,t[3]=N,t)}function jDe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function BDe(t){return t.points!==void 0}function VDe(t){return t.x!==void 0&&t.y!==void 0}function GDe(t){return t.paths!==void 0}function HDe(t){return t.rings!==void 0}const lY=[];function u1e(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function h1e(t,e,i,r,n,s){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:n,zmax:s}}function d1e(t,e,i,r,n,s){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:n,mmax:s}}function p1e(t,e,i,r,n,s,a,u){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:n,ymax:s,zmax:a,mmax:u}}function cY(t,e=!1,i=!1){return e?i?p1e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):h1e(t[0],t[1],t[2],t[3],t[4],t[5]):i?d1e(t[0],t[1],t[2],t[3],t[4],t[5]):u1e(t[0],t[1],t[2],t[3])}function qRt(t){return t?jDe(t)?t:VDe(t)?WDe(t):HDe(t)?f1e(t):GDe(t)?m1e(t):BDe(t)?qDe(t):null:null}function qDe(t){const{hasZ:e,hasM:i,points:r}=t;return cY(aY(lY,r,e??!1,i??!1),e,i)}function WDe(t){const{x:e,y:i,z:r,m:n}=t,s=n!=null;return r!=null?s?p1e(e,i,r,n,e,i,r,n):h1e(e,i,r,e,i,r):s?d1e(e,i,n,e,i,n):u1e(e,i,e,i)}function f1e(t){const{hasZ:e,hasM:i,rings:r}=t,n=mS(lY,r,e??!1,i??!1);return n?cY(n,e,i):null}function m1e(t){const{hasZ:e,hasM:i,paths:r}=t,n=mS(lY,r,e??!1,i??!1);return n?cY(n,e,i):null}var vI;function Aie(t){return!Array.isArray(t[0])}let wf=vI=class extends Iv{static fromExtent(t){const e=t.clone().normalize(),i=t.spatialReference;let r=!1,n=!1;for(const a of e)a.hasZ&&(r=!0),a.hasM&&(n=!0);const s={rings:e.map(a=>{const u=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(r&&a.hasZ){const p=a.zmin+.5*(a.zmax-a.zmin);for(let y=0;y<u.length;y++)u[y].push(p)}if(n&&a.hasM){const p=a.mmin+.5*(a.mmax-a.mmin);for(let y=0;y<u.length;y++)u[y].push(p)}return u}),spatialReference:i};return r&&(s.hasZ=!0),n&&(s.hasM=!0),new vI(s)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let i,r,n=null,s=null;return t&&!Array.isArray(t)?(n=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),i=t.hasZ,r=t.hasM):n=t,n=n||[],e=e||dt.WGS84,n.length&&n[0]?.[0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]?.[0],s&&(i===void 0&&r===void 0?(i=s.length>2,r=s.length>3):i===void 0?i=r?s.length>3:s.length>2:r===void 0&&(r=i?s.length>3:s.length>2)),{rings:n,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=RDe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new Wt;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=f1e(this);if(!e)return null;const i=new rr(e);return i.spatialReference=t,i}get isSelfIntersecting(){return eLe(this.rings)}writeRings(t,e){e.rings=Ce(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(Aie(t)){const r=[];for(let n=0,s=t.length;n<s;n++)r[n]=t[n].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new vI;return t.spatialReference=this.spatialReference,t.rings=Ce(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;if(e!=null!=(i!=null)||e!=null&&i!=null&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([n,s,a,u],[p,y,b,S])=>n===p&&s===y&&(a==null&&b==null||a===b)&&(u==null&&S==null||u===S);for(let n=0;n<this.rings.length;n++){const s=this.rings[n],a=t.rings[n];if(!bg(s,a,r))return!1}return!0}contains(t){if(!t)return!1;const e=HO(t,this.spatialReference);return G6e(this,e??t)}isClockwise(t){let e;return e=Aie(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t,yI(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,n=this.hasM;return r&&!n?new Wt(i[0],i[1],i[2],void 0,this.spatialReference):n&&!r?new Wt(i[0],i[1],void 0,i[2],this.spatialReference):r&&n?new Wt(i[0],i[1],i[2],i[3],this.spatialReference):new Wt(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(fS(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new Wt(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(n=>new Wt(n,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(fS(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};_([T({readOnly:!0})],wf.prototype,"cache",null),_([T({readOnly:!0})],wf.prototype,"centroid",null),_([T({readOnly:!0})],wf.prototype,"extent",null),_([T({readOnly:!0})],wf.prototype,"isSelfIntersecting",null),_([T({type:[[[Number]]],json:{write:{isRequired:!0}}})],wf.prototype,"rings",void 0),_([ot("rings")],wf.prototype,"writeRings",null),wf=vI=_([Z("esri.geometry.Polygon")],wf),wf.prototype.toJSON.isDefaultToJSON=!0;const nd=wf;var dB;function XDe(t){return!Array.isArray(t[0])}let U1=dB=class extends Iv{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let i,r,n=null,s=null;return t&&!Array.isArray(t)?(n=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),i=t.hasZ,r=t.hasM):n=t,n=n||[],e=e||dt.WGS84,n.length&&n[0]?.[0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]?.[0],s&&(i===void 0&&r===void 0?(i=s.length>2,r=!1):i===void 0?i=!r&&s.length>3:r===void 0&&(r=!i&&s.length>3)),{paths:n,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=m1e(this);if(!e)return null;const i=new rr(e);return i.spatialReference=t,i}writePaths(t,e){e.paths=Ce(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(XDe(t)){const r=[];for(let n=0,s=t.length;n<s;n++)r[n]=t[n].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new dB;return t.spatialReference=this.spatialReference,t.paths=Ce(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,n=this.hasM;return r&&!n?new Wt(i[0],i[1],i[2],void 0,this.spatialReference):n&&!r?new Wt(i[0],i[1],void 0,i[2],this.spatialReference):r&&n?new Wt(i[0],i[1],i[2],i[3],this.spatialReference):new Wt(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(fS(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(n=>new Wt(n,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new Wt(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(fS(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};_([T({readOnly:!0})],U1.prototype,"cache",null),_([T({readOnly:!0})],U1.prototype,"extent",null),_([T({type:[[[Number]]],json:{write:{isRequired:!0}}})],U1.prototype,"paths",void 0),_([ot("paths")],U1.prototype,"writePaths",null),U1=dB=_([Z("esri.geometry.Polyline")],U1),U1.prototype.toJSON.isDefaultToJSON=!0;const Vh=U1,k4=Tl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Oie=Tl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function g1e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function uY(t){return t.points!==void 0}function hY(t){return t.x!==void 0&&t.y!==void 0}function dY(t){return t.paths!==void 0}function m2(t){return t.rings!==void 0}function E0(t){return t==null?null:t instanceof Iv?t:hY(t)?Wt.fromJSON(t):dY(t)?Vh.fromJSON(t):m2(t)?nd.fromJSON(t):uY(t)?vw.fromJSON(t):g1e(t)?rr.fromJSON(t):null}function ZO(t){return t?hY(t)?"esriGeometryPoint":dY(t)?"esriGeometryPolyline":m2(t)?"esriGeometryPolygon":g1e(t)?"esriGeometryEnvelope":uY(t)?"esriGeometryMultipoint":null:null}const JDe={esriGeometryPoint:Wt,esriGeometryPolyline:Vh,esriGeometryPolygon:nd,esriGeometryEnvelope:rr,esriGeometryMultipoint:vw};function YDe(t){return t&&JDe[t]||null}const _w={base:Iv,key:"type",typeMap:{extent:rr,multipoint:vw,point:Wt,polyline:Vh,polygon:nd}};Pp(_w);let y1e=0;const pY=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+y1e++})}};return e=_([Z("esri.core.Identifiable")],e),e},WRt=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:y1e++})}};return e=_([Z("esri.core.NumericIdentifiable")],e),e};let Rie=class extends pY(class{}){};Rie=_([Z("esri.core.Identifiable")],Rie);async function ZDe(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:i}=await ke(()=>import("./portalLayers-7555fcdb.js").then(r=>r.p),["./portalLayers-7555fcdb.js","./associatedFeatureServiceUtils-c90a3355.js","./requestPresets-5652178e.js"],import.meta.url);try{return await i(e)}catch(r){const n=e&&e.portalItem,s=n?.id||"unset",a=n&&n.portal&&n.portal.url||vr.portalUrl;throw Ee.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+a+"', id: '"+s+"')",r),r}}let KDe=0,fo=class extends Xn.EventedMixin(pY(Ip)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new rr(-180,-90,180,90,dt.WGS84),this.id=Date.now().toString(16)+"-layer-"+KDe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=dt.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await ke(()=>import("./arcgisLayers-745d5a1b.js"),["./arcgisLayers-745d5a1b.js","./associatedFeatureServiceUtils-c90a3355.js","./fetchService-af1bc981.js","./requestPresets-5652178e.js"],import.meta.url)).fromUrl(i)}static fromPortalItem(e){return ZDe(e)}initialize(){this.when().catch(e=>{qn(e)||Ee.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const e=this.parent;if(e){const i=this;"layers"in e&&e.layers.includes(i)?e.layers.remove(i):"tables"in e&&e.tables.includes(i)?e.tables.remove(i):"baseLayers"in e&&e.baseLayers.includes(i)?e.baseLayers.remove(i):"referenceLayers"in e&&e.referenceLayers.includes(i)&&e.referenceLayers.remove(i),this._set("parent",null)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return Nn(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await ir(e,{query:{f:"json"},responseType:"json"})).data;throw new de("layer:no-attribution-data","Layer does not have attribution data")}};_([T({type:String})],fo.prototype,"attributionDataUrl",void 0),_([T({type:rr})],fo.prototype,"fullExtent",void 0),_([T({readOnly:!0})],fo.prototype,"hasAttributionData",null),_([T({type:String,clonable:!1})],fo.prototype,"id",void 0),_([T({type:Boolean,nonNullable:!0})],fo.prototype,"legendEnabled",void 0),_([T({type:["show","hide","hide-children"]})],fo.prototype,"listMode",void 0),_([T({type:Number,range:{min:0,max:1},nonNullable:!0})],fo.prototype,"opacity",void 0),_([T({clonable:!1})],fo.prototype,"parent",void 0),_([T({readOnly:!0})],fo.prototype,"parsedUrl",null),_([T({type:Boolean,readOnly:!0})],fo.prototype,"persistenceEnabled",void 0),_([T({type:Boolean})],fo.prototype,"popupEnabled",void 0),_([T({type:Boolean})],fo.prototype,"attributionVisible",void 0),_([T({type:dt})],fo.prototype,"spatialReference",void 0),_([T({type:String})],fo.prototype,"title",void 0),_([T({readOnly:!0,json:{read:!1}})],fo.prototype,"type",void 0),_([T()],fo.prototype,"url",void 0),_([T({type:Boolean,nonNullable:!0})],fo.prototype,"visible",void 0),fo=_([Z("esri.layers.Layer")],fo);const HD=fo;function pB(t,e,i){let r,n;if(t)for(let s=0,a=t.length;s<a;s++){if(r=t.at(s),r?.[e]===i)return r;if(r?.type==="group"&&(n=pB(r.layers,e,i),n))return n}}const QDe=t=>{let e=class extends t{constructor(...i){super(...i),this.layers=new Dt;const r=a=>{a.parent&&"remove"in a.parent&&a.parent.remove(a)},n=a=>{a.parent=this,this.layerAdded(a),a.type!=="elevation"&&a.type!=="base-elevation"||Ee.getLogger(this).error(`Layer 'title:${a.title}, id:${a.id}' of type '${a.type}' is not supported as an operational layer and will therefore be ignored.`)},s=a=>{a.parent=null,this.layerRemoved(a)};this.addHandles([this.layers.on("before-add",a=>r(a.item)),this.layers.on("after-add",a=>n(a.item)),this.layers.on("after-remove",a=>s(a.item))])}destroy(){const i=this.layers.toArray();for(const r of i)r.destroy();this.layers.destroy()}set layers(i){this._set("layers",xg(i,this._get("layers")))}add(i,r){const n=this.layers;if(r=n.getNextIndex(r),i instanceof HD){const s=i;s.parent===this?this.reorder(s,r):n.add(s,r)}else Yc(i)?i.then(s=>{this.destroyed||this.add(s,r)}):Ee.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const n=this.layers;let s=n.getNextIndex(r);i.slice().forEach(a=>{a.parent!==this?(n.add(a,s),s+=1):this.reorder(a,s)})}findLayerById(i){return pB(this.layers,"id",i)}findLayerByUid(i){return pB(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return _([T()],e.prototype,"layers",null),e=_([Z("esri.support.LayersMixin")],e),e};function fB(t,e,i){if(t)for(let r=0,n=t.length;r<n;r++){const s=t.at(r);if(s[e]===i)return s;if(s?.type==="group"){const a=fB(s.tables,e,i);if(a)return a}}}const e7e=t=>{let e=class extends t{constructor(...i){super(...i),this.tables=new Dt,this.addHandles([this.tables.on("after-add",r=>{const n=r.item;n.parent&&n.parent!==this&&"tables"in n.parent&&n.parent.tables.remove(n),n.parent=this,n.type!=="feature"&&Ee.getLogger(this).error(`Layer 'title:${n.title}, id:${n.id}' of type '${n.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})])}destroy(){const i=this.tables.toArray();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",xg(i,this._get("tables")))}findTableById(i){return fB(this.tables,"id",i)}findTableByUid(i){return fB(this.tables,"uid",i)}};return _([T()],e.prototype,"tables",null),e=_([Z("esri.support.TablesMixin")],e),e};let xf=class extends e7e(QDe(Xn.EventedMixin(Ke))){constructor(e){super(e),this.allLayers=new F4({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=SDe(this),this.basemap=null,this.editableLayers=new F4({getCollections:()=>[this.allLayers],itemFilterFunction:$8e}),this.ground=new N4,this._basemapCache=yDe()}destroy(){vDe(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=ct(this.basemap),ct(this.ground),this._set("ground",null)}castBasemap(e){return rY(e,this._basemapCache)}castGround(e){return EDe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};_([T({readOnly:!0,dependsOn:[]})],xf.prototype,"allLayers",void 0),_([T({readOnly:!0})],xf.prototype,"allTables",void 0),_([T({type:PT,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],xf.prototype,"basemap",void 0),_([Fi("basemap")],xf.prototype,"castBasemap",null),_([T({readOnly:!0})],xf.prototype,"editableLayers",void 0),_([T({type:N4,nonNullable:!0})],xf.prototype,"ground",void 0),_([Fi("ground")],xf.prototype,"castGround",null),xf=_([Z("esri.Map")],xf);const v1e=xf,sn=t=>{let e=class extends t{clone(){const i=Ql(this);_D(i,"unable to clone instance of non-accessor class");const r=i.metadatas,n=i.store,s={},a=new Map;for(const p in r){const y=r[p],b=n?.originOf(p),S=y.clonable;if(y.readOnly||S===!1||b!==cr.USER&&b!==cr.DEFAULTS&&b!==cr.WEB_MAP&&b!==cr.WEB_SCENE)continue;const C=this[p];let O=null;O=typeof S=="function"?S(C):S==="reference"?C:pj(C),C!=null&&O==null||(b===cr.DEFAULTS?a.set(p,O):s[p]=O)}const u=new(Object.getPrototypeOf(this)).constructor(s);if(a.size){const p=Ql(u)?.store;if(p)for(const[y,b]of a)p.set(y,b,cr.DEFAULTS)}return u}};return e=_([Z("esri.core.Clonable")],e),e};let Mie=class extends sn(Ke){};Mie=_([Z("esri.core.Clonable")],Mie);let av=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}ndiff(e,i=0){return Math.ceil((e-i)/this.range)*this.range+i}_normalize(e,i,r,n=0,s=!1){return(r-=n)<e?r+=this.ndiff(e-r):r>i&&(r-=this.ndiff(r-i)),s&&r===i&&(r=e),r+n}normalize(e,i=0,r=!1){return this._normalize(this.min,this.max,e,i,r)}clamp(e,i=0){return Je(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+this.ndiff(e-i,r)}minimalMonotonic(e,i,r){return this._normalize(e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,n=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(n)?r:n}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function fY(t){for(const e in t){const i=t[e];i instanceof Function&&(t[e]=i.bind(t))}return t}const t7e=fY(new av(0,2*Math.PI)),lv=fY(new av(-Math.PI,Math.PI)),mY=fY(new av(0,360));let _m=class extends sn(Ne){constructor(...e){super(...e),this.position=new Wt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,i,r,n){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return i!=null&&(s.heading=i),r!=null&&(s.tilt=r),n!=null&&(s.fov=n),s}return e}writePosition(e,i,r,n){const s=e.clone();s.x=$h(e.x||0),s.y=$h(e.y||0),s.z=e.hasZ?$h(e.z||0):e.z,i[r]=s.write({},n)}readPosition(e,i){const r=new Wt;return r.read(e,i),r.x=$h(r.x||0),r.y=$h(r.y||0),r.z=r.hasZ?$h(r.z||0):r.z,r}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};_([T({type:Wt,json:{write:{isRequired:!0}}})],_m.prototype,"position",void 0),_([ot("position")],_m.prototype,"writePosition",null),_([rt("position")],_m.prototype,"readPosition",null),_([T({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Fi(t=>mY.normalize($h(t)))],_m.prototype,"heading",void 0),_([T({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Fi(t=>Je($h(t),-180,180))],_m.prototype,"tilt",void 0),_([T({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],_m.prototype,"fov",void 0),_m=_([Z("esri.Camera")],_m);const Ku=_m;var mB;let j1=mB=class extends Ne{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new mB({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function uF(){return{enabled:!this.camera}}_([T({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:uF}}}}})],j1.prototype,"rotation",void 0),_([Fi("rotation")],j1.prototype,"castRotation",null),_([T({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:uF}}}}})],j1.prototype,"scale",void 0),_([T({types:_w,json:{read:E0,write:!0,origins:{"web-scene":{read:E0,write:{overridePolicy:uF}}}}})],j1.prototype,"targetGeometry",void 0),_([T({type:Ku,json:{write:!0}})],j1.prototype,"camera",void 0),j1=mB=_([Z("esri.Viewpoint")],j1);const qc=j1;let i7e=class _1e{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(yj),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new _1e,r=this._originStores[cr.DEFAULTS];r&&r.forEach((n,s)=>{i.set(s,Ce(n),cr.DEFAULTS)});for(let n=cr.SERVICE;n<yj;n++){const s=this._originStores[n];s&&s.forEach((a,u)=>{e&&e.has(u)||i.set(u,Ce(a),n)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=cr.USER){let n=this._originStores[r];if(n||(n=new Map,this._originStores[r]=n),n.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const s=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),s!==i}return!1}delete(e,i=cr.USER){const r=this._originStores[i];if(!r)return;const n=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let s=i-1;s>=0;s--){const a=this._originStores[s];if(a&&a.has(e)){this._values.set(e,a.get(e)),this._propertyOriginMap.set(e,s);break}}}return n}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],n=r?.get(e),s=this._values.get(e);return this._values.set(e,n),this._propertyOriginMap.set(e,i),s!==n}originOf(e){return this._propertyOriginMap.get(e)||cr.DEFAULTS}forEach(e){this._values.forEach(e)}};const b1e=t=>{let e=class extends t{constructor(...i){super(...i);const r=Ql(this),n=r.store,s=new i7e;r.store=s,sme(r,n,s)}read(i,r){ame(this,i,r)}getAtOrigin(i,r){const n=hF(this),s=Py(r);if(typeof i=="string")return n.get(i,s);const a={};return i.forEach(u=>{a[u]=n.get(u,s)}),a}originOf(i){return A6(this.originIdOf(i))}originIdOf(i){return hF(this).originOf(i)}revert(i,r){const n=hF(this),s=Py(r),a=Ql(this);let u;u=typeof i=="string"?i==="*"?n.keys(s):[i]:i,u.forEach(p=>{a.invalidate(p),n.revert(p,s),a.commit(p)})}};return e=_([Z("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function hF(t){return Ql(t).store}let Pie=class extends b1e(Ke){};Pie=_([Z("esri.core.ReadOnlyMultiOriginJSONSupport")],Pie);const r7e=t=>{let e=class extends t{constructor(...i){super(...i)}clear(i,r="user"){return dF(this).delete(i,Py(r))}write(i,r){return ume(this,i=i||{},r),i}setAtOrigin(i,r,n){Ql(this).setAtOrigin(i,r,Py(n))}removeOrigin(i){const r=dF(this),n=Py(i),s=r.keys(n);for(const a of s)r.originOf(a)===n&&r.set(a,r.get(a,n),cr.USER)}updateOrigin(i,r){const n=dF(this),s=Py(r),a=xp(this,i);for(let u=s+1;u<yj;++u)n.delete(i,u);n.set(i,a,s)}toJSON(i){return this.write({},i)}};return e=_([Z("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function dF(t){return Ql(t).store}const qD=t=>{let e=class extends r7e(b1e(t)){constructor(...i){super(...i)}};return e=_([Z("esri.core.MultiOriginJSONSupport")],e),e};let gB=class extends qD(Ke){};gB=_([Z("esri.core.MultiOriginJSONSupport")],gB);function Fe(t,e,i={}){return gY(t,e,i,w1e)}function Qu(t,e,i={}){return gY(t,e,i,x1e)}function gY(t,e,i={},r){let n=null;const s=i.once?(a,u)=>{r(a)&&(nn(n),e(a,u))}:(a,u)=>{r(a)&&e(a,u)};if(n=cIe(t,s,i.sync,i.equals),i.initial){const a=t();s(a,a)}return n}function ga(t,e,i,r={}){let n=null,s=null,a=null;function u(){n&&s&&(s.remove(),r.onListenerRemove?.(n),n=null,s=null)}function p(b){r.once&&r.once&&nn(a),i(b)}const y=Fe(t,(b,S)=>{u(),wD(b)&&(n=b,s=lg(b,e,p),r.onListenerAdd?.(b))},{sync:r.sync,initial:!0});return a=Sr(()=>{y.remove(),u()}),a}function gS(t,e){return n7e(t,x1e,e)}function n7e(t,e,i){if(Ms(i))return Promise.reject(or());const r=t();if(e?.(r))return Promise.resolve(r);let n=null;function s(){n=nn(n)}return new Promise((a,u)=>{n=nv([qs(i,()=>{s(),u(or())}),gY(t,p=>{s(),a(p)},{sync:!1,once:!0},e??w1e)])})}function w1e(t){return!0}function x1e(t){return!!t}function s7e(t,e){const i=new Dt,r=ga(t,"after-splice",({added:n,start:s,deleteCount:a})=>{const u=i.splice(s,a);for(const p of u)p.remove();if(n?.length){const p=n.map(e);i.addMany(p,s)}},{sync:!0,onListenerRemove:()=>i.drain(n=>n.remove()),onListenerAdd:n=>i.addMany(n.items.map(e))});return i.addHandles(r),i}function iMt(t,e){const i=new Dt,r=s7e(t,u=>Pv(async p=>{const y=await e(u,p);if(Ms(p))throw y.remove(),or();return y})),n=()=>null,s=async u=>{const p=await u.promise,y=r.indexOf(u);y<0||i.splice(y,1,p)};i.addMany(r.items.map(n));for(const u of r)O4(s(u));const a=r.on("after-splice",({added:u,start:p,deleteCount:y})=>{const b=i.splice(p,y);for(const S of b)S?.remove();if(u?.length){i.addMany(u.map(n),p);for(const S of u)O4(s(S))}});return i.addHandles([g0e(r),a]),i}const $r={sync:!0},jr={initial:!0},Ur={sync:!0,initial:!0};function o7e(t){return t&&"getAtOrigin"in t&&"originOf"in t}function Iie(t){t?.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:i,newOrigin:r})=>{o7e(e)&&r&&e.originOf(i)!==r&&e.updateOrigin(i,r)})}var XC;const aL=Tl()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),T1e=aL.jsonValues.slice();A4(T1e,"orthometric");const IA=Tl()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Pd=XC=class extends Ne{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return aL.write(t,e,i)}readHeightModel(t,e,i){return aL.read(t)||(i?.messages&&i.messages.push(a7e(t,{context:i})),null)}readHeightUnit(t,e,i){return IA.read(t)||(i?.messages&&i.messages.push($ie(t,{context:i})),null)}readHeightUnitService(t,e,i){return Vme(t)||IA.read(t)||(i?.messages&&i.messages.push($ie(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new XC({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=C6e(e);return new XC({heightModel:t.heightModel,heightUnit:i,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new XC;return e.read(t,{origin:"web-scene"}),e}};function $ie(t,e){return new T0("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function a7e(t,e){return new T0("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}_([T({type:aL.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:T1e,default:"ellipsoidal"}}}})],Pd.prototype,"heightModel",void 0),_([ot("web-scene","heightModel")],Pd.prototype,"writeHeightModel",null),_([rt(["web-scene","service"],"heightModel")],Pd.prototype,"readHeightModel",null),_([T({type:IA.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:IA.jsonValues,write:IA.write}}}})],Pd.prototype,"heightUnit",void 0),_([rt("web-scene","heightUnit")],Pd.prototype,"readHeightUnit",null),_([rt("service","heightUnit")],Pd.prototype,"readHeightUnitService",null),_([T({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Pd.prototype,"vertCRS",void 0),_([rt("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Pd.prototype,"readVertCRS",null),Pd=XC=_([Z("esri.geometry.HeightModelInfo")],Pd);const $v=Pd,rMt=Math.PI/180,nMt=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,n1=ur.radius,vd=ur.eccentricitySquared,l7e={a1:n1*vd,a2:n1*vd*n1*vd,a3:n1*vd*vd/2,a4:n1*vd*n1*vd*2.5,a5:n1*vd+n1*vd*vd/2,a6:1-vd},sMt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:ur.radius,f:ur.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Tg.radius,f:Tg.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:p0.radius,f:p0.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:p0.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var Te;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(Te||(Te={}));const lT={[Te.WGS84]:{[Te.CGCS2000]:null,[Te.GCSMARS2000]:null,[Te.GCSMOON2000]:null,[Te.LON_LAT]:gn,[Te.WGS84_COMPARABLE_LON_LAT]:gn,[Te.SPHERICAL_ECEF]:Dy,[Te.SPHERICAL_MARS_PCPF]:null,[Te.SPHERICAL_MOON_PCPF]:null,[Te.UNKNOWN]:null,[Te.WEB_MERCATOR]:yS,[Te.PLATE_CARREE]:Ly,[Te.WGS84]:gn,[Te.WGS84_ECEF]:Fy},[Te.CGCS2000]:{[Te.CGCS2000]:gn,[Te.GCSMARS2000]:null,[Te.GCSMOON2000]:null,[Te.LON_LAT]:gn,[Te.WGS84_COMPARABLE_LON_LAT]:gn,[Te.SPHERICAL_ECEF]:Dy,[Te.SPHERICAL_MARS_PCPF]:null,[Te.SPHERICAL_MOON_PCPF]:null,[Te.UNKNOWN]:null,[Te.WEB_MERCATOR]:null,[Te.PLATE_CARREE]:Ly,[Te.WGS84]:null,[Te.WGS84_ECEF]:Fy},[Te.GCSMARS2000]:{[Te.CGCS2000]:null,[Te.GCSMARS2000]:gn,[Te.GCSMOON2000]:null,[Te.LON_LAT]:gn,[Te.WGS84_COMPARABLE_LON_LAT]:null,[Te.SPHERICAL_ECEF]:null,[Te.SPHERICAL_MARS_PCPF]:vB,[Te.SPHERICAL_MOON_PCPF]:null,[Te.UNKNOWN]:null,[Te.WEB_MERCATOR]:null,[Te.PLATE_CARREE]:null,[Te.WGS84]:null,[Te.WGS84_ECEF]:null},[Te.GCSMOON2000]:{[Te.CGCS2000]:null,[Te.GCSMARS2000]:null,[Te.GCSMOON2000]:gn,[Te.LON_LAT]:gn,[Te.WGS84_COMPARABLE_LON_LAT]:null,[Te.SPHERICAL_ECEF]:null,[Te.SPHERICAL_MARS_PCPF]:null,[Te.SPHERICAL_MOON_PCPF]:yB,[Te.UNKNOWN]:null,[Te.WEB_MERCATOR]:null,[Te.PLATE_CARREE]:null,[Te.WGS84]:null,[Te.WGS84_ECEF]:null},[Te.WEB_MERCATOR]:{[Te.CGCS2000]:null,[Te.GCSMARS2000]:null,[Te.GCSMOON2000]:null,[Te.LON_LAT]:g2,[Te.WGS84_COMPARABLE_LON_LAT]:g2,[Te.SPHERICAL_ECEF]:E1e,[Te.SPHERICAL_MARS_PCPF]:null,[Te.SPHERICAL_MOON_PCPF]:null,[Te.UNKNOWN]:null,[Te.WEB_MERCATOR]:gn,[Te.PLATE_CARREE]:A1e,[Te.WGS84]:g2,[Te.WGS84_ECEF]:C1e},[Te.WGS84_ECEF]:{[Te.CGCS2000]:ky,[Te.GCSMARS2000]:null,[Te.GCSMOON2000]:null,[Te.LON_LAT]:ky,[Te.WGS84_COMPARABLE_LON_LAT]:ky,[Te.SPHERICAL_ECEF]:M1e,[Te.SPHERICAL_MARS_PCPF]:null,[Te.SPHERICAL_MOON_PCPF]:null,[Te.UNKNOWN]:null,[Te.WEB_MERCATOR]:P1e,[Te.PLATE_CARREE]:c7e,[Te.WGS84]:ky,[Te.WGS84_ECEF]:gn},[Te.SPHERICAL_ECEF]:{[Te.CGCS2000]:Ny,[Te.GCSMARS2000]:null,[Te.GCSMOON2000]:null,[Te.LON_LAT]:Ny,[Te.WGS84_COMPARABLE_LON_LAT]:Ny,[Te.SPHERICAL_ECEF]:gn,[Te.SPHERICAL_MARS_PCPF]:null,[Te.SPHERICAL_MOON_PCPF]:null,[Te.UNKNOWN]:null,[Te.WEB_MERCATOR]:O1e,[Te.PLATE_CARREE]:u7e,[Te.WGS84]:Ny,[Te.WGS84_ECEF]:R1e},[Te.SPHERICAL_MARS_PCPF]:{[Te.CGCS2000]:null,[Te.GCSMARS2000]:bB,[Te.GCSMOON2000]:null,[Te.LON_LAT]:bB,[Te.WGS84_COMPARABLE_LON_LAT]:null,[Te.SPHERICAL_ECEF]:null,[Te.SPHERICAL_MARS_PCPF]:gn,[Te.SPHERICAL_MOON_PCPF]:null,[Te.UNKNOWN]:null,[Te.WEB_MERCATOR]:null,[Te.PLATE_CARREE]:null,[Te.WGS84]:null,[Te.WGS84_ECEF]:null},[Te.SPHERICAL_MOON_PCPF]:{[Te.CGCS2000]:null,[Te.GCSMARS2000]:null,[Te.GCSMOON2000]:_B,[Te.LON_LAT]:_B,[Te.WGS84_COMPARABLE_LON_LAT]:null,[Te.SPHERICAL_ECEF]:null,[Te.SPHERICAL_MARS_PCPF]:null,[Te.SPHERICAL_MOON_PCPF]:gn,[Te.UNKNOWN]:null,[Te.WEB_MERCATOR]:null,[Te.PLATE_CARREE]:null,[Te.WGS84]:null,[Te.WGS84_ECEF]:null},[Te.UNKNOWN]:{[Te.CGCS2000]:null,[Te.GCSMARS2000]:null,[Te.GCSMOON2000]:null,[Te.LON_LAT]:null,[Te.WGS84_COMPARABLE_LON_LAT]:null,[Te.SPHERICAL_ECEF]:null,[Te.SPHERICAL_MARS_PCPF]:null,[Te.SPHERICAL_MOON_PCPF]:null,[Te.UNKNOWN]:gn,[Te.WEB_MERCATOR]:null,[Te.PLATE_CARREE]:null,[Te.WGS84]:null,[Te.WGS84_ECEF]:null},[Te.LON_LAT]:{[Te.CGCS2000]:gn,[Te.GCSMARS2000]:gn,[Te.GCSMOON2000]:gn,[Te.LON_LAT]:gn,[Te.WGS84_COMPARABLE_LON_LAT]:gn,[Te.SPHERICAL_ECEF]:Dy,[Te.SPHERICAL_MARS_PCPF]:vB,[Te.SPHERICAL_MOON_PCPF]:yB,[Te.UNKNOWN]:null,[Te.WEB_MERCATOR]:yS,[Te.PLATE_CARREE]:Ly,[Te.WGS84]:gn,[Te.WGS84_ECEF]:Fy},[Te.WGS84_COMPARABLE_LON_LAT]:{[Te.CGCS2000]:null,[Te.GCSMARS2000]:null,[Te.GCSMOON2000]:null,[Te.LON_LAT]:gn,[Te.WGS84_COMPARABLE_LON_LAT]:gn,[Te.SPHERICAL_ECEF]:Dy,[Te.SPHERICAL_MARS_PCPF]:null,[Te.SPHERICAL_MOON_PCPF]:null,[Te.UNKNOWN]:null,[Te.WEB_MERCATOR]:null,[Te.PLATE_CARREE]:Ly,[Te.WGS84]:gn,[Te.WGS84_ECEF]:Fy},[Te.PLATE_CARREE]:{[Te.CGCS2000]:t2,[Te.GCSMARS2000]:null,[Te.GCSMOON2000]:null,[Te.LON_LAT]:t2,[Te.WGS84_COMPARABLE_LON_LAT]:t2,[Te.SPHERICAL_ECEF]:h7e,[Te.SPHERICAL_MARS_PCPF]:null,[Te.SPHERICAL_MOON_PCPF]:null,[Te.UNKNOWN]:null,[Te.WEB_MERCATOR]:d7e,[Te.PLATE_CARREE]:gn,[Te.WGS84]:t2,[Te.WGS84_ECEF]:p7e}};function S1e(t){const e=z4(t,$1e);return lT[e][Te.WGS84_COMPARABLE_LON_LAT]}function yY(t,e,i=I1e()){return t==null||e==null?null:m7e(t,e,i).projector}function oMt(t,e){switch(yY(t,e,wY)){case gn:return"copy3";case Dy:return"wgs84ToSphericalECEF";case yS:return"wgs84ToWebMercator";case Ly:return"wgs84ToPlateCarree";case Fy:return"wgs84ToWGS84ECEF";case g2:return"webMercatorToWGS84";case E1e:return"webMercatorToSphericalECEF";case C1e:return"webMercatorToWGS84ECEF";case A1e:return"webMercatorToPlateCarree";case ky:return"wgs84ECEFToWGS84";case M1e:return"wgs84ECEFToSphericalECEF";case P1e:return"wgs84ECEFToWebMercator";case Ny:return"sphericalECEFToWGS84";case O1e:return"sphericalECEFToWebMercator";case bB:return"sphericalMarsPCPFToMars2000";case _B:return"sphericalMoonPCPFToMoon2000";case R1e:return"sphericalECEFToWGS84ECEF";case vB:return"mars2000ToSphericalPCPF";case yB:return"moon2000ToSphericalPCPF";default:return null}}function z4(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Va(t,1)),Y6(t)?e.spatialReferenceId=Te.SPHERICAL_ECEF:$4(t)?e.spatialReferenceId=Te.WGS84:N2(t)?e.spatialReferenceId=Te.WEB_MERCATOR:NJ(t)?e.spatialReferenceId=Te.PLATE_CARREE:t.wkt===Ume.wkt?e.spatialReferenceId=Te.WGS84_ECEF:t.wkid===jh.CGCS2000?e.spatialReferenceId=Te.CGCS2000:t.wkt===AD.wkt?e.spatialReferenceId=Te.SPHERICAL_MARS_PCPF:t.wkt===OD.wkt?e.spatialReferenceId=Te.SPHERICAL_MOON_PCPF:L0(t)?e.spatialReferenceId=Te.GCSMARS2000:D0(t)?e.spatialReferenceId=Te.GCSMOON2000:e.spatialReferenceId=Te.UNKNOWN):Te.UNKNOWN}function gn(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function g2(t,e,i,r){i[r++]=_S*(t[e++]/ur.radius),i[r++]=_S*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/ur.radius))),i[r]=t[e]}function E1e(t,e,i,r){g2(t,e,i,r),Dy(i,r,i,r)}function C1e(t,e,i,r){g2(t,e,i,r),Fy(i,r,i,r)}function vY(t,e,i,r,n){const s=.4999999*Math.PI,a=Je(vS*t[e+1],-s,s),u=Math.sin(a);i[r++]=vS*t[e]*n.radius,i[r++]=n.halfSemiMajorAxis*Math.log((1+u)/(1-u)),i[r]=t[e+2]}function yS(t,e,i,r){vY(t,e,i,r,ur)}const Lie=ur.radius*Math.PI/180,Die=180/(ur.radius*Math.PI);function Ly(t,e,i,r){i[r]=t[e]*Lie,i[r+1]=t[e+1]*Lie,i[r+2]=t[e+2]}function t2(t,e,i,r){i[r]=t[e]*Die,i[r+1]=t[e+1]*Die,i[r+2]=t[e+2]}function A1e(t,e,i,r){g2(t,e,i,r),Ly(i,r,i,r)}function c7e(t,e,i,r){ky(t,e,i,r),Ly(i,r,i,r)}function u7e(t,e,i,r){Ny(t,e,i,r),Ly(i,r,i,r)}function h7e(t,e,i,r){t2(t,e,i,r),Dy(i,r,i,r)}function d7e(t,e,i,r){t2(t,e,i,r),yS(i,r,i,r)}function p7e(t,e,i,r){t2(t,e,i,r),Fy(i,r,i,r)}function _Y(t,e,i,r,n){const s=n+t[e+2],a=vS*t[e+1],u=vS*t[e],p=Math.cos(a);i[r++]=Math.cos(u)*p*s,i[r++]=Math.sin(u)*p*s,i[r]=Math.sin(a)*s}function yB(t,e,i,r){_Y(t,e,i,r,Tg.radius)}function vB(t,e,i,r){_Y(t,e,i,r,p0.radius)}function Dy(t,e,i,r){_Y(t,e,i,r,ur.radius)}function bY(t,e,i,r,n){const s=t[e],a=t[e+1],u=t[e+2],p=Math.sqrt(s*s+a*a+u*u),y=Qh(u/(p===0?1:p)),b=Math.atan2(a,s);i[r++]=_S*b,i[r++]=_S*y,i[r]=p-n}function _B(t,e,i,r){bY(t,e,i,r,Tg.radius)}function bB(t,e,i,r){bY(t,e,i,r,p0.radius)}function Ny(t,e,i,r){bY(t,e,i,r,ur.radius)}function O1e(t,e,i,r){Ny(t,e,i,r),yS(i,r,i,r)}function R1e(t,e,i,r){Ny(t,e,i,r),Fy(i,r,i,r)}function f7e(t,e,i,r,n){const s=vS*t[e],a=vS*t[e+1],u=t[e+2],p=Math.sin(a),y=Math.cos(a),b=n.radius/Math.sqrt(1-n.eccentricitySquared*p*p);i[r++]=(b+u)*y*Math.cos(s),i[r++]=(b+u)*y*Math.sin(s),i[r++]=(b*(1-n.eccentricitySquared)+u)*p}function Fy(t,e,i,r){f7e(t,e,i,r,ur)}function ky(t,e,i,r){const n=l7e,s=t[e],a=t[e+1],u=t[e+2];let p,y,b,S,C,O,P,$,N,z,U,j,G,q,W,K,se,ae,le,me,ne;p=Math.abs(u),y=s*s+a*a,b=Math.sqrt(y),S=y+u*u,C=Math.sqrt(S),me=Math.atan2(a,s),O=u*u/S,P=y/S,q=n.a2/C,W=n.a3-n.a4/C,P>.3?($=p/C*(1+P*(n.a1+q+O*W)/C),le=Math.asin($),z=$*$,N=Math.sqrt(1-z)):(N=b/C*(1-O*(n.a5-q-P*W)/C),le=Math.acos(N),z=1-N*N,$=Math.sqrt(z)),U=1-ur.eccentricitySquared*z,j=ur.radius/Math.sqrt(U),G=n.a6*j,q=b-j*N,W=p-G*$,se=N*q+$*W,K=N*W-$*q,ae=K/(G/U+se),le+=ae,ne=se+K*ae/2,u<0&&(le=-le),i[r++]=_S*me,i[r++]=_S*le,i[r]=ne}function M1e(t,e,i,r){ky(t,e,i,r),Dy(i,r,i,r)}function P1e(t,e,i,r){ky(t,e,i,r),yS(i,r,i,r)}function m7e(t,e,i){if(t==null||e==null||i.source.spatialReference===t&&i.dest.spatialReference===e)return i;const r=z4(t,i.source),n=z4(e,i.dest);return r===Te.UNKNOWN&&n===Te.UNKNOWN?Wn(t,e)?i.projector=gn:i.projector=null:i.projector=lT[r][n],i}function I1e(){return{source:{spatialReference:null,spatialReferenceId:Te.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:Te.UNKNOWN,metersPerUnit:1},projector:gn}}const $1e={spatialReference:null,spatialReferenceId:Te.UNKNOWN},g7e={spatialReference:null,spatialReferenceId:Te.UNKNOWN},wY=I1e(),vS=gi(1),_S=wl(1);function Mn(t,e,i,r,n,s,a=1){const u=yY(e,n,wY);if(u==null)return!1;if(u===gn){if(t===r&&i===s)return!0;const y=i+3*a;for(let b=i,S=s;b<y;b++,S++)r[S]=t[b];return!0}const p=i+3*a;for(let y=i,b=s;y<p;y+=3,b+=3)u(t,y,r,b);return!0}const aMt=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:Mn},Symbol.toStringTag,{value:"Module"}));function Nie(t,e,i,r,n,s){return oM[0]=t,oM[1]=e,oM[2]=i,Mn(oM,r,0,n,s,0,1)}const oM=H();let aM=0,pF=class wB{static fromGE(e){const i=new wB;return i._wkt=e.wkt,i._wkid=e.wkid,i._isInverse=e.isInverse,i}constructor(e){this.uid=aM++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=aM++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=aM++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=aM++}getInverse(){const e=new wB;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},lL=class JC{static cacheKey(e,i){return[e.wkid?.toString()??"-1",e.wkt?.toString()??"",e.wkt2?.toString()??"",i.wkid?.toString()??"-1",i.wkt?.toString()??"",i.wkt2?.toString()??""].join()}static fromGE(e){const i=new JC;let r="";for(const n of e.steps){const s=pF.fromGE(n);i.steps.push(s),r+=s.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e?.steps)for(const i of e.steps)i instanceof pF?this.steps.push(i):this.steps.push(new pF({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const e=new JC;e.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const i of this.steps)e+=i.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,i,r){this._cachedProjection[JC.cacheKey(e,i)]=r}getCachedGeTransformation(e,i){let r="";for(const s of this.steps)r+=s.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const n=this._cachedProjection[JC.cacheKey(e,i)];return n===void 0?null:n}};function L1e(t,e,i){if(e==null||i==null||i.vcsWkid||Wn(e,i)||ov(e)||ov(i))return null;const r=aS(e)/aS(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return n=>y7e(n,r);case"polyline":case"esriGeometryPolyline":return n=>_7e(n,r);case"polygon":case"esriGeometryPolygon":return n=>v7e(n,r);case"multipoint":case"esriGeometryMultipoint":return n=>b7e(n,r);case"extent":case"esriGeometryEnvelope":return n=>w7e(n,r);default:return null}}function y7e(t,e){t?.z!=null&&(t.z*=e)}function v7e(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function _7e(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function b7e(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function w7e(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let Ep=null,cv=null,$A=null,_I={};const xY=new VO;function KO(){return!!Ep&&$me()}function x7e(){return!!KO()||(di(xY),bS(),!1)}function bS(t){return $A==null&&($A=Promise.all([Lme(),ke(()=>Promise.resolve().then(()=>HSt),void 0,import.meta.url).then(e=>e.g),ke(()=>Promise.resolve().then(()=>KSt),void 0,import.meta.url)])),$A.then(([,e,{hydratedAdapter:i}])=>{oi(t),cv=i,Ep=e.default,Ep._enableProjection(a6e),xY.notify()})}function F0(t,e,i=null,r=null){return Array.isArray(t)?t.length===0?[]:xB(cv,t,t[0].spatialReference,e,i,r):xB(cv,[t],t.spatialReference,e,i,r)[0]}function xB(t,e,i,r,n=null,s=null){if(i==null||r==null)return e;if($p(i,r,n))return e.map(a=>LA(a,i,r));if(n==null&&Y6(i))return e.map(a=>LA(a,i,dt.WGS84)).map(a=>U4(a,r));if(n==null&&Y6(r))return e.map(a=>U4(a,dt.WGS84)).map(a=>LA(a,dt.WGS84,r));if(n==null){const a=lL.cacheKey(i,r);_I[a]!==void 0?n=_I[a]:((n=N1e(i,r,void 0))==null&&(n=new lL),_I[a]=n)}if(Ep==null||t==null)throw new WD;return s!=null?Ep._project(t,e,i,r,n,s):Ep._project(t,e,i,r,n)}function T7e(t,e){const i=D1e([t],e);return i.pending!=null?{pending:i.pending,geometry:null}:i.geometries!=null?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function D1e(t,e){if(!KO()){for(const i of t)if(i!=null&&!Wn(i.spatialReference,e)&&Fa(i.spatialReference)&&Fa(e)&&!$p(i.spatialReference,e))return di(xY),{pending:bS(),geometries:null}}return{pending:null,geometries:t.map(i=>i==null?null:Wn(i.spatialReference,e)?i:Fa(i.spatialReference)&&Fa(e)?U4(i,e):null)}}function N1e(t,e,i=null){if(t==null||e==null)return null;if(Ep==null||cv==null)throw new WD;const r=Ep._getTransformation(cv,t,e,i,i?.spatialReference);return r!==null?lL.fromGE(r):null}function S7e(t,e,i=null){if(Ep==null||cv==null)throw new WD;const r=Ep._getTransformationBySuitability(cv,t,e,i,i?.spatialReference);if(r!==null){const n=[];for(const s of r)n.push(lL.fromGE(s));return n}return[]}let WD=class extends de{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function E7e(){Ep=null,cv=null,$A=null,_I={}}const C7e={get loadPromise(){return $A}};function U4(t,e){try{const i=F0(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=L1e(i.type,t.spatialReference,e);return r?.(i),i}catch(i){if(!(i instanceof WD))throw i;return null}}async function C0(t,e,i){const r=t.spatialReference;return r!=null&&e!=null&&await TY(r,e,null,i),U4(t,e)}function $p(t,e,i){return!i&&(!!Wn(t,e)||Fa(t)&&Fa(e)&&!!yY(t,e,wY))}async function TY(t,e,i,r){if(KO())return Ite(r);if(Array.isArray(t)){for(const{source:n,dest:s,geographicTransformation:a}of t)if(!$p(n,s,a))return bS(r)}else if(!$p(t,e,i))return bS(r);return Ite(r)}function LA(t,e,i){return t?"x"in t?k1e(t,e,new Wt,i,0):"xmin"in t?B1e(t,e,new rr,i,0):"rings"in t?j1e(t,e,new nd,i,0):"paths"in t?U1e(t,e,new Vh,i,0):"points"in t?z1e(t,e,new vw,i,0):null:null}function F1e(t,e,i=e.spatialReference,r=0){return i!=null&&t.spatialReference!=null&&k1e(t,t.spatialReference,e,i,r)!=null}function k1e(t,e,i,r,n){cl[0]=t.x,cl[1]=t.y;const s=t.z;return cl[2]=s!==void 0?s:n,Mn(cl,e,0,cl,r,0,1)?(i.x=cl[0],i.y=cl[1],i.spatialReference=r,s!==void 0||ov(r)?(i.z=cl[2],i.hasZ=!0):(i.z=void 0,i.hasZ=!1),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function A7e(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&z1e(t,t.spatialReference,e,i,r)!=null}function z1e(t,e,i,r,n){const{points:s,hasZ:a,hasM:u}=t,p=[],y=s.length,b=[];for(const C of s)b.push(C[0],C[1],a?C[2]:n);if(!Mn(b,e,0,b,r,0,y))return null;const S=a||ov(r);for(let C=0;C<y;++C){const O=3*C,P=b[O],$=b[O+1];S&&u?p.push([P,$,b[O+2],s[C][3]]):S?p.push([P,$,b[O+2]]):u?p.push([P,$,s[C][2]]):p.push([P,$])}return i.points=p,i.spatialReference=r,i.hasZ=a,i.hasM=u,i}function O7e(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&U1e(t,t.spatialReference,e,i,r)!=null}function U1e(t,e,i,r,n){const{paths:s,hasZ:a,hasM:u}=t,p=[];if(!V1e(s,a??!1,u??!1,e,p,r,n))return null;const y=a||ov(r);return i.paths=p,i.spatialReference=r,i.hasZ=y,i.hasM=u,i}function R7e(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&j1e(t,t.spatialReference,e,i,r)!=null}function j1e(t,e,i,r,n){const{rings:s,hasZ:a,hasM:u}=t,p=[];if(!V1e(s,a??!1,u??!1,e,p,r,n))return null;const y=a||ov(r);return i.rings=p,i.spatialReference=r,i.hasZ=y,i.hasM=u,i}function M7e(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&B1e(t,t.spatialReference,e,i,r)!=null}function B1e(t,e,i,r,n){const{xmin:s,ymin:a,xmax:u,ymax:p,hasZ:y,hasM:b}=t,S=y?t.zmin:n;if(!Nie(s,a,S,e,cl,r))return null;const C=y||ov(r);i.xmin=cl[0],i.ymin=cl[1],C&&(i.zmin=cl[2]);const O=y?t.zmax:n;return Nie(u,p,O,e,cl,r)?(i.xmax=cl[0],i.ymax=cl[1],C&&(i.zmax=cl[2]),b&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null}function V1e(t,e,i,r,n,s,a=0){const u=new Array;for(const b of t)for(const S of b)u.push(S[0],S[1],e?S[2]:a);if(!Mn(u,r,0,u,s,0,u.length/3))return!1;let p=0;n.length=0;const y=e||ov(s);for(const b of t){const S=new Array;for(const C of b)y&&i?S.push([u[p++],u[p++],u[p++],C[3]]):y?S.push([u[p++],u[p++],u[p++]]):i?(S.push([u[p++],u[p++],C[2]]),p++):(S.push([u[p++],u[p++]]),p++);n.push(S)}return!0}function uv(t){return t!=null&&S1e(t)!=null}const cl=H(),cMt=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:uv,canProjectWithoutEngine:$p,getTransformation:N1e,getTransformations:S7e,initializeProjection:TY,isLoaded:KO,isLoadedOrLoad:x7e,load:bS,project:F0,projectExtent:M7e,projectMany:xB,projectMultipoint:A7e,projectOrLoad:T7e,projectOrLoadMany:D1e,projectPoint:F1e,projectPolygon:R7e,projectPolyline:O7e,projectWithZConversion:C0,projectWithoutEngine:LA,test:C7e,tryProjectWithZConversion:U4,unload:E7e},Symbol.toStringTag,{value:"Module"}));function hv(t,e){const i=e?.url?.path;if(t&&i&&(t=fl(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const r=wJ(t,e.portalItem.itemUrl);r!=null&&P7e.test(r)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(r).path)}return TB(t,e?.portal)}function H2(t,e,i=j4.YES){if(t==null)return t;!ju(t)&&e?.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let r=fl(t);if(e){const n=e.verifyItemRelativeUrls?.rootPath||e.url?.path;if(n){const s=TB(n,e.portal),a=TB(r,e.portal);r=wJ(a,s,s),r!=null&&r!==a&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=H1e(r,e?.portal),ju(r)&&(r=Uu(r)),e?.resources&&e?.portalItem&&!ju(r)&&!$0(r)&&i===j4.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function XD(t,e,i){return hv(t,i)}function Eg(t,e,i,r){const n=H2(t,r);n!==void 0&&(e[i]=n)}const G1e=/\/items\/([^\/]+)\/resources\/(.*)/,P7e=/^\.\/resources\//;function I7e(t){return(t?.match(G1e)??null)?.[1]??null}function $7e(t){const e=t?.match(G1e)??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:a,extension:u}=Hte(i);return{prefix:null,filename:a,extension:u}}const{path:n,extension:s}=Hte(i.slice(r+1));return{prefix:i.slice(0,r),filename:n,extension:s}}function H1e(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?Lj(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function TB(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=vJ();return Tc(r,`${r.scheme}://${i}`)?Lj(t,e.portalHostname,i):Lj(t,i,e.portalHostname)}var j4;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(j4||(j4={}));const uMt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return j4},ensureMainOnlineDomain:H1e,fromJSON:hv,itemIdFromResourceUrl:I7e,prefixAndFilenameFromResourceUrl:$7e,read:XD,toJSON:H2,write:Eg},Symbol.toStringTag,{value:"Module"})),q1e={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},W1e=Object.values(q1e),X1e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${W1e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),L7e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${W1e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),D7e=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function hMt(t){return!!X1e.test(t)}function uE(t){if(t==null)return null;const e=Nn(t),i=e?.path.match(X1e)||e?.path.match(L7e);if(!i)return null;const[,r,n,s,a]=i,u=n.indexOf("/");return{title:SY(u!==-1?n.slice(u+1):n),serverType:q1e[s.toLowerCase()],sublayer:a!=null&&a!==""?parseInt(a,10):null,url:{path:r}}}function N7e(t){const e=Nn(t).path.match(D7e);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function SY(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function F7e(t,e){const i=[];if(t){const r=uE(t);r!=null&&r.title&&i.push(r.title)}if(e){const r=SY(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function J1e(t){if(!t)return!1;const e=".arcgis.com/",i="//services",r="//tiles",n="//features",s=(t=t.toLowerCase()).includes(e),a=t.includes(i)||t.includes(r)||t.includes(n);return s&&a}function k7e(t,e){return t&&_me(wme(t,e))}function z7e(t){let{url:e}=t;if(!e)return{url:e};e=wme(e,t.logger);const i=Nn(e),r=uE(i.path);let n;if(r!=null)r.sublayer!=null&&t.layer.layerId==null&&(n=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const s=N7e(i.path);s!=null&&(e=s.serviceUrl,n=s.sublayerId)}return{url:_me(e),layerId:n}}function U7e(t,e,i,r,n){Eg(e,r,"url",n),r.url&&t.layerId!=null&&(r.url=Kh(r.url,i,t.layerId.toString()))}function dMt(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),n=e.includes("/imageserver/wmsserver"),s=e.includes("/wmsserver");return i&&(r||n||s)}function j7e(t,e){if(!t)return null;if(!SB(t))return new de("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:t});const i=t.heightUnit,r=$v.deriveUnitFromSR(t,e).heightUnit;return i!==r?new de("webscene:incompatible-height-unit",`The vertical units of the scene (${i}) must match the horizontal units of the scene (${r})`,{verticalUnit:i,horizontalUnit:r}):null}function pMt(t,e,i){const r=Y1e(t),n=e,s=B7e(r,n,i);if(r){const a=$v.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&a!==r.heightUnit){const u=new de("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${a})`,{horizontalUnit:a});return new de("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:u})}}if(!V7e(t)||s===Ec.Unsupported)return new de("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(s){case Ec.Units:{const a=r?.heightUnit||"unknown",u=n?.heightUnit||"unknown",p=new de("layerview:incompatible-height-unit",`The vertical units of the layer (${a}) must match the vertical units of the scene (${u})`,{layerUnit:a,sceneUnit:u});return new de("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:p})}case Ec.HeightModel:{const a=r?.heightModel||"unknown",u=n?.heightModel||"unknown",p=new de("layerview:incompatible-height-model",`The height model of the layer (${a}) must match the height model of the scene (${u})`,{layerHeightModel:a,sceneHeightModel:u});return new de("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:p})}case Ec.CRS:{const a=r?.vertCRS||"unknown",u=n?.vertCRS||"unknown",p=new de("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${a}) must match the vertical datum of the scene (${u})`,{layerDatum:a,sceneDatum:u});return new de("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:p})}}return null}function B7e(t,e,i){if(!SB(t)||!SB(e))return Ec.Unsupported;if(t==null||e==null)return Ec.Ok;if(!i&&t.heightUnit!==e.heightUnit)return Ec.Units;if(t.heightModel!==e.heightModel)return Ec.HeightModel;switch(t.heightModel){case"gravity-related-height":return Ec.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Ec.Ok:Ec.CRS;default:return Ec.Unsupported}}var Ec;function SB(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function V7e(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!Q1e(t)}function Y1e(t){const e=t.url?uE(t.url):void 0;return!(t.spatialReference?.vcsWkid==null&&e!=null&&e.serverType==="ImageServer")&&Z1e(t)&&t.heightModelInfo?t.heightModelInfo:Q1e(t)?$v.deriveUnitFromSR(H7e,t.spatialReference):null}function Z1e(t){return"heightModelInfo"in t}function K1e(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function Q1e(t){return K1e(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):eye(t)}function G7e(t){return t.layers!=null||eye(t)||K1e(t)||Z1e(t)}function eye(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Ec||(Ec={}));const H7e=new $v({heightModel:"gravity-related-height"});async function q7e(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return aT(t);const i=dt.WGS84;return await TY(e,i),F0(t,i)}function W7e(t,e){if(!tye(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function tye(t,e){return!!t.typeKeywords?.includes(e)}function fMt(t){return tye(t,EB.HOSTED_SERVICE)}function X7e(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}function Fie(t,e,i){i?W7e(t,e):X7e(t,e)}async function mMt(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return q7e(i)}const EB={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function kie(t){const{portal:e,isOrgItem:i,itemControl:r}=t,n=e.user?.privileges;let s=!n||n.includes("features:user:edit"),a=!!i&&!!n?.includes("features:user:fullEdit");const u=r==="update"||r==="admin";return u?a=s=!0:a&&(s=!0),{features:{edit:s,fullEdit:a},content:{updateItem:u}}}let B1=class extends Ne{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};_([T({type:String,json:{write:!0}})],B1.prototype,"facilityIdField",void 0),_([T({type:String,json:{write:!0}})],B1.prototype,"layerId",void 0),_([T({type:String,json:{write:!0}})],B1.prototype,"nameField",void 0),_([T({type:String,json:{write:!0}})],B1.prototype,"siteIdField",void 0),_([T({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],B1.prototype,"sublayerId",void 0),B1=_([Z("esri.layers.support.FacilityLayerInfo")],B1);const J7e=B1;let Id=class extends Ne{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};_([T({type:String,json:{write:!0}})],Id.prototype,"facilityIdField",void 0),_([T({type:String,json:{write:!0}})],Id.prototype,"layerId",void 0),_([T({type:String,json:{write:!0}})],Id.prototype,"levelIdField",void 0),_([T({type:String,json:{write:!0}})],Id.prototype,"levelNumberField",void 0),_([T({type:String,json:{write:!0}})],Id.prototype,"longNameField",void 0),_([T({type:String,json:{write:!0}})],Id.prototype,"shortNameField",void 0),_([T({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Id.prototype,"sublayerId",void 0),_([T({type:String,json:{write:!0}})],Id.prototype,"verticalOrderField",void 0),Id=_([Z("esri.layers.support.LevelLayerInfo")],Id);const Y7e=Id;let N_=class extends Ne{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};_([T({type:String,json:{write:!0}})],N_.prototype,"layerId",void 0),_([T({type:String,json:{write:!0}})],N_.prototype,"nameField",void 0),_([T({type:String,json:{write:!0}})],N_.prototype,"siteIdField",void 0),_([T({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],N_.prototype,"sublayerId",void 0),N_=_([Z("esri.layers.support.SiteLayerInfo")],N_);const Z7e=N_;let sx=class extends Ne{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};_([T({type:Y7e,json:{write:!0}})],sx.prototype,"levelLayer",void 0),_([T({type:J7e,json:{write:!0}})],sx.prototype,"facilityLayer",void 0),_([T({type:Z7e,json:{write:!0}})],sx.prototype,"siteLayer",void 0),sx=_([Z("esri.support.MapFloorInfo")],sx);const K7e=sx,Q7e=Symbol("WebScene"),eNe="webscene:failed-to-copy-embedded-resources",tNe="webscene:schema-validation";function iNe(){return new de(eNe,"Copying of embedded resources is currently not supported")}function rNe(t){return new de(tNe,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:t})}var ht;function zie(t){return t==="global"?ht.Global:ht.Local}function fF(t){return t===ht.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(ht||(ht={}));function B4(t,e){return t!=null&&(e==null||(e===ht.Local?!t.isGeographic||t.isWGS84||t.wkid===jh.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===jh.CGCS2000||t.wkid===jh.GCSMARS2000||t.wkid===jh.GCSMARS2000_SPHERE||t.wkid===jh.GCSMOON2000))}var Nc;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(Nc||(Nc={}));function Uie(t){if(vr.apiKey&&AJ(t.portal.url))throw new de("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${t.portal.url} when using an api key`)}const nNe="randomUUID"in crypto;function EY(){if(nNe)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function sNe(){return`{${EY()}}`}async function oNe(t,e={},i){await t.load(i);const r=Kh(t.itemUrl,"resources"),{start:n=1,num:s=10,sortOrder:a="asc",sortField:u="created"}=e,p={query:{start:n,num:s,sortOrder:a,sortField:u,token:t.apiKey},signal:i?.signal},y=await t.portal.request(r,p);return{total:y.total,nextStart:y.nextStart,resources:y.resources.map(({created:b,size:S,resource:C})=>({created:new Date(b),size:S,resource:t.resourceFromPath(C)}))}}async function aNe(t,e,i,r){if(!t.hasPath())throw new de(`portal-item-resource-${e}:invalid-path`,"Resource does not have a valid path");const n=t.portalItem;await n.load(r);const s=Kh(n.userItemUrl,e==="add"?"addResources":"updateResources"),[a,u]=iye(t.path),p=new FormData;return a&&a!=="."&&p.append("resourcesPrefix",a),r!=null&&r.compress&&p.append("compress","true"),p.append("fileName",u),p.append("file",i,u),p.append("f","json"),r?.access&&p.append("access",r.access),await n.portal.request(s,{method:"post",body:p,signal:r?.signal}),t}async function lNe(t,e,i){if(!e.hasPath())throw new de("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(i);const r=Kh(t.userItemUrl,"removeResources");await t.portal.request(r,{method:"post",query:{resource:e.path},signal:i?.signal}),e.portalItem=null}async function cNe(t,e){await t.load(e);const i=Kh(t.userItemUrl,"removeResources");return t.portal.request(i,{method:"post",query:{deleteAll:!0},signal:e?.signal})}function iye(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function CY(t){const[e,i]=uNe(t),[r,n]=iye(e);return[r,n,i]}function uNe(t){const e=S$e(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function AY(t){return t.type==="blob"?t.blob:t.type==="json"?new Blob([t.jsonString],{type:"application/json"}):(await ir(t.url,{responseType:"blob"})).data}function hNe(t,e){if(!t.hasPath())return null;const[i,,r]=CY(t.path);return t.portalItem.resourceFromPath(Kh(i,e+r))}function rye(t,e){if(!t.hasPath())return null;const[i,,r]=CY(t.path);return t.portalItem.resourceFromPath(Kh(i,e+r))}const YC=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResource:aNe,contentToBlob:AY,fetchResources:oNe,getSiblingOfSameType:hNe,getSiblingOfSameTypeI:rye,removeAllResources:cNe,removeResource:lNe,splitPrefixFileNameAndExtension:CY},Symbol.toStringTag,{value:"Module"}));async function dNe(t,e,i=null){const r=await nye(t,e,i);await sye(r,e,i)}async function pNe(t,e,i,r,n=null){const s=await nye(i,r,n);await t.update({data:e}),await sye(s,r,n)}async function nye(t,e,i=null){if(!e?.resources)return;const r=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const n=new Set(e.resources.toKeep.map(p=>p.resource.path)),s=new Set,a=[];n.forEach(p=>{r.delete(p),t.paths.push(p)});for(const p of e.resources.toUpdate)if(r.delete(p.resource.path),n.has(p.resource.path)||s.has(p.resource.path)){const{resource:y,content:b,finish:S,error:C}=p,O=rye(y,EY());t.paths.push(O.path),a.push(jie({resource:O,content:b,compress:p.compress,finish:S,error:C},i))}else t.paths.push(p.resource.path),a.push(fNe(p,i)),s.add(p.resource.path);for(const p of e.resources.toAdd)t.paths.push(p.resource.path),r.has(p.resource.path)?r.delete(p.resource.path):a.push(jie(p,i));if(a.length===0)return r;const u=await U9e(a);if(oi(i),u.length>0)throw new de("save:resources","Failed to save one or more resources",{errors:u});return r}async function sye(t,e,i=null){if(!t||!e.portalItem)return;const r=[];for(const n of t){const s=e.portalItem.resourceFromPath(n);r.push(s.portalItem.removeResource(s,i))}await zO(r)}async function jie(t,e){const i={...e??{},compress:t.compress},r=await Gc(t.resource.portalItem.addResource(t.resource,await AY(t.content),i));if(r.ok!==!0)throw t.error?.(r.error),r.error;t.finish?.(t.resource)}async function fNe(t,e){const i=await Gc(t.resource.update(await AY(t.content),e));if(i.ok!==!0)throw t.error?.(i.error),i.error;t.finish?.(t.resource)}async function bMt(t){const e=[];for(const i of t.allLayers)if("beforeSave"in i&&typeof i.beforeSave=="function"){const r=i.beforeSave();r&&e.push(r)}await Promise.allSettled(e)}const mNe={width:600,height:400},lM=1.5;function gNe(t,e){e=e||mNe;let{width:i,height:r}=e;const n=i/r;return n<lM?r=i/lM:n>lM&&(i=r*lM),i>t.width&&(r*=t.width/i,i=t.width),r>t.height&&(i*=t.height/r,r=t.height),{width:Math.round(i),height:Math.round(r)}}function Bie(t){return{enabled:!!t?.length}}const OY=new br({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var CB;let ox=CB=class extends Ne{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new CB({exactMatch:this.exactMatch,type:this.type,name:this.name})}};_([T({type:Boolean,json:{write:!0}})],ox.prototype,"exactMatch",void 0),_([T({type:String,json:{write:!0}})],ox.prototype,"name",void 0),_([Bt(OY)],ox.prototype,"type",void 0),ox=CB=_([Z("esri.webdoc.applicationProperties.SearchLayerField")],ox);const yNe=ox;var AB;let ax=AB=class extends Ne{constructor(t){super(t),this.field=null,this.id=null,this.subLayer=null}clone(){return new AB(Ce({field:this.field,id:this.id,subLayer:this.subLayer}))}};_([T({type:yNe,json:{write:{isRequired:!0}}})],ax.prototype,"field",void 0),_([T({type:String,json:{write:{isRequired:!0}}})],ax.prototype,"id",void 0),_([T({type:Wr,json:{write:!0}})],ax.prototype,"subLayer",void 0),ax=AB=_([Z("esri.webdoc.applicationProperties.SearchLayer")],ax);const vNe=ax;var OB;let lx=OB=class extends Ne{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new OB({exactMatch:this.exactMatch,type:this.type,name:this.name})}};_([T({type:Boolean,json:{write:!0}})],lx.prototype,"exactMatch",void 0),_([T({type:String,json:{write:!0}})],lx.prototype,"name",void 0),_([Bt(OY)],lx.prototype,"type",void 0),lx=OB=_([Z("esri.webdoc.applicationProperties.SearchTableField")],lx);const _Ne=lx;var RB;let ZC=RB=class extends Ne{constructor(t){super(t),this.field=null,this.id=null}clone(){return new RB(Ce({field:this.field,id:this.id}))}};_([T({type:_Ne,json:{write:{isRequired:!0}}})],ZC.prototype,"field",void 0),_([T({type:String,json:{write:{isRequired:!0}}})],ZC.prototype,"id",void 0),ZC=RB=_([Z("esri.webdoc.applicationProperties.SearchTable")],ZC);const bNe=ZC;var MB;const oye=Dt.ofType(vNe),aye=Dt.ofType(bNe);let Tf=MB=class extends Ne{constructor(t){super(t),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new oye,this.tables=new aye}readAddressSearchEnabled(t){return!t}writeAddressSearchEnabled(t,e,i){e[i]=!t}clone(){return new MB(Ce({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};_([T({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],Tf.prototype,"addressSearchEnabled",void 0),_([rt("addressSearchEnabled")],Tf.prototype,"readAddressSearchEnabled",null),_([ot("addressSearchEnabled")],Tf.prototype,"writeAddressSearchEnabled",null),_([T({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],Tf.prototype,"enabled",void 0),_([T({type:String,json:{write:!0}})],Tf.prototype,"hintText",void 0),_([T({type:oye,json:{write:{overridePolicy:Bie},origins:{"web-scene":{write:{isRequired:!0}}}}})],Tf.prototype,"layers",void 0),_([T({type:aye,json:{read:!0,write:{overridePolicy:Bie}}})],Tf.prototype,"tables",void 0),Tf=MB=_([Z("esri.webdoc.applicationProperties.Search")],Tf);const wNe=Tf;var PB;let bI=PB=class extends Ne{constructor(t){super(t),this.search=null}clone(){return new PB(Ce({search:this.search}))}};_([T({type:wNe,json:{write:!0}})],bI.prototype,"search",void 0),bI=PB=_([Z("esri.webdoc.applicationProperties.Viewing")],bI);const xNe=bI;var IB;let wI=IB=class extends Ne{constructor(t){super(t),this.viewing=null}clone(){return new IB({viewing:this.viewing?this.viewing.clone():null})}};_([T({type:xNe,json:{write:!0}})],wI.prototype,"viewing",void 0),wI=IB=_([Z("esri.webscene.ApplicationProperties")],wI);const TNe=wI;var $B;let KC=$B=class extends Ne{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new $B({cloudCover:this.cloudCover})}};_([Bt({sunny:"sunny"})],KC.prototype,"type",void 0),_([T({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],KC.prototype,"cloudCover",void 0),KC=$B=_([Z("esri.views.3d.environment.SunnyWeather")],KC);const cL=KC;var LB;let QC=LB=class extends Ne{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new LB({cloudCover:this.cloudCover})}};_([Bt({cloudy:"cloudy"})],QC.prototype,"type",void 0),_([T({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],QC.prototype,"cloudCover",void 0),QC=LB=_([Z("esri.views.3d.environment.CloudyWeather")],QC);const SNe=QC;var DB;let e5=DB=class extends Ne{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new DB({fogStrength:this.fogStrength})}};_([Bt({foggy:"foggy"})],e5.prototype,"type",void 0),_([T({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],e5.prototype,"fogStrength",void 0),e5=DB=_([Z("esri.views.3d.environment.FoggyWeather")],e5);const ENe=e5;var NB;let cx=NB=class extends Ne{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new NB({cloudCover:this.cloudCover,precipitation:this.precipitation})}};_([Bt({rainy:"rainy"})],cx.prototype,"type",void 0),_([T({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],cx.prototype,"cloudCover",void 0),_([T({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],cx.prototype,"precipitation",void 0),cx=NB=_([Z("esri.views.3d.environment.RainyWeather")],cx);const CNe=cx;var FB;let F_=FB=class extends Ne{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new FB({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};_([Bt({snowy:"snowy"})],F_.prototype,"type",void 0),_([T({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],F_.prototype,"cloudCover",void 0),_([T({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],F_.prototype,"precipitation",void 0),_([T({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],F_.prototype,"snowCover",void 0),F_=FB=_([Z("esri.views.3d.environment.SnowyWeather")],F_);const ANe=F_,RY={key:"type",base:cL,typeMap:{sunny:cL,cloudy:SNe,rainy:CNe,snowy:ANe,foggy:ENe}},ONe=Object.keys(RY.typeMap);function RNe(t,e){return!!ONe.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const Ym=1e4,MNe=1e5;var kB;let mh=kB=class extends Ne{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,i){e[i]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,i){t&&(e[i]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new kB(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};_([T({readOnly:!0,type:["sun"],json:{write:!0}})],mh.prototype,"type",void 0),_([T({type:Date,json:{type:Number,write:{target:"datetime"}}})],mh.prototype,"date",void 0),_([rt("date",["datetime"])],mh.prototype,"readDate",null),_([ot("date")],mh.prototype,"writeDate",null),_([T({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],mh.prototype,"directShadowsEnabled",void 0),_([rt("directShadowsEnabled",["directShadows"])],mh.prototype,"readDirectShadowsEnabled",null),_([ot("directShadowsEnabled")],mh.prototype,"writedirectShadowsEnabled",null),_([T({type:Number,json:{write:!0}})],mh.prototype,"displayUTCOffset",void 0),_([ot("displayUTCOffset")],mh.prototype,"writeDisplayUTCOffset",null),mh=kB=_([Z("esri.webscene.SunLighting")],mh);const q2=mh;var zB;let t5=zB=class extends Ne{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new zB(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};_([T({readOnly:!0,type:["virtual"],json:{write:!0}})],t5.prototype,"type",void 0),_([T({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],t5.prototype,"directShadowsEnabled",void 0),t5=zB=_([Z("esri.webscene.VirtualLighting")],t5);const QO=t5,lye={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:q2,virtual:QO}};let xI=class extends Ne{constructor(e){super(e)}clone(){}};_([T({readOnly:!0,json:{read:!1}})],xI.prototype,"type",void 0),xI=_([Z("esri.webscene.background.Background")],xI);const cye=xI;function PNe(t,e){const i=e.transparency!=null?hS(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new mt([r[0]||0,r[1]||0,r[2]||0,i]):null}function INe(t,e){e.color=t.toJSON().slice(0,3);const i=XO(t.a);i!==0&&(e.transparency=i)}const Fg={type:mt,json:{type:[Wr],default:null,read:{source:["color","transparency"],reader:PNe},write:{target:{color:{type:[Wr]},transparency:{type:Wr}},writer:INe}}},A0={type:Number,cast:Br,json:{write:!0}};var UB;const $Ne={...Fg,nonNullable:!0};let i5=UB=class extends cye{constructor(t){super(t),this.type="color",this.color=new mt([0,0,0,1])}clone(){return new UB(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};_([Bt({color:"color"},{readOnly:!0})],i5.prototype,"type",void 0),_([T($Ne)],i5.prototype,"color",void 0),i5=UB=_([Z("esri.webscene.background.ColorBackground")],i5);const uye=i5,Vie={base:cye,key:"type",typeMap:{color:uye}};function LNe(t){return(e,i,r)=>{if(!e)return e;for(const n in t.typeMap)if(e.type===n){const s=new t.typeMap[n];return s.read(e,r),s}}}const DNe={types:Vie,json:{read:LNe(Vie),write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.isPresentation})}}};var jB;const hye="esri.webscene.Environment",NNe=Ee.getLogger(hye),Gie=(t,e,i)=>({enabled:!i||!i.isPresentation});let V1=jB=class extends Ne{constructor(t){super(t),this.lighting=new q2,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){RNe(t?.type,NNe)&&this._set("weather",t)}clone(){return new jB(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?QO.prototype.clone.call(this.lighting):q2.prototype.clone.call(this.lighting),background:Ce(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};_([T({types:lye,nonNullable:!0,json:{write:!0}})],V1.prototype,"lighting",void 0),_([T(DNe)],V1.prototype,"background",void 0),_([T({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Gie}}})],V1.prototype,"atmosphereEnabled",void 0),_([T({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Gie}}})],V1.prototype,"starsEnabled",void 0),_([T({types:RY,nonNullable:!0,json:{write:!0},value:new cL})],V1.prototype,"weather",null),V1=jB=_([Z(hye)],V1);const wS=V1;var BB;let k_=BB=class extends Ne{constructor(t){super(t),this.environment=new wS,this.spatialReference=null,this.viewpoint=null}set viewingMode(t){this._set("viewingMode",t)}clone(){return new BB({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})}};_([T({type:wS,json:{write:{isRequired:!0}}})],k_.prototype,"environment",void 0),_([T({type:dt})],k_.prototype,"spatialReference",void 0),_([T({type:["local","global"]})],k_.prototype,"viewingMode",null),_([T({type:qc,json:{write:{isRequired:!0}}})],k_.prototype,"viewpoint",void 0),k_=BB=_([Z("esri.webscene.InitialViewProperties")],k_);const uL=k_;let FNe=class{constructor(e,i){this._observable=new VO,this._value=e,this._equalityFunction=i}get value(){return di(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function xS(t,e=c0e){return new FNe(t,e)}let kNe=class{constructor(){this._tasks=new Array,this._running=xS(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return this._running.value=!0,new Promise((n,s)=>this._tasks.push(new Hie(n,s,e,i,r)))}unshift(e,i,r){return this._running.value=!0,new Promise((n,s)=>this._tasks.unshift(new Hie(n,s,e,i,r)))}_process(e){if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const r=Ms(i.signal);if(r&&!i.abortCallback)i.reject(or());else{const n=r?i.abortCallback?.(or()):i.callback(e);Yc(n)?n.then(i.resolve,i.reject):i.resolve(n)}}catch(r){i.reject(r)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const e=or();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(e);i.resolve(r)}else i.reject(e);this._tasks.length=0,this._running.value=!1}},Hie=class{constructor(e,i,r,n=void 0,s=void 0){this.resolve=e,this.reject=i,this.callback=r,this.signal=n,this.abortCallback=s}},r5=class extends Ke{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};_([T()],r5.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),_([T()],r5.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),r5=_([Z("esri.views.support.DebugFlags")],r5);const zNe=new r5;var yr;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(yr||(yr={}));function UNe(){return new hL.Scheduler}var ya,Zt;(function(t){t[t.YIELD=1]="YIELD"})(ya||(ya={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"}(Zt||(Zt={}));const Kf=0,qie=new Map([[Zt.RESOURCE_CONTROLLER_IMMEDIATE,Kf],[Zt.RESOURCE_CONTROLLER,4],[Zt.SLIDE,Kf],[Zt.STREAM_DATA_LOADER,Kf],[Zt.ELEVATION_QUERY,Kf],[Zt.TERRAIN_SURFACE,1],[Zt.SURFACE_GEOMETRY_UPDATES,1],[Zt.LOD_RENDERER,2],[Zt.GRAPHICS_CORE,2],[Zt.I3S_CONTROLLER,2],[Zt.POINT_CLOUD_LAYER,2],[Zt.FEATURE_TILE_FETCHER,2],[Zt.OVERLAY,4],[Zt.STAGE,4],[Zt.GRAPHICS_DECONFLICTOR,4],[Zt.FILTER_VISIBILITY,4],[Zt.SCALE_VISIBILITY,4],[Zt.FRUSTUM_VISIBILITY,4],[Zt.CLOUDS_GENERATOR,4],[Zt.POINT_OF_INTEREST_FREQUENT,6],[Zt.POINT_OF_INTEREST_INFREQUENT,30],[Zt.LABELER,8],[Zt.FEATURE_QUERY_ENGINE,8],[Zt.FEATURE_TILE_TREE,16],[Zt.FEATURE_TILE_TREE_ACTIVE,Kf],[Zt.ELEVATION_ALIGNMENT,12],[Zt.TEXT_TEXTURE_ATLAS,12],[Zt.TEXTURE_UNLOAD,12],[Zt.LINE_OF_SIGHT_TOOL,16],[Zt.LINE_OF_SIGHT_TOOL_INTERACTIVE,Kf],[Zt.SNAPPING,Kf],[Zt.SHADOW_ACCUMULATOR,30]]);function Wie(t){return qie.has(t)?qie.get(t):typeof t=="number"?t:1}const Xie=6.5,Jie=1,jNe=30,Yie=1e3/30,Zie=100,Kie=.9;var hL,Wv;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(s=>s.needsUpdate)}constructor(){this._updating=xS(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new ig("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=yr.INTERACTING,this._tasks=new xi,this._runQueue=new xi,this._load=0,this._idleStateCallbacks=new xi,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=Fe(()=>zNe.SCHEDULER_LOG_SLOW_TASKS,a=>this._debug=a,jr);for(const a of Object.keys(Zt))this.performanceInfo.tasks.set(Zt[a],new ig(Zt[a]));const s=this;this._test={FRAME_SAFETY_BUDGET:Xie,INTERACTING_BUDGET:Yie,IDLE_BUDGET:Zie,get availableBudget(){return s._budget.budget},usedBudget:0,getBudget:()=>s._budget,setBudget:a=>s._budget=a,updateTask:a=>this._updateTask(a),getState:a=>this._getState(a),getRuntime:a=>this._getRuntime(a),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),nn(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(s){this._updatingChanged(),s&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(s,a){const u=Wie(s),p=new i(this,s,a,u);return this._tasks.push(p),this._updatingChanged(),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new ig(s)),p}registerIdleStateCallbacks(s,a){const u={idleBegin:s,idleEnd:a};this._idleStateCallbacks.push(u),this.state===yr.IDLE&&this._idleUpdatesStartFired&&u.idleBegin();const p=this;return{remove:()=>this._removeIdleStateCallbacks(u),set idleBegin(y){p._idleUpdatesStartFired&&(u.idleEnd(),p._state===yr.IDLE&&y()),u.idleBegin=y},set idleEnd(y){u.idleEnd=y}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==yr.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(a=>a.idleEnd())))}get state(){return this._state}updateBudget(s){this._test.usedBudget=0,++this._frameNumber;let a=Xie,u=s.frameDuration,p=Jie;switch(this.state){case yr.IDLE:a=0,u=Math.max(Zie,s.frameDuration),p=jNe;break;case yr.INTERACTING:u=Math.max(Yie,s.frameDuration);case yr.ANIMATING:}return u=u-s.elapsedFrameTime-a,this.state!==yr.IDLE&&u<Jie&&!this._forceTask?(this._forceTask=!0,!1):(u=Math.max(u,p),this._budget.reset(u,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case yr.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case yr.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s),this._updatingChanged()}_updateTask(s){this._tasks.forAll(a=>{a.name===s&&a.setPriority(s)})}_getState(s){if(this._runQueue.some(u=>u.name===s))return Wv.SCHEDULED;let a=Wv.IDLE;return this._tasks.forAll(u=>{u.name===s&&u.needsUpdate&&(u.schedulePriority<=1?a=Wv.READY:a!==Wv.READY&&(a=Wv.WAITING))}),a}_getRuntime(s){let a=0;return this._tasks.forAll(u=>{u.name===s&&(a+=u.runtime)}),a}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(u=>{u.needsUpdate&&s.set(u.name,(s.get(u.name)||0)+1)}),s.size===0)return null;let a="";return s.forEach((u,p)=>{a+=u>1?` ${u}x ${p}`:` ${p}`}),a}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((a,u)=>u.needsUpdate?++a:a,0);this._load=this._load*Kie+s*(1-Kie)}_schedule(){for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===Kf&&s.needsUpdate&&!this._runQueue.includes(s)&&s.blockFrame!==this._frameNumber&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,a=0;if(this._tasks.forAll(u=>{u.needsUpdate&&u.schedulePriority!==0&&u.basePriority!==Kf&&u.blockFrame!==this._frameNumber&&(s=!0,a=Math.max(a,u.basePriority),u.schedulePriority===1?(u.schedulePriority=0,this._runQueue.push(u)):--u.schedulePriority)}),!s)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const a=this._budget.now(),u=this._runQueue.pop();this._budget.resetProgress();try{u.task.runTask(this._budget)===ya.YIELD&&(u.blockFrame=this._frameNumber)}catch(y){Ee.getLogger("esri.views.support.Scheduler").error(`Exception in task "${u.name}"`,y),u.blockFrame=this._frameNumber}!this._budget.hasProgressed&&u.blockFrame!==this._frameNumber&&u.needsUpdate&&(u.name,Zt.I3S_CONTROLLER,u.blockFrame=this._frameNumber),u.schedulePriority=u.basePriority;const p=this._budget.now()-a;if(u.runtime+=p,this._frameTaskTimes.set(u.priority,this._frameTaskTimes.get(u.priority)+p),this._debug&&p>2*this._budget.budget&&console.log("Task",u.name,"used",p,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(Zt))this._frameTaskTimes.set(Zt[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((a,u)=>this.performanceInfo.tasks.get(u).record(a)),this.performanceInfo.total.record(s)}get test(){return this._test}}t.Scheduler=e;class i{get task(){return this._task.value}get updating(){return this._queue.running}constructor(s,a,u,p){this._scheduler=s,this.name=a,this._basePriority=p,this.blockFrame=0,this.runtime=0,this._queue=new kNe,this._handles=new Dg,this.schedulePriority=this._basePriority,this._task=xS(u??this._queue),this._handles.add(Qu(()=>this.task.running,y=>s.taskRunningChanged(y)))}remove(){this.processQueue(ml),this._scheduler.removeTask(this),this.schedule=TS.schedule,this.reschedule=TS.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const a=Wie(s);this._basePriority!==Kf&&this.schedulePriority===0||(this.schedulePriority=a),this._basePriority=a}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,a,u){return this._queue.push(s,a,u)}reschedule(s,a,u){return this._queue.unshift(s,a,u)}processQueue(s){this._queue.runTask(s)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=yr.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(s){return!this.done&&(s()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(s){this._enabled=s}reset(s,a){this._begin=this.now(),this._budget=s,this._state=a,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=r})(hL||(hL={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(Wv||(Wv={}));const ml=(()=>{const t=new hL.Budget;return t.enabled=!1,t})();let BNe=class{remove(){}processQueue(){}schedule(e,i,r){try{if(Ms(i)){const n=or();return r?Promise.resolve(r(n)):Promise.reject(n)}return _j(e(ml))}catch(n){return Promise.reject(n)}}reschedule(e,i,r){return this.schedule(e,i,r)}};const TS=new BNe;var VB;let ng=VB=class extends Ne{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}clone(){return new VB({url:this.url})}};_([T({type:String,json:{write:{isRequired:!0}}})],ng.prototype,"url",void 0),ng=VB=_([Z("esri.webdoc.support.SlideThumbnail")],ng);var GB;let TI=GB=class extends Ne{constructor(){super(...arguments),this.text=""}clone(){return new GB({text:this.text})}};_([T({type:String,json:{write:!0}})],TI.prototype,"text",void 0),TI=GB=_([Z("esri.webscene.support.Description")],TI);const SI=TI;var HB;let cT=HB=class extends Ne{constructor(){super(...arguments),this.lighting=new q2,this.weather=new cL}clone(){return new HB({lighting:Ce(this.lighting),weather:Ce(this.weather)})}};_([T({types:lye,json:{write:!0}})],cT.prototype,"lighting",void 0),_([T({types:RY,json:{write:!0}})],cT.prototype,"weather",void 0),cT=HB=_([Z("esri.webscene.Environment")],cT);var EI;let CI=EI=class extends Ne{constructor(){super(...arguments),this.opacity=null}clone(){return new EI({opacity:this.opacity})}cloneAndApplyTo(t){return this.opacity==null||((t=t?.clone()??new N4).opacity=this.opacity),t}static fromGround(t){return new EI({opacity:t.opacity})}};_([T({type:Number,json:{type:Wr,read:{reader:hS,source:"transparency"},write:{writer:(t,e)=>{e.transparency=XO(t)},target:"transparency"}}})],CI.prototype,"opacity",void 0),CI=EI=_([Z("esri.webscene.support.SlideGround")],CI);const dye=CI;var qB;let uT=qB=class extends Ne{constructor(t){super(t),this.id="",this.sublayerIds=null}clone(){return new qB({id:this.id,sublayerIds:Ce(this.sublayerIds)})}};_([T({type:String,json:{write:!0}})],uT.prototype,"id",void 0),_([T({type:[Wr],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],uT.prototype,"sublayerIds",void 0),uT=qB=_([Z("esri.webscene.support.SlideVisibleLayer")],uT);var WB;let AI=WB=class extends Ne{constructor(){super(...arguments),this.text=""}clone(){return new WB({text:this.text})}};_([T({type:String,json:{write:{isRequired:!0}}})],AI.prototype,"text",void 0),AI=WB=_([Z("esri.webscene.support.Title")],AI);const DA=AI;let VNe=0;const XB=Dt.ofType(uT);let ia=class extends Ne{constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+VNe++,this.title=new DA,this.description=new SI,this.hidden=!1,this.thumbnail=new ng,this.viewpoint=null,this.basemap=null,this.ground=null,this.environment=new cT,this.visibleLayers=new XB}destroy(){this.visibleLayers.removeAll(),this.basemap=null,this.thumbnail=ct(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null}castTitle(e){return typeof e=="string"?new DA({text:e}):os(DA,e)}castDescription(e){return typeof e=="string"?new SI({text:e}):os(SI,e)}castThumbnail(e){return typeof e=="string"?new ng({url:e}):os(ng,e)}castBasemap(e){return rY(e)}set visibleLayers(e){this._set("visibleLayers",xg(e,this._get("visibleLayers"),XB))}castVisibleLayers(e){return e&&typeof e.map=="function"?e.map(i=>{if(typeof i=="string")return{id:i};if(i instanceof HD){const r=Qie(i);return{id:i.id,sublayerIds:r}}return i.id?{id:i.id,sublayerIds:"sublayerIds"in i?i.sublayerIds:void 0}:(Ee.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),i)}):null}clone(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap?.clone()||null,ground:this.ground?.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null,hidden:this.hidden})}async _updateVisibleLayersFrom(e){const i=[];await Promise.allSettled(this._getLayers(e.map).map(r=>e.whenLayerView(r).then(n=>{if(n.visible){const s=Qie(r);i.push(new uT({id:n.layer.id,sublayerIds:s}))}})).toArray()),this.visibleLayers.removeAll(),this.visibleLayers.addMany(i)}updateFrom(e,i){const r={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...i?.screenshot};return e.when(()=>(this.viewpoint=e.viewpoint.clone(),this.environment.lighting=e.environment.lighting.type==="virtual"?QO.prototype.clone.apply(e.environment.lighting):q2.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.basemap=e.map.basemap&&e.map.basemap.clone()||null,this.ground=e.map.ground?dye.fromGround(e.map.ground):null,this._updateVisibleLayersFrom(e))).then(()=>e.takeScreenshot(r)).then(n=>(this.thumbnail=new ng({url:n.dataUrl}),this))}async applyTo(e,i){this._applyToController!=null&&this._applyToController.abort();let r=new AbortController;this._applyToController=r;const n=kO(i,()=>r?.abort()),s=e.resourceController.scheduler.registerTask(Zt.SLIDE);let a=!1;const u={animate:!0,...i,signal:this._applyToController.signal},p=async()=>{await Promise.all([s.schedule(async()=>a=await this._setViewpointOfInterest(e,u)),s.schedule(()=>this._applyBasemap(e,u),u.signal)]),await this._loadLayersWithSublayerVisibility(e),await Promise.all([s.schedule(()=>this._applyLayerVisibility(e),u.signal),s.schedule(()=>this._applyGround(e),u.signal),s.schedule(()=>this._applyViewpoint(e,u),u.signal)]),await s.schedule(()=>e.environment.weather=this.environment.weather.clone())},y=await Gc(e.addUpdatingPromise(p()));if(a&&(e.contentCamera=null),s.remove(),this._applyToController===r&&(this._applyToController=null),r=null,n?.remove(),y.ok===!1)throw y.error;return this}async _applyBasemap(e,i){if(this.basemap){try{await this.basemap.load(i)}catch(r){if(qn(r))throw r}e.map.basemap=_De(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_getLayers(e){const i=new Dt;return this._collectLayers(e,i),this._collectLayers(e.ground,i),i}_collectLayers(e,i){e.layers.forEach(r=>{r.persistenceEnabled&&(i.add(r),"layers"in r&&this._collectLayers(r,i))})}async _loadLayersWithSublayerVisibility(e){this.visibleLayers&&await Promise.allSettled(this._getLayers(e.map).items.map(i=>this.visibleLayers.find(n=>n.id===i.id)?.sublayerIds?i.load():null))}_applyLayerVisibility(e){this.visibleLayers&&this._getLayers(e.map).forEach(i=>{const r=this.visibleLayers.find(a=>a.id===i.id);i.visible=r!=null;const n=r?.sublayerIds,s=pye(i);n&&s&&s.forEach(a=>a.visible=n.includes(a.id))})}async _setViewpointOfInterest(e,i){if(e.state.fixedContentCamera||!this.viewpoint||i?.ignoreViewpoint||!i?.useDestinationCamera)return!1;const{toCameraAsync:r}=await ke(()=>Promise.resolve().then(()=>Eet),void 0,import.meta.url),n=await r(e,this.viewpoint);return e.contentCamera=n,n!=null}async _applyViewpoint(e,i){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!i.ignoreViewpoint){this.viewpoint.camera!=null&&(this.viewpoint.camera.fov=e.camera.fov);const r=this.environment.lighting;if(i.animate&&r.type==="sun"&&r.date)return this._animateToLighting(e,i);i.animate&&(e.environment.applyLighting(r.clone()),await e.goTo(this.viewpoint,i)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,i){let r=null;return e.environment.lighting.type!=="virtual"&&this.environment.lighting.type!=="virtual"&&(e.viewingMode==="global"&&(r=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||e.environment.lighting.type==="virtual"?(e.environment.applyLighting(this.environment.lighting.clone()),e.environment.lighting.type!=="virtual"&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,i).then(()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())}).catch(n=>{throw e.animation==null&&this._applyCachedCameraTrackingEnabled(e),n}).finally(()=>{nn(r)})}_applyCachedCameraTrackingEnabled(e){e.environment.cachedCameraTrackingEnabled!=null&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,i,r){return e.setTime(i),e.setUTCHours(r/3600),e.setUTCMinutes(r%3600/60),e.setUTCSeconds(r%3600%60),e}_animateLightingWithCamera(e,i,r){const n=new Date(i.date.toString()),[s,a]=this._getTime(n),[u,p]=this._getTime(r.date),y=GNe(a,p),b=e.renderCoordsHelper,S=H();b.toRenderCoords(e.camera.position,S);const C=H(),O=H();this.viewpoint.camera!=null&&b.toRenderCoords(this.viewpoint.camera.position,C);const P=new Date;return Qu(()=>e.camera,$=>{b.toRenderCoords($.position,O);const N=ao(S,O),z=ao(C,O);let U=0;N+z!==0&&(U=N/(N+z));const j=s+(u-s)*U,G=HNe(a,y*U);i.date=this._setTime(P,j,G)})}static createFrom(e,i){return new this().updateFrom(e,i)}};function pye(t){if(t.type==="building-scene"||t.type==="map-image")return t.allSublayers.toArray()}function Qie(t){const e=pye(t);if(e)return e.filter(i=>i.visible).map(i=>i.id)}_([T({type:String,json:{write:{isRequired:!0}}})],ia.prototype,"id",void 0),_([T({type:DA,json:{default:()=>new DA({text:""}),write:{isRequired:!0}}})],ia.prototype,"title",void 0),_([Fi("title")],ia.prototype,"castTitle",null),_([T({type:SI,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.text)})}}})],ia.prototype,"description",void 0),_([Fi("description")],ia.prototype,"castDescription",null),_([T({type:Boolean,nonNullable:!0,json:{write:!0,default:!1}})],ia.prototype,"hidden",void 0),_([T({type:ng,json:{default:()=>new ng({url:""}),write:{isRequired:!0}}})],ia.prototype,"thumbnail",void 0),_([Fi("thumbnail")],ia.prototype,"castThumbnail",null),_([T({type:qc,nonNullable:!0,json:{write:{isRequired:!0}}})],ia.prototype,"viewpoint",void 0),_([T({type:PT,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],ia.prototype,"basemap",void 0),_([Fi("basemap")],ia.prototype,"castBasemap",null),_([T({type:dye,json:{write:!0}})],ia.prototype,"ground",void 0),_([T({type:XB,json:{write:{isRequired:!0}}})],ia.prototype,"visibleLayers",null),_([Fi("visibleLayers")],ia.prototype,"castVisibleLayers",null),_([T({type:cT,json:{write:!0}})],ia.prototype,"environment",void 0),ia=_([Z("esri.webscene.Slide")],ia);const JB=86400,ere=43200;function GNe(t,e){let i=e-t;return i>ere&&(i-=JB),i<-ere&&(i+=JB),i}function HNe(t,e){return E8e(t+e,JB)}const qNe=ia,YB=Dt.ofType(qNe);let OI=class extends Ne{constructor(e){super(e),this.slides=new YB}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(i=>!!i.viewpoint)),this._set("slides",xg(e,this._get("slides"),YB))}clone(){return new this.constructor({slides:this.slides.clone()})}};_([T({type:YB,nonNullable:!0,json:{write:!0}}),Fi(MJ)],OI.prototype,"slides",null),OI=_([Z("esri.webscene.Presentation")],OI);const fye=OI;var ZB;let ux=ZB=class extends Ne{constructor(t){super(t)}clone(){return new ZB({name:this.name,path:this.path,title:this.title})}};_([T({type:String,json:{write:!0}})],ux.prototype,"name",void 0),_([T({type:String,json:{write:!0}})],ux.prototype,"path",void 0),_([T({type:String,json:{write:!0}})],ux.prototype,"title",void 0),ux=ZB=_([Z("esri.webscene.TransportationNetwork")],ux);const WNe=ux;let dv=class{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}since(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new de(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new dv(this.major,this.minor,this._context)}static parse(e,i=""){const[r,n]=e.split("."),s=/^\s*\d+\s*$/;if(!r?.match||!s.test(r))throw new de((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!n?.match||!s.test(n))throw new de((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const a=parseInt(r,10),u=parseInt(n,10);return new dv(a,u,i)}},dL=class extends dv{constructor(e,i){super(e,i,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}},XNe=null;function JNe(){return XNe}var mye;const y2=new dL(1,32),YNe=()=>{const e=[],i=y2.major;for(let r=8;r<=y2.minor;r++)e.push(`${i}.${r}`);return e},mF="Web Scene";let Gr=class extends Ip.LoadableMixin(GO(qD(v1e))){constructor(e){super(e),this[mye]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new fye,this.initialViewProperties=new uL,this.portalItem=null,this.resourceInfo=null,this._debouncedSaveOperations=oE(async(i,r,n)=>{switch(i){case Nc.SAVE:return this._saveImpl(r);case Nc.SAVE_AS:return this._saveAsImpl(n,r)}}),this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{Ee.getLogger(this).error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(i){return void this.addResolvingPromise(Promise.reject(i))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(ga(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=ct(this.portalItem)}writeClippingArea(e,i){i.clippingArea||(i.clippingArea={}),i.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,i){return!!i.clippingArea&&!!i.clippingArea.clip}writeClippingEnabled(e,i){this.clippingArea&&(i.clippingArea||(i.clippingArea={}),i.clippingArea.clip=e)}writeLayers(e,i,r,n){i[r]=this._layersToJSON(e,"operational-layers",n)}readSourceVersion(e,i){const[r,n]=i.version.split(".");return new dL(parseInt(r,10),parseInt(n,10))}writeSourceVersion(e,i,r){i[r]=`${y2.major}.${y2.minor}`}writeTables(e,i,r,n){const s=this._layersToJSON(e,"tables",n);s.length&&(i[r]=s)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl??null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,i){e&&this._isAuthoringAppSetByUser?i.authoringApp=e:i.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,i){e&&this._isAuthoringAppVersionSetByUser?i.authoringAppVersion=e:i.authoringAppVersion=Eme}writeGround(e,i,r,n){i[r]=e?e.write({},n):{transparency:0,layers:[]}}readInitialViewProperties(e,i){const r={};return i.initialState?.environment&&(r.environment=wS.fromJSON(i.initialState.environment)),r.spatialReference=i.spatialReference?dt.fromJSON(i.spatialReference):dt.WebMercator,r.viewingMode=i.viewingMode??"global",i.initialState?.viewpoint&&(r.viewpoint=qc.fromJSON(i.initialState.viewpoint)),new uL(r)}get spatialReference(){return this.initialViewProperties?.spatialReference??dt.WebMercator}get viewingMode(){return this.initialViewProperties?.viewingMode??"global"}load(e){const i=this.ground;return this.addResolvingPromise(this._loadFromSource().then(()=>{i&&i!==this.ground&&i.destroy()})),Promise.resolve(this)}loadAll(){return $J(this,e=>{const i=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,i&&i.map(r=>r.basemap),this.tables)})}read(e,i){i={...i,origin:"web-scene"};const r=this._isAuthoringAppVersionSetByUser,n=this._isAuthoringAppSetByUser;if(lme(this,e,s=>super.read(e,s),i),n||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion?.supportsVisibleElevationLayersInSlides){const s=e.baseMap.elevationLayers.map(y=>({id:y.id})),a=this.presentation.slides,u=(y,b)=>y.visibleLayers.some(S=>S.id===b),p=s.filter(y=>!a.some(b=>u(b,y.id)));a.forEach(y=>{y.visibleLayers.addMany(p)})}}_writeBasemapElevationLayers(e){const i=e.ground?.layers;!e.baseMap&&i?.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=Ce(i))}_layersToJSON(e,i,r){const n={...r,layerContainerType:i};return e.map(s=>this._verifyWritableLayer(s,r)?s.write({},n):null).filter(s=>!!s).toArray()}_verifyWritableLayer(e,i){return!!e.persistenceEnabled&&("write"in e||(i?.messages&&i.messages.push(new de("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1))}write(e,i){if(this.loadStatus!=="loaded"){const s=new de("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw Ee.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),s}this._runLayersIdGC();const r=!i?.messages;i={messages:[],...i,origin:"web-scene"};const n=super.write(e,i);if(r){const s=i.messages?.filter(a=>a.name==="web-document-write:property-required")??[];if(s.length){const a=new de("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:s});throw Ee.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",s),a}}return this._writeBasemapElevationLayers(n),n}async save(e){return this._debouncedSaveOperations(Nc.SAVE,e)}async _saveImpl(e){if(!this.portalItem)throw new de("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(Uie(this.portalItem),this.portalItem?.type!==mF)throw new de("webscene:portal-item-wrong-type",`Portal item needs to have type "${mF}"`);const i=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl?Nn(this.portalItem.itemUrl):null,messages:[],portal:this.portalItem.portal??Zs.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),n=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(n,r,e),this._updateTypeKeywords(this.portalItem),await pNe(this.portalItem,n,this._resourceReferences,r,null),Iie(r),i&&await i,await this._saveThumbnail(),this.portalItem}async saveAs(e,i){return this._debouncedSaveOperations(Nc.SAVE_AS,i,e)}async _saveAsImpl(e,i){let r=p2.from(e);if(!r)throw new de("webscene:portal-item-required","saveAs requires a portal item to save to");Uie(r),r.id&&(r=r.clone(),r.id=null);const n=r.portal||Zs.getDefault();await this._ensureLoadBeforeSave(),r.type=mF,r.portal=n;const s=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:n,portalItem:r,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),a=this.write({},s);await Promise.all(s.resources.pendingOperations),await this._verifySaveAs(a,s,i);const u=this.thumbnailUrl,p=!this._isOverridden("thumbnailUrl");if(this._updateTypeKeywords(r),await n.signIn(),!n.user)throw new de("webscene:user-not-signed-in","saveAs requires a user to be signed in to the portal");return await n.user.addItem({item:r,folder:i?.folder,data:a}),await dNe(this._resourceReferences,s,null),this.portalItem=r,gB.prototype.read.call(this,{version:a.version,authoringApp:a.authoringApp,authoringAppVersion:a.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl?Nn(r.itemUrl):void 0}),Iie(s),u&&(this.thumbnailUrl=p?CJ(u,"w","8192"):u),s.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}_verifySave(e,i,r,n=!1){if(!oS(this.spatialReference))return Promise.reject(new de("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently."));let s,a=i.messages?.filter(y=>y.type==="error").map(y=>new de(y.name,y.message,y.details))??[];i.blockedRelativeUrls&&(a=a.concat(i.blockedRelativeUrls.map(y=>new de("url:unsupported",`Relative url '${y}' is not supported in Web Scene`)))),r&&r.ignoreUnsupported&&(a=a.filter(y=>y.name!=="layer:unsupported"&&y.name!=="symbol:unsupported"&&y.name!=="symbol-layer:unsupported"&&y.name!=="property:unsupported"&&y.name!=="url:unsupported"&&y.name!=="scenemodification:unsupported")),r?.requiredPropertyChecksDisabled&&(a=a.filter(y=>y.name!=="web-document-write:property-required"));const u=!!r?.strictSchemaValidationEnabled,p=JNe();return s=u&&p?p().then(y=>{const b=y.validate(e);if(b.length>0){const S=`webscene did not validate:
${b.join(`
`)}`;Ee.getLogger(this).error(`${n?"saveAs":"save"}(): ${S}`)}return b.map(S=>new de("webscene:schema-validation",S))}).then(y=>{if(y.length>0)throw rNe(y.concat(a));return a}):Promise.resolve(a),s.then(y=>{if(y.length>0)throw new de("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:y})})}_verifySaveAs(e,i,r){return this.canNotSaveAs(i)?Promise.reject(iNe()):this._verifySave(e,i,r,!0)}verifySaveAs(e){const i=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write({},i);return this._verifySaveAs(r,i,e)}canNotSaveAs(e){return e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},e)),(e.verifyItemRelativeUrls?.writtenUrls?.length??0)>0}async updateFrom(e,i={}){const r=this._updateFrom(e,i);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFrom(e,i={}){if(await e.whenReady(),!i.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=wS.prototype.clone.apply(e.environment)),!i.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,e.clippingArea!=null?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const r of e.allLayerViews){const n="visible";n in r&&n in r.layer&&r._isOverridden(n)&&(r.layer[n]=r[n])}(i.thumbnailExcluded===!1||i.thumbnailExcluded==null&&!i.viewpointExcluded)&&await this._updateFromThumbnail(e,i.thumbnailSize??void 0)}async _updateFromThumbnail(e,i){const r=gNe(e,i),n=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=n.dataUrl}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem?.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,i){const r=this._validateJSON(e);return this.read(r,i),this._loadFromJSON(r,i)}_extractOperationalLayers(e){const i=[];if(!this.sourceVersion?.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const s of e.baseMap.elevationLayers)i.push(s);const r=[],n=s=>(s.layers&&(s.layers=s.layers.filter(n)),s.layerType!=="ArcGISTiledElevationServiceLayer"||(this.sourceVersion?.supportsGround||r.push(s),!1));return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(n):[],operationalElevationLayers:r,basemapElevationLayers:i}}async _loadFromJSON(e,i){const r=new Dt;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:n}=await ke(()=>import("./layersCreator-38f71b2f.js"),["./layersCreator-38f71b2f.js","./portalLayers-7555fcdb.js","./associatedFeatureServiceUtils-c90a3355.js","./requestPresets-5652178e.js"],import.meta.url),{operationalLayers:s,operationalElevationLayers:a,basemapElevationLayers:u}=this._extractOperationalLayers(e),p=[],y={context:{...i,layerContainerType:"operational-layers"}};if(this.portalItem&&(y.context.portal=this.portalItem.portal||Zs.getDefault()),u.length>0){const b={...y,context:{...y.context,layerContainerType:"ground"}};b.defaultLayerType="ArcGISTiledElevationServiceLayer",p.push(n(this.ground.layers,u,b))}if(a.length>0){const b={...y,context:{...y.context,layerContainerType:"ground"}};b.defaultLayerType="ArcGISTiledElevationServiceLayer",p.push(n(r,a,b))}s&&s.length>0&&p.push(n(this.layers,s,y)),e.tables?.length&&p.push(n(this.tables,e.tables,{...y,context:{...y.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(p),await this._loadObjectsWithLayers(),this.ground.layers.addMany(r)}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],i=[...this.allLayers.items];for(const{basemap:r}of this.presentation.slides.items)r&&(i.push(...r.baseLayers.items),i.push(...r.referenceLayers.items));for(const r of i)if("beforeSave"in r&&typeof r.beforeSave=="function"){const n=r.beforeSave();n&&e.push(n)}await Promise.allSettled(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(i=>{i.basemap&&e.push(i.basemap.load())}),await Promise.allSettled(e)}async _loadFromItem(e){if(await e.load().catch(n=>{throw new de("webscene:load-portal-item","Failed to load portal item",{error:n})}),e.type!=="Web Scene")throw new de("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const i=await e.fetchData();this.resourceInfo=i;const r={origin:"web-scene",url:Nn(e.itemUrl),portal:e.portal||Zs.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(i,r),this._resourceReferences={portalItem:e,paths:r.readResourcePaths??[]}}_validateSpatialReference(){const e=this.initialViewProperties,i=this._sceneSpatialReference;let r;if(e.viewingMode!=="local"){if(!B4(i,ht.Global))return Promise.reject(new de("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=p=>!p||$p(p,i)}else{if(!B4(i,ht.Local))return Promise.reject(new de("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=p=>!p||p.equals(i)}const n=p=>p?.camera?.position.spatialReference??p?.targetGeometry?.spatialReference,s=e.viewpoint,a=n(s);if(a&&!r(a))return Promise.reject(new de("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:a,sceneSpatialReference:i,viewingMode:e.viewingMode}));const u=this.presentation.slides.find(p=>!r(n(p.viewpoint)));if(u){const p=n(u.viewpoint);return Promise.reject(new de("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:p,sceneSpatialReference:i,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,i=j7e(this.heightModelInfo,e);return i?Promise.reject(i):Promise.resolve()}_validateJSON(e){const i=dL.parse(e.version||"","webscene");return y2.validate(i),e.version=`${i.major}.${i.minor}`,i.major===1&&i.minor<=2&&(e.spatialReference=dt.WebMercator.toJSON()),e}_updateTypeKeywords(e){Fie(e,EB.LOCAL_SCENE,this.initialViewProperties.viewingMode==="local"),Fie(e,EB.DEVELOPER_BASEMAP,bie(this.basemap)||this.presentation.slides.some(({basemap:i})=>!!i&&bie(i))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((i,r,n)=>n.indexOf(i)===r))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||dt.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem?.itemUrl?Nn(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const i=this._verifyItemRelativeRootPath;return i&&(e.verifyItemRelativeUrls={rootPath:i,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties?.viewing?.search,i=n=>this.allLayers.some(s=>s.id===n&&s.persistenceEnabled);e&&e.layers&&(e.layers=e.layers.filter(n=>i(n.id)));const r=this.presentation&&this.presentation.slides;r&&r.forEach(n=>{n.visibleLayers&&(n.visibleLayers=n.visibleLayers.filter(s=>i(s.id)))})}static fromJSON(e){if(!e)throw new de("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};mye=Q7e,Gr.version=`${y2.major}.${y2.minor}`,_([T({type:TNe,json:{write:!0}})],Gr.prototype,"applicationProperties",void 0),_([T({type:rr,json:{read:{source:"clippingArea.geometry",reader:E0},write:{target:"clippingArea.geometry"}}})],Gr.prototype,"clippingArea",void 0),_([ot("clippingArea")],Gr.prototype,"writeClippingArea",null),_([T({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],Gr.prototype,"clippingEnabled",void 0),_([rt("clippingEnabled",["clippingArea"])],Gr.prototype,"readClippingEnabled",null),_([ot("clippingEnabled")],Gr.prototype,"writeClippingEnabled",null),_([T({type:K7e,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],Gr.prototype,"floorInfo",void 0),_([T({type:$v,json:{write:!0}})],Gr.prototype,"heightModelInfo",void 0),_([T({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],Gr.prototype,"layers",void 0),_([ot("layers")],Gr.prototype,"writeLayers",null),_([T({readOnly:!0,type:dL,json:{type:YNe(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],Gr.prototype,"sourceVersion",void 0),_([rt("sourceVersion",["version"])],Gr.prototype,"readSourceVersion",null),_([ot("sourceVersion")],Gr.prototype,"writeSourceVersion",null),_([T({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],Gr.prototype,"tables",void 0),_([ot("tables")],Gr.prototype,"writeTables",null),_([T()],Gr.prototype,"thumbnailUrl",null),_([T({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Gr.prototype,"authoringApp",null),_([ot("authoringApp")],Gr.prototype,"writeAuthoringApp",null),_([T({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Gr.prototype,"authoringAppVersion",null),_([ot("authoringAppVersion")],Gr.prototype,"writeAuthoringAppVersion",null),_([T({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],Gr.prototype,"ground",void 0),_([ot("ground")],Gr.prototype,"writeGround",null),_([T({type:Dt.ofType(WNe),json:{write:!0}})],Gr.prototype,"transportationNetworks",void 0),_([T({type:fye,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(t,e,i,r)=>{if(t.slides&&t.slides.length>0){const n={...r,isPresentation:!0};e.presentation=t.write({},n)}}}}})],Gr.prototype,"presentation",void 0),_([T({type:uL,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new uL({viewingMode:"global",spatialReference:dt.WebMercator})}})],Gr.prototype,"initialViewProperties",void 0),_([rt("initialViewProperties",["initialState.environment","initialState.viewpoint","spatialReference","viewingMode"])],Gr.prototype,"readInitialViewProperties",null),_([T({type:dt,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Gr.prototype,"spatialReference",null),_([T({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Gr.prototype,"viewingMode",null),_([T({type:p2})],Gr.prototype,"portalItem",void 0),_([T()],Gr.prototype,"resourceInfo",void 0),Gr=_([Z("esri.WebScene")],Gr);const ZNe=Gr;async function MY(t,e){const{WhereClause:i}=await ke(()=>import("./WhereClause-9d21e01b.js").then(r=>r.W),["./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js"],import.meta.url);return i.create(t,e)}function KNe(t,e){return t!=null?e!=null?`(${t}) AND (${e})`:t:e}function Gw(t){return typeof t=="string"||t instanceof String}const tre=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class bw extends Error{}class QNe extends bw{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class eFe extends bw{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class tFe extends bw{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class n5 extends bw{}class gye extends bw{constructor(e){super(`Invalid unit ${e}`)}}class Lh extends bw{}class s1 extends bw{constructor(){super("Zone is an abstract class")}}const Pt="numeric",Lp="short",Vu="long",pL={year:Pt,month:Pt,day:Pt},yye={year:Pt,month:Lp,day:Pt},iFe={year:Pt,month:Lp,day:Pt,weekday:Lp},vye={year:Pt,month:Vu,day:Pt},_ye={year:Pt,month:Vu,day:Pt,weekday:Vu},bye={hour:Pt,minute:Pt},wye={hour:Pt,minute:Pt,second:Pt},xye={hour:Pt,minute:Pt,second:Pt,timeZoneName:Lp},Tye={hour:Pt,minute:Pt,second:Pt,timeZoneName:Vu},Sye={hour:Pt,minute:Pt,hourCycle:"h23"},Eye={hour:Pt,minute:Pt,second:Pt,hourCycle:"h23"},Cye={hour:Pt,minute:Pt,second:Pt,hourCycle:"h23",timeZoneName:Lp},Aye={hour:Pt,minute:Pt,second:Pt,hourCycle:"h23",timeZoneName:Vu},Oye={year:Pt,month:Pt,day:Pt,hour:Pt,minute:Pt},Rye={year:Pt,month:Pt,day:Pt,hour:Pt,minute:Pt,second:Pt},Mye={year:Pt,month:Lp,day:Pt,hour:Pt,minute:Pt},Pye={year:Pt,month:Lp,day:Pt,hour:Pt,minute:Pt,second:Pt},rFe={year:Pt,month:Lp,day:Pt,weekday:Lp,hour:Pt,minute:Pt},Iye={year:Pt,month:Vu,day:Pt,hour:Pt,minute:Pt,timeZoneName:Lp},$ye={year:Pt,month:Vu,day:Pt,hour:Pt,minute:Pt,second:Pt,timeZoneName:Lp},Lye={year:Pt,month:Vu,day:Pt,weekday:Vu,hour:Pt,minute:Pt,timeZoneName:Vu},Dye={year:Pt,month:Vu,day:Pt,weekday:Vu,hour:Pt,minute:Pt,second:Pt,timeZoneName:Vu};class eR{get type(){throw new s1}get name(){throw new s1}get ianaName(){return this.name}get isUniversal(){throw new s1}offsetName(e,i){throw new s1}formatOffset(e,i){throw new s1}offset(e){throw new s1}equals(e){throw new s1}get isValid(){throw new s1}}let gF=null;class JD extends eR{static get instance(){return gF===null&&(gF=new JD),gF}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return Fye(e,i,r)}formatOffset(e,i){return FA(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let RI={};function nFe(t){return RI[t]||(RI[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),RI[t]}const sFe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function oFe(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,n,s,a,u,p,y,b]=r;return[a,n,s,u,p,y,b]}function aFe(t,e){const i=t.formatToParts(e),r=[];for(let n=0;n<i.length;n++){const{type:s,value:a}=i[n],u=sFe[s];s==="era"?r[u]=a:Nr(u)||(r[u]=parseInt(a,10))}return r}let cM={};class Dp extends eR{static create(e){return cM[e]||(cM[e]=new Dp(e)),cM[e]}static resetCache(){cM={},RI={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Dp.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return Fye(e,i,r,this.name)}formatOffset(e,i){return FA(this.offset(e),i)}offset(e){const i=new Date(e);if(isNaN(i))return NaN;const r=nFe(this.name);let[n,s,a,u,p,y,b]=r.formatToParts?aFe(r,i):oFe(r,i);u==="BC"&&(n=-Math.abs(n)+1);const C=ZD({year:n,month:s,day:a,hour:p===24?0:p,minute:y,second:b,millisecond:0});let O=+i;const P=O%1e3;return O-=P>=0?P:1e3+P,(C-O)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let ire={};function lFe(t,e={}){const i=JSON.stringify([t,e]);let r=ire[i];return r||(r=new Intl.ListFormat(t,e),ire[i]=r),r}let KB={};function QB(t,e={}){const i=JSON.stringify([t,e]);let r=KB[i];return r||(r=new Intl.DateTimeFormat(t,e),KB[i]=r),r}let eV={};function cFe(t,e={}){const i=JSON.stringify([t,e]);let r=eV[i];return r||(r=new Intl.NumberFormat(t,e),eV[i]=r),r}let tV={};function uFe(t,e={}){const{base:i,...r}=e,n=JSON.stringify([t,r]);let s=tV[n];return s||(s=new Intl.RelativeTimeFormat(t,e),tV[n]=s),s}let s5=null;function hFe(){return s5||(s5=new Intl.DateTimeFormat().resolvedOptions().locale,s5)}function dFe(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,n;try{r=QB(t).resolvedOptions(),n=t}catch{const p=t.substring(0,i);r=QB(p).resolvedOptions(),n=p}const{numberingSystem:s,calendar:a}=r;return[n,s,a]}}function pFe(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function fFe(t){const e=[];for(let i=1;i<=12;i++){const r=Ui.utc(2009,i,1);e.push(t(r))}return e}function mFe(t){const e=[];for(let i=1;i<=7;i++){const r=Ui.utc(2016,11,13+i);e.push(t(r))}return e}function uM(t,e,i,r){const n=t.listingMode();return n==="error"?null:n==="en"?i(e):r(e)}function gFe(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class yFe{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:n,floor:s,...a}=r;if(!i||Object.keys(a).length>0){const u={useGrouping:!1,...r};r.padTo>0&&(u.minimumIntegerDigits=r.padTo),this.inf=cFe(e,u)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):IY(e,3);return So(i,this.padTo)}}}class vFe{constructor(e,i,r){this.opts=r,this.originalZone=void 0;let n;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const a=-1*(e.offset/60),u=a>=0?`Etc/GMT+${a}`:`Etc/GMT${a}`;e.offset!==0&&Dp.create(u).valid?(n=u,this.dt=e):(n="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,n=e.zone.name):(n="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const s={...this.opts};s.timeZone=s.timeZone||n,this.dtf=QB(i,s)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(i=>{if(i.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...i,value:r}}else return i}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class _Fe{constructor(e,i,r){this.opts={style:"long",...r},!i&&Nye()&&(this.rtf=uFe(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):NFe(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}class ms{static fromOpts(e){return ms.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,i,r,n=!1){const s=e||xo.defaultLocale,a=s||(n?"en-US":hFe()),u=i||xo.defaultNumberingSystem,p=r||xo.defaultOutputCalendar;return new ms(a,u,p,s)}static resetCache(){s5=null,KB={},eV={},tV={}}static fromObject({locale:e,numberingSystem:i,outputCalendar:r}={}){return ms.create(e,i,r)}constructor(e,i,r,n){const[s,a,u]=dFe(e);this.locale=s,this.numberingSystem=i||a||null,this.outputCalendar=r||u||null,this.intl=pFe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=gFe(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:ms.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1){return uM(this,e,Uye,()=>{const r=i?{month:e,day:"numeric"}:{month:e},n=i?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=fFe(s=>this.extract(s,r,"month"))),this.monthsCache[n][e]})}weekdays(e,i=!1){return uM(this,e,Vye,()=>{const r=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=i?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=mFe(s=>this.extract(s,r,"weekday"))),this.weekdaysCache[n][e]})}meridiems(){return uM(this,void 0,()=>Gye,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Ui.utc(2016,11,13,9),Ui.utc(2016,11,13,19)].map(i=>this.extract(i,e,"dayperiod"))}return this.meridiemCache})}eras(e){return uM(this,e,Hye,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[Ui.utc(-40,1,1),Ui.utc(2017,1,1)].map(r=>this.extract(r,i,"era"))),this.eraCache[e]})}extract(e,i,r){const n=this.dtFormatter(e,i),s=n.formatToParts(),a=s.find(u=>u.type.toLowerCase()===r);return a?a.value:null}numberFormatter(e={}){return new yFe(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new vFe(e,this.intl,i)}relFormatter(e={}){return new _Fe(this.intl,this.isEnglish(),e)}listFormatter(e={}){return lFe(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let yF=null;class yl extends eR{static get utcInstance(){return yF===null&&(yF=new yl(0)),yF}static instance(e){return e===0?yl.utcInstance:new yl(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new yl(KD(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${FA(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${FA(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return FA(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class bFe extends eR{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Sy(t,e){if(Nr(t)||t===null)return e;if(t instanceof eR)return t;if(wFe(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?JD.instance:i==="utc"||i==="gmt"?yl.utcInstance:yl.parseSpecifier(i)||Dp.create(t)}else return v2(t)?yl.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new bFe(t)}let rre=()=>Date.now(),nre="system",sre=null,ore=null,are=null,lre=60,cre;class xo{static get now(){return rre}static set now(e){rre=e}static set defaultZone(e){nre=e}static get defaultZone(){return Sy(nre,JD.instance)}static get defaultLocale(){return sre}static set defaultLocale(e){sre=e}static get defaultNumberingSystem(){return ore}static set defaultNumberingSystem(e){ore=e}static get defaultOutputCalendar(){return are}static set defaultOutputCalendar(e){are=e}static get twoDigitCutoffYear(){return lre}static set twoDigitCutoffYear(e){lre=e%100}static get throwOnInvalid(){return cre}static set throwOnInvalid(e){cre=e}static resetCaches(){ms.resetCache(),Dp.resetCache()}}function Nr(t){return typeof t>"u"}function v2(t){return typeof t=="number"}function YD(t){return typeof t=="number"&&t%1===0}function wFe(t){return typeof t=="string"}function xFe(t){return Object.prototype.toString.call(t)==="[object Date]"}function Nye(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function TFe(t){return Array.isArray(t)?t:[t]}function ure(t,e,i){if(t.length!==0)return t.reduce((r,n)=>{const s=[e(n),n];return r&&i(r[0],s[0])===r[0]?r:s},null)[1]}function SFe(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function SS(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function sg(t,e,i){return YD(t)&&t>=e&&t<=i}function EFe(t,e){return t-e*Math.floor(t/e)}function So(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function my(t){if(!(Nr(t)||t===null||t===""))return parseInt(t,10)}function Xv(t){if(!(Nr(t)||t===null||t===""))return parseFloat(t)}function PY(t){if(!(Nr(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function IY(t,e,i=!1){const r=10**e;return(i?Math.trunc:Math.round)(t*r)/r}function tR(t){return t%4===0&&(t%100!==0||t%400===0)}function NA(t){return tR(t)?366:365}function fL(t,e){const i=EFe(e-1,12)+1,r=t+(e-i)/12;return i===2?tR(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function ZD(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function mL(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,i=t-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return e===4||r===3?53:52}function iV(t){return t>99?t:t>xo.twoDigitCutoffYear?1900+t:2e3+t}function Fye(t,e,i,r=null){const n=new Date(t),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(s.timeZone=r);const a={timeZoneName:e,...s},u=new Intl.DateTimeFormat(i,a).formatToParts(n).find(p=>p.type.toLowerCase()==="timezonename");return u?u.value:null}function KD(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,n=i<0||Object.is(i,-0)?-r:r;return i*60+n}function kye(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new Lh(`Invalid unit value ${t}`);return e}function gL(t,e){const i={};for(const r in t)if(SS(t,r)){const n=t[r];if(n==null)continue;i[e(r)]=kye(n)}return i}function FA(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),n=t>=0?"+":"-";switch(e){case"short":return`${n}${So(i,2)}:${So(r,2)}`;case"narrow":return`${n}${i}${r>0?`:${r}`:""}`;case"techie":return`${n}${So(i,2)}${So(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function QD(t){return SFe(t,["hour","minute","second","millisecond"])}const CFe=["January","February","March","April","May","June","July","August","September","October","November","December"],zye=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],AFe=["J","F","M","A","M","J","J","A","S","O","N","D"];function Uye(t){switch(t){case"narrow":return[...AFe];case"short":return[...zye];case"long":return[...CFe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const jye=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Bye=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],OFe=["M","T","W","T","F","S","S"];function Vye(t){switch(t){case"narrow":return[...OFe];case"short":return[...Bye];case"long":return[...jye];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Gye=["AM","PM"],RFe=["Before Christ","Anno Domini"],MFe=["BC","AD"],PFe=["B","A"];function Hye(t){switch(t){case"narrow":return[...PFe];case"short":return[...MFe];case"long":return[...RFe];default:return null}}function IFe(t){return Gye[t.hour<12?0:1]}function $Fe(t,e){return Vye(e)[t.weekday-1]}function LFe(t,e){return Uye(e)[t.month-1]}function DFe(t,e){return Hye(e)[t.year<0?0:1]}function NFe(t,e,i="always",r=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&s){const S=t==="days";switch(e){case 1:return S?"tomorrow":`next ${n[t][0]}`;case-1:return S?"yesterday":`last ${n[t][0]}`;case 0:return S?"today":`this ${n[t][0]}`}}const a=Object.is(e,-0)||e<0,u=Math.abs(e),p=u===1,y=n[t],b=r?p?y[1]:y[2]||y[1]:p?n[t][0]:t;return a?`${u} ${b} ago`:`in ${u} ${b}`}function hre(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const FFe={D:pL,DD:yye,DDD:vye,DDDD:_ye,t:bye,tt:wye,ttt:xye,tttt:Tye,T:Sye,TT:Eye,TTT:Cye,TTTT:Aye,f:Oye,ff:Mye,fff:Iye,ffff:Lye,F:Rye,FF:Pye,FFF:$ye,FFFF:Dye};class gl{static create(e,i={}){return new gl(e,i)}static parseFormat(e){let i=null,r="",n=!1;const s=[];for(let a=0;a<e.length;a++){const u=e.charAt(a);u==="'"?(r.length>0&&s.push({literal:n||/^\s+$/.test(r),val:r}),i=null,r="",n=!n):n||u===i?r+=u:(r.length>0&&s.push({literal:/^\s+$/.test(r),val:r}),r=u,i=u)}return r.length>0&&s.push({literal:n||/^\s+$/.test(r),val:r}),s}static macroTokenToFormatOpts(e){return FFe[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}dtFormatter(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i})}formatDateTime(e,i){return this.dtFormatter(e,i).format()}formatDateTimeParts(e,i){return this.dtFormatter(e,i).formatToParts()}formatInterval(e,i){return this.dtFormatter(e.start,i).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i){return this.dtFormatter(e,i).resolvedOptions()}num(e,i=0){if(this.opts.forceSimple)return So(e,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",n=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",s=(O,P)=>this.loc.extract(e,O,P),a=O=>e.isOffsetFixed&&e.offset===0&&O.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,O.format):"",u=()=>r?IFe(e):s({hour:"numeric",hourCycle:"h12"},"dayperiod"),p=(O,P)=>r?LFe(e,O):s(P?{month:O}:{month:O,day:"numeric"},"month"),y=(O,P)=>r?$Fe(e,O):s(P?{weekday:O}:{weekday:O,month:"long",day:"numeric"},"weekday"),b=O=>{const P=gl.macroTokenToFormatOpts(O);return P?this.formatWithSystemDefault(e,P):O},S=O=>r?DFe(e,O):s({era:O},"era"),C=O=>{switch(O){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return a({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return a({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return a({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return u();case"d":return n?s({day:"numeric"},"day"):this.num(e.day);case"dd":return n?s({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return y("short",!0);case"cccc":return y("long",!0);case"ccccc":return y("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return y("short",!1);case"EEEE":return y("long",!1);case"EEEEE":return y("narrow",!1);case"L":return n?s({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return n?s({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return p("short",!0);case"LLLL":return p("long",!0);case"LLLLL":return p("narrow",!0);case"M":return n?s({month:"numeric"},"month"):this.num(e.month);case"MM":return n?s({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return p("short",!1);case"MMMM":return p("long",!1);case"MMMMM":return p("narrow",!1);case"y":return n?s({year:"numeric"},"year"):this.num(e.year);case"yy":return n?s({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return n?s({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return n?s({year:"numeric"},"year"):this.num(e.year,6);case"G":return S("short");case"GG":return S("long");case"GGGGG":return S("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return b(O)}};return hre(gl.parseFormat(i),C)}formatDurationFromString(e,i){const r=p=>{switch(p[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=p=>y=>{const b=r(y);return b?this.num(p.get(b),y.length):y},s=gl.parseFormat(i),a=s.reduce((p,{literal:y,val:b})=>y?p:p.concat(b),[]),u=e.shiftTo(...a.map(r).filter(p=>p));return hre(s,n(u))}}class gp{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const qye=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function hE(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function dE(...t){return e=>t.reduce(([i,r,n],s)=>{const[a,u,p]=s(e,n);return[{...i,...a},u||r,p]},[{},null,1]).slice(0,2)}function pE(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const n=i.exec(t);if(n)return r(n)}return[null,null]}function Wye(...t){return(e,i)=>{const r={};let n;for(n=0;n<t.length;n++)r[t[n]]=my(e[i+n]);return[r,null,i+n]}}const Xye=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,kFe=`(?:${Xye.source}?(?:\\[(${qye.source})\\])?)?`,$Y=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Jye=RegExp(`${$Y.source}${kFe}`),LY=RegExp(`(?:T${Jye.source})?`),zFe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,UFe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,jFe=/(\d{4})-?(\d{3})/,BFe=Wye("weekYear","weekNumber","weekDay"),VFe=Wye("year","ordinal"),GFe=/(\d{4})-(\d\d)-(\d\d)/,Yye=RegExp(`${$Y.source} ?(?:${Xye.source}|(${qye.source}))?`),HFe=RegExp(`(?: ${Yye.source})?`);function $T(t,e,i){const r=t[e];return Nr(r)?i:my(r)}function qFe(t,e){return[{year:$T(t,e),month:$T(t,e+1,1),day:$T(t,e+2,1)},null,e+3]}function fE(t,e){return[{hours:$T(t,e,0),minutes:$T(t,e+1,0),seconds:$T(t,e+2,0),milliseconds:PY(t[e+3])},null,e+4]}function iR(t,e){const i=!t[e]&&!t[e+1],r=KD(t[e+1],t[e+2]),n=i?null:yl.instance(r);return[{},n,e+3]}function rR(t,e){const i=t[e]?Dp.create(t[e]):null;return[{},i,e+1]}const WFe=RegExp(`^T?${$Y.source}$`),XFe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function JFe(t){const[e,i,r,n,s,a,u,p,y]=t,b=e[0]==="-",S=p&&p[0]==="-",C=(O,P=!1)=>O!==void 0&&(P||O&&b)?-O:O;return[{years:C(Xv(i)),months:C(Xv(r)),weeks:C(Xv(n)),days:C(Xv(s)),hours:C(Xv(a)),minutes:C(Xv(u)),seconds:C(Xv(p),p==="-0"),milliseconds:C(PY(y),S)}]}const YFe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function DY(t,e,i,r,n,s,a){const u={year:e.length===2?iV(my(e)):my(e),month:zye.indexOf(i)+1,day:my(r),hour:my(n),minute:my(s)};return a&&(u.second=my(a)),t&&(u.weekday=t.length>3?jye.indexOf(t)+1:Bye.indexOf(t)+1),u}const ZFe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function KFe(t){const[,e,i,r,n,s,a,u,p,y,b,S]=t,C=DY(e,n,r,i,s,a,u);let O;return p?O=YFe[p]:y?O=0:O=KD(b,S),[C,new yl(O)]}function QFe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const eke=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,tke=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,ike=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function dre(t){const[,e,i,r,n,s,a,u]=t;return[DY(e,n,r,i,s,a,u),yl.utcInstance]}function rke(t){const[,e,i,r,n,s,a,u]=t;return[DY(e,u,i,r,n,s,a),yl.utcInstance]}const nke=hE(zFe,LY),ske=hE(UFe,LY),oke=hE(jFe,LY),ake=hE(Jye),Zye=dE(qFe,fE,iR,rR),lke=dE(BFe,fE,iR,rR),cke=dE(VFe,fE,iR,rR),uke=dE(fE,iR,rR);function hke(t){return pE(t,[nke,Zye],[ske,lke],[oke,cke],[ake,uke])}function dke(t){return pE(QFe(t),[ZFe,KFe])}function pke(t){return pE(t,[eke,dre],[tke,dre],[ike,rke])}function fke(t){return pE(t,[XFe,JFe])}const mke=dE(fE);function gke(t){return pE(t,[WFe,mke])}const yke=hE(GFe,HFe),vke=hE(Yye),_ke=dE(fE,iR,rR);function bke(t){return pE(t,[yke,Zye],[vke,_ke])}const pre="Invalid Duration",Kye={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},wke={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...Kye},rh=146097/400,Hw=146097/4800,xke={years:{quarters:4,months:12,weeks:rh/7,days:rh,hours:rh*24,minutes:rh*24*60,seconds:rh*24*60*60,milliseconds:rh*24*60*60*1e3},quarters:{months:3,weeks:rh/28,days:rh/4,hours:rh*24/4,minutes:rh*24*60/4,seconds:rh*24*60*60/4,milliseconds:rh*24*60*60*1e3/4},months:{weeks:Hw/7,days:Hw,hours:Hw*24,minutes:Hw*24*60,seconds:Hw*24*60*60,milliseconds:Hw*24*60*60*1e3},...Kye},i2=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Tke=i2.slice(0).reverse();function o1(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Qr(r)}function Qye(t,e){let i=e.milliseconds??0;for(const r of Tke.slice(1))e[r]&&(i+=e[r]*t[r].milliseconds);return i}function fre(t,e){const i=Qye(t,e)<0?-1:1;i2.reduceRight((r,n)=>{if(Nr(e[n]))return r;if(r){const s=e[r]*i,a=t[n][r],u=Math.floor(s/a);e[n]+=u*i,e[r]-=u*a*i}return n},null),i2.reduce((r,n)=>{if(Nr(e[n]))return r;if(r){const s=e[r]%1;e[r]-=s,e[n]+=s*t[r][n]}return n},null)}function Ske(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class Qr{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?xke:wke;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||ms.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return Qr.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new Lh(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Qr({values:gL(e,Qr.normalizeUnit),loc:ms.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(v2(e))return Qr.fromMillis(e);if(Qr.isDuration(e))return e;if(typeof e=="object")return Qr.fromObject(e);throw new Lh(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=fke(e);return r?Qr.fromObject(r,i):Qr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=gke(e);return r?Qr.fromObject(r,i):Qr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new Lh("need to specify a reason the Duration is invalid");const r=e instanceof gp?e:new gp(e,i);if(xo.throwOnInvalid)throw new tFe(r);return new Qr({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new gye(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?gl.create(this.loc,r).formatDurationFromString(this,e):pre}toHuman(e={}){if(!this.isValid)return pre;const i=i2.map(r=>{const n=this.values[r];return Nr(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(n)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=IY(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();return i<0||i>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},Ui.fromMillis(i,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.isValid?Qye(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=Qr.fromDurationLike(e),r={};for(const n of i2)(SS(i.values,n)||SS(this.values,n))&&(r[n]=i.get(n)+this.get(n));return o1(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=Qr.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=kye(e(this.values[r],r));return o1(this,{values:i},!0)}get(e){return this[Qr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...gL(e,Qr.normalizeUnit)};return o1(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:n}={}){const a={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:n,conversionAccuracy:r};return o1(this,a)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return fre(this.matrix,e),o1(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=Ske(this.normalize().shiftToAll().toObject());return o1(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(a=>Qr.normalizeUnit(a));const i={},r={},n=this.toObject();let s;for(const a of i2)if(e.indexOf(a)>=0){s=a;let u=0;for(const y in r)u+=this.matrix[y][a]*r[y],r[y]=0;v2(n[a])&&(u+=n[a]);const p=Math.trunc(u);i[a]=p,r[a]=(u*1e3-p*1e3)/1e3}else v2(n[a])&&(r[a]=n[a]);for(const a in r)r[a]!==0&&(i[s]+=a===s?r[a]:r[a]/this.matrix[s][a]);return fre(this.matrix,i),o1(this,{values:i},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return o1(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,n){return r===void 0||r===0?n===void 0||n===0:r===n}for(const r of i2)if(!i(this.values[r],e.values[r]))return!1;return!0}}const qw="Invalid Interval";function Eke(t,e){return!t||!t.isValid?zs.invalid("missing or invalid start"):!e||!e.isValid?zs.invalid("missing or invalid end"):e<t?zs.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class zs{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new Lh("need to specify a reason the Interval is invalid");const r=e instanceof gp?e:new gp(e,i);if(xo.throwOnInvalid)throw new eFe(r);return new zs({invalid:r})}static fromDateTimes(e,i){const r=jE(e),n=jE(i),s=Eke(r,n);return s??new zs({start:r,end:n})}static after(e,i){const r=Qr.fromDurationLike(i),n=jE(e);return zs.fromDateTimes(n,n.plus(r))}static before(e,i){const r=Qr.fromDurationLike(i),n=jE(e);return zs.fromDateTimes(n.minus(r),n)}static fromISO(e,i){const[r,n]=(e||"").split("/",2);if(r&&n){let s,a;try{s=Ui.fromISO(r,i),a=s.isValid}catch{a=!1}let u,p;try{u=Ui.fromISO(n,i),p=u.isValid}catch{p=!1}if(a&&p)return zs.fromDateTimes(s,u);if(a){const y=Qr.fromISO(n,i);if(y.isValid)return zs.after(s,y)}else if(p){const y=Qr.fromISO(r,i);if(y.isValid)return zs.before(u,y)}}return zs.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(e),r=this.end.startOf(e);return Math.floor(r.diff(i,e).get(e))+(r.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?zs.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(jE).filter(a=>this.contains(a)).sort(),r=[];let{s:n}=this,s=0;for(;n<this.e;){const a=i[s]||this.e,u=+a>+this.e?this.e:a;r.push(zs.fromDateTimes(n,u)),n=u,s+=1}return r}splitBy(e){const i=Qr.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,n=1,s;const a=[];for(;r<this.e;){const u=this.start.plus(i.mapUnits(p=>p*n));s=+u>+this.e?this.e:u,a.push(zs.fromDateTimes(r,s)),r=s,n+=1}return a}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:zs.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return zs.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((n,s)=>n.s-s.s).reduce(([n,s],a)=>s?s.overlaps(a)||s.abutsStart(a)?[n,s.union(a)]:[n.concat([s]),a]:[n,a],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const n=[],s=e.map(p=>[{time:p.s,type:"s"},{time:p.e,type:"e"}]),a=Array.prototype.concat(...s),u=a.sort((p,y)=>p.time-y.time);for(const p of u)r+=p.type==="s"?1:-1,r===1?i=p.time:(i&&+i!=+p.time&&n.push(zs.fromDateTimes(i,p.time)),i=null);return zs.merge(n)}difference(...e){return zs.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} â€“ ${this.e.toISO()})`:qw}toLocaleString(e=pL,i={}){return this.isValid?gl.create(this.s.loc.clone(i),e).formatInterval(this):qw}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:qw}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:qw}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:qw}toFormat(e,{separator:i=" â€“ "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:qw}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):Qr.invalid(this.invalidReason)}mapEndpoints(e){return zs.fromDateTimes(e(this.s),e(this.e))}}class hM{static hasDST(e=xo.defaultZone){const i=Ui.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return Dp.isValidZone(e)}static normalizeZone(e){return Sy(e,xo.defaultZone)}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||ms.create(i,r,s)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||ms.create(i,r,s)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null}={}){return(n||ms.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null}={}){return(n||ms.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return ms.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return ms.create(i,null,"gregory").eras(e)}static features(){return{relative:Nye()}}}function mre(t,e){const i=n=>n.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(Qr.fromMillis(r).as("days"))}function Cke(t,e,i){const r=[["years",(p,y)=>y.year-p.year],["quarters",(p,y)=>y.quarter-p.quarter+(y.year-p.year)*4],["months",(p,y)=>y.month-p.month+(y.year-p.year)*12],["weeks",(p,y)=>{const b=mre(p,y);return(b-b%7)/7}],["days",mre]],n={},s=t;let a,u;for(const[p,y]of r)i.indexOf(p)>=0&&(a=p,n[p]=y(t,e),u=s.plus(n),u>e?(n[p]--,t=s.plus(n),t>e&&(u=t,n[p]--,t=s.plus(n))):t=u);return[t,n,u,a]}function Ake(t,e,i,r){let[n,s,a,u]=Cke(t,e,i);const p=e-n,y=i.filter(S=>["hours","minutes","seconds","milliseconds"].indexOf(S)>=0);y.length===0&&(a<e&&(a=n.plus({[u]:1})),a!==n&&(s[u]=(s[u]||0)+p/(a-n)));const b=Qr.fromObject(s,r);return y.length>0?Qr.fromMillis(p,r).shiftTo(...y).plus(b):b}const NY={arab:"[Ù -Ù©]",arabext:"[Û°-Û¹]",bali:"[á­-á­™]",beng:"[à§¦-à§¯]",deva:"[à¥¦-à¥¯]",fullwide:"[ï¼-ï¼™]",gujr:"[à«¦-à«¯]",hanidec:"[ã€‡|ä¸€|äºŒ|ä¸‰|å››|äº”|å…­|ä¸ƒ|å…«|ä¹]",khmr:"[áŸ -áŸ©]",knda:"[à³¦-à³¯]",laoo:"[à»-à»™]",limb:"[á¥†-á¥]",mlym:"[àµ¦-àµ¯]",mong:"[á -á ™]",mymr:"[á€-á‰]",orya:"[à­¦-à­¯]",tamldec:"[à¯¦-à¯¯]",telu:"[à±¦-à±¯]",thai:"[à¹-à¹™]",tibt:"[à¼ -à¼©]",latn:"\\d"},gre={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Oke=NY.hanidec.replace(/[\[|\]]/g,"").split("");function Rke(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(NY.hanidec)!==-1)e+=Oke.indexOf(t[i]);else for(const n in gre){const[s,a]=gre[n];r>=s&&r<=a&&(e+=r-s)}}return parseInt(e,10)}else return e}function _d({numberingSystem:t},e=""){return new RegExp(`${NY[t||"latn"]}${e}`)}const Mke="missing Intl.DateTimeFormat.formatToParts support";function hn(t,e=i=>i){return{regex:t,deser:([i])=>e(Rke(i))}}const Pke=String.fromCharCode(160),eve=`[ ${Pke}]`,tve=new RegExp(eve,"g");function Ike(t){return t.replace(/\./g,"\\.?").replace(tve,eve)}function yre(t){return t.replace(/\./g,"").replace(tve," ").toLowerCase()}function bd(t,e){return t===null?null:{regex:RegExp(t.map(Ike).join("|")),deser:([i])=>t.findIndex(r=>yre(i)===yre(r))+e}}function vre(t,e){return{regex:t,deser:([,i,r])=>KD(i,r),groups:e}}function dM(t){return{regex:t,deser:([e])=>e}}function $ke(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Lke(t,e){const i=_d(e),r=_d(e,"{2}"),n=_d(e,"{3}"),s=_d(e,"{4}"),a=_d(e,"{6}"),u=_d(e,"{1,2}"),p=_d(e,"{1,3}"),y=_d(e,"{1,6}"),b=_d(e,"{1,9}"),S=_d(e,"{2,4}"),C=_d(e,"{4,6}"),O=N=>({regex:RegExp($ke(N.val)),deser:([z])=>z,literal:!0}),$=(N=>{if(t.literal)return O(N);switch(N.val){case"G":return bd(e.eras("short"),0);case"GG":return bd(e.eras("long"),0);case"y":return hn(y);case"yy":return hn(S,iV);case"yyyy":return hn(s);case"yyyyy":return hn(C);case"yyyyyy":return hn(a);case"M":return hn(u);case"MM":return hn(r);case"MMM":return bd(e.months("short",!0),1);case"MMMM":return bd(e.months("long",!0),1);case"L":return hn(u);case"LL":return hn(r);case"LLL":return bd(e.months("short",!1),1);case"LLLL":return bd(e.months("long",!1),1);case"d":return hn(u);case"dd":return hn(r);case"o":return hn(p);case"ooo":return hn(n);case"HH":return hn(r);case"H":return hn(u);case"hh":return hn(r);case"h":return hn(u);case"mm":return hn(r);case"m":return hn(u);case"q":return hn(u);case"qq":return hn(r);case"s":return hn(u);case"ss":return hn(r);case"S":return hn(p);case"SSS":return hn(n);case"u":return dM(b);case"uu":return dM(u);case"uuu":return hn(i);case"a":return bd(e.meridiems(),0);case"kkkk":return hn(s);case"kk":return hn(S,iV);case"W":return hn(u);case"WW":return hn(r);case"E":case"c":return hn(i);case"EEE":return bd(e.weekdays("short",!1),1);case"EEEE":return bd(e.weekdays("long",!1),1);case"ccc":return bd(e.weekdays("short",!0),1);case"cccc":return bd(e.weekdays("long",!0),1);case"Z":case"ZZ":return vre(new RegExp(`([+-]${u.source})(?::(${r.source}))?`),2);case"ZZZ":return vre(new RegExp(`([+-]${u.source})(${r.source})?`),2);case"z":return dM(/[a-z_+-/]{1,256}?/i);case" ":return dM(/[^\S\n\r]/);default:return O(N)}})(t)||{invalidReason:Mke};return $.token=t,$}const Dke={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function Nke(t,e,i){const{type:r,value:n}=t;if(r==="literal"){const p=/^\s+$/.test(n);return{literal:!p,val:p?" ":n}}const s=e[r];let a=r;r==="hour"&&(e.hour12!=null?a=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?a="hour12":a="hour24":a=i.hour12?"hour12":"hour24");let u=Dke[a];if(typeof u=="object"&&(u=u[s]),u)return{literal:!1,val:u}}function Fke(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function kke(t,e,i){const r=t.match(e);if(r){const n={};let s=1;for(const a in i)if(SS(i,a)){const u=i[a],p=u.groups?u.groups+1:1;!u.literal&&u.token&&(n[u.token.val[0]]=u.deser(r.slice(s,s+p))),s+=p}return[r,n]}else return[r,{}]}function zke(t){const e=s=>{switch(s){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Nr(t.z)||(i=Dp.create(t.z)),Nr(t.Z)||(i||(i=new yl(t.Z)),r=t.Z),Nr(t.q)||(t.M=(t.q-1)*3+1),Nr(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Nr(t.u)||(t.S=PY(t.u)),[Object.keys(t).reduce((s,a)=>{const u=e(a);return u&&(s[u]=t[a]),s},{}),i,r]}let vF=null;function Uke(){return vF||(vF=Ui.fromMillis(1555555555555)),vF}function jke(t,e){if(t.literal)return t;const i=gl.macroTokenToFormatOpts(t.val),r=nve(i,e);return r==null||r.includes(void 0)?t:r}function ive(t,e){return Array.prototype.concat(...t.map(i=>jke(i,e)))}function rve(t,e,i){const r=ive(gl.parseFormat(i),t),n=r.map(a=>Lke(a,t)),s=n.find(a=>a.invalidReason);if(s)return{input:e,tokens:r,invalidReason:s.invalidReason};{const[a,u]=Fke(n),p=RegExp(a,"i"),[y,b]=kke(e,p,u),[S,C,O]=b?zke(b):[null,null,void 0];if(SS(b,"a")&&SS(b,"H"))throw new n5("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:p,rawMatches:y,matches:b,result:S,zone:C,specificOffset:O}}}function Bke(t,e,i){const{result:r,zone:n,specificOffset:s,invalidReason:a}=rve(t,e,i);return[r,n,s,a]}function nve(t,e){if(!t)return null;const r=gl.create(e,t).dtFormatter(Uke()),n=r.formatToParts(),s=r.resolvedOptions();return n.map(a=>Nke(a,t,s))}const sve=[0,31,59,90,120,151,181,212,243,273,304,334],ove=[0,31,60,91,121,152,182,213,244,274,305,335];function Gh(t,e){return new gp("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function ave(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const n=r.getUTCDay();return n===0?7:n}function lve(t,e,i){return i+(tR(t)?ove:sve)[e-1]}function cve(t,e){const i=tR(t)?ove:sve,r=i.findIndex(s=>s<e),n=e-i[r];return{month:r+1,day:n}}function rV(t){const{year:e,month:i,day:r}=t,n=lve(e,i,r),s=ave(e,i,r);let a=Math.floor((n-s+10)/7),u;return a<1?(u=e-1,a=mL(u)):a>mL(e)?(u=e+1,a=1):u=e,{weekYear:u,weekNumber:a,weekday:s,...QD(t)}}function _re(t){const{weekYear:e,weekNumber:i,weekday:r}=t,n=ave(e,1,4),s=NA(e);let a=i*7+r-n-3,u;a<1?(u=e-1,a+=NA(u)):a>s?(u=e+1,a-=NA(e)):u=e;const{month:p,day:y}=cve(u,a);return{year:u,month:p,day:y,...QD(t)}}function _F(t){const{year:e,month:i,day:r}=t,n=lve(e,i,r);return{year:e,ordinal:n,...QD(t)}}function bre(t){const{year:e,ordinal:i}=t,{month:r,day:n}=cve(e,i);return{year:e,month:r,day:n,...QD(t)}}function Vke(t){const e=YD(t.weekYear),i=sg(t.weekNumber,1,mL(t.weekYear)),r=sg(t.weekday,1,7);return e?i?r?!1:Gh("weekday",t.weekday):Gh("week",t.week):Gh("weekYear",t.weekYear)}function Gke(t){const e=YD(t.year),i=sg(t.ordinal,1,NA(t.year));return e?i?!1:Gh("ordinal",t.ordinal):Gh("year",t.year)}function uve(t){const e=YD(t.year),i=sg(t.month,1,12),r=sg(t.day,1,fL(t.year,t.month));return e?i?r?!1:Gh("day",t.day):Gh("month",t.month):Gh("year",t.year)}function hve(t){const{hour:e,minute:i,second:r,millisecond:n}=t,s=sg(e,0,23)||e===24&&i===0&&r===0&&n===0,a=sg(i,0,59),u=sg(r,0,59),p=sg(n,0,999);return s?a?u?p?!1:Gh("millisecond",n):Gh("second",r):Gh("minute",i):Gh("hour",e)}const bF="Invalid DateTime",wre=864e13;function pM(t){return new gp("unsupported zone",`the zone "${t.name}" is not supported`)}function wF(t){return t.weekData===null&&(t.weekData=rV(t.c)),t.weekData}function Jv(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new Ui({...i,...e,old:i})}function dve(t,e,i){let r=t-e*60*1e3;const n=i.offset(r);if(e===n)return[r,e];r-=(n-e)*60*1e3;const s=i.offset(r);return n===s?[r,n]:[t-Math.min(n,s)*60*1e3,Math.max(n,s)]}function fM(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function MI(t,e,i){return dve(ZD(t),e,i)}function xre(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),n=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,s={...t.c,year:r,month:n,day:Math.min(t.c.day,fL(r,n))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},a=Qr.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),u=ZD(s);let[p,y]=dve(u,i,t.zone);return a!==0&&(p+=a,y=t.zone.offset(p)),{ts:p,o:y}}function UE(t,e,i,r,n,s){const{setZone:a,zone:u}=i;if(t&&Object.keys(t).length!==0||e){const p=e||u,y=Ui.fromObject(t,{...i,zone:p,specificOffset:s});return a?y:y.setZone(u)}else return Ui.invalid(new gp("unparsable",`the input "${n}" can't be parsed as ${r}`))}function mM(t,e,i=!0){return t.isValid?gl.create(ms.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function xF(t,e){const i=t.c.year>9999||t.c.year<0;let r="";return i&&t.c.year>=0&&(r+="+"),r+=So(t.c.year,i?6:4),e?(r+="-",r+=So(t.c.month),r+="-",r+=So(t.c.day)):(r+=So(t.c.month),r+=So(t.c.day)),r}function Tre(t,e,i,r,n,s){let a=So(t.c.hour);return e?(a+=":",a+=So(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(a+=":")):a+=So(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(a+=So(t.c.second),(t.c.millisecond!==0||!r)&&(a+=".",a+=So(t.c.millisecond,3))),n&&(t.isOffsetFixed&&t.offset===0&&!s?a+="Z":t.o<0?(a+="-",a+=So(Math.trunc(-t.o/60)),a+=":",a+=So(Math.trunc(-t.o%60))):(a+="+",a+=So(Math.trunc(t.o/60)),a+=":",a+=So(Math.trunc(t.o%60)))),s&&(a+="["+t.zone.ianaName+"]"),a}const pve={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},Hke={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},qke={ordinal:1,hour:0,minute:0,second:0,millisecond:0},fve=["year","month","day","hour","minute","second","millisecond"],Wke=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Xke=["year","ordinal","hour","minute","second","millisecond"];function Sre(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new gye(t);return e}function Ere(t,e){const i=Sy(e.zone,xo.defaultZone),r=ms.fromObject(e),n=xo.now();let s,a;if(Nr(t.year))s=n;else{for(const y of fve)Nr(t[y])&&(t[y]=pve[y]);const u=uve(t)||hve(t);if(u)return Ui.invalid(u);const p=i.offset(n);[s,a]=MI(t,p,i)}return new Ui({ts:s,zone:i,loc:r,o:a})}function Cre(t,e,i){const r=Nr(i.round)?!0:i.round,n=(a,u)=>(a=IY(a,r||i.calendary?0:2,!0),e.loc.clone(i).relFormatter(i).format(a,u)),s=a=>i.calendary?e.hasSame(t,a)?0:e.startOf(a).diff(t.startOf(a),a).get(a):e.diff(t,a).get(a);if(i.unit)return n(s(i.unit),i.unit);for(const a of i.units){const u=s(a);if(Math.abs(u)>=1)return n(u,a)}return n(t>e?-0:0,i.units[i.units.length-1])}function Are(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}class Ui{constructor(e){const i=e.zone||xo.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new gp("invalid input"):null)||(i.isValid?null:pM(i));this.ts=Nr(e.ts)?xo.now():e.ts;let n=null,s=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[n,s]=[e.old.c,e.old.o];else{const u=i.offset(this.ts);n=fM(this.ts,u),r=Number.isNaN(n.year)?new gp("invalid input"):null,n=r?null:n,s=r?null:u}this._zone=i,this.loc=e.loc||ms.create(),this.invalid=r,this.weekData=null,this.c=n,this.o=s,this.isLuxonDateTime=!0}static now(){return new Ui({})}static local(){const[e,i]=Are(arguments),[r,n,s,a,u,p,y]=i;return Ere({year:r,month:n,day:s,hour:a,minute:u,second:p,millisecond:y},e)}static utc(){const[e,i]=Are(arguments),[r,n,s,a,u,p,y]=i;return e.zone=yl.utcInstance,Ere({year:r,month:n,day:s,hour:a,minute:u,second:p,millisecond:y},e)}static fromJSDate(e,i={}){const r=xFe(e)?e.valueOf():NaN;if(Number.isNaN(r))return Ui.invalid("invalid input");const n=Sy(i.zone,xo.defaultZone);return n.isValid?new Ui({ts:r,zone:n,loc:ms.fromObject(i)}):Ui.invalid(pM(n))}static fromMillis(e,i={}){if(v2(e))return e<-wre||e>wre?Ui.invalid("Timestamp out of range"):new Ui({ts:e,zone:Sy(i.zone,xo.defaultZone),loc:ms.fromObject(i)});throw new Lh(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(v2(e))return new Ui({ts:e*1e3,zone:Sy(i.zone,xo.defaultZone),loc:ms.fromObject(i)});throw new Lh("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=Sy(i.zone,xo.defaultZone);if(!r.isValid)return Ui.invalid(pM(r));const n=xo.now(),s=Nr(i.specificOffset)?r.offset(n):i.specificOffset,a=gL(e,Sre),u=!Nr(a.ordinal),p=!Nr(a.year),y=!Nr(a.month)||!Nr(a.day),b=p||y,S=a.weekYear||a.weekNumber,C=ms.fromObject(i);if((b||u)&&S)throw new n5("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(y&&u)throw new n5("Can't mix ordinal dates with month/day");const O=S||a.weekday&&!b;let P,$,N=fM(n,s);O?(P=Wke,$=Hke,N=rV(N)):u?(P=Xke,$=qke,N=_F(N)):(P=fve,$=pve);let z=!1;for(const se of P){const ae=a[se];Nr(ae)?z?a[se]=$[se]:a[se]=N[se]:z=!0}const U=O?Vke(a):u?Gke(a):uve(a),j=U||hve(a);if(j)return Ui.invalid(j);const G=O?_re(a):u?bre(a):a,[q,W]=MI(G,s,r),K=new Ui({ts:q,zone:r,o:W,loc:C});return a.weekday&&b&&e.weekday!==K.weekday?Ui.invalid("mismatched weekday",`you can't specify both a weekday of ${a.weekday} and a date of ${K.toISO()}`):K}static fromISO(e,i={}){const[r,n]=hke(e);return UE(r,n,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,n]=dke(e);return UE(r,n,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,n]=pke(e);return UE(r,n,i,"HTTP",i)}static fromFormat(e,i,r={}){if(Nr(e)||Nr(i))throw new Lh("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:s=null}=r,a=ms.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0}),[u,p,y,b]=Bke(a,e,i);return b?Ui.invalid(b):UE(u,p,r,`format ${i}`,e,y)}static fromString(e,i,r={}){return Ui.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,n]=bke(e);return UE(r,n,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new Lh("need to specify a reason the DateTime is invalid");const r=e instanceof gp?e:new gp(e,i);if(xo.throwOnInvalid)throw new QNe(r);return new Ui({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=nve(e,ms.fromObject(i));return r?r.map(n=>n?n.val:null).join(""):null}static expandFormat(e,i={}){return ive(gl.parseFormat(e),ms.fromObject(i)).map(n=>n.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?wF(this).weekYear:NaN}get weekNumber(){return this.isValid?wF(this).weekNumber:NaN}get weekday(){return this.isValid?wF(this).weekday:NaN}get ordinal(){return this.isValid?_F(this.c).ordinal:NaN}get monthShort(){return this.isValid?hM.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?hM.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?hM.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?hM.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,i=6e4,r=ZD(this.c),n=this.zone.offset(r-e),s=this.zone.offset(r+e),a=this.zone.offset(r-n*i),u=this.zone.offset(r-s*i);if(a===u)return[this];const p=r-a*i,y=r-u*i,b=fM(p,a),S=fM(y,u);return b.hour===S.hour&&b.minute===S.minute&&b.second===S.second&&b.millisecond===S.millisecond?[Jv(this,{ts:p}),Jv(this,{ts:y})]:[this]}get isInLeapYear(){return tR(this.year)}get daysInMonth(){return fL(this.year,this.month)}get daysInYear(){return this.isValid?NA(this.year):NaN}get weeksInWeekYear(){return this.isValid?mL(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:n}=gl.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:n}}toUTC(e=0,i={}){return this.setZone(yl.instance(e),i)}toLocal(){return this.setZone(xo.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=Sy(e,xo.defaultZone),e.equals(this.zone))return this;if(e.isValid){let n=this.ts;if(i||r){const s=e.offset(this.ts),a=this.toObject();[n]=MI(a,s,e)}return Jv(this,{ts:n,zone:e})}else return Ui.invalid(pM(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const n=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return Jv(this,{loc:n})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=gL(e,Sre),r=!Nr(i.weekYear)||!Nr(i.weekNumber)||!Nr(i.weekday),n=!Nr(i.ordinal),s=!Nr(i.year),a=!Nr(i.month)||!Nr(i.day),u=s||a,p=i.weekYear||i.weekNumber;if((u||n)&&p)throw new n5("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(a&&n)throw new n5("Can't mix ordinal dates with month/day");let y;r?y=_re({...rV(this.c),...i}):Nr(i.ordinal)?(y={...this.toObject(),...i},Nr(i.day)&&(y.day=Math.min(fL(y.year,y.month),y.day))):y=bre({..._F(this.c),...i});const[b,S]=MI(y,this.o,this.zone);return Jv(this,{ts:b,o:S})}plus(e){if(!this.isValid)return this;const i=Qr.fromDurationLike(e);return Jv(this,xre(this,i))}minus(e){if(!this.isValid)return this;const i=Qr.fromDurationLike(e).negate();return Jv(this,xre(this,i))}startOf(e){if(!this.isValid)return this;const i={},r=Qr.normalizeUnit(e);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const n=Math.ceil(this.month/3);i.month=(n-1)*3+1}return this.set(i)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,i={}){return this.isValid?gl.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):bF}toLocaleString(e=pL,i={}){return this.isValid?gl.create(this.loc.clone(i),e).formatDateTime(this):bF}toLocaleParts(e={}){return this.isValid?gl.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:n=!0,extendedZone:s=!1}={}){if(!this.isValid)return null;const a=e==="extended";let u=xF(this,a);return u+="T",u+=Tre(this,a,i,r,n,s),u}toISODate({format:e="extended"}={}){return this.isValid?xF(this,e==="extended"):null}toISOWeekDate(){return mM(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:n=!1,extendedZone:s=!1,format:a="extended"}={}){return this.isValid?(n?"T":"")+Tre(this,a==="extended",i,e,r,s):null}toRFC2822(){return mM(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return mM(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?xF(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let n="HH:mm:ss.SSS";return(i||e)&&(r&&(n+=" "),i?n+="z":e&&(n+="ZZ")),mM(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():bF}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return Qr.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...r},s=TFe(i).map(Qr.normalizeUnit),a=e.valueOf()>this.valueOf(),u=a?this:e,p=a?e:this,y=Ake(u,p,s,n);return a?y.negate():y}diffNow(e="milliseconds",i={}){return this.diff(Ui.now(),e,i)}until(e){return this.isValid?zs.fromDateTimes(this,e):this}hasSame(e,i){if(!this.isValid)return!1;const r=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(i)<=r&&r<=n.endOf(i)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||Ui.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],s=e.unit;return Array.isArray(e.unit)&&(n=e.unit,s=void 0),Cre(i,this.plus(r),{...e,numeric:"always",units:n,unit:s})}toRelativeCalendar(e={}){return this.isValid?Cre(e.base||Ui.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(Ui.isDateTime))throw new Lh("min requires all arguments be DateTimes");return ure(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(Ui.isDateTime))throw new Lh("max requires all arguments be DateTimes");return ure(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:n=null,numberingSystem:s=null}=r,a=ms.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});return rve(a,e,i)}static fromStringExplain(e,i,r={}){return Ui.fromFormatExplain(e,i,r)}static get DATE_SHORT(){return pL}static get DATE_MED(){return yye}static get DATE_MED_WITH_WEEKDAY(){return iFe}static get DATE_FULL(){return vye}static get DATE_HUGE(){return _ye}static get TIME_SIMPLE(){return bye}static get TIME_WITH_SECONDS(){return wye}static get TIME_WITH_SHORT_OFFSET(){return xye}static get TIME_WITH_LONG_OFFSET(){return Tye}static get TIME_24_SIMPLE(){return Sye}static get TIME_24_WITH_SECONDS(){return Eye}static get TIME_24_WITH_SHORT_OFFSET(){return Cye}static get TIME_24_WITH_LONG_OFFSET(){return Aye}static get DATETIME_SHORT(){return Oye}static get DATETIME_SHORT_WITH_SECONDS(){return Rye}static get DATETIME_MED(){return Mye}static get DATETIME_MED_WITH_SECONDS(){return Pye}static get DATETIME_MED_WITH_WEEKDAY(){return rFe}static get DATETIME_FULL(){return Iye}static get DATETIME_FULL_WITH_SECONDS(){return $ye}static get DATETIME_HUGE(){return Lye}static get DATETIME_HUGE_WITH_SECONDS(){return Dye}}function jE(t){if(Ui.isDateTime(t))return t;if(t&&t.valueOf&&v2(t.valueOf()))return Ui.fromJSDate(t);if(t&&typeof t=="object")return Ui.fromObject(t);throw new Lh(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const O0="system",ES="unknown",W2="UTC",Jke=Intl.DateTimeFormat().resolvedOptions().timeZone,Yke="shortOffset";function Zke(t){return"timeZoneIANA"in t}function Kke(t){return t.startsWith("UTC")}function yL(t,e=!1){return{json:{read:{source:t,reader:(i,r)=>r[t]?PI(r[t]):null},write:!!e&&{allowNull:!0,writer(i,r){r[t]=i?Qke(i):null}}}}}function PI(t,e=O0){return t?Zke(t)?t.timeZoneIANA:eze(t,e):e}function Qke(t){return{timeZoneIANA:t}}function eze(t,e=O0){if(!t||!tre.has(t.timeZone))return e;const i=tre.get(t.timeZone);return Kke(t.timeZone)||t.respectsDaylightSaving?i:tze(i)}function tze(t){const e=Ui.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${yl.instance(-i).formatOffset(0,"narrow")}`}function IMt(t,e,i,r,n){if(e&&n==="date")return{timeZone:W2,timeZoneName:void 0};const s=r.timeStyle||r.hour,a=i===ES;return{timeZone:a?n==="timestamp-offset"?void 0:t??W2:i,timeZoneName:a&&s?Yke:void 0}}const ize={year:void 0,month:void 0,day:void 0,weekday:void 0},rze={hour:void 0,minute:void 0,second:void 0},mve={timeZone:W2},Zp={year:"numeric",month:"numeric",day:"numeric"},BE={year:"numeric",month:"long",day:"numeric"},VE={year:"numeric",month:"short",day:"numeric"},GE={year:"numeric",month:"long",weekday:"long",day:"numeric"},gy={hour:"numeric",minute:"numeric"},z_={...gy,second:"numeric"},gve={hourCycle:"h23"},HE={...gy,...gve},qE={...z_,...gve},yve={"short-date":Zp,"short-date-short-time":{...Zp,...gy},"short-date-short-time-24":{...Zp,...HE},"short-date-long-time":{...Zp,...z_},"short-date-long-time-24":{...Zp,...qE},"short-date-le":Zp,"short-date-le-short-time":{...Zp,...gy},"short-date-le-short-time-24":{...Zp,...HE},"short-date-le-long-time":{...Zp,...z_},"short-date-le-long-time-24":{...Zp,...qE},"long-month-day-year":BE,"long-month-day-year-short-time":{...BE,...gy},"long-month-day-year-short-time-24":{...BE,...HE},"long-month-day-year-long-time":{...BE,...z_},"long-month-day-year-long-time-24":{...BE,...qE},"day-short-month-year":VE,"day-short-month-year-short-time":{...VE,...gy},"day-short-month-year-short-time-24":{...VE,...HE},"day-short-month-year-long-time":{...VE,...z_},"day-short-month-year-long-time-24":{...VE,...qE},"long-date":GE,"long-date-short-time":{...GE,...gy},"long-date-short-time-24":{...GE,...HE},"long-date-long-time":{...GE,...z_},"long-date-long-time-24":{...GE,...qE},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":gy,"long-time":z_},nze=Tl()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),vve={ar:"ar-u-nu-latn-ca-gregory"};let nV=new WeakMap;const e7=yve["short-date-short-time"];function sze(t){let e=nV.get(t);if(!e){const i=Bu(),r=vve[i]||i,n=FY(t.timeZone??O0),s={...t,timeZone:n};e=new Intl.DateTimeFormat(r,s),nV.set(t,e)}return e}function oze(t){return yve[t]}function pv(t,e=e7){return sze(e).format(t)}function $Mt(t,e=e7){return pv(new Date(t),{...e,...mve,...rze})}function LMt(t,e=e7){return pv(new Date(`1970-01-01T${t}Z`),{...e,...mve,...ize})}function DMt(t,e=e7){if(e.timeZone)return pv(new Date(t),e);const i=Ui.fromISO(t,{setZone:!0}),r=Bu(),n=vve[r]??r,s=i.offset===0?W2:e.timeZone,a={...e,timeZone:s};return i.toLocaleString(a,{locale:n})}function FY(t){switch(t){case O0:return Jke;case ES:return W2;default:return t}}VJ(()=>{nV=new WeakMap});const aze={ar:"ar-u-nu-latn"};let II=new WeakMap,_ve={};function lze(t){const e=t||_ve;if(!II.has(e)){const i=Bu(),r=aze[Bu()]||i;II.set(e,new Intl.NumberFormat(r,t))}return II.get(e)}function NMt(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function V4(t,e){return Object.is(t,-0)&&(t=0),lze(e).format(t)}VJ(()=>{II=new WeakMap,_ve={}});const bve=Ee.getLogger("esri.intl.substitute");function cze(t,e,i={}){const{format:r={}}=i;return vD(t,n=>uze(n,e,r))}function uze(t,e,i){let r,n;const s=t.indexOf(":");if(s===-1?r=t.trim():(r=t.slice(0,s).trim(),n=t.slice(s+1).trim()),!r)return"";const a=tg(r,e);if(a==null)return"";const u=(n?i?.[n]:null)??i?.[r];return u?hze(a,u):n?dze(a,n):kY(a)}function hze(t,e){switch(e.type){case"date":return pv(t,e.intlOptions);case"number":return V4(t,e.intlOptions);default:return bve.warn("missing format descriptor for key {key}"),kY(t)}}function dze(t,e){switch(e.toLowerCase()){case"dateformat":return pv(t);case"numberformat":return V4(t);default:return bve.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?pv(t):/^numberformat/i.test(e)?V4(t):kY(t)}}function kY(t){switch(typeof t){case"string":return t;case"number":return V4(t);case"boolean":return""+t;default:return t instanceof Date?pv(t):""}}async function pze(t,e,i,r){const n=e.exec(i);if(!n)throw new de("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const s=n[1]?`${n[1]}/`:"",a=n[2],u=gLe(r),p=`${s}${a}.json`,y=u?`${s}${a}_${u}.json`:p;let b;try{b=await Ore(t(y))}catch(S){if(y===p)throw new de("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:S});try{b=await Ore(t(p))}catch(C){throw new de("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:C})}}return b}async function Ore(t){if(Rre.fetchBundleAsset!=null)return Rre.fetchBundleAsset(t);const e=await ir(t,{responseType:"text"});return JSON.parse(e.data)}let fze=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let n;n=typeof r=="string"?s=>new URL(s,new URL(r,window.location.href)).href:r instanceof URL?s=>new URL(s,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=n,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,i){return pze(this.getAssetUrl,this.matcher,e,i)}};function mze(t){return new fze(t)}const Rre={};mLe(mze({pattern:"esri/",location:Kr}));const gze="yyyy-MM-dd",yze="TT";var kA;(function(t){t.HM="HH:mm",t.HMS="HH:mm:ss",t.HMS_MS="HH:mm:ss.SSS"})(kA||(kA={}));const vze=[kA.HMS_MS,kA.HMS,kA.HM,yze];function Mre(t){return Ui.fromFormat(t,gze)}function Pre(t){let e=null;return vze.find(i=>(e=Ui.fromFormat(t,i),e.isValid)),e}function Ire(t){return Ui.fromISO(t)}var CS;(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(CS||(CS={}));const _ze=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function bze(t){return t!=null&&_ze.has(t.type)}function wve(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function xve(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function Tve(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function wze(t,e){const i=t?.domain;if(!i)return null;switch(i.type){case"range":{const{min:r,max:n}=Sve(t);if(r!=null&&+e<r||n!=null&&+e>n)return CS.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(i.codedValues==null||i.codedValues.every(r=>r==null||r.code!==e))return CS.INVALID_CODED_VALUE}return null}function Sve(t,e){const i=e??t?.domain;if(!i||i.type!=="range")return;const r="range"in i?i.range[0]:i.minValue,n="range"in i?i.range[1]:i.maxValue,s=bze(t);return wve(t)||Tve(t)||xve(t)?{...xze(t,n,r),isInteger:s}:{min:r!=null&&typeof r=="number"?r:null,max:n!=null&&typeof n=="number"?n:null,rawMin:r,rawMax:n,isInteger:s}}function xze(t,e,i){return wve(t)?{min:i!=null&&Gw(i)?Mre(i).toMillis():null,max:e!=null&&Gw(e)?Mre(e).toMillis():null,rawMin:i,rawMax:e}:Tve(t)?{min:i!=null&&Gw(i)?Pre(i).toMillis():null,max:e!=null&&Gw(e)?Pre(e).toMillis():null,rawMin:i,rawMax:e}:xve(t)?{min:i!=null&&Gw(i)?Ire(i).toMillis():null,max:e!=null&&Gw(e)?Ire(e).toMillis():null,rawMin:i,rawMax:e}:{max:null,min:null}}const Tze=Ee.getLogger("esri.support.arcadeOnDemand");let TF;function fv(){return TF||(TF=(async()=>{const t=await ke(()=>import("./arcadeUtils-476e8f85.js").then(e=>e.aD),["./arcadeUtils-476e8f85.js","./TimeOnly-05b40277.js","./number-67602970.js","./hash-6f442295.js"],import.meta.url);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),TF}const Sze=(t,e,i)=>zY.create(t,e,i,null,["$feature","$view"],[]),Eze=(t,e,i)=>zY.create(t,e,i,null,["$feature","$view"],[]),Cze=(t,e,i,r)=>zY.create(t,e,i,r,["$feature","$view"],[]);let zY=class Eve{constructor(e,i,r,n,s,a,u){this.services=null,this.script=e,this.evaluate=n;const p=Array.isArray(a)?a:a.fields;this.fields=p,this._syntaxTree=r,this._arcade=i,this._arcadeFeature=s,this._spatialReference=u,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,i,r,n,s,a){const{arcade:u,Feature:p,Dictionary:y}=await fv(),b=dt.fromJSON(i);let S;try{S=u.parseScript(e,a)}catch(se){return Tze.error(new de("arcade-bad-expression","Failed to parse arcade script",{script:e,error:se})),null}const C=s.reduce((se,ae)=>({...se,[ae]:null}),{});let O=null;n!=null&&(O=new y(n),O.immutable=!0,C.$config=null);const P=u.scriptUsesGeometryEngine(S),$=P&&u.enableGeometrySupport(),N=u.scriptUsesFeatureSet(S)&&u.enableFeatureSetSupport(),z=u.scriptIsAsync(S),U=z&&u.enableAsyncSupport(),j={vars:C,spatialReference:b,useAsync:!!U};await Promise.all([$,N,U]);const G=new Set;await u.loadDependentModules(G,S,null,z,P);const q=new y;q.immutable=!1,q.setField("scale",0);const W=u.compileScript(S,j),K=(se,ae)=>{const le=se.$view?.timeZone;return"$view"in se&&se.$view&&(q.setField("scale",typeof se.$view=="object"&&"scale"in se.$view?se.$view.scale:void 0),se.$view=q),O&&(se.$config=O),W({vars:se,spatialReference:b,services:ae,timeZone:le})};return new Eve(e,u,S,K,new p,r,b)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const Aze=/^([0-9_])/,Oze=/[^a-z0-9_\u0080-\uffff]+/gi;function Rze(t){return t==null?null:t.trim().replaceAll(Oze,"_").replace(Aze,"F$1")||null}const Mze=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],Pze=["field","normalizationField"];function vL(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if($re(Mze,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)$re(Pze,r,e)}}function $re(t,e,i){if(t)for(const r of t){const n=tg(r,e),s=n&&typeof n!="function"&&i.get(n);s&&bl(r,s.name,e)}}function UY(t,e){if(t!=null&&e?.fields?.length)if("startField"in t){const i=e.get(t.startField),r=e.get(t.endField);t.startField=i?.name??null,t.endField=r?.name??null}else{const i=e.get(t.startTimeField),r=e.get(t.endTimeField);t.startTimeField=i?.name??null,t.endTimeField=r?.name??null}}const SF=new Set;function jY(t,e){return t&&e?(SF.clear(),G4(SF,t,e),Array.from(SF).sort()):[]}function G4(t,e,i){if(i)if(e?.fields?.length)if(i.includes("*"))for(const{name:r}of e.fields)t.add(r);else for(const r of i)Gu(t,e,r);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const r of i)r!=null&&t.add(r)}}function Gu(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function kMt(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}async function tc(t,e,i){if(!i)return;const{arcadeUtils:r}=await fv(),n=r.extractFieldNames(i,e?.fields?.map(s=>s.name));for(const s of n)Gu(t,e,s)}async function Cve(t,e,i){if(i&&i!=="1=1"){const r=await MY(i,e);if(!r.isStandardized)throw new de("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});G4(t,e,r.fieldNames)}}function Ize({displayField:t,fields:e}){return t||(e?.length?EF(e,"name-or-title")||EF(e,"unique-identifier")||EF(e,"type-or-category")||$ze(e):null)}function $ze(t){for(const e of t){if(!e?.name)continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function EF(t,e){for(const i of t)if(i?.valueType&&i.valueType===e)return i.name;return null}async function zMt(t,e){if(!e)return;const i=e.elevationInfo?.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function Lze(t,e,i){i.onStatisticExpression?tc(t,e,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function UMt(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],n=i.popupTemplate;r.push(Dze(t,e,n)),i.fields&&r.push(...i.fields.map(async s=>Lze(t,e.fieldsIndex,s))),await Promise.all(r)}async function Dze(t,e,i){const r=[];i?.expressionInfos&&r.push(...i.expressionInfos.map(s=>tc(t,e.fieldsIndex,s.expression)));const n=i?.content;if(Array.isArray(n))for(const s of n)s.type==="expression"&&s.expressionInfo&&r.push(tc(t,e.fieldsIndex,s.expressionInfo.expression));await Promise.all(r)}async function jMt(t,e,i){e&&(e.timeInfo&&i?.timeExtent&&G4(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&G4(t,e.fieldsIndex,[e.floorInfo.floorField]),i?.where!=null&&await Cve(t,e.fieldsIndex,i.where))}async function BMt(t,e,i){e&&i&&await Promise.all(i.map(r=>Nze(t,e,r)))}async function Nze(t,e,i){e&&i&&(i.valueExpression?await tc(t,e.fieldsIndex,i.valueExpression):i.field&&Gu(t,e.fieldsIndex,i.field))}function VMt(t){return t?jY(t.fieldsIndex,Ave(t)):[]}function Fze(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?jY(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const kze=new Set(["oid","global-id","guid"]),zze=new Set(["oid","global-id"]),Uze=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i];function jze(t){const e=new Set;Ove(t).forEach(r=>e.add(r)),Fze(t).forEach(r=>e.add(r.toLowerCase()));const i=t&&"infoFor3D"in t?t.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach(r=>e.add(r.toLowerCase())),Object.values(i.transformFieldRoles).forEach(r=>e.add(r.toLowerCase()))),Array.from(e)}function Ave(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:i,creatorField:r,editDateField:n,editorField:s}=e;return[i,r,n,s].filter(Boolean)}function Ove(t){return Ave(t).map(e=>e.toLowerCase())}function Bze(t,e){return t.editable&&!kze.has(t.type)&&!Ove(e).includes(t.name?.toLowerCase()??"")}function Vze(t,e){const i=t.name?.toLowerCase()??"";return!(e?.objectIdField!=null&&i===e.objectIdField.toLowerCase()||e?.globalIdField!=null&&i===e.globalIdField.toLowerCase()||jze(e).includes(i)||zze.has(t.type)||Uze.some(r=>r.test(i)))}async function GMt(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i?.length&&await Promise.all(i.map(n=>Gze(t,r,n)))}async function Gze(t,e,i){if(!i)return;const r=i.getLabelExpression(),n=i.where;if(r.type==="arcade")await tc(t,e,r.expression);else{const s=r.expression.match(/{[^}]*}/g);s&&s.forEach(a=>{Gu(t,e,a.slice(1,-1))})}await Cve(t,e,n)}function Hze(t){const e=t.defaultValue;return e!==void 0&&Pve(t,e)?e:t.nullable?null:void 0}function HMt(t){const e=typeof t=="string"?{type:t}:t;return rUe(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function Rve(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function qze(t){return t===null||Rve(t)}function Wze(t){return t===null||Number.isInteger(t)}function Mve(t){return t!=null&&typeof t=="string"}function Xze(t){return t===null||Mve(t)}function Jze(){return!0}function Pve(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":i=t.nullable?Wze:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?qze:Rve;break;case"string":case"esriFieldTypeString":i=t.nullable?Xze:Mve;break;default:i=Jze}return arguments.length===1?i:i(e)}const Yze=["integer","small-integer","big-integer"],Zze=["single","double"],Kze=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],Qze=["esriFieldTypeSingle","esriFieldTypeDouble"],eUe=new Set([...Yze,...Kze]),tUe=new Set([...Zze,...Qze]),iUe=J9e(eUe,tUe);function BY(t){return t!=null&&iUe.has(t.type)}function rUe(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function Ive(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function qMt(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function WMt(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function nUe(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function Lre(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function Dre(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function XMt(t,e){return sUe(t,e)===null}var _L,bL;function JMt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function sUe(t,e){return t==null||t.nullable&&e===null?null:BY(t)&&!oUe(t.type,Number(e))?_L.OUT_OF_RANGE:Pve(t,e)?t.domain?wze(t,e):null:bL.INVALID_TYPE}function oUe(t,e){const i=typeof t=="string"?$ve(t):t;if(!i)return!1;const r=i.min,n=i.max;return i.isInteger?Number.isInteger(e)&&e>=r&&e<=n:e>=r&&e<=n}function $ve(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return aUe;case"esriFieldTypeInteger":case"integer":return lUe;case"esriFieldTypeBigInteger":case"big-integer":return cUe;case"esriFieldTypeSingle":case"single":return uUe;case"esriFieldTypeDouble":case"double":return hUe}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(_L||(_L={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(bL||(bL={}));const aUe={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},lUe={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},cUe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},uUe={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},hUe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function YMt(t,e,i){switch(t){case CS.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case CS.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case bL.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case _L.OUT_OF_RANGE:{const{min:r,max:n}=$ve(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${n}`}}}function ZMt(t,e){return!dUe(t,e,null)}function dUe(t,e,i){if(!e?.attributes||!t){if(i!=null)for(const s of t??[])i.add(s);return!0}const r=new Set(Object.keys(e.attributes));let n=!1;for(const s of t)if(!r.has(s)){if(n=!0,i==null)break;i.add(s)}return n}function pUe(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let $I=class extends Ne{constructor(e){super(e),this.type=null}};_([T({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],$I.prototype,"type",void 0),$I=_([Z("esri.popup.content.Content")],$I);const Lv=$I;var sV;let U_=sV=class extends Lv{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new sV({description:this.description,displayType:this.displayType,title:this.title})}};_([T({type:String,json:{write:!0}})],U_.prototype,"description",void 0),_([T({type:["auto","preview","list"],json:{write:!0}})],U_.prototype,"displayType",void 0),_([T({type:String,json:{write:!0}})],U_.prototype,"title",void 0),_([T({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],U_.prototype,"type",void 0),U_=sV=_([Z("esri.popup.content.AttachmentsContent")],U_);const H4=U_;var oV;let j_=oV=class extends Lv{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new oV({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?Ce(this.outFields):null})}};_([T()],j_.prototype,"creator",void 0),_([T()],j_.prototype,"destroyer",void 0),_([T()],j_.prototype,"outFields",void 0),_([T({type:["custom"],readOnly:!0})],j_.prototype,"type",void 0),j_=oV=_([Z("esri.popup.content.CustomContent")],j_);const fUe=j_;var aV;let hx=aV=class extends Ne{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new aV({title:this.title,expression:this.expression})}};_([T({type:String,json:{write:!0}})],hx.prototype,"title",void 0),_([T({type:String,json:{write:!0}})],hx.prototype,"expression",void 0),_([T({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],hx.prototype,"returnType",void 0),hx=aV=_([Z("esri.popup.ElementExpressionInfo")],hx);const mUe=hx;var lV;let o5=lV=class extends Lv{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){return new lV({expressionInfo:this.expressionInfo?.clone()})}};_([T({type:mUe,json:{write:!0}})],o5.prototype,"expressionInfo",void 0),_([T({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],o5.prototype,"type",void 0),o5=lV=_([Z("esri.popup.content.ExpressionContent")],o5);const VY=o5;let dx=class extends sn(Ne){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};_([Bt(nze)],dx.prototype,"dateFormat",void 0),_([T({type:Boolean,json:{write:!0}})],dx.prototype,"digitSeparator",void 0),_([T({type:Wr,json:{write:!0}})],dx.prototype,"places",void 0),dx=_([Z("esri.popup.support.FieldInfoFormat")],dx);const LI=dx;var cV;let $d=cV=class extends Ne{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new cV({fieldName:this.fieldName,format:this.format?Ce(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};_([T({type:String,json:{write:!0}})],$d.prototype,"fieldName",void 0),_([T({type:LI,json:{write:!0}})],$d.prototype,"format",void 0),_([T({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],$d.prototype,"isEditable",void 0),_([T({type:String,json:{write:!0}})],$d.prototype,"label",void 0),_([Bt(new br({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],$d.prototype,"stringFieldOption",void 0),_([T({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],$d.prototype,"statisticType",void 0),_([T({type:String,json:{write:!0}})],$d.prototype,"tooltip",void 0),_([T({type:Boolean,json:{write:!0}})],$d.prototype,"visible",void 0),$d=cV=_([Z("esri.popup.FieldInfo")],$d);const GY=$d;var uV;let bm=uV=class extends Lv{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(i=>i.toJSON())}clone(){return new uV(Ce({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};_([T({type:Object,json:{write:!0}})],bm.prototype,"attributes",void 0),_([T({type:String,json:{write:!0}})],bm.prototype,"description",void 0),_([T({type:[GY]})],bm.prototype,"fieldInfos",void 0),_([ot("fieldInfos")],bm.prototype,"writeFieldInfos",null),_([T({type:String,json:{write:!0}})],bm.prototype,"title",void 0),_([T({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],bm.prototype,"type",void 0),bm=uV=_([Z("esri.popup.content.FieldsContent")],bm);const q4=bm;let B_=class extends Ne{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};_([T({type:String,json:{write:!0}})],B_.prototype,"altText",void 0),_([T({type:String,json:{write:!0}})],B_.prototype,"caption",void 0),_([T({type:String,json:{write:!0}})],B_.prototype,"title",void 0),_([T({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],B_.prototype,"type",void 0),B_=_([Z("esri.popup.content.mixins.MediaInfo")],B_);const HY=B_;var hV;let V_=hV=class extends Ke{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new hV({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};_([T()],V_.prototype,"color",void 0),_([T()],V_.prototype,"fieldName",void 0),_([T()],V_.prototype,"tooltip",void 0),_([T()],V_.prototype,"value",void 0),V_=hV=_([Z("esri.popup.content.support.ChartMediaInfoValueSeries")],V_);const gUe=V_;var dV;let G1=dV=class extends Ne{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new dV({colors:Ce(this.colors),fields:Ce(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};_([T({type:[mt],json:{type:[[Wr]],write:!0}})],G1.prototype,"colors",void 0),_([T({type:[String],json:{write:!0}})],G1.prototype,"fields",void 0),_([T({type:String,json:{write:!0}})],G1.prototype,"normalizeField",void 0),_([T({type:[gUe],json:{read:!1}})],G1.prototype,"series",void 0),_([T({type:String,json:{write:!0}})],G1.prototype,"tooltipField",void 0),G1=dV=_([Z("esri.popup.content.support.ChartMediaInfoValue")],G1);const yUe=G1;let a5=class extends HY{constructor(e){super(e),this.type=null,this.value=null}};_([T({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],a5.prototype,"type",void 0),_([T({type:yUe,json:{write:!0}})],a5.prototype,"value",void 0),a5=_([Z("esri.popup.content.mixins.ChartMediaInfo")],a5);const t7=a5,i7=Tl()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var pV;let DI=pV=class extends t7{constructor(t){super(t),this.type="bar-chart"}clone(){return new pV({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};_([T({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:i7.write}})],DI.prototype,"type",void 0),DI=pV=_([Z("esri.popup.content.BarChartMediaInfo")],DI);const Lve=DI;var fV;let NI=fV=class extends t7{constructor(t){super(t),this.type="column-chart"}clone(){return new fV({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};_([T({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:i7.write}})],NI.prototype,"type",void 0),NI=fV=_([Z("esri.popup.content.ColumnChartMediaInfo")],NI);const Dve=NI;var mV;let l5=mV=class extends Ne{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new mV({linkURL:this.linkURL,sourceURL:this.sourceURL})}};_([T({type:String,json:{write:!0}})],l5.prototype,"linkURL",void 0),_([T({type:String,json:{write:!0}})],l5.prototype,"sourceURL",void 0),l5=mV=_([Z("esri.popup.content.support.ImageMediaInfoValue")],l5);const vUe=l5;var gV;let px=gV=class extends HY{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new gV({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};_([T({type:Number,json:{write:!0}})],px.prototype,"refreshInterval",void 0),_([T({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],px.prototype,"type",void 0),_([T({type:vUe,json:{write:!0}})],px.prototype,"value",void 0),px=gV=_([Z("esri.popup.content.ImageMediaInfo")],px);const Nve=px;var yV;let FI=yV=class extends t7{constructor(t){super(t),this.type="line-chart"}clone(){return new yV({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};_([T({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:i7.write}})],FI.prototype,"type",void 0),FI=yV=_([Z("esri.popup.content.LineChartMediaInfo")],FI);const Fve=FI;var vV;let kI=vV=class extends t7{constructor(t){super(t),this.type="pie-chart"}clone(){return new vV({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};_([T({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:i7.write}})],kI.prototype,"type",void 0),kI=vV=_([Z("esri.popup.content.PieChartMediaInfo")],kI);const kve=kI,zve={base:HY,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":Lve,"column-chart":Dve,"line-chart":Fve,"pie-chart":kve,image:Nve}};var _V;let Ld=_V=class extends Lv{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?Nve.fromJSON(e):e.type==="barchart"?Lve.fromJSON(e):e.type==="columnchart"?Dve.fromJSON(e):e.type==="linechart"?Fve.fromJSON(e):e.type==="piechart"?kve.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new _V(Ce({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};_([T()],Ld.prototype,"activeMediaInfoIndex",void 0),_([T({type:Object,json:{write:!0}})],Ld.prototype,"attributes",void 0),_([T({type:String,json:{write:!0}})],Ld.prototype,"description",void 0),_([T({types:[zve]})],Ld.prototype,"mediaInfos",void 0),_([rt("mediaInfos")],Ld.prototype,"readMediaInfos",null),_([ot("mediaInfos")],Ld.prototype,"writeMediaInfos",null),_([T({type:String,json:{write:!0}})],Ld.prototype,"title",void 0),_([T({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Ld.prototype,"type",void 0),Ld=_V=_([Z("esri.popup.content.MediaContent")],Ld);const wL=Ld;var bV;let c5=bV=class extends Ne{constructor(t){super(t),this.field=null,this.order=null}clone(){return new bV({field:this.field,order:this.order})}};_([T({type:String,json:{write:!0}})],c5.prototype,"field",void 0),_([T({type:["asc","desc"],json:{write:!0}})],c5.prototype,"order",void 0),c5=bV=_([Z("esri.popup.support.RelatedRecordsInfoFieldOrder")],c5);const qY=c5;let Sf=class extends sn(Lv){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};_([T({type:String,json:{write:!0}})],Sf.prototype,"description",void 0),_([T({type:Number,json:{type:Wr,write:!0}})],Sf.prototype,"displayCount",void 0),_([T({type:["list"],json:{write:!0}})],Sf.prototype,"displayType",void 0),_([T({type:[qY],json:{write:!0}})],Sf.prototype,"orderByFields",void 0),_([T({type:Number,json:{type:Wr,write:!0}})],Sf.prototype,"relationshipId",void 0),_([T({type:String,json:{write:!0}})],Sf.prototype,"title",void 0),_([T({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Sf.prototype,"type",void 0),Sf=_([Z("esri.popup.content.RelationshipContent")],Sf);const xL=Sf;var wV;let u5=wV=class extends Lv{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new wV({text:this.text})}};_([T({type:String,json:{write:!0}})],u5.prototype,"text",void 0),_([T({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],u5.prototype,"type",void 0),u5=wV=_([Z("esri.popup.content.TextContent")],u5);const TL=u5,_Ue={base:null,key:"type",typeMap:{attachment:H4,media:wL,text:TL,expression:VY,field:q4,relationship:xL}};var xV;let G_=xV=class extends Ne{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new xV({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};_([T({type:String,json:{write:!0}})],G_.prototype,"name",void 0),_([T({type:String,json:{write:!0}})],G_.prototype,"title",void 0),_([T({type:String,json:{write:!0}})],G_.prototype,"expression",void 0),_([T({type:["string","number"],json:{write:!0}})],G_.prototype,"returnType",void 0),G_=xV=_([Z("esri.popup.ExpressionInfo")],G_);const bUe=G_;var TV;let h5=TV=class extends Ne{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new TV({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};_([T({type:Boolean,json:{write:!0}})],h5.prototype,"returnTopmostRaster",void 0),_([T({type:Boolean,json:{write:!0}})],h5.prototype,"showNoDataRecords",void 0),h5=TV=_([Z("esri.popup.LayerOptions")],h5);const wUe=h5;var SV;let d5=SV=class extends Ne{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new SV({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?Ce(this.orderByFields):null})}};_([T({type:Boolean,json:{write:!0}})],d5.prototype,"showRelatedRecords",void 0),_([T({type:[qY],json:{write:!0}})],d5.prototype,"orderByFields",void 0),d5=SV=_([Z("esri.popup.RelatedRecordsInfo")],d5);const xUe=d5;var EV;let gh=EV=class extends pY(Ke){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new EV({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};_([T()],gh.prototype,"active",void 0),_([T()],gh.prototype,"className",void 0),_([T()],gh.prototype,"disabled",void 0),_([T()],gh.prototype,"icon",void 0),_([T()],gh.prototype,"id",void 0),_([T()],gh.prototype,"indicator",void 0),_([T()],gh.prototype,"title",void 0),_([T()],gh.prototype,"type",void 0),_([T()],gh.prototype,"visible",void 0),gh=EV=_([Z("esri.support.actions.ActionBase")],gh);const WY=gh;var CV;let zI=CV=class extends WY{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new CV({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};_([T()],zI.prototype,"image",void 0),zI=CV=_([Z("esri.support.Action.ActionButton")],zI);const TUe=zI;var AV;let p5=AV=class extends WY{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new AV({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};_([T()],p5.prototype,"image",void 0),_([T()],p5.prototype,"value",void 0),p5=AV=_([Z("esri.support.Action.ActionToggle")],p5);const SUe=p5,EUe="esri.PopupTemplate",CUe=Ee.getLogger(EUe),WE="relationships/",Nre="expression/",AUe=Dt.ofType({key:"type",defaultKeyValue:"button",base:WY,typeMap:{button:TUe,toggle:SUe}}),OUe={base:Lv,key:"type",typeMap:{media:wL,custom:fUe,text:TL,attachments:H4,fields:q4,expression:VY,relationship:xL}},RUe=new Set(["attachments","fields","media","text","expression","relationship"]);let Fo=class extends sn(Ne){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>Pp(OUe,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Yc(e)?e:(CUe.error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeContent(e,i,r,n){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(s=>RUe.has(s.type)).map(s=>s?.toJSON(n)),i.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(i):s.type==="media"?this._writeMediaContent(s,i):s.type==="text"?this._writeTextContent(s,i):s.type==="relationship"&&this._writeRelationshipContent(s,i)})):i.description=e}writeFieldInfos(e,i,r,n){const{content:s}=this,a=Array.isArray(s)?s:null;if(e){const u=a?a.filter(y=>y.type==="fields"):[],p=u.length&&u.every(y=>y.fieldInfos?.length);i.fieldInfos=e.filter(Boolean).map(y=>{const b=y.toJSON(n);return p&&(b.visible=!1),b})}if(a)for(const u of a)u.type==="fields"&&this._writeFieldsContent(u,i)}writeLayerOptions(e,i,r,n){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(n)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,[...r,...this._getContentExpressionInfos(this.content,r)]),G4(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const i=new Set;return await this.collectRequiredFields(i,e),[...i].sort()}_writeFieldsContent(e,i){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=Ce(e.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(n=>{const s=i.fieldInfos.find(a=>a.fieldName.toLowerCase()===n.fieldName.toLowerCase());s?s.visible=!0:i.fieldInfos.push(n)}):i.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){const r=e.orderByFields?.map(s=>this._toFieldOrderJSON(s,e.relationshipId))||[],n=[...i.relatedRecordsInfo?.orderByFields||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...n?.length&&{orderByFields:n}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=Ce(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const n={description:!1,mediaInfos:!1};return r.map(s=>s.type==="media"?(s.mediaInfos||!i||n.mediaInfos||(s.mediaInfos=i,n.mediaInfos=!0),wL.fromJSON(s)):s.type==="text"?(s.text||!e||n.description||(s.text=e,n.description=!0),TL.fromJSON(s)):s.type==="attachments"?H4.fromJSON(s):s.type==="fields"?q4.fromJSON(s):s.type==="expression"?VY.fromJSON(s):s.type==="relationship"?xL.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!i?.startsWith(WE))return null;const n=i.replace(WE,"").split("/");if(n.length!==2)return null;const s=parseInt(n[0],10),a=n[1];return typeof s=="number"&&a?xL.fromJSON({relationshipId:s,orderByFields:[{field:a,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:n}=e;return{field:`${WE}${i}/${n}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:n={showRelatedRecords:!1}}){const s=[];e?s.push(new TL({text:e})):s.push(new q4),Array.isArray(i)&&i.length&&s.push(wL.fromJSON({mediaInfos:i})),r&&s.push(H4.fromJSON({displayType:"auto"}));const{showRelatedRecords:a,orderByFields:u}=n;return a&&u?.length&&u.forEach(p=>{const y=this._toRelationshipContent(p);y&&s.push(y)}),s.length?s:e}_getContentElementFields(e){const i=e?.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((n,s)=>[...n,...this._getMediaInfoFields(s)],[])]}return i==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:i,title:r,value:n}=e,s=n||{},{fields:a,normalizeField:u,tooltipField:p,sourceURL:y,linkURL:b}=s,S=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(y),...this._extractFieldNames(b),...a??[]];return u&&S.push(u),p&&S.push(p),S}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,n)=>[...r,...n.type==="expression"&&n.expressionInfo?[n.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r){r&&await Promise.all(r.map(n=>tc(e,i,n.expression)))}_getFieldInfoFields(e){return e?e.filter(i=>i.visible===void 0||!!i.visible).map(i=>i.fieldName).filter(i=>!i.startsWith(WE)&&!i.startsWith(Nre)):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:n}=e,s=n==="button"||n==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const i=/{[^}]*}/g,r=e.match(i);if(!r)return[];const n=/\{(\w+):.+\}/,s=r.filter(a=>!(a.indexOf(`{${WE}`)===0||a.indexOf(`{${Nre}`)===0)).map(a=>a.replace(n,"{$1}"));return s?s.map(a=>a.slice(1,-1)):[]}};_([T({type:AUe})],Fo.prototype,"actions",void 0),_([T()],Fo.prototype,"content",void 0),_([Fi("content")],Fo.prototype,"castContent",null),_([rt("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],Fo.prototype,"readContent",null),_([ot("content",{popupElements:{type:Dt.ofType(_Ue)},showAttachments:{type:Boolean},mediaInfos:{type:Dt.ofType(zve)},description:{type:String},relatedRecordsInfo:{type:xUe}})],Fo.prototype,"writeContent",null),_([T({type:[bUe],json:{write:!0}})],Fo.prototype,"expressionInfos",void 0),_([T({type:[GY]})],Fo.prototype,"fieldInfos",void 0),_([ot("fieldInfos")],Fo.prototype,"writeFieldInfos",null),_([T({type:wUe})],Fo.prototype,"layerOptions",void 0),_([ot("layerOptions")],Fo.prototype,"writeLayerOptions",null),_([T({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Fo.prototype,"lastEditInfoEnabled",void 0),_([T()],Fo.prototype,"outFields",void 0),_([T()],Fo.prototype,"overwriteActions",void 0),_([T()],Fo.prototype,"returnGeometry",void 0),_([T({json:{type:String}})],Fo.prototype,"title",void 0),_([ot("title")],Fo.prototype,"writeTitle",null),Fo=_([Z("esri.PopupTemplate")],Fo);const mE=Fo,Fre=new br({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let MUe=0,fx=class extends Ne{constructor(e){super(e),this.id="sym"+MUe++,this.type=null,this.color=new mt([0,0,0,1])}readColor(e){return e?.[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};_([T({type:Fre.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Fre.write}}})],fx.prototype,"type",void 0),_([T({type:mt,json:{write:{allowNull:!0}}})],fx.prototype,"color",void 0),_([rt("color")],fx.prototype,"readColor",null),fx=_([Z("esri.symbols.Symbol")],fx);const Zc=fx;var OV;let H1=OV=class extends Zc{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){if(this.data?.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(n=>{const s=n.valueExpressionInfo;return tc(t,e,s.expression)});await Promise.all(r)}}}clone(){return new OV({data:Ce(this.data)})}hash(){return uJ(JSON.stringify(this.data)).toString()}};_([T({json:{write:!1}})],H1.prototype,"color",void 0),_([T({json:{write:!0}})],H1.prototype,"data",void 0),_([rt("data",["symbol"])],H1.prototype,"readData",null),_([ot("data",{})],H1.prototype,"writeData",null),_([Bt({CIMSymbolReference:"cim"},{readOnly:!0})],H1.prototype,"type",void 0),H1=OV=_([Z("esri.symbols.CIMSymbol")],H1);const gE=H1;let mx=class extends Ne{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,i,r){e||(i[r]=e)}};_([T({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],mx.prototype,"enabled",void 0),_([ot("enabled")],mx.prototype,"writeEnabled",null),_([T({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],mx.prototype,"type",void 0),mx=_([Z("esri.symbols.Symbol3DLayer")],mx);const k0=mx;let H_=class extends Ne{constructor(e){super(e),this.color=new mt([0,0,0,1]),this.extensionLength=0,this.size=ed(1)}clone(){}cloneProperties(){return{color:Ce(this.color),size:this.size,extensionLength:this.extensionLength}}};_([T({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],H_.prototype,"type",void 0),_([T(Fg)],H_.prototype,"color",void 0),_([T({...A0,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],H_.prototype,"extensionLength",void 0),_([T(A0)],H_.prototype,"size",void 0),H_=_([Z("esri.symbols.edges.Edges3D")],H_);const XY=H_;var RV;let UI=RV=class extends XY{constructor(t){super(t),this.type="sketch"}clone(){return new RV(this.cloneProperties())}};_([Bt({sketch:"sketch"},{readOnly:!0})],UI.prototype,"type",void 0),UI=RV=_([Z("esri.symbols.edges.SketchEdges3D")],UI);const PUe=UI;var MV;let jI=MV=class extends XY{constructor(t){super(t),this.type="solid"}clone(){return new MV(this.cloneProperties())}};_([Bt({solid:"solid"},{readOnly:!0})],jI.prototype,"type",void 0),jI=MV=_([Z("esri.symbols.support.SolidEdges3D")],jI);const IUe=jI,Uve={types:{key:"type",base:XY,typeMap:{solid:IUe,sketch:PUe}},json:{write:!0}};var PV;let Hu=PV=class extends Ne{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new PV(t)}};_([T(Fg)],Hu.prototype,"color",void 0),Hu=PV=_([Z("esri.symbols.support.Symbol3DMaterial")],Hu);var IV;let q1=IV=class extends k0{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new IV({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};_([Bt({Extrude:"extrude"},{readOnly:!0})],q1.prototype,"type",void 0),_([T({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],q1.prototype,"size",void 0),_([T({type:Hu,json:{write:!0}})],q1.prototype,"material",void 0),_([T({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],q1.prototype,"castShadows",void 0),_([T(Uve)],q1.prototype,"edges",void 0),q1=IV=_([Z("esri.symbols.ExtrudeSymbol3DLayer")],q1);const jve=q1;let f5=class extends Zc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};_([Bt({esriSLS:"simple-line"},{readOnly:!0})],f5.prototype,"type",void 0),_([T({type:Number,cast:Br,json:{write:!0}})],f5.prototype,"width",void 0),f5=_([Z("esri.symbols.LineSymbol")],f5);const $Ue=f5,LUe=["begin","end","begin-end"],Bve=["arrow","circle","square","diamond","cross","x"];var $V;let Ef=$V=class extends Ne{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=r?.origin==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t?.[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){r?.origin==="web-map"||(e[i]=t)}clone(){return new $V({color:Ce(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};_([T({type:["begin","end","begin-end"],json:{write:!0}})],Ef.prototype,"placement",void 0),_([Bt({"line-marker":"line-marker"},{readOnly:!0}),T({json:{origins:{"web-map":{write:!1}}}})],Ef.prototype,"type",void 0),_([T({type:Bve})],Ef.prototype,"style",void 0),_([ot("style")],Ef.prototype,"writeStyle",null),_([T({type:mt,value:null,json:{write:{allowNull:!0}}})],Ef.prototype,"color",null),_([rt("color")],Ef.prototype,"readColor",null),_([ot("color")],Ef.prototype,"writeColor",null),Ef=$V=_([Z("esri.symbols.LineSymbolMarker")],Ef);const DUe=Ef;var LV;const CF=new br({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let wm=LV=class extends $Ue{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,n,s){if(t&&typeof t!="string")return t;const a={};return t!=null&&(a.style=t),e!=null&&(a.color=e),i!=null&&(a.width=Br(i)),r!=null&&(a.cap=r),n!=null&&(a.join=n),s!=null&&(a.miterLimit=Br(s)),a}clone(){return new LV({color:Ce(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};_([Bt({esriSLS:"simple-line"},{readOnly:!0})],wm.prototype,"type",void 0),_([T({type:CF.apiValues,json:{read:CF.read,write:CF.write}})],wm.prototype,"style",void 0),_([T({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],wm.prototype,"cap",void 0),_([T({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],wm.prototype,"join",void 0),_([T({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":DUe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],wm.prototype,"marker",void 0),_([T({type:Number,json:{read:!1,write:!1}})],wm.prototype,"miterLimit",void 0),wm=LV=_([Z("esri.symbols.SimpleLineSymbol")],wm);const dd=wm;let m5=class extends Zc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};_([T({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":dd}},json:{default:null,write:!0}})],m5.prototype,"outline",void 0),_([T({type:["simple-fill","picture-fill"],readOnly:!0})],m5.prototype,"type",void 0),m5=_([Z("esri.symbols.FillSymbol")],m5);const Vve=m5;let BI=class extends Ne{constructor(e){super(e)}clone(){}};_([T({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],BI.prototype,"type",void 0),BI=_([Z("esri.symbols.patterns.LinePattern3D")],BI);const Gve=BI,NUe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var DV;const FUe=Tl()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let g5=DV=class extends Gve{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new DV(t)}};_([T({type:["style"]})],g5.prototype,"type",void 0),_([Bt(FUe),T({type:NUe})],g5.prototype,"style",void 0),g5=DV=_([Z("esri.symbols.patterns.LineStylePattern3D")],g5);const JY=g5;let VI=class extends Ne{constructor(e){super(e)}clone(){}};_([T({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],VI.prototype,"type",void 0),VI=_([Z("esri.symbols.patterns.Pattern3D")],VI);const Hve=VI,kUe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var NV;let y5=NV=class extends Hve{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new NV(t)}};_([T({type:["style"]})],y5.prototype,"type",void 0),_([T({type:kUe,json:{read:!0,write:!0}})],y5.prototype,"style",void 0),y5=NV=_([Z("esri.symbols.patterns.StylePattern3D")],y5);const qve=y5,zUe={types:{key:"type",base:Hve,typeMap:{style:qve}},json:{write:!0}},Wve={types:{key:"type",base:Gve,typeMap:{style:JY}},json:{write:!0}},zA=new mt("white");new mt("black");const UUe=new mt([255,255,255,0]);function jUe(t){return t.r===0&&t.g===0&&t.b===0}var FV;let UA=FV=class extends Hu{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new FV(t)}};_([Bt({multiply:"multiply",replace:"replace",tint:"tint"})],UA.prototype,"colorMixMode",void 0),UA=FV=_([Z("esri.symbols.support.Symbol3DFillMaterial")],UA);function eo(t=Kve){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function X2(t,e,i,r,n,s,a=eo()){return a[0]=t,a[1]=e,a[2]=i,a[3]=r,a[4]=n,a[5]=s,a}function hPt(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new rr(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function AS(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function BUe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function Np(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function Fu(t,e,i=0,r=e.length/3){let n=t[0],s=t[1],a=t[2],u=t[3],p=t[4],y=t[5];for(let b=0;b<r;b++)n=Math.min(n,e[i+3*b]),s=Math.min(s,e[i+3*b+1]),a=Math.min(a,e[i+3*b+2]),u=Math.max(u,e[i+3*b]),p=Math.max(p,e[i+3*b+1]),y=Math.max(y,e[i+3*b+2]);t[0]=n,t[1]=s,t[2]=a,t[3]=u,t[4]=p,t[5]=y}function AF(t,e,i){const r=e.length;let n=t[0],s=t[1],a=t[2],u=t[3],p=t[4],y=t[5];if(i)for(let b=0;b<r;b++){const S=e[b];n=Math.min(n,S[0]),s=Math.min(s,S[1]),a=Math.min(a,S[2]),u=Math.max(u,S[0]),p=Math.max(p,S[1]),y=Math.max(y,S[2])}else for(let b=0;b<r;b++){const S=e[b];n=Math.min(n,S[0]),s=Math.min(s,S[1]),u=Math.max(u,S[0]),p=Math.max(p,S[1])}t[0]=n,t[1]=s,t[2]=a,t[3]=u,t[4]=p,t[5]=y}function VUe(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function ww(t){return t[0]>=t[3]?0:t[3]-t[0]}function xw(t){return t[1]>=t[4]?0:t[4]-t[1]}function Dv(t){return t[2]>=t[5]?0:t[5]-t[2]}function Xve(t){const e=ww(t),i=Dv(t),r=xw(t);return Math.sqrt(e*e+i*i+r*r)}function yp(t,e=[0,0,0]){return e[0]=t[0]+ww(t)/2,e[1]=t[1]+xw(t)/2,e[2]=t[2]+Dv(t)/2,e}function gM(t,e=[0,0,0]){return e[0]=ww(t),e[1]=xw(t),e[2]=Dv(t),e}function YY(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function dPt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function GUe(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function vp(t,e){return e==null||GUe(t,e)}function Jve(t,e,i,r,n=t){return n[0]=t[0]+e,n[1]=t[1]+i,n[2]=t[2]+r,n[3]=t[3]+e,n[4]=t[4]+i,n[5]=t[5]+r,n}function pPt(t,e,i=t){const r=t[0]+ww(t)/2,n=t[1]+xw(t)/2,s=t[2]+Dv(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=n+(t[1]-n)*e,i[2]=s+(t[2]-s)*e,i[3]=r+(t[3]-r)*e,i[4]=n+(t[4]-n)*e,i[5]=s+(t[5]-s)*e,i}function Yve(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function Zve(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function r7(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function cn(t){return t?r7(t,kre):eo(kre)}function ZY(t,e){return e||(e=Di()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function fPt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function HUe(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=n,t[5]=Number.POSITIVE_INFINITY,t}function kV(t){return t.length===6}function KY(t){return ww(t)===0&&xw(t)===0&&Dv(t)===0}function mPt(t,e,i){if(t==null||e==null)return t===e;if(!kV(t)||!kV(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function qUe(t,e,i,r,n,s){return X2(t,e,i,r,n,s,WUe)}const gPt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],kre=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Kve=[0,0,0,0,0,0],WUe=eo();function OF(t,{isPrimitive:e,width:i,depth:r,height:n}){const s=e?10:1;if(i==null&&n==null&&r==null)return[s*t[0],s*t[1],s*t[2]];const a=st(i,r,n);let u;for(let p=0;p<3;p++){const y=a[p];if(y!=null){u=y/t[p];break}}for(let p=0;p<3;p++)a[p]==null&&(a[p]=t[p]*u);return a}const XUe=X2(-.5,-.5,-.5,.5,.5,.5),JUe=X2(-.5,-.5,0,.5,.5,1),YUe=X2(-.5,-.5,0,.5,.5,.5);function ZUe(t){switch(t){case"sphere":case"cube":case"diamond":return XUe;case"cylinder":case"cone":case"inverted-cone":return JUe;case"tetrahedron":return YUe;default:return}}const QY=["butt","square","round"],KUe=[...QY,"none"],Qve=["miter","bevel","round"];var zV;let q_=zV=class extends Ne{constructor(t){super(t),this.color=new mt([0,0,0,1]),this.size=ed(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new zV(t)}};_([T(Fg)],q_.prototype,"color",void 0),_([T(A0)],q_.prototype,"size",void 0),_([T(Wve)],q_.prototype,"pattern",void 0),_([T({type:QY,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],q_.prototype,"patternCap",void 0),q_=zV=_([Z("esri.symbols.support.Symbol3DOutline")],q_);var GI;let xm=GI=class extends k0{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new GI(t)}static fromSimpleFillSymbol(t){const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new JY({style:t.outline.style}):null,i={size:t.outline?.width??0,color:(t.outline?.color??zA).clone(),pattern:e};return e&&t.outline?.cap&&(i.patternCap=t.outline.cap),new GI({material:new UA({color:(t.color??UUe).clone()}),pattern:t.style&&t.style!=="solid"?new qve({style:t.style}):null,outline:i})}};_([Bt({Fill:"fill"},{readOnly:!0})],xm.prototype,"type",void 0),_([T({type:UA,json:{write:!0}})],xm.prototype,"material",void 0),_([T(zUe)],xm.prototype,"pattern",void 0),_([T({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],xm.prototype,"castShadows",void 0),_([T({type:q_,json:{write:!0}})],xm.prototype,"outline",void 0),_([T(Uve)],xm.prototype,"edges",void 0),xm=GI=_([Z("esri.symbols.FillSymbol3DLayer")],xm);const nR=xm,QUe=["none","underline","line-through"],eje=["normal","italic","oblique"],tje=["normal","lighter","bold","bolder"],e_e={type:Number,cast:t=>{const e=$h(t);return e===0?1:Je(e,.1,4)},nonNullable:!0},ije=["left","right","center"],rje=["baseline","top","middle","bottom"],t_e={type:ije,nonNullable:!0},i_e={type:rje,nonNullable:!0},yPt=8;var UV;let Tm=UV=class extends Ne{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return Br(t)}clone(){return new UV({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};_([T({type:QUe,json:{default:"none",write:!0}})],Tm.prototype,"decoration",void 0),_([T({type:String,json:{write:!0}})],Tm.prototype,"family",void 0),_([T({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],Tm.prototype,"size",void 0),_([Fi("size")],Tm.prototype,"castSize",null),_([T({type:eje,json:{default:"normal",write:!0}})],Tm.prototype,"style",void 0),_([T({type:tje,json:{default:"normal",write:!0}})],Tm.prototype,"weight",void 0),Tm=UV=_([Z("esri.symbols.Font")],Tm);const n7=Tm;var jV;const nje=Tl()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let W_=jV=class extends Ne{constructor(t){super(t)}readHref(t,e,i){return t?hv(t,i):e.dataURI}writeHref(t,e,i,r){t&&($0(t)?e.dataURI=t:(e.href=H2(t,r),ju(e.href)&&(e.href=Uu(e.href))))}clone(){return new jV({href:this.href,primitive:this.primitive})}};_([T({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],W_.prototype,"href",void 0),_([rt("href")],W_.prototype,"readHref",null),_([ot("href",{href:{type:String},dataURI:{type:String}})],W_.prototype,"writeHref",null),_([Bt(nje)],W_.prototype,"primitive",void 0),W_=jV=_([Z("esri.symbols.support.IconSymbol3DLayerResource")],W_);const sje="circle";var BV;let hT=BV=class extends Ke{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new BV({x:this.x,y:this.y})}};_([T({type:Number})],hT.prototype,"x",void 0),_([T({type:Number})],hT.prototype,"y",void 0),hT=BV=_([Z("esri.symbols.support.Symbol3DAnchorPosition2D")],hT);var VV;let v5=VV=class extends Ne{constructor(t){super(t),this.color=new mt([0,0,0,1]),this.size=ed(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new VV(t)}};_([T(Fg)],v5.prototype,"color",void 0),_([T(A0)],v5.prototype,"size",void 0),v5=VV=_([Z("esri.symbols.support.Symbol3DIconOutline")],v5);var gx;const r_e="esri.symbols.IconSymbol3DLayer";let Cf=gx=class extends k0{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new gx({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||zA,i=zre(t),r=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||zA).clone()}:null;return new gx({size:t.size,resource:{primitive:aje(t.style)},material:{color:e},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(t){const e=!t.color||jUe(t.color)?zA:t.color,i=zre(t);return new gx({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(t){return new gx({resource:{href:vme({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function zre(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=Ure(t.xoffset),n=Ure(t.yoffset);return(r||n)&&e&&i?{x:-r/e,y:n/i}:null}function Ure(t){return isFinite(t)?t:0}_([T({type:Hu,json:{write:!0}})],Cf.prototype,"material",void 0),_([T({type:W_,json:{write:!0}})],Cf.prototype,"resource",void 0),_([Bt({Icon:"icon"},{readOnly:!0})],Cf.prototype,"type",void 0),_([T(A0)],Cf.prototype,"size",void 0),_([Bt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),T({json:{default:"center"}})],Cf.prototype,"anchor",void 0),_([T({type:hT,json:{type:[Number],read:{reader:t=>new hT({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Cf.prototype,"anchorPosition",void 0),_([T({type:v5,json:{write:!0}})],Cf.prototype,"outline",void 0),Cf=gx=_([Z(r_e)],Cf);const oje={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function aje(t){return oje[t]||(Ee.getLogger(r_e).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const zy=Cf;let X_=class extends sn(Ne){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};_([T({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],X_.prototype,"type",void 0),_([T({type:LUe,json:{default:"begin-end",write:!0}})],X_.prototype,"placement",void 0),_([T({type:Bve,json:{default:"arrow",write:!0}})],X_.prototype,"style",void 0),_([T({type:mt,json:{type:[Wr],default:null,write:!0}})],X_.prototype,"color",void 0),X_=_([Z("esri.symbols.LineStyleMarker3D")],X_);const GV=X_;var HI;let Af=HI=class extends k0{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=ed(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new HI(t)}static fromSimpleLineSymbol(t){const e={enabled:!0,size:t.width??ed(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new JY({style:t.style}):null,material:new Hu({color:(t.color||zA).clone()}),marker:t.marker?new GV({placement:t.marker.placement,style:t.marker.style,color:t.marker.color?.clone()??null}):null};return new HI(e)}};_([T({type:Hu,json:{write:!0}})],Af.prototype,"material",void 0),_([Bt({Line:"line"},{readOnly:!0})],Af.prototype,"type",void 0),_([T({type:Qve,json:{write:!0,default:"miter"}})],Af.prototype,"join",void 0),_([T({type:QY,json:{write:!0,default:"butt"}})],Af.prototype,"cap",void 0),_([T(A0)],Af.prototype,"size",void 0),_([T(Wve)],Af.prototype,"pattern",void 0),_([T({types:{key:"type",base:GV,typeMap:{style:GV}},json:{write:!0}})],Af.prototype,"marker",void 0),Af=HI=_([Z("esri.symbols.LineSymbol3DLayer")],Af);const sR=Af;var HV;const lje=Tl()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let _5=HV=class extends Ne{clone(){return new HV({href:this.href,primitive:this.primitive})}};_([T({type:String,json:{read:XD,write:Eg}})],_5.prototype,"href",void 0),_([Bt(lje)],_5.prototype,"primitive",void 0),_5=HV=_([Z("esri.symbols.support.ObjectSymbol3DLayerResource")],_5);const n_e="sphere";var qV;let kb=qV=class extends Ke{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new qV({x:this.x,y:this.y,z:this.z})}};_([T({type:Number})],kb.prototype,"x",void 0),_([T({type:Number})],kb.prototype,"y",void 0),_([T({type:Number})],kb.prototype,"z",void 0),kb=qV=_([Z("esri.symbols.support.Symbol3DAnchorPosition3D")],kb);var WV;let tl=WV=class extends k0{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new WV({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition?.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material?.clone()??null,castShadows:this.castShadows,resource:this.resource?.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};_([T({type:Hu,json:{write:!0}})],tl.prototype,"material",void 0),_([T({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],tl.prototype,"castShadows",void 0),_([T({type:_5,json:{write:!0}})],tl.prototype,"resource",void 0),_([Bt({Object:"object"},{readOnly:!0})],tl.prototype,"type",void 0),_([T({type:Number,json:{write:!0}})],tl.prototype,"width",void 0),_([T({type:Number,json:{write:!0}})],tl.prototype,"height",void 0),_([T({type:Number,json:{write:!0}})],tl.prototype,"depth",void 0),_([Bt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),T({json:{default:"origin"}})],tl.prototype,"anchor",void 0),_([T({type:kb,json:{type:[Number],read:{reader:t=>new kb({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],tl.prototype,"anchorPosition",void 0),_([T({type:Number,json:{write:!0}})],tl.prototype,"heading",void 0),_([T({type:Number,json:{write:!0}})],tl.prototype,"tilt",void 0),_([T({type:Number,json:{write:!0}})],tl.prototype,"roll",void 0),_([T({readOnly:!0})],tl.prototype,"isPrimitive",null),tl=WV=_([Z("esri.symbols.ObjectSymbol3DLayer")],tl);const eZ=tl;var XV;let Dl=XV=class extends k0{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new XV({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};_([T({type:Hu,json:{write:!0}})],Dl.prototype,"material",void 0),_([T({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Dl.prototype,"castShadows",void 0),_([Bt({Path:"path"},{readOnly:!0})],Dl.prototype,"type",void 0),_([T({type:["circle","quad"],json:{write:!0,default:"circle"}})],Dl.prototype,"profile",void 0),_([T({type:Qve,json:{write:!0,default:"miter"}})],Dl.prototype,"join",void 0),_([T({type:KUe,json:{write:!0,default:"butt"}})],Dl.prototype,"cap",void 0),_([T({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Dl.prototype,"width",void 0),_([rt("width",["width","size","height"])],Dl.prototype,"readWidth",null),_([T({type:Number,json:{write:!0}})],Dl.prototype,"height",void 0),_([rt("height",["height","size","width"])],Dl.prototype,"readHeight",null),_([T({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Dl.prototype,"anchor",void 0),_([T({type:["heading","all"],json:{write:!0,default:"all"}})],Dl.prototype,"profileRotation",void 0),Dl=XV=_([Z("esri.symbols.PathSymbol3DLayer")],Dl);const tZ=Dl;var JV;let dT=JV=class extends Ne{constructor(){super(...arguments),this.color=new mt([0,0,0,1]),this.size=0}clone(){const t={color:Ce(this.color),size:this.size};return new JV(t)}};_([T(Fg)],dT.prototype,"color",void 0),_([T(A0)],dT.prototype,"size",void 0),dT=JV=_([Z("esri.symbols.support.Symbol3DHalo")],dT);let jA=class extends sn(Ne){constructor(e){super(e),this.color=null}};_([T(Fg)],jA.prototype,"color",void 0),jA=_([Z("esri.symbols.support.Symbol3DTextBackground")],jA);var qI;let pc=qI=class extends k0{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,i,r){const n={...r,textSymbol3D:!0};e.font=t.write({},n),delete e.font.size}get size(){return this._userSize!=null?this._userSize:this.font?.size!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new qI({enabled:this.enabled,font:this.font&&Ce(this.font),halo:this.halo&&Ce(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:Ce(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new qI({font:t.font!=null?t.font.clone():new n7,halo:cje(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new Hu({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new jA({color:t.backgroundColor.clone()}):null})}};function cje(t,e){return t&&e!=null&&e>0?new dT({color:Ce(t),size:e}):null}_([T({type:n7,json:{write:!0}})],pc.prototype,"font",null),_([ot("font")],pc.prototype,"writeFont",null),_([T({type:dT,json:{write:!0}})],pc.prototype,"halo",void 0),_([T({...t_e,json:{default:"center",write:!0}})],pc.prototype,"horizontalAlignment",void 0),_([T({...e_e,json:{default:1,write:!0}})],pc.prototype,"lineHeight",void 0),_([T({type:Hu,json:{write:!0}})],pc.prototype,"material",void 0),_([T({type:jA,json:{write:!0}})],pc.prototype,"background",void 0),_([T(A0)],pc.prototype,"size",null),_([T({type:String,json:{write:!0}})],pc.prototype,"text",void 0),_([Bt({Text:"text"},{readOnly:!0})],pc.prototype,"type",void 0),_([T({...i_e,json:{default:"baseline",write:!0}})],pc.prototype,"verticalAlignment",void 0),pc=qI=_([Z("esri.symbols.TextSymbol3DLayer")],pc);const Tw=pc;var YV;let W1=YV=class extends k0{constructor(t){super(t),this.color=ZV.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new YV({color:Ce(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};_([T({type:mt,nonNullable:!0,json:{type:[Wr],write:(t,e,i)=>e[i]=t.toArray(mt.AlphaMode.UNLESS_OPAQUE),default:()=>ZV.clone(),defaultEquals:t=>t.toCss(!0)===ZV.toCss(!0)}})],W1.prototype,"color",void 0),_([Bt({Water:"water"},{readOnly:!0})],W1.prototype,"type",void 0),_([T({type:["small","medium","large"],json:{write:!0,default:"medium"}})],W1.prototype,"waterbodySize",void 0),_([T({type:Number,json:{write:!0,default:null}})],W1.prototype,"waveDirection",void 0),_([T({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],W1.prototype,"waveStrength",void 0),W1=YV=_([Z("esri.symbols.WaterSymbol3DLayer")],W1);const ZV=new mt([0,119,190]),s_e=W1;var KV;let J_=KV=class extends Ke{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new KV({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};_([T({type:String})],J_.prototype,"name",void 0),_([T({type:String})],J_.prototype,"styleUrl",void 0),_([T({type:String})],J_.prototype,"styleName",void 0),_([T({type:Zs})],J_.prototype,"portal",void 0),J_=KV=_([Z("esri.symbols.support.StyleOrigin")],J_);const W4=J_;var QV;let _2=QV=class extends Ke{constructor(){super(...arguments),this.url=""}clone(){return new QV({url:this.url})}};_([T({type:String})],_2.prototype,"url",void 0),_2=QV=_([Z("esri.symbols.support.Thumbnail")],_2);const o_e={icon:zy,object:eZ,line:sR,path:tZ,fill:nR,extrude:jve,text:Tw,water:s_e},uje=Dt.ofType({base:k0,key:"type",typeMap:o_e,errorContext:"symbol-layer"});let Of=class extends Zc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,r=i?.type,n=r||Dt;this._set("symbolLayers",new n)}get color(){return null}set color(e){this.constructed&&Ee.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){xg(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const n=hv(e.styleUrl,r);return new W4({styleUrl:n,name:e.name})}if(e.styleName&&e.name)return new W4({portal:r?.portal||Zs.getDefault(),styleName:e.styleName,name:e.name});r?.messages&&r.messages.push(new T0("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,n){if(e.styleUrl&&e.name){let s=H2(e.styleUrl,n);ju(s)&&(s=Uu(s)),i.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&n?.portal&&!gme(e.portal.restUrl,n.portal.restUrl)?n?.messages&&n.messages.push(new T0("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof k0||e&&o_e[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};_([T({json:{read:!1,write:!1}})],Of.prototype,"color",null),_([T({type:uje,nonNullable:!0,json:{write:!0}}),Fi(MJ)],Of.prototype,"symbolLayers",null),_([T({type:W4})],Of.prototype,"styleOrigin",void 0),_([rt("styleOrigin")],Of.prototype,"readStyleOrigin",null),_([ot("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Of.prototype,"writeStyleOrigin",null),_([T({type:_2,json:{read:!1}})],Of.prototype,"thumbnail",void 0),_([T({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Of.prototype,"type",void 0),Of=_([Z("esri.symbols.Symbol3D")],Of);const yE=Of;let b5=class extends Ne{constructor(e){super(e),this.visible=!0}clone(){}};_([T({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],b5.prototype,"type",void 0),_([T({readOnly:!0})],b5.prototype,"visible",void 0),b5=_([Z("esri.symbols.callouts.Callout3D")],b5);const a_e=b5;var eG;let WI=eG=class extends Ne{constructor(t){super(t),this.color=new mt("white")}clone(){return new eG({color:Ce(this.color)})}};_([T(Fg)],WI.prototype,"color",void 0),WI=eG=_([Z("esri.symbols.callouts.LineCallout3DBorder")],WI);const hje=WI;var tG;let X1=tG=class extends a_e{constructor(t){super(t),this.type="line",this.color=new mt([0,0,0,1]),this.size=ed(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new tG({color:Ce(this.color),size:this.size,border:Ce(this.border)})}};_([Bt({line:"line"})],X1.prototype,"type",void 0),_([T(Fg)],X1.prototype,"color",void 0),_([T(A0)],X1.prototype,"size",void 0),_([T({type:hje,json:{write:!0}})],X1.prototype,"border",void 0),_([T({readOnly:!0})],X1.prototype,"visible",null),X1=tG=_([Z("esri.symbols.callouts.LineCallout3D")],X1);const l_e=X1;function iZ(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function c_e(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!iZ(t)}function rZ(t){return t.type==="point-3d"||t.type==="label-3d"}function u_e(t){return t.horizontalAlignment==="center"}const h_e={types:{key:"type",base:a_e,typeMap:{line:l_e}},json:{write:!0}};var iG;let yx=iG=class extends Ne{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new iG({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};_([T(A0)],yx.prototype,"screenLength",void 0),_([T({type:Number,nonNullable:!0,json:{write:!0,default:0}})],yx.prototype,"minWorldLength",void 0),_([T({type:Number,json:{write:!0}})],yx.prototype,"maxWorldLength",void 0),yx=iG=_([Z("esri.symbols.support.Symbol3DVerticalOffset")],yx);const nZ=yx;var XI;const d_e=Dt.ofType({base:null,key:"type",typeMap:{text:Tw}});let J1=XI=class extends yE{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new d_e,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return c_e(this)}hasVisibleVerticalOffset(){return iZ(this)}clone(){return new XI({styleOrigin:Ce(this.styleOrigin),symbolLayers:Ce(this.symbolLayers),thumbnail:Ce(this.thumbnail),callout:Ce(this.callout),verticalOffset:Ce(this.verticalOffset)})}static fromTextSymbol(t){return new XI({symbolLayers:new Dt([Tw.fromTextSymbol(t)])})}};_([T({type:nZ,json:{write:!0}})],J1.prototype,"verticalOffset",void 0),_([T(h_e)],J1.prototype,"callout",void 0),_([T({json:{read:!1,write:!1}})],J1.prototype,"styleOrigin",void 0),_([T({type:d_e})],J1.prototype,"symbolLayers",void 0),_([Bt({LabelSymbol3D:"label-3d"},{readOnly:!0})],J1.prototype,"type",void 0),J1=XI=_([Z("esri.symbols.LabelSymbol3D")],J1);const s7=J1;var JI;const p_e=Dt.ofType({base:null,key:"type",typeMap:{line:sR,path:tZ}}),dje=Dt.ofType({base:null,key:"type",typeMap:{line:sR,path:tZ}});let w5=JI=class extends yE{constructor(t){super(t),this.symbolLayers=new p_e,this.type="line-3d"}clone(){return new JI({styleOrigin:Ce(this.styleOrigin),symbolLayers:Ce(this.symbolLayers),thumbnail:Ce(this.thumbnail)})}static fromSimpleLineSymbol(t){return new JI({symbolLayers:new Dt([sR.fromSimpleLineSymbol(t)])})}};_([T({type:p_e,json:{type:dje}})],w5.prototype,"symbolLayers",void 0),_([Bt({LineSymbol3D:"line-3d"},{readOnly:!0})],w5.prototype,"type",void 0),w5=JI=_([Z("esri.symbols.LineSymbol3D")],w5);const o7=w5;let Y1=class extends Zc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};_([T({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Y1.prototype,"angle",void 0),_([T({type:["simple-marker","picture-marker"],readOnly:!0})],Y1.prototype,"type",void 0),_([T({type:Number,cast:Br,json:{write:!0}})],Y1.prototype,"xoffset",void 0),_([T({type:Number,cast:Br,json:{write:!0}})],Y1.prototype,"yoffset",void 0),_([T({type:Number,cast:t=>t==="auto"?t:Br(t),json:{write:!0}})],Y1.prototype,"size",void 0),Y1=_([Z("esri.symbols.MarkerSymbol")],Y1);const f_e=Y1;var YI;const m_e=Dt.ofType({base:null,key:"type",typeMap:{fill:nR}});let x5=YI=class extends yE{constructor(t){super(t),this.symbolLayers=new m_e,this.type="mesh-3d"}clone(){return new YI({styleOrigin:Ce(this.styleOrigin),symbolLayers:Ce(this.symbolLayers),thumbnail:Ce(this.thumbnail)})}static fromSimpleFillSymbol(t){return new YI({symbolLayers:new Dt([nR.fromSimpleFillSymbol(t)])})}};_([T({type:m_e})],x5.prototype,"symbolLayers",void 0),_([Bt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],x5.prototype,"type",void 0),x5=YI=_([Z("esri.symbols.MeshSymbol3D")],x5);const a7=x5;function pje(t,e,i){return e.imageData?vme({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):g_e(e.url,i)}function g_e(t,e){return mje(e)&&!ju(t)&&e?.layer?.parsedUrl?Kh(e.layer.parsedUrl.path,"images",t):hv(t,e)}function fje(t,e,i,r){if($0(t)){const n=sv(t);if(!n)return;e.contentType=n.mediaType,e.imageData=n.data,i&&i.imageData===e.imageData&&i.url&&Eg(i.url,e,"url",r)}else Eg(t,e,"url",r)}const y_e={json:{read:{source:["imageData","url"],reader:pje},write:{writer(t,e,i,r){fje(t,e,this.source,r)}}}},v_e={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=g_e(e.url,i)),r}}}};function mje(t){return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||t.layer?.type!=="feature"&&t.layer?.type!=="stream")}var rG;let yh=rG=class extends Vve{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const n={};return t&&(n.url=t),e&&(n.outline=e),i!=null&&(n.width=Br(i)),r!=null&&(n.height=Br(r)),n}clone(){const t=new rG({color:Ce(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",Ce(this.source)),t}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};_([Bt({esriPFS:"picture-fill"},{readOnly:!0})],yh.prototype,"type",void 0),_([T(y_e)],yh.prototype,"url",void 0),_([T({type:Number,json:{write:!0}})],yh.prototype,"xscale",void 0),_([T({type:Number,json:{write:!0}})],yh.prototype,"yscale",void 0),_([T({type:Number,cast:Br,json:{write:!0}})],yh.prototype,"width",void 0),_([T({type:Number,cast:Br,json:{write:!0}})],yh.prototype,"height",void 0),_([T({type:Number,cast:Br,json:{write:!0}})],yh.prototype,"xoffset",void 0),_([T({type:Number,cast:Br,json:{write:!0}})],yh.prototype,"yoffset",void 0),_([T(v_e)],yh.prototype,"source",void 0),yh=rG=_([Z("esri.symbols.PictureFillSymbol")],yh);const __e=yh;var nG;let Dd=nG=class extends f_e{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=Br(e)),i!=null&&(r.height=Br(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new nG({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",Ce(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};_([T({json:{write:!1}})],Dd.prototype,"color",void 0),_([Bt({esriPMS:"picture-marker"},{readOnly:!0})],Dd.prototype,"type",void 0),_([T(y_e)],Dd.prototype,"url",void 0),_([T(v_e)],Dd.prototype,"source",void 0),_([T({type:Number,cast:Br,json:{write:!0}})],Dd.prototype,"height",void 0),_([rt("height",["height","size"])],Dd.prototype,"readHeight",null),_([T({type:Number,cast:Br,json:{write:!0}})],Dd.prototype,"width",void 0),_([T({json:{write:!1}})],Dd.prototype,"size",void 0),Dd=nG=_([Z("esri.symbols.PictureMarkerSymbol")],Dd);const l7=Dd;var Y_;const b_e=Dt.ofType({base:null,key:"type",typeMap:{icon:zy,object:eZ,text:Tw}});let Z_=Y_=class extends yE{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new b_e,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return c_e(this)}hasVisibleVerticalOffset(){return iZ(this)}clone(){return new Y_({verticalOffset:Ce(this.verticalOffset),callout:Ce(this.callout),styleOrigin:Ce(this.styleOrigin),symbolLayers:Ce(this.symbolLayers),thumbnail:Ce(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new Y_({symbolLayers:new Dt([zy.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new Y_({symbolLayers:new Dt([zy.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){if(t.data?.symbol?.type!=="CIMPointSymbol")return null;const i=t.data.symbol;return new Y_(i?.callout?{symbolLayers:new Dt([zy.fromCIMSymbol(t)]),callout:new l_e({size:.5,color:new mt([0,0,0])}),verticalOffset:new nZ({screenLength:40})}:{symbolLayers:new Dt([zy.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new Y_({symbolLayers:new Dt([Tw.fromTextSymbol(t)])})}};_([T({type:nZ,json:{write:!0}})],Z_.prototype,"verticalOffset",void 0),_([T(h_e)],Z_.prototype,"callout",void 0),_([T({type:b_e,json:{origins:{"web-scene":{write:!0}}}})],Z_.prototype,"symbolLayers",void 0),_([Bt({PointSymbol3D:"point-3d"},{readOnly:!0})],Z_.prototype,"type",void 0),Z_=Y_=_([Z("esri.symbols.PointSymbol3D")],Z_);const Uy=Z_;var T5;const w_e=Dt.ofType({base:null,key:"type",typeMap:{extrude:jve,fill:nR,icon:zy,line:sR,object:eZ,text:Tw,water:s_e}});let S5=T5=class extends yE{constructor(t){super(t),this.symbolLayers=new w_e,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&rS(Ee.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&rS(Ee.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(ga(()=>this.symbolLayers,"after-add",({item:e})=>t(e),$r))}clone(){return new T5({styleOrigin:Ce(this.styleOrigin),symbolLayers:Ce(this.symbolLayers),thumbnail:Ce(this.thumbnail)})}static fromJSON(t){const e=new T5;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const i=e.symbolLayers.at(0),r=e.symbolLayers.at(1);!r.enabled||t.symbolLayers?.[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:r.material!=null?r.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new T5({symbolLayers:new Dt([nR.fromSimpleFillSymbol(t)])})}};_([T({type:w_e,json:{write:!0}})],S5.prototype,"symbolLayers",void 0),_([Bt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],S5.prototype,"type",void 0),S5=T5=_([Z("esri.symbols.PolygonSymbol3D")],S5);const oR=S5;var sG;const RF=new br({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let K_=sG=class extends Vve{constructor(...t){super(...t),this.color=new mt([0,0,0,.25]),this.outline=new dd,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new sG({color:Ce(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};_([T()],K_.prototype,"color",void 0),_([T()],K_.prototype,"outline",void 0),_([Bt({esriSFS:"simple-fill"},{readOnly:!0})],K_.prototype,"type",void 0),_([T({type:RF.apiValues,json:{read:RF.read,write:RF.write}})],K_.prototype,"style",void 0),K_=sG=_([Z("esri.symbols.SimpleFillSymbol")],K_);const Sw=K_;var oG;const MF=new br({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Rf=oG=class extends f_e{constructor(...t){super(...t),this.color=new mt([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new dd}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const n={};return t&&(n.style=t),e!=null&&(n.size=Br(e)),i&&(n.outline=i),r&&(n.color=r),n}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new oG({angle:this.angle,color:Ce(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};_([T()],Rf.prototype,"color",void 0),_([ot("color")],Rf.prototype,"writeColor",null),_([Bt({esriSMS:"simple-marker"},{readOnly:!0})],Rf.prototype,"type",void 0),_([T()],Rf.prototype,"size",void 0),_([T({type:MF.apiValues,json:{read:MF.read,write:MF.write}})],Rf.prototype,"style",void 0),_([T({type:String,json:{write:!0}})],Rf.prototype,"path",null),_([T({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":dd}},json:{default:null,write:!0}})],Rf.prototype,"outline",void 0),Rf=oG=_([Z("esri.symbols.SimpleMarkerSymbol")],Rf);const Nv=Rf;var aG;let cs=aG=class extends Zc{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new n7,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return Br(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new aG({angle:this.angle,backgroundColor:Ce(this.backgroundColor),borderLineColor:Ce(this.borderLineColor),borderLineSize:this.borderLineSize,color:Ce(this.color),font:this.font&&this.font.clone(),haloColor:Ce(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};_([T({type:mt,json:{write:!0}})],cs.prototype,"backgroundColor",void 0),_([T({type:mt,json:{write:!0}})],cs.prototype,"borderLineColor",void 0),_([T({type:Number,json:{write:!0},cast:Br})],cs.prototype,"borderLineSize",void 0),_([T({type:n7,json:{write:!0}})],cs.prototype,"font",void 0),_([T({...t_e,json:{write:!0}})],cs.prototype,"horizontalAlignment",void 0),_([T({type:Boolean,json:{write:!0}})],cs.prototype,"kerning",void 0),_([T({type:mt,json:{write:!0}})],cs.prototype,"haloColor",void 0),_([T({type:Number,cast:Br,json:{write:!0}})],cs.prototype,"haloSize",void 0),_([T({type:Boolean,json:{write:!0}})],cs.prototype,"rightToLeft",void 0),_([T({type:Boolean,json:{write:!0}})],cs.prototype,"rotated",void 0),_([T({type:String,json:{write:!0}})],cs.prototype,"text",void 0),_([Bt({esriTS:"text"},{readOnly:!0})],cs.prototype,"type",void 0),_([T({...i_e,json:{write:!0}})],cs.prototype,"verticalAlignment",void 0),_([T({type:Number,cast:Br,json:{write:!0}})],cs.prototype,"xoffset",void 0),_([T({type:Number,cast:Br,json:{write:!0}})],cs.prototype,"yoffset",void 0),_([T({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],cs.prototype,"angle",void 0),_([T({type:Number,json:{write:!0}})],cs.prototype,"width",void 0),_([T({type:Number})],cs.prototype,"lineWidth",void 0),_([ot("lineWidth")],cs.prototype,"writeLineWidth",null),_([Fi("lineWidth")],cs.prototype,"castLineWidth",null),_([T(e_e)],cs.prototype,"lineHeight",void 0),_([ot("lineHeight")],cs.prototype,"writeLineHeight",null),cs=aG=_([Z("esri.symbols.TextSymbol")],cs);const vE=cs;var lG;let Nd=lG=class extends Zc{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:Zs.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e?.portal,super.read(t,e)}clone(){return new lG({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const i=e!=null?e.cache:null,r=i?this._fetchCacheKey:null;if(i!=null){const u=r&&i.get(r);if(u)return u.clone()}const{resolveWebStyleSymbol:n}=await ke(()=>Promise.resolve().then(()=>zdt),void 0,import.meta.url);oi(e);const s=n(this,{portal:this.portal},t,e);s.catch(u=>{Ee.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",u)});const a=await s;return t==="webRef"&&a.type==="point-3d"||t==="cimRef"&&a.type==="cim"?(i?.set(r,a.clone()),a):null}};_([T({json:{write:!1}})],Nd.prototype,"color",void 0),_([T({type:String,json:{write:!0}})],Nd.prototype,"styleName",void 0),_([T({type:Zs,json:{write:!1}})],Nd.prototype,"portal",void 0),_([T({type:String,json:{read:XD,write:Eg}})],Nd.prototype,"styleUrl",void 0),_([T({type:_2,json:{read:!1}})],Nd.prototype,"thumbnail",void 0),_([T({type:String,json:{write:!0}})],Nd.prototype,"name",void 0),_([Bt({styleSymbolReference:"web-style"},{readOnly:!0})],Nd.prototype,"type",void 0),_([T()],Nd.prototype,"_fetchCacheKey",null),Nd=lG=_([Z("esri.symbols.WebStyleSymbol")],Nd);const Ew=Nd;function c7(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function J2(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const b2={base:Zc,key:"type",typeMap:{"simple-fill":Sw,"picture-fill":__e,"picture-marker":l7,"simple-line":dd,"simple-marker":Nv,text:vE,"label-3d":s7,"line-3d":o7,"mesh-3d":a7,"point-3d":Uy,"polygon-3d":oR,"web-style":Ew,cim:gE},errorContext:"symbol"},gje={base:Zc,key:"type",typeMap:{"picture-marker":l7,"simple-marker":Nv,text:vE,"web-style":Ew,cim:gE},errorContext:"symbol"},yje=aE({types:b2}),x_e={base:Zc,key:"type",typeMap:{"simple-fill":Sw,"picture-fill":__e,"picture-marker":l7,"simple-line":dd,"simple-marker":Nv,text:vE,"line-3d":o7,"mesh-3d":a7,"point-3d":Uy,"polygon-3d":oR,"web-style":Ew,cim:gE},errorContext:"symbol"},vje={base:Zc,key:"type",typeMap:{text:vE,"label-3d":s7},errorContext:"symbol"},jre={base:Zc,key:"type",typeMap:{"line-3d":o7,"mesh-3d":a7,"point-3d":Uy,"polygon-3d":oR,"web-style":Ew,cim:gE},errorContext:"symbol"},_je={base:Zc,key:"type",typeMap:{"label-3d":s7},errorContext:"symbol"},T_e=Pp(b2);var cG;function bje(t){if(!t)return null;const e={};for(const i in t){const r=E0(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function wje(t){if(t==null)return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}let fc=cG=class extends sn(Ne){constructor(...t){super(...t),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:zu(),configurable:!0})}normalizeCtorArgs(t,e,i,r){return t&&!t.declaredClass?t:{geometry:t,symbol:e,attributes:i,popupTemplate:r}}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new cG({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;for(const e of[this.sourceLayer,this.layer])if(e){if("popupTemplate"in e&&e.popupTemplate)return e.popupTemplate;if(t&&"defaultPopupTemplate"in e&&e.defaultPopupTemplate!=null)return e.defaultPopupTemplate}return null}getAttribute(t){return this.attributes?.[t]}setAttribute(t,e){if(this.attributes){const i=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",i,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:wje(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:z6(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:this.popupTemplate?.toJSON()??null}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if(e?.type==="mesh"){const i={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",i,i,t.action)}}_notifyLayer(t,e,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:t,oldValue:e,newValue:i};t==="origin-transform"&&(n.action=r),t==="attributes"&&(n.attributeName=r),this.layer.graphicChanged(n)}};_([T({value:null,json:{read:bje}})],fc.prototype,"aggregateGeometries",null),_([T({value:null})],fc.prototype,"attributes",null),_([T({value:null,types:_w,json:{read:E0}})],fc.prototype,"geometry",null),_([T({type:Boolean})],fc.prototype,"isAggregate",void 0),_([T({clonable:"reference"})],fc.prototype,"layer",void 0),_([T({type:mE})],fc.prototype,"popupTemplate",void 0),_([T({clonable:"reference"})],fc.prototype,"sourceLayer",void 0),_([T({value:null,types:b2})],fc.prototype,"symbol",null),_([T({type:Boolean,value:!0})],fc.prototype,"visible",null),fc=cG=_([Z("esri.Graphic")],fc),function(t){t.generateUID=zu}(fc||(fc={}));const Fp=fc;function u7(t){return typeof t=="string"?document.getElementById(t):t??null}function S_e(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function Bre(t,e){const i=e.parentNode;i&&i.insertBefore(t,e)}function Vre(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}let SL=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._observable=new VO,this._items=new Set}get length(){return di(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return di(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const i=this.length;return this._items.forEach(r=>{e(r)||this._items.delete(r)}),i!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){di(this._observable),yield*this._items}};const E_e=new FinalizationRegistry(t=>{t.close()});function xje(t,e){E_e.register(t,e,e)}function Tje(t){E_e.unregister(t)}const Sje={statsWorker:()=>ke(()=>import("./statsWorker-c6c4beff.js"),["./statsWorker-c6c4beff.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js"],import.meta.url),geometryEngineWorker:()=>ke(()=>import("./geometryEngineWorker-3dc299bf.js"),["./geometryEngineWorker-3dc299bf.js","./geometryEngineJSON-d7488e9e.js","./json-48e3ea08.js"],import.meta.url),CSVSourceWorker:()=>ke(()=>import("./CSVSourceWorker-7d06ecf8.js"),["./CSVSourceWorker-7d06ecf8.js","./date-430969b3.js","./json-48e3ea08.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./QueryEngine-44ece2b8.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./number-67602970.js"],import.meta.url),EdgeProcessingWorker:()=>ke(()=>import("./EdgeProcessingWorker-3ec446b7.js"),[],import.meta.url),ElevationSamplerWorker:()=>ke(()=>import("./ElevationSamplerWorker-cfd79a28.js"),["./ElevationSamplerWorker-cfd79a28.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js"],import.meta.url),FeatureServiceSnappingSourceWorker:()=>ke(()=>import("./FeatureServiceSnappingSourceWorker-c26adabd.js"),["./FeatureServiceSnappingSourceWorker-c26adabd.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./QueryEngine-44ece2b8.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./symbologySnappingCandidates-3ddc2472.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./query-51127c95.js"],import.meta.url),GeoJSONSourceWorker:()=>ke(()=>import("./GeoJSONSourceWorker-0fb16835.js"),["./GeoJSONSourceWorker-0fb16835.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./QueryEngine-44ece2b8.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./geojson-e5e4b4d2.js","./date-430969b3.js","./sourceUtils-e4150479.js"],import.meta.url),LercWorker:()=>ke(()=>import("./LercWorker-ec4119e7.js"),[],import.meta.url),MemorySourceWorker:()=>ke(()=>import("./MemorySourceWorker-ca7e7c83.js"),["./MemorySourceWorker-ca7e7c83.js","./objectIdUtils-967fafff.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./QueryEngine-44ece2b8.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./sourceUtils-e4150479.js","./date-430969b3.js"],import.meta.url),PBFDecoderWorker:()=>ke(()=>import("./PBFDecoderWorker-fea62624.js"),["./PBFDecoderWorker-fea62624.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js"],import.meta.url),Pipeline:()=>ke(()=>import("./Pipeline-79c3924a.js").then(t=>t.P),["./Pipeline-79c3924a.js","./QueryEngine-44ece2b8.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./StreamFeatureManager-a85eefb4.js","./quickselect-4a5a9977.js","./labelPoint-28dffb78.js","./ogcFeatureUtils-13164435.js","./geojson-e5e4b4d2.js","./date-430969b3.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./createConnection-03bdf9dc.js","./definitions-b2b7fe84.js","./enums-9d4f5c11.js","./number-e491b09e.js","./geohashUtils-77d8429b.js"],import.meta.url),PointCloudWorker:()=>ke(()=>import("./PointCloudWorker-d1511010.js"),["./PointCloudWorker-d1511010.js","./PointCloudWorkerUtil-3d5290ee.js","./PointCloudUniqueValueRenderer-95a3111a.js","./I3SBinaryReader-ce9ec7ac.js"],import.meta.url),RasterWorker:()=>ke(()=>import("./RasterWorker-6e33f0e8.js"),["./RasterWorker-6e33f0e8.js","./dataUtils-3396c02a.js","./utils-e4874252.js","./rasterProjectionHelper-04f7c394.js"],import.meta.url),SceneLayerSnappingSourceWorker:()=>ke(()=>import("./SceneLayerSnappingSourceWorker-dea95603.js"),[],import.meta.url),SceneLayerWorker:()=>ke(()=>import("./SceneLayerWorker-615b3bae.js").then(t=>t.S),["./SceneLayerWorker-615b3bae.js","./I3SNode-ab03940e.js"],import.meta.url),WFSSourceWorker:()=>ke(()=>import("./WFSSourceWorker-2c150654.js"),["./WFSSourceWorker-2c150654.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./QueryEngine-44ece2b8.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./geojson-e5e4b4d2.js","./date-430969b3.js","./sourceUtils-e4150479.js","./wfsUtils-49f17520.js","./xmlUtils-444cb4c0.js"],import.meta.url),WorkerTileHandler:()=>ke(()=>import("./WorkerTileHandler-47081496.js"),["./WorkerTileHandler-47081496.js","./TileClipper-ae6eca9e.js","./StyleRepository-f979d920.js","./definitions-b2b7fe84.js","./Rect-98da58d6.js","./pbf-334ee1bd.js","./TurboLine-f3c2a362.js","./BidiEngine-9a40f2f4.js"],import.meta.url)};var ua;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(ua||(ua={}));let Eje=0;function C_e(){return Eje++}function Cje(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function X4(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function sZ(t,e,i,r){if(e.type===ua.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==ua.INVOKE&&e.type!==ua.RESPONSE)return void t.postMessage(e);let n;if(Cje(i)?(n=Gre(i.transferList),e.data=i.result):(n=Gre(r),e.data=i),n){if(Me("ff")){for(const s of n)if("byteLength"in s&&s.byteLength>267386880){const a="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case ua.INVOKE:throw a;case ua.RESPONSE:return void sZ(t,{type:ua.RESPONSE,jobId:e.jobId,error:X4(a)})}}}t.postMessage(e,n)}else t.postMessage(e)}function J4(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Gre(t){if(!t?.length)return null;if(Me("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!Aje(i));return e.length?e:null}function Aje(t){return t instanceof ArrayBuffer||t?.constructor?.name==="ArrayBuffer"}const{CLOSE:Hre,ABORT:qre,INVOKE:Wre,RESPONSE:XE,OPEN_PORT:Xre,ON:Oje}=ua,Rje=2;let Mje=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===ua.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},mv=class vx{static connect(e){const i=new MessageChannel;let r;r=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new vx(i.port1,{channel:i,client:r});return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=n),vx.clients.set(n,r),i.port2}static loadWorker(e){const i=Sje[e];return i?i():Promise.resolve(null)}constructor(e,i,r){this._port=e,this._jobQueue=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new Mje(n=>this._onInvokeMessage(n)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:Hre}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){const n=r?.signal,s=r?.transferList;if(!this._port)return Promise.reject(new de("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const a=C_e();return new Promise((u,p)=>{if(Ms(n))return this._processWork(),void p(or());const y=qs(n,()=>{const S=this._outJobs.get(a);S&&(this._outJobs.delete(a),this._processWork(),nn(S.abortHandle),this._post({type:qre,jobId:a}),p(or()))}),b={resolve:u,reject:p,abortHandle:y,debugInfo:e};this._outJobs.set(a,b),this._post({type:Wre,jobId:a,methodName:e,abortable:n!=null},i,s)})}on(e,i){const r=new MessageChannel;function n(s){i(s.data)}return this._port.postMessage({type:ua.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",n),r.port1.start(),Sr(()=>{r.port1.postMessage({type:ua.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",n)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:Xre,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=Rje)return;const e=this._jobQueue?.pop();if(!e)return;const{methodName:i,data:r,invokeOptions:n,resolver:s}=e;this.invoke(i,r,n).then(a=>s.resolve(a)).catch(a=>s.reject(a))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{nn(e.abortHandle),e.reject(or(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const i=J4(e);if(i)switch(i.type){case XE:this._onResponseMessage(i);break;case Wre:this._invokeQueue.push(i);break;case qre:this._onAbortMessage(i);break;case Hre:this._onCloseMessage();break;case Xre:this._onOpenPortMessage(i);break;case Oje:this._onOnMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,n=i.get(r);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&vx.clients.get(this)===e&&e.destroy(),vx.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:n,abortable:s}=e,a=s?new AbortController:null,u=this._inJobs;let p,y=this._client,b=y[i];try{if(!b&&i&&i.includes(".")){const S=i.split(".");for(let C=0;C<S.length-1;C++)y=y[S[C]],b=y[S[C+1]]}if(typeof b!="function")throw new TypeError(`${i} is not a function`);p=b.call(y,n,{client:this,signal:a?a.signal:null})}catch(S){return void this._post({type:XE,jobId:r,error:X4(S)})}Yc(p)?(u.set(r,{controller:a,promise:p}),p.then(S=>{u.has(r)&&(u.delete(r),this._post({type:XE,jobId:r},S))},S=>{u.has(r)&&(u.delete(r),qn(S)||this._post({type:XE,jobId:r,error:X4(S||{message:`Error encountered at method ${i}`})}))})):this._post({type:XE,jobId:r},p)}_onOpenPortMessage(e){new vx(e.port,{client:this._client})}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,s=>{i.postMessage(s)}),n=lg(e.port,"message",s=>{J4(s)?.type===ua.CLOSE&&(n.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:n}=e,s=this._outJobs;if(!s.has(i))return;const a=s.get(i);s.delete(i),this._processWork(),nn(a.abortHandle),r?a.reject(de.fromJSON(JSON.parse(r))):a.resolve(n)}_post(e,i,r){return sZ(this._port,e,i,r)}};mv.kernelInfo={buildDate:Tme,fullVersion:ED,revision:Sme},mv.clients=new Map;let Pje=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new SL}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,i){return new Promise((r,n)=>{let s=!0;const a=u=>{oi(i.signal),s&&(s=!1,u())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let u=0;u<e.length;++u){const p=e[u];Yc(p)?this._clientPromises[u]=p.then(y=>(this._clients[u]=new mv(y,i,this._ongoingJobsQueue),a(r),this._clients[u]),()=>(a(n),null)):(this._clients[u]=new mv(p,i,this._ongoingJobsQueue),this._clientPromises[u]=Promise.resolve(this._clients[u]),a(r))}})}broadcast(e,i,r){const n=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const a=this._clientPromises[s];n[s]=a.then(u=>u?.invoke(e,i,r))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(or(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r?.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,Tje(this)}invoke(e,i,r){let n;Array.isArray(r)?(Ee.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),n={transferList:r}):n=r;const s=Ys();this._ongoingJobsQueue.push({methodName:e,data:i,invokeOptions:n,resolver:s});for(let a=0;a<this._clientPromises.length;a++){const u=this._clients[a];u?u.jobAdded():this._clientPromises[a].then(p=>p?.jobAdded())}return s.promise}on(e,i){return Promise.all(this._clientPromises).then(()=>nv(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then(s=>{s&&(i[n]=s.openPort()),--r==0&&e(i)})})}get test(){return{numClients:this._clients.length}}};const Ije={async request(t,e){const i=t.options,r=i.responseType;i.signal=e?.signal,i.responseType=r==="native"||r==="native-request-init"?"native-request-init":r&&["blob","json","text"].includes(r)&&yme(t.url)?.after?r:"array-buffer";const n=await ir(t.url,i),s={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch(n.requestOptions?.responseType){case"native-request-init":return delete s.data.signal,s;case"blob":s.data=await s.data.arrayBuffer();break;case"json":s.data=new TextEncoder().encode(JSON.stringify(s.data)).buffer;break;case"text":s.data=new TextEncoder().encode(s.data).buffer}return{result:s,transferList:[s.data]}}},$je={};function Lje(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages?.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=$je.baseUrl),e}let Dje=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},ZI=class{constructor(){this._dispatcher=new Dje,this._workerPostMessage({type:ua.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){nS(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){nS(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=J4(e);if(i&&i.type===ua.OPEN){const{modulePath:r,jobId:n}=i;let s=await mv.loadWorker(r);s||(s=await ke(()=>import(r),[],import.meta.url));const a=mv.connect(s);this._workerPostMessage({type:ua.OPENED,jobId:n,data:a})}}};const uG=Ee.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:Nje}=ua,Fje='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let yM,vM;const Jre="Failed to create Worker. Fallback to execute module in main thread";async function kje(){if(!Me("esri-workers"))return Yre(new ZI);if(!yM&&!vM)try{const e=Fje.split('"{CONFIGURATION}"').join(`'${zje()}'`);yM=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){vM=e||{}}let t;if(yM)try{t=new Worker(yM,{name:"esri-worker-"+Uje++})}catch{uG.warn(Jre,vM),t=new ZI}else uG.warn(Jre,vM),t=new ZI;return Yre(t)}async function Yre(t){return new Promise(e=>{function i(n){const s=J4(n);s&&s.type===Nje&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(n){n.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),uG.warn("Failed to create Worker. Fallback to execute module in main thread",n),(t=new ZI).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function zje(){let t;if(vr.default!=null){const n={...vr};delete n.default,t=JSON.parse(JSON.stringify(n))}else t=JSON.parse(JSON.stringify(vr));t.assetsPath=fl(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?fl(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Bu(),t.has={"esri-csp-restrictions":Me("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":Me("esri-2d-update-debug"),"esri-2d-log-updating":Me("esri-2d-log-updating"),"featurelayer-pbf":Me("featurelayer-pbf"),"featurelayer-simplify-thresholds":Me("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":Me("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":Me("featurelayer-simplify-mobile-factor"),"esri-atomics":Me("esri-atomics"),"esri-shared-array-buffer":Me("esri-shared-array-buffer"),"esri-tiles-debug":Me("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":Me("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":Me("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=fl(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=fl(t.workers.workerPath):t.workers.workerPath=fl(Kr("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=vr.workers.loaderConfig,i=Lje({baseUrl:e?.baseUrl,locale:Bu(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e?.has},map:{...e?.map},paths:{...e?.paths},packages:e?.packages||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{buildDate:Tme,fullVersion:ED,revision:Sme}})}let Uje=0;const{ABORT:Zre,INVOKE:jje,OPEN:Bje,OPENED:Vje,RESPONSE:JE}=ua;let Gje=class A_e{static async create(e){const i=await kje();return new A_e(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),Ee.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,n=C_e();return new Promise((s,a)=>{const u={resolve:s,reject:a,abortHandle:kO(r,()=>{this._outJobs.delete(n),this._post({type:Zre,jobId:n})})};this._outJobs.set(n,u),this._post({type:Bje,jobId:n,modulePath:e})})}_onMessage(e){const i=J4(e);if(i)switch(i.type){case Vje:this._onOpenedMessage(i);break;case JE:this._onResponseMessage(i);break;case Zre:this._onAbortMessage(i);break;case jje:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,n=i.get(r);n&&(n.controller&&n.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:n,abortable:s}=e,a=s?new AbortController:null,u=this._inJobs,p=Ije[i];let y;try{if(typeof p!="function")throw new TypeError(`${i} is not a function`);y=p.call(null,n,{signal:a?a.signal:null})}catch(b){return void this._post({type:JE,jobId:r,error:X4(b)})}Yc(y)?(u.set(r,{controller:a,promise:y}),y.then(b=>{u.has(r)&&(u.delete(r),this._post({type:JE,jobId:r},b))},b=>{u.has(r)&&(u.delete(r),b||(b={message:"Error encountered at method"+i}),qn(b)||this._post({type:JE,jobId:r,error:X4(b||{message:`Error encountered at method ${i}`})}))})):this._post({type:JE,jobId:r},y)}_onOpenedMessage(e){const{jobId:i,data:r}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),nn(n.abortHandle),n.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:n}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),nn(s.abortHandle),r?s.reject(de.fromJSON(JSON.parse(r))):s.resolve(n))}_post(e,i,r){return sZ(this.worker,e,i,r)}};const Kre=Me("host-browser")?Math.min(navigator.hardwareConcurrency-1,Me("workers-pool-size")):0;let r2=Me("esri-mobile")?Math.min(Kre,3):Kre;r2||(r2=Me("safari")&&Me("mac")?7:2);let Qre=0;const KI=[];function Hje(){O_e()}async function _M(t,e){const i=new Pje,{registryTarget:r,...n}=e;return await i.open(t,n),r&&xje(r,i),i}async function oZ(t,e={}){if(typeof t!="string")throw new de("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(Me("host-webworker")&&!Me("esri-workers")&&(i="local"),i==="local"){let r=await mv.loadWorker(t);r||(r=await ke(()=>import(t),[],import.meta.url)),oi(e.signal);const n=e.client||r;return _M([mv.connect(r)],{...e,client:n})}if(await O_e(),oi(e.signal),i==="dedicated"){const r=Qre++%r2;return _M([await KI[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,r2);if(r<r2){const n=new Array(r);for(let s=0;s<r;++s){const a=Qre++%r2;n[s]=KI[a].open(t,e)}return _M(n,e)}}return _M(KI.map(r=>r.open(t,e)),e)}let bM=null;async function O_e(){if(bM)return bM;new AbortController;const t=[];for(let e=0;e<r2;e++){const i=Gje.create(e).then(r=>(KI[e]=r,r));t.push(i)}return bM=Promise.all(t),bM}let BA=class extends Dt{constructor(e){super(e),this.addHandles([this.on("before-add",i=>{i.item==null&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Dt.ofType(this.itemType.Type))(e):new Dt(e)}};function hG(t,e){return{type:t,cast:MJ,set(i){const r=xg(i,this._get(e),t);r.owner=this,this._set(e,r)}}}_([T()],BA.prototype,"owner",null),BA=_([Z("esri.core.support.OwningCollection")],BA);function h7(t,e,i,r){return t!=null&&(Wn(e,r)?(Sg(i,t),!0):(nc[0]=t[0],nc[1]=t[1],nc[2]=0,!!Mn(nc,e,0,nc,r,0,1)&&(i[0]=nc[0],i[1]=nc[1],nc[0]=t[2],nc[1]=t[3],nc[2]=0,!!Mn(nc,e,0,nc,r,0,1)&&(i[2]=nc[0],i[3]=nc[1],!0))))}const nc=H();function Wc(t,e,i,r=0){wM[0]=t.x,wM[1]=t.y;const n=t.z;return wM[2]=n!==void 0?n:r,Mn(wM,t.spatialReference,0,e,i,0,1)}const wM=H();function va(t,e,i,r){return!(e==null||r==null||t.length<2)&&(t.length===2&&(xM[0]=t[0],xM[1]=t[1],xM[2]=0,t=xM),Mn(t,e,0,i,r,0,1))}const xM=H();let kg=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&nS(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*ene);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,ene));e++)this._items.push(this._allocator())}};const ene=1024;function Ze(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function OS(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function aZ(t,e,i,r,n,s,a,u,p,y,b,S,C,O,P,$){return[t,e,i,r,n,s,a,u,p,y,b,S,C,O,P,$]}function R_e(t,e){return new Float64Array(t,e,16)}const Cn=Ze();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Cn,clone:OS,create:Ze,createView:R_e,fromValues:aZ},Symbol.toStringTag,{value:"Module"}));var EL;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(EL||(EL={}));function Pn(){return[1,0,0,0,1,0,0,0,1]}function M_e(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function qje(t,e,i,r,n,s,a,u,p){return[t,e,i,r,n,s,a,u,p]}function P_e(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:M_e,create:Pn,createView:P_e,fromValues:qje},Symbol.toStringTag,{value:"Module"}));function pd(){return[0,0,0,1]}function I_e(t){return[t[0],t[1],t[2],t[3]]}function Wje(t,e,i,r){return[t,e,i,r]}function $_e(t,e){return new Float64Array(t,e,4)}const Xje=pd();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Xje,clone:I_e,create:pd,createView:$_e,fromValues:Wje},Symbol.toStringTag,{value:"Module"}));function Ct(){return[0,0]}function E5(t){return[t[0],t[1]]}function Xi(t,e){return[t,e]}function L_e(t,e=Ct()){const i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function D_e(t,e){return new Float64Array(t,e,2)}function N_e(){return Ct()}function F_e(){return Xi(1,1)}function k_e(){return Xi(1,0)}function z_e(){return Xi(0,1)}const Cg=N_e(),Jje=F_e(),U_e=k_e(),Yje=z_e();Object.freeze(Object.defineProperty({__proto__:null,ONES:Jje,UNIT_X:U_e,UNIT_Y:Yje,ZEROS:Cg,clone:E5,create:Ct,createView:D_e,fromArray:L_e,fromValues:Xi,ones:F_e,unitX:k_e,unitY:z_e,zeros:N_e},Symbol.toStringTag,{value:"Module"}));function ji(){return[0,0,0,0]}function aR(t){return[t[0],t[1],t[2],t[3]]}function vi(t,e,i,r){return[t,e,i,r]}function lZ(t,e=ji()){const i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function j_e(t,e){return new Float64Array(t,e,4)}function B_e(){return ji()}function V_e(){return vi(1,1,1,1)}function G_e(){return vi(1,0,0,0)}function H_e(){return vi(0,1,0,0)}function q_e(){return vi(0,0,1,0)}function W_e(){return vi(0,0,0,1)}const qu=B_e(),Bh=V_e(),Zje=G_e(),Kje=H_e(),Qje=q_e(),eBe=W_e();Object.freeze(Object.defineProperty({__proto__:null,ONES:Bh,UNIT_W:eBe,UNIT_X:Zje,UNIT_Y:Kje,UNIT_Z:Qje,ZEROS:qu,clone:aR,create:ji,createView:j_e,fromArray:lZ,fromValues:vi,ones:V_e,unitW:W_e,unitX:G_e,unitY:H_e,unitZ:q_e,zeros:B_e},Symbol.toStringTag,{value:"Module"}));let _E=class Q_{constructor(e,i,r){this._itemByteSize=e,this._itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this._itemByteSize)}get(){this._itemsPtr===0&&nS(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const i=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this._itemCreate(i,r*this._itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=Ww){return new Q_(16,D_e,e)}static createVec3f64(e=Ww){return new Q_(24,rge,e)}static createVec4f64(e=Ww){return new Q_(32,j_e,e)}static createMat3f64(e=Ww){return new Q_(72,P_e,e)}static createMat4f64(e=Ww){return new Q_(128,R_e,e)}static createQuatf64(e=Ww){return new Q_(32,$_e,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const Ww=4*EL.KILOBYTES,MPt=_E.createVec2f64(),vt=_E.createVec3f64(),cZ=_E.createVec4f64();_E.createMat3f64();const uZ=_E.createMat4f64(),PPt=_E.createQuatf64();function Gp(t){return t?{origin:An(t.origin),vector:An(t.vector)}:{origin:H(),vector:H()}}function tBe(t,e){const i=rBe.get();return i.origin=t,i.vector=e,i}function IPt(t,e=Gp()){return iBe(t.origin,t.vector,e)}function iBe(t,e,i=Gp()){return Ie(i.origin,t),Ie(i.vector,e),i}function w2(t,e,i=Gp()){return Ie(i.origin,t),Be(i.vector,e,t),i}function hZ(t,e){const i=Be(vt.get(),e,t.origin),r=He(t.vector,i),n=He(t.vector,t.vector),s=Je(r/n,0,1),a=Be(vt.get(),Pe(vt.get(),t.vector,s),i);return He(a,a)}function $Pt(t,e,i){return dG(t,e,0,1,i)}function LPt(t,e,i){return Ue(i,t.origin,Pe(i,t.vector,e))}function dG(t,e,i,r,n){const{vector:s,origin:a}=t,u=Be(vt.get(),e,a),p=He(s,u)/ha(s);return Pe(n,s,Je(p,i,r)),Ue(n,n,t.origin)}function DPt(t,e){if(J_e(t,tBe(e.origin,e.direction),!1,CL)){const{tA:i,pB:r,distance2:n}=CL;if(i>=0&&i<=1)return n;if(i<0)return ao(t.origin,r);if(i>1)return ao(Ue(vt.get(),t.origin,t.vector),r)}return null}function X_e(t,e,i){return!!J_e(t,e,!0,CL)&&(Ie(i,CL.pA),!0)}function J_e(t,e,i,r){const s=t.origin,a=Ue(vt.get(),s,t.vector),u=e.origin,p=Ue(vt.get(),u,e.vector),y=vt.get(),b=vt.get();if(y[0]=s[0]-u[0],y[1]=s[1]-u[1],y[2]=s[2]-u[2],b[0]=p[0]-u[0],b[1]=p[1]-u[1],b[2]=p[2]-u[2],Math.abs(b[0])<1e-6&&Math.abs(b[1])<1e-6&&Math.abs(b[2])<1e-6)return!1;const S=vt.get();if(S[0]=a[0]-s[0],S[1]=a[1]-s[1],S[2]=a[2]-s[2],Math.abs(S[0])<1e-6&&Math.abs(S[1])<1e-6&&Math.abs(S[2])<1e-6)return!1;const C=y[0]*b[0]+y[1]*b[1]+y[2]*b[2],O=b[0]*S[0]+b[1]*S[1]+b[2]*S[2],P=y[0]*S[0]+y[1]*S[1]+y[2]*S[2],$=b[0]*b[0]+b[1]*b[1]+b[2]*b[2],N=(S[0]*S[0]+S[1]*S[1]+S[2]*S[2])*$-O*O;if(Math.abs(N)<1e-6)return!1;let z=(C*O-P*$)/N,U=(C+O*z)/$;i&&(z=Je(z,0,1),U=Je(U,0,1));const j=vt.get(),G=vt.get();return j[0]=s[0]+z*S[0],j[1]=s[1]+z*S[1],j[2]=s[2]+z*S[2],G[0]=u[0]+U*b[0],G[1]=u[1]+U*b[1],G[2]=u[2]+U*b[2],r.tA=z,r.tB=U,r.pA=j,r.pB=G,r.distance2=ao(j,G),!0}const CL={tA:0,tB:0,pA:H(),pB:H(),distance2:0},rBe=new kg(()=>Gp());function oo(t){return t?tne(An(t.origin),An(t.direction)):tne(H(),H())}function tne(t,e){return{origin:t,direction:e}}function NPt(t,e){return bg(t.origin,e.origin)&&bg(t.direction,e.direction)}function eh(t,e){const i=oBe.get();return i.origin=t,i.direction=e,i}function AL(t,e=oo()){return Z_e(t.origin,t.direction,e)}function Y_e(t,e,i=oo()){return Ie(i.origin,t),Be(i.direction,e,t),i}function Z_e(t,e,i=oo()){return Ie(i.origin,t),Ie(i.direction,e),i}function nBe(t,e){const i=qt(vt.get(),We(vt.get(),t.direction),Be(vt.get(),e,t.origin));return He(i,i)}function sBe(t,e,i){const r=He(t.direction,Be(i,e,t.origin));return Ue(i,t.origin,Pe(i,t.direction,r)),i}const oBe=new kg(()=>oo());function VA(t,e){return He(t,e)/Qe(t)}function d7(t,e){const i=He(t,e)/(Qe(t)*Qe(e));return-co(i)}function K_e(t,e,i){We(TM,t),We(PF,e);const r=He(TM,PF),n=co(r),s=qt(TM,TM,PF);return He(s,i)<0?2*Math.PI-n:n}const TM=H(),PF=H(),Q_e=as();function as(){return ji()}const aBe=V2,lBe=V2;function RS(t,e=as()){return mp(e,t)}function ebe(t,e){return vi(t[0],t[1],t[2],e)}function cBe(t){return t}function uBe(t){t[0]=t[1]=t[2]=t[3]=0}function p7(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function ug(t){return t[3]}function hBe(t){return t}function tbe(t,e,i,r){return vi(t,e,i,r)}function dBe(t,e,i){return t!==i&&Ie(i,t),i[3]=t[3]+e,i}function pBe(t,e,i){return Ee.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===i?i:RS(t,i)}function Fv(t,e,i){if(e==null||!ibe(t,e,OL))return!1;let{t0:r,t1:n}=OL;if((r<0||n<r&&n>0)&&(r=n),r<0)return!1;if(i){const{origin:s,direction:a}=e;i[0]=s[0]+a[0]*r,i[1]=s[1]+a[1]*r,i[2]=s[2]+a[2]*r}return!0}function fBe(t,e,i){const r=Y_e(e,i);if(!ibe(t,r,OL))return[];const{origin:n,direction:s}=r,{t0:a,t1:u}=OL,p=y=>{const b=H();return Xl(b,n,s,y),dZ(t,b,b)};return Math.abs(a-u)<Ko()?[p(a)]:[p(a),p(u)]}const OL={t0:0,t1:0};function ibe(t,e,i){const{origin:r,direction:n}=e,s=mBe;s[0]=r[0]-t[0],s[1]=r[1]-t[1],s[2]=r[2]-t[2];const a=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(a===0)return!1;const u=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),p=u*u-4*a*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-t[3]*t[3]);if(p<0)return!1;const y=Math.sqrt(p);return i.t0=(-u-y)/(2*a),i.t1=(-u+y)/(2*a),!0}const mBe=H();function pG(t,e){return Fv(t,e,null)}function gBe(t,e,i){if(Fv(t,e,i))return i;const r=bE(t,e,vt.get());return Ue(i,e.origin,Pe(vt.get(),e.direction,un(e.origin,r)/Qe(e.direction))),i}function bE(t,e,i){const r=vt.get(),n=uZ.get();qt(r,e.origin,e.direction);const s=ug(t);qt(i,r,e.origin),Pe(i,i,1/Qe(i)*s);const a=nbe(t,e.origin),u=d7(e.origin,i);return Zu(n,u+a,r),wt(i,i,n),i}function yBe(t,e,i){return Fv(t,e,i)?i:(sBe(e,t,i),dZ(t,i,i))}function dZ(t,e,i){const r=Be(vt.get(),e,t),n=Pe(vt.get(),r,t[3]/Qe(r));return Ue(i,n,t)}function rbe(t,e){const i=Be(vt.get(),e,t),r=ha(i),n=t[3]*t[3];return Math.sqrt(Math.abs(r-n))}function nbe(t,e){const i=Be(vt.get(),e,t),r=Qe(i),n=ug(t),s=n+Math.abs(n-r);return co(n/s)}const IF=H();function sbe(t,e,i,r){const n=Be(IF,e,t);switch(i){case $n.X:{const s=gie(n,IF)[2];return $e(r,-Math.sin(s),Math.cos(s),0)}case $n.Y:{const s=gie(n,IF),a=s[1],u=s[2],p=Math.sin(a);return $e(r,-p*Math.cos(u),-p*Math.sin(u),Math.cos(a))}case $n.Z:return We(r,n);default:return}}function obe(t,e){const i=Be(fG,e,t);return Qe(i)-t[3]}function vBe(t,e,i,r){const n=obe(t,e),s=sbe(t,e,$n.Z,fG),a=Pe(fG,s,i-n);return Ue(r,e,a)}function _Be(t,e){const i=ao(t,e),r=ug(t);return i<=r*r}function bBe(t,e,i=as()){const r=un(t,e),n=t[3],s=e[3];return r+s<n?(mp(i,t),i):r+n<s?(mp(i,e),i):(Ir(i,t,e,(r+s-n)/(2*r)),i[3]=(r+n+s)/2,i)}const fG=H(),f7=as(),wBe=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:Q_e,altitudeAt:obe,angleToSilhouette:nbe,axisAt:sbe,clear:uBe,closestPoint:yBe,closestPointOnSilhouette:bE,containsPoint:_Be,copy:RS,create:as,distanceToSilhouette:rbe,elevate:dBe,equals:lBe,exactEquals:aBe,fromCenterAndRadius:ebe,fromRadius:p7,fromValues:tbe,getCenter:hBe,getRadius:ug,intersectLine:fBe,intersectRay:Fv,intersectRayClosestSilhouette:gBe,intersectsRay:pG,projectPoint:dZ,setAltitudeAt:vBe,setExtent:pBe,tmpSphere:f7,union:bBe,wrap:cBe},Symbol.toStringTag,{value:"Module"}));function MS(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function xBe(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),n=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return $e(t,i,r,n),t}function FPt(t,e,i){i=i||t;const r=He(t,e);$e(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),We(i,i)}function kPt(t,e,i){Math.abs(t[0])>Math.abs(t[1])?$e(e,0,1,0):$e(e,1,0,0),qt(i,t,e),We(e,e),qt(e,i,t),We(i,i)}function SM(t,e,i,r,n,s){const a=t+(e-t)*n;return a+(i+(r-i)*n-a)*s}function TBe(t,e,i,r=H()){const n=Qe(t),s=Qe(e),a=He(t,e)/(n*s);if(a<.9999999999999999){const u=Math.acos(a),p=((1-i)*n+i*s)/Math.sin(u),y=p/n*Math.sin((1-i)*u),b=p/s*Math.sin(i*u);return Pe(n2,t,y),Pe(s2,e,b),Ue(r,n2,s2)}return Ir(r,t,e,i)}function zPt(t,e,i,r=H(),n=H()){const s=Qe(t),a=Qe(e),u=He(t,e)/(s*a);if(u<.9999999999999999){const p=Math.acos(u),y=Math.sin(p),b=Math.sin(i*p),S=Math.sin((1-i)*p),C=(1-i)*s+i*a;{const O=C/y,P=O/a*b;Pe(n2,t,O/s*S),Pe(s2,e,P),Ue(r,n2,s2)}{const O=1/s*(-Math.cos((1-i)*p)*p*C+S*(-s+a));Pe(n2,t,O);const P=1/a*(Math.cos(i*p)*p*C+b*(-s+a));Pe(s2,e,P),Ue(n,n2,s2),Pe(n,n,1/y)}return n}return Ir(r,t,e,i),Be(n,e,t),We(n,n),n}function QI(t,e,i){t=We(n2,t),e=We(s2,e);const r=co(He(t,e));if(i){const n=qt(SBe,t,e);if(He(n,i)<0)return-r}return r}function e$(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const n=t[r-1][0],s=t[r][0],a=(s-i)/(s-n);return a*t[r-1][1]+(1-a)*t[r][1]}}function UPt(t,e,i,r){Be(ine,e,t),Be(rne,i,t),qt(r,ine,rne),We(r,r),r[3]=-He(t,r)}const ine=H(),rne=H(),SBe=H(),n2=H(),s2=H();function gr(t=C5){return[t[0],t[1],t[2],t[3]]}function EBe(t=C5[0],e=C5[1],i=C5[2],r=C5[3]){return pZ(t,e,i,r,cZ.get())}function m7(t,e){return pZ(e[0],e[1],e[2],e[3],t)}function pZ(t,e,i,r,n=gr()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function abe(t,e,i){return Ie(i,t),i[3]=e,i}function lR(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function La(t,e,i,r=gr()){const n=i[0]-e[0],s=i[1]-e[1],a=i[2]-e[2],u=t[0]-e[0],p=t[1]-e[1],y=t[2]-e[2],b=s*y-a*p,S=a*u-n*y,C=n*p-s*u,O=b*b+S*S+C*C,P=Math.abs(O-1)>1e-5&&O>1e-12?1/Math.sqrt(O):1;return r[0]=b*P,r[1]=S*P,r[2]=C*P,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function fZ(t,e,i,r=0,n=Math.floor(i*(1/3)),s=Math.floor(i*(2/3))){if(i<3)return!1;e(YE,r);let a=n,u=!1;for(;a<i-1&&!u;)e(Xw,a),a++,u=!pa(YE,Xw);if(!u)return!1;for(a=Math.max(a,s),u=!1;a<i&&!u;)e(zb,a),a++,Be(EM,YE,Xw),We(EM,EM),Be(CM,Xw,zb),We(CM,CM),u=!pa(YE,zb)&&!pa(Xw,zb)&&Math.abs(He(EM,CM))<ABe;return u?(La(YE,Xw,zb,t),!0):(r!==0||n!==1||s!==2)&&fZ(t,e,i,0,1,2)}function CBe(t,e,i=!0){const r=e.length/3;return fZ(t,(n,s)=>$e(n,e[3*s+0],e[3*s+1],e[3*s+2]),i?r-1:r)}const ABe=.99619469809,YE=H(),Xw=H(),zb=H(),EM=H(),CM=H();function mG(t,e,i){return e!==t&&m7(t,e),t[3]=-He(t,i),t}function gG(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function Y4(t,e,i,r){return qt(zb,e,t),lR(i,zb,r)}function jPt(t,e,i,r){return g7(t,e,Be(vt.get(),i,e),$Be,r)}function Cw(t,e,i){return e!=null&&g7(t,e.origin,e.direction,LBe,i)}function OBe(t,e,i){return g7(t,e.origin,e.vector,m0.NONE,i)}function RBe(t,e,i){return g7(t,e.origin,e.vector,m0.CLAMP,i)}const BPt=(()=>{const t=H();return(e,i,r)=>{const n=e,s=i;if(qt(t,n,s),ha(t)<Ko())return!1;We(t,t);const[a,u,p]=t,y=r.origin,b=Math.abs(a),S=Math.abs(u),C=Math.abs(p),[O,P,$]=n,[N,z,U]=s,j=e[3],G=i[3];return b>S&&b>C?(y[1]=(G*$-j*U)/a,y[2]=(j*z-G*P)/a):S>C?(y[0]=(j*U-G*$)/u,y[2]=(G*O-j*N)/u):(y[0]=(G*P-j*z)/p,y[1]=(j*N-G*O)/p),Ie(r.direction,t),!0}})();function lbe(t,e){return qr(t,e)>=0}function MBe(t,e){const i=He(t,e.ray.direction),r=-qr(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const n=r/i;return i>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function PBe(t,e){const i=He(t,e.ray.direction),r=-qr(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const n=r/i;return i>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function IBe(t,e,i){const r=Pe(vt.get(),t,-t[3]),n=yG(t,Be(vt.get(),e,r),vt.get());return Ue(i,n,r),i}function yG(t,e,i){const r=Pe(vt.get(),t,He(t,e));return Be(i,e,r),i}function VPt(t,e){return Math.abs(qr(t,e))}function qr(t,e){return He(t,e)+t[3]}function g7(t,e,i,r,n){const s=He(t,i);if(s===0)return!1;let a=-(He(t,e)+t[3])/s;return r&m0.CLAMP&&(a=Je(a,0,1)),!(!(r&m0.INFINITE_MIN)&&a<0||!(r&m0.INFINITE_MAX)&&a>1)&&(Ue(n,e,Pe(n,i,a)),!0)}function GPt(t){return t}function HPt(t){return Math.abs(t[2])<Ko()}const C5=[0,0,1,0];var m0;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(m0||(m0={}));const $Be=m0.INFINITE_MIN|m0.INFINITE_MAX,LBe=m0.INFINITE_MAX,$F=Ee.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let DBe=class{constructor(){this.plane=gr(),this.origin=H(),this.basis1=H(),this.basis2=H()}};const cbe=DBe;function zg(t=bbe){return{plane:gr(t.plane),origin:An(t.origin),basis1:An(t.basis1),basis2:An(t.basis2)}}function NBe(t,e,i){const r=XBe.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=EBe(0,0,0,0),y7(r),r}function Aw(t,e=zg()){return mZ(t.origin,t.basis1,t.basis2,e)}function FBe(t,e){Ie(e.origin,t.origin),Ie(e.basis1,t.basis1),Ie(e.basis2,t.basis2),m7(e.plane,t.plane)}function mZ(t,e,i,r=zg()){return Ie(r.origin,t),Ie(r.basis1,e),Ie(r.basis2,i),y7(r),qBe(r,"fromValues()"),r}function y7(t){Y4(t.basis2,t.basis1,t.origin,t.plane)}function ube(t,e,i){t!==i&&Aw(t,i);const r=Pe(vt.get(),Ag(t),e);return Ue(i.origin,i.origin,r),i.plane[3]-=e,i}function kBe(t,e,i){return hbe(e,i),ube(i,_Z(t,t.origin),i),i}function hbe(t,e=zg()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return $e(e.origin,t[0]+i,t[1]+r,0),$e(e.basis1,i,0,0),$e(e.basis2,0,r,0),pZ(0,0,1,0,e.plane),e}function gZ(t,e,i){return!!Cw(t.plane,e,i)&&vbe(t,i)}function zBe(t,e,i){if(gZ(t,e,i))return i;const r=dbe(t,e,vt.get());return Ue(i,e.origin,Pe(vt.get(),e.direction,un(e.origin,r)/Qe(e.direction))),i}function dbe(t,e,i){const r=RL.get();_be(t,e,r,RL.get());let n=Number.POSITIVE_INFINITY;for(const s of wZ){const a=bZ(t,s,v7.get()),u=vt.get();if(OBe(r,a,u)){const p=Ng(vt.get(),e.origin,u),y=Math.abs(co(He(e.direction,p)));y<n&&(n=y,Ie(i,u))}}return n===Number.POSITIVE_INFINITY?pbe(t,e,i):i}function pbe(t,e,i){if(gZ(t,e,i))return i;const r=RL.get(),n=RL.get();_be(t,e,r,n);let s=Number.POSITIVE_INFINITY;for(const a of wZ){const u=bZ(t,a,v7.get()),p=vt.get();if(RBe(r,u,p)){const y=nBe(e,p);if(!lbe(n,p))continue;y<s&&(s=y,Ie(i,p))}}return yZ(t,e.origin)<s&&fbe(t,e.origin,i),i}function fbe(t,e,i){const r=IBe(t.plane,e,vt.get()),n=dG(nne(t,t.basis1),r,-1,1,vt.get()),s=dG(nne(t,t.basis2),r,-1,1,vt.get());return Be(i,Ue(vt.get(),n,s),t.origin),i}function mbe(t,e,i){const{origin:r,basis1:n,basis2:s}=t,a=Be(vt.get(),e,r),u=VA(n,a),p=VA(s,a),y=VA(Ag(t),a);return $e(i,u,p,y)}function yZ(t,e){const i=mbe(t,e,vt.get()),{basis1:r,basis2:n}=t,s=Qe(r),a=Qe(n),u=Math.max(Math.abs(i[0])-s,0),p=Math.max(Math.abs(i[1])-a,0),y=i[2];return u*u+p*p+y*y}function UBe(t,e){return Math.sqrt(yZ(t,e))}function jBe(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of wZ){const n=bZ(t,r,v7.get()),s=hZ(n,e);s>i&&(i=s)}return Math.sqrt(i)}function vZ(t,e){return lbe(t.plane,e)&&vbe(t,e)}function BBe(t,e,i,r){return HBe(t,i,r)}function _Z(t,e){const i=-t.plane[3];return VA(Ag(t),e)-i}function VBe(t,e,i,r){const n=_Z(t,e),s=Pe(WBe,Ag(t),i-n);return Ue(r,e,s),r}function gbe(t,e){return pa(t.basis1,e.basis1)&&pa(t.basis2,e.basis2)&&pa(t.origin,e.origin)}function ybe(t,e,i){return t!==i&&Aw(t,i),Ps(Jw,e),Hc(Jw,Jw),wt(i.basis1,t.basis1,Jw),wt(i.basis2,t.basis2,Jw),wt(i.plane,t.plane,Jw),wt(i.origin,t.origin,e),mG(i.plane,i.plane,i.origin),i}function GBe(t,e,i,r){return t!==r&&Aw(t,r),Zu(LF,e,i),wt(r.basis1,t.basis1,LF),wt(r.basis2,t.basis2,LF),y7(r),r}function Ag(t){return t.plane}function HBe(t,e,i){switch(e){case $n.X:Ie(i,t.basis1),We(i,i);break;case $n.Y:Ie(i,t.basis2),We(i,i);break;case $n.Z:Ie(i,Ag(t))}return i}function vbe(t,e){const i=Be(vt.get(),e,t.origin),r=ha(t.basis1),n=ha(t.basis2),s=He(t.basis1,i),a=He(t.basis2,i);return-s-r<0&&s-r<0&&-a-n<0&&a-n<0}function nne(t,e){const i=v7.get();return Ie(i.origin,t.origin),Ie(i.vector,e),i}function bZ(t,e,i){const{basis1:r,basis2:n,origin:s}=t,a=Pe(vt.get(),r,e.origin[0]),u=Pe(vt.get(),n,e.origin[1]);Ue(i.origin,a,u),Ue(i.origin,i.origin,s);const p=Pe(vt.get(),r,e.direction[0]),y=Pe(vt.get(),n,e.direction[1]);return Pe(i.vector,Ue(p,p,y),2),i}function qBe(t,e){Math.abs(He(t.basis1,t.basis2)/(Qe(t.basis1)*Qe(t.basis2)))>1e-6&&$F.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(He(t.basis1,Ag(t)))>1e-6&&$F.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-He(Ag(t),t.origin)-t.plane[3])>1e-6&&$F.warn(e,"Plane offset is not consistent with plane origin")}function _be(t,e,i,r){const n=Ag(t);Y4(n,e.direction,e.origin,i),Y4(i,n,e.origin,r)}const bbe={plane:gr(),origin:st(0,0,0),basis1:st(1,0,0),basis2:st(0,1,0)},RL=new kg(gr),v7=new kg(Gp),WBe=H(),XBe=new kg(()=>zg()),wZ=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Jw=Ze(),LF=Ze(),JBe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:cbe,altitudeAt:_Z,axisAt:BBe,closestPoint:pbe,closestPointOnSilhouette:dbe,copy:Aw,copyWithoutVerify:FBe,create:zg,distance:UBe,distance2:yZ,distanceToSilhouette:jBe,elevate:ube,equals:gbe,extrusionContainsPoint:vZ,fromAABoundingRect:hbe,fromValues:mZ,intersectRay:gZ,intersectRayClosestSilhouette:zBe,normal:Ag,projectPoint:fbe,projectPointLocal:mbe,rotate:GBe,setAltitudeAt:VBe,setExtent:kBe,transform:ybe,up:bbe,updateUnboundedPlane:y7,wrap:NBe},Symbol.toStringTag,{value:"Module"})),YBe=new dt(zme),sne=new dt(AD),one=new dt(OD),WPt=new dt(Ume);function wE(t){return t&&(L0(t)||Wn(t,sne))?sne:t&&(D0(t)||Wn(t,one))?one:YBe}function ZBe(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function KBe(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function QBe(t){return{operations:t,value:t.create()}}function wbe(t,e,i=QBe(t)){return i.operations=t,t.copy(e,i.value),i}function eVe(t){return wbe(wBe,tbe(0,0,0,Mr(t).radius))}const ane=2**50;function tVe(){return wbe(JBe,mZ([0,0,0],[ane,0,0],[0,ane,0]))}function iVe(t,e,i){return t.operations.axisAt(t.value,e,$n.Z,i)}function rVe(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function nVe(t,e,i){return t.operations.intersectRay(t.value,e,i)}function sVe(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function oVe(t,e){return t.operations.altitudeAt(t.value,e)}function xbe(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function aVe(t,e,i,r){return e!==r&&bs(r,e),$e(Yw,r[12],r[13],r[14]),xbe(t,Yw,i,Yw),r[12]=Yw[0],r[13]=Yw[1],r[14]=Yw[2],r}function DF(t,e,i){return t.operations.elevate(t.value,e,i.value)}const Yw=H();function lne(t,e,i,r,n){return n[0]=He(t,e),n[1]=He(t,i),n[2]=He(t,r),n}function vG(t,e,i,r,n){Ie(i,t),Ie(AM,e),We(AM,AM),qt(r,AM,i),qt(n,r,i)}function lVe(t,e){return t?wE(e):e.isGeographic?dt.PlateCarree:e}const AM=H(),xZ=96;function XPt(t,e){const i=e||t.extent,r=t.width,n=Va(i?.spatialReference);return i&&r?i.width/r*n*UJ*xZ:0}function cVe(t,e){return t/(Va(e)*UJ*xZ)}function uVe(t){return t/(UJ*xZ)}function JPt(t,e,i){return hVe(t,e)&&dVe(t,i)}function hVe(t,e){return e===0||Jy(t,e)||t<e}function dVe(t,e){return e===0||Jy(t,e)||t>e}const pVe="OBJECTID";let PS=class extends BA{constructor(e){super(e),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(Ee.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};PS=_([Z("esri.support.AnalysesCollection")],PS);const t$={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],n=this.values;return r>=i?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},NF={xsmall:544,small:768,medium:992,large:1200};function fVe(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function FF(t,e){return e?t$[t].valueToClassName[e].split(" "):[]}const mVe=t=>{let e=class extends t{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=NF}initialize(){this.addHandles(Fe(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),jr))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=fVe(i);if(!r){const n=JSON.stringify(NF,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}i=r?i:NF,this._set("breakpoints",{...i})}_updateClassNames(){if(!this.container)return;const i=Rc.acquire(),r=Rc.acquire();let n,s=!1;for(n in t$){const a=this[n],u=t$[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});a!==u&&(s=!0,this[n]=u,FF(n,a).forEach(p=>r.push(p)),FF(n,u).forEach(p=>i.push(p)))}s&&(this._applyClassNameChanges(i,r),Rc.release(i),Rc.release(r))}_applyClassNameChanges(i,r){const n=this.container;n&&(r.forEach(s=>n.classList.remove(s)),i.forEach(s=>n.classList.add(s)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in t$)FF(r,this[r]).forEach(n=>i.classList.remove(n))}};return _([T()],e.prototype,"breakpoints",null),_([T()],e.prototype,"orientation",void 0),_([T()],e.prototype,"widthBreakpoint",void 0),_([T()],e.prototype,"heightBreakpoint",void 0),e=_([Z("esri.views.BreakpointsOwner")],e),e};let Cp=class extends Ke{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,i,r={}){return this._installWatch(e,i,r,Fe)}addWhen(e,i,r={}){return this._installWatch(e,i,r,Qu)}addOnCollectionChange(e,i,{initial:r=!1,final:n=!1}={}){const s=++this._handleId;return this.addHandles([ga(e,"after-changes",this._createSyncUpdatingCallback(),$r),ga(e,"change",i,{onListenerAdd:r?a=>i({added:a.toArray(),removed:[]}):void 0,onListenerRemove:n?a=>i({added:[],removed:a.toArray()}):void 0})],s),Sr(()=>this.removeHandles(s))}addPromise(e){if(e==null)return e;const i=++this._handleId;this.addHandles(Sr(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(OM)||this._set("updating",!1))}),i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,i,r={},n){const s=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,s);const a=n(e,i,r);return this.addHandles(a,s),Sr(()=>this.removeHandles(s))}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),n=Fe(e,r,{sync:!0,equals:()=>!1});return this.addHandles(n,i),n}_createSyncUpdatingCallback(){return()=>{this.removeHandles(OM),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(yw(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(OM))}),OM)}}};_([T({readOnly:!0})],Cp.prototype,"updating",void 0),Cp=_([Z("esri.core.support.UpdatingHandles")],Cp);const OM=-42;/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(é›·å®—æ°‘) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var gVe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},Ub={exports:{}},Ls={},Z4={exports:{}},Ow={};function Tbe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function yVe(t,e,i){}function vVe(t,e,i){}var _Ve=/javascript\s*\:/img;function bVe(t,e){return _Ve.test(e)?"":e}Ow.whiteList=Tbe();Ow.getDefaultWhiteList=Tbe;Ow.onAttr=yVe;Ow.onIgnoreAttr=vVe;Ow.safeAttrValue=bVe;var wVe={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,n;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,n=t.length;r<n;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},ZE=wVe;function xVe(t,e){t=ZE.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,n=0,s=0,a="";function u(){if(!r){var b=ZE.trim(t.slice(n,s)),S=b.indexOf(":");if(S!==-1){var C=ZE.trim(b.slice(0,S)),O=ZE.trim(b.slice(S+1));if(C){var P=e(n,a.length,C,O,b);P&&(a+=P+"; ")}}}n=s+1}for(;s<i;s++){var p=t[s];if(p==="/"&&t[s+1]==="*"){var y=t.indexOf("*/",s+2);if(y===-1)break;s=y+1,n=s+1,r=!1}else p==="("?r=!0:p===")"?r=!1:p===";"?r||u():p===`
`&&u()}return ZE.trim(a)}var TVe=xVe,RM=Ow,SVe=TVe;function cne(t){return t==null}function EVe(t){var e={};for(var i in t)e[i]=t[i];return e}function Sbe(t){t=EVe(t||{}),t.whiteList=t.whiteList||RM.whiteList,t.onAttr=t.onAttr||RM.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||RM.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||RM.safeAttrValue,this.options=t}Sbe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,n=i.onAttr,s=i.onIgnoreAttr,a=i.safeAttrValue,u=SVe(t,function(p,y,b,S,C){var O=r[b],P=!1;if(O===!0?P=O:typeof O=="function"?P=O(S):O instanceof RegExp&&(P=O.test(S)),P!==!0&&(P=!1),S=a(b,S),!!S){var $={position:y,sourcePosition:p,source:C,isWhite:P};if(P){var N=n(b,S,$);return cne(N)?b+":"+S:N}else{var N=s(b,S,$);if(!cne(N))return N}}});return u};var CVe=Sbe;(function(t,e){var i=Ow,r=CVe;function n(a,u){var p=new r(u);return p.process(a)}e=t.exports=n,e.FilterCSS=r;for(var s in i)e[s]=i[s]})(Z4,Z4.exports);var TZ={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,n;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,n=t.length;r<n;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},AVe=Z4.exports.FilterCSS,OVe=Z4.exports.getDefaultWhiteList,ML=TZ;function Ebe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var Cbe=new AVe;function RVe(t,e,i){}function MVe(t,e,i){}function PVe(t,e,i){}function IVe(t,e,i){}function Abe(t){return t.replace(LVe,"&lt;").replace(DVe,"&gt;")}function $Ve(t,e,i,r){if(i=$be(i),e==="href"||e==="src"){if(i=ML.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if(MM.lastIndex=0,MM.test(i))return""}else if(e==="style"){if(une.lastIndex=0,une.test(i)||(hne.lastIndex=0,hne.test(i)&&(MM.lastIndex=0,MM.test(i))))return"";r!==!1&&(r=r||Cbe,i=r.process(i))}return i=Lbe(i),i}var LVe=/</g,DVe=/>/g,NVe=/"/g,FVe=/&quot;/g,kVe=/&#([a-zA-Z0-9]*);?/gim,zVe=/&colon;?/gim,UVe=/&newline;?/gim,MM=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,une=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,hne=/u\s*r\s*l\s*\(.*/gi;function Obe(t){return t.replace(NVe,"&quot;")}function Rbe(t){return t.replace(FVe,'"')}function Mbe(t){return t.replace(kVe,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function Pbe(t){return t.replace(zVe,":").replace(UVe," ")}function Ibe(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return ML.trim(e)}function $be(t){return t=Rbe(t),t=Mbe(t),t=Pbe(t),t=Ibe(t),t}function Lbe(t){return t=Obe(t),t=Abe(t),t}function jVe(){return""}function BVe(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(a){return i?!0:ML.indexOf(t,a)!==-1}var n=[],s=!1;return{onIgnoreTag:function(a,u,p){if(r(a))if(p.isClosing){var y="[/removed]",b=p.position+y.length;return n.push([s!==!1?s:p.position,b]),s=!1,y}else return s||(s=p.position),"[removed]";else return e(a,u,p)},remove:function(a){var u="",p=0;return ML.forEach(n,function(y){u+=a.slice(p,y[0]),p=y[1]}),u+=a.slice(p),u}}}function VVe(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var n=t.indexOf("-->",r);if(n===-1)break;i=n+3}return e}function GVe(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}Ls.whiteList=Ebe();Ls.getDefaultWhiteList=Ebe;Ls.onTag=RVe;Ls.onIgnoreTag=MVe;Ls.onTagAttr=PVe;Ls.onIgnoreTagAttr=IVe;Ls.safeAttrValue=$Ve;Ls.escapeHtml=Abe;Ls.escapeQuote=Obe;Ls.unescapeQuote=Rbe;Ls.escapeHtmlEntities=Mbe;Ls.escapeDangerHtml5Entities=Pbe;Ls.clearNonPrintableCharacter=Ibe;Ls.friendlyAttrValue=$be;Ls.escapeAttrValue=Lbe;Ls.onIgnoreTagStripAll=jVe;Ls.StripTagBody=BVe;Ls.stripCommentTag=VVe;Ls.stripBlankChar=GVe;Ls.cssFilter=Cbe;Ls.getDefaultCSSWhiteList=OVe;var _7={},yy=TZ;function HVe(t){var e=yy.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=yy.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function qVe(t){return t.slice(0,2)==="</"}function WVe(t,e,i){var r="",n=0,s=!1,a=!1,u=0,p=t.length,y="",b="";e:for(u=0;u<p;u++){var S=t.charAt(u);if(s===!1){if(S==="<"){s=u;continue}}else if(a===!1){if(S==="<"){r+=i(t.slice(n,u)),s=u,n=u;continue}if(S===">"){r+=i(t.slice(n,s)),b=t.slice(s,u+1),y=HVe(b),r+=e(s,r.length,y,b,qVe(b)),n=u+1,s=!1;continue}if(S==='"'||S==="'")for(var C=1,O=t.charAt(u-C);O.trim()===""||O==="=";){if(O==="="){a=S;continue e}O=t.charAt(u-++C)}}else if(S===a){a=!1;continue}}return n<t.length&&(r+=i(t.substr(n))),r}var XVe=/[^a-zA-Z0-9\\_:.-]/gim;function JVe(t,e){var i=0,r=0,n=[],s=!1,a=t.length;function u(C,O){if(C=yy.trim(C),C=C.replace(XVe,"").toLowerCase(),!(C.length<1)){var P=e(C,O||"");P&&n.push(P)}}for(var p=0;p<a;p++){var y=t.charAt(p),b,S;if(s===!1&&y==="="){s=t.slice(i,p),i=p+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:ZVe(t,p+1);continue}if(s!==!1&&p===r){if(S=t.indexOf(y,p+1),S===-1)break;b=yy.trim(t.slice(r+1,S)),u(s,b),s=!1,p=S,i=p+1;continue}if(/\s|\n|\t/.test(y))if(t=t.replace(/\s|\n|\t/g," "),s===!1)if(S=YVe(t,p),S===-1){b=yy.trim(t.slice(i,p)),u(b),s=!1,i=p+1;continue}else{p=S-1;continue}else if(S=KVe(t,p-1),S===-1){b=yy.trim(t.slice(i,p)),b=dne(b),u(s,b),s=!1,i=p+1;continue}else continue}return i<t.length&&(s===!1?u(t.slice(i)):u(s,dne(yy.trim(t.slice(i))))),yy.trim(n.join(" "))}function YVe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function ZVe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function KVe(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function QVe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function dne(t){return QVe(t)?t.substr(1,t.length-2):t}_7.parseTag=WVe;_7.parseAttr=JVe;var eGe=Z4.exports.FilterCSS,tp=Ls,Dbe=_7,tGe=Dbe.parseTag,iGe=Dbe.parseAttr,i$=TZ;function PM(t){return t==null}function rGe(t){var e=i$.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=i$.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=i$.trim(t.slice(0,-1))),{html:t,closing:i}}function nGe(t){var e={};for(var i in t)e[i]=t[i];return e}function sGe(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function Nbe(t){t=nGe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=tp.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=sGe(t.whiteList||t.allowList):t.whiteList=tp.whiteList,t.onTag=t.onTag||tp.onTag,t.onTagAttr=t.onTagAttr||tp.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||tp.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||tp.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||tp.safeAttrValue,t.escapeHtml=t.escapeHtml||tp.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new eGe(t.css))}Nbe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,n=i.onTag,s=i.onIgnoreTag,a=i.onTagAttr,u=i.onIgnoreTagAttr,p=i.safeAttrValue,y=i.escapeHtml,b=e.cssFilter;i.stripBlankChar&&(t=tp.stripBlankChar(t)),i.allowCommentTag||(t=tp.stripCommentTag(t));var S=!1;i.stripIgnoreTagBody&&(S=tp.StripTagBody(i.stripIgnoreTagBody,s),s=S.onIgnoreTag);var C=tGe(t,function(O,P,$,N,z){var U={sourcePosition:O,position:P,isClosing:z,isWhite:Object.prototype.hasOwnProperty.call(r,$)},j=n($,N,U);if(!PM(j))return j;if(U.isWhite){if(U.isClosing)return"</"+$+">";var G=rGe(N),q=r[$],W=iGe(G.html,function(K,se){var ae=i$.indexOf(q,K)!==-1,le=a($,K,se,ae);return PM(le)?ae?(se=p($,K,se,b),se?K+'="'+se+'"':K):(le=u($,K,se,ae),PM(le)?void 0:le):le});return N="<"+$,W&&(N+=" "+W),G.closing&&(N+=" /"),N+=">",N}else return j=s($,N,U),PM(j)?y(N):j},y);return S&&(C=S.remove(C)),C};var oGe=Nbe;(function(t,e){var i=Ls,r=_7,n=oGe;function s(u,p){var y=new n(p);return y.process(u)}e=t.exports=s,e.filterXSS=s,e.FilterXSS=n,function(){for(var u in i)e[u]=i[u];for(var p in r)e[p]=r[p]}();function a(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}a()&&(self.filterXSS=t.exports)})(Ub,Ub.exports);var aGe=function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(s,a,u,p){return s==="a"&&a==="href"||(s==="img"||s==="source")&&a==="src"?r.sanitizeUrl(u):Ub.exports.safeAttrValue(s,a,u,p)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var n;e&&!i?n=e:e&&i?(n=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(s){s==="whiteList"?n.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]):n[s]=e[s]})):(n=Object.create(this.arcgisFilterOptions),n.whiteList=this.arcgisWhiteList),this.xssFilterOptions=n,this._xssFilter=new Ub.exports.FilterXSS(n)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,n=r===void 0?!0:r,s=this._trim(e.substring(0,e.indexOf(":"))),a=e==="/",u=/^#/.test(e),p=s&&this.allowedProtocols.indexOf(s.toLowerCase())>-1;return a||u||p?Ub.exports.escapeAttrValue(e):!s&&!n?Ub.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,n){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,n):Ub.exports.safeAttrValue(e,i,r,n)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,n){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(n)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(n){Array.isArray(r[n])&&Array.isArray(i[n])?i[n]=i[n].concat(r[n]):i[n]=r[n]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var n=!1,s=void 0;if(Array.isArray(e))s=e.reduce(function(u,p){var y=r.validate(p,i);return y.isValid?u.concat([p]):(n=!0,u.concat([y.sanitized]))},[]);else if(gVe(e)){var a=Object.keys(e);s=a.reduce(function(u,p){var y=e[p],b=r.validate(y,i);return b.isValid?u[p]=y:(n=!0,u[p]=b.sanitized),u},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return n?s:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const b7=new Map;function Fbe(){b7.clear()}function lGe(t){return b7.get(t)}function cGe(t,e){b7.set(t,e)}function kF(t){b7.delete(t)}const uGe=Ee.getLogger("esri.widgets.support.widgetUtils");function hGe(t){const e=Rc.acquire();for(let r=0;r<arguments.length;r++){const n=arguments[r],s=typeof n;if(s==="string")e.push(n);else if(Array.isArray(n))e.push.apply(e,n);else if(s==="object")for(const a in n)n[a]&&e.push(a)}const i=e.join(" ");return Rc.release(e),i}(()=>{const t=new Map,e=new ResizeObserver(r=>{Fbe();for(const n of r)t.get(n.target)?.(n)}),i=(r,n,s)=>(t.has(r)&&uGe.error("Already observing element",r),t.set(r,n),e.observe(r,s),Sr(()=>{e.unobserve(r),t.delete(r)}));return(r,n,s)=>{let a=null;return nv([Fe(()=>typeof r=="function"?r():r,u=>{a?.remove(),u&&(a=i(u,n,s))},Ur),Sr(()=>a?.remove())])}})();function dGe(t){const e=t?.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function KPt(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function pne(t){const e="data-node-ref";this[t.getAttribute(e)]=t}const pGe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],fGe=pGe.reduce((t,e)=>(t[e]=[],t),{}),mGe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],kbe=new aGe({whiteList:fGe,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(mGe.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function gGe(t){return t==="Enter"||t===" "}const zbe="http://www.w3.org/",w7=`${zbe}2000/svg`,Ube=`${zbe}1999/xlink`;let fne=[],SZ=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},EZ=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),jbe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},yGe=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(EZ(t[r],e))return r}return-1},zF=(t,e,i,r)=>{let n=t[e];if(n.vnodeSelector==="")return;let s=n.properties;if(!(s&&(s.key===void 0?s.bind:s.key))){for(let a=0;a<t.length;a++)if(a!==e){let u=t[a];if(EZ(u,n))throw new Error(`${i.vnodeSelector} had a ${n.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},vGe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},_G=[],bG=!1,Bbe=t=>{(t.children||[]).forEach(Bbe),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},mne=()=>{bG=!1,_G.forEach(Bbe),_G.length=0},gne=t=>{_G.push(t),bG||(bG=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(mne,{timeout:16}):setTimeout(mne,16))},yne=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),gne(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),gne(t))},_Ge=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,n=Object.keys(e),s=n.length;for(let a=0;a<s;a++){let u=n[a],p=e[u];if(u==="className")throw new Error('Property "className" is not supported, use "class".');if(u==="class")xG(t,p,!0);else if(u==="classes"){let y=Object.keys(p),b=y.length;for(let S=0;S<b;S++){let C=y[S];p[C]&&t.classList.add(C)}}else if(u==="styles"){let y=Object.keys(p),b=y.length;for(let S=0;S<b;S++){let C=y[S],O=p[C];O&&(jbe(O),i.styleApplyer(t,C,O))}}else if(u!=="key"&&p!=null){let y=typeof p;y==="function"?(u.lastIndexOf("on",0)===0&&(r&&(p=r(u,p,t,e)),u==="oninput"&&function(){let b=p;p=function(S){b.apply(this,[S]),S.target["oninput-value"]=S.target.value}}()),t[u]=p):i.namespace===w7?u==="href"?t.setAttributeNS(Ube,u,p):t.setAttribute(u,p):y==="string"&&u!=="value"?u==="innerHTML"?t[u]=kbe.sanitize(p):wG(t)&&u in t?t[u]=p:t.setAttribute(u,p):t[u]=p}}};function wG(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let PL,bGe=(t,e,i)=>{if(e)for(let r of e)pT(r,t,void 0,i)},Vbe=(t,e,i)=>{bGe(t,e.children,i),e.text&&(t.textContent=e.text),_Ge(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},pT=(t,e,i,r)=>{let n,s=0,a=t.vnodeSelector,u=e.ownerDocument;if(a==="")n=t.domNode=u.createTextNode(t.text),i!==void 0?e.insertBefore(n,i):e.appendChild(n);else{for(let p=0;p<=a.length;++p){let y=a.charAt(p);if(p===a.length||y==="."||y==="#"){let b=a.charAt(s-1),S=a.slice(s,p);b==="."?n.classList.add(S):b==="#"?n.id=S:(S==="svg"&&(r=SZ(r,{namespace:w7})),r.namespace!==void 0?n=t.domNode=u.createElementNS(r.namespace,S):(n=t.domNode=t.domNode||u.createElement(S),S==="input"&&t.properties&&t.properties.type!==void 0&&n.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(n,i):n.parentNode!==e&&e.appendChild(n)),s=p+1}}Vbe(n,t,r)}},xG=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},wGe=(t,e,i,r)=>{if(!i)return;let n=!1,s=Object.keys(i),a=s.length;for(let u=0;u<a;u++){let p=s[u],y=i[p],b=e[p];if(p==="class")b!==y&&(xG(t,b,!1),xG(t,y,!0));else if(p==="classes"){let S=t.classList,C=Object.keys(y),O=C.length;for(let P=0;P<O;P++){let $=C[P],N=!!y[$];N!==!!b[$]&&(n=!0,N?S.add($):S.remove($))}}else if(p==="styles"){let S=Object.keys(y),C=S.length;for(let O=0;O<C;O++){let P=S[O],$=y[P];$!==b[P]&&(n=!0,$?(jbe($),r.styleApplyer(t,P,$)):r.styleApplyer(t,P,""))}}else if(y||typeof b!="string"||(y=""),p!=="value"||wG(t)){if(y!==b){let S=typeof y;S==="function"&&r.eventHandlerInterceptor||(r.namespace===w7?p==="href"?t.setAttributeNS(Ube,p,y):t.setAttribute(p,y):S==="string"?p==="innerHTML"?t[p]=kbe.sanitize(y):p==="role"&&y===""?t.removeAttribute(p):wG(t)&&p in t?t[p]=y:t.setAttribute(p,y):t[p]!==y&&(t[p]=y),n=!0)}}else{let S=t[p];S!==y&&(t["oninput-value"]?S===t["oninput-value"]:y!==b)&&(t[p]=y,t["oninput-value"]=void 0),y!==b&&(n=!0)}}return n},xGe=(t,e,i,r,n)=>{if(i===r)return!1;r=r||fne;let s,a=(i=i||fne).length,u=r.length,p=0,y=0,b=!1;for(;y<u;){let S=p<a?i[p]:void 0,C=r[y];if(S!==void 0&&EZ(S,C))b=PL(S,C,n)||b,p++;else{let O=yGe(i,C,p+1);if(O>=0){for(s=p;s<O;s++)yne(i[s]),zF(i,s,t,"removed");b=PL(i[O],C,n)||b,p=O+1}else pT(C,e,p<a?i[p].domNode:void 0,n),vGe(C),zF(r,y,t,"added")}y++}if(a>p)for(s=p;s<a;s++)yne(i[s]),zF(i,s,t,"removed");return b};PL=(t,e,i)=>{let r=t.domNode,n=!1;if(t===e)return!1;let s=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let a=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(a,r),e.domNode=a,n=!0,n}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=SZ(i,{namespace:w7})),t.text!==e.text&&(s=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,s=xGe(e,r,t.children,e.children,i)||s,s=wGe(r,t.properties,e.properties,i)||s,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return s&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),n};let KE=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,PL(r,i,e)},domNode:t.domNode});const TGe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let _x=t=>SZ(TGe,t),jy={create:(t,e)=>(e=_x(e),pT(t,document.createElement("div"),void 0,e),KE(t,e)),append:(t,e,i)=>(i=_x(i),pT(e,t,void 0,i),KE(e,i)),insertBefore:(t,e,i)=>(i=_x(i),pT(e,t.parentNode,t,i),KE(e,i)),merge:(t,e,i)=>(i=_x(i),e.domNode=t,Vbe(t,e,i),KE(e,i)),replace:(t,e,i)=>(i=_x(i),pT(e,t.parentNode,t,i),t.parentNode.removeChild(t),KE(e,i))},Gbe,SGe=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};Gbe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let EGe=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?Gbe(i.children,n=>n.domNode===r):void 0}),i},CGe=(t,e,i)=>{let r=function(n){i("domEvent",n);let s=e(),a=SGe(n.currentTarget,s.domNode);a.reverse();let u,p=EGe(s.getLastRender(),a);return t.scheduleRender(),p&&(u=p.properties[`on${n.type}`].apply(p.properties.bind||this,arguments)),i("domEventProcessed",n),u};return(n,s,a,u)=>r},vne=t=>{let e,i,r=_x(t),n=r.performanceLogger,s=!0,a=!1,u=[],p=[],y=(S,C,O)=>{let P,$=()=>P;r.eventHandlerInterceptor=CGe(e,$,n),P=S(C,O(),r),u.push(P),p.push(O)},b=()=>{if(i=void 0,s){s=!1,n("renderStart",void 0);for(let S=0;S<u.length;S++){let C=p[S]();n("rendered",void 0),u[S].update(C),n("patched",void 0)}n("renderDone",void 0),s=!0}};return e={renderNow:b,scheduleRender:()=>{i||a||(i=requestAnimationFrame(b))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),a=!0},resume:()=>{a=!1,s=!0,e.scheduleRender()},append:(S,C)=>{y(jy.append,S,C)},insertBefore:(S,C)=>{y(jy.insertBefore,S,C)},merge:(S,C)=>{y(jy.merge,S,C)},replace:(S,C)=>{y(jy.replace,S,C)},detach:S=>{for(let C=0;C<p.length;C++)if(p[C]===S)return p.splice(C,1),u.splice(C,1)[0];throw new Error("renderFunction was not found")}},e},Z1=class extends Ke{constructor(){super(...arguments),this.items=new Dt,this._watchUpdatingTracking=new Cp,this._callbacks=new Map,this._projector=vne(),this._hiddenProjector=vne()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const n=()=>r.render();this._callbacks.set(r,n),this._projector.append(this.surface,n)}for(const r of i.removed){const n=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(n.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let n;const s=()=>(n=e.render(),n);r.append(i,s),r.renderNow();const a={left:0,top:0,right:0,bottom:0};if(n?.domNode){const u=n.domNode.getBoundingClientRect();a.left=u.left,a.top=u.top,a.right=u.right,a.bottom=u.bottom}for(r.detach(s);i.firstChild;)i.removeChild(i.firstChild);return a}overlaps(e,i){const r=this.computeBoundingRect(e),n=this.computeBoundingRect(i);return Math.max(r.left,n.left)<=Math.min(r.right,n.right)&&Math.max(r.top,n.top)<=Math.min(r.bottom,n.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,i){const r=!!i?.disableDecorations;if(!this.items.some(s=>s.visible&&!(r&&s.isDecoration)))return;const n=e.getContext("2d");n.save(),n.font=this._fontString(),this.items.forEach(s=>{r&&s.isDecoration||(n.save(),s.renderCanvas(n),n.restore())}),n.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};_([T({readOnly:!0})],Z1.prototype,"surface",void 0),_([T({readOnly:!0})],Z1.prototype,"items",void 0),_([T({readOnly:!0})],Z1.prototype,"needsRender",null),_([T({readOnly:!0})],Z1.prototype,"_watchUpdatingTracking",void 0),_([T({readOnly:!0})],Z1.prototype,"updating",null),Z1=_([Z("esri.views.overlay.ViewOverlay")],Z1);const _ne=Z1,UF=[0,0];function AGe(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return UF[0]=i.left+(e?.pageXOffset??0),UF[1]=i.top+(e?.pageYOffset??0),UF}function bne(t){t&&(S_e(t),t.parentNode&&t.parentNode.removeChild(t))}function OGe(t){const e=document.createElement("div");return t.appendChild(e),e}const QE=16,IM=750,RGe=512,MGe=2,PGe=t=>{let e=class extends t{constructor(...i){super(...i),this._freqInfo={freq:QE,time:IM},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([Fe(()=>this.cursor,r=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",r)}),Fe(()=>this.navigating,r=>{const{surface:n}=this;n&&n.setAttribute("data-navigating",r.toString())})])}initialize(){const i=Me("mac"),r=async()=>{i&&(await gS(()=>this.ready),this.messagesCommon=await HJ("esri/t9n/common").catch(()=>{}))};r(),this.addHandles([Fe(()=>this.ui,(n,s)=>this._handleUIChange(n,s),jr),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused")),BJ(r)])}destroy(){this.destroyed||(this.ui=ct(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),n=u7(i);if(n||typeof i!="string"||Ee.getLogger(this).error("#container",`element with id '${i}' not found`),r===n)return;if(this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(bne(this.root),this._set("root",null)),this.userContent&&(Vre(this.userContent,r),bne(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const s=document.createElement("div");s.className="esri-view-user-storage",Vre(n,s),n.appendChild(s),this._set("userContent",s);const a=document.createElement("div");a.className="esri-view-root",n.insertBefore(a,n.firstChild),this._set("root",a);const u=document.createElement("div");u.className="esri-view-surface",u.setAttribute("role","application"),u.tabIndex=0,a.appendChild(u),this._set("surface",u);const p=new _ne;a.appendChild(p.surface),this._set("overlay",p),this.addHandles(Fe(()=>p.needsRender,y=>{y&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=$2({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=nn(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",n),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(i,r,n){const s=this.position;return i-=s?s[0]:0,r-=s?s[1]:0,n?(n[0]=i,n[1]=r):n=[i,r],n}containerToPage(i,r,n){const s=this.position;return i+=s?s[0]:0,r+=s?s[1]:0,n?(n[0]=i,n[1]=r):n=[i,r],n}_handleUIChange(i,r){this.removeHandles("ui"),r&&r!==i&&r.destroy(),i&&(i.view=this,this.addHandles(Fe(()=>this.root,n=>{i.container=n?OGe(n):null},jr),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=QE,i.time=IM,this.addHandles([lg(window,"resize",()=>{i.freq=QE,i.time=IM}),$2({prepare:r=>{const n=this._measure(),s=this._freqInfo;if(s.time+=r.deltaTime,n&&(s.freq=QE,this._get("resizing")||this._set("resizing",!0)),s.time<s.freq)return;s.time=0;const a=this._position();s.freq=a||n?QE:Math.min(IM,s.freq*MGe),!n&&s.freq>=RGe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,n=i?i.clientHeight:0;if(r===0||n===0)return this.suspended||this._set("suspended",!0),!1;const s=this.width,a=this.height;return r===s&&n===a?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:a,width:r,height:n}),!0)}_position(){const i=this.container,r=this.position,n=i&&AGe(i);return!!n&&(!r||n[0]!==r[0]||n[1]!==r[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return _([T()],e.prototype,"container",null),_([T({readOnly:!0})],e.prototype,"focused",null),_([T({readOnly:!0})],e.prototype,"height",void 0),_([T()],e.prototype,"messagesCommon",void 0),_([T({type:_ne})],e.prototype,"overlay",void 0),_([T({readOnly:!0})],e.prototype,"position",void 0),_([T({readOnly:!0})],e.prototype,"resizing",void 0),_([T({readOnly:!0})],e.prototype,"root",void 0),_([T({value:null,readOnly:!0})],e.prototype,"size",null),_([T({readOnly:!0})],e.prototype,"surface",void 0),_([T({readOnly:!0})],e.prototype,"suspended",void 0),_([T()],e.prototype,"ui",void 0),_([T({readOnly:!0})],e.prototype,"userContent",void 0),_([T({readOnly:!0})],e.prototype,"width",void 0),_([T()],e.prototype,"widthBreakpoint",void 0),e=_([Z("esri.views.DOMContainer")],e),e};function kv(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}async function IL(t,e,i,r,n){r??(r=0);const s=t.spatialReference;if($p(s,i)||s==null||i==null||Wn(s,i))return $M[0]=t.x,$M[1]=t.y,$M[2]=t.z??r,void Mn($M,t.spatialReference,0,e,i,0,1);const a=kv(t.x,t.y,t.z??r,s),u=await C0(a,i,n);e[0]=u.x,e[1]=u.y,e[2]=u.z??0}const $M=H();function Og(t,e,i){if(e==null||i==null)return null;const r=new Wt({spatialReference:i});return Mn(t,e,0,LM,i,0,1)?(r.x=LM[0],r.y=LM[1],r.z=LM[2],r):null}const LM=H();async function Hbe(t,e,i,r){const n=Og(t,e,i);if(n!=null)return n;const s=new Wt({x:t[0],y:t[1],z:t[2],spatialReference:e,hasZ:!0});return C0(s,i,r)}var En,Jo;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(En||(En={}));let IGe=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Jo.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Jo||(Jo={}));let $Ge=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.triangleNr=r}},LGe=class extends $Ge{constructor(e,i,r,n){super(e,i,r),this.center=n!=null?An(n):null}},qbe=class{constructor(e){this.layerUid=e}},x7=class extends qbe{constructor(e,i){super(e),this.graphicUid=i}};function Hp(t){return t?.dist!=null}function wne(t){return(e,i,r)=>(Ir(xne,e,i,r),!vZ(t,xne))}function T7(t){return Hp(t)&&t.intersector===En.OBJECT&&!!t.target}function S7(t){return Hp(t)&&t.intersector===En.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const xne=H();function sd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function DGe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function CZ(t,e,i,r,n,s,a,u,p,y){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=a,t[6]=u,t[7]=p,t[8]=y,t}function AZ(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function od(t,e){if(t===e){const i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Rw(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],u=e[5],p=e[6],y=e[7],b=e[8],S=b*a-u*y,C=-b*s+u*p,O=y*s-a*p;let P=i*S+r*C+n*O;return P?(P=1/P,t[0]=S*P,t[1]=(-b*r+n*y)*P,t[2]=(u*r-n*a)*P,t[3]=C*P,t[4]=(b*i-n*p)*P,t[5]=(-u*i+n*s)*P,t[6]=O*P,t[7]=(-y*i+r*p)*P,t[8]=(a*i-r*s)*P,t):null}function NGe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],u=e[5],p=e[6],y=e[7],b=e[8];return t[0]=a*b-u*y,t[1]=n*y-r*b,t[2]=r*u-n*a,t[3]=u*p-s*b,t[4]=i*b-n*p,t[5]=n*s-i*u,t[6]=s*y-a*p,t[7]=r*p-i*y,t[8]=i*a-r*s,t}function FGe(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],a=t[5],u=t[6],p=t[7],y=t[8];return e*(y*s-a*p)+i*(-y*n+a*u)+r*(p*n-s*u)}function IS(t,e,i){const r=e[0],n=e[1],s=e[2],a=e[3],u=e[4],p=e[5],y=e[6],b=e[7],S=e[8],C=i[0],O=i[1],P=i[2],$=i[3],N=i[4],z=i[5],U=i[6],j=i[7],G=i[8];return t[0]=C*r+O*a+P*y,t[1]=C*n+O*u+P*b,t[2]=C*s+O*p+P*S,t[3]=$*r+N*a+z*y,t[4]=$*n+N*u+z*b,t[5]=$*s+N*p+z*S,t[6]=U*r+j*a+G*y,t[7]=U*n+j*u+G*b,t[8]=U*s+j*p+G*S,t}function $L(t,e,i){const r=e[0],n=e[1],s=e[2],a=e[3],u=e[4],p=e[5],y=e[6],b=e[7],S=e[8],C=i[0],O=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=a,t[4]=u,t[5]=p,t[6]=C*r+O*a+y,t[7]=C*n+O*u+b,t[8]=C*s+O*p+S,t}function OZ(t,e,i){const r=e[0],n=e[1],s=e[2],a=e[3],u=e[4],p=e[5],y=e[6],b=e[7],S=e[8],C=Math.sin(i),O=Math.cos(i);return t[0]=O*r+C*a,t[1]=O*n+C*u,t[2]=O*s+C*p,t[3]=O*a-C*r,t[4]=O*u-C*n,t[5]=O*p-C*s,t[6]=y,t[7]=b,t[8]=S,t}function RZ(t,e,i){const r=i[0],n=i[1],s=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=s*e[6],t[7]=s*e[7],t[8]=s*e[8],t}function kGe(t,e,i){const r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t}function zGe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function UGe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function jGe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function BGe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function MZ(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],a=i+i,u=r+r,p=n+n,y=i*a,b=r*a,S=r*u,C=n*a,O=n*u,P=n*p,$=s*a,N=s*u,z=s*p;return t[0]=1-S-P,t[3]=b-z,t[6]=C+N,t[1]=b+z,t[4]=1-y-P,t[7]=O-$,t[2]=C-N,t[5]=O+$,t[8]=1-y-S,t}function Wbe(t,e){const i=e[0],r=e[1],n=e[2],s=e[4],a=e[5],u=e[6],p=e[8],y=e[9],b=e[10],S=b*a-u*y,C=-b*s+u*p,O=y*s-a*p,P=i*S+r*C+n*O;if(!P)return null;const $=1/P;return t[0]=S*$,t[1]=(-b*r+n*y)*$,t[2]=(u*r-n*a)*$,t[3]=C*$,t[4]=(b*i-n*p)*$,t[5]=(-u*i+n*s)*$,t[6]=O*$,t[7]=(-y*i+r*p)*$,t[8]=(a*i-r*s)*$,t}function Rg(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],u=e[5],p=e[6],y=e[7],b=e[8],S=e[9],C=e[10],O=e[11],P=e[12],$=e[13],N=e[14],z=e[15],U=i*u-r*a,j=i*p-n*a,G=i*y-s*a,q=r*p-n*u,W=r*y-s*u,K=n*y-s*p,se=b*$-S*P,ae=b*N-C*P,le=b*z-O*P,me=S*N-C*$,ne=S*z-O*$,pe=C*z-O*N;let ge=U*pe-j*ne+G*me+q*le-W*ae+K*se;return ge?(ge=1/ge,t[0]=(u*pe-p*ne+y*me)*ge,t[1]=(p*le-a*pe-y*ae)*ge,t[2]=(a*ne-u*le+y*se)*ge,t[3]=(n*ne-r*pe-s*me)*ge,t[4]=(i*pe-n*le+s*ae)*ge,t[5]=(r*le-i*ne-s*se)*ge,t[6]=($*K-N*W+z*q)*ge,t[7]=(N*G-P*K-z*j)*ge,t[8]=(P*W-$*G+z*U)*ge,t):null}function VGe(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function GGe(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function HGe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function qGe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function Xbe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function WGe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function XGe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function JGe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function YGe(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],u=t[5],p=t[6],y=t[7],b=t[8],S=e[0],C=e[1],O=e[2],P=e[3],$=e[4],N=e[5],z=e[6],U=e[7],j=e[8],G=Ko();return Math.abs(i-S)<=G*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(r-C)<=G*Math.max(1,Math.abs(r),Math.abs(C))&&Math.abs(n-O)<=G*Math.max(1,Math.abs(n),Math.abs(O))&&Math.abs(s-P)<=G*Math.max(1,Math.abs(s),Math.abs(P))&&Math.abs(a-$)<=G*Math.max(1,Math.abs(a),Math.abs($))&&Math.abs(u-N)<=G*Math.max(1,Math.abs(u),Math.abs(N))&&Math.abs(p-z)<=G*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(y-U)<=G*Math.max(1,Math.abs(y),Math.abs(U))&&Math.abs(b-j)<=G*Math.max(1,Math.abs(b),Math.abs(j))}function PZ(t){const e=Ko(),i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],u=t[5],p=t[6],y=t[7],b=t[8];return Math.abs(1-(i*i+s*s+p*p))<=e&&Math.abs(1-(r*r+a*a+y*y))<=e&&Math.abs(1-(n*n+u*u+b*b))<=e}const ZGe=IS,KGe=Xbe;Object.freeze(Object.defineProperty({__proto__:null,add:qGe,adjoint:NGe,copy:DGe,determinant:FGe,equals:YGe,exactEquals:JGe,frob:HGe,fromMat2d:BGe,fromMat4:sd,fromQuat:MZ,fromRotation:UGe,fromScaling:jGe,fromTranslation:zGe,identity:AZ,invert:Rw,isOrthoNormal:PZ,mul:ZGe,multiply:IS,multiplyScalar:WGe,multiplyScalarAndAdd:XGe,normalFromMat4:Rg,normalFromMat4Legacy:Wbe,projection:VGe,rotate:OZ,scale:RZ,scaleByVec2:kGe,set:CZ,str:GGe,sub:KGe,subtract:Xbe,translate:$L,transpose:od},Symbol.toStringTag,{value:"Module"}));function QGe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function K4(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function IZ(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>Ko()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function $Z(t,e,i){const r=e[0],n=e[1],s=e[2],a=e[3],u=i[0],p=i[1],y=i[2],b=i[3];return t[0]=r*b+a*u+n*y-s*p,t[1]=n*b+a*p+s*u-r*y,t[2]=s*b+a*y+r*p-n*u,t[3]=a*b-r*u-n*p-s*y,t}function eHe(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],a=e[3],u=Math.sin(i),p=Math.cos(i);return t[0]=r*p+a*u,t[1]=n*p+s*u,t[2]=s*p-n*u,t[3]=a*p-r*u,t}function tHe(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],a=e[3],u=Math.sin(i),p=Math.cos(i);return t[0]=r*p-s*u,t[1]=n*p+a*u,t[2]=s*p+r*u,t[3]=a*p-n*u,t}function iHe(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],a=e[3],u=Math.sin(i),p=Math.cos(i);return t[0]=r*p+n*u,t[1]=n*p-r*u,t[2]=s*p+a*u,t[3]=a*p-s*u,t}function rHe(t,e){const i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t}function r$(t,e,i,r){const n=e[0],s=e[1],a=e[2],u=e[3];let p,y,b,S,C,O=i[0],P=i[1],$=i[2],N=i[3];return y=n*O+s*P+a*$+u*N,y<0&&(y=-y,O=-O,P=-P,$=-$,N=-N),1-y>Ko()?(p=Math.acos(y),b=Math.sin(p),S=Math.sin((1-r)*p)/b,C=Math.sin(r*p)/b):(S=1-r,C=r),t[0]=S*n+C*O,t[1]=S*s+C*P,t[2]=S*a+C*$,t[3]=S*u+C*N,t}function nHe(t){const e=qO,i=e(),r=e(),n=e(),s=Math.sqrt(1-i),a=Math.sqrt(i);return t[0]=s*Math.sin(2*Math.PI*r),t[1]=s*Math.cos(2*Math.PI*r),t[2]=a*Math.sin(2*Math.PI*n),t[3]=a*Math.cos(2*Math.PI*n),t}function sHe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],a=i*i+r*r+n*n+s*s,u=a?1/a:0;return t[0]=-i*u,t[1]=-r*u,t[2]=-n*u,t[3]=s*u,t}function Y2(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Jbe(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const s=(n+1)%3,a=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*a+a]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*s+a]-e[3*a+s])*r,t[s]=(e[3*s+n]+e[3*n+s])*r,t[a]=(e[3*a+n]+e[3*n+a])*r}return t}function oHe(t,e,i,r){const n=.5*Math.PI/180;e*=n,i*=n,r*=n;const s=Math.sin(e),a=Math.cos(e),u=Math.sin(i),p=Math.cos(i),y=Math.sin(r),b=Math.cos(r);return t[0]=s*p*b-a*u*y,t[1]=a*u*b+s*p*y,t[2]=a*p*y-s*u*b,t[3]=a*p*b+s*u*y,t}function aHe(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const LZ=mp,lHe=_n,cHe=YJ,uHe=$Z,hHe=B2,dHe=vge,pHe=DD,Ybe=ZJ,fHe=Ybe,Zbe=KJ,mHe=Zbe,DZ=yge,gHe=IT,yHe=V2;function vHe(t,e,i){const r=He(e,i);return r<-.999999?(qt(Kp,_He,e),Sc(Kp)<1e-6&&qt(Kp,bHe,e),We(Kp,Kp),K4(t,Kp,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(qt(Kp,e,i),t[0]=Kp[0],t[1]=Kp[1],t[2]=Kp[2],t[3]=1+r,DZ(t,t))}const Kp=H(),_He=st(1,0,0),bHe=st(0,1,0);function wHe(t,e,i,r,n,s){return r$(Tne,e,n,s),r$(Sne,i,r,s),r$(t,Tne,Sne,2*s*(1-s)),t}const Tne=pd(),Sne=pd();function xHe(t,e,i,r){const n=THe;return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],DZ(t,Jbe(t,n))}const THe=Pn();Object.freeze(Object.defineProperty({__proto__:null,add:cHe,calculateW:rHe,conjugate:Y2,copy:LZ,dot:dHe,equals:yHe,exactEquals:gHe,fromEuler:oHe,fromMat3:Jbe,getAxisAngle:IZ,identity:QGe,invert:sHe,len:fHe,length:Ybe,lerp:pHe,mul:uHe,multiply:$Z,normalize:DZ,random:nHe,rotateX:eHe,rotateY:tHe,rotateZ:iHe,rotationTo:vHe,scale:hHe,set:lHe,setAxes:xHe,setAxisAngle:K4,slerp:r$,sqlerp:wHe,sqrLen:mHe,squaredLength:Zbe,str:aHe},Symbol.toStringTag,{value:"Module"}));let cR=class{constructor(e,i,r=i){this.data=e,this.size=i,this.stride=r}},Et=class extends cR{constructor(e,i,r,n=!1,s=r){super(e,r,s),this.indices=i,this.exclusive=n}};const $S=1e-6,eC=[0,0,0],DM=[0,0,0];function SHe(t,e){const{data:i,size:r}=t,n=i.length/r;if(n<=0)return;const s=new $He(t);n$(eC,s.minProj,s.maxProj),jb(eC,eC,.5),Dh(DM,s.maxProj,s.minProj);const a=TG(DM),u=new LHe;u.quality=a,n<14&&(t=new cR(new Float64Array(s.buffer,112,42),3));const p=[0,0,0],y=[0,0,0],b=[0,0,0],S=[0,0,0],C=[0,0,0],O=[0,0,0],P=[0,0,0];switch(EHe(s,t,P,p,y,b,S,C,O,u)){case 1:return void One(eC,DM,e);case 2:return void IHe(t,S,e)}CHe(t,P,p,y,b,S,C,O,u),Kbe(t,u.b0,u.b1,u.b2,DT,NT);const $=[0,0,0];Dh($,NT,DT),u.quality=TG($),u.quality<a?Qbe(u.b0,u.b1,u.b2,DT,NT,$,e):One(eC,DM,e)}function EHe(t,e,i,r,n,s,a,u,p,y){return AHe(t,r,n),SG(r,n)<$S?1:(Dh(a,r,n),aa(a,a),OHe(e,r,a,s)<$S?2:(Dh(u,n,s),aa(u,u),Dh(p,s,r),aa(p,p),Nh(i,u,a),aa(i,i),eb(e,i,a,u,p,y),0))}const tC=[0,0,0],iC=[0,0,0],nh=[0,0,0],sh=[0,0,0],oh=[0,0,0],a1=[0,0,0],l1=[0,0,0],c1=[0,0,0];function CHe(t,e,i,r,n,s,a,u,p){RHe(t,e,i,tC,iC),tC[0]!==void 0&&(Dh(nh,tC,i),aa(nh,nh),Dh(sh,tC,r),aa(sh,sh),Dh(oh,tC,n),aa(oh,oh),Nh(a1,sh,s),aa(a1,a1),Nh(l1,oh,a),aa(l1,l1),Nh(c1,nh,u),aa(c1,c1),eb(t,a1,s,sh,nh,p),eb(t,l1,a,oh,sh,p),eb(t,c1,u,nh,oh,p)),iC[0]!==void 0&&(Dh(nh,iC,i),aa(nh,nh),Dh(sh,iC,r),aa(sh,sh),Dh(oh,iC,n),aa(oh,oh),Nh(a1,sh,s),aa(a1,a1),Nh(l1,oh,a),aa(l1,l1),Nh(c1,nh,u),aa(c1,c1),eb(t,a1,s,sh,nh,p),eb(t,l1,a,oh,sh,p),eb(t,c1,u,nh,oh,p))}function AHe(t,e,i){let r=SG(t.maxVert[0],t.minVert[0]),n=0;for(let s=1;s<7;++s){const a=SG(t.maxVert[s],t.minVert[s]);a>r&&(r=a,n=s)}Fc(e,t.minVert[n]),Fc(i,t.maxVert[n])}const ah=[0,0,0];function OHe(t,e,i,r){const{data:n,size:s}=t;let a=Number.NEGATIVE_INFINITY,u=0;for(let p=0;p<n.length;p+=s){ah[0]=n[p]-e[0],ah[1]=n[p+1]-e[1],ah[2]=n[p+2]-e[2];const y=i[0]*ah[0]+i[1]*ah[1]+i[2]*ah[2],b=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],S=ah[0]*ah[0]+ah[1]*ah[1]+ah[2]*ah[2]-y*y/b;S>a&&(a=S,u=p)}return Fc(r,n,u),a}const no=[0,0];function RHe(t,e,i,r,n){PHe(t,e,no,n,r);const s=t2e(i,e);no[1]-$S<=s&&(r[0]=void 0),no[0]+$S>=s&&(n[0]=void 0)}const Ene=[0,0,0],Cne=[0,0,0],Ane=[0,0,0],Zw=[0,0,0],Kw=[0,0,0],NM=[0,0,0];function eb(t,e,i,r,n,s){if(e2e(e)<$S)return;Nh(Ene,i,e),Nh(Cne,r,e),Nh(Ane,n,e),LT(t,e,no),Kw[1]=no[0],Zw[1]=no[1],NM[1]=Zw[1]-Kw[1];const a=[i,r,n],u=[Ene,Cne,Ane];for(let p=0;p<3;++p){LT(t,a[p],no),Kw[0]=no[0],Zw[0]=no[1],LT(t,u[p],no),Kw[2]=no[0],Zw[2]=no[1],NM[0]=Zw[0]-Kw[0],NM[2]=Zw[2]-Kw[2];const y=TG(NM);y<s.quality&&(Fc(s.b0,a[p]),Fc(s.b1,e),Fc(s.b2,u[p]),s.quality=y)}}const MHe=[0,0,0];function LT(t,e,i){const{data:r,size:n}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<r.length;s+=n){const a=r[s]*e[0]+r[s+1]*e[1]+r[s+2]*e[2];i[0]=Math.min(i[0],a),i[1]=Math.max(i[1],a)}}function PHe(t,e,i,r,n){const{data:s,size:a}=t;Fc(r,s),Fc(n,r),i[0]=t2e(MHe,e),i[1]=i[0];for(let u=a;u<s.length;u+=a){const p=s[u]*e[0]+s[u+1]*e[1]+s[u+2]*e[2];p<i[0]&&(i[0]=p,Fc(r,s,u)),p>i[1]&&(i[1]=p,Fc(n,s,u))}}function One(t,e,i){Fc(i.center,t),jb(i.halfSize,e,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const Z0=[0,0,0],Qw=[0,0,0],rC=[0,0,0],DT=[0,0,0],NT=[0,0,0],Rne=[0,0,0];function IHe(t,e,i){Fc(Z0,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Z0[0]=0:Math.abs(e[1])>Math.abs(e[2])?Z0[1]=0:Z0[2]=0,e2e(Z0)<$S&&(Z0[0]=Z0[1]=Z0[2]=1),Nh(Qw,e,Z0),aa(Qw,Qw),Nh(rC,e,Qw),aa(rC,rC),Kbe(t,e,Qw,rC,DT,NT),Dh(Rne,NT,DT),Qbe(e,Qw,rC,DT,NT,Rne,i)}function Kbe(t,e,i,r,n,s){LT(t,e,no),n[0]=no[0],s[0]=no[1],LT(t,i,no),n[1]=no[0],s[1]=no[1],LT(t,r,no),n[2]=no[0],s[2]=no[1]}const FM=[0,0,0],Qp=[1,0,0,0,1,0,0,0,1],e3=[0,0,0];function Qbe(t,e,i,r,n,s,a){Qp[0]=t[0],Qp[1]=t[1],Qp[2]=t[2],Qp[3]=e[0],Qp[4]=e[1],Qp[5]=e[2],Qp[6]=i[0],Qp[7]=i[1],Qp[8]=i[2],DHe(a.quaternion,Qp),n$(e3,r,n),jb(e3,e3,.5),jb(a.center,t,e3[0]),jb(FM,e,e3[1]),n$(a.center,a.center,FM),jb(FM,i,e3[2]),n$(a.center,a.center,FM),jb(a.halfSize,s,.5)}const eu=7;let $He=class{constructor(e){this.minVert=new Array(eu),this.maxVert=new Array(eu);const i=64*eu;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,eu),r+=8*eu,this.maxProj=new Float64Array(this.buffer,r,eu),r+=8*eu;for(let p=0;p<eu;++p)this.minVert[p]=new Float64Array(this.buffer,r,3),r+=24;for(let p=0;p<eu;++p)this.maxVert[p]=new Float64Array(this.buffer,r,3),r+=24;for(let p=0;p<eu;++p)this.minProj[p]=Number.POSITIVE_INFINITY,this.maxProj[p]=Number.NEGATIVE_INFINITY;const n=new Array(eu),s=new Array(eu),{data:a,size:u}=e;for(let p=0;p<a.length;p+=u){let y=a[p];y<this.minProj[0]&&(this.minProj[0]=y,n[0]=p),y>this.maxProj[0]&&(this.maxProj[0]=y,s[0]=p),y=a[p+1],y<this.minProj[1]&&(this.minProj[1]=y,n[1]=p),y>this.maxProj[1]&&(this.maxProj[1]=y,s[1]=p),y=a[p+2],y<this.minProj[2]&&(this.minProj[2]=y,n[2]=p),y>this.maxProj[2]&&(this.maxProj[2]=y,s[2]=p),y=a[p]+a[p+1]+a[p+2],y<this.minProj[3]&&(this.minProj[3]=y,n[3]=p),y>this.maxProj[3]&&(this.maxProj[3]=y,s[3]=p),y=a[p]+a[p+1]-a[p+2],y<this.minProj[4]&&(this.minProj[4]=y,n[4]=p),y>this.maxProj[4]&&(this.maxProj[4]=y,s[4]=p),y=a[p]-a[p+1]+a[p+2],y<this.minProj[5]&&(this.minProj[5]=y,n[5]=p),y>this.maxProj[5]&&(this.maxProj[5]=y,s[5]=p),y=a[p]-a[p+1]-a[p+2],y<this.minProj[6]&&(this.minProj[6]=y,n[6]=p),y>this.maxProj[6]&&(this.maxProj[6]=y,s[6]=p)}for(let p=0;p<eu;++p){let y=n[p];Fc(this.minVert[p],a,y),y=s[p],Fc(this.maxVert[p],a,y)}}},LHe=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function TG(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function n$(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function Dh(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function jb(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function Fc(t,e,i=0){t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2]}function Nh(t,e,i){const r=e[0],n=e[1],s=e[2],a=i[0],u=i[1],p=i[2];t[0]=n*p-s*u,t[1]=s*a-r*p,t[2]=r*u-n*a}function aa(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function e2e(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function SG(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function t2e(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function DHe(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const n=(r+1)%3,s=(r+2)%3;let a=Math.sqrt(e[3*r+r]-e[3*n+n]-e[3*s+s]+1);t[r]=.5*a,a=.5/a,t[3]=(e[3*n+s]-e[3*s+n])*a,t[n]=(e[3*n+r]+e[3*r+n])*a,t[s]=(e[3*s+r]+e[3*r+s])*a}}const x2=pd(),ll=H(),EG=H(),NHe=Pn();function NZ(t=[0,0,0],e=[-1,-1,-1],i=pd()){return{center:An(t),halfSize:An(e),quaternion:I_e(i)}}function Mne(t){return NZ(t.center,t.halfSize,t.quaternion)}function c9t(t,e){Ie(e.center,t.center),Ie(e.halfSize,t.halfSize),LZ(e.quaternion,t.quaternion)}function u9t(t,e){return e=e||NZ(),SHe(t,e),e}function tb(t,e){const i=qr(e,t.center),r=E7(t,e);return i>r?1:i<-r?-1:0}function h9t(t,e){return ll[0]=t.center[0]-e[0],ll[1]=t.center[1]-e[1],ll[2]=t.center[2]-e[2],Y2(x2,t.quaternion),f0(ll,ll,x2),uS(ll,ll),$D(EG,ll,t.halfSize),LD(EG,ll)<e[3]*e[3]}function d9t(t,e){e||(e=eo());const i=MZ(NHe,t.quaternion),r=t.halfSize[0]*Math.abs(i[0])+t.halfSize[1]*Math.abs(i[3])+t.halfSize[2]*Math.abs(i[6]),n=t.halfSize[0]*Math.abs(i[1])+t.halfSize[1]*Math.abs(i[4])+t.halfSize[2]*Math.abs(i[7]),s=t.halfSize[0]*Math.abs(i[2])+t.halfSize[1]*Math.abs(i[5])+t.halfSize[2]*Math.abs(i[8]);return e[0]=t.center[0]-r,e[1]=t.center[1]-n,e[2]=t.center[2]-s,e[3]=t.center[0]+r,e[4]=t.center[1]+n,e[5]=t.center[2]+s,e}function p9t(t,e){return qr(e,t.center)-E7(t,e)}function f9t(t,e){return qr(e,t.center)+E7(t,e)}function m9t(t,e){return tb(t,e[0])<=0&&tb(t,e[1])<=0&&tb(t,e[2])<=0&&tb(t,e[3])<=0&&tb(t,e[4])<=0&&tb(t,e[5])<=0}function g9t(t,e,i,r=0){Y2(x2,t.quaternion),Be(ll,e,t.center);const n=f0(ll,ll,x2),s=f0(EG,i,x2);let a=-1/0,u=1/0;for(let p=0;p<3;p++)if(Math.abs(s[p])>1e-6){const y=(r+t.halfSize[p]-n[p])/s[p],b=(-r-t.halfSize[p]-n[p])/s[p];a=Math.max(a,Math.min(y,b)),u=Math.min(u,Math.max(y,b))}else if(n[p]>t.halfSize[p]+r||n[p]<-t.halfSize[p]-r)return!1;return a<=u}(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let n=0;n<r.length;n++)t[e+n]=r[n];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function E7(t,e){Y2(x2,t.quaternion),f0(ll,e,x2);const i=t.halfSize;return Math.abs(ll[0]*i[0])+Math.abs(ll[1]*i[1])+Math.abs(ll[2]*i[2])}function y9t(t,e){for(let i=0;i<8;++i){const r=e[i];r[0]=1&i?-t.halfSize[0]:t.halfSize[0],r[1]=2&i?-t.halfSize[1]:t.halfSize[1],r[2]=4&i?-t.halfSize[2]:t.halfSize[2],f0(r,r,t.quaternion),Ue(r,r,t.center)}}function FHe(t){return Sc(t.halfSize)}function i2e(t,e,i,r,n){if(LZ(n.quaternion,t.quaternion),r===ht.Global){Y2(kM,t.quaternion),f0(u1,t.center,kM),uS(t3,u1),$D(i3,t3,t.halfSize),Ao(i3,t3,i3);const s=Qe(i3);Ue(i3,t3,t.halfSize);const a=Qe(i3);if(s<i)Ie(n.center,t.center),$e(u1,i,i,i),Ue(n.halfSize,t.halfSize,u1);else{const u=a>0?1+e/a:1,p=s>0?1+i/s:1,y=(p+u)/2,b=(p-u)/2;Pe(n.halfSize,t3,b),Xl(n.halfSize,n.halfSize,t.halfSize,y),Pe(n.center,t3,y),Xl(n.center,n.center,t.halfSize,b),tL(u1,u1),ID(n.center,n.center,u1),f0(n.center,n.center,n.quaternion)}}else{const s=$e(u1,0,0,1);Xl(n.center,t.center,s,(i+e)/2),Y2(kM,t.quaternion),f0(s,s,kM),uS(s,s),Xl(n.halfSize,t.halfSize,s,(i-e)/2)}return n}const u1=H(),t3=H(),i3=H(),kM=pd();let kHe=class{constructor(){this._transform=Ze(),this._transformInverse=new zM({value:this._transform},Ps,Ze),this._transformInverseTranspose=new zM(this._transformInverse,Hc,Ze),this._transformTranspose=new zM({value:this._transform},Hc,Ze),this._transformInverseRotation=new zM({value:this._transform},Wbe,Pn)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){bs(this._transform,e)}multiplyTransform(e){Rr(this._transform,this._transform,e)}set(e){bs(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},zM=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},zHe=class{constructor(e=0){this.offset=e,this.tmpVertex=H()}applyToVertex(e,i,r){const n=$e(LL,e,i,r),s=Ue(AG,n,this.localOrigin),a=this.offset/Qe(s);return Xl(this.tmpVertex,n,s,a),this.tmpVertex}applyToAabb(e){const i=r2e,r=n2e,n=s2e;for(let p=0;p<3;++p)i[p]=e[0+p]+this.localOrigin[p],r[p]=e[3+p]+this.localOrigin[p],n[p]=i[p];const s=this.applyToVertex(i[0],i[1],i[2]);for(let p=0;p<3;++p)e[p]=s[p],e[p+3]=s[p];const a=p=>{const y=this.applyToVertex(p[0],p[1],p[2]);for(let b=0;b<3;++b)e[b]=Math.min(e[b],y[b]),e[b+3]=Math.max(e[b+3],y[b])};for(let p=1;p<8;++p){for(let y=0;y<3;++y)n[y]=p&1<<y?r[y]:i[y];a(n)}let u=0;for(let p=0;p<3;++p)i[p]*r[p]<0&&(u|=1<<p);if(u!==0&&u!==7){for(let p=0;p<8;++p)if(!(u&p)){for(let y=0;y<3;++y)n[y]=u&1<<y?0:p&1<<y?i[y]:r[y];a(n)}}for(let p=0;p<3;++p)e[p]-=this.localOrigin[p],e[p+3]-=this.localOrigin[p];return e}},UHe=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=H(),this._mbs=as(),this._obb=NZ(),this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Qe(e)}applyToVertex(e,i,r){const n=$e(LL,e,i,r),s=$e(AG,e,i,r+this.componentLocalOriginLength),a=this._totalOffset/Qe(s);return Xl(this._tmpVertex,n,s,a),this._tmpVertex}applyToAabb(e){const i=$e(LL,e[0],e[1],e[2]+this.componentLocalOriginLength),r=$e(AG,e[3],e[4],e[5]+this.componentLocalOriginLength),n=tL(r2e,i),s=tL(n2e,r),a=uS(s2e,i),u=uS(GHe,r),p=$D(Lne,a,u);p[0]=n[0]*s[0]<0?0:p[0],p[1]=n[1]*s[1]<0?0:p[1],p[2]=n[2]*s[2]<0?0:p[2];const y=Qe(p);if(y<this._totalOffset)return e[0]-=i[0]<0?this._totalOffset:0,e[1]-=i[1]<0?this._totalOffset:0,e[2]-=i[2]<0?this._totalOffset:0,e[3]+=r[0]>0?this._totalOffset:0,e[4]+=r[1]>0?this._totalOffset:0,e[5]+=r[2]>0?this._totalOffset:0,e;const b=hge(Lne,a,u),S=Qe(b),C=this._totalOffset/S,O=this._totalOffset/y;return e[0]+=i[0]*(i[0]>0?C:O),e[1]+=i[1]*(i[1]>0?C:O),e[2]+=i[2]*(i[2]>0?C:O),e[3]+=r[0]*(r[0]<0?C:O),e[4]+=r[1]*(r[1]<0?C:O),e[5]+=r[2]*(r[2]<0?C:O),e}applyToMbs(e){const i=Qe(e),r=this._totalOffset/i;return Xl(this._mbs,e,e,r),this._mbs[3]=e[3]+e[3]*this._totalOffset/i,this._mbs}applyToObb(e){return i2e(e,this._totalOffset,this._totalOffset,ht.Global,this._obb),this._obb}},jHe=class{constructor(e=0){this.offset=e,this.sphere=as(),this.tmpVertex=H()}applyToVertex(e,i,r){const n=this.objectTransform.transform,s=$e(LL,e,i,r),a=wt(s,s,n),u=this.offset/Qe(a);Xl(a,a,a,u);const p=this.objectTransform.inverse;return wt(this.tmpVertex,a,p),this.tmpVertex}applyToMinMax(e,i){const r=this.offset/Qe(e);Xl(e,e,e,r);const n=this.offset/Qe(i);Xl(i,i,i,n)}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=Qe(e),r=this.offset/i;return Xl(this.sphere,e,e,r),this.sphere[3]=e[3]+e[3]*this.offset/i,this.sphere}};const Pne=new jHe;function CG(t){return t!=null?(Pne.offset=t,Pne):null}const Ine=new UHe;function BHe(t){return t!=null?(Ine.offset=t,Ine):null}const $ne=new zHe;function VHe(t){return t!=null?($ne.offset=t,$ne):null}const Ey="terrain",LL=H(),AG=H(),r2e=H(),n2e=H(),s2e=H(),GHe=H(),Lne=H(),LS=1e-5;let HHe=class{constructor(e){this.options=new IGe,this._results=new qHe,this.transform=new kHe,this.tolerance=LS,this.verticalOffset=null,this._ray=oo(),this._rayEnd=H(),this._rayBeginTransformed=H(),this._rayEndTransformed=H(),this.viewingMode=e??ht.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay(Y_e(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&AL(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===ht.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Ue(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,n,s){this.point=i,this.filterPredicate=n,this.tolerance=r??LS;const a=CG(this.verticalOffset);if(e&&e.length>0){const u=s?p=>{s(p)&&this.intersectObject(p)}:p=>{this.intersectObject(p)};for(const p of e){const y=p.getSpatialQueryAccelerator?.();y!=null?(a!=null?y.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,u,a):y.forEachAlongRay(this._ray.origin,this._ray.direction,u),this.options.selectionMode&&this.options.hud&&y.forEachDegenerateObject(u)):p.objects.forAll(b=>u(b))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.effectiveTransformation,n=CG(this.verticalOffset);for(const s of i){if(!s.visible)continue;const{material:a,id:u}=s;this.transform.setAndInvalidateLazyTransforms(r,s.transformation),wt(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),wt(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const p=this.transform.transform;n!=null&&(n.objectTransform=this.transform),a.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(y,b,S,C,O,P)=>{if(y>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,y))return;const $=C?this._results.hud:this._results,N=C?z=>{const U=new LGe(e,u,S,P);z.set(En.HUD,U,y,b,Cn,O)}:z=>z.set(En.OBJECT,{object:e,geometryId:u,triangleNr:S},y,b,p,O);if(($.min.drapedLayerOrder==null||O>=$.min.drapedLayerOrder)&&($.min.dist==null||y<$.min.dist)&&N($.min),this.options.store!==Jo.MIN&&($.max.drapedLayerOrder==null||O<$.max.drapedLayerOrder)&&($.max.dist==null||y>$.max.dist)&&N($.max),this.options.store===Jo.ALL)if(C){const z=new OG(this._ray);N(z),this._results.hud.all.push(z)}else{const z=new FT(this._ray);N(z),this._results.all.push(z)}}})}}sortResults(e=this._results.all){e.sort((i,r)=>i.dist!==r.dist?(i.dist??0)-(r.dist??0):i.drapedLayerOrder!==r.drapedLayerOrder?(i.drapedLayerOrder??Number.MAX_VALUE)-(r.drapedLayerOrder??Number.MAX_VALUE):(r.drapedLayerGraphicOrder??Number.MIN_VALUE)-(i.drapedLayerGraphicOrder??Number.MIN_VALUE))}};function ad(t){return new HHe(t)}let qHe=class{constructor(){this.min=new FT(oo()),this.max=new FT(oo()),this.hud={min:new OG(oo()),max:new OG(oo()),all:new Array},this.ground=new FT(oo()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},FT=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(Pe(UM,this.ray.direction,this.dist),Qe(UM)):null}getIntersectionPoint(e){return!!Hp(this)&&(Pe(UM,this.ray.direction,this.dist),Ue(e,this.ray.origin,UM),!0)}getTransformedNormal(e){return Ie(nC,this.normal),nC[3]=0,Nu(nC,nC,this.transformation),Ie(e,nC),We(e,e)}constructor(e){this.intersector=En.OBJECT,this.normal=H(),this.transformation=Ze(),this._ray=oo(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=En.OBJECT,AL(e,this._ray)}set(e,i,r,n,s,a,u){this.intersector=e,this.dist=r,Ie(this.normal,n??XJ),bs(this.transformation,s??Cn),this.target=i,this.drapedLayerOrder=a,this.drapedLayerGraphicOrder=u}copy(e){AL(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Ie(this.normal,e.normal),bs(this.transformation,e.transformation)}},OG=class extends FT{constructor(){super(...arguments),this.intersector=En.HUD}};function FZ(t){return new FT(t)}const UM=H(),nC=ji();function o2e(t,e,i,r){return t.renderCoordsHelper.fromRenderCoords(e.eye,DL,r)!=null&&i1e(i,DL)}function C7(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function Mw(t,e,i,r){const n=t.state.camera.clone();e&&i&&r&&(n.eye=e,n.center=i,n.up=r),WHe(t,n.ray,h1)||Ie(h1,n.center);const s=t.state.constraints,a=s.minimumPoiDistance;if(ao(n.eye,h1)<a){const u=s.collision.enabled;Ie(Yv,n.viewForward),Pe(Yv,Yv,a),u?n.eye=Be(DL,h1,Yv):Ue(h1,n.eye,Yv);const p=t.renderCoordsHelper,y=p.getAltitude(n.eye),b=s.collision.elevationMargin;u&&y<b&&(Be(Yv,h1,n.eye),n.eye=p.setAltitude(DL,b,n.eye),Ue(h1,n.eye,Yv))}return n.center=h1,n}function Dne(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=C7(t,e),n=t.stateManager.constraintsManager.nearFarHeuristic,{far:s}=n.compute(e,i,t.renderDataExtent,r,JHe),a=s*s;return ao(e,i)>a}function WHe(t,e,i){let r=Nne[t.viewingMode];r||(r=ad(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,Nne[t.viewingMode]=r);const{isGlobal:n}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||Dne(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||Dne(t,e.origin,i))||!!n&&XHe(e,i,Mr(t.spatialReference).radius)}function XHe(t,e,i){const r=He(t.origin,t.origin)-i*i,n=r>0?Math.sqrt(r)/3:1;return Pe(e,t.direction,n/Qe(t.direction)),Ue(e,e,t.origin),!0}const Nne={},DL=H(),h1=H(),Yv=H(),JHe={near:0,far:0},YHe=H(),jM=H();function kZ(){return{direction:H(),up:H()}}function a2e(t,e,i,r,n){let s=We(YHe,t),a=He(s,r);const u=a>0;a=Math.abs(a),a>.99&&(a=Math.abs(He(e,r)),a<.99?(Ie(s,e),u&&Pe(s,s,-1)):s=null);let p=0;if(s){Pe(jM,r,He(r,s)),Be(s,s,jM);const b=He(s,n)/(Qe(s)*Qe(n));qt(jM,s,n),p=(He(jM,r)>0?1:-1)*wl(co(b))}const y=wl(co(-He(r,t)/Qe(t)));return i?(i.heading=p,i.tilt=y,i):{heading:p,tilt:y}}const l2e=st(0,1,0),c2e=st(0,0,1),sC=Ze(),K0=H(),Q0=H();function u2e(t,e,i,r=kZ()){const{direction:n,up:s}=r;return Mge(sC,-gi(e)),dS(sC,sC,gi(i)),wt(n,c2e,sC),Pe(n,n,-1),wt(s,l2e,sC),r}function ZHe(t,e,i,r){return a2e(e,i,r,c2e,l2e)}function KHe(t,e,i,r){const n=u2e(t,i,r),s=H();return Pe(s,n.direction,-e),Ue(s,s,t),{up:n.up,eye:s,heading:i,tilt:r}}function QHe(t){return wl(t)}function eqe(t){return gi(t)}function h2e(t,e,i,r,n){const s=t.renderSpatialReference,a=t.map&&t.spatialReference||e.spatialReference;return Wc(e,K0,s),Wc(e,Q0,s),K0[0]-=i/2,Q0[0]+=i/2,K0[1]-=r/2,Q0[1]+=r/2,va(K0,s,K0,a),va(Q0,s,Q0,a),n?(n.xmin=K0[0],n.ymin=K0[1],n.xmax=Q0[0],n.ymax=Q0[1],n.spatialReference=a):n=new rr(K0[0],K0[1],Q0[0],Q0[1],a),n}const tqe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:ZHe,eyeForCenterWithHeadingTilt:KHe,eyeTiltToLookAtTilt:eqe,headingTiltToDirectionUp:u2e,lookAtTiltToEyeTilt:QHe,toExtent:h2e},Symbol.toStringTag,{value:"Module"}));function Fne(t,e,i){if(e.longitude==null||e.latitude==null||i.longitude==null||i.latitude==null)throw new Error("Invalid points: no lon/lat");return iqe(t,e.longitude,e.latitude,i.longitude,i.latitude)}function iqe(t,e,i,r,n){const s=gi(i),a=gi(n),u=s-a,p=gi(e)-gi(r),y=Math.sin(u/2),b=Math.sin(p/2),S=2*Qh(Math.sqrt(y*y+Math.cos(s)*Math.cos(a)*b*b))*t;return Math.round(1e4*S)/1e4}function rqe(t,e,i){const r=e.spatialReference,n=Mr(r),s=new Wt(e.x,t.y,r),a=new Wt(i.x,t.y,r),u=new Wt(t.x,e.y,r),p=new Wt(t.x,i.y,r);return{lon:Fne(n.radius,s,a),lat:Fne(n.radius,u,p)}}function nqe(t,e,i){const r=e/i,n=gi(t),s=Math.sin(r/2),a=Math.cos(n),u=2*Qh(Math.sqrt(s*s/(a*a)));return wl(u)}function sqe(t,e){let i=t/15;return e||(i=Math.round(i)),i}function kne(t,e){const i=t?.[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=sqe(i,!0);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const n=e.minutes%1;return e.minutes-=n,e.seconds=Math.round(60*n),e}const d2e=st(0,0,1),p2e=We(H(),st(1,1,1)),oqe=new av(-180,180),oC=Ze(),vy=H(),r3=H();function f2e(t,e,i,r=kZ()){qt(vy,t,d2e),He(vy,vy)===0&&qt(vy,t,p2e),Zu(oC,-gi(e),t),Dc(oC,oC,-gi(i),vy);const{up:n,direction:s}=r;return qt(n,vy,t),We(n,n),wt(n,n,oC),We(s,t),ka(s,s),wt(s,s,oC),r}function aqe(t,e,i,r){const n=vy,s=r3;return We(n,t),qt(r3,n,d2e),He(r3,r3)===0&&qt(r3,n,p2e),qt(s,r3,n),a2e(e,i,r,n,s)}function lqe(t,e,i,r){const n={eye:H(),up:null,tilt:r,heading:i},s=vy;s[0]=t[0],s[1]=t[2],s[2]=-t[1];const a=e,u=gi(i),p=gi(r),y=Math.sin(u),b=Math.cos(u),S=Math.sin(p),C=Math.cos(p),O=Qe(s);let P;if(Math.abs(p)<1e-8)P=a+O;else{const Se=O/S,ee=Qh(a/Se),re=Math.PI-p-ee;P=Se*Math.sin(re)}const $=C*a,N=a*a*(S*S),z=b*b*N,U=P-$,j=U*U,G=z*(z+j-s[1]*s[1]);if(G<0)return Pe(n.eye,s,P/O),n.tilt=0,BM(n,t);const q=Math.sqrt(G),W=s[1]*U,K=z+j;let se;if(se=b>0?-q+W:q+W,Math.abs(K)<1e-8)return O<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=a):Pe(n.eye,s,P/O),n.tilt=0,jF(n.eye),BM(n,t);n.eye[1]=se/K;const ae=y*y*N,le=S*a,me=b*le*n.eye[1],ne=n.eye[1]*n.eye[1],pe=1-ne,ge=Math.sqrt(pe),ve=z*ne+ae-2*me*ge*U+pe*j;return Math.abs(ve)<1e-8?(Pe(n.eye,s,P/O),n.tilt=0,jF(n.eye),BM(n,t)):(n.eye[0]=(pe*(P*s[0]-$*s[0])-le*ge*(s[0]*n.eye[1]*b+s[2]*y))/ve,n.eye[2]=(pe*(P*s[2]-$*s[2])-le*ge*(s[2]*n.eye[1]*b-s[0]*y))/ve,Pe(n.eye,n.eye,P),jF(n.eye),BM(n,t))}function jF(t){const e=t[1];t[1]=-t[2],t[2]=e}function BM(t,e){const i=f2e(e,t.heading,t.tilt);return t.up=i.up,t}function cqe(t,e,i){const r=Qe(e),n=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),s=Qh(i/(n/Math.sin(t)));return wl(t-s)}function uqe(t,e,i){const r=gi(t),n=Qe(e);return Qh(i/(n/Math.sin(r)))+r}function m2e(t,e,i,r,n){let s,a,u,p;const y=e.latitude,b=Mr(t.spatialReference).radius,S=e.longitude,C=nqe(y,i,b)/2;s=S-C,a=S+C;const O=gi(y),P=(1+Math.sin(O))/(1-Math.sin(O)),$=(P+1)*Math.tan(r/b/2),N=$*$;function z(j){const G=Math.PI/2;return(j=t7e.normalize(j,-G))>G&&(j=Math.PI-j),j}if(u=1.5*Math.PI-2*Math.atan(.5*($+Math.sqrt(4*P+N))),p=u+r/b,u=z(u),p=z(p),p<u){const j=p;p=u,u=j}if(u=Math.max(wl(u),-90),p=Math.min(wl(p),90),a=oqe.monotonic(s,a),a-s>180){const j=(a-s-180)/2;s+=j,a-=j}const U=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:dt.WGS84;return n?(n.xmin=s,n.ymin=u,n.xmax=a,n.ymax=p,n.spatialReference=U):n=new rr(s,u,a,p,U),t.spatialReference&&t.spatialReference.isWebMercator&&Xy(n,!1,n),n}const hqe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:aqe,eyeForCenterWithHeadingTilt:lqe,eyeTiltToLookAtTilt:uqe,headingTiltToDirectionUp:f2e,lookAtTiltToEyeTilt:cqe,toExtent:m2e},Symbol.toStringTag,{value:"Module"}));function NL(t){return t.type==="point"}let zZ=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function g2e(t){return"array"in t}function a0(t,e,i="ground"){if(NL(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(g2e(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,e.spatialReference??t.spatialReference,i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}const y2e=Ee.getLogger("esri.views.3d.support.cameraUtils"),v2e=39.37,_2e=96,RG=1,dqe=8,pqe=5,b2e=1,zne=H(),fqe={heading:0,tilt:0},GA=H(),mqe=new av(-20037508342788905e-9,20037508342788905e-9),gqe=new av(-180,180);var ma;function Ug(t){return t.spatialReference??dt.WGS84}function xE(t){return t.viewingMode==="global"?hqe:tqe}function yqe(t,e,i,r,n){return xE(t).headingTiltToDirectionUp(e,i,r,n)}function Gm(t,e){if(e==null)return null;const i=t.renderSpatialReference,r=xE(t).headingTiltToDirectionUp,n=H();if(!Wc(e.position,n,i))return null;const s=r(n,e.heading,e.tilt);Pe(s.direction,s.direction,t.state.camera.distance),Ue(s.direction,s.direction,n);const a=Mw(t,n,s.direction,s.up);return a.fov=gi(e.fov),a}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(ma||(ma={}));const n3=H();function DS(t,e,i){const r=t.renderSpatialReference,n=O7(t,e.eye,e.viewForward,e.up,fqe);let s=Ug(t);return va(e.eye,r,n3,s)||(s=dt.WGS84,va(e.eye,r,n3,s)),i==null?new Ku(new Wt(n3,s),n.heading,n.tilt,wl(e.fov)):(i.position.x=n3[0],i.position.y=n3[1],i.position.z=n3[2],i.position.spatialReference=s,i.heading=n.heading,i.tilt=n.tilt,i.fov=wl(e.fov),i)}function A7(t,e,i){const r=t.state.camera,n=r.width/2/r.pixelRatio;return t.renderCoordsHelper.viewingMode===ht.Global&&i!=null&&(e*=Math.cos(gi(i))),e/=t.renderCoordsHelper.unitInMeters,n/(_2e*v2e/e)/Math.tan(r.fovX/2)}function Z2(t,e,i){const r=t.state.camera,n=e*Math.tan(r.fovX/2),s=r.width/2/r.pixelRatio;let a=_2e*v2e/(s/n);return t.renderCoordsHelper.viewingMode===ht.Global&&i!=null&&(a/=Math.cos(gi(i))),a*t.renderCoordsHelper.unitInMeters}async function w2e(t,e,i,r,n,s){return x2e(t,e,A7(t,i,e.latitude),r,n,s)}function vqe(t,e,i,r,n,s){return N2e(t,UZ(t,r.heading,r.tilt,e,i,n),r.fov,s)}async function x2e(t,e,i,r,n,s){const a=await S2e(t,r.heading,r.tilt,e,i,n,s);return oi(s),F2e(t,a,r.fov,s)}function O7(t,e,i,r,n){return xE(t).directionToHeadingTilt(e,i,r,n)}function T2e(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,GA,t.spatialReference)&&t.elevationProvider&&(a0(t.elevationProvider,GA)??0)>GA[2]-b2e)}async function _qe(t,e,i){if(T2e(t,e))return!0;const{elevationProvider:r,spatialReference:n,renderCoordsHelper:s}=t;if(r==null||!s.fromRenderCoords(e,GA,n))return!1;const[a,u,p]=GA,y=await r.queryElevation(a,u,p,n,"ground",i)??0;return oi(i),y>p-b2e}async function bqe(t,e,i){const r=H();if(e==null)return Ie(r,t.state.camera.center);if(e instanceof Wt){const{renderSpatialReference:n,basemapTerrain:s,elevationProvider:a}=t,u=e.spatialReference;if(await IL(e,r,n,0,{signal:i}),oi(i),e.z==null&&s!=null&&a!=null){const p=await a.queryElevation(e.x,e.y,e.z??0,u,"ground",i);oi(i),p!=null&&t.renderCoordsHelper.setAltitude(r,p)}return r}return Ie(r,e)}function wqe(t,e){const i=H();if(e==null)return Ie(i,t.state.camera.center);if(e instanceof Wt){if(!Wc(e,i,t.renderSpatialReference))return null;const{basemapTerrain:r,elevationProvider:n}=t;if(e.z==null&&r!=null&&n!=null){const s=a0(n,e);s!=null&&t.renderCoordsHelper.setAltitude(i,s)}return i}return Ie(i,e)}function UZ(t,e,i,r,n,s){return E2e(t,e,i,r instanceof Wt?r:null,wqe(t,r),n,s)}async function S2e(t,e,i,r,n,s,a){const u=r instanceof Wt?r:null,p=await bqe(t,r,a);return oi(a),C2e(t,e,i,u,p,n,s,a)}function E2e(t,e,i,r,n,s,a){if(n==null||(r??(r=Og(n,t.renderSpatialReference,Ug(t))),r==null))return null;const u=A2e(t,e,i,n,s,a);if(O2e(t,i,a)&&T2e(t,u.eye)){const{tilt:p,mode:y}=R2e(t,i,n,s);return E2e(t,e,p,r,n,s,y)}return M2e(u,n)}async function C2e(t,e,i,r,n,s,a,u){r??(r=await Hbe(n,t.renderSpatialReference,Ug(t),{signal:u})),oi(u);const p=A2e(t,e,i,n,s,a);if(O2e(t,i,a)&&await _qe(t,p.eye,u)){oi(u);const{tilt:y,mode:b}=R2e(t,i,n,s);return C2e(t,e,y,r,n,s,b,u)}return M2e(p,n)}function A2e(t,e,i,r,n,s){const a=Tqe(t,e,i,r,n=Math.max(n,t.state.constraints.minimumPoiDistance),s);return(0,xE(t).eyeForCenterWithHeadingTilt)(r,n,a.heading,a.tilt)}function O2e(t,e,i){const r=t.map.ground.navigationConstraint;return i===ma.ADJUST&&t.viewingMode==="global"&&e>0&&(r==null||r.type==="stay-above")}function R2e(t,e,i,r){const n=D2e(t,i,r,Eqe(t,r,e,i));return{tilt:n,mode:e-n<1?ma.LOCKED:ma.ADJUST}}function M2e(t,e){return{...t,center:An(e)}}function P2e(t,e){const{state:i,spatialReference:r}=t,n=e.spatialReference;return i.isGlobal&&B4(n,ht.Global)||i.isLocal&&r.equals(n)}function I2e(t,e){let i,r,n;if(t.state.isGlobal){const b=new Wt(e.xmin,e.ymin,e.spatialReference),S=new Wt(e.xmax,e.ymax,e.spatialReference),C=e.spatialReference.isGeographic?gqe:mqe;i=new Wt({x:C.center(b.x,S.x),y:(S.y+b.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const O=Mr(e.spatialReference),P=rqe(i,b,S);r=P.lon,n=P.lat,C.diff(b.x,S.x)>C.range/2&&(r+=O.halfCircumference),r=Math.min(r,O.halfCircumference),n=Math.min(n,O.halfCircumference)}else{const b=t.renderSpatialReference??e.spatialReference;b.equals(e.spatialReference)||(e=F0(e,b)),r=e.xmax-e.xmin,n=e.ymax-e.ymin;const S=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;i=new Wt({x:e.xmin+.5*r,y:e.ymin+.5*n,z:S,spatialReference:b})}const s=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,a=t.state.camera,u=1/Math.tan(a.fovX/2),p=1/Math.tan(a.fovY/2),y=1/Math.tan(a.fov/2);return{center:i,distance:Math.max(.5*r*u,.5*n*p,.5*s*y)/RG}}async function $2e(t,e,i,r,n,s){const a=P2e(t,e)?e:await C0(e,t.spatialReference,{signal:s});oi(s);const{center:u,distance:p}=I2e(t,a),y=await S2e(t,i,r,u,p,n,s);return oi(s),F2e(t,y,t.camera.fov,s)}function s$(t,e,i,r,n,s){let a;try{a=P2e(t,e)?e:F0(e,t.spatialReference)}catch{return null}const{center:u,distance:p}=I2e(t,a),y=UZ(t,i,r,u,p,n);return y==null?null:N2e(t,y,t.camera.fov,s)}function L2e(t,e,i){const r=t.renderSpatialReference,n=Og(i,r,Ug(t));if(n==null)return null;const s=Math.tan(e.fovX/2),a=Math.tan(e.fovY/2),u=WO(e.eye,i),p=2*u*s*RG,y=2*u*a*RG;return t.viewingMode==="global"?m2e(t,n,p,y):h2e(t,n,p,y)}function xqe(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>dqe)return!0;const n=t.renderSpatialReference,s=Ug(t),a=Og(e,n,s),u=Og(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n,s);if(a==null||u==null)return!1;const p=Math.tan(.5*t.state.camera.fov)*r;return u.distance(a)/p>pqe}function Tqe(t,e,i,r,n,s){let a=0;return s===ma.ADJUST&&xqe(t,r,n)?(e=0,a=Sqe(t,n,i,r)):a=jZ(t,r,n,i),a=t.state.constraints.clampTilt(n,a),{heading:e,tilt:i=D2e(t,r,n,a)}}const FL=.7;function Sqe(t,e,i,r){const n=jZ(t,r,e,i);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);s.max=Math.min(s.max,.5*Math.PI);const a=s.min*(1-FL)+s.max*FL;return Math.min(n,a)}function Eqe(t,e,i,r){let n=jZ(t,r,e,i);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);return n=Math.min(n,.5*Math.PI),s.min*(1-FL)+n*FL}function D2e(t,e,i,r){return xE(t).lookAtTiltToEyeTilt(r,e,i)}function jZ(t,e,i,r){return xE(t).eyeTiltToLookAtTilt(r,e,i)}function N2e(t,e,i,r){if(e==null)return null;const n=t.renderSpatialReference,s=Og(e.eye,n,Ug(t));return s==null?null:(r??(r=new Ku),r.position=s,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r)}async function F2e(t,e,i,r){const n=t.renderSpatialReference,s=await Hbe(e.eye,n,Ug(t),{signal:r});return oi(r),new Ku(s,e.heading,e.tilt,i)}function Cqe(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.levelAtScale(e);y2e.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function k2e(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.scaleAtLevel(e);y2e.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function z2e(t,e){return va(e.center,t.renderSpatialReference,zne,dt.WGS84),Z2(t,e.distance,zne[1])}const BZ=Ee.getLogger("esri.layers.support.ElevationSampler");let U2e=class{queryElevation(e){return j2e(e.clone(),this)}on(){return Sr()}projectIfRequired(e,i){return B2e(e,i)}},Aqe=class extends U2e{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){super(),this.tile=e,this.noDataValue=r;const n=e.tile.extent;this.extent=BD(n,i.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=n;const s=Va(i.spatialReference),a=i.lodAt(e.tile.level).resolution*s;this.demResolution={min:a,max:a}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return i!=null&&this.containsAt(i.x,i.y)}containsAt(e,i){return VD(this._aaExtent,e,i)}elevationAt(e,i){if(!this.containsAt(e,i)){const r=this.extent,n=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return BZ.warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${n})`),this.noDataValue}return this.tile.sample(e,i)??this.noDataValue}},M9t=class extends U2e{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){let n;super(),typeof i=="number"?(this.noDataValue=i,n=null):(n=i,this.noDataValue=r),this.samplers=n?e.map(a=>new Aqe(a,n,this.noDataValue)):e;const s=this.samplers[0];if(s){this.extent=s.extent.clone();const{min:a,max:u}=s.demResolution;this.demResolution={min:a,max:u};for(let p=1;p<this.samplers.length;p++){const y=this.samplers[p];this.extent.union(y.extent),this.demResolution.min=Math.min(this.demResolution.min,y.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,y.demResolution.max)}}else this.extent=BD(Di(),n.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,i){for(const r of this.samplers)if(r.containsAt(e,i))return r.elevationAt(e,i);return BZ.warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue}};function j2e(t,e){const i=B2e(t,e.spatialReference);if(!i)return null;switch(t.type){case"point":Oqe(t,i,e);break;case"polyline":Rqe(t,i,e);break;case"multipoint":Mqe(t,i,e)}return t}function B2e(t,e){if(t==null)return null;const i=t.spatialReference;if(i.equals(e))return t;const r=HO(t,e);return r||BZ.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}function Oqe(t,e,i){t.z=i.elevationAt(e.x,e.y)}function Rqe(t,e,i){t0.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n],a=e.paths[n];for(let u=0;u<s.length;u++){const p=s[u],y=a[u];t0.x=y[0],t0.y=y[1],r&&(p[3]=p[2]),p[2]=i.elevationAt(t0.x,t0.y)}}t.hasZ=!0}function Mqe(t,e,i){t0.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let n=0;n<t.points.length;n++){const s=t.points[n],a=e.points[n];t0.x=a[0],t0.y=a[1],r&&(s[3]=s[2]),s[2]=i.elevationAt(t0.x,t0.y)}t.hasZ=!0}const t0=new Wt;var MG;let Mf=MG=class extends Ne{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new MG({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};_([T({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Mf.prototype,"cols",void 0),_([T({type:Wr,json:{write:!0}})],Mf.prototype,"level",void 0),_([T({type:String,json:{write:!0}})],Mf.prototype,"levelValue",void 0),_([T({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Mf.prototype,"origin",void 0),_([T({type:Number,json:{write:!0}})],Mf.prototype,"resolution",void 0),_([T({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Mf.prototype,"rows",void 0),_([T({type:Number,json:{write:!0}})],Mf.prototype,"scale",void 0),Mf=MG=_([Z("esri.layers.support.LOD")],Mf);const cp=Mf;let Pqe=class{constructor(e,i,r,n,s=void 0){this.id=e,this.level=i,this.row=r,this.col=n,this.extent=s}};var K1;const Une=new br({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Ea=K1=class extends Ne{static create(t={}){const{resolutionFactor:e=1,scales:i,size:r=256,spatialReference:n=dt.WebMercator,numLODs:s=24}=t;if(!Fa(n)){const S=[];if(i)for(let C=0;C<i.length;C++){const O=i[C];S.push(new cp({level:C,scale:O,resolution:O}))}else{let C=5e-4;for(let O=s-1;O>=0;O--)S.unshift(new cp({level:O,scale:C,resolution:C})),C*=2}return new K1({dpi:96,lods:S,origin:new Wt(0,0,n),size:[r,r],spatialReference:n})}const a=Sp(n),u=t.origin?new Wt({x:t.origin.x,y:t.origin.y,spatialReference:n}):new Wt(a?{x:a.origin[0],y:a.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),p=96,y=1/(Va(n)*39.37*p),b=[];if(i)for(let S=0;S<i.length;S++){const C=i[S],O=C*y;b.push(new cp({level:S,scale:C,resolution:O}))}else{let S=DJ(n)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const C=Math.ceil(s/e);b.push(new cp({level:0,scale:S,resolution:S*y}));for(let O=1;O<C;O++){const P=S/2**e,$=P*y;b.push(new cp({level:O,scale:P,resolution:$})),S=P}}return new K1({dpi:p,lods:b,origin:u,size:[r,r],spatialReference:n})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const i=Sp(t);return t.isWrappable&&!!i&&Math.abs(i.origin[0]-e.x)<=i.dx}return!1}readOrigin(t,e){return Wt.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,i=0;const r=[],n=this._levelToLOD={};t&&(e=-1/0,i=1/0,t.forEach(s=>{r.push(s.scale),e=s.scale>e?s.scale:e,i=s.scale<i?s.scale:i,n[s.level]=s})),this._set("scales",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const i=Math.floor(t),r=i+1;return e[i]/(e[i]/e[r])**(t-i)}scaleToZoom(t){const e=this.scales,i=e.length-1;let r=0;for(;r<i;r++){const n=e[r],s=e[r+1];if(n<=t)return r;if(s===t)return r+1;if(n>t&&s<t)return r+Math.log(n/t)/Math.log(n/s)}return r}snapScale(t,e=.95){const i=this.scaleToZoom(t);return i%Math.floor(i)>=e?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(t,e,i,r){const n=this.lodAt(t);if(!n)return null;let s,a;if(typeof e=="number")s=e,a=i;else if(Wn(e.spatialReference,this.spatialReference))s=e.x,a=e.y,r=i;else{const y=HO(e,this.spatialReference);if(y==null)return null;s=y.x,a=y.y,r=i}const u=n.resolution*this.size[0],p=n.resolution*this.size[1];return r||(r=new Pqe(null,0,0,0,Di())),r.level=t,r.row=Math.floor((this.origin.y-a)/p+.001),r.col=Math.floor((s-this.origin.x)/u+.001),this.updateTileInfo(r),r}updateTileInfo(t,e=K1.ExtrapolateOptions.NONE){let i=this.lodAt(t.level);if(!i&&e===K1.ExtrapolateOptions.POWER_OF_TWO){const a=this.lods[this.lods.length-1];a.level<t.level&&(i=a)}if(!i)return;const r=t.level-i.level,n=i.resolution*this.size[0]/2**r,s=i.resolution*this.size[1]/2**r;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=Di()),t.extent[0]=this.origin.x+t.col*n,t.extent[1]=this.origin.y-(t.row+1)*s,t.extent[2]=t.extent[0]+n,t.extent[3]=t.extent[1]+s}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const i=this.lodAt(e.level);if(i==null)return null;const{resolution:r}=i,n=r*this.size[0],s=r*this.size[1];return t[0]=this.origin.x+e.col*n,t[1]=this.origin.y-(e.row+1)*s,t[2]=t[0]+n,t[3]=t[1]+s,t}lodAt(t){return this._levelToLOD?.[t]??null}clone(){return K1.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const i=[],r=this.lods.length;for(let n=0;n<r;n++){const s=this.lods[n],a=s.resolution*e;i.push(new cp({level:s.level,scale:s.scale,resolution:a}))}return new K1({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let i=0;i<t.length;i++){const r=t[i];this._upsampleLevels[r.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/r.resolution:0},e=r}}};_([T({type:Number,json:{write:!0}})],Ea.prototype,"compressionQuality",void 0),_([T({type:Number,json:{write:!0}})],Ea.prototype,"dpi",void 0),_([T({type:String,json:{read:Une.read,write:Une.write,origins:{"web-scene":{read:!1,write:!1}}}})],Ea.prototype,"format",void 0),_([T({readOnly:!0})],Ea.prototype,"isWrappable",null),_([T({type:Wt,json:{write:!0}})],Ea.prototype,"origin",void 0),_([rt("origin")],Ea.prototype,"readOrigin",null),_([T({type:[cp],value:null,json:{write:!0}})],Ea.prototype,"lods",null),_([T({readOnly:!0})],Ea.prototype,"scales",void 0),_([T({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Ea.prototype,"size",void 0),_([rt("size",["rows","cols"])],Ea.prototype,"readSize",null),_([ot("size",{cols:{type:Wr},rows:{type:Wr}})],Ea.prototype,"writeSize",null),_([T({type:dt,json:{write:!0}})],Ea.prototype,"spatialReference",void 0),Ea=K1=_([Z("esri.layers.support.TileInfo")],Ea),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Ea||(Ea={}));const o$=Ea,Iqe=12;let Mc=class Nl{constructor(e){const i=Nl.checkUnsupported(e);if(i!=null)throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=uv(this.spatialReference)||L0(this.spatialReference)||D0(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const n=r.lods.reduce((y,b,S)=>(b.level<y.min&&(y.min=b.level,y.minIndex=S),y.max=Math.max(y.max,b.level),y),{min:1/0,minIndex:0,max:-1/0}),s=r.lods[n.minIndex],a=2**s.level;let u=s.resolution*a,p=s.scale*a;this.levels=new Array(n.max+1);for(let y=0;y<this.levels.length;y++)this.levels[y]={resolution:u,scale:p,tileSize:[u*r.size[0],u*r.size[1]]},u/=2,p/=2}clone(){return new Nl(this.toTileInfo())}toTileInfo(){return new o$({dpi:this.dpi,origin:new Wt({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new cp({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,n){const s=this.levels[e],a=s.tileSize[0],u=s.tileSize[1];n[0]=this.origin[0]+r*a,n[2]=this.origin[0]+(r+1)*a,n[3]=this.origin[1]-i*u,n[1]=this.origin[1]-(i+1)*u}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=iie(e[0]),i[1]=Z6(e[1]),i[2]=iie(e[2]),i[3]=Z6(e[3])):this._isGCS&&(i[0]=gi(e[0]),i[1]=gi(e[1]),i[2]=gi(e[2]),i[3]=gi(e[3]))}getExtentGeometry(e,i,r,n=new rr){return this.getExtent(e,i,r,ef),n.spatialReference=this.spatialReference,n.xmin=ef[0],n.ymin=ef[1],n.xmax=ef[2],n.ymax=ef[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const r=this.levels[this.levels.length-1],n=r.resolution/2;this.levels.push({resolution:n,scale:r.scale/2,tileSize:[n*this.pixelSize,n*this.pixelSize]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof Nl)){if(Nl.checkUnsupported(e))return!1;e=new Nl(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,e.levels.length)-1,r=this.levels[i].resolution;let n=.5*r;return!Jy(e.origin[0],this.origin[0],n)||!Jy(e.origin[1],this.origin[1],n)?!1:(n=.5*r/2**i/this.pixelSize*Iqe,Jy(r,e.levels[i].resolution,n))}rootTilesInExtent(e,i=null,r=1/0){const n=new Array,s=this.levels[0].tileSize;if(e==null||s[0]===0||s[1]===0)return n;Nl.computeRowColExtent(e,s,this.origin,ef);let a=ef[1],u=ef[3],p=ef[0],y=ef[2];const b=y-p,S=u-a;if(b*S>r){const C=Math.floor(Math.sqrt(r));S>C&&(a=a+Math.floor(.5*S)-Math.floor(.5*C),u=a+C),b>C&&(p=p+Math.floor(.5*b)-Math.floor(.5*C),y=p+C)}for(let C=a;C<u;C++)for(let O=p;O<y;O++)n.push([0,C,O]);return i!=null&&(i[0]=this.origin[0]+p*s[0],i[1]=this.origin[1]-u*s[1],i[2]=this.origin[0]+y*s[0],i[3]=this.origin[1]-a*s[1]),n}static computeRowColExtent(e,i,r,n){const s=.001*(e[2]-e[0]+(e[3]-e[1]));n[0]=Math.max(0,Math.floor((e[0]+s-r[0])/i[0])),n[2]=Math.max(0,Math.ceil((e[2]-s-r[0])/i[0])),n[1]=Math.max(0,Math.floor((r[1]-e[3]+s)/i[1])),n[3]=Math.max(0,Math.ceil((r[1]-e[1]-s)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(n=>!T8e(n.resolution,r/2**n.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,n)=>r-n);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new de("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?VZ():e.lods.length<1?new de("tilingscheme:generic","Tiling scheme must have at least one level"):Nl.isPowerOfTwo(e)?Nl.hasGapInLevels(e)?new de("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Nl.tileSizeSupported(e)?Nl.hasOriginPerLODs(e)?new de("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new de("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new de("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],n=e[3]-e[1],s=Va(i),a=1.2*Math.max(r,n),u=256,p=96,y=.0254,b=new Nl(new o$({size:[u,u],origin:new Wt({x:e[0]-.5*(a-r),y:e[3]+.5*(a-n)}),lods:[new cp({level:0,resolution:a/u,scale:1/(u/p*y/(a*s))})],spatialReference:i}));return b.ensureMaxLod(20),b}static makeWebMercatorAuxiliarySphere(e){const i=new Nl(Nl.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const n=256/i,s=new Nl(new o$({size:[i,i],origin:new Wt({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new cp({level:0,resolution:.703125*n,scale:295497598570834e-6*n})]}));return s.ensureMaxLod(r),s}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function VZ(){return new de("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Mc.WebMercatorAuxiliarySphereTileInfo=new o$({size:[256,256],origin:new Wt({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:dt.WebMercator}),spatialReference:dt.WebMercator,lods:[new cp({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),Mc.WebMercatorAuxiliarySphere=Mc.makeWebMercatorAuxiliarySphere(19);const ef=Di(),fT=64,A5=512,$qe=2.5,Q4=S8e(rB/10),V2e=2,G2e=Di();Mc.WebMercatorAuxiliarySphere.getExtent(0,0,0,G2e);const Lqe=Di([-180,-90,180,90]),Dqe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Nqe="Surface extent is too large for tile resolution at level 0.",Fqe=3;let kqe=Fqe;function PG(t){return t<4?3:kqe}let Q1=class extends Xn.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=Q4}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e?.extent==null||e.spatialReference==null)return null;const i=BD(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){return this.view.basemapTerrain?.spatialReference??dt.WGS84}elevationAt(e,i){if(this.extent==null||!al(this.extent,e,i)){const r=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return Ee.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${r})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,i,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(e){return j2e(e.clone(),this)}};_([T({readOnly:!0})],Q1.prototype,"demResolution",void 0),_([T({readOnly:!0})],Q1.prototype,"extent",null),_([T({readOnly:!0})],Q1.prototype,"noDataValue",void 0),_([T()],Q1.prototype,"spatialReference",null),_([T({constructOnly:!0})],Q1.prototype,"view",void 0),Q1=_([Z("esri.views.support.GroundViewElevationSampler")],Q1);const zqe=Q1;let Sm=class extends Ke{constructor(e){super(e),this.view=null,this.layerViews=new Dt}initialize(){this.addHandles(Qu(()=>this.view?.map?.ground,e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new zqe({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?L2e(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>Fe(()=>e.updating,()=>this._updateUpdating(),$r)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};_([T({readOnly:!0})],Sm.prototype,"elevationSampler",null),_([T({readOnly:!0})],Sm.prototype,"extent",null),_([T({type:Boolean,readOnly:!0})],Sm.prototype,"updating",null),_([T({constructOnly:!0})],Sm.prototype,"view",void 0),_([T({type:Dt,readOnly:!0})],Sm.prototype,"layerViews",void 0),_([T({readOnly:!0})],Sm.prototype,"suspended",null),Sm=_([Z("esri.views.GroundView")],Sm);const Uqe=Sm;let Mg=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const n=e[r],s=new A0e(n,void 0,void 0,2,2);this._properties[r]={pool:s,acquired:[]}}this._afterDispatchHandle=z0e(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)Dte(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let n=r.pool.acquire();for(r.acquired.push(n);n===i;)r.acquired.push(n),n=r.pool.acquire();return n}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const n of i.acquired)Dte(n)?i.acquired[r++]=n:i.pool.release(n);i.acquired.length=r}}};const jqe=Me("mac")?"Meta":"Ctrl",R7={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)R7[t]=String.fromCharCode(t);for(let t=1;t<25;t++)R7[111+t]=`F${t}`;for(let t=65;t<91;t++)R7[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function Bqe(t){if(t.key!==void 0)return k9e(t);const e=R7[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function Vqe(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let Gqe=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}};const jne=Ee.getLogger("esri.views.input.InputHandler");let Qo=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?jne.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let n;typeof i=="function"?(r=i,n=[]):n=i||[];const s=typeof e=="string"?new Gqe(e,n):e,a=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},u=b=>{const S=this._incoming[b.match.eventType];if(S){const C=S.indexOf(b);S.splice(C,1),a(),this._manager&&this._manager.updateDependencies()}},p=new Hqe(s,r,{onPause:u,onRemove:u,onResume:b=>{const S=this._incoming[b.match.eventType];S&&!S.includes(b)&&(S.push(b),a(),this._manager&&this._manager.updateDependencies())}});let y=this._incoming[s.eventType];return y||(y=[],this._incoming[s.eventType]=y),y.push(p),a(),this._manager&&this._manager.updateDependencies(),p}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new qqe(e,{onEmit:(r,n,s,a)=>{this._manager?.emit(r.eventType,n,s,a)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager?.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){this._manager?.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager?.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):jne.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const i=this._incoming[e.type];if(i){for(const r of i)if(r.match.matches(e)&&(r.callback?.(e),e.shouldStopPropagation()))break}}},Hqe=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},qqe=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},Wqe=class extends Qo{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{this._update(i.data)})}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:n}=e;i===this._value&&this._x===r&&this._y===n||(this._value=i,this._x=r,this._y=n,this._onChange(i,r,n))}},Xqe=class extends Qo{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=xS(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},vh=class extends Ke{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=jqe,this._latestPointerType="mouse",this._propertiesPool=new Mg({latestPointerLocation:Zqe},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,i,r=Zy.INTERNAL){if(this._nameToGroup[e])return void Ee.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(i.length===0)return void Ee.getLogger(this).error("Can't register a group of zero handlers");const n={name:e,handlers:i.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=n;for(let s=n.handlers.length-1;s>=0;s--){const a=n.handlers[s];this._handlers.push(a),a.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(u,p,y,b,S)=>{this._emitInputEvent(a.priorityIndex+1,u,p,y,S,b)},setPointerCapture:(u,p)=>{this._setPointerCapture(n,a,u,p)},setEventCallback:u=>{a.eventCallback=u},setUninstallCallback:u=>{a.uninstallCallback=u},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{r.removed=!0,r.uninstallCallback?.()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):Ee.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const n=this._handlers[r];n.priorityIndex=r,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const n=this._handlersPriority[r];n.priorityIndex=r;let s=n.handler.hasSideEffects;if(!s){for(const a of n.handler.outgoingEventTypes)if(e.has(a)){s=!0;break}}if(s)for(const a of n.handler.incomingEventMatches){e.add(a.eventType);for(const u of a.keyModifiers)Vqe(u)||i.add(u)}n.active=s}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r){this._latestPointerType=e;const n=this._get("latestPointerLocation");if(n==null||n.x!==i||n.y!==r){const s=this._propertiesPool.get("latestPointerLocation");s.x=i,s.y=r,this._set("latestPointerLocation",s)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const s=i;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,n=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,r,n)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const n=()=>{if(!r){const u=new Set;this._activeKeyModifiers.forEach(p=>{u.add(p)}),this._activeKeyModifiers=u,r=!0}},s=(u,p)=>{p&&!this._activeKeyModifiers.has(u)?(n(),this._activeKeyModifiers.add(u)):!p&&this._activeKeyModifiers.has(u)&&(n(),this._activeKeyModifiers.delete(u))};if(e==="key-down"||e==="key-up"){const u=i.key;this._keyModifiers.has(u)&&s(u,e==="key-down")}const a=i.native;s("Alt",!(!a||!a.altKey)),s("Ctrl",!(!a||!a.ctrlKey)),s("Shift",!(!a||!a.shiftKey)),s("Meta",!(!a||!a.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new Wqe((e,i,r)=>this._setLatestPointer(e,i,r)),this._multiTouchHandler=new Xqe,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Zy.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Zy.INTERNAL)}_setPointerCapture(e,i,r,n){const s=e.name+"-"+i.priorityIndex,a=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,a),n?(a.add(s),a.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):a.has(s)&&(a.delete(s),a.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,n){this._emitInputEvent(0,e,i,r,n)}_emitInputEvent(e,i,r,n,s,a){const u=n!==void 0?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),p=s!==void 0&&s,y={event:new Jqe(i,r,u,a||this._activeKeyModifiers,p),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(y):this._doNewPropagation(y)}_doNewPropagation(e){this._currentPropagation={events:new SL,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:i,priorityIndex:r}=e.events.pop(),n=i.data?.eventId;if(!(n!=null&&this._stoppedPropagationEventIds.has(n)))for(e.currentHandler=this._handlersPriority[r];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!i.shouldStopPropagation()&&e.currentHandler.eventCallback?.(i),i.shouldStopPropagation()){n!=null&&this._stoppedPropagationEventIds.add(n);break}if(i.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:i,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const i=new SL;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const n of i.handler.incomingEventMatches){if(r.eventType!==n.eventType)continue;const s=r.keyModifiers.filter(a=>n.keyModifiers.includes(a));if(s.length===r.keyModifiers.length!=(s.length===n.keyModifiers.length))return r.keyModifiers.length>n.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let n=0;for(;n<i.length&&this._compareHandlerPriority(r,i[n])>=0;)n++;i.splice(n,0,r)}return i}get debug(){const e=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{e(()=>{this._onEventReceived(i,r)})},disablePointerCapture:e}}};_([T({readOnly:!0})],vh.prototype,"hasPendingInputs",null),_([T({constructOnly:!0})],vh.prototype,"eventSource",void 0),_([T({constructOnly:!0})],vh.prototype,"recognizers",void 0),_([T()],vh.prototype,"_latestPointerType",void 0),_([T()],vh.prototype,"latestPointerType",null),_([T()],vh.prototype,"multiTouchActive",null),_([T({readOnly:!0})],vh.prototype,"latestPointerLocation",void 0),_([T()],vh.prototype,"_paused",void 0),_([T({readOnly:!0})],vh.prototype,"updating",null),vh=_([Z("esri.views.input.InputManager")],vh);let Jqe=class{constructor(e,i,r,n,s){this.type=e,this.data=i,this.timestamp=r,this.modifiers=n,this.cancelable=s,this._propagationState=_y.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=_y.STOPPED}shouldStopPropagation(){return(this._propagationState&_y.STOPPED)!=0}async(e){this._propagationState|=_y.PAUSED;const i=(r,n)=>{this._propagationState&=~_y.PAUSED;const s=this._resumeCallback;if(this._resumeCallback=null,s&&s(),n)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&_y.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var _y;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(_y||(_y={}));const Zy={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let Yqe=class{};const Zqe=Yqe;function tf(t){return t!=null&&"open"in t&&"declaredClass"in t}function Bne(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const Kqe=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([Fe(()=>[this.ui,this.popup],([i,r],n)=>{const s="popup",a="manual";if(n){const[u,p]=n;u&&tf(p)&&(p.view=null,Bne(p)&&u.remove(p,s))}i&&tf(r)&&(r.view=this,Bne(r)&&i.add(r,{key:s,position:a,internal:!0}))},jr),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(!tf(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(tf(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),tf(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)})))},Zy.WIDGET)]),gS(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{ke(()=>import("./Popup-47ba054d.js"),["./Popup-47ba054d.js","./unitFormatUtils-7fb3d5de.js","./AttachmentInfo-6f2d2eca.js","./utils-af61b1ad.js","./executeQueryJSON-b46d6877.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./ReactiveSet-a030607c.js"],import.meta.url)})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if(tf(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void Ee.getLogger(this).error(new de("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){this._popupSetupTask?.abort(),tf(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,r){await this.when();const{location:n,queryArea:s,layerViewsAndGraphics:a,clientOnlyGraphics:u}=await this._prepareFetchPopupFeatures(i,r),p=Promise.resolve(u),y=this._queryLayerPopupFeatures(s,a,r),b=y.map(S=>S.promise);return{location:n,clientOnlyGraphics:u,allGraphicsPromise:z9e([p,...b]).then(S=>Array.from(new Set(S.flat()))),promisesPerLayerView:y}}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!tf(this.popup))return this._popupSetupTask=Pv(async i=>{const{default:r}=await ke(()=>import("./Popup-47ba054d.js"),["./Popup-47ba054d.js","./unitFormatUtils-7fb3d5de.js","./AttachmentInfo-6f2d2eca.js","./utils-af61b1ad.js","./executeQueryJSON-b46d6877.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./ReactiveSet-a030607c.js"],import.meta.url);if(oi(i),!this.popup||tf(this.popup))return;const n=this.popup;delete n.open,delete n.close,this.popup=new r(n)}),this._popupSetupTask.promise}_queryLayerPopupFeatures(i,r,n){return r.map(({layerView:s,graphics:a})=>{const u={clientGraphics:a,event:n?.event,signal:n?.signal,defaultPopupTemplateEnabled:n!=null&&!!n.defaultPopupTemplateEnabled},p=s.fetchPopupFeatures(i,u);return{layerView:s,promise:p}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(r!=null&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:n,queryArea:s,location:a}=await this._popupHitTestGraphics(i,r),u=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:p,clientOnlyGraphics:y}=this._graphicsPerFetchPopupLayerView(n,u);return{clientOnlyGraphics:y,layerViewsAndGraphics:p,queryArea:s,location:a}}async _popupHitTestGraphics(i,r){const n=await this.popupHitTest(i),s=n.results,a=n.mapPoint,u=s.filter(y=>y.type==="graphic"&&this._isValidPopupGraphic(y.graphic,r)),p=u.length?u[0].mapPoint:null;return{clientGraphics:u.map(y=>y.graphic),queryArea:a,location:a||p}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),this.graphicsView!=null&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return i!=null&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const n=[],s=new Map,a=r.map(u=>{const p=[];return"layer"in u?s.set(u.layer,p):s.set(u.graphics,p),{layerView:u,graphics:p}});for(const u of i){const p=s.get(u.layer)||s.get(u.sourceLayer)||null;p?p.push(u):n.push(u)}return{layerViewsAndGraphics:a,clientOnlyGraphics:n}}};return _([T({cast(i){return!i||tf(i)||typeof i=="object"&&(i.open=r=>(rS(Ee.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(r)),i.close=()=>(rS(Ee.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),i}})],e.prototype,"popup",void 0),_([T()],e.prototype,"popupEnabled",void 0),e=_([Z("esri.views.PopupView")],e),e},Vne={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function T2(t,e,i,r=O0){const n=new Dp(FY(r)),s=Ui.fromJSDate(t,{zone:n}),a=i==="decades"||i==="centuries"?"year":H2e(i);return i==="decades"&&(e*=10),i==="centuries"&&(e*=100),s.plus({[a]:e}).toJSDate()}function Gne(t,e,i=O0){const r=new Dp(FY(i)),n=Ui.fromJSDate(t,{zone:r});if(e==="decades"||e==="centuries"){const a=n.startOf("year"),{year:u}=a,p=u-u%(e==="decades"?10:100);return a.set({year:p}).toJSDate()}const s=H2e(e);return n.startOf(s).toJSDate()}function Qqe(t,e,i){return t===0?0:t*Vne[e]/Vne[i]}function H9t(t,e){return t&&e?t.intersection(e):t||e}function H2e(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var Fd;let Tu=Fd=class extends Ne{static get allTime(){return Hne}static get empty(){return eWe}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?.getTime()??null}get isAllTime(){return this.equals(Fd.allTime)}get isEmpty(){return this.equals(Fd.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?.getTime()??null}clone(){return new Fd({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=this.start?.getTime()??this.start,i=this.end?.getTime()??this.end,r=t.start?.getTime()??t.start,n=t.end?.getTime()??t.end;return e===r&&i===n}expandTo(t,e=O0){if(this.isEmpty||this.isAllTime)return this.clone();let i=this.start;i&&(i=Gne(i,t,e));let r=this.end;if(r){const n=Gne(r,t,e);r=r.getTime()===n.getTime()?n:T2(n,1,t,e)}return new Fd({start:i,end:r})}intersection(t){if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return Fd.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=this.start?.getTime()??-1/0,i=this.end?.getTime()??1/0,r=t.start?.getTime()??-1/0,n=t.end?.getTime()??1/0;let s,a;if(r>=e&&r<=i?s=r:e>=r&&e<=n&&(s=e),i>=r&&i<=n?a=i:n>=e&&n<=i&&(a=n),s!=null&&a!=null&&!isNaN(s)&&!isNaN(a)){const u=new Fd;return u.start=s===-1/0?null:new Date(s),u.end=a===1/0?null:new Date(a),u}return Fd.empty}offset(t,e,i=O0){if(this.isEmpty||this.isAllTime)return this.clone();const r=new Fd,{start:n,end:s}=this;return n!=null&&(r.start=T2(n,t,e,i)),s!=null&&(r.end=T2(s,t,e,i)),r}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return Hne.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,i=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new Fd({start:e,end:i})}};_([T({type:Date,json:{write:{allowNull:!0}}})],Tu.prototype,"end",void 0),_([rt("end")],Tu.prototype,"readEnd",null),_([ot("end")],Tu.prototype,"writeEnd",null),_([T({readOnly:!0,json:{read:!1}})],Tu.prototype,"isAllTime",null),_([T({readOnly:!0,json:{read:!1}})],Tu.prototype,"isEmpty",null),_([T({type:Date,json:{write:{allowNull:!0}}})],Tu.prototype,"start",void 0),_([rt("start")],Tu.prototype,"readStart",null),_([ot("start")],Tu.prototype,"writeStart",null),Tu=Fd=_([Z("esri.TimeExtent")],Tu);const Hne=new Tu,eWe=new Tu({start:void 0,end:void 0}),z0=Tu;let HA=class extends BA{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};_([RJ({Type:Fp,ensureType:os(Fp)})],HA.prototype,"itemType",void 0),HA=_([Z("esri.support.GraphicsCollection")],HA);let ey=class extends Ke{constructor(e){super(e),this.view=null,this.baseLayerViews=new Dt,this.referenceLayerViews=new Dt,this._loadingHandle=Fe(()=>this.view?.map?.basemap,i=>{i&&i.load().catch(()=>{})},jr)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){if(this.view&&this.view.suspended)return!1;const e=this.view?.map?.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(i=>i.updating)||this.referenceLayerViews.some(i=>i.updating))}};_([T({constructOnly:!0})],ey.prototype,"view",void 0),_([T({readOnly:!0})],ey.prototype,"baseLayerViews",void 0),_([T({readOnly:!0})],ey.prototype,"referenceLayerViews",void 0),_([T({readOnly:!0})],ey.prototype,"suspended",null),_([T({type:Boolean,readOnly:!0})],ey.prototype,"updating",null),ey=_([Z("esri.views.BasemapView")],ey);function tWe(t){return"tryRecycleWith"in t}let iWe=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=Ys(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,qs(this._controller.signal,()=>{const n=new de("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(n)})}tryRecycle(e){if(!this.done||!this.layerView||!tWe(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let n=0;n<e.length;n++){const s=e[n];if(s.type!==i)continue;const a=this.layerView.tryRecycleWith(s,{signal:r});if(a){e.splice(n,1),this.layer=s;const u=this.layerView,p=u.view;return this.promise=Promise.race([a.then(()=>(oi(this._controller.signal),s.emit("layerview-destroy",{view:p,layerView:u}),p.emit("layerview-destroy",{view:p,layerView:u}),s.emit("layerview-create",{view:p,layerView:u}),p.emit("layerview-create",{view:p,layerView:u}),u)),new Promise((y,b)=>qs(this._controller.signal,()=>b(or())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:r}=this;this._map=r.map;try{let n,s;if(await i.load({signal:e}),i.prefetchResources&&await i.prefetchResources({signal:e}),nWe(i))n=await i.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new de("layer:view-not-supported","No layerview implementation was found");const p=await this.layerViewImporter.importLayerView(i);oi(e),n="default"in p?new p.default({layer:i,view:r}):new p({layer:i,view:r})}const a=()=>{s=nn(s),n.destroyed||n.destroy(),n.layer=null,n.parent=null,n.view=null,this.done=!0};s=qs(e,a),oi(e);try{await n.when()}catch(p){throw a(),p}if(!this._map?.allLayers?.includes(i))return a(),void this._deferred.reject(new de("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=n,i.emit("layerview-create",{view:r,layerView:n}),r.emit("layerview-create",{layer:i,layerView:n}),this.done=!0,this._deferred.resolve(n)}catch(n){i.emit("layerview-create-error",{view:r,error:n}),r.emit("layerview-create-error",{layer:i,error:n}),this.done=!0,this._deferred.reject(new de("layerview:create-error","layerview creation failed",{layer:i,error:n}))}}},_h=class extends Ke{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Cp,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const i=this.view.map?.allLayers;if(i)for(const r of i)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=Ys(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(yw(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,n=[],s=this.view.ready,a=p=>{if(p!=null){for(const y of p)if(y){r.add(y);const b=this._layerLayerViewInfoMap.get(y);b&&s?b.start():b||this._recyclingInfoMap.has(y)||n.push(y),"layers"in y&&y.layers&&a(y.layers)}}};for(const p of this._rootCollectionNames)a(xp(this,p));for(const[p,y]of this._layerLayerViewInfoMap)if(!r.has(p)){this._layerLayerViewInfoMap.delete(y.layer);const b=y.tryRecycle(n);b?(this.notifyChange("updating"),this._recyclingInfoMap.set(y.layer,y),b.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(y.layer),this._layerLayerViewInfoMap.set(y.layer,y),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(y.layer),y.destroy(),this._reschedule()})):y.destroy()}for(const[p,y]of this._recyclingInfoMap)r.has(p)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(y.layer),y.destroy());for(const p of n)this._createLayerView(p);this._refreshCollections();const u=[i?.ground?.layers,i?.basemap?.baseLayers,i?.basemap?.referenceLayers,i?.layers].filter(p=>!!p);r.forEach(p=>"layers"in p&&u.push(p.layers)),this.addHandles(u.map(p=>this._watchUpdatingTracking.addOnCollectionChange(()=>p,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([ga(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),Fe(()=>{const e=this.view,i=e?.map;return[i?.basemap,i?.ground,i?.layers,e?.ready]},()=>this._reschedule(),Ur)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),lF(this._recyclingInfoMap),lF(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(or()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Iu(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||(lF(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new de("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(xp(this,e),xp(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void(i&&i.removeAll());let n=0;for(const s of e){const a=this._layerLayerViewInfoMap.get(s);if(!a?.layerView)continue;const u=a.layerView;u.layer=s,u.parent=r,i.at(n)!==u&&i.splice(n,0,u),s.layers&&this._populateLayerViewsOwners(s.layers,u.layerViews,u),n+=1}n<i.length&&i.splice(n,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new iWe(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(qn(r)||r.name==="cancelled:layerview-create")||Ee.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};_([T()],_h.prototype,"_workPromise",void 0),_([T({readOnly:!0})],_h.prototype,"_watchUpdatingTracking",void 0),_([T({readOnly:!0})],_h.prototype,"_layersToLayerViews",null),_([T({readOnly:!0})],_h.prototype,"_rootCollectionNames",null),_([T()],_h.prototype,"layerViewImporter",void 0),_([T()],_h.prototype,"supportsGround",void 0),_([T({readOnly:!0})],_h.prototype,"updating",null),_([T({readOnly:!0})],_h.prototype,"updatingRemaining",null),_([T({constructOnly:!0})],_h.prototype,"view",void 0),_h=_([Z("esri.views.LayerViewManager")],_h);const rWe=_h;function nWe(t){return"createLayerView"in t&&t.createLayerView!=null}let du=class extends Ke{constructor(e){super(e),this.factor=1.5,this.offset=td(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};_([T({type:Number})],du.prototype,"factor",void 0),_([T({nonNullable:!0})],du.prototype,"offset",void 0),_([T()],du.prototype,"position",void 0),_([T({type:Number,range:{min:0}})],du.prototype,"size",void 0),_([T()],du.prototype,"maskUrl",void 0),_([T()],du.prototype,"maskEnabled",void 0),_([T()],du.prototype,"overlayUrl",void 0),_([T()],du.prototype,"overlayEnabled",void 0),_([T({readOnly:!0})],du.prototype,"version",null),_([T({type:Boolean})],du.prototype,"visible",void 0),du=_([Z("esri.views.Magnifier")],du);const q2e=du;let O5=class extends sn(Ke){constructor(e){super(e),this.accentColor=new mt([255,127,0]),this.textColor=new mt([255,255,255])}};_([T({type:mt,nonNullable:!0})],O5.prototype,"accentColor",void 0),_([T({type:mt,nonNullable:!0})],O5.prototype,"textColor",void 0),O5=_([Z("esri.views.Theme")],O5);const IG=O5;var qne;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(qne||(qne={}));const W2e=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],X2e={};function J2e(t){return!!X2e[t]}function sWe(t){for(const e of t)if(!J2e(e))return!1;return!0}W2e.forEach(t=>{X2e[t]=!0});let oWe=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},n)=>this.inputManager?.installHandlers(n,[i],r))}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>this.inputManager?.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,n){const s=Array.isArray(e)?e:e.split(",");if(!sWe(s))return s.some(J2e)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let a,u;Array.isArray(i)?u=i:(a=i,u=[]),typeof r=="function"?a=r:n=r,n=n??Zy.DEFAULT;const p=this._createUniqueGroupName(),y=new aWe(this.view,s,u,a);this._handlers.set(p,{handler:y,priority:n});for(const b of s){const S=this._handlerCounts.get(b)||0;this._handlerCounts.set(b,S+1)}return this.inputManager&&this.inputManager.installHandlers(p,[y],n),Sr(()=>this._removeHandler(p,s))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const n=this._handlerCounts.get(r);n===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):n===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,n-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},aWe=class extends Qo{constructor(e,i,r,n){super(!0),this._latestDragStart=void 0,this.view=e;for(const s of i)switch(s){case"click":this.registerIncoming("click",r,a=>n(this._wrapClick(a)));break;case"double-click":this.registerIncoming("double-click",r,a=>n(this._wrapDoubleClick(a)));break;case"immediate-click":this.registerIncoming("immediate-click",r,a=>n(this._wrapImmediateClick(a)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,a=>n(this._wrapImmediateDoubleClick(a)));break;case"hold":this.registerIncoming("hold",r,a=>n(this._wrapHold(a)));break;case"drag":this.registerIncoming("drag",r,a=>{const u=this._wrapDrag(a);u&&n(u)});break;case"key-down":this.registerIncoming("key-down",r,a=>n(this._wrapKeyDown(a)));break;case"key-up":this.registerIncoming("key-up",r,a=>n(this._wrapKeyUp(a)));break;case"pointer-down":this.registerIncoming("pointer-down",r,a=>n(this._wrapPointer(a,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,a=>n(this._wrapPointer(a,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,a=>n(this._wrapPointer(a,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,a=>n(this._wrapPointerDrag(a)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,a=>n(this._wrapMouseWheel(a)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,a=>n(this._wrapPointer(a,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,a=>n(this._wrapPointer(a,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,a=>{n(this._wrapGamepad(a))});break;case"focus":this.registerIncoming("focus",r,a=>{n(this._wrapFocus(a))});break;case"blur":this.registerIncoming("blur",r,a=>{n(this._wrapBlur(a))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:i=>e.async(i),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:i=>e.async(i),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:a,native:u,eventId:p}=e.data,{cancelable:y,timestamp:b}=e;return{type:"click",pointerType:i,button:r,buttons:n,x:s,y:a,native:u,timestamp:b,screenPoint:td(s,a),mapPoint:this._getMapPoint(s,a),eventId:p,cancelable:y,stopPropagation:()=>e.stopPropagation(),async:S=>e.async(S),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:a,native:u,eventId:p}=e.data,{cancelable:y,timestamp:b}=e;return{type:"double-click",pointerType:i,button:r,buttons:n,x:s,y:a,native:u,timestamp:b,mapPoint:this._getMapPoint(s,a),eventId:p,cancelable:y,stopPropagation:()=>e.stopPropagation(),async:S=>e.async(S),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:a,native:u,eventId:p}=e.data,y=u.pointerId,{cancelable:b,timestamp:S}=e;return{type:"immediate-click",pointerId:y,pointerType:i,button:r,buttons:n,x:s,y:a,native:u,timestamp:S,mapPoint:this._getMapPoint(s,a),eventId:p,cancelable:b,stopPropagation:()=>e.stopPropagation(),async:C=>e.async(C),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:a,native:u,eventId:p}=e.data,y=u.pointerId,{cancelable:b,timestamp:S}=e;return{type:"immediate-double-click",pointerId:y,pointerType:i,button:r,buttons:n,x:s,y:a,native:u,timestamp:S,mapPoint:this._getMapPoint(s,a),eventId:p,cancelable:b,stopPropagation:()=>e.stopPropagation(),async:C=>e.async(C),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:i,button:r,buttons:n,x:s,y:a,native:u}=e.data,{cancelable:p,timestamp:y}=e;return{type:"hold",pointerType:i,button:r,buttons:n,x:s,y:a,native:u,timestamp:y,mapPoint:this._getMapPoint(s,a),cancelable:p,stopPropagation:()=>e.stopPropagation(),async:b=>e.async(b),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,i){return this.view.toMap(td(e,i),{exclude:[]})}_wrapDrag(e){const i=e.data,{x:r,y:n}=i.center,{action:s,pointerType:a,button:u}=i;if(s==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const p=i.pointer.native,y=i.buttons,{cancelable:b,timestamp:S}=e,C={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return s==="end"&&(this._latestDragStart=void 0),{type:"drag",action:s,x:r,y:n,origin:C,pointerType:a,button:u,buttons:y,radius:i.radius,angle:wl(i.angle),native:p,timestamp:S,cancelable:b,stopPropagation:()=>e.stopPropagation(),async:O=>e.async(O),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:i,repeat:r,native:n}=e.data,{cancelable:s,timestamp:a}=e;return{type:"key-down",key:i,repeat:r,native:n,timestamp:a,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:i,native:r}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-up",key:i,native:r,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,i){const{x:r,y:n,button:s,buttons:a,native:u,eventId:p}=e.data,y=u.pointerId,b=u.pointerType,{cancelable:S,timestamp:C}=e;return{type:i,x:r,y:n,pointerId:y,pointerType:b,button:s,buttons:a,native:u,timestamp:C,eventId:p,cancelable:S,stopPropagation:()=>e.stopPropagation(),async:O=>e.async(O),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:i,y:r,buttons:n,native:s,eventId:a}=e.data.currentEvent,{button:u}=e.data.startEvent,p=e.data.startEvent.native.pointerId,y=e.data.startEvent.native.pointerType,b=e.data.action,S={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:C,timestamp:O}=e;return{type:"pointer-drag",x:i,y:r,pointerId:p,pointerType:y,button:u,buttons:n,action:b,origin:S,native:s,timestamp:O,eventId:a,cancelable:C,stopPropagation:()=>e.stopPropagation(),async:P=>e.async(P),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:i,data:r,timestamp:n}=e,{x:s,y:a,deltaY:u,native:p}=r;return{type:"mouse-wheel",x:s,y:a,deltaY:u,native:p,timestamp:n,cancelable:i,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:i,state:r,device:n}=e.data,{cancelable:s,timestamp:a}=e,{buttons:u,axes:p}=r;return{type:"gamepad",device:n,timestamp:a,action:i,buttons:u,axes:p,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}};var eO,Wne,Xne;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(eO||(eO={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(Wne||(Wne={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(Xne||(Xne={}));function lWe(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return Ee.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function $G(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(eO.USER)&&t.getEditableFlag(eO.MANAGER)}function Pf(t){return td(t.x,t.y)}function eIt(t){return Dn(t.x,t.y)}function Y2e(t,e){const i=(t instanceof HTMLElement?t:t.surface)?.getBoundingClientRect();return i?td(e.clientX-i.left,e.clientY-i.top):td(0,0)}function Jne(t,e){return e instanceof Event?Y2e(t,e):Pf(e)}function Yne(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let cWe=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":Zne(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Kne(e))break;const n=Pf(e),s=this._intersect(n,e.pointerType,i.forEachTool);if(s==null)break;const a=s.manipulator,u=s.tool;a==null||u==null||!a.interactive||a.grabbable&&a.grabbableForEvent(e)||!a.grabbing||a.dragging||this._ungrabManipulatorBeforeDragging(a,e,i),a!=null&&u!=null&&a.interactive&&a.grabbable&&a.grabbableForEvent(e)&&!a.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:a,tool:u,start:n,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(s.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:n}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!Kne(e))break;const n=this._grabbedManipulators.get(e.pointerId),s=n?.manipulator,a=n?.tool;if(s==null||a==null)break;const u=Pf(e);u.x=Je(u.x,0,i.view.width),u.y=Je(u.y,0,i.view.height);const p=n.start,y=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,y?s.events.emit("drag",{action:"update",start:p,screenPoint:u}):s.events.emit("drag",{action:"start",start:p,screenPoint:u,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:a,manipulator:s,start:p}));break;case"end":s.dragging=!1,y&&s.events.emit("drag",{action:"end",start:p,screenPoint:u}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const n=Pf(e),s=this._intersect(n,e.pointerType,i.forEachTool);if(uWe(e)||i.forEachTool(y=>{if((s==null||s.tool!==y||y.automaticManipulatorSelection)&&y.manipulators){let b=!1;y.manipulators.forEach(({manipulator:S})=>{S.selected&&(S.selected=!1,b=!0)}),b&&y.onManipulatorSelectionChanged&&y.onManipulatorSelectionChanged()}}),s==null)break;const{manipulator:a,tool:u}=s;if(!a.interactive)break;a.selectable&&u.automaticManipulatorSelection&&(a.selected=!a.selected,u.onManipulatorSelectionChanged&&u.onManipulatorSelectionChanged());const p=e.native.shiftKey;a.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:p,stopPropagation:r}),BF(a,r);break}case"click":{const n=Pf(e),s=this._intersect(n,e.pointerType,i.forEachTool),a=s?.manipulator;if(a==null||!a.interactive)break;const u=e.native.shiftKey;a.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:u}),r();break}case"double-click":{const n=Pf(e),s=this._intersect(n,e.pointerType,i.forEachTool),a=s!=null?s.manipulator:null;if(a==null||!a.interactive)break;const u=e.native.shiftKey;a.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:u,stopPropagation:r}),BF(a,r);break}case"immediate-double-click":{const n=Pf(e),s=this._intersect(n,e.pointerType,i.forEachTool),a=s!=null?s.manipulator:null;if(a==null||!a.interactive)break;const u=e.native.shiftKey;a.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:u,stopPropagation:r}),BF(a,r);break}}this._onFocusChange(i.forEachTool)}_ungrabManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:Pf(i)}),this._grabbedManipulators.forEach(({manipulator:n},s)=>{n===e&&this._grabbedManipulators.delete(s)}),this._afterManipulatorUngrab(r.setActiveTool)}_handlePointerEnd(e,i){const r=this._grabbedManipulators.get(e.pointerId)?.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Pf(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(i.setActiveTool))}_cursorFromMap(e){let i=null;return Iu(e,({manipulator:r})=>!(r==null||!r.interactive)&&(r.grabbing&&r.grabCursor?(i=r.grabCursor,!0):!!r.cursor&&(i=r.cursor,!0))),i}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:n})=>{i.add(n)}),this._hoveredManipulators.forEach(({tool:n})=>{r.add(n)}),e(n=>{n.hasGrabbedManipulators=i.has(n),n.hasHoveredManipulators=r.has(n);const s=this._grabbedManipulators.values(),a=l9e(s,({tool:u})=>u===n);n.firstGrabbedManipulator=a!=null?a.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:r},n=!0,s){const a=(u,p)=>u===e&&(s==null||s===p);this._grabbedManipulators.forEach(({tool:u,manipulator:p,pointerType:y},b)=>{a(u,p)&&(this._grabbedManipulators.delete(b),p.grabbing=!1,p.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:y}))}),this._draggedManipulators.forEach(({tool:u,manipulator:p},y)=>{a(u,p)&&(this._draggedManipulators.delete(y),p.dragging=!1,p.events.emit("drag",{action:"cancel"}))}),n&&this._hoveredManipulators.forEach(({tool:u,manipulator:p},y)=>{a(u,p)&&(this._hoveredManipulators.delete(y),p.hovering=!1)}),this._afterManipulatorUngrab(r),this._onFocusChange(i)}_intersect(e,i,r){let n=null;return r(s=>{if(s.manipulators==null||!$G(s))return!1;const a=s.manipulators.intersect(e,i);return a!=null&&(n={tool:s,manipulator:a},!0)}),n}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(td(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!Zne(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Pf(e),e.pointerId,e.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(e,i,r,n){let s=this._intersect(e,r,n);const a=this._hoveredManipulators.get(i)?.manipulator;s==null||s.manipulator.interactive||(s=null),s!=null&&a===s.manipulator||(a!=null&&(a.hovering=!1),s!=null?(s.manipulator.hovering=!0,this._hoveredManipulators.set(i,s)):this._hoveredManipulators.delete(i),this._onFocusChange(n))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function Zne(t){return t==="mouse"}function Kne(t){return t.pointerType!=="mouse"||t.button===0}function uWe(t){return!!t.native.shiftKey}function BF(t,e){t?.consumesClicks&&e()}const Qne="attached",VF="tools",ese=1e3;let If=class extends Ke{constructor(e){super(e),this._updatingHandles=new Cp,this._clock=FO,this._manipulatorState=new cWe,this.tools=new Dt,this.cursor=null,this._interacting=!1,this._interactingTimeout=ese,this._interactingTimeoutHandle=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.addHandles([this.view.on(W2e,e=>{this._handleInputEvent(e)},Zy.TOOL),...lWe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void Ee.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const n=$G(r);this.activeTool!=null&&n||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!n)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=nn(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){this.view.type==="3d"?this.addHandles([Fe(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider?.on("elevation-change",e=>this._forEachManipulator(i=>i.onElevationChange(e)))],Qne):this.addHandles(Fe(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(Qne),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))})}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(n=>{!i&&n.visible&&n.handleInputEvent(r)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(VF),this._forEachTool(e=>{if(e instanceof Ke){const i=Fe(()=>[e.cursor,e.visible,e.editable],()=>{$G(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(i,VF)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],VF)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(eO.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(i=>!(i.cursor==null||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){const e=this;return{setClock:i=>this._clock=i,set interactingTimeoutEnabled(i){e._interactingTimeout=i?ese:0},get interactingTimeoutEnabled(){return e._interactingTimeout!==0}}}};_([T({constructOnly:!0,nonNullable:!0})],If.prototype,"view",void 0),_([T({value:null})],If.prototype,"activeTool",null),_([T({readOnly:!0,type:Dt})],If.prototype,"tools",void 0),_([T({readOnly:!0})],If.prototype,"cursor",void 0),_([T({readOnly:!0})],If.prototype,"updating",null),_([T()],If.prototype,"_interacting",void 0),_([T({readOnly:!0})],If.prototype,"interacting",null),If=_([Z("esri.views.ToolViewManager")],If);let bx=class extends Ke{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":hWe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return dWe[this.deviceType]}};_([T({nonNullable:!0,readOnly:!0})],bx.prototype,"nativeIndex",void 0),_([T({type:String,readOnly:!0})],bx.prototype,"deviceType",null),_([T({type:Number,readOnly:!0})],bx.prototype,"axisThreshold",null),bx=_([Z("esri.views.input.gamepad.GamepadInputDevice")],bx);const hWe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),dWe={standard:.15,spacemouse:.025,unknown:0},GZ=bx;let R5=class extends Ke{constructor(...e){super(...e),this.devices=new Dt,this.enabledFocusMode="document"}};_([T({type:Dt.ofType(GZ),readOnly:!0})],R5.prototype,"devices",void 0),_([T({type:["document","view","none"]})],R5.prototype,"enabledFocusMode",void 0),R5=_([Z("esri.views.input.gamepad.GamepadSettings")],R5);const pWe=R5;let a$=class extends Ke{constructor(){super(...arguments),this.gamepad=new pWe}};_([T({readOnly:!0})],a$.prototype,"gamepad",void 0),a$=_([Z("esri.views.input.Input")],a$);const fWe=a$;let ty=class extends Ke{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};_([T({type:Boolean,nonNullable:!0})],ty.prototype,"enabled",void 0),_([T({type:GZ})],ty.prototype,"device",void 0),_([T({type:["pan","zoom"],nonNullable:!0})],ty.prototype,"mode",void 0),_([T({type:["forward-down","forward-up"],nonNullable:!0})],ty.prototype,"tiltDirection",void 0),_([T({type:Number,nonNullable:!0})],ty.prototype,"velocityFactor",void 0),ty=_([Z("esri.views.navigation.gamepad.GamepadSettings")],ty);const Z2e=ty;let ib=class extends Ke{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new Z2e,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};_([T({type:Boolean})],ib.prototype,"browserTouchPanEnabled",void 0),_([T({type:Z2e,nonNullable:!0})],ib.prototype,"gamepad",void 0),_([T({type:Boolean})],ib.prototype,"momentumEnabled",void 0),_([T({type:Boolean})],ib.prototype,"mouseWheelZoomEnabled",void 0),ib=_([Z("esri.views.navigation.Navigation")],ib);const K2e=ib;let LG,GF=null;async function mWe(t){GF||(GF=ke(()=>Promise.resolve().then(()=>k0t),void 0,import.meta.url).then(e=>LG=e)),await GF,oi(t)}async function Q2e(t,e,i,r){if(!t)return null;const n=t.spatialReference;return KO()||$p(n,e)?F0(t,e):LG?LG.projectGeometry(t,e,i,r):(await Promise.race([mWe(r),bS(r)]),Q2e(t,e,i,r))}let Tn=class extends Ke{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Vc(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){const e=this.map?.(),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),i}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;let r=null;for(const s of e){const a=this._getSupportedSpatialReferences(s);if(a.length>0){const u=this._narrowDownSpatialReferenceCandidates(r,a);u!=null&&(r=u)}if(r!=null&&r.length===1)break}if(i&&(r==null||r.length!==1))return{updating:!0};const n=this._pickSpatialReferenceCandidate(r);return{spatialReference:n!=null?n.spatialReference:null,viewingMode:n!=null?n.viewingMode:null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:i}=this._collectLayers([{parent:this.map?.()?.basemap,layers:this.map?.()?.basemap?.baseLayers},{layers:this.map?.()?.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const r=e[0].tileInfo;return{tileInfo:r&&r.spatialReference.equals(this.spatialReference)?r:null,updating:!1}}return{updating:i}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;for(const r of e)if(G7e(r)){const n=Y1e(r);if(n)return{heightModelInfo:n,vcsWkid:r.spatialReference?.vcsWkid,latestVcsWkid:r.spatialReference?.latestVcsWkid,updating:!1}}return{updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,i=e.updating,r=[];for(const n of e.layers){const s="fullExtents"in n&&n.fullExtents||(n.fullExtent!=null?[n.fullExtent]:[]),a=this.requiresExtentInSpatialReference?null:s[0],u=s.find(p=>p.spatialReference.equals(this.spatialReference))??a;if(u)return{candidates:[{extent:u,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const p of s)r.push({extent:p,layer:n})}return{candidates:r,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),n=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&n.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=Vc(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:n.clone(),task:Pv(async s=>{try{const a=await Q2e(r.extent,n,"portalItem"in r.layer?r.layer.portalItem:void 0,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:a}}catch{if(Ms(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const r=[],n=(s,a)=>s!=null?a!=null?s===a&&s:s:a;for(const s of e)for(const a of i){if(!s.spatialReference.equals(a.spatialReference))continue;const u=n(s.viewingMode,a.viewingMode);if(u!==!1){r.push({spatialReference:s.spatialReference,viewingMode:u});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i!=null?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==ht.Local)&&(e=e.filter(({viewingMode:r})=>r!==ht.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const n of i){const s=this.getSpatialReferenceSupport({spatialReference:n,layer:e});if(s!=null){const a=s.constraints!=null?s.constraints:[{spatialReference:n,viewingMode:null}];for(const{spatialReference:u,viewingMode:p}of a)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!u.equals(this.userSpatialReference)||r.push({spatialReference:u,viewingMode:p})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e){if(this._loadMaybe(this.map?.())!=="loaded")return{layers:[],updating:!0};const i=new gWe;for(const r of e)if(this._collectCollection(r,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":i.updating||i.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{qn(i)||console.log(i)}),"loading"):e.loadStatus:"loaded"}};_([T()],Tn.prototype,"required",void 0),_([T({constructOnly:!0})],Tn.prototype,"map",void 0),_([T({constructOnly:!0})],Tn.prototype,"getSpatialReferenceSupport",void 0),_([T()],Tn.prototype,"defaultSpatialReference",void 0),_([T()],Tn.prototype,"userSpatialReference",void 0),_([T()],Tn.prototype,"sourcePreloadCount",void 0),_([T()],Tn.prototype,"priorityCollection",void 0),_([T()],Tn.prototype,"requiresExtentInSpatialReference",void 0),_([T()],Tn.prototype,"suspended",void 0),_([T({readOnly:!0})],Tn.prototype,"ready",null),_([T({readOnly:!0})],Tn.prototype,"heightModelInfoReady",null),_([T({readOnly:!0})],Tn.prototype,"spatialReference",null),_([T({readOnly:!0})],Tn.prototype,"extent",null),_([T({readOnly:!0})],Tn.prototype,"heightModelInfo",null),_([T({readOnly:!0})],Tn.prototype,"vcsWkid",null),_([T({readOnly:!0})],Tn.prototype,"latestVcsWkid",null),_([T({readOnly:!0})],Tn.prototype,"viewingMode",null),_([T({readOnly:!0})],Tn.prototype,"tileInfo",null),_([T({readOnly:!0})],Tn.prototype,"mapCollections",null),_([T({readOnly:!0})],Tn.prototype,"_allLayers",null),_([T({readOnly:!0})],Tn.prototype,"_spatialReferenceTask",null),_([T({readOnly:!0})],Tn.prototype,"_tileInfoTask",null),_([T({readOnly:!0})],Tn.prototype,"_heightModelInfoTask",null),_([T({readOnly:!0})],Tn.prototype,"_extentCandidatesTask",null),_([T()],Tn.prototype,"_extentTask",null),_([T()],Tn.prototype,"_projectExtentTask",void 0),Tn=_([Z("esri.views.support.DefaultsFromMap")],Tn);let gWe=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var M5;let ui=M5=class extends Xn.EventedMixin(GO(Ke)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new Dg,this.updatingHandles=new Cp,this.allLayerViews=new F4({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:vWe}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new HA,this.analyses=new PS,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Dt,this.magnifier=new q2e,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new fWe,this.navigation=new K2e,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new oWe(this),this.persistableViewModels=new Dt,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(Fe(()=>this.preconditionsReady,e=>{e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,M5.views.add(this)):(this._lockedSpatialReference=null,M5.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?(this.toolViewManager?.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown()):e&&!this.ready&&(this._startup(),this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach())},$r))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,gS(()=>this.ready)))),this.basemapView=new ey({view:this}),this.layerViewManager=new rWe({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new If({view:this}),this._setupSpatialReferenceLogger(),this.addHandles([Fe(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),Fe(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),Fe(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.addHandles([Fe(()=>this.defaultsFromMap?.ready,e=>{const i=this.map?.allLayers.length>0;if(e&&!this.spatialReference&&i){if(t!=null)return;const r=Sr(()=>t=Vc(t));t=Pv(async n=>{try{await R4(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{t=null}Ee.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(r,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){this.destroyed||(M5.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=ct(this.graphics),this.analyses=ct(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),ct(this.analysisViewManager),this.toolViewManager=ct(this.toolViewManager),this.layerViewManager=ct(this.layerViewManager),this.basemapView=ct(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach(t=>t.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=ct(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return Ee.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Tn({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Ip.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t?.destroyed&&(Ee.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),Ip.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get spatialReference(){let t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;return t&&this.defaultsFromMap?.required?.heightModelInfo&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!Wn(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??O0}set timeZone(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(r=>r.toLowerCase()));this._userTimeZone=t,t===O0||t===ES||e.has(t.toLowerCase())||i.has(t.toLowerCase())||Ee.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){return this.toolViewManager?.cursor??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new IG}whenLayerView(t){return this.layerViewManager?.whenLayerView(t)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}getDefaultTimeZone(){return null}importLayerView(t){throw new de("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&Ee.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(Qu(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};ui.views=new Dt,_([T()],ui.prototype,"_userSpatialReference",void 0),_([T()],ui.prototype,"activeTool",null),_([T({readOnly:!0})],ui.prototype,"allLayerViews",void 0),_([T()],ui.prototype,"groundView",void 0),_([T()],ui.prototype,"animation",null),_([T()],ui.prototype,"basemapView",void 0),_([T()],ui.prototype,"center",null),_([T({readOnly:!0})],ui.prototype,"_defaultsFromMapSettings",null),_([T()],ui.prototype,"defaultsFromMap",null),_([T()],ui.prototype,"fatalError",void 0),_([T({type:rr})],ui.prototype,"extent",null),_([T(hG(HA,"graphics"))],ui.prototype,"graphics",void 0),_([T(hG(PS,"analyses"))],ui.prototype,"analyses",void 0),_([T({readOnly:!0,type:$v})],ui.prototype,"heightModelInfo",null),_([T({readOnly:!0})],ui.prototype,"interacting",null),_([T({readOnly:!0})],ui.prototype,"navigating",null),_([T({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],ui.prototype,"preconditionsReady",null),_([T({readOnly:!0})],ui.prototype,"typeSpecificPreconditionsReady",void 0),_([T({type:Dt,readOnly:!0})],ui.prototype,"layerViews",void 0),_([T()],ui.prototype,"resolution",null),_([T({type:q2e})],ui.prototype,"magnifier",void 0),_([T({value:null,type:v1e})],ui.prototype,"map",null),_([T()],ui.prototype,"padding",void 0),_([T({readOnly:!0})],ui.prototype,"ready",void 0),_([T({type:dt})],ui.prototype,"spatialReference",null),_([T()],ui.prototype,"spatialReferenceWarningDelay",void 0),_([T()],ui.prototype,"stationary",null),_([T({readOnly:!0})],ui.prototype,"supportsGround",void 0),_([T({type:z0})],ui.prototype,"timeExtent",void 0),_([T({type:String,nonNullable:!0})],ui.prototype,"timeZone",null),_([T()],ui.prototype,"tools",null),_([T()],ui.prototype,"toolViewManager",void 0),_([T({readOnly:!0})],ui.prototype,"type",void 0),_([T({type:Number})],ui.prototype,"scale",void 0),_([T({readOnly:!0})],ui.prototype,"updating",void 0),_([T({readOnly:!0})],ui.prototype,"initialExtentRequired",void 0),_([T({readOnly:!0})],ui.prototype,"initialExtent",null),_([T()],ui.prototype,"cursor",null),_([T({readOnly:!0})],ui.prototype,"input",void 0),_([T({type:K2e,nonNullable:!0})],ui.prototype,"navigation",void 0),_([T()],ui.prototype,"layerViewManager",void 0),_([T()],ui.prototype,"analysisViewManager",void 0),_([T()],ui.prototype,"width",void 0),_([T()],ui.prototype,"height",void 0),_([T({readOnly:!0})],ui.prototype,"resizing",void 0),_([T({value:null,readOnly:!0})],ui.prototype,"size",null),_([T({readOnly:!0})],ui.prototype,"suspended",void 0),_([T({readOnly:!0})],ui.prototype,"viewEvents",void 0),_([T({readOnly:!0})],ui.prototype,"persistableViewModels",void 0),_([T()],ui.prototype,"_isValid",void 0),_([T()],ui.prototype,"_readyCycleForced",void 0),_([T()],ui.prototype,"_lockedSpatialReference",void 0),_([T()],ui.prototype,"_userTimeZone",void 0),_([T()],ui.prototype,"_lockedTimeZone",void 0),_([T({type:IG})],ui.prototype,"theme",void 0),_([T({readOnly:!0,type:IG})],ui.prototype,"effectiveTheme",null),ui=M5=_([Z("esri.views.View")],ui);const yWe=ui;function vWe(t){return t.layerViews}let iy=class extends G6{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=Ys(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new de("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,i){i||(i=Yc(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};_([T({readOnly:!0})],iy.prototype,"done",null),_([T({readOnly:!0,type:String})],iy.prototype,"state",void 0),_([T()],iy.prototype,"target",void 0),iy=_([Z("esri.views.ViewAnimation")],iy),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(iy||(iy={}));const NS=iy,aC=()=>ke(()=>import("./TileLayerView3D-a5beb811.js"),["./TileLayerView3D-a5beb811.js","./LayerView3D-cadfe2a7.js","./TiledLayerView3D-db629e29.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js","./MapServiceLayerViewHelper-74c302e2.js","./floorFilterUtils-73949d2d.js","./sublayerUtils-7a445087.js","./popupUtils-424614c6.js","./drapedUtils-011ee4d5.js"],import.meta.url),tse=()=>ke(()=>import("./ElevationLayerView3D-fd92ca91.js"),["./ElevationLayerView3D-fd92ca91.js","./LayerView3D-cadfe2a7.js","./TiledLayerView3D-db629e29.js","./LayerView-56ae8a75.js"],import.meta.url),ise={"base-dynamic":()=>ke(()=>import("./BaseDynamicLayerView3D-231ad4b2.js"),["./BaseDynamicLayerView3D-231ad4b2.js","./DynamicLayerView3D-de5acd27.js","./LayerView3D-cadfe2a7.js","./projectExtentUtils-5c353335.js","./ImageMaterial-31d914f8.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js"],import.meta.url),"base-elevation":tse,"base-tile":aC,"bing-maps":aC,"building-scene":()=>ke(()=>import("./BuildingSceneLayerView3D-d6c752c5.js"),["./BuildingSceneLayerView3D-d6c752c5.js","./BuildingGroupSublayer-f82ef256.js","./BuildingComponentSublayer-568a4c8f.js","./capabilities-c607cf72.js","./I3SIndexInfo-5ce9237d.js","./I3SLayerDefinitions-3194b507.js","./I3SUtil-00117a32.js","./I3SBinaryReader-ce9ec7ac.js","./popupUtils-424614c6.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./I3SMeshView3D-a9ab2fc0.js","./I3SOverrides-11b82592.js","./I3SNode-ab03940e.js","./ReactiveSet-a030607c.js","./meshFeatureSet-ac68b3f7.js","./External-27723e17.js","./FeatureLayerView3D-ee444e8d.js","./FeatureLayerViewBase3D-f1aec35e.js","./FeatureLikeLayerView3D-af701d9a.js","./dehydratedFeatureComparison-806f289d.js","./queryForSymbologySnapping-e89956a6.js","./elevationInfoUtils-fe734b95.js","./hash-6f442295.js","./Graphics3DObjectStates-c0ae2c22.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./floorFilterUtils-73949d2d.js","./QueryEngine-44ece2b8.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./projectExtentUtils-5c353335.js","./LayerView3D-cadfe2a7.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./EventedSet-1c1c6fea.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js","./SceneModification-c9819a6f.js","./persistable-585a2b37.js","./resourceExtension-6591026e.js","./SceneLayerWorker-615b3bae.js","./I3SQueryFeatureStore-d440d03b.js","./DefinitionExpressionSceneLayerView-f3adf5a8.js"],import.meta.url),csv:()=>ke(()=>import("./CSVLayerView3D-40513108.js"),["./CSVLayerView3D-40513108.js","./FeatureLayerViewBase3D-f1aec35e.js","./FeatureLikeLayerView3D-af701d9a.js","./dehydratedFeatureComparison-806f289d.js","./queryForSymbologySnapping-e89956a6.js","./elevationInfoUtils-fe734b95.js","./hash-6f442295.js","./Graphics3DObjectStates-c0ae2c22.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./popupUtils-424614c6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-44ece2b8.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./projectExtentUtils-5c353335.js","./LayerView3D-cadfe2a7.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./EventedSet-1c1c6fea.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js"],import.meta.url),dimension:()=>ke(()=>import("./DimensionLayerView3D-7685494a.js"),["./DimensionLayerView3D-7685494a.js","./LayerView3D-cadfe2a7.js","./LayerView-56ae8a75.js"],import.meta.url),elevation:tse,feature:()=>ke(()=>import("./FeatureLayerView3D-ee444e8d.js"),["./FeatureLayerView3D-ee444e8d.js","./FeatureLayerViewBase3D-f1aec35e.js","./FeatureLikeLayerView3D-af701d9a.js","./dehydratedFeatureComparison-806f289d.js","./queryForSymbologySnapping-e89956a6.js","./elevationInfoUtils-fe734b95.js","./hash-6f442295.js","./Graphics3DObjectStates-c0ae2c22.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./popupUtils-424614c6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-44ece2b8.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./projectExtentUtils-5c353335.js","./LayerView3D-cadfe2a7.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./EventedSet-1c1c6fea.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js"],import.meta.url),geojson:()=>ke(()=>import("./GeoJSONLayerView3D-3aa1d764.js"),["./GeoJSONLayerView3D-3aa1d764.js","./FeatureLayerViewBase3D-f1aec35e.js","./FeatureLikeLayerView3D-af701d9a.js","./dehydratedFeatureComparison-806f289d.js","./queryForSymbologySnapping-e89956a6.js","./elevationInfoUtils-fe734b95.js","./hash-6f442295.js","./Graphics3DObjectStates-c0ae2c22.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./popupUtils-424614c6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-44ece2b8.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./projectExtentUtils-5c353335.js","./LayerView3D-cadfe2a7.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./EventedSet-1c1c6fea.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js"],import.meta.url),graphics:()=>ke(()=>import("./GraphicsLayerView3D-5127e0a4.js"),["./GraphicsLayerView3D-5127e0a4.js","./LayerView3D-cadfe2a7.js","./queryForSymbologySnapping-e89956a6.js","./elevationInfoUtils-fe734b95.js","./GraphicsProcessor-fc9ef2b4.js","./Graphics3DObjectStates-c0ae2c22.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./popupUtils-424614c6.js","./projectExtentUtils-5c353335.js","./LayerView-56ae8a75.js"],import.meta.url),group:()=>ke(()=>import("./GroupLayerView-58ffc7fd.js"),["./GroupLayerView-58ffc7fd.js","./LayerView-56ae8a75.js"],import.meta.url),imagery:()=>ke(()=>import("./ImageryLayerView3D-0576714c.js"),["./ImageryLayerView3D-0576714c.js","./DynamicLayerView3D-de5acd27.js","./LayerView3D-cadfe2a7.js","./projectExtentUtils-5c353335.js","./ImageMaterial-31d914f8.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js","./popupUtils-424614c6.js"],import.meta.url),"integrated-mesh":()=>ke(()=>import("./IntegratedMeshLayerView3D-874fee62.js"),["./IntegratedMeshLayerView3D-874fee62.js","./I3SMeshView3D-a9ab2fc0.js","./I3SOverrides-11b82592.js","./I3SNode-ab03940e.js","./I3SUtil-00117a32.js","./I3SBinaryReader-ce9ec7ac.js","./ReactiveSet-a030607c.js","./meshFeatureSet-ac68b3f7.js","./External-27723e17.js","./FeatureLayerView3D-ee444e8d.js","./FeatureLayerViewBase3D-f1aec35e.js","./FeatureLikeLayerView3D-af701d9a.js","./dehydratedFeatureComparison-806f289d.js","./queryForSymbologySnapping-e89956a6.js","./elevationInfoUtils-fe734b95.js","./hash-6f442295.js","./Graphics3DObjectStates-c0ae2c22.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./popupUtils-424614c6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-44ece2b8.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./projectExtentUtils-5c353335.js","./LayerView3D-cadfe2a7.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./EventedSet-1c1c6fea.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js","./SceneModification-c9819a6f.js","./persistable-585a2b37.js","./resourceExtension-6591026e.js","./SceneLayerWorker-615b3bae.js"],import.meta.url),"line-of-sight":()=>ke(()=>import("./LineOfSightLayerView3D-4a1bea99.js"),["./LineOfSightLayerView3D-4a1bea99.js","./LayerView3D-cadfe2a7.js","./LayerView-56ae8a75.js"],import.meta.url),"map-image":()=>ke(()=>import("./MapImageLayerView3D-6486f988.js"),["./MapImageLayerView3D-6486f988.js","./DynamicLayerView3D-de5acd27.js","./LayerView3D-cadfe2a7.js","./projectExtentUtils-5c353335.js","./ImageMaterial-31d914f8.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js","./ExportImageParameters-d837b18a.js","./floorFilterUtils-73949d2d.js","./sublayerUtils-7a445087.js","./MapServiceLayerViewHelper-74c302e2.js","./popupUtils-424614c6.js","./drapedUtils-011ee4d5.js"],import.meta.url),media:()=>ke(()=>import("./MediaLayerView3D-a8f89aec.js"),["./MediaLayerView3D-a8f89aec.js","./MediaElementView-89d8b39c.js","./normalizeUtilsSync-55e54404.js","./LayerView3D-cadfe2a7.js","./ImageMaterial-31d914f8.js","./LayerView-56ae8a75.js"],import.meta.url),"ogc-feature":()=>ke(()=>import("./OGCFeatureLayerView3D-f8449733.js"),["./OGCFeatureLayerView3D-f8449733.js","./FeatureLayerViewBase3D-f1aec35e.js","./FeatureLikeLayerView3D-af701d9a.js","./dehydratedFeatureComparison-806f289d.js","./queryForSymbologySnapping-e89956a6.js","./elevationInfoUtils-fe734b95.js","./hash-6f442295.js","./Graphics3DObjectStates-c0ae2c22.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./popupUtils-424614c6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-44ece2b8.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./projectExtentUtils-5c353335.js","./LayerView3D-cadfe2a7.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./EventedSet-1c1c6fea.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js"],import.meta.url),"open-street-map":aC,"oriented-imagery":()=>ke(()=>import("./FeatureLayerView3D-ee444e8d.js"),["./FeatureLayerView3D-ee444e8d.js","./FeatureLayerViewBase3D-f1aec35e.js","./FeatureLikeLayerView3D-af701d9a.js","./dehydratedFeatureComparison-806f289d.js","./queryForSymbologySnapping-e89956a6.js","./elevationInfoUtils-fe734b95.js","./hash-6f442295.js","./Graphics3DObjectStates-c0ae2c22.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./popupUtils-424614c6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-44ece2b8.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./projectExtentUtils-5c353335.js","./LayerView3D-cadfe2a7.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./EventedSet-1c1c6fea.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js"],import.meta.url),"point-cloud":()=>ke(()=>import("./PointCloudLayerView3D-d17d86d1.js").then(t=>t.P),["./PointCloudLayerView3D-d17d86d1.js","./LayerView3D-cadfe2a7.js","./I3SUtil-00117a32.js","./I3SBinaryReader-ce9ec7ac.js","./PointCloudWorkerUtil-3d5290ee.js","./PointCloudUniqueValueRenderer-95a3111a.js","./PopupSceneLayerView-1298a235.js","./popupUtils-424614c6.js","./LayerView-56ae8a75.js"],import.meta.url),voxel:()=>ke(()=>import("./VoxelLayerView3D-d7c4f2ac.js"),["./VoxelLayerView3D-d7c4f2ac.js","./LayerView3D-cadfe2a7.js","./PopupSceneLayerView-1298a235.js","./popupUtils-424614c6.js","./LayerView-56ae8a75.js"],import.meta.url),route:()=>ke(()=>import("./RouteLayerView3D-bcb99e75.js"),["./RouteLayerView3D-bcb99e75.js","./Stop-c40829c5.js","./LayerView3D-cadfe2a7.js","./GraphicsProcessor-fc9ef2b4.js","./Graphics3DObjectStates-c0ae2c22.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./popupUtils-424614c6.js","./projectExtentUtils-5c353335.js","./EventedSet-1c1c6fea.js","./LayerView-56ae8a75.js"],import.meta.url),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?ke(()=>import("./SceneLayerView3D-1791c3b5.js"),["./SceneLayerView3D-1791c3b5.js","./ReactiveSet-a030607c.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./floorFilterUtils-73949d2d.js","./I3SMeshView3D-a9ab2fc0.js","./I3SOverrides-11b82592.js","./I3SNode-ab03940e.js","./I3SUtil-00117a32.js","./I3SBinaryReader-ce9ec7ac.js","./meshFeatureSet-ac68b3f7.js","./External-27723e17.js","./FeatureLayerView3D-ee444e8d.js","./FeatureLayerViewBase3D-f1aec35e.js","./FeatureLikeLayerView3D-af701d9a.js","./dehydratedFeatureComparison-806f289d.js","./queryForSymbologySnapping-e89956a6.js","./elevationInfoUtils-fe734b95.js","./hash-6f442295.js","./Graphics3DObjectStates-c0ae2c22.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./popupUtils-424614c6.js","./QueryEngine-44ece2b8.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./projectExtentUtils-5c353335.js","./LayerView3D-cadfe2a7.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./EventedSet-1c1c6fea.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js","./SceneModification-c9819a6f.js","./persistable-585a2b37.js","./resourceExtension-6591026e.js","./SceneLayerWorker-615b3bae.js","./SceneLayerView-31520d44.js","./DefinitionExpressionSceneLayerView-f3adf5a8.js","./I3SQueryFeatureStore-d440d03b.js","./PopupSceneLayerView-1298a235.js"],import.meta.url):ke(()=>import("./SceneLayerGraphicsView3D-1da037f7.js"),["./SceneLayerGraphicsView3D-1da037f7.js","./I3SOverrides-11b82592.js","./I3SNode-ab03940e.js","./I3SUtil-00117a32.js","./I3SBinaryReader-ce9ec7ac.js","./ReactiveSet-a030607c.js","./meshFeatureSet-ac68b3f7.js","./External-27723e17.js","./FeatureLayerView3D-ee444e8d.js","./FeatureLayerViewBase3D-f1aec35e.js","./FeatureLikeLayerView3D-af701d9a.js","./dehydratedFeatureComparison-806f289d.js","./queryForSymbologySnapping-e89956a6.js","./elevationInfoUtils-fe734b95.js","./hash-6f442295.js","./Graphics3DObjectStates-c0ae2c22.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./popupUtils-424614c6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-44ece2b8.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./projectExtentUtils-5c353335.js","./LayerView3D-cadfe2a7.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./EventedSet-1c1c6fea.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js","./SceneLayerView-31520d44.js","./DefinitionExpressionSceneLayerView-f3adf5a8.js","./PopupSceneLayerView-1298a235.js"],import.meta.url),stream:()=>ke(()=>import("./StreamLayerView3D-f9791232.js"),["./StreamLayerView3D-f9791232.js","./StreamFeatureManager-a85eefb4.js","./createConnection-03bdf9dc.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./EventedSet-1c1c6fea.js","./FeatureLikeLayerView3D-af701d9a.js","./dehydratedFeatureComparison-806f289d.js","./queryForSymbologySnapping-e89956a6.js","./elevationInfoUtils-fe734b95.js","./hash-6f442295.js","./Graphics3DObjectStates-c0ae2c22.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./popupUtils-424614c6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-44ece2b8.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./projectExtentUtils-5c353335.js","./LayerView3D-cadfe2a7.js","./LayerView-56ae8a75.js"],import.meta.url),tile:aC,"imagery-tile":()=>ke(()=>import("./ImageryTileLayerView3D-6d9eed53.js"),["./ImageryTileLayerView3D-6d9eed53.js","./rasterProjectionHelper-04f7c394.js","./LayerView3D-cadfe2a7.js","./TiledLayerView3D-db629e29.js","./popupUtils-424614c6.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js","./drapedUtils-011ee4d5.js"],import.meta.url),"vector-tile":()=>ke(()=>import("./VectorTileLayerView3D-47f00020.js"),["./VectorTileLayerView3D-47f00020.js","./Rect-98da58d6.js","./pbf-334ee1bd.js","./rasterizingUtils-e04f6f4b.js","./vec4f32-0d1b2306.js","./definitions-b2b7fe84.js","./enums-9d4f5c11.js","./number-e491b09e.js","./GeometryUtils-0258f920.js","./StyleRepository-f979d920.js","./TileClipper-ae6eca9e.js","./LayerView3D-cadfe2a7.js","./TiledLayerView3D-db629e29.js","./LayerView-56ae8a75.js"],import.meta.url),wcs:()=>ke(()=>import("./ImageryTileLayerView3D-6d9eed53.js"),["./ImageryTileLayerView3D-6d9eed53.js","./rasterProjectionHelper-04f7c394.js","./LayerView3D-cadfe2a7.js","./TiledLayerView3D-db629e29.js","./popupUtils-424614c6.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js","./drapedUtils-011ee4d5.js"],import.meta.url),"web-tile":aC,wfs:()=>ke(()=>import("./WFSLayerView3D-9d1c462b.js"),["./WFSLayerView3D-9d1c462b.js","./FeatureLayerViewBase3D-f1aec35e.js","./FeatureLikeLayerView3D-af701d9a.js","./dehydratedFeatureComparison-806f289d.js","./queryForSymbologySnapping-e89956a6.js","./elevationInfoUtils-fe734b95.js","./hash-6f442295.js","./Graphics3DObjectStates-c0ae2c22.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./popupUtils-424614c6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-44ece2b8.js","./WhereClause-9d21e01b.js","./TimeOnly-05b40277.js","./json-48e3ea08.js","./utils-097bae63.js","./utils-af61b1ad.js","./generateRendererUtils-f5995837.js","./FeatureStore-312d326c.js","./BoundsStore-be95aa6d.js","./projectExtentUtils-5c353335.js","./LayerView3D-cadfe2a7.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./EventedSet-1c1c6fea.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js"],import.meta.url),wms:()=>ke(()=>import("./WMSLayerView3D-16427284.js"),["./WMSLayerView3D-16427284.js","./DynamicLayerView3D-de5acd27.js","./LayerView3D-cadfe2a7.js","./projectExtentUtils-5c353335.js","./ImageMaterial-31d914f8.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js","./ExportWMSImageParameters-89167c00.js"],import.meta.url),wmts:()=>ke(()=>import("./WMTSLayerView3D-09a2c147.js"),["./WMTSLayerView3D-09a2c147.js","./LayerView3D-cadfe2a7.js","./TiledLayerView3D-db629e29.js","./LayerView-56ae8a75.js","./RefreshableLayerView-ac92d1c6.js"],import.meta.url),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function _We(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new de(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const rse={hasLayerViewModule:t=>ise[t.type]!=null,importLayerView:t=>{const e=ise[t.type];if(e==null)throw _We(t);return e(t)}},nse="analyses-owner-handles";var mT,Bb;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(mT||(mT={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(Bb||(Bb={}));let rb=class extends Ke{constructor(e){super(e),this._allAnalysisViews=new Dt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=sse(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(or("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(or()),this._attachedToViewResolver=sse()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(i==null||i.state.list===Bb.REMOVED)throw new de("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),nse)}_disconnectOwners(){this.removeHandles(nse),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const n of e)this._addAnalysis(n);const i=e.on("after-add",n=>this._addAnalysis(n.item)),r=e.on("after-remove",n=>this._removeAnalysis(n.item));return Sr(()=>{i.remove(),r.remove();for(const n of e)this._removeAnalysis(n)})}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:mT.PENDING,list:Bb.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=Pv(n=>this._createAnalysisViewPromise(r,n))}else i.state.list=Bb.ADDED}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=Bb.REMOVED,this._scheduleUpdate()):Ee.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=yw(()=>this._update()))}_update(){this._scheduledUpdateHandle=nn(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===Bb.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case mT.PENDING:e.createAnalysisViewTask=Vc(e.createAnalysisViewTask);break;case mT.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=ct(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,i){const r=e.analysis,n=r.type,s=this._analysisModules[n];if(this._creatingViewCount+=1,s.module==null)try{s.module=await this._loadAnalysisModule(n)}catch(u){throw this._creatingViewCount-=1,u}if(Ms(i))throw this._creatingViewCount-=1,or("AnalysisView creation aborted");const a=new s.module.default({analysis:r,view:this.view});try{await a.when()}catch(u){throw this._creatingViewCount-=1,u}if(Ms(i))throw this._creatingViewCount-=1,a.destroy(),or("AnalysisView creation aborted");return e.view=a,e.state.view=mT.CREATED,this._allAnalysisViews.add(a),this._creatingViewCount-=1,a}_loadAnalysisModule(e){switch(e){case"area-measurement":return ke(()=>import("./AreaMeasurementAnalysisView3D-4c0ac0df.js").then(i=>i.A),["./AreaMeasurementAnalysisView3D-4c0ac0df.js","./UnitNormalizer-98605da3.js","./Segment-5e10faf9.js","./unitFormatUtils-7fb3d5de.js","./LineVisualElement-66dac256.js","./elevationInfoUtils-fe734b95.js","./EditGeometryOperations-8bf50ffe.js"],import.meta.url);case"dimension":return ke(()=>import("./DimensionAnalysisView3D-65e93a9a.js").then(i=>i.D),["./DimensionAnalysisView3D-65e93a9a.js","./LineVisualElement-66dac256.js","./LengthDimension-cb7d380d.js","./Segment-5e10faf9.js","./unitFormatUtils-7fb3d5de.js","./elevationInfoUtils-fe734b95.js","./analysisViewUtils-ffd55722.js","./Factory-d72c612e.js","./ImageMaterial-31d914f8.js","./vec4f32-0d1b2306.js","./RightAngleQuadVisualElement-21350989.js","./PointVisualElement-511deac0.js","./EditGeometryOperations-8bf50ffe.js","./floorFilterUtils-73949d2d.js","./dehydratedFeatureComparison-806f289d.js"],import.meta.url);case"direct-line-measurement":return ke(()=>import("./DirectLineMeasurementAnalysisView3D-ff9942ca.js").then(i=>i.D),["./DirectLineMeasurementAnalysisView3D-ff9942ca.js","./UnitNormalizer-98605da3.js","./Segment-5e10faf9.js","./unitFormatUtils-7fb3d5de.js","./LineVisualElement-66dac256.js","./elevationInfoUtils-fe734b95.js","./RightAngleQuadVisualElement-21350989.js"],import.meta.url);case"line-of-sight":return ke(()=>import("./LineOfSightAnalysisView3D-e7cc07e0.js"),["./LineOfSightAnalysisView3D-e7cc07e0.js","./LineVisualElement-66dac256.js","./LineOfSightAnalysisTarget-43dbc60a.js","./persistable-585a2b37.js","./resourceExtension-6591026e.js","./elevationInfoUtils-fe734b95.js","./analysisViewUtils-ffd55722.js","./PointVisualElement-511deac0.js"],import.meta.url);case"slice":return ke(()=>import("./SliceAnalysisView3D-9d6696f3.js").then(i=>i.S),["./SliceAnalysisView3D-9d6696f3.js","./LineVisualElement-66dac256.js","./persistable-585a2b37.js","./resourceExtension-6591026e.js","./BuildingComponentSublayer-568a4c8f.js","./capabilities-c607cf72.js","./I3SIndexInfo-5ce9237d.js","./I3SLayerDefinitions-3194b507.js","./I3SUtil-00117a32.js","./I3SBinaryReader-ce9ec7ac.js","./popupUtils-424614c6.js","./analysisViewUtils-ffd55722.js","./Factory-d72c612e.js","./ImageMaterial-31d914f8.js"],import.meta.url)}}};function sse(){const t=Ys();return t.promise.catch(()=>{}),t}_([T()],rb.prototype,"updating",null),_([T({constructOnly:!0})],rb.prototype,"view",void 0),_([T()],rb.prototype,"_allAnalysisViews",void 0),_([T()],rb.prototype,"_creatingViewCount",void 0),rb=_([Z("esri.views.3d.analysis.AnalysisViewManager3D")],rb);const bWe=rb;let Em=class extends Ke{constructor(e){super(e),this.collision=new P5,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===ht.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==ht.Local?this._set("altitude",e):Ee.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?Je(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return Je(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===ht.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=HF)=>(r.min=ca.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?e$([[4e3,ca.max],[1e4,gi(88)],[6e6,gi(88)]]):()=>ca.max;return(i,r=HF)=>(r.min=ca.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?e$([[4e3,ca.max],[5e4,gi(88)],[6e6,gi(88)],[2e7,ca.min]]):e$([[3e5,ca.max],[3e6,gi(88)],[6e6,gi(88)],[2e7,ca.min]]);return(i,r=HF)=>(r.min=ca.min,r.max=e(i),r)}};function wWe(t){return{min:-2e5,max:4*t.radius}}_([T()],Em.prototype,"altitude",null),_([T({readOnly:!0})],Em.prototype,"collision",void 0),_([T()],Em.prototype,"distance",void 0),_([T({readOnly:!0})],Em.prototype,"minimumPoiDistance",void 0),_([T()],Em.prototype,"tilt",void 0),_([T({constructOnly:!0})],Em.prototype,"mode",void 0),Em=_([Z("esri.views.3d.state.Constraints")],Em);const ose=wWe(ur),ca={min:gi(.5),max:gi(179.5)},HF={min:0,max:0};let P5=class extends Ke{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};_([T({type:Boolean})],P5.prototype,"enabled",void 0),_([T({type:Number})],P5.prototype,"elevationMargin",void 0),P5=_([Z("esri.views.3d.state.Constraints.CollisionConstraint")],P5);let gT=class extends Ke{constructor(){super(...arguments),this.min=ose.min,this.max=ose.max}};_([T({type:Number})],gT.prototype,"min",void 0),_([T({type:Number})],gT.prototype,"max",void 0),gT=_([Z("esri.views.3d.constraints.AltitudeConstraint")],gT);let Hm=class extends Ke{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};_([T({type:Number,value:1e-8})],Hm.prototype,"near",null),_([Fi("near")],Hm.prototype,"castNear",null),_([T({type:Number,value:1e-8})],Hm.prototype,"far",null),_([Fi("far")],Hm.prototype,"castFar",null),_([T({type:["auto","manual"]})],Hm.prototype,"mode",void 0),Hm=_([Z("esri.views.3d.constraints.ClipDistanceConstraint")],Hm);const DG={min:wl(ca.min),max:wl(ca.max)};let Vb=class extends Ke{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Je(e,DG.min,DG.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};_([T({type:["auto","manual"]})],Vb.prototype,"mode",void 0),_([T({type:Number,value:DG.max})],Vb.prototype,"max",null),_([Fi("max")],Vb.prototype,"castMax",null),Vb=_([Z("esri.views.3d.constraints.TiltConstraint")],Vb);let Gb=class extends Ke{constructor(){super(...arguments),this.tilt=new Vb,this.altitude=new gT,this.clipDistance=new Hm}};_([T({type:Vb})],Gb.prototype,"tilt",void 0),_([T({type:gT})],Gb.prototype,"altitude",void 0),_([T({type:Hm})],Gb.prototype,"clipDistance",void 0),Gb=_([Z("esri.views.3d.constraints.Constraints")],Gb);var wx;const ewe="esri.views.3d.environment.SunLighting",VM=Ee.getLogger(ewe);let $f=wx=class extends Xn.EventedMixin(q2){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get ambientOcclusionEnabled(){return fp(VM,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){fp(VM,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return fp(VM,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){fp(VM,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new wx(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const i=wx.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const n=wx.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==n&&(GM.target=this,GM.timezoneOffset=n,this.emit("timezone-will-change",GM),GM.target=null),t!=null)return isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new wx({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};_([T({type:Boolean})],$f.prototype,"cameraTrackingEnabled",void 0),_([T({type:Boolean})],$f.prototype,"ambientOcclusionEnabled",null),_([T({type:Boolean})],$f.prototype,"waterReflectionEnabled",null),_([T({type:Date})],$f.prototype,"defaultDate",null),_([T({type:Date})],$f.prototype,"date",null),$f=wx=_([Z(ewe)],$f),function(t){function e({hours:i,minutes:r,seconds:n}){return Math.round(i+r/60+n/3600)}t.calculateTimezoneOffset=e}($f||($f={}));const GM={target:null,timezoneOffset:0},nb=$f;var l$;const twe="esri.views.3d.environment.VirtualLighting",HM=Ee.getLogger(twe);let xx=l$=class extends Xn.EventedMixin(QO){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return fp(HM,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){fp(HM,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return fp(HM,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){fp(HM,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new l$({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new l$(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};_([T({type:Boolean})],xx.prototype,"ambientOcclusionEnabled",null),_([T({type:Boolean})],xx.prototype,"waterReflectionEnabled",null),_([T({type:Boolean})],xx.prototype,"cameraTrackingEnabled",void 0),xx=l$=_([Z(twe)],xx);const I5=xx,xWe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:nb,virtual:I5}};var NG;let qA=NG=class extends Ke{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new NG({quality:this.quality})}};_([T({type:["low","high"],value:"low"})],qA.prototype,"quality",null),qA=NG=_([Z("esri.views.3d.environment.SceneViewAtmosphere")],qA);var $5;let Tx=$5=class extends wS{constructor(t){super(t),this.atmosphere=new qA,this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new $5({...e,lighting:e.lighting?e.lighting.type==="virtual"?I5.fromWebsceneLighting(e.lighting):nb.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const e=this._convertLighting(t);return e!==t&&this.addHandles(g0e(e)),e}_convertLighting(t){return t?t instanceof nb||t instanceof I5?t:t instanceof q2?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new nb({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):t instanceof QO?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new I5({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):Pp(xWe,t):new nb}clone(){return new $5({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Ce(this.background)})}cloneWithWebsceneEnvironment(t){return new $5({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Ce(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):nb.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):I5.fromWebsceneLighting(t.lighting);default:return t.lighting,nb.fromWebsceneLighting(t.lighting)}}};_([T({type:qA,json:{read:!1},nonNullable:!0})],Tx.prototype,"atmosphere",void 0),_([T({nonNullable:!0})],Tx.prototype,"lighting",void 0),_([Fi("lighting")],Tx.prototype,"castLighting",null),Tx=$5=_([Z("esri.views.3d.environment.SceneViewEnvironment")],Tx);const Sx=Tx;function TWe(t,e,i){if(e==null)return!1;const r=S1e(e);return r!=null&&(r(t,0,lC,0),i!==lC&&(i[0]=lC[0],i[1]=lC[1],i.length>2&&(i[2]=lC[2])),!0)}const lC=H();function SWe(t,e){qM[0]=t.x,qM[1]=t.y;const i=t.z;return qM[2]=i!==void 0?i:0,TWe(qM,t.spatialReference,e)}const qM=H();var Oa;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(Oa||(Oa={}));function EWe(t){return"r"in t&&"g"in t&&"b"in t}function iwe(t){return"h"in t&&"s"in t&&"v"in t}function rwe(t){return"l"in t&&"a"in t&&"b"in t}function nwe(t){return"l"in t&&"c"in t&&"h"in t}function CWe(t){return"x"in t&&"y"in t&&"z"in t}const AWe=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],OWe=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function swe(t,e){const i=[];let r,n;if(t[0].length!==e.length)throw new Error("dimensions do not match");const s=t.length,a=t[0].length;let u=0;for(r=0;r<s;r++){for(u=0,n=0;n<a;n++)u+=t[r][n]*e[n];i.push(u)}return i}function owe(t){const e=[t.r/255,t.g/255,t.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=swe(AWe,e);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function HZ(t){const e=swe(OWe,[t.x/100,t.y/100,t.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function awe(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function lwe(t){const e=t.l,i=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function RWe(t){const e=t.l,i=t.a,r=t.b,n=Math.sqrt(i*i+r*r);let s=Math.atan2(r,i);return s=s>0?s:s+2*Math.PI,{l:e,c:n,h:s}}function MWe(t){const e=t.l,i=t.c,r=t.h;return{l:e,a:i*Math.cos(r),b:i*Math.sin(r)}}function PWe(t){return awe(owe(t))}function IWe(t){return HZ(lwe(t))}function $We(t){return RWe(awe(owe(t)))}function LWe(t){return HZ(lwe(MWe(t)))}function DWe(t){const e=t.r,i=t.g,r=t.b,n=Math.max(e,i,r),s=n-Math.min(e,i,r);let a=n,u=s===0?0:n===e?(i-r)/s%6:n===i?(r-e)/s+2:(e-i)/s+4,p=s===0?0:s/a;return u<0&&(u+=6),u*=60,p*=100,a*=100/255,{h:u,s:p,v:a}}function NWe(t){const e=(t.h+360)%360/60,i=t.s/100,r=t.v/100*255,n=r*i,s=n*(1-Math.abs(e%2-1));let a;switch(Math.floor(e)){case 0:a={r:n,g:s,b:0};break;case 1:a={r:s,g:n,b:0};break;case 2:a={r:0,g:n,b:s};break;case 3:a={r:0,g:s,b:n};break;case 4:a={r:s,g:0,b:n};break;case 5:case 6:a={r:n,g:0,b:s};break;default:a={r:0,g:0,b:0}}return a.r=Math.round(a.r+r-n),a.g=Math.round(a.g+r-n),a.b=Math.round(a.b+r-n),a}function qZ(t){return EWe(t)?t:nwe(t)?LWe(t):rwe(t)?IWe(t):CWe(t)?HZ(t):iwe(t)?NWe(t):t}function vIt(t){return iwe(t)?t:DWe(qZ(t))}function _It(t){return rwe(t)?t:PWe(qZ(t))}function bIt(t){return nwe(t)?t:$We(qZ(t))}function FWe(t){let{r:e,g:i,b:r,a:n}=t;return n<1&&(e=Math.round(n*e+255*(1-n)),i=Math.round(n*i+255*(1-n)),r=Math.round(n*r+255*(1-n))),new mt({r:e,g:i,b:r})}function kWe(t,e){const{r:i,g:r,b:n}=e?.ignoreAlpha?t:FWe(t);return .2126*i+.7152*r+.0722*n}var FG;function wIt(t,e=FG.High){return kWe(t,{ignoreAlpha:!0})>e?new mt([0,0,0,t.a]):new mt([255,255,255,t.a])}function xIt(t,e){const i=t.clone();return i.a*=e,i}function tO(t){return mt.toUnitRGBA(t)}function TIt(t,e){return t===e||t!=null&&e!=null&&V2(t,e)}function SIt(t){return vi(t[0],t[1],t[2],t.length>3?t[3]:1)}function EIt(t,e){const i=mt.toUnitRGBA(t);return i[3]*=e,i}(function(t){t[t.Low=160]="Low",t[t.High=225]="High"})(FG||(FG={}));function $s(t,e){return t[0]=e[0],t[1]=e[1],t}function Yi(t,e,i){return t[0]=e,t[1]=i,t}function rp(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function i0(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function cwe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function uwe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function zWe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function UWe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function jWe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function BWe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function VWe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Ic(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function GWe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function gv(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function kL(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function WZ(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function hwe(t){const e=t[0],i=t[1];return e*e+i*i}function XZ(t,e){return t[0]=-e[0],t[1]=-e[1],t}function HWe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function iO(t,e){const i=e[0],r=e[1];let n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t}function Us(t,e){return t[0]*e[0]+t[1]*e[1]}function qWe(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function Fh(t,e,i,r){const n=e[0],s=e[1];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t}function WWe(t,e){e=e||1;const i=2*qO()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function dwe(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t}function ry(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n+i[4],t[1]=i[1]*r+i[3]*n+i[5],t}function XWe(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t}function JWe(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t}function YWe(t,e,i,r){const n=e[0]-i[0],s=e[1]-i[1],a=Math.sin(r),u=Math.cos(r);return t[0]=n*u-s*a+i[0],t[1]=n*a+s*u+i[1],t}function ZWe(t,e){const i=t[0],r=t[1],n=e[0],s=e[1];let a=i*i+r*r;a>0&&(a=1/Math.sqrt(a));let u=n*n+s*s;u>0&&(u=1/Math.sqrt(u));const p=(i*n+r*s)*a*u;return p>1?0:p<-1?Math.PI:Math.acos(p)}function KWe(t){return"vec2("+t[0]+", "+t[1]+")"}function pwe(t,e){return t[0]===e[0]&&t[1]===e[1]}function fwe(t,e){const i=t[0],r=t[1],n=e[0],s=e[1],a=Ko();return Math.abs(i-n)<=a*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-s)<=a*Math.max(1,Math.abs(r),Math.abs(s))}function QWe(t,e,i,r,n){let s=e[0]-i[0],a=e[1]-i[1];const u=(r[0]*s+r[1]*a)*(n-1);return s=r[0]*u,a=r[1]*u,t[0]=e[0]+s,t[1]=e[1]+a,t}const eXe=WZ,tXe=i0,iXe=cwe,rXe=uwe,mwe=gv,nXe=kL,sXe=hwe;Object.freeze(Object.defineProperty({__proto__:null,add:rp,angle:ZWe,ceil:zWe,copy:$s,cross:qWe,dist:mwe,distance:gv,div:rXe,divide:uwe,dot:Us,equals:fwe,exactEquals:pwe,floor:UWe,inverse:HWe,len:eXe,length:WZ,lerp:Fh,max:BWe,min:jWe,mul:iXe,multiply:cwe,negate:XZ,normalize:iO,projectAndScale:QWe,random:WWe,rotate:YWe,round:VWe,scale:Ic,scaleAndAdd:GWe,set:Yi,sqrDist:nXe,sqrLen:sXe,squaredDistance:kL,squaredLength:hwe,str:KWe,sub:tXe,subtract:i0,transformMat2:dwe,transformMat2d:ry,transformMat3:XWe,transformMat4:JWe},Symbol.toStringTag,{value:"Module"}));function JZ(t){return Je((t-1e5)/(1e6-1e5),0,1)}const kG=1e4,oXe=.085,by=1e5;let aXe=class{};const Vr=aXe;function F(t,...e){let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i}(function(t){function e(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}t.int=e,t.float=i})(F||(F={}));var X;function lXe(t){return t===X.POSITION}(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(X||(X={}));var vs;function g0(t,e){switch(e.textureCoordinateType){case vs.Default:return t.attributes.add(X.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(F`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case vs.Compressed:return t.attributes.add(X.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(F`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case vs.Atlas:return t.attributes.add(X.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(X.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(F`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case vs.None:return void t.vertex.code.add(F`void forwardTextureCoordinates() {}`);case vs.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(vs||(vs={}));function fd(t){t.code.add(F`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function ld(t){t.include(fd),t.code.add(F`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTex, 0)));
return linearDepthFromRGBA(texelFetch(depthTex, iuv, 0), nearFar);
}`)}function M7(t){t.fragment.code.add(F`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var hr;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(hr||(hr={}));let zn=class{constructor(e,i,r,n,s=null){if(this.name=e,this.type=i,this.arraySize=s,this.bind={[hr.Pass]:null,[hr.Draw]:null},n)switch(r){case hr.Pass:this.bind[hr.Pass]=n;break;case hr.Draw:this.bind[hr.Draw]=n}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},_i=class extends zn{constructor(e,i){super(e,"vec3",hr.Pass,(r,n,s)=>r.setUniform3fv(e,i(n,s)))}};function jg(t){t.uniforms.add(new _i("mainLightDirection",(e,i)=>i.lighting.mainLight.direction))}function U0(t){t.uniforms.add(new _i("mainLightIntensity",(e,i)=>i.lighting.mainLight.intensity))}function zL(t){jg(t.fragment),U0(t.fragment),t.fragment.code.add(F`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let Lr=class extends zn{constructor(e,i){super(e,"vec2",hr.Pass,(r,n,s)=>r.setUniform2fv(e,i(n,s)))}},er=class extends zn{constructor(e,i){super(e,"vec4",hr.Pass,(r,n,s)=>r.setUniform4fv(e,i(n,s)))}},lt=class extends zn{constructor(e,i){super(e,"float",hr.Pass,(r,n,s)=>r.setUniform1f(e,i(n,s)))}},On=class extends zn{constructor(e,i){super(e,"mat4",hr.Pass,(r,n,s)=>r.setUniformMatrix4fv(e,i(n,s)))}};const qa=ji();let cXe=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function zt(t,e){if(!t){e=e||"Assertion";const i=new Error(e).stack;throw new cXe(`${e} at ${i}`)}}function s3(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function ase(t,e,i,r){let n,s=(i[0]-t[0])/e[0],a=(r[0]-t[0])/e[0];s>a&&(n=s,s=a,a=n);let u=(i[1]-t[1])/e[1],p=(r[1]-t[1])/e[1];if(u>p&&(n=u,u=p,p=n),s>p||u>a)return!1;u>s&&(s=u),p<a&&(a=p);let y=(i[2]-t[2])/e[2],b=(r[2]-t[2])/e[2];return y>b&&(n=y,y=b,b=n),!(s>b||y>a)&&(b<a&&(a=b),!(a<0))}function WM(t,e,i,r,n,s=Ct()){const a=(r[n]-i[n])*(e[0]-t[0])-(r[0]-i[0])*(e[n]-t[n]),u=(r[0]-i[0])*(t[n]-i[n])-(r[n]-i[n])*(t[0]-i[0]);if(a===0)return!1;const p=u/a;return s[0]=t[0]+p*(e[0]-t[0]),s[1]=t[n]+p*(e[n]-t[n]),!0}function lse(t,e,i,r,n){qa[0]=t[0],qa[1]=t[1],qa[2]=t[2],qa[3]=1,Nu(qa,qa,e),n.length>2&&(n[2]=-qa[2]),Nu(qa,qa,i),zt(qa[3]!==0),n[0]=qa[0]/qa[3],n[1]=qa[1]/qa[3],n[2]=qa[2]/qa[3],n[0]=(.5*n[0]+.5)*r[2]+r[0],n[1]=(.5*n[1]+.5)*r[3]+r[1]}function uXe(t,e){return Math.log(t)/Math.log(e)}function hXe(t,e,i,r){t[12]=e,t[13]=i,t[14]=r}function gwe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const ywe=Ee.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let vwe=class{constructor(){this._includedModules=new Map}include(e,i){if(this._includedModules.has(e)){const r=this._includedModules.get(e);if(r!==i){ywe.error("Trying to include shader module multiple times with different sets of options.");const n=new Set;for(const s of Object.keys(r))r[s]!==e[s]&&n.add(s);for(const s of Object.keys(e))r[s]!==e[s]&&n.add(s);n.forEach(s=>console.error(`  ${s}: current ${r[s]} new ${e[s]}`))}}else this._includedModules.set(e,i),e(this.builder,i)}},lr=class extends vwe{constructor(){super(...arguments),this.vertex=new cse,this.fragment=new cse,this.attributes=new fXe,this.varyings=new mXe,this.extensions=new zG,this.constants=new _we,this.outputs=new jG}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const i=this.extensions.generateSource(e),r=this.attributes.generateSource(e),n=this.varyings.generateSource(e),s=e==="vertex"?this.vertex:this.fragment,a=s.uniforms.generateSource(),u=s.code.generateSource(),p=e==="vertex"?yXe:gXe,y=this.constants.generateSource().concat(s.constants.generateSource()),b=this.outputs.generateSource(e);return`#version 300 es
${i.join(`
`)}

${p}

${y.join(`
`)}

${a.join(`
`)}

${r.join(`
`)}

${n.join(`
`)}

${b.join(`
`)}

${u.join(`
`)}`}generateBindPass(e){const i=new Map;this.vertex.uniforms.entries.forEach(s=>{const a=s.bind[hr.Pass];a&&i.set(s.name,a)}),this.fragment.uniforms.entries.forEach(s=>{const a=s.bind[hr.Pass];a&&i.set(s.name,a)});const r=Array.from(i.values()),n=r.length;return(s,a)=>{for(let u=0;u<n;++u)r[u](e,s,a)}}generateBindDraw(e){const i=new Map;this.vertex.uniforms.entries.forEach(s=>{const a=s.bind[hr.Draw];a&&i.set(s.name,a)}),this.fragment.uniforms.entries.forEach(s=>{const a=s.bind[hr.Draw];a&&i.set(s.name,a)});const r=Array.from(i.values()),n=r.length;return(s,a,u)=>{for(let p=0;p<n;++p)r[p](e,s,a,u)}}},dXe=class{constructor(){this._entries=new Map}add(...e){for(const i of e)this._add(i)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new de(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else ywe.error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},pXe=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},cse=class extends vwe{constructor(){super(...arguments),this.uniforms=new dXe,this.code=new pXe,this.constants=new _we}get builder(){return this}},fXe=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`in ${i[1]} ${i[0]};`)}},mXe=class{constructor(){this._entries=new Map}add(e,i){this._entries.has(e)&&zt(this._entries.get(e)===i),this._entries.set(e,i)}generateSource(e){const i=new Array;return this._entries.forEach((r,n)=>i.push(e==="vertex"?`out ${r} ${n};`:`in ${r} ${n};`)),i}},zG=class UG{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?UG.ALLOWLIST_VERTEX:UG.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}};zG.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],zG.ALLOWLIST_VERTEX=[];let jG=class BG{constructor(){this._entries=new Map}add(e,i,r=0){const n=this._entries.get(r);n?zt(n.name===e&&n.type===i,`Fragment shader output location ${r} occupied`):this._entries.set(r,{name:e,type:i})}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:BG.DEFAULT_NAME,type:BG.DEFAULT_TYPE});const i=new Array;return this._entries.forEach((r,n)=>i.push(`layout(location = ${n}) out ${r.type} ${r.name};`)),i}};jG.DEFAULT_TYPE="vec4",jG.DEFAULT_NAME="fragColor";let _we=class Ds{constructor(){this._entries=new Set}add(e,i,r){let n="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":n=Ds._numberToFloatStr(r);break;case"int":n=Ds._numberToIntStr(r);break;case"bool":n=r.toString();break;case"vec2":n=`vec2(${Ds._numberToFloatStr(r[0])},                            ${Ds._numberToFloatStr(r[1])})`;break;case"vec3":n=`vec3(${Ds._numberToFloatStr(r[0])},                            ${Ds._numberToFloatStr(r[1])},                            ${Ds._numberToFloatStr(r[2])})`;break;case"vec4":n=`vec4(${Ds._numberToFloatStr(r[0])},                            ${Ds._numberToFloatStr(r[1])},                            ${Ds._numberToFloatStr(r[2])},                            ${Ds._numberToFloatStr(r[3])})`;break;case"ivec2":n=`ivec2(${Ds._numberToIntStr(r[0])},                             ${Ds._numberToIntStr(r[1])})`;break;case"ivec3":n=`ivec3(${Ds._numberToIntStr(r[0])},                             ${Ds._numberToIntStr(r[1])},                             ${Ds._numberToIntStr(r[2])})`;break;case"ivec4":n=`ivec4(${Ds._numberToIntStr(r[0])},                             ${Ds._numberToIntStr(r[1])},                             ${Ds._numberToIntStr(r[2])},                             ${Ds._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${i}(${Array.prototype.map.call(r,s=>Ds._numberToFloatStr(s)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${n};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const gXe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,yXe=`precision highp float;
precision highp sampler2D;`;let kt=class extends zn{constructor(e,i){super(e,"sampler2D",hr.Pass,(r,n,s)=>r.bindTexture(e,i(n,s)))}};const WA=st(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),qF=3,WF=st(qF*parseFloat(65e-8.toFixed(6)),qF*parseFloat(1881e-9.toFixed(6)),qF*parseFloat(85e-9.toFixed(6))),vXe=3996e-9,_Xe=st(parseFloat(Number(WA[0]+WF[0]).toFixed(6)),parseFloat(Number(WA[1]+WF[1]).toFixed(6)),parseFloat(Number(WA[2]+WF[2]).toFixed(6)));function bXe(t){const e=new lr;e.attributes.add(X.POSITION,"vec2"),e.include(g0,{textureCoordinateType:vs.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=e;return i.uniforms.add(new On("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new On("inverseViewMatrix",(n,s)=>cE(wXe,s.camera.viewMatrix))),i.code.add(F`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new _i("backgroundColor",n=>n.backgroundColor),new Lr("radii",n=>n.radii),new _i("cameraPosition",(n,s)=>s.camera.eye),new er("heightParameters",n=>n.heightParameters),new lt("innerFadeDistance",n=>n.innerFadeDistance),new lt("altitudeFade",n=>n.altitudeFade),new kt("depthTexture",n=>n.depthTexture),new lt("hazeStrength",n=>n.hazeStrength)),r.constants.add("betaRayleigh","vec3",WA),r.constants.add("betaCombined","vec3",_Xe),r.constants.add("betaMie","float",vXe),r.constants.add("scaleHeight","float",oXe*by),jg(r),e.include(M7),t.haze&&(r.include(ld),r.uniforms.add(new Lr("nearFar",(n,s)=>s.camera.nearFar))),r.code.add(F`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(F`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(F`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(F`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?F`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":F`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":F`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?F`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:F`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":F`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?F`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?F`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?F`cameraSpaceRay *= -textureBilinear(vuv0);`:F`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:F`${t.reduced?"":F`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?F`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:F`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":F`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const wXe=Ze(),xXe=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:WA,build:bXe},Symbol.toStringTag,{value:"Module"}));let pr=class{constructor(e,i){this._module=e,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var tn,Hi,et,R0,li,_p,FS,Ft,Tr,Rn,Si,Ai,Vn,ei,Mt,Qs,Eo,dr,Mu,la;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(tn||(tn={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Hi||(Hi={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(et||(et={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(R0||(R0={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(li||(li={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(_p||(_p={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(FS||(FS={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(Ft||(Ft={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Tr||(Tr={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(Rn||(Rn={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Si||(Si={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Ai||(Ai={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(Vn||(Vn={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(ei||(ei={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Mt||(Mt={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Qs||(Qs={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Eo||(Eo={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(dr||(dr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Mu||(Mu={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(la||(la={}));const XF=33984;var gs,Gl,VG;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.UNCOUNTED=8]="UNCOUNTED",t[t.LinesOfCode=8]="LinesOfCode",t[t.Uniform=9]="Uniform",t[t.COUNT=10]="COUNT"})(gs||(gs={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Gl||(Gl={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK"}(VG||(VG={}));const use=33306;var es,hse,dse,pse,UL,GG,fse;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(es||(es={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(hse||(hse={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(dse||(dse={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(pse||(pse={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(UL||(UL={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(GG||(GG={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(fse||(fse={}));let wr=class{constructor(e,i,r){this.release=r,this.initializeConfiguration(e,i),this._configuration=i.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=jt(this._program),this._pipeline=this._configuration=null}reload(e){jt(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return Hi.TRIANGLES}getPipeline(e,i,r){return this._pipeline}initializeConfiguration(e,i){}};const ar=new Map([[X.POSITION,0],[X.NORMAL,1],[X.NORMALCOMPRESSED,1],[X.UV0,2],[X.COLOR,3],[X.COLORFEATUREATTRIBUTE,3],[X.SIZE,4],[X.TANGENT,4],[X.AUXPOS1,5],[X.SYMBOLCOLOR,5],[X.AUXPOS2,6],[X.FEATUREATTRIBUTE,6],[X.INSTANCEFEATUREATTRIBUTE,6],[X.INSTANCECOLOR,7],[X.OBJECTANDLAYERIDCOLOR,7],[X.INSTANCEOBJECTANDLAYERIDCOLOR,7],[X.INSTANCEMODEL,8],[X.INSTANCEMODELNORMAL,12],[X.INSTANCEMODELORIGINHI,11],[X.INSTANCEMODELORIGINLO,15]]),TXe=Ee.getLogger("esri.views.webgl.checkWebGLError");function SXe(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const bwe=!!Me("enable-feature:webgl-debug");function np(){return bwe}function HG(){return bwe}function r0(t){if(np()){const e=t.getError();if(e){const i=SXe(t,e),r=new Error().stack;TXe.error(new de("webgl-error","WebGL error occurred",{message:i,stack:r}))}}}let fr=class{constructor(e,i,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new xi({deallocator:null}),this._glProgram=e.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBindPass(this),this.bindDraw=i.generateBindDraw(this),this._fragmentUniforms=np()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i){this._glProgram.setUniform1f(e,i)}setUniform2fv(e,i){this._glProgram.setUniform2fv(e,i)}setUniform3fv(e,i){this._glProgram.setUniform3fv(e,i)}setUniform4fv(e,i){this._glProgram.setUniform4fv(e,i)}setUniformMatrix3fv(e,i){this._glProgram.setUniformMatrix3fv(e,i)}setUniformMatrix4fv(e,i){this._glProgram.setUniformMatrix4fv(e,i)}setUniform1fv(e,i){this._glProgram.setUniform1fv(e,i)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,i){if(i?.glName==null){const n=this._textures.get(e);return n&&(this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(e)),null}let r=this._textures.get(e);return r==null?(r=this._allocTextureUnit(i),this._textures.set(e,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,i)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(i,e.unit)}),this._fragmentUniforms!=null&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var rn,K2,ns,yv,Kl,Pg,zr,kc,hg;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(rn||(rn={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(K2||(K2={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(ns||(ns={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(yv||(yv={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Kl||(Kl={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(Pg||(Pg={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(zr||(zr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(kc||(kc={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(hg||(hg={}));function Xc(t,e,i=R0.ADD,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function Zo(t,e,i,r,n=R0.ADD,s=R0.ADD,a=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:n,opAlpha:s,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const YZ={face:_p.BACK,mode:FS.CCW},wwe={face:_p.FRONT,mode:FS.CCW},P7=t=>t===rn.Back?YZ:t===rn.Front?wwe:null,ic={zNear:0,zFar:1},Oi={r:!0,g:!0,b:!0,a:!0};function EXe(t){return LXe.intern(t)}function CXe(t){return DXe.intern(t)}function AXe(t){return NXe.intern(t)}function OXe(t){return FXe.intern(t)}function RXe(t){return kXe.intern(t)}function MXe(t){return zXe.intern(t)}function PXe(t){return UXe.intern(t)}function IXe(t){return jXe.intern(t)}function $Xe(t){return BXe.intern(t)}function mi(t){return VXe.intern(t)}let j0=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function B0(t){return"["+t.join(",")+"]"}const LXe=new j0(xwe,t=>({__tag:"Blending",...t}));function xwe(t){return t?B0([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const DXe=new j0(Twe,t=>({__tag:"Culling",...t}));function Twe(t){return t?B0([t.face,t.mode]):null}const NXe=new j0(Swe,t=>({__tag:"PolygonOffset",...t}));function Swe(t){return t?B0([t.factor,t.units]):null}const FXe=new j0(Ewe,t=>({__tag:"DepthTest",...t}));function Ewe(t){return t?B0([t.func]):null}const kXe=new j0(Cwe,t=>({__tag:"StencilTest",...t}));function Cwe(t){return t?B0([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const zXe=new j0(Awe,t=>({__tag:"DepthWrite",...t}));function Awe(t){return t?B0([t.zNear,t.zFar]):null}const UXe=new j0(Owe,t=>({__tag:"ColorWrite",...t}));function Owe(t){return t?B0([t.r,t.g,t.b,t.a]):null}const jXe=new j0(Rwe,t=>({__tag:"StencilWrite",...t}));function Rwe(t){return t?B0([t.mask]):null}const BXe=new j0(Mwe,t=>({__tag:"DrawBuffers",...t}));function Mwe(t){return t?B0(t.buffers):null}const VXe=new j0(GXe,t=>({blending:EXe(t.blending),culling:CXe(t.culling),polygonOffset:AXe(t.polygonOffset),depthTest:OXe(t.depthTest),stencilTest:RXe(t.stencilTest),depthWrite:MXe(t.depthWrite),colorWrite:PXe(t.colorWrite),stencilWrite:IXe(t.stencilWrite),drawBuffers:$Xe(t.drawBuffers)}));function GXe(t){return t?B0([xwe(t.blending),Twe(t.culling),Swe(t.polygonOffset),Ewe(t.depthTest),Cwe(t.stencilTest),Awe(t.depthWrite),Owe(t.colorWrite),Rwe(t.stencilWrite),Mwe(t.drawBuffers)]):null}let HXe=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,i,r,n){return(r||e!==i)&&(n(e),this._pipelineInvalid=!0),e}},qXe=class extends Vr{constructor(){super(...arguments),this.heightParameters=ji(),this.radii=Ct(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=Ct(),this.backgroundColor=H()}},L5=class Pwe extends wr{initializeProgram(e){return new fr(e.rctx,Pwe.shader.get().build(this.configuration),ar)}initializePipeline(){return this.configuration.reduced?mi({blending:Xc(et.ONE,et.ZERO),depthTest:{func:Tr.ALWAYS},colorWrite:Oi}):this.configuration.haze?mi({blending:Zo(et.ONE,et.ZERO,et.ONE_MINUS_SRC_COLOR,et.ONE),colorWrite:Oi}):mi({blending:Xc(et.SRC_ALPHA,et.ONE_MINUS_SRC_ALPHA),depthTest:{func:Tr.LEQUAL},colorWrite:Oi})}};L5.shader=new pr(xXe,()=>ke(()=>import("./ChapmanAtmosphere.glsl-681115e3.js"),[],import.meta.url));let rc=class extends Vr{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,i={key:this.key};for(const r of e)i[r]=this[r];return i}};function ce(t={}){return(e,i)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(i),t.constValue!=null)Object.defineProperty(e,i,{get:()=>t.constValue});else{const r=e._parameterNames.length-1,n=t.count||2,s=Math.ceil(Math.log2(n)),a=e._parameterBits??[0];let u=0;for(;a[u]+s>16;)u++,u>=a.length&&a.push(0);e._parameterBits=a;const p=a[u],y=(1<<s)-1<<p;a[u]+=s,Object.defineProperty(e,i,{get(){return this[r]},set(b){if(this[r]!==b&&(this[r]=b,this._keyDirty=!0,this._parameterBits[u]=this._parameterBits[u]&~y|+b<<p&y,typeof b!="number"&&typeof b!="boolean"))throw new Error("Configuration value for "+i+" must be boolean or number, got "+typeof b)}})}}}let jL=class extends rc{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};_([ce()],jL.prototype,"haze",void 0),_([ce()],jL.prototype,"reduced",void 0);const XA=-3;var sp;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(sp||(sp={}));let WXe=class{constructor(e,i,r){this.name=e,this._storage=i,this.id=XXe+++":",this.size=0,this.maxSize=0,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),r&&(this._storage.registerRemoveFunc(this.id,r),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get sizeAll(){return this._storage.size}resetHitRate(){this._hit=this._miss=0}put(e,i,r,n=0){this._storage.put(this,e,i,r,n)}get(e){const i=this._storage.get(this,e);return i===void 0?++this._miss:++this._hit,i}peek(e){return this._storage.peek(this,e)}pop(e){const i=this._storage.pop(this,e);return i===void 0?++this._miss:++this._hit,i}updateSize(e,i,r){this._storage.updateSize(this,e,i,r)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},Iwe=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new xi,this._users=new xi}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,i){this._removeFuncs.push([e,i])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(i=>i[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimits()}put(e,i,r,n,s){i=e.id+i;const a=this._db.get(i);if(a&&(this._size-=a.size,e.size-=a.size,this._db.delete(i),a.entry!==r&&this._notifyRemove(i,a.entry,sp.ALL)),n>this._maxSize)return void this._notifyRemove(i,r,sp.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!n||n<0)return console.warn(`Refusing to cache entry with size ${n} for key ${i}`),void this._notifyRemove(i,r,sp.ALL);const u=1+Math.max(s,XA)-XA;this._db.set(i,{entry:r,size:n,lifetime:u,lives:u}),this._size+=n,e.size+=n,this._checkSizeLimits()}updateSize(e,i,r,n){i=e.id+i;const s=this._db.get(i);if(s&&s.entry===r){for(this._size-=s.size,e.size-=s.size;n>this._maxSize;){const a=this._notifyRemove(i,r,sp.SOME);if(!(a!=null&&a>0))return void this._db.delete(i);n=a}s.size=n,this._size+=n,e.size+=n,this._checkSizeLimits()}}pop(e,i){i=e.id+i;const r=this._db.get(i);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(i),++this._hit,r.entry;++this._miss}get(e,i){i=e.id+i;const r=this._db.get(i);if(r!==void 0)return this._db.delete(i),r.lives=r.lifetime,this._db.set(i,r),++this._hit,r.entry;++this._miss}peek(e,i){const r=this._db.get(e.id+i);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((a,u)=>{const p=a.lifetime;r[p]=(r[p]||0)+a.size,this._users.forAll(y=>{const{id:b,name:S}=y;if(u.startsWith(b)){const C=i[S]||0;i[S]=C+a.size}})});const n={};this._users.forAll(a=>{const u=a.name;if("hitRate"in a&&typeof a.hitRate=="number"&&!isNaN(a.hitRate)&&a.hitRate>0){const p=i[u]||0;i[u]=p,n[u]=Math.round(100*a.hitRate)+"%"}else n[u]="0%"});const s=Object.keys(i);s.sort((a,u)=>i[u]-i[a]),s.forEach(a=>e[a]=Math.round(i[a]/2**20)+"MB / "+n[a]);for(let a=r.length-1;a>=0;--a){const u=r[a];u&&(e["Priority "+(a+XA-1)]=Math.round(u/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const i=e.id;this._db.forEach((r,n)=>{n.startsWith(i)&&(this._size-=r.size,this._db.delete(n),this._notifyRemove(n,r.entry,sp.ALL))}),e.size=0}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,sp.ALL)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r){let n;return this._removeFuncs.some(s=>{if(e.startsWith(s[0])){const a=s[1](i,r);return typeof a=="number"&&(n=a),!0}return!1}),n}_checkSizeLimits(){if(this._size>this._maxSize){for(const[e,i]of this._db)if(this._purgeItem(e,i),this._size<=.9*this.maxSize)return}this._users.forEach(e=>{if(e.maxSize>0&&e.size>e.maxSize){for(const[i,r]of this._db)if(i.startsWith(e.id)&&(this._purgeItem(i,r,e),e.size<=.9*e.maxSize))return}})}_purgeItem(e,i,r=this._users.find(n=>e.startsWith(n.id))){if(this._db.delete(e),i.lives<=1){this._size-=i.size,r&&(r.size-=i.size);const n=this._notifyRemove(e,i.entry,sp.SOME);n!=null&&n>0&&(this._size+=n,r&&(r.size+=n),i.lives=i.lifetime,i.size=n,this._db.set(e,i))}else--i.lives,this._db.set(e,i)}},XXe=0,uR=class{constructor(e,i){this._cache=e(i,(r,n)=>this._remove(r,n))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}pop(e){const i=this._cache.peek(e);if(!i)return;const r=i.pop();if(i.length>0){const n=i.reduce((s,a)=>s+a.usedMemory,0);this._cache.updateSize(e,i,n)}else this._cache.pop(e);return r}put(e,i,r=XA){const n=this._cache.peek(e);if(!n)return void this._cache.put(e,[i],i.usedMemory,r);n.push(i);const s=n.reduce((a,u)=>a+u.usedMemory,0);this._cache.updateSize(e,n,s)}_remove(e,i){switch(i){case sp.ALL:return e.forEach(r=>r.dispose()),0;case sp.SOME:return e.shift()?.dispose(),e.reduce((r,n)=>r+n.usedMemory,0)}}},JF=class{constructor(e,i){this._last=new xi,this._incarnation=0,this._cache=new uR(e,i)}destroy(){this._last?.forAll(e=>e.dispose()),this._last=null,this._cache.destroy()}set interactive(e){e&&!this._last?this._last=new xi:e||(this._last?.forAll(i=>i.dispose()),this._last=null)}clean(){this._last?.filterInPlace(e=>!(e.incarnation<this._incarnation)||(this._cache.put(e.key,e),!1))}frame(){++this._incarnation}pop(e){if(this._last){const i=this._last.find(r=>r.key===e);if(i)return this._last.removeUnordered(i),i}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){return this._last?.reduce((e,i)=>e+i.usedMemory,0)??0}};var Ji;function qG(t,e,i={}){const r=e===Ji.WEBGL1?"webgl":"webgl2";return t.getContext(r,i)||null}function JXe(t,e,i={}){const r=$we(t);for(const n of r){const s=qG(e,n,i);if(s)return s}return null}function $we(t){if(t==="3d")return[Ji.WEBGL2];const e=Me("esri-force-webgl");return e===Ji.WEBGL1||e===Ji.WEBGL2?[e]:Me("mac")&&Me("chrome")?[Ji.WEBGL1,Ji.WEBGL2]:[Ji.WEBGL2,Ji.WEBGL1]}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(Ji||(Ji={}));const rf=Ee.getLogger("esri.views.webgl.BufferObject");let xr=class Ex{static createIndex(e,i,r){return new Ex(e,li.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(e,i,r){return new Ex(e,li.ARRAY_BUFFER,i,r)}static createUniform(e,i,r){if(e.type!==Ji.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new Ex(e,li.UNIFORM_BUFFER,i,r)}static createPixelPack(e,i=dr.STREAM_READ,r){if(e.type!==Ji.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const n=new Ex(e,li.PIXEL_PACK_BUFFER,i);return r&&n.setSize(r),n}static createPixelUnpack(e,i=dr.STREAM_DRAW,r){if(e.type!==Ji.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new Ex(e,li.PIXEL_UNPACK_BUFFER,i,r)}constructor(e,i,r,n){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(gs.BufferObject,this),this._glName=this._context.gl.createBuffer(),r0(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===li.ELEMENT_ARRAY_BUFFER?this._indexType===Ft.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===li.ELEMENT_ARRAY_BUFFER||this.bufferType===li.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(gs.BufferObject,this),this._context=null):this._glName&&rf.warn("Leaked WebGL buffer object")}setSize(e,i=null){if(e<=0&&rf.error("Buffer size needs to be positive!"),this.bufferType===li.ELEMENT_ARRAY_BUFFER&&i!=null)switch(this._indexType=i,i){case Ft.UNSIGNED_SHORT:e*=2;break;case Ft.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===li.ELEMENT_ARRAY_BUFFER&&(mD(e)&&(i/=2,this._indexType=Ft.UNSIGNED_SHORT),gD(e)&&(i/=4,this._indexType=Ft.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;i!=null?n.bufferData(this.bufferType,i,this.usage):n.bufferData(this.bufferType,e,this.usage),r0(n),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,n){if(!e)return;(i<0||i*e.BYTES_PER_ELEMENT>=this.byteLength)&&rf.error("offset is out of range!"),r>=n&&rf.error("end must be bigger than start!"),(i+(n-r))*e.BYTES_PER_ELEMENT>this.byteLength&&rf.error("An attempt to write beyond the end of the buffer!");const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const a=this._context.gl;if(this._context.type===Ji.WEBGL2)a.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,n-r);else{const u=r===0&&n===e.length?e:e.subarray(r,n);a.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,u)}r0(a),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,i=0,r,n){if(this._context.type!==Ji.WEBGL2)return void rf.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||n<0)return void rf.error("Problem getting subdata: offset and length were less than zero!");const s=YXe(e)?e.BYTES_PER_ELEMENT:1;if(s*((r??0)+(n??0))>e.byteLength)return void rf.error("Problem getting subdata: offset and length exceeded destination size!");i+s*(n??0)>this.byteLength&&rf.warn("Potential problem getting subdata: requested data exceeds buffer size!");const a=this._context.gl;this._context.bindBuffer(this,li.COPY_READ_BUFFER),a.getBufferSubData(li.COPY_READ_BUFFER,i,e,r,n),this._context.unbindBuffer(li.COPY_READ_BUFFER)}async getSubDataAsync(e,i=0,r,n){this._context.type===Ji.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,i,r,n)):rf.error("Get buffer subdata is supported in WebGL2 only!")}};function YXe(t){return VPe(t)}var vv;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(vv||(vv={}));function ZXe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function dg(t,e){return t.vertexBuffers[e].byteLength/KXe(t.layout[e])}function KXe(t){return t[0].stride}function ZZ(t,e,i,r,n=0){const s=t.gl;t.bindBuffer(i);for(const a of r){const u=e.get(a.name);u===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const p=n*a.stride;if(a.count<=4)s.vertexAttribPointer(u,a.count,a.type,a.normalized,a.stride,a.offset+p),s.enableVertexAttribArray(u),a.divisor>0&&t.gl2?.vertexAttribDivisor(u,a.divisor);else if(a.count===9)for(let y=0;y<3;y++)s.vertexAttribPointer(u+y,3,a.type,a.normalized,a.stride,a.offset+12*y+p),s.enableVertexAttribArray(u+y),a.divisor>0&&t.gl2?.vertexAttribDivisor(u+y,a.divisor);else if(a.count===16)for(let y=0;y<4;y++)s.vertexAttribPointer(u+y,4,a.type,a.normalized,a.stride,a.offset+16*y+p),s.enableVertexAttribArray(u+y),a.divisor>0&&t.gl2?.vertexAttribDivisor(u+y,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function KZ(t,e,i,r){const n=t.gl;t.bindBuffer(i);for(const s of r){const a=e.get(s.name);if(s.count<=4)n.disableVertexAttribArray(a),s.divisor&&s.divisor>0&&t.gl2?.vertexAttribDivisor(a,0);else if(s.count===9)for(let u=0;u<3;u++)n.disableVertexAttribArray(a+u),s.divisor&&s.divisor>0&&t.gl2?.vertexAttribDivisor(a+u,0);else if(s.count===16)for(let u=0;u<4;u++)n.disableVertexAttribArray(a+u),s.divisor&&s.divisor>0&&t.gl2?.vertexAttribDivisor(a+u,0);else console.error("Unsupported vertex attribute element count: "+s.count)}t.unbindBuffer(li.ARRAY_BUFFER)}function QZ(t){switch(t){case ei.ALPHA:case ei.LUMINANCE:case ei.RED:case ei.RED_INTEGER:case Mt.R8:case Mt.R8I:case Mt.R8UI:case Mt.R8_SNORM:case Eo.STENCIL_INDEX8:return 1;case ei.LUMINANCE_ALPHA:case ei.RG:case ei.RG_INTEGER:case Mt.RGBA4:case Mt.R16F:case Mt.R16I:case Mt.R16UI:case Mt.RG8:case Mt.RG8I:case Mt.RG8UI:case Mt.RG8_SNORM:case Mt.RGB565:case Mt.RGB5_A1:case Eo.DEPTH_COMPONENT16:return 2;case ei.DEPTH_COMPONENT:case ei.RGB:case ei.RGB_INTEGER:case Mt.RGB8:case Mt.RGB8I:case Mt.RGB8UI:case Mt.RGB8_SNORM:case Mt.SRGB8:case Eo.DEPTH_COMPONENT24:return 3;case ei.DEPTH_STENCIL:case ei.DEPTH24_STENCIL8:case ei.RGBA:case ei.RGBA_INTEGER:case Mt.RGBA8:case Mt.R32F:case Mt.R11F_G11F_B10F:case Mt.RG16F:case Mt.R32I:case Mt.R32UI:case Mt.RG16I:case Mt.RG16UI:case Mt.RGBA8I:case Mt.RGBA8UI:case Mt.RGBA8_SNORM:case Mt.SRGB8_ALPHA8:case Mt.RGB9_E5:case Mt.RGB10_A2UI:case Mt.RGB10_A2:case Eo.DEPTH_STENCIL:case Eo.DEPTH_COMPONENT32F:case Eo.DEPTH24_STENCIL8:return 4;case Eo.DEPTH32F_STENCIL8:return 5;case Mt.RGB16F:case Mt.RGB16I:case Mt.RGB16UI:return 6;case Mt.RG32F:case Mt.RG32I:case Mt.RG32UI:case Mt.RGBA16F:case Mt.RGBA16I:case Mt.RGBA16UI:return 8;case Mt.RGB32F:case Mt.RGB32I:case Mt.RGB32UI:return 12;case Mt.RGBA32F:case Mt.RGBA32I:case Mt.RGBA32UI:return 16;case es.COMPRESSED_RGB_S3TC_DXT1_EXT:case es.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case es.COMPRESSED_RGBA_S3TC_DXT3_EXT:case es.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case es.COMPRESSED_R11_EAC:case es.COMPRESSED_SIGNED_R11_EAC:case es.COMPRESSED_RGB8_ETC2:case es.COMPRESSED_SRGB8_ETC2:case es.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case es.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case es.COMPRESSED_RG11_EAC:case es.COMPRESSED_SIGNED_RG11_EAC:case es.COMPRESSED_RGBA8_ETC2_EAC:case es.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}let c$=class{constructor(e,i,r=i){this.internalFormat=e,this.width=i,this.height=r,this.multisampled=!1,this.samples=1}};function QXe(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*QZ(t.internalFormat)}let Lwe=class{constructor(e,i){this._context=e,this._descriptor=i,this.type=vv.RenderBuffer,this._context.instanceCounter.increment(gs.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:n,height:s,internalFormat:a,multisampled:u}=i;if(u){if(this._context.type!==Ji.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,a,n,s)}else r.renderbufferStorage(r.RENDERBUFFER,a,n,s)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}get gpuMemoryUsage(){return QXe(this._descriptor)}resize(e,i){const r=this._descriptor;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const n=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):n.renderbufferStorage(n.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(gs.Renderbuffer,this),this._context=null)}},Ar=class{constructor(e=0,i=e){this.width=e,this.height=i,this.target=Vn.TEXTURE_2D,this.pixelFormat=ei.RGBA,this.dataType=Qs.UNSIGNED_BYTE,this.samplingMode=Si.LINEAR,this.wrapMode=Ai.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function eJe(t){return t.width<=0||t.height<=0?0:t.width*t.height*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:QZ(t.internalFormat))}let tJe=class Dwe extends Ar{constructor(e,i){switch(super(),this.context=e,Object.assign(this,i),this.internalFormat){case Mt.R16F:case Mt.R16I:case Mt.R16UI:case Mt.R32F:case Mt.R32I:case Mt.R32UI:case Mt.R8_SNORM:case Mt.R8:case Mt.R8I:case Mt.R8UI:this.pixelFormat=ei.RED}}static validate(e,i){return new Dwe(e,i)}};const mse=4;let yi=class{constructor(e,i=null,r=null){if(this.type=vv.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=i;else{const n=tJe.validate(e,i);if(!n)throw new de("Texture descriptor invalid");this._descriptor=n}if(this._descriptor.context.type!==Ji.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),sb(this._descriptor.target)))throw new de("3D and array textures are not supported in WebGL1");this._descriptor.target===Vn.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get gpuMemoryUsage(){return oJe.delete(this),eJe(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(gs.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new de("Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===Vn.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let i=Vn.TEXTURE_CUBE_MAP_POSITIVE_X;i<=Vn.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(e,i)}setData(e){this._setData(e)}_setData(e,i){if(!this._descriptor.context?.gl)return;const r=this._descriptor.context.gl;r0(r),this._glName||(this._glName=r.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(gs.Texture,this)),e===void 0&&(e=null);const n=this._descriptor,s=i??n.target,a=sb(s);e===null&&(n.width=n.width||mse,n.height=n.height||mse,a&&(n.depth=n.depth??1));const u=this._descriptor.context.bindTexture(this,yi.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(yi.TEXTURE_UNIT_FOR_UPDATES),YF(this._descriptor.context,n),this._configurePixelStorage(),r0(r);const p=this._deriveInternalFormat();if(ZF(e)){let y="width"in e?e.width:e.codedWidth,b="height"in e?e.height:e.codedHeight;const S=1;e instanceof HTMLVideoElement&&(y=e.videoWidth,b=e.videoHeight),n.width&&n.height,a&&n.depth,n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,p,n.hasMipmap,y,b,S),this._texImage(s,0,p,y,b,S,e),r0(r),n.hasMipmap&&this.generateMipmap(),n.width||(n.width=y),n.height||(n.height=b),a&&!n.depth&&(n.depth=S)}else{const{width:y,height:b,depth:S}=n;if(y==null||b==null)throw new de("Width and height must be specified!");if(a&&S==null)throw new de("Depth must be specified!");if(n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,p,n.hasMipmap,y,b,S),u$(e)){const C=e.levels,O=vse(s,y,b,S),P=Math.min(O-1,C.length-1);this._descriptor.context.gl2!=null?r.texParameteri(n.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,P):n.hasMipmap=n.hasMipmap&&O===C.length;const $=p;if(!nJe($))throw new de("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((N,z,U,j)=>{const G=C[Math.min(N,C.length-1)];this._compressedTexImage(s,N,$,z,U,j,G)},P)}else this._texImage(s,0,p,y,b,S,e),r0(r),n.hasMipmap&&this.generateMipmap()}gse(r,this._descriptor),yse(r,this._descriptor),iJe(this._descriptor.context,this._descriptor),r0(r),this._descriptor.context.bindTexture(u,yi.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,i,r,n,s,a,u=0){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const p=this._descriptor.context.gl,y=this._descriptor.context.gl2,b=this._descriptor,S=this._deriveInternalFormat(),{pixelFormat:C,dataType:O,target:P,isImmutable:$}=b;if($&&!this._wasImmutablyAllocated)throw new de("Cannot update immutable texture before allocation!");const N=this._descriptor.context.bindTexture(this,yi.TEXTURE_UNIT_FOR_UPDATES,!0);if((i<0||r<0||n>b.width||s>b.height||i+n>b.width||r+s>b.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),u){if(!y)return void console.error("Webgl2 must be enabled to use dataRowOffset!");p.pixelStorei(y.UNPACK_SKIP_ROWS,u)}if(ZF(a)?y?y.texSubImage2D(P,e,i,r,n,s,C,O,a):p.texSubImage2D(P,e,i,r,C,O,a):u$(a)?p.compressedTexSubImage2D(P,e,i,r,n,s,S,a.levels[e]):p.texSubImage2D(P,e,i,r,n,s,C,O,a),u){if(!y)return void console.error("Webgl2 must be enabled to use dataRowOffset!");p.pixelStorei(y.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(N,yi.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,n,s,a,u,p){p||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const y=this._descriptor.context.gl2;if(y==null)throw new de("3D textures are not supported in WebGL1");const b=this._descriptor,S=this._deriveInternalFormat(),{pixelFormat:C,dataType:O,isImmutable:P,target:$}=b;if(P&&!this._wasImmutablyAllocated)throw new de("Cannot update immutable texture before allocation!");sb($)||console.warn("Attempting to set 3D texture data on a non-3D texture");const N=this._descriptor.context.bindTexture(this,yi.TEXTURE_UNIT_FOR_UPDATES);if(this._descriptor.context.setActiveTexture(yi.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||n<0||s>b.width||a>b.height||u>b.depth||i+s>b.width||r+a>b.height||n+u>b.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),u$(p))p=p.levels[e],y.compressedTexSubImage3D($,e,i,r,n,s,a,u,S,p);else{const z=p;y.texSubImage3D($,e,i,r,n,s,a,u,C,O,z)}this._descriptor.context.bindTexture(N,yi.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new de("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,YF(this._descriptor.context,e)}e.samplingMode===Si.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=Si.LINEAR_MIPMAP_NEAREST):e.samplingMode===Si.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=Si.NEAREST_MIPMAP_NEAREST);const i=this._descriptor.context.bindTexture(this,yi.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(yi.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,yi.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,YF(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor.context.gl,i=this._descriptor;this._samplingModeDirty&&(gse(e,i),this._samplingModeDirty=!1),this._wrapModeDirty&&(yse(e,i),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.context.type===Ji.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===ei.DEPTH_STENCIL&&(this._descriptor.internalFormat=ei.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case Qs.FLOAT:switch(this._descriptor.pixelFormat){case ei.RGBA:return this._descriptor.internalFormat=Mt.RGBA32F;case ei.RGB:return this._descriptor.internalFormat=Mt.RGB32F;default:throw new de("Unable to derive format")}case Qs.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case ei.RGBA:return this._descriptor.internalFormat=Mt.RGBA8;case ei.RGB:return this._descriptor.internalFormat=Mt.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===ei.DEPTH_STENCIL?ei.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:n}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0)}_texStorage(e,i,r,n,s,a){const u=this._descriptor.context.gl2;if(u==null)throw new de("Immutable textures are not supported in WebGL1");if(!rJe(i))throw new de("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const p=r?vse(e,n,s,a):1;if(sb(e)){if(a==null)throw new de("Missing depth dimension for 3D texture upload");u.texStorage3D(e,p,i,n,s,a)}else u.texStorage2D(e,p,i,n,s);this._wasImmutablyAllocated=!0}_texImage(e,i,r,n,s,a,u){const p=this._descriptor.context.gl,y=sb(e),{isImmutable:b,pixelFormat:S,dataType:C}=this._descriptor,O=this._descriptor.context.type===Ji.WEBGL2,P=O?p:null;if(O||!ZF(u))if(b){if(u!=null){const $=u;if(y){if(a==null)throw new de("Missing depth dimension for 3D texture upload");P.texSubImage3D(e,i,0,0,0,n,s,a,S,C,$)}else p.texSubImage2D(e,i,0,0,n,s,S,C,$)}}else{const $=u;if(y){if(a==null)throw new de("Missing depth dimension for 3D texture upload");P.texImage3D(e,i,r,n,s,a,0,S,C,$)}else p.texImage2D(e,i,r,n,s,0,S,C,$)}else p.texImage2D(e,0,r,S,C,u)}_compressedTexImage(e,i,r,n,s,a,u){const p=this._descriptor.context.gl;let y=null;const b=sb(e),S=this._descriptor.isImmutable;if(b){if(this._descriptor.context.type!==Ji.WEBGL2)throw new de("3D textures are not supported in WebGL1");y=p}if(S){if(u!=null)if(b){if(a==null)throw new de("Missing depth dimension for 3D texture upload");y.compressedTexSubImage3D(e,i,0,0,0,n,s,a,r,u)}else p.compressedTexSubImage2D(e,i,0,0,n,s,r,u)}else if(b){if(a==null)throw new de("Missing depth dimension for 3D texture upload");y.compressedTexImage3D(e,i,r,n,s,a,0,u)}else p.compressedTexImage2D(e,i,r,n,s,0,u)}_forEachMipmapLevel(e,i=1/0){let{width:r,height:n,depth:s,hasMipmap:a,target:u}=this._descriptor;const p=u===Vn.TEXTURE_3D;if(r==null||n==null||p&&s==null)throw new de("Missing texture dimensions for mipmap calculation");for(let y=0;e(y,r,n,s),a&&(r!==1||n!==1||p&&s!==1)&&!(y>=i);++y)r=Math.max(1,r>>1),n=Math.max(1,n>>1),p&&(s=Math.max(1,s>>1))}};function YF(t,e){(e.width!=null&&e.width<0||e.height!=null&&e.height<0||e.depth!=null&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!");const i=t.type===Ji.WEBGL2;i||!e.isImmutable&&!sb(e.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),!i&&(e.width!=null&&G2(e.width)&&e.height!=null&&G2(e.height)||(typeof e.wrapMode=="number"?e.wrapMode!==Ai.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):e.wrapMode.s===Ai.CLAMP_TO_EDGE&&e.wrapMode.t===Ai.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!")))}function gse(t,e){let i=e.samplingMode,r=e.samplingMode;i===Si.LINEAR_MIPMAP_NEAREST||i===Si.LINEAR_MIPMAP_LINEAR?(i=Si.LINEAR,e.hasMipmap||(r=Si.LINEAR)):i!==Si.NEAREST_MIPMAP_NEAREST&&i!==Si.NEAREST_MIPMAP_LINEAR||(i=Si.NEAREST,e.hasMipmap||(r=Si.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,r)}function yse(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function iJe(t,e){const i=t.capabilities.textureFilterAnisotropic;i&&t.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function rJe(t){return t in Mt}function nJe(t){return t in es}function u$(t){return t!=null&&"type"in t&&t.type==="compressed"}function sJe(t){return t!=null&&"byteLength"in t}function ZF(t){return t!=null&&!u$(t)&&!sJe(t)}function sb(t){return t===Vn.TEXTURE_3D||t===Vn.TEXTURE_2D_ARRAY}function vse(t,e,i,r=1){let n=Math.max(e,i);return t===Vn.TEXTURE_3D&&(n=Math.max(n,r)),Math.round(Math.log(n)/Math.LN2)+1}yi.TEXTURE_UNIT_FOR_UPDATES=0;const oJe=new Map,aJe=Ee.getLogger("esri.views.webgl.FramebufferObject");let qp=class Cx{constructor(e,i,r=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(gs.FramebufferObject,this);const n=h$(i)?i:new yi(this._context,i);if(this._colorAttachments.set(Gl.COLOR_ATTACHMENT0,n),this._validateTextureDescriptor(n.descriptor),this._validateColorAttachmentPoint(Gl.COLOR_ATTACHMENT0),r!=null)if(cJe(r))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=h$(r)?r:new yi(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const s=lJe(r)?r:new Lwe(this._context,r);this._depthStencilBuffer=s,this._validateRenderBufferDescriptor(s.descriptor)}}dispose(){if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((i,r)=>this.detachColorTexture(r)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(gs.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(Gl.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(Gl.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(Gl.COLOR_ATTACHMENT0)?.descriptor?.height??0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((e,[i,r])=>e+r.gpuMemoryUsage,this.depthStencil?.gpuMemoryUsage??0)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&h$(i)?i:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,i=Gl.COLOR_ATTACHMENT0){if(!e)return;this._validateColorAttachmentPoint(i);const r=e.descriptor;this._validateTextureDescriptor(r),this.detachColorTexture(i)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e)}detachColorTexture(e=Gl.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);if(i)return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),i}setColorTextureTarget(e,i=Gl.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);r&&this._framebufferTexture2D(r.glName,i,e)}attachDepthStencil(e){if(e)switch(e.type){case vv.Texture:return this._attachDepthStencilTexture(e);case vv.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(e==null)return;const i=e.descriptor;i.pixelFormat!==ei.DEPTH_STENCIL&&i.pixelFormat!==ei.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==Qs.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,use)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,use)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const i=e.descriptor;if(this._validateRenderBufferDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,n=this._getGLAttachmentPoint(i);r.framebufferRenderbuffer(la.FRAMEBUFFER,n,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,r=this._getGLAttachmentPoint(e.descriptor);i.framebufferRenderbuffer(la.FRAMEBUFFER,r,i.RENDERBUFFER,null)}return this._depthStencilBuffer=null,e}copyToTexture(e,i,r,n,s,a,u){(e<0||i<0||s<0||a<0)&&console.error("Offsets cannot be negative!"),(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const p=u.descriptor;u.descriptor.target!==Vn.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(p?.width==null||p?.height==null||e+r>this.width||i+n>this.height||s+r>p.width||a+n>p.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const y=this._context,b=y.bindTexture(u,yi.TEXTURE_UNIT_FOR_UPDATES);y.setActiveTexture(yi.TEXTURE_UNIT_FOR_UPDATES),y.bindFramebuffer(this),y.gl.copyTexSubImage2D(Vn.TEXTURE_2D,0,s,a,e,i,r,n),y.bindTexture(b,yi.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,n,s,a,u){(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),u||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,n,s,a,u)}async readPixelsAsync(e,i,r,n,s,a,u){if(this._context.type!==Ji.WEBGL2)return np()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,i,r,n,s,a,u);const p=this._context.gl,y=xr.createPixelPack(this._context,dr.STREAM_READ,u.byteLength);this._context.bindBuffer(y),this._context.bindFramebuffer(this),p.readPixels(e,i,r,n,s,a,0),this._context.unbindBuffer(li.PIXEL_PACK_BUFFER),await y.getSubDataAsync(u),y.dispose()}resize(e,i){if(this.width===e&&this.height===i)return;const r={width:e,height:i};o2(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(n=>n.resize(r.width,r.height)),this._depthStencilTexture?.resize(r.width,r.height),this._initialized&&(o2(r,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=la.FRAMEBUFFER){const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=i.createFramebuffer();if(i.bindFramebuffer(e,r),this._colorAttachments.forEach((n,s)=>this._framebufferTexture2D(n.glName,s,_se(n),e)),this._depthStencilBuffer){const n=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);i.framebufferRenderbuffer(e,n,i.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,_se(this._depthStencilTexture),e);np()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,i=Gl.COLOR_ATTACHMENT0,r=Vn.TEXTURE_2D,n=la.FRAMEBUFFER,s=0){this._context.gl.framebufferTexture2D(n,i,r,e,s)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(la.FRAMEBUFFER,i,e.RENDERBUFFER,null)}this._depthStencilBuffer=jt(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=jt(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==Vn.TEXTURE_2D&&e.target!==Vn.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),o2(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){o2(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case Eo.DEPTH_COMPONENT16:case Eo.DEPTH_COMPONENT24:case Eo.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case Eo.DEPTH24_STENCIL8:case Eo.DEPTH32F_STENCIL8:case Eo.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case Eo.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(Cx._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const n=this._context.gl;Cx._MAX_COLOR_ATTACHMENTS=n.getParameter(r.MAX_COLOR_ATTACHMENTS)}else Cx._MAX_COLOR_ATTACHMENTS=1}const i=e-Gl.COLOR_ATTACHMENT0;i+1>Cx._MAX_COLOR_ATTACHMENTS&&Ee.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${Cx._MAX_COLOR_ATTACHMENTS} color attachments`)}};function h$(t){return t!=null&&"type"in t&&t.type===vv.Texture}function lJe(t){return t!=null&&"type"in t&&t.type===vv.RenderBuffer}function cJe(t){return h$(t)||t!=null&&"pixelFormat"in t}function o2(t,e){const i=Math.max(t.width,t.height);if(i>e){aJe.warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function _se(t){return t.descriptor.target===Vn.TEXTURE_CUBE_MAP?Vn.TEXTURE_CUBE_MAP_POSITIVE_X:Vn.TEXTURE_2D}qp._MAX_COLOR_ATTACHMENTS=-1;let uJe=class{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new JF(e.newCache,"FBOCache"),this._depthCache=new JF(e.newCache,"DepthAttachmentCache"),this._colorCache=new JF(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frame(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame()}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,i)=>e+("colorTexture"in i?i.colorTexture?.gpuMemoryUsage??0:i.usedMemory),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,i,r){const n=KF(e,i,r),s=this._cache.pop(n)||new hJe(n,new qp(this.rctx,{...wse[e],width:i,height:r}),a=>(s.releaseDepth(),s.depth=this._acquireDepth(a,s.fbo.width,s.fbo.height),s.fbo.attachDepthStencil(s.depth.attachment),s),(a,u)=>{const p=this._acquireColor(a,i,r);return s.colors??(s.colors=new Map),s.colors.set(u,p),s.fbo.attachColorTexture(p.attachment,u),s});return s.release=()=>{this._acquired.delete(s),s.releaseDepth(),this._cache.put(s),s.release=()=>console.log(`Double FBO release in ${new Error().stack}`)},this.rctx.unbindTexture(s.fbo.colorTexture),this._trackHandle(s)}acquireDepth(e,i,r){return this._acquireDepth(e,i,r)}_acquireDepth(e,i,r){const n=KF(e,i,r),s=this._depthCache.pop(n);if(s)return this._trackHandle(s);const a=e===Vs.DEPTH_STENCIL_TEXTURE?new bse(n,new yi(this.rctx,{...xse[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)}):new bse(n,new Lwe(this.rctx,{...xse[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)});return this._trackHandle(a)}_acquireColor(e,i,r){const n=KF(e,i,r),s=this._colorCache.pop(n);if(s)return this._trackHandle(s);const a=new dJe(n,new yi(this.rctx,{...wse[e],width:i,height:r}),()=>{this._acquired.delete(a),this._colorCache.put(a)});return this._trackHandle(a)}_trackHandle(e){return this._acquired.add(e),e}},hJe=class{constructor(e,i,r,n){this.key=e,this.fbo=i,this.acquireDepth=r,this.acquireColor=n,this.release=()=>{},this.incarnation=0}dispose(){this.fbo.dispose()}releaseDepth(){this.fbo.detachDepthStencilTexture(),this.fbo.detachDepthStencilBuffer(),this.depth=Gi(this.depth)}detachDepth(){const e=this.depth;return this.depth=void 0,this.fbo.detachDepthStencilTexture(),this.fbo.detachDepthStencilBuffer(),e}attachDepth(e){return this.releaseDepth(),e&&(this.fbo.attachDepthStencil(e.attachment),this.depth=e),this}releaseColor(e){this.fbo.detachColorTexture(e);const i=this.colors?.get(e);this.colors?.delete(e),Gi(i)}get colorTexture(){return this.fbo?.colorTexture}getColorTexture(e=Gl.COLOR_ATTACHMENT0){return this.fbo?.getColorTexture(e)}get usedMemory(){return this.fbo.gpuMemoryUsage}},Nwe=class{constructor(e,i,r){this.key=e,this.attachment=i,this.release=r,this.incarnation=0}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.gpuMemoryUsage}},bse=class extends Nwe{},dJe=class extends Nwe{constructor(e,i,r){super(e,i,r),this.attachment=i,this.release=r}};function KF(t,e,i){return`${t}x${e}x${i}`}var sr;(function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"})(sr||(sr={}));const d$=new Ar;d$.pixelFormat=ei.RED,d$.internalFormat=Mt.R8,d$.wrapMode=Ai.CLAMP_TO_EDGE;const p$=new Ar;p$.pixelFormat=ei.RG,p$.internalFormat=Mt.RG8,p$.wrapMode=Ai.CLAMP_TO_EDGE;const f$=new Ar;f$.internalFormat=Mt.RGBA4,f$.dataType=Qs.UNSIGNED_SHORT_4_4_4_4,f$.wrapMode=Ai.CLAMP_TO_EDGE;const Fwe=new Ar;Fwe.wrapMode=Ai.CLAMP_TO_EDGE;const D5=new Ar;D5.wrapMode=Ai.CLAMP_TO_EDGE,D5.samplingMode=Si.LINEAR_MIPMAP_LINEAR,D5.hasMipmap=!0,D5.maxAnisotropy=8;const N5=new Ar;N5.pixelFormat=ei.RED,N5.dataType=Qs.HALF_FLOAT,N5.internalFormat=Mt.R16F,N5.samplingMode=Si.NEAREST;const m$=new Ar;m$.dataType=Qs.HALF_FLOAT,m$.internalFormat=Mt.RGBA16F,m$.samplingMode=Si.NEAREST;const wse={[sr.RED]:d$,[sr.RG]:p$,[sr.RGBA4]:f$,[sr.RGBA]:Fwe,[sr.RGBA_MIPMAP]:D5,[sr.R16F]:N5,[sr.RGBA16F]:m$};var Vs;(function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH_STENCIL_BUFFER=1]="DEPTH_STENCIL_BUFFER",t[t.DEPTH24_BUFFER=2]="DEPTH24_BUFFER",t[t.DEPTH16_BUFFER=3]="DEPTH16_BUFFER"})(Vs||(Vs={}));const F5=new Ar;F5.pixelFormat=ei.DEPTH_STENCIL,F5.dataType=Qs.UNSIGNED_INT_24_8,F5.samplingMode=Si.NEAREST,F5.wrapMode=Ai.CLAMP_TO_EDGE;const xse={[Vs.DEPTH_STENCIL_TEXTURE]:F5,[Vs.DEPTH_STENCIL_BUFFER]:new c$(Eo.DEPTH24_STENCIL8,4),[Vs.DEPTH24_BUFFER]:new c$(Eo.DEPTH_COMPONENT24,4),[Vs.DEPTH16_BUFFER]:new c$(Eo.DEPTH_COMPONENT16,4)};let Yo=class{constructor(e,i,r,n,s,a=!1,u=0){this.name=e,this.count=i,this.type=r,this.offset=n,this.stride=s,this.normalized=a,this.divisor=u}};new Yo(X.POSITION,3,Ft.FLOAT,0,12);new Yo(X.POSITION,3,Ft.FLOAT,0,20),new Yo(X.UV0,2,Ft.FLOAT,12,20);new Yo(X.POSITION,3,Ft.FLOAT,0,32),new Yo(X.NORMAL,3,Ft.FLOAT,12,32),new Yo(X.UV0,2,Ft.FLOAT,24,32);new Yo(X.POSITION,3,Ft.FLOAT,0,16),new Yo(X.COLOR,4,Ft.UNSIGNED_BYTE,12,16);const eK=[new Yo(X.POSITION,2,Ft.FLOAT,0,8)],hR=[new Yo(X.POSITION,2,Ft.FLOAT,0,16),new Yo(X.UV0,2,Ft.FLOAT,8,16)],o3=Ee.getLogger("esri.views.webgl.VertexArrayObject");let cd=class{constructor(e,i,r,n,s=null){this._context=e,this._locations=i,this._layout=r,this._buffers=n,this._indexBuffer=s,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,i)=>e+this._buffers[i].byteLength,this._indexBuffer!=null?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*s0e}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const e in this._buffers)this._buffers[e]?.dispose(),delete this._buffers[e];this._indexBuffer=jt(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&o3.warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&((this._context?.capabilities?.vao).deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(gs.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const i=e.createVertexArray();e.bindVertexArray(i),this._bindLayout(),e.bindVertexArray(null),this._glName=i,this._context.instanceCounter.increment(gs.VertexArrayObject,this)}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:i,_indexBuffer:r}=this;e||o3.error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const s in e){const a=e[s];a||o3.error("Vertex buffer is uninitialized!");const u=i[s];u||o3.error("Vertex element descriptor is empty!"),ZZ(this._context,this._locations,a,u)}r!=null&&(this._context.capabilities.vao?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:i}=this;e||o3.error("Vertex buffer dictionary is empty!");for(const r in e){const n=e[r];n||o3.error("Vertex buffer is uninitialized!");const s=i[r];KZ(this._context,this._locations,n,s)}this._indexBuffer!=null&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},Wp=class extends cd{};function V0(t,e=eK,i=ar,r=-1,n=1){let s=null;return e===hR?s=new Float32Array([r,r,0,0,n,r,1,0,r,n,0,1,n,n,1,1]):s=new Float32Array([r,r,n,r,r,n,n,n]),new Wp(t,i,{geometry:e},{geometry:xr.createVertex(t,dr.STATIC_DRAW,s)})}function pJe(t,e=eK,i=ar){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new Wp(t,i,{geometry:e},{geometry:xr.createVertex(t,dr.STATIC_DRAW,r)})}const fJe=4;function kwe(t){const e=new Ar(fJe);return e.samplingMode=Si.NEAREST,new yi(t,e)}function mJe(t){const e=new Ar(1);return e.samplingMode=Si.NEAREST,new yi(t,e,new Uint8Array([255,255,255,255]))}const Tse=16;function S2(t){return Math.ceil(t/Tse)*Tse}function gJe(t,e){let s=t.width*t.height;if(s<4096)return t instanceof ImageData?zwe(t):t;let a=t.width,u=t.height;do a=Math.ceil(a/2),u=Math.ceil(u/2),s=a*u;while(s>1048576||e!=null&&(a>e||u>e));return tK(t,a,u)}function yJe(t,e){const i=Math.max(t.width,t.height);if(i<=e)return t;const r=e/i;return tK(t,Math.round(t.width*r),Math.round(t.height*r))}function tK(t,e,i){if(t instanceof ImageData)return tK(zwe(t),e,i);const r=document.createElement("canvas");return r.width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,r.width,r.height),r}function zwe(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");if(i==null)throw new de("Failed to create 2d context from HTMLCanvasElement");return i.putImageData(t,0,0),e}function Ga(t,e=!0){t.attributes.add(X.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(F`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?F`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let Uwe=class extends Vr{};function vJe(t){const e=new lr;e.include(Ga),e.fragment.uniforms.add(new kt("colorTexture",r=>r.color),new kt("depthTexture",r=>r.depth));const i=t.haze;return e.fragment.code.add(F`
    void main() {
      ${i?F`vec4`:F`float`} depthSample = texture(depthTexture, uv) ${i?"":F`.r`};
      if (depthSample ${i?F`== vec4(0)`:F`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `),e}const _Je=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:Uwe,build:vJe},Symbol.toStringTag,{value:"Module"}));let jwe=class Bwe extends wr{initializeProgram(e){return new fr(e.rctx,Bwe.shader.get().build(this.configuration),ar)}initializePipeline(){return this.configuration.haze?mi({blending:Zo(et.ONE,et.ZERO,et.ONE_MINUS_SRC_COLOR,et.ONE),depthTest:{func:Tr.ALWAYS},colorWrite:Oi}):mi({blending:Xc(et.SRC_ALPHA,et.ONE_MINUS_SRC_ALPHA),depthTest:{func:Tr.ALWAYS},colorWrite:Oi})}};jwe.shader=new pr(_Je,()=>ke(()=>import("./AtmosphereCompositing.glsl-56abb9b9.js"),[],import.meta.url));let Sse=class{constructor(e,i){this._view=e,this._context=i,this.type=Oa.Realistic,this._handles=new Dg,this._atmosphereCompositionParameters=new Uwe,this._atmosphereConfiguration=new jL,this._passParameters=new qXe,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=ur.radius,this._fadeHaze=0,this._updateRadius(ur.radius);const r=this._context.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([Fe(()=>this._view?.basemapTerrain?.rootTileElevationBounds,()=>this._view?.basemapTerrain?this._updateRootTileElevationBounds():null),Fe(()=>this._view?.basemapTerrain?.visibleElevationBounds,()=>this._view?.basemapTerrain?this._updateVisibleElevationBounds():null),Fe(()=>this._view?.environment.background,s=>{const a=s instanceof uye?tO(s.color):qu;$e(this._passParameters.backgroundColor,a[0]*a[3],a[1]*a[3],a[2]*a[3])},Ur)]);const n=new jL;n.haze=!1,this._atmosphereTechnique=this._context.techniqueRepository.acquire(L5,n),n.haze=!0,this._atmosphereHazeTechnique=this._context.techniqueRepository.acquire(L5,n),n.reduced=!0,n.haze=!1,this._atmosphereReducedTechnique=this._context.techniqueRepository.acquire(L5,n),n.haze=!0,this._atmosphereHazeReducedTechnique=this._context.techniqueRepository.acquire(L5,n),this._vao=V0(r,hR)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,i){this._render(e,i?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,i,!1)}renderHaze(e,i,r){this._fadeHaze=i,this._render(e,r?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,e.bindParameters.linearDepth?.colorTexture,r,!0)}_render(e,i,r,n,s){if(r==null)return;const a=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=r;const u=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);if(n)a.renderDepthDetached(()=>this._renderCommon(u,e));else{const p=e.rctx.getViewport(),y=Qe(e.bindParameters.camera.eye)-ur.radius;let b;if(y<by){const $=Math.min(1,Math.max(0,y/by));b=s?si(.4,.5,$):si(.2,.3,$)}else{const $=Math.min(1,Math.max(0,(y-by)/(15*by)));b=s?si(.5,1,$):si(.3,.6,$)}const S=S2(Math.round(b*e.bindParameters.camera.fullViewport[2])),C=S2(Math.round(b*e.bindParameters.camera.fullViewport[3]));e.rctx.setViewport(0,0,S,C);const O=a.renderToCachedFBO(null,()=>this._renderCommon(u,e),[0,0,0,1],sr.RGBA,null,S,C);e.rctx.setViewport(p.x,p.y,p.width,p.height),this._atmosphereCompositionParameters.color=O.colorTexture,this._atmosphereCompositionParameters.depth=r,this._atmosphereConfiguration.haze=s;const P=this._context.techniqueRepository.acquire(jwe,this._atmosphereConfiguration);e.rctx.bindTechnique(P,this._atmosphereCompositionParameters,e.bindParameters),a.renderDepthDetached(()=>e.rctx.screen.draw()),P.release(),O.release()}}_renderCommon(e,i){this._vao!=null&&(i.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.rctx.drawArrays(Hi.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=ur.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(ur.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,Yi(this._passParameters.radii,e,e+by),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-kG)*kG)}_update(e){if(!e)return;const i=ha(e.eye),r=Math.sqrt(i),n=i-this._passParameters.radii[1]*this._passParameters.radii[1],s=Je((r-this._passParameters.radii[0])/by,0,1);_n(this._passParameters.heightParameters,r,i,n,s),this._passParameters.altitudeFade=JZ(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=si(si(.6,1,D4(9500,10500,r-ur.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function Vwe(t){t.fragment.code.add(F`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function iK(t,e){switch(t.include(g0,e),e.textureCoordinateType){case vs.Default:case vs.Compressed:return void t.fragment.code.add(F`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case vs.Atlas:return t.include(Vwe),void t.fragment.code.add(F`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case vs.None:case vs.COUNT:return}}let Wu=class extends zn{constructor(e,i){super(e,"vec3",hr.Draw,(r,n,s,a)=>r.setUniform3fv(e,i(n,s,a)))}},Wh=class extends zn{constructor(e,i){super(e,"sampler2D",hr.Draw,(r,n,s)=>r.bindTexture(e,i(n,s)))}},zv=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,i){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,i),this._technique),this._technique}ensureResources(e){return yv.LOADED}},rK=class extends zv{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRepository,this._textureId=e.textureId,this._acquire(e.textureId,i=>this._texture=i),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=Gi(this._texture),this._textureNormal=Gi(this._textureNormal),this._textureEmissive=Gi(this._textureEmissive),this._textureOcclusion=Gi(this._textureOcclusion),this._textureMetallicRoughness=Gi(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?yv.LOADED:yv.LOADING}get textureBindParameters(){return new Gwe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=Gi(this._texture),this._textureId=e,this._acquire(this._textureId,i=>this._texture=i))}_acquire(e,i){if(e==null)return void i(null);const r=this._textureRepository.acquire(e);if(Yc(r))return++this._numLoading,void r.then(n=>{if(this._disposed)return Gi(n),void i(null);i(n)}).finally(()=>--this._numLoading);i(r)}},Gwe=class extends Vr{constructor(e=null,i=null,r=null,n=null,s=null){super(),this.texture=e,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=n,this.textureMetallicRoughness=s}};var Gt;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(Gt||(Gt={}));function nK(t,e){const i=t.fragment,r=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===Gt.Normal&&r&&t.include(iK,e),e.pbrMode!==Gt.Schematic)if(e.pbrMode!==Gt.Disabled){if(e.pbrMode===Gt.Normal){i.code.add(F`vec3 mrr;
vec3 emission;
float occlusion;`);const n=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(i.uniforms.add(n===hr.Pass?new kt("texMetallicRoughness",s=>s.textureMetallicRoughness):new Wh("texMetallicRoughness",s=>s.textureMetallicRoughness)),i.code.add(F`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(i.uniforms.add(n===hr.Pass?new kt("texEmission",s=>s.textureEmissive):new Wh("texEmission",s=>s.textureEmissive)),i.code.add(F`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(i.uniforms.add(n===hr.Pass?new kt("texOcclusion",s=>s.textureOcclusion):new Wh("texOcclusion",s=>s.textureOcclusion)),i.code.add(F`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(F`float getBakedOcclusion() { return 1.0; }`),n===hr.Pass?i.uniforms.add(new _i("emissionFactor",s=>s.emissiveFactor),new _i("mrrFactors",s=>s.mrrFactors)):i.uniforms.add(new Wu("emissionFactor",s=>s.emissiveFactor),new Wu("mrrFactors",s=>s.mrrFactors)),i.code.add(F`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?F`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?F`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?F`applyEmission(${e.hasEmissiveTextureTransform?F`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?F`applyOcclusion(${e.hasOcclusionTextureTransform?F`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else i.code.add(F`float getBakedOcclusion() { return 1.0; }`);else i.code.add(F`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function sK(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new _i("lightingAmbientSH0",(n,s)=>$e(Ese,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0]))),i.code.add(F`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add(new er("lightingAmbientSH_R",(n,s)=>_n(em,s.lighting.sh.r[0],s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3])),new er("lightingAmbientSH_G",(n,s)=>_n(em,s.lighting.sh.g[0],s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3])),new er("lightingAmbientSH_B",(n,s)=>_n(em,s.lighting.sh.b[0],s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3]))),i.code.add(F`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add(new _i("lightingAmbientSH0",(n,s)=>$e(Ese,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0])),new er("lightingAmbientSH_R1",(n,s)=>_n(em,s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3],s.lighting.sh.r[4])),new er("lightingAmbientSH_G1",(n,s)=>_n(em,s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3],s.lighting.sh.g[4])),new er("lightingAmbientSH_B1",(n,s)=>_n(em,s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3],s.lighting.sh.b[4])),new er("lightingAmbientSH_R2",(n,s)=>_n(em,s.lighting.sh.r[5],s.lighting.sh.r[6],s.lighting.sh.r[7],s.lighting.sh.r[8])),new er("lightingAmbientSH_G2",(n,s)=>_n(em,s.lighting.sh.g[5],s.lighting.sh.g[6],s.lighting.sh.g[7],s.lighting.sh.g[8])),new er("lightingAmbientSH_B2",(n,s)=>_n(em,s.lighting.sh.b[5],s.lighting.sh.b[6],s.lighting.sh.b[7],s.lighting.sh.b[8]))),i.code.add(F`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==Gt.Normal&&e.pbrMode!==Gt.Schematic||i.code.add(F`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Ese=H(),em=ji();function dR(t){t.vertex.code.add(F`const float PI = 3.141592653589793;`),t.fragment.code.add(F`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var l0,Q2;function bJe(t){return t?.cubeMap!=null}function wJe(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FADING=1]="FADING",t[t.FINISHED=2]="FINISHED"})(l0||(l0={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(Q2||(Q2={}));function Bg(t=Hwe){return[t[0],t[1],t[2],t[3]]}function g$(t,e,i=Bg()){return Ie(i,t),i[3]=e,i}function Cse(t,e,i=Bg()){return qt(i,t,e),We(i,i),i[3]=-dge(t,e),i}function Ase(t,e,i=Bg()){return K4(XM,t,WG(t)),K4(Ose,e,WG(e)),$Z(XM,Ose,XM),TJe(i,wl(IZ(i,XM)))}function _$t(t,e,i,r=Bg()){return g$(lge,t,JM),g$(cge,e,Rse),g$(XJ,i,Mse),Ase(JM,Rse,JM),Ase(JM,Mse,r),r}function b$t(t){return t}function xJe(t){return t[3]}function WG(t){return gi(t[3])}function TJe(t,e){return t[3]=e,t}const Hwe=[0,0,1,0],XM=pd(),Ose=pd();Bg();const JM=Bg(),Rse=Bg(),Mse=Bg();let SJe=class{constructor(){this.readChannels=Q2.RG,this.renderingStage=l0.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=H(),this.parallax=new Pse,this.parallaxNew=new Pse,this.pointOnGround=H(),this.fadeMode=ln.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const i=this.parallax,r=Qe(e.eye);if(i.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(r*r-ur.radius*ur.radius,0))/r,Cse(Ise,i.anchorPointClouds,a3),Dc(i.transform,Cn,a3[3],a3),this.fadeMode===ln.CROSS_FADE){const n=this.parallaxNew;Cse(Ise,n.anchorPointClouds,a3),Dc(n.transform,Cn,a3[3],a3)}}updateFading(e,i,r,n){this.isFading&&this._advanceFading(r,n),this._evaluateFading(e,i,r)}_evaluateFading(e,i,r){const n=e.relativeElevation,s=this._calculateDistanceToAnchorPoint(e);if((n>1.7*Ym||n<-Ym||s>RJe)&&this.opacity>0)this._setFade(ln.HIDE,r);else if(!this.isFading){if((n>Ym||n<-.35*Ym||s>OJe)&&this.opacity>0)this._setFade(ln.FADE_OUT,r);else if(n<=Ym&&n>=-.35*Ym&&i===yr.IDLE&&wJe(this.data)){if(this.opacity===0)return void this._setFade(ln.FADE_IN,r);(s>AJe||this.renderingStage===l0.FADING)&&this._setFade(ln.CROSS_FADE,r)}}}_advanceFading(e,i){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,i)}_advanceFadingFactorAndOpacity(e,i){if(this.fadeFactor<1)return this.fadeFactor=i?Je((e-this.startTime)/(CJe*i),0,1):1,this.fadeMode===ln.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===ln.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===ln.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===ln.FADE_OUT&&(this.opacity=0),this.fadeMode===ln.FADE_IN&&(this.opacity=1),this.fadeMode===ln.CROSS_FADE&&(this.opacity=1),this.fadeMode=ln.NONE}_switchReadChannels(){const e=this.fadeMode===ln.CROSS_FADE&&this.fadeFactor===1,i=this.fadeMode===ln.FADE_IN&&this.fadeFactor===0;this.renderingStage===l0.FADING&&(e||i)&&(this.readChannels=1-this.readChannels,this.renderingStage=l0.FINISHED)}_calculateDistanceToAnchorPoint(e){return We(this.pointOnGround,e.eye),Pe(this.pointOnGround,this.pointOnGround,ur.radius),Qe(Be(EJe,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===ln.CROSS_FADE&&(this.fadeFactor===0&&Ie(this.parallaxNew.anchorPointClouds,this.pointOnGround),this.fadeFactor===1&&Ie(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===ln.FADE_IN&&this.fadeFactor===0&&Ie(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,i){switch(e){case ln.HIDE:this.opacity=0;break;case ln.FADE_OUT:this.opacity=1;break;case ln.FADE_IN:this.opacity=0;break;case ln.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=i}get isFading(){return this.fadeMode===ln.FADE_OUT||this.fadeMode===ln.FADE_IN||this.fadeMode===ln.CROSS_FADE}};var ln;(function(t){t[t.NONE=0]="NONE",t[t.HIDE=1]="HIDE",t[t.FADE_OUT=2]="FADE_OUT",t[t.FADE_IN=3]="FADE_IN",t[t.CROSS_FADE=4]="CROSS_FADE"})(ln||(ln={}));let Pse=class{constructor(){this.anchorPointClouds=H(),this.radiusCurvatureCorrectionFactor=0,this.transform=Ze()}};const Ise=st(0,0,1),a3=Bg(),EJe=H(),CJe=1.25,AJe=34e3,OJe=64e3,RJe=2e5;let y0=class extends zn{constructor(e,i){super(e,"bool",hr.Pass,(r,n,s)=>r.setUniform1b(e,i(n,s)))}},MJe=class extends zn{constructor(e,i){super(e,"samplerCube",hr.Pass,(r,n,s)=>r.bindTexture(e,i(n,s)))}};function qwe(t){const e=t.fragment;e.uniforms.add(new On("rotationMatrixClouds",(i,r)=>r.cloudsFade.parallax.transform),new On("rotationMatrixCloudsCrossFade",(i,r)=>r.cloudsFade.parallaxNew.transform),new _i("anchorPosition",(i,r)=>r.cloudsFade.parallax.anchorPointClouds),new _i("anchorPositionCrossFade",(i,r)=>r.cloudsFade.parallaxNew.anchorPointClouds),new lt("cloudsHeight",()=>MNe),new lt("radiusCurvatureCorrectionFactor",(i,r)=>r.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new lt("totalFadeInOut",(i,r)=>1-r.cloudsFade.opacity),new lt("crossFadeAnchorFactor",(i,r)=>Je(r.cloudsFade.fadeFactor,0,1)),new MJe("cubeMap",(i,r)=>r.cloudsFade.data?.cubeMap?.colorTexture??null),new y0("crossFade",(i,r)=>r.cloudsFade.fadeMode===ln.CROSS_FADE),new y0("readChannelsRG",(i,r)=>r.cloudsFade.readChannels===Q2.RG),new y0("fadeTextureChannels",(i,r)=>r.cloudsFade.renderingStage===l0.FADING)),e.constants.add("planetRadius","float",ur.radius),e.code.add(F`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(F`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(F`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),jg(e),U0(e),e.code.add(F`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(F`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(F`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(F`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(F`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function G0(t){t.code.add(F`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function PJe(){const t=new lr,{attributes:e,varyings:i,vertex:r,fragment:n}=t;return e.add(X.POSITION,"vec2"),i.add("worldRay","vec3"),r.uniforms.add(new On("inverseProjectionMatrix",(s,a)=>a.camera.inverseProjectionMatrix),new On("inverseViewMatrix",(s,a)=>cE(IJe,a.camera.viewMatrix))),r.code.add(F`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),n.include(G0),n.include(fd),t.include(sK,{pbrMode:Gt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(dR),t.include(M7),t.include(zL),t.include(qwe),n.uniforms.add(new _i("cameraPosition",(s,a)=>a.camera.eye)),n.code.add(F`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const IJe=Ze(),$Je=Object.freeze(Object.defineProperty({__proto__:null,build:PJe},Symbol.toStringTag,{value:"Module"}));let Wwe=class Xwe extends wr{constructor(e){super(e,new rc,()=>this.destroy())}initializeProgram(e){return new fr(e.rctx,Xwe.shader.get().build(),ar)}initializePipeline(){return mi({blending:Zo(et.ONE,et.ZERO,et.SRC_ALPHA,et.ONE),depthTest:{func:Tr.LEQUAL},colorWrite:Oi})}};Wwe.shader=new pr($Je,()=>ke(()=>import("./CloudsComposition.glsl-5700515e.js"),[],import.meta.url));let ob=class extends Ke{constructor(e){super(e),this._technique=new Wwe(e),this._vao=V0(e.rctx)}destroy(){this._technique=Gi(this._technique),this._vao=jt(this._vao)}render(e){if(!this._technique.compiled)return void this.requestRender();const i=e.bindParameters.cloudsFade;if(this._vao==null||i.data==null)return;const r=e.rctx.bindTechnique(this._technique,LJe,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Hi.TRIANGLE_STRIP,0,4)}};_([T({constructOnly:!0})],ob.prototype,"rctx",void 0),_([T({constructOnly:!0})],ob.prototype,"viewingMode",void 0),_([T({constructOnly:!0})],ob.prototype,"planetRadius",void 0),_([T({constructOnly:!0})],ob.prototype,"requestRender",void 0),ob=_([Z("esri.views.3d.environment.CloudsComposition")],ob);const LJe=new Vr;function ts(){return new Float32Array(3)}function XG(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function kr(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function DJe(t,e){return new Float32Array(t,e,3)}function oK(){return ts()}function Jwe(){return kr(1,1,1)}function Ywe(){return kr(1,0,0)}function Zwe(){return kr(0,1,0)}function Kwe(){return kr(0,0,1)}const NJe=oK(),FJe=Jwe(),kJe=Ywe(),zJe=Zwe(),UJe=Kwe();Object.freeze(Object.defineProperty({__proto__:null,ONES:FJe,UNIT_X:kJe,UNIT_Y:zJe,UNIT_Z:UJe,ZEROS:NJe,clone:XG,create:ts,createView:DJe,fromValues:kr,ones:Jwe,unitX:Ywe,unitY:Zwe,unitZ:Kwe,zeros:oK},Symbol.toStringTag,{value:"Module"}));var Yl;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(Yl||(Yl={}));let y$=class extends rc{constructor(){super(...arguments),this.steps=Yl.SIXTEEN,this.writeTextureChannels=Q2.RG}};_([ce({count:Yl.COUNT})],y$.prototype,"steps",void 0),_([ce({constValue:Me("esri-mobile")?1024:2048})],y$.prototype,"cubeMapSize",void 0),_([ce()],y$.prototype,"writeTextureChannels",void 0);let k5=class{constructor(e,i,r,n,s,a,u,p,y=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=n,this.detailSize=s,this.smoothness=a,this.cloudHeight=u,this.raymarchingSteps=p,this.median=y}};const $se=new k5([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Yl.SIXTEEN),Aa={sunny:$se,cloudy:new k5([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Yl.TWOHUNDRED,.6),rainy:new k5([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Yl.TWOHUNDRED,.4),snowy:new k5([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Yl.HUNDRED,.65),foggy:new k5([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Yl.SIXTEEN),default:$se},Ph=Me("esri-mobile")?64:128,jJe=Ph/128,ep=Math.ceil(Math.sqrt(Ph)),Ky=(Ph+2)*ep,BJe=1e5,QF=128,VJe=Ky/1560;let rO=class extends zn{constructor(e,i){super(e,"mat3",hr.Draw,(r,n,s)=>r.setUniformMatrix3fv(e,i(n,s)))}},Qwe=class extends Vr{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=Aa.default.raymarchingSteps,this.weatherTile=Ct()}},e3e=class extends Vr{constructor(){super(...arguments),this.viewMatrix=Pn()}};function GJe(t){const e=new lr;e.include(Ga,!1);const i=e.fragment;return i.uniforms.add(new lt("cloudRadius",r=>r.cloudRadius),new lt("power",r=>si(35,120,r.absorption)),new lt("sigmaE",r=>1+r.absorption),new lt("density",r=>si(0,.3,r.density)),new lt("cloudSize",r=>si(0,.02,Math.max(.01,1-r.cloudSize))),new lt("detailSize",r=>si(0,.2,Math.max(.01,1-r.detailSize))),new lt("smoothness",r=>si(0,.5,1-r.smoothness)),new lt("cloudHeight",r=>si(0,1500,r.cloudHeight)),new lt("coverage",r=>r.coverage),new rO("view",r=>r.viewMatrix),new kt("cloudShapeTexture",r=>r.noiseTexture!=null?r.noiseTexture.textureAtlas:null),new Lr("cloudVariables",r=>Yi(HJe,r.coverage,r.absorption))),i.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),i.code.add(F`
    const int STEPS = ${t.steps===Yl.SIXTEEN?F`16`:t.steps===Yl.HUNDRED?F`100`:F`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(F`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${F.float(Ky)};
      const float dataWidth = ${F.float(Ky)};
      const float tileRows = ${F.float(ep)};
      const vec3 atlasDimensions = vec3(${F.float(Ph)}, ${F.float(Ph)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${F.float(jJe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${F.float(VJe)} * p) / ${F.float(Ky)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),i.code.add(F`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(F`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),i.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),i.code.add(F`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(F`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.code.add(F`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const HJe=Ct(),qJe=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:e3e,CloudsPassParameters:Qwe,build:GJe},Symbol.toStringTag,{value:"Module"}));let t3e=class i3e extends wr{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new fr(e.rctx,i3e.shader.get().build(this.configuration),ar)}initializePipeline(){return mi({blending:Xc(et.CONSTANT_COLOR,et.ONE_MINUS_CONSTANT_COLOR,R0.ADD,this.configuration.writeTextureChannels===Q2.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Tr.LEQUAL},colorWrite:Oi})}};t3e.shader=new pr(qJe,()=>ke(()=>import("./Clouds.glsl-2dcc809b.js"),[],import.meta.url));var $u;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})($u||($u={}));let JG=class extends rc{constructor(){super(...arguments),this.mode=$u.Full}};_([ce({count:$u.COUNT})],JG.prototype,"mode",void 0);let r3e=class extends Vr{constructor(){super(...arguments),this.weatherTile=Xi(0,0)}};function WJe(t){const e=new lr;return e.include(Ga,!1),e.fragment.code.add(F`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===$u.Full&&e.fragment.code.add(F`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${F.float(ep)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${F.float(8)});

      float worley0 = worley(p, ${F.float(2)} * 2.0);
      float worley1 = worley(p, ${F.float(2)} * 8.0);
      float worley2 = worley(p, ${F.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${F.float(2)});
      float worley1 = worley(p, ${F.float(2)} * 2.0);
      float worley2 = worley(p, ${F.float(2)} * 4.0);
      float worley3 = worley(p, ${F.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Lr("weatherTile",i=>i.weatherTile)),e.fragment.code.add(F`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${F.float(QF)});

      // Get global coordinates of p
      p += weatherTile * ${F.float(QF)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${F.float(BJe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(F`void main() {`),t.mode===$u.Full&&e.fragment.code.add(F`
        float padWidth = 1.0;
        float paddedSize = ${F.float(Ph)} + 2.0 * padWidth;
        float tileCount = ${F.float(ep)} * ${F.float(ep)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${F.float(Ph)};
          }

          if (startPadY) {
            pixel.y += ${F.float(Ph)};
          }

          if (endPadX) {
            pixel.x -= ${F.float(Ph)};
          }

          if (endPadY) {
            pixel.y -= ${F.float(Ph)};
          }

          uv = vec2(pixel.xy / ${F.float(Ph)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${F.float(Ph)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${F.float(ep)} * ${F.float(ep)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${F.float(ep)} * ${F.float(ep)});
        p = p_;
        p.z /= (${F.float(ep)} * ${F.float(ep)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(F`
      vec2 mapUV = ${F.float(QF)} * (gl_FragCoord.xy / ${F.float(Ky)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===$u.Full?F`fragColor.ba = vec2(0.0, map);`:F`fragColor = vec4(map);`};
    }
  `),e}const XJe=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:r3e,build:WJe},Symbol.toStringTag,{value:"Module"}));let YG=class n3e extends wr{initializeProgram(e){return new fr(e.rctx,n3e.shader.get().build(this.configuration),ar)}initializePipeline(){return mi({blending:this.configuration.mode===$u.Full?Xc(et.ONE,et.ZERO):Zo(et.ZERO,et.ONE,et.ONE,et.ZERO),depthTest:{func:Tr.ALWAYS},colorWrite:Oi})}};YG.shader=new pr(XJe,()=>ke(()=>import("./NoiseTextureAtlas.glsl-5e5afe0b.js"),[],import.meta.url));let z5=class extends Ke{constructor(e){super(e),this._needsRender=!0,this._passParameters=new r3e,this._frameBuffer=new qp(e.context.renderContext.rctx,new Ar(Ky)),this._vao=V0(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render($u.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render($u.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||($s(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=Gi(this._fullTechniqueCached),this._weatherMapTechniqueCached=Gi(this._weatherMapTechniqueCached),this._frameBuffer=jt(this._frameBuffer),this._vao=jt(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new JG;e.mode=$u.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(YG,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new JG;e.mode=$u.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(YG,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._frameBuffer==null)return null;const i=e===$u.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,n=r.getViewport();r.setViewport(0,0,Ky,Ky),r.bindFramebuffer(this._frameBuffer);const s=r.bindTechnique(i,this._passParameters,null);return r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(n.x,n.y,n.width,n.height),this._needsRender=!1,this._frameBuffer.colorTexture}};_([T({constructOnly:!0})],z5.prototype,"context",void 0),_([T({readOnly:!0})],z5.prototype,"_techniqueRepository",null),z5=_([Z("esri.views.3d.environment.NoiseTextureAtlas")],z5);var xc;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(xc||(xc={}));function s3e(t){t.include(ld),t.uniforms.add(new kt("geometryDepthTexture",(e,i)=>i.multipassGeometry.linearDepth?.colorTexture),new Lr("nearFar",(e,i)=>i.camera.nearFar)),t.code.add(F`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let JJe=class{};function Jc(t,e){if(!e.multipassEnabled)return;t.fragment.include(ld),t.fragment.uniforms.add(new kt("terrainDepthTexture",(r,n)=>n.multipassTerrain.linearDepth?.colorTexture)),t.fragment.uniforms.add(new Lr("nearFar",(r,n)=>n.camera.nearFar));const i=e.occlusionPass;t.fragment.code.add(F`
   ${i?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      vec4 data = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);
      float linearDepth = linearDepthFromRGBA(data, nearFar);
      ${i?F`return fragmentDepth < linearDepth && data != vec4(0.0, 0.0, 0.0, 1.0);`:F`
          if(fragmentDepth ${e.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}let YJe=class{constructor(){this.cullAboveGround=!1}};function I7(t){return t?{ray:oo(t.ray),c0:t.c0,c1:t.c1}:{ray:oo(),c0:0,c1:Number.MAX_VALUE}}function ZJe(t,e=I7()){return AL(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function KJe(t,e,i=I7()){const r=Qe(t.vector);return Z_e(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function N$t(t,e){return o3e(t,t.c0,e)}function F$t(t,e){return o3e(t,t.c1,e)}function o3e(t,e,i){return Ue(i,t.ray.origin,Pe(i,t.ray.direction,e))}new kg(()=>I7());function nO(t){return t?[gr(t[0]),gr(t[1]),gr(t[2]),gr(t[3]),gr(t[4]),gr(t[5])]:[gr(),gr(),gr(),gr(),gr(),gr()]}function a3e(){return[H(),H(),H(),H(),H(),H(),H(),H()]}function BL(t,e){for(let i=0;i<TE;i++)m7(t[i],e[i]);return t}function l3e(t,e,i,r=nYe){const n=Rr(uZ.get(),e,t);Ps(n,n);for(let s=0;s<iYe;++s){const a=Nu(cZ.get(),rYe[s],n);$e(r[s],a[0]/a[3],a[1]/a[3],a[2]/a[3])}c3e(i,r)}function c3e(t,e){La(e[Lt.FAR_BOTTOM_LEFT],e[Lt.NEAR_BOTTOM_LEFT],e[Lt.NEAR_TOP_LEFT],t[en.LEFT]),La(e[Lt.NEAR_BOTTOM_RIGHT],e[Lt.FAR_BOTTOM_RIGHT],e[Lt.FAR_TOP_RIGHT],t[en.RIGHT]),La(e[Lt.FAR_BOTTOM_LEFT],e[Lt.FAR_BOTTOM_RIGHT],e[Lt.NEAR_BOTTOM_RIGHT],t[en.BOTTOM]),La(e[Lt.NEAR_TOP_LEFT],e[Lt.NEAR_TOP_RIGHT],e[Lt.FAR_TOP_RIGHT],t[en.TOP]),La(e[Lt.NEAR_BOTTOM_LEFT],e[Lt.NEAR_BOTTOM_RIGHT],e[Lt.NEAR_TOP_RIGHT],t[en.NEAR]),La(e[Lt.FAR_BOTTOM_RIGHT],e[Lt.FAR_BOTTOM_LEFT],e[Lt.FAR_TOP_LEFT],t[en.FAR])}function By(t,e){for(let i=0;i<TE;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function QJe(t,e){return h3e(t,ZJe(e,d3e.get()))}function k$t(t,e){for(let i=0;i<TE;i++){const r=t[i];if(!PBe(r,e))return!1}return!0}function eYe(t,e,i){return h3e(t,KJe(e,i,d3e.get()))}function u3e(t,e){for(let i=0;i<TE;i++)if(qr(t[i],e)>0)return!1;return!0}function h3e(t,e){for(let i=0;i<TE;i++)if(!MBe(t[i],e))return!1;return!0}var en,Lt;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(en||(en={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(Lt||(Lt={}));const tYe={bottom:[Lt.FAR_BOTTOM_RIGHT,Lt.NEAR_BOTTOM_RIGHT,Lt.NEAR_BOTTOM_LEFT,Lt.FAR_BOTTOM_LEFT],near:[Lt.NEAR_BOTTOM_LEFT,Lt.NEAR_BOTTOM_RIGHT,Lt.NEAR_TOP_RIGHT,Lt.NEAR_TOP_LEFT],far:[Lt.FAR_BOTTOM_RIGHT,Lt.FAR_BOTTOM_LEFT,Lt.FAR_TOP_LEFT,Lt.FAR_TOP_RIGHT],right:[Lt.NEAR_BOTTOM_RIGHT,Lt.FAR_BOTTOM_RIGHT,Lt.FAR_TOP_RIGHT,Lt.NEAR_TOP_RIGHT],left:[Lt.FAR_BOTTOM_LEFT,Lt.NEAR_BOTTOM_LEFT,Lt.NEAR_TOP_LEFT,Lt.FAR_TOP_LEFT],top:[Lt.FAR_TOP_LEFT,Lt.NEAR_TOP_LEFT,Lt.NEAR_TOP_RIGHT,Lt.FAR_TOP_RIGHT]},TE=6,iYe=8,rYe=[vi(-1,-1,-1,1),vi(1,-1,-1,1),vi(1,1,-1,1),vi(-1,1,-1,1),vi(-1,-1,1,1),vi(1,-1,1,1),vi(1,1,1,1),vi(-1,1,1,1)],d3e=new kg(I7),nYe=a3e();function sYe(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function oYe(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function aYe(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function lYe(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}var ZG;let Kt=ZG=class extends Ke{constructor(t={}){super(t),this._center=H(),this._up=H(),this._viewUp=H(),this._viewForward=H(),this._viewRight=H(),this._ray=oo(),this._viewport=vi(0,0,1,1),this._padding=vi(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Xi(1,1e3),this._viewDirty=!0,this._viewMatrix=Ze(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Ze(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Ze(),this._frustumDirty=!0,this._frustum=nO(),this._fullViewport=ji(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return Be(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){bs(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=B2(ji(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&V2(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=B2(ji(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&V2(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[zi.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[zi.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[zi.RIGHT]+this._padding[zi.LEFT]}set fullWidth(t){this.width=t-(this._padding[zi.RIGHT]+this._padding[zi.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[zi.TOP]+this._padding[zi.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[zi.TOP]+this._padding[zi.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[zi.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[zi.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){IT(this._padding,t)||(this._viewport[0]+=t[zi.LEFT]-this._padding[zi.LEFT],this._viewport[1]+=t[zi.BOTTOM]-this._padding[zi.BOTTOM],this._viewport[2]-=t[zi.RIGHT]+t[zi.LEFT]-(this._padding[zi.RIGHT]+this._padding[zi.LEFT]),this._viewport[3]-=t[zi.TOP]+t[zi.BOTTOM]-(this._padding[zi.TOP]+this._padding[zi.BOTTOM]),mp(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Rr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this._aspect,n=Lge(Ze(),-r*(1+2*this._padding[zi.LEFT]/t),r*(1+2*this._padding[zi.RIGHT]/t),-i*(1+2*this._padding[zi.BOTTOM]/e),i*(1+2*this._padding[zi.TOP]/e),this.near,this.far),s=this._get("projectionMatrix");return s&&zD(s,n)?s:n}get inverseProjectionMatrix(){return Ps(Ze(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||Ze()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return aYe(this._fov,this.width,this.height)}set fovX(t){this._fov=sYe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return lYe(this._fov,this.width,this.height)}set fovY(t){this._fov=oYe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return un(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Ps(this._viewInverseTransposeMatrix,this.viewMatrix),Hc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){Ie(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,mp(this._viewport,t.viewport),this.notifyChange("_viewport"),mp(this._padding,t.padding),this.notifyChange("_padding"),$s(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(bs(this._viewMatrix,t.viewMatrix),Ie(this._viewRight,t.viewRight),Ie(this._viewUp,t.viewUp),Ie(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(BL(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(bs(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),mp(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new ZG().copyFrom(this)}equals(t){return pa(this.eye,t.eye)&&pa(this.center,t.center)&&pa(this.up,t.up)&&IT(this._viewport,t.viewport)&&IT(this._padding,t.padding)&&pwe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||iL(t.screenPadding,this.screenPadding)>=e||iL(this.screenViewport,t.screenViewport)>=e)return!1;Ao(ba,t.eye,t.center),Ao(ek,this.eye,this.center);const i=He(ba,ek),r=eB(ba),n=eB(ek),s=5e-4;return i*i>=(1-1e-10)*r*n&&LD(t.eye,this.eye)<Math.max(r,n)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(VA(this.viewForward,Be(ba,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Dn()){return t[0]=(this.padding[zi.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[zi.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[zi.LEFT]+this.width*e,t[1]=this.padding[zi.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==ki&&Ie(ki,t),ki[3]=1,Nu(ki,ki,this.projectionMatrix);const i=Math.abs(ki[3]);Pe(ki,ki,1/i);const r=this.fullViewport;e[0]=si(0,r[0]+r[2],.5+.5*ki[0]),e[1]=si(0,r[1]+r[3],.5+.5*ki[1]),e[2]=.5*(ki[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;ki[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],ki[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],ki[2]=(2*t[2]-1)*t[3],ki[3]=t[3],this.inverseProjectionMatrix!=null&&(Nu(ki,ki,this.inverseProjectionMatrix),e[0]=ki[0],e[1]=ki[1],e[2]=ki[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,tk),this.renderToScreen(tk,e),e}projectToRenderScreen(t,e){if(ki[0]=t[0],ki[1]=t[1],ki[2]=t[2],ki[3]=1,Nu(ki,ki,this.viewProjectionMatrix),ki[3]===0)return null;Pe(ki,ki,1/Math.abs(ki[3]));const i=this.fullViewport;return"x"in e?(e.x=si(0,i[0]+i[2],.5+.5*ki[0]),e.y=si(0,i[1]+i[3],.5+.5*ki[1])):(e[0]=si(0,i[0]+i[2],.5+.5*ki[0]),e[1]=si(0,i[1]+i[3],.5+.5*ki[1]),e.length>2&&(e[2]=.5*(ki[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,tk),e)}unprojectFromRenderScreen(t,e){if(Rr(YM,this.projectionMatrix,this.viewMatrix),!Ps(YM,YM))return null;const i=this.fullViewport;return ki[0]=2*(t[0]-i[0])/i[2]-1,ki[1]=2*(t[1]-i[1])/i[3]-1,ki[2]=2*t[2]-1,ki[3]=1,Nu(ki,ki,YM),ki[3]===0?null:(e[0]=ki[0]/ki[3],e[1]=ki[1]/ki[3],e[2]=ki[2]/ki[3],e)}constrainWindowSize(t,e,i,r){const n=t*this.pixelRatio,s=e*this.pixelRatio,a=Math.max(n-i/2,0),u=Math.max(this.fullHeight-s-r/2,0),p=-Math.min(n-i/2,0),y=-Math.min(this.fullHeight-s-r/2,0),b=i-p- -Math.min(this.fullWidth-n-i/2,0),S=r-y- -Math.min(s-r/2,0);return[Math.round(a),Math.round(u),Math.round(b),Math.round(S)]}computeUp(t){t===ht.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){Be(ba,this.center,this.eye);const t=Qe(this.center);t<1?($e(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(He(ba,this.center))>.9999*Qe(ba)*t||(qt(this._up,ba,this.center),qt(this._up,this._up,ba),We(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){Ng(ba,this.eye,this.center),Math.abs(ba[2])<=.9999&&(Pe(ba,ba,ba[2]),$e(this._up,-ba[0],-ba[1],1-ba[2]),We(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?pa(t,e)||(Ie(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):Ee.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(l3e(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(kD(this._viewMatrix,this.eye,this.center,this.up),$e(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),$e(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),$e(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};_([T()],Kt.prototype,"_center",void 0),_([T()],Kt.prototype,"_up",void 0),_([T()],Kt.prototype,"_viewport",void 0),_([T()],Kt.prototype,"_padding",void 0),_([T()],Kt.prototype,"_fov",void 0),_([T()],Kt.prototype,"_nearFar",void 0),_([T()],Kt.prototype,"_pixelRatio",void 0),_([T()],Kt.prototype,"pixelRatio",null),_([T()],Kt.prototype,"eye",null),_([T()],Kt.prototype,"center",null),_([T()],Kt.prototype,"up",null),_([T({readOnly:!0})],Kt.prototype,"nearFar",null),_([T()],Kt.prototype,"near",null),_([T()],Kt.prototype,"far",null),_([T()],Kt.prototype,"viewport",null),_([T({readOnly:!0})],Kt.prototype,"screenViewport",null),_([T({readOnly:!0})],Kt.prototype,"screenPadding",null),_([T()],Kt.prototype,"x",null),_([T()],Kt.prototype,"y",null),_([T()],Kt.prototype,"width",null),_([T()],Kt.prototype,"height",null),_([T()],Kt.prototype,"fullWidth",null),_([T()],Kt.prototype,"fullHeight",null),_([T({readOnly:!0})],Kt.prototype,"_aspect",null),_([T()],Kt.prototype,"padding",null),_([T({readOnly:!0})],Kt.prototype,"projectionMatrix",null),_([T({readOnly:!0})],Kt.prototype,"inverseProjectionMatrix",null),_([T()],Kt.prototype,"fov",null),_([T()],Kt.prototype,"fovX",null),_([T()],Kt.prototype,"fovY",null),Kt=ZG=_([Z("esri.views.3d.webgl-engine.lib.Camera")],Kt);const ki=ji(),YM=Ze(),ba=H(),ek=H(),tk=fa();var zi;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(zi||(zi={}));var De;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.ANTIALIASING=10]="ANTIALIASING",t[t.COMPOSITE=11]="COMPOSITE",t[t.BLIT=12]="BLIT",t[t.SSAO=13]="SSAO",t[t.HIGHLIGHT=14]="HIGHLIGHT",t[t.SHADOW_HIGHLIGHT=15]="SHADOW_HIGHLIGHT",t[t.ENVIRONMENT_OPAQUE=16]="ENVIRONMENT_OPAQUE",t[t.ENVIRONMENT_TRANSPARENT=17]="ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=18]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=19]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=20]="HUD_MATERIAL",t[t.LABEL_MATERIAL=21]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=22]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=23]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=24]="DRAPED_MATERIAL",t[t.DRAPED_WATER=25]="DRAPED_WATER",t[t.VOXEL=26]="VOXEL",t[t.MAX_SLOTS=27]="MAX_SLOTS"})(De||(De={}));var Ut;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(Ut||(Ut={}));let aK=class{constructor(e=H()){this.intensity=e}},p3e=class{constructor(e=H(),i=st(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},VL=class{constructor(e=H(),i=st(.57735,.57735,.57735),r=!0,n=1,s=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=n,this.environmentStrength=s}},f3e=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function cYe(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function ik(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function kT(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function m3e(t){return(t+1)*(t+1)}function uYe(t){return Je(Math.floor(Math.sqrt(t)-1),0,2)}function g3e(t,e,i){const r=t[0],n=t[1],s=t[2],a=i||[];return a.length=m3e(e),e>=0&&(a[0]=.28209479177),e>=1&&(a[1]=.4886025119*r,a[2]=.4886025119*s,a[3]=.4886025119*n),e>=2&&(a[4]=1.09254843059*r*n,a[5]=1.09254843059*n*s,a[6]=.31539156525*(3*s*s-1),a[7]=1.09254843059*r*s,a[8]=.54627421529*(r*r-n*n)),a}function hYe(t,e){const i=m3e(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let n=0;n<i;n++)r.r[n]=r.g[n]=r.b[n]=0;return r}function dYe(t,e){const i=uYe(e.r.length);for(const r of t)ka(KG,r.direction),g3e(KG,i,Qm),cYe(Qm,v$),ik(Qm,r.intensity[0],l3),kT(e.r,l3),ik(Qm,r.intensity[1],l3),kT(e.g,l3),ik(Qm,r.intensity[2],l3),kT(e.b,l3);return e}function pYe(t,e){g3e(KG,0,Qm);for(const i of t)e.r[0]+=Qm[0]*v$[0]*i.intensity[0]*4*Math.PI,e.g[0]+=Qm[0]*v$[0]*i.intensity[1]*4*Math.PI,e.b[0]+=Qm[0]*v$[0]*i.intensity[2]*4*Math.PI;return e}function fYe(t,e,i,r){hYe(e,r),$e(i.intensity,0,0,0);let n=!1;const s=mYe,a=gYe,u=yYe;s.length=0,a.length=0,u.length=0;for(const p of t)p instanceof VL&&!n?(Ie(i.direction,p.direction),Ie(i.intensity,p.intensity),i.specularStrength=p.specularStrength,i.environmentStrength=p.environmentStrength,i.castShadows=p.castShadows,n=!0):p instanceof VL||p instanceof p3e?s.push(p):p instanceof aK?a.push(p):p instanceof f3e&&u.push(p);dYe(s,r),pYe(a,r);for(const p of u)kT(r.r,p.r),kT(r.g,p.g),kT(r.b,p.b)}const mYe=[],gYe=[],yYe=[],Qm=[0],l3=[0],KG=H(),v$=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Lse=class{constructor(){this.color=H(),this.intensity=1}},vYe=class{constructor(){this.direction=H(),this.ambient=new Lse,this.diffuse=new Lse}};const y3e=.4;let rk=class{constructor(){this._shOrder=2,this._legacy=new vYe,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new f3e,this._mainLight=new VL(H(),st(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){fYe(e,this._shOrder,this._mainLight,this._sphericalHarmonics),Ie(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,Pe(this._legacy.diffuse.color,this._mainLight.intensity,i),Ie(ZM,this._legacy.diffuse.color),Pe(ZM,ZM,y3e*this.globalFactor),Ue(this._legacy.ambient.color,this._legacy.ambient.color,ZM)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),Ie(this._mainLight.direction,e.mainLight.direction),Ie(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(Ir(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=si(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=si(e.mainLight.specularStrength,i.mainLight.specularStrength,r),Ie(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=si(e.globalFactor,i.globalFactor,r),this.noonFactor=si(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let n=0;n<i.sh.r.length;n++)this._sphericalHarmonics.r[n]=si(e.sh.r[n],i.sh.r[n],r),this._sphericalHarmonics.g[n]=si(e.sh.g[n],i.sh.g[n],r),this._sphericalHarmonics.b[n]=si(e.sh.b[n],i.sh.b[n],r);else for(let n=0;n<i.sh.r.length;n++)this._sphericalHarmonics.r[n]=i.sh.r[n],this._sphericalHarmonics.g[n]=i.sh.g[n],this._sphericalHarmonics.b[n]=i.sh.b[n]}};const ZM=H();let $7=class{constructor(e,i){this.shadowMap=e,this.slicePlane=i,this.slot=De.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=Ut.NONE,this.alignPixelEnabled=!1,this.decorations=kc.ON,this.overlayStretch=1,this._camera=new Kt,this._inverseViewport=Ct(),this.oldLighting=new rk,this.newLighting=new rk,this._fadedLighting=new rk,this._lighting=this.newLighting,this.ssr=new _Ye,this.multipassEnabled=!1,this.multipassTerrain=new YJe,this.multipassGeometry=new JJe,this.hudRenderStyle=xc.Occluded,this.cloudsFade=new SJe}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:i,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(i,r,e),this._lighting=this._fadedLighting)}},_Ye=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=Ze()}},Fl=class extends Ke{constructor(e){super(e),this._techniques=new Array,this._techniqueConfiguration=new y$,this._bindParameters=new $7(null,null),this._passParameters=new Qwe,this._drawParameters=new e3e,this._weatherTile=Ct(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=si(Aa.default.coverage[0],Aa.default.coverage[1],.5),this.density=si(Aa.default.density[0],Aa.default.density[1],.5),this.absorption=si(Aa.default.absorption[0],Aa.default.absorption[1],.5),this.cloudSize=si(Aa.default.cloudSize[0],Aa.default.cloudSize[1],.5),this.detailSize=si(Aa.default.detailSize[0],Aa.default.detailSize[1],.5),this.smoothness=si(Aa.default.smoothness[0],Aa.default.smoothness[1],.5),this.cloudHeight=si(Aa.default.cloudHeight[0],Aa.default.cloudHeight[1],.5),this.raymarchingSteps=Aa.default.raymarchingSteps,this._viewMatrix=Ze(),this._dirty=!1,this.running=!1,this._vao=V0(e.context.renderContext.rctx)}_getTechnique(e){const i=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=i===Q2.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=i,this._techniqueConfiguration.steps=e,this._techniques[r]=new t3e({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,i=this.view.camera.position.longitude;if(e==null||i==null)return;Yi(this._weatherTile,(e+90)/180,(i+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let n=0,s=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const a=new Date(this.view.environment.lighting.date);a.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),n=31*a.getUTCMonth()+a.getUTCDate(),s=a.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+n)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+s%100)%(4*this._weatherTileCount),fwe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=Mr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this.addHandles([this.view.resourceController.scheduler.registerTask(Zt.CLOUDS_GENERATOR,this),Fe(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),jr)])}destroy(){this._techniques.forEach(e=>Gi(e)),this._frameBufferCube=jt(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=ct(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Yl.SIXTEEN:return 1;case Yl.HUNDRED:return 4;case Yl.COUNT:case Yl.TWOHUNDRED:return 8}}get usedMemory(){return(this._frameBufferCube?.gpuMemoryUsage??0)+(this._passParameters.noiseTexture?.textureAtlas?.gpuMemoryUsage??0)}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new z5({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const i=new Ar(e);i.target=Vn.TEXTURE_CUBE_MAP,i.wrapMode=Ai.CLAMP_TO_EDGE,this._frameBufferCube=new qp(this.context.renderContext.rctx,i)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=jt(this._frameBufferCube)}applyPreset(e,i){const r=e.median,n=s=>{const a=si(s[0],s[1],r);return i<.5?si(s[0],a,2*i):si(a,s[1],2*(i-.5))};this.coverage=n(e.coverage),this.density=n(e.density),this.absorption=n(e.absorption),this.cloudSize=n(e.cloudSize),this.detailSize=n(e.detailSize),this.smoothness=n(e.smoothness),this.cloudHeight=n(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),$s(this._passParameters.weatherTile,this._weatherTile));const i=this._getTechnique(this._passParameters.raymarchingSteps);if(!i.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===ln.CROSS_FADE||!this._ensureNoiseTexture())return ya.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=l0.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=this.context.renderContext.rctx,n=r.bindTechnique(i,this._passParameters,this._bindParameters);r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao);const s=r.getViewport(),a=i.configuration.cubeMapSize,u=a/this._tilesPerFace,p=this._tileIndex*u;r.setViewport(0,p,a,u);const y=this._ensureFrameBufferCube(a);r.bindFramebuffer(y);const b=bYe[this._faceIndex],S=wYe[this._faceIndex];Nge(this._viewMatrix,xYe,b,S),sd(this._drawParameters.viewMatrix,this._viewMatrix);const C=Vn.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return y.setColorTextureTarget(C),n.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush(),r.setViewport(s.x,s.y,s.width,s.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=l0.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),ya.YIELD}};_([T({constructOnly:!0})],Fl.prototype,"context",void 0),_([T({constructOnly:!0})],Fl.prototype,"view",void 0),_([T({constructOnly:!0})],Fl.prototype,"requestRender",void 0),_([T()],Fl.prototype,"coverage",void 0),_([T()],Fl.prototype,"density",void 0),_([T()],Fl.prototype,"absorption",void 0),_([T()],Fl.prototype,"cloudSize",void 0),_([T()],Fl.prototype,"detailSize",void 0),_([T()],Fl.prototype,"smoothness",void 0),_([T()],Fl.prototype,"cloudHeight",void 0),_([T()],Fl.prototype,"raymarchingSteps",void 0),_([T()],Fl.prototype,"running",void 0),Fl=_([Z("esri.views.3d.environment.CloudsGenerator")],Fl);const bYe=[kr(1,0,0),kr(-1,0,0),kr(0,1,0),kr(0,-1,0),kr(0,0,1)],wYe=[kr(0,1,0),kr(0,1,0),kr(0,0,-1),kr(0,0,1),kr(0,1,0)],xYe=oK();let v3e=class extends Vr{constructor(){super(...arguments),this.fogColor=H(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function TYe(){const t=new lr;t.attributes.add(X.POSITION,"vec2"),t.include(g0,{textureCoordinateType:vs.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:i}=t;return e.uniforms.add(new On("inverseProjectionMatrix",(r,n)=>n.camera.inverseProjectionMatrix),new On("inverseViewMatrix",(r,n)=>cE(SYe,n.camera.viewMatrix))),e.code.add(F`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new lt("atmosphereC",r=>r.atmosphereC),new _i("cameraPosition",(r,n)=>n.camera.eye),new Lr("nearFar",(r,n)=>n.camera.nearFar),new kt("depthTexture",r=>r.depthTexture),new lt("fogStrength",r=>r.fogStrength),new lt("fogAmount",r=>r.fogAmount),new _i("fogColor",r=>r.fogColor)),t.include(M7),i.include(ld),i.code.add(F`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(F`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(F`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const SYe=Ze(),EYe=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:v3e,build:TYe},Symbol.toStringTag,{value:"Module"}));let _3e=class b3e extends wr{constructor(e){super(e,new rc,()=>this.destroy())}initializeProgram(e){return new fr(e.rctx,b3e.shader.get().build(),ar)}initializePipeline(){return mi({blending:Zo(et.SRC_ALPHA,et.ZERO,et.ONE_MINUS_SRC_ALPHA,et.ONE),colorWrite:Oi})}};_3e.shader=new pr(EYe,()=>ke(()=>import("./Fog.glsl-6f3a29af.js"),[],import.meta.url));const CYe=.95,AYe=1;let ab=class extends Ke{constructor(e){super(e),this._passParameters=new v3e;const i=e.context.renderContext.rctx;this._vao=V0(i,hR),this._technique=new _3e(e);const r=Mr(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+by}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,i){if(this._update(e,i),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const n=e.offscreenRenderingHelper;n.renderDepthDetached(()=>{this._passParameters.depthTexture=n.depthTexture;const s=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderFog(s,e)})}_renderFog(e,i){const r=i.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Hi.TRIANGLE_STRIP,0,4)}_update(e,i){const r=e.bindParameters.camera;We(Dse,r.eye);const n=Math.max(0,He(Dse,e.bindParameters.lighting.mainLight.direction)),s=i.color;Pe(Nse,s,.1),Ir(this._passParameters.fogColor,Nse,s,n);const a=Qe(r.eye),u=a*a;this._passParameters.atmosphereC=u-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-D4(CYe*Ym,AYe*Ym,Math.abs(a-this._planetRadius)))*i.amount,this._passParameters.fogStrength=i.strength}static isSupported(e){return e.capabilities.depthTexture}};_([T({constructOnly:!0})],ab.prototype,"context",void 0),_([T({constructOnly:!0})],ab.prototype,"view",void 0),_([T({constructOnly:!0})],ab.prototype,"rctx",void 0),_([T({constructOnly:!0})],ab.prototype,"viewingMode",void 0),ab=_([Z("esri.views.3d.environment.Fog")],ab);let OYe=class{constructor(){this.color=H(),this.strength=0,this.amount=0}};const Dse=H(),Nse=H();var oe;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.CompositeColor=9]="CompositeColor",t[t.COUNT=10]="COUNT"})(oe||(oe={}));function lK({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(F`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(F`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let w3e=class extends zn{constructor(e,i){super(e,"mat4",hr.Draw,(r,n,s)=>r.setUniformMatrix4fv(e,i(n,s)))}};function kp(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Mo):t.uniforms.add(new Wu("cameraPosition",(i,r)=>$e(x3e,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Uc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new On("proj",(r,n)=>n.camera.projectionMatrix),new w3e("view",(r,n)=>ec(Fse,n.camera.viewMatrix,r.origin)),new Wu("localOrigin",r=>r.origin));const i=r=>$e(x3e,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new On("proj",(r,n)=>n.camera.projectionMatrix),new On("view",(r,n)=>ec(Fse,n.camera.viewMatrix,i(n))),new _i("localOrigin",(r,n)=>i(n)))}const Fse=Ze(),x3e=H();function kS(t){t.uniforms.add(new On("viewNormal",(e,i)=>i.camera.viewInverseTransposeMatrix))}function SE(t){t.uniforms.add(new lt("pixelRatio",(e,i)=>i.camera.pixelRatio/i.overlayStretch))}let Xp=class extends zn{constructor(e,i){super(e,"mat3",hr.Pass,(r,n,s)=>r.setUniformMatrix3fv(e,i(n,s)))}};function QG(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function RYe(t,e){const i=t.length;for(let r=0;r<i;++r)yT[0]=t[r],e[r]=yT[0];return e}function MYe(t,e){const i=t.length;for(let r=0;r<i;++r)yT[0]=t[r],yT[1]=t[r]-yT[0],e[r]=yT[1];return e}const yT=new Float32Array(2);let eH=class extends rc{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};_([ce()],eH.prototype,"instancedDoublePrecision",void 0),_([ce()],eH.prototype,"hasModelTransformation",void 0);const kse=Pn();function T3e(t,e){const i=e.hasModelTransformation,r=e.instancedDoublePrecision;i&&(t.vertex.uniforms.add(new On("model",s=>s.modelTransformation??Cn)),t.vertex.uniforms.add(new Xp("normalLocalOriginFromModel",s=>(Rg(kse,s.modelTransformation??Cn),kse)))),e.instanced&&r&&(t.attributes.add(X.INSTANCEMODELORIGINHI,"vec3"),t.attributes.add(X.INSTANCEMODELORIGINLO,"vec3"),t.attributes.add(X.INSTANCEMODEL,"mat3"),t.attributes.add(X.INSTANCEMODELNORMAL,"mat3"));const n=t.vertex;r&&(n.include(lK,e),n.uniforms.add(new Wu("viewOriginHi",(s,a)=>RYe($e(KM,a.camera.viewInverseTransposeMatrix[3],a.camera.viewInverseTransposeMatrix[7],a.camera.viewInverseTransposeMatrix[11]),KM)),new Wu("viewOriginLo",(s,a)=>MYe($e(KM,a.camera.viewInverseTransposeMatrix[3],a.camera.viewInverseTransposeMatrix[7],a.camera.viewInverseTransposeMatrix[11]),KM)))),n.code.add(F`
    vec3 getVertexInLocalOriginSpace() {
      return ${i?r?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":r?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${r?F`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),n.code.add(F`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${i?r?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":r?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),e.output===oe.Normal&&(kS(n),n.code.add(F`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${i?r?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":r?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),e.hasVertexTangents&&n.code.add(F`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${i?r?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":r?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const KM=H();let _l=class extends eH{};_([ce({constValue:!0})],_l.prototype,"hasSliceHighlight",void 0),_([ce({constValue:!1})],_l.prototype,"hasSliceInVertexProgram",void 0),_([ce({constValue:hr.Pass})],_l.prototype,"pbrTextureBindType",void 0);var M0;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(M0||(M0={}));let cK=class extends _l{constructor(){super(...arguments),this.geometry=M0.Cone}};_([ce({count:M0.COUNT})],cK.prototype,"geometry",void 0);function pR(t){t.attributes.add(X.POSITION,"vec3"),t.vertex.code.add(F`vec3 positionModel() { return position; }`)}function zT(t,e){t.include(pR);const i=t.vertex;i.include(lK,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),i.uniforms.add(new _i("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new _i("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Xp("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new On("transformProjFromView",r=>r.transformProjFromView),new rO("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Wu("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Wu("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)),i.code.add(F`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(F`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?F`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:F`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new _i("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(F`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(F`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let S3e=class extends Vr{constructor(){super(...arguments),this.transformWorldFromViewTH=H(),this.transformWorldFromViewTL=H(),this.transformViewFromCameraRelativeRS=Pn(),this.transformProjFromView=Ze()}},E3e=class extends Vr{constructor(){super(...arguments),this.transformWorldFromModelRS=Pn(),this.transformWorldFromModelTH=H(),this.transformWorldFromModelTL=H()}};function _v(t){t.varyings.add("linearDepth","float")}function ew(t){t.vertex.uniforms.add(new Lr("nearFar",(e,i)=>i.camera.nearFar))}function L7(t){t.vertex.code.add(F`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function EE(t,e){const{vertex:i}=t;switch(e.output){case oe.Color:if(e.receiveShadows)return _v(t),void i.code.add(F`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case oe.Depth:case oe.Shadow:case oe.ShadowHighlight:case oe.ShadowExcludeHighlight:return t.include(zT,e),_v(t),ew(t),L7(t),void i.code.add(F`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(F`void forwardLinearDepth() {}`)}function Zl(t){L7(t),t.vertex.code.add(F`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(F`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let uK=class extends Vr{constructor(){super(...arguments),this.texV=Ct(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new C3e}},C3e=class{constructor(){this.center=H(),this.v1=H(),this.v2=H()}};function PYe(t){const e=new lr,{vertex:i,fragment:r}=e;if(jg(i),t.geometry===M0.Underground)e.attributes.add(X.POSITION,"vec2"),e.varyings.add("color","vec4"),i.uniforms.add(new _i("cameraPosition",(n,s)=>s.camera.eye),new lt("undergroundFadeAlpha",n=>n.undergroundFadeAlpha)),i.code.add(F`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(F`void main() {
fragColor = color;
}`);else{e.include(Zl,t),e.attributes.add(X.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const n=t.geometry===M0.Cylinder;i.uniforms.add(new On("proj",(u,p)=>p.camera.projectionMatrix),new On("view",(u,p)=>p.camera.viewMatrix)),n||(e.varyings.add("innerFactor","float"),i.uniforms.add(new _i("silCircleCenter",u=>u.silhouette.center)),i.uniforms.add(new _i("silCircleV1",u=>u.silhouette.v1)),i.uniforms.add(new _i("silCircleV2",u=>u.silhouette.v2)),i.uniforms.add(new Lr("texV",u=>u.texV)),i.uniforms.add(new lt("innerScale",u=>u.innerScale)));const s=6.2831853,a=1/128;i.code.add(F`
		void main(void) {
      ${n?F`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:F`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${F.float(s*a)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${F.float(a)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new kt("tex",u=>u.texture)),n||r.uniforms.add(new lt("altitudeFade",u=>u.altitudeFade)),r.code.add(F`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${n?F`fragColor = atmosphereColor;`:F`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const IYe=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:C3e,SimpleAtmospherePassParameters:uK,build:PYe},Symbol.toStringTag,{value:"Module"}));let GL=class A3e extends wr{initializeProgram(e){return new fr(e.rctx,A3e.shader.get().build(this.configuration),ar)}initializePipeline(){return this.configuration.geometry===M0.Cylinder?mi({blending:Zo(et.SRC_ALPHA,et.ONE,et.ONE_MINUS_SRC_ALPHA,et.ONE_MINUS_SRC_ALPHA),culling:YZ,depthTest:{func:Tr.LEQUAL},colorWrite:Oi}):mi({blending:Zo(et.SRC_ALPHA,et.ONE,et.ONE_MINUS_SRC_ALPHA,et.ONE_MINUS_SRC_ALPHA),depthTest:{func:Tr.LEQUAL},colorWrite:Oi})}};GL.shader=new pr(IYe,()=>ke(()=>import("./SimpleAtmosphere.glsl-bc050c07.js"),[],import.meta.url));const $Ye=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Kc(t,e=0){const i=t.stride;return Array.from(t.fields.keys()).map(r=>{const n=t.fields.get(r),s=n.constructor.ElementCount,a=LYe(n.constructor.ElementType),u=n.offset,p=!(!n.optional||!n.optional.glNormalized);return new Yo(r,s,a,u,i,p,e)})}function LYe(t){const e=DYe[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const DYe={u8:Ft.UNSIGNED_BYTE,u16:Ft.UNSIGNED_SHORT,u32:Ft.UNSIGNED_INT,i8:Ft.BYTE,i16:Ft.SHORT,i32:Ft.INT,f32:Ft.FLOAT};let hK=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=9;const a=this.TypedArrayConstructor;n===void 0&&(n=9*a.BYTES_PER_ELEMENT);const u=i.byteLength===0?0:r;this.typedBuffer=s==null?new a(i,u):new a(i,u,(s-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<9;n++)i[n]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<9;n++)this.typedBuffer[r++]=i[n]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let a=e*this.typedBufferStride,u=r*i.typedBufferStride;for(let p=0;p<9;++p)n[a++]=s[u++]}get buffer(){return this.typedBuffer.buffer}};hK.ElementCount=9;let dK=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=16;const a=this.TypedArrayConstructor;n===void 0&&(n=16*a.BYTES_PER_ELEMENT);const u=i.byteLength===0?0:r;this.typedBuffer=s==null?new a(i,u):new a(i,u,(s-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<16;n++)i[n]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<16;n++)this.typedBuffer[r++]=i[n]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let a=e*this.typedBufferStride,u=r*i.typedBufferStride;for(let p=0;p<16;++p)n[a++]=s[u++]}get buffer(){return this.typedBuffer.buffer}};dK.ElementCount=16;let Vg=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=1;const a=this.TypedArrayConstructor;n===void 0&&(n=a.BYTES_PER_ELEMENT);const u=i.byteLength===0?0:r;this.typedBuffer=s==null?new a(i,u):new a(i,u,(s-r)/a.BYTES_PER_ELEMENT),this.stride=n,this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}};Vg.ElementCount=1;let Gg=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=2;const a=this.TypedArrayConstructor;n===void 0&&(n=2*a.BYTES_PER_ELEMENT);const u=i.byteLength===0?0:r;this.typedBuffer=s==null?new a(i,u):new a(i,u,(s-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,Yi(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let a=e*this.typedBufferStride,u=r*i.typedBufferStride;n[a++]=s[u++],n[a]=s[u]}get buffer(){return this.typedBuffer.buffer}};Gg.ElementCount=2;let Hg=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=3;const a=this.TypedArrayConstructor;n===void 0&&(n=3*a.BYTES_PER_ELEMENT);const u=i.byteLength===0?0:r;this.typedBuffer=s==null?new a(i,u):new a(i,u,(s-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,$e(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=n}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let a=e*this.typedBufferStride,u=r*i.typedBufferStride;n[a++]=s[u++],n[a++]=s[u++],n[a]=s[u]}get buffer(){return this.typedBuffer.buffer}};Hg.ElementCount=3;let qg=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const a=this.TypedArrayConstructor;n===void 0&&(n=4*a.BYTES_PER_ELEMENT);const u=i.byteLength===0?0:r;this.typedBuffer=s==null?new a(i,u):new a(i,u,(s-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,_n(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,n,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=n,this.typedBuffer[e]=s}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let a=e*this.typedBufferStride,u=r*i.typedBufferStride;n[a++]=s[u++],n[a++]=s[u++],n[a++]=s[u++],n[a]=s[u]}get buffer(){return this.typedBuffer.buffer}};qg.ElementCount=4;let D7=class O3e extends Vg{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}static fromTypedArray(e,i){return new O3e(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};D7.ElementType="f32";let Pw=class tH extends Gg{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(tH,e,i)}static fromTypedArray(e,i){return new tH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Pw.ElementType="f32";let lo=class iH extends Hg{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(iH,e,i)}static fromTypedArray(e,i){return new iH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};lo.ElementType="f32";let zp=class rH extends qg{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(rH,e,i)}static fromTypedArray(e,i){return new rH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};zp.ElementType="f32";let bv=class nH extends hK{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(nH,e,i)}static fromTypedArray(e,i){return new nH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};bv.ElementType="f32";let pK=class sH extends hK{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(sH,e,i)}static fromTypedArray(e,i){return new sH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};pK.ElementType="f64";let fK=class oH extends dK{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(oH,e,i)}static fromTypedArray(e,i){return new oH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};fK.ElementType="f32";let sO=class aH extends dK{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(aH,e,i)}static fromTypedArray(e,i){return new aH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};sO.ElementType="f64";let mK=class lH extends Vg{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(lH,e,i)}static fromTypedArray(e,i){return new lH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};mK.ElementType="f64";let gK=class cH extends Gg{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(cH,e,i)}static fromTypedArray(e,i){return new cH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};gK.ElementType="f64";let ud=class uH extends Hg{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(uH,e,i)}static fromTypedArray(e,i){return new uH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ud.ElementType="f64";let N7=class hH extends qg{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(hH,e,i)}static fromTypedArray(e,i){return new hH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};N7.ElementType="f64";let zS=class dH extends Vg{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(dH,e,i)}static fromTypedArray(e,i){return new dH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};zS.ElementType="u8";let F7=class pH extends Gg{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(pH,e,i)}static fromTypedArray(e,i){return new pH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};F7.ElementType="u8";let k7=class fH extends Hg{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(fH,e,i)}static fromTypedArray(e,i){return new fH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};k7.ElementType="u8";let ja=class mH extends qg{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(mH,e,i)}static fromTypedArray(e,i){return new mH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ja.ElementType="u8";let z7=class gH extends Vg{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(gH,e,i)}static fromTypedArray(e,i){return new gH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};z7.ElementType="u16";let yK=class yH extends Gg{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(yH,e,i)}static fromTypedArray(e,i){return new yH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};yK.ElementType="u16";let U7=class vH extends Hg{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(vH,e,i)}static fromTypedArray(e,i){return new vH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};U7.ElementType="u16";let fR=class _H extends qg{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(_H,e,i)}static fromTypedArray(e,i){return new _H(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};fR.ElementType="u16";let j7=class bH extends Vg{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(bH,e,i)}static fromTypedArray(e,i){return new bH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};j7.ElementType="u32";let vK=class wH extends Gg{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(wH,e,i)}static fromTypedArray(e,i){return new wH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};vK.ElementType="u32";let R3e=class xH extends Hg{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(xH,e,i)}static fromTypedArray(e,i){return new xH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};R3e.ElementType="u32";let M3e=class TH extends qg{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(TH,e,i)}static fromTypedArray(e,i){return new TH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};M3e.ElementType="u32";let _K=class SH extends Vg{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(SH,e,i)}static fromTypedArray(e,i){return new SH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};_K.ElementType="i8";let B7=class EH extends Gg{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(EH,e,i)}static fromTypedArray(e,i){return new EH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};B7.ElementType="i8";let P3e=class CH extends Hg{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(CH,e,i)}static fromTypedArray(e,i){return new CH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};P3e.ElementType="i8";let I3e=class AH extends qg{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(AH,e,i)}static fromTypedArray(e,i){return new AH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};I3e.ElementType="i8";let $3e=class OH extends Vg{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(OH,e,i)}static fromTypedArray(e,i){return new OH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};$3e.ElementType="i16";let mR=class RH extends Gg{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(RH,e,i)}static fromTypedArray(e,i){return new RH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};mR.ElementType="i16";let L3e=class MH extends Hg{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(MH,e,i)}static fromTypedArray(e,i){return new MH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};L3e.ElementType="i16";let D3e=class PH extends qg{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(PH,e,i)}static fromTypedArray(e,i){return new PH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};D3e.ElementType="i16";let N3e=class IH extends Vg{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(IH,e,i)}static fromTypedArray(e,i){return new IH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};N3e.ElementType="i32";let F3e=class $H extends Gg{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer($H,e,i)}static fromTypedArray(e,i){return new $H(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};F3e.ElementType="i32";let k3e=class LH extends Hg{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(LH,e,i)}static fromTypedArray(e,i){return new LH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};k3e.ElementType="i32";let z3e=class DH extends qg{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(DH,e,i)}static fromTypedArray(e,i){return new DH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};z3e.ElementType="i32";function zse(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let Use=class U3e{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fields.keys()){const n=e.fields.get(r);this[r]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new U3e(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i=0,r=0,n=e.count){const s=this.stride;if(s%4==0){const a=new Uint32Array(e.buffer,i*s,n*s/4);new Uint32Array(this.buffer,r*s,n*s/4).set(a)}else{const a=new Uint8Array(e.buffer,i*s,n*s);new Uint8Array(this.buffer,r*s,n*s).set(a)}return this}get usedMemory(){return this.byteLength}dispose(){}},j3e=class B3e{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(i=>this._fields.set(i[0],{...i[1],constructor:kYe(i[1].constructor)})))}vec2f(e,i){return this._appendField(e,Pw,i),this}vec2f64(e,i){return this._appendField(e,gK,i),this}vec3f(e,i){return this._appendField(e,lo,i),this}vec3f64(e,i){return this._appendField(e,ud,i),this}vec4f(e,i){return this._appendField(e,zp,i),this}vec4f64(e,i){return this._appendField(e,N7,i),this}mat3f(e,i){return this._appendField(e,bv,i),this}mat3f64(e,i){return this._appendField(e,pK,i),this}mat4f(e,i){return this._appendField(e,fK,i),this}mat4f64(e,i){return this._appendField(e,sO,i),this}vec4u8(e,i){return this._appendField(e,ja,i),this}f32(e,i){return this._appendField(e,D7,i),this}f64(e,i){return this._appendField(e,mK,i),this}u8(e,i){return this._appendField(e,zS,i),this}u16(e,i){return this._appendField(e,z7,i),this}i8(e,i){return this._appendField(e,_K,i),this}vec2i8(e,i){return this._appendField(e,B7,i),this}vec2i16(e,i){return this._appendField(e,mR,i),this}vec2u8(e,i){return this._appendField(e,F7,i),this}vec4u16(e,i){return this._appendField(e,fR,i),this}u32(e,i){return this._appendField(e,j7,i),this}_appendField(e,i,r){if(this._fields.has(e))return void zt(!1,`${e} already added to vertex buffer layout`);const n=i.ElementCount*zse(i.ElementType),s=this._stride;this._stride+=n,this._fields.set(e,{size:n,constructor:i,offset:s,optional:r})}createBuffer(e){return new Use(this,e)}createView(e){return new Use(this,e)}clone(){const e=new B3e;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((i,r)=>e._fields.set(r,i)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(i=>e=Math.max(e,zse(i.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function wn(){return new j3e}let NYe=class{constructor(e){this.fields=new Array,e.fields.forEach((i,r)=>{const n={...i,constructor:V3e(i.constructor)};this.fields.push([r,n])}),this.stride=e.stride}};const FYe=[D7,Pw,lo,zp,bv,fK,mK,gK,ud,N7,pK,sO,zS,F7,k7,ja,z7,yK,U7,fR,j7,vK,R3e,M3e,_K,B7,P3e,I3e,$3e,mR,L3e,D3e,N3e,F3e,k3e,z3e];function V3e(t){return`${t.ElementType}_${t.ElementCount}`}function kYe(t){return G3e.get(t)}const G3e=new Map;FYe.forEach(t=>G3e.set(V3e(t),t));function Ro(t,e=!1){return t<=Yu?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function H3e(t){return(Zh(t)?t.length:t.byteLength/8)<=Yu?Array.from(t):new Float64Array(t)}function Xh(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function zYe(t,e){for(let i=0;i<e.length;++i)t[i]=e[i];return t}function f6t(t){return Array.isArray(t)?new Float64Array(t):t}function Fn(t,e=!1){return t<=Yu?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function m6t(t){return Zh(t)?t.length<Yu?t:new Float32Array(t):t.length<Yu?Array.from(t):t}function jse(t){return(Zh(t)?t.length:t.byteLength/8)<=Yu?Array.from(t):new Float32Array(t)}function HL(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function v0(t){if(Zh(t)){if(t.length<Yu)return t}else if(t.length<Yu)return Array.from(t);let e=!0,i=!0;return t.some((r,n)=>(e=e&&r===0,i=i&&r===n,!e&&!i)),e?Uv(t.length):i?Iw(t.length):Zh(t)||t.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?UYe(t):t}function UYe(t){let e=!0;for(const i of t){if(i>=65536)return Zh(t)?new Uint32Array(t):t;i>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function qL(t){return t<=Yu?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function jYe(t){return t<=Yu?new Array(t):new Uint32Array(t)}let c3=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const q3e=[0],nk=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function Iw(t){if(t===1)return q3e;if(t<Yu)return Array.from(new Uint16Array(nk.buffer,0,t));if(t<nk.length)return new Uint16Array(nk.buffer,0,t);if(t>c3.length){const e=Math.max(2*c3.length,t);c3=new Uint32Array(e);for(let i=0;i<c3.length;i++)c3[i]=i}return new Uint32Array(c3.buffer,0,t)}let QM=new Uint8Array(65536);function Uv(t){if(t===1)return q3e;if(t<Yu)return new Array(t).fill(0);if(t>QM.length){const e=Math.max(2*QM.length,t);QM=new Uint8Array(e)}return new Uint8Array(QM.buffer,0,t)}var NH;(function(t){function e(a,u){const p=a[u],y=a[u+1],b=a[u+2];return Math.sqrt(p*p+y*y+b*b)}function i(a,u){const p=a[u],y=a[u+1],b=a[u+2],S=1/Math.sqrt(p*p+y*y+b*b);a[u]*=S,a[u+1]*=S,a[u+2]*=S}function r(a,u,p){a[u]*=p,a[u+1]*=p,a[u+2]*=p}function n(a,u,p,y,b,S=u){(b=b||a)[S]=a[u]+p[y],b[S+1]=a[u+1]+p[y+1],b[S+2]=a[u+2]+p[y+2]}function s(a,u,p,y,b,S=u){(b=b||a)[S]=a[u]-p[y],b[S+1]=a[u+1]-p[y+1],b[S+2]=a[u+2]-p[y+2]}t.length=e,t.normalize=i,t.scale=r,t.add=n,t.subtract=s})(NH||(NH={}));var Gn;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(Gn||(Gn={}));function BYe(t){if(t.length<Yu)return Array.from(t);if(Zh(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return mD(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let W3e=class X3e{constructor(e,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.position=r,this._children=void 0,zt(e.length>=1),zt(r.size===3||r.size===4);const{data:n,size:s,indices:a}=r;zt(a.length%this._numIndexPerPrimitive==0),zt(a.length>=e.length*this._numIndexPerPrimitive);const u=e.length;let p=s*a[this._numIndexPerPrimitive*e[0]];Zv.clear(),Zv.push(p);const y=st(n[p],n[p+1],n[p+2]),b=An(y);for(let O=0;O<u;++O){const P=this._numIndexPerPrimitive*e[O];for(let $=0;$<this._numIndexPerPrimitive;++$){p=s*a[P+$],Zv.push(p);let N=n[p];y[0]=Math.min(N,y[0]),b[0]=Math.max(N,b[0]),N=n[p+1],y[1]=Math.min(N,y[1]),b[1]=Math.max(N,b[1]),N=n[p+2],y[2]=Math.min(N,y[2]),b[2]=Math.max(N,b[2])}}this.bbMin=y,this.bbMax=b;const S=Ir(H(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(b[0]-y[0],b[1]-y[1]),b[2]-y[2]);let C=this.radius*this.radius;for(let O=0;O<Zv.length;++O){p=Zv.at(O);const P=n[p]-S[0],$=n[p+1]-S[1],N=n[p+2]-S[2],z=P*P+$*$+N*N;if(z<=C)continue;const U=Math.sqrt(z),j=.5*(U-this.radius);this.radius=this.radius+j,C=this.radius*this.radius;const G=j/U;S[0]+=P*G,S[1]+=$*G,S[2]+=N*G}this.center=S,Zv.clear()}getChildren(){if(this._children||ao(this.bbMin,this.bbMax)<=1)return this._children;const e=Ir(H(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),n=new Array(8);for(let b=0;b<8;++b)n[b]=0;const{data:s,size:a,indices:u}=this.position;for(let b=0;b<i;++b){let S=0;const C=this._numIndexPerPrimitive*this.primitiveIndices[b];let O=a*u[C],P=s[O],$=s[O+1],N=s[O+2];for(let z=1;z<this._numIndexPerPrimitive;++z){O=a*u[C+z];const U=s[O],j=s[O+1],G=s[O+2];U<P&&(P=U),j<$&&($=j),G<N&&(N=G)}P<e[0]&&(S|=1),$<e[1]&&(S|=2),N<e[2]&&(S|=4),r[b]=S,++n[S]}let p=0;for(let b=0;b<8;++b)n[b]>0&&++p;if(p<2)return;const y=new Array(8);for(let b=0;b<8;++b)y[b]=n[b]>0?new Uint32Array(n[b]):void 0;for(let b=0;b<8;++b)n[b]=0;for(let b=0;b<i;++b){const S=r[b];y[S][n[S]++]=this.primitiveIndices[b]}this._children=new Array;for(let b=0;b<8;++b)y[b]!==void 0&&this._children.push(new X3e(y[b],this._numIndexPerPrimitive,this.position));return this._children}static prune(){Zv.prune()}};const Zv=new xi({deallocator:null});let gR=class{constructor(){this.id=zu()}};function VYe(t){return t?{p0:An(t.p0),p1:An(t.p1),p2:An(t.p2)}:{p0:H(),p1:H(),p2:H()}}function Bse(t,e,i){const r=e[0]-t[0],n=e[1]-t[1],s=i[0]-t[0],a=i[1]-t[1];return .5*Math.abs(r*a-n*s)}function GYe(t,e,i){return Be(sk,e,t),Be(Vse,i,t),Qe(qt(sk,sk,Vse))/2}new kg(Gp);new kg(()=>VYe());const sk=H(),Vse=H();function HYe(t,e){if(!t)return!1;const{size:i,data:r,indices:n}=t;$e(e,0,0,0),$e(Oh,0,0,0);let s=0,a=0;for(let u=0;u<n.length-2;u+=3){const p=n[u]*i,y=n[u+1]*i,b=n[u+2]*i;$e(To,r[p],r[p+1],r[p+2]),$e(eg,r[y],r[y+1],r[y+2]),$e(eP,r[b],r[b+1],r[b+2]);const S=GYe(To,eg,eP);S?(Ue(To,To,eg),Ue(To,To,eP),Pe(To,To,1/3*S),Ue(e,e,To),s+=S):(Ue(Oh,Oh,To),Ue(Oh,Oh,eg),Ue(Oh,Oh,eP),a+=3)}return(a!==0||s!==0)&&(s!==0?(Pe(e,e,1/s),!0):a!==0&&(Pe(e,Oh,1/a),!0))}function qYe(t,e){if(!t)return!1;const{size:i,data:r,indices:n}=t;$e(e,0,0,0);let s=-1,a=0;for(let u=0;u<n.length;u++){const p=n[u]*i;s!==p&&(e[0]+=r[p],e[1]+=r[p+1],e[2]+=r[p+2],a++),s=p}return a>1&&Pe(e,e,1/a),a>0}function WYe(t,e,i){if(!t)return!1;$e(i,0,0,0),$e(Oh,0,0,0);let r=0,n=0;const{size:s,data:a,indices:u}=t,p=u.length-1,y=p+(e?2:0);for(let b=0;b<y;b+=2){const S=b<p?b+1:0,C=u[b<p?b:p]*s,O=u[S]*s;To[0]=a[C],To[1]=a[C+1],To[2]=a[C+2],eg[0]=a[O],eg[1]=a[O+1],eg[2]=a[O+2],Pe(To,Ue(To,To,eg),.5);const P=WO(To,eg);P>0?(Ue(i,i,Pe(To,To,P)),r+=P):r===0&&(Ue(Oh,Oh,To),n++)}return r!==0?(Pe(i,i,1/r),!0):n!==0&&(Pe(i,Oh,1/n),!0)}const To=H(),eg=H(),eP=H(),Oh=H();let WL=class{constructor(e){this.channel=e,this.id=zu()}};function FH(t,e){return t==null&&(t=[]),t.push(e),t}function kH(t,e){if(t==null)return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function XYe(t,e,i,r,n){tP[0]=t.get(e,0),tP[1]=t.get(e,1),tP[2]=t.get(e,2),QG(tP,Kv,3),i.set(n,0,Kv[0]),r.set(n,0,Kv[1]),i.set(n,1,Kv[2]),r.set(n,1,Kv[3]),i.set(n,2,Kv[4]),r.set(n,2,Kv[5])}const tP=H(),Kv=new Float32Array(6);let Is=class J3e extends gR{constructor(e,i,r=null,n=Gn.Mesh,s=null,a=-1){super(),this.material=e,this.mapPositions=r,this.type=n,this.objectAndLayerIdColor=s,this.edgeIndicesLength=a,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[u,p]of i)this._attributes.set(u,{...p,indices:v0(p.indices)}),u===X.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(u).indices.length:this.edgeIndicesLength)}instantiate(e={}){const i=new J3e(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((r,n)=>{r.exclusive=!1,i._attributes.set(n,r)}),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(e){let i=this._attributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:BYe(i.data)},this._attributes.set(e,i)),i}setAttributeData(e,i){const r=this._attributes.get(e);r&&this._attributes.set(e,{...r,exclusive:!0,data:i})}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Gn.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Gn.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&wt(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.attributes.get(X.POSITION);return HYe(i,e)}_computeAttachmentOriginLines(e){const i=this.attributes.get(X.POSITION);return WYe(i,JYe(this.material.parameters,i),e)}_computeAttachmentOriginPoints(e){const i=this.attributes.get(X.POSITION);return qYe(i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(X.POSITION);if(!e||e.indices.length===0)return null;const i=this.type===Gn.Mesh?3:1;zt(e.indices.length%i==0,"Indexing error: "+e.indices.length+" not divisible by "+i);const r=Iw(e.indices.length/i);return new W3e(r,i,e)}get transformation(){return this._transformation??Cn}set transformation(e){this._transformation=e&&e!==Cn?OS(e):null}addHighlight(){const e=new WL(Pg.Highlight);return this.highlights=FH(this.highlights,e),e}removeHighlight(e){this.highlights=kH(this.highlights,e)}};function JYe(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const u3=NH,ok=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],YYe=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],ZYe=[0,0,1,0,1,1,0,1],KYe=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],Y3e=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)Y3e[6*t+e]=t;const lb=new Array(36);for(let t=0;t<6;t++)lb[6*t]=0,lb[6*t+1]=1,lb[6*t+2]=2,lb[6*t+3]=2,lb[6*t+4]=3,lb[6*t+5]=0;function QYe(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=ok[r][0]*e[0],i[3*r+1]=ok[r][1]*e[1],i[3*r+2]=ok[r][2]*e[2];return new Is(t,[[X.POSITION,new Et(i,KYe,3,!0)],[X.NORMAL,new Et(YYe,Y3e,3)],[X.UV0,new Et(ZYe,lb,2)]])}const ak=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],eZe=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],tZe=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],iZe=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function rZe(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=ak[r][0]*e[0],i[3*r+1]=ak[r][1]*e[1],i[3*r+2]=ak[r][2]*e[2];return new Is(t,[[X.POSITION,new Et(i,tZe,3,!0)],[X.NORMAL,new Et(eZe,iZe,3)]])}const _$=kr(-.5,0,-.5),b$=kr(.5,0,-.5),w$=kr(0,0,.5),x$=kr(0,.5,0),h3=ts(),d3=ts(),UT=ts(),jT=ts(),BT=ts();Be(h3,_$,x$),Be(d3,_$,b$),qt(UT,h3,d3),We(UT,UT),Be(h3,b$,x$),Be(d3,b$,w$),qt(jT,h3,d3),We(jT,jT),Be(h3,w$,x$),Be(d3,w$,_$),qt(BT,h3,d3),We(BT,BT);const lk=[_$,b$,w$,x$],nZe=[0,-1,0,UT[0],UT[1],UT[2],jT[0],jT[1],jT[2],BT[0],BT[1],BT[2]],sZe=[0,1,2,3,1,0,3,2,1,3,0,2],oZe=[0,0,0,1,1,1,2,2,2,3,3,3];function aZe(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=lk[r][0]*e[0],i[3*r+1]=lk[r][1]*e[1],i[3*r+2]=lk[r][2]*e[2];return new Is(t,[[X.POSITION,new Et(i,sZe,3,!0)],[X.NORMAL,new Et(nZe,oZe,3)]])}function v6t(t,e,i,r,n={uv:!0}){const s=-Math.PI,a=2*Math.PI,u=-Math.PI/2,p=Math.PI,y=Math.max(3,Math.floor(i)),b=Math.max(2,Math.floor(r)),S=(y+1)*(b+1),C=Fn(3*S),O=Fn(3*S),P=Fn(2*S),$=[];let N=0;for(let j=0;j<=b;j++){const G=[],q=j/b,W=u+q*p,K=Math.cos(W);for(let se=0;se<=y;se++){const ae=se/y,le=s+ae*a,me=Math.cos(le)*K,ne=Math.sin(W),pe=-Math.sin(le)*K;C[3*N]=me*e,C[3*N+1]=ne*e,C[3*N+2]=pe*e,O[3*N]=me,O[3*N+1]=ne,O[3*N+2]=pe,P[2*N]=ae,P[2*N+1]=q,G.push(N),++N}$.push(G)}const z=new Array;for(let j=0;j<b;j++)for(let G=0;G<y;G++){const q=$[j][G],W=$[j][G+1],K=$[j+1][G+1],se=$[j+1][G];j===0?(z.push(q),z.push(K),z.push(se)):j===b-1?(z.push(q),z.push(W),z.push(K)):(z.push(q),z.push(W),z.push(K),z.push(K),z.push(se),z.push(q))}const U=[[X.POSITION,new Et(C,z,3,!0)],[X.NORMAL,new Et(O,z,3,!0)]];return n.uv&&U.push([X.UV0,new Et(P,z,2,!0)]),n.offset&&(U[0][0]=X.OFFSET,U.push([X.POSITION,new Et(Float64Array.from(n.offset),Uv(z.length),3,!0)])),new Is(t,U)}function lZe(t,e,i,r){const n=Z3e(e,i,r);return new Is(t,n)}function Z3e(t,e,i){const r=t;let n,s;if(i)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const y=r*(1+Math.sqrt(5))/2;n=[-r,y,0,r,y,0,-r,-y,0,r,-y,0,0,-r,y,0,r,y,0,-r,-y,0,r,-y,y,0,-r,y,0,r,-y,0,-r,-y,0,r],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let y=0;y<n.length;y+=3)u3.scale(n,y,t/u3.length(n,y));let a={};function u(y,b){y>b&&([y,b]=[b,y]);const S=y.toString()+"."+b.toString();if(a[S])return a[S];let C=n.length;return n.length+=3,u3.add(n,3*y,n,3*b,n,C),u3.scale(n,C,t/u3.length(n,C)),C/=3,a[S]=C,C}for(let y=0;y<e;y++){const b=s.length,S=new Array(4*b);for(let C=0;C<b;C+=3){const O=s[C],P=s[C+1],$=s[C+2],N=u(O,P),z=u(P,$),U=u($,O),j=4*C;S[j]=O,S[j+1]=N,S[j+2]=U,S[j+3]=P,S[j+4]=z,S[j+5]=N,S[j+6]=$,S[j+7]=U,S[j+8]=z,S[j+9]=N,S[j+10]=z,S[j+11]=U}s=S,a={}}const p=jse(n);for(let y=0;y<p.length;y+=3)u3.normalize(p,y);return[[X.POSITION,new Et(jse(n),s,3,!0)],[X.NORMAL,new Et(p,s,3,!0)]]}function zH(t,e,i,r,n,s,a,u,p=null){const y=i?[i[0],i[1],i[2]]:[0,0,0],b=e?[e[0],e[1],e[2]]:[0,0,1];a=a||[0,0];const S=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],C=n!=null&&n.length===2?n:[1,1],O=Uv(1),P=[[X.POSITION,new Et(y,O,3,!0)],[X.NORMAL,new Et(b,O,3,!0)],[X.UV0,new Et(a,O,a.length)],[X.COLOR,new Et(S,O,4,!0)],[X.SIZE,new Et(C,O,2)]];if(s!=null){const $=[s[0],s[1],s[2],s[3]];P.push([X.AUXPOS1,new Et($,O,4)])}if(u!=null){const $=[u[0],u[1],u[2],u[3]];P.push([X.FEATUREATTRIBUTE,new Et($,O,4)])}return new Is(t,P,null,Gn.Point,p)}const cZe=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function _6t(t,e=cZe){const i=new Array(12);for(let y=0;y<4;y++)for(let b=0;b<3;b++)i[3*y+b]=e[y][b];const r=[0,1,2,2,3,0],n=[0,0,1],s=[0,0,0,0,0,0],a=[0,0,1,0,1,1,0,1],u=[255,255,255,255],p=[[X.POSITION,new Et(i,r,3,!0)],[X.NORMAL,new Et(n,s,3,!0)],[X.UV0,new Et(a,r,2,!0)],[X.COLOR,new Et(u,s,4,!0)]];return new Is(t,p)}function Gse(t,e,i,r,n,s=!0,a=!0){let u=0;const p=i,y=e;let b=kr(0,u,0),S=kr(0,u+y,0),C=kr(0,-1,0),O=kr(0,1,0);n&&(u=y,S=kr(0,0,0),b=kr(0,u,0),C=kr(0,1,0),O=kr(0,-1,0));const P=[S,b],$=[C,O],N=r+2,z=Math.sqrt(y*y+p*p);if(n)for(let K=r-1;K>=0;K--){const se=K*(2*Math.PI/r),ae=kr(Math.cos(se)*p,u,Math.sin(se)*p);P.push(ae);const le=kr(y*Math.cos(se)/z,-p/z,y*Math.sin(se)/z);$.push(le)}else for(let K=0;K<r;K++){const se=K*(2*Math.PI/r),ae=kr(Math.cos(se)*p,u,Math.sin(se)*p);P.push(ae);const le=kr(y*Math.cos(se)/z,p/z,y*Math.sin(se)/z);$.push(le)}const U=new Array,j=new Array;if(s){for(let K=3;K<P.length;K++)U.push(1),U.push(K-1),U.push(K),j.push(0),j.push(0),j.push(0);U.push(P.length-1),U.push(2),U.push(1),j.push(0),j.push(0),j.push(0)}if(a){for(let K=3;K<P.length;K++)U.push(K),U.push(K-1),U.push(0),j.push(K),j.push(K-1),j.push(1);U.push(0),U.push(2),U.push(P.length-1),j.push(1),j.push(2),j.push($.length-1)}const G=Fn(3*N);for(let K=0;K<N;K++)G[3*K]=P[K][0],G[3*K+1]=P[K][1],G[3*K+2]=P[K][2];const q=Fn(3*N);for(let K=0;K<N;K++)q[3*K]=$[K][0],q[3*K+1]=$[K][1],q[3*K+2]=$[K][2];const W=[[X.POSITION,new Et(G,U,3,!0)],[X.NORMAL,new Et(q,j,3,!0)]];return new Is(t,W)}function uZe(t,e,i,r,n,s,a){const u=n?XG(n):kr(1,0,0),p=s?XG(s):kr(0,0,0);a??(a=!0);const y=ts();We(y,u);const b=ts();Pe(b,y,Math.abs(e));const S=ts();Pe(S,b,-.5),Ue(S,S,p);const C=kr(0,1,0);Math.abs(1-He(y,C))<.2&&$e(C,0,0,1);const O=ts();qt(O,y,C),We(O,O),qt(C,O,y);const P=2*r+(a?2:0),$=r+(a?2:0),N=Fn(3*P),z=Fn(3*$),U=Fn(2*P),j=new Array(3*r*(a?4:2)),G=new Array(3*r*(a?4:2));a&&(N[3*(P-2)]=S[0],N[3*(P-2)+1]=S[1],N[3*(P-2)+2]=S[2],U[2*(P-2)]=0,U[2*(P-2)+1]=0,N[3*(P-1)]=N[3*(P-2)]+b[0],N[3*(P-1)+1]=N[3*(P-2)+1]+b[1],N[3*(P-1)+2]=N[3*(P-2)+2]+b[2],U[2*(P-1)]=1,U[2*(P-1)+1]=1,z[3*($-2)]=-y[0],z[3*($-2)+1]=-y[1],z[3*($-2)+2]=-y[2],z[3*($-1)]=y[0],z[3*($-1)+1]=y[1],z[3*($-1)+2]=y[2]);const q=(le,me,ne)=>{j[le]=me,G[le]=ne};let W=0;const K=ts(),se=ts();for(let le=0;le<r;le++){const me=le*(2*Math.PI/r);Pe(K,C,Math.sin(me)),Pe(se,O,Math.cos(me)),Ue(K,K,se),z[3*le]=K[0],z[3*le+1]=K[1],z[3*le+2]=K[2],Pe(K,K,i),Ue(K,K,S),N[3*le]=K[0],N[3*le+1]=K[1],N[3*le+2]=K[2],U[2*le]=le/r,U[2*le+1]=0,N[3*(le+r)]=N[3*le]+b[0],N[3*(le+r)+1]=N[3*le+1]+b[1],N[3*(le+r)+2]=N[3*le+2]+b[2],U[2*(le+r)]=le/r,U[2*le+1]=1;const ne=(le+1)%r;q(W++,le,le),q(W++,le+r,le),q(W++,ne,ne),q(W++,ne,ne),q(W++,le+r,le),q(W++,ne+r,ne)}if(a){for(let le=0;le<r;le++){const me=(le+1)%r;q(W++,P-2,$-2),q(W++,le,$-2),q(W++,me,$-2)}for(let le=0;le<r;le++){const me=(le+1)%r;q(W++,le+r,$-1),q(W++,P-1,$-1),q(W++,me+r,$-1)}}const ae=[[X.POSITION,new Et(N,j,3,!0)],[X.NORMAL,new Et(z,G,3,!0)],[X.UV0,new Et(U,j,2,!0)]];return new Is(t,ae)}function b6t(t,e,i,r,n,s,a=kr(0,0,0)){const u=e.length,p=Fn(i.length*u*3+(6*r.length||0)),y=Fn(i.length*u*3+(r?6:0)),b=new Array,S=new Array;let C=0,O=0;const P=ts(),$=ts(),N=ts(),z=ts(),U=ts(),j=ts(),G=ts(),q=H(),W=ts(),K=ts(),se=ts(),ae=ts(),le=ts(),me=gr();$e(W,0,1,0),Be($,i[1],i[0]),We($,$),s?(Ue(q,i[0],a),We(N,q)):$e(N,0,0,1),XL($,N,W,W,U,N,Hse),Ie(z,N),Ie(ae,U);for(let re=0;re<r.length;re++)Pe(j,U,r[re][0]),Pe(q,N,r[re][2]),Ue(j,j,q),Ue(j,j,i[0]),p[C++]=j[0],p[C++]=j[1],p[C++]=j[2];y[O++]=-$[0],y[O++]=-$[1],y[O++]=-$[2];for(let re=0;re<n.length;re++)b.push(n[re][0]>0?n[re][0]:-n[re][0]-1+r.length),b.push(n[re][1]>0?n[re][1]:-n[re][1]-1+r.length),b.push(n[re][2]>0?n[re][2]:-n[re][2]-1+r.length),S.push(0),S.push(0),S.push(0);let ne=r.length;const pe=r.length-1;for(let re=0;re<i.length;re++){let fe=!1;re>0&&(Ie(P,$),re<i.length-1?(Be($,i[re+1],i[re]),We($,$)):fe=!0,Ue(K,P,$),We(K,K),Ue(se,i[re-1],z),lR(i[re],K,me),Cw(me,eh(se,P),q)?(Be(q,q,i[re]),We(N,q),qt(U,K,N),We(U,U)):XL(K,z,ae,W,U,N,Hse),Ie(z,N),Ie(ae,U)),s&&(Ue(q,i[re],a),We(le,q));for(let ye=0;ye<u;ye++)if(Pe(j,U,e[ye][0]),Pe(q,N,e[ye][1]),Ue(j,j,q),We(G,j),y[O++]=G[0],y[O++]=G[1],y[O++]=G[2],Ue(j,j,i[re]),p[C++]=j[0],p[C++]=j[1],p[C++]=j[2],!fe){const we=(ye+1)%u;b.push(ne+ye),b.push(ne+u+ye),b.push(ne+we),b.push(ne+we),b.push(ne+u+ye),b.push(ne+u+we);for(let Ae=0;Ae<6;Ae++){const Oe=b.length-6;S.push(b[Oe+Ae]-pe)}}ne+=u}const ge=i[i.length-1];for(let re=0;re<r.length;re++)Pe(j,U,r[re][0]),Pe(q,N,r[re][1]),Ue(j,j,q),Ue(j,j,ge),p[C++]=j[0],p[C++]=j[1],p[C++]=j[2];const ve=O/3;y[O++]=$[0],y[O++]=$[1],y[O++]=$[2];const Se=ne-u;for(let re=0;re<n.length;re++)b.push(n[re][0]>=0?ne+n[re][0]:-n[re][0]-1+Se),b.push(n[re][2]>=0?ne+n[re][2]:-n[re][2]-1+Se),b.push(n[re][1]>=0?ne+n[re][1]:-n[re][1]-1+Se),S.push(ve),S.push(ve),S.push(ve);const ee=[[X.POSITION,new Et(p,b,3,!0)],[X.NORMAL,new Et(y,S,3,!0)]];return new Is(t,ee)}function w6t(t,e,i,r){zt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),zt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),zt(i==null||i.length===e.length,"createPolylineGeometry: need same number of points and normals"),zt(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const n=Ro(3*e.length),s=new Array(2*(e.length-1));let a=0,u=0;for(let y=0;y<e.length;y++){for(let b=0;b<3;b++)n[a++]=e[y][b];y>0&&(s[u++]=y-1,s[u++]=y)}const p=[[X.POSITION,new Et(n,s,3,!0)]];if(i){const y=Fn(3*i.length);let b=0;for(let S=0;S<e.length;S++)for(let C=0;C<3;C++)y[b++]=i[S][C];p.push([X.NORMAL,new Et(y,s,3,!0)])}return r&&p.push([X.COLOR,new Et(r,Iw(r.length/4),4)]),new Is(t,p,null,Gn.Line)}function hZe(t,e=t){const i=t.attributes,r=i.get(X.POSITION).data,n=i.get(X.NORMAL).data;if(n){const s=e.getMutableAttribute(X.NORMAL).data;for(let a=0;a<n.length;a+=3){const u=n[a+1];s[a+1]=-n[a+2],s[a+2]=u}}if(r){const s=e.getMutableAttribute(X.POSITION).data;for(let a=0;a<r.length;a+=3){const u=r[a+1];s[a+1]=-r[a+2],s[a+2]=u}}}function ck(t,e,i,r,n){return!(Math.abs(He(e,t))>n)&&(qt(i,t,e),We(i,i),qt(r,i,t),We(r,r),!0)}function XL(t,e,i,r,n,s,a){return ck(t,e,n,s,a)||ck(t,i,n,s,a)||ck(t,r,n,s,a)}const Hse=.99619469809;let dZe=class{constructor(e,i){this.type=Oa.Local,this._configuration=new cK,this._passParameters=new uK,this._configuration.geometry=M0.Cylinder,this._technique=i.techniqueRepository.acquire(GL,this._configuration);const r=i.renderContext.rctx;this._vao=this._createVertexArrayObject(r),this._vaoCount=dg(this._vao,"geometry");const n=new Ar;n.wrapMode=Ai.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new yi(r,n,$Ye)}destroy(){this._passParameters.texture=jt(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const i=e.rctx,r=i.bindTechnique(this._technique,this._passParameters,e.bindParameters);pZe(qse,e.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",qse),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Hi.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const i=Z3e(1,2,!1),{data:r,indices:n}=i[0][1],s=Wse.createBuffer(n.length),a=s.position;for(let u=0;u<n.length;++u){const p=3*n[u%3==0?u+2:u%3==2?u-2:u];a.set(u,0,r[p]),a.set(u,1,r[p+1]),a.set(u,2,r[p+2])}return new Wp(e,ar,{geometry:Kc(Wse)},{geometry:xr.createVertex(e,dr.STATIC_DRAW,s.buffer)})}};function pZe(t,e){bs(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const qse=Ze(),Wse=wn().vec3f(X.POSITION),fZe=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),iP=128,Xse=-kG,Jse=0,uk=50,mZe=()=>1-511/512,gZe=e$([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let yZe=class{constructor(e,i){this.view=e,this.type=Oa.Mars,this._passParameters=new uK,this._vaoCount=0,this._texV1=1;const r=Mr(e.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+Xse)/this._planetRadius,this._middleRimFactor=(this._planetRadius+Jse)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=Jse/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=i.techniqueRepository;const n=i.renderContext.rctx;this._cameraChangeHandle=Fe(()=>this.view.state?.camera,()=>i.requestRender(),Ur),this._vao=this._createRibbon(n),this._vaoCount=dg(this._vao,"geometry"),this._fadeVao=V0(n),this._fadeVaoCount=dg(this._fadeVao,"geometry");const s=new Ar;s.wrapMode=Ai.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new yi(n,s,fZe);const a=new cK;a.geometry=M0.Cone,this._coneTechnique=this._techniqueRepository.acquire(GL,a),a.geometry=M0.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(GL,a)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=jt(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const i=e.bindParameters.camera;this._update(i);const r=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._vao),r.drawArrays(Hi.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._fadeVao),r.drawArrays(Hi.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const i=H(),r=this._planetRadius,n=Qe(e.eye),s=n-r;if(s<0){const O=Math.min(-s/5e3,1);this._passParameters.undergroundFadeAlpha=O}else this._passParameters.undergroundFadeAlpha=0;const a=Math.max(uk,s),u=r+Xse;this._passParameters.innerScale=vZe(r+a,r,u)-1,this._passParameters.altitudeFade=JZ(s),Pe(i,e.eye,(r+uk)/n),Yse(i,e.center,e.up,r,this._passParameters.silhouette);const p=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),y=mZe(),b=gZe(s);let S=this._texV0+y*this._texVScale,C=this._texV0+p*b*this._texVScale;if(s>uk){Yse(e.eye,e.center,e.up,r,this._passParameters.silhouette);const O=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),P=Je((O-1.5)/(p-1.5),0,1);S=this._texV0+P*y*this._texVScale,C=this._texV0+si(this._texV1,p*b,P)*this._texVScale}Yi(this._passParameters.texV,S,C)}_createRibbon(e){const i=Fn(3+3*iP*3),r=new Uint32Array(3*iP*5);i[0]=0,i[1]=0,i[2]=-1;for(let a=0;a<iP;a++){const u=9*a+3;i[u]=a,i[u+1]=this._innerRimFactor,i[u+2]=-1,i[u+3]=a,i[u+4]=this._middleRimFactor,i[u+5]=0,i[u+6]=a,i[u+7]=this._outerRimFactor,i[u+8]=1;const p=3*a+1,y=a===iP-1?1:p+3,b=15*a;r[b]=p,r[b+1]=p+1,r[b+2]=y+1,r[b+3]=y+1,r[b+4]=y,r[b+5]=p,r[b+6]=p+1,r[b+7]=p+2,r[b+8]=y+2,r[b+9]=y+2,r[b+10]=y+1,r[b+11]=p+1,r[b+12]=p,r[b+13]=y,r[b+14]=0}const n=Zse.createBuffer(r.length),s=n.position;for(let a=0;a<r.length;++a){const u=3*r[a];s.set(a,0,i[u]),s.set(a,1,i[u+1]),s.set(a,2,i[u+2])}return new Wp(e,ar,{geometry:Kc(Zse)},{geometry:xr.createVertex(e,dr.STATIC_DRAW,n.buffer)})}_computeScreenRimWidth(e,i,r,n){return Ue(p3,n.center,n.v2),Pe(rP,p3,this._outerRimFactor),kD(hk,i,p3,r),lse(p3,hk,e.projectionMatrix,e.viewport,p3),lse(rP,hk,e.projectionMatrix,e.viewport,rP),un(p3,rP)/e.height}};function Yse(t,e,i,r,n){const s=Qe(t),a=r*Math.sqrt(s*s-r*r)/s,u=Math.sqrt(r*r-a*a),p=n.v1,y=n.v2;return Pe(n.center,t,u/s),qt(p,t,e),ha(p)<1&&qt(p,t,i),Pe(p,p,a/Qe(p)),qt(y,p,t),Pe(y,y,a/Qe(y)),a}const hk=Ze(),p3=H(),rP=H();function vZe(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}const Zse=wn().vec3f(X.POSITION);var Ig;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(Ig||(Ig={}));let UH=class extends rc{constructor(){super(...arguments),this.type=Ig.Rain}};_([ce({count:Ig.COUNT})],UH.prototype,"type",void 0);function _Ze(t){const e=new lr;return e.attributes.add(X.POSITION,"vec3"),e.attributes.add(X.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new _i("cameraPosition",(i,r)=>r.camera.eye)),e.vertex.uniforms.add(new _i("offset",(i,r)=>bZe(i,r))),e.vertex.uniforms.add(new lt("width",i=>i.width)),e.vertex.uniforms.add(new On("proj",(i,r)=>r.camera.projectionMatrix)),e.vertex.uniforms.add(new On("view",(i,r)=>r.camera.viewMatrix)),e.vertex.uniforms.add(new lt("time",i=>i.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(F`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===Ig.Rain?F`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:F`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new lt("opacity",i=>i.opacity),new _i("particleColor",(i,r)=>wZe(r,t))),e.fragment.code.add(F`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===Ig.Rain?F`d = 0.35 * smoothstep(0.5, 0.0, d);`:F`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function bZe(t,e){const i=e.camera.eye,r=.5*t.width,n=1/t.width,s=uge(jH,$e(jH,(i[0]+r)*n,(i[1]+r)*n,(i[2]+r)*n));return Ao(s,i,Pe(s,s,t.width))}function wZe(t,e){const i=e.type===Ig.Rain?TZe:xZe,r=Pe(jH,i,SZe),n=t.camera.eye;We(Kse,n);const s=Math.max(0,He(Kse,t.lighting.mainLight.direction));return Ir(r,r,i,s)}const jH=H(),Kse=H(),xZe=st(1,1,1),TZe=st(.85,.85,.85),SZe=.7,EZe=Object.freeze(Object.defineProperty({__proto__:null,build:_Ze},Symbol.toStringTag,{value:"Module"}));let CZe=class extends Vr{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},BH=class K3e extends wr{initializeProgram(e){return new fr(e.rctx,K3e.shader.get().build(this.configuration),T$)}initializePipeline(){return mi({blending:Zo(et.ONE,et.ONE,et.ONE_MINUS_SRC_ALPHA,et.ONE_MINUS_SRC_ALPHA),depthTest:{func:Tr.LEQUAL},colorWrite:Oi})}};BH.shader=new pr(EZe,()=>ke(()=>import("./Precipitation.glsl-168da314.js"),[],import.meta.url));const T$=new Map([[X.POSITION,0],[X.INSTANCEFEATUREATTRIBUTE,1]]);let Q3e=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:i}){return i!=null?this._time!==i&&(this._time=i,!0):(this._time=this._time+e,e!==0)}},AZe=class{constructor(e,i){this.deltaTime=e,this.fixedTime=i}},cb=class extends Ke{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new CZe,this._animation=new Q3e,this._updatingTracking=new Cp,this._passParameters.time=0,this._passParameters.radius=Mr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=Gi(this._snowTechniqueCached),this._rainTechniqueCached=Gi(this._rainTechniqueCached),this._vao=jt(this._vao),this._instanceIdBuffer=jt(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new UH;e.type=Ig.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(BH,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new UH;e.type=Ig.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(BH,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,i,r){const n=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!n.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),n==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=e.bindParameters.cloudsFade.opacity),this._passParameters.opacity<=0))return;const a=.35;i=i<.5?si(0,a,2*i):si(a,1,2*(i-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*dJ(this._animation.time)%1e5;const u=s.bindTechnique(n,this._passParameters,e.bindParameters);s.bindVAO(this._vao),u.assertCompatibleVertexAttributeLocations(this._vao),ZZ(s,T$,this._instanceIdBuffer,Qse,0),s.drawArraysInstanced(Hi.TRIANGLES,0,3,this._numParticles*i),KZ(s,T$,this._instanceIdBuffer,Qse)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const i=[];for(let r=0;r<this._numParticles;r++)i.push(r);return xr.createVertex(e,dr.STATIC_DRAW,new Float32Array(i))}_createVertexArrayObject(e){const i=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Wp(e,T$,{geometry:Kc(OZe)},{geometry:xr.createVertex(e,dr.STATIC_DRAW,i)})}};_([T({constructOnly:!0})],cb.prototype,"context",void 0),_([T({constructOnly:!0})],cb.prototype,"view",void 0),_([T({readOnly:!0})],cb.prototype,"updating",null),_([T()],cb.prototype,"_updatingTracking",void 0),cb=_([Z("esri.views.3d.environment.Precipitation")],cb);const OZe=wn().vec3f(X.POSITION),Qse=Kc(wn().f32(X.INSTANCEFEATUREATTRIBUTE),1);function RZe(){const t=new lr;return t.attributes.add(X.POSITION,"vec3"),t.attributes.add(X.COLOR,"vec4"),t.attributes.add(X.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new On("transform",(e,i)=>MZe(e,i)),new er("viewport",(e,i)=>i.camera.fullViewport),new lt("pixelRatio",(e,i)=>i.camera.pixelRatio)),t.vertex.code.add(F`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(F`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function MZe(t,e){return bs(d1,e.camera.projectionMatrix),d1[10]=24e-8-1,d1[11]=-1,d1[14]=(24e-8-2)*e.camera.near,Rr(d1,d1,e.camera.viewMatrix),Rr(d1,d1,t.modelMatrix)}const d1=Ze(),PZe=Object.freeze(Object.defineProperty({__proto__:null,build:RZe},Symbol.toStringTag,{value:"Module"}));let IZe=class extends Vr{constructor(){super(...arguments),this.modelMatrix=Ze()}},exe=class txe extends wr{constructor(e){super(e,new rc,()=>this.destroy())}initializeProgram(e){return new fr(e.rctx,txe.shader.get().build(),ar)}initializePipeline(){return mi({blending:Zo(et.SRC_ALPHA,et.ONE,et.ONE_MINUS_SRC_ALPHA,et.ONE_MINUS_SRC_ALPHA),depthTest:{func:Tr.LEQUAL},colorWrite:Oi})}};exe.shader=new pr(PZe,()=>ke(()=>import("./Stars.glsl-91caadb4.js"),[],import.meta.url));let ny=class extends Ke{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new IZe,this._updatingTracking=new Cp}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Vc(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Gi(this._technique),this._vao=jt(this._vao),Qv=null}render(e){const{rctx:i}=e;if(this._ensureResources(i),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const r=i.bindTechnique(this._technique,this._renderParameter,e.bindParameters);i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Hi.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||Qv==null)return;this._technique=new exe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Qv.byteLength/eoe;const i=new Float32Array(Qv,0,2*this._numPoints),r=new Uint8Array(Qv,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,i,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,n=>this._update(n),jr)}_computeDayDuration(e){const i=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+i-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),n=bs(this._renderParameter.modelMatrix,DZe);pS(n,n,-r*Math.PI),Rr(n,LZe,n),pS(n,n,-i*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,i,r,n){const s=toe.createBuffer(n),a=s.position,u=s.color,p=s.size;for(let y=0;y<n;y++){const b=i[2*y],S=i[2*y+1];a.set(y,0,-Math.cos(b)*Math.sin(S)),a.set(y,1,-Math.sin(b)*Math.sin(S)),a.set(y,2,-Math.cos(S));const C=this._unpackUint8Attributes(r[y]),O=this._hexToRGB($Ze[C[1]]);u.set(y,0,255*O[0]),u.set(y,1,255*O[1]),u.set(y,2,255*O[2]),u.set(y,3,255),p.set(y,C[0])}return new Wp(e,ar,{geometry:Kc(toe)},{geometry:xr.createVertex(e,dr.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(Qv!=null)return null;const e=Pv(async i=>{const{data:r}=await s6e("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});this._verifyStarData(r),Qv=r});return e.promise.catch(i=>{qn(i)||Ee.getLogger(this).error(i)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new de("stars:no-data-received","Failed to create stars because star catalogue is missing");const i=e.byteLength/eoe;if(i%1!=0||i>5e4||i<5e3)throw new de("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};_([T({constructOnly:!0})],ny.prototype,"view",void 0),_([T({constructOnly:!0})],ny.prototype,"requestRender",void 0),_([T({readOnly:!0})],ny.prototype,"updating",null),_([T()],ny.prototype,"_loadDataTask",void 0),_([T()],ny.prototype,"_updatingTracking",void 0),ny=_([Z("esri.views.3d.environment.Stars")],ny);const $Ze=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],LZe=aZ(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),DZe=aZ(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),eoe=9,toe=wn().vec3f(X.POSITION).vec4u8(X.COLOR).f32(X.SIZE);let Qv=null;const V7={required:[]},ixe={required:[oe.Depth]},rxe={required:[oe.CompositeColor]},nxe={required:[oe.Highlight]},NZe={required:[oe.Depth,oe.Normal]};let G7=class extends Ke{consumes(){return V7}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}},$w=class extends G7{},sxe=class extends G7{},FZe=class extends G7{},kZe=class extends G7{};var VT;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(VT||(VT={}));var U5;let ra=U5=class extends $w{constructor(t){super(t),this.produces=new Map([[De.ENVIRONMENT_OPAQUE,()=>!(this._atmosphere===null&&this._stars===null)],[De.ENVIRONMENT_TRANSPARENT,()=>this._atmosphere!==null]]),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new dk,this._newWeatherParameters=new dk,this._fadedWeatherParameters=new dk,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),this.view?._stage!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:Oa.None}consumes(){return this._atmosphereType===Oa.Realistic?ixe:V7}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Qe(this.view.state.camera.eye)-Mr(this.view.spatialReference).radius<=Ym}get usedMemory(){return this._clouds?.usedMemory??0}get _stars(){const t=this.view,e=t.environment?.starsEnabled??!1,i=this._get("_stars");return e&&this._context!=null?i??new ny({view:t,requestRender:()=>this._setNeedsRender()}):(ct(i),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return ct(t),null;const e=this.view,i=this._context;return t!=null&&t.context===i?t:(ct(t),new cb({context:i,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return ct(t),null;if(t!=null)return t;const e=this.view,i=this._context;return ct(t),new Fl({context:i,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return ct(t),null;const e=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=Mr(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===r?t:(ct(t),new ob({rctx:i,viewingMode:e,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return ct(t),null;if(t!=null)return t;const e=this.view,i=this._context,r=this._context.renderContext.rctx,n=this.view.state.viewingMode;return new ab({context:i,view:e,rctx:r,viewingMode:n})}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([Fe(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),i=>this._updateAtmosphere(i),Ur),Fe(()=>this._stars,e),Fe(()=>this._precipitation,e),Fe(()=>this._clouds,()=>this._updateWeather(),jr),Fe(()=>this._fog,()=>this._updateFogHaze(),jr),Fe(()=>this.view.state.mode,()=>{this._setNeedsRender()},$r),Fe(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Ur)])}uninitializeRenderContext(){this._context=null,this._atmosphere=ct(this._atmosphere),this._set("_stars",ct(this._stars)),this._set("_precipitation",ct(this._precipitation)),this._set("_clouds",ct(this._clouds)),this._set("_cloudsComposition",ct(this._cloudsComposition)),this._set("_fog",ct(this._fog))}prepareRender(t){t.bindParameters.cloudsFade.data=bJe(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&t.bindParameters.cloudsFade.data?.cubeMap!=null&&(this._updateWeatherFading(t.bindParameters,t.time),t.bindParameters.cloudsFade.renderingStage===l0.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}renderNode(t){switch(t.bindParameters.slot){case De.ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,this.view?._stage?.renderer?.fullResolutionAtmosphere),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),t.bindParameters.cloudsFade.isFading&&this._context!=null&&t.bindParameters.cloudsFade.data?.cubeMap!=null&&this._context.requestRender());break;case De.ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,this.view?._stage?.renderer?.fullResolutionAtmosphere),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation!=null)){const e=this.view.environment.weather;e.type!=="rainy"&&e.type!=="snowy"||this._precipitation.render(t,e.precipitation,e.type)}}}updateLightSources(t,e,i,r){if(this._context!=null){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=e,n.bindParameters.newLighting.globalFactor=i,n.bindParameters.newLighting.set(t),r===VT.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t,e){t.cloudsFade.updateFading(t.camera,this.view.state.mode,e,this.view.qualitySettings.fadeDuration),t.cloudsFade.updateParallax(t.camera),t.weatherFading&&(this._updateLighting(t),this._updateFogAtmoshpere(t))}_updateLighting(t){t.cloudsFade.fadeMode!==ln.CROSS_FADE&&t.cloudsFade.fadeMode!==ln.FADE_IN?t.fadeLighting(0):t.fadeLighting(t.cloudsFade.fadeFactor)}_updateFogAtmoshpere(t){t.cloudsFade.fadeMode!==ln.CROSS_FADE&&t.cloudsFade.fadeMode!==ln.FADE_IN?this._fadeWeather(0):this._fadeWeather(t.cloudsFade.fadeFactor)}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:i}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(i,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(Aa[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=si(3e-5,.005,t.weatherAdjustment**3),Ie(this._newWeatherParameters.fog.color,ioe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=si(4e-6,2e-4,(t.effect??0)**3),Ie(this._newWeatherParameters.fog.color,zZe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=si(4e-6,2e-4,(t.effect??0)**3),Ie(this._newWeatherParameters.fog.color,ioe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==Oa.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=ct(this._atmosphere);const i=this._getAtmosphereClass(e);i&&(this._atmosphere=new i(this.view,this._context))}}else this._atmosphere=ct(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case Oa.Realistic:return Sse;case Oa.Local:return dZe;case Oa.Mars:return yZe;default:case Oa.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:i}=t;return!e||D0(this.view.spatialReference)?Oa.None:i===ht.Local?Oa.Local:this._context!=null&&Sse.isSupported(this._context)&&oS(this.view.spatialReference)?Oa.Realistic:L0(this.view.spatialReference)?Oa.Mars:Oa.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{roe=U5.prototype._getAtmosphereClass,U5.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{U5.prototype._getAtmosphereClass=roe}}}};_([T({constructOnly:!0})],ra.prototype,"view",void 0),_([T({readOnly:!0})],ra.prototype,"atmosphere",null),_([T({readOnly:!0})],ra.prototype,"_atmosphereType",null),_([T({type:Boolean,readOnly:!0})],ra.prototype,"updating",null),_([T({readOnly:!0})],ra.prototype,"weatherVisible",null),_([T()],ra.prototype,"_context",void 0),_([T()],ra.prototype,"_atmosphere",void 0),_([T({readOnly:!0})],ra.prototype,"_stars",null),_([T({readOnly:!0})],ra.prototype,"_precipitation",null),_([T({readOnly:!0})],ra.prototype,"_clouds",null),_([T({readOnly:!0})],ra.prototype,"_cloudsComposition",null),_([T({readOnly:!0})],ra.prototype,"_fog",null),_([T({readOnly:!0})],ra.prototype,"weatherEnabled",null),_([T({readOnly:!0})],ra.prototype,"_precipitationEnabled",null),_([T({readOnly:!0})],ra.prototype,"_weatherUpdateParameters",null),ra=U5=_([Z("esri.views.3d.environment.EnvironmentRenderer")],ra);let dk=class{constructor(){this.fog=new OYe,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,Ie(this.fog.color,e.fog.color)}lerp(e,i,r){this.fog.amount=si(e.fog.amount,i.fog.amount,r),this.hazeAmount=si(e.hazeAmount,i.hazeAmount,r),this.fog.strength=si(e.fog.strength,i.fog.strength,r),Ir(this.fog.color,e.fog.color,i.fog.color,r)}};const zZe=st(.5,.5,.5),ioe=st(1.5,1.5,1.5);let roe;var F6t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function CE(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var noe,soe,ooe,VH={exports:{}};VH.exports,noe=VH,soe=function(){var t=Math.PI,e=Math.sin,i=Math.cos,r=Math.tan,n=Math.asin,s=Math.atan2,a=Math.acos,u=t/180,p=864e5,y=2440588,b=2451545,S={dec:0,ra:0};function C(ee){return ee.valueOf()/p-.5+y}function O(ee){return new Date((ee+.5-y)*p)}function P(ee){return C(ee)-b}var $=23.4397*u;function N(ee,re){return s(e(ee)*i($)-r(re)*e($),i(ee))}function z(ee,re){return n(e(re)*i($)+i(re)*e($)*e(ee))}function U(ee,re,fe){return s(e(ee),i(ee)*e(re)-r(fe)*i(re))}function j(ee,re,fe){return n(e(re)*e(fe)+i(re)*i(fe)*i(ee))}function G(ee,re){return u*(280.16+360.9856235*ee)-re}function q(ee){return u*(357.5291+.98560028*ee)}function W(ee){return u*(1.9148*e(ee)+.02*e(2*ee)+3e-4*e(3*ee))}function K(ee,re){return ee+re+102.9372*u+t}function se(ee,re){var fe=q(ee),ye=K(fe,W(fe));return re||(re={dec:0,ra:0}),re.dec=z(ye,0),re.ra=N(ye,0),re}var ae={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(ee,re,fe,ye){var we=u*-fe,Ae=u*re,Oe=P(ee),Ve=se(Oe,S),at=G(Oe,we)-Ve.ra;return ye||(ye={azimuth:0,altitude:0}),ye.azimuth=U(at,Ae,Ve.dec),ye.altitude=j(at,Ae,Ve.dec),ye}},le=[[-.83,"sunrise","sunset"]];ae.addTime=function(ee,re,fe){le.push([ee,re,fe])};var me=9e-4;function ne(ee,re){return Math.round(ee-me-re/(2*t))}function pe(ee,re,fe){return me+(ee+re)/(2*t)+fe}function ge(ee,re,fe){return b+ee+.0053*e(re)-.0069*e(2*fe)}function ve(ee,re,fe){return a((e(ee)-e(re)*e(fe))/(i(re)*i(fe)))}function Se(ee){var re=u*(134.963+13.064993*ee),fe=u*(93.272+13.22935*ee),ye=u*(218.316+13.176396*ee)+6.289*u*e(re),we=5.128*u*e(fe),Ae=385001-20905*i(re);return{ra:N(ye,we),dec:z(ye,we),dist:Ae}}return ae.getTimes=function(ee,re,fe){var ye=u*-fe,we=u*re,Ae=ne(P(ee),ye),Oe=pe(0,ye,Ae),Ve=q(Oe),at=W(Ve),Xt=K(Ve,at),ti=z(Xt,0),Vt=ge(Oe,Ve,Xt);function Qt(Tt){return ge(pe(ve(Tt,we,ti),ye,Ae),Ve,Xt)}function St(Tt){var Q=(e(Tt)-e(we)*e(ti))/(i(we)*i(ti));return Q<-1?ae.PolarException.MIDNIGHT_SUN:Q>1?ae.PolarException.POLAR_NIGHT:ae.PolarException.NORMAL}var ze,ni,Ye,gt,Nt,Jt={solarNoon:O(Vt),nadir:O(Vt-.5),polarException:ae.PolarException.NORMAL};for(ze=0,ni=le.length;ze<ni;ze+=1)Nt=Vt-((gt=Qt((Ye=le[ze])[0]*u))-Vt),Jt[Ye[1]]=O(Nt),Jt[Ye[2]]=O(gt);return Jt.polarException=St(le[0][0]*u),Jt},ae.getMoonPosition=function(ee,re,fe){var ye=u*-fe,we=u*re,Ae=P(ee),Oe=Se(Ae),Ve=G(Ae,ye)-Oe.ra,at=j(Ve,we,Oe.dec);return at+=.017*u/r(at+10.26*u/(at+5.1*u)),{azimuth:U(Ve,we,Oe.dec),altitude:at,distance:Oe.dist}},ae.getMoonFraction=function(ee){var re=P(ee),fe=se(re),ye=Se(re),we=149598e3,Ae=a(e(fe.dec)*e(ye.dec)+i(fe.dec)*i(ye.dec)*i(fe.ra-ye.ra)),Oe=s(we*e(Ae),ye.dist-we*i(Ae));return(1+i(Oe))/2},ae},(ooe=soe())!==void 0&&(noe.exports=ooe);const tw=CE(VH.exports),hl={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let nP=class{constructor(e,i){this.direct=e,this.ambient=i}};function UZe(t,e,i,r,n,s){$e(s.ambient.color,1,1,1),s.ambient.intensity=hl.global.ambient,$e(s.direct.color,1,1,1),s.direct.intensity=hl.global.direct;const a=e[2],u=Je((Math.abs(a)-hl.local.altitude)/(hl.global.altitude-hl.local.altitude),0,1);let p;if(s.globalFactor=u,t!=null&&(p=tw.getTimes(t,e[1],e[0])),u<1){let y;if(t!=null)y=WZe(t,p,r);else{const b=lxe(r);y={direct:{intensity:hl.local.directAtNoon*b.direct,color:st(1,1,1)},ambient:{intensity:hl.local.ambientAtNoon*b.ambient,color:st(1,1,1)},timeOfDay:"early afternoon"}}Ir(s.ambient.color,y.ambient.color,s.ambient.color,u),s.ambient.intensity=si(y.ambient.intensity,s.ambient.intensity,u),Ir(s.direct.color,y.direct.color,s.direct.color,u),s.direct.intensity=si(y.direct.intensity,s.direct.intensity,u),s.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,s.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}s.noonFactor=t!=null?qZe(t,p):1,t!=null?jZe(t,e,i,s.direct.directionToLightSource):oxe(n,i,s.direct.directionToLightSource)}function oxe(t,e,i){e===ht.Global?We(gk,t.eye):$e(gk,0,0,1),Pe(yk,t.viewForward,-1);const r=QI(yk,gk),n=Math.max(r-2*vk,0),s=.85*n/(n+1),a=Math.max(vk,r-vk-s);Zu(yoe,-a,t.viewRight),wt(i,yk,yoe),Ue(i,i,Pe(XZe,t.viewRight,JZe)),We(i,i)}function jZe(t,e,i,r){const n=HZe,s=id(GZe);if(i===ht.Global)tw.getPosition(t,0,0,n),$e(r,0,0,-1),dS(s,s,-n.azimuth),FD(s,s,-n.altitude),wt(r,r,s);else{const a=hl.planarDirection,u=a.globalAngles,p=e[2];let y=(Math.abs(p)-a.localAltitude)/(a.globalAltitude-a.localAltitude);y=Je(y,0,1),y<1?(tw.getPosition(t,e[1],e[0],n),n.azimuth=(1-y)*n.azimuth+y*u.azimuth,n.altitude=(1-y)*n.altitude+y*u.altitude):(n.azimuth=u.azimuth,n.altitude=u.altitude),$e(r,0,-1,0),pS(s,s,-n.azimuth),dS(s,s,-n.altitude),wt(r,r,s)}}function BZe(t,e){if(e===ht.Global)return!0;const i=hl.planarDirection;return Math.abs(t)<i.localAltitude}const VZe=st(.5773502691896258,-.5773502691896258,.5773502691896258);let axe=class{constructor(){this.ambient={color:st(1,1,1),intensity:.55},this.direct={color:st(1,1,1),intensity:.55,directionToLightSource:An(VZe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const GZe=Ze(),HZe={azimuth:0,altitude:0};function qZe(t,e){const i=t.valueOf();let r,n;e.polarException===tw.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=r+432e6):e.polarException===tw.PolarException.POLAR_NIGHT?(r=i-2,n=i-1):(r=e.sunrise.valueOf(),n=e.sunset.valueOf());const s=r+(n-r)/2;return 1-Je(Math.abs(i-s)/432e5,0,1)}function lxe(t){switch(t){case"disabled":case"sunny":case"cloudy":return new nP(1,1);case"rainy":return new nP(.4,1.2);case"snowy":return new nP(.5,1.3);case"foggy":return new nP(.2,1.6)}}function aoe(t,e){const i=(t[0]+t[1]+t[2])/3;t[0]+=(i-t[0])*e,t[1]+=(i-t[1])*e,t[2]+=(i-t[2])*e}const pk=st(.01,.01,.01),GH=st(1,.6,.5),HH=st(1,.98,.98),loe=st(1,1,1),fk=st(.8,.8,1),qH=st(.8,.8,1),WH=st(.98,.98,1),coe=st(1,1,1),mk=Xi(.01,hl.local.ambientAtNight),XH=Xi(hl.local.directAtTwilight,hl.local.ambientAtTwilight),JH=Xi(.9*hl.local.directAtNoon,hl.local.ambientAtNoon),uoe=Xi(hl.local.directAtNoon,hl.local.ambientAtNoon),hoe=JH,doe=HH,poe=WH,foe=XH,moe=GH,goe=qH;function WZe(t,e,i){const r=t.valueOf();let n,s;e.polarException===tw.PolarException.MIDNIGHT_SUN?(n=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=n+432e6):e.polarException===tw.PolarException.POLAR_NIGHT?(n=r-2,s=r-1):(n=e.sunrise.valueOf(),s=e.sunset.valueOf());const a=s-n,u=n+a/2,p=a/4,y=u-p,b=u+p,S=.06*a,C=n-S/2,O=n+S/2,P=s-S/2,$=s+S/2,N=Ct(),z=H(),U=H();let j="";if(r<C||r>$)$s(N,mk),Ie(z,pk),Ie(U,fk),j="night";else if(r<O){const W=(r-C)/(O-C);Fh(N,mk,XH,W),Ir(z,pk,GH,W),Ir(U,fk,qH,W),j="sun rising"}else if(r<y){const W=(r-O)/(y-O);Fh(N,XH,JH,W),Ir(z,GH,HH,W),Ir(U,qH,WH,W),j="early morning"}else if(r<u){const W=(r-y)/(u-y);Fh(N,JH,uoe,W),Ir(z,HH,loe,W),Ir(U,WH,coe,W),j="late morning"}else if(r<b){const W=(r-u)/(b-u);Fh(N,uoe,hoe,W),Ir(z,loe,doe,W),Ir(U,coe,poe,W),j="early afternoon"}else if(r<P){const W=(r-b)/(P-b);Fh(N,hoe,foe,W),Ir(z,doe,moe,W),Ir(U,poe,goe,W),j="late afternoon"}else if(r<$){const W=(r-P)/($-P);Fh(N,foe,mk,W),Ir(z,moe,pk,W),Ir(U,goe,fk,W),j="sun setting"}let G=0;switch(i){case"rainy":case"foggy":G=.8;break;case"snowy":G=.5}G>0&&(aoe(z,G),aoe(U,G));const q=lxe(i);return{direct:{intensity:N[0]*q.direct,color:z},ambient:{intensity:N[1]*q.ambient,color:U},timeOfDay:j}}const yoe=Ze(),gk=H(),yk=H(),XZe=H(),vk=.25,JZe=.2;let kd=class extends Xn.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandlesKey="viewHandles",this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new VL,this._ambientLight=new aK,this._moonLight=new p3e,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===ht.Global&&oS(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new ra({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this.addHandles([Fe(()=>e.environment.lighting,n=>this._updateLightingHandler(n),$r),Fe(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,n=>this._lightingDateHandler(n),$r),Fe(()=>e.stationary,()=>this._interactingStationaryHandler()),Fe(()=>e.environment.lighting.directShadowsEnabled,i,$r),Fe(()=>e.qualitySettings.ambientOcclusion,i,$r),Fe(()=>e.qualitySettings.reflections,i,$r),Fe(()=>e.spatialReference,()=>this._resetReferencePosition(!0),$r),Fe(()=>e.environment.weather.type,()=>this._updateLighting(null,VT.Faded),$r),Fe(()=>this.weatherEnabled,()=>this._updateLighting(null,VT.Faded),$r),Fe(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Ur),Fe(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,n=>this._updateCameraTracking(n),Ur),Fe(()=>e.state.camera,r,Ur),Fe(()=>this.disableQueries,r)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=ct(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;i?.type!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if(i?.type!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!uv(r)){const n=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(n))return void this._requestReferencePositionUpdate(n)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const n=kne(this._referencePosWGS84Comparable,voe);n!=null&&(i.autoUpdate(null,n),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,i){const r=oS(this._view.spatialReference);if(r&&!uv(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const n=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=H()),r?SWe(n,this._referencePosWGS84Comparable):$e(this._referencePosWGS84Comparable,n.longitude??0,n.latitude??0,n.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,i)||this._updateLighting(i),!0}_cameraHandlerServerSide(e){const i=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(i))&&this._requestReferencePositionUpdate(i,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(i.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,i=VT.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const n=this._referencePosWGS84Comparable,s=n!=null?YZe:ZZe,a=this.weatherVisible?r.environment.weather.type:"disabled";n!=null?UZe(e,n,r.state.viewingMode,a,r.state.camera,s):r.environment.lighting.type==="virtual"&&oxe(r.state.camera,r.state.viewingMode,s.direct.directionToLightSource);const u=this._mainLight,p=s.direct;Pe(u.intensity,p.color,p.intensity*Math.PI),Ie(u.direction,p.directionToLightSource),u.specularStrength=s.specularStrength,u.environmentStrength=s.environmentStrength;const y=this._ambientLight;Pe(y.intensity,s.ambient.color,s.ambient.intensity);const b=this._moonLight;Ir(b.intensity,QZe,eKe,s.globalFactor);const S=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));Pe(b.intensity,b.intensity,S),Ie(b.direction,p.directionToLightSource),this._renderer.updateLightSources([u,y,b],s.noonFactor,s.globalFactor,i),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=KZe;r.setTime((i||this._view.environment.lighting.date).getTime());const n=kne(e,voe);if(n==null)return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===n.hours&&s.minutes===n.minutes&&s.seconds===n.seconds)return!1}else s=n;const a=r.getUTCHours()-(n.hours-s.hours),u=r.getUTCMinutes()-(n.minutes-s.minutes),p=r.getUTCSeconds()-(n.seconds-s.seconds);return r.setUTCHours(a),r.setUTCMinutes(u),r.setUTCSeconds(p),!i&&this._view.environment.lighting.autoUpdate(r,n)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const i=this._referencePosWGS84Comparable==null||BZe(this._referencePosWGS84Comparable[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,i=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!i,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=R4(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const s=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),n=this._referencePosUpdateTimer=R4(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===n&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const i=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(i[0])&&!isNaN(i[1])){const r=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=i[0],this._referencePosWGS84Comparable[1]=i[1],this._referencePosWGS84Comparable[2]=r):this._referencePosWGS84Comparable=[i[0],i[1],r],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let i=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(i*=this._view.mapCoordsHelper.unitInMeters),i>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(i){e._referencePointUpdateInterval=i},set referencePointUpdateDistThreshold(i){e._referencePointUpdateDistThreshold=i},set referencePosUpdateTimer(i){e._referencePosUpdateTimer=i},set referencePointUpdateDelay(i){e._referencePointUpdateDelay=i},set disableWeather(i){e._disableWeather=i}}}};_([T({type:Boolean,readOnly:!0})],kd.prototype,"updating",null),_([T()],kd.prototype,"disableQueries",void 0),_([T()],kd.prototype,"_disableWeather",void 0),_([T()],kd.prototype,"weatherEnabled",null),_([T()],kd.prototype,"weatherVisible",null),_([T()],kd.prototype,"referencePositionWGS84Comparable",null),_([T()],kd.prototype,"_renderer",void 0),_([T()],kd.prototype,"_referencePosWGS84Comparable",void 0),kd=_([Z("esri.views.3d.environment.SceneViewEnvironmentManager")],kd);const YZe=new axe,ZZe=new axe,KZe=new Date,voe={hours:0,minutes:0,seconds:0},QZe=st(.22,.22,.33),eKe=st(.22,.22,.22);var mn;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(mn||(mn={}));var Ni;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(Ni||(Ni={}));var Po;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(Po||(Po={}));function oO(t,e){return(t&e)!=0}function JL(t,e,i,r,n,s){t!==0&&(i?(s.min=Math.min(s.min,e),s.max=Math.max(s.max,e)):r!=null?(s.min-=Math.max(0,(e-s.min)*(1-r)),s.max+=Math.max(0,(e-s.max)*(1-r))):n&&(s.min-=Math.max(0,e-s.min-n),s.max+=Math.max(0,e-s.max-n)))}const wv={selection:mn.NONE,interactionType:Ni.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Po.TUMBLE};function cxe(t,e,i,r){return e=e||t.viewForward,Ie(r,e),Pe(r,r,Math.sign(He(e,i))),r}function tKe(t,e,i,r){return oKe(t,e,i,nKe(r,e,i,!0))}function iKe(t,e,i,r){const n=He(i,Be(t,r,e));return Ue(t,e,Pe(t,i,n))}const rKe={dir:H(),len:0,clip:Ct()};function nKe(t,e,i,r){const n=rKe;return t?(i&&r&&(n.len=un(e,i)),Ie(n.dir,t)):r?(n.len=un(e,i),Be(n.dir,i,e),Pe(n.dir,n.dir,1/n.len)):(Be(n.dir,i,e),We(n.dir,n.dir)),n}function sKe(t,e,i){const r=He(t,i.dir),n=-qr(t,e);if(n<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return n>0;if((n<0||r<0)&&!(n<0&&r<0))return!0;const s=n/r;return r>0?s<i.clip[1]&&(i.clip[1]=s):s>i.clip[0]&&(i.clip[0]=s),i.clip[0]<=i.clip[1]}function oKe(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let n=0;n<t.length;n++)if(!sKe(t[n],e,r))return!1;return!0}function aKe(t,e,i=wv){const r=bK(t,e,i);if(r===0)return!1;const n=t.renderCoordsHelper,s=n.getAltitude(e.eye)+r,a=cxe(e,i.interactionDirection,uKe(t,e,Math.sign(r),fKe),pKe),u=Ie(mKe,e.viewForward),p=n.intersectInfiniteManifold(eh(e.eye,a),s,_k);return e.eye=p??n.setAltitude(_k,s,e.eye),e.center=iKe(_k,e.eye,u,e.center),!0}function bK(t,e,i=wv){if(!lKe(t,i)||!t.state.constraints.altitude)return 0;const r=hKe(t.state.constraints.altitude,dKe);cKe(t,i,r);const n=t.renderCoordsHelper.getAltitude(e.eye),s=Je(n,r.min,r.max)-n;return Math.abs(s)<=1e-6?0:s}function lKe(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==Ni.TUMBLE||!oO(e.selection,mn.TILT))}function cKe(t,e,i){const r=e.interactionType;if(r===Ni.NONE)return;const{min:n,max:s}=i,{interactionStartCamera:a,interactionFactor:u}=e;if(!a)return;const p=r===Ni.TUMBLE||r===Ni.ZOOM,y=bK(t,a),b=y===0?0:t.renderCoordsHelper.getAltitude(a.eye);i.min=n,i.max=s,JL(y,b,p,u,.05*b,i)}function uKe(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),Pe(r,r,i),r}function hKe(t,e){return e.min=t.min,e.max=t.max,e}const dKe={min:0,max:0},pKe=H(),fKe=H(),mKe=H(),_k=H();function wK(t,e,i=wv){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;sP.min=0,sP.max=r,yKe(t,i,sP);const n=xK(t,e),s=sP.max-n;return s>=-1e-6?0:s}function gKe(t,e,i=wv){const r=wK(t,e,i);if(r===0)return!1;const n=t.pointsOfInterest.surfaceOrigin;if(!n.renderLocation)return!1;const s=xK(t,e)+r,a=Ie(_Ke,e.eye),u=cxe(e,i.interactionDirection,vKe(e,n.renderLocation,xKe),wKe);if(!Fv(ebe(n.renderLocation,s),eh(e.eye,u),oP))return!1;e.eye=oP;const p=Be(bKe,e.eye,a);e.center=Ue(oP,e.center,p);const y=t.renderCoordsHelper.getAltitude(e.center),b=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,y,oP);return b!=null&&(e.center=b),!0}function yKe(t,e,i){const r=e.interactionType;if(r===Ni.NONE)return;const{min:n,max:s}=i,{interactionStartCamera:a,interactionFactor:u}=e;if(!a)return;const p=r===Ni.ZOOM||r===Ni.PAN,y=wK(t,a),b=y===0?0:xK(t,a);i.min=n,i.max=s,JL(y,b,p,u,.05*b,i)}function xK(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?un(e.eye,i.renderLocation):0}function vKe(t,e,i){return Ng(i,t.eye,e)}const sP={min:0,max:0},_Ke=H(),bKe=H(),wKe=H(),xKe=H(),oP=H();function AE(t,e,i=Hh.EYE){const r=t.state.constraints;if(!r.collision.enabled)return!1;const n=C7(t,e.eye),s=t.renderCoordsHelper.getAltitude(e.eye),a=n+r.collision.elevationMargin;if(s>=a)return!1;const u=Qe(e.eye);if(Be(aP,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(TKe,a,e.eye),i===Hh.EYE_AND_CENTER)e.center=Ue(aP,e.eye,aP);else if(i===Hh.EYE_AND_CENTER_SCALE){const p=(u-s+a)/u;e.center=Pe(aP,e.center,p)}return!0}var Hh;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Hh||(Hh={}));const aP=H(),TKe=H();function xv(t,e,i){t.worldUpAtPosition(e,_oe),Be(bk,i,e);const r=Qe(bk);return r===0?0:co(He(bk,_oe)/r)}const _oe=H(),bk=H();function uxe(t,e,i=wv,r=!0){cC.eyeCenterDistance=0,cC.requiresTwoSteps=!1;const n=TK(t,e,i,void 0,cC);if(n===0)return!1;switch(Zu(lP,-n,e.viewRight),i.tiltMode){case Po.LOOK_AROUND:wt(p1,e.viewForward,lP),Pe(p1,p1,cC.eyeCenterDistance),e.center=Ue(Cy,e.eye,p1);break;case Po.TUMBLE:Be(p1,e.center,e.eye),wt(p1,p1,lP),e.eye=Be(Cy,e.center,p1);break;default:i.tiltMode}return e.up=wt(Cy,e.up,lP),!cC.requiresTwoSteps||!r||uxe(t,e,i,!1)}function TK(t,e,i=wv,r=wv,n){if(!t.state.constraints.tilt)return 0;const s=e.distance,a=t.state.constraints.tilt(s,$Ke);return IKe(t,i,a),r.interactionType===Ni.TUMBLE&&oO(r.selection,mn.ALTITUDE)&&hxe(t,r.interactionStartCamera,a),i.tiltMode===Po.LOOK_AROUND||r.tiltMode===Po.LOOK_AROUND?EKe(t,e,a,n):SKe(t,e,a)}function SKe(t,e,i){const r=xv(t.renderCoordsHelper,e.center,e.eye),n=r-Je(r,i.min,i.max);return aO(n)?n:0}function EKe(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return AKe(t,e,i,r);case"local":return CKe(t,e,i,r)}}function CKe(t,e,i,r){const n=xv(t.renderCoordsHelper,e.center,e.eye),s=Je(n,i.min,i.max),a=n-s;if(!aO(a))return 0;if(r){const u=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,p=t.renderCoordsHelper.getAltitude(e.eye)-u,y=Math.cos(s);Math.abs(y)>1e-4?r.eyeCenterDistance=p/y:r.eyeCenterDistance=e.distance}return a}function AKe(t,e,i,r){const n=OKe(t,e,LKe),s=Je(n.tiltAtCenter,i.min,i.max);if(!aO(n.tiltAtCenter-s))return 0;let a,u;return n.centerIsOnSurface?(a=RKe(n),u=MKe(n,a)):(a=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),r&&a<Math.PI/2&&(r.requiresTwoSteps=!0,a=Math.PI/2-1e-5),u=PKe(n,a)),r&&(r.eyeCenterDistance=YH(n,a)),u}function OKe(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=r+Mr(t.spatialReference).radius,s=t.renderCoordsHelper.intersectManifold(e.ray,r,Cy);return i.eyeCenterDistance=e.distance,i.centerIsOnSurface=!1,s!=null?(i.eyeCenterDistance=un(e.eye,s),i.tiltAtCenter=xv(t.renderCoordsHelper,s,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=xv(t.renderCoordsHelper,e.center,e.eye):(bE(p7(f7,n),e.ray,Cy),i.eyeCenterDistance=un(e.eye,Cy),i.tiltAtCenter=co(-He(e.viewForward,We(Cy,Cy)))),i.radius=n,i.eyeRadius=Qe(e.eye),i.constraints=t.state.constraints,i}function aO(t){return Math.abs(t)>1e-9}function RKe(t){const{constraints:e,eyeCenterDistance:i,tiltAtCenter:r}=t;let n=r,s=e.clampTilt(i,r);const a=YH(t,s);if(e.clampTilt(a,r)===s)return s;let u=0;for(;u<10&&aO(s-n);){const p=(n+s)/2,y=YH(t,p);aO(e.clampTilt(y,p)-p)?n=p:s=p,u++}return s}function YH(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const i=Math.PI-Je(e,0,Math.PI),r=Qh(t.radius/t.eyeRadius*Math.sin(i)),n=Math.PI-i-r,s=Math.sin(n)/Math.sin(i);if(t.eyeRadius<t.radius&&s>1){const a=Math.PI-r,u=Math.PI-i-a;return Math.sin(u)/Math.sin(i)*t.eyeRadius}return s*t.eyeRadius}function MKe(t,e){const i=Qh(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=Qh(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function PKe(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function IKe(t,e,i){if(e.interactionType===Ni.NONE)return;const{interactionStartCamera:r,interactionFactor:n}=e;if(!r)return;const{min:s,max:a}=i,u=TK(t,r,wv,e),p=u===0?0:xv(t.renderCoordsHelper,r.center,r.eye);i.min=s,i.max=a,e.interactionType===Ni.TUMBLE?(oO(e.selection,mn.ALTITUDE)&&hxe(t,r,i),JL(u,p,!0,n,boe,i)):JL(u,p,!1,n,boe,i)}function hxe(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const n=ha(e.center),s=Math.sqrt(n),a=e.distance,u=Mr(t.spatialReference).radius,p=r.altitude.min+u,y=r.altitude.max+u,b=(p*p-a*a-n)/(-2*s*a),S=(y*y-a*a-n)/(-2*s*a);i.min=Math.max(i.min,Math.min(Math.PI-co(S),i.max)),i.max=Math.min(i.max,Math.PI-co(b))}const p1=H(),lP=Ze(),Cy=H(),boe=gi(5),$Ke={min:0,max:0},LKe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},cC={eyeCenterDistance:0,requiresTwoSteps:!1},DKe=t=>t,H7=t=>t*t,SK=t=>1-H7(1-t),NKe=t=>t<.5?H7(2*t)/2:(SK(2*(t-.5))+1)/2,EK=t=>t*t*t,dxe=t=>1-EK(1-t),pxe=t=>t<.5?EK(2*t)/2:(dxe(2*(t-.5))+1)/2,CK=t=>t*t*t*t,fxe=t=>1-CK(1-t),FKe=t=>t<.5?CK(2*t)/2:(fxe(2*(t-.5))+1)/2,AK=t=>t*t*t*t*t,mxe=t=>1-AK(1-t),kKe=t=>t<.5?AK(2*t)/2:(mxe(2*(t-.5))+1)/2,OK=t=>1-Math.cos(t*Math.PI/2),gxe=t=>1-OK(1-t),zKe=t=>t<.5?OK(2*t)/2:(gxe(2*(t-.5))+1)/2,RK=t=>2**(10*(t-1)),yR=t=>1-RK(1-t),UKe=t=>t<.5?RK(2*t)/2:(yR(2*(t-.5))+1)/2,MK=t=>-(Math.sqrt(1-t*t)-1),yxe=t=>1-MK(1-t),jKe=t=>t<.5?MK(2*t)/2:(yxe(2*(t-.5))+1)/2;function md(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function gd(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const BKe=gd(md(1),1),VKe=gd(md(1),0),vxe=gd(md(1),.5),GKe=gd(md(2),1),HKe=gd(md(2),0),qKe=gd(md(2),.5),WKe=gd(md(3),1),XKe=gd(md(3),0),JKe=gd(md(3),.5),YKe=gd(md(4),1),ZKe=gd(md(4),0),KKe=gd(md(4),.5),QKe={linear:DKe,"in-quad":H7,"out-quad":SK,"in-out-quad":NKe,"in-coast-quad":BKe,"out-coast-quad":VKe,"in-out-coast-quad":vxe,"in-cubic":EK,"out-cubic":dxe,"in-out-cubic":pxe,"in-coast-cubic":GKe,"out-coast-cubic":HKe,"in-out-coast-cubic":qKe,"in-quart":CK,"out-quart":fxe,"in-out-quart":FKe,"in-coast-quart":WKe,"out-coast-quart":XKe,"in-out-coast-quart":JKe,"in-quint":AK,"out-quint":mxe,"in-out-quint":kKe,"in-coast-quint":YKe,"out-coast-quint":ZKe,"in-out-coast-quint":KKe,"in-sine":OK,"out-sine":gxe,"in-out-sine":zKe,"in-expo":RK,"out-expo":yR,"in-out-expo":UKe,"in-circ":MK,"out-circ":yxe,"in-out-circ":jKe};function ys(t,e,i=rQe,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let n=!1;for(let u=0;u<nQe;u++){let p=0;for(const y of iQe)if(oO(i.selection,y.type)){const b=Math.abs(y.error(t,r,i));y.apply(t,r,i)&&(n=!0,p+=b)}if(p===0)break}const s=oO(i.selection,mn.COLLISION),a=eQe(i.interactionType,t);return s&&AE(t,r,a)&&(n=!0),n&&r.computeUp(t.state.viewingMode),n}function eQe(t,e){switch(t){case Ni.PAN:return Hh.EYE_AND_CENTER;case Ni.ASCEND:return e.state.isGlobal?Hh.EYE_AND_CENTER_SCALE:Hh.EYE_AND_CENTER;default:return Hh.EYE}}function up(t){const e=Math.min(1,t/150);return pxe(e)}function tQe(t,e,i){return TK(t,e,i)*e.distance}const iQe=[{type:mn.TILT,error:tQe,apply:uxe},{type:mn.ALTITUDE,error:bK,apply:aKe},{type:mn.DISTANCE,error:wK,apply:gKe}],rQe={selection:mn.ALL,interactionType:Ni.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Po.TUMBLE},nQe=5,tu=H(),sc=H(),f1=H(),wa=H(),e_=H(),sQe=H(),iu={upward:st(0,0,1),forward:st(0,1,0),sideway:st(1,0,0)},woe=Pn();let xoe=class{constructor(e=ht.Global){this.viewingMode=e,this.center=H(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=An(iu.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===ht.Global){const s=(Qe(this.center)+Qe(e.center))/2;i.pan=QI(this.center,e.center)*s}else i.pan=un(this.center,e.center);let r=Math.abs(e.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const n=Math.abs(e.pitch-this.pitch);return i.rotate=Math.max(r,n),i.sourceZoom=this.distance,i.targetZoom=e.distance,i}interpolate(e,i,r){this.viewingMode===ht.Global?TBe(e.center,i.center,r.pan,this.center):Ir(this.center,e.center,i.center,r.pan),this.distance=isFinite(i.distance)?si(e.distance,i.distance,r.zoom):e.distance,this.pitch=si(e.pitch,i.pitch,r.rotate);let n=e.yaw;const s=i.yaw;Math.abs(s-n)>=Math.PI&&(n+=2*(n<s?1:-1)*Math.PI),this.yaw=si(n,s,r.rotate)}copyFrom(e){Ie(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,Ie(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,woe);Ie(this.center,e.center),Be(wa,e.center,e.eye),Lc(wa,wa,i),Lc(e_,e.up,i),this.distance=Qe(wa),this.distance!==0&&(wa[0]/=this.distance,wa[1]/=this.distance,wa[2]/=this.distance),this.pitch=this._eyeUpToPitch(wa),this.yaw=this._eyeUpToYaw(wa,e_),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,woe);od(i,i),this._axisAngleVec3(iu.sideway,this.pitch-Math.PI/2,iu.forward,wa),this._axisAngleVec3(iu.upward,this.yaw,wa),this._axisAngleVec3(iu.sideway,this.pitch-Math.PI/2,iu.upward,e_),this._axisAngleVec3(iu.upward,this.yaw,e_),Pe(wa,wa,this.distance),Lc(wa,wa,i),Lc(e_,e_,i),e.center=this.center,e.eye=Be(wa,this.center,wa),e.up=e_}_axisAngleVec3(e,i,r,n=r){const s=Math.cos(i),a=Math.sin(i);return Pe(tu,r,s),qt(sc,e,r),Pe(sc,sc,a),Pe(f1,e,(1-s)*He(e,r)),Ue(n,Ue(n,tu,sc),f1)}_lookAtOrientation(e,i=Pn()){return this._upAtLookAt(e,f1),qt(tu,this.lookAtDirection,f1),We(tu,tu),tu[0]===0&&tu[1]===0&&tu[2]===0&&Ie(tu,iu.sideway),qt(sc,f1,tu),We(sc,sc),i[0]=tu[0],i[1]=sc[0],i[2]=f1[0],i[3]=tu[1],i[4]=sc[1],i[5]=f1[1],i[6]=tu[2],i[7]=sc[2],i[8]=f1[2],i}_upAtLookAt(e,i){return this.viewingMode===ht.Local?Ie(i,iu.upward):We(i,e)}_eyeUpToPitch(e){return Math.PI-QI(iu.upward,e)}_eyeUpToYaw(e,i){const r=sQe;return Math.abs(i[2])<.5?(Ie(r,i),e[2]>0&&Pe(r,r,-1)):Ie(r,e),qt(sc,r,iu.upward),We(sc,sc),QI(iu.sideway,sc,iu.upward)}};const YL={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let oQe=class _xe{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:YL.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new _xe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:YL.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},aQe=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,n=0;const s=this.definition;for(let a=0;a<this.segments.length;a++){const u=this.segments[a],p=u.definition;if(e<=u.time||a===this.segments.length-1){if(i=this.segmentInterpolateComponentsAt(u,u.time===0?0:e/u.time,i),s.hasPan&&!isNaN(i.pan)&&isFinite(s.compared.pan)?i.pan=(r+p.compared.pan*i.pan)/s.compared.pan:i.pan=1,s.hasRotate&&!isNaN(i.rotate)&&isFinite(s.compared.rotate)?i.rotate=(n+p.compared.rotate*i.rotate)/s.compared.rotate:i.rotate=1,s.hasZoom&&!isNaN(i.zoom)&&isFinite(p.compared.targetZoom)){const y=i.zoom*(p.compared.targetZoom-p.compared.sourceZoom)+p.compared.sourceZoom,b=this.segments[0].definition.compared.sourceZoom,S=this.segments[this.segments.length-1].definition.compared.targetZoom;i.zoom=(y-b)/(S-b)}else i.zoom=1;return i}e-=u.time,r+=p.compared.pan,n+=p.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){return e.interpolateComponentsAt(i,r)}},wk=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,n=i.targetZoom;this._zoomSign=r>n?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const s=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(n))/2;this._rotatePixels=i.rotate*s}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:n,hasRotate:s}=this.definition;let a=0,u=0;r&&(n&&(a=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(u=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const p=this.definition.desiredPixelFlow;if(r&&n&&s){const y=a+u+a*u;this._zoomPixelFlow=a*u/y*p,this._panPixelFlow=u/y*p,this._rotatePixelFlow=a/y*p}else if(r&&n){const y=1+a;this._zoomPixelFlow=a/y*p,this._panPixelFlow=1/y*p}else if(r&&s){const y=1+u;this._zoomPixelFlow=u/y*p,this._rotatePixelFlow=1/y*p}else if(n&&s){const y=this._panPixelsAtSource/this._rotatePixels,b=1+y;this._panPixelFlow=y/b*p,this._rotatePixelFlow=1/b*p}else n?this._panPixelFlow=p:r?this._zoomPixelFlow=p:s&&(this._rotatePixelFlow=p);this._time=s?this.rotateTime:r?this.zoomTime:n?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1);const r=this._interpolateComponentsZoom(e),n=this._interpolateComponentsPan(e),s=this._interpolateComponentsRotate(e);return i?(i.zoom=r,i.pan=n,i.rotate=s):i={zoom:r,pan:n,rotate:s},i}};function lQe(t,e,i){const r=e-t.compared.sourceZoom,n=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+n)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*n)}function cQe(t,e,i){const r=1/e,n=Math.log(t.compared.sourceZoom*r),s=1/t.desiredPixelFlow,a=1/Math.LN2,u=e-t.compared.sourceZoom,p=1/u,y=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(u))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*s*a*p*y-t.halfWindowSize*n*s*a*p+t.halfWindowSize*n*s*a*y/(u*u)}function uQe(t,e,i){const r=e-t.compared.sourceZoom,n=1/r,s=1/e,a=Math.log(t.compared.sourceZoom*s),u=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*u+2*n*a+2*s-2*a*u/(r*r)-u/(e*e))/(t.desiredPixelFlow*Math.LN2)}function hQe(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function dQe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function pQe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function fQe(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function mQe(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function gQe(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function yQe(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function vQe(t,e,i){const r=Math.log(e/t.compared.targetZoom),n=1/t.desiredPixelFlow,s=1/Math.LN2,a=-e+t.compared.targetZoom,u=1/a,p=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*n*s*u+t.halfWindowSize*r*n*s*p/(a*a)+t.halfWindowSize*n*s*u*p/e}function _Qe(t,e,i){const r=e-t.compared.targetZoom,n=1/r,s=1/e,a=Math.log(e/t.compared.targetZoom),u=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*u-2*n*a+2*s+2*a*u/(r*r)-u/(e*e))/(t.desiredPixelFlow*Math.LN2)}function bQe(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function wQe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function xQe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function TQe(t){const e=Math.LN2*t.compared.pan,i=t.compared.sourceZoom-t.compared.targetZoom,r=t.halfWindowPanAtZoom(i),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*r);return t.compared.sourceZoom<=t.compared.targetZoom?n*(e-r):n*(e+r)}function SQe(t,e){let i=EQe(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},n=r.ascensionFactor===0,s=r.descensionFactor===0,a=n?hQe:lQe,u=n?dQe:cQe,p=n?pQe:uQe,y=s?bQe:yQe,b=s?wQe:vQe,S=s?xQe:_Qe,C=G=>a(t,G,r)+fQe(t,G,r)+y(t,G,r),O=G=>u(t,G,r)+mQe(t,G,r)+b(t,G,r),P=G=>p(t,G,r)+gQe(t,G,r)+S(t,G,r);let $=C(i);const N=TQe(t);let z;const U=e.maximumIterations||20,j=e.maximumDistance!=null?e.maximumDistance:1/0;for(z=0;z<U;z++){const q=(O(i)+1e-6)/P(i);if(isNaN(q)||i>=j&&q<0){if(!isFinite(j))return null;i=j,$=C(i);break}if(i-=q,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const W=C(i);if(Math.abs(W-$)/$<=.005)break;$=W}return $>N*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function EQe(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let CQe=class extends aQe{constructor(e,i){super(),this._preallocSegments=[new wk,new wk,new wk],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let r=null;i?.apex&&(r=SQe(e,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i?.apex)}segmentInterpolateComponentsAt(e,i,r){return r=e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=SK(r.zoom):e===this._descensionSegment&&(r.zoom=H7(r.zoom)),r}_updateWithApex(e,i){const[r,n,s]=this._preallocSegments,a=i?.ascensionFactor??.5,u=Math.min(1-a,i?.ascensionFactor!=null&&i.descensionFactor!=null?i.descensionFactor:.5),p=1-a-u;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*a,r.definition.compared.rotate=this.definition.compared.rotate*a,r.update(),this._ascensionSegment=r,this.segments.push(r),p>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=e,n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*p,n.definition.compared.rotate=this.definition.compared.rotate*p,n.update(),this.segments.push(n)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=e,s.definition.compared.pan=this.definition.compared.pan*u,s.definition.compared.rotate=this.definition.compared.rotate*u,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const AQe={zoom:0,pan:0,rotate:0};let OQe=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new oQe(e),this.path=new CQe}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(M0e(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing??(this._time>=1e3?vxe:yR)}cameraAt(e,i){i=i||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,AQe);return i.interpolate(this.definition.source,this.definition.target,r),i}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1;i.duration!=null?e=i.duration:i.speedFactor!=null&&(e=e/r);const n=i.minDuration!=null?i.minDuration:YL.minDuration/r,s=i.maxDuration!=null?i.maxDuration:YL.maxDuration/r;return Math.min(Math.max(n,e),s)}};const RQe=H();let MQe=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new OQe(()=>new xoe(e)),this._current=new xoe(e)}update(e,i,r){const n=this._animation.definition.source,s=this._animation.definition.target,a=Be(RQe,i.center,e.center),u=Qe(a);u>=1e-5?(a[0]/=u,a[1]/=u,a[2]/=u):(a[0]=0,a[1]=1,a[0]=0),Ie(n.lookAtDirection,a),Ie(s.lookAtDirection,a),n.copyFromRenderCamera(e),s.copyFromRenderCamera(i),this._current.copyFrom(n),this._animation.update(n,s,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){return this._animation.cameraAt(e,this._current),i=i||new Kt,this._current.copyToRenderCamera(i),i}step(e,i){return this.finished||(this.currentTime=this.currentTime+M0e(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};var In;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(In||(In={}));let Zm=class extends Ke{constructor(e){super(e),this.state=In.Ready}get active(){return this.state===In.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=In.Stopped,!0)}finishController(){this.state=In.Finished}get steppingFinished(){return!1}};_([T({constructOnly:!0})],Zm.prototype,"view",void 0),_([T({readOnly:!0})],Zm.prototype,"active",null),_([T()],Zm.prototype,"state",void 0),_([T({readOnly:!0})],Zm.prototype,"isInteractive",null),Zm=_([Z("esri.views.3d.state.controllers.CameraController")],Zm);let lO=class extends Zm{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(or()),this._asyncResult=null),this.state===In.Finished||this.state===In.Stopped?(_D(e),this.state===In.Finished?e.resolve():e.reject(or())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=In.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==In.Ready&&this.state!==In.Running||(this.viewAnimation.state===NS.State.FINISHED?this.finish():this.viewAnimation.state===NS.State.STOPPED&&(this.state=In.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===In.Finished?this.viewAnimation.finish():this.state===In.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===In.Finished?this._asyncResult.resolve():this._asyncResult.reject(or()))}finish(){this.finishController()}};lO=_([Z("esri.views.3d.state.controllers.AnimationController")],lO);let og=class extends lO{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new MQe(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new NS}get isInteractive(){return this.mode==="interaction"}begin(e,i){this._hasTarget=!0;const r=this.animationSettings(i);cP.copyFrom(this.view.state.camera);const n=ad(this.view.state.viewingMode);this.intersectionHelper.intersectRay(cP.ray,n,Toe)&&(cP.center=Toe),this.animation.update(cP,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,i){this._hasTarget&&this.animation.step(e,i)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?QKe[e.easing]:e.easing}}};_([T({constructOnly:!0})],og.prototype,"mode",void 0),_([T({readOnly:!0})],og.prototype,"isInteractive",null),og=_([Z("esri.views.3d.state.controllers.PointToPointAnimationController")],og);const cP=new Kt,Toe=H();function q7(t=IQe){return[t[0],t[1],t[2],t[3]]}function cO(t,e){return PQe(t[0],t[1],t[2],e,cZ.get())}function PQe(t,e,i,r,n=q7()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function PK(t,e,i){return qt(i,t,e),We(i,i),i[3]=d7(t,e),i}const IQe=[0,0,1,0];function Y6t(t,e,i=oo()){return IK(t,pp(e),i),We(i.direction,i.direction),i}function IK(t,e,i){return $Qe(t,t.screenToRender(e,vt.get()),i)}function $Qe(t,e,i){const r=$s(vt.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const n=$s(vt.get(),e);n[2]=1;const s=t.unprojectFromRenderScreen(n,vt.get());return s==null?null:(Be(i.direction,s,i.origin),i)}function OE(t,e,i){return $K(t,t.screenToRender(e,vt.get()),i)}function $K(t,e,i){Ie(i.origin,t.eye);const r=$e(vt.get(),e[0],e[1],1),n=t.unprojectFromRenderScreen(r,vt.get());return n==null?null:(Be(i.direction,n,i.origin),i)}function LK(t,e,i,r){const n=OE(e,i,LQe);return Fv(t,n,r)}const LQe=oo();var US;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(US||(US={}));const bxe=30,ZL=[1,3e8],W7=80,wxe=8,xxe=200,Txe=1508e5,Sxe=5,Exe=50,DQe=5,NQe=10,xk=90,Lw={exclude:new Set([Ey])};function E2(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function ZH(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function Tv(t,e,i){const r=Zu(uZ.get(),i[3],i);r==null||tY(r,Cn)||(Be(Fr,t.eye,e),wt(Fr,Fr,r),t.eye=Ue(Fr,Fr,e),Be(Fr,t.center,e),wt(Fr,Fr,r),t.center=Ue(Fr,Fr,e),t.up=wt(Fr,t.up,r))}function FQe(t,e,i,r){return Cw(t,IK(e,i,FK),r)}function KH(t,e,i,r){return Cw(t,OE(e,i,FK),r)}function DK(t,e,i,r){const n=vt.get();let s=1-i;Be(n,e,t.eye);const a=Qe(n);let u=a*(1-s);s>=0&&u<r&&(u=r,s=-(u-a)/a),Math.abs(a-u)<1e-6||(Pe(n,n,s),t.eye=Ue(Fr,t.eye,n),t.center=Ir(Fr,t.center,e,s))}function Cxe(t,e,i){e.getScreenCenter(Soe),LK(t,e,Soe,Fr)&&(e.center=Fr);const r=e.distance,n=r*i;if(Math.abs(r-n)<1e-6)return;const s=Pe(vt.get(),e.viewForward,n);e.eye=Be(Fr,e.center,s)}const Soe=Dn();function Tk(t,e){$e(e,0,0,0);for(const i of t)Ue(e,e,i);Pe(e,e,1/t.length)}function S$(t,e,i,r){return Math.sin(t/Qe(e))*(i+r.radius)}function Eoe(t,e,i,r){return S$(Math.PI/2,e,i,r)+(t-Math.PI/2)}var Oo;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(Oo||(Oo={}));const Coe={Elevation:3e4,Angle:gi(16)},uP={Pole:.95,Angle:gi(18),Tilt:45},Axe=gi(80);function Oxe(t,e,i,r,n,s){const a=H(),u=as();let p=!0,y=!0;return t.intersectScreen(i,a,s)?u[3]=Qe(a):(y=!1,e.aboveGround&&n!==US.Ellipsoid?u[3]=Math.max(Qe(e.center),.9*r.radius):u[3]=Qe(e.eye)-e.relativeElevation,n===US.Silhouette?uO(u,e,i,a):p=LK(u,e,i,a)),{sphere:u,scenePickPoint:p?a:null,hasGeometryIntersection:y}}function X7(t,e,i){return Qe(t.eye)-i.radius>Coe.Elevation?Oo.Horizontal:(OE(t,e,Loe),-Math.sign(t.relativeElevation)*(.5*Math.PI+d7(t.eye,Loe.direction))<Coe.Angle?Oo.Vertical:Oo.Horizontal)}function Rxe(t,e,i){Be(Sk,i,e),t.eye=Be(Fr,t.eye,Sk),t.center=Be(Fr,t.center,Sk)}const Sk=H();function uO(t,e,i,r){const n=OE(e,i,FK);return n!=null&&(bE(t,n,hP),Fv(t,n,r)?!(ao(hP,n.origin)<ao(r,n.origin))||(Ie(r,hP),!1):(Be(f3,e.eye,e.center),We(f3,f3),abe(f3,-He(We(f3,f3),hP),Aoe),Cw(Aoe,n,r),!1))}const hP=H(),f3=H(),Aoe=gr();function Mxe(t,e,i,r,n,s){let a=0;if(qt(e8,t,e),Be(mP,t,e),Qe(t)<=n||!r.aboveGround){qt(i,mP,r.eye);const u=He(t,e)/(Qe(t)*Qe(e));if(u<.9999)a=co(u);else{const y=Qe(qt(H(),t,e))/(Qe(t)*Qe(e));a=Qh(y)}const p=Math.cos(Je(lv.normalize(gi(s)),0,Axe));a=-a-Math.max(0,Qe(e)-n)/(p*n)}else Be(Ooe,r.eye,r.center),qt(i,mP,Ooe),a=-Qe(mP)/n;return We(i,i),Pe(i,i,Qe(e8)),a}const Ooe=H();function Roe(t,e,i,r){let n,s;const a=Math.cos(Je(lv.normalize(gi(r)),0,Axe));return n=e>i?-(e-i)/(a*i):e<-i?Math.PI-(e+i)/(a*i):co(e/i),s=t>i?-(t-i)/(a*i):t<-i?Math.PI-(t+i)/(a*i):co(t/i),(s-n)*i}function kQe(t,e,i,r,n,s,a,u,p,y){const b=Roe(t[2],e[2],s[3],u),S=p?Roe(t[0],e[0],s[3],180):e[0]-t[0],C=Math.sin(a)*S-Math.cos(a)*b,O=Math.cos(a)*S+Math.sin(a)*b;We(Fr,n);const P=p?C/Math.sqrt(Math.abs(s[3]**2-He(i,Fr)**2)):C/s[3],$=O/Math.sqrt(Math.abs(s[3]**2-He(i,r)**2));Yi(y,P,$)}function Pxe(t,e,i,r,n,s,a,u,p,y){qt(e8,t,e),vG(s.up,s.eye,dP,pP,fP),vG([0,0,1],s.eye,pg,Qy,Dxe),Ie(i,Qy),Ie(r,pg),We(i,i),Pe(i,i,Qe(e8)),lne(t,We(pP,pP),We(fP,fP),We(dP,dP),Moe),lne(e,pP,fP,dP,Poe),kQe(Moe,Poe,t,pg,Qy,a,u,p,y,n)}function zQe(t,e,i,r,n,s,a){Zu(KL,n,r),Zu(QL,a,s),Rr(vT,KL,QL),Be(e,t,i),wt(e,e,vT),Ue(e,e,i)}function Ixe(t,e,i,r,n,s){Zu(KL,r,i),Zu(QL,s,n),Rr(vT,KL,QL),Be(Fr,t.eye,e),wt(Fr,Fr,vT),t.eye=Ue(Fr,Fr,e),Be(Fr,t.center,e),wt(Fr,Fr,vT),t.center=Ue(Fr,Fr,e),Be(Fr,t.up,e),wt(Fr,Fr,vT),t.up=Ue(Fr,Fr,e)}function NK(t,e,i,r,n,s){return(Math.abs(r)>Math.PI-uP.Angle||Math.abs(r)<uP.Angle)&&(Math.abs(t[2])<i*uP.Pole||Math.abs(e)>i)&&s.aboveGround&&n<uP.Tilt}function $xe(t,e,i,r,n,s){if(s)PK(i,r,Ioe),Tv(e,t,Ioe);else{const a=Mxe(i,r,$oe,e,t[3],n);Tv(e,t,cO($oe,a))}}function Lxe(t,e,i,r,n,s,a){const u=a?20:1,p=1e-12;let y,b;Ie(t_,r),gP.copyFrom(e);for(let S=0;S<u&&ao(i,t_)>p&&(y=ao(i,t_),Pxe(i,t_,Qy,pg,uC,gP,t,n,s,a),Ixe(gP,t,pg,uC[1],Qy,uC[0]),zQe(t_,t_,t,pg,uC[1],Qy,uC[0]),b=ao(i,t_),b<y||S===0);S++)e.copyFrom(gP)}function UQe(t,e,i,r,n,s,a){NK(i,He(e.up,i),t[3],-lv.normalize(gi(n)),s,e)?Lxe(t,e,i,r,-lv.normalize(gi(n)),s,a):$xe(t,e,i,r,s,a)}function jQe(t,e,i,r,n,s){const{eye:a}=t;vG([0,0,1],a,pg,Qy,Dxe);const u=e.translation[0]*i.pan,p=n.mode==="zoom"?0:e.translation[1]*i.pan,y=Math.max(Math.sqrt(Math.abs(1-He(t.center,pg)**2/Qe(t.center)**2)),.5),b=(Math.sin(s)*p+Math.cos(s)*u)/y,S=-Math.cos(s)*p+Math.sin(s)*u;switch(Dc(r.pan.matrix,r.pan.matrix,b,pg),r.pan.enabled=!0,n.mode){case"pan":Dc(r.pan.matrix,r.pan.matrix,S,Qy),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function BQe(t,e,i,r,n){const{eye:s,viewRight:a}=t,u=qt(vt.get(),a,s),p=e.translation[0]*i.pan;switch(p!==0&&(Dc(r.pan.matrix,r.pan.matrix,-p,u),r.pan.enabled=!0),n.mode){case"pan":{const y=e.translation[1]*i.pan;y!==0&&(Dc(r.pan.matrix,r.pan.matrix,y,a),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function VQe(t,e,i,r,n,s,a,u,p){NK(t.center,He(t.up,t.center),Qe(t.center),-lv.normalize(gi(s)),a,e)?jQe(e,i,r,u,p,-lv.normalize(gi(n))):BQe(e,i,r,u,p)}const pg=H(),Qy=H(),Dxe=H(),dP=H(),pP=H(),fP=H(),Moe=H(),Poe=H(),uC=Ct(),Ioe=q7(),KL=Ze(),QL=Ze(),vT=Ze(),t_=H(),Fr=H(),mP=H(),gP=new Kt,e8=H(),$oe=H(),FK={origin:H(),direction:H()},Loe={origin:H(),direction:H()},Doe=.6,Ek=4,GQe=60;let t8=class extends og{constructor(){super(...arguments),this._zoomLocation=H(),this._tmpCamera=new Kt,this._tmpViewDir=H(),this._tmpRayDir={origin:H(),direction:H()},this._targetOnSphere=H(),this._tmpCenter=H(),this._constraintOptions={selection:mn.ALL_EXCEPT_COLLISION,interactionType:Ni.ZOOM,interactionFactor:null,interactionStartCamera:new Kt,interactionDirection:null,tiltMode:Po.TUMBLE},this._sphere=as()}initialize(){this._intersector=ad(this.view.state.viewingMode)}zoomStep(e,i){if(!this.active)return;const r=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(r.camera):this.animation.cameraAt(1,n));let s=!1,a=!1;this.intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?Lw:{})&&(s=e>0,a=!0),this._tmpCamera.copyFrom(r.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:Ie(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,i,a),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:yR}}_updateCamera(e,i,r,n,s){const a=Mr(this.view.spatialReference),u=X7(e,n,a),p=Math.abs(this.view.camera.position.z);We(vP,e.eye),Pe(vP,vP,-1),OE(e,n,this._tmpRayDir),We(this._tmpRayDir.direction,this._tmpRayDir.direction);const y=Je(Math.min(wxe,1/Math.abs(He(vP,this._tmpRayDir.direction)))*p,xxe,Txe);if(u===Oo.Horizontal){let b=Doe**i;this._sphere[3]=Qe(r),Be(this._tmpViewDir,e.center,e.eye);const S=Math.min(Qe(this._tmpViewDir),y);let C=S*b;if(b<=1&&C<Ek&&(C=Ek,b=C/S),Math.abs(S-C)<1e-6)return;const O=Qe(e.center);if(this._sphere[3]!==O){const P=this._sphere[3]+b*(O-this._sphere[3]);e.center=Pe(yP,e.center,P/O)}Pe(this._tmpViewDir,this._tmpViewDir,-b),e.eye=Ue(yP,e.center,this._tmpViewDir),ys(this.view,e,this._constraintOptions),ao(r,e.center)>1e-12&&LK(this._sphere,e,n,this._targetOnSphere)&&UQe(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let b=Doe**Math.abs(i);const S=i>0?1:-1;Be(this._tmpViewDir,r,e.eye);const C=Qe(this._tmpViewDir),O=this.view._stage.renderView.getMinimalDepthForArea(null,n[0],n[1],this.view.state.camera,GQe);let P=O??y;P=s&&i>0?Math.min(P,C):P,Pe(this._tmpRayDir.direction,this._tmpRayDir.direction,P),Ue(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let $=P*b;const N=Math.max(Ek,1.01*e.nearFar[0]);if(i>0&&$<N&&($=N,b=$/P),Math.abs(P-$)<1e-6)return;Pe(this._tmpRayDir.direction,this._tmpRayDir.direction,S*(1-b)),e.eye=Ue(yP,e.eye,this._tmpRayDir.direction),e.center=Ue(yP,e.center,this._tmpRayDir.direction)}AE(this.view,e)}};t8=_([Z("esri.views.3d.state.controllers.global.ZoomStepController")],t8);const yP=H(),vP=H();let E$;const GT=new Map;async function K6t(t){E$==null&&(E$=ke(()=>import("./VoxelWasmPerSceneView-465e54eb.js"),[],import.meta.url));const e=t.view,i=GT.get(e);return i?i.addVoxelLayer(t):(await E$.then(r=>{const n=new r.default({view:e});return GT.set(e,n),n})).addVoxelLayer(t)}function hO(t){return GT.get(t)}function Q6t(t){const e=t.view,i=GT.get(e);i&&i.removeVoxelLayer(t)<1&&(GT.delete(e),GT.size===0&&(E$=null))}const HQe=.6,qQe=4,WQe=60;let i8=class extends og{constructor(){super(...arguments),this._zoomLocation=H(),this._tmpCamera=new Kt,this._tmpRayDir=H(),this._tmpCenter=H(),this._constraintOptions={selection:mn.ALL,interactionType:Ni.ZOOM,interactionFactor:null,interactionStartCamera:new Kt,interactionDirection:null,tiltMode:Po.TUMBLE}}zoomStep(e,i){if(!this.active)return;const r=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(r.camera):this.animation.cameraAt(1,n)),this._tmpCamera.copyFrom(r.camera);const s=ad(this.view.state.viewingMode);let a=!1;e>0?(a=this.intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.map.ground.opacity===0?Lw:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:Ie(this._zoomLocation,this._tmpCamera.center);const u=HQe**e;let p=this.view._stage.renderView.getMinimalDepthForArea(hO(this.view),i[0],i[1],this.view.state.camera,WQe);Be(_P,this._tmpCamera.eye,this._zoomLocation),We(_P,_P);const y=Je(Math.min(wxe,1/Math.abs(He(XQe,_P)))*Math.abs(this.view.camera.position.z),xxe,Txe);if(p=p??y,p){const b=H();Be(b,this._zoomLocation,this._tmpCamera.eye),(p<Qe(b)||!a)&&(We(b,b),Ue(this._zoomLocation,this._tmpCamera.eye,Pe(b,b,p)))}this._updateCamera(this._tmpCamera,u,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:yR}}_updateCamera(e,i,r){Be(this._tmpRayDir,r,e.eye);const n=Qe(this._tmpRayDir);let s=n*i;const a=i<=1,u=Math.max(qQe,1.01*e.nearFar[0]);s!==0&&(a&&s<u&&(s=u,i=s/n),Math.abs(n-s)<1e-6||(Pe(this._tmpRayDir,this._tmpRayDir,i),e.eye=Be(Noe,r,this._tmpRayDir),e.center=Ir(Noe,e.center,r,1-i),ys(this.view,e,this._constraintOptions)))}};i8=_([Z("esri.views.3d.state.controllers.local.ZoomStepController")],i8);const Noe=H(),XQe=st(0,0,1),_P=H();function JQe(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function kK(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let YQe=class extends Qo{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(JQe(i,"primary")){const r=this._view.state.isGlobal?new t8({view:this._view,mode:"animation"}):new i8({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Dn(i.x,i.y)),e.stopPropagation()}}};function ZQe(t,e,i){return t===ht.Global?new QQe(i):new KQe(e,i)}let KQe=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=Mr(i),this._unitInMeters=Va(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,n,s){s||(s={near:0,far:0});let a=e[2]*this._unitInMeters;const u=a,p=a-n,y=this._elevationProvider?.visibleElevationBounds;y&&(a=p>=0?u-this._unitInMeters*y.min:this._unitInMeters*y.max-u);const b={x:(r=r??new rr({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},S=Math.max(b.x,b.y,b.z);Be(i_,i,e),m3[0]=i_[0]>0?r.xmax:r.xmin,m3[1]=i_[1]>0?r.ymax:r.ymin,m3[2]=i_[2]>0?S/2:-S/2,Be(m3,m3,e),We(i_,i_);const C=1.1*He(m3,i_)*this._unitInMeters,O=Math.sqrt(a*(a+2*this._referenceEllipsoid.radius)),P=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),$=P*iet*this._unitInMeters,N=P*ret*this._unitInMeters,z=Je((a-N)/($-N),0,1)**3,U=Math.min(si(O,C,z),O)*Math.max(Math.log(Math.abs(p)),1);return Nxe(Math.min(U,Math.max(34064e4,S))/this._unitInMeters,eet,this._unitInMeters,s)}},QQe=class{constructor(e){this._referenceEllipsoid=Mr(e)}compute(e,i,r,n,s){s||(s={near:0,far:0});const a=Qe(e),u=a-this._referenceEllipsoid.radius,p=this._referenceEllipsoid.radius+Math.min(0,n),y=Math.abs(u-n),b=Math.max(y,Math.abs(u)),S=Math.sqrt(b*(b+2*p)),C=a+this._referenceEllipsoid.radius;return Nxe(1.2*si(S,C,JZ(b)),Je(2e4-(Math.log(b)-7.983)/9.011*19e3,1e3,2e4),1,s)}};function Nxe(t,e,i,r){const n=tet/i;return t/e>n?(r.far=t,r.near=r.far/e):(r.near=n,r.far=r.near*e),r}const eet=2e4,tet=2,iet=.001,ret=1e-4,m3=H(),i_=H();let C$=class extends Ke{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const i=this.view.state.camera;e.spatialReference!=null&&o2e(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>AE(this.view,e,Hh.EYE_AND_CENTER))}};_([T({constructOnly:!0})],C$.prototype,"view",void 0),C$=_([Z("esri.views.3d.state.ElevationCollisionConstraint")],C$);let j5=class extends Ke{constructor(e){super(e),this.nearFarHeuristic=ZQe(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([Fe(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),Fe(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),Fe(()=>this.view.renderDataExtent,()=>this._updateNearFar(),$r),Fe(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),$r),Fe(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),$r),Fe(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),$r),Fe(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),$r),Fe(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),$r)]),this.view.state.isLocal&&this.addHandles(Fe(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),jr)),this._updateNearFar(),this.view.state.viewingMode!==ht.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new C$({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints?.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const i=this.view.constraints&&this.view.constraints.clipDistance;(i?i.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,i):this._updateCameraNearFarAuto(e,i)}_updateCameraNearFarAuto(e,i){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,C7(this.view,e.eye),e),i&&i.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,i){i&&(e.near=i.near,e.far=i.far)}_updateCollision(){const e=this.view.map?.ground?.navigationConstraint?.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;if(i!==r.enabled){r.enabled=i,i&&this._reapplyConstraints(mn.COLLISION);const n=this.view.constraints&&this.view.constraints.tilt;n&&n.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==ht.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(gi(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(wl(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,n=3*i/Math.atan(r.camera.fov/2);n!==r.constraints.distance&&(r.constraints.distance=n)}_reapplyConstraints(e=mn.ALL){this.view.state.updateCamera(i=>ys(this.view,i,{selection:e,interactionType:Ni.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:Po.TUMBLE}))}};_([T({constructOnly:!0})],j5.prototype,"view",void 0),_([T({readOnly:!0})],j5.prototype,"surfaceCollisionConstraint",void 0),j5=_([Z("esri.views.3d.state.ConstraintsManager")],j5);let Ay=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=nO(),this._points=a3e(),this.lines=new Array(12),this._origin=H(),this._direction=H(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:H(),endpoint:null}}update(e){l3e(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),Ie(this._origin,e.eye),Ie(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)Ie(this._points[i],e[i]);c3e(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return By(this.frustum,e)}intersectsRay(e){return QJe(this.frustum,e)}intersectsLineSegment(e,i){return eYe(this.frustum,e,i)}intersectsPoint(e){return u3e(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;Ck(this.lines[i],e[i],e[r]),Ck(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),Ck(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}};function Ck(t,e,i){t.origin=e,t.endpoint=i,Ng(t.direction,e,i)}Ay.planePointIndices=tYe,Ay.nearFarLineIndices=[[Lt.NEAR_BOTTOM_LEFT,Lt.FAR_BOTTOM_LEFT],[Lt.NEAR_BOTTOM_RIGHT,Lt.FAR_BOTTOM_RIGHT],[Lt.NEAR_TOP_RIGHT,Lt.FAR_TOP_RIGHT],[Lt.NEAR_TOP_LEFT,Lt.FAR_TOP_LEFT]];let JA=class extends Zm{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=In.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||o2e(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),AE(this.view,e,Hh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=In.Stopped)})}};_([T({constructOnly:!0})],JA.prototype,"desiredCamera",null),JA=_([Z("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],JA);function Fxe(t,e,i){const r=Math.sin(t),n=Math.cos(t),s=Math.sin(e),a=Math.cos(e),u=i;return u[0]=-r,u[4]=-s*n,u[8]=a*n,u[12]=0,u[1]=n,u[5]=-s*r,u[9]=a*r,u[13]=0,u[2]=0,u[6]=a,u[10]=s,u[14]=0,u[3]=0,u[7]=0,u[11]=0,u[15]=1,u}function net(t,e,i){return Fxe(t,e,i),Hc(i,i),i}function jc(t,e,i,r){if(t==null||r==null)return!1;const n=z4(t,$1e),s=z4(r,g7e);if(n===s&&!Foe(s)&&(n!==Te.UNKNOWN||Wn(t,r)))return YO(i,e),!0;if(Foe(s)){const a=lT[n][Te.LON_LAT],u=lT[Te.LON_LAT][s];return a!=null&&u!=null&&(a(e,0,m1,0),u(m1,0,g1,0),Fxe(bP*m1[0],bP*m1[1],i),i[12]=g1[0],i[13]=g1[1],i[14]=g1[2],!0)}if((s===Te.WEB_MERCATOR||s===Te.PLATE_CARREE)&&(n===Te.WGS84||n===Te.CGCS2000&&s===Te.PLATE_CARREE||n===Te.SPHERICAL_ECEF||n===Te.WEB_MERCATOR)){const a=lT[n][Te.LON_LAT],u=lT[Te.LON_LAT][s];return a!=null&&u!=null&&(a(e,0,m1,0),u(m1,0,g1,0),n===Te.SPHERICAL_ECEF?net(bP*m1[0],bP*m1[1],i):id(i),i[12]=g1[0],i[13]=g1[1],i[14]=g1[2],!0)}return!1}function Foe(t){return t===Te.SPHERICAL_ECEF||t===Te.SPHERICAL_MARS_PCPF||t===Te.SPHERICAL_MOON_PCPF}const bP=gi(1),m1=H(),g1=H(),set=.66;function kxe(t){return 360-mY.normalize(t)}function J7(t){return mY.normalize(360-t)}function zxe(t,e,i){const r=e.camera;if(r!=null)return oet(r,Ug(t));const{targetGeometry:n}=e;if(n==null)return null;const{camera:s,mode:a}=jxe(t,e.rotation,i);if(n.type==="point")return cet(t,e,n,s,a);const u=n.extent;return u==null?null:s$(t,u,s.heading,s.tilt,a)}async function Uxe(t,e,i,r){const n=e.camera;if(n!=null)return aet(n,Ug(t),r);const{targetGeometry:s}=e;if(s==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:a,mode:u}=jxe(t,e.rotation,i);if(s.type==="point")return uet(t,e,s,a,u,r);const p=s.extent;if(p==null)throw new Error("Target geometry has no extent!");return $2e(t,p,a.heading,a.tilt,u,r)}function oet(t,e){const i=t.position;let r;try{r=F0(i,e)}catch{return null}const n=t.clone();return n.position=r.clone(),n}async function aet(t,e,i){const r=t.position,n=await C0(r,e,{signal:i});oi(i);const s=t.clone();return s.position=n.clone(),s}function jxe(t,e,i){const r=DS(t,t.state.camera);let n=ma.ADJUST;return e!=null&&(r.heading=kxe(e),n=ma.LOCKED),i!=null&&(r.tilt=i),{camera:r,mode:n}}function cet(t,e,i,r,n){const s=t.spatialReference;let a;try{a=F0(i.clone(),s)}catch{return null}const u=e.scale!=null?A7(t,e.scale,a.latitude):t.state.camera.distance;return vqe(t,a,u,r,n)}async function uet(t,e,i,r,n,s){const a=t.spatialReference,u=await C0(i.clone(),a,{signal:s});oi(s);const p=e.scale!=null?A7(t,e.scale,u.latitude):t.state.camera.distance;return x2e(t,u,p,r,n,s)}function Bxe(t,e,i=null){return i==null&&(i=new qc),jK(t,null,e.clone(),i)}async function Vxe(t,e,i){const r=bet(t,e);if(!r)throw new de("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new Ku({fov:t.camera.fov}),s=new qc({camera:n});if(r.target instanceof qc)return r_(await pet(t,r.target,r,i,s));if(r.target instanceof Ku)return r_(await Hxe(t,r.target,i,s));const a=r.scale!=null||r.zoom!=null;if(r.target instanceof rr){const y=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return r_(a||y?await QH(t,r,r.target.center,n,i,s):await yet(t,r,r.target,n,i,s))}const u={boundingBox:cn(),hasZ:!1,screenSpaceObjects:[]},p=a?het(t,r):void 0;if(await Gxe(t,r.target,p,u,i),isFinite(u.boundingBox[0])){let y;if(yp(u.boundingBox,rs),Su.x=rs[0],Su.y=rs[1],Su.z=rs[2],Su.spatialReference=t.spatialReference,isFinite(Su.z)&&u.hasZ?y=KY(u.boundingBox):(Su.z=void 0,y=kDe(ZY(u.boundingBox,xet))),a||y)return r_(await QH(t,r,Su,n,i,s));const b=wet(t,u.screenSpaceObjects);return r_(await _et(t,r,Su,u.boundingBox,b,n,i,s))}return r.position?r_(await met(t,r,n,s,i)):r_(await get(t,r,n,i,s))}function zK(t,e){return e.scale==null&&e.zoom!=null?k2e(t,e.zoom):e.scale}function het(t,e){const i=zK(t,e);return i?uVe(i):void 0}function UK(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=kxe(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function jK(t,e,i,r){const n=t.spatialReference||dt.WGS84;return(e=e??Gm(t,i))==null||(r.targetGeometry=Og(e.center,t.renderSpatialReference,n),r.scale=z2e(t,e),r.rotation=J7(i.heading),r.camera=i),r}async function r8(t,e,i,r){const n=()=>new de("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw n();e.type==="mesh"&&(e=e.extent);const s=e.spatialReference,a=t.spatialReference,u=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let S;switch(e.type){case"point":S=e;break;case"multipoint":case"polyline":S=e.extent?.center;break;case"extent":S=e.center;break;case"polygon":S=e.centroid}S!=null&&u!=null&&t.elevationProvider!=null?(S=await C0(S,u,{signal:r}),rs[2]=a0(t.elevationProvider,S)??0):rs[2]=0}const p=Tet[e.type],y=new Array;if(p(e,e.hasZ?S=>{y.push([S[0],S[1],S[2]])}:S=>{y.push([S[0],S[1]])},rs),y.length===0)throw n();const b=await C0(new vw({spatialReference:s,hasZ:e.hasZ,hasM:!1,points:y}),a,{signal:r});if(e.hasZ&&(i.hasZ=!0),e.hasZ)for(const[S,C,O]of b.points)rs[0]=S,rs[1]=C,rs[2]=O,Np(i.boundingBox,rs);else for(const[S,C]of b.points)rs[0]=S,rs[1]=C,Np(i.boundingBox,rs)}async function det(t,e,i,r,n){const s=await Gc(t.whenViewForGraphic(e));if(s.ok===!1||s.value==null||!("whenGraphicBounds"in s.value))return void await r8(t,e.geometry,r,n);const a=s.value,u=await Gc(a.whenGraphicBounds(e,{minDemResolution:i}));if(u.ok===!1||!u.value)return void await r8(t,e.geometry,r,n);const{screenSpaceObjects:p,boundingBox:y}=u.value;AS(r.boundingBox,y),p&&p.forEach(b=>{r.screenSpaceObjects.push(b)}),isFinite(y[2])&&(r.hasZ=!0)}async function Gxe(t,e,i,r,n){if(Array.isArray(e)&&e.length===2){const s=e[0],a=e[1];if(typeof s=="number"&&typeof a=="number")return Su.x=s,Su.y=a,Su.z=void 0,Su.spatialReference=t.spatialReference?.isGeographic?t.spatialReference:dt.WGS84,void await r8(t,Su,r,n)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(s=>Gxe(t,s,i,r,n))):e instanceof Iv?await r8(t,e,r,n):e instanceof Fp&&await det(t,e,i,r,n)}async function pet(t,e,i,r,n){if(e.camera!=null)return Hxe(t,e.camera,r,n);n.scale=e.scale,n.rotation=e.rotation,n.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,n.camera=null,i.heading!=null?n.rotation=J7(i.heading):i.rotation!=null&&(n.rotation=i.rotation);const s=zK(t,i);return s!=null&&(n.scale=s),n.camera=await Uxe(t,n,i.tilt,r),n}async function Hxe(t,e,i,r){const n=t.spatialReference,s=await C0(e.position,n,{signal:i});return(e=e.clone()).fov=t.camera.fov,e.position=s,jK(t,null,e,r)}async function fet(t,e,i,r,n,s,a){const u=t.renderSpatialReference;return await IL(e,Ak,u,0,{signal:a}),await IL(i,xP,u,0,{signal:a}),s.targetGeometry=new Wt(e),n.position=new Wt(i),Be(n8,Ak,xP),O7(t,xP,n8,r.up,n),s.scale=Z2(t,un(xP,Ak),s.targetGeometry.latitude),s.rotation=J7(n.heading),s.camera=n,s}async function QH(t,e,i,r,n,s){if(i==null)throw new de("createfromcenter","invalid point");s.targetGeometry=i.clone();const a=Mw(t);if(e.position)return fet(t,s.targetGeometry,e.position,a,r,s,n);if(e.zoomFactor){const p=a.distance/e.zoomFactor,y=Pe(rs,a.viewForward,-p);a.eye=Ue(rs,a.center,y),s.scale=Z2(t,p,i.latitude)}DS(t,a,r);const u=UK(r,e)?ma.LOCKED:ma.ADJUST;if(!e.zoomFactor){const p=zK(t,e);if(p==null){const{renderSpatialReference:y}=t;await IL(i,rs,y,0,{signal:n}),u3e(a.frustum,rs)?s.scale=Z2(t,un(a.eye,rs),i.latitude):s.scale=z2e(t,a)}else s.scale=p;s.camera=await w2e(t,s.targetGeometry,s.scale,r,u,n)}return s}async function met(t,e,i,r,n){const s=Mw(t);Ie(n8,s.viewForward),O7(t,s.eye,n8,s.up,Ok);const a=t.spatialReference,{position:u}=e;if(u){const p=await C0(u,a,{signal:n});i.position=p}else i.position=new Wt;return i.heading=e.heading!=null?e.heading:Ok.heading,i.tilt=e.tilt!=null?e.tilt:Ok.tilt,jK(t,null,i,r)}async function get(t,e,i,r,n){const s=Mw(t),{spatialReference:a,renderSpatialReference:u}=t;return QH(t,e,Og(s.center,u,a),i,r,n)}async function yet(t,e,i,r,n,s){s.targetGeometry=i.clone();const a=Mw(t);DS(t,a,r);const u=UK(r,e)?ma.LOCKED:ma.ADJUST;return s.camera=await $2e(t,i,r.heading,r.tilt,u,n),s}function vet(t,e,i,r,n){let s=0;i.z!=null?s=i.z:t.basemapTerrain&&t.elevationProvider&&(s=a0(t.elevationProvider,i)),$e(rs,i.x,i.y,s),jc(t.spatialReference,rs,koe,t.renderSpatialReference),sd(wP,koe),od(wP,wP),cn(hC);const a=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let P=0;P<a.length;P++){const $=a[P];let N=r[$[2]];isFinite(N)||(N=s),$e(rs,r[$[0]],r[$[1]],N),va(rs,t.spatialReference,rs,t.renderSpatialReference),Np(hC,Lc(rs,rs,wP))}const u=ww(hC),p=Dv(hC),y=xw(hC),b=1/Math.tan(e.fovX/2),S=1/Math.tan(e.fovY/2),C=.5*Math.sqrt(u*u+y*y)*Math.max(S,b)+.5*p,O=.5*p*S+.5*Math.max(u,y);return Math.max(C,O)/n}async function _et(t,e,i,r,n,s,a,u){u.targetGeometry=i.clone();const p=Mw(t),y=vet(t,p,i,r,n);DS(t,p,s);const b=UK(s,e)?ma.LOCKED:ma.ADJUST;return u.scale=Z2(t,y,u.targetGeometry.latitude),u.camera=await w2e(t,u.targetGeometry,u.scale,s,b,a),u}function bet(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};return"declaredClass"in e||Array.isArray(e)?i.target=e:(Object.assign(i,e),e.center&&!i.target&&(i.target=e.center)),i}function r_(t){return t?.camera!=null&&(t.rotation=J7(t.camera.heading)),t}function wet(t,e){const i=set;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n].screenSpaceBoundingRect;r=Math.max(r,Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]),Math.abs(s[3]))}return i-r/Math.min(t.width,t.height)*2}const rs=H(),koe=Ze(),wP=Pn(),hC=eo(),xet=Di(),n8=H(),xP=H(),Ak=H(),Ok={heading:0,tilt:0},Su=new Wt,Tet={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let n=0;n<t.rings.length;n++){const s=t.rings[n];for(let a=0;a<s.length;a++)i[0]=s[a][0],i[1]=s[a][1],r&&(i[2]=s[a][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n];for(let a=0;a<s.length;a++)i[0]=s[a][0],i[1]=s[a][1],r&&(i[2]=s[a][2]),e(i)}},multipoint(t,e,i){const r=t.points,n=t.hasZ;for(let s=0;s<r.length;s++)i[0]=r[s][0],i[1]=r[s][1],n&&(i[2]=r[s][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e($e(i,t.xmin,t.ymin,t.zmin)),e($e(i,t.xmax,t.ymin,t.zmin)),e($e(i,t.xmin,t.ymax,t.zmin)),e($e(i,t.xmax,t.ymax,t.zmin)),e($e(i,t.xmin,t.ymin,t.zmax)),e($e(i,t.xmax,t.ymin,t.zmax)),e($e(i,t.xmin,t.ymax,t.zmax)),e($e(i,t.xmax,t.ymax,t.zmax))):(e($e(i,t.xmin,t.ymin,i[2])),e($e(i,t.xmax,t.ymin,i[2])),e($e(i,t.xmin,t.ymax,i[2])),e($e(i,t.xmax,t.ymax,i[2])))}},Eet=Object.freeze(Object.defineProperty({__proto__:null,create:Vxe,fromCamera:Bxe,toCameraAsync:Uxe,toCameraSync:zxe},Symbol.toStringTag,{value:"Module"}));let Cet=class{constructor(e,i,r){this.target=e,this.options=i,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((n,s)=>{this._resolveCallback=n,this._rejectCallback=s;const a=new AbortController;this.options.signal!=null&&qs(this.options.signal,()=>{this.abort()}),this._abortController=a,this.waitForReady()})}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(or())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await gS(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}async createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null;try{const e=await Vxe(this.view,this.target,this._abortController.signal);if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(i==null)return;if(this.options.animate){if(this._animationController==null)return;this.startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()}catch(e){this.reject(e)}}}_getCameraFromViewpoint(e){const i=!!(this.target instanceof qc&&this.target.camera||this.target instanceof Ku),r=e.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){const s=r.position,a=s&&s.spatialReference,u=a?a.wkid:"none",p=this.view.spatialReference?.wkid;return this.reject(new de("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${u}, view: ${p})`,{camera:r})),null}const n=Gm(this.view,r);return n==null?(this.reject(new de("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:n,isFullySpecified:i}}startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(r==null)return void this.reject(new de("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.active||i.viewAnimation==null||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let n;e.isFullySpecified?(n=new JA({view:this.view,desiredCamera:e.camera}),AE(this.view,e.camera,Hh.EYE_AND_CENTER)):ys(this.view,e.camera),i.begin(e.camera,this.options);const s=()=>{const u=this.view.state.cameraController;n&&(u&&u.active?u instanceof og&&u.viewAnimation!=null&&u.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=n):i.viewAnimation!=null&&i.viewAnimation.target===e.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=n))},a=u=>{if(this.view.state!=null)switch(i.state){case In.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case In.Ready:case In.Rejected:case In.Running:case In.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(u)}}};r.when(s,u=>a(u)),i.asyncResult={resolve:()=>a(),reject:u=>a(u)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return r instanceof og&&(r.updateStateFromViewAnimation(),r.active&&(e=r,i=e.viewAnimation)),e!=null||(e=new og({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e))?e:(i?.stop(),this.reject(new de("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},RE=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,i){return this._outer.get(e)?.get(i)}set(e,i,r){const n=this._outer.get(e);n?n.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((i,r)=>e(i,r))}};var Os;function Rk(t=!Me("disable-feature:high-quality-idle"),e=null){const i=new RE;return t?(i.set(yr.IDLE,Os.Antialiasing,e!=="low"),i.set(yr.IDLE,Os.HighResolutionAtmosphere,e!=="low"),i.set(yr.IDLE,Os.HighQualityTransparency,!0),i.set(yr.IDLE,Os.SSAO,!0),i.set(yr.IDLE,Os.WaterReflection,!0),i.set(yr.IDLE,Os.PhysicalPixelRendering,!0)):(i.set(yr.ANIMATING,Os.HighResolutionShadows,!0),i.set(yr.INTERACTING,Os.HighResolutionShadows,!0)),i.set(yr.IDLE,Os.HighResolutionShadows,!0),i.set(yr.IDLE,Os.HighResolutionVoxel,!0),i}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(Os||(Os={}));let Ns=class extends Ke{get camera(){const e=this._get("camera");if(!this.ready)return e;const i=DS(this.view,this.view.state.camera,Mk);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider?.enableElevationCache(!0),this.setStateCamera(Gm(this.view,e),{applyConstraints:!1})||Ee.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider?.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=DS(this.view,this.view.state.contentCamera,Mk);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=Gm(this.view,e);i!=null?(this._updateElevation(i),this.view.state.contentCamera=i):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(Pk),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,n=Ma(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([Fe(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(Pk),this.test.contentCameraResetState.clear())}),Fe(()=>this.zoom,a=>{a!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(a-i)/2),Math.abs(a-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),Fe(()=>this.view.state.camera,a=>{const u=ao(n,a.center);this.test.contentCameraResetState.set("camera.center",u/r),u>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],Pk),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():Ee.getLogger(this).error("#center=","Invalid center",e):Ee.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):Ee.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=L2e(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return i??this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||Ee.getLogger(this).error("#extent=","Invalid extent",e):Ee.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):Ee.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get _initialViewpoint(){const e=this.view.map;return e&&"initialViewProperties"in e?e.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Z2(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||Ee.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,n=this._get("padding"),s=Math.round(i[zi.TOP]/r),a=Math.round(i[zi.RIGHT]/r),u=Math.round(i[zi.BOTTOM]/r),p=Math.round(i[zi.LEFT]/r);return n!=null&&n.top===s&&n.right===a&&n.bottom===u&&n.left===p?n:{top:s,right:a,bottom:u,left:p}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,TP),this.view.state.updateCamera(i=>i.padding=TP))}_paddingToArray(e,i,r){e?_n(r,e.top||0,e.right||0,e.bottom||0,e.left||0):_n(r,0,0,0,0);for(let n=0;n<4;n++)r[n]=Math.round(r[n]*i)}get screenCenter(){const e=this.padding;return td((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?Bxe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||Ee.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const i=e.camera!=null?e.camera.position:e.targetGeometry,r=i!=null&&i.spatialReference;Ee.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}else Ee.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?Cqe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||Ee.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),i=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*i),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*i);const r=this.view._stage.renderView.renderingContext.parameters.maxTextureSize;return o2(this._tmpCanvasSize,r),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:i,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(Os.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const e=this.view?._stage?.renderer;return e&&(e.isFeatureEnabled(Os.PhysicalPixelRendering,yr.IDLE)||e.isFeatureEnabled(Os.PhysicalPixelRendering,yr.INTERACTING)||e.isFeatureEnabled(Os.PhysicalPixelRendering,yr.ANIMATING))}constructor(e){super(e),this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=zoe,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(i){this.viewStateManager._idleTimeout=i?zoe:0}},this._propertiesPool=new Mg({frustum:Ay},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new Aet}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([ga(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),Fe(()=>this.view.state?.camera,(e,i)=>this._cameraChangedHandler(e,i),$r)]),Qu(()=>this.view.state?.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([$2({prepare:()=>this._prepareFrame()}),Fe(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(SP)}),ga(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=ct(this._propertiesPool)}init(){this.constraintsManager=new j5({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this._initialViewpoint||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===ht.Local&&this.addHandles(Qu(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(SP),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),SP)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(SP),this.constraintsManager=ct(this.constraintsManager))}async goTo(e,i){const r={animate:!0,...i};return this._gotoOperation!=null&&this._gotoOperation.abort(r.animate),this._gotoOperation=new Cet(e,r,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(Mw(this.view),{applyConstraints:!1})}step(e){const i=this.view.state,r=i?.cameraController;r&&(i.updateCamera(n=>r.stepController(e,n)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:n}of Ret){const s=e.has(r),a=this._isOverridden(r);!s&&a&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(s||a)&&n.forEach(u=>e.add(u))}return i}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof Ku)return void this.setStateCamera(Gm(this.view,e),{applyConstraints:!1});if(e instanceof qc){if(e.targetGeometry instanceof rr){const s=s$(this.view,e.targetGeometry,0,.5,ma.LOCKED);return void(s!=null&&this.setStateCamera(Gm(this.view,s),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},n=this._viewpointToCamera(e);return void this.setStateCamera(n,r)}const i=s$(this.view,e,0,.5,ma.LOCKED);i!=null&&this.setStateCamera(Gm(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&Oet.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof qc?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Ku?this.isCompatible(e.position):e.spatialReference&&CA(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=Met){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=y1){const{heading:n,tilt:s}=this._getPreservingHeadingTilt(),a=UZ(this.view,n,s,e,i,ma.ADJUST);return a==null?null:(r.copyFrom(this.view.state.camera),r.eye=a.eye,r.center=a.center,r.up=a.up,r)}_centerToCamera(e){const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),n=s$(this.view,e,i,r,ma.ADJUST,Mk);return n?Gm(this.view,n):null}_scaleToCamera(e){if(e==null)return null;const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.renderLocation,n=i.location.latitude;if(n==null)return null;const s=A7(this.view,e,n);return this._centerPointAtDistanceToCamera(r,s)}_zoomToCamera(e){return this._scaleToCamera(k2e(this.view,e))}_viewpointToCamera(e){return Gm(this.view,zxe(this.view,e))}setStateCamera(e,i){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up):r.copyFrom(e),i.applyConstraints&&ys(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new JA({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i}=this.view;if(!e||!i)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._computeCanvasSize();if(r.width!==0&&r.height!==0&&(i.width===r.width&&i.height===r.height||(i.width=r.width,i.height=r.height),this.view.state)){const n=this.view.state.camera;n.fullWidth===r.width&&n.fullHeight===r.height&&n.pixelRatio===r.pixelRatio||(y1.copyFrom(n),y1.pixelRatio!==r.pixelRatio&&(this._paddingToArray(this.padding,r.pixelRatio,TP),y1.padding=TP),y1.fullWidth=r.width,y1.fullHeight=r.height,y1.pixelRatio=r.pixelRatio,this.view.state.camera=y1),this._updateViewState()}}_updateElevation(e){const i=this.view.basemapTerrain?.spatialReference,r=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,n=i?C7(this.view,e.eye):0;e.relativeElevation=r-n}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=yr.ANIMATING:this.view.interacting?this.view.state.mode=yr.INTERACTING:(this.view.state.mode===yr.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=yr.INTERACTING:this.view.state.mode=yr.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};_([T({type:Ku,dependsOn:["view.state.camera","ready"]})],Ns.prototype,"camera",null),_([T({type:Ku,dependsOn:["view.state.contentCamera","ready"]})],Ns.prototype,"contentCamera",null),_([T({type:Wt})],Ns.prototype,"center",null),_([T({type:rr})],Ns.prototype,"extent",null),_([T({readOnly:!0})],Ns.prototype,"frustum",null),_([T()],Ns.prototype,"_initialViewpoint",null),_([T({readOnly:!0})],Ns.prototype,"hasInitialView",null),_([T({readOnly:!0,type:Boolean})],Ns.prototype,"ready",void 0),_([T({type:Number})],Ns.prototype,"scale",null),_([T()],Ns.prototype,"padding",null),_([T({readOnly:!0})],Ns.prototype,"screenCenter",null),_([T({constructOnly:!0})],Ns.prototype,"view",void 0),_([T({type:qc})],Ns.prototype,"viewpoint",null),_([T({type:Number})],Ns.prototype,"zoom",null),_([T({readOnly:!0})],Ns.prototype,"_rasterPixelRatio",null),_([T({readOnly:!0})],Ns.prototype,"_usePhysicalPixelRendering",null),_([T({readOnly:!0})],Ns.prototype,"_usePhysicalPixelRenderingAny",null),_([T()],Ns.prototype,"_windowDevicePixelRatio",void 0),_([T()],Ns.prototype,"_devicePixelRatioOverride",void 0),Ns=_([Z("esri.views.3d.state.ViewStateManager")],Ns);let Aet=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const Oet=new Set(["camera","viewpoint","extent","scale","center","zoom"]),Ret=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Met={heading:0,tilt:0},Mk=new Ku,y1=new Kt,TP=ji(),SP="pending-initial-view",Pk="content-camera-reset",zoe=300,Uoe=100;let c0=class extends Zm{constructor(){super(...arguments),this.startCamera=new Kt,this.currentCamera=new Kt,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<Uoe}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=In.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),Uoe),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};_([T({readOnly:!0})],c0.prototype,"isInteractive",null),_([T()],c0.prototype,"_lastInteraction",void 0),c0=_([Z("esri.views.3d.state.controllers.InteractiveController")],c0);var Cc;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(Cc||(Cc={}));let YA=class extends c0{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Cc.CENTER,this._rotScale=0,this._lastPoint=Ct(),this._tmpWorldUp=H(),this._tmpViewDir=H(),this._tmpRotCurPoint=Ct(),this._tmpTransf=Ze(),this._tmpAxis=H(),this._tmpPivotPoint=H(),this._pivotPos=H(),this._constraintOptions={selection:mn.ALL,interactionType:Ni.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Po.TUMBLE}}initialize(){this._rotScale=this.pivot===Cc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Cc.EYE:Ie(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Ni.LOOK_AROUND,this._constraintOptions.tiltMode=Po.LOOK_AROUND,this._constraintOptions.selection=mn.NONE;break;case Cc.CENTER:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?Lw:{});i||Ie(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Ni.TUMBLE,this._constraintOptions.tiltMode=Po.TUMBLE,this._constraintOptions.selection=mn.ALL&~mn.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,E2(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,n=H();Be(n,this._pivotPos,r.eye);const s=Qe(n),a=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,joe);let u=Math.max(Math.min(DQe,1/Math.abs(He(joe,r.viewForward)))*a,NQe);i&&(u=Math.min(s,u));const p=Mr(this.view.spatialReference),y=Dn(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),b=X7(this.startCamera,y,p);let S=this.view._stage.renderView.getMinimalDepthForArea(hO(this.view),r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*xk,xk),C=this.view._stage.renderView.getMinimalDepthForArea(hO(this.view),e[0],e[1],r,xk);S==null&&C==null||(S=S??C??0,C=C==null||b===Oo.Horizontal?S:C,u=S>C?C:S,u=i?Math.min(u,s):u),We(n,n),Ie(this._pivotPos,Ue(this._tmpPivotPoint,r.eye,Pe(this._tmpPivotPoint,n,u)))}update(e){if(this.active){switch(this.pivot){case Cc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Cc.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}ys(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,i,r,n){this.view.renderCoordsHelper.worldUpAtPosition(n,this._tmpWorldUp),E2(e,i,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,a=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;Be(this._tmpViewDir,r,n);const u=Qe(this._tmpViewDir),p=co(He(this._tmpViewDir,this._tmpWorldUp)/u);if(this.pivot===Cc.EYE){s*=-.5;const y=.5*Math.PI-p,b=.5*Math.PI*.99;s=y-Math.max(-b,Math.min(b,y+s))}return s=Je(s+p,ca.min,ca.max)-p,qt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Cc.CENTER&&(a=-a),Zu(this._tmpTransf,a,this._tmpWorldUp),Dc(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),wt(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=wt(Ik,e.up,this._tmpTransf),Ue(Ik,n,this._tmpViewDir),$s(this._lastPoint,this._tmpRotCurPoint),Ik}};_([T()],YA.prototype,"pivot",void 0),YA=_([Z("esri.views.3d.state.controllers.RotateController")],YA);const Ik=H(),joe=H();let $k=class extends Qo{constructor(e,i,r,n){super(!0),this._view=e,this.pointerAction=i,this._pivot=r,this.registerIncoming("drag",n,s=>this._handleDrag(s))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!kK(e.data,this.pointerAction))return;const r=Dn(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new YA({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},eq=class extends c0{constructor(){super(...arguments),this._pickPoint=H(),this._tmpP0=Ct(),this._panAxisAngle=q7(),this._tmpRayDir=H(),this._tmpRayDirPick=H(),this._targetOnSphere=H(),this._navMode=Oo.Horizontal,this._tmpRay={origin:H(),direction:H()},this.dragBeginPoint=Dn(),this._normalizedAnchorPoint=Ct(),this._constraintOptions={selection:mn.ALL_EXCEPT_COLLISION,interactionType:Ni.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Po.TUMBLE},this._sphere=as(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;$s(this.dragBeginPoint,e),E2(this.startCamera,e,this._normalizedAnchorPoint);const i=Mr(this.view.spatialReference),r=Oxe(this._intersectionHelper,this.startCamera,e,i,US.Ellipsoid,this.view.map.ground.opacity===0?Lw:{});if(this._navMode=X7(this.startCamera,e,i),this._navMode===Oo.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let n;OE(this.startCamera,e,this._tmpRay),We(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&(Be(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),n=Qe(this._tmpRayDirPick));const s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Boe);let a=Je(Math.min(bxe,1/Math.abs(He(Boe,this._tmpRay.direction)))*s,ZL[0],ZL[1]);const u=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,W7);a=u??a,a=n!=null?Math.min(a,n):a,this._hasPickPoint=!0,Pe(this._tmpRay.direction,this._tmpRay.direction,a),Ue(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Oo.Horizontal){Be(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=Qe(this._tmpRayDir);E2(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=i*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&n<s&&(n=s),Math.abs(i-n)<1e-6)return;if(this._hasPickPoint&&n<i){const a=1-(1-n/i)*(1-this._sphere[3]/Qe(this.currentCamera.center));this.currentCamera.center=Pe(EP,this.currentCamera.center,a)}Pe(this._tmpRayDir,this._tmpRayDir,-n/i),this.currentCamera.eye=Ue(EP,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=up(gv(this.dragBeginPoint,e)),ys(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(uO(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),PK(this._pickPoint,this._targetOnSphere,this._panAxisAngle),Tv(this.currentCamera,this._sphere,this._panAxisAngle))}else{const i=Qe(this._tmpRay.direction);E2(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=i*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&n<s&&(n=s),Math.abs(i-n)<1e-6)return;Pe(this._tmpRayDir,this._tmpRay.direction,1-n/i),this.currentCamera.eye=Ue(EP,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=Ue(EP,this.currentCamera.center,this._tmpRayDir)}AE(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};eq=_([Z("esri.views.3d.state.controllers.global.ZoomController")],eq);const EP=H(),Boe=H();let tq=class extends c0{constructor(){super(...arguments),this._tmpP=H(),this._tmpDir=H(),this._tmpN=H(),this._tmpP0=Ct(),this._tmpPoi=H(),this._tmpRayDir=H(),this.dragBeginPoint=Dn(),this._normalizedAnchorPoint=Ct(),this._constraintOptions={selection:mn.ALL,interactionType:Ni.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:H(),tiltMode:Po.TUMBLE},this._plane=gr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;$s(this.dragBeginPoint,e),E2(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?Lw:{});Be(this._tmpDir,this._tmpP,this.startCamera.eye);const r=Qe(this._tmpDir);We(this._tmpDir,this._tmpDir);const n=Math.abs(this.view.camera.position.z);let s=Je(Math.min(bxe,1/Math.abs(He(Pet,this._tmpDir)))*n,ZL[0],ZL[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(hO(this.view),e[0],e[1],this.view.state.camera,W7);s=a??s,s=i?Math.min(s,r):s,Pe(this._tmpDir,this._tmpDir,s),Ue(this._tmpP,this.startCamera.eye,this._tmpDir),Be(this._tmpN,this.startCamera.eye,this.startCamera.center),We(this._tmpN,this._tmpN),this._tmpN[1]<0&&ka(this._tmpN,this._tmpN),lR(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;FQe(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||Ie(this._tmpPoi,this.currentCamera.center),E2(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);$s(this._normalizedAnchorPoint,this._tmpP0),Be(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=Qe(this._tmpRayDir);let n=r*(1-i);this._constraintOptions.interactionDirection&&(Ie(this._constraintOptions.interactionDirection,this._tmpRayDir),Pe(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const s=this.view.state.constraints.minimumPoiDistance;i>=0&&n<s&&(n=s,i=-(n-r)/r),Math.abs(r-n)<1e-6||(Pe(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=Ue(n_,this.currentCamera.eye,this._tmpRayDir),Ir(n_,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?n_[2]=Math.max(this.startCamera.center[2],n_[2]):n_[2]=Math.min(this.startCamera.center[2],n_[2]),this.currentCamera.center=n_,this._constraintOptions.interactionFactor=up(gv(this.dragBeginPoint,e)),ys(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};tq=_([Z("esri.views.3d.state.controllers.local.ZoomController")],tq);const n_=H(),Pet=st(0,0,1);let Iet=class extends Qo{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this.registerIncoming("drag",r,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!kK(e.data,this.pointerAction))return;const r=Dn(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new eq({view:this._view}):this._cameraController=new tq({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function wd(t){let e=t*t;return t<0&&(e*=-1),e}function Voe(t,e,i){const r=i,n=t.state,s=t.device,a=e.tiltDirection==="forward-down"?1:-1,u=1;return s.deviceType==="standard"?(r.translation[0]=wd(n.axes[0]),r.translation[1]=wd(n.axes[1]),r.translation[2]=wd(n.buttons[7])-wd(n.buttons[6]),r.heading=wd(n.axes[2]),r.tilt=wd(n.axes[3])):s.deviceType==="spacemouse"&&(r.translation[0]=1.2*wd(n.axes[0]),r.translation[1]=1.2*wd(n.axes[1]),r.translation[2]=2*-wd(n.axes[2]),r.heading=1.2*wd(n.axes[5]),r.tilt=1.2*wd(n.axes[3])),r.tilt*=a,Pe(r.translation,r.translation,u),r}function Goe(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function Lk(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let a2=class extends c0{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Kt,this._headingStart=0,this._constraintOptions={selection:mn.ALL,interactionType:Ni.NONE,interactionStartCamera:new Kt,interactionFactor:0,interactionDirection:null,tiltMode:Po.LOOK_AROUND}}handleEventGamepad(e){const i=Voe(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||Lk(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,Goe(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const i=Goe(this._keysButtonState,this._transformation);Lk(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,s_),this._applyDisabledMovementTypes(s_),this._applyPan(s_.pan),this._applyRotate(s_.rotate),this._applyZoom(s_.zoom),this._applyAscend(s_.ascend),this._constraintOptions.interactionType=Ni.NONE,this._constraintOptions.selection=mn.COLLISION,ys(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;Be(Sl,i.center,i.eye),wt(Sl,Sl,e.matrix),i.center=Ue(Sl,Sl,i.eye),i.up=wt(Sl,i.up,e.matrix),this._constraintOptions.interactionType=Ni.LOOK_AROUND,this._constraintOptions.selection=mn.ALL_EXCEPT_COLLISION,ys(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=wt(Sl,i.eye,e.matrix),i.center=wt(Sl,i.center,e.matrix),this.view.state.isGlobal&&(i.up=wt(Sl,i.up,e.matrix)),this._constraintOptions.interactionType=Ni.PAN,this._constraintOptions.selection=mn.ALL,ys(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=Ue(Sl,this.currentCamera.eye,Pe(vt.get(),i,e)),Ie(dC,i),ka(dC,dC),this._constraintOptions.interactionDirection=dC,this._constraintOptions.interactionType=Ni.ZOOM,this._constraintOptions.selection=mn.ALL_EXCEPT_COLLISION,ys(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,vt.get());if(this._constraintOptions.interactionDirection=Ie(dC,i),this.view.state.isGlobal){const r=Qe(this.currentCamera.eye),n=(r+e)/r;this.currentCamera.eye=Pe(Sl,this.currentCamera.eye,n),this.currentCamera.center=Pe(Sl,this.currentCamera.center,n)}else{const r=Pe(vt.get(),i,e);this.currentCamera.eye=Ue(Sl,this.currentCamera.eye,r),this.currentCamera.center=Ue(Sl,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=Ni.ASCEND,this._constraintOptions.selection=mn.COLLISION,ys(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=mn.ALL_EXCEPT_COLLISION,ys(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){zet(r);const n=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(n,i,r):this._calculateControlTransformationGlobal(n,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,Sl)}_calculateControlTransformationLocal(e,i,r){const{viewRight:n,viewForward:s}=i,a=this._transformation,u=this.view.navigation.gamepad,p=$e(vt.get(),s[0],s[1],0);We(p,p);const y=a.translation[0]*e.pan;if(y!==0){const $=Pe(vt.get(),n,y);ec(r.pan.matrix,r.pan.matrix,$),r.pan.enabled=!0}switch(u.mode){case"pan":{const $=-a.translation[1]*e.pan;if($!==0){const N=Pe(vt.get(),p,$);ec(r.pan.matrix,r.pan.matrix,N),r.pan.enabled=!0}r.zoom=a.zoom*e.zoom;break}case"zoom":r.zoom=(-a.translation[1]+a.zoom)*e.zoom;break;default:u.mode}const b=a.translation[2]*e.ascend;r.ascend=b;const S=-a.heading*e.rotate;S!==0&&(Dc(r.rotate.matrix,r.rotate.matrix,S,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,vt.get())),r.rotate.enabled=!0);const C=a.tilt*e.rotate,O=xv(this.view.renderCoordsHelper,i.center,i.eye),P=Je(O+C,ca.min,ca.max)-O;P&&(Dc(r.rotate.matrix,r.rotate.matrix,P,n),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:n,viewRight:s}=i,a=this._transformation,u=this.view.navigation.gamepad,p=qt(vt.get(),s,n);We(p,p),ka(p,p),VQe(this.startCamera,i,a,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,u),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(s_.pan,this._tmpCamera);const y=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,b=a.translation[2]*e.ascend;r.ascend=b;const S=-a.heading*e.rotate;S!==0&&(Dc(r.rotate.matrix,r.rotate.matrix,S,this._tmpCamera.eye),r.rotate.enabled=!0);const C=a.tilt*e.rotate,O=this._clampTiltDeltaGlobalToValidRange(C,i.ray,y);O!==0&&(Dc(r.rotate.matrix,r.rotate.matrix,O,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=a.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const n=Mr(this.view.spatialReference),s=S$(ca.min,i.origin,r,n);let a=0,u=0;const p=vt.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,p)){const y=xv(this.view.renderCoordsHelper,p,i.origin);a=S$(y,i.origin,r,n),u=S$(ca.max,i.origin,r,n)}else{bE(p7(f7,r+n.radius),i,p);const y=Math.PI+d7(i.direction,p);a=Eoe(y,i.origin,r,n),u=Eoe(ca.max,i.origin,r,n)}return Je(a+e,s,u)-a}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:n}=this.view,s=n.getAltitude(e),a=i+Math.abs(s-i);return n.setAltitude(r,a,e),a}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:n}=this.view.state,{direction:s}=yqe(this.view,i,0,qxe,ket),a=r.intersectManifoldClosestSilhouette(eh(i,s),e,vt.get()),u=un(i,a),p=r.intersectManifoldClosestSilhouette(eh(i,Ng(vt.get(),i,n.center)),e,vt.get()),y=un(i,p);return Math.min(u,y)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:n,isGlobal:s}=r,a=i.intersectManifoldClosestSilhouette(n.ray,this._filteredSurfaceElevation,vt.get());if(s){const u=Be(vt.get(),e,a),p=Qe(u);Pe(u,u,1/p);const y=We(vt.get(),e),b=co(He(y,u));return p*Math.sin(Math.min(Let,b))}{const u=Ie(vt.get(),e);return i.setAltitude(u,this._filteredSurfaceElevation),un(a,u)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:Det}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+Mr(this.view.spatialReference).radius,{camera:n,isGlobal:s}=this.view.state,a=vt.get(),u=this._getPointAbsoluteSurfaceElevation(n.eye,i,a),p=this._clampedDistanceToSurface(i,a),y=n.width/2,b=Hoe*n.width,S=Hoe*n.width,C=p*Math.tan(.5*n.fovX)/y,O=C/r,P=C/this._computeHeadingRotateRadius(a),$=u-i;return{pan:(s?O:C)*b*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(b*e/y)*$-$),zoom:2**(b*e/y)*p-p,rotate:Je(P*S,Net,Fet)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&id(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&id(e.rotate.matrix))}static activatesFor(e,i){const r=Voe(i,e.navigation.gamepad,$et);return!(i.action==="end"||Lk(r))}};_([T({constructOnly:!0})],a2.prototype,"gamepadDevice",void 0),_([T({constructOnly:!0})],a2.prototype,"disableMovements",void 0),a2=_([Z("esri.views.3d.state.controllers.GamepadKeyboardController")],a2);const $et={translation:[0,0,0],heading:0,tilt:0,zoom:0},qxe=80,Let=gi(qxe),Hoe=.75,Det=5,Net=gi(30),Fet=gi(80),s_={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ze()},rotate:{enabled:!1,matrix:Ze()}},Sl=H(),dC=H(),ket=kZ();function zet(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,id(t.pan.matrix),t.rotate.enabled=!1,id(t.rotate.matrix)}let Uet=class extends Qo{constructor(e){super(!0),this._view=e,this._watchHandles=new Dg,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([Fe(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},jr),Fe(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(r||a2.activatesFor(this._view,e.data)){if(!r){const n=new a2({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(n)&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};function jet(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),{remove:()=>document.addEventListener("visibilitychange",e)}}var vc;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(vc||(vc={}));let Bet=class extends Qo{constructor(e,i){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:ht.Local},this._keyToNumber={[i.left]:vc.LEFT,[i.right]:vc.RIGHT,[i.forward]:vc.FORWARD,[i.backward]:vc.BACKWARD,[i.up]:vc.UP,[i.down]:vc.DOWN,[i.headingLeft]:vc.HEADINGLEFT,[i.headingRight]:vc.HEADINGRIGHT,[i.tiltUp]:vc.TILTUP,[i.tiltDown]:vc.TILTDOWN,[i.zoomIn]:vc.ZOOMIN,[i.zoomOut]:vc.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=jet(r=>r?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new a2({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(i),e.stopPropagation()))}_handleStop(){this._cameraControllerKeyboard?.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(i),e.stopPropagation())}},Vet=class extends Qo{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const i=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new t8({view:this._view,mode:"interaction"}):new i8({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*i.deltaY,Dn(i.x,i.y)),e.preventDefault(),e.stopPropagation()}},s8=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},iw=class extends lO{constructor(){super(...arguments),this._beginCamera=new Kt,this._elapsedTimeSec=0,this.constraintOptions={selection:mn.ALL,interactionType:Ni.PAN,interactionFactor:0,interactionStartCamera:new Kt,interactionDirection:null,tiltMode:Po.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new NS}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,i),ys(this.view,i,this.constraintOptions)}};iw=_([Z("esri.views.3d.state.controllers.momentum.MomentumController")],iw);let ZA=class extends iw{constructor(e){super(e),this.interactionType=Ni.PAN,this._tmpPan=H()}momentumStep(e,i){const r=this.momentum.value(e);Pe(this._tmpPan,this.momentum.direction,r),i.eye=Be(qoe,i.eye,this._tmpPan),i.center=Be(qoe,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};_([T({constructOnly:!0})],ZA.prototype,"momentum",void 0),ZA=_([Z("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],ZA);const qoe=H(),Get=H(),CP=H();let A$=class extends iw{constructor(e){super(e),this.interactionType=Ni.PAN}momentumStep(e,i){const r=this.momentum.value1(e),n=this.momentum.value2(e);Ie(CP,i.eye),We(CP,CP),qt(this.momentum.axis2,CP,this.momentum.axis1),Ixe(i,Get,this.momentum.axis1,r,this.momentum.axis2,n)}};_([T({constructOnly:!0})],A$.prototype,"momentum",void 0),A$=_([Z("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],A$);let Hb=class extends iw{set center(e){this._set("center",An(e))}set axis(e){this._set("axis",An(e))}constructor(e){super(e),this.interactionType=Ni.TUMBLE}momentumStep(e,i){const r=this.momentum.value(e);Tv(i,this.center,cO(this.axis,r))}};_([T({constructOnly:!0})],Hb.prototype,"momentum",void 0),_([T({constructOnly:!0})],Hb.prototype,"center",null),_([T({constructOnly:!0})],Hb.prototype,"axis",null),Hb=_([Z("esri.views.3d.state.controllers.momentum.MomentumController")],Hb);let _T=class extends iw{set zoomCenter(e){this._set("zoomCenter",An(e))}constructor(e){super(e),this.interactionType=Ni.ZOOM,this.constraintOptions.interactionDirection=H()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;Ie(r,i.eye);const n=this.momentum.valueDelta(0,e);DK(i,this.zoomCenter,n,this.view.state.constraints.minimumPoiDistance),Ng(r,i.eye,r)}};_([T({constructOnly:!0})],_T.prototype,"momentum",void 0),_([T({constructOnly:!0})],_T.prototype,"zoomCenter",null),_T=_([Z("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],_T);let ub=class extends iw{set screenCenter(e){this._set("screenCenter",Dn(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",An(e))}constructor(e){super(e),this.interactionType=Ni.ZOOM,this.radius=0,this._tmpSceneCenter=H(),this._tmpZoomAxisAngle=q7(),this._sphere=as()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);Cxe(this._sphere,i,r),this.constraintOptions.interactionType=Ni.ZOOM,ys(this.view,i,this.constraintOptions),uO(this._sphere,i,this.screenCenter,this._tmpSceneCenter),PK(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),Tv(i,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Ni.PAN}};_([T({constructOnly:!0})],ub.prototype,"momentum",void 0),_([T({constructOnly:!0})],ub.prototype,"screenCenter",null),_([T({constructOnly:!0})],ub.prototype,"sceneCenter",null),_([T({constructOnly:!0})],ub.prototype,"radius",void 0),ub=_([Z("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],ub);let hp=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},Y7=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},Het=class extends Y7{constructor(e,i,r,n,s){super(e,i,r),this._sceneVelocity=n,this.direction=s}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},Wxe=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new hp(.6),this._screen=[new hp(.4),new hp(.4)],this._scene=[new hp(.6),new hp(.6),new hp(.6)],this._tmpDirection=H()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),n=this._time.filteredDelta,s=n==null||r==null?0:r/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,i,r){$e(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=Qe(this._tmpDirection);n>0&&Pe(this._tmpDirection,this._tmpDirection,1/n);const s=this._time.filteredDelta;return new Het(e,i,r,s==null?0:n/s,this._tmpDirection)}},Woe=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const Xoe=1e-5;let qet=class extends Y7{constructor(e,i,r,n,s,a=0,u){super(e,i,r),this._angularVelocity1=n,this.axis1=s,this.angularVelocity2=a,this.axis2=u}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},Wet=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=H(),this._tmpAxis2=H(),this._tmpAngles=Ct(),this._time=new hp(.3),this._screen=[new hp(.4),new hp(.4)],this._angle1=new Woe(.6),this._angle2=new Woe(.6),this._axis1=H(),this._axis2=H(),this._lastScene=H()}addMomentumDirectRotation(e,i,r,n,s,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let u=Mxe(this._lastScene,i,this._tmpAxis2,n,s,a);this._angle2.update(0),ha(this._tmpAxis2)<Xoe?u=0:We(this._axis1,this._tmpAxis2),this._angle1.update(u),Ie(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,n,s,a,u){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;Pxe(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,n,s,a,u,!1),ha(this._tmpAxis2)<Xoe?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),We(this._axis1,this._tmpAxis1),We(this._axis2,this._tmpAxis2)),Ie(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),n=this._time.filteredDelta,s=r==null||n==null?0:r/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,i,r){const n=this._time.filteredDelta,s=this._angle1.filteredValue,a=this._angle2.filteredValue,u=n==null||a==null?0:a/n;return new qet(e,i,r,n==null||s==null?0:s/n,this._axis1,u,this._axis2)}},Xxe=class{constructor(e=2.5,i=.01,r=.95,n=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=n,this.enabled=!0,this.value=new hp(.8),this.time=new hp(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=Je(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new Y7(e,i,r)}},Jxe=class extends Xxe{constructor(e=3,i=.01,r=.95,n=12){super(e,i,r,n)}add(e,i){const r=this.value.lastValue;if(r!=null){let n=e-r;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;e=r+n}super.add(e,i)}},Xet=class extends Y7{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),n=super.value(e+i)-r;return Math.exp(n)}},Yxe=class extends Xxe{constructor(e=2.5,i=.01,r=.95,n=12){super(e,i,r,n)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new Xet(e,i,r)}},iq=class extends c0{constructor(){super(...arguments),this._smoothRotation=new s8(.05),this._rotationAxis=H(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=gr(),this._beginRadius=0,this._smoothScaling=new s8(.05),this._zoomCenterScreen=Dn(),this._zoomMomentumEstimator=new Yxe,this._rotationMomentumEstimator=new Jxe,this._panSphericalMomentumEstimator=new Wet,this._panPlanarMomentumEstimator=new Wxe,this._adjustedSphere=as(),this._tmp3d=H(),this._tmpScreenPointArray=Dn(),this._beginScreenPoint=Dn(),this._beginScenePoint=H(),this._screenPickPoint=Dn(),this._scenePickPoint=H(),this._mode=Oo.Horizontal,this._sphere=as(),this._pointerCount=0,this._tmpInteractionDirection=H(),this._constraintOptions={selection:mn.ALL,interactionType:Ni.NONE,interactionFactor:0,interactionStartCamera:new Kt,interactionDirection:null,tiltMode:Po.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panPlanarMomentumEstimator.enabled=i,this._panSphericalMomentumEstimator.enabled=i,this._beginHeading=-lv.normalize(gi(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),pp(e.center,this._screenPickPoint),$s(this._beginScreenPoint,this._screenPickPoint);const r=Mr(this.view.spatialReference),n=Oxe(this._intersectionHelper,this.startCamera,this._screenPickPoint,r,US.Silhouette,this.view.map.ground.opacity===0?Lw:{});n.scenePickPoint!=null&&(this._scenePickPoint=n.scenePickPoint,this._sphere=n.sphere,Ie(this._beginScenePoint,this._scenePickPoint),this._mode=X7(this.startCamera,this._screenPickPoint,r),this._mode===Oo.Vertical&&this._preparePlanarPanMode(e,n.hasGeometryIntersection),this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._mode===Oo.Horizontal?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._mode===Oo.Horizontal?new ub({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new _T({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new Hb({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._mode===Oo.Horizontal){const n=this._panSphericalMomentumEstimator.evaluateMomentum();if(n)return new A$({view:this.view,momentum:n})}else{const n=this._panPlanarMomentumEstimator.evaluateMomentum();if(n)return new ZA({view:this.view,momentum:n})}return null}_preparePlanarPanMode(e,i){const r=ka(this._tmp3d,this.startCamera.viewForward);lR(this._scenePickPoint,r,this._panningPlane);const n=Dn(this._screenPickPoint[0],0),s=H(),a=Qe(this.startCamera.eye);this._adjustedSphere[3]=a<this._sphere[3]?a-100:this._sphere[3],uO(this._adjustedSphere,this.startCamera,n,s);const u=fa();this.startCamera.projectToRenderScreen(s,u);const p=H(),y=H(),b=H();Be(p,this._scenePickPoint,this.currentCamera.eye);const S=Qe(p);We(p,p);const C=Sxe*Math.max(Math.abs(this.view.camera.position.z),Exe),O=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,W7);let P=O??C;P=i?Math.min(P,S):P,Ie(b,Ue(y,this.currentCamera.eye,Pe(y,p,P))),this._panningPlane[3]=-He(this._panningPlane,b),this.startCamera.center=Ue(y,this.startCamera.eye,Pe(y,this.startCamera.viewForward,P));const $=pp(e.center,this._tmpScreenPointArray);KH(this._panningPlane,this.startCamera,$,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),Cxe(this._sphere,this.currentCamera,this._smoothScaling.value),pp(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Ni.ZOOM,this._constraintOptions.interactionFactor=up(e.radius-this._beginRadius),ys(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=pp(e.center,this._tmpScreenPointArray);uO(this._sphere,this.currentCamera,i,this._tmp3d),NK(this._beginScenePoint,He(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(Lxe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):($xe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Ni.PAN,this._constraintOptions.interactionFactor=up(gv(this._screenPickPoint,i)),ys(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){We(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||ka(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+ZH(e.angle-i),n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(r);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),Tv(this.currentCamera,this._sphere,cO(this._rotationAxis,s)),this._constraintOptions.interactionType=Ni.TUMBLE,this._constraintOptions.interactionFactor=up(e.radius*r),ys(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=pp(e.center,this._tmpScreenPointArray);KH(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(Rxe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Ni.PAN,this._constraintOptions.interactionFactor=up(gv(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),ys(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),DK(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Ni.ZOOM,this._constraintOptions.interactionFactor=up(e.radius-this._beginRadius),ys(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){Ie(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||ka(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=ZH(r);const n=i+r,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(n);const a=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(a,.001*e.timestamp),Tv(this.currentCamera,this._sphere,cO(this._rotationAxis,a)),this._constraintOptions.interactionType=Ni.TUMBLE,this._constraintOptions.interactionFactor=up(e.radius*a),ys(this.view,this.currentCamera,this._constraintOptions)}};iq=_([Z("esri.views.3d.state.controllers.global.PinchAndPanController")],iq);const Joe=st(0,0,1),Jet={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let rq=class extends c0{constructor(){super(...arguments),this._rotationValueSmooth=new s8(.05),this._scalingValueSmooth=new s8(.05),this._planeHorizontal=gr(),this._planeVertical=gr(),this._rotationMomentumEstimator=new Jxe,this._panMomentumEstimator=new Wxe(300,12,.9),this._zoomMomentumEstimator=new Yxe,this._beginRadius=0,this._beginCenter=H(),this._beginAngle=0,this._tmpPoints=[],this._panMode=Oo.Horizontal,this._beginCenterScreen=Dn(),this._tmpCentroid3d=H(),this._tmpCentroid2d=Dn(),this._tmp2d=Dn(),this._pointerCount=0,this._constraintOptions={selection:mn.ALL,interactionType:Ni.NONE,interactionFactor:0,interactionStartCamera:new Kt,interactionDirection:null,tiltMode:Po.TUMBLE}}begin(e){if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),pp(e.center,this._beginCenterScreen),abe(Joe,0,this._planeHorizontal);const r=H(),n=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?Lw:{}),s=H();ka(s,this.startCamera.viewForward);const a=H();Ie(a,Joe);const u=He(s,a),p=Qh(u<0?-u:u);this._panMode=p>=Jet.ANGLE_THRESHOLD?Oo.Horizontal:Oo.Vertical;const y=Math.min(Sxe,1/Math.abs(He(a,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),Exe);mG(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||gG(this._planeHorizontal,this._planeHorizontal);const b=H(),S=H(),C=H();Be(b,r,this.currentCamera.eye);const O=Qe(b);if(We(b,b),this._panMode===Oo.Vertical){Pe(a,a,u),Be(this._planeVertical,s,a),We(this._planeVertical,this._planeVertical),mG(this._planeVertical,this._planeVertical,r);const P=this.view._stage.renderView.getMinimalDepthForArea(hO(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,W7);let $=P??y;$=n?Math.min($,O):$,Ie(C,Ue(S,this.currentCamera.eye,Pe(S,b,$))),this._planeVertical[3]=-He(this._planeVertical,C),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),Tk(this._tmpPoints,this._beginCenter)}else{const P=n?O:y;Ie(C,Ue(S,this.currentCamera.eye,Pe(S,b,P))),this._planeHorizontal[3]=-He(this._planeHorizontal,C),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),Tk(this._tmpPoints,this._beginCenter)}this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._panMode===Oo.Horizontal?this._planeHorizontal:this._planeVertical,n=this._beginCenter;if(i){const s=this._beginRadius/e.radius,a=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=a,this._scalingValueSmooth.update(s),DK(this.currentCamera,n,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Ni.ZOOM,this._constraintOptions.interactionFactor=up(Math.abs(e.radius-this._beginRadius)),ys(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),Tk(this._tmpPoints,this._tmpCentroid3d),pp(e.center,this._tmpCentroid2d),Rxe(this.currentCamera,n,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Ni.PAN,this._constraintOptions.interactionFactor=up(gv(this._beginCenterScreen,this._tmpCentroid2d)),ys(this.view,this.currentCamera,this._constraintOptions),i){const s=this._planeHorizontal,a=n,u=this._rotationValueSmooth.value,p=u+ZH(e.angle-u),y=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=y,this._rotationValueSmooth.update(p);const b=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(b,.001*e.timestamp),Tv(this.currentCamera,a,cO(s,b)),this._constraintOptions.interactionType=Ni.TUMBLE,this._constraintOptions.interactionFactor=up(Math.abs(e.radius*b)),ys(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new _T({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new Hb({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const n=this._panMomentumEstimator.evaluateMomentum();return n?new ZA({view:this.view,momentum:n}):null}_computePlanePoints(e,i,r,n){n.length=e.size;const s=this._tmp2d;let a=0;return e.forEach(u=>{s[0]=u.x,s[1]=u.y,n[a]===void 0&&(n[a]=H()),KH(i,r,s,n[a]),a+=1}),n}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};rq=_([Z("esri.views.3d.state.controllers.local.PinchAndPanController")],rq);let Yoe=class extends Qo{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,n=>this._handleDrag(n))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!kK(e.data,this.pointerAction))return;const i=e.timestamp-this._lastEndTimestamp,r=40,n=this._momentum&&this._momentum.active&&i<r;switch(e.data.action){case"start":case"update":if(n)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const r=this._controller.end(e.data);i&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new iq({view:this._view}):new rq({view:this._view})}},Yet=class extends Qo{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},Zxe=class extends Qo{constructor(e,i){super(!0),this.key=e,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},Zet=class extends Zxe{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},Ket=class extends Zxe{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},Qet=class extends Qo{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){const i=this._invert?-1:1,r=Dn(0,e.data.delta*i);switch(e.data.action){case"begin":this._cameraController?.end(),this._cameraController=new YA({view:this._view,pivot:Cc.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController?.update(r);break;case"end":this._cameraController?.end(),this._cameraController=null}}};function Zoe(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>itt(i,t.axisThreshold))}:{buttons:[],axes:[]}}function ett(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function ttt(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function itt(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let rtt=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const a=s.gamepad,u=a.index,p=this._inputDevices[u];p&&(this._emitGamepadEvent(a,Zoe(p),!1),this._inputDevices.splice(u,1),this._latestUpdate.splice(u,1),this._input.gamepad.devices.remove(p),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=r&&n,this.supported&&(this._forEachGamepad(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new GZ(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=$2({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(n=>{const s=this._inputDevices[n.index];if(!s)return;const a=this._latestUpdate[n.index],u=Zoe(s),p=r||ttt(u);a&&(a.timestamp===n.timestamp||!a.active&&p||ett(a.state,u))||this._emitGamepadEvent(n,u,!p)})}_forEachGamepad(e){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const n=i[r];this._validate(n)&&e(n)}}_emitGamepadEvent(e,i,r){const n=this._latestUpdate[e.index],s=n&&n.active;if(!s&&!r)return;const a=!s&&r?"start":s&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:a})}_validate(e){if(!e||!e.connected)return!1;for(let i=0;i<e.axes.length;i++)if(isNaN(e.axes[i]))return!1;return!0}};const Koe=Me("edge"),ntt=Me("chrome"),stt=Me("ff"),ott=Me("safari"),Qoe="esri-view-surface",g3={touchNone:`${Qoe}--touch-none`,touchPan:`${Qoe}--touch-pan`};let Kxe=class Qxe{constructor(e,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new rtt(e,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=ct(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(Dk[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&Dk[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(Dk[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=e?.has("gamepad")??!1}setPointerCapture(e,i){i?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?g3.touchNone:g3.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?g3.touchPan:g3.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(g3.touchNone),this._element.classList.remove(g3.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=Y2e(this._element,e);return Qxe.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const r=Bqe(i);r&&e==="key-up"&&this._keyDownState.delete(r);const n={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(n.key),this._callback(e,n)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_handleMouseWheel(e,i){let r=i.deltaY;switch(i.deltaMode){case 0:Koe&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}Koe?r*=.7:ntt||ott?r*=.6:stt&&(r*=1.375);const n=100,s=Math.abs(r);s>n&&(r=r/s*200/(1+Math.exp(-.02*(s-n))));const a=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,a)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};Kxe.test={disableSubpixelCoordinates:!1};const Dk={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let att=class extends Qo{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};const Lu={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function nq(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function ltt(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function ctt(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:td()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[j,G]=t,[q,W]=[G.x-j.x,G.y-j.y];return e.radius=Math.sqrt(q*q+W*W)/2,e.center.x=(j.x+G.x)/2,e.center.y=(j.y+G.y)/2,e}let i=0,r=0;for(let j=0;j<t.length;j++)i+=t[j].x,r+=t[j].y;i/=t.length,r/=t.length;const n=t.map(j=>j.x-i),s=t.map(j=>j.y-r);let a=0,u=0,p=0,y=0,b=0,S=0,C=0;for(let j=0;j<n.length;j++){const G=n[j],q=s[j],W=G*G,K=q*q;a+=W,u+=K,p+=G*q,y+=W*G,b+=K*q,S+=G*K,C+=q*W}const O=.5*(y+S),P=.5*(b+C),$=a*u-p*p,N=(O*u-P*p)/$,z=(a*P-p*O)/$,U=td(N+i,z+r);return{radius:Math.sqrt(N*N+z*z+(a+u)/t.length),center:U}}function KA(t){const{native:e}=t,{pointerId:i,button:r,pointerType:n}=e;return n==="mouse"?`${i}:${r}`:`${n}`}let utt=class extends Qo{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,n){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:n,pointers:htt(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=AP(this._activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,n);const s=O$(n,eTe(this._activePointerMap));n.initialAngle=s,n.lastAngle=s,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=AP(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=AP(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=O$(r,i)-e,r.lastAngle=O$(r,i)-e})}_emitEvent(e,i,r){const n=AP(this._activePointerMap);this._drag.emit(this._createPayload(e,i,n,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,n=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,n)):(this._addPointer(r),this._emitEvent("added",r,n),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,n))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function eTe(t){const e=[];return t.forEach(i=>{e.push(td(i.event.x,i.event.y))}),ctt(e)}function AP(t){const e=eTe(t);let i=0;return t.forEach(r=>{let n=O$(r,e),s=n-r.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=r.lastAngle+s,r.lastAngle=n;const a=n-r.initialAngle;i+=a}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function htt(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function O$(t,e){const i=t.event,r=i.x-e.center.x,n=i.y-e.center.y;return Math.atan2(n,r)}var eae;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(eae||(eae={}));let dtt=class extends Qo{constructor(e=Lu.maximumDoubleClickDelay,i=Lu.maximumDoubleClickDistance,r=Lu.maximumDoubleTouchDelay,n=Lu.maximumDoubleTouchDistance,s=FO){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=KA(i);if(!this._pointerState.has(r)){const n={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,n),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=KA(i),n=this._pointerState.get(r);if(n&&n.downButton===i.native.button){const s=n.immediateDoubleClick,a=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;s?(s.timeoutHandle.remove(),nq(s,e.data)>a?this._startImmediateDoubleClick(e,n):(this._immediateDoubleClick.emit(e.data,void 0,s.modifiers),this._removeState(i))):nq(n,e.data)>a?this._removeState(i):this._startImmediateDoubleClick(e,n)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=KA(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},ptt=class extends Qo{constructor(e=Lu.maximumClickDelay,i=Lu.movementUntilMouseDrag,r=Lu.movementUntilPenDrag,n=Lu.movementUntilTouchDrag,s=Lu.holdDelay,a=FO){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=n,this._holdDelay=s,this._clock=a,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",u=>{this._handlePointerLoss(u,"pointer-up")}),this.registerIncoming("pointer-capture-lost",u=>{this._handlePointerLoss(u,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",u=>{this._handlePointerLoss(u,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=nn(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{const a=this._pointerState.get(r);if(a){if(!a.isDragging){const u=a.previousEvent;this._pointerHold.emit(u,void 0,e.modifiers),a.holdEmitted=!0}a.holdTimeout=null}},this._holdDelay));const s={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(r,s),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,i,r){return{action:e,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,n=this._pointerState.get(r);n&&(n.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",n,i),void 0,n.modifiers):ltt(i,n.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),n.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,r===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",n,i)):this._pointerDrag.emit(this._createPointerDragData("start",n,n.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,n=r.native.pointerId,s=this._pointerState.get(n);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,i==="pointer-up"?r:s.previousEvent),void 0,s.modifiers):i==="pointer-up"&&s.downButton===r.native.button&&e.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(n),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}},ftt=class extends Qo{constructor(e=Lu.maximumDoubleClickDelay,i=Lu.maximumDoubleClickDistance,r=Lu.maximumDoubleTouchDelay,n=Lu.maximumDoubleTouchDistance,s=FO){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=nn(e.doubleClickTimer))}get hasPendingInputs(){return Iu(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=nn(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:i,pointerType:r,button:n}=e.native;return r==="mouse"?`${i}:${n}`:`${r}`}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,n=this._getPointerId(i);if(!this._pointerState.has(n))return void this._startClick(e);const s=this._pointerState.get(n),{data:a,modifiers:u}=s.event,p=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;nq(a,i)>p?(this._clearDoubleClickTimer(n,!0),this._startClick(e)):(this._clearDoubleClickTimer(n,!1),s.pointerDownCount===2&&this._doubleClick.emit(a,void 0,u))}_handlePointerDown(e){const i=KA(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,n=KA(i),s=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,a=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),s),u=1;this._pointerState.set(n,{event:e,doubleClickTimer:a,pointerDownCount:u}),this.refreshHasPendingInputs()}},mtt=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){this._startEvent=e,this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},gtt=class extends Qo{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new mtt({start:(r,n)=>this._observeStart(r,n),update:(r,n,s)=>this._observeUpdate(r,n,s),end:(r,n)=>this._observeEnd(n)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,n=1/0,s=-1/0,a=1/0;for(const{x:$,y:N}of i.pointers.values())r=Math.max(r,$),n=Math.min(n,$),s=Math.max(s,N),a=Math.min(a,N);let u=-1/0,p=1/0,y=-1/0,b=1/0;for(const{x:$,y:N}of e.pointers.values())u=Math.max(u,$),p=Math.min(p,$),y=Math.max(y,N),b=Math.min(b,N);const S=r-n,C=s-a,O=u-p,P=y-b;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(O-S)<=this._maxDelta&&Math.abs(P-C)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((n,s)=>{const a=i.pointers.get(s);r=Math.min(r,Math.abs(n.y-a.y))}),r>=this._threshold}},zd=class extends Ke{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=ct(this._inputManager)}connect(){const e=this.view;this._source=new Kxe(this.view.surface,e.input);const i=[new dtt,new ptt,new ftt,new utt(this.view.navigation),new gtt],r=new vh({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new att],Zy.INTERNAL),this._modeDragPan=new Yoe(e,"primary"),this._modeDragRotate=new $k(e,"secondary",Cc.CENTER),this._modeDragZoom=new Iet(e,"tertiary");const n={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new Yet(e),new YQe(e),new Uet(e),new Bet(e,n.pan),new Vet(e),new Ket(e,n.resetTilt),new Zet(e,n.resetHeading),new $k(e,"primary",Cc.EYE,[n.lookAround]),new $k(e,"secondary",Cc.CENTER,[n.lookAround]),new Yoe(e,"tertiary",[n.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Qet(e)],Zy.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this.addHandles(Fe(()=>this.view.navigation?.browserTouchPanEnabled,s=>{this._source.browserTouchPanningEnabled=!s},jr))}_updateMode(){const e=this.mode,i=this.primaryDragAction,r=sq.get(e)?.get(i);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};_([T()],zd.prototype,"view",void 0),_([T({value:"pan"})],zd.prototype,"primaryDragAction",null),_([T({value:"default"})],zd.prototype,"mode",null),_([T({readOnly:!0})],zd.prototype,"updating",null),_([T()],zd.prototype,"latestPointerType",null),_([T()],zd.prototype,"latestPointerLocation",null),_([T()],zd.prototype,"multiTouchActive",null),_([T()],zd.prototype,"_inputManager",void 0),zd=_([Z("esri.views.3d.input.SceneInputManager")],zd);const sq=new Map,Nk=new Map,Fk=new Map;Nk.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),Nk.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),Fk.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),Fk.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),sq.set("default",Nk),sq.set("pro",Fk);const ytt=zd;let us=class extends Ke{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};_([T()],us.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),_([T()],us.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),_([T()],us.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),_([T()],us.prototype,"DECONFLICTOR_SHOW_GRID",void 0),_([T()],us.prototype,"LABELS_SHOW_BORDER",void 0),_([T()],us.prototype,"TEXT_SHOW_BASELINE",void 0),_([T()],us.prototype,"TEXT_SHOW_BORDER",void 0),_([T()],us.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),_([T()],us.prototype,"OVERLAY_SHOW_CENTER",void 0),_([T()],us.prototype,"SHOW_POI",void 0),_([T()],us.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),_([T()],us.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),_([T()],us.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),_([T()],us.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),_([T()],us.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),_([T()],us.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),_([T()],us.prototype,"I3S_TREE_SHOW_TILES",void 0),_([T()],us.prototype,"I3S_SHOW_MODIFICATIONS",void 0),_([T()],us.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),_([T()],us.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),_([T()],us.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),_([T()],us.prototype,"LINE_WIREFRAMES",void 0),us=_([Z("esri.views.3d.support.DebugFlags")],us);const Xr=new us;let Eu,HT,oq=!1,aq=!1,lq=!1,cq=!1,QA=null;function vtt(t,e){if(!aq||!HT)return;tTe();const i=HT;let r=0;for(let n=0;n<t.accBinsNumX;n++)for(let s=0;s<t.accBinsNumY;s++){const a=t.accBins[n][t.accBinsNumY-1-s];r+=a.length;const u=n*t.accBinsSizeX,p=(n+1)*t.accBinsSizeX,y=s*t.accBinsSizeY,b=(s+1)*t.accBinsSizeY;i.fillText(a.length.toFixed(),u+5,y+15),iTe(u,p,y,b,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30)}function _tt(t){lq=Xr.DECONFLICTOR_SHOW_VISIBLE,cq=Xr.DECONFLICTOR_SHOW_INVISIBLE,oq=lq||cq,aq=Xr.DECONFLICTOR_SHOW_GRID,QA=null,oq||aq?QA=()=>btt(t):Eu&&(Eu.parentElement.removeChild(Eu),Eu=null)}function tTe(){QA&&(QA(),QA=null)}function btt(t){Eu==null&&(Eu=document.createElement("canvas"),Eu.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Eu));const{state:e}=t,{camera:i,pixelRatio:r}=e,{width:n,height:s}=i,a=n*r,u=s*r;Eu.setAttribute("width",`${a}px`),Eu.setAttribute("height",`${u}px`),Eu.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),HT=Eu.getContext("2d"),HT.clearRect(0,0,n,s),HT.font="12px Arial"}function iTe(t,e,i,r,n){tTe();const s=Eu.height,a=HT;a.beginPath(),a.lineWidth=1,a.strokeStyle=n,a.moveTo(t,s-i),a.lineTo(e,s-i),a.stroke(),a.lineTo(e,s-r),a.stroke(),a.lineTo(e,s-i),a.stroke(),a.lineTo(t,s-i),a.stroke(),a.lineTo(t,s-i),a.stroke(),a.closePath()}function wtt(t,e){oq&&(e&&lq||!e&&cq)&&iTe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var da,Co;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(da||(da={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(Co||(Co={}));function rTe(t,e){return new oTe(t,lTe,e)}function xtt(t,e){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:n}=lTe;return new oTe(t,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:kk.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:kk.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:n,minPixelSize:kk.minPixelSize},e)}function Ttt(t){return Math.abs(t*t*t)}function nTe(t,e,i){const r=i.parameters;return zk.scale=Math.min(r.divisor/(e-r.offset),1),zk.factor=Ttt(t),zk}function BK(t,e){return si(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function Stt(t,e,i){const r=nTe(t,e,i);return r.minScaleFactor=0,BK(1,r)}function tae(t,e,i,r){r.scale=Stt(t,e,i),r.factor=0,r.minScaleFactor=i.minScaleFactor}function sTe(t,e,i=[0,0]){const r=Math.min(Math.max(e.scale,e.minScaleFactor),1);return i[0]=t[0]*r,i[1]=t[1]*r,i}function Ett(t,e,i,r){return BK(t,nTe(e,i,r))}let oTe=class aTe{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,i,r,n=Ctt(),s){this._viewingMode=e,this._description=i,this._ellipsoidRadius=r,this.parameters=n,this._fontHeight=s,this._viewingMode===ht.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new aTe(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,i,r){const{scaleStart:n,scaleFallOffRange:s}=this._description,{fovY:a,distance:u}=e,p=this._calculateCurvatureDependentParameters(e,i),y=this._coverageCompensation(e,i,p),{tiltAngle:b,scaleFallOffFactor:S}=p,C=Math.sin(b)*u,O=.5*Math.PI-b-a*(.5-n*y),P=C/Math.cos(O),$=O+a*s*y,N=(P-S*(C/Math.cos($)))/(1-S);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=N,r.divisor=P-N,r}_calculateCurvatureDependentParametersLocal(e,i,r=iae){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,i,r=iae){const n=this._description.curvatureDependent,s=1+e.distance/i,a=Math.sqrt(s*s-1),[u,p]=[n.min.curvature,n.max.curvature],y=Je((a-u)/(p-u),0,1),[b,S]=[n.min,n.max];return r.tiltAngle=si(b.tiltAngle,S.tiltAngle,y),r.scaleFallOffFactor=si(b.scaleFallOffFactor,S.scaleFallOffFactor,y),r}_surfaceCoverageCompensationLocal(e,i,r){return(e.fovY-r.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,i,r){const n=i*i,s=r.tiltAngle+.5*Math.PI,{fovY:a,distance:u}=e,p=u*u+n-2*Math.cos(s)*u*i,y=Math.sqrt(p),b=Math.sqrt(p-n);return(Math.acos(b/y)-Math.asin(i/(y/Math.sin(s)))+.5*a)/a}};const lTe={curvatureDependent:{min:{curvature:gi(10),tiltAngle:gi(12),scaleFallOffFactor:.5},max:{curvature:gi(70),tiltAngle:gi(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},kk={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function Ctt(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const zk={scale:0,factor:0,minScaleFactor:0},iae={tiltAngle:0,scaleFallOffFactor:0};function Att(t){return t instanceof Float32Array&&t.length>=16}function Ott(t){return Array.isArray(t)&&t.length>=16}function Rtt(t){return Att(t)||Ott(t)}const jS={unknown:1,inches:Go(1,"meters","inches"),feet:Go(1,"meters","feet"),"us-feet":Go(1,"meters","us-feet"),yards:Go(1,"meters","yards"),miles:Go(1,"meters","miles"),"nautical-miles":Go(1,"meters","nautical-miles"),millimeters:Go(1,"meters","millimeters"),centimeters:Go(1,"meters","centimeters"),decimeters:Go(1,"meters","decimeters"),meters:Go(1,"meters","meters"),kilometers:Go(1,"meters","kilometers"),"decimal-degrees":1/E6e(1,"meters",ur.radius)};var Da,rae;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(Da||(Da={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(rae||(rae={}));let VK=class{constructor(e){this.field=e}},Mtt=class extends VK{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[Da.Undefined,Da.Undefined,Da.Undefined]}},Ptt=class extends VK{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},Itt=class extends VK{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},$tt=class{};function pC(t){return t!=null}function y3(t){return typeof t=="number"}function Z7(t){return typeof t=="string"}function Ltt(t){return t==null||Z7(t)}function Ws(t,e){t&&t.push(e)}function Dtt(t,e,i,r=Ze()){const n=t||0,s=e||0,a=i||0;return n!==0&&pS(r,r,-n/180*Math.PI),s!==0&&dS(r,r,s/180*Math.PI),a!==0&&FD(r,r,a/180*Math.PI),r}function v1(t,e,i,r,n){const s=t.minSize,a=t.maxSize;if(t.expression)return Ws(n,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const u=r.symbolSize[i];return e.minSize[i]=u,e.maxSize[i]=u,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Da.DefinedSize,!0}if(pC(t.field))return pC(t.stops)?t.stops.length===2&&y3(t.stops[0].size)&&y3(t.stops[1].size)?(nae(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=Da.DefinedSize,!0):(Ws(n,"Could not convert size info: stops only supported with 2 elements"),!1):y3(s)&&y3(a)&&pC(t.minDataValue)&&pC(t.maxDataValue)?(nae(s,a,t.minDataValue,t.maxDataValue,e,i),e.type[i]=Da.DefinedSize,!0):t.valueUnit==="unknown"?(Ws(n,"Could not convert size info: proportional size not supported"),!1):jS[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/jS[t.valueUnit],e.type[i]=Da.DefinedSize,!0):(Ws(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!pC(t.field)){if(t.stops?.[0]&&y3(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Da.DefinedSize,!0;if(y3(s))return e.minSize[i]=s,e.maxSize[i]=s,e.offset[i]=s,e.factor[i]=0,e.type[i]=Da.DefinedSize,!0}return Ws(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function nae(t,e,i,r,n,s){const a=Math.abs(r-i)>0?(e-t)/(r-i):0;n.minSize[s]=a>0?t:e,n.maxSize[s]=a>0?e:t,n.offset[s]=t-i*a,n.factor[s]=a}function Ntt(t,e,i,r){if(t.normalizationField||t.valueRepresentation)return Ws(r,"Could not convert size info: unsupported property"),null;if(!Ltt(t.field))return Ws(r,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return Ws(r,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new Mtt(t.field);let n;switch(t.axis){case"width":return n=v1(t,e.size,0,i,r),n?e:null;case"height":return n=v1(t,e.size,2,i,r),n?e:null;case"depth":return n=v1(t,e.size,1,i,r),n?e:null;case"width-and-depth":return n=v1(t,e.size,0,i,r),n&&v1(t,e.size,1,i,r),n?e:null;case null:case void 0:case"all":return n=v1(t,e.size,0,i,r),n=n&&v1(t,e.size,1,i,r),n=n&&v1(t,e.size,2,i,r),n?e:null;default:return Ws(r,`Could not convert size info: unknown axis "${t.axis}""`),null}}function Ftt(t,e,i){for(let n=0;n<3;++n){let s=e.unitInMeters;t.type[n]===Da.DefinedSize&&(s*=e.modelSize[n],t.type[n]=Da.DefinedScale),t.minSize[n]=t.minSize[n]/s,t.maxSize[n]=t.maxSize[n]/s,t.offset[n]=t.offset[n]/s,t.factor[n]=t.factor[n]/s}let r;if(t.type[0]!==Da.Undefined)r=0;else if(t.type[1]!==Da.Undefined)r=1;else{if(t.type[2]===Da.Undefined)return Ws(i,"No size axis contains a valid size or scale"),!1;r=2}for(let n=0;n<3;++n)t.type[n]===Da.Undefined&&(t.minSize[n]=t.minSize[r],t.maxSize[n]=t.maxSize[r],t.offset[n]=t.offset[r],t.factor[n]=t.factor[r],t.type[n]=t.type[r]);return!0}function sae(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function ktt(t,e,i){if(t.normalizationField)return Ws(i,"Could not convert color info: unsupported property"),null;if(Z7(t.field)){if(!t.stops)return Ws(i,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return Ws(i,"Could not convert color info: too many color stops"),null;e.color=new Ptt(t.field);const r=t.stops;for(let n=0;n<8;++n){const s=r[Math.min(n,r.length-1)];e.color.values[n]=s.value,sae(e.color.colors,n,s.color)}}}else{if(!(t.stops&&t.stops.length>=0))return Ws(i,"Could not convert color info: no field and no colors/stops"),null;{const r=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.color.values[n]=1/0,sae(e.color.colors,n,r)}}return e}function ztt(t,e,i){if(t.normalizationField)return Ws(i,"Could not convert opacity info: unsupported property"),null;if(Z7(t.field)){if(!t.stops)return Ws(i,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return Ws(i,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new Itt(t.field);const r=t.stops;for(let n=0;n<8;++n){const s=r[Math.min(n,r.length-1)];e.opacity.values[n]=s.value,e.opacity.opacityValues[n]=s.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return Ws(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.opacity.values[n]=1/0,e.opacity.opacityValues[n]=r}}return e}function Uk(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function Utt(t,e,i){if(!Z7(t.field))return Ws(i,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return Ws(i,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return Uk(t,e.rotation,0),e;case"roll":return Uk(t,e.rotation,1),e;case null:case void 0:case"heading":return Uk(t,e.rotation,2),e;default:return Ws(i,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let vR=class{constructor(e,i=[1,1,1],r=[1,1,1],n=1,s=[0,0,0],a=[1,1,1],u=[0,0,0]){this.supports=e,this.modelSize=i,this.symbolSize=r,this.unitInMeters=n,this.anchor=s,this.scale=a,this.rotation=u}};function cTe(t,e,i){if(!t)return null;const r=t.reduce((n,s)=>{if(!n)return n;if(s.valueExpression)return Ws(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(s.type){case"size":return e.supports.size?Ntt(s,n,e,i):n;case"color":return e.supports.color?ktt(s,n,i):n;case"opacity":return e.supports.opacity?ztt(s,n,i):null;case"rotation":return e.supports.rotation?Utt(s,n,i):n;default:return null}},new $tt);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r?.size&&!Ftt(r.size,e,i)?null:r:null}let jtt=class{constructor(e,i,r){this.visualVariables=e,this.materialParameters=i,this.requiresShaderTransformation=r}};function BS(t,e){if(!t||Xr.TESTS_DISABLE_FAST_UPDATES)return null;const i=cTe(t.visualVariables,e);return i?new jtt(i,hTe(i,e),!!i.size):null}function VS(t,e,i){if(!e||!t)return!1;const r=t.visualVariables,n=cTe(e.visualVariables,i);return!!n&&!!(OP(r.size,n.size,"size")&&OP(r.color,n.color,"color")&&OP(r.rotation,n.rotation,"rotation")&&OP(r.opacity,n.opacity,"opacity"))&&(t.visualVariables=n,t.materialParameters=hTe(n,i),t.requiresShaderTransformation=!!n.size,!0)}function OP(t,e,i){if(!!t!=!!e||t&&t.field!==e?.field)return!1;if(t&&i==="rotation"){const r=t,n=e;for(let s=0;s<3;s++)if(r.type[s]!==n.type[s]||r.offset[s]!==n.offset[s]||r.factor[s]!==n.factor[s])return!1}return!0}let uTe=class extends Vr{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}};function hTe(t,e){const i=new uTe(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,id(e4),Dtt(e.rotation[2],e.rotation[0],e.rotation[1],e4),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||Pn(),sd(i.vvSymbolRotationMatrix,e4)),i}function Btt(t,e,i){if(!t.vvSize)return i;bs(_1,i);const r=t.vvSymbolRotationMatrix;N0(e4,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),Rr(_1,_1,e4);for(let n=0;n<3;++n){const s=t.vvSize.offset[n]+e[0]*t.vvSize.factor[n];oae[n]=Je(s,t.vvSize.minSize[n],t.vvSize.maxSize[n])}return JO(_1,_1,oae),ec(_1,_1,t.vvSymbolAnchor),_1}function GK(t,e,i){if(!e.vvSize)return $e(t,1,1,1),t;for(let r=0;r<3;++r){const n=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=Je(n,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return t}function Ap(t,e){const i=t==null?0:e.attributes[t];return typeof i=="number"&&isFinite(i)?i:0}const _1=Ze(),oae=H(),e4=Ze();function HK(t){t.vertex.code.add(F`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(F`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(F`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(F`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(F`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(F`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function Vtt(t){t.uniforms.add(new _i("screenSizePerspective",e=>dTe(e.screenSizePerspective)))}function K7(t){t.uniforms.add(new _i("screenSizePerspectiveAlignment",e=>dTe(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function dTe(t){return $e(Gtt,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const Gtt=H();function pTe(t,e){const i=t.vertex;e.hasVerticalOffset?(fTe(i),e.hasScreenSizePerspective&&(t.include(HK),K7(i),kp(t.vertex,e)),i.code.add(F`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?F`vec3 worldNormal = normalize(worldPos + localOrigin);`:F`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?F`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:F`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(F`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const Htt=ji();function fTe(t){t.uniforms.add(new er("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:n,screenLength:s}=e.verticalOffset,a=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),u=i.camera.pixelRatio||1;return _n(Htt,s*u,a,r,n)}))}const mTe=.5;function gTe(t,e){t.include(HK),t.attributes.add(X.POSITION,"vec3"),t.attributes.add(X.NORMAL,"vec3"),t.attributes.add(X.AUXPOS1,"vec4");const i=t.vertex;Uc(i,e),kp(i,e),i.uniforms.add(new er("viewport",(r,n)=>n.camera.fullViewport),new lt("polygonOffset",r=>r.shaderPolygonOffset),new lt("cameraGroundRelative",(r,n)=>n.camera.aboveGround?1:-1)),e.hasVerticalOffset&&fTe(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(F`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(F`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.multipassEnabled?F.float(0):F`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||kS(i),e.draped||(i.uniforms.add(new lt("perDistancePixelRatio",(r,n)=>Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2))),i.code.add(F`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${F.float(mTe)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&SE(i),e.hasScreenSizePerspective&&K7(i),i.code.add(F`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offset of labels with respect to objects.
      // It also pulls the label towards the viewer so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?F`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":F`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}const RP=eo();function yTe(t,e,i,r,n,s){if(t.visible)if(t.boundingInfo){zt(t.type===Gn.Mesh);const a=e.tolerance;vTe(t.boundingInfo,i,r,a,n,s)}else{const a=t.attributes.get(X.POSITION),u=a.indices;_R(i,r,0,u.length/3,u,a,void 0,n,s)}}const qtt=H();function vTe(t,e,i,r,n,s){if(t==null)return;const a=bTe(e,i,qtt);if(Yve(RP,t.bbMin),Zve(RP,t.bbMax),n?.applyToAabb(RP),WK(RP,e,a,r)){const{primitiveIndices:u,position:p}=t,y=u?u.length:p.indices.length/3;if(y>Ytt){const b=t.getChildren();if(b!==void 0){for(const S of b)vTe(S,e,i,r,n,s);return}}_R(e,i,0,y,p.indices,p,u,n,s)}}const _Te=H();function _R(t,e,i,r,n,s,a,u,p){if(a)return Wtt(t,e,i,r,n,s,a,u,p);const{data:y,stride:b}=s,S=t[0],C=t[1],O=t[2],P=e[0]-S,$=e[1]-C,N=e[2]-O;for(let z=i,U=3*i;z<r;++z){let j=b*n[U++],G=y[j++],q=y[j++],W=y[j];j=b*n[U++];let K=y[j++],se=y[j++],ae=y[j];j=b*n[U++];let le=y[j++],me=y[j++],ne=y[j];u!=null&&([G,q,W]=u.applyToVertex(G,q,W,z),[K,se,ae]=u.applyToVertex(K,se,ae,z),[le,me,ne]=u.applyToVertex(le,me,ne,z));const pe=K-G,ge=se-q,ve=ae-W,Se=le-G,ee=me-q,re=ne-W,fe=$*re-ee*N,ye=N*Se-re*P,we=P*ee-Se*$,Ae=pe*fe+ge*ye+ve*we;if(Math.abs(Ae)<=Number.EPSILON)continue;const Oe=S-G,Ve=C-q,at=O-W,Xt=Oe*fe+Ve*ye+at*we;if(Ae>0){if(Xt<0||Xt>Ae)continue}else if(Xt>0||Xt<Ae)continue;const ti=Ve*ve-ge*at,Vt=at*pe-ve*Oe,Qt=Oe*ge-pe*Ve,St=P*ti+$*Vt+N*Qt;if(Ae>0){if(St<0||Xt+St>Ae)continue}else if(St>0||Xt+St<Ae)continue;const ze=(Se*ti+ee*Vt+re*Qt)/Ae;ze>=0&&p(ze,qK(pe,ge,ve,Se,ee,re,_Te),z,!1)}}function Wtt(t,e,i,r,n,s,a,u,p){const{data:y,stride:b}=s,S=t[0],C=t[1],O=t[2],P=e[0]-S,$=e[1]-C,N=e[2]-O;for(let z=i;z<r;++z){const U=a[z];let j=3*U,G=b*n[j++],q=y[G++],W=y[G++],K=y[G];G=b*n[j++];let se=y[G++],ae=y[G++],le=y[G];G=b*n[j];let me=y[G++],ne=y[G++],pe=y[G];u!=null&&([q,W,K]=u.applyToVertex(q,W,K,z),[se,ae,le]=u.applyToVertex(se,ae,le,z),[me,ne,pe]=u.applyToVertex(me,ne,pe,z));const ge=se-q,ve=ae-W,Se=le-K,ee=me-q,re=ne-W,fe=pe-K,ye=$*fe-re*N,we=N*ee-fe*P,Ae=P*re-ee*$,Oe=ge*ye+ve*we+Se*Ae;if(Math.abs(Oe)<=Number.EPSILON)continue;const Ve=S-q,at=C-W,Xt=O-K,ti=Ve*ye+at*we+Xt*Ae;if(Oe>0){if(ti<0||ti>Oe)continue}else if(ti>0||ti<Oe)continue;const Vt=at*Se-ve*Xt,Qt=Xt*ge-Se*Ve,St=Ve*ve-ge*at,ze=P*Vt+$*Qt+N*St;if(Oe>0){if(ze<0||ti+ze>Oe)continue}else if(ze>0||ti+ze<Oe)continue;const ni=(ee*Vt+re*Qt+fe*St)/Oe;ni>=0&&p(ni,qK(ge,ve,Se,ee,re,fe,_Te),U,!1)}}const aae=H(),lae=H();function qK(t,e,i,r,n,s,a){return $e(aae,t,e,i),$e(lae,r,n,s),qt(a,aae,lae),We(a,a),a}function bTe(t,e,i){return $e(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function WK(t,e,i,r){return XK(t,e,i,r,1/0)}function XK(t,e,i,r,n){const s=(t[0]-r-e[0])*i[0],a=(t[3]+r-e[0])*i[0];let u=Math.min(s,a),p=Math.max(s,a);const y=(t[1]-r-e[1])*i[1],b=(t[4]+r-e[1])*i[1];if(p=Math.min(p,Math.max(y,b)),p<0||(u=Math.max(u,Math.min(y,b)),u>p))return!1;const S=(t[2]-r-e[2])*i[2],C=(t[5]+r-e[2])*i[2];return p=Math.min(p,Math.max(S,C)),!(p<0)&&(u=Math.max(u,Math.min(S,C)),!(u>p)&&u<n)}function wTe(t,e,i,r,n){let s=(i.screenLength||0)*t.pixelRatio;n!=null&&(s=Ett(s,r,e,n));const a=s*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return Je(a*e,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function xTe(t,e){const i=e?xTe(e):{};for(const r in t){let n=t[r];n?.forEach&&(n=Jtt(n)),n==null&&r in i||(i[r]=n)}return i}function Xtt(t,e){let i=!1;for(const r in e){const n=e[r];n!==void 0&&(Array.isArray(n)?t[r]===null?(t[r]=n.slice(),i=!0):iJ(t[r],n)&&(i=!0):t[r]!==n&&(i=!0,t[r]=n))}return i}function Jtt(t){const e=[];return t.forEach(i=>e.push(i)),e}const TTe={multiply:1,ignore:2,replace:3,tint:4},Ytt=1e3;let jv=class extends gR{constructor(e,i){super(),this.type=Gn.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=ar,this._pp0=st(0,0,1),this._pp1=st(0,0,0),this._parameters=xTe(e,i),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){Xtt(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bindParameters.decorations===kc.ON)&&(this.parameters.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository?.materialChanged(this)}intersectDraped(e,i,r,n,s,a){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],this.intersect(e,i,r,this._pp0,this._pp1,s)}},STe=class extends AZe{constructor(e,i,r){super(i,r),this.camera=e}};var vn;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(vn||(vn={}));let JK=class extends Vr{constructor(){super(...arguments),this.renderOccluded=vn.Occlude,this.isDecoration=!1}},ETe=class{constructor(){this.factor=new cae,this.factorAlignment=new cae}},cae=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function y8t(t,e,i,r=1){const{data:n,indices:s}=t,a=e.typedBuffer,u=e.typedBufferStride,p=s.length;if(i*=u,r===1)for(let y=0;y<p;++y)a[i]=n[s[y]],i+=u;else for(let y=0;y<p;++y){const b=n[s[y]];for(let S=0;S<r;S++)a[i]=b,i+=u}}function uae(t,e,i){const{data:r,indices:n}=t,s=e.typedBuffer,a=e.typedBufferStride,u=n.length;i*=a;for(let p=0;p<u;++p){const y=2*n[p];s[i]=r[y],s[i+1]=r[y+1],i+=a}}function CTe(t,e,i,r){const{data:n,indices:s}=t,a=e.typedBuffer,u=e.typedBufferStride,p=s.length;if(i*=u,r==null||r===1)for(let y=0;y<p;++y){const b=3*s[y];a[i]=n[b],a[i+1]=n[b+1],a[i+2]=n[b+2],i+=u}else for(let y=0;y<p;++y){const b=3*s[y];for(let S=0;S<r;++S)a[i]=n[b],a[i+1]=n[b+1],a[i+2]=n[b+2],i+=u}}function GS(t,e,i,r=1){const{data:n,indices:s}=t,a=e.typedBuffer,u=e.typedBufferStride,p=s.length;if(i*=u,r===1)for(let y=0;y<p;++y){const b=4*s[y];a[i]=n[b],a[i+1]=n[b+1],a[i+2]=n[b+2],a[i+3]=n[b+3],i+=u}else for(let y=0;y<p;++y){const b=4*s[y];for(let S=0;S<r;++S)a[i]=n[b],a[i+1]=n[b+1],a[i+2]=n[b+2],a[i+3]=n[b+3],i+=u}}function hae(t,e,i){const r=t.typedBuffer,n=t.typedBufferStride;e*=n;for(let s=0;s<i;++s)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=n}function YK(t,e,i,r,n=1){if(!e)return void CTe(t,i,r,n);const{data:s,indices:a}=t,u=i.typedBuffer,p=i.typedBufferStride,y=a.length,b=e[0],S=e[1],C=e[2],O=e[4],P=e[5],$=e[6],N=e[8],z=e[9],U=e[10],j=e[12],G=e[13],q=e[14];r*=p;let W=0,K=0,se=0;const ae=UD(e)?le=>{W=s[le]+j,K=s[le+1]+G,se=s[le+2]+q}:le=>{const me=s[le],ne=s[le+1],pe=s[le+2];W=b*me+O*ne+N*pe+j,K=S*me+P*ne+z*pe+G,se=C*me+$*ne+U*pe+q};if(n===1)for(let le=0;le<y;++le)ae(3*a[le]),u[r]=W,u[r+1]=K,u[r+2]=se,r+=p;else for(let le=0;le<y;++le){ae(3*a[le]);for(let me=0;me<n;++me)u[r]=W,u[r+1]=K,u[r+2]=se,r+=p}}function ZK(t,e,i,r,n=1){if(!e)return void CTe(t,i,r,n);const{data:s,indices:a}=t,u=e,p=i.typedBuffer,y=i.typedBufferStride,b=a.length,S=u[0],C=u[1],O=u[2],P=u[4],$=u[5],N=u[6],z=u[8],U=u[9],j=u[10],G=!iY(u),q=1e-6,W=1-q;r*=y;let K=0,se=0,ae=0;const le=UD(u)?me=>{K=s[me],se=s[me+1],ae=s[me+2]}:me=>{const ne=s[me],pe=s[me+1],ge=s[me+2];K=S*ne+P*pe+z*ge,se=C*ne+$*pe+U*ge,ae=O*ne+N*pe+j*ge};if(n===1)if(G)for(let me=0;me<b;++me){le(3*a[me]);const ne=K*K+se*se+ae*ae;if(ne<W&&ne>q){const pe=1/Math.sqrt(ne);p[r]=K*pe,p[r+1]=se*pe,p[r+2]=ae*pe}else p[r]=K,p[r+1]=se,p[r+2]=ae;r+=y}else for(let me=0;me<b;++me)le(3*a[me]),p[r]=K,p[r+1]=se,p[r+2]=ae,r+=y;else for(let me=0;me<b;++me){if(le(3*a[me]),G){const ne=K*K+se*se+ae*ae;if(ne<W&&ne>q){const pe=1/Math.sqrt(ne);K*=pe,se*=pe,ae*=pe}}for(let ne=0;ne<n;++ne)p[r]=K,p[r+1]=se,p[r+2]=ae,r+=y}}function Ztt(t,e,i,r,n=1){if(!e)return void GS(t,i,r,n);const{data:s,indices:a}=t,u=e,p=i.typedBuffer,y=i.typedBufferStride,b=a.length,S=u[0],C=u[1],O=u[2],P=u[4],$=u[5],N=u[6],z=u[8],U=u[9],j=u[10],G=!iY(u),q=1e-6,W=1-q;if(r*=y,n===1)for(let K=0;K<b;++K){const se=4*a[K],ae=s[se],le=s[se+1],me=s[se+2],ne=s[se+3];let pe=S*ae+P*le+z*me,ge=C*ae+$*le+U*me,ve=O*ae+N*le+j*me;if(G){const Se=pe*pe+ge*ge+ve*ve;if(Se<W&&Se>q){const ee=1/Math.sqrt(Se);pe*=ee,ge*=ee,ve*=ee}}p[r]=pe,p[r+1]=ge,p[r+2]=ve,p[r+3]=ne,r+=y}else for(let K=0;K<b;++K){const se=4*a[K],ae=s[se],le=s[se+1],me=s[se+2],ne=s[se+3];let pe=S*ae+P*le+z*me,ge=C*ae+$*le+U*me,ve=O*ae+N*le+j*me;if(G){const Se=pe*pe+ge*ge+ve*ve;if(Se<W&&Se>q){const ee=1/Math.sqrt(Se);pe*=ee,ge*=ee,ve*=ee}}for(let Se=0;Se<n;++Se)p[r]=pe,p[r+1]=ge,p[r+2]=ve,p[r+3]=ne,r+=y}}function ATe(t,e,i,r,n=1){const{data:s,indices:a}=t,u=i.typedBuffer,p=i.typedBufferStride,y=a.length;if(r*=p,e!==s.length||e!==4)if(n!==1)if(e!==4)for(let b=0;b<y;++b){const S=3*a[b];for(let C=0;C<n;++C)u[r]=s[S],u[r+1]=s[S+1],u[r+2]=s[S+2],u[r+3]=255,r+=p}else for(let b=0;b<y;++b){const S=4*a[b];for(let C=0;C<n;++C)u[r]=s[S],u[r+1]=s[S+1],u[r+2]=s[S+2],u[r+3]=s[S+3],r+=p}else{if(e===4){for(let b=0;b<y;++b){const S=4*a[b];u[r]=s[S],u[r+1]=s[S+1],u[r+2]=s[S+2],u[r+3]=s[S+3],r+=p}return}for(let b=0;b<y;++b){const S=3*a[b];u[r]=s[S],u[r+1]=s[S+1],u[r+2]=s[S+2],u[r+3]=255,r+=p}}else{u[r]=s[0],u[r+1]=s[1],u[r+2]=s[2],u[r+3]=s[3];const b=new Uint32Array(i.typedBuffer.buffer,i.start),S=p/4,C=b[r/=4];r+=S;const O=y*n;for(let P=1;P<O;++P)b[r]=C,r+=S}}function Ktt(t,e,i){const{data:r,indices:n}=t,s=e.typedBuffer,a=e.typedBufferStride,u=n.length,p=r[0];i*=a;for(let y=0;y<u;++y)s[i]=p,i+=a}function OTe(t,e,i,r,n=1){const s=e.typedBuffer,a=e.typedBufferStride;if(r*=a,n===1)for(let u=0;u<i;++u)s[r]=t[0],s[r+1]=t[1],s[r+2]=t[2],s[r+3]=t[3],r+=a;else for(let u=0;u<i;++u)for(let p=0;p<n;++p)s[r]=t[0],s[r+1]=t[1],s[r+2]=t[2],s[r+3]=t[3],r+=a}function Qtt(t,e,i,r,n,s){for(const a of e.fields.keys()){const u=t.attributes.get(a),p=u?.indices;if(u&&p)RTe(a,u,i,r,n,s);else if(a===X.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const y=t.attributes.get(X.POSITION)?.indices;if(y){const b=y.length,S=n.getField(a,ja);OTe(t.objectAndLayerIdColor,S,b,s)}}}}function RTe(t,e,i,r,n,s){switch(t){case X.POSITION:{zt(e.size===3);const a=n.getField(t,lo);zt(!!a,`No buffer view for ${t}`),a&&YK(e,i,a,s);break}case X.NORMAL:{zt(e.size===3);const a=n.getField(t,lo);zt(!!a,`No buffer view for ${t}`),a&&ZK(e,r,a,s);break}case X.NORMALCOMPRESSED:{zt(e.size===2);const a=n.getField(t,mR);zt(!!a,`No buffer view for ${t}`),a&&uae(e,a,s);break}case X.UV0:{zt(e.size===2);const a=n.getField(t,Pw);zt(!!a,`No buffer view for ${t}`),a&&uae(e,a,s);break}case X.COLOR:case X.SYMBOLCOLOR:{const a=n.getField(t,ja);zt(!!a,`No buffer view for ${t}`),zt(e.size===3||e.size===4),!a||e.size!==3&&e.size!==4||ATe(e,e.size,a,s);break}case X.COLORFEATUREATTRIBUTE:{const a=n.getField(t,D7);zt(!!a,`No buffer view for ${t}`),zt(e.size===1),a&&e.size===1&&Ktt(e,a,s);break}case X.TANGENT:{zt(e.size===4);const a=n.getField(t,zp);zt(!!a,`No buffer view for ${t}`),a&&Ztt(e,r,a,s);break}case X.PROFILERIGHT:case X.PROFILEUP:case X.PROFILEVERTEXANDNORMAL:case X.FEATUREVALUE:{zt(e.size===4);const a=n.getField(t,zp);zt(!!a,`No buffer view for ${t}`),a&&GS(e,a,s)}}}let v8t=class extends Vr{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function eit(t,e){MTe(t,e,new _i("slicePlaneOrigin",(i,r)=>LTe(e,i,r)),new _i("slicePlaneBasis1",(i,r)=>o8(e,i,r,r.slicePlane?.basis1)),new _i("slicePlaneBasis2",(i,r)=>o8(e,i,r,r.slicePlane?.basis2)))}function ss(t,e){MTe(t,e,new Wu("slicePlaneOrigin",(i,r)=>LTe(e,i,r)),new Wu("slicePlaneBasis1",(i,r)=>o8(e,i,r,r.slicePlane?.basis1)),new Wu("slicePlaneBasis2",(i,r)=>o8(e,i,r,r.slicePlane?.basis2)))}function MTe(t,e,...i){if(!e.hasSlicePlane){const a=F`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(a),void t.fragment.code.add(a)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...i),t.fragment.uniforms.add(...i);const r=F`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=F`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=e.hasSliceHighlight?F`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:F`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(r),t.fragment.code.add(r),t.fragment.code.add(s)}function PTe(t,e,i){return t.instancedDoublePrecision?$e(tit,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function ITe(t,e){return t!=null?Be(a8,e.origin,t):e.origin}function $Te(t,e,i){return t.hasSliceTranslatedView?e!=null?ec(iit,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function LTe(t,e,i){if(i.slicePlane==null)return Mo;const r=PTe(t,e,i),n=ITe(r,i.slicePlane),s=$Te(t,r,i);return s!=null?wt(a8,n,s):n}function o8(t,e,i,r){if(r==null||i.slicePlane==null)return Mo;const n=PTe(t,e,i),s=ITe(n,i.slicePlane),a=$Te(t,n,i);return a!=null?(Ue(fC,r,s),wt(a8,s,a),wt(fC,fC,a),Be(fC,fC,a8)):r}const tit=H(),a8=H(),fC=H(),iit=Ze();function bR(t,e){const i=e.output===oe.ObjectAndLayerIdColor,r=e.objectAndLayerIdColorInstanced;i&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),r?t.attributes.add(X.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(X.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(F`
     void forwardObjectAndLayerIdColor() {
      ${i?r?F`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:F`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:F``} }`),t.fragment.code.add(F`
      void outputObjectAndLayerIdColor() {
        ${i?F`fragColor = objectAndLayerIdColorVarying;`:F``} }`)}function Q7(t){t.uniforms.add(new y0("alignPixelEnabled",(e,i)=>i.alignPixelEnabled)),t.code.add(F`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(F`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function rit(t,e){const{vertex:i,fragment:r}=t;i.include(Q7),e.multipassEnabled&&(i.include(s3e),t.varyings.add("depth","float")),i.code.add(F`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.multipassEnabled?F`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.include(Jc,e),r.code.add(F`
  void main() {
    fragColor = vec4(1);
    ${e.multipassEnabled?F`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}function DTe(t){t.vertex.uniforms.add(new lt("renderTransparentlyOccludedHUD",(e,i)=>i.hudRenderStyle===xc.Occluded?1:i.hudRenderStyle===xc.NotOccluded?0:.75),new er("viewport",(e,i)=>i.camera.fullViewport),new kt("hudVisibilityTexture",(e,i)=>i.hudVisibility?.colorTexture)),t.vertex.include(Q7),t.vertex.code.add(F`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}const NTe=vi(1,1,0,1),KK=vi(1,0,1,1);function Bv(t){t.fragment.uniforms.add(new kt("depthTexture",(e,i)=>i.mainDepth)),t.fragment.constants.add("occludedHighlightFlag","vec4",NTe).add("unoccludedHighlightFlag","vec4",KK),t.fragment.code.add(F`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let FTe=class extends zn{constructor(e,i,r){super(e,"vec4",hr.Pass,(n,s,a)=>n.setUniform4fv(e,i(s,a)),r)}},Wl=class extends zn{constructor(e,i,r){super(e,"float",hr.Pass,(n,s,a)=>n.setUniform1fv(e,i(s,a)),r)}},wR=class extends uTe{constructor(){super(...arguments),this.renderOccluded=vn.Occlude,this.isDecoration=!1}};const qT=8;function fg(t,e){const{vertex:i,attributes:r}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&r.add(X.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(i.uniforms.add(new _i("vvSizeMinSize",n=>n.vvSize.minSize)),i.uniforms.add(new _i("vvSizeMaxSize",n=>n.vvSize.maxSize)),i.uniforms.add(new _i("vvSizeOffset",n=>n.vvSize.offset)),i.uniforms.add(new _i("vvSizeFactor",n=>n.vvSize.factor)),i.uniforms.add(new Xp("vvSymbolRotationMatrix",n=>n.vvSymbolRotationMatrix)),i.uniforms.add(new _i("vvSymbolAnchor",n=>n.vvSymbolAnchor)),i.code.add(F`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(F`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?F`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(F`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(i.constants.add("vvColorNumber","int",qT),i.uniforms.add(new Wl("vvColorValues",n=>n.vvColor.values,qT),new FTe("vvColorColors",n=>n.vvColor.colors,qT)),i.code.add(F`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?F`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):i.code.add(F`vec4 vvColor() { return vec4(1.0); }`)}const l8=.1,Wo=.001;function nit(t){const e=new lr,i=t.signedDistanceFieldEnabled;if(e.include(gTe,t),e.include(ss,t),t.occlusionPass)return e.include(rit,t),e;const{vertex:r,fragment:n}=e;e.include(HK),n.include(fd),n.include(G0),e.include(fg,t),e.include(bR,t),e.include(DTe),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),e.varyings.add("voccluded","float"),r.uniforms.add(new er("viewport",(y,b)=>b.camera.fullViewport),new Lr("screenOffset",(y,b)=>Yi(kTe,2*y.screenOffset[0]*b.camera.pixelRatio,2*y.screenOffset[1]*b.camera.pixelRatio)),new Lr("anchorPosition",y=>c8(y)),new er("materialColor",y=>y.color)),SE(r),i&&(r.uniforms.add(new er("outlineColor",y=>y.outlineColor)),n.uniforms.add(new er("outlineColor",y=>dae(y)?y.outlineColor:qu),new lt("outlineSize",y=>dae(y)?y.outlineSize:0))),t.pixelSnappingEnabled&&r.include(Q7),t.hasScreenSizePerspective&&(Vtt(r),K7(r)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(X.UV0,"vec2"),e.attributes.add(X.COLOR,"vec4"),e.attributes.add(X.SIZE,"vec2"),e.attributes.add(X.FEATUREATTRIBUTE,"vec4"),r.code.add(F`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?F`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:F`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const s=F`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,a=t.pixelSnappingEnabled?i?F`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:F`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:F`posProj += quadOffset;`;r.code.add(F`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${s}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===oe.ObjectAndLayerIdColor?F`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${F.float(Wo)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${F.float(Wo)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${a}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?F`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),n.uniforms.add(new kt("tex",y=>y.texture));const u=t.debugDrawLabelBorder?F`(isBorder > 0.0 ? 0.0 : ${F.float(l8)})`:F.float(l8),p=F`
    ${t.debugDrawLabelBorder?F`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${t.sampleSignedDistanceFieldTexelCenter?F`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:F`
      vec2 samplePos = vtc;
      `}

    ${i?F`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${u} ||
          fillPixelColor.a + outlinePixelColor.a < ${F.float(Wo)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${u}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:F`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${u}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?F`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(t.output){case oe.Color:n.code.add(F`
        void main() {
          ${p}
          ${t.transparencyPassType===Ut.FrontFace?"fragColor.rgb /= fragColor.a;":""}
        }`);break;case oe.Alpha:n.code.add(F`
        void main() {
          ${p}
          fragColor = vec4(fragColor.a);
        }`);break;case oe.ObjectAndLayerIdColor:n.code.add(F`
        void main() {
          ${p}
          outputObjectAndLayerIdColor();
        }`);break;case oe.Highlight:n.constants.add("occludedHighlightFlag","vec4",NTe).add("unoccludedHighlightFlag","vec4",KK),n.code.add(F`
        void main() {
          ${p}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return e}function dae(t){return t.outlineColor[3]>0&&t.outlineSize>0}function c8(t,e=kTe){return t.textureIsSignedDistanceField?sit(t.anchorPosition,t.distanceFieldBoundingBox,e):$s(e,t.anchorPosition),e}function sit(t,e,i){e!=null?Yi(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):Yi(i,0,0)}const kTe=Ct(),oit=Object.freeze(Object.defineProperty({__proto__:null,build:nit,calculateAnchorPosForRendering:c8},Symbol.toStringTag,{value:"Module"})),Xu=Zo(et.SRC_ALPHA,et.ONE,et.ONE_MINUS_SRC_ALPHA,et.ONE_MINUS_SRC_ALPHA),ait=Xc(et.ONE,et.ONE),zTe=Xc(et.ZERO,et.ONE_MINUS_SRC_ALPHA);function Wg(t){return t===Ut.FrontFace?null:t===Ut.Alpha?zTe:ait}function eN(t){return t===Ut.FrontFace?ic:null}const tN=5e5,iN={factor:-1,units:-2};function rN(t){return t?iN:null}function Vv(t,e=Tr.LESS){return t===Ut.NONE||t===Ut.FrontFace?e:Tr.LEQUAL}let UTe=class jTe extends wr{initializeConfiguration(e,i){i.spherical=e.viewingMode===ht.Global}initializeProgram(e){return new fr(e.rctx,jTe.shader.get().build(this.configuration),ar)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===Ut.NONE,n=e===Ut.FrontFace,s=this.configuration.hasPolygonOffset?lit:null,a=(r||n)&&i.output!==oe.Highlight&&(i.depthEnabled||i.occlusionPass)?ic:null;return mi({blending:i.output===oe.Color||i.output===oe.Alpha||i.output===oe.Highlight?r?cit:Wg(e):null,depthTest:{func:Tr.LEQUAL},depthWrite:a,colorWrite:Oi,polygonOffset:s})}get primitiveType(){return this.configuration.occlusionPass?Hi.POINTS:Hi.TRIANGLES}};UTe.shader=new pr(oit,()=>ke(()=>import("./HUDMaterial.glsl-3749fcf3.js"),[],import.meta.url));const lit={factor:0,units:-4},cit=Xc(et.ONE,et.ONE_MINUS_SRC_ALPHA);let ws=class extends _l{constructor(){super(...arguments),this.output=oe.Color,this.transparencyPassType=Ut.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};_([ce({count:oe.COUNT})],ws.prototype,"output",void 0),_([ce({count:Ut.COUNT})],ws.prototype,"transparencyPassType",void 0),_([ce()],ws.prototype,"screenCenterOffsetUnitsEnabled",void 0),_([ce()],ws.prototype,"spherical",void 0),_([ce()],ws.prototype,"occlusionTestEnabled",void 0),_([ce()],ws.prototype,"signedDistanceFieldEnabled",void 0),_([ce()],ws.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),_([ce()],ws.prototype,"vvSize",void 0),_([ce()],ws.prototype,"vvColor",void 0),_([ce()],ws.prototype,"hasVerticalOffset",void 0),_([ce()],ws.prototype,"hasScreenSizePerspective",void 0),_([ce()],ws.prototype,"debugDrawLabelBorder",void 0),_([ce()],ws.prototype,"hasSlicePlane",void 0),_([ce()],ws.prototype,"hasPolygonOffset",void 0),_([ce()],ws.prototype,"depthEnabled",void 0),_([ce()],ws.prototype,"pixelSnappingEnabled",void 0),_([ce()],ws.prototype,"draped",void 0),_([ce()],ws.prototype,"multipassEnabled",void 0),_([ce()],ws.prototype,"cullAboveGround",void 0),_([ce()],ws.prototype,"occlusionPass",void 0),_([ce()],ws.prototype,"objectAndLayerIdColorInstanced",void 0),_([ce({constValue:!0})],ws.prototype,"hasSliceInVertexProgram",void 0),_([ce({constValue:!1})],ws.prototype,"hasVvInstancing",void 0);let HS=class extends jv{constructor(e){super(e,new wit),this._configuration=new ws}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===De.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===oe.Color||e===oe.Alpha),e===oe.Color&&(this._configuration.debugDrawLabelBorder=!!Xr.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(e,i,r,n,s,a){if(!(r.options.selectionMode&&r.options.hud&&e.visible&&r.point))return;const u=this.parameters,p=r.point,y=r.camera;let{scaleX:b,scaleY:S}=this._getScreenScale(e);b*=y.pixelRatio,S*=y.pixelRatio,sd(Bk,i),e.attributes.has(X.FEATUREATTRIBUTE)&&dit(Bk);const C=e.attributes.get(X.POSITION),O=e.attributes.get(X.SIZE),P=e.attributes.get(X.NORMAL),$=e.attributes.get(X.AUXPOS1);zt(C.size>=3);const N=c8(u),z=this.parameters.centerOffsetUnits==="screen";for(let U=0;U<C.data.length/C.size;U++){const j=U*C.size;$e(xa,C.data[j],C.data[j+1],C.data[j+2]),wt(xa,xa,i);const G=U*O.size;b1[0]=O.data[G]*b,b1[1]=O.data[G+1]*S,wt(xa,xa,y.viewMatrix);const q=U*$.size;if($e(ru,$.data[q],$.data[q+1],$.data[q+2]),!z&&(xa[0]+=ru[0],xa[1]+=ru[1],ru[2]!==0)){const K=ru[2];We(ru,xa),Be(xa,xa,Pe(ru,ru,K))}const W=U*P.size;if($e(mC,P.data[W],P.data[W+1],P.data[W+2]),this._normalAndViewAngle(mC,Bk,y,Vk),this._applyVerticalOffsetTransformationView(xa,Vk,y,jk),y.applyProjection(xa,Wa),Wa[0]>-1){z&&(ru[0]||ru[1])&&(Wa[0]+=ru[0]*y.pixelRatio,ru[1]!==0&&(Wa[1]+=BK(ru[1],jk.factorAlignment)*y.pixelRatio),y.unapplyProjection(Wa,xa)),Wa[0]+=this.parameters.screenOffset[0]*y.pixelRatio,Wa[1]+=this.parameters.screenOffset[1]*y.pixelRatio,Wa[0]=Math.floor(Wa[0]),Wa[1]=Math.floor(Wa[1]),sTe(b1,jk.factor,b1);const K=vit*y.pixelRatio;let se=0;if(u.textureIsSignedDistanceField&&(se=u.outlineSize*y.pixelRatio/2),pae(p,Wa[0],Wa[1],b1,K,se,u,N)){const ae=r.ray;if(wt(fae,xa,Ps(mit,y.viewMatrix)),Wa[0]=p[0],Wa[1]=p[1],y.unprojectFromRenderScreen(Wa,xa)){const le=H();Ie(le,ae.direction);const me=1/Qe(le);Pe(le,le,me),a(un(ae.origin,xa)*me,le,-1,!0,1,fae)}}}}}intersectDraped(e,i,r,n,s,a){const u=e.attributes.get(X.POSITION),p=e.attributes.get(X.SIZE),y=this.parameters,b=c8(y);let{scaleX:S,scaleY:C}=this._getScreenScale(e);S*=e.screenToWorldRatio,C*=e.screenToWorldRatio;const O=_it*e.screenToWorldRatio;for(let P=0;P<u.data.length/u.size;P++){const $=P*u.size,N=u.data[$],z=u.data[$+1],U=P*p.size;b1[0]=p.data[U]*S,b1[1]=p.data[U+1]*C;let j=0;y.textureIsSignedDistanceField&&(j=y.outlineSize*e.screenToWorldRatio/2),pae(n,N,z,b1,O,j,y,b)&&s(a.dist,a.normal,-1,!1)}}createBufferWriter(){return new Tit(this)}_normalAndViewAngle(e,i,r,n){return Rtt(i)&&(i=sd(fit,i)),Lc(n.normal,e,i),wt(n.normal,n.normal,r.viewInverseTransposeMatrix),n.cosAngle=He(BTe,bit),n}_updateScaleInfo(e,i,r){const n=this.parameters;n.screenSizePerspective!=null?tae(r,i,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),n.screenSizePerspectiveAlignment!=null?tae(r,i,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,i,r,n,s,a,u){const p=this._normalAndViewAngle(i,r,s,Vk);return this._applyVerticalGroundOffsetView(e,p,s,u),this._applyVerticalOffsetTransformationView(u,p,s,a),this._applyPolygonOffsetView(u,p,n[3],s,u),this._applyCenterOffsetView(u,n,u),u}applyShaderOffsetsNDC(e,i,r,n,s){return this._applyCenterOffsetNDC(e,i,r,n),s!=null&&Ie(s,n),this._applyPolygonOffsetNDC(n,i,r,n),n}_applyPolygonOffsetView(e,i,r,n,s){const a=n.aboveGround?1:-1;let u=Math.sign(r);u===0&&(u=a);const p=a*u;if(this.parameters.shaderPolygonOffset<=0)return Ie(s,e);const y=Je(Math.abs(i.cosAngle),.01,1),b=1-Math.sqrt(1-y*y)/y/n.viewport[2];return Pe(s,e,p>0?b:1/b),s}_applyVerticalGroundOffsetView(e,i,r,n){const s=Qe(e),a=r.aboveGround?1:-1,u=r.computeRenderPixelSizeAtDist(s)*mTe,p=Pe(xa,i.normal,a*u);return Ue(n,e,p),n}_applyVerticalOffsetTransformationView(e,i,r,n){const s=this.parameters;if(!s.verticalOffset?.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const y=Qe(e);this._updateScaleInfo(n,y,i.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const a=Qe(e),u=s.screenSizePerspectiveAlignment??s.screenSizePerspective,p=wTe(r,a,s.verticalOffset,i.cosAngle,u);return this._updateScaleInfo(n,a,i.cosAngle),Pe(i.normal,i.normal,p),Ue(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const n=this.parameters.centerOffsetUnits!=="screen";return r!==e&&Ie(r,e),n&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(We(mC,r),Ue(r,r,Pe(mC,mC,i[2])))),r}_applyCenterOffsetNDC(e,i,r,n){const s=this.parameters.centerOffsetUnits!=="screen";return n!==e&&Ie(n,e),s||(n[0]+=i[0]/r.fullWidth*2,n[1]+=i[1]/r.fullHeight*2),n}_applyPolygonOffsetNDC(e,i,r,n){const s=this.parameters.shaderPolygonOffset;if(e!==n&&Ie(n,e),s){const a=r.aboveGround?1:-1,u=a*Math.sign(i[3]);n[2]-=(u||a)*s}return n}produces(e,i){if(i===oe.Color||i===oe.Alpha||i===oe.Highlight||i===oe.ObjectAndLayerIdColor){if(e===De.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:r,occlusionTest:n}=this.parameters;return e===(r?De.LABEL_MATERIAL:De.HUD_MATERIAL)||n&&e===De.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new uit(e)}calculateRelativeScreenBounds(e,i,r=Di()){return hit(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e){const i=e.attributes.get(X.FEATUREATTRIBUTE);if(i==null)return{scaleX:1,scaleY:1};const r=lZ(i.data,yit),[n,s]=GK(git,this.parameters,r);return{scaleX:n,scaleY:s}}},uit=class extends rK{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(UTe,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function hit(t,e,i,r=pit){return $s(r,t.anchorPosition),r[0]*=-e[0],r[1]*=-e[1],r[0]+=t.screenOffset[0]*i,r[1]+=t.screenOffset[1]*i,r}function dit(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],a=t[5],u=t[6],p=t[7],y=t[8],b=1/Math.sqrt(e*e+i*i+r*r),S=1/Math.sqrt(n*n+s*s+a*a),C=1/Math.sqrt(u*u+p*p+y*y);return t[0]=e*b,t[1]=i*b,t[2]=r*b,t[3]=n*S,t[4]=s*S,t[5]=a*S,t[6]=u*C,t[7]=p*C,t[8]=y*C,t}function pae(t,e,i,r,n,s,a,u){let p=e-n-(u[0]>0?r[0]*u[0]:0),y=p+r[0]+2*n,b=i-n-(u[1]>0?r[1]*u[1]:0),S=b+r[1]+2*n;const C=a.distanceFieldBoundingBox;return a.textureIsSignedDistanceField&&C!=null&&(p+=r[0]*C[0],b+=r[1]*C[1],y-=r[0]*(1-C[2]),S-=r[1]*(1-C[3]),p-=s,y+=s,b-=s,S+=s),t[0]>p&&t[0]<y&&t[1]>b&&t[1]<S}const jk=new ETe,pit=Ct(),xa=H(),mC=H(),Wa=ji(),BTe=H(),fae=H(),Bk=Pn(),fit=Pn(),mit=Ze(),ru=H(),git=ji(),yit=ji(),Vk={normal:BTe,cosAngle:0},vit=1,_it=2,b1=[0,0],bit=st(0,0,1);let wit=class extends Gwe{constructor(){super(...arguments),this.renderOccluded=vn.Occlude,this.isDecoration=!1,this.color=vi(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Xi(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=vi(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const VTe=wn().vec3f(X.POSITION).vec3f(X.NORMAL).vec2f(X.UV0).vec4u8(X.COLOR).vec2f(X.SIZE).vec4f(X.AUXPOS1).vec4f(X.FEATUREATTRIBUTE),xit=VTe.clone().vec4u8(X.OBJECTANDLAYERIDCOLOR);let Tit=class{constructor(e){this._material=e,this.vertexBufferLayout=Me("enable-feature:objectAndLayerId-rendering")?xit:VTe}elementCount(e){return 6*e.attributes.get(X.POSITION).indices.length}write(e,i,r,n,s){YK(r.attributes.get(X.POSITION),e,n.position,s,6),ZK(r.attributes.get(X.NORMAL),i,n.normal,s,6);const a=r.attributes.get(X.UV0).data;let u,p,y,b;if(a==null||a.length<4){const z=this._material.parameters;u=0,p=0,y=z.texCoordScale[0],b=z.texCoordScale[1]}else u=a[0],p=a[1],y=a[2],b=a[3];y=Math.min(1.99999,y+1),b=Math.min(1.99999,b+1);let S=r.attributes.get(X.POSITION).indices.length,C=s;const O=n.uv0;for(let z=0;z<S;++z)O.set(C,0,u),O.set(C,1,p),C++,O.set(C,0,y),O.set(C,1,p),C++,O.set(C,0,y),O.set(C,1,b),C++,O.set(C,0,y),O.set(C,1,b),C++,O.set(C,0,u),O.set(C,1,b),C++,O.set(C,0,u),O.set(C,1,p),C++;ATe(r.attributes.get(X.COLOR),4,n.color,s,6);const{data:P,indices:$}=r.attributes.get(X.SIZE);S=$.length;const N=n.size;C=s;for(let z=0;z<S;++z){const U=P[2*$[z]],j=P[2*$[z]+1];for(let G=0;G<6;++G)N.set(C,0,U),N.set(C,1,j),C++}if(r.attributes.get(X.AUXPOS1)?GS(r.attributes.get(X.AUXPOS1),n.auxpos1,s,6):hae(n.auxpos1,s,6*S),r.attributes.get(X.FEATUREATTRIBUTE)?GS(r.attributes.get(X.FEATUREATTRIBUTE),n.featureAttribute,s,6):hae(n.featureAttribute,s,6*S),r.objectAndLayerIdColor!=null){const z=r.attributes.get(X.POSITION)?.indices;if(z){const U=z.length,j=n.getField(X.OBJECTANDLAYERIDCOLOR,ja);OTe(r.objectAndLayerIdColor,j,U,s,6)}}}};const nf=H(),v3=ji(),gC=ji(),Gk=H(),Sit=Ze(),Eit=as(),Hk=oo(),Cit=H(),Ait=Di();class Oit{constructor(){this.aabr=Di(),this.distance=0,this.culled=!1,this.visible=!1}}class Rit{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this.info={}}}var wc;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(wc||(wc={}));class GTe{constructor(){this.camera=new Kt,this.slicePlane=zg(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),Aw(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let bT=class extends Ke{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new GTe,this._state=wc.Idle,this._active=new Map,this._visible=new Map,this._iterators=new $it,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==wc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/wc.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case wc.Idle:this._startUpdate(),t.madeProgress();case wc.Process:if(this._state=wc.Process,!this._processActiveGraphics(t))return;case wc.Sort:if(this._state=wc.Sort,!this._sortVisibleGraphics(t))return;case wc.Deconflict:if(this._state=wc.Deconflict,!this._deconflictVisibleGraphics(t))return;default:vtt(this,this._visible),this._state=wc.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;return(e?.geometries.length??0)!==1?!1:e?.geometries[0]?.material instanceof HS}_startUpdate(){_tt(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new Oit,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),Mit(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=cE(Sit,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?Eit:null;let n=0;for(r!=null&&(wt(r,Mo,this._runningViewState.camera.viewMatrix),r[3]=Mr(this.view.spatialReference).radius,n=rbe(r,Mo));!t.done;){t.madeProgress();const s=e.next();if(s.done===!0)return this._resetActiveGraphicsIterator(),!0;const a=s.value,u=a?.info[this.visibilityGroup];u&&(this._collectGraphics3DGraphics(a,i,r,n),u.culled?this._visible.delete(a.graphics3DGraphic.graphic.uid):this._visible.set(a.graphics3DGraphic.graphic.uid,a))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const i=e.next();if(t.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===Co.LABEL;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const n=r.value,s=n.info[this.visibilityGroup];if(!s||s.culled){this._setGraphicVisibility(n,!1);continue}const a=n.graphics3DGraphic,u=!i||a.isVisible();s.visible=u&&!this._isConflicted(n),s.visible&&this._addToBins(n),this._setGraphicVisibility(n,s.visible),wtt(s,s.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=mae(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=mae(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=Pit(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,i,r){const n=t.graphics3DGraphic;if(n.destroyed)return;const s=t.info[this.visibilityGroup];if(!n.isVisible(Co.GRAPHIC,da.DECONFLICTION))return void(s.culled=!0);const a=this.getGraphicsLayers(n);rd(s.aabr);let u=null;for(const p of a){if(!this.layerSupportsDeconfliction(p))continue;const y=p.stageObject.geometries[0].material;if(u==null&&(u=Nit,this._getProjectionInfo(p,e,u),u.isOutsideScreen||this._isCulledBySlice(t,nf)||i!=null&&this._isCulledByHorizon(u,i,r)))return void(s.culled=!0);this._expandBoundingRect(s,p,y,u)}u==null?s.culled=!0:(s.distance=u.distance,s.culled=!1)}_getProjectionInfo(t,e,i){const r=this._runningViewState.camera,n=t.stageObject,s=n.geometries[0],a=s.material,u=n.boundingVolumeWorldSpace.bounds;wt(nf,u,r.viewMatrix);const p=s.attributes,y=p.get(X.NORMAL).data,b=p.get(X.AUXPOS1).data;a.applyShaderOffsetsView(nf,y,n.transformation,b,r,i.scaleInfo,nf),_n(v3,nf[0],nf[1],nf[2],1),Nu(gC,v3,r.projectionMatrix),Pe(i.positionNDC,gC,1/gC[3]),a.applyShaderOffsetsNDC(i.positionNDC,b,r,i.positionNDC,Gk),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(Gk[2]),i.distance=Gk[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),_n(gC,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),Nu(v3,gC,e),B2(v3,v3,1/v3[3]),$e(i.positionView,nf[0],nf[1],nf[2])}_isCulledByHorizon(t,e,i){return Ie(Hk.direction,t.positionView),$e(Hk.origin,0,0,0),!!Fv(e,Hk,Cit)&&t.distanceWithoutPolygonOffset>i}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&vZ(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,i,{positionNDC:r,scaleInfo:n}){const s=this._runningViewState.camera,a=e.getScreenSize(Lit);sTe(a,n.factor,a),a[0]*=s.pixelRatio,a[1]*=s.pixelRatio;const u=oL(i.calculateRelativeScreenBounds(a,n.factorAlignment.scale,Ait),si(0,s.fullWidth,.5+.5*r[0]),si(0,s.fullHeight,.5+.5*r[1])),p=this.marginFactor;if(p!==0){const y=p*Math.min(Na(u),Jl(u));u[0]-=y,u[1]-=y,u[2]+=y,u[3]+=y}Yy(t.aabr,u,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,i=t.info[this.visibilityGroup];let r=!0;for(let n=Math.floor(i.aabr[0]/this._accBinsSizeX);n<=Math.floor(i.aabr[2]/this._accBinsSizeX);n++)if(!(n<0||n>=this._accBinsNumX))for(let s=Math.floor(i.aabr[1]/this._accBinsSizeY);s<=Math.floor(i.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;r=!1;const a=this._accBins[n][s];for(let u=0;u<a.length;u++){const p=a.data[u],y=p.info[this.visibilityGroup];if(y&&y.visible&&p.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,GD(y.aabr,i.aabr)))return!0}}return r}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let n=0;n<this._accBinsNumY;n++)r.push(new xi)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],i=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),n=Math.floor(e.aabr[1]/this._accBinsSizeY),s=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let a=i;a<=r;a++)if(!(a<0||a>=this._accBinsNumX))for(let u=n;u<=s;u++)u<0||u>=this._accBinsNumY||this._accBins[a][u].push(t)}_setGraphicVisibility(t,e){const i=t.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(this.visibilityGroup,da.DECONFLICTION,e),this.visibilityGroup===Co.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function Mit(t,e){const i=t.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(e,da.DECONFLICTION,!0)}function*mae(t){if(Map.prototype.entries){const e=t.entries();for(let i=e.next();!i.done;i=e.next())yield i.value[1]}else yield*t.values()}function*Pit(t,e,i){e.clear(),t.forEach((n,s)=>{const a=e.pushNew();a.id=s,a.visible=n.graphics3DGraphic.getVisibilityFlag(i,da.DECONFLICTION);const u=n.info?.[i];a.prio=n.graphics3DGraphic.deconflictionPriority,a.distance=u?u.distance:Number.MAX_VALUE}),yield;const r=e.iterableSort((n,s)=>n.prio!==s.prio?s.prio-n.prio:n.distance!==s.distance?n.distance-s.distance:n.visible!==s.visible?n.visible?-1:1:n.id-s.id);for(let n=r.next();!n.done;n=r.next())yield;e.forAll(n=>{const s=t.get(n.id);s&&(t.delete(n.id),t.set(n.id,s))}),e.clear()}_([T({constructOnly:!0})],bT.prototype,"view",void 0),_([T({type:Boolean,readOnly:!0})],bT.prototype,"updating",null),bT=_([Z("esri.views.3d.layers.graphics.Deconflictor")],bT);class Iit{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class $it{constructor(e=null,i=null,r=null){this.active=e,this.visible=i,this.sort=r,this.sortArray=new xi({allocator:n=>n||new Iit})}}const Lit=Ct();class Dit{constructor(){this.positionView=H(),this.positionNDC=H(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new ETe}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const Nit=new Dit,Fit=2e3;let R$=class extends bT{constructor(e){super(e),this.visibilityGroup=Co.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return ya.YIELD;const i=performance.now();if(e.state!==yr.IDLE&&i-this._lastDeconfliction<Fit)return ya.YIELD;super.runTask(e),this.state===wc.Idle&&(this._lastDeconfliction=i)}enabledChanged(e,i){this.modifyGraphics(i,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};_([T({constructOnly:!0})],R$.prototype,"parent",void 0),R$=_([Z("esri.views.3d.layers.graphics.LabelDeconflictor")],R$);let uq=class extends bT{constructor(){super(...arguments),this._contexts=new Map,this._viewState=new GTe,this.visibilityGroup=Co.GRAPHIC,this._marginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([Fe(()=>this.view?.state?.camera,()=>{this._updateViewState(),this.setDirty()}),Fe(()=>this.view?.map?.ground?.opacity,(e,i)=>{e!==1&&i!==1||this.setDirty()}),Fe(()=>this.view?.slicePlane,()=>{this._updateSlicePlane(),this._slicePlaneChanged()},jr)]),this._frameTask=this.view.resourceController.scheduler.registerTask(Zt.GRAPHICS_DECONFLICTOR,this),this._labels=new R$({view:this.view,parent:this})}destroy(){this._labels=ct(this._labels),this._frameTask=nn(this._frameTask)}get marginFactor(){return this._marginFactor}set marginFactor(e){this._marginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,i){const r=!(this._graphicSupportsDeconfliction(i)&&qk(e));i.setVisibilityFlag(Co.GRAPHIC,da.DECONFLICTION,r)}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&ybe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){Iu(this._contexts,(e,i)=>i.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labels.enabledChanged(e,i),featureReductionChange:()=>this.enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic))}}removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const n=r.graphic.uid,s=new Rit(r,e.symbolCreationContext.slicePlaneEnabled);i.set(n,s),qk(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,i){const r=i.graphic.uid,n=e.get(r);n&&(this.removeFromActiveGraphics(n),this._labels.removeFromActiveGraphics(n),e.delete(r),this.setDirty())}enabledChanged(e,i){const r=qk(e);r||kit(e),this.modifyGraphics(i,r)}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(n=>n.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!i?.length)return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function qk(t){const e=t.layer;return!(!e?.featureReduction||e.featureReduction.type!=="selection")}function kit(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.setVisibilityFlag(Co.GRAPHIC,da.DECONFLICTION,!0))}uq=_([Z("esri.views.3d.layers.graphics.GraphicsDeconflictor")],uq);function HTe(t){return"declaredClass"in t}function gae(t){return"declaredClass"in t}function zit(t){return"declaredClass"in t}function Uit(t,e){return t?zit(t)?t:new Fp({layer:e,sourceLayer:e,visible:t.visible,symbol:Ce(t.symbol),attributes:Ce(t.attributes),geometry:qTe(t.geometry)}):null}function qTe(t){return t==null?null:HTe(t)?t:E0(jit(t))}function jit(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:n}=t.spatialReference,s={wkid:e,wkt:i,wkt2:r,latestWkid:n};switch(t.type){case"point":{const{x:a,y:u,z:p,m:y}=t;return{x:a,y:u,z:p,m:y,spatialReference:s}}case"polygon":{const{rings:a,hasZ:u,hasM:p}=t;return{rings:yae(a),hasZ:u,hasM:p,spatialReference:s}}case"polyline":{const{paths:a,hasZ:u,hasM:p}=t;return{paths:yae(a),hasZ:u,hasM:p,spatialReference:s}}case"extent":{const{xmin:a,xmax:u,ymin:p,ymax:y,zmin:b,zmax:S,mmin:C,mmax:O,hasZ:P,hasM:$}=t;return{xmin:a,xmax:u,ymin:p,ymax:y,zmin:b,zmax:S,mmin:C,mmax:O,hasZ:P,hasM:$,spatialReference:s}}case"multipoint":{const{points:a,hasZ:u,hasM:p}=t;return{points:XTe(a)?WTe(a):a,hasZ:u,hasM:p,spatialReference:s}}default:return}}function yae(t){return Bit(t)?t.map(e=>WTe(e)):t}function WTe(t){return t.map(e=>Array.from(e))}function Bit(t){for(const e of t)if(e.length!==0)return XTe(e);return!1}function XTe(t){return t.length>0&&(nE(t[0])||sE(t[0]))}function Vit(t,e){if(!t)return null;let i;if(gae(t)){if(e==null)return t.clone();if(gae(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=kv(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function M8t(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:n}=t,s={wkid:e,wkt:i,wkt2:r,latestWkid:n};return dt.fromJSON(s)}const QK="__begin__",eQ="__end__",Git=new RegExp(QK,"ig"),Hit=new RegExp(eQ,"ig"),vae=new RegExp("^"+QK,"i"),_ae=new RegExp(eQ+"$","i"),u8='"',qit=u8+" + ",Wit=" + "+u8;function Xit(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function Jit(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function nN(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=Xit(t.labelExpression),e.type="conventional"),e}function Yit(t){const e=nN(t);if(!e)return null;switch(e.type){case"conventional":return hq(e.expression);case"arcade":return e.expression}return null}function Zit(t){const e=nN(t);if(!e)return null;switch(e.type){case"conventional":return Qit(e.expression);case"arcade":return tQ(e.expression)}return null}function hq(t){let e;return t?(e=vD(t,i=>QK+'$feature["'+i+'"]'+eQ),e=vae.test(e)?e.replace(vae,""):u8+e,e=_ae.test(e)?e.replace(_ae,""):e+u8,e=e.replaceAll(Git,qit).replaceAll(Hit,Wit)):e='""',e}const Kit=/^\s*\{([^}]+)\}\s*$/i;function Qit(t){return t?.match(Kit)?.[1].trim()||null}const ert=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,trt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,irt=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function tQ(t){if(!t)return null;let e=ert.exec(t)||trt.exec(t);return e?e[1]||e[3]:(e=irt.exec(t),e?e[2]:null)}const Wk=Ee.getLogger("esri.layers.support.labelFormatUtils"),Xk={type:"simple",evaluate:()=>null},rrt={getAttribute:(t,e)=>t.field(e)};async function JTe(t,e,i){if(!t||!t.symbol||!e)return Xk;const r=t.where,n=nN(t);let s;if(n.type==="arcade"){const a=await Sze(n.expression,i,e);if(a==null)return Xk;s={type:"arcade",evaluate(u,p){try{const y="attributes"in u?a.repurposeFeature(u):u;y.contextTimeZone=p??null;const b=a.evaluate({$view:{timeZone:p},$feature:y},a.services);if(b!=null)return b.toString()}catch(y){Wk.error(new de("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:y,feature:u,expression:n}))}return null},needsHydrationToEvaluate:()=>tQ(n.expression)==null}}else s={type:"simple",evaluate:a=>n.expression.replaceAll(/{[^}]*}/g,u=>{const p=u.slice(1,-1),y=e.get(p);if(!y)return u;let b=null;return"attributes"in a?a&&a.attributes&&(b=a.attributes[y.name]):b=a.field(y.name),b==null?"":YTe(b,y)})};if(r){let a;try{a=await MY(r,e)}catch(p){return Wk.error(new de("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:p})),Xk}const u=s.evaluate;s.evaluate=(p,y)=>{const b="attributes"in p?void 0:rrt;try{if(a.testFeature(p,b))return u(p,y)}catch(S){Wk.error(new de("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:p,error:S}))}return null}}return s}function YTe(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const n=t;for(const s of i.codedValues)if(s.code===n)return s.name}else if(i.type==="range"){const{max:n,min:s}=Sve(e),a=+t;if(s!=null&&n!=null&&s<=a&&a<=n)return i.name}}let r=t;return Ive(e)?r=pv(r,oze("short-date")):BY(e)&&(r=V4(+r)),r||""}const P8t=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:JTe,formatField:YTe},Symbol.toStringTag,{value:"Module"}));function iQ(t,e){if(t.type==="point")return w1(t,e,!1);if(HTe(t))switch(t.type){case"extent":return w1(t.center,e,!1);case"polygon":return w1(t.centroid,e,!1);case"polyline":return w1(bae(t),e,!0);case"mesh":return w1(t.origin,e,!1)}else switch(t.type){case"extent":return w1(nrt(t),e,!0);case"polygon":return w1(srt(t),e,!0);case"polyline":return w1(bae(t),e,!0)}}function bae(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=Kge(e,Zge(e)/2);return kv(i[0],i[1],i[2],t.spatialReference)}function nrt(t){return kv(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function srt(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=Qge(t.rings,!!t.hasZ);return kv(i[0],i[1],i[2],t.spatialReference)}function w1(t,e,i){const r=i?t:Vit(t);return e&&t?F1e(t,r,e)?r:null:r}function I8t(t,e,i,r=0){if(t){e||(e=Di());const n=t;let s=.5*n.width*(i-1),a=.5*n.height*(i-1);return n.width<1e-7*n.height?s+=a/20:n.height<1e-7*n.width&&(a+=s/20),_n(e,n.xmin-s-r,n.ymin-a-r,n.xmax+s+r,n.ymax+a+r),e}return null}function ZTe(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute(X.AUXPOS1);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[i],X.AUXPOS1))}}function t4(t,e,i=null){const r=aR(Bh);return t!=null&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),e!=null?r[3]=e:t!=null&&t.length>3&&(r[3]=t[3]),i&&(r[0]*=i,r[1]*=i,r[2]*=i,r[3]*=i),r}function $8t(t,e,i,r,n,s=[0,0,0,0]){for(let a=0;a<3;++a)s[a]=t?.[a]!=null?t[a]:i?.[a]!=null?i[a]:n[a];return s[3]=e??r??n[3],s}function wae(t=rg,e,i,r=1){const n=new Array(3);if(e==null||i==null)n[0]=1,n[1]=1,n[2]=1;else{let s,a=0;for(let u=2;u>=0;u--){const p=t[u];let y;const b=p!=null,S=u===0&&!s&&!b,C=i[u];p==="symbol-value"||S?y=C!==0?e[u]/C:1:b&&p!=="proportional"&&isFinite(p)&&(y=C!==0?p/C:1),y!=null&&(n[u]=y,s=y,a=Math.max(a,Math.abs(y)))}for(let u=2;u>=0;u--)n[u]==null?n[u]=s:n[u]===0&&(n[u]=.001*a)}for(let s=2;s>=0;s--)n[s]/=r;return Ma(n)}function ort(t){return t.isPrimitive!=null}function sN(t){return dq(ort(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function dq(t){const e=i=>i==null||i>=0;return Array.isArray(t)?t.every(e):e(t)}function art(t,e,i,r=Ze()){return t&&pS(r,r,-t/180*Math.PI),e&&dS(r,r,e/180*Math.PI),i&&FD(r,r,i/180*Math.PI),r}function rQ(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=Va(e),n=ww(t)*r,s=xw(t)*r,a=Dv(t)*(e.isGeographic?1:r);return n===0&&s===0&&a===0?i.minDemResolutionForPoints:.01*Math.max(n,s,a)}function KTe(t,e,i,r,n,s,a,u,p,y,b){const S=mrt[b.mode];let C,O,P=0;if(Mn(t,e,i,r,p.spatialReference,n,u))return S.requiresAlignment(b)?(P=S.applyElevationAlignmentBuffer(r,n,s,a,u,p,y,b),C=s,O=a):(C=r,O=n),Mn(C,p.spatialReference,O,s,y.spatialReference,a,u)?P:void 0}function Sv(t,e,i,r,n){const s=(NL(t)?t.z:g2e(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const a=a0(e,t,"ground")??0;return n.verticalDistanceToGround=0,n.sampledElevation=a,void(n.z=a)}case"relative-to-ground":{const a=a0(e,t,"ground")??0,u=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=u,n.sampledElevation=a,void(n.z=u+a)}case"relative-to-scene":{const a=a0(e,t,"scene")??0,u=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=u,n.sampledElevation=a,void(n.z=u+a)}case"absolute-height":{const a=i.geometryZWithOffset(s,r),u=a0(e,t,"ground")??0;return n.verticalDistanceToGround=a-u,n.sampledElevation=u,void(n.z=a)}default:return void(n.z=0)}}function lrt(t,e,i,r){return Sv(t,e,i,r,wT),wT.z}function xR(t,e,i){return e==null||i==null?t.definedChanged:e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?Hn.UPDATE:t.onTheGroundChanged}function hd(t){return t==="relative-to-ground"||t==="relative-to-scene"}function Ev(t){return t!=="absolute-height"}function crt(t,e,i,r,n){Sv(e,i,n,r,wT),ZTe(t,wT.verticalDistanceToGround);const s=wT.sampledElevation,a=bs(grt,t.transformation);return MP[0]=e.x,MP[1]=e.y,MP[2]=wT.z,jc(e.spatialReference,MP,a,r.spatialReference)?t.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function urt(t,e,i,r,n,s){let a=0;const u=s.spatialReference;e*=3,r*=3;for(let p=0;p<n;++p){const y=t[e],b=t[e+1],S=t[e+2],C=s.getElevation(y,b,S,u,"ground")??0;a+=C,i[r]=y,i[r+1]=b,i[r+2]=C,e+=3,r+=3}return a/n}function hrt(t,e,i,r,n,s,a,u){let p=0;const y=u.calculateOffsetRenderUnits(a),b=u.featureExpressionInfoContext,S=s.spatialReference;e*=3,r*=3;for(let C=0;C<n;++C){const O=t[e],P=t[e+1],$=t[e+2],N=s.getElevation(O,P,$,S,"ground")??0;p+=N,i[r]=O,i[r+1]=P,i[r+2]=b==null?$+N+y:N+y,e+=3,r+=3}return p/n}function drt(t,e,i,r,n,s,a,u){let p=0;const y=u.calculateOffsetRenderUnits(a),b=u.featureExpressionInfoContext,S=s.spatialReference;e*=3,r*=3;for(let C=0;C<n;++C){const O=t[e],P=t[e+1],$=t[e+2],N=s.getElevation(O,P,$,S,"scene")??0;p+=N,i[r]=O,i[r+1]=P,i[r+2]=b==null?$+N+y:N+y,e+=3,r+=3}return p/n}function prt(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function frt(t,e,i,r,n,s,a,u){const p=u.calculateOffsetRenderUnits(a),y=u.featureExpressionInfoContext;e*=3,r*=3;for(let b=0;b<n;++b){const S=t[e],C=t[e+1],O=t[e+2];i[r]=S,i[r+1]=C,i[r+2]=y==null?O+p:p,e+=3,r+=3}return 0}let TR=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var Hn;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(Hn||(Hn={}));const mrt={"absolute-height":{applyElevationAlignmentBuffer:frt,requiresAlignment:prt},"on-the-ground":{applyElevationAlignmentBuffer:urt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:hrt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:drt,requiresAlignment:()=>!0}},grt=Ze(),wT=new TR,MP=H();function nQ(t){return t.mapPositions!=null}function QTe(t,e,i,r,n){const s=t.stageObject,a=s.geometries;let u=0;for(const p of a){if(!nQ(p))continue;const{update:y,averageGeometrySampledElevation:b}=tSe(p,e,i,r,n);u+=b,y&&s.geometryVertexAttributeUpdated(p,X.POSITION)}return u/a.length}function C2(t,e,i,r,n,s){const a=t.stageObject,u=e.centerPointInElevationSR;let p=0;a.usesVerticalDistanceToGround?(r(u,ql),ZTe(a,ql.verticalDistanceToGround),p=ql.sampledElevation):(r(u,ql),e.mode!=="absolute-height"&&(p=ql.sampledElevation));const y=bs(yrt,s??a.transformation),b=$e(eSe,y[12],y[13],y[14]);Xr.TESTS_DISABLE_OPTIMIZATIONS?(Hl[0]=u.x,Hl[1]=u.y,Hl[2]=ql.z,jc(u.spatialReference,Hl,y,n.spatialReference)&&(s?bs(s,y):a.transformation=y)):n.setAltitudeOfTransformation(ql.z,y);const S=sQ/n.unitInMeters;return(Math.abs(y[12]-b[0])>=S||Math.abs(y[13]-b[1])>=S||Math.abs(y[14]-b[2])>=S)&&(s?bs(s,y):a.transformation=y),p}const yrt=Ze();function vrt(t,e,i,r,n){const s=t.graphics3DSymbolLayer.lodRenderer;if(s==null)return 0;const a=e.centerPointInElevationSR;r(a,ql);const u=e.mode!=="absolute-height"?ql.sampledElevation:0,p=s.instanceData,y=t.instanceIndex,b=brt;p.getGlobalTransform(y,b);const S=$e(eSe,b[12],b[13],b[14]);Xr.TESTS_DISABLE_OPTIMIZATIONS?(Hl[0]=a.x,Hl[1]=a.y,Hl[2]=ql.z,jc(a.spatialReference,Hl,b,n.spatialReference)&&p.setGlobalTransform(y,b)):n.setAltitudeOfTransformation(ql.z,b);const C=sQ/n.unitInMeters;return(Xr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(b[12]-S[0])>=C||Math.abs(b[13]-S[1])>=C||Math.abs(b[14]-S[2])>=C)&&p.setGlobalTransform(y,b),u}function _rt(t,e,i,r,n){const s=t.stageObject,a=s.geometries;if(a.length===0)return 0;let u=0,p=null,y=0,b=!1;for(const S of a){if(!nQ(S))continue;const C=S.attributes.get(X.POSITION);if(C!==p){const{update:O,averageGeometrySampledElevation:P}=tSe(S,e,i,r,n);y=P,p=C,b=O}b&&s.geometryVertexAttributeUpdated(S,X.POSITION),u+=y}return u/a.length}const sQ=.01,Hl=H(),lh=H(),_3=H(),brt=Ze(),eSe=H(),ql=new TR;function tSe(t,e,i,r,n){let s=!1;const a=t.transformation,u=e.requiresSampledElevationInfo;lh[0]=a[12],lh[1]=a[13],lh[2]=a[14],t.invalidateBoundingInfo();const p=t.getMutableAttribute(X.POSITION),y=p.data,b=p.size,S=y.length/b,C=new zZ(t.mapPositions,i);let O=0,P=0;for(let $=0;$<S;$++){if(_3[0]=y[O],_3[1]=y[O+1],_3[2]=y[O+2],r(C,ql),u&&(P+=ql.sampledElevation),Xr.TESTS_DISABLE_OPTIMIZATIONS)y[O]=C.array[C.offset],y[O+1]=C.array[C.offset+1],y[O+2]=ql.z,Mn(y,i,O,y,n.spatialReference,O,1),y[O]-=lh[0],y[O+1]-=lh[1],y[O+2]-=lh[2],s=!0;else{Hl[0]=y[O]+lh[0],Hl[1]=y[O+1]+lh[1],Hl[2]=y[O+2]+lh[2],n.setAltitude(Hl,ql.z),y[O]=Hl[0]-lh[0],y[O+1]=Hl[1]-lh[1],y[O+2]=Hl[2]-lh[2];const N=sQ/n.unitInMeters;(Math.abs(_3[0]-y[O])>=N||Math.abs(_3[1]-y[O+1])>=N||Math.abs(_3[2]-y[O+2])>=N)&&(s=!0)}O+=b,C.offset+=3}return P/=S,{update:s,averageGeometrySampledElevation:P}}function wrt(t){return!!t&&jS[t]!=null}function xrt(t){return 1/(jS[t]||1)}function Trt(){const t=Object.keys(jS);return t.sort(),t}const Srt=Trt(),Ert=Ee.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Crt(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function D8t(t){const e=t?.expression;if(typeof e=="string"){const i=nSe(e);if(i!=null)return{cachedResult:i}}return null}async function N8t(t,e,i,r){const n=t?.expression;if(typeof n!="string")return null;const s=nSe(n);if(s!=null)return{cachedResult:s};const a=await fv();oi(i);const u=a.arcadeUtils,p=u.createSyntaxTree(n);return u.dependsOnView(p)?(r?.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:u.createFunction(p),context:u.createExecContext(null,{sr:e}),modules:a}}}function iSe(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function oN(t,e){if(t!=null&&!rSe(t)){if(!e||!t.arcade)return void Ert.errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=qTe(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function Art(t){if(t!=null){if(rSe(t))return t.cachedResult;const e=t.arcade;let i=e?.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function F8t(t,e=!1){let i=t?.featureExpressionInfo;const r=i?.expression;return e||r==="0"||(i=null),i??null}const Ort={cachedResult:0};function rSe(t){return t.cachedResult!=null}function nSe(t){return t==="0"?0:null}let h8=class sSe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=xrt(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=Art(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=wrt(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,i,r){if(e==null)return void(this._featureExpressionInfoContext=null);const n=e?.arcade;n&&i!=null&&r!=null?(this._featureExpressionInfoContext=Crt(e),oN(this._featureExpressionInfoContext,iSe(n.modules,i,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const i=new sSe;return e!=null&&i.setFromElevationInfo(e),i}},Rrt=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}};var Pi;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(Pi||(Pi={}));let Mrt=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterials=i,this.properties=r}},H0=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,i,r,n,s,a,u,p=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=n,this._sharedResource=s,this.elevationAligner=a,this.elevationContext=u,this._edgeState=p,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const i=e.stage;i.addMany(this._uniqueMaterials),i.addMany(this._uniqueGeometries),i.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=e.renderer.edgeView;i?.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,i){if(this._edgeState==null)return;const r=xae(this._edgeState.baseMaterial);let n=!1;for(const s of this._edgeState.edgeMaterials)s.objectTransparency!==r&&(s.objectTransparency=r,n=!0);n&&this.resetEdgeObject(i),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,i){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!i),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const i=this._stageLayer.stage.renderer.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(e,i,r,n){if(this.elevationAligner==null)return;r!=null&&oN(this.elevationContext.featureExpressionInfoContext,r);const s=(a,u)=>Sv(a,e,this.elevationContext,i,u);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,i),this.resetEdgeObject(n)}alignWithAbsoluteElevation(e,i,r){const n=(s,a)=>{a.sampledElevation=e,a.verticalDistanceToGround=0,a.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,n,i),this.resetEdgeObject(r)}getCenterObjectSpace(e=H()){return Ie(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=eo()){const i=this.stageObject.boundingVolumeObjectSpace;return Yve(e,i.min),Zve(e,i.max),e}computeAttachmentOrigin(e){const i=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(tm)&&(wt(tm,tm,i),Ue(e.render.origin,e.render.origin,tm),e.render.num++)}async getProjectedBoundingBox(e,i,r,n,s){const a=this.getBoundingBoxObjectSpace(s),u=Prt,p=KY(a)?1:u.length;for(let b=0;b<p;b++){const S=u[b];x1[0]=a[S[0]],x1[1]=a[S[1]],x1[2]=a[S[2]],wt(x1,x1,this.stageObject.transformation),o_[3*b]=x1[0],o_[3*b+1]=x1[1],o_[3*b+2]=x1[2]}if(!e(o_,0,p))return null;cn(a);let y=null;this.calculateRelativeScreenBounds&&(y=this.calculateRelativeScreenBounds());for(let b=0;b<3*p;b+=3){for(let S=0;S<3;S++)a[S]=Math.min(a[S],o_[b+S]),a[S+3]=Math.max(a[S+3],o_[b+S]);y&&r.push({location:o_.slice(b,b+3),screenSpaceBoundingRect:y})}if(i?.service&&this.elevationContext.mode!=="absolute-height"){yp(a,tm);const b=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let S=0;if(i.useViewElevation)S=i.service.getElevation(tm[0],tm[1],b)??0;else try{const C=rQ(a,i.service.spatialReference,i);S=await i.service.queryElevation(tm[0],tm[1],n,C,b)??0}catch{}Jve(a,0,0,-this.alignedSampledElevation+S)}return a}addObjectState(e,i){e===Pg.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),e===Pg.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(this._edgeState==null)return;const i=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,e):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,i){const r=this._edgeState;if(r==null)return;const n=xae(r.baseMaterial);for(const s of r.edgeMaterials)s.objectTransparency=n;e.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>this._stageLayer?.sync())}};function xae(t){return t.isVisible()?t.parameters.transparent?Pi.TRANSPARENT:Pi.OPAQUE:Pi.INVISIBLE}const o_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x1=H(),tm=H(),Prt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let oSe=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=e??0}};const aSe=3,pq=3,lSe=10;let cSe=class{constructor(e,i=null){this.geometry=e,this.textures=i}},uSe=class{constructor(e,i,r){this.components=e,this.minScreenSpaceRadius=i,this.pivotOffset=r;const n=this.geometries;this.numVertices=n.reduce((s,a)=>s+a.attributes.get(X.POSITION).indices.length,0)}get geometries(){return fD(this.components.map(e=>e.geometry))}},hSe=class{constructor(e){this.levels=e,this.levels.sort((i,r)=>i.minScreenSpaceRadius===r.minScreenSpaceRadius?i.numVertices-r.numVertices:i.minScreenSpaceRadius-r.minScreenSpaceRadius)}};function PP(t){const e=[];return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),fD(e)}function Tae(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>{r.textures!=null&&e.push(...r.textures)})),fD(e)}function Sae(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry))),fD(e)}function Irt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function dSe(t,e){const i=(r,n,s=!1)=>new hSe(r.map(a=>{const u=n(a.tesselation);return s&&hZe(u),new uSe([new cSe(u)],a.minScreenSpaceRadius)}));switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>lZe(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>QYe(e,1));case"cone":return i(Jk,r=>Gse(e,1,.5,r,!1),!0);case"inverted-cone":return i(Jk,r=>Gse(e,1,.5,r,!0),!0);case"cylinder":return i(Jk,r=>uZe(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>aZe(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>rZe(e,1),!0);default:return}}const Jk=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let Ih=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new pSe}},oQ=class extends Ih{constructor(e){super(e),this.estimated=!0}},$rt=class extends Ih{constructor(e,i){super(i),this.numComplexities=e}},Lrt=class extends oQ{constructor(e,i){super(i),this.numComplexities=e}},pSe=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function Drt(t){return t.type==="fill"}function Nrt(t){return t.type==="extrude"}function Frt(t){return t&&t.enabled&&(Nrt(t)||Drt(t))&&t.edges!=null}function krt(t){return t&&t.enabled&&t.edges||null}function fSe(t,e){return zrt(krt(t),e)}function zrt(t,e){if(t==null)return null;const i=t.color!=null?lZ(mt.toUnitRGBA(t.color)):vi(0,0,0,0),r=Xo(t.size),n=Xo(t.extensionLength);switch(t.type){case"solid":return Urt({color:i,size:r,extensionLength:n,...e});case"sketch":return jrt({color:i,size:r,extensionLength:n,...e});default:return}}function Urt(t){return{...Brt,...t,type:"solid"}}function jrt(t){return{...Vrt,...t,type:"sketch"}}const Brt={color:vi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Pi.OPAQUE,hasSlicePlane:!1},Vrt={color:vi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Pi.OPAQUE,hasSlicePlane:!1};function SR(t,e){switch(e.normalType){case _r.Compressed:t.attributes.add(X.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(F`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case _r.Attribute:t.attributes.add(X.NORMAL,"vec3"),t.vertex.code.add(F`vec3 normalModel() {
return normal;
}`);break;case _r.ScreenDerivative:t.fragment.code.add(F`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case _r.COUNT:case _r.Ground:}}var _r;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(_r||(_r={}));function mSe(t,e){const i=t.fragment;switch(i.code.add(F`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case kn.None:i.code.add(F`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case kn.View:i.code.add(F`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case kn.WindingOrder:i.code.add(F`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case kn.COUNT:}}var kn;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(kn||(kn={}));let ME=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get(X.POSITION).indices.length}write(e,i,r,n,s){Qtt(r,this.vertexBufferLayout,e,i,n,s)}};function aN(t,e){switch(e.normalType){case _r.Attribute:case _r.Compressed:t.include(SR,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new rO("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new Xp("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),t.vertex.code.add(F`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case _r.Ground:t.include(zT,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(F`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?F`normalize(vPositionWorldCameraRelative);`:F`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case _r.ScreenDerivative:t.vertex.code.add(F`void forwardNormal() {}`);break;default:e.normalType;case _r.COUNT:}}let gSe=class extends S3e{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Pn()}},ySe=class extends E3e{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Pn(),this.toMapSpace=ji()}};const aQ={func:Tr.LESS},d8={func:Tr.ALWAYS},P0={mask:255},vSe={mask:0},Grt=t=>({function:{func:Tr.NOTEQUAL,ref:t,mask:t},operation:{fail:Rn.KEEP,zFail:Rn.KEEP,zPass:Rn.KEEP}}),Hrt=t=>({function:{func:Tr.ALWAYS,ref:t,mask:t},operation:{fail:Rn.KEEP,zFail:Rn.KEEP,zPass:Rn.REPLACE}}),Gv={function:{func:Tr.ALWAYS,ref:Kl.OutlineVisualElementMask,mask:Kl.OutlineVisualElementMask},operation:{fail:Rn.KEEP,zFail:Rn.KEEP,zPass:Rn.ZERO}},Cv={function:{func:Tr.ALWAYS,ref:Kl.OutlineVisualElementMask,mask:Kl.OutlineVisualElementMask},operation:{fail:Rn.KEEP,zFail:Rn.KEEP,zPass:Rn.REPLACE}},_Se={function:{func:Tr.EQUAL,ref:Kl.OutlineVisualElementMask,mask:Kl.OutlineVisualElementMask},operation:{fail:Rn.KEEP,zFail:Rn.KEEP,zPass:Rn.KEEP}},bSe={function:{func:Tr.NOTEQUAL,ref:Kl.OutlineVisualElementMask,mask:Kl.OutlineVisualElementMask},operation:{fail:Rn.KEEP,zFail:Rn.KEEP,zPass:Rn.KEEP}};function wSe({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:n,emissiveFactor:s,occlusionTexture:a}){return t==null&&e==null&&n==null&&(s==null||pa(s,Mo))&&a==null&&(r==null||r===1)&&(i==null||i===1||i===0)}const lN=[1,1,.5],lQ=[0,.6,.2],qrt=[0,1,.2];function xSe(t){t.vertex.code.add(F`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}var Xs;function Wrt(t){switch(t){case"multiply":default:return Xs.Multiply;case"ignore":return Xs.Ignore;case"replace":return Xs.Replace;case"tint":return Xs.Tint}}function TSe(t,e,i){if(t==null||e===Xs.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=Je(Math.round(t[3]*p8),0,p8),n=r===0||e===Xs.Tint?0:e===Xs.Replace?Xrt:Jrt;i[0]=Je(Math.round(t[0]*b3),0,b3),i[1]=Je(Math.round(t[1]*b3),0,b3),i[2]=Je(Math.round(t[2]*b3),0,b3),i[3]=r+n}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Xs||(Xs={}));const b3=255,p8=85,Xrt=p8,Jrt=2*p8;function SSe(t){t.vertex.code.add(F`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${F.int(Xs.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${F.int(Xs.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${F.int(Xs.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${F.int(Xs.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let ER=class extends zn{constructor(e,i){super(e,"int",hr.Pass,(r,n,s)=>r.setUniform1i(e,i(n,s)))}};function ESe(t,e){e.hasSymbolColors?(t.include(SSe),t.attributes.add(X.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(F`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new ER("colorMixMode",i=>TTe[i.colorMixMode])),t.vertex.code.add(F`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function Dw(t,e){e.hasVertexColors?(t.attributes.add(X.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(F`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(F`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(F`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function CSe(t){t.code.add(F`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function $g(t,e){switch(e.output){case oe.Shadow:case oe.ShadowHighlight:case oe.ShadowExcludeHighlight:t.fragment.include(CSe),t.fragment.code.add(F`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`);break;case oe.Depth:t.fragment.include(fd),t.fragment.code.add(F`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}function Yrt(t){t.fragment.code.add(F`
    #define discardOrAdjustAlpha(color) { if (color.a < ${F.float(Wo)}) { discard; } }
  `)}let A2=class extends zn{constructor(e,i){super(e,"float",hr.Draw,(r,n,s)=>r.setUniform1f(e,i(n,s)))}};function O2(t,e){ASe(t,e,new lt("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function Zrt(t,e){ASe(t,e,new A2("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function ASe(t,e,i){const r=t.fragment;switch(e.alphaDiscardMode!==zr.Mask&&e.alphaDiscardMode!==zr.MaskBlend||r.uniforms.add(i),e.alphaDiscardMode){case zr.Blend:return t.include(Yrt);case zr.Opaque:r.code.add(F`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case zr.Mask:r.code.add(F`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case zr.MaskBlend:t.fragment.code.add(F`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function OSe(t,e){const{vertex:i,fragment:r}=t,n=e.hasColorTexture&&e.alphaDiscardMode!==zr.Opaque;switch(e.output){case oe.Depth:case oe.Shadow:case oe.ShadowHighlight:case oe.ShadowExcludeHighlight:case oe.ObjectAndLayerIdColor:Uc(i,e),t.include(Zl,e),t.include(g0,e),t.include(fg,e),t.include($g,e),t.include(ss,e),t.include(bR,e),ew(t),t.varyings.add("depth","float"),n&&r.uniforms.add(new kt("tex",s=>s.texture)),i.code.add(F`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`),t.include(O2,e),r.code.add(F`
          void main(void) {
            discardBySlice(vpos);
            ${n?F`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?F`colorUV`:F`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===oe.ObjectAndLayerIdColor?F`outputObjectAndLayerIdColor();`:F`outputDepth(depth);`}
          }
        `);break;case oe.Normal:{Uc(i,e),t.include(Zl,e),t.include(SR,e),t.include(aN,e),t.include(g0,e),t.include(fg,e),n&&r.uniforms.add(new kt("tex",a=>a.texture)),e.normalType===_r.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const s=e.normalType===_r.Attribute||e.normalType===_r.Compressed;i.code.add(F`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${s?F`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:F`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(ss,e),t.include(O2,e),r.code.add(F`
          void main() {
            discardBySlice(vpos);
            ${n?F`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?F`colorUV`:F`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===_r.ScreenDerivative?F`vec3 normal = screenDerivativeNormal(vPositionView);`:F`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case oe.Highlight:Uc(i,e),t.include(Zl,e),t.include(g0,e),t.include(fg,e),n&&r.uniforms.add(new kt("tex",s=>s.texture)),i.code.add(F`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(ss,e),t.include(O2,e),t.include(Bv,e),r.code.add(F`
          void main() {
            discardBySlice(vpos);
            ${n?F`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?F`colorUV`:F`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function RSe(t,e){const i=t.fragment;e.hasVertexTangents?(t.attributes.add(X.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===kn.WindingOrder?i.code.add(F`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(F`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):i.code.add(F`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==vs.None&&(t.include(iK,e),i.uniforms.add(e.pbrTextureBindType===hr.Pass?new kt("normalTexture",r=>r.textureNormal):new Wh("normalTexture",r=>r.textureNormal)),i.code.add(F`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))}let MSe=class extends zn{constructor(e,i){super(e,"vec2",hr.Draw,(r,n,s,a)=>r.setUniform2fv(e,i(n,s,a)))}};const Yk=4;function Krt(){const t=new lr,e=t.fragment;t.include(Ga);const i=(Yk+1)/2,r=1/(2*i*i);return e.include(ld),e.uniforms.add(new kt("depthMap",n=>n.depthTexture),new Wh("tex",n=>n.colorTexture),new MSe("blurSize",n=>n.blurSize),new lt("projScale",(n,s)=>{const a=un(s.camera.eye,s.camera.center);return a>5e4?Math.max(0,n.projScale-(a-5e4)):n.projScale}),new Lr("nearFar",(n,s)=>s.camera.nearFar)),e.code.add(F`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${F.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.code.add(F`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${F.int(Yk)}; r <= ${F.int(Yk)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `),t}const Qrt=Object.freeze(Object.defineProperty({__proto__:null,build:Krt},Symbol.toStringTag,{value:"Module"}));let PSe=class ISe extends wr{initializeProgram(e){return new fr(e.rctx,ISe.shader.get().build(),ar)}initializePipeline(){return mi({colorWrite:Oi})}};PSe.shader=new pr(Qrt,()=>ke(()=>import("./SSAOBlur.glsl-dbdfd7ca.js"),[],import.meta.url));const ent="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let tnt=class extends Vr{constructor(){super(...arguments),this.projScale=1}},int=class extends tnt{constructor(){super(...arguments),this.intensity=1}},rnt=class extends Vr{},nnt=class extends rnt{constructor(){super(...arguments),this.blurSize=Ct()}};function cN(t){t.fragment.uniforms.add(new er("projInfo",(e,i)=>snt(i))),t.fragment.uniforms.add(new Lr("zScale",(e,i)=>ont(i))),t.fragment.code.add(F`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function snt(t){const e=t.camera.projectionMatrix;return e[11]===0?_n(Eae,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):_n(Eae,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const Eae=ji();function ont(t){return t.camera.projectionMatrix[11]===0?Yi(Cae,0,1):Yi(Cae,1,0)}const Cae=Ct(),Aae=16;function ant(){const t=new lr,e=t.fragment;return t.include(Ga),e.include(ld),t.include(cN),e.uniforms.add(new lt("radius",(i,r)=>cQ(r.camera))),e.code.add(F`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(F`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new Lr("nearFar",(i,r)=>r.camera.nearFar),new kt("normalMap",i=>i.normalTexture),new kt("depthMap",i=>i.depthTexture),new lt("projScale",i=>i.projScale),new kt("rnm",i=>i.noiseTexture),new Lr("rnmScale",(i,r)=>Yi(Oae,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new lt("intensity",i=>i.intensity),new Lr("screenSize",(i,r)=>Yi(Oae,r.camera.fullWidth,r.camera.fullHeight))),t.outputs.add("fragOcclusion","float"),e.code.add(F`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
        fragOcclusion = 0.0;
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${F.int(Aae)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${F.int(Aae)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `),t}function cQ(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const Oae=Ct(),lnt=Object.freeze(Object.defineProperty({__proto__:null,build:ant,getRadius:cQ},Symbol.toStringTag,{value:"Module"}));let $Se=class LSe extends wr{initializeProgram(e){return new fr(e.rctx,LSe.shader.get().build(),ar)}initializePipeline(){return mi({colorWrite:Oi})}};$Se.shader=new pr(lnt,()=>ke(()=>import("./SSAO.glsl-198eaae4.js"),[],import.meta.url));const B5=2;let V5=class extends $w{constructor(e){super(e),this._context=null,this._passParameters=new int,this._drawParameters=new nnt,this.produces=new Map([[De.SSAO,()=>this._produces()]])}_produces(){return this._enableTime!=null&&this._context!=null}consumes(){return this._produces()?NZe:V7}initializeRenderContext(e){this._context=e,this.addHandles([Fe(()=>this.view.qualitySettings.ambientOcclusion||this._context?.isFeatureEnabled(Os.SSAO),i=>i?this._enable():this._disable(),Ur)])}uninitializeRenderContext(){this._disable(),this._context=null}_disable(){this._passParameters.noiseTexture=jt(this._passParameters.noiseTexture),this._enableTime=null}destroy(){this._disable()}_enable(){if(this._enableTime!=null||!this._context)return;const e=Uint8Array.from(atob(ent),r=>r.charCodeAt(0)),i=new Ar;i.wrapMode=Ai.CLAMP_TO_EDGE,i.pixelFormat=ei.RGB,i.wrapMode=Ai.REPEAT,i.hasMipmap=!0,i.width=32,i.height=32,this._passParameters.noiseTexture=new yi(this._context.renderContext.rctx,i,e),this._ssaoTechnique==null&&(this._ssaoTechnique=this._context.techniqueRepository.acquire($Se)),this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(PSe)),this._enableTime=0,this._context?.requestRender()}renderNode(e,i,r){const n=e.bindParameters,s=n.linearDepth?.colorTexture,a=r?.normal?.colorTexture;if(this._enableTime==null||this._context==null||s==null||!a)return;if(!this._ssaoTechnique.compiled||!this._blurTechnique.compiled)return this._enableTime=e.time,void this._context.requestRender();this._enableTime===0&&(this._enableTime=e.time);const u=e.rctx,p=n.camera,y=this.view.qualitySettings.fadeDuration,b=y>0?Math.min(y,e.time-this._enableTime)/y:1;this._passParameters.normalTexture=a,this._passParameters.depthTexture=s,this._passParameters.projScale=1/p.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*cnt/cQ(p)**6*b;const S=p.fullViewport[2],C=p.fullViewport[3],O=Math.round(S/B5),P=Math.round(C/B5),$=this._context.fbos,N=$.acquire(sr.RED,S,C);u.bindFramebuffer(N.fbo),u.setViewport(0,0,S,C),u.bindTechnique(this._ssaoTechnique,this._passParameters,n).bindDraw(this._drawParameters,n,this._passParameters),u.screen.draw();const z=u.bindTechnique(this._blurTechnique,this._passParameters,n);u.setViewport(0,0,O,P);const U=$.acquire(sr.RED,O,P);u.bindFramebuffer(U.fbo),this._drawParameters.colorTexture=N.colorTexture,Yi(this._drawParameters.blurSize,0,B5/C),z.bindDraw(this._drawParameters,n,this._passParameters),u.setViewport(0,0,O,P),u.screen.draw(),N.release();const j=$.acquire(sr.RED,O,P);return u.bindFramebuffer(j.fbo),u.setViewport(0,0,S,C),u.setClearColor(1,1,1,0),u.clear(tn.COLOR_BUFFER_BIT),u.setViewport(0,0,O,P),this._drawParameters.colorTexture=U.colorTexture,Yi(this._drawParameters.blurSize,B5/S,0),z.bindDraw(this._drawParameters,n,this._passParameters),u.screen.draw(),u.setViewport4fv(p.fullViewport),U.release(),b<1&&this._context.requestRender(),j}};_([T({constructOnly:!0})],V5.prototype,"view",void 0),_([T()],V5.prototype,"_context",void 0),V5=_([Z("esri.views.3d.webgl-engine.effects.ssao.SSAO")],V5);const cnt=.5;function CR(t,e){const i=t.fragment;e.receiveAmbientOcclusion?(i.uniforms.add(new kt("ssaoTex",(r,n)=>n.ssao?.colorTexture)),i.constants.add("blurSizePixelsInverse","float",1/B5),i.code.add(F`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):i.code.add(F`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function unt(t){const e=t.fragment.code;e.add(F`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(F`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(F`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function uQ(t,e){const i=t.fragment.code;t.include(dR),e.pbrMode!==Gt.Normal&&e.pbrMode!==Gt.Schematic&&e.pbrMode!==Gt.Terrain&&e.pbrMode!==Gt.TerrainWithWater||(i.add(F`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(F`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==Gt.Normal&&e.pbrMode!==Gt.Schematic||(t.include(unt),i.add(F`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(F`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(F`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(F`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function hnt(t,e){const i=t.fragment.code;t.include(dR),i.add(F`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(F`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(F`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(F`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(F`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function AR(t){t.constants.add("ambientBoostFactor","float",y3e)}function PE(t){t.uniforms.add(new lt("lightingGlobalFactor",(e,i)=>i.lighting.globalFactor))}function rw(t,e){const i=t.fragment;switch(t.include(CR,e),e.pbrMode!==Gt.Disabled&&t.include(uQ,e),t.include(sK,e),t.include(dR),i.code.add(F`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===Gt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),AR(i),PE(i),jg(i),i.code.add(F`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?F`normalize(vPosWorld)`:F`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),U0(i),i.code.add(F`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case Gt.Disabled:case Gt.WaterOnIntegratedMesh:case Gt.Water:t.include(zL),i.code.add(F`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case Gt.Normal:case Gt.Schematic:i.code.add(F`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(F`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new y0("hasFillLights",(r,n)=>n.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(F`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add(new lt("lightingSpecularStrength",(r,n)=>n.lighting.mainLight.specularStrength),new lt("lightingEnvironmentStrength",(r,n)=>n.lighting.mainLight.environmentStrength)),i.code.add(F`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(F`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode!==Gt.Schematic||e.hasColorTexture?F`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:F`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case Gt.Terrain:case Gt.TerrainWithWater:t.include(zL),i.code.add(F`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case Gt.COUNT:}}let dnt=class extends zn{constructor(e,i,r){super(e,"mat4",hr.Draw,(n,s,a,u)=>n.setUniformMatrix4fv(e,i(s,a,u)),r)}},pnt=class extends zn{constructor(e,i,r){super(e,"mat4",hr.Pass,(n,s,a)=>n.setUniformMatrix4fv(e,i(s,a)),r)}},fnt=class extends Vr{constructor(){super(...arguments),this.origin=H()}},mnt=class extends fnt{},gnt=class extends Vr{constructor(){super(...arguments),this.modelTransformation=Cn}},hQ=class extends gnt{constructor(){super(...arguments),this.origin=H()}};function uN(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new pnt("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),DSe(t))}function nw(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new dnt("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),DSe(t))}function DSe(t){const e=t.fragment;e.include(CSe),e.uniforms.add(new kt("shadowMapTex",(i,r)=>r.shadowMap.depthTexture),new ER("numCascades",(i,r)=>r.shadowMap.numCascades),new er("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances)),e.code.add(F`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMapTex, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMapTex);
}`)}function za(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function NSe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function M$(t,e,i,r,n,s,a,u,p){const y=new Float32Array(9);return y[0]=t,y[1]=e,y[2]=i,y[3]=r,y[4]=n,y[5]=s,y[6]=a,y[7]=u,y[8]=p,y}function ynt(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:NSe,create:za,createView:ynt,fromValues:M$},Symbol.toStringTag,{value:"Module"}));function vnt(t){t.vertex.uniforms.add(new Xp("colorTextureTransformMatrix",e=>e.colorTextureTransformMatrix!=null?e.colorTextureTransformMatrix:za())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(F`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function _nt(t){t.vertex.uniforms.add(new Xp("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix!=null?e.normalTextureTransformMatrix:za())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(F`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function bnt(t){t.vertex.uniforms.add(new Xp("emissiveTextureTransformMatrix",e=>e.emissiveTextureTransformMatrix!=null?e.emissiveTextureTransformMatrix:za())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(F`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function wnt(t){t.vertex.uniforms.add(new Xp("occlusionTextureTransformMatrix",e=>e.occlusionTextureTransformMatrix!=null?e.occlusionTextureTransformMatrix:za())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(F`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function xnt(t){t.vertex.uniforms.add(new Xp("metallicRoughnessTextureTransformMatrix",e=>e.metallicRoughnessTextureTransformMatrix!=null?e.metallicRoughnessTextureTransformMatrix:za())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(F`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function dO(t){t.include(G0),t.code.add(F`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${F.int(Xs.Multiply)}) {
        return allMixed;
      }
      if (mode == ${F.int(Xs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${F.int(Xs.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${F.int(Xs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${F.int(Xs.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function Tnt(t){const e=new lr,{vertex:i,fragment:r,varyings:n}=e;if(Uc(i,t),e.include(pR),n.add("vpos","vec3"),e.include(fg,t),e.include(T3e,t),e.include(pTe,t),t.hasColorTextureTransform&&e.include(vnt),t.output===oe.Color||t.output===oe.Alpha){t.hasNormalTextureTransform&&e.include(_nt),t.hasEmissionTextureTransform&&e.include(bnt),t.hasOcclusionTextureTransform&&e.include(wnt),t.hasMetallicRoughnessTextureTransform&&e.include(xnt),kp(i,t),e.include(SR,t),e.include(Zl,t);const s=t.normalType===_r.Attribute||t.normalType===_r.Compressed;s&&t.offsetBackfaces&&e.include(xSe),e.include(RSe,t),e.include(aN,t),t.instancedColor&&e.attributes.add(X.INSTANCECOLOR,"vec4"),n.add("vPositionLocal","vec3"),e.include(g0,t),e.include(EE,t),e.include(ESe,t),e.include(Dw,t),i.uniforms.add(new er("externalColor",a=>a.externalColor)),n.add("vcolorExt","vec4"),t.multipassEnabled&&n.add("depth","float"),i.code.add(F`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${F.float(Wo)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${s?F`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${s&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?F`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?F`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?F`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?F`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?F`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(t.output){case oe.Alpha:e.include(ss,t),e.include(O2,t),e.include(Jc,t),r.uniforms.add(new lt("opacity",s=>s.opacity),new lt("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new kt("tex",s=>s.texture)),r.include(dO),r.code.add(F`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?F`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?F`colorUV`:F`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:F`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?F`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:F`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case oe.Color:e.include(ss,t),e.include(rw,t),e.include(CR,t),e.include(O2,t),e.include(t.instancedDoublePrecision?uN:nw,t),e.include(Jc,t),kp(r,t),r.uniforms.add(i.uniforms.get("localOrigin"),new _i("ambient",s=>s.ambient),new _i("diffuse",s=>s.diffuse),new lt("opacity",s=>s.opacity),new lt("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new kt("tex",s=>s.texture)),e.include(nK,t),e.include(uQ,t),r.include(dO),e.include(mSe,t),AR(r),PE(r),U0(r),r.code.add(F`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?F`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?F`colorUV`:F`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:F`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===_r.ScreenDerivative?F`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:F`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===Gt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?F`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:F`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?F`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?F`normalUV`:"vuv0"});`:F`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?F`normalize(posWorld);`:F`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?F`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===Gt.Normal||t.pbrMode===Gt.Schematic?F`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?F`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:F`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===Ut.Color?F`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return e.include(OSe,t),e}const Snt=Object.freeze(Object.defineProperty({__proto__:null,build:Tnt},Symbol.toStringTag,{value:"Module"}));let Ent=class extends gSe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ma(lN),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=rn.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=st(0,0,0),this.instancedDoublePrecision=!1,this.normalType=_r.Attribute,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=st(.2,.2,.2),this.diffuse=st(.8,.8,.8),this.externalColor=vi(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=H(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=K2.Less,this.textureAlphaMode=zr.Blend,this.textureAlphaCutoff=l8,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=vn.Occlude,this.isDecoration=!1}},Cnt=class extends ySe{constructor(){super(...arguments),this.origin=H(),this.slicePlaneLocalOrigin=this.origin}},dQ=class FSe extends wr{initializeConfiguration(e,i){i.spherical=e.viewingMode===ht.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,i.textureCoordinateType=i.hasColorTexture||i.hasMetallicRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?vs.Default:vs.None,i.objectAndLayerIdColorInstanced=i.instanced}initializeProgram(e){return this._initializeProgram(e,FSe.shader)}_initializeProgram(e,i){return new fr(e.rctx,i.get().build(this.configuration),ar)}_convertDepthTestFunction(e){return e===K2.Lequal?Tr.LEQUAL:Tr.LESS}_makePipeline(e,i){const r=this.configuration,n=e===Ut.NONE,s=e===Ut.FrontFace;return mi({blending:r.output!==oe.Color&&r.output!==oe.Alpha||!r.transparent?null:n?Xu:Wg(e),culling:Ant(r)?P7(r.cullFace):null,depthTest:{func:Vv(e,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:(n||s)&&r.writeDepth?ic:null,colorWrite:Oi,stencilWrite:r.hasOccludees?P0:null,stencilTest:r.hasOccludees?i?Cv:Gv:null,polygonOffset:n||s?null:rN(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function Ant(t){return t.cullFace!==rn.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}dQ.shader=new pr(Snt,()=>ke(()=>import("./DefaultMaterial.glsl-c6c714e7.js"),[],import.meta.url));let Ci=class extends _l{constructor(){super(...arguments),this.output=oe.Color,this.alphaDiscardMode=zr.Opaque,this.doubleSidedMode=kn.None,this.pbrMode=Gt.Disabled,this.cullFace=rn.None,this.transparencyPassType=Ut.NONE,this.normalType=_r.Attribute,this.textureCoordinateType=vs.None,this.customDepthTest=K2.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};_([ce({count:oe.COUNT})],Ci.prototype,"output",void 0),_([ce({count:zr.COUNT})],Ci.prototype,"alphaDiscardMode",void 0),_([ce({count:kn.COUNT})],Ci.prototype,"doubleSidedMode",void 0),_([ce({count:Gt.COUNT})],Ci.prototype,"pbrMode",void 0),_([ce({count:rn.COUNT})],Ci.prototype,"cullFace",void 0),_([ce({count:Ut.COUNT})],Ci.prototype,"transparencyPassType",void 0),_([ce({count:_r.COUNT})],Ci.prototype,"normalType",void 0),_([ce({count:vs.COUNT})],Ci.prototype,"textureCoordinateType",void 0),_([ce({count:K2.COUNT})],Ci.prototype,"customDepthTest",void 0),_([ce()],Ci.prototype,"spherical",void 0),_([ce()],Ci.prototype,"hasVertexColors",void 0),_([ce()],Ci.prototype,"hasSymbolColors",void 0),_([ce()],Ci.prototype,"hasVerticalOffset",void 0),_([ce()],Ci.prototype,"hasSlicePlane",void 0),_([ce()],Ci.prototype,"hasSliceHighlight",void 0),_([ce()],Ci.prototype,"hasColorTexture",void 0),_([ce()],Ci.prototype,"hasMetallicRoughnessTexture",void 0),_([ce()],Ci.prototype,"hasEmissionTexture",void 0),_([ce()],Ci.prototype,"hasOcclusionTexture",void 0),_([ce()],Ci.prototype,"hasNormalTexture",void 0),_([ce()],Ci.prototype,"hasScreenSizePerspective",void 0),_([ce()],Ci.prototype,"hasVertexTangents",void 0),_([ce()],Ci.prototype,"hasOccludees",void 0),_([ce()],Ci.prototype,"multipassEnabled",void 0),_([ce()],Ci.prototype,"hasModelTransformation",void 0),_([ce()],Ci.prototype,"offsetBackfaces",void 0),_([ce()],Ci.prototype,"vvSize",void 0),_([ce()],Ci.prototype,"vvColor",void 0),_([ce()],Ci.prototype,"receiveShadows",void 0),_([ce()],Ci.prototype,"receiveAmbientOcclusion",void 0),_([ce()],Ci.prototype,"textureAlphaPremultiplied",void 0),_([ce()],Ci.prototype,"instanced",void 0),_([ce()],Ci.prototype,"instancedColor",void 0),_([ce()],Ci.prototype,"objectAndLayerIdColorInstanced",void 0),_([ce()],Ci.prototype,"instancedDoublePrecision",void 0),_([ce()],Ci.prototype,"doublePrecisionRequiresObfuscation",void 0),_([ce()],Ci.prototype,"writeDepth",void 0),_([ce()],Ci.prototype,"transparent",void 0),_([ce()],Ci.prototype,"enableOffset",void 0),_([ce()],Ci.prototype,"cullAboveGround",void 0),_([ce()],Ci.prototype,"snowCover",void 0),_([ce()],Ci.prototype,"hasColorTextureTransform",void 0),_([ce()],Ci.prototype,"hasEmissionTextureTransform",void 0),_([ce()],Ci.prototype,"hasNormalTextureTransform",void 0),_([ce()],Ci.prototype,"hasOcclusionTextureTransform",void 0),_([ce()],Ci.prototype,"hasMetallicRoughnessTextureTransform",void 0),_([ce({constValue:!1})],Ci.prototype,"occlusionPass",void 0),_([ce({constValue:!0})],Ci.prototype,"hasVvInstancing",void 0),_([ce({constValue:!1})],Ci.prototype,"useCustomDTRExponentForWater",void 0),_([ce({constValue:!1})],Ci.prototype,"supportsTextureAtlas",void 0),_([ce({constValue:!0})],Ci.prototype,"useFillLights",void 0);function Ont(t){const e=new lr,{vertex:i,fragment:r,varyings:n}=e;return Uc(i,t),e.include(pR),n.add("vpos","vec3"),e.include(fg,t),e.include(T3e,t),e.include(pTe,t),t.output!==oe.Color&&t.output!==oe.Alpha||(kp(e.vertex,t),e.include(SR,t),e.include(Zl,t),t.offsetBackfaces&&e.include(xSe),t.instancedColor&&e.attributes.add(X.INSTANCECOLOR,"vec4"),n.add("vNormalWorld","vec3"),n.add("localvpos","vec3"),t.multipassEnabled&&n.add("depth","float"),e.include(g0,t),e.include(EE,t),e.include(ESe,t),e.include(Dw,t),i.uniforms.add(new er("externalColor",s=>s.externalColor)),n.add("vcolorExt","vec4"),i.code.add(F`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${F.float(Wo)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.multipassEnabled?F`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===oe.Alpha&&(e.include(ss,t),e.include(O2,t),e.include(Jc,t),r.uniforms.add(new lt("opacity",s=>s.opacity),new lt("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new kt("tex",s=>s.texture)),r.include(dO),r.code.add(F`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?F`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?F`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?F`colorUV`:F`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:F`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?F`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:F`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===oe.Color&&(e.include(ss,t),e.include(rw,t),e.include(CR,t),e.include(O2,t),e.include(t.instancedDoublePrecision?uN:nw,t),e.include(Jc,t),kp(e.fragment,t),jg(r),AR(r),PE(r),r.uniforms.add(i.uniforms.get("localOrigin"),i.uniforms.get("view"),new _i("ambient",s=>s.ambient),new _i("diffuse",s=>s.diffuse),new lt("opacity",s=>s.opacity),new lt("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new kt("tex",s=>s.texture)),e.include(nK,t),e.include(uQ,t),r.include(dO),U0(r),r.code.add(F`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?F`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?F`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?F`colorUV`:F`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:F`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===Gt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?F`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:F`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?F`albedo = mix(albedo, vec3(1), 0.9);`:F``}
        ${F`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===Gt.Normal||t.pbrMode===Gt.Schematic?t.spherical?F`vec3 normalGround = normalize(vpos + localOrigin);`:F`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:F``}
        ${t.pbrMode===Gt.Normal||t.pbrMode===Gt.Schematic?F`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?F`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:F`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===Ut.Color?F`fragColor = premultiplyAlpha(fragColor);`:F``}
      }
    `)),e.include(OSe,t),e}const Rnt=Object.freeze(Object.defineProperty({__proto__:null,build:Ont},Symbol.toStringTag,{value:"Module"}));let kSe=class zSe extends dQ{initializeConfiguration(e,i){super.initializeConfiguration(e,i),i.hasMetallicRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=_r.Attribute,i.doubleSidedMode=kn.WindingOrder,i.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,zSe.shader)}};kSe.shader=new pr(Rnt,()=>ke(()=>import("./RealisticTree.glsl-a411ae08.js"),[],import.meta.url));let Up=class extends jv{constructor(e){super(e,Int),this.supportsEdges=!0,this._configuration=new Ci,this._vertexBufferLayout=$nt(this.parameters)}isVisibleForOutput(e){return e!==oe.Shadow&&e!==oe.ShadowExcludeHighlight&&e!==oe.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:i,hasVertexColors:r,hasSymbolColors:n,vvColor:s}=e,a=e.colorMixMode==="replace",u=e.opacity>0,p=e.externalColor&&e.externalColor[3]>0,y=i||s||n;return r&&y?a||u:r?a?p:u:y?a||u:a?p:u}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?rn.None:this.parameters.cullFace,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==oe.Color&&e!==oe.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=kn.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?kn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?kn.WindingOrder:kn.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=i.ssao!=null,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Gt.Schematic:Gt.Normal:Gt.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<tN,this._configuration.snowCover=this.hasSnowCover(i),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,i,r,n,s,a){if(this.parameters.verticalOffset!=null){const u=r.camera;$e(Kk,i[12],i[13],i[14]);let p=null;switch(r.viewingMode){case ht.Global:p=We(Rae,Kk);break;case ht.Local:p=Ie(Rae,Nnt)}let y=0;const b=Be(Fnt,Kk,u.eye),S=Qe(b),C=Pe(b,b,1/S);let O=null;this.parameters.screenSizePerspective&&(O=He(p,C)),y+=wTe(u,S,this.parameters.verticalOffset,O??0,this.parameters.screenSizePerspective),Pe(p,p,y),Lc(Zk,p,r.transform.inverseRotation),n=Be(Lnt,n,Zk),s=Be(Dnt,s,Zk)}yTe(e,r,n,s,CG(r.verticalOffset),a)}produces(e,i){return i===oe.Color||i===oe.Alpha||i===oe.Depth||i===oe.Normal||i===oe.Shadow||i===oe.ShadowHighlight||i===oe.ShadowExcludeHighlight||i===oe.Highlight||i===oe.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?De.TRANSPARENT_MATERIAL:De.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:De.OPAQUE_MATERIAL)||e===De.DRAPED_MATERIAL:!1}createGLMaterial(e){return new Mnt(e)}createBufferWriter(){return new ME(this._vertexBufferLayout)}},Mnt=class extends rK{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==oe.Color&&this._output!==oe.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return $e(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?kSe:dQ,e)}},Pnt=class extends Ent{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const Int=new Pnt;function $nt(t){const e=wn().vec3f(X.POSITION);return t.normalType===_r.Compressed?e.vec2i16(X.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(X.NORMAL),t.hasVertexTangents&&e.vec4f(X.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(X.UV0),t.hasVertexColors&&e.vec4u8(X.COLOR),t.hasSymbolColors&&e.vec4u8(X.SYMBOLCOLOR),Me("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(X.OBJECTANDLAYERIDCOLOR),e}const Lnt=H(),Dnt=H(),Nnt=st(0,0,1),Rae=H(),Zk=H(),Kk=H(),Fnt=H(),USe=new oQ({});function _Dt(t){return t.type==="web-style"?USe:pQ(t.symbolLayers.toArray().map(e=>jSe(t,e)))}function pQ(t){let e=0,i=0,r=0,n=!1,s=0;const a=new pSe;for(const u of t)u!=null&&(e+=u.verticesPerFeature,i+=u.verticesPerCoordinate,r+=u.drawCallsPerFeature,a.bytesPerFeature+=u.memory.bytesPerFeature,a.bytesPerFeatureLabel+=u.memory.bytesPerFeatureLabel,a.resourceBytes+=u.memory.resourceBytes,a.draped.bytesPerFeature+=u.memory.bytesPerFeature,a.draped.bytesPerFeatureLabel+=u.memory.bytesPerFeatureLabel,n=n||u.estimated,++s);return n?new Lrt(s,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:a}):new $rt(s,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:a})}function bDt(t){const e=pQ(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const Qk={};function jSe(t,e){const i=BSe(t,e),r=Frt(e)?2:0;switch(e.type){case"extrude":return new Ih({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:i});case"fill":if(t.type==="mesh-3d")return new Ih({drawCallsPerFeature:r,memory:i});if(e.outline!=null&&e.outline.size>0)return new Ih({verticesPerFeature:-12,verticesPerCoordinate:9,memory:i});case"water":return new Ih({verticesPerFeature:-6,verticesPerCoordinate:3,memory:i});case"line":return new Ih({verticesPerFeature:-6,verticesPerCoordinate:6,memory:i});case"object":return e.resource?.href?new oQ({verticesPerFeature:100,memory:i}):{...knt(e.resource?.primitive??n_e),memory:i};case"path":{let n=0,s=0;switch(e.profile){case"circle":n=lSe;break;case"quad":n=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":s=aSe;break;case"miter":case"bevel":s=1;break;default:return}const a=2*n,u=n*s*2,p=u+a;let y=-2*u-a;switch(e.cap){case"none":break;case"butt":case"square":y+=2*(n-1);break;case"round":y+=2*(n*(pq-1)*2+n);break;default:return}return new Ih({verticesPerFeature:y,verticesPerCoordinate:p,memory:i})}case"text":case"icon":return new Ih({verticesPerFeature:6,memory:i});default:return}}function BSe(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?El.EXTRUDE_EDGES:El.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?El.FILL_OUTLINE:El.FILL;case"water":return El.FILL;case"line":return e.join==="round"?El.LINE_ROUND:El.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return El.PATH_ROUND_CIRCLE;case"quad":return El.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return El.PATH_MITER_CIRCLE;case"quad":return El.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?El.OBJECT_POINT:El.OBJECT_POLYGON;case"icon":case"text":return i?El.ICON_POINT:El.ICON_POLYGON;default:return}}function knt(t){const e=Qk[t];if(e)return e;const i=VSe(dSe(t,new Up({})).levels);return Qk[t]=new Ih({verticesPerFeature:i}),Qk[t]}function VSe(t){return t.reduce((e,i,r)=>e+i.numVertices*(1/10**r),0)/t.reduce((e,i,r)=>e+1/10**r,0)}const El={ICON_POINT:{bytesPerFeature:2111.586639736967,bytesPerFeatureLabel:870.520855,resourceBytes:0,draped:{bytesPerFeature:1799.2619971817762,bytesPerFeatureLabel:857.4890149999999}},ICON_POLYGON:{bytesPerFeature:2829.8183316810564,bytesPerFeatureLabel:858.0951816666667,resourceBytes:0,draped:{bytesPerFeature:2521.242008227286,bytesPerFeatureLabel:869.6919750000001}},OBJECT_POINT:{bytesPerFeature:607.8007336777831,bytesPerFeatureLabel:715.7017950000001,resourceBytes:0,draped:{bytesPerFeature:607.8007336777831,bytesPerFeatureLabel:715.7017950000001}},OBJECT_POLYGON:{bytesPerFeature:1111.4123028075749,bytesPerFeatureLabel:684.5498416666667,resourceBytes:0,draped:{bytesPerFeature:1111.4123028075749,bytesPerFeatureLabel:684.5498416666667}},LINE_MITER:{bytesPerFeature:3053.034748007272,bytesPerFeatureLabel:804.5473016666666,resourceBytes:0,draped:{bytesPerFeature:2649.5661560225844,bytesPerFeatureLabel:843.3404083333334}},LINE_ROUND:{bytesPerFeature:3225.35183564197,bytesPerFeatureLabel:807.296835,resourceBytes:0,draped:{bytesPerFeature:2650.9229994933276,bytesPerFeatureLabel:861.108335}},PATH_MITER_CIRCLE:{bytesPerFeature:38664.832646351235,bytesPerFeatureLabel:862.95665,resourceBytes:0,draped:{bytesPerFeature:38664.832646351235,bytesPerFeatureLabel:862.95665}},PATH_ROUND_CIRCLE:{bytesPerFeature:42462.97022293504,bytesPerFeatureLabel:851.35885,resourceBytes:0,draped:{bytesPerFeature:42462.97022293504,bytesPerFeatureLabel:851.35885}},PATH_MITER_QUAD:{bytesPerFeature:25558.22153327986,bytesPerFeatureLabel:838.56885,resourceBytes:0,draped:{bytesPerFeature:25558.22153327986,bytesPerFeatureLabel:838.56885}},PATH_ROUND_QUAD:{bytesPerFeature:42274.86801764233,bytesPerFeatureLabel:867.5658500000001,resourceBytes:0,draped:{bytesPerFeature:42274.86801764233,bytesPerFeatureLabel:867.5658500000001}},FILL:{bytesPerFeature:3124.272297197038,bytesPerFeatureLabel:850.6966816666666,resourceBytes:0,draped:{bytesPerFeature:2630.99580851019,bytesPerFeatureLabel:845.464495}},FILL_OUTLINE:{bytesPerFeature:4501.643043274039,bytesPerFeatureLabel:866.3982816666668,resourceBytes:0,draped:{bytesPerFeature:3841.8870233416183,bytesPerFeatureLabel:854.9969683333334}},EXTRUDE:{bytesPerFeature:7545.975968446941,bytesPerFeatureLabel:859.7106016666668,resourceBytes:0,draped:{bytesPerFeature:7545.975968446941,bytesPerFeatureLabel:859.7106016666668}},EXTRUDE_EDGES:{bytesPerFeature:2872.306473115409,bytesPerFeatureLabel:604.556581666667,resourceBytes:0,draped:{bytesPerFeature:2872.306473115409,bytesPerFeatureLabel:604.556581666667}}};var _s;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(_s||(_s={}));let fQ=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Ru.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===Ru.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===Ru.FAILED?(i&&i(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Ru.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Ru.FAILED,!qn(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=Vc(this._abortController):this._loadStatus===Ru.LOADING&&(this._loadStatus=Ru.FAILED),this._loader=null}};var Ru;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(Ru||(Ru={}));const w3=Ee.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let q0=class extends fQ{constructor(e,i,r,n){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this._materials=[],this.usedMemory=0,this.logger=w3,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=n.renderPriority,this._renderPriorityStep=n.renderPriorityStep,this._elevationContext=new h8,this.complexity=this.computeComplexity(),this.ignoreDrivers=n.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Mae(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const i=this._drivenProperties,r=Mae(e);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,i,r,n){const s=e.projectionSuccess,a="polygons"in e?e.polygons:null,u=`${n} geometry failed to be created`;let p=null;s?!this._logGeometryValidationWarnings(i,r,n)&&a&&a.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(p=`${u} (filled rings should use clockwise winding - try reversing the order of vertices)`):p=`${u} (failed to project geometry to view spatial reference)`,p&&w3.warnOncePerTick(p)}_logGeometryValidationWarnings(e,i,r){const n=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(w3.warnOncePerTick(`${n} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(w3.warnOncePerTick(`${n} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(i!=null&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;if(e.type==="point"){const n=e;if(!isFinite(n.x)||!isFinite(n.y))return w3.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return znt}_defaultElevationInfoZ(){return Unt}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,i=new h8){const r=e.geometry,n=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:n.unit,i.mode=this.getGeometryElevationMode(r,n),i.offsetMeters=this._elevationContext.meterUnitOffset??n.offset??0;const s=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";s&&(i.mode="relative-to-ground",i.offsetMeters=0);const a=s?Ort:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(a,e,this._context.layer),i}prepareSymbolLayerPatch(e){}updateGeometry(e,i){return!1}updateTransform(e,i,r,n){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=Pae){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?r*=e.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,i=Pae){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return t4(null,r);const n=e!=null?mt.toUnitRGB(e):rg;return t4(n,r)}_getVertexOpacityAndColor(e,i=null){const r=this._drivenProperties.color?e.color:null,n=this._drivenProperties.opacity?e.opacity:null,s=t4(r,n);return i&&(s[0]*=i,s[1]*=i,s[2]*=i,s[3]*=i),s}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return jSe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,n)!==Hn.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,i,r){let n=Hn.UPDATE;return e.forEach(s=>{const a=i(s);if(a!=null){const u=s.graphic;this.setGraphicElevationContext(u,a.elevationContext),a.needsElevationUpdates=r(a.elevationContext.mode)}else n=Hn.RECREATE}),n}applyRendererDiff(e,i){return _s.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const i=this._fastUpdates.visualVariables,r=i.size?Ap(i.size.field,e):0,n=i.color?Ap(i.color.field,e):0,s=i.opacity?Ap(i.opacity.field,e):0;return vi(r,n,s,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&w3.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null});return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function Mae(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(i=>{switch(i.type){case"color":if(e.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const n=i.stops[r].color;n&&(e.opacity=!0,n.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const znt={mode:"on-the-ground",offset:0,unit:"meters"},Unt={mode:"absolute-height",offset:0,unit:"meters"},Pae={hasIntrinsicColor:!1};let Xg=class extends gR{get geometries(){return this._geometries}get transformation(){return this._transformation??Cn}set transformation(e){this._transformation=bs(this._transformation??Ze(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?bs(this._shaderTransformation??Ze(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=Gn.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new GSe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){zt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];i&&(this._emit("geometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,i,r=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:i,sync:r}),lXe(i)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new WL(Pg.MaskOccludee);for(const i of this._geometries)i.occludees=FH(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=kH(i.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new WL(Pg.Highlight);for(const i of this._geometries)i.highlights=FH(i.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const i of this._geometries)i.highlights=kH(i.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,i){return Rr(i,this.transformation,e.transformation)}getCombinedShaderTransformation(e,i=Ze()){return Rr(i,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new Iae,this._validateBoundingVolume(this._bvWorldSpace,i4.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new Iae,this._validateBoundingVolume(this._bvObjectSpace,i4.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,i){const r=i===i4.ObjectSpace;for(const n of this._geometries){const s=n.boundingInfo;s&&jnt(s,e,r?n.transformation:this.getCombinedShaderTransformation(n))}Ir(e.bounds,e.min,e.max,.5);for(const n of this._geometries){const s=n.boundingInfo;if(s==null)continue;const a=r?n.transformation:this.getCombinedShaderTransformation(n),u=MS(a);wt($ae,s.center,a);const p=un($ae,e.bounds),y=s.radius*u;e.bounds[3]=Math.max(e.bounds[3],p+y)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,i){this._parentLayer&&this._parentLayer.events.emit(e,i)}get test(){const e=this;return{hasGeometry:i=>e._geometries.includes(i),getGeometryIndex:i=>e._geometries.indexOf(i)}}},GSe=class{constructor(){this.min=st(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=st(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Iae=class extends GSe{constructor(){super(...arguments),this.bounds=as()}};function jnt(t,e,i){const r=t.bbMin,n=t.bbMax;if(UD(i)){const s=$e(Bnt,i[12],i[13],i[14]);Ue(nu,r,s),Ue(xd,n,s);for(let a=0;a<3;++a)e.min[a]=Math.min(e.min[a],nu[a]),e.max[a]=Math.max(e.max[a],xd[a])}else if(wt(nu,r,i),pa(r,n))for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],nu[s]),e.max[s]=Math.max(e.max[s],nu[s]);else{wt(xd,n,i);for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],nu[s],xd[s]),e.max[s]=Math.max(e.max[s],nu[s],xd[s]);for(let s=0;s<3;++s){Ie(nu,r),Ie(xd,n),nu[s]=n[s],xd[s]=r[s],wt(nu,nu,i),wt(xd,xd,i);for(let a=0;a<3;++a)e.min[a]=Math.min(e.min[a],nu[a],xd[a]),e.max[a]=Math.max(e.max[a],nu[a],xd[a])}}}const Bnt=H(),nu=H(),xd=H(),$ae=H();var i4;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(i4||(i4={}));function mQ(t,e,i,r,n){const s=t.clippingExtent;if(Wc(e,Vy,t.elevationProvider.spatialReference),s!=null&&!YY(s,Vy))return null;Wc(e,Vy,t.renderCoordsHelper.spatialReference),i.localOrigin=t.localOriginFactory.getOrigin(Vy);const a=new Xg({geometries:[i],castShadow:!1,layerUid:t.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:crt(a,e,t.elevationProvider,t.renderCoordsHelper,r)}}function pO(t,e,i){const r=t.elevationContext,n=i.spatialReference;Wc(e,Vy,n),r.centerPointInElevationSR=kv(Vy[0],Vy[1],e.hasZ?Vy[2]:0,n??null)}function fO(t){switch(t.type){case"point":return t;case"polygon":case"extent":return iQ(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=Kge(e,Zge(e)/2);return kv(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.origin}return null}const Vy=H();function HSe(){return new Float32Array(2)}function Vnt(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function kh(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function Gnt(t,e){return new Float32Array(t,e,2)}function qSe(){return HSe()}function WSe(){return kh(1,1)}function XSe(){return kh(1,0)}function JSe(){return kh(0,1)}const YSe=qSe(),ZSe=WSe(),Hnt=XSe(),qnt=JSe();Object.freeze(Object.defineProperty({__proto__:null,ONES:ZSe,UNIT_X:Hnt,UNIT_Y:qnt,ZEROS:YSe,clone:Vnt,create:HSe,createView:Gnt,fromValues:kh,ones:WSe,unitX:XSe,unitY:JSe,zeros:qSe},Symbol.toStringTag,{value:"Module"}));function Wnt(t){const e=new lr,{vertex:i,fragment:r}=e;return i.include(Q7),e.include(gTe,t),e.include(ss,t),e.attributes.add(X.UV0,"vec2"),i.uniforms.add(new er("viewport",(n,s)=>s.camera.fullViewport),new lt("lineSize",(n,s)=>n.size>0?Math.max(1,n.size)*s.camera.pixelRatio:0),new Lr("pixelToNDC",(n,s)=>Yi(Dae,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new lt("borderSize",(n,s)=>n.borderColor!=null?s.camera.pixelRatio:0),new Lr("screenOffset",(n,s)=>Yi(Dae,n.horizontalScreenOffset*s.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.multipassEnabled&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(DTe),t.hasScreenSizePerspective&&K7(i),i.code.add(F`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?F`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?F`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:F`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.multipassEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?F`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:F`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?F`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:F`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add(new er("uColor",n=>Lae(n.color)),new er("borderColor",n=>Lae(n.borderColor))),t.multipassEnabled&&(r.include(s3e,t),r.uniforms.add(new Lr("inverseViewport",(n,s)=>s.inverseViewport))),r.code.add(F`
    void main() {
      ${t.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?F`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:F`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function Lae(t){return t??qu}const Dae=Ct(),Xnt=Object.freeze(Object.defineProperty({__proto__:null,build:Wnt},Symbol.toStringTag,{value:"Module"}));let KSe=class QSe extends wr{initializeConfiguration(e,i){i.spherical=e.viewingMode===ht.Global}initializeProgram(e){return new fr(e.rctx,QSe.shader.get().build(this.configuration),ar)}setPipelineState(e){const i=e?Tr.ALWAYS:Tr.LESS;return this.configuration.depthHudEnabled?mi({depthTest:{func:i},depthWrite:ic}):mi({blending:Zo(et.ONE,et.SRC_ALPHA,et.ONE_MINUS_SRC_ALPHA,et.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:Oi})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}};KSe.shader=new pr(Xnt,()=>ke(()=>import("./LineCallout.glsl-33d1b452.js"),[],import.meta.url));let bh=class extends _l{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.multipassEnabled=!1}};_([ce()],bh.prototype,"screenCenterOffsetUnitsEnabled",void 0),_([ce()],bh.prototype,"spherical",void 0),_([ce()],bh.prototype,"occlusionTestEnabled",void 0),_([ce()],bh.prototype,"hasVerticalOffset",void 0),_([ce()],bh.prototype,"hasScreenSizePerspective",void 0),_([ce()],bh.prototype,"depthHudEnabled",void 0),_([ce()],bh.prototype,"depthHudAlignStartEnabled",void 0),_([ce()],bh.prototype,"hasSlicePlane",void 0),_([ce()],bh.prototype,"multipassEnabled",void 0),_([ce({constValue:!0})],bh.prototype,"hasSliceInVertexProgram",void 0),_([ce({constValue:!1})],bh.prototype,"draped",void 0);let IP=class fq extends jv{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new eEe),this._configuration=new bh,this._uniqueMaterialIdentifier=fq.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,i){const r=i?.slot!==De.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration}intersect(){}produces(e,i){if(i===oe.Color)switch(e){case De.LINE_CALLOUTS:case De.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new Jnt(e)}createBufferWriter(){return new Znt}validateParameters(e){const i=fq.uniqueMaterialIdentifier(e);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(e){return JSON.stringify({horizontalScreenOffset:e.horizontalScreenOffset??0,centerOffsetUnits:e.centerOffsetUnits||"world"})}},Jnt=class extends zv{beginSlot(e){return this.ensureTechnique(KSe,e)}},eEe=class extends JK{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const Ynt=wn().vec3f(X.POSITION).vec3f(X.NORMAL).vec2f(X.UV0).vec4f(X.AUXPOS1),Nae=[kh(0,0),kh(1,0),kh(0,1),kh(1,0),kh(1,1),kh(0,1)];let Znt=class{constructor(){this.vertexBufferLayout=Ynt}elementCount(e){return 6*e.attributes.get(X.POSITION).indices.length}write(e,i,r,n,s){YK(r.attributes.get(X.POSITION),e,n.position,s,6),ZK(r.attributes.get(X.NORMAL),i,n.normal,s,6),GS(r.attributes.get(X.AUXPOS1),n.auxpos1,s,6);for(let a=0;a<Nae.length;++a)n.uv0.setVec(s+a,Nae[a])}},tEe=class iEe extends q0{constructor(e,i){super(e,null,i,Qnt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new IP(this._materialParameters),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.horizontalScreenOffset=e.horizontalScreenOffset??0,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){const e=new eEe,i=this.symbol,r=i.callout;if(e.color=r.color!=null?mt.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=Xo(r.size||0),i.verticalOffset){const{screenLength:a,minWorldLength:u,maxWorldLength:p}=i.verticalOffset;e.verticalOffset={screenLength:Xo(a),minWorldLength:u||0,maxWorldLength:p??1/0}}e.borderColor=r.border?.color!=null?mt.toUnitRGBA(r.border.color):null;const n=i.symbolLayers.at(0).type==="object",s=i.type==="label-3d";return e.occlusionTest=!n,e.shaderPolygonOffset=n?0:void 0,e.depthHUDAlignStart=s,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Knt}createGraphics3DGraphic(e){const i=e.renderingInfo,r=e.graphic,n=this.setGraphicElevationContext(r,new h8,i.elevationOffset||0),s=i.symbol,a=this._elevationContext.mode==="on-the-ground"&&(s.type==="cim"||!s.symbolLayers.some(p=>p.type==="object"||p.type==="text"));if(s.type!=="label-3d"&&a||s.type==="point-3d"&&s.symbolLayers.every(p=>p.type==="text"&&!u_e(p)))return null;const u=iQ(r.geometry);return u==null?null:this._createAs3DShape(u,n,i,r.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=xR(iEe.elevationModeChangeTypes,r,n);return s!==Hn.UPDATE||e.forEach(a=>{const u=i(a);u!=null&&this.updateGraphicElevationContext(a.graphic,u)}),s}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}updateGraphicElevationContext(e,i){this.setGraphicElevationContext(e,i.elevationContext,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=hd(i.elevationContext.mode)}computeComplexity(){return new Ih({verticesPerFeature:6})}_createVertexData(e){const{translation:i,centerOffset:r}=e,n=new Et(i?[i[0],i[1],i[2]]:[0,0,0],ez,3,!0),s=new Et(r?[r[0],r[1],r[2],r[3]]:[0,0,0,1],ez,4,!0);return[[X.POSITION,n],[X.NORMAL,new Et([0,0,1],ez,3,!0)],[X.AUXPOS1,s]]}_getOrCreateMaterial(e){const i=this._perInstanceMaterialParameters(e),r=IP.uniqueMaterialIdentifier(i);if(r===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let n=e.materialCollection.get(r);return n==null&&(n=new IP(i),e.materialCollection.add(r,n)),{material:n,isUnique:!1}}return{material:new IP(i),isUnique:!0}}_createAs3DShape(e,i,r,n){const s=this._context.layer.uid,a=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:s}),u=this._getOrCreateMaterial(r),p=new Is(u.material,this._createVertexData(r),null,Gn.Point,a),y=mQ(this._context,e,p,i,n);if(y==null)return null;const b=new H0(this,y.object,[p],u.isUnique?[u.material]:null,null,C2,i);return b.metadata=new oSe(r.elevationOffset),b.alignedSampledElevation=y.sampledElevation,b.needsElevationUpdates=hd(i.mode),pO(b,e,this._context.elevationProvider),b}};tEe.elevationModeChangeTypes={definedChanged:Hn.UPDATE,staysOnTheGround:Hn.UPDATE,onTheGroundChanged:Hn.RECREATE};const ez=[0],Knt={mode:"relative-to-ground",offset:0},Qnt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let est=class{constructor(e,i,r=H(),n=ji(),s=0,a="world",u=0,p=null){this.renderer=e,this.symbol=i,this.translation=r,this.centerOffset=n,this.horizontalScreenOffset=s,this.centerOffsetUnits=a,this.elevationOffset=u,this.materialCollection=p}},tst=class extends Rrt{};const Fae=Ee.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function ist(t,e){if(!rZ(t))return Fae.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=rst[t.callout.type];return i?new i(t,e):(Fae.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const rst={line:tEe},gQ=(t,e,i)=>[e,i],qS=(t,e,i)=>[e,i,t[2]],yQ=(t,e,i)=>[e,i,t[2],t[3]];function IDt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function nst({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function sst({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function rEe({scale:t,translate:e},i){return i*t[0]+e[0]}function nEe({scale:t,translate:e},i){return e[1]-i*t[1]}function sEe(t,e,i){const r=new Array(i.length);if(!i.length)return r;const[n,s]=t.scale;let a=rEe(t,i[0][0]),u=nEe(t,i[0][1]);r[0]=e(i[0],a,u);for(let p=1;p<i.length;p++){const y=i[p];a+=y[0]*n,u-=y[1]*s,r[p]=e(y,a,u)}return r}function oEe(t,e,i){const r=new Array(i.length);for(let n=0;n<i.length;n++)r[n]=sEe(t,e,i[n]);return r}function ost(t,e,i,r){return sEe(t,i?r?yQ:qS:r?qS:gQ,e)}function ast(t,e,i,r){return oEe(t,i?r?yQ:qS:r?qS:gQ,e)}function lst(t,e,i,r){return oEe(t,i?r?yQ:qS:r?qS:gQ,e)}function $Dt(t,e,i,r,n){return e.x=nst(t,i.x),e.y=sst(t,i.y),e!==i&&(r&&(e.z=i.z),n&&(e.m=i.m)),e}function aEe(t,e,i,r,n){return i!=null&&(e.points=ost(t,i.points,r,n)),e}function lEe(t,e,i,r,n){return i==null||(e.x=rEe(t,i.x),e.y=nEe(t,i.y),e!==i&&(r&&(e.z=i.z),n&&(e.m=i.m))),e}function cEe(t,e,i,r,n){return i!=null&&(e.rings=lst(t,i.rings,r,n)),e}function uEe(t,e,i,r,n){return i!=null&&(e.paths=ast(t,i.paths,r,n)),e}var mq;let G5=mq=class extends Ne{constructor(t){super(t),this.name=null,this.code=null}clone(){return new mq({name:this.name,code:this.code})}};_([T({type:String,json:{write:!0}})],G5.prototype,"name",void 0),_([T({type:[String,Number],json:{write:!0}})],G5.prototype,"code",void 0),G5=mq=_([Z("esri.layers.support.CodedValue")],G5);const cst=new br({inherited:"inherited",codedValue:"coded-value",range:"range"});let H5=class extends Ne{constructor(e){super(e),this.name=null,this.type=null}};_([T({type:String,json:{write:!0}})],H5.prototype,"name",void 0),_([Bt(cst)],H5.prototype,"type",void 0),H5=_([Z("esri.layers.support.Domain")],H5);const hN=H5;var gq;let q5=gq=class extends hN{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const i=String(t);this.codedValues.some(r=>(String(r.code)===i&&(e=r.name),!!e))}return e}clone(){return new gq({codedValues:Ce(this.codedValues),name:this.name})}};_([T({type:[G5],json:{write:!0}})],q5.prototype,"codedValues",void 0),_([Bt({codedValue:"coded-value"})],q5.prototype,"type",void 0),q5=gq=_([Z("esri.layers.support.CodedValueDomain")],q5);const hEe=q5;var yq;let P$=yq=class extends hN{constructor(t){super(t),this.type="inherited"}clone(){return new yq}};_([Bt({inherited:"inherited"})],P$.prototype,"type",void 0),P$=yq=_([Z("esri.layers.support.InheritedDomain")],P$);const dEe=P$;var vq;let Ax=vq=class extends hN{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new vq({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};_([T({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]}}}})],Ax.prototype,"maxValue",void 0),_([T({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[0]},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]}}}})],Ax.prototype,"minValue",void 0),_([Bt({range:"range"})],Ax.prototype,"type",void 0),Ax=vq=_([Z("esri.layers.support.RangeDomain")],Ax);const pEe=Ax,fEe={key:"type",base:hN,typeMap:{range:pEe,"coded-value":hEe,inherited:dEe}};function dN(t){if(!t?.type)return null;switch(t.type){case"range":return pEe.fromJSON(t);case"codedValue":return hEe.fromJSON(t);case"inherited":return dEe.fromJSON(t)}return null}var _q;const ust=new br({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let il=_q=class extends Ne{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?.value??null}readValueType(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?ust.fromJSON(i.fieldValueType):null}clone(){return new _q({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};_([T({type:String,json:{write:!0}})],il.prototype,"alias",void 0),_([T({type:[String,Number],json:{write:{allowNull:!0}}})],il.prototype,"defaultValue",void 0),_([T()],il.prototype,"description",void 0),_([rt("description")],il.prototype,"readDescription",null),_([T({types:fEe,json:{read:{reader:dN},write:!0}})],il.prototype,"domain",void 0),_([T({type:Boolean,json:{write:!0}})],il.prototype,"editable",void 0),_([T({type:Wr,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],il.prototype,"length",void 0),_([T({type:String,json:{write:!0}})],il.prototype,"name",void 0),_([T({type:Boolean,json:{write:!0}})],il.prototype,"nullable",void 0),_([Bt(OY)],il.prototype,"type",void 0),_([T()],il.prototype,"valueType",void 0),_([rt("valueType",["description"])],il.prototype,"readValueType",null),_([T({type:Boolean,json:{read:!1}})],il.prototype,"visible",void 0),il=_q=_([Z("esri.layers.support.Field")],il);const OR=il;let DDt=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function FDt(t){return t.geometry!=null}let kDt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function UDt(t){const e=k4.fromJSON(t.geometryType),i=dt.fromJSON(t.spatialReference),r=t.transform,n=t.features.map(s=>{const a=hst(s,e,i,t.objectIdFieldName),u=a.geometry;if(u!=null&&r)switch(u.type){case"point":a.geometry=lEe(r,u,u,u.hasZ,u.hasM);break;case"multipoint":a.geometry=aEe(r,u,u,!!u.hasZ,!!u.hasM);break;case"polygon":a.geometry=cEe(r,u,u,!!u.hasZ,!!u.hasM);break;case"polyline":a.geometry=uEe(r,u,u,!!u.hasZ,!!u.hasM);break;case"extent":case"mesh":a.geometry=u}return a});return{geometryType:e,features:n,spatialReference:i,fields:t.fields?.map(s=>OR.fromJSON(s))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function hst(t,e,i,r){return{uid:zu(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:dst(t.geometry,e,i),visible:!0}}function dst(t,e,i){if(t==null)return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function pst(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(t.hasZ?1:0)+(t.hasM?1:0),n=t.type==="polyline"?t.paths:t.rings;for(const s of n)i+=s.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32*(n.length+1);break}case"multipoint":{const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.points.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=rv(t.vertexAttributes.position,t.vertexAttributes.normal,t.vertexAttributes.uv,t.vertexAttributes.tangent)}return e}function jDt(t){let e=32;return e+=Qfe(t.attributes),e+=3,e+=8+pst(t.geometry),e}function BDt(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function VDt(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function GDt(t,e){switch(cn(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)AF(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)AF(e,t.rings[i],!!t.hasZ);break;case"multipoint":AF(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function fst(t,e){switch(rd(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)cF(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)cF(e,t.rings[i]);break;case"multipoint":cF(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function HDt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}let sw=class mEe{constructor(e=null,i={},r,n){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new mEe(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function qDt(t){return!!t.geometry?.coords?.length}let WDt=class extends sw{},mst=class gEe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new gEe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}},Av=class I${constructor(e=[],i=[],r=!1){this.lengths=e??[],this.coords=i??[],this.hasIndeterminateRingOrder=r}static fromRect(e){const[i,r,n,s]=e,a=n-i,u=s-r;return new I$([5],[i,r,a,0,0,u,-a,0,0,-u])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const n=this.lengths[r];for(let s=0;s<n;s++)e(this.coords[2*(s+i)],this.coords[2*(s+i)+1]);i+=n}}clone(e){return e?(e.set(this.coords),new I$(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new I$(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}};function Ba(t,e){return t?e?4:3:e?3:2}const RR=Ee.getLogger("esri.layers.graphics.featureConversionUtils"),yEe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},gst=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s},kae=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+2]},yst=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+3]},vst=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+2],t[i+3]=e[r+3]};function vQ(t,e,i,r){if(t){if(i)return e&&r?vst:kae;if(e&&r)return yst}else if(e&&r)return kae;return gst}function tz({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function iz({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function rz({scale:t,translate:e},i,r){return i*t[r]+e[r]}function JDt(t,e,i){return t?e?i?wQ(t):_Q(t):i?bQ(t):pN(t):null}function pN(t){const e=t.coords;return{x:e[0],y:e[1]}}function vEe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function _Q(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function _st(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function bQ(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function bst(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function wQ(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function wst(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function xst(t,e,i,r){let n=pN;i&&r?n=wQ:i?n=_Q:r&&(n=bQ);for(const s of e){const{geometry:a,attributes:u}=s,p=a!=null?n(a):null;t.push({attributes:u,geometry:p})}return t}function xQ(t,e){return t&&e?wst:t?_st:e?bst:vEe}function Tst(t,e,i,r,n){const s=xQ(i,r);for(const{geometry:a,attributes:u}of e){const p=a!=null?s(new Av,a):null;t.push(new sw(p,u,null,n?u[n]:void 0))}return t}function YDt(t,e,i=xQ(e.z!=null,e.m!=null)){return i(t,e)}function Sst(t,e,i,r){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?_Ee(n,i,r):null});return t}function _Ee(t,e,i){if(t==null)return null;const r=Ba(e,i),n=[];for(let s=0;s<t.coords.length;s+=r){const a=[];for(let u=0;u<r;u++)a.push(t.coords[s+u]);n.push(a)}return e?i?{points:n,hasZ:e,hasM:i}:{points:n,hasZ:e}:i?{points:n,hasM:i}:{points:n}}function Est(t,e,i,r,n){const s=Ba(i,r);for(const{geometry:a,attributes:u}of e){const p=a!=null?bEe(new Av,a,s):null;t.push(new sw(p,u,null,n?u[n]:void 0))}return t}function bEe(t,e,i=Ba(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let n=0;for(const s of e.points)for(let a=0;a<i;a++)r[n++]=s[a];return t}function Cst(t,e,i,r){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?wEe(n,i,r):null});return t}function wEe(t,e,i){if(!t)return null;const r=Ba(e,i),{coords:n,lengths:s}=t,a=[];let u=0;for(const p of s){const y=[];for(let b=0;b<p;b++){const S=[];for(let C=0;C<r;C++)S.push(n[u++]);y.push(S)}a.push(y)}return e?i?{paths:a,hasZ:e,hasM:i}:{paths:a,hasZ:e}:i?{paths:a,hasM:i}:{paths:a}}function Ast(t,e,i,r,n){const s=Ba(i,r);for(const{geometry:a,attributes:u}of e){const p=a!=null?xEe(new Av,a,s):null;t.push(new sw(p,u,null,n?u[n]:void 0))}return t}function xEe(t,e,i=Ba(e.hasZ,e.hasM)){const{lengths:r,coords:n}=t;let s=0;for(const a of e.paths){for(const u of a)for(let p=0;p<i;p++)n[s++]=u[p];r.push(a.length)}return t}function Ost(t,e,i,r){for(const{geometry:n,attributes:s,centroid:a}of e){const u=n!=null?TEe(n,i,r):null;if(a!=null){const p=pN(a);t.push({attributes:s,centroid:p,geometry:u})}else t.push({attributes:s,geometry:u})}return t}function TEe(t,e,i){if(!t)return null;const r=Ba(e,i),{coords:n,lengths:s}=t,a=[];let u=0;for(const p of s){const y=[];for(let b=0;b<p;b++){const S=[];for(let C=0;C<r;C++)S.push(n[u++]);y.push(S)}a.push(y)}return e?i?{rings:a,hasZ:e,hasM:i}:{rings:a,hasZ:e}:i?{rings:a,hasM:i}:{rings:a}}function Rst(t,e,i,r,n){for(const{geometry:s,centroid:a,attributes:u}of e){const p=s!=null?SEe(new Av,s,i,r):null,y=n?u[n]:void 0;a!=null?t.push(new sw(p,u,vEe(new Av,a),y)):t.push(new sw(p,u,null,y))}return t}function SEe(t,e,i=e.hasZ,r=e.hasM){return Mst(t,e.rings,i,r)}function Mst(t,e,i,r){const n=Ba(i,r),{lengths:s,coords:a}=t;let u=0;mg(t);for(const p of e){for(const y of p)for(let b=0;b<n;b++)a[u++]=y[b];s.push(p.length)}return t}const WT=[],r4=[];function ZDt(t,e,i,r,n){WT[0]=t;const[s]=EEe(r4,WT,e,i,r,n);return jp(WT),jp(r4),s}function EEe(t,e,i,r,n,s){if(jp(t),!i){for(const a of e){const u=s?a.attributes[s]:void 0;t.push(new sw(null,a.attributes,null,u))}return t}switch(i){case"esriGeometryPoint":return Tst(t,e,r,n,s);case"esriGeometryMultipoint":return Est(t,e,r,n,s);case"esriGeometryPolyline":return Ast(t,e,r,n,s);case"esriGeometryPolygon":return Rst(t,e,r,n,s);default:RR.error("convertToFeatureSet:unknown-geometry",new de(`Unable to parse unknown geometry type '${i}'`)),jp(t)}return t}function KDt(t,e,i,r){r4[0]=t,CEe(WT,r4,e,i,r);const n=WT[0];return jp(WT),jp(r4),n}function Pst(t,e,i){if(t==null)return null;const r=new Av;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),hY(t)?xQ(e??t.z!=null,i??t.m!=null)(r,t):m2(t)?SEe(r,t,e,i):dY(t)?xEe(r,t,Ba(e,i)):uY(t)?bEe(r,t,Ba(e,i)):void RR.error("convertFromGeometry:unknown-geometry",new de(`Unable to parse unknown geometry type '${t}'`))}function Ist(t,e,i,r){const n=t&&("coords"in t?t:t.geometry);if(n==null)return null;switch(e){case"esriGeometryPoint":{let s=pN;return i&&r?s=wQ:i?s=_Q:r&&(s=bQ),s(n)}case"esriGeometryMultipoint":return _Ee(n,i,r);case"esriGeometryPolyline":return wEe(n,i,r);case"esriGeometryPolygon":return TEe(n,i,r);default:return RR.error("convertToGeometry:unknown-geometry",new de(`Unable to parse unknown geometry type '${e}'`)),null}}function $st(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function CEe(t,e,i,r,n){if(jp(t),i==null)return $st(t,e);switch(i){case"esriGeometryPoint":return xst(t,e,r,n);case"esriGeometryMultipoint":return Sst(t,e,r,n);case"esriGeometryPolyline":return Cst(t,e,r,n);case"esriGeometryPolygon":return Ost(t,e,r,n);default:RR.error("convertToFeatureSet:unknown-geometry",new de(`Unable to parse unknown geometry type '${i}'`))}return t}function QDt(t){const{objectIdFieldName:e,spatialReference:i,transform:r,fields:n,hasM:s,hasZ:a,features:u,geometryType:p,exceededTransferLimit:y,uniqueIdField:b,queryGeometry:S,queryGeometryType:C}=t,O={features:CEe([],u,p,a,s),fields:n,geometryType:p,objectIdFieldName:e,spatialReference:i,uniqueIdField:b,queryGeometry:Ist(S,C,!1,!1)};return r&&(O.transform=r),y&&(O.exceededTransferLimit=y),s&&(O.hasM=s),a&&(O.hasZ=a),O}function e7t(t,e){const i=new mst,{hasM:r,hasZ:n,features:s,objectIdFieldName:a,spatialReference:u,geometryType:p,exceededTransferLimit:y,transform:b,fields:S}=t;return S&&(i.fields=S),i.geometryType=p??null,i.objectIdFieldName=a??e??null,i.spatialReference=u??null,i.objectIdFieldName?(s&&EEe(i.features,s,p,n,r,i.objectIdFieldName),y&&(i.exceededTransferLimit=y),r&&(i.hasM=r),n&&(i.hasZ=n),b&&(i.transform=b),i):(RR.error(new de("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function t7t(t){const{transform:e,features:i,hasM:r,hasZ:n}=t;if(!e)return t;for(const s of i)s.geometry!=null&&Uae(s.geometry,s.geometry,r,n,e),s.centroid!=null&&Uae(s.centroid,s.centroid,r,n,e);return t.transform=null,t}function i7t(t,e){const{geometryType:i,features:r,hasM:n,hasZ:s}=e;if(!t)return e;for(let a=0;a<r.length;a++){const u=r[a],p=u.weakClone();p.geometry=new Av,zae(p.geometry,u.geometry,n,s,i,t),u.centroid&&(p.centroid=new Av,zae(p.centroid,u.centroid,n,s,"esriGeometryPoint",t)),r[a]=p}return e.transform=t,e}function zae(t,e,i,r,n,s,a=i,u=r){if(mg(t),!e?.coords.length)return null;const p=yEe[n],{coords:y,lengths:b}=e,S=Ba(i,r),C=Ba(i&&a,r&&u),O=vQ(i,r,a,u);if(!b.length)return O(t.coords,y,0,0,tz(s,y[0]),iz(s,y[1])),mg(t,S,0),t;let P,$,N,z,U=0,j=0,G=j;for(const q of b){if(q<p)continue;let W=0;j=G,N=P=tz(s,y[U]),z=$=iz(s,y[U+1]),O(t.coords,y,j,U,N,z),W++,U+=S,j+=C;for(let K=1;K<q;K++,U+=S)N=tz(s,y[U]),z=iz(s,y[U+1]),N===P&&z===$||(O(t.coords,y,j,U,N-P,z-$),j+=C,W++,P=N,$=z);W>=p&&(t.lengths.push(W),G=j)}return jp(t.coords,G),t.coords.length?t:null}function r7t(t,e,i,r,n,s,a=i,u=r){if(mg(t),!e?.coords.length)return null;const p=yEe[n],{coords:y,lengths:b}=e,S=Ba(i,r),C=Ba(i&&a,r&&u),O=vQ(i,r,a,u);if(!b.length)return O(t.coords,y,0,0,y[0],y[1]),mg(t,S,0),t;let P=0;const $=s*s;for(const N of b){if(N<p){P+=N*S;continue}const z=t.coords.length/C,U=P,j=P+(N-1)*S;O(t.coords,y,t.coords.length,U,y[U],y[U+1]),bq(t.coords,y,S,$,O,U,j),O(t.coords,y,t.coords.length,j,y[j],y[j+1]);const G=t.coords.length/C-z;G>=p?t.lengths.push(G):jp(t.coords,z*C),P+=N*S}return t.coords.length?t:null}function Lst(t,e,i,r){const n=t[e],s=t[e+1],a=t[i],u=t[i+1],p=t[r],y=t[r+1];let b=a,S=u,C=p-b,O=y-S;if(C!==0||O!==0){const P=((n-b)*C+(s-S)*O)/(C*C+O*O);P>1?(b=p,S=y):P>0&&(b+=C*P,S+=O*P)}return C=n-b,O=s-S,C*C+O*O}function bq(t,e,i,r,n,s,a){let u,p=r,y=0;for(let b=s+i;b<a;b+=i)u=Lst(e,b,s,a),u>p&&(y=b,p=u);p>r&&(y-s>i&&bq(t,e,i,r,n,s,y),n(t,e,t.length,y,e[y],e[y+1]),a-y>i&&bq(t,e,i,r,n,y,a))}function n7t(t,e,i,r){if(!e?.coords?.length)return null;const n=Ba(i,r);let s=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,p=Number.NEGATIVE_INFINITY;if(e&&e.coords){const y=e.coords;for(let b=0;b<y.length;b+=n){const S=y[b],C=y[b+1];s=Math.min(s,S),u=Math.max(u,S),a=Math.min(a,C),p=Math.max(p,C)}}return kV(t)?HUe(t,s,a,u,p):nY(s,a,u,p,t),t}function Uae(t,e,i,r,n){const{coords:s,lengths:a}=e,u=Ba(i,r);if(!s.length)return t!==e&&mg(t),t;_D(n);const{originPosition:p,scale:y,translate:b}=n,S=Nst;S.originPosition=p;const C=S.scale;C[0]=y[0]??1,C[1]=-(y[1]??1),C[2]=y[2]??1,C[3]=y[3]??1;const O=S.translate;if(O[0]=b[0]??0,O[1]=b[1]??0,O[2]=b[2]??0,O[3]=b[3]??0,!a.length){for(let $=0;$<u;++$)t.coords[$]=rz(S,s[$],$);return t!==e&&mg(t,u,0),t}let P=0;for(let $=0;$<a.length;$++){const N=a[$];t.lengths[$]=N;for(let j=0;j<u;++j)t.coords[P+j]=rz(S,s[P+j],j);let z=t.coords[P],U=t.coords[P+1];P+=u;for(let j=1;j<N;j++,P+=u){z+=s[P]*C[0],U+=s[P+1]*C[1],t.coords[P]=z,t.coords[P+1]=U;for(let G=2;G<u;++G)t.coords[P+G]=rz(S,s[P+G],G)}}return t!==e&&mg(t,s.length,a.length),t}function s7t(t,e,i,r,n,s){if(mg(t),t.lengths.push(...e.lengths),i===n&&r===s)for(let a=0;a<e.coords.length;a++)t.coords.push(e.coords[a]);else{const a=Ba(i,r),u=vQ(i,r,n,s),p=e.coords;for(let y=0;y<p.length;y+=a)u(t.coords,p,t.coords.length,y,p[y],p[y+1])}return t}function Dst(t,e,i,r){let n=0,s=t[r*e],a=t[r*(e+1)];for(let u=1;u<i;u++){const p=s+t[r*(e+u)],y=a+t[r*(e+u)+1],b=(p-s)*(y+a);s=p,a=y,n+=b}return .5*n}function o7t(t,e){const{coords:i,lengths:r}=t;let n=0,s=0;for(let a=0;a<r.length;a++){const u=r[a];s+=Dst(i,n,u,e),n+=u}return Math.abs(s)}function mg(t,e=0,i=0){jp(t.lengths,i),jp(t.coords,e)}function jp(t,e=0){t.length!==e&&(t.length=e)}const Nst={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},jae=new Ua(Array,t=>r7(t,Kve),null,10,5),Fst=Di();let kst=class{get labelLayers(){return this._labelLayers||YPe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e?.isElevationSource)}constructor(e,i,r,n,s){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._visibleFlags=da.ALL_LABEL,this.deconflictionPriority=0,++i.referenced,this._featureExpressionFeature=s?iSe(s,e,n):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,i){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(i),e.setVisibility(this.isVisible(Co.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=Co.GRAPHIC,i){const r=i?this._visibleFlags|i|Co.LABEL*i:this._visibleFlags;return e===Co.GRAPHIC?(r&da.ALL_GRAPHIC)===da.ALL_GRAPHIC:(r&da.ALL_LABEL)===da.ALL_LABEL}setVisibilityFlag(e,i,r){const n=this.isVisible(e);r?this._visibleFlags|=e*i:this._visibleFlags&=~(e*i);const s=this.isVisible(e);if(n===s)return!1;if(e===Co.LABEL)this._forEachLabelGraphic(a=>a.setVisibility(s));else{this._forEachSymbolLayerGraphic(u=>u.setVisibility(s));const a=this.isVisible(Co.LABEL);this._forEachLabelGraphic(u=>u.setVisibility(a))}return!0}getVisibilityFlag(e,i){return(this._visibleFlags&e*i)!=0}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(i==null)return!1;this._extent=Di(),fst(i,this._extent);const r=i.spatialReference;if(!Wn(r,e)&&!h7(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,i,r){let n=e.geometry;return n.type!=="mesh"&&n.type!=="extent"||(n=nd.fromExtent(n.type==="mesh"?n.extent:n)),Pst(n,i,r)}get usedMemory(){let e=Qfe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>e+=i.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:H(),num:0},draped:{origin:Ct(),num:0}};for(const i of this.layers)i?.computeAttachmentOrigin(e);return e.render.num>1&&Pe(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Ic(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,n,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?cn(s.boundingBox):s.boundingBox=cn(),s.requiresDrapedElevation=!1,await CD(this.layers,async a=>{if(a==null)return;const u=a.type==="draped"?i:e,p=jae.acquire(),y=await a.getProjectedBoundingBox(u,r,s.screenSpaceObjects,n,p);isFinite(y[2])&&isFinite(y[5])||(s.requiresDrapedElevation=!0),y&&AS(s.boundingBox,p),jae.release(p)}),VUe(s.boundingBox)||lB(ZY(s.boundingBox,Fst))?s:null}needsElevationUpdates(){for(const e of this.layers)if(e!=null&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;return this._labelLayers?.some(e=>e?.needsElevationUpdates??!1)??!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(n=>{n.type!=="object3d"&&n.type!=="lod-instance"||n.alignWithElevation(e,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(n=>{n.type==="object3d"&&n.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(e,i))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}_forEachGraphicList(e,i){e?.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:i=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(i)}}}},l7t=class{constructor(e,i){this.scheduler=e,this.schedule=i,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},zst=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var Bae,Vae,Gae,wq={exports:{}};wq.exports,Bae=wq,Vae=function(){function t(ee,re,fe){fe=fe||2;var ye,we,Ae,Oe,Ve,at,Xt,ti=re&&re.length,Vt=ti?re[0]*fe:ee.length,Qt=e(ee,0,Vt,fe,!0),St=[];if(!Qt||Qt.next===Qt.prev)return St;if(ti&&(Qt=p(ee,re,Qt,fe)),ee.length>80*fe){ye=Ae=ee[0],we=Oe=ee[1];for(var ze=fe;ze<Vt;ze+=fe)(Ve=ee[ze])<ye&&(ye=Ve),(at=ee[ze+1])<we&&(we=at),Ve>Ae&&(Ae=Ve),at>Oe&&(Oe=at);Xt=(Xt=Math.max(Ae-ye,Oe-we))!==0?1/Xt:0}return r(Qt,St,fe,ye,we,Xt),St}function e(ee,re,fe,ye,we){var Ae,Oe;if(we===Se(ee,re,fe,ye)>0)for(Ae=re;Ae<fe;Ae+=ye)Oe=pe(Ae,ee[Ae],ee[Ae+1],Oe);else for(Ae=fe-ye;Ae>=re;Ae-=ye)Oe=pe(Ae,ee[Ae],ee[Ae+1],Oe);if(Oe&&q(Oe,Oe.next)){var Ve=Oe.next;ge(Oe),Oe=Ve}return Oe}function i(ee,re){if(!ee)return ee;re||(re=ee);var fe,ye=ee;do if(fe=!1,ye.steiner||!q(ye,ye.next)&&G(ye.prev,ye,ye.next)!==0)ye=ye.next;else{var we=ye.prev;if(ge(ye),(ye=re=we)===ye.next)break;fe=!0}while(fe||ye!==re);return re}function r(ee,re,fe,ye,we,Ae,Oe){if(ee){!Oe&&Ae&&P(ee,ye,we,Ae);for(var Ve,at,Xt=ee;ee.prev!==ee.next;)if(Ve=ee.prev,at=ee.next,Ae?s(ee,ye,we,Ae):n(ee))re.push(Ve.i/fe),re.push(ee.i/fe),re.push(at.i/fe),ge(ee),ee=at.next,Xt=at.next;else if((ee=at)===Xt){Oe?Oe===1?r(ee=a(i(ee),re,fe),re,fe,ye,we,Ae,2):Oe===2&&u(ee,re,fe,ye,we,Ae):r(i(ee),re,fe,ye,we,Ae,1);break}}}function n(ee){var re=ee.prev,fe=ee,ye=ee.next;if(G(re,fe,ye)>=0)return!1;for(var we=ee.next.next;we!==ee.prev;){if(U(re.x,re.y,fe.x,fe.y,ye.x,ye.y,we.x,we.y)&&G(we.prev,we,we.next)>=0)return!1;we=we.next}return!0}function s(ee,re,fe,ye){var we=ee.prev,Ae=ee,Oe=ee.next;if(G(we,Ae,Oe)>=0)return!1;for(var Ve=we.x<Ae.x?we.x<Oe.x?we.x:Oe.x:Ae.x<Oe.x?Ae.x:Oe.x,at=we.y<Ae.y?we.y<Oe.y?we.y:Oe.y:Ae.y<Oe.y?Ae.y:Oe.y,Xt=we.x>Ae.x?we.x>Oe.x?we.x:Oe.x:Ae.x>Oe.x?Ae.x:Oe.x,ti=we.y>Ae.y?we.y>Oe.y?we.y:Oe.y:Ae.y>Oe.y?Ae.y:Oe.y,Vt=N(Ve,at,re,fe,ye),Qt=N(Xt,ti,re,fe,ye),St=ee.prevZ,ze=ee.nextZ;St&&St.z>=Vt&&ze&&ze.z<=Qt;){if(St!==ee.prev&&St!==ee.next&&U(we.x,we.y,Ae.x,Ae.y,Oe.x,Oe.y,St.x,St.y)&&G(St.prev,St,St.next)>=0||(St=St.prevZ,ze!==ee.prev&&ze!==ee.next&&U(we.x,we.y,Ae.x,Ae.y,Oe.x,Oe.y,ze.x,ze.y)&&G(ze.prev,ze,ze.next)>=0))return!1;ze=ze.nextZ}for(;St&&St.z>=Vt;){if(St!==ee.prev&&St!==ee.next&&U(we.x,we.y,Ae.x,Ae.y,Oe.x,Oe.y,St.x,St.y)&&G(St.prev,St,St.next)>=0)return!1;St=St.prevZ}for(;ze&&ze.z<=Qt;){if(ze!==ee.prev&&ze!==ee.next&&U(we.x,we.y,Ae.x,Ae.y,Oe.x,Oe.y,ze.x,ze.y)&&G(ze.prev,ze,ze.next)>=0)return!1;ze=ze.nextZ}return!0}function a(ee,re,fe){var ye=ee;do{var we=ye.prev,Ae=ye.next.next;!q(we,Ae)&&W(we,ye,ye.next,Ae)&&le(we,Ae)&&le(Ae,we)&&(re.push(we.i/fe),re.push(ye.i/fe),re.push(Ae.i/fe),ge(ye),ge(ye.next),ye=ee=Ae),ye=ye.next}while(ye!==ee);return i(ye)}function u(ee,re,fe,ye,we,Ae){var Oe=ee;do{for(var Ve=Oe.next.next;Ve!==Oe.prev;){if(Oe.i!==Ve.i&&j(Oe,Ve)){var at=ne(Oe,Ve);return Oe=i(Oe,Oe.next),at=i(at,at.next),r(Oe,re,fe,ye,we,Ae),void r(at,re,fe,ye,we,Ae)}Ve=Ve.next}Oe=Oe.next}while(Oe!==ee)}function p(ee,re,fe,ye){var we,Ae,Oe,Ve=[];for(we=0,Ae=re.length;we<Ae;we++)(Oe=e(ee,re[we]*ye,we<Ae-1?re[we+1]*ye:ee.length,ye,!1))===Oe.next&&(Oe.steiner=!0),Ve.push(z(Oe));for(Ve.sort(y),we=0;we<Ve.length;we++)fe=i(fe=S(Ve[we],fe),fe.next);return fe}function y(ee,re){return ee.x-re.x}function b(ee){if(ee.next.prev===ee)return ee;let re=ee;for(;;){const fe=re.next;if(fe.prev===re||fe===re||fe===ee)break;re=fe}return re}function S(ee,re){var fe=C(ee,re);if(!fe)return re;var ye=ne(fe,ee),we=i(fe,fe.next);let Ae=b(ye);return i(Ae,Ae.next),we=b(we),b(re===fe?we:re)}function C(ee,re){var fe,ye=re,we=ee.x,Ae=ee.y,Oe=-1/0;do{if(Ae<=ye.y&&Ae>=ye.next.y&&ye.next.y!==ye.y){var Ve=ye.x+(Ae-ye.y)*(ye.next.x-ye.x)/(ye.next.y-ye.y);if(Ve<=we&&Ve>Oe){if(Oe=Ve,Ve===we){if(Ae===ye.y)return ye;if(Ae===ye.next.y)return ye.next}fe=ye.x<ye.next.x?ye:ye.next}}ye=ye.next}while(ye!==re);if(!fe)return null;if(we===Oe)return fe;var at,Xt=fe,ti=fe.x,Vt=fe.y,Qt=1/0;ye=fe;do we>=ye.x&&ye.x>=ti&&we!==ye.x&&U(Ae<Vt?we:Oe,Ae,ti,Vt,Ae<Vt?Oe:we,Ae,ye.x,ye.y)&&(at=Math.abs(Ae-ye.y)/(we-ye.x),le(ye,ee)&&(at<Qt||at===Qt&&(ye.x>fe.x||ye.x===fe.x&&O(fe,ye)))&&(fe=ye,Qt=at)),ye=ye.next;while(ye!==Xt);return fe}function O(ee,re){return G(ee.prev,ee,re.prev)<0&&G(re.next,ee,ee.next)<0}function P(ee,re,fe,ye){var we=ee;do we.z===null&&(we.z=N(we.x,we.y,re,fe,ye)),we.prevZ=we.prev,we.nextZ=we.next,we=we.next;while(we!==ee);we.prevZ.nextZ=null,we.prevZ=null,$(we)}function $(ee){var re,fe,ye,we,Ae,Oe,Ve,at,Xt=1;do{for(fe=ee,ee=null,Ae=null,Oe=0;fe;){for(Oe++,ye=fe,Ve=0,re=0;re<Xt&&(Ve++,ye=ye.nextZ);re++);for(at=Xt;Ve>0||at>0&&ye;)Ve!==0&&(at===0||!ye||fe.z<=ye.z)?(we=fe,fe=fe.nextZ,Ve--):(we=ye,ye=ye.nextZ,at--),Ae?Ae.nextZ=we:ee=we,we.prevZ=Ae,Ae=we;fe=ye}Ae.nextZ=null,Xt*=2}while(Oe>1);return ee}function N(ee,re,fe,ye,we){return(ee=1431655765&((ee=858993459&((ee=252645135&((ee=16711935&((ee=32767*(ee-fe)*we)|ee<<8))|ee<<4))|ee<<2))|ee<<1))|(re=1431655765&((re=858993459&((re=252645135&((re=16711935&((re=32767*(re-ye)*we)|re<<8))|re<<4))|re<<2))|re<<1))<<1}function z(ee){var re=ee,fe=ee;do(re.x<fe.x||re.x===fe.x&&re.y<fe.y)&&(fe=re),re=re.next;while(re!==ee);return fe}function U(ee,re,fe,ye,we,Ae,Oe,Ve){return(we-Oe)*(re-Ve)-(ee-Oe)*(Ae-Ve)>=0&&(ee-Oe)*(ye-Ve)-(fe-Oe)*(re-Ve)>=0&&(fe-Oe)*(Ae-Ve)-(we-Oe)*(ye-Ve)>=0}function j(ee,re){return ee.next.i!==re.i&&ee.prev.i!==re.i&&!ae(ee,re)&&(le(ee,re)&&le(re,ee)&&me(ee,re)&&(G(ee.prev,ee,re.prev)||G(ee,re.prev,re))||q(ee,re)&&G(ee.prev,ee,ee.next)>0&&G(re.prev,re,re.next)>0)}function G(ee,re,fe){return(re.y-ee.y)*(fe.x-re.x)-(re.x-ee.x)*(fe.y-re.y)}function q(ee,re){return ee.x===re.x&&ee.y===re.y}function W(ee,re,fe,ye){var we=se(G(ee,re,fe)),Ae=se(G(ee,re,ye)),Oe=se(G(fe,ye,ee)),Ve=se(G(fe,ye,re));return we!==Ae&&Oe!==Ve||!(we!==0||!K(ee,fe,re))||!(Ae!==0||!K(ee,ye,re))||!(Oe!==0||!K(fe,ee,ye))||!(Ve!==0||!K(fe,re,ye))}function K(ee,re,fe){return re.x<=Math.max(ee.x,fe.x)&&re.x>=Math.min(ee.x,fe.x)&&re.y<=Math.max(ee.y,fe.y)&&re.y>=Math.min(ee.y,fe.y)}function se(ee){return ee>0?1:ee<0?-1:0}function ae(ee,re){var fe=ee;do{if(fe.i!==ee.i&&fe.next.i!==ee.i&&fe.i!==re.i&&fe.next.i!==re.i&&W(fe,fe.next,ee,re))return!0;fe=fe.next}while(fe!==ee);return!1}function le(ee,re){return G(ee.prev,ee,ee.next)<0?G(ee,re,ee.next)>=0&&G(ee,ee.prev,re)>=0:G(ee,re,ee.prev)<0||G(ee,ee.next,re)<0}function me(ee,re){var fe=ee,ye=!1,we=(ee.x+re.x)/2,Ae=(ee.y+re.y)/2;do fe.y>Ae!=fe.next.y>Ae&&fe.next.y!==fe.y&&we<(fe.next.x-fe.x)*(Ae-fe.y)/(fe.next.y-fe.y)+fe.x&&(ye=!ye),fe=fe.next;while(fe!==ee);return ye}function ne(ee,re){var fe=new ve(ee.i,ee.x,ee.y),ye=new ve(re.i,re.x,re.y),we=ee.next,Ae=re.prev;return ee.next=re,re.prev=ee,fe.next=we,we.prev=fe,ye.next=fe,fe.prev=ye,Ae.next=ye,ye.prev=Ae,ye}function pe(ee,re,fe,ye){var we=new ve(ee,re,fe);return ye?(we.next=ye.next,we.prev=ye,ye.next.prev=we,ye.next=we):(we.prev=we,we.next=we),we}function ge(ee){ee.next.prev=ee.prev,ee.prev.next=ee.next,ee.prevZ&&(ee.prevZ.nextZ=ee.nextZ),ee.nextZ&&(ee.nextZ.prevZ=ee.prevZ)}function ve(ee,re,fe){this.i=ee,this.x=re,this.y=fe,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Se(ee,re,fe,ye){for(var we=0,Ae=re,Oe=fe-ye;Ae<fe;Ae+=ye)we+=(ee[Oe]-ee[Ae])*(ee[Ae+1]+ee[Oe+1]),Oe=Ae;return we}return t.deviation=function(ee,re,fe,ye){var we=re&&re.length,Ae=we?re[0]*fe:ee.length,Oe=Math.abs(Se(ee,0,Ae,fe));if(we)for(var Ve=0,at=re.length;Ve<at;Ve++){var Xt=re[Ve]*fe,ti=Ve<at-1?re[Ve+1]*fe:ee.length;Oe-=Math.abs(Se(ee,Xt,ti,fe))}var Vt=0;for(Ve=0;Ve<ye.length;Ve+=3){var Qt=ye[Ve]*fe,St=ye[Ve+1]*fe,ze=ye[Ve+2]*fe;Vt+=Math.abs((ee[Qt]-ee[ze])*(ee[St+1]-ee[Qt+1])-(ee[Qt]-ee[St])*(ee[ze+1]-ee[Qt+1]))}return Oe===0&&Vt===0?0:Math.abs((Vt-Oe)/Oe)},t.flatten=function(ee){for(var re=ee[0][0].length,fe={vertices:[],holes:[],dimensions:re},ye=0,we=0;we<ee.length;we++){for(var Ae=0;Ae<ee[we].length;Ae++)for(var Oe=0;Oe<re;Oe++)fe.vertices.push(ee[we][Ae][Oe]);we>0&&(ye+=ee[we-1].length,fe.holes.push(ye))}return fe},t},(Gae=Vae())!==void 0&&(Bae.exports=Gae);const WS=CE(wq.exports),fN=Ee.getLogger("esri.views.3d.support.buffer.math");function Ust(t,e,i){Bp(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function Bp(t,e,i,r=3,n=r){if(t.length/r!==Math.ceil(e.length/n))return fN.error("source and destination buffers need to have the same number of elements"),t;const s=t.length/r,a=i[0],u=i[1],p=i[2],y=i[4],b=i[5],S=i[6],C=i[8],O=i[9],P=i[10],$=i[12],N=i[13],z=i[14];let U=0,j=0;for(let G=0;G<s;G++){const q=e[U],W=e[U+1],K=e[U+2];t[j]=a*q+y*W+C*K+$,t[j+1]=u*q+b*W+O*K+N,t[j+2]=p*q+S*W+P*K+z,U+=n,j+=r}return t}function AEe(t,e,i){Vp(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function Vp(t,e,i,r=3,n=r){if(t.length/r!==Math.ceil(e.length/n))return void fN.error("source and destination buffers need to have the same number of elements");const s=t.length/r,a=i[0],u=i[1],p=i[2],y=i[3],b=i[4],S=i[5],C=i[6],O=i[7],P=i[8];let $=0,N=0;for(let z=0;z<s;z++){const U=e[$],j=e[$+1],G=e[$+2];t[N]=a*U+y*j+C*G,t[N+1]=u*U+b*j+O*G,t[N+2]=p*U+S*j+P*G,$+=n,N+=r}}function jst(t,e,i){f8(t.typedBuffer,e,i,t.typedBufferStride)}function f8(t,e,i,r=3){const n=Math.min(t.length/r,e.count),s=e.typedBuffer,a=e.typedBufferStride;let u=0,p=0;for(let y=0;y<n;y++)t[p]=i*s[u],t[p+1]=i*s[u+1],t[p+2]=i*s[u+2],u+=a,p+=r}function Bst(t,e){mN(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function mN(t,e,i=3,r=i){const n=Math.min(t.length/i,e.length/r);let s=0,a=0;for(let u=0;u<n;u++){const p=e[s],y=e[s+1],b=e[s+2],S=p*p+y*y+b*b;if(S>0){const C=1/Math.sqrt(S);t[a]=C*p,t[a+1]=C*y,t[a+2]=C*b}s+=r,a+=i}}function Vst(t,e,i){const r=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,a=e.typedBuffer,u=e.typedBufferStride;let p=0,y=0;for(let b=0;b<r;b++)n[y]=a[p]>>i,n[y+1]=a[p+1]>>i,n[y+2]=a[p+2]>>i,p+=u,y+=s}Object.freeze(Object.defineProperty({__proto__:null,normalize:mN,normalizeView:Bst,scale:f8,scaleView:jst,shiftRight:Vst,transformMat3:Vp,transformMat3View:AEe,transformMat4:Bp,transformMat4View:Ust},Symbol.toStringTag,{value:"Module"}));function Gst(t,e,i){return{objectId:t,target:e,distance:i,type:"vertex"}}function Hae(t,e,i,r,n,s=!1){return{objectId:t,target:e,distance:i,type:"edge",start:r,end:n,draped:s}}var gg,Ho;function Gy(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function mO(t){return t!=null&&!isNaN(t)&&isFinite(t)}function OEe(t){return t.valueExpression?gg.Expression:t.field&&typeof t.field=="string"?gg.Field:gg.Unknown}function Hst(t,e){const i=e||OEe(t),r=t.valueUnit||"unknown";return i===gg.Unknown?Ho.Constant:t.stops?Ho.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?Ho.ClampedLinear:r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?Ho.Proportional:Ho.Additive:Ho.Identity:Ho.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(gg||(gg={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(Ho||(Ho={}));const Ov=Ee.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),qae=new Fp,$$=Math.PI,REe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function MEe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(P=>P.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Ov.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const n=typeof e=="number",s=n?null:e,a=s?.attributes;let u=n?e:null;const p=r.field,{ipData:y,hasExpression:b}=r.cache;let S=r.cache.compiledFunc;if(!p&&!b){const P=r.stops;return P&&P[0]&&P[0].color}if(typeof u!="number")if(b){if(i?.arcade==null)return void Ov.error("Use of arcade expressions requires an arcade context");const P={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},$=i.arcade.arcadeUtils,N=$.getViewInfo(P),z=$.createExecContext(s,N,i.timeZone);if(!S){const U=$.createSyntaxTree(r.valueExpression);S=$.createFunction(U),r.cache.compiledFunc=S}u=$.executeFunction(S,z)}else a&&(u=a[p]);const C=r.normalizationField,O=a!=null&&C!=null?parseFloat(a[C]):void 0;if(u!=null&&(!C||n||!isNaN(O)&&O!==0)){isNaN(O)||n||(u/=O);const P=SQ(u,y);if(P){const $=P[0],N=P[1],z=$===N?r.stops[$].color:mt.blendColors(r.stops[$].color,r.stops[N].color,P[2],i?.color);return new mt(z)}}}function PEe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(P=>P.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Ov.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const n=typeof e=="number",s=n?null:e,a=s?.attributes;let u=n?e:null;const p=r.field,{ipData:y,hasExpression:b}=r.cache;let S=r.cache.compiledFunc;if(!p&&!b){const P=r.stops;return P&&P[0]&&P[0].opacity}if(typeof u!="number")if(b){if(i?.arcade==null)return void Ov.error("Use of arcade expressions requires an arcade context");const P={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},$=i.arcade.arcadeUtils,N=$.getViewInfo(P),z=$.createExecContext(s,N,i.timeZone);if(!S){const U=$.createSyntaxTree(r.valueExpression);S=$.createFunction(U),r.cache.compiledFunc=S}u=$.executeFunction(S,z)}else a&&(u=a[p]);const C=r.normalizationField,O=a!=null&&C!=null?parseFloat(a[C]):void 0;if(u!=null&&(!C||n||!isNaN(O)&&O!==0)){isNaN(O)||n||(u/=O);const P=SQ(u,y);if(P){const $=P[0],N=P[1];if($===N)return r.stops[$].opacity;{const z=r.stops[$].opacity;return z+(r.stops[N].opacity-z)*P[2]}}}}function IEe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(O=>O.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Ov.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const n=r.axis||"heading",s=n==="heading"&&r.rotationType==="arithmetic"?90:0,a=n==="heading"&&r.rotationType==="arithmetic"?-1:1,u=typeof e=="number"?null:e,p=u?.attributes,y=r.field,{hasExpression:b}=r.cache;let S=r.cache.compiledFunc,C=0;if(!y&&!b)return C;if(b){if(i?.arcade==null)return void Ov.error("Use of arcade expressions requires an arcade context");const O={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},P=i.arcade.arcadeUtils,$=P.getViewInfo(O),N=P.createExecContext(u,$,i.timeZone);if(!S){const z=P.createSyntaxTree(r.valueExpression);S=P.createFunction(z),r.cache.compiledFunc=S}C=P.executeFunction(S,N)}else p&&(C=p[y]||0);return C=typeof C!="number"||isNaN(C)?null:s+a*C,C}function qst(t,e,i){const r=typeof e=="number",n=r?null:e,s=n?.attributes;let a=r?e:null;const{isScaleDriven:u}=t.cache;let p=t.cache.compiledFunc;if(u){const b=i?.scale,S=i?.view;a=b==null||S==="3d"?Wst(t):b}else if(!r)switch(t.inputValueType){case gg.Expression:{if(i?.arcade==null)return void Ov.error("Use of arcade expressions requires an arcade context");const b={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},S=i.arcade.arcadeUtils,C=S.getViewInfo(b),O=S.createExecContext(n,C,i.timeZone);if(!p){const P=S.createSyntaxTree(t.valueExpression);p=S.createFunction(P),t.cache.compiledFunc=p}a=S.executeFunction(p,O);break}case gg.Field:s&&(a=s[t.field]);break;case gg.Unknown:a=null}if(!mO(a))return null;if(r||!t.normalizationField)return a;const y=s?parseFloat(s[t.normalizationField]):null;return mO(y)&&y!==0?a/y:null}function Wst(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function gN(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(s=>s.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Ov.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const n=LEe(qst(r,e,i),r,e,i,r.cache.ipData);return n==null||isNaN(n)?0:n}function Bc(t,e,i){return t==null?null:Gy(t)?gN(t,e,i):mO(t)?t:null}function $Ee(t,e,i){return mO(i)&&t>i?i:mO(e)&&t<e?e:t}function Xst(t,e,i,r){return t+((Bc(e.minSize,i,r)||e.minDataValue)??0)}function Jst(t,e,i){const r=t.stops;let n=r?.length&&r[0].size;return n==null&&(n=t.minSize),Bc(n,e,i)}function Yst(t,e,i,r){const n=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),s=Bc(e.minSize,i,r),a=Bc(e.maxSize,i,r),u=r?.shape;if(t<=e.minDataValue)return s;if(t>=e.maxDataValue)return a;if(s==null||a==null)return null;if(e.scaleBy==="area"&&u){const p=u==="circle",y=p?$$*(s/2)**2:s*s,b=y+n*((p?$$*(a/2)**2:a*a)-y);return p?2*Math.sqrt(b/$$):Math.sqrt(b)}return s+n*(a-s)}function Zst(t,e,i,r){const n=r?.shape,s=t/e.minDataValue,a=Bc(e.minSize,i,r),u=Bc(e.maxSize,i,r);let p=null;return p=n==="circle"?2*Math.sqrt(s*(a/2)**2):n==="square"||n==="diamond"||n==="image"?Math.sqrt(s*a**2):s*a,$Ee(p,a,u)}function Kst(t,e,i,r,n){const[s,a,u]=SQ(t,n);if(s===a)return Bc(e.stops?.[s].size,i,r);{const p=Bc(e.stops?.[s].size,i,r);return p+(Bc(e.stops?.[a].size,i,r)-p)*u}}function Qst(t,e,i,r){const n=(r?.resolution??1)*jS[e.valueUnit],s=Bc(e.minSize,i,r),a=Bc(e.maxSize,i,r),{valueRepresentation:u}=e;let p=null;return p=u==="area"?2*Math.sqrt(t/$$)/n:u==="radius"||u==="distance"?2*t/n:t/n,$Ee(p,s,a)}function LEe(t,e,i,r,n){switch(e.transformationType){case Ho.Additive:return Xst(t,e,i,r);case Ho.Constant:return Jst(e,i,r);case Ho.ClampedLinear:return Yst(t,e,i,r);case Ho.Proportional:return Zst(t,e,i,r);case Ho.Stops:return Kst(t,e,i,r,n);case Ho.RealWorldSize:return Qst(t,e,i,r);case Ho.Identity:return t;case Ho.Unknown:return null}}function eot(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const n={scale:e,view:i};let s=Bc(t.minSize,qae,n),a=Bc(t.maxSize,qae,n);if(s!=null||a!=null){if(s>a){const u=a;a=s,s=u}return{minSize:s,maxSize:a}}}function TQ(t,e,i){if(!t.visualVariables)return;const r=[],n=[],s=[],a=[],u=[];for(const p of t.visualVariables)switch(p.type){case"color":n.push(p);break;case"opacity":s.push(p);break;case"rotation":u.push(p);break;case"size":a.push(p)}return n.forEach(p=>{const y=MEe(p,e,i);r.push({variable:p,value:y})}),s.forEach(p=>{const y=PEe(p,e,i);r.push({variable:p,value:y})}),u.forEach(p=>{const y=IEe(p,e,i);r.push({variable:p,value:y})}),a.forEach(p=>{const y=gN(p,e,i);r.push({variable:p,value:y})}),r.filter(p=>p.value!=null)}function SQ(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((n,s)=>t<n?(r=s,!0):(i=s,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function tot(t,e,i){const r=["proportional","proportional","proportional"];for(const n of t){const s=n.useSymbolValue?"symbol-value":gN(n,e,i);switch(n.axis){case"width":r[0]=s;break;case"depth":r[1]=s;break;case"height":r[2]=s;break;case"width-and-depth":r[0]=s,r[1]=s;break;case"all":case void 0:case null:r[0]=s,r[1]=s,r[2]=s;break;default:n.axis}}return r}const h7t=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:tot,getColor:MEe,getOpacity:PEe,getRotationAngle:IEe,getSize:gN,getSizeForValue:LEe,getSizeFromNumberOrVariable:Bc,getSizeRangeAtScale:eot,getVisualVariableValues:TQ,viewScaleRE:REe},Symbol.toStringTag,{value:"Module"}));function yN(t,e){if(!t||t.symbol)return null;const i=e?.renderer;return t&&i!=null&&i.getObservationRenderer?i.getObservationRenderer(t):i}function iot(t,e){if(t.symbol!=null)return t.symbol;const i=yN(t,e);return i!=null&&i.type!=="dot-density"?i.getSymbol(t,e):null}function d7t(t,e){const i=yN(t,e),r=iot(t,e);if(r==null)return null;const n={renderer:i,symbol:r};if(i==null||!("visualVariables"in i)||!i.visualVariables)return n;const s=TQ(i,t,e)??[],a=["proportional","proportional","proportional"];for(const{variable:u,value:p}of s)switch(u.type){case"color":n.color=p.toRgba();break;case"size":if(u.target==="outline")n.outlineSize=p;else{const y=u.axis,b=u.useSymbolValue?"symbol-value":p;switch(y){case"width":a[0]=b;break;case"depth":a[1]=b;break;case"height":a[2]=b;break;case"width-and-depth":a[0]=a[1]=b;break;default:a[0]=a[1]=a[2]=b}}break;case"opacity":n.opacity=p;break;case"rotation":switch(u.axis){case"tilt":n.tilt=p;break;case"roll":n.roll=p;break;default:n.heading=p}}return a[0]==="proportional"&&a[1]==="proportional"&&a[2]==="proportional"||(n.size=a),n}async function rot(t,e){if(t.symbol!=null)return t.symbol;const i=yN(t,e);return i!=null?i.getSymbolAsync(t,e):null}async function p7t(t,e){const i=yN(t,e),r=await rot(t,e);if(!r)return null;const n={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return n;const s=TQ(i,t,e)??[],a=["proportional","proportional","proportional"];for(const{variable:u,value:p}of s)if(u.type==="color")n.color=mt.toUnitRGBA(p);else if(u.type==="size")if(u.target==="outline")n.outlineSize=p;else{const y=u.axis,b=u.useSymbolValue?"symbol-value":p;y==="width"?a[0]=b:y==="depth"?a[1]=b:y==="height"?a[2]=b:a[0]=a[1]=y==="width-and-depth"?b:a[2]=b}else u.type==="opacity"?n.opacity=p:u.type==="rotation"&&u.axis==="tilt"?n.tilt=p:u.type==="rotation"&&u.axis==="roll"?n.roll=p:u.type==="rotation"&&(n.heading=p);return(isFinite(a[0])||isFinite(a[1])||isFinite(a[2]))&&(n.size=a),n}function not(t,e=0){const i=t[e];return typeof i=="number"&&isFinite(i)?i:null}function sot(t){for(let e=0;e<3;e++){const i=t[e];if(typeof i=="number")return isFinite(i)?i:0}return 0}function oot(t,e,i,r){const n=(a=>!Array.isArray(a[0]))(e)?(a,u)=>e[3*a+u]:(a,u)=>e[a][u],s=r?Va(r)/aS(r):1;return fZ(t,(a,u)=>$e(a,n(u,0)*s,n(u,1)*s,n(u,2)),i)}function DEe(t,e,i){const r=oot(Wae,t,e,i)?Wae:[0,0,1];return Math.abs(r[2])>Math.cos(gi(80))?$n.Z:Math.abs(r[1])>Math.abs(r[0])?$n.Y:$n.X}const Wae=gr();function aot(t,e,i){const r=DEe(t,(e.length>0?e[0]:t.length/3)-1,i);if(r!==$n.Z){t=t.slice();for(let n=0;n<t.length;n+=3)t[n+r]=t[n+2]}return WS(t,e,3)}function Xae(t){const e=[[X.POSITION,new Et(t.attributeData.position,t.indices,3,!0)]],i=Uv(t.indices.length);return t.attributeData.colorFeature!=null?e.push([X.COLORFEATUREATTRIBUTE,new Et([t.attributeData.colorFeature],i,1,!0)]):t.attributeData.color&&e.push([X.COLOR,new Et(t.attributeData.color,i,4,!0)]),t.attributeData.uvMapSpace&&e.push([X.UVMAPSPACE,new Et(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([X.BOUNDINGRECT,new Et(t.attributeData.boundingRect,t.indices,9,!0)]),new Is(t.material,e,t.mapPositions,Gn.Mesh,t.attributeData.objectAndLayerIdColor)}function Jae(t,e=null){const i=[[X.POSITION,new Et(t.attributeData.position,t.indices,3,!0)],[X.UV0,new Et(t.attributeData.uv0,t.indices,2,!0)]];return new Is(t.material,i,t.mapPositions,Gn.Mesh,e)}function gO(t){switch(t.type){case"extent":if(t instanceof rr)return nd.fromExtent(t);break;case"polygon":return t}return null}let vN=class{constructor(e,i,r){this.renderData=e,this.layerUid=i,this.graphicUid=r,this.outGeometries=new Array}};function xq(t,e,i){const r=Array.isArray(t),n=r?t.length/e:t.byteLength/(4*e),s=r?t:new Uint32Array(t,0,n*e),a=i?.minReduction??0,u=i?.originalIndices||null,p=u?u.length:0,y=i?.componentOffsets||null;let b=0;if(y)for(let W=0;W<y.length-1;W++){const K=y[W+1]-y[W];K>b&&(b=K)}else b=n;const S=Math.floor(1.1*b)+1;(sf==null||sf.length<2*S)&&(sf=new Uint32Array(bge(2*S)));for(let W=0;W<2*S;W++)sf[W]=0;let C=0;const O=!!y&&!!u,P=O?p:n;let $=qL(n);const N=new Uint32Array(p),z=1.96;let U=a!==0?Math.ceil(4*z*z/(a*a)*a*(1-a)):P,j=1,G=y?y[1]:P;for(let W=0;W<P;W++){if(W===U){const ne=1-C/W;if(ne+z*Math.sqrt(ne*(1-ne)/W)<a)return null;U*=2}if(W===G){for(let ne=0;ne<2*S;ne++)sf[ne]=0;if(u)for(let ne=y[j-1];ne<y[j];ne++)N[ne]=$[u[ne]];G=y[++j]}const K=O?u[W]:W,se=K*e,ae=uot(s,se,e);let le=ae%S,me=C;for(;sf[2*le+1]!==0;){if(sf[2*le]===ae){const ne=sf[2*le+1]-1;if(lot(s,se,ne*e,e)){me=$[ne];break}}le++,le>=S&&(le-=S)}me===C&&(sf[2*le]=ae,sf[2*le+1]=K+1,C++),$[K]=me}if(a!==0&&1-C/n<a)return null;if(O){for(let W=y[j-1];W<N.length;W++)N[W]=$[u[W]];$=v0(N)}const q=r?new Array(C):new Uint32Array(C*e);C=0;for(let W=0;W<P;W++)$[W]===C&&(cot(s,(O?u[W]:W)*e,q,C*e,e),C++);if(u&&!O){const W=new Uint32Array(p);for(let K=0;K<W.length;K++)W[K]=$[u[K]];$=v0(W)}return{buffer:Array.isArray(q)?q:q.buffer,indices:$,uniqueCount:C}}function lot(t,e,i,r){for(let n=0;n<r;n++)if(t[e+n]!==t[i+n])return!1;return!0}function cot(t,e,i,r,n){for(let s=0;s<n;s++)i[r+s]=t[e+s]}function uot(t,e,i){let r=0;for(let n=0;n<i;n++)r=t[e+n]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let sf=null;function m7t(t){const e=MR(t.rings,t.hasZ,I0.CCW_IS_HOLE,t.spatialReference),i=new Array;let r=0,n=0;for(const u of e.polygons){const p=u.count,y=u.index,b=Xh(e.position,3*y,3*p),S=u.holeIndices.map(O=>O-y),C=v0(WS(b,S,3));i.push({position:b,faces:C}),r+=b.length,n+=C.length}const s=hot(i,r,n),a=Array.isArray(s.position)?xq(s.position,3,{originalIndices:s.faces}):xq(s.position.buffer,6,{originalIndices:s.faces});return s.position=H3e(new Float64Array(a.buffer)),s.faces=a.indices,s}function hot(t,e,i){if(t.length===1)return t[0];const r=Ro(e),n=new Array(i);let s=0,a=0,u=0;for(const p of t){for(let y=0;y<p.position.length;y++)r[s++]=p.position[y];for(const y of p.faces)n[a++]=y+u;u=s/3}return{position:r,faces:v0(n)}}function MR(t,e,i,r){const n=t.length,s=new Array(n),a=new Array(n),u=new Array(n);let p=0,y=0,b=0,S=0;for(let P=0;P<n;++P)S+=t[P].length;const C=Ro(3*S);let O=0;for(let P=n-1;P>=0;P--){const $=t[P],N=i===I0.CCW_IS_HOLE&&dot($,e,r);if(N&&n!==1)s[p++]=$;else{let z=$.length;for(let j=0;j<p;++j)z+=s[j].length;const U={index:O,pathLengths:new Array(p+1),count:z,holeIndices:new Array(p)};U.pathLengths[0]=$.length,$.length>0&&(u[b++]={index:O,count:$.length}),O=N?$P($,$.length-1,-1,C,O,$.length,e):$P($,0,1,C,O,$.length,e);for(let j=0;j<p;++j){const G=s[j];U.holeIndices[j]=O,U.pathLengths[j+1]=G.length,G.length>0&&(u[b++]={index:O,count:G.length}),O=$P(G,0,1,C,O,G.length,e)}p=0,U.count>0&&(a[y++]=U)}}for(let P=0;P<p;++P){const $=s[P];$.length>0&&(u[b++]={index:O,count:$.length}),O=$P($,0,1,C,O,$.length,e)}return a.length=y,u.length=b,{position:C,polygons:a,outlines:u}}function $P(t,e,i,r,n,s,a){n*=3;for(let u=0;u<s;++u){const p=t[e];r[n++]=p[0],r[n++]=p[1],r[n++]=a?p[2]:0,e+=i}return n/3}function dot(t,e,i){if(e){const r=t.length-1,n=DEe(t,r,i);if(n===$n.X)return!yI(t,$n.Y,$n.Z);if(n===$n.Y)return!yI(t,$n.X,$n.Z)}return!yI(t,$n.X,$n.Y)}var I0;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(I0||(I0={}));var n4,m8,Tq;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(n4||(n4={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(m8||(m8={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(Tq||(Tq={}));var Ss,zh,s4,Hs;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(Ss||(Ss={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(zh||(zh={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(s4||(s4={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(Hs||(Hs={}));let pot=class{constructor(e,i){this.vec3=e,this.id=i}};function g8(t,e,i,r){return new pot(st(t,e,i),r)}let Yae=class{constructor(){this._extent=Di(),this.resolution=0,this.renderLocalOrigin=g8(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new fot}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];oL(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];oL(this._extent,-e.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Sg(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}},fot=class{constructor(){this.extents=[Di(),Di(),Di()],this.numViews=0}};var bn;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(bn||(bn={}));let mot=class{constructor(e,i){this._fbos=e,this._format=i}get valid(){return this._handle!=null}dispose(){this._handle=Gi(this._handle)}get texture(){return this._handle?.colorTexture}bind(e,i,r){this._handle&&this._handle.fbo.width===i&&this._handle.fbo.height===r||(this._handle?.release(),this._handle=this._fbos.acquire(this._format,i,r)),e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.colorTexture?.descriptor?.hasMipmap&&this._handle?.colorTexture?.generateMipmap()}},x3=class{constructor(e,i,r,n=sr.RGBA_MIPMAP){this.output=i,this.content=r,this.fbo=new mot(e,n)}get valid(){return this.fbo.valid}},got=class{constructor(e){this.targets=[new x3(e,oe.Color,bn.Color),new x3(e,oe.Color,bn.ColorNoRasterImage),new x3(e,oe.Highlight,bn.Highlight,sr.RGBA4),new x3(e,oe.Normal,bn.WaterNormal),new x3(e,oe.Color,bn.Occluded)],Me("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new x3(e,oe.ObjectAndLayerIdColor,bn.ObjectAndLayerIdColor))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,i,r)=>i.valid?e|=1<<r:e,0)}},EQ=class extends gSe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=H(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var $c;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})($c||($c={}));let yot=class extends EQ{constructor(){super(...arguments),this.identifier=$c.Material,this.output=oe.Color,this.transparent=!1}},vot=class extends EQ{constructor(){super(...arguments),this.identifier=$c.ShadowMap}},_ot=class extends EQ{constructor(){super(...arguments),this.identifier=$c.Highlight}};function bot(t){t.fragment.code.add(F`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function wot(t){t.fragment.code.add(F`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function xot(t,e){const i=t.fragment;i.include(ld),i.uniforms.add(new Lr("nearFar",(r,n)=>n.camera.nearFar)),i.uniforms.add(new kt("depthMap",(r,n)=>n.linearDepth?.colorTexture)),i.uniforms.add(new On("proj",(r,n)=>n.camera.projectionMatrix)),i.uniforms.add(new lt("invResolutionHeight",(r,n)=>1/n.camera.height)),i.uniforms.add(new On("reprojectionMatrix",(r,n)=>n.ssr.reprojectionMatrix)),i.code.add(F`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function NEe(t,e){t.include(hnt,e),t.include(M7),t.include(wot),e.hasCloudsReflections&&t.include(qwe,e),e.hasScreenSpaceReflections&&t.include(xot,e);const i=t.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(F`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new lt("lightingSpecularStrength",(r,n)=>n.lighting.mainLight.specularStrength),new lt("lightingEnvironmentStrength",(r,n)=>n.lighting.mainLight.environmentStrength)),i.code.add(F`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&i.code.add(F`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(i.uniforms.add(new On("view",(r,n)=>n.camera.viewMatrix),new kt("lastFrameColorTexture",(r,n)=>n.ssr.lastFrameColor?.colorTexture),new lt("fadeFactorSSR",(r,n)=>n.ssr.fadeFactor)),i.code.add(F`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):i.code.add(F`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?i.code.add(F`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(F`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(F`return waterRenderedColor;
}`)}let y8=class extends zn{constructor(e,i){super(e,"vec4",hr.Draw,(r,n,s)=>r.setUniform4fv(e,i(n,s)))}};var u0;function Tot(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new y8("overlayTexOffset",(n,s)=>Sot(n,s)),new y8("overlayTexScale",(n,s)=>Eot(n,s))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new kt("ovColorTex",(n,s)=>Sq(n,s))),FEe(t,e)}function yC(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new Zae("overlayTexOffset"),new Zae("overlayTexScale")),r.uniforms.add(new lt("overlayOpacity",n=>n.overlayOpacity),new kt("ovColorTex",(n,s)=>s.overlay?.getTexture(n.overlayContent))),FEe(t,e)}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(u0||(u0={}));let Zae=class extends zn{constructor(e){super(e,"vec4")}};function FEe(t,e){e.pbrMode!==Gt.Water&&e.pbrMode!==Gt.WaterOnIntegratedMesh&&e.pbrMode!==Gt.TerrainWithWater||t.include(NEe,e);const{vertex:i,fragment:r}=t;t.varyings.add("vtcOverlay","vec4"),i.code.add(F`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(F`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(F`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),r.code.add(F`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==Gt.Water&&e.pbrMode!==Gt.WaterOnIntegratedMesh&&e.pbrMode!==Gt.TerrainWithWater||(jg(r),U0(r),r.code.add(F`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function Sq(t,e){return t.identifier===$c.Material&&t.output===oe.Color?e.overlay?.getTexture(bn.ColorNoRasterImage):t.identifier===$c.Material&&t.output===oe.ObjectAndLayerIdColor?e.overlay?.getTexture(bn.ObjectAndLayerIdColor):t.identifier===$c.Highlight?e.overlay?.getTexture(bn.Highlight):null}function Sot(t,e){const i=e.overlay?.overlays[Ss.INNER]?.extent;sL(i)&&(n0[0]=t.toMapSpace[0]/Na(i)-i[0]/Na(i),n0[1]=t.toMapSpace[1]/Jl(i)-i[1]/Jl(i));const r=e.overlay?.overlays[Ss.OUTER]?.extent;return sL(r)&&(n0[2]=t.toMapSpace[0]/Na(r)-r[0]/Na(r),n0[3]=t.toMapSpace[1]/Jl(r)-r[1]/Jl(r)),n0}function Eot(t,e){const i=e.overlay?.overlays[Ss.INNER]?.extent;sL(i)&&(n0[0]=t.toMapSpace[2]/Na(i),n0[1]=t.toMapSpace[3]/Jl(i));const r=e.overlay?.overlays[Ss.OUTER]?.extent;return sL(r)&&(n0[2]=t.toMapSpace[2]/Na(r),n0[3]=t.toMapSpace[3]/Jl(r)),n0}const n0=ji();let kEe=class extends Vr{constructor(){super(...arguments),this.color=vi(1,1,1,1)}};function Cot(){const t=new lr;return t.include(Ga),t.fragment.uniforms.add(new kt("tex",e=>e.texture),new er("uColor",e=>e.color)),t.fragment.code.add(F`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`),t}const Aot=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:kEe,build:Cot},Symbol.toStringTag,{value:"Module"}));let zEe=class{constructor(e){this._context=e,this._perConstructorInstances=new RE,this._frameCounter=0,this._keepAliveFrameCount=Kae}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,i=Rot){const r=i.key;let n=this._perConstructorInstances.get(e,r);if(n==null){const s=new e(this._context,i,()=>this.release(s));n=new Oot(s),this._perConstructorInstances.set(e,r,n)}return++n.refCount,n.technique}releaseAndAcquire(e,i,r){if(r!=null){if(i.key===r.key)return r;this.release(r)}return this.acquire(e,i)}release(e){if(e==null||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(e.constructor,e.key);i!=null&&(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Kae&&this._perConstructorInstances.forEach((e,i)=>{e.forEach((r,n)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,n))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((i,r)=>{const n=async(s,a)=>{const u=a.shader;u&&(await u.reload(),s.forEach(p=>p.technique.reload(this._context)))};e.push(n(i,r))}),await Promise.all(e)}},Oot=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const Kae=-1,Rot=new rc;let UEe=class{constructor(e,i,r,n){this._textureRepository=e,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=n,this._id2glMaterialRef=new RE}dispose(){this._textureRepository.destroy()}acquire(e,i,r){if(this._ownMaterial(e),!e.produces(i,r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(n==null){const s=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRepository:this._textureRepository,output:r});n=new Mot(s),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);r!=null&&(r.unref(),r.referenced||(jt(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&Ee.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},Mot=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,zt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const Pot=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let Eq=class L${get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new bo,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),bo.clearPool(),Cq[0]=null,a_.prune(),hb.prune()}add(e,i=e.length){this._objectCount+=i,this._grow(e,i);const r=bo.acquire();for(let n=0;n<i;n++){const s=e[n];this._isDegenerate(s)?this._degenerateObjects.add(s):(r.init(this._root),this._add(s,r))}bo.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=bo.acquire();for(const n of e){const s=i??RS(this.objectToBoundingSphere(n),Not);W5(s[3])?(r.init(this._root),this._remove(n,s,r)):this._degenerateObjects.delete(n)}bo.release(r),this._shrink()}update(e,i){if(!W5(i[3])&&this._isDegenerate(e))return;const r=Dot(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const n=eh(e,i);this._forEachNode(this._root,s=>{if(!this._intersectsNode(n,s))return!1;const a=s.node;return a.terminals.forAll(u=>{this._intersectsObject(n,u)&&r(u)}),a.residents!==null&&a.residents.forAll(u=>{this._intersectsObject(n,u)&&r(u)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,n){const s=eh(e,i);this._forEachNode(this._root,a=>{if(!this._intersectsNodeWithOffset(s,a,n))return!1;const u=a.node;return u.terminals.forAll(p=>{this._intersectsObjectWithOffset(s,p,n)&&r(p)}),u.residents!==null&&u.residents.forAll(p=>{this._intersectsObjectWithOffset(s,p,n)&&r(p)}),!0})}forEach(e){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,n=()=>!0,s=1/0){let a=1/0,u=1/0,p=null;const y=nz(e,i),b=S=>{if(--s,!n(S))return;const C=this.objectToBoundingSphere(S);if(!By(r,C))return;const O=wy(e,i,C),P=O-C[3],$=O+C[3];P<a&&(a=P,u=$,p=S)};return this._forEachNodeDepthOrdered(this._root,S=>{if(s<=0||!By(r,S.bounds)||(Pe(ch,y,S.halfSize),Ue(ch,ch,S.bounds),wy(e,i,ch)>u))return!1;const C=S.node;return C.terminals.forAll(O=>b(O)),C.residents!==null&&C.residents.forAll(O=>b(O)),!0},e,i),p}forEachInDepthRange(e,i,r,n,s,a,u){let p=-1/0,y=1/0;const b={setRange:$=>{r===L$.DepthOrder.FRONT_TO_BACK?(p=Math.max(p,$.near),y=Math.min(y,$.far)):(p=Math.max(p,-$.far),y=Math.min(y,-$.near))}};b.setRange(n);const S=wy(i,r,e),C=nz(i,r),O=nz(i,-r),P=$=>{if(!u($))return;const N=this.objectToBoundingSphere($),z=N,U=wy(i,r,z)-S,j=U-N[3],G=U+N[3];j>y||G<p||!By(a,N)||s($,b)};this._forEachNodeDepthOrdered(this._root,$=>{if(!By(a,$.bounds)||(Pe(ch,C,$.halfSize),Ue(ch,ch,$.bounds),wy(i,r,ch)-S>y)||(Pe(ch,O,$.halfSize),Ue(ch,ch,$.bounds),wy(i,r,ch)-S<p))return!1;const N=$.node;return N.terminals.forAll(z=>P(z)),N.residents!==null&&N.residents.forAll(z=>P(z)),!0},i,r)}forEachNode(e){this._forEachNode(this._root,i=>e(i.node,i.bounds,i.halfSize,i.depth))}forEachNeighbor(e,i){const r=ug(i),n=i,s=p=>{const y=this.objectToBoundingSphere(p),b=ug(y),S=r+b;return!(ao(y,n)-S*S<=0)||e(p)};let a=!0;const u=p=>{a&&(a=s(p))};this._forEachNode(this._root,p=>{const y=ug(p.bounds),b=r+y;if(ao(p.bounds,n)-b*b>0)return!1;const S=p.node;return S.terminals.forAll(u),a&&S.residents!==null&&S.residents.forAll(u),a}),a&&this.forEachDegenerateObject(u)}_intersectsNode(e,i){return LP(i.bounds,2*-i.halfSize,Cu),LP(i.bounds,2*i.halfSize,Au),ase(e.origin,e.direction,Cu,Au)}_intersectsNodeWithOffset(e,i,r){return LP(i.bounds,2*-i.halfSize,Cu),LP(i.bounds,2*i.halfSize,Au),r.applyToMinMax(Cu,Au),ase(e.origin,e.direction,Cu,Au)}_intersectsObject(e,i){const r=this.objectToBoundingSphere(i);return!(r[3]>0)||pG(r,e)}_intersectsObjectWithOffset(e,i,r){const n=this.objectToBoundingSphere(i);return!(n[3]>0)||pG(r.applyToBoundingSphere(n),e)}_forEachNode(e,i){let r=bo.acquire().init(e);const n=[r];for(;n.length!==0;){if(r=n.pop(),i(r)&&!r.isLeaf())for(let s=0;s<r.node.children.length;s++)r.node.children[s]&&n.push(bo.acquire().init(r).advance(s));bo.release(r)}}_forEachNodeDepthOrdered(e,i,r,n=L$.DepthOrder.FRONT_TO_BACK){let s=bo.acquire().init(e);const a=[s];for(Lot(r,n,tle);a.length!==0;){if(s=a.pop(),i(s)&&!s.isLeaf())for(let u=7;u>=0;--u){const p=tle[u];s.node.children[p]&&a.push(bo.acquire().init(s).advance(p))}bo.release(s)}}_remove(e,i,r){a_.clear();const n=r.advanceTo(i,(s,a)=>{a_.push(s.node),a_.push(a)})?r.node.terminals:r.node.residents;if(n.removeUnordered(e),n.length===0)for(let s=a_.length-2;s>=0;s-=2){const a=a_.data[s],u=a_.data[s+1];if(!this._purge(a,u))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let i=0;i<e.children.length;i++)if(e.children[i])return!1;return!0}_purge(e,i){return i>=0&&(e.children[i]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new xi({shrink:!0})),!0)}_add(e,i){i.advanceTo(this.objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const n=bo.acquire().init(e);this._add(i.at(r),n),bo.release(n)}}_grow(e,i){if(i!==0&&(Qae(e,i,r=>this.objectToBoundingSphere(r),im),W5(im[3])&&!this._fitsInsideTree(im)))if(this._nodeIsEmpty(this._root.node))RS(im,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(im);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(im,r):this._growRootAsSubNode(r),bo.release(r)}}_rebuildTree(e,i){Ie(oz,i.bounds),oz[3]=i.halfSize,Qae([e,oz],2,n=>n,az);const r=bo.acquire().init(this._root);this._root.initFrom(null,az,az[3]),this._root.increaseHalfSize(1.25),this._forEachNode(r,n=>(this.add(n.node.terminals.data,n.node.terminals.length),n.node.residents!==null&&this.add(n.node.residents.data,n.node.residents.length),!0)),bo.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,n=>(r=Math.max(r,n.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let n=-1/0;const s=this._root.bounds,a=this._root.halfSize;for(let p=0;p<3;p++){const y=s[p]-a-(r[p]-i),b=r[p]+i-(s[p]+a),S=Math.max(0,Math.ceil(y/(2*a))),C=Math.max(0,Math.ceil(b/(2*a)))+1,O=2**Math.ceil(Math.log(S+C)*Math.LOG2E);n=Math.max(n,O),DP[p].min=S,DP[p].max=C}for(let p=0;p<3;p++){let y=DP[p].min,b=DP[p].max;const S=(n-(y+b))/2;y+=Math.ceil(S),b+=Math.floor(S);const C=s[p]-a-y*a*2;sz[p]=C+(b+y)*a}const u=n*a;return sz[3]=u*BEe,bo.acquire().initFrom(null,sz,u,0)}_growRootAsSubNode(e){const i=this._root.node;Ie(im,this._root.bounds),im[3]=this._root.halfSize,this._root.init(e),e.advanceTo(im,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,n=0;for(;n<i.length&&e==null;)r=n++,e=i[r];for(;n<i.length;)if(i[n++])return-1;return r}_isDegenerate(e){return!W5(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:i,_objectCount:r}=this,n=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:i,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:n}}}_nodeToJSON(e){const i=e.children.map(s=>s?this._nodeToJSON(s):null),r=e.residents?.map(s=>this.objectToBoundingSphere(s)),n=e.terminals?.map(s=>this.objectToBoundingSphere(s));return{children:i,residents:r,terminals:n}}static fromJSON(e){const i=new L$(r=>r,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return i._objectCount=e.objectCount,i._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),i}},bo=class Ox{constructor(){this.bounds=as(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,n=this.depth){return this.node=e??Ox.createEmptyNode(),i!=null&&RS(i,this.bounds),this.halfSize=r,this.depth=n,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*BEe}advance(e){let i=this.node.children[e];i||(i=Ox.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=jEe[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const n=this._childIndex(e);i&&i(this,n),this.advance(n)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new xi({shrink:!0}),residents:new xi({shrink:!0})}}static acquire(){return Ox._pool.acquire()}static release(e){Ox._pool.release(e)}static clearPool(){Ox._pool.prune()}};function Iot(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function $ot(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function LP(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function Qae(t,e,i,r){if(e===1){const n=i(t[0]);RS(n,r)}else{Cu[0]=1/0,Cu[1]=1/0,Cu[2]=1/0,Au[0]=-1/0,Au[1]=-1/0,Au[2]=-1/0;for(let n=0;n<e;n++){const s=i(t[n]);W5(s[3])&&(Iot(Cu,s),$ot(Au,s))}Ir(r,Cu,Au,.5),r[3]=Math.max(Au[0]-Cu[0],Au[1]-Cu[1],Au[2]-Cu[2])/2}}function Lot(t,e,i){if(!hb.length)for(let r=0;r<8;++r)hb.push({index:0,distance:0});for(let r=0;r<8;++r){const n=jEe[r];hb.data[r].index=r,hb.data[r].distance=wy(t,e,n)}hb.sort((r,n)=>r.distance-n.distance);for(let r=0;r<8;++r)i[r]=hb.data[r].index}function nz(t,e){let i,r=1/0;for(let n=0;n<8;++n){const s=wy(t,e,ele[n]);s<r&&(r=s,i=ele[n])}return i}function wy(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function W5(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}bo._pool=new Ua(bo),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(Eq||(Eq={}));const jEe=[st(-1,-1,-1),st(1,-1,-1),st(-1,1,-1),st(1,1,-1),st(-1,-1,1),st(1,-1,1),st(-1,1,1),st(1,1,1)],ele=[st(-1,-1,-1),st(-1,-1,1),st(-1,1,-1),st(-1,1,1),st(1,-1,-1),st(1,-1,1),st(1,1,-1),st(1,1,1)],BEe=Math.sqrt(3),Cq=[null];function Dot(t){return Cq[0]=t,Cq}const sz=as(),ch=H(),Cu=H(),Au=H(),a_=new xi,Not=as(),im=as(),oz=as(),az=as(),DP=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],hb=new xi,tle=[0,0,0,0,0,0,0,0],bp=Eq;var ev;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(ev||(ev={}));let VEe=class extends gR{get objects(){return this._objects}constructor(e,i,r=""){super(),this.stage=e,this.apiLayerUid=r,this.type=Gn.Layer,this.events=new Xn,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new xi,this._objectsAdded=new xi,this._handles=new Dg,this.apiLayerUid=r,this.visible=i?.visible??!0,this.pickable=i?.pickable??!0,this.updatePolicy=i?.updatePolicy??ev.ASYNC,this._disableOctree=i?.disableOctree??!1,e.add(this);for(const n of Pot)this._handles.add(this.events.on(n,s=>e.handleEvent(n,s)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const i of e)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const i=new Array;if(this._objects.removeUnorderedMany(e,e.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),this._octree!=null){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){this.updatePolicy!==ev.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,i)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new bp(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=ct(this._octree),this._objectsAdded.clear()}};function v8(t){return t!=null&&t.type===Gn.Layer}var Ju,ow;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(Ju||(Ju={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(ow||(ow={}));let mo=class extends _l{constructor(){super(...arguments),this.output=oe.Color,this.transparencyPassType=Ut.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Ju.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=ow.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===Ju.Draped}};_([ce({count:oe.COUNT})],mo.prototype,"output",void 0),_([ce({count:Ut.COUNT})],mo.prototype,"transparencyPassType",void 0),_([ce()],mo.prototype,"occluder",void 0),_([ce()],mo.prototype,"hasSlicePlane",void 0),_([ce()],mo.prototype,"writeDepth",void 0),_([ce({count:Ju.COUNT})],mo.prototype,"space",void 0),_([ce()],mo.prototype,"hideOnShortSegments",void 0),_([ce()],mo.prototype,"hasCap",void 0),_([ce({count:ow.COUNT})],mo.prototype,"anchor",void 0),_([ce()],mo.prototype,"hasTip",void 0),_([ce()],mo.prototype,"vvSize",void 0),_([ce()],mo.prototype,"vvColor",void 0),_([ce()],mo.prototype,"vvOpacity",void 0),_([ce()],mo.prototype,"hasOccludees",void 0),_([ce()],mo.prototype,"multipassEnabled",void 0),_([ce()],mo.prototype,"cullAboveGround",void 0),_([ce({constValue:!1})],mo.prototype,"occlusionPass",void 0),_([ce({constValue:!0})],mo.prototype,"hasVvInstancing",void 0),_([ce({constValue:!0})],mo.prototype,"hasSliceTranslatedView",void 0);const ile=8;function GEe(t,e){const i=t.vertex;i.uniforms.add(new lt("intrinsicWidth",r=>r.width)),e.vvSize?(t.attributes.add(X.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new _i("vvSizeMinSize",r=>r.vvSize.minSize),new _i("vvSizeMaxSize",r=>r.vvSize.maxSize),new _i("vvSizeOffset",r=>r.vvSize.offset),new _i("vvSizeFactor",r=>r.vvSize.factor)),i.code.add(F`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(X.SIZE,"float"),i.code.add(F`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(X.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new Wl("vvOpacityValues",r=>r.vvOpacity.values,ile),new Wl("vvOpacityOpacities",r=>r.vvOpacity.opacityValues,ile)),i.code.add(F`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(F`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(fg,e),t.attributes.add(X.COLORFEATUREATTRIBUTE,"float"),i.code.add(F`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(X.COLOR,"vec4"),i.code.add(F`vec4 getColor(){
return applyOpacity(color);
}`))}function yO(t,e,i=0){const r=Je(t,0,zot);for(let n=0;n<4;n++)e[i+n]=Math.floor(256*Uot(r*Fot[n]))}function CQ(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*kot[r];return i}const Fot=[1,256,65536,16777216],kot=[1/256,1/65536,1/16777216,1/4294967296],zot=CQ(new Uint8ClampedArray([255,255,255,255]));function Uot(t){return t-Math.floor(t)}let HEe=class{constructor(e,i,r){this._createTexture=e,this._parametersKey=i,this._repository=new Map,this._orphanCache=r.newCache(`procedural-texture-repository:${zu()}`,n=>n.dispose())}destroy(){for(const[e,{texture:i}]of this._repository)i.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,i=null){const r=this._acquire(e);return this.release(i),r}release(e){if(e==null)return;const i=this._parametersKey(e),r=this._repository.get(i);if(r&&(r.refCount--,r.refCount===0)){this._repository.delete(i);const{texture:n}=r,s=n.gpuMemoryUsage;this._orphanCache.put(i,n,s)}}_acquire(e){if(e==null)return null;const i=this._parametersKey(e),r=this._repository.get(i);if(r)return r.refCount++,r.texture;const n=this._orphanCache.pop(i)??this._createTexture(e),s=new jot(n);return this._repository.set(i,s),n}},jot=class{constructor(e){this.texture=e,this.refCount=1}};function Bot(t,e){return new HEe(i=>{const{encodedData:r,textureSize:n}=Vot(i),s=new Ar;return s.internalFormat=ei.RGBA,s.width=n,s.height=1,s.wrapMode=Ai.REPEAT,new yi(t,s,r)},i=>`${i.pattern.join(",")}-r${i.pixelRatio}`,e)}function Vot(t){const e=AQ(t),i=1/t.pixelRatio,r=qEe(t),n=WEe(t),s=(Math.floor(.5*(n-1))+.5)*i,a=[];let u=1;for(const C of e){for(let O=0;O<C;O++){const P=u*(Math.min(O,C-1-O)+.5)*i/s*.5+.5;a.push(P)}u=-u}const p=Math.round(e[0]/2),y=[...a.slice(p),...a.slice(0,p)],b=new Uint8Array(4*r);let S=0;for(const C of y)yO(C,b,S),S+=4;return{encodedData:b,textureSize:r}}function AQ(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function qEe(t){if(t==null)return 1;const e=AQ(t);return Math.floor(e.reduce((i,r)=>i+r))}function WEe(t){return AQ(t).reduce((e,i)=>Math.max(e,i))}function Got(t){return t==null?qu:t.length===4?t:_n(Hot,t[0],t[1],t[2],1)}const Hot=ji();function qot(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?Wot(t,e):Xot(t)}function Wot(t,e){const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:n}=t;n.include(fd),e.draped||(kp(r,e),r.uniforms.add(new lt("worldToScreenPerDistanceRatio",(s,a)=>1/a.camera.perScreenPixelRatio)),r.code.add(F`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),r.code.add(F`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${Yot};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(F`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(F`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),SE(r),r.code.add(F`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),n.uniforms.add(new kt("stipplePatternTexture",s=>s.stippleTexture),new lt("stipplePatternSDFNormalizer",s=>Jot(s.stipplePattern)),new lt("stipplePatternPixelSizeInv",s=>1/XEe(s))),n.code.add(F`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),e.stippleOffColorEnabled?(n.uniforms.add(new er("stippleOffColor",s=>Got(s.stippleOffColor))),n.code.add(F`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):n.code.add(F`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Xot(t){t.fragment.code.add(F`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function Jot(t){return t?(Math.floor(.5*(WEe(t)-1))+.5)/t.pixelRatio:1}function XEe(t){const e=t.stipplePattern;return e?qEe(t.stipplePattern)/e.pixelRatio:1}const Yot=F.float(.4);async function Lg(t,e){const{data:i}=await ir(t,{responseType:"image",...e});return i}function Zot(){if(lz==null){const t=e=>Kr(`esri/libs/basisu/${e}`);lz=ke(()=>import("./basis_transcoder-b48ec9d1.js"),[],import.meta.url).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(i=>(i.initializeBasis(),delete i.then,i)))}return lz}let lz;var qb;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(qb||(qb={}));let Op=null,NP=null;async function JEe(){return NP==null&&(NP=Zot(),Op=await NP),NP}function Kot(t,e){if(Op==null)return t.byteLength;const i=new Op.BasisFile(new Uint8Array(t)),r=ZEe(i)?YEe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function Qot(t,e){if(Op==null)return t.byteLength;const i=new Op.KTX2File(new Uint8Array(t)),r=KEe(i)?YEe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function YEe(t,e,i,r,n){const s=QZ(e?es.COMPRESSED_RGBA8_ETC2_EAC:es.COMPRESSED_RGB8_ETC2),a=n&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*s*a)}function ZEe(t){return t.getNumImages()>=1&&!t.isUASTC()}function KEe(t){return t.getFaces()>=1&&t.isETC1S()}async function eat(t,e,i){Op==null&&(Op=await JEe());const r=new Op.BasisFile(new Uint8Array(i));if(!ZEe(r))return null;r.startTranscoding();const n=QEe(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(s,a)=>r.getImageTranscodedSizeInBytes(0,s,a),(s,a,u)=>r.transcodeImage(u,0,s,a,0,0));return r.close(),r.delete(),n}async function tat(t,e,i){Op==null&&(Op=await JEe());const r=new Op.KTX2File(new Uint8Array(i));if(!KEe(r))return null;r.startTranscoding();const n=QEe(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(s,a)=>r.getImageTranscodedSizeInBytes(s,0,0,a),(s,a,u)=>r.transcodeImage(u,s,0,0,a,0,-1,-1));return r.close(),r.delete(),n}function QEe(t,e,i,r,n,s,a,u){const{compressedTextureETC:p,compressedTextureS3TC:y}=t.capabilities,[b,S]=p?r?[qb.ETC2_RGBA,es.COMPRESSED_RGBA8_ETC2_EAC]:[qb.ETC1_RGB,es.COMPRESSED_RGB8_ETC2]:y?r?[qb.BC3_RGBA,es.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[qb.BC1_RGB,es.COMPRESSED_RGB_S3TC_DXT1_EXT]:[qb.RGBA32,ei.RGBA],C=e.hasMipmap?i:Math.min(1,i),O=[];for(let P=0;P<C;P++)O.push(new Uint8Array(a(P,b))),u(P,b,O[P]);return e.internalFormat=S,e.hasMipmap=O.length>1,e.samplingMode=e.hasMipmap?Si.LINEAR_MIPMAP_LINEAR:Si.LINEAR,e.width=n,e.height=s,new yi(t,e,{type:"compressed",levels:O})}const FP=Ee.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),iat=542327876,rat=131072,nat=4;function OQ(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function sat(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const oat=OQ("DXT1"),aat=OQ("DXT3"),lat=OQ("DXT5"),cat=31,uat=0,hat=1,dat=2,pat=3,fat=4,mat=7,gat=20,yat=21;function vat(t,e,i){const r=_at(i,e.hasMipmap??!1);if(r==null)throw new Error("DDS texture data is null");const{textureData:n,internalFormat:s,width:a,height:u}=r;return e.samplingMode=n.levels.length>1?Si.LINEAR_MIPMAP_LINEAR:Si.LINEAR,e.hasMipmap=n.levels.length>1,e.internalFormat=s,e.width=a,e.height=u,new yi(t,e,n)}function _at(t,e){const i=new Int32Array(t,0,cat);if(i[uat]!==iat)return FP.error("Invalid magic number in DDS header"),null;if(!(i[gat]&nat))return FP.error("Unsupported format, must contain a FourCC code"),null;const r=i[yat];let n,s;switch(r){case oat:n=8,s=es.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case aat:n=16,s=es.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case lat:n=16,s=es.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return FP.error("Unsupported FourCC code:",sat(r)),null}let a=1,u=i[fat],p=i[pat];!(3&u)&&!(3&p)||(FP.warn("Rounding up compressed texture size to nearest multiple of 4."),u=u+3&-4,p=p+3&-4);const y=u,b=p;let S,C;i[dat]&rat&&e!==!1&&(a=Math.max(1,i[mat]));let O=i[hat]+4;const P=[];for(let $=0;$<a;++$)C=(u+3>>2)*(p+3>>2)*n,S=new Uint8Array(t,O,C),P.push(S),O+=C,u=Math.max(1,u>>1),p=Math.max(1,p>>1);return{textureData:{type:"compressed",levels:P},internalFormat:s,width:y,height:b}}let Nw=class extends gR{get parameters(){return this._parameters}constructor(e,i){super(),this._data=e,this.type=Gn.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new Xn,this._parameters={...wat,...i},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=i=>this._frameUpdate(e,i),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(sS(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const i=!e.paused;if(e.src=e.src,i&&e.autoplay){const r=()=>{e.removeEventListener("canplay",r),e.play()};e.addEventListener("canplay",r)}}}_startPreloadImageElement(e){$0(e.src)||sS(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const i=new Ar;return i.wrapMode=this._parameters.wrap??Ai.REPEAT,i.flipped=!this._parameters.noUnpackFlip,i.samplingMode=this._parameters.mipmap?Si.LINEAR_MIPMAP_LINEAR:Si.LINEAR,i.hasMipmap=!!this._parameters.mipmap,i.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,i.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),i}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.gpuMemoryUsage||bat(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const i=this._data;return i==null?(this._glTexture=new yi(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof i=="string"?this._loadFromURL(e,i):i instanceof Image?this._loadFromImageElement(e,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i):(BC(i)||My(i))&&this._parameters.encoding===hg.DDS_ENCODING?this._loadFromDDSData(e,i):(BC(i)||My(i))&&this._parameters.encoding===hg.KTX2_ENCODING?this._loadFromKTX2(e,i):(BC(i)||My(i))&&this._parameters.encoding===hg.BASIS_ENCODING?this._loadFromBasis(e,i):My(i)?this._loadFromPixelData(e,i):BC(i)?this._loadFromPixelData(e,new Uint8Array(i)):null)}_frameUpdate(e,i){return this._glTexture==null||e.readyState<o4.HAVE_CURRENT_DATA||i===e.currentTime?i:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,i){return this._glTexture=vat(e,this._createDescriptor(e),i),this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>tat(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>eat(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){zt(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=this._parameters.components===1?ei.LUMINANCE:this._parameters.components===3?ei.RGB:ei.RGBA,r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new yi(e,r,i),this._glTexture}_loadFromURL(e,i){return this._loadAsync(async r=>{const n=await Lg(i,{signal:r});return oi(r),this._loadFromImage(e,n)})}_loadFromImageElement(e,i){return i.complete?this._loadFromImage(e,i):this._loadAsync(async r=>{const n=await Cme(i,i.src,!1,r);return oi(r),this._loadFromImage(e,n)})}_loadFromVideoElement(e,i){return i.readyState>=o4.HAVE_CURRENT_DATA?this._loadFromImage(e,i):this._loadFromVideoElementAsync(e,i)}_loadFromVideoElementAsync(e,i){return this._loadAsync(r=>new Promise((n,s)=>{const a=()=>{i.removeEventListener("loadeddata",u),i.removeEventListener("error",p),nn(y)},u=()=>{i.readyState>=o4.HAVE_CURRENT_DATA&&(a(),n(this._loadFromImage(e,i)))},p=b=>{a(),s(b||new de("Failed to load video"))};i.addEventListener("loadeddata",u),i.addEventListener("error",p);const y=qs(r,()=>p(or()))}))}_loadFromImage(e,i){let r=i;if(!(r instanceof HTMLVideoElement)){const{maxTextureSize:a}=e.parameters;r=this._parameters.downsampleUncompressed?gJe(r,a):yJe(r,a)}const n=eCe(r);this._parameters.width=n.width,this._parameters.height=n.height;const s=this._createDescriptor(e);return s.pixelFormat=this._parameters.components===3?ei.RGB:ei.RGBA,s.width=n.width,s.height=n.height,this._glTexture=new yi(e,s,r),this._glTexture}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const n=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(n,n),r}unload(){if(this._glTexture=jt(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function bat(t,e){if(t==null)return 0;if(BC(t)||My(t))return e.encoding===hg.KTX2_ENCODING?Qot(t,!!e.mipmap):e.encoding===hg.BASIS_ENCODING?Kot(t,!!e.mipmap):t.byteLength;const{width:i,height:r}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?eCe(t):e;return(e.mipmap?4/3:1)*i*r*(e.components||4)||0}function eCe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var o4;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(o4||(o4={}));const wat={wrap:{s:Ai.REPEAT,t:Ai.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1},_8=128,RQ=.5;function xat(t){return t==="cross"||t==="x"}function Tat(t,e=_8,i=e*RQ,r=0){const n=tCe(t,e,i,r);return new Nw(n,{mipmap:!1,wrap:{s:Ai.CLAMP_TO_EDGE,t:Ai.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function tCe(t,e=_8,i=e*RQ,r=0){switch(t){case"circle":default:return Sat(e,i);case"square":return Eat(e,i);case"cross":return Aat(e,i,r);case"x":return Oat(e,i,r);case"kite":return Cat(e,i);case"triangle":return Rat(e,i);case"arrow":return Mat(e,i)}}function Sat(t,e){const i=t/2-.5;return PR(t,nCe(i,i,e/2))}function Eat(t,e){return iCe(t,e,!1)}function Cat(t,e){return iCe(t,e,!0)}function Aat(t,e,i=0){return rCe(t,e,!1,i)}function Oat(t,e,i=0){return rCe(t,e,!0,i)}function Rat(t,e){return PR(t,sCe(t/2,e,e/2))}function Mat(t,e){const i=e,r=e/2,n=t/2,s=.8*i,a=nCe(n,(t-e)/2-s,Math.sqrt(s*s+r*r)),u=sCe(n,i,r);return PR(t,(p,y)=>Math.max(u(p,y),-a(p,y)))}function iCe(t,e,i){return i&&(e/=Math.SQRT2),PR(t,(r,n)=>{let s=r-.5*t+.25,a=.5*t-n-.75;if(i){const u=(s+a)/Math.SQRT2;a=(a-s)/Math.SQRT2,s=u}return Math.max(Math.abs(s),Math.abs(a))-.5*e})}function rCe(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const n=.5*e;return PR(t,(s,a)=>{let u,p=s-.5*t,y=.5*t-a-1;if(i){const b=(p+y)/Math.SQRT2;y=(y-p)/Math.SQRT2,p=b}return p=Math.abs(p),y=Math.abs(y),u=p>y?p>n?Math.sqrt((p-n)*(p-n)+y*y):y:y>n?Math.sqrt(p*p+(y-n)*(y-n)):p,u-=r/2,u})}function nCe(t,e,i){return(r,n)=>{const s=r-t,a=n-e;return Math.sqrt(s*s+a*a)-i}}function sCe(t,e,i){const r=Math.sqrt(e*e+i*i);return(n,s)=>{const a=Math.abs(n-t)-i,u=s-t+e/2+.75,p=(e*a+i*u)/r,y=-u;return Math.max(p,y)}}function PR(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let n=0;n<t;n++){const s=n+t*r;let a=e(n,r);a=a/t+.5,yO(a,i,4*s)}return i}const R2=64,MQ=R2/2,oCe=MQ/5,Pat=R2/oCe,Iat=.25;function $at(t,e){const i=tCe(t,R2,MQ,oCe),r=new Ar;return r.internalFormat=ei.RGBA,r.width=R2,r.height=R2,r.wrapMode=Ai.CLAMP_TO_EDGE,new yi(e,r,i)}function aCe(t,e){const{vertex:i,constants:r}=t;r.add("markerSizePerLineWidth","float",Pat),SE(i),i.uniforms.get("markerScale")==null&&i.constants.add("markerScale","float",1),i.code.add(F`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===Ju.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new lt("perRenderPixelRatio",(n,s)=>s.camera.perRenderPixelRatio)),i.code.add(F`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var Jh;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Jh||(Jh={}));let Un=class extends _l{constructor(){super(...arguments),this.output=oe.Color,this.capType=Jh.BUTT,this.transparencyPassType=Ut.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};_([ce({count:oe.COUNT})],Un.prototype,"output",void 0),_([ce({count:Jh.COUNT})],Un.prototype,"capType",void 0),_([ce({count:Ut.COUNT})],Un.prototype,"transparencyPassType",void 0),_([ce()],Un.prototype,"occluder",void 0),_([ce()],Un.prototype,"hasSlicePlane",void 0),_([ce()],Un.prototype,"hasPolygonOffset",void 0),_([ce()],Un.prototype,"writeDepth",void 0),_([ce()],Un.prototype,"draped",void 0),_([ce()],Un.prototype,"stippleEnabled",void 0),_([ce()],Un.prototype,"stippleOffColorEnabled",void 0),_([ce()],Un.prototype,"stipplePreferContinuous",void 0),_([ce()],Un.prototype,"roundJoins",void 0),_([ce()],Un.prototype,"applyMarkerOffset",void 0),_([ce()],Un.prototype,"vvSize",void 0),_([ce()],Un.prototype,"vvColor",void 0),_([ce()],Un.prototype,"vvOpacity",void 0),_([ce()],Un.prototype,"falloffEnabled",void 0),_([ce()],Un.prototype,"innerColorEnabled",void 0),_([ce()],Un.prototype,"hasOccludees",void 0),_([ce()],Un.prototype,"multipassEnabled",void 0),_([ce()],Un.prototype,"cullAboveGround",void 0),_([ce()],Un.prototype,"wireframe",void 0),_([ce()],Un.prototype,"objectAndLayerIdColorInstanced",void 0),_([ce({constValue:!1})],Un.prototype,"occlusionPass",void 0),_([ce({constValue:!0})],Un.prototype,"hasVvInstancing",void 0),_([ce({constValue:!0})],Un.prototype,"hasSliceTranslatedView",void 0);const b8=1;function Lat(t){const e=new lr,{vertex:i,fragment:r}=e,n=t.multipassEnabled&&(t.output===oe.Color||t.output===oe.Alpha);e.include(dR),e.include(GEe,t),e.include(qot,t);const s=t.applyMarkerOffset&&!t.draped;s&&(i.uniforms.add(new lt("markerScale",O=>O.markerScale)),e.include(aCe,{space:Ju.World,draped:!1})),t.output===oe.Depth&&e.include($g,t),e.include(bR,t),Uc(i,t),i.uniforms.add(new On("inverseProjectionMatrix",(O,P)=>P.camera.inverseProjectionMatrix),new Lr("nearFar",(O,P)=>P.camera.nearFar),new lt("miterLimit",O=>O.join!=="miter"?0:O.miterLimit),new er("viewport",(O,P)=>P.camera.fullViewport)),i.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(X.POSITION,"vec3"),e.attributes.add(X.SUBDIVISIONFACTOR,"float"),e.attributes.add(X.UV0,"vec2"),e.attributes.add(X.AUXPOS1,"vec3"),e.attributes.add(X.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),_v(e),n&&e.varyings.add("depth","float");const a=t.stippleEnabled;a&&e.varyings.add("vLineSizeInv","float");const u=t.capType===Jh.ROUND,p=a||u;p&&e.varyings.add("vLineWidth","float");const y=t.innerColorEnabled||u;y&&e.varyings.add("vLineDistance","float");const b=t.stippleEnabled&&u,S=t.falloffEnabled||b;S&&e.varyings.add("vLineDistanceNorm","float"),u&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),i.code.add(F`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),i.code.add(F`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),L7(e),i.code.add(F`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${n?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),SE(i),i.code.add(F`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${p?F`vLineWidth = lineWidth;`:""}
      ${a?F`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),s&&i.code.add(F`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),i.code.add(F`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||u)&&i.code.add(F`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${u?F`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),i.code.add(F`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?i.code.add(F`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?F`min(1.0, subdivisionFactor * ${F.float((b8+2)/(b8+1))})`:F`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):i.code.add(F`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const C=t.capType!==Jh.BUTT;return i.code.add(F`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${C?F`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),i.code.add(F`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${S||y?F`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${y?F`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${S?F`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),u&&i.code.add(F`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?i.uniforms.add(new lt("worldToScreenRatio",(O,P)=>1/P.screenToPCSRatio)):i.code.add(F`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(F`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?i.code.add(F`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):i.code.add(F`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.uniforms.add(new lt("stipplePatternPixelSize",O=>XEe(O))),i.code.add(F`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),i.code.add(F`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),n&&e.include(Jc,t),e.include(ss,t),r.include(G0),r.code.add(F`
  void main() {
    discardBySlice(vpos);
    ${n?"terrainDepthTest(depth);":""}
  `),t.wireframe?r.code.add(F`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(u&&r.code.add(F`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${F.float(Wo)}) {
        discard;
      }
    `),b?r.code.add(F`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${F.float(Wo)}, stippleCoverage);
      `):r.code.add(F`float stippleAlpha = getStippleAlpha();`),t.output!==oe.ObjectAndLayerIdColor&&r.code.add(F`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),r.uniforms.add(new er("intrinsicColor",O=>O.color)),r.code.add(F`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(r.uniforms.add(new er("innerColor",O=>O.innerColor??O.color),new lt("innerWidth",(O,P)=>O.innerWidth*P.camera.pixelRatio)),r.code.add(F`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),r.code.add(F`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(r.uniforms.add(new lt("falloff",O=>O.falloff)),r.code.add(F`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),r.code.add(F`
    ${t.output===oe.ObjectAndLayerIdColor?F`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${F.float(Wo)}) {
      discard;
    }

    ${t.output===oe.Alpha?F`fragColor = vec4(finalColor.a);`:""}
    ${t.output===oe.Color?F`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===oe.Color&&t.transparencyPassType===Ut.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===oe.Highlight?F`fragColor = vec4(1.0);`:""}
    ${t.output===oe.Depth?F`outputDepth(linearDepth);`:""}
    ${t.output===oe.ObjectAndLayerIdColor?F`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const Dat=Object.freeze(Object.defineProperty({__proto__:null,build:Lat,ribbonlineNumRoundJoinSubdivisions:b8},Symbol.toStringTag,{value:"Module"})),lCe=new Map([[X.POSITION,0],[X.SUBDIVISIONFACTOR,1],[X.UV0,2],[X.AUXPOS1,3],[X.AUXPOS2,4],[X.COLOR,5],[X.COLORFEATUREATTRIBUTE,5],[X.SIZE,6],[X.SIZEFEATUREATTRIBUTE,6],[X.OPACITYFEATUREATTRIBUTE,7],[X.OBJECTANDLAYERIDCOLOR,8]]);let cCe=class uCe extends wr{initializeProgram(e){return new fr(e.rctx,uCe.shader.get().build(this.configuration),lCe)}_makePipelineState(e,i){const r=this.configuration,n=e===Ut.NONE,s=e===Ut.FrontFace;return mi({blending:r.output===oe.Color||r.output===oe.Alpha?n?Xu:Wg(e):null,depthTest:{func:Vv(e)},depthWrite:n?r.writeDepth?ic:null:eN(e),colorWrite:Oi,stencilWrite:r.hasOccludees?P0:null,stencilTest:r.hasOccludees?i?Cv:Gv:null,polygonOffset:n||s?r.hasPolygonOffset?rle:null:iN})}initializePipeline(){const e=this.configuration;if(e.occluder){const i=e.hasPolygonOffset?rle:null;this._occluderPipelineTransparent=mi({blending:Xu,polygonOffset:i,depthTest:d8,depthWrite:null,colorWrite:Oi,stencilWrite:null,stencilTest:bSe}),this._occluderPipelineOpaque=mi({blending:Xu,polygonOffset:i,depthTest:d8,depthWrite:null,colorWrite:Oi,stencilWrite:vSe,stencilTest:_Se}),this._occluderPipelineMaskWrite=mi({blending:null,polygonOffset:i,depthTest:aQ,depthWrite:null,colorWrite:null,stencilWrite:P0,stencilTest:Cv})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Hi.LINES:Hi.TRIANGLE_STRIP}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};cCe.shader=new pr(Dat,()=>ke(()=>import("./RibbonLine.glsl-f99162be.js"),[],import.meta.url));const rle={factor:0,units:-4};var _c;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(_c||(_c={}));let xT=class extends jv{constructor(e){super(e,new Fat),this._configuration=new Un,this._vertexAttributeLocations=lCe}getConfiguration(e,i){this._configuration.output=e,this._configuration.draped=i.slot===De.DRAPED_MATERIAL;const r=this.parameters.stipplePattern!=null&&e!==oe.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&zat(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===vn.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,i,r,n,s,a){if(!r.options.selectionMode)return;const u=e.attributes.get(X.POSITION).data,p=e.attributes.get(X.SIZE);let y=this.parameters.width;if(this.parameters.vvSize){const $=e.attributes.get(X.SIZEFEATUREATTRIBUTE).data[0];y*=Je(this.parameters.vvSize.offset[0]+$*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else p&&(y*=p.data[0]);const b=n[0],S=n[1],C=(y/2+4)*e.screenToWorldRatio;let O=Number.MAX_VALUE,P=0;for(let $=0;$<u.length-5;$+=3){const N=u[$],z=u[$+1],U=b-N,j=S-z,G=u[$+3]-N,q=u[$+4]-z,W=Je((G*U+q*j)/(G*G+q*q),0,1),K=G*W-U,se=q*W-j,ae=K*K+se*se;ae<O&&(O=ae,P=$/3)}O<C*C&&s(a.dist,a.normal,P,!1)}intersect(e,i,r,n,s,a){if(!r.options.selectionMode||!e.visible)return;if(!gwe(i))return void Ee.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const u=e.attributes,p=u.get(X.POSITION).data;let y=this.parameters.width;if(this.parameters.vvSize){const U=u.get(X.SIZEFEATUREATTRIBUTE).data[0];y*=Je(this.parameters.vvSize.offset[0]+U*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else u.has(X.SIZE)&&(y*=u.get(X.SIZE).data[0]);const b=r.camera,S=Uat;$s(S,r.point);const C=y*b.pixelRatio/2+4*b.pixelRatio;$e(vC[0],S[0]-C,S[1]+C,0),$e(vC[1],S[0]+C,S[1]+C,0),$e(vC[2],S[0]+C,S[1]-C,0),$e(vC[3],S[0]-C,S[1]-C,0);for(let U=0;U<4;U++)if(!b.unprojectFromRenderScreen(vC[U],rm[U]))return;La(b.eye,rm[0],rm[1],uz),La(b.eye,rm[1],rm[2],hz),La(b.eye,rm[2],rm[3],dz),La(b.eye,rm[3],rm[0],pz);let O=Number.MAX_VALUE,P=0;const $=hCe(this.parameters,u)?p.length-2:p.length-5;for(let U=0;U<$;U+=3){Cl[0]=p[U]+i[12],Cl[1]=p[U+1]+i[13],Cl[2]=p[U+2]+i[14];const j=(U+3)%p.length;if(Al[0]=p[j]+i[12],Al[1]=p[j+1]+i[13],Al[2]=p[j+2]+i[14],qr(uz,Cl)<0&&qr(uz,Al)<0||qr(hz,Cl)<0&&qr(hz,Al)<0||qr(dz,Cl)<0&&qr(dz,Al)<0||qr(pz,Cl)<0&&qr(pz,Al)<0)continue;if(b.projectToRenderScreen(Cl,c_),b.projectToRenderScreen(Al,u_),c_[2]<0&&u_[2]>0){Be(of,Cl,Al);const q=b.frustum,W=-qr(q[en.NEAR],Cl)/He(of,q[en.NEAR]);Pe(of,of,W),Ue(Cl,Cl,of),b.projectToRenderScreen(Cl,c_)}else if(c_[2]>0&&u_[2]<0){Be(of,Al,Cl);const q=b.frustum,W=-qr(q[en.NEAR],Al)/He(of,q[en.NEAR]);Pe(of,of,W),Ue(Al,Al,of),b.projectToRenderScreen(Al,u_)}else if(c_[2]<0&&u_[2]<0)continue;c_[2]=0,u_[2]=0;const G=hZ(w2(c_,u_,ole),S);G<O&&(O=G,Ie(nle,Cl),Ie(sle,Al),P=U/3)}const N=r.rayBegin,z=r.rayEnd;if(O<C*C){let U=Number.MAX_VALUE;if(X_e(w2(nle,sle,ole),w2(N,z,jat),l_)){Be(l_,l_,N);const j=Qe(l_);Pe(l_,l_,1/j),U=j/un(N,z)}a(U,l_,P,!1)}}get _layout(){const e=wn().vec3f(X.POSITION).f32(X.SUBDIVISIONFACTOR).vec2f(X.UV0).vec3f(X.AUXPOS1).vec3f(X.AUXPOS2);return this.parameters.vvSize?e.f32(X.SIZEFEATUREATTRIBUTE):e.f32(X.SIZE),this.parameters.vvColor?e.f32(X.COLORFEATUREATTRIBUTE):e.vec4f(X.COLOR),this.parameters.vvOpacity&&e.f32(X.OPACITYFEATUREATTRIBUTE),Me("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(X.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new kat(this._layout,this.parameters)}produces(e,i){return i===oe.Color||i===oe.Alpha||i===oe.Highlight||i===oe.Depth||i===oe.ObjectAndLayerIdColor?e===De.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===vn.OccludeAndTransparentStencil?e===De.OPAQUE_MATERIAL||e===De.OCCLUDER_MATERIAL||e===De.TRANSPARENT_OCCLUDER_MATERIAL:i===oe.Color||i===oe.Alpha?e===(this.parameters.writeDepth?De.TRANSPARENT_MATERIAL:De.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===De.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new Nat(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},Nat=class extends zv{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==oe.Color&&this._output!==oe.Alpha||this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(i,this._stipplePattern)}),this._stipplePattern=i),this.ensureTechnique(cCe,e)}},Fat=class extends wR{constructor(){super(...arguments),this.width=0,this.color=Bh,this.join="miter",this.cap=Jh.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},kat=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i,this.numJoinSubdivisions=0;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=b8+r}}_isClosed(e){return hCe(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.attributes.get(X.POSITION).indices.length/2+1,n=this._isClosed(e);let s=n?2:2*2;return s+=((n?r:r-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this._parameters.wireframe&&(s=2+4*(s-2)),s}write(e,i,r,n,s){const a=Bat,u=Vat,p=Gat,y=r.attributes.get(X.POSITION),b=y.indices,S=y.data.length/3,C=r.attributes.get(X.DISTANCETOSTART)?.data;b&&b.length!==2*(S-1)&&console.warn("RibbonLineMaterial does not support indices");let O=1,P=0;const $=this.vertexBufferLayout.fields.has(X.SIZEFEATUREATTRIBUTE);$?P=r.attributes.get(X.SIZEFEATUREATTRIBUTE).data[0]:r.attributes.has(X.SIZE)&&(O=r.attributes.get(X.SIZE).data[0]);let N=[1,1,1,1],z=0;const U=this.vertexBufferLayout.fields.has(X.COLORFEATUREATTRIBUTE);U?z=r.attributes.get(X.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(X.COLOR)&&(N=r.attributes.get(X.COLOR).data);const j=Me("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null;let G=0;const q=this.vertexBufferLayout.fields.has(X.OPACITYFEATUREATTRIBUTE);q&&(G=r.attributes.get(X.OPACITYFEATUREATTRIBUTE).data[0]);const W=new Float32Array(n.buffer),K=Me("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,se=this.vertexBufferLayout.stride/4;let ae=s*se;const le=ae;let me=0;const ne=C?(re,fe,ye)=>me=C[ye]:(re,fe,ye)=>me+=un(re,fe),pe=Me("enable-feature:objectAndLayerId-rendering"),ge=(re,fe,ye,we,Ae,Oe,Ve)=>{if(W[ae++]=fe[0],W[ae++]=fe[1],W[ae++]=fe[2],W[ae++]=we,W[ae++]=Ve,W[ae++]=Ae,W[ae++]=re[0],W[ae++]=re[1],W[ae++]=re[2],W[ae++]=ye[0],W[ae++]=ye[1],W[ae++]=ye[2],W[ae++]=$?P:O,U)W[ae++]=z;else{const at=Math.min(4*Oe,N.length-4);W[ae++]=N[at],W[ae++]=N[at+1],W[ae++]=N[at+2],W[ae++]=N[at+3]}q&&(W[ae++]=G),pe&&(j!=null&&(K[4*ae]=j[0],K[4*ae+1]=j[1],K[4*ae+2]=j[2],K[4*ae+3]=j[3]),ae++)};ae+=se,$e(u,y.data[0],y.data[1],y.data[2]),e&&wt(u,u,e);const ve=this._isClosed(r);if(ve){const re=y.data.length-3;$e(a,y.data[re],y.data[re+1],y.data[re+2]),e&&wt(a,a,e)}else $e(p,y.data[3],y.data[4],y.data[5]),e&&wt(p,p,e),ge(u,u,p,1,_c.LEFT_CAP_START,0,0),ge(u,u,p,1,_c.RIGHT_CAP_START,0,0),Ie(a,u),Ie(u,p);const Se=ve?0:1,ee=ve?S:S-1;for(let re=Se;re<ee;re++){const fe=(re+1)%S*3;$e(p,y.data[fe],y.data[fe+1],y.data[fe+2]),e&&wt(p,p,e),ne(a,u,re),ge(a,u,p,0,_c.LEFT_JOIN_END,re,me),ge(a,u,p,0,_c.RIGHT_JOIN_END,re,me);const ye=this.numJoinSubdivisions;for(let we=0;we<ye;++we){const Ae=(we+1)/(ye+1);ge(a,u,p,Ae,_c.LEFT_JOIN_END,re,me),ge(a,u,p,Ae,_c.RIGHT_JOIN_END,re,me)}ge(a,u,p,1,_c.LEFT_JOIN_START,re,me),ge(a,u,p,1,_c.RIGHT_JOIN_START,re,me),Ie(a,u),Ie(u,p)}ve?($e(p,y.data[3],y.data[4],y.data[5]),e&&wt(p,p,e),me=ne(a,u,ee),ge(a,u,p,0,_c.LEFT_JOIN_END,Se,me),ge(a,u,p,0,_c.RIGHT_JOIN_END,Se,me)):(me=ne(a,u,ee),ge(a,u,u,0,_c.LEFT_CAP_END,ee,me),ge(a,u,u,0,_c.RIGHT_CAP_END,ee,me)),cz(W,le+se,W,le,se),ae=cz(W,ae-se,W,ae,se),this._parameters.wireframe&&this._addWireframeVertices(n,le,ae,se)}_addWireframeVertices(e,i,r,n){const s=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),a=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let u=0;const p=y=>u=cz(a,y,s,u,n);for(let y=0;y<a.length-1;y+=2*n)p(y),p(y+2*n),p(y+1*n),p(y+2*n),p(y+1*n),p(y+3*n)}};function cz(t,e,i,r,n){for(let s=0;s<n;s++)i[r++]=t[e++];return r}function hCe(t,e){return t.isClosed?e.get(X.POSITION).indices.length>2:!1}function zat(t){return t.anchor===ow.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const Cl=H(),Al=H(),of=H(),l_=H(),Uat=H(),c_=fa(),u_=fa(),nle=H(),sle=H(),ole=Gp(),jat=Gp(),Bat=H(),Vat=H(),Gat=H(),vC=[fa(),fa(),fa(),fa()],rm=[H(),H(),H(),H()],uz=gr(),hz=gr(),dz=gr(),pz=gr();let PQ=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+zu(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const b=g8(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,b),b}const r=this._gridSize,n=Math.round(e[0]/r),s=Math.round(e[1]/r),a=Math.round(e[2]/r),u=`${n}/${s}/${a}`;let p=this._origins.get(u);const y=.5*r;if(Be($o,e,i.vec3),$o[0]=Math.abs($o[0]),$o[1]=Math.abs($o[1]),$o[2]=Math.abs($o[2]),$o[0]<y&&$o[1]<y&&$o[2]<y){if(p){const b=Math.max(...$o);if(Be($o,e,p.vec3),$o[0]=Math.abs($o[0]),$o[1]=Math.abs($o[1]),$o[2]=Math.abs($o[2]),Math.max(...$o)<b)return p}return i}return p||(p=g8(n*r,s*r,a*r,u),this._origins.set(u,p)),p}_drawOriginBox(e,i=vi(1,1,0,1)){const r=window.view,n=r._stage,s=i.toString();if(!this._objects.has(s)){this._material=new xT({width:2,color:i}),n.add(this._material);const O=new VEe(n,{pickable:!1}),P=new Xg({castShadow:!1});n.add(P),O.add(P),this._objects.set(s,P)}const a=this._objects.get(s),u=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=u.length,y=new Array(3*p),b=new Array,S=.5*this._gridSize;for(let O=0;O<p;O++)y[3*O]=e[0]+(1&u[O]?S:-S),y[3*O+1]=e[1]+(2&u[O]?S:-S),y[3*O+2]=e[2]+(4&u[O]?S:-S),O>0&&b.push(O-1,O);Mn(y,this._originSR,0,y,r.renderSpatialReference,0,p);const C=new Is(this._material,[[X.POSITION,new Et(y,b,3,!0)]],null,Gn.Line);n.add(C),a.addGeometry(C)}get test(){const e=this;return{set gridSize(i){e._gridSize=i}}}};const $o=H();let dCe=class{constructor(e,i,r=null){this.rctx=e,this.sliceHelper=r,this.lastFrameCamera=new Kt,this.output=oe.Color,this.renderOccludedMask=ale,this.bindParameters=new $7(i,r!=null?r.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=ale}},Hat=class extends dCe{constructor(e,i,r,n){super(e,r,n),this.offscreenRenderingHelper=i,this.sliceHelper=n,this.time=0}};const ale=vn.Occlude|vn.OccludeAndTransparent|vn.OccludeAndTransparentStencil;let X5=class extends Kt{constructor(){super(...arguments),this._projectionMatrix=Ze()}get projectionMatrix(){return this._projectionMatrix}};_([T()],X5.prototype,"_projectionMatrix",void 0),_([T({readOnly:!0})],X5.prototype,"projectionMatrix",null),X5=_([Z("esri.views.3d.webgl-engine.lib.CascadeCamera")],X5);var XS;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(XS||(XS={}));let kP=class{constructor(){this.camera=new X5,this.lightMat=Ze()}},qat=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},IQ=class{get depthTexture(){return this._handle?.colorTexture}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return _n(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,i){this._fbos=e,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new qat,this._projectionView=Ze(),this._projectionViewInverse=Ze(),this._modelViewLight=Ze(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=ji(),this._cascades=[new kP,new kP,new kP,new kP],this._lastOrigin=null,this._maxTextureWidth=Math.min(Me("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._handle=Gi(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=Je(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)mz[e]=this._cascades[e];return mz.length=this._numCascades,mz}start(e,i,r,n,s){zt(this.enabled);const{near:a,far:u}=this._clampNearFar(r);this._computeCascadeDistances(a,u,n),this._textureHeight=this._computeTextureHeight(e,s,n),this._setupMatrices(e,i);const{viewMatrix:p,projectionMatrix:y}=e;for(let b=0;b<this._numCascades;++b)this._constructCascade(b,y,p,i);this._lastOrigin=null,this.clear()}finish(){zt(this.enabled),this._handle?.releaseDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!pa(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||H(),Ie(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){ec(ple,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)fle[16*i+r]=ple[r]}}return fle}moveSnapshot(e){zt(this.enabled),this._handle?.releaseDepth(),this._snapshots[e]?.release(),this._snapshots[e]=this._handle,this._handle=null}copySnapshot(e){const i=this._handle?.colorTexture?.descriptor;if(!this.enabled||!i)return;this._snapshots[e]?.release();const{width:r,height:n}=i;this._snapshots[e]=this._fbos.acquire(sr.RGBA4,r,n);const s=this._fbos.rctx;this._bindFbo();const a=s.bindTexture(this._snapshots[e]?.colorTexture,yi.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(Vn.TEXTURE_2D,0,0,0,0,0,r,n),s.bindTexture(a,yi.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){return this.enabled?this._snapshots[e]?.colorTexture:null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(tn.COLOR_BUFFER_BIT|tn.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,i,r){const n=Math.min(window.devicePixelRatio,i)/e.pixelRatio,s=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,a=S2(Math.floor(Math.max(e.fullWidth,e.fullHeight)*n*s));return Math.min(this._maxTextureWidth,this._numCascades*a)/this._numCascades}_ensureFbo(){this._handle?.fbo.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._fbos.acquire(sr.RGBA4,this._textureWidth,this._textureHeight)),this._handle.acquireDepth(Vs.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=Gi(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._handle?.fbo)}_constructCascade(e,i,r,n){const s=this._cascades[e],a=-this._cascadeDistances[e],u=-this._cascadeDistances[e+1],p=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]),y=(i[10]*u+i[14])/Math.abs(i[11]*u+i[15]);zt(p<y);for(let O=0;O<8;++O){_n(lle,O%4==0||O%4==3?-1:1,O%4==0||O%4==1?-1:1,O<4?p:y,1);const P=Rh[O];Nu(P,lle,this._projectionViewInverse),P[0]/=P[3],P[1]/=P[3],P[2]/=P[3]}ka(fz,Rh[0]),s.camera.viewMatrix=ec(Wat,this._modelViewLight,fz);for(let O=0;O<8;++O)wt(Rh[O],Rh[O],s.camera.viewMatrix);let b=Rh[0][2],S=Rh[0][2];for(let O=1;O<8;++O)b=Math.min(b,Rh[O][2]),S=Math.max(S,Rh[O][2]);b-=200,S+=200,s.camera.near=-S,s.camera.far=-b,Zat(r,n,b,S,s.camera),Rr(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const C=this._textureHeight;s.camera.viewport=[e*C,0,C,C]}_setupMatrices(e,i){Rr(this._projectionView,e.projectionMatrix,e.viewMatrix),Ps(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===ht.Global?e.eye:$e(fz,0,0,1);kD(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(e){let{near:i,far:r}=e;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(e,i,r){const n=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(uXe(i/e,4)),n);const s=(i-e)/this._numCascades,a=(i/e)**(1/this._numCascades);let u=e,p=e;for(let y=0;y<this._numCascades+1;++y)this._cascadeDistances[y]=si(u,p,this.settings.splitSchemeLambda),u*=a,p+=s}get test(){return{cascades:this._cascades,textureHeight:this._textureHeight}}};const Wat=Ze(),lle=ji(),Rh=[];for(let t=0;t<8;++t)Rh.push(ji());const cle=Ct(),ule=Ct(),Xat=Ct(),hle=Ct(),dle=Ct(),fz=H(),mz=[],ple=Ze(),fle=Cn.concat(Cn,Cn,Cn,Cn),su=Ct(),T3=Ct(),h_=[Ct(),Ct(),Ct(),Ct()],to=Ct(),gz=Ct(),T1=Ct(),_C=Ct(),S3=Ct(),E3=Ct(),zP=Ct();function Jat(t,e,i,r,n,s,a,u){Yi(su,0,0);for(let q=0;q<4;++q)rp(su,su,t[q]);Ic(su,su,.25),Yi(T3,0,0);for(let q=4;q<8;++q)rp(T3,T3,t[q]);Ic(T3,T3,.25),Fh(h_[0],t[4],t[5],.5),Fh(h_[1],t[5],t[6],.5),Fh(h_[2],t[6],t[7],.5),Fh(h_[3],t[7],t[4],.5);let p=0,y=kL(h_[0],su);for(let q=1;q<4;++q){const W=kL(h_[q],su);W<y&&(y=W,p=q)}i0(to,h_[p],t[p+4]);const b=to[0];let S,C;to[0]=-to[1],to[1]=b,i0(gz,T3,su),Us(gz,to)<0&&XZ(to,to),Fh(to,to,gz,i),iO(to,to),S=C=Us(i0(T1,t[0],su),to);for(let q=1;q<8;++q){const W=Us(i0(T1,t[q],su),to);W<S?S=W:W>C&&(C=W)}$s(r,su),Ic(T1,to,S-e),rp(r,r,T1);let O=-1,P=1,$=0,N=0;for(let q=0;q<8;++q){i0(_C,t[q],r),iO(_C,_C);const W=to[0]*_C[1]-to[1]*_C[0];W>0?W>O&&(O=W,$=q):W<P&&(P=W,N=q)}s3(O>0,"leftArea"),s3(P<0,"rightArea"),Ic(S3,to,S),rp(S3,S3,su),Ic(E3,to,C),rp(E3,E3,su),zP[0]=-to[1],zP[1]=to[0];const z=WM(r,t[N],E3,rp(T1,E3,zP),1,n),U=WM(r,t[$],E3,T1,1,s),j=WM(r,t[$],S3,rp(T1,S3,zP),1,a),G=WM(r,t[N],S3,T1,1,u);s3(z,"rayRay"),s3(U,"rayRay"),s3(j,"rayRay"),s3(G,"rayRay")}function nr(t,e){return 3*e+t}const mle=Ct();function oc(t,e){return Yi(mle,t[e],t[e+3]),mle}const Ol=Ct(),$t=Pn();function Yat(t,e,i,r,n){i0(Ol,i,r),Ic(Ol,Ol,.5),$t[0]=Ol[0],$t[1]=Ol[1],$t[2]=0,$t[3]=Ol[1],$t[4]=-Ol[0],$t[5]=0,$t[6]=Ol[0]*Ol[0]+Ol[1]*Ol[1],$t[7]=Ol[0]*Ol[1]-Ol[1]*Ol[0],$t[8]=1,$t[nr(0,2)]=-Us(oc($t,0),t),$t[nr(1,2)]=-Us(oc($t,1),t);let s=Us(oc($t,0),i)+$t[nr(0,2)],a=Us(oc($t,1),i)+$t[nr(1,2)],u=Us(oc($t,0),r)+$t[nr(0,2)],p=Us(oc($t,1),r)+$t[nr(1,2)];s=-(s+u)/(a+p),$t[nr(0,0)]+=$t[nr(1,0)]*s,$t[nr(0,1)]+=$t[nr(1,1)]*s,$t[nr(0,2)]+=$t[nr(1,2)]*s,s=1/(Us(oc($t,0),i)+$t[nr(0,2)]),a=1/(Us(oc($t,1),i)+$t[nr(1,2)]),$t[nr(0,0)]*=s,$t[nr(0,1)]*=s,$t[nr(0,2)]*=s,$t[nr(1,0)]*=a,$t[nr(1,1)]*=a,$t[nr(1,2)]*=a,$t[nr(2,0)]=$t[nr(1,0)],$t[nr(2,1)]=$t[nr(1,1)],$t[nr(2,2)]=$t[nr(1,2)],$t[nr(1,2)]+=1,s=Us(oc($t,1),e)+$t[nr(1,2)],a=Us(oc($t,2),e)+$t[nr(2,2)],u=Us(oc($t,1),i)+$t[nr(1,2)],p=Us(oc($t,2),i)+$t[nr(2,2)],s=-.5*(s/a+u/p),$t[nr(1,0)]+=$t[nr(2,0)]*s,$t[nr(1,1)]+=$t[nr(2,1)]*s,$t[nr(1,2)]+=$t[nr(2,2)]*s,s=Us(oc($t,1),e)+$t[nr(1,2)],a=Us(oc($t,2),e)+$t[nr(2,2)],u=-a/s,$t[nr(1,0)]*=u,$t[nr(1,1)]*=u,$t[nr(1,2)]*=u,n[0]=$t[0],n[1]=$t[1],n[2]=0,n[3]=$t[2],n[4]=$t[3],n[5]=$t[4],n[6]=0,n[7]=$t[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=$t[6],n[13]=$t[7],n[14]=0,n[15]=$t[8]}function Zat(t,e,i,r,n){const s=1/Rh[0][3],a=1/Rh[4][3];zt(s<a);let u=s+Math.sqrt(s*a);const p=Math.sin(co(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));u/=p,Jat(Rh,u,p,cle,ule,Xat,hle,dle),Yat(cle,ule,hle,dle,n.projectionMatrix),n.projectionMatrix[10]=2/(i-r),n.projectionMatrix[14]=-(i+r)/(i-r)}function Kat(t){return Hp(t)&&t.intersector===En.TERRAIN&&!!t.target}let Qat=class extends x7{constructor(e,i,r){super(e,i),this.triangleNr=r}};function pCe(t){return Hp(t)&&t.intersector===En.OVERLAY&&!!t.target}let Aq=class{constructor(){this.adds=new xi,this.removes=new xi,this.updates=new xi({allocator:e=>e||new elt,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},elt=class{},tlt=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Sn,Gs;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(Sn||(Sn={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Gs||(Gs={}));function fCe(t){const e=new Map,i=r=>{let n=e.get(r);return n||(n=new tlt,e.set(r,n)),n};return t.removes.forAll(r=>{yz(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{yz(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{yz(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function yz(t){return t.geometry.indexCount>=1}let mCe=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}dispose(){this._map.forEach((e,i)=>{e!=null&&this._repository.release(this._material,i)})}load(e,i,r){if(!this._material.produces(i,r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const n=this._map.get(r);if(n!=null){if(n.ensureResources(e)===yv.LOADED)return n;this._repository.requestRender()}return null}},Oq=class extends ySe{constructor(e=H()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}};const ilt=wn().vec3f(X.POSITION),rlt=wn().vec3f(X.POSITION).vec2f(X.UV0),nlt=wn().vec3f(X.POSITION).vec4u8(X.COLOR);wn().vec3f(X.POSITION).vec4u8(X.OBJECTANDLAYERIDCOLOR);const slt=wn().vec3f(X.POSITION).vec2f(X.UV0).vec4u8(X.OBJECTANDLAYERIDCOLOR);wn().vec3f(X.POSITION).vec4u8(X.COLOR).vec4u8(X.OBJECTANDLAYERIDCOLOR);let $Q=class extends jv{intersect(e,i,r,n,s,a){return yTe(e,r,n,s,void 0,a)}};function gle(t){t.fragment.uniforms.add(new kt("texWaveNormal",e=>e.waveNormal),new kt("texWavePerturbation",e=>e.wavePerturbation),new er("waveParams",e=>_n(olt,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Lr("waveDirection",e=>Yi(alt,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(bot),t.fragment.code.add(F`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const olt=ji(),alt=Ct();function vO(t,e){e.spherical?t.vertex.code.add(F`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(F`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(F`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(F`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function llt(t){const e=new lr,{vertex:i,fragment:r}=e;Uc(i,t),e.include(Zl,t),e.attributes.add(X.POSITION,"vec3"),e.attributes.add(X.UV0,"vec2");const n=new er("waterColor",s=>s.color);if(t.output===oe.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),i.uniforms.add(n),i.code.add(F`
        void main(void) {
          if (waterColor.a < ${F.float(Wo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(n),r.code.add(F`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==oe.Color&&t.output!==oe.Alpha||(e.include(vO,t),e.include(EE,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.multipassEnabled&&e.varyings.add("depth","float"),i.uniforms.add(n),i.code.add(F`
      void main(void) {
        if (waterColor.a < ${F.float(Wo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===oe.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Jc,t),t.output){case oe.Alpha:e.include(ss,t),r.uniforms.add(n),r.code.add(F`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case oe.Color:e.include(zL),e.include(sK,{pbrMode:Gt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(gle),e.include(ss,t),e.include(nw,t),e.include(NEe,t),r.uniforms.add(n,new lt("timeElapsed",s=>s.timeElapsed),i.uniforms.get("view"),i.uniforms.get("localOrigin")),kp(r,t),r.include(G0),jg(r),U0(r),r.code.add(F`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?F`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===Ut.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case oe.Normal:e.include(vO,t),e.include(gle,t),e.include(ss,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i.uniforms.add(n),i.code.add(F`
        void main(void) {
          if (waterColor.a < ${F.float(Wo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new lt("timeElapsed",s=>s.timeElapsed)),r.code.add(F`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case oe.Highlight:e.include(Bv,t),e.varyings.add("vpos","vec3"),i.uniforms.add(n),i.code.add(F`
      void main(void) {
        if (waterColor.a < ${F.float(Wo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(ss,t),r.code.add(F`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case oe.ObjectAndLayerIdColor:e.include(bR,t),e.varyings.add("vpos","vec3"),i.uniforms.add(n),i.code.add(F`
      void main(void) {
        if (waterColor.a < ${F.float(Wo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(ss,t),r.code.add(F`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const clt=Object.freeze(Object.defineProperty({__proto__:null,build:llt},Symbol.toStringTag,{value:"Module"}));let gCe=class yCe extends wr{initializeConfiguration(e,i){i.spherical=e.viewingMode===ht.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new fr(e.rctx,yCe.shader.get().build(this.configuration),ar)}_setPipelineState(e){const i=this.configuration,r=e===Ut.NONE,n=e===Ut.FrontFace;return mi({blending:i.output!==oe.Normal&&i.output!==oe.Highlight&&i.output!==oe.ObjectAndLayerIdColor&&i.transparent?r?Xu:Wg(e):null,depthTest:{func:Vv(e)},depthWrite:r?i.writeDepth?ic:null:eN(e),colorWrite:Oi,polygonOffset:r||n?null:rN(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};gCe.shader=new pr(clt,()=>ke(()=>import("./WaterSurface.glsl-c521eb04.js"),[],import.meta.url));let io=class extends _l{constructor(){super(...arguments),this.output=oe.Color,this.transparencyPassType=Ut.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}};_([ce({count:oe.COUNT})],io.prototype,"output",void 0),_([ce({count:Ut.COUNT})],io.prototype,"transparencyPassType",void 0),_([ce()],io.prototype,"spherical",void 0),_([ce()],io.prototype,"receiveShadows",void 0),_([ce()],io.prototype,"hasSlicePlane",void 0),_([ce()],io.prototype,"transparent",void 0),_([ce()],io.prototype,"enableOffset",void 0),_([ce()],io.prototype,"writeDepth",void 0),_([ce()],io.prototype,"hasScreenSpaceReflections",void 0),_([ce()],io.prototype,"doublePrecisionRequiresObfuscation",void 0),_([ce()],io.prototype,"hasCloudsReflections",void 0),_([ce()],io.prototype,"objectAndLayerIdColorInstanced",void 0),_([ce()],io.prototype,"isDraped",void 0),_([ce()],io.prototype,"multipassEnabled",void 0),_([ce()],io.prototype,"cullAboveGround",void 0),_([ce({constValue:!1})],io.prototype,"occlusionPass",void 0),_([ce({constValue:Gt.Water})],io.prototype,"pbrMode",void 0),_([ce({constValue:!0})],io.prototype,"useCustomDTRExponentForWater",void 0),_([ce({constValue:!0})],io.prototype,"highStepCount",void 0),_([ce({constValue:!1})],io.prototype,"useFillLights",void 0);let ult=class extends zv{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const i=e.ssr.lastFrameColor!=null;i!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:i})}_updateCloudsReflectionState(e){const i=e.cloudsFade.data!=null;i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===oe.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(gCe,e)}},vCe=class extends $Q{constructor(e){super(e,new _Ce),this._configuration=new io,this._animation=new Q3e}getConfiguration(e,i){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<tN,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}update(e){const i=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<hlt;const r=this._animation.advance(e);return this.setParameters({timeElapsed:dJ(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&r}produces(e,i){switch(i){case oe.Normal:return e===De.DRAPED_WATER;case oe.Color:if(this.parameters.isDraped)return e===De.DRAPED_MATERIAL;break;case oe.Alpha:break;case oe.Highlight:case oe.ObjectAndLayerIdColor:return e===De.OPAQUE_MATERIAL||e===De.DRAPED_MATERIAL;default:return!1}let r=De.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?De.TRANSPARENT_MATERIAL:De.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===r}createGLMaterial(e){return new ult(e)}createBufferWriter(){return new ME(Me("enable-feature:objectAndLayerId-rendering")?slt:rlt)}get test(){return{animationEnabled:this._animation.enabled}}},_Ce=class extends JK{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Xi(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=vi(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=H(),this.modelTransformation=null}};const hlt=35e3;let LQ=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function yle(t){const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;)i=!1,t.forEach(r=>{const n=e.get(r.to);n&&(r.to=n.to,e.delete(n.from),t.removeUnordered(n),i=!0)})}let vle=class extends LQ{constructor(e,i,r){super(i,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},dlt=class{constructor(){this.first=0,this.count=0}},plt=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new xi({allocator:e=>e||new LQ,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=UP(),this.drawCommandsHighlight=UP(),this.drawCommandsOccludees=UP(),this.drawCommandsShadowHighlightRest=UP()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const n=this._instances.get(e);n&&(this._numElements-=n.numElements,n.from=i,n.to=r,this._numElements+=n.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const r=this.drawCommandsDefault.pushNew(),n=this.holes.front();return this.vao!=null&&this.holes.length===1&&n.to===Math.floor(this.vao.byteSize/e)?(r.first=0,void(r.count=n.from)):(r.first=1/0,r.count=0,this._instances.forEach(s=>{r.first=Math.min(r.first,s.from),r.count=Math.max(r.count,s.to)}),void(r.count-=r.first))}const i=Array.from(this._instances.values()).sort((r,n)=>r.from===n.from?r.to-n.to:r.from-n.from);for(const r of i)r.isVisible&&(_le(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),_le(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function flt(t){return t.vao!=null}function UP(){return new xi({allocator:t=>t||new dlt,deallocator:t=>t})}function _le(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(mlt(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function mlt(t,e){return t.first+t.count>=e.from}let glt=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}};const ylt=XA+1;let vlt=class{constructor(e,i,r){this._rctx=e,this._locations=i,this._layout=r,this._cache=new uR(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const i=e.toString();let r=this._cache.pop(i);return r||(r=new Wp(this._rctx,this._locations,{geometry:this._layout},{geometry:xr.createVertex(this._rctx,dr.STATIC_DRAW)}),r.vertexBuffers.geometry.setSize(e),r)}deleteVao(e){if(e==null)return;const i=e.byteSize.toString();this._cache.put(i,e,ylt)}},a4=class extends sxe{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this.priority=0,this.produces=new Map}dispose(){this._glMaterials=jt(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=jt(this._vaoCache)}initializeRenderContext(e,i){const{rctx:r}=e.renderContext;this._glMaterials=new mCe(this.material,i??e.materialRepository),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new vlt(r,this.material.vertexAttributeLocations,Kc(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof vCe}get isDecoration(){return this.material.parameters.isDecoration}get rendersOccluded(){return!this.isEmpty&&this.material.parameters.renderOccluded!==vn.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,n)=>r+n.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,n)=>r+n.vao.usedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(n=>e(n.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const i=this._bufferWriter;if(i===null)return;const r=i.vertexBufferLayout.stride/4;for(const n of e){const s=n.renderGeometry,a=this._dataByOrigin.get(s.localOrigin.id),u=a?.findBuffer(s.id);if(u==null)return;const p=u.instances.get(s.id);if(n.updateType&(Gs.GEOMETRY|Gs.TRANSFORMATION)){const y=VP(i.elementCount(p.geometry.geometry)*r),b=i.vertexBufferLayout.createView(y.buffer);this._writeGeometry(s,b,0),u.vao.vertexBuffers.geometry.setSubData(y,p.from*r,0,p.numElements*r)}n.updateType&(Gs.HIGHLIGHT|Gs.OCCLUDEE|Gs.VISIBILITY)&&(u.drawCommandsDirty=!0)}}_computeDeltas(e,i){const r=new RE;for(const n of e){const s=n.localOrigin;if(s==null)continue;let a=r.get(s.id,null);a==null&&(a=new ble(s.vec3),r.set(s.id,null,a)),a.changes.push(n)}for(const n of i){const s=n.localOrigin;if(s==null)continue;const a=this._dataByOrigin.get(s.id),u=a?.findBuffer(n.id);if(u==null)continue;let p=r.get(s.id,u);p==null&&(p=new ble(s.vec3),r.set(s.id,u,p)),p.changes.push(n)}return r}_addAndRemoveGeometries(e,i){if(this._bufferWriter===null||this._vaoCache===null)return;const{_bufferWriter:r,_dataByOrigin:n}=this,s=r.vertexBufferLayout.stride/4,a=this._computeDeltas(e,i);a.forEach((u,p)=>{const y=u.get(null),b=y!=null?y.changes:[];a.delete(p,null);let S=n.get(p);if(u.forEach((C,O)=>{if(a.delete(p,O),O==null)return void zt(!1,"No VAO for removed geometries");if(O.instances.size===C.changes.length)return this._vaoCache.deleteVao(O.vao),A4(S.buffers,O),void(S.buffers.length===0&&b.length===0&&n.delete(p));const P=O.numElements,$=O.vao.byteSize/4,N=b.reduce((G,q)=>G+r.elementCount(q.geometry),0),z=C.changes.reduce((G,q)=>G+r.elementCount(q.geometry),0),U=Math.min((P+N-z)*s,BP),j=U>$;U>w8&&U<$/2?(C.changes.forEach(({id:G})=>O.deleteInstance(G)),O.instances.forEach(({geometry:G})=>b.push(G)),this._vaoCache.deleteVao(O.vao),A4(S.buffers,O)):j?this._applyAndRebuild(O,b,C):this._applyRemoves(O,C)}),b.length>0)for(S==null&&(S=new glt(y.origin),n.set(p,S)),S.buffers.forEach(C=>this._applyAdds(C,b));b.length>0;)S.buffers.push(this._applyAndRebuild(new plt,b,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.drawCommandsDirty&&(i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,Iu(i.instances,r=>(i.updateDrawState(r),i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees)),i.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||i.hasHighlights,this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(r!=null)for(const P of r.changes)e.deleteInstance(P.id);const n=this._bufferWriter,s=n.vertexBufferLayout.stride,a=s/4,u=Math.floor(BP/a);let p=e.numElements;for(;i.length>0;){const P=i.pop(),$=n.elementCount(P.geometry);if(p+$>u&&p>0){i.push(P);break}p+=$;const N=new vle(P,0,0);zt(e.instances.get(P.id)==null),e.addInstance(P.id,N)}const y=p*a,b=VP(y),S=n.vertexBufferLayout.createView(b.buffer);let C=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((P,$)=>{this._writeGeometry(P.geometry,S,C);const N=C;C+=n.elementCount(P.geometry.geometry),e.updateInstance($,N,C),e.updateDrawState(P)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Tle(y)),e.vao.vertexBuffers.geometry.setSubData(b,0,0,C*a),e.holes.clear();const O=e.holes.pushNew();return O.from=C,O.to=Math.floor(e.vao.byteSize/s),e.updateDrawCommands(s),e}_applyRemoves(e,i){if(i.changes.length===0||this._bufferWriter===null)return;for(const u of i.changes){const p=u.id,y=e.instances.get(p);if(!y)continue;e.deleteInstance(p);const b=af.back();if(b){if(b.to===y.from){b.to=y.to;continue}if(b.from===y.to){b.from=y.from;continue}}const S=af.pushNew();S.from=y.from,S.to=y.to}yle(af);const r=this._bufferWriter.vertexBufferLayout.stride/4,n=af.reduce((u,p)=>Math.max(u,p.numElements),0)*r,s=VP(n);s.fill(0,0,n);const a=e.vao.vertexBuffers.geometry;af.forAll(u=>a.setSubData(s,u.from*r,0,u.numElements*r)),e.holes.pushArray(af.data,af.length),af.forAll((u,p)=>af.data[p]=null),af.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0||this._bufferWriter===null)return;if(!flt(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,n=r.vertexBufferLayout.stride/4,s=e.numElements,a=i.reduce((z,U)=>z+r.elementCount(U.geometry),0),u=Math.min((s+a)*n,BP),p=4*u;if(e.vao.byteSize<Tle(BP-w8)&&p>e.vao.byteSize)return void this._applyAndRebuild(e,i,null);yle(e.holes);const y=new Array;for(const z of i){const U=r.elementCount(z.geometry),j=_lt(e.holes,U);y.push(j)}const b=e.vao.vertexBuffers.geometry;let S=0,C=0,O=0;const P=VP(u),$=r.vertexBufferLayout.createView(P.buffer);i.forEach((z,U)=>{const j=y[U];if(j==null)return;if(O!==j){const W=O-C;W>0&&b.setSubData(P,C*n,0,W*n),C=j,S=0}const G=r.elementCount(z.geometry);this._writeGeometry(z,$,S),S+=G,O=j+G;const q=new vle(z,j,j+G);zt(e.instances.get(z.id)==null),e.addInstance(z.id,q),e.drawCommandsDirty=!0});const N=O-C;N>0&&b.setSubData(P,C*n,0,N*n),XPe(i,(z,U)=>y[U]==null)}_writeGeometry(e,i,r){if(this._bufferWriter===null)return;const n=e.localOrigin.vec3;hXe(wle,-n[0],-n[1],-n[2]);const s=Rr(blt,wle,e.transformation);Ps(jP,s),Hc(jP,jP),this._bufferWriter.write(s,jP,e.geometry,i,r)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:i,bindParameters:r}=e;if(!this.material.produces(r.slot,i))return null;const n=i===oe.Highlight||i===oe.ShadowHighlight;if(n&&!this._hasHighlights)return null;const s=i===oe.ShadowExcludeHighlight,a=!(n||s);for(const u of this._dataByOrigin.values())for(const p of u.buffers){if(n&&!p.hasHighlights)continue;const y=(n?p.drawCommandsHighlight:s&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,b=a&&p.drawCommandsOccludees||null;if(y?.length||b?.length){const S=this._glMaterials.load(e.rctx,r.slot,i),C=S!=null?S.beginSlot(r):null;if(C!=null)return C}}return null}renderNode(e,i){const{output:r,bindParameters:n}=e,s=r===oe.Highlight||r===oe.ShadowHighlight,a=r===oe.ShadowExcludeHighlight,u=!(s||a),p=e.rctx,y=e.bindParameters.slot===De.OCCLUDER_MATERIAL,b=e.bindParameters.slot===De.TRANSPARENT_OCCLUDER_MATERIAL;p.runAppleAmdDriverHelper(),p.bindTechnique(i,this.material.parameters,n);for(const S of this._dataByOrigin.values())for(const C of S.buffers){if(s&&!C.hasHighlights)continue;const O=(s?C.drawCommandsHighlight:a&&C.needsMultipleCommands()?C.drawCommandsShadowHighlightRest:C.drawCommandsDefault)||null,P=u&&C.drawCommandsOccludees||null;(O?.length||P?.length)&&(i.program.bindDraw(new Oq(S.origin),n,this.material.parameters),i.ensureAttributeLocations(C.vao),p.bindVAO(C.vao),O?.length&&(p.setPipelineState(i.getPipeline(!1,y,b)),O.forAll($=>p.drawArrays(i.primitiveType,$.first,$.count))),P?.length&&(p.setPipelineState(i.getPipeline(!0,y,b)),P.forAll($=>p.drawArrays(i.primitiveType,$.first,$.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}};_([T({constructOnly:!0})],a4.prototype,"material",void 0),a4=_([Z("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],a4);let ble=class{constructor(e){this.origin=e,this.changes=new Array}};function _lt(t,e){let i;if(!t.some(n=>!(n.numElements<e)&&(i=n,!0)))return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const wle=Ze(),blt=Ze(),jP=Ze(),af=new xi({allocator:t=>t||new LQ,deallocator:null}),w8=65536,vz=4*w8,xle=1024,bCe=16777216,BP=bCe/4;let _z=new Float32Array(w8);function VP(t){return _z.length<t&&(_z=new Float32Array(t)),_z}function Tle(t){const e=4*t;return e<=xle?xle:e<vz?bge(e):Math.max(Math.min(Math.ceil(1.5*e/vz)*vz,bCe),e)}let bu=class extends Ke{constructor(e){super(e),this._pending=new wlt,this._changes=new Aq,this._materialRenderers=new xi,this._sortedMaterialRenderers=new xi,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forAll(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._materialRenderers.some(e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.length===0&&this._geometries.size===0}getMemoryForMaterial(e){return e==null?0:this._materialRenderers.find(r=>r.material===e)?.usedMemory??0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=fCe(this._changes);let i=!1,r=!1,n=!1;return e.forEach((s,a)=>{let u=this._materialRenderers.find(b=>b.material===a);if(!u&&s.adds.length>0){const b=new a4({material:a});b.initializeRenderContext(this.rendererContext.pluginContext,this._materialRepository),u=b,this._materialRenderers.push(u),i=!0,r=!0,n=!0}if(!u)return;const p=r||u.hasHighlights,y=n||u.hasWater;u.modify(s),r=r||p!==u.hasHighlights,n=n||y!==u.hasWater,u.isEmpty&&(this._materialRenderers.removeUnordered(u),u.dispose(),i=!0)}),this._changes.clear(),i&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=this._materialRenderers.some(s=>s.hasHighlights)),n&&(this._hasWater=this._materialRenderers.some(s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const s of r)this._geometries.set(s.id,s);const n=this._pending.empty;for(const s of r)this._pending.adds.add(s);n&&this.notifyChange("updating"),i===Sn.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,i){const r=this._pending.empty,n=this._pending.adds;for(const s of e)n.has(s)?(this._pending.removed.add(s),n.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===Sn.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const n of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(n),s.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case Gs.TRANSFORMATION:case Gs.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Gs.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedMaterialRenderers.forAll(r=>i=r.updateAnimation(e)||i),i}shouldRender(e){return this._sortedMaterialRenderers.some(i=>i.prepareTechnique(e))}render(e){this._sortedMaterialRenderers.forAll(i=>{const r=i.prepareTechnique(e);r!=null&&i.renderNode(e,r)})}intersect(e,i,r,n,s){return this._geometries.forEach(a=>{if(n&&!n(a))return;this._intersectRenderGeometry(a,r,i,0,e,s);const u=this.rendererContext.longitudeCyclical;u&&(a.boundingSphere[0]-a.boundingSphere[3]<u.min&&this._intersectRenderGeometry(a,r,i,u.range,e,s),a.boundingSphere[0]+a.boundingSphere[3]>u.max&&this._intersectRenderGeometry(a,r,i,-u.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear(),this._materialRenderers.forAll((e,i)=>{e.priority=i,this._sortedMaterialRenderers.push(e)}),this._sortedMaterialRenderers.sort((e,i)=>i.material.renderPriority===e.material.renderPriority?e.priority-i.priority:i.material.renderPriority-e.material.renderPriority)}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const i=this._changes.updates.data[e];this._pending.has(i.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,i,r,n,s,a){if(!e.visible)return;let u=0;n+=e.transformation[12],u=e.transformation[13],bz[0]=r[0]-n,bz[1]=r[1]-u,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,bz,(p,y,b)=>{xlt(i,b,e.material.renderPriority,a,s,e.layerUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let i;for(const r of e){const n=r.graphicUid;n!=null&&n!==i&&(this.drapeSource.notifyGraphicGeometryChanged(n),i=n)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let i;for(const r of e){const n=r.graphicUid;n!=null&&n!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(n),i=n)}}_validateRenderGeometries(e){for(const i of e)this._validateRenderGeometry(i);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};_([T()],bu.prototype,"drapeSource",void 0),_([T()],bu.prototype,"updating",null),_([T()],bu.prototype,"rctx",null),_([T({constructOnly:!0})],bu.prototype,"rendererContext",void 0),_([T()],bu.prototype,"_materialRepository",null),_([T()],bu.prototype,"_localOriginFactory",null),_([T({readOnly:!0})],bu.prototype,"isEmpty",null),_([T()],bu.prototype,"_materialRenderers",void 0),_([T()],bu.prototype,"_geometries",void 0),bu=_([Z("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],bu);let wlt=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function xlt(t,e,i,r,n,s,a){const u=new Qat(s,a,e),p=y=>{y.set(En.OVERLAY,u,t.dist,t.normal,t.transformation,i,r)};if((n.results.min.drapedLayerOrder==null||i>=n.results.min.drapedLayerOrder)&&(n.results.min.dist==null||n.results.ground.dist<=n.results.min.dist)&&p(n.results.min),n.options.store!==Jo.MIN&&(n.results.max.drapedLayerOrder==null||i<n.results.max.drapedLayerOrder)&&(n.results.max.dist==null||n.results.ground.dist>n.results.max.dist)&&p(n.results.max),n.options.store===Jo.ALL){const y=FZ(n.ray);p(y),n.results.all.push(y)}}const bz=Ct();let DQ=class wCe extends wr{initializeProgram(e){return new fr(e.rctx,wCe.shader.get().build(),ar)}initializePipeline(){return this.configuration.hasAlpha?mi({blending:Zo(et.SRC_ALPHA,et.ONE,et.ONE_MINUS_SRC_ALPHA,et.ONE_MINUS_SRC_ALPHA),colorWrite:Oi}):mi({colorWrite:Oi})}};DQ.shader=new pr(Aot,()=>ke(()=>import("./TextureOnly.glsl-64d9bfd6.js"),[],import.meta.url));let NQ=class extends rc{constructor(){super(...arguments),this.hasAlpha=!1}};_([ce()],NQ.prototype,"hasAlpha",void 0);let xCe=class extends Vr{constructor(){super(...arguments),this.overlayIndex=Ss.INNER,this.opacity=1}};function Tlt(){const t=new lr;return t.include(Ga),t.fragment.uniforms.add(new kt("tex",e=>e.texture)),t.fragment.uniforms.add(new ER("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new lt("opacity",e=>e.opacity)),t.fragment.code.add(F`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const Slt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:xCe,build:Tlt},Symbol.toStringTag,{value:"Module"}));let TCe=class SCe extends wr{initializeProgram(e){return new fr(e.rctx,SCe.shader.get().build(),ar)}initializePipeline(){return mi({blending:Xc(et.ONE,et.ONE_MINUS_SRC_ALPHA),colorWrite:Oi})}};TCe.shader=new pr(Slt,()=>ke(()=>import("./OverlayCompositing.glsl-41980473.js"),[],import.meta.url));let Ud=class extends $w{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new xCe,this.hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new xi,this._passParameters=new kEe,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new Kt,this.worldToPCSRatio=1,this.events=new Xn,this.longitudeCyclical=null,this.produces=new Map([[De.DRAPED_MATERIAL,i=>i!==oe.Highlight||this.hasHighlights],[De.DRAPED_WATER,()=>!0]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,i=this.view._stage.renderView,{waterTextureRepository:r,stippleTextureRepository:n,markerTextureRepository:s}=i;this._shaderTechniqueRepository=new zEe({rctx:this._rctx,viewingMode:ht.Local,stippleTextureRepository:n,markerTextureRepository:s,waterTextureRepository:r}),this._renderContext=new dCe(this._rctx,new IQ(e,this.view.state.viewingMode),null),this.addHandles([Fe(()=>r.updating,()=>this.events.emit("content-changed"),Ur),Fe(()=>this.spatialReference,a=>this._localOriginFactory=new PQ(a),Ur),ga(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new UEe(i.textureRepository,this._shaderTechniqueRepository,a=>{(a.parameters.renderOccluded&x8)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=De.DRAPED_MATERIAL,this._bindParameters.mainDepth=mJe(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=Ut.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new aK(st(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(Zt.STAGE,this))}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=Gi(this._debugTextureTechnique),this._passParameters.texture=jt(this._passParameters.texture),this._bindParameters.mainDepth=jt(this._bindParameters.mainDepth),this._shaderTechniqueRepository=ct(this._shaderTechniqueRepository),this.disposeOverlays()}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||Iu(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMemoryForMaterial(e){return Array.from(this._renderers.values()).reduce((i,r)=>i+r.getMemoryForMaterial(e),0)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,bu)}createDrapeSourceRenderer(e,i,r){const n=this._renderers.get(e);n?.destroy();const s=new i({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(Fe(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(e==null)return;const i=this._renderers.get(e);i!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),i.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&lI(e,i=>i.drapeTargetType===Tq.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=lI(e,i=>i.drapeSourceType===n4.Features),this._hasDrapedRasterSource=lI(e,i=>i.drapeSourceType===n4.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,i,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new got(this.view._stage.renderer.fboCache),this._overlays=[new Yae,new Yae]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=jt(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){if(e!=null)return e===bn.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(bn.Color):this._renderTargets?.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,i){let r=!1;for(const[n,s]of this._renderers){if(e.done)break;(n.destroyed||i(n))&&s.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=Iu(this._renderers,n=>n.hasHighlights),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(ml,e=>e.updatePolicy===ev.SYNC)}get isEmpty(){return!Xr.OVERLAY_DRAW_DEBUG_TEXTURE&&!Iu(this._renderers,e=>!e.isEmpty)}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}get mode(){return this.isEmpty?u0.Disabled:this._renderTargets?.getTexture(bn.WaterNormal)?u0.EnabledWithWater:this._renderTargets?.getTexture(bn.Color)?u0.Enabled:u0.Disabled}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const i of this._overlays)this.longitudeCyclical?i.setupGeometryViewsCyclical(this.longitudeCyclical):i.setupGeometryViewsDirect();for(const i of this._renderTargets.targets)(i.content!==bn.ColorNoRasterImage||this._needsColorWithoutRasterImage)&&(this._drawTarget(Ss.INNER,i,e),this._drawTarget(Ss.OUTER,i,e))}}_drawTarget(e,i,r){const n=this._overlays[e],s=n.canvasGeometries;if(s.numViews===0)return;const{alignPixelEnabled:a,contentPixelRatio:u}=r;this._screenToWorldRatio=u*n.mapUnitsPerPixel/this._bindParameters.overlayStretch;const p=i.output;if(this.isEmpty||p===oe.Highlight&&!this.hasHighlights||p===oe.Normal&&!this.hasWater||!n.hasSomeSizedView())return;const y=this._rctx;this._camera.pixelRatio=n.pixelRatio*u,this._renderContext.output=p,this._bindParameters.alignPixelEnabled=a,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=p===oe.Normal?De.DRAPED_WATER:De.DRAPED_MATERIAL;const b=Xr.OVERLAY_DRAW_DEBUG_TEXTURE&&i.content!==bn.Occluded;if(!b&&!this._sortedRenderers.some(({renderer:$})=>$.shouldRender(this._renderContext)))return;const S=n.resolution;this._rctx.setViewport(e===Ss.INNER?0:S,0,S,S);const C=2*n.resolution,O=n.resolution,P=i.fbo;if(P.bind(y,C,O),e===Ss.INNER&&(y.setClearColor(0,0,0,0),y.clearSafe(tn.COLOR_BUFFER_BIT)),i.content===bn.Occluded&&(this._renderContext.renderOccludedMask=x8),b)for(let $=0;$<s.numViews;$++)this._setViewParameters(s.extents[$],n),this._ensureDebugPatternResources(n.resolution,Clt[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._passParameters,null),this._rctx.screen.draw();this._sortedRenderers.forAll(({drapeSource:$,renderer:N})=>{if(i.content===bn.ColorNoRasterImage&&$.drapeSourceType===n4.RasterImage)return;const{fullOpacity:z}=$,U=z!=null&&z<1&&p===oe.Color?this.bindTemporaryFramebuffer(C,O):null;for(let j=0;j<s.numViews;j++)this._setViewParameters(s.extents[j],n),N.render(this._renderContext);if(U){P.bind(y,C,O),this._overlayParameters.texture=U.colorTexture,this._overlayParameters.opacity=z,this._overlayParameters.overlayIndex=e;const j=this.pluginContext.techniqueRepository.acquire(TCe);this._rctx.bindTechnique(j,this._overlayParameters,this._renderContext.bindParameters),this._rctx.screen.draw(),j.release(),U.release()}}),y.bindFramebuffer(null),e===Ss.OUTER&&P.generateMipMap(),this._renderContext.resetRenderOccludedMask()}bindTemporaryFramebuffer(e,i){const r=this.view._stage.renderer.fboCache,n=r.acquire(sr.RGBA,e,i);return r.rctx.bindFramebuffer(n.fbo),r.rctx.clearSafe(tn.COLOR_BUFFER_BIT),n}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,n){let s=0;for(const a of this._renderers.values())s=a.intersect?.(e,i,r,n,s)??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((i,r)=>{const n=e.indexOf(r.layer),s=n>=0,a=this._renderers.size*(r.renderGroup??(s?m8.MapLayer:m8.ViewLayer))+(s?n:0);this._sortedRenderers.push(new Elt(r,i,a))}),this._sortedRenderers.sort((i,r)=>i.index-r.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],Dge(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),YO(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=Iu(this._renderers,i=>i.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateRendersOccluded(){const e=Iu(this._renderers,i=>i.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_ensureDebugPatternResources(e,i){if($e(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let n=0;for(let u=0;u<e;u++)for(let p=0;p<e;p++){const y=Math.floor(p/10),b=Math.floor(u/10);y<2||b<2||10*y>e-20||10*b>e-20?(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=255):(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=1&y&&1&b?1&p^1&u?0:255:1&y^1&b?0:128)}const s=new Ar(e);s.samplingMode=Si.NEAREST,this._passParameters.texture=new yi(this._rctx,s,r);const a=new NQ;a.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(DQ,a)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};_([T()],Ud.prototype,"hasHighlights",void 0),_([T()],Ud.prototype,"_sortedDrapeSourceRenderersDirty",void 0),_([T({autoDestroy:!0})],Ud.prototype,"_shaderTechniqueRepository",void 0),_([T({constructOnly:!0})],Ud.prototype,"view",void 0),_([T()],Ud.prototype,"worldToPCSRatio",void 0),_([T()],Ud.prototype,"spatialReference",void 0),_([T({type:Boolean,readOnly:!0})],Ud.prototype,"updating",null),_([T()],Ud.prototype,"isEmpty",null),Ud=_([Z("esri.views.3d.terrain.OverlayRenderer")],Ud);let Elt=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const Clt=[[1,.5,.5],[.5,.5,1]],FQ=-2,x8=vn.OccludeAndTransparent;function kQ(t,e,i,r){const n=MR(t.rings,!!t.hasZ,I0.CCW_IS_HOLE,t.spatialReference),s=Ro(n.position.length),a=KTe(n.position,t.spatialReference,0,s,0,n.position,0,n.position.length/3,e,i,r),u=a!=null;return new Rlt(n.position,s,ACe(n.polygons,n.position,s),CCe(n.outlines,n.position,s),u,a)}function ECe(t,e){const i=MR(t.rings,!1,I0.CCW_IS_HOLE),r=Mn(i.position,t.spatialReference,0,i.position,e,0,i.position.length/3);for(let n=2;n<i.position.length;n+=3)i.position[n]=FQ;return{position:i.position,polygons:ACe(i.polygons,i.position),outlines:CCe(i.outlines,i.position),projectionSuccess:r}}function CCe(t,e,i=null){return t.filter(({count:r})=>r>1).map(({index:r,count:n})=>{const s=3*r,a=3*n;return i!=null?new OCe(r,n,Xh(e,s,a),Xh(i,s,a)):new zQ(r,n,Xh(e,s,a))})}function ACe(t,e,i=null){const r=new Array;for(const{index:n,count:s,holeIndices:a,pathLengths:u}of t){if(s<=1)continue;const p=3*n,y=3*s,b=a.map(C=>C-n),S=i!=null?new Alt(n,s,Xh(e,3*n,3*s),Xh(i,p,y),b,u):new Olt(n,s,Xh(e,3*n,3*s),b,u);r.push(S)}return r}let zQ=class{constructor(e,i,r){this.index=e,this.count=i,this.position=r}},OCe=class extends zQ{constructor(e,i,r,n){super(e,i,r),this.mapPositions=n}},Alt=class extends OCe{constructor(e,i,r,n,s,a){super(e,i,r,n),this.holeIndices=s,this.pathLengths=a}},Olt=class extends zQ{constructor(e,i,r,n,s){super(e,i,r),this.holeIndices=n,this.pathLengths=s}},Rlt=class{constructor(e,i,r,n,s,a){this.position=e,this.mapPositions=i,this.polygons=r,this.outlines=n,this.projectionSuccess=s,this.sampledElevation=a}};function aw(t,e,i,r,n,s=2){const a=1/(Math.abs(i)+Math.abs(r)+Math.abs(n)),u=i*a,p=r*a,y=n<=0?(u>=0?1:-1)*(1-Math.abs(p)):u,b=n<=0?(p>=0?1:-1)*(1-Math.abs(u)):p,S=e*s;t[S]=Sle(y),t[S+1]=Sle(b)}function Mlt(t){const e=t.length/3,i=new Int16Array(2*e);let r=0;for(let n=0;n<e;++n)aw(i,n,t[r++],t[r++],t[r++]);return i}function Plt(t,e,i,r=2){const n=i*r,s=Ele(e[n]),a=Ele(e[n+1]),u=1-Math.abs(s)-Math.abs(a);t[2]=u,u<0?(t[0]=(s>=0?1:-1)*(1-Math.abs(a)),t[1]=(a>=0?1:-1)*(1-Math.abs(s))):(t[0]=s,t[1]=a),We(t,t)}function Sle(t){return Je(Math.round(32767*t),-32767,32767)}function Ele(t){return Je(t/32767,-1,1)}const Ilt=["polygon","extent"];let $lt=class extends q0{constructor(e,i,r,n){super(e,i,r,n),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const u=sN(this._getSymbolSize());if(u)throw new de("graphics3dextrudesymbollayer:invalid-size",u)}const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacityAndColor(e),r=Ma(i),n=i[3],s=n<1||this.needsDrivenTransparentPass,a={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:n,transparent:s,cullFace:s?rn.None:rn.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:_r.Compressed};this._materials[wu.Main]=new Up(a),this._materials[wu.Bottom]=new Up({...a,cullFace:rn.Back}),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Ilt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(i);return this._createAs3DShape(i,e.renderingInfo,r,n,i.uid)}layerOpacityChanged(e,i){const r=this.symbolLayer?.material?.color,n=this._getCombinedOpacity(r),s=n<1||this.needsDrivenTransparentPass;this._materials[wu.Main]?.setParameters({opacity:n,transparent:s}),this._materials[wu.Bottom]?.setParameters({opacity:n,transparent:s});const a=this._getLayerOpacity();e.forEach(u=>{const p=i(u);p?.layerOpacityChanged(a,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Ev)}slicePlaneEnabledChanged(e,i){return this._materials[wu.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[wu.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(r=>{const n=i(r);n?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return this._materials[wu.Main]?.setParameters(e),this._materials[wu.Bottom]?.setParameters(e),!0}_getExtrusionSize(e){let i;return i=e.size&&this._drivenProperties.size?not(e.size,2)??0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(e,i){return this._drivenPropertiesChanged(i)?_s.RecreateSymbol:_s.RecreateGraphics}async queryForSnapping(e,i,r,n){const s=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/aS(i),{objectId:a,target:u}=e,p=Ce(u);switch(p.z=(p.z??0)+s,e.type){case"edge":{const{start:y,end:b}=e,S=Ce(y),C=Ce(b);return S.z=(S.z??0)+s,C.z=(C.z??0)+s,[Hae(a,p,1/0,S,C)]}case"vertex":return[Gst(a,p,1/0),Hae(a,u,1/0,u,p)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,i,r,n,s){const a=gO(e.geometry);if(a==null)return null;if(a.rings.length===0||!a.rings.some(se=>se.length>0))return this._logGeometryValidationWarnings(a.rings,"rings","ExtrudeSymbol3DLayer"),null;const u=kQ(a,this._context.elevationProvider,this._context.renderCoordsHelper,n);this._logGeometryCreationWarnings(u,a.rings,"rings","ExtrudeSymbol3DLayer");const p=iQ(a);if(p==null)return null;const y=new Array,b=new Array,S=eo(),C=Ze(),O=H(),P=this._context.renderCoordsHelper.viewingMode===ht.Global;P||this._context.renderCoordsHelper.worldUpAtPosition(null,O),jc(a.spatialReference,[p.x,p.y,0],C,this._context.renderCoordsHelper.spatialReference);const $=Ze();Ps($,C);const N=Pn();Rg(N,$);const{polygons:z,mapPositions:U,position:j}=u;for(const se of z){const ae=se.count;if(this._context.clippingExtent&&(cn(S),Fu(S,se.mapPositions),!vp(S,this._context.clippingExtent)))continue;const le=WS(se.mapPositions,se.holeIndices,3);if(le.length===0)continue;const me=le.length,ne=6*ae,pe=qL(ne+me),ge=qL(me),ve=Ro(3*ne),Se=Ro(3*ne),ee=Ro(3*ne),re=Ro(ne);Llt(j,U,le,se,ve,ee,Se,re,pe,ge,this._getExtrusionSize(i),O,P),Bp(ve,ve,$);const fe=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),ye=new zlt(ve,ee,Mlt(Se),re);y.push(Cle(this._materials[wu.Main],pe,pe.length-ge.length,ye,r,fe),Cle(this._materials[wu.Bottom],ge,0,ye,r,fe)),b.push(ye.heights)}if(y.length===0)return null;const G=new Xg({geometries:y,layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0});G.transformation=C;const q=fSe(this.symbolLayer,{opacity:this._getLayerOpacity()}),W=q!=null?{baseMaterial:this._materials[wu.Main],edgeMaterials:[q],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,K=new H0(this,G,y,null,null,(se,ae,le,me,ne)=>Flt(se,ae,le,me,ne,b),n,W);return K.alignedSampledElevation=u.sampledElevation,K.needsElevationUpdates=Ev(n.mode),K}};function Cle(t,e,i,r,n,s){const a=Uv(e.length),u=[[X.POSITION,new Et(r.positions,e,3,!0)],[X.NORMALCOMPRESSED,new Et(r.normals,e,2,!0)],[X.COLOR,new Et(n,a,4,!0)]];return new Is(t,u,r.elevation,Gn.Mesh,s,i)}function Llt(t,e,i,r,n,s,a,u,p,y,b,S,C){const O=i.length/3;let P=0,$=2*r.count;Dlt(t,e,r.index,r.count,i,0,O,n,s,a,u,p,y,$,b,S,C);let N=2*r.count;$=0,Ale(n,s,u,a,P,r.pathLengths[0],r.count,N,p,$,b),N+=4*r.pathLengths[0],$+=2*r.pathLengths[0],P+=r.pathLengths[0];for(let z=1;z<r.pathLengths.length;++z)Ale(n,s,u,a,P,r.pathLengths[z],r.count,N,p,$,b),N+=4*r.pathLengths[z],$+=2*r.pathLengths[z],P+=r.pathLengths[z]}function Dlt(t,e,i,r,n,s,a,u,p,y,b,S,C,O,P,$,N){Ie(Rl,$);const z=P>0?1:-1;let U=3*i,j=0,G=3*j,q=r,W=3*q;for(let ae=0;ae<r;++ae)N&&(Rl[0]=t[U],Rl[1]=t[U+1],Rl[2]=t[U+2],We(Rl,Rl)),u[G]=t[U],u[G+1]=t[U+1],u[G+2]=t[U+2],p[G]=e[U],p[G+1]=e[U+1],p[G+2]=e[U+2],y[G]=-z*Rl[0],y[G+1]=-z*Rl[1],y[G+2]=-z*Rl[2],b[j]=0,u[W]=t[U]+P*Rl[0],u[W+1]=t[U+1]+P*Rl[1],u[W+2]=t[U+2]+P*Rl[2],p[W]=e[U],p[W+1]=e[U+1],p[W+2]=e[U+2],y[W]=z*Rl[0],y[W+1]=z*Rl[1],y[W+2]=z*Rl[2],b[q]=P,G+=3,W+=3,U+=3,j+=1,q+=1;U=3*s,G=0,W=3*O;const K=P<0?$le:Ile,se=P<0?Ile:$le;for(let ae=0;ae<a;++ae)C[G]=n[U+K[0]],C[G+1]=n[U+K[1]],C[G+2]=n[U+K[2]],S[W]=n[U+se[0]]+r,S[W+1]=n[U+se[1]]+r,S[W+2]=n[U+se[2]]+r,G+=3,W+=3,U+=3}function GP(t,e,i,r,n,s,a){r[s]=r[a],a*=3,t[s*=3]=t[a],t[s+1]=t[a+1],t[s+2]=t[a+2],e[s]=e[a],e[s+1]=e[a+1],e[s+2]=e[a+2],i[s]=n[0],i[s+1]=n[1],i[s+2]=n[2]}const bC=H();function Ale(t,e,i,r,n,s,a,u,p,y,b){let S=n,C=n+1,O=n+a,P=n+a+1,$=u,N=u+1,z=u+2*s,U=u+2*s+1;b<0&&(S=n+a+1,P=n),y*=3;for(let j=0;j<s;++j)j===s-1&&(b>0?(C=n,P=n+a):(C=n,S=n+a)),Nlt(t,S,C,O,bC),GP(t,e,r,i,bC,$,S),GP(t,e,r,i,bC,N,C),GP(t,e,r,i,bC,z,O),GP(t,e,r,i,bC,U,P),p[y++]=$,p[y++]=z,p[y++]=U,p[y++]=$,p[y++]=U,p[y++]=N,S++,C++,O++,P++,$+=2,N+=2,z+=2,U+=2}const wz=H(),Ole=H(),Rle=H(),Mle=H(),Ple=H();function Nlt(t,e,i,r,n){e*=3,i*=3,r*=3,$e(wz,t[e++],t[e++],t[e++]),$e(Ole,t[i++],t[i++],t[i++]),$e(Rle,t[r++],t[r++],t[r++]),Be(Mle,Ole,wz),Be(Ple,Rle,wz),qt(n,Ple,Mle),We(n,n)}const C3=H();function Flt(t,e,i,r,n,s){const a=t.stageObject,u=a.geometries,p=u.length,y=e.mode!=="absolute-height";let b=0;const S=a.transformation,C=cE(Ze(),S);for(let O=0;O<p;O+=2){const P=u[O];if(!nQ(P))continue;const $=P.getMutableAttribute(X.POSITION).data,N=s[O/2],z=new zZ(P.mapPositions),U=$.length/3;let j=0,G=!1,q=0;for(let W=0;W<U;W++){C3[0]=$[j],C3[1]=$[j+1],C3[2]=$[j+2],r(z,HP),y&&(q+=HP.sampledElevation),Xr.TESTS_DISABLE_OPTIMIZATIONS?($e(ac,z.array[z.offset],z.array[z.offset+1],HP.z+N[j/3]),i!=null&&n.toRenderCoords(ac,i,ac),wt(ac,ac,C)):($e(ac,$[j],$[j+1],$[j+2]),wt(ac,ac,S),n.setAltitude(ac,HP.z+N[j/3]),wt(ac,ac,C)),$[j]=ac[0],$[j+1]=ac[1],$[j+2]=ac[2];const K=klt/n.unitInMeters;(Math.abs(C3[0]-$[j])>=K||Math.abs(C3[1]-$[j+1])>=K||Math.abs(C3[2]-$[j+2])>=K)&&(G=!0),z.offset+=3,j+=3}G&&(P.invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(u[O],X.POSITION),u[O+1].invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(u[O+1],X.POSITION)),b+=q/U}return b/p}const ac=H(),Rl=H(),HP=new TR,Ile=[0,2,1],$le=[0,1,2],klt=.01;var wu;(function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"})(wu||(wu={}));class zlt{constructor(e,i,r,n){this.positions=e,this.elevation=i,this.normals=r,this.heights=n}}var Lle,Dle,Rq={exports:{}};Rq.exports,Dle=function(){function t(n,s){function a(){this.constructor=n}a.prototype=s.prototype,n.prototype=new a}function e(n,s,a,u){var p=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(p,e.prototype),p.expected=s,p.found=a,p.location=u,p.name="SyntaxError",p}function i(n,s,a){return a=a||" ",n.length>s?n:(s-=n.length,n+(a+=a.repeat(s)).slice(0,s))}function r(n,s){var a,u={},p=(s=s!==void 0?s:{}).grammarSource,y={start:xn},b=xn,S="none",C=")",O=",",P="(",$="%",N="px",z="cm",U="mm",j="in",G="pt",q="pc",W="deg",K="rad",se="grad",ae="turn",le="#",me=".",ne="e",pe=/^[ \t\n\r]/,ge=/^[a-z\-]/,ve=/^[0-9a-fA-F]/,Se=/^[+\-]/,ee=/^[0-9]/,re=it("none"),fe=Xe("none",!1),ye=Xe(")",!1),we=Xe(",",!1),Ae=it("whitespace"),Oe=qe([" ","	",`
`,"\r"],!1,!1),Ve=it("function"),at=Xe("(",!1),Xt=it("identifier"),ti=qe([["a","z"],"-"],!1,!1),Vt=it("percentage"),Qt=Xe("%",!1),St=it("length"),ze=Xe("px",!1),ni=Xe("cm",!1),Ye=Xe("mm",!1),gt=Xe("in",!1),Nt=Xe("pt",!1),Jt=Xe("pc",!1),Tt=it("angle"),Q=Xe("deg",!1),pt=Xe("rad",!1),ii=Xe("grad",!1),bt=Xe("turn",!1),ci=it("number"),Ot=it("color"),It=Xe("#",!1),Rt=qe([["0","9"],["a","f"],["A","F"]],!1,!1),pi=qe(["+","-"],!1,!1),Ti=qe([["0","9"]],!1,!1),Dr=Xe(".",!1),tr=Xe("e",!1),je=function(){return[]},Bi=function(_e,Ge){return{type:"function",name:_e,parameters:Ge||[]}},f=function(_e,Ge){return Ge.length>0?NE(_e,Ge,3):[_e]},L=function(_e){return{type:"quantity",value:_e.value,unit:_e.unit}},x=function(_e){return{type:"color",colorType:_e.type,value:_e.value}},d=function(_e){return _e},c=function(){return Le()},o=function(_e){return{value:_e,unit:"%"}},l=function(_e){return{value:_e,unit:"px"}},h=function(_e){return{value:_e,unit:"cm"}},m=function(_e){return{value:_e,unit:"mm"}},g=function(_e){return{value:_e,unit:"in"}},v=function(_e){return{value:_e,unit:"pt"}},w=function(_e){return{value:_e,unit:"pc"}},E=function(_e){return{value:_e,unit:"deg"}},A=function(_e){return{value:_e,unit:"rad"}},M=function(_e){return{value:_e,unit:"grad"}},I=function(_e){return{value:_e,unit:"turn"}},D=function(_e){return{value:_e,unit:null}},k=function(){return{type:"hex",value:Le()}},B=function(_e){return{type:"function",value:_e}},J=function(){return{type:"named",value:Le()}},Y=function(){return parseFloat(Le())},V=0,te=0,he=[{line:1,column:1}],ue=0,xe=[],be=0;if("startRule"in s){if(!(s.startRule in y))throw new Error(`Can't start parsing from rule "`+s.startRule+'".');b=y[s.startRule]}function Le(){return n.substring(te,V)}function Xe(_e,Ge){return{type:"literal",text:_e,ignoreCase:Ge}}function qe(_e,Ge,nt){return{type:"class",parts:_e,inverted:Ge,ignoreCase:nt}}function xt(){return{type:"end"}}function it(_e){return{type:"other",description:_e}}function hi(_e){var Ge,nt=he[_e];if(nt)return nt;for(Ge=_e-1;!he[Ge];)Ge--;for(nt={line:(nt=he[Ge]).line,column:nt.column};Ge<_e;)n.charCodeAt(Ge)===10?(nt.line++,nt.column=1):nt.column++,Ge++;return he[_e]=nt,nt}function ai(_e,Ge,nt){var Qi=hi(_e),Cs=hi(Ge),an={source:p,start:{offset:_e,line:Qi.line,column:Qi.column},end:{offset:Ge,line:Cs.line,column:Cs.column}};return nt&&p&&typeof p.offset=="function"&&(an.start=p.offset(an.start),an.end=p.offset(an.end)),an}function yt(_e){V<ue||(V>ue&&(ue=V,xe=[]),xe.push(_e))}function Or(_e,Ge,nt){return new e(e.buildMessage(_e,Ge),_e,Ge,nt)}function xn(){var _e;return(_e=Pr())===u&&(_e=Ri()),_e}function Pr(){var _e,Ge;return be++,_e=V,bi(),n.substr(V,4)===S?(Ge=S,V+=4):(Ge=u,be===0&&yt(fe)),Ge!==u?(bi(),te=_e,_e=je()):(V=_e,_e=u),be--,_e===u&&be===0&&yt(re),_e}function Ri(){var _e,Ge;if(_e=[],(Ge=Vi())!==u)for(;Ge!==u;)_e.push(Ge),Ge=Vi();else _e=u;return _e}function Vi(){var _e,Ge,nt,Qi;return _e=V,bi(),(Ge=uo())!==u?(bi(),(nt=Ei())===u&&(nt=null),bi(),n.charCodeAt(V)===41?(Qi=C,V++):(Qi=u,be===0&&yt(ye)),Qi!==u?(bi(),te=_e,_e=Bi(Ge,nt)):(V=_e,_e=u)):(V=_e,_e=u),_e}function Ei(){var _e,Ge,nt,Qi,Cs,an,Ha,qv;if(_e=V,(Ge=Ki())!==u){for(nt=[],Qi=V,Cs=bi(),n.charCodeAt(V)===44?(an=O,V++):(an=u,be===0&&yt(we)),an===u&&(an=null),Ha=bi(),(qv=Ki())!==u?Qi=Cs=[Cs,an,Ha,qv]:(V=Qi,Qi=u);Qi!==u;)nt.push(Qi),Qi=V,Cs=bi(),n.charCodeAt(V)===44?(an=O,V++):(an=u,be===0&&yt(we)),an===u&&(an=null),Ha=bi(),(qv=Ki())!==u?Qi=Cs=[Cs,an,Ha,qv]:(V=Qi,Qi=u);te=_e,_e=f(Ge,nt)}else V=_e,_e=u;return _e}function Ki(){var _e,Ge;return _e=V,(Ge=Es())===u&&(Ge=Er())===u&&(Ge=th())===u&&(Ge=Qc()),Ge!==u&&(te=_e,Ge=L(Ge)),(_e=Ge)===u&&(_e=V,(Ge=J0())!==u&&(te=_e,Ge=x(Ge)),_e=Ge),_e}function bi(){var _e,Ge;for(be++,_e=[],pe.test(n.charAt(V))?(Ge=n.charAt(V),V++):(Ge=u,be===0&&yt(Oe));Ge!==u;)_e.push(Ge),pe.test(n.charAt(V))?(Ge=n.charAt(V),V++):(Ge=u,be===0&&yt(Oe));return be--,Ge=u,be===0&&yt(Ae),_e}function uo(){var _e,Ge,nt;return be++,_e=V,(Ge=Zi())!==u?(n.charCodeAt(V)===40?(nt=P,V++):(nt=u,be===0&&yt(at)),nt!==u?(te=_e,_e=d(Ge)):(V=_e,_e=u)):(V=_e,_e=u),be--,_e===u&&(Ge=u,be===0&&yt(Ve)),_e}function Zi(){var _e,Ge,nt;if(be++,_e=V,Ge=[],ge.test(n.charAt(V))?(nt=n.charAt(V),V++):(nt=u,be===0&&yt(ti)),nt!==u)for(;nt!==u;)Ge.push(nt),ge.test(n.charAt(V))?(nt=n.charAt(V),V++):(nt=u,be===0&&yt(ti));else Ge=u;return Ge!==u&&(te=_e,Ge=c()),be--,(_e=Ge)===u&&(Ge=u,be===0&&yt(Xt)),_e}function Es(){var _e,Ge,nt;return be++,_e=V,bi(),(Ge=Io())!==u?(n.charCodeAt(V)===37?(nt=$,V++):(nt=u,be===0&&yt(Qt)),nt!==u?(te=_e,_e=o(Ge)):(V=_e,_e=u)):(V=_e,_e=u),be--,_e===u&&be===0&&yt(Vt),_e}function Er(){var _e,Ge,nt;return be++,_e=V,bi(),(Ge=Io())!==u?(n.substr(V,2)===N?(nt=N,V+=2):(nt=u,be===0&&yt(ze)),nt!==u?(te=_e,_e=l(Ge)):(V=_e,_e=u)):(V=_e,_e=u),_e===u&&(_e=V,bi(),(Ge=Io())!==u?(n.substr(V,2)===z?(nt=z,V+=2):(nt=u,be===0&&yt(ni)),nt!==u?(te=_e,_e=h(Ge)):(V=_e,_e=u)):(V=_e,_e=u),_e===u&&(_e=V,bi(),(Ge=Io())!==u?(n.substr(V,2)===U?(nt=U,V+=2):(nt=u,be===0&&yt(Ye)),nt!==u?(te=_e,_e=m(Ge)):(V=_e,_e=u)):(V=_e,_e=u),_e===u&&(_e=V,bi(),(Ge=Io())!==u?(n.substr(V,2)===j?(nt=j,V+=2):(nt=u,be===0&&yt(gt)),nt!==u?(te=_e,_e=g(Ge)):(V=_e,_e=u)):(V=_e,_e=u),_e===u&&(_e=V,bi(),(Ge=Io())!==u?(n.substr(V,2)===G?(nt=G,V+=2):(nt=u,be===0&&yt(Nt)),nt!==u?(te=_e,_e=v(Ge)):(V=_e,_e=u)):(V=_e,_e=u),_e===u&&(_e=V,bi(),(Ge=Io())!==u?(n.substr(V,2)===q?(nt=q,V+=2):(nt=u,be===0&&yt(Jt)),nt!==u?(te=_e,_e=w(Ge)):(V=_e,_e=u)):(V=_e,_e=u)))))),be--,_e===u&&be===0&&yt(St),_e}function th(){var _e,Ge,nt;return be++,_e=V,(Ge=Io())!==u?(n.substr(V,3)===W?(nt=W,V+=3):(nt=u,be===0&&yt(Q)),nt!==u?(te=_e,_e=E(Ge)):(V=_e,_e=u)):(V=_e,_e=u),_e===u&&(_e=V,(Ge=Io())!==u?(n.substr(V,3)===K?(nt=K,V+=3):(nt=u,be===0&&yt(pt)),nt!==u?(te=_e,_e=A(Ge)):(V=_e,_e=u)):(V=_e,_e=u),_e===u&&(_e=V,(Ge=Io())!==u?(n.substr(V,4)===se?(nt=se,V+=4):(nt=u,be===0&&yt(ii)),nt!==u?(te=_e,_e=M(Ge)):(V=_e,_e=u)):(V=_e,_e=u),_e===u&&(_e=V,(Ge=Io())!==u?(n.substr(V,4)===ae?(nt=ae,V+=4):(nt=u,be===0&&yt(bt)),nt!==u?(te=_e,_e=I(Ge)):(V=_e,_e=u)):(V=_e,_e=u)))),be--,_e===u&&(Ge=u,be===0&&yt(Tt)),_e}function Qc(){var _e,Ge;return be++,_e=V,bi(),(Ge=Io())!==u?(te=_e,_e=D(Ge)):(V=_e,_e=u),be--,_e===u&&be===0&&yt(ci),_e}function J0(){var _e,Ge,nt,Qi;if(be++,_e=V,n.charCodeAt(V)===35?(Ge=le,V++):(Ge=u,be===0&&yt(It)),Ge!==u){if(nt=[],ve.test(n.charAt(V))?(Qi=n.charAt(V),V++):(Qi=u,be===0&&yt(Rt)),Qi!==u)for(;Qi!==u;)nt.push(Qi),ve.test(n.charAt(V))?(Qi=n.charAt(V),V++):(Qi=u,be===0&&yt(Rt));else nt=u;nt!==u?(te=_e,_e=k()):(V=_e,_e=u)}else V=_e,_e=u;return _e===u&&(_e=V,(Ge=Vi())!==u&&(te=_e,Ge=B(Ge)),(_e=Ge)===u&&(_e=V,(Ge=Zi())!==u&&(te=_e,Ge=J()),_e=Ge)),be--,_e===u&&(Ge=u,be===0&&yt(Ot)),_e}function Io(){var _e,Ge,nt,Qi,Cs,an,Ha;for(_e=V,Se.test(n.charAt(V))?(n.charAt(V),V++):be===0&&yt(pi),Ge=V,nt=[],ee.test(n.charAt(V))?(Qi=n.charAt(V),V++):(Qi=u,be===0&&yt(Ti));Qi!==u;)nt.push(Qi),ee.test(n.charAt(V))?(Qi=n.charAt(V),V++):(Qi=u,be===0&&yt(Ti));if(n.charCodeAt(V)===46?(Qi=me,V++):(Qi=u,be===0&&yt(Dr)),Qi!==u){if(Cs=[],ee.test(n.charAt(V))?(an=n.charAt(V),V++):(an=u,be===0&&yt(Ti)),an!==u)for(;an!==u;)Cs.push(an),ee.test(n.charAt(V))?(an=n.charAt(V),V++):(an=u,be===0&&yt(Ti));else Cs=u;Cs!==u?Ge=nt=[nt,Qi,Cs]:(V=Ge,Ge=u)}else V=Ge,Ge=u;if(Ge===u)if(Ge=[],ee.test(n.charAt(V))?(nt=n.charAt(V),V++):(nt=u,be===0&&yt(Ti)),nt!==u)for(;nt!==u;)Ge.push(nt),ee.test(n.charAt(V))?(nt=n.charAt(V),V++):(nt=u,be===0&&yt(Ti));else Ge=u;if(Ge!==u){if(nt=V,n.charCodeAt(V)===101?(Qi=ne,V++):(Qi=u,be===0&&yt(tr)),Qi!==u){if(Se.test(n.charAt(V))?(Cs=n.charAt(V),V++):(Cs=u,be===0&&yt(pi)),Cs===u&&(Cs=null),an=[],ee.test(n.charAt(V))?(Ha=n.charAt(V),V++):(Ha=u,be===0&&yt(Ti)),Ha!==u)for(;Ha!==u;)an.push(Ha),ee.test(n.charAt(V))?(Ha=n.charAt(V),V++):(Ha=u,be===0&&yt(Ti));else an=u;an!==u?nt=Qi=[Qi,Cs,an]:(V=nt,nt=u)}else V=nt,nt=u;nt===u&&(nt=null),te=_e,_e=Y()}else V=_e,_e=u;return _e}function DE(_e,Ge){return _e.map(function(nt){return nt[Ge]})}function NE(_e,Ge,nt){return[_e].concat(DE(Ge,nt))}if((a=b())!==u&&V===n.length)return a;throw a!==u&&V<n.length&&yt(xt()),Or(xe,ue<n.length?n.charAt(ue):null,ue<n.length?ai(ue,ue+1):ai(ue,ue))}return t(e,Error),e.prototype.format=function(n){var s="Error: "+this.message;if(this.location){var a,u=null;for(a=0;a<n.length;a++)if(n[a].source===this.location.source){u=n[a].text.split(/\r\n|\n|\r/g);break}var p=this.location.start,y=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(p):p,b=this.location.source+":"+y.line+":"+y.column;if(u){var S=this.location.end,C=i("",y.line.toString().length," "),O=u[p.line-1],P=(p.line===S.line?S.column:O.length+1)-p.column||1;s+=`
 --> `+b+`
`+C+` |
`+y.line+" | "+O+`
`+C+" | "+i("",p.column-1," ")+i("",P,"^")}else s+=`
 at `+b}return s},e.buildMessage=function(n,s){var a={literal:function(O){return'"'+p(O.text)+'"'},class:function(O){var P=O.parts.map(function($){return Array.isArray($)?y($[0])+"-"+y($[1]):y($)});return"["+(O.inverted?"^":"")+P.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(O){return O.description}};function u(O){return O.charCodeAt(0).toString(16).toUpperCase()}function p(O){return O.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(P){return"\\x0"+u(P)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(P){return"\\x"+u(P)})}function y(O){return O.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(P){return"\\x0"+u(P)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(P){return"\\x"+u(P)})}function b(O){return a[O.type](O)}function S(O){var P,$,N=O.map(b);if(N.sort(),N.length>0){for(P=1,$=1;P<N.length;P++)N[P-1]!==N[P]&&(N[$]=N[P],$++);N.length=$}switch(N.length){case 1:return N[0];case 2:return N[0]+" or "+N[1];default:return N.slice(0,-1).join(", ")+", or "+N[N.length-1]}}function C(O){return O?'"'+p(O)+'"':"end of input"}return"Expected "+S(n)+" but "+C(s)+" found."},{SyntaxError:e,parse:r}},(Lle=Rq).exports&&(Lle.exports=Dle());var Ult=Rq.exports;function RCe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=Nle(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new de("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:Nle(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!pDe(e[i].effects,e[i+1].effects))throw new de("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});fDe(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function Nle(t){let e;if(!t)return[];try{e=Ult.parse(t)}catch(i){throw new de("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>jlt(i))}function jlt(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return Blt(t);case"opacity":return Vlt(t);case"hue-rotate":return Glt(t);case"blur":return Hlt(t);case"drop-shadow":return qlt(t);case"bloom":return Wlt(t)}}catch(e){throw e.details.filter=t,e}throw new de("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function Blt(t){let e=1;return IE(t.parameters,1),t.parameters.length===1&&(e=op(t.parameters[0])),new oB(t.name,e)}function Vlt(t){let e=1;return IE(t.parameters,1),t.parameters.length===1&&(e=op(t.parameters[0])),new Wge(e)}function Glt(t){let e=0;return IE(t.parameters,1),t.parameters.length===1&&(e=Qlt(t.parameters[0])),new Hge(e)}function Hlt(t){let e=0;return IE(t.parameters,1),t.parameters.length===1&&(e=BQ(t.parameters[0]),IR(e,t.parameters[0])),new Uge(e)}function qlt(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new de("effect:type-error","Accepts only one color",{});i=ect(r)}else{const n=BQ(r);if(Object.isFrozen(e))throw new de("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(n),e.length===3&&IR(n,r)}if(e.length<2||e.length>3)throw new de("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new Vge(e[0],e[1],e[2]||0,i||MCe("black"))}function Wlt(t){let e=1,i=0,r=0;return IE(t.parameters,3),t.parameters[0]&&(e=op(t.parameters[0])),t.parameters[1]&&(i=BQ(t.parameters[1]),IR(i,t.parameters[1])),t.parameters[2]&&(r=op(t.parameters[2])),new kge(e,i,r)}function IE(t,e){if(t.length>e)throw new de("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function _N(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in jQ)return"<length>";if(t.unit in UQ)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function IR(t,e){if(t<0)throw new de("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function Xlt(t){if(t.type!=="quantity"||t.unit!==null)throw new de("effect:type-error",`Expected <double>, Actual: ${_N(t)}`,{term:t})}function Jlt(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new de("effect:type-error",`Expected <double> or <percentage>, Actual: ${_N(t)}`,{term:t})}const UQ={deg:1,grad:.9,rad:180/Math.PI,turn:360};function Ylt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&UQ[t.unit]!=null))throw new de("effect:type-error",`Expected <angle>, Actual: ${_N(t)}`,{term:t})}const jQ={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function Zlt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&jQ[t.unit]!=null))throw new de("effect:type-error",`Expected <length>, Actual: ${_N(t)}`,{term:t})}function op(t){Jlt(t);const e=t.value;return IR(e,t),t.unit==="%"?.01*e:e}function Klt(t){return Xlt(t),IR(t.value,t),t.value}function Qlt(t){return Ylt(t),t.value*UQ[t.unit]||0}function BQ(t){return Zlt(t),t.value*jQ[t.unit]||0}function ect(t){switch(t.colorType){case"hex":return zLe(t.value);case"named":return MCe(t.value);case"function":return rct(t.value)}}function MCe(t){if(!tge(t))throw new de("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return kLe(t)}const tct=/^rgba?/i,ict=/^hsla?/i;function rct(t){if(IE(t.parameters,4),tct.test(t.name))return[op(t.parameters[0]),op(t.parameters[1]),op(t.parameters[2]),t.parameters[3]?op(t.parameters[3]):1];if(ict.test(t.name))return ige(Klt(t.parameters[0]),op(t.parameters[1]),op(t.parameters[2]),t.parameters[3]?op(t.parameters[3]):1);throw new de("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function VQ(t,e,i){try{return sct(t)}catch(r){i?.messages?.push(r)}return null}function GQ(t,e,i,r){try{const n=nct(t);bl(i,n,e)}catch(n){r.messages&&r.messages.push(n)}}function nct(t){const e=RCe(t);return e?mDe(e)?e.map(i=>i.toJSON()):e.map(({scale:i,effects:r})=>({scale:i,value:r.map(n=>n.toJSON())})):null}function sct(t){if(!t||t.length===0)return null;if(oct(t)){const e=[];for(const i of t)e.push({scale:i.scale,value:Fle(i.value)});return e}return Fle(t)}function oct(t){const e=t[0];return!!e&&"scale"in e}function Fle(t){if(!t?.length)return"";const e=[];for(const i of t){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[nm(i,"amount")];break;case"blur":r=[nm(i,"radius","pt")];break;case"hue-rotate":r=[nm(i,"angle","deg")];break;case"drop-shadow":r=[nm(i,"xoffset","pt"),nm(i,"yoffset","pt"),nm(i,"blurRadius","pt"),act(i,"color")];break;case"bloom":r=[nm(i,"strength"),nm(i,"radius","pt"),nm(i,"threshold")]}const n=`${i.type}(${r.filter(Boolean).join(" ")})`;RCe(n),e.push(n)}return e.join(" ")}function nm(t,e,i){if(t[e]==null)throw new de("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return i?t[e]+i:""+t[e]}function act(t,e){if(t[e]==null)throw new de("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const i=t[e];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}function lct(t){return typeof t=="function"}function ANt(t,e,i,r){return lct(t)?t(e,i,r):t}function ONt(t){return[t.r,t.g,t.b,t.a]}const cct=` /-,
`;function kle(t){let e=t.length;for(;e--;)if(!cct.includes(t.charAt(e)))return!1;return!0}function uct(t,e){const i=[];let r=0,n=-1;do if(n=t.indexOf("[",r),n>=r){if(n>r){const s=t.substr(r,n-r);i.push([s,null,kle(s)])}if(r=n+1,n=t.indexOf("]",r),n>=r){if(n>r){const s=e[t.substr(r,n-r)];s&&i.push([null,s,!1])}r=n+1}}while(n!==-1);if(r<t.length-1){const s=t.substr(r);i.push([s,null,kle(s)])}return i}function hct(t,e,i){let r="",n=null;for(const s of e){const[a,u,p]=s;if(a)p?n=a:(n&&(r+=n,n=null),r+=a);else{const y=t.attributes[u];y&&(n&&(r+=n,n=null),r+=y)}}return dct(r,i)}function RNt(t,e,i){const r=uct(e,t);return n=>hct(n,r,i)}function dct(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function MNt(t,e,i,r,n,s,a=!0){const u=e/n,p=i/s,y=Math.ceil(u/2),b=Math.ceil(p/2);for(let S=0;S<s;S++)for(let C=0;C<n;C++){const O=4*(C+(a?s-S-1:S)*n);let P=0,$=0,N=0,z=0,U=0,j=0,G=0;const q=(S+.5)*p;for(let W=Math.floor(S*p);W<(S+1)*p;W++){const K=Math.abs(q-(W+.5))/b,se=(C+.5)*u,ae=K*K;for(let le=Math.floor(C*u);le<(C+1)*u;le++){let me=Math.abs(se-(le+.5))/y;const ne=Math.sqrt(ae+me*me);ne>=-1&&ne<=1&&(P=2*ne*ne*ne-3*ne*ne+1,P>0&&(me=4*(le+W*e),G+=P*t[me+3],N+=P,t[me+3]<255&&(P=P*t[me+3]/250),z+=P*t[me],U+=P*t[me+1],j+=P*t[me+2],$+=P))}}r[O]=z/$,r[O+1]=U/$,r[O+2]=j/$,r[O+3]=G/N}}function PCe(t){return t?{r:t[0],g:t[1],b:t[2],a:t[3]/255}:{r:0,g:0,b:0,a:0}}function pct(t){return t.data?.symbol??null}function fct(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function mct(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function ICe(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const PNt=(t,e=0)=>t==null||isNaN(t)?e:t,INt=t=>t.tintColor?PCe(t.tintColor):{r:255,g:255,b:255,a:1},$Nt=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function LNt(){return ke(()=>import("./geometryEngineJSON-3815d4bf.js"),["./geometryEngineJSON-3815d4bf.js","./geometryEngineJSON-d7488e9e.js","./json-48e3ea08.js"],import.meta.url)}function DNt(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function NNt(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function FNt(t){let e="normal",i="normal";if(t){const r=t.toLowerCase();r.includes("italic")?e="italic":r.includes("oblique")&&(e="oblique"),r.includes("bold")?i="bold":r.includes("light")&&(i="lighter")}return{style:e,weight:i}}function kNt(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function zle(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=zle(e);if(i!=null)return i}break;case"CIMTextSymbol":return zle(t.symbol);case"CIMSolidFill":return t.color}}function Ule(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const i of e){const r=Ule(i);if(r!=null)return r}break}case"CIMTextSymbol":return Ule(t.symbol);case"CIMSolidStroke":return t.color}}function jle(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=jle(e);if(i!==void 0)return i}break;case"CIMTextSymbol":return jle(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function zNt(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function UNt(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function jNt(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const BNt=t=>t.includes("data:image/svg+xml");function VNt(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function $Ce(t,e,i,r){if(t)if(t.type!=="CIMTextSymbol"){if(i&&t.effects)for(const n of t.effects)vct(n,e);if(t.symbolLayers)for(const n of t.symbolLayers)switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":gct(n,e,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!r?.preserveOutlineWidth&&n.width&&(n.width*=e);break;case"CIMPictureFill":n.height&&(n.height*=e),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e);break;case"CIMHatchFill":$Ce(n.lineSymbol,e,!0,{...r,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e),n.separation&&(n.separation*=e)}}else t.height!=null&&(t.height*=e)}function gct(t,e,i){if(t&&(t.markerPlacement&&yct(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const r of t.markerGraphics)t.scaleSymbolsProportionally||$Ce(r.symbol,e,!0,i)}function yct(t,e){switch(ICe(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function vct(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const i=t.dashTemplate.map(r=>r*e);t.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function _ct(t){const e=[];return Mq(pct(t),e),e.length?new mt(PCe(e[0])):null}function Mq(t,e){if(!t)return;let i;i=t.type==="CIMTextSymbol"?t.symbol:t;const r=t.type==="CIMPolygonSymbol";if(i?.symbolLayers){for(const n of i.symbolLayers)if(!(n.colorLocked||r&&(mct(n)||fct(n)&&n.markerPlacement&&ICe(n.markerPlacement))))switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor&&Ble(e,n.tintColor);break;case"CIMVectorMarker":n.markerGraphics?.forEach(s=>{Mq(s.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":Ble(e,n.color);break;case"CIMHatchFill":Mq(n.lineSymbol,e)}}}function Ble(t,e){for(const i of t)if(i.join(".")===e.join("."))return;t.push(e)}let LCe=class{constructor(e,i){this._storage=new Iwe,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),i&&this._storage.registerRemoveFunc("",i)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,i,r=1){this._storage.put(this,e,i,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};new LCe(1e3);new mt([128,128,128]);const bct=new mt("white");function wct(t){return t.resource?.href??""}function HNt(t,e){if(!t)return null;let i=null;return J2(t)?i=xct(t):c7(t)&&(i=t.type==="cim"?_ct(t):t.color?new mt(t.color):null),i?_O(i,e):null}function xct(t){const e=t.symbolLayers;if(!e)return null;let i=null;return e.forEach(r=>{r.type==="object"&&r.resource?.href||(i=r.type==="water"?r.color:r.material?r.material.color:null)}),i?new mt(i):null}function _O(t,e){if(e==null||t==null)return t;const i=t.toRgba();return i[3]=i[3]*e,new mt(i)}function Tct(t,e,i){const r=t.symbolLayers;if(!r)return;const n=s=>_O(e=e??s??(i!=null?bct:null),i);r.forEach(s=>{if(s.type!=="object"||!s.resource?.href||e)if(s.type==="water")s.color=n(s.color);else{const a=s.material!=null?s.material.color:null,u=n(a);s.material==null?s.material=new Hu({color:u}):s.material.color=u,i!=null&&"outline"in s&&s.outline?.color!=null&&(s.outline.color=_O(s.outline.color,i))}})}function Sct(t,e,i){(e=e??t.color)&&(t.color=_O(e,i)),i!=null&&"outline"in t&&t.outline?.color&&(t.outline.color=_O(t.outline.color,i))}function qNt(t,e,i){t&&(e||i!=null)&&(e&&(e=new mt(e)),J2(t)?Tct(t,e,i):c7(t)&&Sct(t,e,i))}async function Ect(t,e){const i=t.symbolLayers;i&&await CD(i,async r=>Cct(r,e))}async function Cct(t,e){switch(t.type){case"extrude":Oct(t,e);break;case"icon":case"line":case"text":Act(t,e);break;case"path":Mct(t,e);break;case"object":await Rct(t,e)}}function Act(t,e){const i=DCe(e);i!=null&&(t.size=i)}function DCe(t){for(const e of t)if(typeof e=="number")return e;return null}function Oct(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function Rct(t,e){const{resourceSize:i,symbolSize:r}=await Pct(t),n=NCe(e,i,r);t.width=l4(e[0],r[0],i[0],n),t.depth=l4(e[1],r[1],i[1],n),t.height=l4(e[2],r[2],i[2],n)}function Mct(t,e){const i=NCe(e,rg,[t.width,void 0,t.height]);t.width=l4(e[0],t.width,1,i),t.height=l4(e[2],t.height,1,i)}function NCe(t,e,i){for(let r=0;r<3;r++){const n=t[r];switch(n){case"symbol-value":{const s=i[r];return s!=null?s/e[r]:1}case"proportional":break;default:if(n&&e[r])return n/e[r]}}return 1}async function Pct(t){const{computeObjectLayerResourceSize:e}=await ke(()=>import("./symbolLayerUtils-63b82dec.js"),[],import.meta.url),i=await e(t,10),{width:r,height:n,depth:s}=t,a=[r,s,n];let u=1;for(let p=0;p<3;p++){const y=a[p];if(y!=null){u=y/i[p];break}}for(let p=0;p<3;p++)a[p]==null&&(a[p]=i[p]*u);return{resourceSize:i,symbolSize:a}}function l4(t,e,i,r){switch(t){case"proportional":return i*r;case"symbol-value":return e??i;default:return t}}function Ict(t,e){const i=DCe(e);if(i!=null)switch(t.type){case"simple-marker":t.size=i;break;case"picture-marker":{const r=t.width/t.height;r>1?(t.width=i,t.height=i*r):(t.width=i*r,t.height=i);break}case"simple-line":t.width=i;break;case"text":t.font.size=i}}async function WNt(t,e){if(t&&e)return J2(t)?Ect(t,e):void(c7(t)&&Ict(t,e))}function XNt(t,e,i){if(t&&e!=null)if(J2(t)){const r=t.symbolLayers;r&&r.forEach(n=>{if(n&&n.type==="object")switch(i){case"tilt":n.tilt=e;break;case"roll":n.roll=e;break;default:n.heading=e}})}else c7(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function JNt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function YNt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}function $ct(t,e,i,r,n){if(t==null)return null;const s=t.referencesGeometry()&&n?Lct(e,r,n):e,a=t.repurposeFeature(s);try{return t.evaluate({...i,$feature:a},t.services)}catch(u){return Ee.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",u),null}}const xz=new Map;function Lct(t,e,i){const{transform:r,hasZ:n,hasM:s}=i;xz.has(e)||xz.set(e,Dct(e));const a=xz.get(e)(t.geometry,r,n,s);return{...t,geometry:a}}function Dct(t){const e={};switch(t){case"esriGeometryPoint":return(i,r,n,s)=>lEe(r,e,i,n,s);case"esriGeometryPolygon":return(i,r,n,s)=>cEe(r,e,i,n,s);case"esriGeometryPolyline":return(i,r,n,s)=>uEe(r,e,i,n,s);case"esriGeometryMultipoint":return(i,r,n,s)=>aEe(r,e,i,n,s);default:return Ee.getLogger("esri.views.2d.support.arcadeOnDemand").error(new de("mapview-arcade",`Unable to handle geometryType: ${t}`)),i=>i}}const ZNt=1.2,Nct=qu,Fct=4;let bN=class{constructor(e,i,r,n){this.graphics3DSymbolLayer=e,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=n,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Sn.ADD);if(e||this._addedToStage){for(const i of this.renderGeometries)i.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Gs.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Sn.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=H()){return $e(e,0,0,0)}getBoundingBoxObjectSpace(e=eo()){return cn(e)}addObjectState(e,i){e===Pg.Highlight&&(this.renderGeometries.forEach(r=>{const n=r.geometry.addHighlight();i.addRenderGeometry(r,n,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Gs.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(i=>{e.removeRenderGeometry(i)})}removeRenderGeometryObjectState(e,i){e.geometry.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Gs.HIGHLIGHT)}computeAttachmentOrigin(e){for(const i of this.renderGeometries)i.geometry.computeAttachmentOrigin(A3)&&(e.draped.origin[0]+=A3[0],e.draped.origin[1]+=A3[1],e.draped.num++)}async getProjectedBoundingBox(e,i,r,n,s){cn(s);for(let a=0;a<this.renderGeometries.length;a++){const u=this.renderGeometries[a];this._getRenderGeometryProjectedBoundingRect(u,e,Vle,r),BUe(s,Vle)}if(i){let a;yp(s,A3);const u=rQ(s,i.service.spatialReference,i);try{a=await i.service.queryElevation(A3[0],A3[1],n,u,"ground")}catch{}a!=null&&(s[2]=Math.min(s[2],a),s[5]=Math.max(s[5],a))}return s}_getRenderGeometryProjectedBoundingRect(e,i,r,n){if(this.boundingBox)r7(lf,this.boundingBox);else{const s=e.boundingSphere,a=s[3];lf[0]=s[0]-a,lf[1]=s[1]-a,lf[2]=s[2]-a,lf[3]=s[0]+a,lf[4]=s[1]+a,lf[5]=s[2]+a}return i(lf,0,2),this.calculateRelativeScreenBounds&&n.push({location:yp(lf),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),ZY(lf,r)}};const Vle=Di(),lf=eo(),A3=H();function T8(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}function FCe(t){const{size:e}=t.definition,i=t.fontString(e);let r=Gle.get(i);if(!r){const n=T8(zct,0,0).getContext("2d");t.setFontProperties(n,e);const s=n.measureText(Uct);r=new kct(s.actualBoundingBoxAscent,s.actualBoundingBoxDescent),Gle.set(i,r)}return r}const Gle=new Map;let kct=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,i){this.maxAscent=e,this.maxDescent=i}};const zct={canvas:null},Uct=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),S8=1;let kCe=class{constructor(e,i,r,n){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.replaceAll(" ","Â ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let i=0;i<this._lines.length-1;i++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=T8(Hle,qP,qP).getContext("2d");this._parameters.setFontProperties(e,this._fontSize);let i=2*this._haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let n,s,a=0,u=0,p=0;this._lines.forEach((C,O)=>{const P=e.measureText(C),$=P.width,N=$+i;this._textWidths.push($),this._lineWidths.push(N),a=Math.max(a,N),u=Math.max(u,P.actualBoundingBoxAscent),p=Math.max(p,P.actualBoundingBoxDescent),O===0&&(n=P),O===this._lines.length-1&&(s=P)});const y=FCe(this._parameters);u=Math.max(u,y.maxAscent),p=Math.max(p,y.maxDescent);const b=n.actualBoundingBoxAscent,S=this._parameters.definition.font.decoration==="underline"?p:s.actualBoundingBoxDescent;this._metricsCached=new Bct(b,S,u,p,a)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*jct}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,S8)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case tv.Left:return this._horizontalPadding;case tv.Center:return(this.displayWidth-this._lineWidths[e])/2;case tv.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,i,r){e.save();const n=i/=this.renderPixelRatio,s=r/=this.renderPixelRatio,a=this._haloSize,u=this._firstLineYOffset+this._metrics.firstLineAscent;i+=a,r+=u;const p=this._haloSize>0;p&&this._renderHalo(e,n,s,a,u),this._parameters.setFontProperties(e,this._renderedFontSize);for(let y=0;y<this._lines.length;++y){const b=this._lines[y],S=this._getLineXOffset(y);p&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,b,i+S,r),this._renderLineDecoration(e,i+S,r,this._textWidths[y])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,b,i+this._getLineXOffset(y),r),this._renderLineDecoration(e,i+S,r,this._textWidths[y]),r+=this._lineSpacing}if(Xr.TEXT_SHOW_BASELINE){e.strokeStyle=qle,e.setLineDash([2,2]),e.lineWidth=1;let y=s+u;for(let b=0;b<this._lines.length;++b)this._drawLine(e,[n,y],[n+this.displayWidth,y]),y+=this._lineSpacing}if(Xr.TEXT_SHOW_BORDER&&(e.strokeStyle=qle,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[n,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const y=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,n,s,y),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,n,s=!1){if(this._parameters.definition.font.decoration==="none"||n===0)return;const a=1,u=Math.max(this._parameters.definition.size/16,a);switch(this._parameters.definition.font.decoration){case"underline":r+=2*u;break;case"line-through":r-=.33*this._midLineAscent}const p=s?this._haloSize:0;e.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(u+2*p),e.beginPath(),e.moveTo(this._toRenderUnit(i-p),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+n+p),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,n){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const s=this.renderedWidth,a=this.renderedHeight;n!==0?(n=Je(n,0,Math.floor(a/2)),e.beginPath(),e.moveTo(i,r+n),e.arcTo(i,r,i+n,r,n),e.lineTo(i+s-n,r),e.arcTo(i+s,r,i+s,r+n,n),e.lineTo(i+s,r+a-n),e.arcTo(i+s,r+a,i+s-n,r+a,n),e.lineTo(i+n,r+a),e.arcTo(i,r+a,i,r+a-n,n),e.closePath()):e.rect(i,r,s,a)}_renderHalo(e,i,r,n,s){const a=this.renderedWidth,u=this.renderedHeight,p=T8(Hle,Math.max(a,qP),Math.max(u,qP)),y=p.getContext("2d");y.clearRect(0,0,a,u),this._parameters.setFontProperties(y,this._renderedFontSize),y.fillStyle=this._parameters.haloStyle,y.strokeStyle=this._parameters.haloStyle;const b=this._renderedHaloSize<3;y.lineJoin=b?"miter":"round",b?this._renderHaloEmulated(y,n,s):this._renderHaloNative(y,n,s);let S=s;for(let C=0;C<this._lines.length;++C){const O=this._getLineXOffset(C);this._renderLineDecoration(y,n+O,S,this._textWidths[C],!0),S+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(p,0,0,a,u,this._toRenderUnit(i),this._toRenderUnit(r),a,u),e.globalAlpha=1}_renderHaloEmulated(e,i,r){for(let n=0;n<this._lines.length;++n){const s=this._lines[n],a=this._getLineXOffset(n);for(const[u,p]of zCe)this._fillText(e,s,i+a+this._haloSize*u,r+this._haloSize*p);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const n=2*this._haloSize;for(let s=0;s<this._lines.length;++s){const a=this._lines[s],u=this._getLineXOffset(s),p=5,y=.1;for(let b=0;b<p;b++){const S=1-(p-1)*y+b*y;e.lineWidth=this._toRenderUnit(S*n),this._strokeText(e,a,i+u,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,n){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(n))}_strokeText(e,i,r,n){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(n))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const n=this._toRenderUnit(i[0]),s=this._toRenderUnit(i[1]),a=this._toRenderUnit(r[0]),u=this._toRenderUnit(r[1]),p=Math.floor(n)+.5,y=Math.ceil(n+a)-.5,b=Math.floor(s)+.5,S=Math.ceil(s+u)-.5;e.beginPath(),e.moveTo(p,b),e.lineTo(y,b),e.lineTo(y,S),e.lineTo(p,S),e.lineTo(p,b),e.stroke()}};const zCe=[];for(let e=0;e<360;e+=360/16)zCe.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var tv;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(tv||(tv={}));const Hle={canvas:null},jct=.2,qP=512,qle="rgb(255, 0, 255, 0.5)";let Bct=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,i,r,n,s){this.firstLineAscent=e,this.lastLineDescent=i,this.maxLineAscent=r,this.maxLineDescent=n,this.displayWidth=s}};const Vct=Object.freeze({left:0,center:.5,right:1}),D$=Object.freeze({"bottom-left":Xi(0,0),bottom:Xi(.5,0),"bottom-right":Xi(1,0),left:Xi(0,.5),center:Xi(.5,.5),right:Xi(1,.5),"top-left":Xi(0,1),top:Xi(.5,1),"top-right":Xi(1,1)});function UCe(t){switch(t){case"left":return tv.Left;case"right":return tv.Right;default:return tv.Center}}function Wle(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function Gct(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Hct(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function qct(t){return t==="middle"?"center":t}function Wct(t,e){switch(t){case"top":return Yi(e,0,S8);case"bottom":return Yi(e,0,-S8);default:return $s(e,Cg)}}let JS=class{constructor(e,i={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=Ze(),this._shaderTransformation=null,this._boundingSphere=null,this.id=zu(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.castShadow=i.castShadow??!1,i.objectShaderTransformation!=null&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){bs(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=Ze()),Rr(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=as()),wt(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*MS(this.shaderTransformation)),this._boundingSphere):Q_e}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation==null?this.transformation:this._shaderTransformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const Xle=st(0,0,1),Xct=16,Jct=1.5,l2=RQ,Yct=[l2/2,l2/2,1-l2/2,1-l2/2],Zct=[_8*l2,_8*l2];let Pq=class jCe extends q0{getCachedSize(){return{size:this._getIconSize()}}constructor(e,i,r,n){super(e,i,r,n),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(r!=null)this._prepareResourcesPrimitive(i,r);else{const n=wct(this.symbolLayer),s=sv(n);s&&s.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(s.data),e):await this._prepareResourcesHref(i,n,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=sN(this._getIconSize());if(e)throw new de("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,i=Math.round(e.size!=null?Xo(e.size):Xct);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(e){const i=this._getGraphicHash(e);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const n={scaleFactor:this._cimScaleFactorOrFunction},s=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",n,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",s.anchorPosition);const a={width:s.imageData.width,height:s.imageData.height};r=new Nw(s.imageData,a),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(Kct(i)){const{screenLength:r,minWorldLength:n,maxWorldLength:s}=i.verticalOffset;e.verticalOffset={screenLength:Xo(r),minWorldLength:n||0,maxWorldLength:s??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,i){const r=this._getOutlineSize();if(Tz(i)&&r===0)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const s=this._context.sharedResources.textures.fromData(`${i}-icon`,()=>Tat(i));this._textureHandle=s,e.textureId=s.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=xat(i),e.distanceFieldBoundingBox=Yct;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/l2,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,i,r){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const n=this._getIconSize(),s=n*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const a=await Gc(this._context.sharedResources.textures.fromUrl(i,s,{signal:r}));if(a.ok===!1)throw $a(a.error),new de("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._textureHandle=a.value;const u=a.value.texture,p=u.parameters.width/u.parameters.height;this._size=p>1?[n,Math.round(n/p)]:[Math.round(n*p),n],e.textureId=u.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,i,r){const n=new gE({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const b=(await ke(()=>import("./CIMSymbolRasterizer-3c64cb3d.js"),["./CIMSymbolRasterizer-3c64cb3d.js","./cimAnalyzer-d2e2bef0.js","./labelPoint-28dffb78.js","./TileClipper-ae6eca9e.js","./definitions-b2b7fe84.js","./number-e491b09e.js","./BidiEngine-9a40f2f4.js","./rasterizingUtils-e04f6f4b.js"],import.meta.url)).CIMSymbolRasterizer;oi(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new b(this._context.renderCoordsHelper.spatialReference,!0))}const s=this._context.layer.fields?this._context.layer.fields.map(b=>b.toJSON()):null;let a,u;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(n,s,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const b=this._context.renderer;if(isNaN(b.scaleExpression)){const S=b.scaleExpression,C=await Eze(S,this._context.layer.spatialReference,s);u=(O,P,$)=>{const N=$ct(C,O,{$view:$},"esriGeometryPoint",P);return N!==null?N:1}}else a=Number(b.scaleExpression)}this._cimScaleFactorOrFunction=a||u||1;const p=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];oi(r);const y=this._context.layer.fieldsIndex;this._cimRequiredFields=p.map(b=>y.get(b).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||sje}_getOutlineSize(){let e=0;const i=this.symbolLayer;return i.outline?.size!=null?Math.max(Xo(i.outline.size),0):(e=Tz(this._getPrimitive())?Jct:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),i=this.symbolLayer,r=i?.outline?.color;if(r!=null){const n=mt.toUnitRGB(r),s=r.a*e;return[n[0],n[1],n[2],s]}return[0,0,0,0]}_getFillColor(){if(Tz(this._getPrimitive()))return Nct;const e=this._getPrimitive()==null,i=this.symbolLayer?.material?.color;return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:e})}_getAnchorPos(e,i){return e==="relative"?Xi((i.x||0)+.5,.5-(i.y||0)):e in D$?D$[e]:D$.center}_createMaterialAndAddToStage(e,i){if(this._cimLayers){this._fastUpdates=null;let r=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new HS(e),this._cimSymbolMaterials.set(e.textureId??0,r),i.add(r)),r}return this._fastUpdates=BS(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._materials[0]=new HS(e),i.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._textureHandle=Gi(this._textureHandle)}_getScaleFactor(e,i){if(this._drivenProperties.size&&e.size){for(let r=0;r<3;r++){const n=e.size[r];n&&n!=="symbol-value"&&n!=="proportional"&&(e.size[r]=Xo(n))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/i;if(isFinite(+e.size[2]))return+e.size[2]/i}return 1}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;let r,n=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const S=this._generateTextureCIM(i),C={textureId:S.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(C,this._context.stage),n=[S.parameters.width,S.parameters.height]}else n=this._size,r=this._materials[0];const s=fO(i.geometry);if(s==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const a=e.renderingInfo,u=this._getVertexOpacityAndColor(a);let p=1;if(!this._fastUpdates?.visualVariables.size){const S=n[0]>n[1]?n[0]:n[1];p=this._getScaleFactor(a,S)}p*=this._symbolTextureRatio;const y=Xi(n[0]*p,n[1]*p),b=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(b.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,s,r,u,y,e.layer.uid):this._createAs3DShape(i,s,r,u,y,b,i.uid)}layerOpacityChanged(){const e=this._getFillColor(),i=this._getOutlineColor();this._forEachMaterial(r=>{r.setParameters({color:e}),r.setParameters({outlineColor:i})})}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=xR(jCe.elevationModeChangeTypes,r,n);if(s!==Hn.UPDATE)return s;const a=hd(n)||n==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,i,()=>a)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!VS(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return _s.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return _s.FastUpdate}_defaultElevationInfoNoZ(){return Qct}_createAs3DShape(e,i,r,n,s,a,u){const p=this.getFastUpdateAttrValues(e),y=this._context.layer.uid,b=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:u,layerUid:y}),S=zH(r,Xle,null,n,s,eut,null,p,b),C=mQ(this._context,i,S,a,u);if(C==null)return null;const O=new H0(this,C.object,[S],null,null,C2,a);return O.alignedSampledElevation=C.sampledElevation,O.needsElevationUpdates=hd(a.mode)||a.mode==="absolute-height",O.getScreenSize=this._createScreenSizeGetter(s,p),O.calculateRelativeScreenBounds=P=>r.calculateRelativeScreenBounds(O.getScreenSize(),1,P),pO(O,i,this._context.elevationProvider),O}_createAsOverlay(e,i,r,n,s,a){r.renderPriority=this._renderPriority;const u=ji();Wc(i,u,this._context.overlaySR),u[2]=FQ;const p=this._context.clippingExtent;if(p!=null&&!YY(p,u))return null;const y=this.getFastUpdateAttrValues(e),b=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),S=zH(r,Xle,u,n,s,null,null,y,b),C=new JS(S,{layerUid:a,graphicUid:e.uid}),O=new bN(this,[C],null,this._context.drapeSourceRenderer);return O.getScreenSize=this._createScreenSizeGetter(s,y),O.calculateRelativeScreenBounds=P=>r.calculateRelativeScreenBounds(O.getScreenSize(),1,P),O}_createScreenSizeGetter(e,i){const r=this._outlineSize+2;if(this._fastUpdates&&i){const a=e[0]/this._symbolTextureRatio,u=e[1]/this._symbolTextureRatio;return(p=Ct())=>{const[y,b]=GK(tut,this._fastUpdates.materialParameters,i);return p[0]=y*a+r,p[1]=b*u+r,p}}const n=e[0]/this._symbolTextureRatio+r,s=e[1]/this._symbolTextureRatio+r;return(a=Ct())=>(a[0]=n,a[1]=s,a)}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),i=st(e,e,e),r=ed(1),n=e*r,s=st(n,n,n);return new vR({size:!0,color:!0,rotation:!0,opacity:!1},i,s,r)}_getGraphicHash(e){let i="";for(const r of this._cimRequiredFields)i+=r+e.attributes[r];return i}_forEachMaterial(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._materials[0]}}};function Kct(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function Tz(t){return t!=null&&(t==="cross"||t==="x")}Pq.PRIMITIVE_SIZE=Zct,Pq.elevationModeChangeTypes={definedChanged:Hn.UPDATE,staysOnTheGround:Hn.NONE,onTheGroundChanged:Hn.RECREATE};const Qct={mode:"relative-to-ground",offset:0},eut=vi(0,0,0,1),tut=H();function Iq(t){switch(t){case"butt":return Jh.BUTT;case"square":return Jh.SQUARE;case"round":return Jh.ROUND;default:return null}}function Jle(t){return t==="diamond"?"kite":t}function $q(t,e,i=null){const r=[],n=e.mapPositions;iut(e,r);const s=r[0][1].data,a=r[0][1].indices.length,u=Uv(a);return rut(e,r,u),out(e,r,u),nut(e,r,u),sut(e,r,u),aut(e,r,u),lut(e,r,u),cut(e,r,s),new Is(t,r,n,Gn.Line,i)}function iut(t,e){const{attributeData:{position:i},removeDuplicateStartEnd:r}=t,n=uut(i)&&r,s=i.length/3-(n?1:0),a=new Array(2*(s-1)),u=n?i.slice(0,-3):i;let p=0;for(let y=0;y<s-1;y++)a[p++]=y,a[p++]=y+1;e.push([X.POSITION,new Et(u,a,3,n)])}function rut(t,e,i){if(t.attributeData.colorFeature!=null)return;const r=t.attributeData.color;e.push([X.COLOR,new Et(r??Bh,i,4)])}function nut(t,e,i){t.attributeData.normal&&e.push([X.NORMAL,new Et(t.attributeData.normal,i,3)])}function sut(t,e,i){t.attributeData.colorFeature!=null&&e.push([X.COLORFEATUREATTRIBUTE,new Et([t.attributeData.colorFeature],i,1,!0)])}function out(t,e,i){t.attributeData.sizeFeature==null&&e.push([X.SIZE,new Et([t.attributeData.size??1],i,1,!0)])}function aut(t,e,i){t.attributeData.sizeFeature!=null&&e.push([X.SIZEFEATUREATTRIBUTE,new Et([t.attributeData.sizeFeature],i,1,!0)])}function lut(t,e,i){t.attributeData.opacityFeature!=null&&e.push([X.OPACITYFEATUREATTRIBUTE,new Et([t.attributeData.opacityFeature],i,1,!0)])}function cut(t,e,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==ht.Global||!t.overlayInfo.spatialReference.isGeographic)return;const r=Ro(i.length),n=Mr(t.overlayInfo.spatialReference);for(let S=0;S<r.length;S+=3)vY(i,S,r,S,n);const s=i.length/3,a=Fn(s+1);let u=hut,p=dut,y=0,b=0;$e(u,r[b++],r[b++],r[b++]),a[0]=0;for(let S=1;S<s+1;++S)S===s&&(b=0),$e(p,r[b++],r[b++],r[b++]),y+=mwe(u,p),a[S]=y,[u,p]=[p,u];e.push([X.DISTANCETOSTART,new Et(a,e[0][1].indices,1,!0)])}function uut(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const hut=H(),dut=H();function rFt(t,e){if(t==null||t.length===0)return[];const i=[];return t.forEach(r=>{const n=r.length,s=Ro(3*n);r.forEach((u,p)=>{s[3*p]=u[0],s[3*p+1]=u[1],s[3*p+2]=u[2]});const a={attributeData:{position:s,normal:e},removeDuplicateStartEnd:!1};i.push(a)}),i}function put(t,e,i,r){const n=t.type==="polygon"?I0.CCW_IS_HOLE:I0.NONE,s=t.type==="polygon"?t.rings:t.paths,{position:a,outlines:u}=MR(s,!!t.hasZ,n,t.spatialReference),p=Ro(a.length),y=KTe(a,t.spatialReference,0,p,0,a,0,a.length/3,e,i,r),b=y!=null;return{lines:b?BCe(u,a,p):[],projectionSuccess:b,sampledElevation:y}}function fut(t,e){const i=t.type==="polygon"?I0.CCW_IS_HOLE:I0.NONE,r=t.type==="polygon"?t.rings:t.paths,{position:n,outlines:s}=MR(r,!1,i),a=Mn(n,t.spatialReference,0,n,e,0,n.length/3);for(let u=2;u<n.length;u+=3)n[u]=FQ;return{lines:a?BCe(s,n):[],projectionSuccess:a}}function BCe(t,e,i=null){const r=new Array;for(const{index:n,count:s}of t){if(s<=1)continue;const a=3*n,u=3*s;r.push({position:Xh(e,3*n,3*s),mapPositions:i!=null?Xh(i,a,u):void 0})}return r}function mut(t){const e=new lr,i=t.multipassEnabled&&(t.output===oe.Color||t.output===oe.Alpha),r=t.space===Ju.World;e.include(GEe,t),e.include(aCe,t),t.output===oe.Depth&&e.include($g,t);const{vertex:n,fragment:s}=e;return s.include(fd),Uc(n,t),e.attributes.add(X.POSITION,"vec3"),e.attributes.add(X.UV0,"vec2"),e.attributes.add(X.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),_v(e),i&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),n.uniforms.add(new Lr("nearFar",(a,u)=>u.camera.nearFar),new er("viewport",(a,u)=>u.camera.fullViewport)),n.code.add(F`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(F`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),r?(e.attributes.add(X.NORMAL,"vec3"),kS(n),n.constants.add("tiltThreshold","float",.7),n.code.add(F`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):n.code.add(F`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),n.code.add(F`
      #define vecN ${r?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${r?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===ow.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===Ju.Screen&&(n.uniforms.add(new On("inverseProjectionMatrix",(a,u)=>u.camera.inverseProjectionMatrix)),n.code.add(F`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),n.code.add(F`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),n.uniforms.add(new lt("perScreenPixelRatio",(a,u)=>u.camera.perScreenPixelRatio)),n.code.add(F`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),SE(n),L7(e),n.code.add(F`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),r?(t.hideOnShortSegments&&n.code.add(F`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),n.code.add(F`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(n.code.add(F`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===Ju.Screen&&n.code.add(F`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),n.code.add(F`
        ${i?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${r?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&e.include(Jc,t),e.include(ss,t),s.uniforms.add(new er("intrinsicColor",a=>a.color),new kt("tex",a=>a.markerTexture)),s.include(G0),e.constants.add("texelSize","float",1/R2),s.code.add(F`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",MQ/R2),e.constants.add("relativeTipLineWidth","float",Iat),s.code.add(F`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${r?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",Wo),s.code.add(F`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${r?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===oe.ObjectAndLayerIdColor?F`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===oe.Alpha?F`fragColor = vec4(finalColor.a);`:""}
    ${t.output===oe.Color?F`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===oe.Color&&t.transparencyPassType===Ut.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===oe.Highlight?F`fragColor = vec4(1.0);`:""}
    ${t.output===oe.Depth?F`outputDepth(linearDepth);`:""}
  }
  `),e}const gut=Object.freeze(Object.defineProperty({__proto__:null,build:mut},Symbol.toStringTag,{value:"Module"})),VCe=new Map([[X.POSITION,0],[X.UV0,1],[X.AUXPOS1,2],[X.NORMAL,3],[X.COLOR,4],[X.COLORFEATUREATTRIBUTE,4],[X.SIZE,5],[X.SIZEFEATUREATTRIBUTE,5],[X.OPACITYFEATUREATTRIBUTE,6]]);let GCe=class HCe extends wr{initializeProgram(e){return new fr(e.rctx,HCe.shader.get().build(this.configuration),VCe)}_makePipelineState(e,i){const r=this.configuration,n=e===Ut.NONE;return mi({blending:r.output===oe.Color||r.output===oe.Alpha?n?Xu:Wg(e):null,depthTest:{func:Vv(e)},depthWrite:n?r.writeDepth?ic:null:eN(e),colorWrite:Oi,stencilWrite:r.hasOccludees?P0:null,stencilTest:r.hasOccludees?i?Cv:Gv:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=mi({blending:Xu,depthTest:d8,depthWrite:null,colorWrite:Oi,stencilWrite:null,stencilTest:bSe}),this._occluderPipelineOpaque=mi({blending:Xu,depthTest:d8,depthWrite:null,colorWrite:Oi,stencilWrite:vSe,stencilTest:_Se}),this._occluderPipelineMaskWrite=mi({blending:null,depthTest:aQ,depthWrite:null,colorWrite:null,stencilWrite:P0,stencilTest:Cv})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};GCe.shader=new pr(gut,()=>ke(()=>import("./LineMarker.glsl-f482474a.js"),[],import.meta.url));let yut=class extends jv{constructor(e){super(e,new _ut),this._vertexAttributeLocations=VCe,this._configuration=new mo,this._layout=this.createLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.space=i.slot===De.DRAPED_MATERIAL?Ju.Draped:this.parameters.worldSpace?Ju.World:Ju.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Jh.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===vn.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=wn().vec3f(X.POSITION).vec2f(X.UV0).vec3f(X.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(X.NORMAL),this.parameters.vvSize?e.f32(X.SIZEFEATUREATTRIBUTE):e.f32(X.SIZE),this.parameters.vvColor?e.f32(X.COLORFEATUREATTRIBUTE):e.vec4f(X.COLOR),this.parameters.vvOpacity&&e.f32(X.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new but(this._layout,this.parameters)}produces(e,i){return i===oe.Color||i===oe.Alpha||i===oe.Highlight||i===oe.Depth?e===De.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===vn.OccludeAndTransparentStencil?e===De.OPAQUE_MATERIAL||e===De.OCCLUDER_MATERIAL||e===De.TRANSPARENT_OCCLUDER_MATERIAL:i===oe.Color||i===oe.Alpha?e===(this.parameters.writeDepth?De.TRANSPARENT_MATERIAL:De.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===De.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new vut(e)}},vut=class extends rK{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const i=this._material.parameters.markerPrimitive;return i!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(i,this._markerPrimitive)}),this._markerPrimitive=i),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(GCe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==oe.Color&&this._output!==oe.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},_ut=class extends wR{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=Jh.BUTT,this.anchor=ow.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},but=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,i,r,n,s){const a=r.attributes.get(X.POSITION).data,u=a.length/3;let p=[1,0,0];const y=r.attributes.get(X.NORMAL);this._parameters.worldSpace&&y!=null&&(p=y.data);let b=1,S=0;this._parameters.vvSize?S=r.attributes.get(X.SIZEFEATUREATTRIBUTE).data[0]:r.attributes.has(X.SIZE)&&(b=r.attributes.get(X.SIZE).data[0]);let C=[1,1,1,1],O=0;this._parameters.vvColor?O=r.attributes.get(X.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(X.COLOR)&&(C=r.attributes.get(X.COLOR).data);let P=0;this._parameters.vvOpacity&&(P=r.attributes.get(X.OPACITYFEATUREATTRIBUTE).data[0]);const $=new Float32Array(n.buffer);let N=s*(this.vertexBufferLayout.stride/4);const z=(q,W,K,se)=>{if($[N++]=q[0],$[N++]=q[1],$[N++]=q[2],$[N++]=K[0],$[N++]=K[1],$[N++]=W[0],$[N++]=W[1],$[N++]=W[2],this._parameters.worldSpace&&($[N++]=p[0],$[N++]=p[1],$[N++]=p[2]),this._parameters.vvSize?$[N++]=S:$[N++]=b,this._parameters.vvColor)$[N++]=O;else{const ae=Math.min(4*se,C.length-4);$[N++]=C[ae],$[N++]=C[ae+1],$[N++]=C[ae+2],$[N++]=C[ae+3]}this._parameters.vvOpacity&&($[N++]=P)};let U;(function(q){q[q.ASCENDING=1]="ASCENDING",q[q.DESCENDING=-1]="DESCENDING"})(U||(U={}));const j=(q,W)=>{const K=$e(wut,a[3*q],a[3*q+1],a[3*q+2]),se=xut;let ae=q+W;do $e(se,a[3*ae],a[3*ae+1],a[3*ae+2]),ae+=W;while(j2(K,se)&&ae>=0&&ae<u);e&&(wt(K,K,e),wt(se,se,e)),z(K,se,[-1,-1],q),z(K,se,[1,-1],q),z(K,se,[1,1],q),z(K,se,[-1,-1],q),z(K,se,[1,1],q),z(K,se,[-1,1],q)},G=this._parameters.placement;G!=="begin"&&G!=="begin-end"||j(0,U.ASCENDING),G!=="end"&&G!=="begin-end"||j(u-1,U.DESCENDING)}};const wut=H(),xut=H(),Ta={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},Tut={dash:Ta.dash,"dash-dot":[...Ta.dash,...Ta.dot],dot:Ta.dot,"long-dash":Ta["long-dash"],"long-dash-dot":[...Ta["long-dash"],...Ta.dot],"long-dash-dot-dot":[...Ta["long-dash"],...Ta.dot,...Ta.dot],none:null,"short-dash":Ta["short-dash"],"short-dash-dot":[...Ta["short-dash"],...Ta["short-dot"]],"short-dash-dot-dot":[...Ta["short-dash"],...Ta["short-dot"],...Ta["short-dot"]],"short-dot":Ta["short-dot"],solid:null},Sut=8;function Eut(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function lFt(t){return{pattern:[t,t],pixelRatio:2}}function qCe(t){return t!=null&&t.type==="style"?Cut(t.style):null}function Cut(t){return t!=null?Eut(Tut[t],Sut):null}const Aut=["polyline","polygon","extent"],Yle=new vR({size:!0,color:!0,rotation:!1,opacity:!0});let WCe=class XCe extends q0{constructor(e,i,r,n){super(e,i,r,n)}async doLoad(){if(this._fastUpdates=BS(this._context.renderer,Yle),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:ed(1))<0)throw new de("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,i=!1){const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const n={width:this._computeMaterialWidth(this.symbolLayer?.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:Iq(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:qCe(this.symbolLayer.pattern)};return this._fastUpdates?.visualVariables?{...n,...this._fastUpdates.materialParameters}:n}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){return this._materials[Kn.Line]==null&&(this._materials[Kn.Line]=new xT(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[Kn.Line])),this._materials[Kn.Line]}get _ringMaterial(){return this._materials[Kn.Ring]==null&&(this._materials[Kn.Ring]=new xT(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[Kn.Ring])),this._materials[Kn.Ring]}get _wireframeLineMaterial(){return this._materials[Kn.LineWireframe]==null&&(this._materials[Kn.LineWireframe]=new xT({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[Kn.LineWireframe])),this._materials[Kn.LineWireframe]}get _wireframeRingMaterial(){return this._materials[Kn.RingWireframe]==null&&(this._materials[Kn.RingWireframe]=new xT({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[Kn.RingWireframe])),this._materials[Kn.RingWireframe]}get _markerMaterial(){return this._materials[Kn.Marker]==null&&this.symbolLayer.marker!=null&&(this._materials[Kn.Marker]=new yut({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:Jle(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[Kn.Marker])),this._materials[Kn.Marker]}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0}_getDrivenSize(e){return this._drivenProperties.size&&e.size?Xo(sot(e.size)):1}_getDrivenColor(e){const i=vi(1,1,1,1);return this._drivenProperties.color&&e.color&&(i[0]=e.color[0],i[1]=e.color[1],i[2]=e.color[2],e.color.length>0&&(i[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(i[3]=e.opacity),i}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Aut,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,i.uid)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables")return _s.RecreateSymbol;{const n=this._fastUpdates;if(!VS(n,i,Yle))return _s.RecreateSymbol;this._forEachMaterial(s=>s?.setParameters(n.materialParameters))}}return _s.FastUpdate}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff,r={};i.size?.type==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),i.cap?.type==="complete"&&(r.cap=Iq(i.cap.newValue??"butt"),delete i.cap);const n=this._prepareMarkerPatch(e,i);this._prepareMaterialPatch(e,i,n),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(s=>s?.setParameters(r)))}layerOpacityChanged(){this._forEachMaterial((e,i)=>this._updateMaterialLayerOpacity(e,i===Kn.Marker))}_forEachMaterial(e){this._materials.forEach(e)}_updateMaterialLayerOpacity(e,i=!1){if(e==null)return;const r=e.parameters.color,n=this.symbolLayer?.material?.color,s=this._patternHidesLine&&!i?0:this._getCombinedOpacity(n),a=vi(r[0],r[1],r[2],s);e.setParameters({color:a})}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=xR(XCe.elevationModeChangeTypes,r,n);if(s!==Hn.UPDATE)return s;const a=hd(n);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>a)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i?.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof rr)return nd.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,i,r){const n=e.graphic,s=this._getGeometryAsPolygonOrPolyline(n.geometry),a=s.type==="polygon"?s.rings:s.paths,u=new Array,p=eo(),y=put(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),b=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(y,a,b,"LineSymbol3DLayer");for(let O=0;O<y.lines.length;O++){const P=y.lines[O],$=P.position,N=P.mapPositions;if(this._context.clippingExtent!=null&&(cn(p),Fu(p,N),!vp(p,this._context.clippingExtent)))continue;const z=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,$,N,s.type,c4.ELEVATED,r);u.push(z),Xr.LINE_WIREFRAMES&&u.push(z.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&u.push(z.instantiate({material:this._markerMaterial}))}if(u.length===0)return null;const S=new Xg({geometries:u,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),C=new H0(this,S,u,null,null,_rt,i);return C.alignedSampledElevation=y.sampledElevation,C.needsElevationUpdates=hd(i.mode),C}_createGeometry(e,i,r,n,s,a,u){const p=a===c4.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,y=s==="polygon",b=this._fastUpdates?.visualVariables.color,S=this._fastUpdates?.visualVariables.size,C=this._fastUpdates?.visualVariables.opacity,O=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:u,layerUid:this._context.layer.uid}),P={position:r,size:S?null:this._getDrivenSize(i.renderingInfo),color:b?null:this._getDrivenColor(i.renderingInfo),sizeFeature:S?Ap(S.field,i.graphic):null,colorFeature:b?Ap(b.field,i.graphic):null,opacityFeature:C?Ap(C.field,i.graphic):null};return $q(e,{overlayInfo:p,removeDuplicateStartEnd:y,mapPositions:n,attributeData:P},O)}_createAsOverlay(e,i){const r=e.graphic,n=this._getGeometryAsPolygonOrPolyline(r.geometry),s=n.type==="polygon"?n.rings:n.paths,a=n.type==="polygon"?this._ringMaterial:this._lineMaterial;a.renderPriority=this._renderPriority;const u=Xr.LINE_WIREFRAMES?n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,p=this._markerMaterial;u!=null&&(u.renderPriority=this._renderPriority-.001),p!=null&&(p.renderPriority=this._renderPriority-.002);const y=new Array,b=eo(),S=cn(),C=fut(n,this._context.overlaySR),O=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(C,s,O,"LineSymbol3DLayer");for(const P of C.lines){if(cn(b),Fu(b,P.position),!vp(b,this._context.clippingExtent))continue;AS(S,b);const $=N=>{const z=this._createGeometry(N,e,P.position,void 0,n.type,c4.DRAPED,r.uid),U=new JS(z,{layerUid:i,graphicUid:r.uid});y.push(U)};if(p!=null){$(p);const N=this.symbolLayer.marker.placement;N!=="begin"&&N!=="begin-end"||Fu(b,P.position,0,1),N!=="end"&&N!=="begin-end"||Fu(b,P.position,P.position.length-3,1)}$(a),Xr.LINE_WIREFRAMES&&$(u)}return new bN(this,y,S,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){return e=e??ed(1),this._drivenProperties.size?this._fastUpdates?.visualVariables.size?Xo(1):1:Xo(e)}_prepareMaterialPatch(e,i,r){const n=i.material;if(n==null)return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._materials[Kn.Marker],e));if(n.type==="collection")return;const s=n.type==="complete"?n.newValue?.color:n.diff.color?.type==="complete"?n.diff.color.newValue:null,a=this._getCombinedOpacityAndColor(s);r.useMaterialColor&&this._patchMaterialColor(aR(a),this._materials[Kn.Marker],e),this._patternHidesLine&&(a[3]=0),this._patchMaterialColor(a,this._materials[Kn.Line],e),delete i.material}_prepareMarkerPatch(e,i){const r=i.marker,n=this._markerMaterial;if(r==null||r.type!=="partial"||r.diff==null||r.diff.placement!=null||r.diff.style!=null&&r.diff.style.type!=="complete"||r.diff.color!=null&&r.diff.color.type!=="complete"||n==null)return{changed:!1,useMaterialColor:this._markerColor==null};const s=r.diff.color,a=s!=null,u=a?s.newValue:null,p=u==null&&this._markerColor==null;u&&this._patchMaterialColor(this._getCombinedOpacityAndColor(u),n,e);const y=r.diff.style?.newValue;return y&&e.symbolLayerStatePatches.push(()=>n.setParameters({markerPrimitive:Jle(y)})),delete i.marker,{changed:a,useMaterialColor:p}}_patchMaterialColor(e,i,r){i!=null&&r.symbolLayerStatePatches.push(()=>i.setParameters({color:e}))}};var c4,Kn;WCe.elevationModeChangeTypes={definedChanged:Hn.RECREATE,staysOnTheGround:Hn.NONE,onTheGroundChanged:Hn.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(c4||(c4={})),function(t){t[t.Line=0]="Line",t[t.Ring=1]="Ring",t[t.LineWireframe=2]="LineWireframe",t[t.RingWireframe=3]="RingWireframe",t[t.Marker=4]="Marker"}(Kn||(Kn={}));function JCe(t,e,i){return Mn(t,e,0,WP,i.spatialReference,0,1)?(i.x=WP[0],i.y=WP[1],i.z=WP[2],i):null}const WP=H();let wC=null,E8=!0;function Sz(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(E8)try{return new ImageData(t,e)}catch{E8=!1}return YCe(t,e,i)}function Out(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(E8)try{return new ImageData(t,e,i)}catch{E8=!1}const n=YCe(e,i,r);return n.data.set(t,0),n}function Rut(){return wC||(wC=document.createElement("canvas"),wC.width=1,wC.height=1),wC}function YCe(t,e,i){return i||(i=Rut()),i.getContext("2d").createImageData(t,e)}async function Mut(t,e){const i=window.URL.createObjectURL(t);try{const{data:r}=await ir(i,{...e,responseType:"image"});return r}catch(r){throw qn(r)?r:new de("invalid-image",`Could not fetch requested image at ${i}`)}finally{window.URL.revokeObjectURL(i)}}async function cFt(t,e){const{arrayBuffer:i,mediaType:r}=await Put(t,e),n=r==="image/png";if(r==="image/gif"){const{isAnimatedGIF:s,parseGif:a}=await ke(()=>import("./gif-361d47ad.js"),[],import.meta.url);if(s(i))return a(i,e)}if(n){const{isAnimatedPNG:s,parseApng:a}=await ke(()=>import("./apng-d50110be.js"),[],import.meta.url);if(s(i))return a(i,e)}return Mut(new Blob([i],{type:r}),e)}async function Put(t,e){const i=sv(t);if(i?.isBase64)return{arrayBuffer:dme(i.data),mediaType:i.mediaType};const r=await ir(t,{responseType:"array-buffer",...e});return{arrayBuffer:r.data,mediaType:r.getHeader("Content-Type")}}var Rx;const Ez=new WeakMap;let Iut=0,Lf=Rx=class extends Ne{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,i,r){if(t instanceof HTMLImageElement){const n={type:"image-element",src:H2(t.src,r),crossOrigin:t.crossOrigin};e[i]=n}else if(t instanceof HTMLCanvasElement){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),s={type:"canvas-element",imageData:this._encodeImageData(n)};e[i]=s}else if(t instanceof HTMLVideoElement){const n={type:"video-element",src:H2(t.src,r),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[i]=n}else if(t instanceof ImageData){const n={type:"image-data",imageData:this._encodeImageData(t)};e[i]=n}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(e,0,0),i}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const i=e.substr(e.length-4,4).toLowerCase(),r=e.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(i="")=>`d:${i},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(Ez.has(this.data)||Ez.set(this.data,++Iut),e(Ez.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new Rx(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const i=this.clone();return t.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let i=0;i<t.data.length;i++)e+=String.fromCharCode(t.data[i]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),i=new Uint8ClampedArray(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return Out(i,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new Rx({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new Rx({data:t}):L2(Rx,t)}};_([T({type:String,json:{write:Eg}})],Lf.prototype,"url",null),_([T({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),T()],Lf.prototype,"data",null),_([ot("data")],Lf.prototype,"writeData",null),_([rt("data")],Lf.prototype,"readData",null),_([T({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Lf.prototype,"transparent",null),_([T({json:{write:!0}})],Lf.prototype,"wrap",void 0),_([T({readOnly:!0})],Lf.prototype,"contentHash",null),Lf=Rx=_([Z("esri.geometry.support.MeshTexture")],Lf);const u4=Lf;let Mx=class extends sn(Ne){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};_([T({type:[Number],nonNullable:!0,json:{write:!0}})],Mx.prototype,"offset",void 0),_([T({type:Number,nonNullable:!0,json:{write:!0}})],Mx.prototype,"rotation",void 0),_([T({type:[Number],nonNullable:!0,json:{write:!0}})],Mx.prototype,"scale",void 0),Mx=_([Z("esri.geometry.support.MeshTextureTransform")],Mx);const XT=Mx;var Lq;let jd=Lq=class extends Ne{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new Lq(this.clonePropertiesWithDeduplication(e));return t?.set(this,r),r}clonePropertiesWithDeduplication(t){return{color:this.color!=null?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(t),normalTexture:this.normalTexture?.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};_([T({type:mt,json:{write:!0}})],jd.prototype,"color",void 0),_([T({type:u4,json:{write:!0}})],jd.prototype,"colorTexture",void 0),_([T({type:XT,json:{write:!0}})],jd.prototype,"colorTextureTransform",void 0),_([T({type:u4,json:{write:!0}})],jd.prototype,"normalTexture",void 0),_([T({type:XT,json:{write:!0}})],jd.prototype,"normalTextureTransform",void 0),_([T({nonNullable:!0,json:{write:!0}})],jd.prototype,"alphaMode",void 0),_([T({nonNullable:!0,json:{write:!0}})],jd.prototype,"alphaCutoff",void 0),_([T({nonNullable:!0,json:{write:!0}})],jd.prototype,"doubleSided",void 0),jd=Lq=_([Z("esri.geometry.support.MeshMaterial")],jd);const HQ=jd;var Dq;let wh=Dq=class extends HQ{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new Dq(this.clonePropertiesWithDeduplication(e));return t?.set(this,r),r}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(t),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(t),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(t),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};_([T({type:mt,json:{write:!0}})],wh.prototype,"emissiveColor",void 0),_([T({type:u4,json:{write:!0}})],wh.prototype,"emissiveTexture",void 0),_([T({type:XT,json:{write:!0}})],wh.prototype,"emissiveTextureTransform",void 0),_([T({type:u4,json:{write:!0}})],wh.prototype,"occlusionTexture",void 0),_([T({type:XT,json:{write:!0}})],wh.prototype,"occlusionTextureTransform",void 0),_([T({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],wh.prototype,"metallic",void 0),_([T({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],wh.prototype,"roughness",void 0),_([T({type:u4,json:{write:!0}})],wh.prototype,"metallicRoughnessTexture",void 0),_([T({type:XT,json:{write:!0}})],wh.prototype,"metallicRoughnessTextureTransform",void 0),wh=Dq=_([Z("esri.geometry.support.MeshMaterialMetallicRoughness")],wh);const ZCe=wh;var N$;const KCe="esri.geometry.support.MeshVertexAttributes",O3=Ee.getLogger(KCe);let uh=N$=class extends Ne{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return Px(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},O3)}castPosition(t){return t&&t instanceof Float32Array&&O3.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),Px(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},O3)}castUv(t){return Px(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},O3)}castNormal(t){return Px(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},O3)}castTangent(t){return Px(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},O3)}clone(){const t={position:Ce(this.position),uv:Ce(this.uv),normal:Ce(this.normal),tangent:Ce(this.tangent),color:Ce(this.color)};return new N$(t)}clonePositional(){const t={position:Ce(this.position),normal:Ce(this.normal),tangent:Ce(this.tangent),uv:this.uv,color:this.color};return new N$(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function Cz(t,e,i,r){const{loggerTag:n,stride:s}=e;return t.length%s!=0?(r.error(n,`Invalid array length, expected a multiple of ${s}`),new i([])):t}function Px(t,e,i,r,n){if(!t)return t;if(t instanceof e)return Cz(t,r,e,n);for(const s of i)if(t instanceof s)return Cz(new e(t),r,e,n);if(Array.isArray(t))return Cz(new e(t),r,e,n);{const s=i.map(a=>`'${a.name}'`);return n.error(`Failed to set property, expected one of ${s}, but got ${t.constructor.name}`),new e([])}}function xC(t,e,i){e[i]=$ut(t)}function $ut(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i];return e}_([T({json:{write:xC}})],uh.prototype,"color",void 0),_([Fi("color")],uh.prototype,"castColor",null),_([T({nonNullable:!0,json:{write:xC}})],uh.prototype,"position",void 0),_([Fi("position")],uh.prototype,"castPosition",null),_([T({json:{write:xC}})],uh.prototype,"uv",void 0),_([Fi("uv")],uh.prototype,"castUv",null),_([T({json:{write:xC}})],uh.prototype,"normal",void 0),_([Fi("normal")],uh.prototype,"castNormal",null),_([T({json:{write:xC}})],uh.prototype,"tangent",void 0),_([Fi("tangent")],uh.prototype,"castTangent",null),uh=N$=_([Z(KCe)],uh);var J5;const QCe="esri.geometry.support.MeshComponent",Lut=Ee.getLogger(QCe);let Df=J5=class extends Ne{static from(t){return L2(J5,t)}constructor(t){super(t),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return Px(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},Lut)}castMaterial(t){return L2(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?ZCe:HQ,t)}clone(){return new J5({faces:Ce(this.faces),shading:this.shading,material:Ce(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(t,e){const i={faces:Ce(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new J5(i)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};_([T({json:{write:!0}})],Df.prototype,"faces",void 0),_([Fi("faces")],Df.prototype,"castFaces",null),_([T({type:HQ,json:{write:!0}})],Df.prototype,"material",void 0),_([Fi("material")],Df.prototype,"castMaterial",null),_([T()],Df.prototype,"name",void 0),_([T({type:String,json:{write:!0}})],Df.prototype,"shading",void 0),_([T({type:Boolean})],Df.prototype,"trustSourceNormals",void 0),Df=J5=_([Z(QCe)],Df);const Dut=Df;let Y5=class extends sn(Ne){constructor(e){super(e),this.type="georeferenced-relative",this.isRelative=!0,this.isGeoreferenced=!0,this.origin=H()}getOriginPoint(e){const[i,r,n]=this.origin;return new Wt({x:i,y:r,z:n,spatialReference:e})}setOriginFromPoint({x:e,y:i,z:r}){this.origin=st(e,i,r??0)}};_([Bt({georeferencedRelative:"georeferenced-relative"},{readOnly:!0})],Y5.prototype,"type",void 0),_([T({type:[Number],nonNullable:!0,json:{write:!0}})],Y5.prototype,"origin",void 0),Y5=_([Z("esri.geometry.support.MeshGeoreferencedRelativeVertexSpace")],Y5);const Nut=Y5;let F$=class extends sn(Ne){constructor(){super({}),this.type="georeferenced",this.isRelative=!1,this.isGeoreferenced=!0}};_([Bt({georeferenced:"georeferenced"},{readOnly:!0})],F$.prototype,"type",void 0),F$=_([Z("esri.geometry.support.MeshGeoreferencedVertexSpace")],F$);const Fut=F$;let Z5=class extends sn(Ne){constructor(e){super(e),this.type="local",this.isRelative=!0,this.isGeoreferenced=!1,this.origin=H()}getOriginPoint(e){const[i,r,n]=this.origin;return new Wt({x:i,y:r,z:n,spatialReference:e})}setOriginFromPoint({x:e,y:i,z:r}){this.origin=st(e,i,r??0)}};_([Bt({local:"local"},{readOnly:!0})],Z5.prototype,"type",void 0),_([T({type:[Number],nonNullable:!0,json:{write:!0}})],Z5.prototype,"origin",void 0),Z5=_([Z("esri.geometry.support.MeshLocalVertexSpace")],Z5);const kut=Z5;var Nq;let Nf=Nq=class extends Ne{constructor(t){super(t),this.translation=H(),this.rotationAxis=Ma(Hwe),this.rotationAngle=0,this.scale=st(1,1,1)}get rotation(){return g$(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=An(t),this.rotationAngle=xJe(t)}get localMatrix(){const t=Ze();return K4(Zle,this.rotation,WG(this.rotation)),$ge(t,Zle,this.translation,this.scale),t}get localMatrixInverse(){return Ps(Ze(),this.localMatrix)}applyLocal(t,e){return wt(e,t,this.localMatrix)}applyLocalInverse(t,e){return wt(e,t,this.localMatrixInverse)}equals(t){return this===t||t!=null&&tY(this.localMatrix,t.localMatrix)}clone(){const t={translation:An(this.translation),rotationAxis:An(this.rotationAxis),rotationAngle:this.rotationAngle,scale:An(this.scale)};return new Nq(t)}};_([T({type:[Number],nonNullable:!0,json:{write:!0}})],Nf.prototype,"translation",void 0),_([T({type:[Number],nonNullable:!0,json:{write:!0}})],Nf.prototype,"rotationAxis",void 0),_([T({type:Number,nonNullable:!0,json:{write:!0}})],Nf.prototype,"rotationAngle",void 0),_([T({type:[Number],nonNullable:!0,json:{write:!0}})],Nf.prototype,"scale",void 0),_([T()],Nf.prototype,"rotation",null),_([T()],Nf.prototype,"localMatrix",null),_([T()],Nf.prototype,"localMatrixInverse",null),Nf=Nq=_([Z("esri.geometry.support.MeshTransform")],Nf);const Zle=pd(),zut=Nf;function e5e(t,e){return t.isGeographic||t.isWebMercator&&(e?.geographic??!0)}function fFt(t,e,i){const r=!t.isGeoreferenced;i?.geographic!=null&&i.geographic!==r&&Ee.getLogger(e).warnOnce(`Specifying the 'geographic' parameter (${i.geographic}) for a Mesh vertex space of type "${t.type}" is not supported. This parameter will be ignored.`)}const wN=Ee.getLogger("esri.geometry.support.meshUtils.normalProjection");function t5e(t,e,i,r,n){return TN(r)?(xN(yg.TO_PCPF,lo.fromTypedArray(t),ud.fromTypedArray(e),ud.fromTypedArray(i),r,lo.fromTypedArray(n)),n):(wN.error("Cannot convert spatial reference to PCPF"),n)}function Uut(t,e,i,r,n){return TN(r)?(xN(yg.FROM_PCPF,lo.fromTypedArray(t),ud.fromTypedArray(e),ud.fromTypedArray(i),r,lo.fromTypedArray(n)),n):(wN.error("Cannot convert to spatial reference from PCPF"),n)}function jut(t,e,i){return Mn(t,e,0,i,wE(e),0,t.length/3),i}function But(t,e,i){return Mn(t,wE(i),0,e,i,0,t.length/3),e}function i5e(t,e,i){return Rg(wo,i),Vp(e,t,wo),PZ(wo)||mN(e,e),e}function r5e(t,e,i){if(Rg(wo,i),Vp(e,t,wo,4),PZ(wo)||mN(e,e,4),t!==e)for(let r=3;r<t.length;r+=4)e[r]=t[r];return e}function n5e(t,e,i,r,n){if(!TN(r))return wN.error("Cannot convert spatial reference to PCPF"),n;xN(yg.TO_PCPF,lo.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),ud.fromTypedArray(e),ud.fromTypedArray(i),r,lo.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function Vut(t,e,i,r,n){if(!TN(r))return wN.error("Cannot convert to spatial reference from PCPF"),n;xN(yg.FROM_PCPF,lo.fromTypedArray(t,16),ud.fromTypedArray(e),ud.fromTypedArray(i),r,lo.fromTypedArray(n,16));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function xN(t,e,i,r,n,s){if(!e)return;const a=i.count,u=wE(n);if(s5e(n))for(let p=0;p<a;p++)r.getVec(p,XP),e.getVec(p,cf),jc(u,XP,JP,u),sd(wo,JP),t===yg.FROM_PCPF&&od(wo,wo),Lc(cf,cf,wo),s.setVec(p,cf);else for(let p=0;p<a;p++){r.getVec(p,XP),e.getVec(p,cf),jc(u,XP,JP,u),sd(wo,JP);const y=Z6(i.get(p,1));let b=Math.cos(y);t===yg.TO_PCPF&&(b=1/b),wo[0]*=b,wo[1]*=b,wo[2]*=b,wo[3]*=b,wo[4]*=b,wo[5]*=b,t===yg.FROM_PCPF&&od(wo,wo),Lc(cf,cf,wo),We(cf,cf),s.setVec(p,cf)}return s}function TN(t){return s5e(t)||Gut(t)}function s5e(t){return t.isWGS84||kme(t)||L0(t)||D0(t)}function Gut(t){return t.isWebMercator}var yg;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(yg||(yg={}));const XP=H(),cf=H(),JP=Ze(),wo=Pn();function qQ(t,e,i){return e5e(e.spatialReference,i)?Xut(t,e,i):Wut(t,e,i)}function o5e(t,e=Cn){const{position:i,normal:r,tangent:n}=t;return{position:Bp(new Float64Array(i.length),i,e),normal:r!=null?i5e(r,new Float32Array(r.length),e):null,tangent:n!=null?r5e(n,new Float32Array(n.length),e):null}}function a5e(t,e,i,r){const{position:n,normal:s,tangent:a}=t;return e.isRelative?qQ(o5e(t,i?.localMatrix),e.getOriginPoint(r),{geographic:!e.isGeoreferenced}):{position:n,normal:s,tangent:a}}function Hut(t,e,i){if(i?.useTransform){const{position:r,normal:n,tangent:s}=t,{x:a,y:u,z:p}=e,y=st(a,u,p??0);return{vertexAttributes:{position:r,normal:n,tangent:s},vertexSpace:i.geographic??1?new kut({origin:y}):new Nut({origin:y}),transform:new zut}}return{vertexAttributes:qQ(t,e,i),vertexSpace:new Fut,transform:null}}function Fq(t,e,i){return e5e(e.spatialReference,i)?Kut(t,e,i):c5e(t,e,i)}function qut(t,e,i,r,n){if(!e.isRelative)return Fq(t,r,n);const{spatialReference:s}=r,a=a5e(t,e,i,s);return r.equals(e.getOriginPoint(s))?c5e(a,r,n):Fq(a,r,n)}function l5e({positions:t,transform:e,vertexSpace:i,inSpatialReference:r,outSpatialReference:n,outPositions:s,localMode:a}){const u=i.isRelative?i.origin:Mo,p=i.isRelative?e?.localMatrix??Cn:Cn;if(i.isGeoreferenced){const C=s??Ro(t.length);if(zD(p,Cn)?zYe(C,t):Bp(C,t,p),!pa(u,Mo)){const[O,P,$]=u;for(let N=0;N<C.length;N+=3)C[N]+=O,C[N+1]+=P,C[N+2]+=$}return Mn(C,r,0,C,n,0,C.length/3),C}let y=r;const b=wE(r);y=n.isWebMercator&&a||!$p(r,b)?y:b,jc(r,u,c2,y),Rr(c2,c2,p);const S=s??Ro(t.length);return Bp(S,t,c2),Mn(S,y,0,S,n,0,S.length/3),S}function Wut(t,e,i){const r=new Float64Array(t.position.length),n=t.position,s=e.x,a=e.y,u=e.z??0,p=WQ(i?i.unit:null,e.spatialReference);for(let y=0;y<n.length;y+=3)r[y]=n[y]*p+s,r[y+1]=n[y+1]*p+a,r[y+2]=n[y+2]*p+u;return{position:r,normal:t.normal,tangent:t.tangent}}function Xut(t,e,i){const r=e.spatialReference,n=u5e(e,i,c2),s=new Float64Array(t.position.length),a=Jut(t.position,n,r,s),u=Rg(h5e,n);return{position:a,normal:Yut(a,s,t.normal,u,r),tangent:Zut(a,s,t.tangent,u,r)}}function Jut(t,e,i,r){Bp(r,t,e);const n=new Float64Array(t.length);return But(r,n,i)}function Yut(t,e,i,r,n){if(i==null)return null;const s=new Float32Array(i.length);return Vp(s,i,r),Uut(s,t,e,n,s),s}function Zut(t,e,i,r,n){if(i==null)return null;const s=new Float32Array(i.length);Vp(s,i,r,4);for(let a=3;a<s.length;a+=4)s[a]=i[a];return Vut(s,t,e,n,s),s}function c5e(t,e,i){const r=new Float64Array(t.position.length),n=t.position,s=e.x,a=e.y,u=e.z??0,p=WQ(i?i.unit:null,e.spatialReference);for(let y=0;y<n.length;y+=3)r[y]=(n[y]-s)/p,r[y+1]=(n[y+1]-a)/p,r[y+2]=(n[y+2]-u)/p;return{position:r,normal:t.normal,tangent:t.tangent}}function Kut(t,e,i){const r=e.spatialReference;u5e(e,i,c2);const n=Ps(iht,c2),s=new Float64Array(t.position.length),a=Qut(t.position,r,n,s),u=Rg(h5e,n);return{position:a,normal:eht(t.normal,t.position,s,r,u),tangent:tht(t.tangent,t.position,s,r,u)}}function u5e(t,e,i){jc(t.spatialReference,[t.x,t.y,t.z??0],i,wE(t.spatialReference));const r=WQ(e?e.unit:null,t.spatialReference);return JO(i,i,[r,r,r]),i}function Qut(t,e,i,r){const n=jut(t,e,r),s=new Float64Array(n.length);return Bp(s,n,i),s}function eht(t,e,i,r,n){if(t==null)return null;const s=t5e(t,e,i,r,new Float32Array(t.length));return Vp(s,s,n),s}function tht(t,e,i,r,n){if(t==null)return null;const s=n5e(t,e,i,r,new Float32Array(t.length));return Vp(s,s,n,4),s}function WQ(t,e){if(t==null)return 1;const i=Hj(e);return 1/Go(i,"meters",t)}const c2=Ze(),iht=Ze(),h5e=Pn(),mFt=Object.freeze(Object.defineProperty({__proto__:null,applyTransform:o5e,georeference:qQ,georeferenceApplyTransform:a5e,georeferenceByTransform:Hut,project:l5e,ungeoreference:Fq,ungeoreferenceByTransform:qut},Symbol.toStringTag,{value:"Module"}));var h4;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(h4||(h4={}));let d5e=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=hg.KTX2_ENCODING}};function d4(t){return t?.type==="encoded-mesh-texture"}async function rht(t){const e=new Blob([t]),i=await e.text();return JSON.parse(i)}async function nht(t,e){if(e===hg.KTX2_ENCODING)return new d5e(t);const i=new Blob([t],{type:e}),r=URL.createObjectURL(i),n=new Image;if(Me("esri-iPhone"))return new Promise((s,a)=>{const u=()=>{y(),s(n)},p=b=>{y(),a(b)},y=()=>{URL.revokeObjectURL(r),n.removeEventListener("load",u),n.removeEventListener("error",p)};n.addEventListener("load",u),n.addEventListener("error",p),n.src=r});try{n.src=r,await n.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(r),n}function s0(t){if(t==null)return null;const e=t.offset!=null?t.offset:YSe,i=t.rotation!=null?t.rotation:0,r=t.scale!=null?t.scale:ZSe,n=M$(1,0,0,0,1,0,e[0],e[1],1),s=M$(Math.cos(i),-Math.sin(i),0,Math.sin(i),Math.cos(i),0,0,0,1),a=M$(r[0],0,0,0,r[1],0,0,0,1),u=za();return IS(u,s,a),IS(u,n,u),u}let sht=class extends H0{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(e,i){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:r}=this,n=r.geometries.slice();r.removeAllGeometries();const s=nL(Az,r.transformation),a=i.getOrigin(s);for(const u of n){const p=e(u.material),y=u.instantiate({material:p});y.localOrigin=a,r.addGeometry(y)}this._originalGeometries=n}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:i}=this,r=i.geometries.map(n=>e(n.material));i.removeAllGeometries();for(let n=0;n<this._originalGeometries.length;n++){const s=this._originalGeometries[n],a=r[n];a.setParameters({modelTransformation:null}),a===s.material?i.addGeometry(s):i.addGeometry(s.instantiate({material:a}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,i,r){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:n}=this;if(n.geometries.length===0)return;const s=n.geometries[0].localOrigin,a=nL(Az,e),u=r.getOrigin(a);if(u===s)return;const p=i?.localMatrix??Cn;n.shaderTransformation=null,n.transformation=e,n.geometries.forEach(y=>{y.transformation=p,y.localOrigin=u})}updateTransform(e,i,r){const{stageObject:n}=this,s=i?.localMatrix??Cn;if(!this._fastTransformUpdatesEnabled)return n.shaderTransformation=null,n.transformation=e,n.geometries.forEach(O=>{O.transformation=s}),void(this._fastUpdateEdgeTransform()||this.resetEdgeObject(r));const a=n.transformation,u=n.geometries[0].transformation,p=e,y=s,b=Rr(Kle,a,u),S=Rr(Qle,p,y),C=Rr(ece,S,Ps(ece,u));n.shaderTransformation=C,this._setFastMaterialTransformation({matA:b,matB:S}),this._fastUpdateEdgeTransform()||this.resetEdgeObject(r)}alignWithElevation(e,i,r,n){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,i,r,n);r!=null&&oN(this.elevationContext.featureExpressionInfoContext,r);const s=(P,$)=>Sv(P,e,this.elevationContext,i,$),{stageObject:a}=this;if(!a.geometries[0].material.parameters.modelTransformation)return;const u=a.transformation,p=a.geometries[0].transformation,y=Rr(Kle,u,p),b=a.effectiveTransformation,S=bs(oht,b);this.alignedSampledElevation=C2(this,this.elevationContext,e.spatialReference,s,i,S),a.shaderTransformation=S;const C=a.geometries[0].transformation,O=Rr(Qle,S,C);this._setFastMaterialTransformation({matA:y,matB:O}),this._fastUpdateEdgeTransform()||this.resetEdgeObject(n)}_setFastMaterialTransformation({matA:e,matB:i}){const{stageObject:r}=this;if(r.geometries.length===0)return;const n=r.geometries[0].localOrigin,s=YO(aht,Pe(Az,n.vec3,-1)),a=Rr(tce,s,e),u=Rr(ice,s,i),p=Ps(tce,a),y=Rr(ice,u,p);for(const b of r.geometries)b.material.setParameters({modelTransformation:y})}_fastUpdateEdgeTransform(){return this._stageLayer.stage.renderer.ensureEdgeView().fastUpdateObject3DEdgesTransform(this.stageObject)}};const Az=H(),Kle=Ze(),Qle=Ze(),oht=Ze(),ece=Ze(),tce=Ze(),ice=Ze(),aht=Ze();let lht=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,i,r){e.enableFastTransformUpdates(n=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(n))return n;const a=i.byMaterial(n);return this._fastTransformOriginalMaterials.set(n,a),i.delete(n),n}const s=new Up(n.parameters);return r.stage.add(s),this._fastTransformClonedMaterials.set(s,n),s},r.localOriginFactory)}disable(e,i,r){const n=new Set,s=new Set;e.disableFastTransformUpdates(a=>{if(!this._fastTransformClonedMaterials.has(a)){const y=a,b=this._fastTransformOriginalMaterials.get(y);return i.has(b.uid)?(n.add(y),i.byUid(b.uid).material):(s.add(y),b.material)}const u=a,p=this._fastTransformClonedMaterials.get(u);return this._fastTransformClonedMaterials.delete(u),r.stage.remove(u),p});for(const a of n)this._fastTransformOriginalMaterials.delete(a),r.stage.remove(a);for(const a of s){const u=this._fastTransformOriginalMaterials.get(a);this._fastTransformOriginalMaterials.delete(a),i.set(u.uid,u)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,i,r){this._graphicReferenceCount--,this.disable(e,i,r)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:i})=>i)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},cht=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,i){this._byUid.set(e,i),this._byMaterial.set(i.material,i)}delete(e){const i=this._byMaterial.get(e)?.uid;i&&(this._byUid.delete(i),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};function uht(t){const e=new lr,{vertex:i,fragment:r}=e;return e.include(Zl,t),e.include(Dw,t),Uc(i,t),e.attributes.add(X.POSITION,"vec3"),e.varyings.add("vpos","vec3"),i.code.add(F`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`),t.output===oe.Highlight&&e.include(Bv,t),e.include(ss,t),r.uniforms.add(new lt("alphaCoverage",(n,s)=>Math.min(1,n.width*s.camera.pixelRatio))),t.hasVertexColors||r.uniforms.add(new er("constantColor",n=>n.color)),r.code.add(F`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    ${t.output===oe.ObjectAndLayerIdColor?F`color.a = 1.0;`:""}

    if (color.a < ${F.float(Wo)}) {
      discard;
    }

    ${t.output===oe.Color?F`fragColor = highlightSlice(color, vpos);`:""}
    ${t.output===oe.Highlight?F`outputHighlight();`:""}
  }
  `),e}const hht=Object.freeze(Object.defineProperty({__proto__:null,build:uht},Symbol.toStringTag,{value:"Module"}));let p5e=class f5e extends wr{initializeProgram(e){return new fr(e.rctx,f5e.shader.get().build(this.configuration),ar)}initializePipeline(){const e=this.configuration,i=Zo(et.SRC_ALPHA,et.ONE,et.ONE_MINUS_SRC_ALPHA,et.ONE_MINUS_SRC_ALPHA),r=(n,s=null,a=null)=>mi({blending:s,depthTest:aQ,depthWrite:a,colorWrite:Oi,stencilWrite:e.hasOccludees?P0:null,stencilTest:e.hasOccludees?n?Cv:Gv:null});return e.output===oe.Color?(this._occludeePipelineState=r(!0,e.transparent?i:null,ic),r(!1,e.transparent?i:null,ic)):r(!1)}get primitiveType(){return Hi.LINES}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};p5e.shader=new pr(hht,()=>ke(()=>import("./NativeLine.glsl-7d627ebc.js"),[],import.meta.url));let Ix=class extends _l{constructor(){super(...arguments),this.output=oe.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}};_([ce({count:oe.COUNT})],Ix.prototype,"output",void 0),_([ce()],Ix.prototype,"hasSlicePlane",void 0),_([ce()],Ix.prototype,"hasVertexColors",void 0),_([ce()],Ix.prototype,"transparent",void 0),_([ce()],Ix.prototype,"hasOccludees",void 0);let rce=class extends jv{constructor(e){super(e,new pht),this._configuration=new Ix}getConfiguration(e){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}intersect(e,i,r,n,s,a){if(!r.options.selectionMode||!e.visible)return;if(!gwe(i))return void Ee.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const u=e.attributes.get(X.POSITION).data,p=r.camera,y=mht;$s(y,r.point);const b=2;$e(TC[0],y[0]-b,y[1]+b,0),$e(TC[1],y[0]+b,y[1]+b,0),$e(TC[2],y[0]+b,y[1]-b,0),$e(TC[3],y[0]-b,y[1]-b,0);for(let $=0;$<4;$++)if(!p.unprojectFromRenderScreen(TC[$],sm[$]))return;La(p.eye,sm[0],sm[1],Oz),La(p.eye,sm[1],sm[2],Rz),La(p.eye,sm[2],sm[3],Mz),La(p.eye,sm[3],sm[0],Pz);let S=Number.MAX_VALUE,C=0;for(let $=0;$<u.length-5;$+=3){if(Ml[0]=u[$]+i[12],Ml[1]=u[$+1]+i[13],Ml[2]=u[$+2]+i[14],Pl[0]=u[$+3]+i[12],Pl[1]=u[$+4]+i[13],Pl[2]=u[$+5]+i[14],qr(Oz,Ml)<0&&qr(Oz,Pl)<0||qr(Rz,Ml)<0&&qr(Rz,Pl)<0||qr(Mz,Ml)<0&&qr(Mz,Pl)<0||qr(Pz,Ml)<0&&qr(Pz,Pl)<0)continue;if(p.projectToRenderScreen(Ml,p_),p.projectToRenderScreen(Pl,f_),p_[2]<0&&f_[2]>0){Be(uf,Ml,Pl);const z=p.frustum,U=-qr(z[en.NEAR],Ml)/He(uf,z[en.NEAR]);Pe(uf,uf,U),Ue(Ml,Ml,uf),p.projectToRenderScreen(Ml,p_)}else if(p_[2]>0&&f_[2]<0){Be(uf,Pl,Ml);const z=p.frustum,U=-qr(z[en.NEAR],Pl)/He(uf,z[en.NEAR]);Pe(uf,uf,U),Ue(Pl,Pl,uf),p.projectToRenderScreen(Pl,f_)}else if(p_[2]<0&&f_[2]<0)continue;p_[2]=0,f_[2]=0;const N=hZ(w2(p_,f_,oce),y);N<S&&(S=N,Ie(nce,Ml),Ie(sce,Pl),C=$/3)}const O=r.rayBegin,P=r.rayEnd;if(S<b*b){let $=Number.MAX_VALUE;if(X_e(w2(nce,sce,oce),w2(O,P,fht),d_)){Be(d_,d_,O);const N=Qe(d_);Pe(d_,d_,1/N),$=N/un(O,P)}a($,d_,C,!1)}}intersectDraped(e,i,r,n,s,a){if(!r.options.selectionMode)return;const u=e.attributes.get(X.POSITION).data,p=e.attributes.get(X.SIZE),y=p?p.data[0]:0,b=n[0],S=n[1],C=((y+1)/2+4)*e.screenToWorldRatio;let O=Number.MAX_VALUE,P=0;for(let $=0;$<u.length-5;$+=3){const N=u[$],z=u[$+1],U=b-N,j=S-z,G=u[$+3]-N,q=u[$+4]-z,W=Je((G*U+q*j)/(G*G+q*q),0,1),K=G*W-U,se=q*W-j,ae=K*K+se*se;ae<O&&(O=ae,P=$/3)}O<C*C&&s(a.dist,a.normal,P,!1)}produces(e,i){return!(i!==oe.Color&&i!==oe.Highlight&&i!==oe.ObjectAndLayerIdColor||e!==De.OPAQUE_MATERIAL&&e!==De.DRAPED_MATERIAL)}createGLMaterial(e){return new dht(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?nlt:ilt;return new ME(e)}},dht=class extends zv{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===oe.Color&&this._updateOccludeeState(e),this.ensureTechnique(p5e,e)}},pht=class extends JK{constructor(){super(...arguments),this.color=Bh,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.hasOccludees=!1}};const Ml=H(),Pl=H(),uf=H(),d_=H(),p_=fa(),f_=fa(),nce=H(),sce=H(),oce=Gp(),fht=Gp(),mht=H(),TC=[fa(),fa(),fa(),fa()],sm=[H(),H(),H(),H()],Oz=gr(),Rz=gr(),Mz=gr(),Pz=gr(),ght=["mesh"];class yht extends q0{constructor(e,i,r,n){super(e,i,r,n),this._materialInfoCache=new cht,this._fastUpdateProcessor=new lht,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Xr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new rce({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new rce({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach(e=>e.unload()),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,ght,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i),n=e.renderingInfo;return this._createAs3DShape(i,n,r,i.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,i){const r=this._getLayerOpacity();this._updateMaterialParameters(n=>{n.material.setParameters({layerOpacity:r});const s=n.material.parameters;this._setMaterialTransparentParameter(s,n),n.material.setParameters({transparent:s.transparent})}),e.forEach(n=>i(n)?.layerOpacityChanged(r,this._context.isAsync))}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Ev)}slicePlaneEnabledChanged(e,i){return this._updateMaterialParameters(({material:r})=>{r.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(r=>i(r)?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:i})=>i.setParameters({usePBR:e})),!0}updateTransform(e,i,r,n){const s=this._context.renderCoordsHelper.spatialReference,a=vht,{origin:u,transform:p}=r;switch(jc(i,$e(ho,u.x,u.y,u.z??0),a,s),n){case h4.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case h4.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case h4.UpdateFastLocalOrigin:e.updateFastLocalOrigin(a,p,this._context.localOriginFactory)}const{elevationContext:y}=e;y.centerPointInElevationSR=this._getCenterPointInElevationSR(a);const{elevationProvider:b,renderCoordsHelper:S}=this._context,C=(O,P)=>Sv(O,b,y,S,P);return e.alignedSampledElevation=C2(e,y,b.spatialReference,C,S,a),e.updateTransform(a,p,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof mt?e.toHex():e.contentHash}_materialPropertiesDefault(e,i){const r=this._requiresSymbolVertexColors(),n=!!e.vertexAttributes.color,s=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:n,hasVertexTangents:s,uid:`vc:${n},vt:${s},vct${i},svc:${r}`}}_textureTransformUid(e){const{offset:i,scale:r,rotation:n}=e??bht;return`${i[0]},${i[1]},${n},${r[0]},${r[1]}`}_materialProperties(e,i,r){const n=this._materialPropertiesDefault(e,r);if(!i.material)return n;const{color:s,colorTexture:a,colorTextureTransform:u,normalTexture:p,normalTextureTransform:y,doubleSided:b,alphaCutoff:S,alphaMode:C}=i.material,O=this._colorOrTextureUid(s),P=this._colorOrTextureUid(a),$=this._textureTransformUid(u),N=this._colorOrTextureUid(p),z=this._textureTransformUid(y);if(n.color=s,n.colorTexture=a,n.normalTexture=p,n.uid=`${n.uid},cmuid:${O},ctmuid:${P},cttuid:${$},ntmuid:${N},nttuid:${z},ds:${b},ac:${S},am:${C}`,i.material instanceof ZCe){const{metallic:U,roughness:j,metallicRoughnessTexture:G,metallicRoughnessTextureTransform:q,emissiveColor:W,emissiveTexture:K,emissiveTextureTransform:se,occlusionTexture:ae,occlusionTextureTransform:le}=i.material,me=this._colorOrTextureUid(G),ne=this._textureTransformUid(q),pe=this._colorOrTextureUid(W),ge=this._colorOrTextureUid(K),ve=this._textureTransformUid(se),Se=this._colorOrTextureUid(ae),ee=this._textureTransformUid(le);n.metallic=U,n.roughness=j,n.metallicRoughnessTexture=G,n.emissiveColor=W,n.emissiveTexture=K,n.occlusionTexture=ae,n.colorTextureTransform=this._convertTextureTransform(u),n.normalTextureTransform=this._convertTextureTransform(y),n.emissiveTextureTransform=this._convertTextureTransform(se),n.occlusionTextureTransform=this._convertTextureTransform(le),n.metallicRoughnessTextureTransform=this._convertTextureTransform(q),n.uid=`${n.uid},mrm:${U},mrr:${j},mrt:${me},mrtt:${ne},emuid:${pe},etmuid:${ge},ett:${ve},otmuid:${Se},ott:${ee}`}return n}_convertTextureTransform(e){if(!e)return null;const{scale:i,offset:r,rotation:n}=e;return{scale:i,offset:r,rotation:gi(n)}}_setInternalColorValueParameters(e,i){i.diffuse=mt.toUnitRGB(e),i.opacity=e.a}_getLoadableTextureResource(e){return e.data??e.url}_getInternalTextureId(e){return this._getInternalTexture(e,zr.Opaque)?.id}_getInternalTexture(e,i){const r=this._getLoadableTextureResource(e);if(!r)return null;const n=`${e.contentHash}/${i}`;let s=this._textures.get(n);if(!s){let a=null;const u=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,p={wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,maxAnisotropy:u,mipmap:u>1};d4(r)?(a=r.data,p.preMultiplyAlpha=!1,p.encoding=r.encoding):(a=r,p.preMultiplyAlpha=i!==zr.Opaque,p.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),s=new Nw(a,p),this._textures.set(n,s),s.load(this._context.stage.renderView.renderingContext),this._context.stage.add(s)}return s}_castTextureWrap(e="repeat"){if(typeof e=="string"){const i=this._castTextureWrapIndividual(e);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return Ai.CLAMP_TO_EDGE;case"mirror":return Ai.MIRRORED_REPEAT;default:return Ai.REPEAT}}_setInternalMaterialParameters(e,i){if(e.color!=null&&this._setInternalColorValueParameters(e.color,i),e.colorTexture!=null){const r=this._getInternalTexture(e.colorTexture,i.textureAlphaMode);r?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.parameters.preMultiplyAlpha):i.textureId=void 0}e.normalTexture&&(i.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor&&(i.emissiveFactor=mt.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(i.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture&&(i.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture&&(i.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),i.colorTextureTransformMatrix=s0(e.colorTextureTransform),i.normalTextureTransformMatrix=s0(e.normalTextureTransform),i.occlusionTextureTransformMatrix=s0(e.occlusionTextureTransform),i.emissiveTextureTransformMatrix=s0(e.emissiveTextureTransform),i.metallicRoughnessTextureTransformMatrix=s0(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const i=this._drivenProperties.color;let r=this.symbolLayer.material?.colorMixMode??null;if(i)e.externalColor=Bh;else{const n=this.symbolLayer.material?.color??null;n?e.externalColor=mt.toUnitRGBA(n):(r=null,e.externalColor=Bh)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const i=e.vertexAttributes.color;if(i==null)return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(e,i){const r=i.material?.color,n=i.material?.colorTexture,s=i.material?.alphaMode,a=s==="blend",u=s!=="opaque"&&(this._hasTransparentVertexColors(e)||r!=null&&r.a<1||n?.transparent||a),p=this._materialProperties(e,i,u),y=this._materialInfoCache.byUid(p.uid);if(y)return y.material;const b={uid:p.uid,material:null,isComponentTransparent:u,alphaMode:i.material?i.material.alphaMode:"opaque"},S=wSe({normalTexture:p.normalTexture,metallicRoughnessTexture:p.metallicRoughnessTexture,metallicFactor:p.metallic,roughnessFactor:p.roughness,emissiveTexture:p.emissiveTexture,emissiveFactor:mt.toUnitRGB(p.emissiveColor),occlusionTexture:p.occlusionTexture}),C={usePBR:this._usePBR(),isSchematic:S,hasVertexColors:p.hasVertexColors,hasSymbolColors:p.hasSymbolVertexColors,hasVertexTangents:p.hasVertexTangents,ambient:Mo,diffuse:rg,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:rn.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};C.mrrFactors=S?[...lQ]:[p.metallic,p.roughness,lN[2]],i.material&&(C.doubleSided=i.material.doubleSided,C.cullFace=i.material.doubleSided?rn.None:rn.Back,C.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(C),this._setMaterialTransparentParameter(C,b),this._setInternalMaterialParameters(p,C);const O=new Up(C);return b.material=O,this._materialInfoCache.set(p.uid,b),this._context.stage.add(O),O}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,i){e.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,i.alphaMode==="auto"?e.textureAlphaMode=e.transparent?zr.MaskBlend:zr.Opaque:e.textureAlphaMode=i.alphaMode==="opaque"?zr.Opaque:i.alphaMode==="mask"?zr.Mask:zr.Blend}_addDebugNormals(e,i){const r=i.length,n=e.spatialReference.isGeographic?20015077/180:1,s=.1*Math.max(e.extent.width*n,e.extent.height*n,e.extent.zmax-e.extent.zmin),a=[],u=[],p=[],y=[];for(let O=0;O<r;O++){const P=i[O],$=P.attributes.get(X.POSITION),N=P.attributes.get(X.NORMAL),z=$.data,U=$.indices,j=N.data,G=N.indices;for(let q=0;q<U.length;q++){const W=3*U[q],K=3*G[q];for(let se=0;se<3;se++)a.push(z[W+se]);for(let se=0;se<3;se++)a.push(z[W+se]+j[K+se]*s);if(u.push(u.length),u.push(u.length),q%3==0){this._calculateFaceNormal(z,U,q,P3),this._getFaceVertices(z,U,q,ho,R3,M3),Ue(ho,ho,R3),Ue(ho,ho,M3),Pe(ho,ho,1/3);for(let se=0;se<3;se++)p.push(ho[se]);for(let se=0;se<3;se++)p.push(ho[se]+P3[se]*s);y.push(y.length),y.push(y.length)}}}const b=i[0].transformation,S=new Is(this._debugVertexNormalMaterial,[[X.POSITION,new Et(a,u,3,!0)]],null,Gn.Line);i.push(S),S.transformation=b;const C=new Is(this._debugFaceNormalMaterial,[[X.POSITION,new Et(p,y,3,!0)]],null,Gn.Line);C.transformation=b,i.push(C)}_createAs3DShape(e,i,r,n){const s=e.geometry;if(s.type!=="mesh")return null;const a=this._createGeometryInfo(s,i,n);if(a==null)return null;const{geometries:u,objectTransformation:p}=a;Xr.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,u);const y=new Xg({geometries:u,layerUid:this._context.layer.uid,graphicUid:n});y.transformation=p;const b=fSe(this.symbolLayer,{opacity:this._getLayerOpacity()}),S=b?new Mrt(u[0].material,[b],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,C=new sht(this,y,u,null,null,C2,r,S);this._fastUpdateProcessor.onAddGraphic(),C.needsElevationUpdates=Ev(r.mode),C.useObjectOriginAsAttachmentOrigin=!0,r.centerPointInElevationSR=this._getCenterPointInElevationSR(y.transformation);const{elevationProvider:O,renderCoordsHelper:P}=this._context,$=(N,z)=>Sv(N,O,r,P,z);return C.alignedSampledElevation=C2(C,r,O.spatialReference,$,P),C}_getCenterPointInElevationSR(e){const i=kv(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return JCe([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(e,i,r,n){switch(r.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,i,r,n);case"flat":return this._createComponentNormalsFlat(e,n);case"smooth":return this._createComponentNormalsSmooth(e,n)}}_createComponentNormalsSource(e,i,r,n){if(i==null)return this._createComponentNormalsFlat(e,n);let s=!1;if(!r.trustSourceNormals)for(let a=0;a<n.length;a+=3){this._calculateFaceNormal(e,n,a,P3);for(let u=0;u<3;u++){const p=3*n[a+u];ho[0]=i[p],ho[1]=i[p+1],ho[2]=i[p+2],He(P3,ho)<0&&(i[p]=-i[p],i[p+1]=-i[p+1],i[p+2]=-i[p+2],s=!0)}}return new Iz(i,n,s)}_createComponentNormalsFlat(e,i){const r=Fn(i.length),n=new Array(3*i.length);for(let s=0;s<i.length;s+=3){const a=this._calculateFaceNormal(e,i,s,P3);for(let u=0;u<3;u++)r[s+u]=a[u],n[s+u]=s/3}return new Iz(r,n,!1)}_createComponentNormalsSmooth(e,i){const r={};for(let a=0;a<i.length;a+=3){const u=this._calculateFaceNormal(e,i,a,P3);for(let p=0;p<3;p++){const y=i[a+p];let b=r[y];b||(b={normal:H(),count:0},r[y]=b),Ue(b.normal,b.normal,u),b.count++}}const n=Fn(3*i.length),s=new Array(3*i.length);for(let a=0;a<i.length;a++){const u=r[i[a]];u.count!==1&&(We(u.normal,u.normal),u.count=1);for(let p=0;p<3;p++)n[3*a+p]=u.normal[p];s[a]=a}return new Iz(n,s,!1)}_getFaceVertices(e,i,r,n,s,a){const u=3*i[r],p=3*i[r+1],y=3*i[r+2];n[0]=e[u],n[1]=e[u+1],n[2]=e[u+2],s[0]=e[p],s[1]=e[p+1],s[2]=e[p+2],a[0]=e[y],a[1]=e[y+1],a[2]=e[y+2]}_calculateFaceNormal(e,i,r,n){return this._getFaceVertices(e,i,r,ho,R3,M3),Be(R3,R3,ho),Be(M3,M3,ho),qt(ho,R3,M3),We(n,ho),n}_getOrCreateComponents(e){return e.components??_ht}_createPositionBuffer(e,i){let r=e.vertexAttributes.position;const n=i.reprojection===bc.ECEF?i.transformBeforeProject:null;if(n&&(r=Bp(new Float64Array(r.length),r,n)),i.reprojection===bc.NONE)return i.needsBufferCopy?new Float64Array(r):r;const s=n?r:new Float64Array(r.length);return Mn(r,e.spatialReference,0,s,this._context.renderCoordsHelper.spatialReference,0,r.length/3),s}_createNormalBuffer(e,i,r){let n=e.vertexAttributes.normal;if(n==null)return null;const s=r.reprojection===bc.ECEF?r.transformBeforeProject:null;if(s&&(n=i5e(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===bc.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const a=e.vertexAttributes.position,u=s?n:new Float32Array(n.length);return t5e(n,a,i,e.spatialReference,u)}_createTangentBuffer(e,i,r){let n=e.vertexAttributes.tangent;if(n==null)return null;const s=r.reprojection===bc.ECEF?r.transformBeforeProject:null;if(s&&(n=r5e(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===bc.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const a=e.vertexAttributes.position,u=s?n:new Float32Array(n.length);return n5e(n,a,i,e.spatialReference,u)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(e),r=Wrt(this.symbolLayer?.material?.colorMixMode),n=new Uint8Array(4);return TSe(i,r,n),n}return null}_createBuffers(e,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const n=e.vertexAttributes.normal,s=e.vertexAttributes.uv,a=e.vertexAttributes.tangent;if(n&&n.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(a&&a.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(s&&s.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const u=this._computeReprojectionInfo(e),p=this._createPositionBuffer(e,u),y=this._createColorBuffer(e),b=this._createSymbolColorBuffer(i),S=this._createNormalBuffer(e,p,u),C=this._createTangentBuffer(e,p,u);return{positionBuffer:p,normalBuffer:S,tangentBuffer:C,uvBuffer:s,colorBuffer:y,symbolColorBuffer:b,objectTransformation:u.reprojection===bc.NONE&&u.objectTransformation?u.objectTransformation:this._transformOriginLocal(e,p,S,C),geometryTransformation:u.reprojection===bc.NONE&&u.geometryTransformation?u.geometryTransformation:Ze()}}_computeReprojectionInfo(e){const{vertexSpace:i}=e,r=i.isRelative,n=i.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===ht.Local?bc.NONE:bc.ECEF:bc.NONE;if(r){const{origin:s}=i,a=Ze(),u=e.transform?.localMatrix??Cn;if(n===bc.NONE)return jc(e.spatialReference,s,a,this._context.renderCoordsHelper.spatialReference),{reprojection:n,objectTransformation:a,geometryTransformation:OS(u),needsBufferCopy:!1};const p=YO(Ze(),s);return Rr(p,p,u),{reprojection:n,transformBeforeProject:p,needsBufferCopy:!0}}return{reprojection:n,needsBufferCopy:!0}}_transformOriginLocal(e,i,r,n){const s=this._context.renderCoordsHelper.spatialReference,a=e.anchor;YP[0]=a.x,YP[1]=a.y,YP[2]=a.z??0;const u=Ze();return jc(e.spatialReference,YP,u,s),Ps(ace,u),Bp(i,i,ace),(r||n)&&(sd(SC,u),od(SC,SC),r&&Vp(r,r,SC),n&&Vp(n,n,SC,4)),u}_validateFaces(e,i){const r=e.vertexAttributes.position.length/3,n=i.faces;if(n){let s=-1;for(let a=0;a<n.length;a++){const u=n[a];u>s&&(s=u)}if(r<=s)return this.logger.warn(`Vertex index ${s} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,i){return i.faces??Iw(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const i=e.vertexAttributes?.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference,n=l5e({positions:i,transform:e.transform,vertexSpace:e.vertexSpace,inSpatialReference:e.spatialReference,outSpatialReference:r??e.spatialReference,localMode:this._context.stage.viewingMode===ht.Local}),s=n.length/3;return cn($z),Fu($z,n,0,s),!vp($z,this._context.clippingExtent)}_createGeometryInfo(e,i,r){if(!$p(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const n=this._createBuffers(e,i);if(n==null)return null;const{positionBuffer:s,uvBuffer:a,colorBuffer:u,symbolColorBuffer:p,normalBuffer:y,tangentBuffer:b,objectTransformation:S,geometryTransformation:C}=n,O=this._getOrCreateComponents(e),P=new Array;let $=!1;const N=nL(ho,S),z=this._context.localOriginFactory.getOrigin(N);for(const U of O){if(!this._validateFaces(e,U))return null;const j=this._getOrCreateFaces(e,U);if(j.length===0)continue;const G=this._createComponentNormals(s,y,U,j);G.didFlipNormals&&($=!0);const q=[[X.POSITION,new Et(s,j,3,!0)],[X.NORMAL,new Et(G.normals,G.indices,3,!0)]];u&&q.push([X.COLOR,new Et(u,j,4,!0)]),p&&q.push([X.SYMBOLCOLOR,new Et(p,Uv(j.length),4,!0)]),a&&q.push([X.UV0,new Et(a,j,2,!0)]),b&&q.push([X.TANGENT,new Et(b,j,4,!0)]);const W=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),K=this._getOrCreateMaterial(e,U),se=new Is(K,q,null,Gn.Mesh,W);se.transformation=C,se.localOrigin=z,P.push(se)}return $&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:P,objectTransformation:S}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((i,r)=>{r.setParameters(i.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}}class Iz{constructor(e,i,r){this.normals=e,this.indices=i,this.didFlipNormals=r}}const YP=H(),ho=H(),R3=H(),M3=H(),P3=H(),ace=Ze(),SC=Pn(),vht=Ze(),$z=eo(),_ht=[new Dut],bht=new XT;var bc;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(bc||(bc={}));let wht=class{constructor(e,i,r,n){this.graphics3DSymbolLayer=e,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=n,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const i=this._lodRenderer.instanceData;e!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,i,r){if(this.elevationAligner){oN(this.elevationContext.featureExpressionInfoContext,r);const n=(a,u)=>Sv(a,e,this.elevationContext,i,u),s=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,i);s!=null&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(e=H()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,hf),wt(e,this._lodRenderer.baseBoundingSphere.center,hf)}getBoundingBoxObjectSpace(e=eo()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,hf);const i=this._lodRenderer.baseBoundingBox;cn(e);for(let r=0;r<8;++r)$e(hh,1&r?i[3]:i[0],2&r?i[4]:i[1],4&r?i[5]:i[2]),wt(hh,hh,hf),Np(e,hh);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,hf),e.render.origin[0]+=hf[12],e.render.origin[1]+=hf[13],e.render.origin[2]+=hf[14],e.render.num++}async getProjectedBoundingBox(e,i,r,n,s){const a=this.getBoundingBoxObjectSpace(s),u=xht,p=KY(a)?1:u.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,hf);for(let b=0;b<p;b++){const S=u[b];hh[0]=a[S[0]],hh[1]=a[S[1]],hh[2]=a[S[2]],wt(hh,hh,hf),m_[3*b]=hh[0],m_[3*b+1]=hh[1],m_[3*b+2]=hh[2]}if(!e(m_,0,p))return null;cn(a);let y=null;this.calculateRelativeScreenBounds&&(y=this.calculateRelativeScreenBounds());for(let b=0;b<3*p;b+=3){for(let S=0;S<3;S++)a[S]=Math.min(a[S],m_[b+S]),a[S+3]=Math.max(a[S+3],m_[b+S]);y&&r.push({location:m_.slice(b,b+3),screenSpaceBoundingRect:y})}if(i&&(yp(a,Lz),this.elevationContext.mode!=="absolute-height")){let b;const S=rQ(a,i.service.spatialReference,i);try{b=await i.service.queryElevation(Lz[0],Lz[1],n,S,"ground")}catch{}b!=null&&Jve(a,0,0,-this.alignedSampledElevation+b)}return a}addObjectState(e,i){if(e===Pg.Highlight){const r=new WL(e);this._addHighlightId(r),i.addExternal(n=>{this._removeHighlightId(n)},r)}}removeObjectState(e){this._highlights.forEach(i=>e.remove(i))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const m_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],hh=H(),Lz=H(),xht=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],hf=Ze();function Tht(t,e){const i=t.stageResources.geometries.map(n=>new cSe(n,t.stageResources.textures)),r=t.lodThreshold==null||t.lodThreshold===0&&e>0?Eht(i):t.lodThreshold;return new uSe(i,r,t.pivotOffset)}function Sht(t){return new hSe(t.map((e,i)=>Tht(e,i)))}function Eht(t){const e=t.reduce((i,{geometry:r})=>i+r.indexCount/3,0);return Math.sqrt(e*Cht/Math.PI)}const Cht=20;function Aht(t){return t=t||globalThis.location.hostname,Oht.some(e=>t?.match(e)!=null)}function kq(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(m5e)!=null||e.match(y5e)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(g5e)!=null||e.match(v5e)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const m5e=/^devext.arcgis.com$/,g5e=/^qaext.arcgis.com$/,y5e=/^[\w-]*\.mapsdevext.arcgis.com$/,v5e=/^[\w-]*\.mapsqa.arcgis.com$/,Oht=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,m5e,g5e,/^jsapps.esri.com$/,y5e,v5e];function Rht(t,e,i){if(t.count!==e.count)return void fN.error("source and destination buffers need to have the same number of elements");const r=t.count,n=i[0],s=i[1],a=i[2],u=i[3],p=i[4],y=i[5],b=i[6],S=i[7],C=i[8],O=i[9],P=i[10],$=i[11],N=i[12],z=i[13],U=i[14],j=i[15],G=t.typedBuffer,q=t.typedBufferStride,W=e.typedBuffer,K=e.typedBufferStride;for(let se=0;se<r;se++){const ae=se*q,le=se*K,me=W[le],ne=W[le+1],pe=W[le+2],ge=W[le+3];G[ae]=n*me+p*ne+C*pe+N*ge,G[ae+1]=s*me+y*ne+O*pe+z*ge,G[ae+2]=a*me+b*ne+P*pe+U*ge,G[ae+3]=u*me+S*ne+$*pe+j*ge}}function Mht(t,e,i){XQ(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function XQ(t,e,i,r=4,n=r){if(t.length/r!=e.length/n)return void fN.error("source and destination buffers need to have the same number of elements");const s=t.length/r,a=i[0],u=i[1],p=i[2],y=i[3],b=i[4],S=i[5],C=i[6],O=i[7],P=i[8];let $=0,N=0;for(let z=0;z<s;z++){const U=e[$],j=e[$+1],G=e[$+2],q=e[$+3];t[N]=a*U+y*j+C*G,t[N+1]=u*U+b*j+O*G,t[N+2]=p*U+S*j+P*G,t[N+3]=q,$+=n,N+=r}}function Pht(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,a=e.typedBufferStride;for(let u=0;u<i;u++){const p=u*n,y=u*a,b=s[y],S=s[y+1],C=s[y+2],O=b*b+S*S+C*C;if(O>0){const P=1/Math.sqrt(O);r[p]=P*b,r[p+1]=P*S,r[p+2]=P*C}}}function Iht(t,e,i){C8(t.typedBuffer,e,i,t.typedBufferStride)}function C8(t,e,i,r=4){const n=Math.min(t.length/r,e.count),s=e.typedBuffer,a=e.typedBufferStride;let u=0,p=0;for(let y=0;y<n;y++)t[p]=i*s[u],t[p+1]=i*s[u+1],t[p+2]=i*s[u+2],t[p+3]=i*s[u+3],u+=a,p+=r}Object.freeze(Object.defineProperty({__proto__:null,normalize:Pht,scale:C8,scaleView:Iht,transformMat3:XQ,transformMat3View:Mht,transformMat4:Rht},Symbol.toStringTag,{value:"Module"}));function $ht(t,e){JQ(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function JQ(t,e,i=2,r=i){const n=e.length/2;let s=0,a=0;if(Zh(e)||e9e(e)){for(let p=0;p<n;++p)t[s]=e[a],t[s+1]=e[a+1],s+=i,a+=r;return}const u=t9e(e);if(QPe(e))for(let p=0;p<n;++p)t[s]=Math.max(e[a]/u,-1),t[s+1]=Math.max(e[a+1]/u,-1),s+=i,a+=r;else for(let p=0;p<n;++p)t[s]=e[a]/u,t[s+1]=e[a+1]/u,s+=i,a+=r}function Lht(t,e,i,r){const n=t.typedBuffer,s=t.typedBufferStride,a=r?.count??t.count;let u=(r?.dstIndex??0)*s;for(let p=0;p<a;++p)n[u]=e,n[u+1]=i,u+=s}Object.freeze(Object.defineProperty({__proto__:null,fill:Lht,normalizeIntegerBuffer:JQ,normalizeIntegerBufferView:$ht},Symbol.toStringTag,{value:"Module"}));function Dht(t,e){$R(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function $R(t,e,i=3,r=i){const n=e.length/r;let s=0,a=0;for(let u=0;u<n;++u)t[s]=e[a],t[s+1]=e[a+1],t[s+2]=e[a+2],s+=i,a+=r}function Nht(t,e,i,r,n){const s=t.typedBuffer,a=t.typedBufferStride,u=n?.count??t.count;let p=(n?.dstIndex??0)*a;for(let y=0;y<u;++y)s[p]=e,s[p+1]=i,s[p+2]=r,p+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:$R,copyView:Dht,fill:Nht},Symbol.toStringTag,{value:"Module"}));function Fht(t,e){YQ(t.typedBuffer,e,t.typedBufferStride)}function YQ(t,e,i=4){const r=e.typedBuffer,n=e.typedBufferStride,s=e.count;let a=0,u=0;for(let p=0;p<s;++p)t[a]=r[u],t[a+1]=r[u+1],t[a+2]=r[u+2],t[a+3]=r[u+3],a+=i,u+=n}function kht(t,e,i,r,n,s){const a=t.typedBuffer,u=t.typedBufferStride,p=s?.count??t.count;let y=(s?.dstIndex??0)*u;for(let b=0;b<p;++b)a[y]=e,a[y+1]=i,a[y+2]=r,a[y+3]=n,y+=u}Object.freeze(Object.defineProperty({__proto__:null,copy:YQ,copyView:Fht,fill:kht},Symbol.toStringTag,{value:"Module"}));let _5e=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load("json",e,i)}async loadBinary(e,i){return $0(e)?(oi(i),xJ(e)):this._load("binary",e,i)}async loadImage(e,i){return this._load("image",e,i)}async _load(e,i,r){if(this._streamDataRequester==null)return(await ir(i,{responseType:zht[e]})).data;const n=await Gc(this._streamDataRequester.request(i,e,r));if(n.ok===!0)return n.value;throw $a(n.error),new de("",`Request for resource failed: ${n.error}`)}};const zht={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function Uht(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function jht(t,e={}){return{data:t,parameters:{wrap:{s:Ai.REPEAT,t:Ai.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}function k$(t,e){const i=t.count;e||(e=new t.TypedArrayConstructor(i));for(let r=0;r<i;r++)e[r]=t.get(r);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:k$},Symbol.toStringTag,{value:"Module"}));let lce=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const i=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,i,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var p4,cce;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(p4||(p4={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(cce||(cce={}));const b5e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},Bht={pbrMetallicRoughness:b5e,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},Vht={ESRI_externalColorMixMode:"tint"},uce=(t={})=>{const e={...b5e,...t.pbrMetallicRoughness},i=Ght({...Vht,...t.extras});return{...Bht,...t,pbrMetallicRoughness:e,extras:i}};function Ght(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const Hht={magFilter:Si.LINEAR,minFilter:Si.LINEAR_MIPMAP_LINEAR,wrapS:Ai.REPEAT,wrapT:Ai.REPEAT},qht=t=>({...Hht,...t});function Wht(t){let e,i;return t.replace(/^(.*\/)?([^/]*)$/,(r,n,s)=>(e=n||"",i=s||"","")),{dirPart:e,filePart:i}}const ZP={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let Xht=class sy{constructor(e,i,r,n){if(this._context=e,this.uri=i,this.json=r,this._glbBuffer=n,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=Wht(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.scenes==null)throw new de("gltf-loader-unsupported-feature","Scenes must be defined.");if(r.meshes==null)throw new de("gltf-loader-unsupported-feature","Meshes must be defined");if(r.nodes==null)throw new de("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,i,r){if($0(i)){const a=sv(i);if(a&&a.mediaType!=="model/gltf-binary")try{const p=JSON.parse(a.isBase64?atob(a.data):a.data);return new sy(e,i,p)}catch{}const u=xJ(i);if(sy._isGLBData(u))return this._fromGLBData(e,i,u)}if(edt.test(i)||r?.expectedType==="gltf"){const a=await e.loadJSON(i,r);return new sy(e,i,a)}const n=await e.loadBinary(i,r);if(sy._isGLBData(n))return this._fromGLBData(e,i,n);if(tdt.test(i)||r?.expectedType==="glb")throw new de("gltf-loader-invalid-glb","This is not a valid glb file.");const s=await e.loadJSON(i,r);return new sy(e,i,s)}static _isGLBData(e){if(e==null)return!1;const i=new lce(e);return i.remainingBytes()>=4&&i.readUint32()===ZP.MAGIC}static async _fromGLBData(e,i,r){const n=await sy._parseGLBData(r);return new sy(e,i,n.json,n.binaryData)}static async _parseGLBData(e){const i=new lce(e);if(i.remainingBytes()<12)throw new de("gltf-loader-error","glb binary data is insufficiently large.");const r=i.readUint32(),n=i.readUint32(),s=i.readUint32();if(r!==ZP.MAGIC)throw new de("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(e.byteLength<s)throw new de("gltf-loader-error","glb binary data is smaller than header specifies.");if(n!==2)throw new de("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let a,u,p=0;for(;i.remainingBytes()>=8;){const y=i.readUint32(),b=i.readUint32();if(p===0){if(b!==ZP.CHUNK_TYPE_JSON)throw new de("gltf-loader-error","First glb chunk must be JSON.");if(y<0)throw new de("gltf-loader-error","No JSON data found.");a=await rht(i.readUint8Array(y))}else if(p===1){if(b!==ZP.CHUNK_TYPE_BIN)throw new de("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");u=i.readUint8Array(y)}else Ee.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");p+=1}if(!a)throw new de("gltf-loader-error","No glb JSON chunk detected.");return{json:a,binaryData:u}}async getBuffer(e,i){const r=this.json.buffers[e];if(r.uri==null){if(this._glbBuffer==null)throw new de("gltf-loader-error","glb buffer not present");return this._glbBuffer}const n=await this._getBufferLoader(e,i);if(n.byteLength!==r.byteLength)throw new de("gltf-loader-error","Buffer byte lengths should match.");return n}async _getBufferLoader(e,i){const r=this._bufferLoaders.get(e);if(r)return r;const n=this.json.buffers[e].uri,s=this._context.loadBinary(this._resolveUri(n),i).then(a=>new Uint8Array(a));return this._bufferLoaders.set(e,s),s}async getAccessor(e,i){if(!this.json.accessors)throw new de("gltf-loader-unsupported-feature","Accessors missing.");const r=this.json.accessors[e];if(r?.bufferView==null)throw new de("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(r.type in[p4.MAT2,p4.MAT3,p4.MAT4])throw new de("gltf-loader-unsupported-feature",`AttributeType ${r.type} is not supported`);const n=this.json.bufferViews[r.bufferView],s=await this.getBuffer(n.buffer,i),a=Zht[r.type],u=Kht[r.componentType],p=a*u,y=n.byteStride||p;return{raw:s.buffer,byteStride:y,byteOffset:s.byteOffset+(n.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:y===p,componentCount:a,componentByteSize:u,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,i){if(e.indices==null)return;const r=await this.getAccessor(e.indices,i);if(r.isDenselyPacked)switch(r.componentType){case Ft.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case Ft.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case Ft.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case Ft.UNSIGNED_BYTE:return k$(this._wrapAccessor(zS,r));case Ft.UNSIGNED_SHORT:return k$(this._wrapAccessor(z7,r));case Ft.UNSIGNED_INT:return k$(this._wrapAccessor(j7,r))}}async getPositionData(e,i){if(e.attributes.POSITION==null)throw new de("gltf-loader-unsupported-feature","No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,i);if(r.componentType!==Ft.FLOAT)throw new de("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+Ft[r.componentType]);if(r.componentCount!==3)throw new de("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(lo,r)}async getNormalData(e,i){if(e.attributes.NORMAL==null)throw new de("gltf-loader-error","No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,i);if(r.componentType!==Ft.FLOAT)throw new de("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+Ft[r.componentType]);if(r.componentCount!==3)throw new de("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(lo,r)}async getTangentData(e,i){if(e.attributes.TANGENT==null)throw new de("gltf-loader-error","No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,i);if(r.componentType!==Ft.FLOAT)throw new de("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+Ft[r.componentType]);if(r.componentCount!==4)throw new de("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed());return new zp(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,i){if(e.attributes.TEXCOORD_0==null)throw new de("gltf-loader-error","No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,i);if(r.componentCount!==2)throw new de("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed());if(r.componentType===Ft.FLOAT)return this._wrapAccessor(Pw,r);if(!r.normalized)throw new de("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return Qht(r)}async getVertexColors(e,i){if(e.attributes.COLOR_0==null)throw new de("gltf-loader-error","No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,i);if(r.componentCount!==4&&r.componentCount!==3)throw new de("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed());if(r.componentCount===4){if(r.componentType===Ft.FLOAT)return this._wrapAccessor(zp,r);if(r.componentType===Ft.UNSIGNED_BYTE)return this._wrapAccessor(ja,r);if(r.componentType===Ft.UNSIGNED_SHORT)return this._wrapAccessor(fR,r)}else if(r.componentCount===3){if(r.componentType===Ft.FLOAT)return this._wrapAccessor(lo,r);if(r.componentType===Ft.UNSIGNED_BYTE)return this._wrapAccessor(k7,r);if(r.componentType===Ft.UNSIGNED_SHORT)return this._wrapAccessor(U7,r)}throw new de("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+Ft[r.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,i,r){let n=e.material?this._materialCache.get(e.material):void 0;if(!n){const s=e.material!=null?uce(this.json.materials[e.material]):uce(),a=s.pbrMetallicRoughness,u=this.hasVertexColors(e),p=this.getTexture(a.baseColorTexture,i),y=this.getTexture(s.normalTexture,i),b=r?this.getTexture(s.occlusionTexture,i):void 0,S=r?this.getTexture(s.emissiveTexture,i):void 0,C=r?this.getTexture(a.metallicRoughnessTexture,i):void 0,O=e.material!=null?e.material:-1;n={alphaMode:s.alphaMode,alphaCutoff:s.alphaCutoff,color:a.baseColorFactor,doubleSided:!!s.doubleSided,colorTexture:await p,normalTexture:await y,name:s.name,id:O,occlusionTexture:await b,emissiveTexture:await S,emissiveFactor:s.emissiveFactor,metallicFactor:a.metallicFactor,roughnessFactor:a.roughnessFactor,metallicRoughnessTexture:await C,hasVertexColors:u,ESRI_externalColorMixMode:s.extras.ESRI_externalColorMixMode,colorTextureTransform:a?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:s.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:s.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:s.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:a?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return n}async getTexture(e,i){if(!e)return;if((e.texCoord||0)!==0)throw new de("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const r=e.index,n=this.json.textures[r],s=qht(n.sampler!=null?this.json.samplers[n.sampler]:{}),a=this._getTextureSourceId(n),u=this.json.images[a],p=await this._loadTextureImageData(r,n,i);return U0e(this._textureCache,r,()=>{const y=S=>S===33071||S===33648||S===10497,b=S=>{throw new de("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${S}`)};return{data:p,wrapS:y(s.wrapS)?s.wrapS:b(s.wrapS),wrapT:y(s.wrapT)?s.wrapT:b(s.wrapT),minFilter:s.minFilter,name:u.name,id:r}})}getNodeTransform(e){if(e===void 0)return Jht;let i=this._nodeTransformCache.get(e);if(!i){const r=this.getNodeTransform(this._getNodeParent(e)),n=this.json.nodes[e];n.matrix?i=Rr(Ze(),r,n.matrix):n.translation||n.rotation||n.scale?(i=OS(r),n.translation&&ec(i,i,n.translation),n.rotation&&(KP[3]=IZ(KP,n.rotation),Dc(i,i,KP[3],KP)),n.scale&&JO(i,i,n.scale)):i=OS(r),this._nodeTransformCache.set(e,i)}return i}_wrapAccessor(e,i){return new e(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(e){return fl(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=dv.parse(this.json.asset.version,"glTF");Yht.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(i=>this._supportedExtensions.includes(i)))throw new de("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,i)=>{e.children&&e.children.forEach(r=>{this._nodeParentMap.set(r,i)})})}async _loadTextureImageData(e,i,r){const n=this._textureLoaders.get(e);if(n)return n;const s=this._createTextureLoader(i,r);return this._textureLoaders.set(e,s),s}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new de("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,i){const r=this._getTextureSourceId(e),n=this.json.images[r];if(n.uri){if(n.uri.endsWith(".ktx2")){const p=await this._context.loadBinary(this._resolveUri(n.uri),i);return new d5e(new Uint8Array(p))}return this._context.loadImage(this._resolveUri(n.uri),i)}if(n.bufferView==null)throw new de("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(n.mimeType==null)throw new de("gltf-loader-unsupported-feature","Image mimeType must be defined.");const s=this.json.bufferViews[n.bufferView],a=await this.getBuffer(s.buffer,i);if(s.byteStride!=null)throw new de("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const u=a.byteOffset+(s.byteOffset||0);return nht(new Uint8Array(a.buffer,u,s.byteLength),n.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await Pte(Array.from(this._bufferLoaders.values())),i=await Pte(Array.from(this._textureLoaders.values()));return e.reduce((r,n)=>r+(n?.byteLength??0),0)+i.reduce((r,n)=>r+(n?d4(n)?n.data.byteLength:n.width*n.height*4:0),0)}};const Jht=Rge(Ze(),Math.PI/2),Yht=new dv(2,0,"glTF"),KP=pd(),Zht={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Kht={[Ft.BYTE]:1,[Ft.UNSIGNED_BYTE]:1,[Ft.SHORT]:2,[Ft.UNSIGNED_SHORT]:2,[Ft.FLOAT]:4,[Ft.INT]:4,[Ft.UNSIGNED_INT]:4};function Qht(t){switch(t.componentType){case Ft.BYTE:return new B7(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ft.UNSIGNED_BYTE:return new F7(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ft.SHORT:return new mR(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ft.UNSIGNED_SHORT:return new yK(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ft.UNSIGNED_INT:return new vK(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ft.FLOAT:return new Pw(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}const edt=/\.gltf$/i,tdt=/\.glb$/i;let idt=0;async function w5e(t,e,i={},r=!0){const n=await Xht.load(t,e,i),s="gltf_"+idt++,a={lods:[],materials:new Map,textures:new Map,meta:rdt(n)},u=!(!n.json.asset.extras||n.json.asset.extras.ESRI_type!=="symbolResource"),p=new Map;await ndt(n,async(b,S,C,O)=>{const P=p.get(C)??0;p.set(C,P+1);const $=b.mode!==void 0?b.mode:Hi.TRIANGLES,N=$===Hi.TRIANGLES||$===Hi.TRIANGLE_STRIP||$===Hi.TRIANGLE_FAN?$:null;if(N==null)return void Ee.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Hi[$]+"). Skipping primitive.");if(!n.hasPositions(b))return void Ee.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const z=n.getPositionData(b,i),U=n.getMaterial(b,i,r),j=n.hasNormals(b)?n.getNormalData(b,i):null,G=n.hasTangents(b)?n.getTangentData(b,i):null,q=n.hasTextureCoordinates(b)?n.getTextureCoordinates(b,i):null,W=n.hasVertexColors(b)?n.getVertexColors(b,i):null,K=n.getIndexData(b,i),se={name:O,transform:OS(S),attributes:{position:await z,normal:j?await j:null,texCoord0:q?await q:null,color:W?await W:null,tangent:G?await G:null},indices:await K,primitiveType:N,material:odt(a,await U,s)};let ae=null;a.meta?.ESRI_lod!=null&&a.meta.ESRI_lod.metric==="screenSpaceRadius"&&(ae=a.meta.ESRI_lod.thresholds[C]),a.lods[C]=a.lods[C]||{parts:[],name:O,lodThreshold:ae},a.lods[C].parts[P]=se});for(const b of a.lods)b.parts=b.parts.filter(S=>!!S);const y=await n.getLoadedBuffersSize();return{model:a,meta:{isEsriSymbolResource:u,uri:n.uri},customMeta:{},size:y}}function rdt(t){const e=t.json;let i=null;return e.nodes.forEach(r=>{const n=r.extras;n!=null&&(n.ESRI_proxyEllipsoid||n.ESRI_lod)&&(i=n)}),i}async function ndt(t,e){const i=t.json,r=i.scenes[i.scene||0].nodes,n=r.length>1,s=[];for(const u of r){const p=i.nodes[u];s.push(a(u,0)),sdt(p)&&!n&&p.extensions.MSFT_lod.ids.forEach((y,b)=>a(y,b+1))}async function a(u,p){const y=i.nodes[u],b=t.getNodeTransform(u);if(y.weights!=null&&Ee.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),y.mesh!=null){const S=i.meshes[y.mesh];for(const C of S.primitives)s.push(e(C,b,p,S.name))}for(const S of y.children||[])s.push(a(S,p))}await Promise.all(s)}function sdt(t){return t.extensions?.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function odt(t,e,i){const r=s=>{const a=`${i}_tex_${s&&s.id}${s?.name?"_"+s.name:""}`;if(s&&!t.textures.has(a)){const u=jht(s.data,{wrap:{s:s.wrapS,t:s.wrapT},mipmap:adt.has(s.minFilter),noUnpackFlip:!0});t.textures.set(a,u)}return a},n=`${i}_mat_${e.id}_${e.name}`;if(!t.materials.has(n)){const s=Uht({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?r(e.colorTexture):void 0,textureNormal:e.normalTexture?r(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?r(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?r(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?r(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(n,s)}return n}const adt=new Set([Si.LINEAR_MIPMAP_LINEAR,Si.LINEAR_MIPMAP_NEAREST]);function ldt(t,e){switch(e){case Hi.TRIANGLES:return cdt(t);case Hi.TRIANGLE_STRIP:return udt(t);case Hi.TRIANGLE_FAN:return hdt(t)}}function cdt(t){return typeof t=="number"?Iw(t):My(t)?new Uint16Array(t):t}function udt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const i=e-2,r=qL(3*i);if(typeof t=="number"){let n=0;for(let s=0;s<i;s+=1)s%2==0?(r[n++]=s,r[n++]=s+1,r[n++]=s+2):(r[n++]=s+1,r[n++]=s,r[n++]=s+2)}else{let n=0;for(let s=0;s<i;s+=1)s%2==0?(r[n++]=t[s],r[n++]=t[s+1],r[n++]=t[s+2]):(r[n++]=t[s+1],r[n++]=t[s],r[n++]=t[s+2])}return r}function hdt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const i=e-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof t=="number"){let u=0;for(let p=0;p<i;++p)r[u++]=0,r[u++]=p+1,r[u++]=p+2;return r}const n=t[0];let s=t[1],a=0;for(let u=0;u<i;++u){const p=t[u+2];r[a++]=n,r[a++]=s,r[a++]=p,s=p}return r}let ddt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},pdt=class{constructor(e,i,r){this.name=e,this.lodThreshold=i,this.pivotOffset=r,this.stageResources=new ddt,this.numberOfVertices=0}};const Cm=Ee.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function x5e(t,e){const i=await fdt(t,e),r=await _dt(i.textureDefinitions??{},e);let n=0;for(const s in r)if(r.hasOwnProperty(s)){const a=r[s];n+=a?.image?a.image.width*a.image.height*4:0}return{resource:i,textures:r,size:n+e0e(i)}}async function fdt(t,e){const i=e?.streamDataRequester;if(i)return mdt(t,i,e);const r=await Gc(ir(t,e));if(r.ok===!0)return r.value.data;$a(r.error),T5e(r.error)}async function mdt(t,e,i){const r=await Gc(e.request(t,"json",i));if(r.ok===!0)return r.value;$a(r.error),T5e(r.error.details.url)}function T5e(t){throw new de("",`Request for object resource failed: ${t}`)}function gdt(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(Cm.warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const s=e.faces;if(s){if(e.vertexAttributes)for(const a in e.vertexAttributes){const u=s[a];u?.values?(u.valueType!=null&&u.valueType!=="UInt32"&&(Cm.warn(`Unsupported indexed geometry indices type '${u.valueType}', only UInt32 is currently supported`),r=!1),u.valuesPerElement!=null&&u.valuesPerElement!==1&&(Cm.warn(`Unsupported indexed geometry values per element '${u.valuesPerElement}', only 1 is currently supported`),r=!1)):(Cm.warn(`Indexed geometry does not specify face indices for '${a}' attribute`),r=!1)}}else Cm.warn("Indexed geometries must specify faces"),r=!1;break}default:Cm.warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(Cm.warn("Geometry requires material"),r=!1);const n=t.params.vertexAttributes;for(const s in n)n[s].values||(Cm.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function ydt(t,e){const i=new Array,r=new Array,n=new Array,s=new RE,a=t.resource,u=dv.parse(a.version||"1.0","wosr");wdt.validate(u);const p=a.model.name,y=a.model.geometries,b=a.materialDefinitions??{},S=t.textures;let C=0;const O=new Map;for(let P=0;P<y.length;P++){const $=y[P];if(!gdt($))continue;const N=bdt($),z=$.params.vertexAttributes,U=[],j=pe=>{if($.params.topology==="PerAttributeArray")return null;const ge=$.params.faces;for(const ve in ge)if(ve===pe)return ge[ve].values;return null},G=z[X.POSITION],q=G.values.length/G.valuesPerElement;for(const pe in z){const ge=z[pe],ve=ge.values,Se=j(pe)??Iw(q);U.push([pe,new Et(ve,Se,ge.valuesPerElement,!0)])}const W=N.texture,K=S&&S[W];if(K&&!O.has(W)){const{image:pe,parameters:ge}=K,ve=new Nw(pe,ge);r.push(ve),O.set(W,ve)}const se=O.get(W),ae=se?se.id:void 0,le=N.material;let me=s.get(le,W);if(me==null){const pe=b[le.substring(le.lastIndexOf("/")+1)].params;pe.transparency===1&&(pe.transparency=0);const ge=K&&K.alphaChannelUsage,ve=pe.transparency>0||ge==="transparency"||ge==="maskAndTransparency",Se=K?S5e(K.alphaChannelUsage):void 0,ee={ambient:Ma(pe.diffuse),diffuse:Ma(pe.diffuse),opacity:1-(pe.transparency||0),transparent:ve,textureAlphaMode:Se,textureAlphaCutoff:.33,textureId:ae,initTextureTransparent:!0,doubleSided:!0,cullFace:rn.None,colorMixMode:pe.externalColorMixMode||"tint",textureAlphaPremultiplied:K?.parameters.preMultiplyAlpha??!1};e?.materialParameters&&Object.assign(ee,e.materialParameters),me=new Up(ee),s.set(le,W,me)}n.push(me);const ne=new Is(me,U);C+=U.find(pe=>pe[0]===X.POSITION)?.[1]?.indices.length??0,i.push(ne)}return{engineResources:[{name:p,stageResources:{textures:r,materials:n,geometries:i},pivotOffset:a.model.pivotOffset,numberOfVertices:C,lodThreshold:null}],referenceBoundingBox:vdt(i)}}function vdt(t){const e=cn();return t.forEach(i=>{const r=i.boundingInfo;r!=null&&(Np(e,r.bbMin),Np(e,r.bbMax))}),e}async function _dt(t,e){const i=new Array;for(const s in t){const a=t[s],u=a.images[0].data;if(!u){Cm.warn("Externally referenced texture data is not yet supported");continue}const p=a.encoding+";base64,"+u,y="/textureDefinitions/"+s,b=a.channels==="rgba"?a.alphaChannelUsage||"transparency":"none",S={noUnpackFlip:!0,wrap:{s:Ai.REPEAT,t:Ai.REPEAT},preMultiplyAlpha:S5e(b)!==zr.Opaque},C=e!=null&&e.disableTextures?Promise.resolve(null):Lg(p,e);i.push(C.then(O=>({refId:y,image:O,parameters:S,alphaChannelUsage:b})))}const r=await Promise.all(i),n={};for(const s of r)n[s.refId]=s;return n}function S5e(t){switch(t){case"mask":return zr.Mask;case"maskAndTransparency":return zr.MaskBlend;case"none":return zr.Opaque;default:return zr.Blend}}function bdt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const wdt=new dv(1,2,"wosr"),I3=2.1;async function E5e(t,e){const i=C5e(kq(t));if(i.fileType==="wosr"){const S=await(e.cache?e.cache.loadWOSR(i.url,e):x5e(i.url,e)),{engineResources:C,referenceBoundingBox:O}=ydt(S,e);return{lods:C,referenceBoundingBox:O,isEsriSymbolResource:!1,isWosr:!0}}const r=await(e.cache?e.cache.loadGLTF(i.url,e,!!e.usePBR):w5e(new _5e(e.streamDataRequester),i.url,e,e.usePBR)),n=r.model.meta?.ESRI_proxyEllipsoid,s=r.meta.isEsriSymbolResource&&n!=null&&r.meta.uri.includes("/RealisticTrees/");s&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,Edt(r,n));const a=!!e.usePBR,u=r.meta.isEsriSymbolResource?{usePBR:a,isSchematic:!1,treeRendering:s,mrrFactors:[...qrt]}:{usePBR:a,isSchematic:!1,treeRendering:!1,mrrFactors:[...lN]},p={...e.materialParameters,treeRendering:s},{engineResources:y,referenceBoundingBox:b}=A5e(r,u,p,e.skipHighLods&&i.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:i.specifiedLodIndex});return{lods:y,referenceBoundingBox:b,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function C5e(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function A5e(t,e,i,r){const n=t.model,s=new Array,a=new Map,u=new Map,p=n.lods.length,y=cn();return n.lods.forEach((b,S)=>{const C=r.skipHighLods===!0&&(p>1&&S===0||p>3&&S===1)||r.skipHighLods===!1&&r.singleLodIndex!=null&&S!==r.singleLodIndex;if(C&&S!==0)return;const O=new pdt(b.name,b.lodThreshold,[0,0,0]);b.parts.forEach(P=>{const $=C?new Up({}):xdt(n,P,O,e,i,a,u),{geometry:N,vertexCount:z}=Tdt(P,$??new Up({})),U=N.boundingInfo;U!=null&&S===0&&(Np(y,U.bbMin),Np(y,U.bbMax)),$!=null&&(O.stageResources.geometries.push(N),O.numberOfVertices+=z)}),C||s.push(O)}),{engineResources:s,referenceBoundingBox:y}}function xdt(t,e,i,r,n,s,a){const u=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),p=t.materials.get(e.material),y=e.attributes.texCoord0!=null,b=e.attributes.normal!=null;if(p==null)return null;const S=Sdt(p.alphaMode);if(!s.has(u)){if(y){const q=(W,K=!1)=>{if(W!=null&&!a.has(W)){const se=t.textures.get(W);if(se!=null){const ae=se.data;a.set(W,new Nw(d4(ae)?ae.data:ae,{...se.parameters,preMultiplyAlpha:!d4(ae)&&K,encoding:d4(ae)&&ae.encoding!=null?ae.encoding:void 0}))}}};q(p.textureColor,S!==zr.Opaque),q(p.textureNormal),q(p.textureOcclusion),q(p.textureEmissive),q(p.textureMetallicRoughness)}const O=p.color[0]**(1/I3),P=p.color[1]**(1/I3),$=p.color[2]**(1/I3),N=p.emissiveFactor[0]**(1/I3),z=p.emissiveFactor[1]**(1/I3),U=p.emissiveFactor[2]**(1/I3),j=p.textureColor!=null&&y?a.get(p.textureColor):null,G=wSe({normalTexture:p.textureNormal,metallicRoughnessTexture:p.textureMetallicRoughness,metallicFactor:p.metallicFactor,roughnessFactor:p.roughnessFactor,emissiveTexture:p.textureEmissive,emissiveFactor:p.emissiveFactor,occlusionTexture:p.textureOcclusion});s.set(u,new Up({...r,transparent:S===zr.Blend,customDepthTest:K2.Lequal,textureAlphaMode:S,textureAlphaCutoff:p.alphaCutoff,diffuse:[O,P,$],ambient:[O,P,$],opacity:p.opacity,doubleSided:p.doubleSided,doubleSidedType:"winding-order",cullFace:p.doubleSided?rn.None:rn.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:b?_r.Attribute:_r.ScreenDerivative,castShadows:!0,textureId:j?.id,colorMixMode:p.colorMixMode,normalTextureId:p.textureNormal!=null&&y?a.get(p.textureNormal).id:void 0,textureAlphaPremultiplied:j!=null&&!!j.parameters.preMultiplyAlpha,occlusionTextureId:p.textureOcclusion!=null&&y?a.get(p.textureOcclusion).id:void 0,emissiveTextureId:p.textureEmissive!=null&&y?a.get(p.textureEmissive).id:void 0,metallicRoughnessTextureId:p.textureMetallicRoughness!=null&&y?a.get(p.textureMetallicRoughness).id:void 0,emissiveFactor:[N,z,U],mrrFactors:G?[...lQ]:[p.metallicFactor,p.roughnessFactor,r.mrrFactors[2]],isSchematic:G,colorTextureTransformMatrix:s0(p.colorTextureTransform),normalTextureTransformMatrix:s0(p.normalTextureTransform),occlusionTextureTransformMatrix:s0(p.occlusionTextureTransform),emissiveTextureTransformMatrix:s0(p.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:s0(p.metallicRoughnessTextureTransform),...n}))}const C=s.get(u);if(i.stageResources.materials.push(C),y){const O=P=>{P!=null&&i.stageResources.textures.push(a.get(P))};O(p.textureColor),O(p.textureNormal),O(p.textureOcclusion),O(p.textureEmissive),O(p.textureMetallicRoughness)}return C}function Tdt(t,e){const i=t.attributes.position.count,r=ldt(t.indices||i,t.primitiveType),n=Fn(3*i),{typedBuffer:s,typedBufferStride:a}=t.attributes.position;Bp(n,s,t.transform,3,a);const u=[[X.POSITION,new Et(n,r,3,!0)]];if(t.attributes.normal!=null){const p=Fn(3*i),{typedBuffer:y,typedBufferStride:b}=t.attributes.normal;Rg(QP,t.transform),Vp(p,y,QP,3,b),u.push([X.NORMAL,new Et(p,r,3,!0)])}if(t.attributes.tangent!=null){const p=Fn(4*i),{typedBuffer:y,typedBufferStride:b}=t.attributes.tangent;Rg(QP,t.transform),XQ(p,y,QP,4,b),u.push([X.TANGENT,new Et(p,r,4,!0)])}if(t.attributes.texCoord0!=null){const p=Fn(2*i),{typedBuffer:y,typedBufferStride:b}=t.attributes.texCoord0;JQ(p,y,2,b),u.push([X.UV0,new Et(p,r,2,!0)])}if(t.attributes.color!=null){const p=new Uint8Array(4*i);t.attributes.color.elementCount===4?t.attributes.color instanceof zp?C8(p,t.attributes.color,255):t.attributes.color instanceof ja?YQ(p,t.attributes.color):t.attributes.color instanceof fR&&C8(p,t.attributes.color,1/256):(p.fill(255),t.attributes.color instanceof lo?f8(p,t.attributes.color,255,4):t.attributes.color instanceof k7?$R(p,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof U7&&f8(p,t.attributes.color,1/256,4)),u.push([X.COLOR,new Et(p,r,4,!0)])}return{geometry:new Is(e,u),vertexCount:i}}const QP=Pn();function Sdt(t){switch(t){case"BLEND":return zr.Blend;case"MASK":return zr.Mask;case"OPAQUE":case null:case void 0:return zr.Opaque}}function Edt(t,e){for(let i=0;i<t.model.lods.length;++i){const r=t.model.lods[i];for(const n of r.parts){const s=n.attributes.normal;if(s==null)return;const a=n.attributes.position,u=a.count,p=H(),y=H(),b=H(),S=new Uint8Array(4*u),C=new Float64Array(3*u),O=Ps(Ze(),n.transform);let P=0,$=0;for(let N=0;N<u;N++){a.getVec(N,y),s.getVec(N,p),wt(y,y,n.transform),Be(b,y,e.center),eL(b,b,e.radius);const z=b[2],U=Qe(b),j=Math.min(.45+.55*U*U,1);eL(b,b,e.radius),O!==null&&wt(b,b,O),We(b,b),i+1!==t.model.lods.length&&t.model.lods.length>1&&Ir(b,b,p,z>-1?.2:Math.min(-4*z-3.8,1)),C[P]=b[0],C[P+1]=b[1],C[P+2]=b[2],P+=3,S[$]=255*j,S[$+1]=255*j,S[$+2]=255*j,S[$+3]=255,$+=4}n.attributes.normal=new lo(C),n.attributes.color=new ja(S)}}}const RFt=Object.freeze(Object.defineProperty({__proto__:null,fetch:E5e,gltfToEngineResources:A5e,parseUrl:C5e},Symbol.toStringTag,{value:"Module"})),Cdt=()=>!!Me("enable-feature:force-wosr"),MFt=()=>!!Me("enable-feature:direct-3d-object-feature-layer-display"),Adt=()=>Me.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),Odt=()=>Me.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),PFt=()=>!!Me("enable-i3s-patching"),Rdt=()=>Me.add("enable-i3s-patching",!0,!0,!0),Mdt=()=>Me.add("enable-i3s-patching",!1,!0,!0),IFt=()=>!!Me("enable-feature:SceneLayer-editing"),Pdt=(t="i3s-patching")=>{switch(Mdt(),Odt(),Me.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":Adt();break;case"i3s-patching":Rdt()}};Pdt("i3s-patching");let Dz={};async function Idt(t,e){try{return{data:(await KQ(t,e)).data,baseUrl:EJ(t),styleUrl:t}}catch(i){return $a(i),null}}function $dt(t,e,i){const r=e.portal!=null?e.portal:Zs.getDefault();let n;const s=`${r.url} - ${r.user&&r.user.username} - ${t}`;return Dz[s]||(Dz[s]=Ldt(t,r,i).then(a=>(n=a,a.fetchData())).then(a=>({data:a,baseUrl:n.itemUrl??"",styleName:t}))),Dz[s]}function Ldt(t,e,i){return e.load(i).then(()=>{const r=new e0({disableExtraQuery:!0,query:`owner:${hce} AND type:${dce} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{let n=null;const s=t.toLowerCase();if(r&&Array.isArray(r)){for(const a of r)if(a.typeKeywords?.some(p=>p.toLowerCase()===s)&&a.type===dce&&a.owner===hce){n=a;break}}if(!n)throw new de("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return n.load(i)})}function ZQ(t,e,i){return t?.styleUrl!=null?Idt(t.styleUrl,i):t?.styleName!=null?$dt(t.styleName,e,i):Promise.reject(new de("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function O5e(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function R5e(t,e,i=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!Cdt())for(const r of i){const n=t.formatInfos.find(s=>s.type===r);if(n)return n.href}return t.webRef}function KQ(t,e){const i={responseType:"json",query:{f:"json"},...e};return ir(Uu(t),i)}const hce="esri_en",dce="Style",Ddt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",EC={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function Ndt(t,e=EC){if(!t)return{symbol:null};const{retainId:i=EC.retainId,ignoreDrivers:r=EC.ignoreDrivers,hasLabelingContext:n=EC.hasLabelingContext,retainCIM:s=EC.retainCIM}=e;let a=null;if(J2(t)||t instanceof Ew)a=t.clone();else if(t.type==="cim"){const u=t.data?.symbol?.type;if(u!=="CIMPointSymbol")return{error:new de("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${u||"unknown"}' is unsupported in 3D`,{symbol:t})};a=s?t.clone():Uy.fromCIMSymbol(t)}else if(t instanceof dd)a=o7.fromSimpleLineSymbol(t);else if(t instanceof Nv)a=Uy.fromSimpleMarkerSymbol(t);else if(t instanceof l7)a=Uy.fromPictureMarkerSymbol(t);else if(t instanceof Sw)a=e.geometryType&&e.geometryType==="mesh"?a7.fromSimpleFillSymbol(t):oR.fromSimpleFillSymbol(t);else{if(!(t instanceof vE))return{error:new de("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};a=n?s7.fromTextSymbol(t):Uy.fromTextSymbol(t)}return i&&a&&a.type!=="cim"&&(a.id=t.id),r&&J2(a)&&a.symbolLayers.forEach(u=>u.ignoreDrivers=!0),{symbol:a}}function A8(t,e,i,r){const n=M5e(t,{},{context:r,isLabelSymbol:!1});n!=null&&(e[i]=n)}function pce(t,e,i,r){const n=M5e(t,{},{context:r,isLabelSymbol:!0});n!=null&&(e[i]=n)}function fce(t){return t instanceof yE||t instanceof Ew}function M5e(t,e,i){if(t==null)return null;const{context:r,isLabelSymbol:n}=i,s=r?.origin,a=r?.messages;if(s==="web-scene"&&!fce(t)){const u=Ndt(t,{retainCIM:!0,hasLabelingContext:n});return u.symbol!=null?u.symbol.write(e,r):(a?.push(new de("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:u.error})),null)}return(s==="web-map"||s==="portal-item"&&!Qme(r?.layer))&&fce(t)?(a?.push(new de("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function P5e(t,e){return yje(t,null,e)}function Fdt(t,e,i,r){const n=t.name;return n==null?Promise.reject(new de("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?kdt(n,e,r):ZQ(t,e,r).then(s=>eee(s,n,e,i,R5e,r))}function QQ(t,e){return e.items.find(i=>i.name===t)}function eee(t,e,i,r,n,s){const a=i?.portal!=null?i.portal:Zs.getDefault(),u={portal:a,url:Nn(t.baseUrl),origin:"portal-item"},p=QQ(e,t.data);if(!p){const O=`The symbol name '${e}' could not be found`;return Promise.reject(new de("symbolstyleutils:symbol-name-not-found",O,{symbolName:e}))}let y=hv(n(p,r),u),b=p.thumbnail?.href??null;const S=p.thumbnail?.imageData;Aht()&&(y=kq(y)??"",b=kq(b));const C={portal:a,url:Nn(EJ(y)),origin:"portal-item"};return KQ(y,s).then(O=>{const P=r==="cimRef"?O5e(O.data):O.data,$=P5e(P,C);if($&&J2($)){if(b){const N=hv(b,u);$.thumbnail=new _2({url:N})}else S&&($.thumbnail=new _2({url:`data:image/png;base64,${S}`}));t.styleUrl?$.styleOrigin=new W4({portal:i.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&($.styleOrigin=new W4({portal:i.portal,styleName:t.styleName,name:e}))}return $})}function kdt(t,e,i){const r=Ddt.replaceAll(/\{SymbolName\}/gi,t),n=e.portal!=null?e.portal:Zs.getDefault();return KQ(r,i).then(s=>{const a=O5e(s.data);return P5e(a,{portal:n,url:Nn(EJ(r)),origin:"portal-item"})})}const zdt=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:eee,getStyleItemFromStyle:QQ,resolveWebStyleSymbol:Fdt},Symbol.toStringTag,{value:"Module"}));async function Udt(t){if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new de("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const i={portal:t.portal},r=await ZQ(t,i).catch(()=>null);if(r===null)return null;const n=QQ(e,r.data);if(n&&!n.formatInfos?.some(u=>u.type==="gltf_basisu"))return null;const s=await eee(r,e,i,"webRef",(u,p)=>R5e(u,p,["gltf_basisu","gltf"])).catch(()=>null);if(s===null||s.type!=="point-3d")return null;const a=s.symbolLayers.items[0];return a.type==="object"?a.resource:null}let jdt=class{constructor(e,i,r){this._elementSize=i,this._buffer=xr.createVertex(e,dr.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.byteLength}copyRange(e,i,r,n=0){const s=new Uint8Array(this.array,e*this.elementSize,(i-e)*this.elementSize);new Uint8Array(r.array,n*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(e,i){const r=e*this._elementSize,n=i*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,n)}resize(e){const i=e*this._elementSize,r=new ArrayBuffer(i);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=e}},Bdt=class{constructor(e){this.modelOriginHi=e.getField(X.INSTANCEMODELORIGINHI,lo),this.modelOriginLo=e.getField(X.INSTANCEMODELORIGINLO,lo),this.model=e.getField(X.INSTANCEMODEL,bv),this.modelNormal=e.getField(X.INSTANCEMODELNORMAL,bv),this.featureAttribute=e.getField(X.INSTANCEFEATUREATTRIBUTE,zp),this.color=e.getField(X.INSTANCECOLOR,ja),this.objectAndLayerIdColor=e.getField(X.INSTANCEOBJECTANDLAYERIDCOLOR,ja)}},mce=class{constructor(e,i){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,i=this._tailIndex;return e>=i?e-i:e+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){zt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){zt(this._updating,"not updating"),this.size<jPe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){zt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),zt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){zt(this._updating,"not updating"),zt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(O8,Math.floor(this._capacity*pD));this._resize(e)}_shrink(){const e=Math.max(O8,Math.floor(this._capacity*UPe));this._resize(e)}_resize(e){if(zt(this._updating,"not updating"),e===this._capacity)return;const i=new jdt(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,n=this._compactInstances(i);zt(n===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=i,this._view=new Bdt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,e),i-r):r>i?(this._buffer.copyRange(r,this._capacity,e),i>0&&this._buffer.copyRange(0,i,e,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,i){e<i?this._buffer.transferRange(e,i):e>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(e,this._capacity))}};const O8=64;var yn;function Vdt(t){let e=wn().mat4f64(X.LOCALTRANSFORM).mat4f64(X.GLOBALTRANSFORM).vec4f64(X.BOUNDINGSPHERE).vec3f64(X.MODELORIGIN).mat3f(X.INSTANCEMODEL).mat3f(X.INSTANCEMODELNORMAL).vec2f(X.MODELSCALEFACTORS);return t.includes(X.FEATUREATTRIBUTE)&&(e=e.vec4f(X.FEATUREATTRIBUTE)),t.includes(X.COLOR)&&(e=e.vec4u8(X.COLOR)),t.includes(X.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(X.OBJECTANDLAYERIDCOLOR)),e=e.u8(X.STATE).u8(X.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(yn||(yn={}));let gce=class{constructor(e){this.localTransform=e.getField(X.LOCALTRANSFORM,sO),this.globalTransform=e.getField(X.GLOBALTRANSFORM,sO),this.modelOrigin=e.getField(X.MODELORIGIN,ud),this.model=e.getField(X.INSTANCEMODEL,bv),this.modelNormal=e.getField(X.INSTANCEMODELNORMAL,bv),this.modelScaleFactors=e.getField(X.MODELSCALEFACTORS,Pw),this.boundingSphere=e.getField(X.BOUNDINGSPHERE,N7),this.featureAttribute=e.getField(X.FEATUREATTRIBUTE,zp),this.color=e.getField(X.COLOR,ja),this.objectAndLayerIdColor=e.getField(X.OBJECTANDLAYERIDCOLOR,ja),this.state=e.getField(X.STATE,zS),this.lodLevel=e.getField(X.LODLEVEL,zS)}},$x=class extends Ke{constructor(e,i){super(e),this.events=new Xn,this._capacity=0,this._size=0,this._next=0,this._layout=Vdt(i),this._capacity=O8,this._buffer=this._layout.createBuffer(this._capacity),this._view=new gce(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,yn.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const i=this._view.state;zt(e>=0&&e<this._capacity&&(i.get(e)&yn.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,yn.ACTIVE)?this._setStateFlags(e,yn.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const i=this._view.state;zt(e>=0&&e<this._capacity&&(i.get(e)&yn.ALLOCATED)!=0,"invalid instance handle"),i.set(e,0),this._size--}setLocalTransform(e,i,r=!0){this._view.localTransform.setMat(e,i),r&&this.updateModelTransform(e)}getLocalTransform(e,i){this._view.localTransform.getMat(e,i)}setGlobalTransform(e,i,r=!0){this._view.globalTransform.setMat(e,i),r&&this.updateModelTransform(e)}getGlobalTransform(e,i){this._view.globalTransform.getMat(e,i)}updateModelTransform(e){const i=this._view,r=lc,n=Td;i.localTransform.getMat(e,yce),i.globalTransform.getMat(e,Nz);const s=Rr(Nz,Nz,yce);$e(r,s[12],s[13],s[14]),i.modelOrigin.setVec(e,r),sd(n,s),i.model.setMat(e,n);const a=xBe(lc,s);a.sort(),i.modelScaleFactors.set(e,0,a[1]),i.modelScaleFactors.set(e,1,a[2]),Rw(n,n),od(n,n),i.modelNormal.setMat(e,n),this._setStateFlags(e,yn.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,i){const r=this._view;r.model.getMat(e,Td),r.modelOrigin.getVec(e,lc),i[0]=Td[0],i[1]=Td[1],i[2]=Td[2],i[3]=0,i[4]=Td[3],i[5]=Td[4],i[6]=Td[5],i[7]=0,i[8]=Td[6],i[9]=Td[7],i[10]=Td[8],i[11]=0,i[12]=lc[0],i[13]=lc[1],i[14]=lc[2],i[15]=1}applyShaderTransformation(e,i){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedModelTransform(e,i){return this.getModelTransform(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedLocalTransform(e,i){this._view.localTransform.getMat(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedMaxScaleFactor(e){let i=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(lc,this,e),i*=Math.max(lc[0],lc[1],lc[2])),i}getCombinedMedianScaleFactor(e){let i=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(lc,this,e),i*=Gdt(lc[0],lc[1],lc[2])),i}getModel(e,i){this._view.model.getMat(e,i)}setFeatureAttribute(e,i){this._view.featureAttribute.setVec(e,i)}getFeatureAttribute(e,i){this._view.featureAttribute.getVec(e,i)}setColor(e,i){this._view.color.setVec(e,i)}setObjectAndLayerIdColor(e,i){this._view.objectAndLayerIdColor.setVec(e,i)}setVisible(e,i){i!==this.getVisible(e)&&(this._setStateFlag(e,yn.VISIBLE,i),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,yn.VISIBLE)}setHighlight(e,i){i!==this.getHighlight(e)&&(this._setStateFlag(e,yn.HIGHLIGHT,i),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,yn.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++i;return i}_setStateFlags(e,i){const r=this._view.state;i=r.get(e)|i,r.set(e,i)}_clearStateFlags(e,i){const r=this._view.state;i=r.get(e)&~i,r.set(e,i)}_setStateFlag(e,i,r){r?this._setStateFlags(e,i):this._clearStateFlags(e,i)}_getStateFlag(e,i){return!!(this._view.state.get(e)&i)}_grow(){this._capacity=Math.max(O8,Math.floor(this._capacity*pD)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new gce(this._buffer)}_findSlot(){const e=this._view.state;let i=this._next;for(;e.get(i)&yn.ALLOCATED;)i=i+1===this._capacity?0:i+1;return this._next=i+1===this._capacity?0:i+1,i}};function Gdt(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}_([T({constructOnly:!0})],$x.prototype,"shaderTransformation",void 0),_([T()],$x.prototype,"_size",void 0),_([T({readOnly:!0})],$x.prototype,"size",null),$x=_([Z("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],$x);const lc=H(),Td=Pn(),yce=Ze(),Nz=Ze();let Hdt=class extends bp{constructor(e,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=i,this._tmpSphere=as(),this._tmpMat4=Ze()}addInstance(e){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);wt(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*MS(r),i.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},qdt=class{constructor(e,i){this._worldSpaceRadius=e,this._minScreenSpaceRadii=i}selectLevel(e,i,r){const n=r.computeScreenPixelSizeAt(e),s=this._worldSpaceRadius*i/n;let a=0;for(let u=1;u<this._minScreenSpaceRadii.length;++u)s>=this._minScreenSpaceRadii[u]&&(a=u);return a}},Wdt=class extends x7{constructor(e,i,r,n,s,a){super(e,i),this.layerUid=e,this.graphicUid=i,this.geometryId=r,this.triangleNr=n,this.baseBoundingSphere=s,this.numLodLevels=a}};function tee(t){return Hp(t)&&t.intersector===En.LOD&&!!t.target}let Xdt=class{constructor(e,i){const r=e.renderContext.rctx,n=i.geometry;this._materialRepository=e.materialRepository,n.material.setParameters({instancedDoublePrecision:!0});const s=n.material.createBufferWriter(),a=s.vertexBufferLayout,u=s.elementCount(n),p=a.createBuffer(u);s.write(null,null,n,p,0),this.geometry=n,this.material=n.material,this.glMaterials=new mCe(n.material,this._materialRepository),this.vertexBufferLayout=a,this.vbo=xr.createVertex(r,dr.STATIC_DRAW,p.buffer),this.vao=new Wp(r,ar,{geometry:Kc(a)},{geometry:this.vbo}),this.vertexCount=u}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,i,r,n,s,a,u,p){const y=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,n,(b,S,C,O,P)=>{if(b>=0){if(i!=null&&!i(e.rayBegin,e.rayEnd,b))return;const $=new Wdt(a.layerUid,a.graphicUid(s),y,C,u,p);if((e.results.min.drapedLayerOrder==null||P>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||b<e.results.min.dist)&&e.results.min.set(En.LOD,$,b,S,e.transform.transform,P),e.options.store!==Jo.MIN&&(e.results.max.drapedLayerOrder==null||P>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||b>e.results.max.dist)&&e.results.max.set(En.LOD,$,b,S,e.transform.transform,P),e.options.store===Jo.ALL){const N=FZ(e.results.min.ray);N.set(En.LOD,$,b,S,e.transform.transform,P),e.results.all.push(N)}}})}},Jdt=class I5e{static async create(e,i,r){const n=await Promise.allSettled(i.components.map(a=>e.controller.schedule(()=>new Xdt(e,a),r))),s=n.map(a=>a.status==="fulfilled"?a.value:null).filter(gw);if(Ms(r)||s.length!==n.length){s.forEach(a=>a.destroy()),oi(r);for(const a of n)if(a.status==="rejected")throw a.reason}return new I5e(i.minScreenSpaceRadius,s)}constructor(e,i){this.minScreenSpaceRadius=e,this.components=i}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,i,r,n,s,a,u){this.components.forEach(p=>p.intersect(e,i,r,n,s,a,this.boundingSphere,u))}get boundingBox(){if(this._boundingBox==null){const e=cn();this.components.forEach(i=>{i.boundingInfo!=null&&(Np(e,i.boundingInfo.bbMin),Np(e,i.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,i=H();yp(e,i),this._boundingSphere={center:i,radius:.5*Xve(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,i)=>e+i.triangleCount,0)}};const Ydt=t=>{const e=t.baseBoundingSphere.radius,i=t.levels.map(r=>r.minScreenSpaceRadius);return new qdt(e,i)};let xh=class extends kZe{constructor(e,i){super(e),this.type=En.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new Kt,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[De.OPAQUE_MATERIAL,r=>this._produces(r)],[De.TRANSPARENT_MATERIAL,r=>!!this._hasTransparentLevels()&&this._produces(r)]]),this._instanceData=new $x({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(i.registerTask(Zt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=Kdt(this.optionalFields),this._glInstanceBufferLayout=Kc(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((e,i)=>i.reduce((r,n)=>r+n.usedMemory,e),0)}get renderStats(){const e=this._instanceData.size,i=[];return this._levels.forEach((r,n)=>{const s=this._allRenderInstanceData[0][n].size+this._allRenderInstanceData[1][n].size,a=r.triangleCount;i.push({renderedInstances:s,renderedTriangles:s*a,trianglesPerInstance:a})}),{totalInstances:e,renderedInstances:i.reduce((r,n)=>r+n.renderedInstances,0),renderedTriangles:i.reduce((r,n)=>r+n.renderedTriangles,0),levels:i}}async initializeRenderContext(e,i){this._context=e;const r=e.renderContext.rctx,n=await Promise.allSettled(this.symbol.levels.map(a=>(this._defaultRenderInstanceData[0].push(new mce(r,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new mce(r,this._instanceBufferLayout)),Jdt.create(e,a,i)))),s=n.map(a=>a.status==="fulfilled"?a.value:null).filter(gw);if(Ms(i)||s.length!==n.length){s.forEach(a=>a.destroy()),oi(i);for(const a of n)if(a.status==="rejected")throw a.reason}this._levels=s,this._levelSelector=Ydt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}_hasTransparentLevels(){return this._levels.some(e=>e.components.some(i=>i.material.produces(De.TRANSPARENT_MATERIAL,oe.Color)))}hasHighlights(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}_produces(e){return e!==oe.Highlight&&e!==oe.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!Xr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const i=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),i||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(ml),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const i=this._getInstanceDatas(e.output);if(!i)return null;const r=new Array;return i.forEach(n=>this.levels.forEach((s,a)=>{s.components.forEach(u=>r.push(this._beginComponent(e,n[a],u)))})),r}renderNode(e,i){const r=this._getInstanceDatas(e.output);if(!r||i==null)return;let n=0;e.rctx.bindVAO(),r.forEach(s=>this.levels.forEach((a,u)=>{a.components.forEach(p=>this._renderComponent(e,i[n++],s[u],p,u))}))}_getInstanceDatas(e){const i=e!==oe.Highlight&&e!==oe.ShadowHighlight,r=e!==oe.ShadowExcludeHighlight;return i&&r?this._allRenderInstanceData:i?this._defaultRenderInstanceData:r?this._highlightRenderInstanceData:null}intersect(e,i,r,n){if(!this.baseMaterial.isVisible()||this._octree==null)return;const s=H();Be(s,n,r);const a=u=>{this._instanceData.getCombinedModelTransform(u,bce),e.transform.set(bce),wt(wce,r,e.transform.inverse),wt(xce,n,e.transform.inverse);const p=this._instanceData.getState(u),y=this._instanceData.getLodLevel(u),b=this._levels.length;zt((p&yn.ACTIVE)!=0,"invalid instance state"),zt(y>=0&&y<b,"invaid lod level"),this._levels[y].intersect(e,i,wce,xce,u,this.metadata,b)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(a):this._octree.forEachAlongRay(r,s,a)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(this._octreeCached==null){const e=this._instanceData,i=e.view?.state;if(!i)return null;this._octreeCached=new Hdt(e,this.baseBoundingSphere);for(let r=0;r<e.capacity;++r)i.get(r)&yn.ACTIVE&&this._octreeCached.addInstance(r)}return this._octreeCached}_invalidateOctree(){this._octreeCached=ct(this._octreeCached)}queryDepthRange(e){if(this._octree==null)return{near:1/0,far:-1/0};const i=e.viewForward,r=this._octree.findClosest(i,bp.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(i,bp.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||n==null)return{near:1/0,far:-1/0};const s=e.eye,a=this._instanceData.view;a.boundingSphere.getVec(r,df),Be(df,df,s);const u=He(df,i)-df[3];a.boundingSphere.getVec(n,df),Be(df,df,s);const p=He(df,i)+df[3];return{near:Math.max(e.near,u),far:Math.min(e.far,p)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(i=>i.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:i,_camera:r,_levelSelector:n}=this;this._allRenderInstanceData.forEach(S=>S.forEach(C=>C.beginUpdate()));const s=this._instanceData,a=s.view;let u=s.size;const p=s.capacity;let y=this._instanceIndex;const b=Math.ceil(p/500);for(let S=0;S<u&&!e.done;++S){y===this._cycleStartIndex&&this._startUpdateCycle();const C=a.state.get(y);let O=0;if(!(C&yn.ALLOCATED)){y=y+1===p?0:y+1,u++;continue}const P=a.lodLevel.get(y);if(C&yn.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][P].freeTail(),C&yn.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][P].freeTail(),C&yn.REMOVE)s.freeInstance(y);else if(C&yn.VISIBLE){let $=0;i&&(a.modelOrigin.getVec(y,_ce),$=n.selectLevel(_ce,s.getCombinedMedianScaleFactor(y),r)),O=C&~(yn.ACTIVE|yn.TRANSFORM_CHANGED),$>=0&&(C&yn.HIGHLIGHT?(vce(this._highlightRenderInstanceData[0][$],a,y),O|=yn.HIGHLIGHT_ACTIVE):(vce(this._defaultRenderInstanceData[0][$],a,y),O|=yn.DEFAULT_ACTIVE)),a.state.set(y,O),a.lodLevel.set(y,$)}else O=C&~(yn.ACTIVE|yn.TRANSFORM_CHANGED),a.state.set(y,O);if(this._octreeCached!=null){const $=!!(C&yn.ACTIVE),N=!!(O&yn.ACTIVE);!$&&N?this._octreeCached.addInstance(y):$&&!N?this._octreeCached.removeInstance(y):$&&N&&C&yn.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(y),this._octreeCached.addInstance(y))}y=y+1===p?0:y+1,y%b==0&&e.madeProgress()}this._instanceIndex=y,this._allRenderInstanceData.forEach(S=>S.forEach(C=>C.endUpdate())),this._context.requestRender()}_beginComponent(e,i,r){if(i.size===0)return null;const n=r.glMaterials.load(e.rctx,e.bindParameters.slot,e.output);return n!=null?n.beginSlot(e.bindParameters):null}_renderComponent(e,i,r,n,s){if(!i)return;const{bindParameters:a,rctx:u}=e;u.runAppleAmdDriverHelper();const p=u.bindTechnique(i,n.material.parameters,a);u.bindVAO(n.vao),i.ensureAttributeLocations(n.vao),p.bindDraw(Qdt,a,n.material.parameters),Xr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===oe.Color&&(p.setUniform4fv("externalColor",Tce[Math.min(s,Tce.length-1)]),p.setUniform1i("colorMixMode",TTe.replace));const y=r.capacity,b=r.headIndex,S=r.tailIndex,C=r.firstIndex,O=this._glInstanceBufferLayout,P=($,N)=>{ZZ(u,ar,r.buffer,O,$),u.drawArraysInstanced(i.primitiveType,0,n.vertexCount,N-$),KZ(u,ar,r.buffer,O)};n.material.parameters.transparent&&C!=null?b>S?(zt(C>=S&&C<=b,"invalid firstIndex"),P(C,b),P(S,C)):b<S&&(C<=b?(zt(C>=0&&C<=b,"invalid firstIndex"),P(C,b),P(S,y),P(0,C)):(zt(C>=S&&C<=y,"invalid firstIndex"),P(C,y),P(0,b),P(S,C))):b>S?P(S,b):b<S&&(P(0,b),P(S,y)),u.bindVAO(null)}};function vce(t,e,i){const r=t.allocateHead();Zdt(e,i,t.view,r)}function Zdt(t,e,i,r){XYe(t.modelOrigin,e,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,t.model,e),i.modelNormal.copyFrom(r,t.modelNormal,e),t.color&&i.color&&i.color.copyFrom(r,t.color,e),t.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,t.objectAndLayerIdColor,e),t.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,t.featureAttribute,e)}function Kdt(t){let e=wn().vec3f(X.INSTANCEMODELORIGINHI).vec3f(X.INSTANCEMODELORIGINLO).mat3f(X.INSTANCEMODEL).mat3f(X.INSTANCEMODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(X.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(X.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(X.INSTANCEOBJECTANDLAYERIDCOLOR)),e}_([T({constructOnly:!0})],xh.prototype,"symbol",void 0),_([T({constructOnly:!0})],xh.prototype,"optionalFields",void 0),_([T({constructOnly:!0})],xh.prototype,"metadata",void 0),_([T({constructOnly:!0})],xh.prototype,"shaderTransformation",void 0),_([T()],xh.prototype,"_instanceData",void 0),_([T()],xh.prototype,"_cycleStartIndex",void 0),_([T({readOnly:!0})],xh.prototype,"_enableLevelSelection",null),_([T()],xh.prototype,"_updateCyclesWithStaticCamera",void 0),_([T({readOnly:!0})],xh.prototype,"running",null),xh=_([Z("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],xh);const _ce=H(),df=ji(),bce=Ze(),wce=H(),xce=H(),Tce=[vi(1,0,1,1),vi(0,0,1,1),vi(0,1,0,1),vi(1,1,0,1),vi(1,0,0,1)],Qdt=new Cnt;let Sce=class{constructor(e,i,r,n,s,a,u,p,y,b,S,C){this.lodResources=e,this.lodRenderer=i,this.stageResources=r,this.originalMaterialParameters=n,this.resourceSize=s,this.isEsriSymbolResource=a,this.isWosr=u,this.resourceBoundingBox=p,this.symbolSize=y,this.extentPadding=b,this.physicalBasedRenderingEnabled=S,this.pivotOffset=C}},ept=class extends q0{getCachedSize(){const[e,i,r]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:i,height:r}}constructor(e,i,r,n){super(e,i,r,n),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&sN(this.symbolLayer))throw new Error;if(this._isPrimitive){const i=this.symbolLayer.resource,r=i&&Irt(i.primitive)?i.primitive:n_e;this._resources=await this._createResourcesForPrimitive(r,e)}else{const i=await Udt(this.symbol.styleOrigin),r=i?.href??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(r,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}get materials(){return this._resources?.stageResources.materials??[]}_setMaterialTransparencyParameters(e,i=this.symbolLayer?.material?.color){const r=this._getCombinedOpacity(i),n=r<1||this.needsDrivenTransparentPass;return e.transparent=n,e.opacity=r,e.cullFace=n?rn.None:rn.Back,e}async _createResourcesForPrimitive(e,i){const r=this.symbolLayer,n=eo(ZUe(e)),s=Ma(gM(n)),a=Ma(OF(s,r)),u=Qe(a),p=!1,y=!1,b={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...lQ],ambient:rg,diffuse:rg,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},S=!!b.usePBR;this._setMaterialTransparencyParameters(b);const C=this.symbol;if(C.type==="point-3d"&&C.verticalOffset){const{screenLength:U,minWorldLength:j,maxWorldLength:G}=C.verticalOffset;b.verticalOffset={screenLength:Xo(U),minWorldLength:j||0,maxWorldLength:G??1/0},b.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(b.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)b.externalColor=Bh;else{const U=r.material!=null?r.material.color:null,j=U!=null?mt.toUnitRGBA(U):Bh;b.externalColor=j}this._fastUpdates=BS(this._context.renderer,this._fastVisualVariableConvertOptions(n,a,s,null)),b.isInstanced=!0,this._fastUpdates?(Object.assign(b,this._fastUpdates.materialParameters),this._optionalFields.push(X.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(b.hasInstancedColor=!0,this._optionalFields.push(X.COLOR)),Me("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(X.OBJECTANDLAYERIDCOLOR);const O=new Up(b),P=dSe(e,O);if(!P)throw new Error(`Unknown object symbol primitive: ${e}`);const $=PP(P).map(U=>({opacity:1,transparent:U.parameters.transparent})),N=await this._createStageResources(P,S,i),z=await this._createLodRenderer(P,i);return new Sce(P,z,N,$,s,p,y,n,a,u,S,null)}async _createResourcesForUrl(e,i){const r={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=BS(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(r.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(X.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(r.materialParameters.hasInstancedColor=!0,this._optionalFields.push(X.COLOR)),Me("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(X.OBJECTANDLAYERIDCOLOR);const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:le,minWorldLength:me,maxWorldLength:ne}=n.verticalOffset;r.materialParameters.verticalOffset={screenLength:Xo(le),minWorldLength:me||0,maxWorldLength:ne??1/0},r.materialParameters.castShadows=!1}const s=this._context.physicalBasedRenderingEnabled;r.signal=i,r.usePBR=s,r.skipHighLods=this._context.skipHighSymbolLods;const a=await E5e(e,r),u=a.isEsriSymbolResource,p=a.isWosr,y=Sht(a.lods),b=this._context,S=this.symbolLayer.material,C=this._getExternalColorParameters(S),O=this.symbolLayer?.material?.color,P=this._getCombinedOpacity(O,{hasIntrinsicColor:!0}),$=this.needsDrivenTransparentPass,N=PP(y),z=PP(y).map(le=>({opacity:le.parameters.opacity||1,transparent:le.parameters.transparent}));N.forEach(le=>{const me=le.parameters;le.setParameters(C);const ne=me.opacity*P,pe=ne<1||$||me.transparent;le.setParameters({opacity:ne,transparent:pe}),b.screenSizePerspectiveEnabled&&le.setParameters({screenSizePerspective:b.sharedResources.screenSizePerspectiveSettings})});const U=a.referenceBoundingBox,j=Ma(gM(U)),G=Ma(y.levels[0].pivotOffset),q=Ma(OF(j,this.symbolLayer)),W=Qe(q),K=this._fastUpdates;VS(K,this._context.renderer,this._fastVisualVariableConvertOptions(U,q,j,G))&&N.forEach(le=>le.setParameters(K.materialParameters));const se=await this._createStageResources(y,s,i),ae=await this._createLodRenderer(y,i);return new Sce(y,ae,se,z,j,u,p,U,q,W,s,G)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,i,r){const n=this._context.stage,s=PP(e);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),n.addMany(s),this._addDisposeResource(()=>n.removeMany(s));const a=Tae(e);n.addMany(a),this._addDisposeResource(()=>{a.forEach(p=>p.unload()),n.removeMany(a)}),await Promise.all(a.map(p=>this._context.stage.schedule(()=>p.load(n.renderView.renderingContext),r))),oi(r);const u=Sae(e);return n.addMany(u),this._addDisposeResource(()=>n.removeMany(u)),{materials:s,textures:a,geometries:u}}async _createLodRenderer(e,i){const r=this._context.stage,n={layerUid:this._context.layer.uid,graphicUid:p=>this._instanceIndexToGraphicUid.get(p),notifyGraphicGeometryChanged:p=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(p)),notifyGraphicVisibilityChanged:p=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(p))},s=this._fastUpdates,a=s?{applyTransform:(p,y,b)=>{p.getFeatureAttribute(y,e9),bs(b,Btt(s.materialParameters,e9,b))},scaleFactor:(p,y,b)=>{y.getFeatureAttribute(b,e9),GK(p,s.materialParameters,e9)}}:null,u=new xh({symbol:e,optionalFields:this._optionalFields,metadata:n,shaderTransformation:a},this._context.scheduler);return u.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(u),u.destroy()}),await r.addRenderPlugin(u,i),u}_getExternalColorParameters(e){const i={};return this._drivenProperties.color?i.externalColor=Bh:e?.color!=null?i.externalColor=mt.toUnitRGBA(e.color):(i.externalColor=Bh,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;const r=fO(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const n=this.setGraphicElevationContext(i),s=e.renderingInfo;return this._createAs3DShape(i,r,s,n,i.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(this._resources==null)return;const e=this._drivenProperties.opacity,i=!this._isPrimitive,r=this._resources.stageResources.materials,n=this._resources.originalMaterialParameters;for(let s=0;s<r.length;s++){const a=r[s],u=this.symbolLayer?.material?.color,p=n[s],y=this._getCombinedOpacity(u,{hasIntrinsicColor:i})*p.opacity,b=y<1||e||p.transparent;a.setParameters({opacity:y,transparent:b}),this._isPrimitive&&a.setParameters({cullFace:b?rn.None:rn.Back})}}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Ev)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:i}=this._resources;for(const r of e.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,i){if(this._resources==null)return _s.RecreateSymbol;const{stageResources:{materials:r},lodRenderer:n,resourceBoundingBox:s,symbolSize:a,resourceSize:u,pivotOffset:p}=this._resources;for(const y in e.diff){if(y!=="visualVariables"||!VS(this._fastUpdates,i,this._fastVisualVariableConvertOptions(s,a,u,p)))return _s.RecreateSymbol;for(const b of r)b.setParameters(this._fastUpdates.materialParameters);n.notifyShaderTransformationChanged()}return _s.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,i=VSe(e.levels),r=u=>Array.from(u.attributes.values()).reduce((p,y)=>p+rv(y.data,y.indices),0),n=Sae(e).reduce((u,p)=>u+r(p),0),s=Tae(e).reduce((u,p)=>u+p.memoryEstimate,0)+n,a={...BSe(this.symbol,this.symbolLayer),resourceBytes:s};return new Ih({verticesPerFeature:i,memory:a})}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,i,r,n,s,a){if(!this._hasLodRenderer()||this._resources==null)return null;const u=this.getFastUpdateAttrValues(e),p=this._context.clippingExtent;if(Wc(i,$3,this._context.elevationProvider.spatialReference),p!=null&&!YY(p,$3))return null;const y=this._requiresTerrainElevation(n),b=this._computeGlobalTransform(i,n,Fz,t9),S=this._computeLocalTransform(this._resources,this.symbolLayer,r,Ece),C=this._resources.lodRenderer.instanceData,O=C.addInstance();this._instanceIndexToGraphicUid.set(O,s),C.setLocalTransform(O,S,!1),C.setGlobalTransform(O,b),u&&C.setFeatureAttribute(O,u),this._fastUpdates==null&&this._hasPerInstanceColor()&&C.setColor(O,t4(r.color,r.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&C.setObjectAndLayerIdColor(O,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:s,layerUid:a}));const P=new wht(this,O,vrt,n);return y&&(P.alignedSampledElevation=t9.sampledElevation),P.needsElevationUpdates=Ev(n.mode),pO(P,i,this._context.elevationProvider),P}_computeGlobalTransform(e,i,r,n){return Sv(e,this._context.elevationProvider,i,this._context.renderCoordsHelper,n),$3[0]=e.x,$3[1]=e.y,$3[2]=n.z,jc(e.spatialReference,$3,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,i,r,n){return id(n),this._applyObjectRotation(r,!1,n),this._applyObjectRotation(i,!0,n),this._applyObjectScale(e,r,n),this._applyAnchor(e,i,n),n}_applyObjectScale(e,i,r){if(this._fastUpdates?.requiresShaderTransformation)return;const n=this._drivenProperties.size&&i.size?i.size:e.symbolSize,s=wae(n,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);s[0]===1&&s[1]===1&&s[2]===1||JO(r,r,s)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchTransform(e,i),this._preparePatchColor(e,i)}updateGeometry(e,i){if(this._resources==null)return!0;const r=i&&fO(i);if(r==null)return!1;const n=this.getGeometryElevationMode(i);return e.elevationContext.mode===n&&(this._computeGlobalTransform(r,e.elevationContext,Fz,t9),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=t9.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,Fz,!0),pO(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||this._resources==null)return;const r=(P,$,N)=>(P!=null&&P.type==="complete"?P.newValue:$)??N,n=r(i.heading,this.symbolLayer.heading,0),s=r(i.tilt,this.symbolLayer.tilt,0),a=r(i.roll,this.symbolLayer.roll,0),u=r(i.width,this.symbolLayer.width,void 0),p=r(i.height,this.symbolLayer.height,void 0),y=r(i.depth,this.symbolLayer.depth,void 0),b=r(i.anchor,this.symbolLayer.anchor,void 0),S=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const C={heading:n,tilt:s,roll:a,anchor:b,anchorPosition:S},O=this._resources;this.loadStatus===Ru.LOADED&&e.symbolLayerStatePatches.push(()=>{O.symbolSize=Ma(OF(O.resourceSize,{width:u,height:p,depth:y,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((P,$)=>{const N=this._computeLocalTransform(O,C,$,Ece),z=P.instanceIndex;O.lodRenderer.instanceData.setLocalTransform(z,N,!0)})}_preparePatchColor(e,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const n=r.color.newValue,s=n!=null?mt.toUnitRGBA(n):Bh;delete r.color;const a=this._resources;a!=null&&e.graphics3DGraphicPatches.push(u=>{let p;this._hasPerInstanceColor()?(a.lodRenderer.instanceData.setColor(u.instanceIndex,s),p=this._setMaterialTransparencyParameters({},n)):p=this._setMaterialTransparencyParameters({externalColor:s},n);for(const y of a.stageResources.materials)y.setParameters(p)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,i,r){if(!this._fastUpdates?.requiresShaderTransformation||!i)return art(e.heading,e.tilt,e.roll,r)}_computeAnchor(e,i,r){const n=H();switch(r.anchor){case"center":Ie(n,yp(e)),ka(n,n);break;case"top":{const s=yp(e);$e(n,-s[0],-s[1],-e[5]);break}case"bottom":{const s=yp(e);$e(n,-s[0],-s[1],-e[2]);break}case"relative":{const s=yp(e),a=gM(e),u=r.anchorPosition,p=u?st(u.x,u.y,u.z):Mo;ID(n,a,p),Ue(n,n,s),ka(n,n);break}default:i!=null?ka(n,i):Ie(n,Mo)}return n}_applyAnchor(e,i,r){if(this._fastUpdates?.requiresShaderTransformation)return;const n=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,i);n&&ec(r,r,n)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,i,r,n){const s=e!=null?Ma(gM(e)):rg,a=e!=null?this._computeAnchor(e,n,this.symbolLayer):Mo,u=this._context.renderCoordsHelper.unitInMeters,p=wae(i??void 0,i,r,u),y=st(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new vR({size:!0,color:!0,rotation:!0,opacity:!1},s,i??rg,u,a,p,y)}};const $3=H(),Ece=Ze(),Fz=Ze(),e9=ji(),t9=new TR;let tpt=class{constructor(e,i,r,n){this.vertices=e,this.positionsES=i,this.offset=n;const s=e.length,a=Math.floor(s/2),u=this.offset+3*a,p=r[u],y=r[u+1],b=r[u+2];this.origin=st(p,y,b),this.positions=Fn(3*s);const S=this.offset+3*s;for(let C=this.offset;C<S;C+=3)this.positions[C]=r[C]-p,this.positions[C+1]=r[C+1]-y,this.positions[C+2]=r[C+2]-b;this.updatePathVertexInformation()}get usedMemory(){return rv(this.positions)}updatePathVertexInformation(){const e=this.vertices.length,i=this.vertices[0];let r=this.offset;const n=this.positions;i.vRight[0]=n[r+3]-n[r],i.vRight[1]=n[r+4]-n[r+1],i.vRight[2]=n[r+5]-n[r+2],r+=3;let s=Qe(i.vRight);i.vMinSiblingLength=s,We(i.vRight,i.vRight);let a=i;for(let u=1;u<e;++u){const p=this.vertices[u];if(p.vLeft=a.vRight,u<e-1){p.vRight[0]=n[r+3]-n[r],p.vRight[1]=n[r+4]-n[r+1],p.vRight[2]=n[r+5]-n[r+2];const y=Qe(p.vRight);p.vMinSiblingLength=Math.min(s,y),s=y,We(p.vRight,p.vRight)}else Ie(p.vRight,p.vLeft),p.vMinSiblingLength=s;a=p,r+=3}}},ipt=class{constructor(e,i,r,n,s,a={}){this.path=e,this.profile=i,this.extruder=r,this.startCap=n,this.endCap=s,this.options=a,this._extrusionVertexCount=0;const u=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*u+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const p=this.startCap.numVertices;this.numVerticesTotal+=p,this.endCap.vertexBufferStart=this.numVerticesTotal;const y=this.endCap.numVertices;this.numVerticesTotal+=y,this.pathVertexData=jYe(1*this.numVerticesTotal),this.profileRightAxes=Fn(4*this.numVerticesTotal),this.profileUpAxes=Fn(4*this.numVerticesTotal),this.profileVertexAndNormals=Fn(4*this.numVerticesTotal),this.positions=HL(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return rv(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(e,i,r,n,s){const a=4*this._extrusionVertexCount;if(this.profileRightAxes[a]=i.right[0],this.profileRightAxes[a+1]=i.right[1],this.profileRightAxes[a+2]=i.right[2],this.profileUpAxes[a]=i.up[0],this.profileUpAxes[a+1]=i.up[1],this.profileUpAxes[a+2]=i.up[2],this.profileVertexAndNormals[a]=r[0],this.profileVertexAndNormals[a+1]=r[1],this.profileVertexAndNormals[a+2]=n[0],this.profileVertexAndNormals[a+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,s){const u=this.path.vertices[e],p=u.maxStretchDistance;this.profileRightAxes[a+3]=u.rotationRight[0]*p,this.profileUpAxes[a+3]=u.rotationRight[1]*p}else this.profileRightAxes[a+3]=0,this.profileUpAxes[a+3]=0;++this._extrusionVertexCount}emitCapVertex(e,i,r,n,s,a){const u=4*this._extrusionVertexCount;this.profileRightAxes[u]=i.right[0],this.profileRightAxes[u+1]=i.right[1],this.profileRightAxes[u+2]=i.right[2],this.profileRightAxes[u+3]=s,this.profileUpAxes[u]=i.up[0],this.profileUpAxes[u+1]=i.up[1],this.profileUpAxes[u+2]=i.up[2],this.profileUpAxes[u+3]=a,this.profileVertexAndNormals[u]=r[0],this.profileVertexAndNormals[u+1]=r[1],this.profileVertexAndNormals[u+2]=n[0],this.profileVertexAndNormals[u+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:i,vertices:r}=this.path;this.positions=HL(e,i,3*r.length);let n=0;const s=(u,p,y,b,S)=>this.emitCapVertex(n,u,p,y,b,S),a=(u,p,y,b)=>this.emitVertex(n,u,p,y,b);for(this.startCap.rebuildConnectingProfileGeometry(r[n],this.profile,s),n=1;n<r.length-1;++n)this.extruder.extrude(r[n],this.profile,a);this.endCap.rebuildConnectingProfileGeometry(r[n],this.profile,s),n=0,this.startCap.rebuildCapGeometry(r[n],s),n=r.length-1,this.endCap.rebuildCapGeometry(r[n],s)}buildTopology(){const e=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let n=3*(2*(i*r));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.numIndices,this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const s=new Array,a=new Array,u=new Array,p=(y,b,S)=>{s.push(y),s.push(b),s.push(S),a.push(y),a.push(b),a.push(S),u.push(this.pathVertexData[y]),u.push(this.pathVertexData[b]),u.push(this.pathVertexData[S])};for(let y=0;y<i;++y){const b=this.profile.indices[2*y],S=this.profile.indices[2*y+1];for(let C=0;C<r;++C){const O=C*e+b,P=(C+1)*e+S,$=C*e+S;p(O,(C+1)*e+b,P),p(O,P,$)}}this.startCap.buildTopology(this.path.vertices[0],p),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],p),this.vertexIndices=v0(s),this.normalIndices=v0(a),this.pathVertexIndices=v0(u)}onPathChanged(){this._rebuildGeometry()}},iee=class{rebuildConnectingProfileGeometry(e,i,r){for(let n=0;n<i.vertices.length;++n)r(e.frame,i.vertices[n],i.normals[n],0,0)}},Cce=class extends iee{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},i9=class extends iee{constructor(e,i=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=i,this.flip=r}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,i,r){const n=this.profilePlaneOffset;for(let s=0;s<i.vertices.length;++s)r(e.frame,i.vertices[s],i.normals[s],n,0)}rebuildCapGeometry(e,i){const r=this.profile,n=this.flip?1:-1,s=this.profilePlaneOffset,a=$5e;Yi(a,0,0);for(let u=0;u<r.vertices.length;++u)i(e.frame,r.vertices[u],a,s,n)}buildTopology(e,i){const r=this.profile,n=this.vertexBufferStart+r.indices[0];for(let s=1;s<r.numSegments;++s){const a=r.indices[2*s],u=r.indices[2*s+1],p=this.vertexBufferStart+a,y=this.vertexBufferStart+u;this.flip?i(y,p,n):i(n,p,y)}}},Ace=class extends iee{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const i=this.profile;e+=2*i.numSegments*(this.numSegments-1);for(let r=0;r<i.numSegments;++r){const n=i.indices[2*r],s=i.indices[2*r+1];i.poleIndices[n]===i.poleIndices[s]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,i){const r=this.profile,n=e.frame,s=.5*this.sign,a=rpt,u=$5e;Yi(u,0,0);for(const p of r.poles)p.normal?i(n,p.position,p.normal,s,0):i(n,p.position,u,s,this.sign);if(this.breakNormals)for(let p=0;p<r.vertices.length;++p)i(n,r.vertices[p],r.normals[p],0,0);for(let p=0;p<this.numSegments-1;++p){const y=(1-(p+1)/this.numSegments)*Math.PI*.5,b=Math.sin(y),S=Math.cos(y);for(let C=0;C<r.vertices.length;++C){const O=r.poles[r.poleIndices[C]];i0(a,r.vertices[C],O.position),Ic(a,a,b),O.normal?(rp(a,a,O.position),i(n,a,O.normal,s*S,0)):(iO(u,a),Ic(u,u,b),rp(a,a,O.position),i(n,a,u,s*S,this.sign*S))}}}buildTopology(e,i){const r=this.profile,n=this.breakNormals?this.vertexBufferStart+r.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+r.poles.length+r.vertices.length:this.vertexBufferStart+r.poles.length;for(let a=0;a<r.numSegments;++a){const u=r.indices[2*a],p=r.indices[2*a+1],y=this.vertexBufferStart+r.poleIndices[u],b=this.vertexBufferStart+r.poleIndices[p];let S=n+u,C=n+p;for(let O=0;O<this.numSegments-1;++O){const P=s+O*r.vertices.length+u,$=s+O*r.vertices.length+p;this.flip?(i(P,C,S),i(C,P,$)):(i(S,C,P),i($,P,C)),S=P,C=$}this.flip?(i(y,C,S),y!==b&&i(y,b,C)):(i(S,C,y),y!==b&&i(C,b,y))}}};const rpt=Ct(),$5e=Ct();let npt=class{numProfilesPerJoin(){return 1}extrude(e,i,r){for(let n=0;n<i.vertices.length;++n)r(e.frame,i.vertices[n],i.normals[n],!1)}},kz=class{constructor(e,i){this.cutoffAngle=e,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,i,r){const n=opt,{rotationAngle:s,rotationRight:a,frame:u}=e;if(Math.abs(s)>=this.cutoffAngle){const p=e.rotationFrameUp;for(let y=0;y<this.numBendSubdivisions+1;++y){Zu(Rce,.5*-s+y*s/this.numBendSubdivisions,p),spt(n,u,Rce);for(let b=0;b<i.vertices.length;++b)Us(i.vertices[b],a)*s>=0?r(n,i.vertices[b],i.normals[b],!1):r(u,e.applyMiterStretch(Oce,i.vertices[b]),i.normals[b],!0)}}else for(let p=0;p<this.numBendSubdivisions+1;++p)for(let y=0;y<i.vertices.length;++y){const b=Us(i.vertices[y],a)*s>=0;r(u,e.applyMiterStretch(Oce,i.vertices[y]),i.normals[y],!b)}}},L5e=class{constructor(){this.up=H(),this.right=H()}};function spt(t,e,i){wt(t.up,e.up,i),wt(t.right,e.right,i)}const Oce=Ct(),Rce=Ze(),opt=new L5e;let apt=class extends Is{constructor(e,i,r,n,s,a){super(e,i,null,Gn.Mesh,a),this.path=r,this.geometrySR=n,this.stencilWidth=s}};var _0;function D5e(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(_0||(_0={}));let N5e=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},F5e=class extends N5e{constructor(e){super(e),this.vertexAttributeColor=vi(255,255,255,255),this.size=new Array,this.vertexAttributePosition=Fn(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:i,pathVertexData:r,path:n,positions:s,profileRightAxes:a,profileUpAxes:u,profileVertexAndNormals:p}=this.builder;for(let y=0;y<i;++y){let b=r[y];const S=b===0||b===n.vertices.length-1;b*=3;const C=dpt;let O=0,P=0;const $=4*y,N=$e(ppt,a[$],a[$+1],a[$+2]),z=$e(fpt,u[$],u[$+1],u[$+2]),U=Yi(Mce,p[$]*e[0],p[$+1]*e[1]);if(S)qt(C,z,N),O=a[$+3]*e[0],P=u[$+3];else{const W=cpt,K=upt;Yi(W,a[$+3],u[$+3]);const se=WZ(W);iO(W,W);const ae=Us(U,W);if(Math.abs(ae)>se){Yi(K,-W[1],W[0]);const le=Us(U,K);Ic(W,W,se*Math.sign(ae)),Ic(K,K,le),rp(U,W,K)}$e(C,0,0,0)}const j=$e(hpt,N[0]*U[0]+z[0]*U[1],N[1]*U[0]+z[1]*U[1],N[2]*U[0]+z[2]*U[1]),G=3*y;this.vertexAttributePosition[G]=s[b]+j[0]+C[0]*O,this.vertexAttributePosition[G+1]=s[b+1]+j[1]+C[1]*O,this.vertexAttributePosition[G+2]=s[b+2]+j[2]+C[2]*O;const q=Yi(Mce,p[$+2],p[$+3]);aw(this.vertexAttributeNormal,y,N[0]*q[0]+z[0]*q[1]+C[0]*P,N[1]*q[0]+z[1]*q[1]+C[1]*P,N[2]*q[0]+z[2]*q[1]+C[2]*P)}}createGeometryData(){const e=this.builder.vertexIndices.length,{normalIndices:i,vertexIndices:r}=this.builder;return[[X.POSITION,new Et(this.vertexAttributePosition,r,3,!0)],[X.NORMALCOMPRESSED,new Et(this.vertexAttributeNormal,i,2,!0)],[X.COLOR,new Et(this.vertexAttributeColor,Uv(e),4)]]}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,i,r){const n=this.builder.vertexIndices,s=new cR(this.vertexAttributePosition,3),a=n.length/3;_R(e,i,0,a,n,s,void 0,void 0,r)}},lpt=class extends N5e{constructor(e,i,r,n){super(e),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=n,this.vvData=null,this.baked=new F5e(e),this.vvData=Fn(4*this.builder.path.vertices.length);for(let s=0;s<this.builder.path.vertices.length;++s){this.vvData[4*s]=i,this.vvData[4*s+1]=r,this.vvData[4*s+2]=n;const a=s===0||s===this.builder.path.vertices.length-1;this.vvData[4*s+3]=a?1:0}}createGeometryData(){const{positions:e,profileRightAxes:i,profileUpAxes:r,profileVertexAndNormals:n,pathVertexIndices:s,vertexIndices:a}=this.builder;return[[X.POSITION,new Et(e,s,3,!0)],[X.PROFILERIGHT,new Et(i,a,4,!0)],[X.PROFILEUP,new Et(r,a,4,!0)],[X.PROFILEVERTEXANDNORMAL,new Et(n,a,4,!0)],[X.FEATUREVALUE,new Et(this.vvData,s,4,!0)]]}onPathChanged(e){super.onPathChanged(e);const i=e.getMutableAttribute(X.POSITION);i&&(i.data=this.builder.positions)}};const Mce=Ct(),cpt=Ct(),upt=Ct(),hpt=H(),dpt=H(),ppt=H(),fpt=H();function mpt(t,e){let i=null;const r=t.vertices.length,n=.99619469809,s=H(),a=H(),u=H(),p=H(),y=H(),b=H(),S=gr();let C=t.vertices[0];Ie(a,e),$e(s,0,1,0),XL(C.vRight,a,s,s,u,a,n),Ie(C.frame.up,a),Ie(C.frame.right,u);const O=t.positions;let P=t.offset;i=C;for(let $=1;$<r;++$){C=t.vertices[$],Ue(y,C.vLeft,C.vRight);let N=Qe(y);N>0?(N=1/Math.sqrt(N),y[0]=y[0]*N,y[1]=y[1]*N,y[2]=y[2]*N):(y[0]=C.vRight[0],y[1]=C.vRight[1],y[2]=C.vRight[2]),b[0]=O[P]+i.frame.up[0],b[1]=O[P+1]+i.frame.up[1],b[2]=O[P+2]+i.frame.up[2],P+=3;const z=$e(gpt,O[P],O[P+1],O[P+2]);lR(z,y,S),Cw(S,eh(b,C.vLeft),p)?(p[0]-=O[P],p[1]-=O[P+1],p[2]-=O[P+2],We(a,p),qt(u,y,a),We(u,u)):XL(y,i.frame.up,i.frame.right,s,u,a,n),Ie(C.frame.up,a),Ie(C.frame.right,u),i=C}}const gpt=H();let k5e=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,i){return this.vertices.push(E5(e)),this.normals.push(E5(i)),this.vertices.length-1}addPole(e,i=null){return this.poles.push({position:E5(e),normal:i?E5(i):null}),this.poles.length-1}addSegment(e,i=null){this.indices.push(e.v0),this.indices.push(e.v1),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.indices.length/2}translate(e,i){for(const r of this.vertices)r[0]+=e,r[1]+=i;for(const r of this.poles)r.position[0]+=e,r.position[1]+=i}get usedMemory(){return this.vertices.length*rv(this.vertices[0])*2+rv(this.indices)}};const z5e={top:[0,-.5],bottom:[0,.5]};function zz(t){const i=lSe,r=new k5e,n={v0:0,v1:0};r.addPole(Xi(0,0));for(let a=0;a<i;++a){const u=2*a*Math.PI/i,p=Math.cos(u),y=Math.sin(u),b=Xi(p*.5,y*.5),S=Xi(p,y);r.addVertex(b,S)}for(let a=0;a<i-1;++a){const u={v0:a,v1:a+1};r.addSegment(u,n)}const s={v0:i-1,v1:0};if(r.addSegment(s,n),t!=="center"){const a=z5e[t];r.translate(a[0],a[1])}return r}const ypt={center:zz("center"),top:zz("top"),bottom:zz("bottom")},vpt={center:Uz("center"),top:Uz("top"),bottom:Uz("bottom")};function Uz(t){const r=new k5e,n=Xi(.5*-1,.5*-1),s=Xi(.5*1,.5*-1),a=Xi(.5*1,.5*1),u=Xi(.5*-1,.5*1),p=Xi(0,-1),y=Xi(1,0),b=Xi(0,1),S=Xi(-1,0);if(r.addPole(Xi(0,.5*1),b),r.addPole(Xi(0,.5*1)),r.addPole(Xi(0,.5*-1)),r.addPole(Xi(0,.5*-1),p),r.addVertex(n,p),r.addVertex(s,p),r.addSegment({v0:0,v1:1},{v0:3,v1:3}),r.addVertex(s,y),r.addVertex(a,y),r.addSegment({v0:2,v1:3},{v0:2,v1:1}),r.addVertex(a,b),r.addVertex(u,b),r.addSegment({v0:4,v1:5},{v0:0,v1:0}),r.addVertex(u,S),r.addVertex(n,S),r.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const C=z5e[t];r.translate(C[0],C[1])}return r}function _pt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function bpt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function U5e(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function wpt(t,e){if(t===e){const i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function xpt(t,e){const i=e[0],r=e[1],n=e[2],s=e[3];let a=i*s-n*r;return a?(a=1/a,t[0]=s*a,t[1]=-r*a,t[2]=-n*a,t[3]=i*a,t):null}function Tpt(t,e){const i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t}function Spt(t){return t[0]*t[3]-t[2]*t[1]}function j5e(t,e,i){const r=e[0],n=e[1],s=e[2],a=e[3],u=i[0],p=i[1],y=i[2],b=i[3];return t[0]=r*u+s*p,t[1]=n*u+a*p,t[2]=r*y+s*b,t[3]=n*y+a*b,t}function Ept(t,e,i){const r=e[0],n=e[1],s=e[2],a=e[3],u=Math.sin(i),p=Math.cos(i);return t[0]=r*p+s*u,t[1]=n*p+a*u,t[2]=r*-u+s*p,t[3]=n*-u+a*p,t}function Cpt(t,e,i){const r=e[0],n=e[1],s=e[2],a=e[3],u=i[0],p=i[1];return t[0]=r*u,t[1]=n*u,t[2]=s*p,t[3]=a*p,t}function Apt(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t}function Opt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function Rpt(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Mpt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function Ppt(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]}function Ipt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function B5e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function $pt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Lpt(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],a=e[0],u=e[1],p=e[2],y=e[3],b=Ko();return Math.abs(i-a)<=b*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-u)<=b*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-p)<=b*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-y)<=b*Math.max(1,Math.abs(s),Math.abs(y))}function Dpt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Npt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}const Fpt=j5e,kpt=B5e;Object.freeze(Object.defineProperty({__proto__:null,LDU:Ppt,add:Ipt,adjoint:Tpt,copy:_pt,determinant:Spt,equals:Lpt,exactEquals:$pt,frob:Mpt,fromRotation:Apt,fromScaling:Opt,identity:bpt,invert:xpt,mul:Fpt,multiply:j5e,multiplyScalar:Dpt,multiplyScalarAndAdd:Npt,rotate:Ept,scale:Cpt,set:U5e,str:Rpt,sub:kpt,subtract:B5e,transpose:wpt},Symbol.toStringTag,{value:"Module"}));function V5e(){return[1,0,0,1]}function zpt(t){return[t[0],t[1],t[2],t[3]]}function Upt(t,e,i,r){return[t,e,i,r]}function jpt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:zpt,create:V5e,createView:jpt,fromValues:Upt},Symbol.toStringTag,{value:"Module"}));let G5e=class{constructor(){this.vLeft=H(),this.vRight=H(),this.vMinSiblingLength=0,this.frame=new L5e}setFrameFromUpVector(e){Ie(this.frame.up,e),Ue(AC,this.vLeft,this.vRight),We(AC,AC),Pe($ce,this.frame.up,He(AC,this.frame.up)),Be(r9,AC,$ce),We(r9,r9),qt(this.frame.right,r9,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},Bpt=class extends G5e{get rotationFrameUp(){return this.frame.up}get rotationRight(){return U_e}get rotationAngle(){return Pe(S1,this.frame.up,He(this.frame.up,this.vLeft)),Be(S1,this.vLeft,S1),ka(S1,S1),We(S1,S1),Pe(D3,this.frame.up,He(this.frame.up,this.vRight)),Be(D3,this.vRight,D3),We(D3,D3),qt(R8,this.rotationFrameUp,this.vLeft),Math.sign(He(R8,this.vRight))*(Math.PI-co(He(S1,D3)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)<=0)return i;const n=tB(Math.cos(.5*r));return Yi(e,(n-1+1)*i[0],i[1])}},Vpt=class extends G5e{get rotationFrameUp(){const e=Math.sign(He(this.frame.right,this.vRight));return qt(CC,this.vRight,this.vLeft),Pe(CC,CC,e),We(CC,CC)}get rotationRight(){const e=this.rotationFrameUp,i=He(e,this.frame.up),r=He(e,this.frame.right);return Pe(L3,this.frame.up,-r),Pe(Ice,this.frame.right,i),Ue(L3,L3,Ice),We(L3,L3),Gpt(Pce,this.frame,L3),Pce}get rotationAngle(){const e=Math.sign(He(this.frame.right,this.vRight));return ka(R8,this.vLeft),-e*(Math.PI-co(He(R8,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*tB(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)===0)return i;const n=tB(Math.cos(.5*r)),s=this.rotationRight,a=U5e(qpt,1+(n-1)*s[0]*s[0],(n-1)*s[0]*s[1],(n-1)*s[0]*s[1],1+(n-1)*s[1]*s[1]);return dwe(e,i,a)}};function Gpt(t,e,i){Yi(t,He(i,e.right),He(i,e.up))}function Hpt(t){switch(t){case _0.World:return new Bpt;case _0.Path:return new Vpt}}const CC=H(),Pce=Ct(),L3=H(),Ice=H(),R8=H(),S1=H(),D3=H(),$ce=H(),AC=H(),r9=H(),qpt=V5e(),jz=8;function Wpt(t,e){const i=X.FEATUREVALUE;t.attributes.add(i,"vec4");const r=t.vertex;r.code.add(F`
  bool isCapVertex() {
    return ${i}.w == 1.0;
  }
  `),r.uniforms.add(new Lr("size",n=>n.size)),e.vvSize?(r.uniforms.add(new _i("vvSizeMinSize",n=>n.vvSize.minSize),new _i("vvSizeMaxSize",n=>n.vvSize.maxSize),new _i("vvSizeOffset",n=>n.vvSize.offset),new _i("vvSizeFactor",n=>n.vvSize.factor)),r.code.add(F`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${i}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):r.code.add(F`vec2 getSize(){
return size;
}`),e.vvOpacity?(r.constants.add("vvOpacityNumber","int",jz),r.uniforms.add(new Wl("vvOpacityValues",n=>n.vvOpacity.values,jz),new Wl("vvOpacityOpacities",n=>n.vvOpacity.opacityValues,jz)),r.code.add(F`
    vec4 applyOpacity(vec4 color) {
      float value = ${i}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):r.code.add(F`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(r.constants.add("vvColorNumber","int",qT),r.uniforms.add(new Wl("vvColorValues",n=>n.vvColor.values,qT),new FTe("vvColorColors",n=>n.vvColor.colors,qT)),r.code.add(F`
    vec4 getColor() {
      float value = ${i}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):r.code.add(F`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(pR),t.attributes.add(X.PROFILERIGHT,"vec4"),t.attributes.add(X.PROFILEUP,"vec4"),t.attributes.add(X.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(F`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(F`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(F`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(F`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let Xpt=class extends wR{constructor(){super(...arguments),this.size=Xi(1,1)}};function Jpt(t){const e=new lr,{vertex:i,fragment:r}=e;switch(Uc(i,t),e.varyings.add("vpos","vec3"),e.include(Wpt,t),t.output!==oe.Color&&t.output!==oe.Alpha||(e.include(Zl,t),e.include(nw,t),e.include(EE,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.multipassEnabled&&e.varyings.add("depth","float"),i.code.add(F`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===oe.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(Jc,t),t.output){case oe.Alpha:e.include(ss,t),r.uniforms.add(new lt("opacity",n=>n.opacity)),r.code.add(F`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case oe.Color:e.include(ss,t),e.include(rw,t),e.include(CR,t),e.include(nw,t),e.include(mSe,t),kp(r,t),AR(r),PE(r),r.uniforms.add(i.uniforms.get("localOrigin"),new _i("ambient",n=>n.ambient),new _i("diffuse",n=>n.diffuse),new _i("specular",n=>n.specular),new lt("opacity",n=>n.opacity)),r.include(G0),U0(r),r.code.add(F`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===Ut.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case oe.Depth:case oe.Shadow:case oe.ShadowHighlight:case oe.ShadowExcludeHighlight:e.include(Zl,t),ew(e),e.varyings.add("depth","float"),i.code.add(F`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(ss,t),e.include($g,t),r.code.add(F`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case oe.Normal:e.include(Zl,t),e.include(vO,t),kS(i),e.varyings.add("vnormal","vec3"),i.code.add(F`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(ss,t),r.code.add(F`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case oe.Highlight:e.include(Zl,t),e.include(vO,t),e.varyings.add("vnormal","vec3"),i.code.add(F`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(ss,t),e.include(Bv,t),r.code.add(F`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const Ypt=Object.freeze(Object.defineProperty({__proto__:null,build:Jpt},Symbol.toStringTag,{value:"Module"})),H5e=new Map([[X.POSITION,0],[X.PROFILERIGHT,1],[X.PROFILEUP,2],[X.PROFILEVERTEXANDNORMAL,3],[X.FEATUREVALUE,4]]);let Zpt=class extends Xpt{constructor(){super(...arguments),this.ambient=st(.2,.2,.2),this.diffuse=st(.8,.8,.8),this.specular=st(0,0,0),this.opacity=1,this.origin=H(),this.modelTransformation=null}},q5e=class W5e extends wr{initializeConfiguration(e,i){i.spherical=e.viewingMode===ht.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new fr(e.rctx,W5e.shader.get().build(this.configuration),H5e)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===Ut.NONE,n=e===Ut.FrontFace;return mi({blending:i.output!==oe.Color&&i.output!==oe.Alpha||!i.transparent?null:r?Xu:Wg(e),culling:i.hasSlicePlane&&!i.transparent&&i.doubleSidedMode!==kn.None?wwe:null,depthTest:{func:Vv(e)},depthWrite:r||n?ic:null,colorWrite:Oi,stencilWrite:i.hasOccludees?P0:null,stencilTest:i.hasOccludees?Gv:null,polygonOffset:r||n?null:iN})}};q5e.shader=new pr(Ypt,()=>ke(()=>import("./Path.glsl-25614f07.js"),[],import.meta.url));let Fs=class extends _l{constructor(){super(...arguments),this.output=oe.Color,this.doubleSidedMode=kn.None,this.transparencyPassType=Ut.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};_([ce({count:oe.COUNT})],Fs.prototype,"output",void 0),_([ce({count:kn.COUNT})],Fs.prototype,"doubleSidedMode",void 0),_([ce({count:Ut.COUNT})],Fs.prototype,"transparencyPassType",void 0),_([ce()],Fs.prototype,"spherical",void 0),_([ce()],Fs.prototype,"receiveShadows",void 0),_([ce()],Fs.prototype,"receiveAmbientOcclusion",void 0),_([ce()],Fs.prototype,"vvSize",void 0),_([ce()],Fs.prototype,"vvColor",void 0),_([ce()],Fs.prototype,"vvOpacity",void 0),_([ce()],Fs.prototype,"hasSlicePlane",void 0),_([ce()],Fs.prototype,"transparent",void 0),_([ce()],Fs.prototype,"hasOccludees",void 0),_([ce()],Fs.prototype,"multipassEnabled",void 0),_([ce()],Fs.prototype,"cullAboveGround",void 0),_([ce()],Fs.prototype,"doublePrecisionRequiresObfuscation",void 0),_([ce({constValue:!1})],Fs.prototype,"occlusionPass",void 0),_([ce({constValue:Gt.Disabled})],Fs.prototype,"pbrMode",void 0),_([ce({constValue:!0})],Fs.prototype,"hasVvInstancing",void 0),_([ce({constValue:!1})],Fs.prototype,"useCustomDTRExponentForWater",void 0),_([ce({constValue:!1})],Fs.prototype,"useFillLights",void 0),_([ce({constValue:!1})],Fs.prototype,"hasColorTexture",void 0);let Kpt=class X5e extends jv{constructor(e){super(e,new eft),this.supportsEdges=!0,this._vertexAttributeLocations=H5e,this._configuration=new Fs,this._vertexBufferLayout=X5e.getVertexBufferLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==oe.Color&&e!==oe.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?kn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?kn.WindingOrder:kn.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=i.ssao!=null),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==oe.Shadow&&e!==oe.ShadowExcludeHighlight&&e!==oe.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,i,r,n,s,a){const u=e;if(!D5e(u))return;const p=u.path,y=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:N,factor:z,minSize:U,maxSize:j}=this.parameters.vvSize,G=p.sizeAttributeValue;y[0]*=Je(N[0]+G*z[0],U[0],j[0]),y[1]*=Je(N[2]+G*z[2],U[2],j[2])}const b=Math.max(y[0],y[1]),S=e.boundingInfo;if(S==null)return void this._intersectTriangles(p,y,n,s,a);const C=X2(S.bbMin[0]-b,S.bbMin[1]-b,S.bbMin[2]-b,S.bbMax[0]+b,S.bbMax[1]+b,S.bbMax[2]+b),O=[s[0]-n[0],s[1]-n[1],s[2]-n[2]],P=Math.sqrt(O[0]*O[0]+O[1]*O[1]+O[2]*O[2]),$=[P/O[0],P/O[1],P/O[2]];WK(C,n,$,r.tolerance)&&this._intersectTriangles(p,y,n,s,a)}_intersectTriangles(e,i,r,n,s){e.baked.size&&e.baked.size[0]===i[0]&&e.baked.size[1]===i[1]||e.baked.bake(i),e.baked.intersect(r,n,s)}createBufferWriter(){return new ME(this._vertexBufferLayout)}produces(e,i){switch(i){case oe.Shadow:case oe.ShadowHighlight:case oe.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case oe.Color:case oe.Alpha:case oe.Depth:case oe.Normal:case oe.Highlight:case oe.ObjectAndLayerIdColor:return e===(this.parameters.transparent?De.TRANSPARENT_MATERIAL:De.OPAQUE_MATERIAL)||e===De.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new Qpt(e)}static getVertexBufferLayout(){return wn().vec3f(X.POSITION).vec4f(X.PROFILERIGHT).vec4f(X.PROFILEUP).vec4f(X.PROFILEVERTEXANDNORMAL).vec4f(X.FEATUREVALUE)}},Qpt=class extends zv{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==oe.Color&&this._output!==oe.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(q5e,e)}},eft=class extends Zpt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const tft=["polyline"];let ift=class extends q0{constructor(e,i,r,n){super(e,i,r,n),this._intrinsicSize=Xi(1,1),this._upVectorAlignment=_0.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,i=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new vR({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,i],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=this._context.renderer?.visualVariables?.length>0?BS(this._context.renderer,this._vvConvertOptions):null;const r=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?_0.World:_0.Path;const n=this.symbolLayer.profile||"circle";switch(n){default:case"circle":this._profile=ypt[r];break;case"quad":this._profile=vpt[r]}switch(this.symbolLayer.join){case"round":this._extruder=new kz(0,aSe);break;case"bevel":this._extruder=new kz(0,1);break;case"miter":this._extruder=new kz(.8*Math.PI,1);break;default:this._extruder=new npt}const s=this.symbolLayer.cap||"butt";switch(s){case"none":this._startCap=new Cce,this._endCap=new Cce;break;case"butt":default:this._startCap=new i9(this._profile,0),this._endCap=new i9(this._profile,0,!0);break;case"square":this._startCap=new i9(this._profile,-.5),this._endCap=new i9(this._profile,.5,!0);break;case"round":{const C=n==="quad";this._startCap=new Ace({profile:this._profile,flip:!1,breakNormals:C,subdivisions:pq}),this._endCap=new Ace({profile:this._profile,flip:!0,breakNormals:C,subdivisions:pq});break}}const a=this.symbolLayer?.material?.color,u=this._getCombinedOpacityAndColor(a),p=Ma(u),y=u[3],b=y<1||this.needsDrivenTransparentPass,S={diffuse:p,ambient:p,opacity:y,transparent:b,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:b||s==="none"?rn.None:rn.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Yi(this._intrinsicSize,e,i),!dq(this._intrinsicSize[0])||!dq(this._intrinsicSize[1])))throw new de("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates?.visualVariables.size||Ic(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const C={...S,...this._fastUpdates.materialParameters,size:L_e(this._intrinsicSize)};this._materials[0]=new Kpt(C)}else S.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,S.normalType=_r.Compressed,this._materials[0]=new Up(S);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,tft,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i),n=e.renderingInfo;return this._createAs3DShape(i,n,r,i.uid)}layerOpacityChanged(){const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacity(e),r=i<1||this.needsDrivenTransparentPass;this._materials[0]?.setParameters({opacity:i,transparent:r})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Ev)}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._materials[0]?.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!VS(this._fastUpdates,i,this._vvConvertOptions))return _s.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return _s.FastUpdate}_getVertexData(e){let i=0;const r=e.paths,n=[],s=e.spatialReference,a=this._context.elevationProvider.spatialReference,u=this._context.renderCoordsHelper.spatialReference;for(const S of r)i+=S.length;const p=Ro(3*i);let y,b=0;for(const S of r){n.push({offset:b,numVertices:S.length});for(const C of S)p[b++]=C[0],p[b++]=C[1],p[b++]=e.hasZ?C[2]:0}return a==null||s.equals(a)||Mn(p,s,0,p,a,0,i)?(a==null||a.equals(u)?y=H3e(p):(y=Ro(3*i),Mn(p,a,0,y,u,0,i)),{pathVertexDataInfos:n,vertexDataES:p,vertexDataRS:y}):null}_createAs3DShape(e,i,r,n){this.usedMemory=0;const s=e.geometry,a=this._getVertexData(s);if(a==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(a.pathVertexDataInfos.length===0)return s.paths.length!==0&&s.paths.some(P=>P.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const u=new Array,p=s.spatialReference,y=eo(),b=this._context.renderCoordsHelper,S=new zZ(a.vertexDataES);for(const P of a.pathVertexDataInfos){const $=P.numVertices;if($<2)continue;const N=P.offset;if(this._context.clippingExtent!=null&&(cn(y),Fu(y,a.vertexDataES,N,$),!vp(y,this._context.clippingExtent)))continue;const z=new Array,U=N+3*$;for(let ae=N;ae<U;ae+=3){S.offset=ae;const le=lrt(S,this._context.elevationProvider,r,b);$e(is,a.vertexDataRS[ae],a.vertexDataRS[ae+1],a.vertexDataRS[ae+2]),b.setAltitude(is,le),a.vertexDataRS[ae]=is[0],a.vertexDataRS[ae+1]=is[1],a.vertexDataRS[ae+2]=is[2],z.push(Hpt(this._upVectorAlignment))}const j=new tpt(z,a.vertexDataES,a.vertexDataRS,N);J5e(j,this._upVectorAlignment,this._context.renderCoordsHelper);const G=new ipt(j,this._profile,this._extruder,this._startCap,this._endCap);let q=null;if(this._fastUpdates){const ae=this._fastUpdates.visualVariables,le=Ap(ae.size?.field,e)??0,me=Ap(ae.color?.field,e)??0,ne=Ap(ae.opacity?.field,e)??0;q=new lpt(G,le,me,ne)}else{const ae=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const ne=i.size;ae[0]*=Lce(ne[0],ne[2]==="symbol-value"?this.symbolLayer.height||0:ne[2],this.symbolLayer.width||0),ae[1]*=Lce(ne[2],ne[0]==="symbol-value"?this.symbolLayer.width||0:ne[0],this.symbolLayer.height||0)}let le;this._drivenProperties.color&&(le=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(le=le?[le[0],le[1],le[2],i.opacity]:[1,1,1,i.opacity]);const me=new F5e(G);me.bake(ae),le&&me.bakeVertexColors(le),q=me}const W=q.createGeometryData(),K=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),se=new apt(this._materials[0],W,q,p,this._stencilWidth,K);se.transformation=ec(Ze(),Cn,G.path.origin),u.push(se),this.usedMemory+=G.usedMemory}if(u.length===0)return null;const C=new Xg({geometries:u,layerUid:this._context.layer.uid,graphicUid:n}),O=new H0(this,C,u,null,null,(P,$,N,z,U)=>nft(P,$,z,U,this._upVectorAlignment),r);return O.alignedSampledElevation=0,O.needsElevationUpdates=Ev(r.mode),O}};function J5e(t,e,i){const{origin:r,positions:n}=t;let s=t.offset;switch(e){default:case _0.World:for(const a of t.vertices)is[0]=n[s++]+r[0],is[1]=n[s++]+r[1],is[2]=n[s++]+r[2],i.worldUpAtPosition(is,is),a.setFrameFromUpVector(is);break;case _0.Path:is[0]=n[s]+r[0],is[1]=n[s+1]+r[1],is[2]=n[s+2]+r[2],i.worldUpAtPosition(is,is),mpt(t,is)}}function Lce(t,e,i){switch(t){case"symbol-value":return i;case"proportional":return e;default:return t}}function rft(t,e,i,r){let n=0;const{origin:s,vertices:a,positions:u,positionsES:p}=t,y=t.offset+3*a.length;for(let b=t.offset;b<y;b+=3)$e(is,p[b],p[b+1],p[b+2]),i(is,Bz),n+=Bz.sampledElevation,is[0]=u[b]+s[0],is[1]=u[b+1]+s[1],is[2]=u[b+2]+s[2],r.setAltitude(is,Bz.z),u[b]=is[0]-s[0],u[b+1]=is[1]-s[1],u[b+2]=is[2]-s[2];return t.updatePathVertexInformation(),n/a.length}function nft(t,e,i,r,n){const s=t.stageObject,a=s.geometries;let u=0;for(const p of a){if(!D5e(p))continue;const y=p.path,b=y.builder.path;u+=rft(b,e,i,r),n!==_0.World&&J5e(b,n,r),y.onPathChanged(p),p.invalidateBoundingInfo(),s.geometryVertexAttributeUpdated(p,X.POSITION)}return u/a.length}const is=H(),Bz=new TR;function sft(t,e,i,r,n=1){if(i.isGeographic&&r===ht.Global){const y=Ro(e.length),b=e.length,S=Mr(i);for(let C=0;C<b;C+=3)vY(e,C,y,C,S);e=y}Yi(Bs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let y=0;y<e.length;y+=3)Bs[0]=Math.min(Bs[0],e[y]),Bs[1]=Math.min(Bs[1],e[y+1]);const s=Bs[0]%n,a=Bs[1]%n,u=Bs[0]-s,p=Bs[1]-a;for(let y=0;y<e.length;y+=3){const b=y/3*4;t[b]=(e[y]-u)/n,t[b+1]=(e[y+1]-p)/n,t[b+2]=u/n,t[b+3]=p/n}}function Y5e(t,e,i,r,n=1){$e(g_,1,0,0),$e(y_,0,1,0),$e(F3,0,0,1),aft(Vz,i),CBe(Dce,i)&&oft(Dce,g_,y_,F3,r,Vz),Yi(Bs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Yi(v_,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let b=0;b<i.length;b+=3){$e(N3,i[b],i[b+1],i[b+2]);const S=He(g_,N3),C=He(y_,N3);Bs[0]=Math.min(Bs[0],S),Bs[1]=Math.min(Bs[1],C),v_[0]=Math.max(v_[0],S),v_[1]=Math.max(v_[1],C)}const s=He(F3,Vz);Hz(E1,Bs[0],Bs[1],s,g_,y_,F3),Hz(__,v_[0],Bs[1],s,g_,y_,F3),Hz(b_,Bs[0],v_[1],s,g_,y_,F3),Be(__,__,E1),Pe(__,__,.5),Be(b_,b_,E1),Pe(b_,b_,.5),Ue(E1,E1,__),Ue(E1,E1,b_);const a=Bs[0]%n,u=Bs[1]%n,p=Bs[0]-a,y=Bs[1]-u;for(let b=0;b<i.length;b+=3){$e(N3,i[b],i[b+1],i[b+2]);const S=b/3,C=4*S;t[C]=(He(g_,N3)-p)/n,t[C+1]=(He(y_,N3)-y)/n,t[C+2]=p/n,t[C+3]=y/n;const O=9*S;for(let P=0;P<3;P++)e[O+P]=E1[P],e[O+P+3]=__[P],e[O+P+6]=b_[P]}}const Vz=H(),N3=H(),Dce=gr(),g_=H(),y_=H(),F3=H(),Bs=Ct(),v_=Ct(),E1=H(),__=H(),b_=H();function oft(t,e,i,r,n,s){n!=null?(n.basisMatrixAtPosition(s,pf),$e(n9,pf[0],pf[1],pf[2]),$e(s9,pf[4],pf[5],pf[6]),$e(Gz,pf[8],pf[9],pf[10])):($e(n9,1,0,0),$e(s9,0,1,0),$e(Gz,0,0,1));const a=t;He(a,Gz)<0&&Pe(a,a,-1),Ie(r,a);const u=He(a,s9),p=He(a,n9);Math.abs(u)>Math.abs(p)?(Xl(e,n9,a,-p),We(e,e),qt(i,e,a),We(i,i),Pe(i,i,-1)):(Xl(i,s9,a,-u),We(i,i),qt(e,i,a),We(e,e))}const pf=Ze(),n9=H(),s9=H(),Gz=H();function aft(t,e){$e(OC,0,0,0);for(let i=0;i<e.length-3;i+=3)OC[0]+=e[i],OC[1]+=e[i+1],OC[2]+=e[i+2];Pe(t,OC,1/(e.length/3-1))}const OC=H();function Hz(t,e,i,r,n,s,a){$e(t,e*n[0]+i*s[0]+r*a[0],e*n[1]+i*s[1]+r*a[1],e*n[2]+i*s[2]+r*a[2])}function lft(t){const e=new lr,{vertex:i,fragment:r,attributes:n,varyings:s}=e;Uc(i,t),e.include(Zl,t),e.include(Dw,t),e.include(fg,t),e.include(bR,t),n.add(X.POSITION,"vec3"),t.vvColor&&n.add(X.COLORFEATUREATTRIBUTE,"float"),s.add("vColor","vec4"),s.add("vpos","vec3");const a=t.multipassEnabled&&(t.output===oe.Color||t.output===oe.Alpha);a&&s.add("depth","float"),i.uniforms.add(new er("eColor",y=>y.color));const u=t.output===oe.Depth;u&&(e.include($g,t),ew(e),_v(e)),i.code.add(F`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${a?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${u?F`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:F`transformPosition(proj, view, vpos);`}
    }
  `),e.include(ss,t),a&&e.include(Jc,t),r.include(G0);const p=t.output===oe.Highlight;return p&&e.include(Bv,t),r.code.add(F`
  void main() {
    discardBySlice(vpos);
    ${a?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${t.output===oe.ObjectAndLayerIdColor?F`fColor.a = 1.0;`:""}

    if (fColor.a < ${F.float(Wo)}) {
      discard;
    }

    ${t.output===oe.Alpha?F`fragColor = vec4(fColor.a);`:""}

    ${t.output===oe.Color?F`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===Ut.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${p?F`outputHighlight();`:""};
    ${t.output===oe.Depth?F`outputDepth(linearDepth);`:""};
    ${t.output===oe.ObjectAndLayerIdColor?F`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const cft=Object.freeze(Object.defineProperty({__proto__:null,build:lft},Symbol.toStringTag,{value:"Module"}));let Z5e=class K5e extends wr{initializeProgram(e){return new fr(e.rctx,K5e.shader.get().build(this.configuration),ar)}_createPipeline(e,i){const r=this.configuration,n=e===Ut.NONE,s=e===Ut.FrontFace;return mi({blending:r.output!==oe.Color&&r.output!==oe.Alpha||!r.transparent?null:n?Xu:Wg(e),culling:P7(r.cullFace),depthTest:{func:Vv(e)},depthWrite:(n||s)&&r.writeDepth?ic:null,colorWrite:Oi,stencilWrite:r.hasOccludees?P0:null,stencilTest:r.hasOccludees?i?Cv:Gv:null,polygonOffset:n||s?r.polygonOffset?uft:null:rN(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};Z5e.shader=new pr(cft,()=>ke(()=>import("./ColorMaterial.glsl-ff41a67f.js"),[],import.meta.url));const uft={factor:1,units:1};let ko=class extends _l{constructor(){super(...arguments),this.output=oe.Color,this.cullFace=rn.None,this.transparencyPassType=Ut.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}};_([ce({count:oe.COUNT})],ko.prototype,"output",void 0),_([ce({count:rn.COUNT})],ko.prototype,"cullFace",void 0),_([ce({count:Ut.COUNT})],ko.prototype,"transparencyPassType",void 0),_([ce()],ko.prototype,"hasSlicePlane",void 0),_([ce()],ko.prototype,"hasVertexColors",void 0),_([ce()],ko.prototype,"transparent",void 0),_([ce()],ko.prototype,"polygonOffset",void 0),_([ce()],ko.prototype,"enableOffset",void 0),_([ce()],ko.prototype,"writeDepth",void 0),_([ce()],ko.prototype,"hasOccludees",void 0),_([ce()],ko.prototype,"multipassEnabled",void 0),_([ce()],ko.prototype,"cullAboveGround",void 0),_([ce()],ko.prototype,"objectAndLayerIdColorInstanced",void 0),_([ce()],ko.prototype,"vvColor",void 0),_([ce({constValue:!1})],ko.prototype,"occlusionPass",void 0),_([ce({constValue:!0})],ko.prototype,"hasVvInstancing",void 0),_([ce({constValue:!1})],ko.prototype,"vvSize",void 0),_([ce({constValue:!1})],ko.prototype,"vvOpacity",void 0);let Nce=class extends $Q{constructor(e){super(e,new dft),this.supportsEdges=!0,this._configuration=new ko}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<tN,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}produces(e,i){return i===oe.Color||i===oe.Alpha||i===oe.Highlight||i===oe.Depth&&this.parameters.writeLinearDepth||i===oe.ObjectAndLayerIdColor?e===De.DRAPED_MATERIAL?!0:i===oe.Highlight?e===De.OPAQUE_MATERIAL:e===(this._isTransparent?this.parameters.writeDepth?De.TRANSPARENT_MATERIAL:De.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:De.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new hft(e)}createBufferWriter(){const e=wn().vec3f(X.POSITION);return Me("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(X.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(X.COLORFEATUREATTRIBUTE):e.vec4u8(X.COLOR),new ME(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}},hft=class extends zv{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==oe.Color&&this._output!==oe.Alpha||this._updateOccludeeState(e),this.ensureTechnique(Z5e,e)}},dft=class extends wR{constructor(){super(...arguments),this.color=qu,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=rn.None,this.hasOccludees=!1}};var qo;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(qo||(qo={}));const zq=.70710678118,Fce=zq,pft=.08715574274;function fft(t){const e=new lr,i=t.multipassEnabled&&(t.output===oe.Color||t.output===oe.Alpha),{vertex:r,fragment:n,attributes:s,varyings:a}=e;Uc(r,t),e.include(Zl,t),e.include(Dw,t),e.include(fg,t),t.draped?r.uniforms.add(new lt("worldToScreenRatio",(y,b)=>1/b.screenToPCSRatio)):s.add(X.BOUNDINGRECT,"mat3"),s.add(X.POSITION,"vec3"),s.add(X.UVMAPSPACE,"vec4"),t.vvColor&&s.add(X.COLORFEATUREATTRIBUTE,"float"),a.add("vColor","vec4"),a.add("vpos","vec3"),a.add("vuv","vec2"),i&&a.add("depth","float"),r.uniforms.add(new er("uColor",y=>y.color));const u=t.style===qo.ForwardDiagonal||t.style===qo.BackwardDiagonal||t.style===qo.DiagonalCross;u&&r.code.add(F`
      const mat2 rotate45 = mat2(${F.float(zq)}, ${F.float(-Fce)},
                                 ${F.float(Fce)}, ${F.float(zq)});
    `),t.draped||(kp(r,t),r.uniforms.add(new lt("worldToScreenPerDistanceRatio",(y,b)=>1/b.camera.perScreenPixelRatio)),r.code.add(F`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),r.code.add(F`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),r.code.add(F`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${F.float(pft)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),r.code.add(F`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${u?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${u?" * rotate45":""};

      ${t.draped?"":F`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${F.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const p=t.output===oe.Depth;return p&&(e.include($g,t),ew(e),_v(e)),r.code.add(F`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${p?F`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:F`transformPosition(proj, view, vpos);`}
    }
  `),e.include(ss,t),n.include(G0),t.draped&&n.uniforms.add(new lt("texelSize",(y,b)=>1/b.camera.pixelRatio)),t.output===oe.Highlight&&e.include(Bv,t),i&&e.include(Jc,t),t.output!==oe.Highlight&&(n.code.add(F`
      const float lineWidth = ${F.float(t.lineWidth)};
      const float spacing = ${F.float(t.patternSpacing)};
      const float spacingINV = ${F.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||n.code.add(F`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.code.add(F`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==oe.Highlight?F`color.a *= ${mft(t)};`:""}

      ${t.output===oe.ObjectAndLayerIdColor?F`color.a = 1.0;`:""}

      if (color.a < ${F.float(Wo)}) {
        discard;
      }

      ${t.output===oe.Alpha?F`fragColor = vec4(color.a);`:""}

      ${t.output===oe.Color?F`fragColor = color; ${t.transparencyPassType===Ut.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===oe.Highlight?F`outputHighlight();`:""}
      ${t.output===oe.Depth?F`outputDepth(linearDepth);`:""};
    }
  `),e}function mft(t){function e(i){return t.draped?F`coverage(vuv.${i}, texelSize)`:F`sampleAA(vuv.${i})`}switch(t.style){case qo.ForwardDiagonal:case qo.Horizontal:return e("y");case qo.BackwardDiagonal:case qo.Vertical:return e("x");case qo.DiagonalCross:case qo.Cross:return F`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const gft=Object.freeze(Object.defineProperty({__proto__:null,build:fft},Symbol.toStringTag,{value:"Module"}));let Q5e=class eAe extends wr{initializeProgram(e){return new fr(e.rctx,eAe.shader.get().build(this.configuration),tAe)}_setPipelineState(e,i){const r=this.configuration,n=e===Ut.NONE,s=e===Ut.FrontFace;return mi({blending:r.output===oe.Color||r.output===oe.Alpha?n?Xu:Wg(e):null,culling:P7(r.cullFace),depthTest:{func:Vv(e)},depthWrite:n?r.writeDepth?ic:null:eN(e),colorWrite:Oi,stencilWrite:r.hasOccludees?P0:null,stencilTest:r.hasOccludees?i?Cv:Gv:null,polygonOffset:n||s?r.polygonOffset?yft:null:rN(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};Q5e.shader=new pr(gft,()=>ke(()=>import("./Pattern.glsl-cb8e3a3a.js"),[],import.meta.url));const yft={factor:1,units:1};let ro=class extends _l{constructor(){super(...arguments),this.output=oe.Color,this.cullFace=rn.None,this.transparencyPassType=Ut.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.multipassEnabled=!1,this.cullAboveGround=!1,this.vvColor=!1}};_([ce({count:oe.COUNT})],ro.prototype,"output",void 0),_([ce({count:rn.COUNT})],ro.prototype,"cullFace",void 0),_([ce({count:qo.COUNT})],ro.prototype,"style",void 0),_([ce({count:Ut.COUNT})],ro.prototype,"transparencyPassType",void 0),_([ce()],ro.prototype,"hasSlicePlane",void 0),_([ce()],ro.prototype,"hasVertexColors",void 0),_([ce()],ro.prototype,"polygonOffset",void 0),_([ce()],ro.prototype,"writeDepth",void 0),_([ce()],ro.prototype,"hasOccludees",void 0),_([ce()],ro.prototype,"patternSpacing",void 0),_([ce()],ro.prototype,"lineWidth",void 0),_([ce()],ro.prototype,"enableOffset",void 0),_([ce()],ro.prototype,"draped",void 0),_([ce()],ro.prototype,"multipassEnabled",void 0),_([ce()],ro.prototype,"cullAboveGround",void 0),_([ce()],ro.prototype,"vvColor",void 0),_([ce({constValue:!1})],ro.prototype,"occlusionPass",void 0),_([ce({constValue:!1})],ro.prototype,"hasVvInstancing",void 0),_([ce({constValue:!1})],ro.prototype,"vvSize",void 0),_([ce({constValue:!1})],ro.prototype,"vvOpacity",void 0);const tAe=new Map([[X.POSITION,0],[X.COLOR,3],[X.UVMAPSPACE,4],[X.COLORFEATUREATTRIBUTE,5],[X.BOUNDINGRECT,6]]);let ree=class extends $Q{constructor(e){super(e,new bft),this.supportsEdges=!0,this._vertexAttributeLocations=tAe,this._configuration=new ro}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<tN,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}produces(e,i){return i===oe.Color||i===oe.Alpha||i===oe.Highlight||i===oe.Depth&&this.parameters.writeLinearDepth?e===De.DRAPED_MATERIAL?!0:i===oe.Highlight?e===De.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?De.TRANSPARENT_MATERIAL:De.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new vft(e)}createBufferWriter(){const e=wn().vec3f(X.POSITION).vec4f(X.UVMAPSPACE);return this.parameters.draped||e.mat3f(X.BOUNDINGRECT),this.parameters.vvColor?e.f32(X.COLORFEATUREATTRIBUTE):e.vec4u8(X.COLOR),new _ft(e)}},vft=class extends zv{_updateParameters(e){return this.ensureTechnique(Q5e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==oe.Color&&this._output!==oe.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},_ft=class extends ME{write(e,i,r,n,s){for(const a of this.vertexBufferLayout.fields.keys()){const u=r.attributes.get(a),p=u?.indices;if(u&&p)switch(a){case X.UVMAPSPACE:{zt(u.size===4);const y=n.getField(a,zp);y&&GS(u,y,s);break}case X.BOUNDINGRECT:{zt(u.size===9);const y=n.getField(a,bv);y&&this.writeBoundingRect(u,e,y,s);break}default:RTe(a,u,e,i,n,s)}}}writeBoundingRect(e,i,r,n){const{data:s,indices:a}=e,u=i,p=r.typedBuffer,y=r.typedBufferStride,b=a.length;n*=y;for(let S=0;S<b;++S){const C=9*a[S],O=s[C],P=s[C+1],$=s[C+2];p[n]=u[0]*O+u[4]*P+u[8]*$+u[12],p[n+1]=u[1]*O+u[5]*P+u[9]*$+u[13],p[n+2]=u[2]*O+u[6]*P+u[10]*$+u[14];for(let N=3;N<9;++N)p[n+N]=s[C+N];n+=y}}},bft=class extends wR{constructor(){super(...arguments),this.color=vi(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=rn.None,this.hasOccludees=!1,this.style=qo.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function wft(t,e){const i=t?.pattern??null;return i==null?new Nce(e):i.style==="none"||i.style==="solid"?(i.style==="none"&&(e.color=vi(0,0,0,0),e.forceTransparentMode=!0),new Nce(e)):(e.style=xft(i.style),new ree(e))}function xft(t){switch(t){case"horizontal":return qo.Horizontal;case"vertical":return qo.Vertical;case"cross":return qo.Cross;case"forward-diagonal":return qo.ForwardDiagonal;case"backward-diagonal":return qo.BackwardDiagonal;case"diagonal-cross":return qo.DiagonalCross;default:return}}function Tft(t){return t.material instanceof ree&&!t.material.parameters.draped}function Sft(t,e){if(Tft(t)){const i=t.attributes.get(X.POSITION).data,r=t.getMutableAttribute(X.UVMAPSPACE).data,n=t.getMutableAttribute(X.BOUNDINGRECT).data;Y5e(r,n,i,e)}}function Eft(t,e,i,r,n){const s=QTe(t,e,i,r,n),a=t.stageObject.geometries;for(const u of a)Sft(u,n);return s}const Cft=["polyline","polygon","extent"],kce=new vR({size:!1,color:!0,rotation:!1,opacity:!1});let iAe=class rAe extends q0{constructor(e,i,r,n){super(e,i,r,n),this._needsUV=!1}async doLoad(){this._fastUpdates=BS(this._context.renderer,kce)}_createMaterials(){if(this._materials.length>0)return;const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacityAndColor(e);this._materials[Qn.Fill]=wft(this.symbolLayer,{color:i,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters}),this._needsUV=this._materials[Qn.Fill]instanceof ree;const r=this.symbolLayer.outline;if(this._isValidOutline(r)){const n=qCe(r.pattern);this._materials[Qn.Outline]=new xT({width:Xo(r.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:n,cap:Iq(r.patternCap||"butt")})}this._context.stage.addMany(this._materials)}_isValidOutline(e){return e?.size!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Cft,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(n.mode==="on-the-ground"),this._createMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,n)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!VS(this._fastUpdates,i,kce))return _s.RecreateSymbol;this._materials[Qn.Fill]?.setParameters(this._fastUpdates.materialParameters)}return _s.FastUpdate}layerOpacityChanged(){if(this._materials[Qn.Fill]!=null){const e=this._materials[Qn.Fill].parameters.color,i=this.symbolLayer?.material?.color,r=this._getCombinedOpacity(i);this._materials[Qn.Fill].setParameters({color:[e[0],e[1],e[2],r],forceTransparentMode:this.needsDrivenTransparentPass})}if(this._materials[Qn.Outline]!=null){const e=this._materials[Qn.Outline].parameters.color;this._materials[Qn.Outline].setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=xR(rAe.elevationModeChangeTypes,r,n);if(s!==Hn.UPDATE)return s;const a=hd(n);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>a)}slicePlaneEnabledChanged(){if(this._materials[Qn.Fill]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Qn.Outline]){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[Qn.Outline].setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){const n=gO(e.geometry);if(!n)return null;const s=kQ(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),a=new Aft(s,i,this._context.layer.uid,e.uid),u=a.renderData.position.length/3;if(this._needsUV&&(a.uvMapSpace=Fn(4*u,!0),a.boundingRect=Ro(9*u,!0),Y5e(a.uvMapSpace,a.boundingRect,a.renderData.position,this._context.renderCoordsHelper)),a.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(a),this._createAs3DShapeFill(e,a),this._materials[Qn.Outline]&&this._createAs3DShapeOutline(a),this._logGeometryCreationWarnings(a.renderData,n.rings,"rings","FillSymbol3DLayer"),a.outGeometries.length===0)return null;const p=new Xg({geometries:a.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),y=new H0(this,p,a.outGeometries,null,null,Eft,r);return y.alignedSampledElevation=a.renderData.sampledElevation,y.needsElevationUpdates=hd(r.mode),y}_createAs3DShapeFill(e,i){const r=i.renderData.polygons;for(const{position:n,mapPositions:s,holeIndices:a,index:u,count:p}of r){if(this._context.clippingExtent!=null&&(cn(Sd),Fu(Sd,s),!vp(Sd,this._context.clippingExtent)))continue;const y=aot(s,a,this._context.elevationProvider.spatialReference);if(y.length===0)continue;const b=this._fastUpdates?.visualVariables.color,S=Xae({material:this._materials[Qn.Fill],indices:y,mapPositions:s,attributeData:{position:n,color:b?null:i.color,colorFeature:b?Ap(b.field,e):null,uvMapSpace:this._needsUV?HL(i.uvMapSpace,4*u,4*p):null,boundingRect:this._needsUV?Xh(i.boundingRect,9*u,9*p):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(S)}}_createAs3DShapeOutline(e){if(this._materials[Qn.Outline]==null)return;const i=e.renderData.outlines;for(const{mapPositions:r,position:n}of i){if(this._context.clippingExtent!=null&&(cn(Sd),Fu(Sd,r),!vp(Sd,this._context.clippingExtent)))continue;const s=$q(this._materials[Qn.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:r,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(s)}}_createAsOverlay(e,i){const r=gO(e.geometry);if(r==null)return null;this._materials[Qn.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,this._materials[Qn.Outline]!=null&&(this._materials[Qn.Outline].renderPriority=this._renderPriority);const n=ECe(r,this._context.overlaySR),s=new Oft(n,i,this._context.layer.uid,e.uid),a=s.renderData.position.length/3;return this._needsUV&&(s.uvMapSpace=Fn(4*a,!0),sft(s.uvMapSpace,s.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),s.outBoundingBox=cn(),s.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(s),this._createAsOverlayFill(e,s),this._materials[Qn.Outline]&&this._createAsOverlayOutline(s),this._logGeometryCreationWarnings(s.renderData,r.rings,"rings","FillSymbol3DLayer"),s.outGeometries.length===0?null:new bN(this,s.outGeometries,s.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,i){const r=i.renderData.polygons;for(const{position:n,holeIndices:s,index:a,count:u}of r){const p=cn(Sd);if(Fu(p,n),!vp(p,this._context.clippingExtent))continue;const y=WS(n,s,3);if(y.length===0)continue;AS(i.outBoundingBox,p);const b=this._fastUpdates?.visualVariables.color,S=Xae({material:this._materials[Qn.Fill],indices:y,attributeData:{position:n,color:b?null:i.color,colorFeature:b?Ap(b.field,e):null,uvMapSpace:this._needsUV?HL(i.uvMapSpace,4*a,4*u):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(new JS(S,i))}}_createAsOverlayOutline(e){if(this._materials[Qn.Outline]==null)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{position:n}=i[r];if(cn(Sd),Fu(Sd,n),!vp(Sd,this._context.clippingExtent))continue;AS(e.outBoundingBox,Sd);const s=$q(this._materials[Qn.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(new JS(s,e))}}_getOutlineOpacity(){const e=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){const e=this.symbolLayer?.outline?.color,i=this._getOutlineOpacity();return t4(e!=null?mt.toUnitRGB(e):null,i)}test(){return{...super.test(),createAsOverlay:(e,i)=>this._createAsOverlay(e,i),createAs3DShape:(e,i,r)=>this._createAs3DShape(e,i,r)}}};iAe.elevationModeChangeTypes={definedChanged:Hn.RECREATE,staysOnTheGround:Hn.NONE,onTheGroundChanged:Hn.RECREATE};const Sd=eo();let Aft=class extends vN{constructor(e,i,r,n){super(e,r,n),this.color=i}},Oft=class extends vN{constructor(e,i,r,n){super(e,r,n),this.color=i}};var Qn;(function(t){t[t.Fill=0]="Fill",t[t.Outline=1]="Outline"})(Qn||(Qn={}));let nAe=class{constructor(e,i="center",r=!1,n=Ct(),s=vi(0,0,0,-1),a="world",u=H(),p=0){this.verticalOffset=e,this.anchor=i,this.hasLabelVerticalOffset=r,this.screenOffset=n,this.centerOffset=s,this.centerOffsetUnits=a,this.translation=u,this.elevationOffset=p}},sAe=class{constructor(e,i="center",r="center",n=null,s=Ct()){this.placement=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=n,this.displaySize=s}};const Rft="arial-unicode-ms",zce="woff2",Uce=new Map,oAe=new Set;let Mft=class{constructor(e,i){this.fontFace=e,this.promise=i}};async function Pft(t){const e=Lft(t),i=Uce.get(e);if(i)return i.promise;const r=new FontFace(t.family,`url('${vr.fontsUrl}/woff2/${e}.${zce}') format('${zce}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(r)&&r.status==="loading")return r.loaded;const s=r.load().then(()=>(n.add(r),r));return Uce.set(e,new Mft(r,s)),oAe.add(r),s}function Ift(t){return oAe.has(t)}function $ft(t){if(!t)return Rft;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function Lft(t){const e=Dft(t)+Nft(t);return $ft(t.family)+(e.length>0?e:"-regular")}function Dft(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function Nft(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let aAe=class lAe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const i=this.definition.font,r="sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji";return`${i.style} ${i.weight} ${e}px ${i.family}, ${r}`}setFontProperties(e,i){e.font=this.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}_colorToRGB(e){return`rgb(${e.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(i=>Math.floor(255*i)).toString()},${e[3]})`}static async fromSymbol(e,i){const r=e?.material?.color,n=mt.toUnitRGBA(r)??qu,s=e.size!=null?Xo(e.size):12,a=e.lineHeight,u=e.background!=null?mt.toUnitRGBA(e.background.color):qu,p={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"},y=e.halo,b=y?.color!=null&&y.size>0?{size:Xo(y.size),color:mt.toUnitRGBA(y.color)}:{size:0,color:qu},S=new lAe({color:n,size:s,background:{color:u,padding:e.background!=null?[.65*s,.5*s]:[0,0],borderRadius:e.background!=null?s*(6/16):0},lineSpacingFactor:a,font:p,halo:b,pixelRatio:i});if(e.font){let C=!1;const O=S.fontString(s);try{C=(await document.fonts.load(O)).some(P=>!Ift(P))}catch{Ee.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${O}'. Some text symbology may be rendered using the default browser font.`)}if(!C&&!Fft.has(e.font.family))try{await Pft(e.font)}catch{}}return S}};const Fft=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),C1=4096;let u2=class extends Ke{constructor(e){super(e),this.type=Gn.Texture,this.id=zu(),this.events=new Xn,this._glTexture=null,this._atlas=new Uft(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=jt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return f4=0,[C1-A1-f4,C1-A1-f4-jce]}load(e){if(this._glTexture)return this._glTexture;const i=new Ar;return i.wrapMode=Ai.CLAMP_TO_EDGE,i.samplingMode=Si.LINEAR_MIPMAP_LINEAR,i.hasMipmap=!0,i.preMultiplyAlpha=!0,i.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new yi(e,i,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(Zt.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=nn(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=jt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.width.toString()),this._canvas.setAttribute("height",e.height.toString())}_resizeAtlas(e,i){const{width:r,height:n}=this._atlas;r===e&&n===i||(this._atlas.width=e,this._atlas.height=i,this._glTexture?.resize(e,i),this._glTexture?.updateData(0,0,0,r,n,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(s=>{this._stageObjects.get(s.textRenderer.key)?.forEach(u=>qz(u,s))}),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,i,r,n){const s=this._atlas;if(s.width<r||s.height<n)return!1;let a=s.cursors.get(n);if(!a){if(s.height<s.nextY+n)return!1;a=[new Bce(s.nextY)],s.cursors.set(n,a),s.nextY+=n}let u=a.find(p=>s.width>=p.x+r);if(u==null){if(s.height<s.nextY+n)return!1;u=new Bce(s.nextY),s.nextY+=n,a.push(u)}return e.setNewPosition(u),this._elements.set(i,e),this._elementsToRender.set(i,e),u.x+=r,!0}_ensureStageObjects(e){const i=this._stageObjects.get(e);if(i)return i;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,i){this._ensureStageObjects(e).add(i)}_removeStageObject(e,i){this._stageObjects.get(e)?.delete(i)&&(i.geometries[0].setAttributeData(X.SIZE,[0,0]),i.geometryVertexAttributeUpdated(i.geometries[0],X.SIZE),this._elementsToRender.delete(e))}_processAddition(e){const i=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(i,e);const r=this._atlas,n=e.textRenderer.renderedWidth,s=e.textRenderer.renderedHeight,a=n+A1,u=s+A1+jce;if(!this._addAtlasElement(e,i,a,u)){if(this._canRepack)this._reset();else if(r.width<a){const p=Math.min(S2(Math.max(a,1.5*r.width)),C1);this._resizeAtlas(p,r.height)}else{const p=r.nextY+u,y=Math.min(S2(Math.max(p,1.5*r.height)),C1);if(y>r.height)this._resizeAtlas(r.width,y);else if(r.width<C1){const b=Math.min(S2(1.5*r.width),C1);this._resizeAtlas(b,r.height)}}this._elements.set(i,e)}}_renderElement(e){const i=e.commitNewPosition();this._ctx.clearRect(i[0]-A1,i[1]-A1,e.textRenderer.renderedWidth+2*A1,e.textRenderer.renderedHeight+2*A1),e.textRenderer.render(this._ctx,i[0],i[1]),this._stageObjects.get(e.textRenderer.key)?.forEach(n=>qz(n,e))}get running(){return this.updating}runTask(e){if(this._glTexture==null)return ya.YIELD;for(;this._needsRepack&&(this._canRepack||this._atlas.height<C1&&this._atlas.height<C1);){this._canRepack=this._needsRepack=!1;const i=this._elements;this._elements=new Map,i.forEach(r=>this._processAddition(r)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[i,r]of this._elementsToRender){if(e.done)break;this._renderElement(r),this._elementsToRender.delete(i),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addTextTexture(e,i){const r=e.key;this._addStageObject(r,i);let n=this._elements.get(r);n==null&&(n=new zft(this._atlas,e),this._processAddition(n),this.setDirty()),kft(i,n),qz(i,n)}removeTextTexture(e,i){const r=e.key;if(!this._elements.get(r))return;this._removeStageObject(r,i);const n=this._stageObjects.get(r);n&&n.size!==0||this._elements.delete(r),n?.size===0&&this._stageObjects.delete(r),this._canRepack=!0}setDirty(){this._glTexture&&(this.updating=!0)}get test(){const{_elements:e,_stageObjects:i,_atlas:r}=this,n=this;return{elements:e,stageObjects:i,atlas:r,resizeAtlas:(s,a)=>n._resizeAtlas(s,a),run:s=>n.runTask(s)}}};function kft(t,e){t.geometries[0].setAttributeData(X.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],X.SIZE)}function qz(t,e){t.geometries[0].setAttributeData(X.UV0,e.uv),t.geometryVertexAttributeUpdated(t.geometries[0],X.UV0,!0)}_([T({constructOnly:!0})],u2.prototype,"view",void 0),_([T({type:Boolean})],u2.prototype,"updating",void 0),u2=_([Z("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],u2);const A1=2,jce=2;let zft=class{constructor(e,i){this._atlas=e,this.textRenderer=i,this._uv=ji(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return qu;const{renderedWidth:e,renderedHeight:i}=this.textRenderer;return _n(this._uv,this._xOffset/this._atlas.width,(this._yOffset+i)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},Uft=class{constructor(e,i){this.width=e,this.height=i,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=f4}},Bce=class{constructor(e){this.y=e,this.x=f4}},f4=0,jft=class{constructor(e,i,r){this._renderer=new kCe(e,i,r,u2.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=T8(Bft,this._renderer.renderedWidth,this._renderer.renderedHeight),i=e.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new Nw(e,{wrap:{s:Ai.CLAMP_TO_EDGE,t:Ai.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const Bft={canvas:null},Vft=[0,0,1];let Gft=class extends q0{constructor(e,i,r,n){super(e,i,r,n),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=sN(this.symbolLayer.size);if(e)throw new de("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await aAe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const i=e.graphic,r=fO(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const n=this.symbolLayer.text;if(n==null||n==="")return null;const s=rZ(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(s!=null&&!u_e(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:a}=this.symbolLayer,u=new nAe(s);Wct(a,u.screenOffset);const p=new sAe(u,this.symbolLayer.horizontalAlignment,qct(a));return this._createAs3DShape(i,r,n,p)}createLabel(e,i,r,n,s){const a=e.graphic,u=fO(a.geometry);if(u==null)return this.logger.warn(`unsupported geometry type for label: ${a.geometry.type}`),null;const p=i.text;return!p||/^\s+$/.test(p)?null:this._createAs3DShape(a,u,p,i,r,n,s)}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,i){return Vce(e,i,(r,n)=>{this.updateGraphicElevationContext(n,r)}),Hn.UPDATE}slicePlaneEnabledChanged(e,i){return Vce(e,i,r=>{for(const n of r.stageObject.geometries)n.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,i){const r=i.elevationContext;this.setGraphicElevationContext(e,r,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=hd(r.mode)||r.mode==="absolute-height"}_defaultElevationInfoNoZ(){return qft}_createAs3DShape(e,i,r,n,s=null,a=null,u=()=>n.placement.elevationOffset){const p=this.setGraphicElevationContext(e,new h8,n.placement.elevationOffset),y=e.geometry?.type==="polyline",b=e.uid;let S=null,C=null;if(a==null){const ae=UCe(n.horizontalPlacement);S=new jft(r,ae,this._textRenderParameters);let le=null;if(this._context.sharedResources.textures!=null){C=this._context.sharedResources.textures.fromData(S.key,()=>S.create()),C.texture.events.on("unloaded",()=>le?.release());const me=this._context.stage.renderView.textureRepository.acquire(C.texture.id);if(me==null||Yc(me))return C.release(),null;le=me}}const O=Hft(S,n),P={occlusionTest:!0,screenOffset:n.placement.screenOffset,anchorPosition:O,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:n.placement.centerOffsetUnits,drawInSecondSlot:!0};if(a?P.textureId=a.id:C&&(P.textureId=C.texture.id),n.placement.verticalOffset!=null){const{screenLength:ae,minWorldLength:le,maxWorldLength:me}=n.placement.verticalOffset;P.verticalOffset={screenLength:Xo(ae),minWorldLength:le||0,maxWorldLength:me??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:ae,screenSizePerspectiveSettingsLabels:le}=this._context.sharedResources,me=FCe(this._textRenderParameters);P.screenSizePerspective=le.overrideFontHeight(me.maxHeight),P.screenSizePerspectiveAlignment=ae}y&&(P.shaderPolygonOffset=1e-4),P.hasSlicePlane=this._context.slicePlaneEnabled;const $=(ae,le)=>{const me=JSON.stringify(le);let ne=ae.get(me);return ne==null&&(ne=new HS(le),ae.add(me,ne)),ne},N=s?$(s,P):new HS(P),z=n.placement.translation,U=S?Xi(S.displayWidth,S.displayHeight):Cg,j=n.placement.centerOffset,G=zH(N,Vft,z,null,U,j,[0,0],null),q=mQ(this._context,i,G,p,b);if(q==null)return null;const W=(ae,le,me,ne,pe,ge)=>{const ve=u()||n.placement.elevationOffset,Se=this.setGraphicElevationContext(e,le,ve);return C2(ae,Se,me,ne,pe,ge)},K=new H0(this,q.object,[G],s==null?[N]:null,C,W,p);K.alignedSampledElevation=q.sampledElevation,K.needsElevationUpdates=hd(p.mode)||p.mode==="absolute-height",K.getScreenSize=(ae=Ct())=>(ae[0]=S?S.displayWidth:n.displaySize[0],ae[1]=S?S.displayHeight:n.displaySize[1],ae);const se=new oSe(n.placement.elevationOffset,r);return K.metadata=se,pO(K,i,this._context.elevationProvider),K}};function Vce(t,e,i){t&&t.forEach(r=>{const n=e(r);n!=null&&i(n,r.graphic)})}function Hft(t,e){if(e.verticalPlacement==="baseline"){const r=Vct[e.horizontalPlacement],n=t!=null?t.baselineAnchorY:0;return Xi(r,n)}const i=Hct(e.horizontalPlacement,e.verticalPlacement);return D$[i]}const qft={mode:"relative-to-ground",offset:0},Wft={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Xft=["polyline","polygon","extent"];let Uq=class db extends q0{constructor(e,i,r,n){super(e,i,r,n)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Xft,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(this._materials[0])return;const e=new _Ce,i=this.symbolLayer.color;i!=null&&(e.color=mt.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?db.headingVectorFromAngle(this.symbolLayer.waveDirection):Xi(0,0);const n=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,s=Wft[n];e.waveStrength=s.waveStrength,e.waveTextureRepeat=s.textureRepeat,e.waveVelocity=s.waveVelocity,e.flowStrength=s.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._materials[0]=new vCe(e),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(this._materials[0]==null)return;const e=this._materials[0].parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],i],transparent:r})}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=xR(db.elevationModeChangeTypes,r,n);if(s!==Hn.UPDATE)return s;const a=hd(n);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>a)}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){const n=gO(e.geometry);if(n==null)return null;const s=kQ(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),a=s.position.length/3,u=Ro(2*a);this._createUVCoordsFromVertices(u,s.mapPositions,a,this._context.elevationProvider.spatialReference);const p=new Jft(s,u,this._context.layer.uid,e.uid);if(p.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(p),this._create3DShapeGeometries(p),this._logGeometryCreationWarnings(p.renderData,n.rings,"rings","WaterSymbol3DLayer"),p.outGeometries.length===0)return null;const y=new Xg({geometries:p.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),b=new H0(this,y,p.outGeometries,null,null,QTe,i);return b.alignedSampledElevation=p.renderData.sampledElevation,b.needsElevationUpdates=hd(i.mode),b}_createUVCoordsFromVertices(e,i,r,n){const s=Va(n);rd(O1);for(let p=0;p<r;p++)Yi(Gce,i[3*p],i[3*p+1]),sY(O1,Gce);B2(O1,O1,s);const a=O1[0]%db.unitSizeOfTexture,u=O1[1]%db.unitSizeOfTexture;o9[0]=O1[0]-a,o9[1]=O1[1]-u;for(let p=0;p<r;p++)e[2*p]=(i[3*p]*s-o9[0])/db.unitSizeOfTexture,e[2*p+1]=(i[3*p+1]*s-o9[1])/db.unitSizeOfTexture}_create3DShapeGeometries(e){const i=e.renderData.polygons,r=e.uvCoords;for(const{count:n,index:s,position:a,mapPositions:u,holeIndices:p}of i){if(this._context.clippingExtent!=null&&(cn(w_),Fu(w_,u),!vp(w_,this._context.clippingExtent)))continue;const y=WS(u,p,3);if(y.length===0)continue;const b=Xh(r,2*s,2*n),S=Jae({material:this._materials[0],indices:y,mapPositions:u,attributeData:{position:a,uv0:b}},e.objectAndLayerIdColor);e.outGeometries.push(S)}}_createAsOverlay(e){const i=gO(e.geometry);if(i==null)return null;this._materials[0].renderPriority=this._renderPriority;const r=ECe(i,this._context.overlaySR),n=r.position.length/3,s=Ro(2*n);this._createUVCoordsFromVertices(s,r.position,n,this._context.overlaySR);const a=new Yft(r,s,this._context.layer.uid,e.uid);return a.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(a),a.outBoundingBox=cn(),this._createAsOverlayWater(a),this._logGeometryCreationWarnings(a.renderData,i.rings,"rings","WaterSymbol3DLayer"),a.outGeometries.length===0?null:new bN(this,a.outGeometries,a.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const i=e.uvCoords,r=e.renderData.polygons;for(const{position:n,holeIndices:s,index:a,count:u}of r){if(cn(w_),Fu(w_,n),!vp(w_,this._context.clippingExtent))continue;AS(e.outBoundingBox,w_);const p=WS(n,s,3);if(p.length===0)continue;const y=Xh(i,2*a,2*u),b=Jae({material:this._materials[0],indices:p,attributeData:{position:n,uv0:y}},e.objectAndLayerIdColor);e.outGeometries.push(new JS(b,e))}}static headingVectorFromAngle(e){const i=Ct(),r=PD(e);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};Uq.unitSizeOfTexture=100,Uq.elevationModeChangeTypes={definedChanged:Hn.RECREATE,staysOnTheGround:Hn.NONE,onTheGroundChanged:Hn.RECREATE};const o9=Ct(),O1=Di(),Gce=Ct(),w_=eo();let Jft=class extends vN{constructor(e,i,r,n){super(e,r,n),this.uvCoords=i}},Yft=class extends vN{constructor(e,i,r,n){super(e,r,n),this.uvCoords=i}};function Zft(t,e,i,r){const n=Qft[t.type]?.[e.type]||Kft[e.type];return n?new n(t,e,i,r):(Ee.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const Kft={icon:Pq,object:ept,line:WCe,path:ift,fill:iAe,extrude:$lt,text:Gft,water:Uq},Qft={"mesh-3d":{fill:yht}};let e0t=class extends fQ{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const n=this.symbolLayers[r];n!=null&&(n.symbol=e,n.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const n=[];for(let s=0;s<r;s++){const a=i.at(s);if(a.enabled===!1)continue;a9.renderPriority=1-(1+s)/r,a9.renderPriorityStep=1/r,a9.ignoreDrivers=a.ignoreDrivers;const u=Zft(this.symbol,a,this._context,a9),p=kO(e,()=>{this.symbolLayers[s]=null,u.destroy()});p&&n.push(p),this.symbolLayers[s]=u}if(await CD(this.symbolLayers,async(s,a)=>{if(s!=null)try{await s.load(),this._extentPadding+=Math.max(this._extentPadding,s.extentPadding)}catch{this.symbolLayers[a]=null}}),n.forEach(s=>s.remove()),oi(e),this.symbolLayers.length&&!this.symbolLayers.some(s=>!!s))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return i!=null?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e?.queryForSnapping)}createGraphics3DGraphic(e,i){const r=e.graphic,n=this.symbolLayers.map(a=>a?.createGraphics3DGraphic(e)??null),s=this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null;return new kst(r,i||this,n,e.layer,s)}get complexity(){return pQ(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let n=0;n<r;n++){const s=this.symbolLayers[n],a=u=>{const p=u.layers[n];return p instanceof H0?p:null};if(s!=null&&!s.globalPropertyChanged(e,i,a))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==Ru.LOADED?_s.RecreateSymbol:this.symbolLayers.reduce((r,n)=>r!==_s.RecreateSymbol&&n!=null?Math.min(r,n.applyRendererDiff(e,i)):r,_s.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===Ru.FAILED||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((n,s)=>{if(n==null)return;const a=r[s];if(a){const u={diff:a,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};n.prepareSymbolLayerPatch(u),e.symbolStatePatches.push(...u.symbolLayerStatePatches),u.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((p,y)=>{const b=p.layers[s];b!=null&&u.graphics3DGraphicPatches.forEach(S=>S(b,y))})}})}updateGeometry(e,i){return this._updateGeometryOrTransform(e,(r,n)=>r.updateGeometry(n,i))}updateTransform(e,i,r,n){return this._updateGeometryOrTransform(e,(s,a)=>s.updateTransform(a,i,r,n))}_updateGeometryOrTransform(e,i){for(let r=0;r<this.symbolLayers.length;r++){const n=this.symbolLayers[r];if(n==null)continue;const s=e.layers[r];if(!s||!i(n,s))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(r==null)continue;const n=e.layers[i];n!=null&&r.onRemoveGraphic(n)}}getFastUpdateStatus(){let e=0,i=0,r=0;return this.symbolLayers.forEach(n=>{n!=null&&(n.loadStatus===Ru.LOADING?e++:n.isFastUpdatesEnabled()?r++:i++)}),{loading:e,slow:i,fast:r}}async queryForSnapping(e,i,r,n){const s=this.symbolLayers.filter(gw).filter(u=>u.queryForSnapping!=null).map(u=>u.queryForSnapping(e,i,r,n)),a=await Promise.all(s);return oi(n),a.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e?.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const a9=new zst;let t0t=class extends fQ{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:USe}globalPropertyChanged(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,i):_s.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,i)}updateTransform(e,i,r,n){return this.graphics3DSymbol?.updateTransform(e,i,r,n)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function nee(t){return t instanceof t0t?t.graphics3DSymbol:t instanceof e0t?t:null}const bO=Ee.getLogger("esri.views.3d.layers.graphics.labelPlacement");let i0t=class{constructor(e,i,r,n=null){this.graphics3DGraphic=e,this.labelSymbol=i,this.labelClass=r,this.disablePlacement=n}};function Hce(t){const e=h0t(t);if(e==null)return null;const i=r0t(t,e);if(i==null)return null;const r=i.anchor,n=!!e.hasLabelVerticalOffset,s=e.verticalOffset;return s0t(new nAe(s,r,n),i,t)}function r0t(t,e){if(e.anchor)return e;const i=t.labelClass.labelPlacement,r=wp[i],n=r||M8(t);return i&&!r&&bO.warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),n0t(n,t)}function see(t){const e=t.graphics3DGraphic.graphics3DSymbol,i=nee(e);return i!=null?i.symbol.symbolLayers.at(0):null}function n0t(t,e){const i=e.graphics3DGraphic.graphic.geometry;if(i==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(bO.warnOncePerTick(qce(t?.placement,e.disablePlacement.logEntityDescription)),M8(e)):t;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return bO.warnOncePerTick(qce(t?.placement,`'${r}' geometries`)),M8(e);break;case"point":case"mesh":return t}return t}function qce(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function M8(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:Mo,anchor:"center"};case"polygon":{const i=see(t);return i!=null&&i.type==="extrude"?wp["above-center"]:{placement:"center-center",normalizedOffset:Mo,anchor:"center"}}case"point":case"mesh":return wp["above-center"];default:return}}function s0t(t,e,i){const r=i.graphics3DGraphic.graphic.geometry;if(r==null)return null;switch(r.type){case"point":a0t(t,e,i);break;case"polygon":o0t(t,e,i);break;case"mesh":oee(t,e,i.graphics3DGraphic.layers[0])}const n=Fct-S8;return t.screenOffset[0]+=n*e.normalizedOffset[0],t.screenOffset[1]+=n*e.normalizedOffset[1],t}function o0t(t,e,i){const r=see(i);if(r!=null)switch(r.type){case"extrude":{const n=i.graphics3DGraphic.layers[0];n!=null?(n.getBoundingBoxObjectSpace(m4),yp(m4,t.translation),t.translation[2]=Dv(m4)/2):$e(t.translation,0,0,0),oee(t,e,n);break}}}function a0t(t,e,i){const r=see(i);if(r==null)return;const n=i.graphics3DGraphic.layers[0];switch(n!=null?n.getCenterObjectSpace(t.translation):$e(t.translation,0,0,0),r.type){case"icon":case"text":l0t(t,e,i,n);break;case"object":oee(t,e,n)}}function l0t(t,e,i,r){const{graphics3DGraphic:n}=i,s=r!=null?r.getScreenSize():null;if(n.isDraped||s==null)t.hasLabelVerticalOffset||t.anchor==="center"||(wp[i.labelClass.labelPlacement]&&bO.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const a=c0t(i);t.screenOffset[0]=s[0]/2*(e.normalizedOffset[0]-a[0]);const u=s[1]/2*(e.normalizedOffset[1]-a[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=u,t.centerOffsetUnits="screen"):t.screenOffset[1]=u}}function c0t(t,e=d0t){const{graphics3DGraphic:i}=t,r=i.layers[0],n=r?.stageObject.geometries[0].material??null;if(n&&n instanceof HS){const s=n.parameters.anchorPosition;e[0]=2*(s[0]-.5),e[1]=2*(s[1]-.5)}else e[0]=0,e[1]=0;return e}function oee(t,e,i){const r=i!=null?i.getBoundingBoxObjectSpace(m4):m4,n=st(r[3]-r[0],r[4]-r[1],r[5]-r[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);t.centerOffset[0]=s/2*e.normalizedOffset[0];const a=t.translation[2],u=n[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=a+u;const p=Qe(n);t.centerOffset[2]=p/2*e.normalizedOffset[2]}function u0t(t){return t==="above-center"}function h0t(t){const e=t.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=t,n=nee(r.graphics3DSymbol),s=n?.symbol.type==="point-3d"?n.symbol:null,a=wp[e]||M8(t);return s!=null&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Wce(s.verticalOffset),anchor:null,normalizedOffset:null}:!i||!i.hasVisibleVerticalOffset()||s!=null&&s.supportsCallout()&&s.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:a&&u0t(a.placement)?{placement:"above-center",verticalOffset:Wce(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,a.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(bO.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function Wce(t){const{screenLength:e,minWorldLength:i,maxWorldLength:r}=t;return{screenLength:e,minWorldLength:i,maxWorldLength:r}}const wp={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Xce={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in Xce){const e=Xce[t],i=wp[t];e.forEach(r=>{wp[r]=i})}Object.freeze&&(Object.freeze(wp),Object.keys(wp).forEach(t=>{Object.freeze(wp[t]),Object.freeze(wp[t]?.normalizedOffset)}));const d0t=[0,0],m4=eo();let Jce=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,i){this._materials.set(e,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}},Yce=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.addedToTextureAtlas=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},p0t=class{constructor(e,i,r,n,s){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=n,this.labelFunction=s,this.calloutSymbolLayerIndex=0}},f0t=class{constructor(e,i,r,n,s,a,u,p){this.layer=i,this.graphics3DCore=r,this.scaleVisibility=n,this.emptySymbolLabelSupported=s,this.elevationInfoOverride=a,this.disablePlacement=u,this.active=p,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new VEe(e,{pickable:!0,disableOctree:!0},i.uid)}destroy(){this.stageLayer.destroy()}},pb=class extends Ke{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([Fe(()=>this.view.state?.camera,()=>this.setDirty()),Fe(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(Zt.LABELER,this)]),this._textTextureAtlas=new u2({view:this.view}),this._hudMaterialCollection=new Jce(this.view._stage),this._calloutMaterialCollection=new Jce(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=jt(this._textTextureAtlas),this._hudMaterialCollection=jt(this._hudMaterialCollection),this._calloutMaterialCollection=jt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),Ed.graphic=null,Ed.renderingInfo=null,Ed.layer=null}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const n=new Yce(e,i);this._labels.set(r,n),e.labelsToInitialize.set(r,n),i.setVisibilityFlag(Co.LABEL,da.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(Co.LABEL,da.USER,!1),this.setLabelGraphicVisibility(i,!1),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r&&(this._textTextureAtlas.addTextTexture(r,i.stageObject),e.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r!=null&&(this._textTextureAtlas.removeTextTexture(r,i.stageObject),e.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),ya.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active)if(Wz(i))this._dirty=!0;else if(Xz(i.labelClassContexts)){if(i.labelClassContexts===null){this._deactivateLabelingContext(i);continue}this._createLabelClassContext(i),this._dirty=!0}else Iu(i.labelsToInitialize,(r,n)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(n,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(i.labelsToInitialize.delete(n),e.madeProgress()),e.done))&&(this._dirty=!0);this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const i=e.labelClassAbortController?.signal;e.layer.when&&await e.layer.when(),oi(i),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const r=e.graphics3DCore,n=r.layer,s=n.labelingInfo?.filter(a=>!!a.symbol);!s||s.length===0||(await CD(s,async(a,u)=>{const p=a.symbol,y=nee(r.getOrCreateGraphics3DSymbol(p));if(y==null)return void Ee.getLogger(this).error("Failed to create Graphics3DSymbol for label");await y.load(),oi(i);let b=null;rZ(p)&&p.hasVisibleCallout()&&(b=ist(p,r.symbolCreationContext),await b.load(),oi(i));const S=await Gc(JTe(a,e.layer.fieldsIndex,this.view.spatialReference));if(oi(i),S.ok===!0){const C=await this._createTextRenderParameters(y.symbol);oi(i),e.labelClassContexts[u]=new p0t(a,y,b,C,S.value)}else Ee.getLogger(this).error(`Label expression failed to evaluate: ${S.error}`)}),oi(i))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(qn(i))throw i;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.at(0);return i?.type!=="text"?null:aAe.fromSymbol(i,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,Vc(i),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,n,s,a){const u=new sAe(r,Wle(r.anchor),Gct(r.anchor),e.text,Xi(e.displayWidth,e.displayHeight));return Ed.graphic=i,Ed.renderingInfo=null,Ed.layer=n,s.createLabel(Ed,u,this._hudMaterialCollection,this._textTextureAtlas,()=>{const p=Hce(a);return p?p.elevationOffset:null})}_createLineCalloutGraphic(e,i,r,n,s){Ed.graphic=e,Ed.layer=s;const a=n.screenOffset[0];return Ed.renderingInfo=new est(null,i,n.translation,n.centerOffset,a,n.centerOffsetUnits,n.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(Ed)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,n=r.labelClassContexts;if(Xz(n)||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let s=!1;const a=i.graphic,u=r.layer,p=l9(r.layer);for(let y=0;y<n.length;y++){const b=e.textRenderers[y],S=e.textLabelPlacements[y];if(b==null||S==null)continue;const C=n[y],O=C.graphics3DSymbol,P=O.symbol&&O.symbol.type==="label-3d"?O.symbol:null,$=O.symbolLayers[0];if(!$)continue;$.setElevationInfoOverride(r.elevationInfoOverride);const N=new i0t(i,P,C.labelClass),z=this._createTextSymbolGraphic(b,a,S,u,$,N);if(z==null)return!1;z._labelClass=C.labelClass,z._labelIndex=y,i.addLabelGraphic(z,r.stageLayer),i.deconflictionPriority=C.textRenderParameters?.definition.size??0,i.setVisibilityFlag(Co.LABEL,da.USER,p),i.setVisibilityFlag(Co.LABEL,da.SCALE_RANGE,!0),i.setVisibilityFlag(Co.LABEL,da.DECONFLICTION,!1),s=!0;const U=C.graphics3DCalloutSymbolLayer;if(U&&S.hasLabelVerticalOffset){U.setElevationInfoOverride(r.elevationInfoOverride);const j=this._createLineCalloutGraphic(a,P,U,S,u);j!=null&&(C.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(j,r.stageLayer))}break}return r.scaleVisibility&&s&&r.scaleVisibility.updateGraphicLabelScaleVisibility(i),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;i[r._labelIndex].graphics3DSymbol.symbolLayers[0]?.onRemoveGraphic(r)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(Xz(r))return;const n=e.graphics3DGraphic.graphic;for(let s=0;s<r.length;s++){const a=r[s];if(e.textRenderers[s]=null,e.textLabelPlacements[s]=null,a?.textRenderParameters==null)continue;const u=a.labelFunction;let p;if(u.type==="arcade")try{const z=u.needsHydrationToEvaluate()?Uit(n,i.layer):n;p=u.evaluate(z)}catch{p=null}else p=u.evaluate(n);if(p==null||p===""||/^\s+$/.test(p))continue;const y=a.graphics3DSymbol,b=y.symbol?.type==="label-3d"?y.symbol:null;if(!y.symbolLayers[0])continue;const S=e.graphics3DGraphic,C=a.labelClass,O=i.disablePlacement,P=Hce({graphics3DGraphic:S,labelSymbol:b,labelClass:C,disablePlacement:O});if(P==null)continue;const $=Wle(P.anchor),N=UCe($);e.textRenderers[s]=new kCe(p,N,a.textRenderParameters,u2.maxSize),e.textLabelPlacements[s]=P}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const n=new Yce(e,i);this._labels.set(r,n),e.labelsToInitialize.set(r,n)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,i){const r=i.graphic.uid,n=this._labels.get(r);e.graphics.delete(r),n&&(this._destroyGraphic(n,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.delete(i),e.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const n=e.graphics.get(r);n&&(this._removeGraphic(e,n),this._addGraphic(e,n))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){const n=new Map;i.graphics.forEach(a=>n.set(a.graphic.uid,a));const s=a=>a.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,n,s),r.graphics3DCalloutSymbolLayer){const a=u=>u.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,n,a)}}}_visibilityInfoChange(e){const i=l9(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const n=this._labels.get(r);n&&(this._destroyGraphic(n,r),n.visible=!1,e.labelsToInitialize.set(r,n))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const n=r&&r.emptySymbolLabelSupported||!1,s=r?.elevationInfoOverride||null,a=r?.disablePlacement||null;if(this._findLabelingContext(e))return;const u=e.layer,p=new f0t(this.view._stage,u,e,i,n,s,a,l9(u));return this._labelingContexts.push(p),this.setDirty(),{addGraphic:y=>this._addGraphic(p,y),removeGraphic:y=>this._removeGraphic(p,y),featureReductionChange:()=>{},layerLabelsEnabled:()=>l9(p.layer),labelingInfoChange:y=>this._labelingInfoChange(p,y),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",p),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",p),visibilityInfoChange:()=>this._visibilityInfoChange(p),reset:()=>this._resetLabels(p),clear:()=>{}}}removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(n=>this._removeGraphic(i,n)),i.destroy(),this.setDirty()}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,n=this._labels.get(r);n&&n.visible!==i&&(i&&!n.addedToTextureAtlas?(this._addLabelTextureToAtlas(n),n.textInitialized||n.labelingContext.labelsToInitialize.set(r,n)):!i&&n.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(n),n.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(e=>Wz(e))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(Wz(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function Wz(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function Xz(t){return!t||t.length===0}function l9(t){return t.labelsVisible===!0&&!!t.labelingInfo?.some(e=>!!e.symbol)}_([T({constructOnly:!0})],pb.prototype,"view",void 0),_([T({constructOnly:!0})],pb.prototype,"deconflictor",void 0),_([T()],pb.prototype,"_textTextureAtlas",void 0),_([T({type:Boolean,readOnly:!0})],pb.prototype,"updating",null),pb=_([Z("esri.views.3d.layers.graphics.Labeler")],pb);const Ed=new tst(null,null,null);let K5=class Lx{constructor(e,i,r,n=null){this.lij=[0,0,0],this.extent=Di(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Ra.VISIBLE_ON_SURFACE,screenRect:Di(),distance:0,shouldSplit:!1},this.used=!1,n&&this.acquire(e,i,r,n)}acquire(e,i,r,n){this.tilingScheme=n,this.id=Lx.id(e,i,r),this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,n.getExtent(e,i,r,this.extent),this.resolution=n.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const i=this.lij[0]+1,r=2*this.lij[1],n=2*this.lij[2];return e?(e[0].acquire(i,r,n,this.tilingScheme),e[1].acquire(i,r+1,n,this.tilingScheme),e[2].acquire(i,r,n+1,this.tilingScheme),e[3].acquire(i,r+1,n+1,this.tilingScheme),e):[new Lx(i,r,n,this.tilingScheme),new Lx(i,r+1,n,this.tilingScheme),new Lx(i,r,n+1,this.tilingScheme),new Lx(i,r+1,n+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,Sg(e.measures.screenRect,this.measures.screenRect)}static id(e,i,r){return`${e}/${i}/${r}`}};var Ra;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Ra||(Ra={}));const cAe=.5*Math.PI,m0t=cAe/Math.PI*180;let g0t=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:H(),direction:H()};for(let i=0;i<4;i++)this._extent[i]={origin:H(),direction:H(),cap:{next:null,direction:H()}},this._planes[i]=gr();this._planes[en.NEAR]=gr(),this._planes[en.FAR]=gr(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,i,r,n=!0){const s=this._extent;this._toRenderBoundingExtent(e,i,r),Ue(this._center.origin,s[0].origin,s[2].origin),Pe(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),n||Pe(this._center.direction,this._center.direction,-1);for(let a=0;a<4;a++){const u=s[a];this._renderCoordsHelper.worldUpAtPosition(u.origin,u.direction);const p=s[a===3?0:a+1];u.cap.next=p.origin,Ng(u.cap.direction,u.origin,p.origin),Y4(u.direction,u.cap.direction,u.origin,this._planes[a]),n||Pe(u.direction,u.direction,-1)}Y4(s[0].cap.direction,s[1].cap.direction,s[0].origin,this._planes[en.NEAR]),n?gG(this._planes[en.NEAR],this._planes[en.FAR]):(m7(this._planes[en.FAR],this._planes[en.NEAR]),gG(this._planes[en.NEAR],this._planes[en.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=i,this._minGlobalAltitude=.9*Mr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,i,r=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===ht.Global){const s=this._maxSpanSpatialReference.isGeographic?m0t:cAe*i;if(this._maxSpan>s)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const s=this._extent[0];return!(r||!e.intersectsRay(eh(s.origin,s.direction)))}for(let s=0;s<this._extent.length;s++){const a=this._extent[s];if(!r&&e.intersectsRay(eh(a.origin,a.direction))||e.intersectsLineSegment(w2(a.origin,a.cap.next,v0t),a.cap.direction))return!0}const n=r?this._planes:this._planesWithoutFar;for(let s=0;s<e.lines.length;s++){const a=e.lines[s];if(tKe(n,a.origin,a.endpoint,a.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,i,r){oY(e,Cd),Cd[2]=r,jc(i,Cd,Jz,this._renderCoordsHelper.spatialReference),Ps(Zce,Jz),cn(cc);for(const{x0:s,x1:a,y0:u,y1:p}of y0t)for(let y=0;y<5;y++){const b=y/4;Cd[0]=si(e[s],e[a],b),Cd[1]=si(e[u],e[p],b),Cd[2]=r,va(Cd,i,Cd,this._renderCoordsHelper.spatialReference),wt(Cd,Cd,Zce),Np(cc,Cd)}$e(this._extent[0].origin,cc[0],cc[1],cc[2]),$e(this._extent[1].origin,cc[3],cc[1],cc[2]),$e(this._extent[2].origin,cc[3],cc[4],cc[2]),$e(this._extent[3].origin,cc[0],cc[4],cc[2]);for(let s=0;s<4;++s)wt(this._extent[s].origin,this._extent[s].origin,Jz)}_toRenderBoundingExtentLocal(e,i,r){h7(e,i,om,this._renderCoordsHelper.spatialReference),$e(this._extent[0].origin,om[0],om[1],r),$e(this._extent[1].origin,om[2],om[1],r),$e(this._extent[2].origin,om[2],om[3],r),$e(this._extent[3].origin,om[0],om[3],r)}_toRenderBoundingExtent(e,i,r){switch(this._renderCoordsHelper.viewingMode){case ht.Global:this._toRenderBoundingExtentGlobal(e,i,r);break;case ht.Local:this._toRenderBoundingExtentLocal(e,i,r);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(qr(e.planes[en.NEAR],this._center.origin)<0&&He(this._center.direction,e.direction)<0)return!0;for(let i=0;i<4;i++){const r=this._extent[i];if(qr(e.planes[en.NEAR],r.origin)<0&&He(r.direction,e.direction)<0)return!0}return!1}};const y0t=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Cd=H(),Jz=Ze(),Zce=Ze(),cc=eo(),om=Di(),v0t=Gp();let _0t=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new Ay(e),this._extendedFrustum=new Ay(e),this._intersector=new g0t({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,i){this._surfaceElevation=i,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>i,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return Ra.INVISIBLE;const i=this._renderCoordsHelper.viewingMode===ht.Global&&e.lij[0]>=b0t&&e.lij[0]<w0t,r=this._getOrCalculateSingleTileVisibility(e,!i);return r!==Ra.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(e):r}_shortenFrustumFarPlane(e){const i=Ay.nearFarLineIndices,r=e.mutablePoints;for(const n of i){const[s,a]=n,u=r[s],p=r[a];Be(ou,p,u),Pe(ou,ou,T0t),Ue(r[a],u,ou)}e.updatePoints(r)}_calculateAggregatedChildrenVisibility(e){let i=Ra.INVISIBLE;const r=this._cache.get(e.id);if(r!=null)return r;const n=tue.acquire();e.getChildren(n);for(const s of n){const a=this.calculate(s);if(a!==Ra.INVISIBLE&&(i=a,a===Ra.VISIBLE_ON_SURFACE))break}return tue.release(n),this._cache.set(e.id,i),i}_getOrCalculateSingleTileVisibility(e,i){const r=this._cache.get(e.id);if(r!=null)return r;const n=this._calculateSingleTileVisibility(e);return i&&this._cache.set(e.id,n),n}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===ht.Global&&e.lij[0]<x0t?this._calculateSingleTileVisibilitySided(e,!1)===Ra.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,i){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,i);const r=Mr(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,r)?this._intersector.isVisibleInFrustum(this._frustum,r,!0)?Ra.VISIBLE_ON_SURFACE:Ra.VISIBLE_WHEN_EXTENDED:Ra.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const i=this._renderCoordsHelper.worldUpAtPosition(e.eye,ou);this._aboveGround||ka(i,i);const r=co(-He(i,e.viewForward));if(this._allTilesInvisible=r>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=r>e.fovY/2,!this._hasExtendedFrustum))return;const n=this._extendedFrustumParameters(),s=this._extendedFrustum.mutablePoints;for(let a=0;a<4;a++){const u=n.pointIndices[a],p=s[u],y=this._renderCoordsHelper.getAltitude(p);if(n.needsAltitudeAdjustment(y)){switch(this._renderCoordsHelper.worldUpAtPosition(p,ou),u){case Lt.FAR_BOTTOM_LEFT:case Lt.FAR_TOP_LEFT:case Lt.NEAR_BOTTOM_LEFT:case Lt.NEAR_TOP_LEFT:yG(this._extendedFrustum.planes[en.LEFT],ou,ou);break;case Lt.FAR_BOTTOM_RIGHT:case Lt.FAR_TOP_RIGHT:case Lt.NEAR_BOTTOM_RIGHT:case Lt.NEAR_TOP_RIGHT:yG(this._extendedFrustum.planes[en.RIGHT],ou,ou)}Pe(ou,ou,n.direction),this._renderCoordsHelper.intersectInfiniteManifold(eh(p,ou),n.zWithMargin,p)}}if(this._extendedFrustum.updatePoints(s),La(s[Lt.NEAR_BOTTOM_LEFT],s[Lt.NEAR_BOTTOM_RIGHT],s[Lt.NEAR_TOP_RIGHT],Qce),La(s[Lt.NEAR_BOTTOM_RIGHT],s[Lt.NEAR_TOP_RIGHT],s[Lt.NEAR_TOP_LEFT],eue),He(Qce,eue)<0){const a=this._extendedFrustum.mutablePoints;this._aboveGround?[a[Lt.NEAR_BOTTOM_LEFT],a[Lt.NEAR_BOTTOM_RIGHT]]=[a[Lt.NEAR_BOTTOM_RIGHT],a[Lt.NEAR_BOTTOM_LEFT]]:[a[Lt.NEAR_TOP_LEFT],a[Lt.NEAR_TOP_RIGHT]]=[a[Lt.NEAR_TOP_RIGHT],a[Lt.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(a)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-Kce;return{zWithMargin:e,pointIndices:Ay.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+Kce;return{zWithMargin:e,pointIndices:Ay.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<e}}};const b0t=2,w0t=6,x0t=12,T0t=.95,Kce=1,ou=H(),Qce=gr(),eue=gr(),tue=new Ua(Array,t=>{t.length!==4&&(t[0]=new K5,t[1]=new K5,t[2]=new K5,t[3]=new K5)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let S0t=class{constructor(e){this._camera=new Kt,this._focusOnMap=[0,0],this._screenRect=Di(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new _0t(e.renderCoordsHelper)}begin(e,i,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,nY(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=FDe(e.extent,this._focusOnMap),e.measures.visibility!==Ra.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const i=E0t,r=1<<i,n=e.measures.screenRect;rd(n);let s=0;const a=e.lij[0]+i,u=e.lij[1]<<i,p=e.lij[2]<<i,y=this._tileSizeWithBias(e),b=y*y;for(let S=0;S<r;S++)for(let C=0;C<r;C++)if(s+=this._computeScreenArea(e,a,u+S,p+C,n),s>b)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Ra.VISIBLE_WHEN_EXTENDED?this._tileSize*C0t:this._tileSize}_computeScreenArea(e,i,r,n,s){const a=e.measures.visibility===Ra.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,n,a,R1),rd(Yz);for(let u=0;u<4;u++)sY(Yz,R1[u]);return Yy(s,Yz,s),Bse(R1[0],R1[1],R1[2])+Bse(R1[0],R1[2],R1[3])}_projectToScreen(e,i,r,n,s){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,i,r,RC),this._toRenderCoords(RC,0,3,M1[0]),this._toRenderCoords(RC,2,3,M1[1]),this._toRenderCoords(RC,2,1,M1[2]),this._toRenderCoords(RC,0,1,M1[3]),n&&(this._projectToPlane(M1,this._camera.frustum[en.NEAR]),this._projectToPlane(M1,this._camera.frustum[en.TOP]),this._projectToPlane(M1,this._camera.frustum[en.BOTTOM]));for(let a=0;a<4;a++)this._camera.projectToRenderScreen(M1[a],iue),this._camera.renderToScreen(iue,s[a])}_projectToPlane(e,i){for(let n=0;n<4;n++)PC[n]=qr(i,e[n]);const r=Math.max(PC[0],PC[1],PC[2],PC[3]);if(r>0){const n=Pe(MC,i,-r);for(let s=0;s<4;s++)Ue(e[s],e[s],n)}}_toRenderCoords(e,i,r,n){return MC[0]=e[i],MC[1]=e[r],MC[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(MC,this._tilingScheme.spatialReference,n),n}};const Yz=Di(),E0t=2,C0t=5,R1=[Dn(),Dn(),Dn(),Dn()],RC=Di(),MC=H(),M1=[H(),H(),H(),H()],PC=[0,0,0,0],iue=fa();function Wkt(t,e,i){if(t==null||i==null)return!1;let r=!0;return js[0]=t.xmin!=null?t.xmin:0,js[1]=t.ymin!=null?t.ymin:0,js[2]=t.zmin!=null?t.zmin:0,r=r&&Mn(js,t.spatialReference,0,e,i,0,1),js[0]=t.xmax!=null?t.xmax:0,js[1]=t.ymax!=null?t.ymax:0,js[2]=t.zmax!=null?t.zmax:0,r=r&&Mn(js,t.spatialReference,0,e,i,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function uAe(t,e,i){if(t==null||i==null)return!1;let r=!0;return js[0]=t.xmin!=null?t.xmin:0,js[1]=t.ymin!=null?t.ymin:0,js[2]=t.zmin!=null?t.zmin:0,r=r&&Mn(js,t.spatialReference,0,js,i,0,1),e[0]=js[0],e[1]=js[1],js[0]=t.xmax!=null?t.xmax:0,js[1]=t.ymax!=null?t.ymax:0,js[2]=t.zmax!=null?t.zmax:0,r=r&&Mn(js,t.spatialReference,0,js,i,0,1),e[2]=js[0],e[3]=js[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const js=H();let Bo=class extends Ke{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void Ee.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const i=this._get("filterExtent");if(i===e||i!=null&&e&&i.equals(e))return;const r=e!=null?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=Di();return uAe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new Dt,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new xi}initialize(){this.addHandles([Fe(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),$r),Fe(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location],()=>this._setDirty(),Ur)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(Zt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=nn(this._frameWorker)}addClient(){const e=zu();return this._clients.add(e),this._clients.size===1&&this._setDirty(),Sr(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(ml))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=Zt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=Zt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new S0t({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(i=>new K5(i[0],i[1],i[2],e))}_purgeHorizonTiles(e){e.sort((i,r)=>{const n=i.measures.screenRect,s=r.measures.screenRect;return n[1]+n[3]-(s[1]+s[3])}),rd(c9);for(let i=0;i<e.length;i++)if(Yy(c9,e.data[i].measures.screenRect,c9),Jl(c9)>A0t)return e.data.slice(i,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:i}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!GD(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==Ra.INVISIBLE&&(r.measures.shouldSplit?(i.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const n of this.tiles.items)n.used=!1;const i=e.filter(n=>{const s=this._idToTile.get(n.id);return s?(s.copyMeasurementsFrom(n),s.used=!0):this._idToTile.set(n.id,n),!s}),r=this.tiles.items.filter(n=>!n.used&&(this._idToTile.delete(n.id),!0));this.tiles.removeMany(r),this.tiles.addMany(i),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,i)=>e.measures.visibility!==i.measures.visibility?e.measures.visibility===Ra.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-i.measures.distance),this.tiles.forEach((e,i)=>e.loadPriority=i)}};_([T({constructOnly:!0})],Bo.prototype,"scheduler",void 0),_([T({constructOnly:!0})],Bo.prototype,"renderCoordsHelper",void 0),_([T({constructOnly:!0})],Bo.prototype,"tilingSchemeOwner",void 0),_([T({constructOnly:!0})],Bo.prototype,"cameraOnSurface",void 0),_([T({constructOnly:!0})],Bo.prototype,"focus",void 0),_([T({constructOnly:!0})],Bo.prototype,"viewState",void 0),_([T({constructOnly:!0})],Bo.prototype,"terrain",void 0),_([T()],Bo.prototype,"tiles",void 0),_([T()],Bo.prototype,"tileSize",void 0),_([T({readOnly:!0})],Bo.prototype,"tilingScheme",null),_([T()],Bo.prototype,"filterExtent",null),_([T({readOnly:!0})],Bo.prototype,"_filterExtentRect",null),_([T({readOnly:!0})],Bo.prototype,"_rootTileIds",null),_([T({value:!1})],Bo.prototype,"suspended",null),_([T({readOnly:!0})],Bo.prototype,"updating",null),Bo=_([Z("esri.views.3d.layers.support.FeatureTileTree3D")],Bo);const c9=Di(),A0t=10;let jn=class extends Ke{constructor(){super(...arguments),this._propertiesPool=new Mg({camera:Kt},this),this._lastSeenCameraProjectionValues=new Kt,this.mode=yr.ANIMATING,this._cssCamera=new Kt,this._camera=new Kt,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Xn,this.viewingMode=ht.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,i){this._set("viewingMode",e),this._set("spatialReference",i),this._set("constraints",new Em({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Mg({camera:Kt},this)}destroy(){this.cameraController=null,this._propertiesPool?.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===ht.Global){const e=Mr(this.spatialReference).radius;this.camera=new Kt({eye:st(4*e,0,0),center:st(e,0,0),up:st(0,0,1)})}else this.camera=new Kt({eye:st(0,0,100),center:st(0,0,0),up:st(0,1,0)})}get animation(){return this.cameraController instanceof lO&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:i,width:r,pixelRatio:n}=this.camera;return e.pixelRatio=1,e.height=Math.round(i/n),e.width=Math.round(r/n),e}set camera(e){e!==dh&&dh.copyFrom(e),dh.computeUp(this.viewingMode),this.events.emit("before-camera-change",dh);const i=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,dh)&&(this._lastSeenCameraProjectionValues.copyFrom(dh),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!i.equals(dh)&&(this._camera=this._propertiesPool.get("camera").copyFrom(dh),this._cameraChanged=!i.almostEquals(dh),this._cameraChanged)){const r=z0e(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===yr.IDLE}get updating(){return this.mode!==yr.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===ht.Global}get isLocal(){return this.viewingMode===ht.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.cameraController?.destroy(),e&&(this.removeHandles(rue),this.addHandles(Qu(()=>e.state===In.Finished||e.state===In.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),rue),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=In.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==In.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();dh.copyFrom(this._get("camera")),e(dh),this.camera=dh,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,i){return e.fov!==i.fov||e.fullViewport[0]!==i.fullViewport[0]||e.fullViewport[1]!==i.fullViewport[1]||e.fullViewport[2]!==i.fullViewport[2]||e.fullViewport[3]!==i.fullViewport[3]||e.padding[zi.TOP]!==i.padding[zi.TOP]||e.padding[zi.RIGHT]!==i.padding[zi.RIGHT]||e.padding[zi.BOTTOM]!==i.padding[zi.BOTTOM]||e.padding[zi.LEFT]!==i.padding[zi.LEFT]}};_([T()],jn.prototype,"mode",void 0),_([T({readOnly:!0,type:NS})],jn.prototype,"animation",null),_([T({type:Kt})],jn.prototype,"camera",null),_([T({type:Kt})],jn.prototype,"cssCamera",null),_([T()],jn.prototype,"_cssCamera",void 0),_([T()],jn.prototype,"_camera",void 0),_([T({readOnly:!0})],jn.prototype,"pixelRatio",null),_([T()],jn.prototype,"rasterPixelRatio",void 0),_([T()],jn.prototype,"contentPixelRatio",void 0),_([T({readOnly:!0})],jn.prototype,"alignPixelEnabled",null),_([T({readOnly:!0})],jn.prototype,"updating",null),_([T({})],jn.prototype,"_contentCamera",void 0),_([T({type:Kt})],jn.prototype,"contentCamera",null),_([T({readOnly:!0})],jn.prototype,"fixedContentCamera",null),_([T({readOnly:!0})],jn.prototype,"constraints",void 0),_([T({readOnly:!0})],jn.prototype,"events",void 0),_([T({readOnly:!0})],jn.prototype,"isGlobal",null),_([T({readOnly:!0})],jn.prototype,"isLocal",null),_([T({readOnly:!0})],jn.prototype,"viewingMode",void 0),_([T({readOnly:!0})],jn.prototype,"spatialReference",void 0),_([T()],jn.prototype,"navigating",null),_([T()],jn.prototype,"stationary",null),_([T()],jn.prototype,"_cameraChanged",void 0),_([T()],jn.prototype,"cameraController",null),jn=_([Z("esri.views.3d.state.ViewState")],jn);const O0t=jn,dh=new Kt,rue="ViewStateHandles";let R0t=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new xi,this._tolerance=LS,this._tmpRay=oo(),this._tmpRegion=Di(),this._validateHUDIntersector=ad(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),nue(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,nue(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,n){return i.options.selectionMode=!1,i.options.store=Jo.MIN,this.computeIntersection(e,i,n),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,n=.5){return e.getRenderCenter(d9,r,n),d9[0]+=.0466,d9[1]-=.0123,$K(e,d9,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,r)}intersectToolIntersectorScreen(e,i,r){const n=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(n,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,r);const n=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||Hp(n)&&n.intersector!==En.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(e,i,r))}setTolerance(e=LS){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===En.TERRAIN?1:r.type===En.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===En.TERRAIN?1:r.type===En.TERRAIN?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return IK(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==ht.Local||e==null||Ue(i,e.origin,We(vt.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,n=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,n)}_intersectElevation(e,i,r=0,n=null){if(e==null)return null;const s=i!=null?i.mode:"absolute-height",a=i?.offset??0,u=s!=="on-the-ground"?a+r:0,p=u/this._view.renderCoordsHelper.unitInMeters;if(s==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,u,h9)){const U=this._view.computeMapPointFromVec3d(h9);return U.z??(U.z=0),U.z-=a,U}return null}const y=this._view.state.camera,b=vt.get();y.projectToRenderScreen(e.origin,b);const S=new sue(null,this._forEachLayer),C=this._view.slicePlane,O=C!=null?wne(C):null,P=ad(this.viewingMode);P.options.store=Jo.MIN,P.options.verticalOffset=p;const $=e.origin,N=Ue(vt.get(),$,e.direction);P.reset($,N,y),P.point=b;const z=n?"type"in n&&n.type==="graphics"?U=>U.layerUid!==n.uid:U=>U.graphicUid!==n.uid:null;switch(s){case"relative-to-scene":{const U=j=>(!z||z(j))&&!!j.lastValidElevationBB;P.intersect(S.layers,b,this._tolerance,null,U),this._externalIntersectionHandlers.forAll(j=>{if(j.type===En.I3S||j.type===En.TERRAIN){const G=j.slicePlaneEnabled?O:null;j.intersect(P,G,P.rayBegin,P.rayEnd,b)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(U=>{if(U.isGround){const j=U.slicePlaneEnabled?O:null;U.intersect(P,j,P.rayBegin,P.rayEnd,b)}})}if(P.results.min.getIntersectionPoint(h9)){const U=this._view.computeMapPointFromVec3d(h9);return U.z=r,U}return null}computeIntersection(e,i,r){if(e==null)return;const n=this._view.state.camera,s=vt.get();n.projectToRenderScreen(e.origin,s);const a=new sue(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const u=e.origin,p=Ue(vt.get(),e.origin,e.direction);i.reset(u,p,n),i.intersect(a.layers,s,this._tolerance);const y=this._view.slicePlane,b=y!=null?wne(y):null;i.intersect(a.sliceableLayers,s,this._tolerance,b);const S=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(P=>{const $=P.layerUid,N=Array.isArray($),z=N?$:[$];N&&(i.options.filteredLayerUids=[]);let U=!1;for(const j of z)a.filterLayerUid(j)?U=!0:N&&i.options.filteredLayerUids.push(j);if(i.options.isFiltered=!U,P.isGround&&S||!i.options.isFiltered){const j=P.slicePlaneEnabled?b:null;P.intersect(i,j,u,p,s)}});const C=vt.get(),O=this._view.basemapTerrain;if(r&&r.enableDraped&&O.spatialReference!=null&&i.results.ground.getIntersectionPoint(C)){const P=O.overlayManager.renderer,$=this._view.renderCoordsHelper.spatialReference,N=vt.get();this._view.renderCoordsHelper.fromRenderCoords(C,N,O.spatialReference),N[2]=this._view.elevationProvider?.getElevation(C[0],C[1],C[2],$,"ground")??0,P.intersect(i,N,i.results.ground,z=>a.filterRenderGeometry(z))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;Sg(this._tmpRegion,hB);const r=this._view.state.camera,n=[],s=this._tmpRegion,a=z=>{const U=new P0t(z);r.projectToRenderScreen(z.target.center,U.screenPoint),U.screenPoint[0]=Math.floor(U.screenPoint[0]),U.screenPoint[1]=Math.floor(U.screenPoint[1]),n.push(U),sY(s,U.screenPoint)};e.sortResults(i.all),i.min.dist!=null&&a(i.min);for(const z of i.all)i.min.target.object!==z.target.object&&i.max.target.object!==z.target.object&&a(z);if(i.max.dist!=null&&i.max.target.object!==i.min.target.object&&a(i.max),!n.length)return;s[0]===s[2]&&(s[2]+=1),s[1]===s[3]&&(s[3]+=1);const u=r.fullWidth,p=r.fullHeight,y=Math.max(0,s[0]-Q5),b=Math.max(0,s[1]-Q5),S=Math.min(Na(s)+2*Q5,u-y),C=Math.min(Jl(s)+2*Q5,p-b),O=new Uint8Array(S*C*4);this._view._stage.renderer.readHUDVisibility(y,b,S,C,O);let P=!0;const $=e.results.max.dist==null;let N=0;for(const z of n)for(const U of M0t)if(O[4*(Math.min(z.screenPoint[0]+U[0],u)-s[0]+(Math.min(z.screenPoint[1]+U[1],p)-s[1])*S)]){P&&(e.results.min.copy(z.result),P=!1),$&&e.results.max.copy(z.result),e.options.store===Jo.ALL&&e.results.all.splice(N++,0,z.result);break}}};const Q5=1,M0t=(()=>{const t=[],e=Q5;for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)t.push([r+e,i+e]);return t})();let P0t=class{constructor(e){this.result=e,this.screenPoint=fa()}},u9;function nue(t){return u9&&u9.viewingMode===t||(u9=ad(t)),u9}let sue=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e?.include,this.exclude=e?.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:i,exclude:r}=this;return e==null?i==null&&r==null:(i==null||i.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function oue(t){return typeof t=="object"&&"intersect"in t}const h9=H(),d9=fa();let Qkt=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,n,s){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,s,r,n)}},I0t=class{constructor(e,i,r,n){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...n,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(Zt.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(ml);else for(const i of this._queries)i.result.reject(or())}queryElevation(e,i,r,n=0){const s=Ys(),a={x:e,y:i,minDemResolution:n,result:s,signal:r};return this._queries.push(a),qs(r,()=>{rJ(this._queries,a),s.reject(or())}),s.promise}get running(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(b=>b.result.reject()),void e.madeProgress();const n=i.map(b=>[b.x,b.y]),s=i.reduce((b,S)=>Math.min(b,S.minDemResolution),1/0),a=new vw({points:n,spatialReference:this.spatialReference}),u=i.length>1&&i.some(b=>!!b.signal)?new AbortController:null,p=u!=null?u.signal:i[0].signal;if(u!=null){let b=0;i.forEach(S=>qs(S.signal,()=>{b++,S.result.reject(or()),b===i.length&&u.abort()}))}const y={...this._queryOptions,minDemResolution:s,signal:p};r.queryElevation(a,y).then(b=>{i.forEach((S,C)=>{S.signal!=null&&S.signal.aborted?S.result.reject(or()):S.result.resolve(b.geometry.points[C][2])})}).catch(b=>{i.forEach(S=>S.result.reject(b))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(ml)}}},eA=class extends Xn.EventedMixin(Ke){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=ct(this._elevationQueryCached)}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,i,r,n,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const u=this.lastElevationQuery;if(e===u.x&&i===u.y&&r===u.z&&Wn(n,u.spatialReference)&&s===u.queryContext)return u.result}let a=null;return a=p9(a,this._im,e,i,r,n,s),a==null&&(a=p9(a,this._ground,e,i,r,n,s)),s==="scene"&&(a=p9(a,this._scene,e,i,r,n,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:i,z:r,spatialReference:n,queryContext:s,result:a}),a}getSphereElevationBounds(e,i){let r=1/0,n=-1/0;for(const s of[this._im,this._ground,this._scene])s.forEach(a=>{if(a.getSphereElevationBounds){const u=a.getSphereElevationBounds(e,i);u!=null&&(r=Math.min(r,u.min),n=Math.max(n,u.max))}});return{min:r,max:n}}getRootElevationBounds(){let e=1/0,i=-1/0;for(const r of[this._im,this._ground,this._scene])r.forEach(n=>{if(n.getRootElevationBounds){const s=n.getRootElevationBounds();s!=null&&(e=Math.min(e,s.min),i=Math.max(i,s.max))}});return{min:e,max:i}}async queryElevation(e,i,r,n,s,a=null,u=0){const p=this._getElevationQuery(n);try{const y=await p.queryElevation(e,i,a,u);return s==="scene"?p9(y,this._scene,e,i,r,n,s):y}catch(y){return $a(y),this.getElevation(e,i,r,n,s)}}register(e,i){this.addHandles(i.on("elevation-change",r=>this.emit("elevation-change",r)),i),this._providersFromContext(e).push(i)}unregister(e){this.removeHandles(e);for(const i of[this._im,this._ground,this._scene]){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const i=this._elevationQueryCached;if(i!=null&&Wn(e,i.spatialReference))return i;i?.destroy({completeTasks:!0});const{wkid:r,wkt:n,wkt2:s,latestWkid:a}=e,u=new I0t(this.view.resourceController.scheduler,new dt({wkid:r,wkt:n,wkt2:s,latestWkid:a}),()=>this.view.map?.ground,{maximumAutoTileRequests:4});return this._elevationQueryCached=u,u}};function p9(t,e,i,r,n,s,a){for(const u of e){const p=u.getElevation(i,r,n,s,a);p!=null&&(t=t!=null?Math.max(p,t):p)}return t}_([T({constructOnly:!0})],eA.prototype,"view",void 0),_([T()],eA.prototype,"spatialReference",null),eA=_([Z("esri.views.3d.support.CombinedElevationProvider")],eA);let wO=class jq{static isValidProfile(e){return e in jq.profiles}static getDefaultProfile(){return Me("esri-iPhone")?"low":"medium"}static apply(e,i){const r=jq.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxNumberOfDrawCalls=r.graphics3D.maxNumberOfDrawCalls,i.graphics3D.maxTotalNumberOfVertices=r.graphics3D.maxTotalNumberOfVertices,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods,i.graphics3D.uncompressedTextureDownsamplingEnabled=r.graphics3D.uncompressedTextureDownsamplingEnabled;const n=i.sceneService.object,s=r.sceneService.object;n.lodFactor=s.lodFactor,n.lodCrossfadeinDuration=s.lodCrossfadeinDuration,n.lodCrossfadeoutDuration=s.lodCrossfadeoutDuration,n.lodCrossfadeUncoveredDuration=s.lodCrossfadeUncoveredDuration,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.vtlContentZoom=r.tiledSurface.vtlContentZoom,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.highResolutionAtmosphere=r.highResolutionAtmosphere,i.reflections=r.reflections,i.ambientOcclusion=r.ambientOcclusion,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}};wO.test={reset(){const t=hAe();for(const e of Object.keys(t))wO.profiles[e]=t[e]}};const IC={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function hAe(){const t=!!Me("esri-mobile"),e=!!Me("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,reduceTileLevelDifferences:!0,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+IC.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!Me("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600+IC.GalaxyS20:750+IC.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!Me("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900+IC.SurfacePro7:1500+IC.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}(function(t){t.profiles=hAe()})(wO||(wO={}));const z$=wO,dAe=new mt([0,255,255]),pAe=1,fAe=.25,mAe=new mt([0,0,0]),gAe=.4,yAe=.2;let Ff=class extends Ke{constructor(){super(...arguments),this.color=dAe.clone(),this.haloColor=null,this.haloOpacity=pAe,this.fillOpacity=fAe,this.shadowOpacity=gAe,this.shadowColor=mAe.clone(),this.shadowDifference=yAe}};_([T({type:mt})],Ff.prototype,"color",void 0),_([T({type:mt})],Ff.prototype,"haloColor",void 0),_([T()],Ff.prototype,"haloOpacity",void 0),_([T()],Ff.prototype,"fillOpacity",void 0),_([T()],Ff.prototype,"shadowOpacity",void 0),_([T({type:mt})],Ff.prototype,"shadowColor",void 0),_([T()],Ff.prototype,"shadowDifference",void 0),Ff=_([Z("esri.views.3d.support.HighlightOptions")],Ff);const vAe=Ff;function $0t(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function _Ae(t){return typeof t=="string"?Nn(t):Ce(t)}function L0t(t,e,i){const r={};for(const n in t){if(n==="declaredClass")continue;const s=t[n];if(s!=null&&typeof s!="function")if(Array.isArray(s)){r[n]=[];for(let a=0;a<s.length;a++)r[n][a]=L0t(s[a])}else if(typeof s=="object")if(s.toJSON){const a=s.toJSON(i?.[n]);r[n]=e?a:JSON.stringify(a)}else r[n]=e?s:JSON.stringify(s);else r[n]=s}return r}function D0t(t){return{geometryType:ZO(t[0]),geometries:t.map(e=>e.toJSON())}}function bAe(t,e,i){const r=YDe(e);return t.map(n=>{const s=r.fromJSON(n);return s.spatialReference=i,s})}let fb=class extends Ne{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(n=>n.toJSON()),i=this.geometries[0],r={};return r.outSR=J6(this.outSpatialReference),r.inSR=J6(i.spatialReference),r.geometries=JSON.stringify({geometryType:ZO(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};_([T()],fb.prototype,"geometries",void 0),_([T({json:{read:{source:"outSR"}}})],fb.prototype,"outSpatialReference",void 0),_([T()],fb.prototype,"transformation",void 0),_([T()],fb.prototype,"transformForward",void 0),fb=_([Z("esri.rest.support.ProjectParameters")],fb);const aee=fb,N0t=os(aee);async function wAe(t,e,i){e=N0t(e);const r=_Ae(t),n={...r.query,f:"json",...e.toJSON()},s=e.outSpatialReference,a=ZO(e.geometries[0]),u=$0t(n,i);return ir(r.path+"/project",u).then(({data:{geometries:p}})=>bAe(p,a,s))}async function lee(t=null,e){if(vr.geometryServiceUrl)return vr.geometryServiceUrl;if(!t)throw new de("internal:geometry-service-url-not-configured");let i;i="portal"in t?t.portal||Zs.getDefault():t,await i.load({signal:e});const r=i.helperServices?.geometry?.url;if(!r)throw new de("internal:geometry-service-url-not-configured");return r}async function F0t(t,e,i=null,r){const n=await lee(i,r),s=new aee;s.geometries=[t],s.outSpatialReference=e;const a=await wAe(n,s,{signal:r});if(a&&Array.isArray(a)&&a.length===1)return a[0];throw new de("internal:geometry-service-projection-failed")}const k0t=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:lee,projectGeometry:F0t},Symbol.toStringTag,{value:"Module"}));let z0t=class{constructor(e,i){this.spatialReference=i,this.unitInMeters=Va(this.spatialReference,Mr(this.spatialReference).metersPerDegree);const r=e&&"portalItem"in e?e.portalItem:void 0;this._geometryServiceURLPromise=lee(r).catch(()=>{throw new de("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const i=await this._geometryServiceURLPromise;let r,n=!0;Array.isArray(e[0])&&typeof e[0]!="number"?r=e:(r=[e],n=!1);const s=r.map(p=>p instanceof Wt?p:new Wt(p,this.spatialReference)),a=new aee({geometries:s,outSpatialReference:dt.WGS84}),u=(await wAe(i,a)).map(p=>p.type==="point"?[p.x,p.y]:void 0).filter(p=>!!p);return n?u:u[0]}},xu=class extends Ke{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};_([T()],xu.prototype,"minTotalNumberOfFeatures",void 0),_([T()],xu.prototype,"maxTotalNumberOfFeatures",void 0),_([T()],xu.prototype,"maxNumberOfDrawCalls",void 0),_([T()],xu.prototype,"maxTotalNumberOfVertices",void 0),_([T()],xu.prototype,"snapshotAvailable",void 0),_([T()],xu.prototype,"polygonLodFactor",void 0),_([T()],xu.prototype,"polylineLodFactor",void 0),_([T()],xu.prototype,"skipHighSymbolLods",void 0),_([T()],xu.prototype,"uncompressedTextureDownsamplingEnabled",void 0),xu=_([Z("esri.views.3d.support.QualitySettings.Graphics3DSettings")],xu);let b0=class extends Ke{constructor(){super(...arguments),this.lodFactor=1}};_([T()],b0.prototype,"lodFactor",void 0),b0=_([Z("esri.views.3d.support.QualitySettings.LoDFactorSettings")],b0);let P8=class extends b0{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};P8=_([Z("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],P8);let qm=class extends Ke{constructor(){super(...arguments),this.object=new P8,this.point=new b0,this.integratedMesh=new b0,this.pointCloud=new b0,this.uncompressedTextureDownsamplingEnabled=!1}};_([T({type:P8})],qm.prototype,"object",void 0),_([T({type:b0})],qm.prototype,"point",void 0),_([T({type:b0})],qm.prototype,"integratedMesh",void 0),_([T({type:b0})],qm.prototype,"pointCloud",void 0),_([T()],qm.prototype,"uncompressedTextureDownsamplingEnabled",void 0),qm=_([Z("esri.views.3d.support.QualitySettings.SceneServiceSettings")],qm);let Wm=class extends Ke{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};_([T()],Wm.prototype,"lodBias",void 0),_([T()],Wm.prototype,"angledSplitBias",void 0),_([T()],Wm.prototype,"vtlContentZoom",void 0),_([T()],Wm.prototype,"reduceTileLevelDifferences",void 0),_([T()],Wm.prototype,"textureFadeDuration",void 0),Wm=_([Z("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Wm);let TT=class extends Ke{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};_([T()],TT.prototype,"pixelRatio",void 0),_([T()],TT.prototype,"maxTotalNumberOfFeatures",void 0),TT=_([Z("esri.views.3d.support.QualitySettings.HeatmapSettings")],TT);let na=class extends Ke{constructor(){super(...arguments),this.graphics3D=new xu,this.sceneService=new qm,this.tiledSurface=new Wm,this.heatmap=new TT,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};_([T({type:xu})],na.prototype,"graphics3D",void 0),_([T({type:qm})],na.prototype,"sceneService",void 0),_([T({type:Wm})],na.prototype,"tiledSurface",void 0),_([T({type:TT})],na.prototype,"heatmap",void 0),_([T()],na.prototype,"fadeDuration",void 0),_([T()],na.prototype,"antialiasingEnabled",void 0),_([T()],na.prototype,"physicallyBasedRenderingEnabled",void 0),_([T()],na.prototype,"highQualityTransparency",void 0),_([T()],na.prototype,"highResolutionAtmosphere",void 0),_([T()],na.prototype,"reflections",void 0),_([T()],na.prototype,"ambientOcclusion",void 0),_([T()],na.prototype,"memoryLimit",void 0),_([T()],na.prototype,"additionalCacheMemory",void 0),_([T()],na.prototype,"frameRate",void 0),_([T()],na.prototype,"maximumPixelRatio",void 0),na=_([Z("esri.views.3d.support.QualitySettings.QualitySettings")],na);const aue=na;function U0t(t){return nE(t)&&t.length>=3}function j0t(t){return(sE(t)||Array.isArray(t))&&t.length>=3}function B0t(t){return U0t(t)||j0t(t)}let V0t=class Bq{constructor(e,i,r,n){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=n,this._tmpCoordinateSystem=ZBe(n)}set extent(e){e&&KBe(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return oVe(this._coordinateSystem,e)}setAltitude(e,i,r=e){return xbe(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){aVe(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return iVe(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return rVe(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,$n.X,vt.get()),n=this.worldBasisAtPosition(e,$n.Y,vt.get()),s=this.worldBasisAtPosition(e,$n.Z,vt.get());return N0(i,r[0],r[1],r[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,vt.get()),n=this.worldBasisAtPosition(e,$n.Y,vt.get()),s=K_e(i,n,r);return wl(s)}intersectManifoldClosestSilhouette(e,i,r){return DF(this._coordinateSystem,i,this._tmpCoordinateSystem),sVe(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){DF(this._coordinateSystem,i,this._tmpCoordinateSystem);const n=vt.get();return nVe(this._tmpCoordinateSystem,e,n)?Ie(r,n):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===ht.Global)return this.intersectManifold(e,i,r);DF(this._coordinateSystem,i,this._tmpCoordinateSystem);const n=this._tmpCoordinateSystem.value,s=vt.get();return Cw(n.plane,e,s)?Ie(r,s):null}toRenderCoords(e,i,r){return NL(e)?Wc(e,i,this.spatialReference):va(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return NL(i)?(r!=null&&(i.spatialReference=r),JCe(e,this.spatialReference,i)):B0t(i)?va(e,this.spatialReference,i,r)?i:null:Og(e,this.spatialReference,i)}static create(e,i){switch(e){case ht.Local:return new Bq(ht.Local,i,Va(i),tVe());case ht.Global:return new Bq(ht.Global,i,1,eVe(i))}}static renderUnitScaleFactor(e,i){return Hj(e)/Hj(i)}};var o0;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(o0||(o0={}));const G0t=(()=>{const t=new Array;return t[o0.ELEVATION]=10,t[o0.BASEMAP]=10,t[o0.I3S_INDEX]=10,t[o0.I3S_DATA]=10,t[o0.SYMBOLOGY]=5,t})(),H0t=30;function xAe(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function q0t(t){return new rl({view:t})}const lue=.1,f9=1,Zz=1,W0t=.75,X0t=.6,cue=1.3;let rl=class extends Ke{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new Iwe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles($2({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(f9),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,i){return new WXe(e,this._cacheStorage,i)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<X0t&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(f9);else if(e)(this._memoryPredicted>1.1*Zz||this._usedMemory>Zz)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>lue&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/cue),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>Zz)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/cue),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<W0t&&this._quality<f9){this._stableQuality=this._quality;const i=.05;e=this._updateQuality(this._quality+i)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,lue),f9))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){if(!this.view)return;this.view._stage?.renderer?.tick();let e=(this.view.basemapTerrain?.usedMemory??0)+(this.view._stage?.renderer?.usedMemory??0),i=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(a=>{if(xAe(a)){const u=a.ignoresMemoryFactor?this._quality:1;e+=a.usedMemory*u,i+=a.unloadedMemory*u}});const r=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(e>n&&r){this._warnMemoryUsage=e;const a=p=>(p/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",u=Math.round(100*this._quality);Ee.getLogger(this).warn(`Memory Limit exceeded! Limit: ${a(n)} Current: ${a(e)} Projected: ${a(e+i)} Quality: ${u}%`)}this._usedMemory=e/n,this._memoryPredicted=(e+i)/n;const s=n-e;this._cacheStorage.maxSize=Math.max(0,s+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const i=e._numQualityChanges;return e._numQualityChanges=0,i}}}};_([T({constructOnly:!0})],rl.prototype,"view",void 0),_([T()],rl.prototype,"maxMemory",null),_([T()],rl.prototype,"additionalCacheMemory",null),_([T({readOnly:!0})],rl.prototype,"memoryFactor",null),_([T({readOnly:!0})],rl.prototype,"updating",null),_([T({readOnly:!0})],rl.prototype,"usedMemory",null),_([T({readOnly:!0})],rl.prototype,"usedCacheMemory",null),_([T()],rl.prototype,"_quality",void 0),_([T()],rl.prototype,"_usedMemory",void 0),_([T()],rl.prototype,"_updating",void 0),_([T()],rl.prototype,"_stableQuality",void 0),_([T()],rl.prototype,"_maxMemory",void 0),_([T()],rl.prototype,"_additionalCacheMemory",void 0),rl=_([Z("esri.views.3d.support.MemoryController")],rl);let J0t=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},Y0t=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new Z0t}},Z0t=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},K0t=class{constructor(e,i,r,n){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=n.map(s=>new Y0t(s))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,n)=>this._taskCallback(r,n))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,zt(i.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const e=this;return{set workerFunc(i){e._workerFunc=i}}}},U$=class extends Ke{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new K0t((n,s)=>this._startLoading(n,s),(n,s)=>this._doneLoadingCB(n,s),e,i),r&&(this._frameTask=r.registerTask(Zt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=nn(this._frameTask),this._tasks.forEach(e=>Vc(e.abortController)),this._loadQueue=ct(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,n={}){const s=Ys();s.__signal=n!=null?n.signal:null;const a=this._createOrUpdateTask(e,i,r,n,s);return qs(n,()=>this._cancelRequest(a,s)),s.promise}_createTask(e,i,r,n,s,a){const u=new imt(e,i,r,n,s);return this._updateTask(u,a),this._tasks.set(s,u),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(u),u}_cancelRequest(e,i){A4(e.resolvers,i),i.reject(or()),e.resolvers.length===0&&(e.status===Ch.DOWNLOADING&&(e.status=Ch.CANCELLED,this._loadQueue.cancel(e),e.abortController?.abort(),e.request=null,e.abortController=null),e.status=Ch.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,n,s){const a=rmt(n?.uid||e,i,r),u=this._tasks.get(a);return u?(this._updateTask(u,s),u):this._createTask(e,n,i,r,a,s)}_doneLoadingCB(e,i){this._loadQueue&&(zt(e.status===Ch.DOWNLOADING),e.status=Ch.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();oi(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==Ch.DOWNLOADED&&(i.err=i.err||or()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!qn(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const n of e.resolvers)if(i)qn(i)?n.reject(i):n.reject(new de("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const s=r>0?Ce(e.result):e.result;n.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===Ch.CANCELLED)return!1;let r,n;switch(e.startTime=performance.now(),e.status=Ch.DOWNLOADING,e.docType){case"binary":n="array-buffer",r=0;break;case"image":n="image";break;case"image+type":n="array-buffer";break;default:n="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=ir(e.url,{...e.options,responseType:n,timeout:r,signal:s});let a=()=>{};const u=y=>{e.duration=performance.now()-e.startTime,e.size=y instanceof ArrayBuffer?y.byteLength:e.size||0,e.result=y,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},p=y=>{e.status===Ch.DOWNLOADING&&i(e,y),a()};return e.docType!=="image+type"?(e.request.then(y=>u(y.data),p),!0):(e.request.then(y=>{const b=y.data,S=emt(b);if(n="image",e.size=b.byteLength,S==="unknown")return e.request=ir(e.url,{responseType:n,timeout:r,signal:s}),void e.request.then(P=>u(P.data),p);const C=new Blob([b],{type:S}),O=window.URL.createObjectURL(C);a=()=>window.URL.revokeObjectURL(O),e.request=ir(O,{responseType:n,timeout:r,signal:s}),e.request.then(P=>u(new cee(P.data,S,a)),p)},p),!0)}get test(){return{loadQueue:this._loadQueue}}};_([T({readOnly:!0})],U$.prototype,"updating",void 0),U$=_([Z("esri.views.3d.support.StreamDataLoader")],U$);const Q0t={numRetries:0};function emt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let cee=class{constructor(e,i,r){this.image=e,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}};function tmt(t){return"image"in t&&"type"in t}let imt=class extends J0t{constructor(e,i,r,n,s){super(n),this.url=e,this.options=i,this.docType=r,this.key=s,this.result=null,this.status=Ch.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Q0t.numRetries}};function rmt(t,e,i){return`${t}:${e}:${i}`}var Ch;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Ch||(Ch={}));let j$=class extends Ke{constructor(){super(...arguments),this.updating=!1}};function nmt(t){return new Bd({view:t})}_([T({readOnly:!0})],j$.prototype,"updating",void 0),j$=_([Z("esri.views.3d.support.ResourceControllerMain")],j$);let Bd=class extends j${constructor(){super(...arguments),this._immediateTask=TS,this._normalTask=TS,this._updatingObjects=xS([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=UNe(),this._memoryController=q0t(this.view),this._streamDataLoader=new U$,this._streamDataLoader.setup(H0t,G0t,this._scheduler),this.addHandles([Fe(()=>this.view.state?.mode,e=>{e!=null&&(this._scheduler.state=e)},$r),Fe(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=$2({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(Zt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(Zt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=nn(this._frameTask),this._streamDataLoader=ct(this._streamDataLoader),this._memoryController=ct(this._memoryController),this._scheduler=ct(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some(e=>e.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const i=this._streamDataLoader;return{request:(r,n,s)=>i.request(r,n,e,s),get busy(){return!i.hasDownloadSlots(e)}}}addUpdatingObject(e){const i=this._updatingObjects;return i.value=[...i.value,e],Sr(()=>{i.value=i.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(dJ(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};_([T()],Bd.prototype,"view",void 0),_([T()],Bd.prototype,"_scheduler",void 0),_([T()],Bd.prototype,"_memoryController",void 0),_([T()],Bd.prototype,"_streamDataLoader",void 0),_([T()],Bd.prototype,"_immediateTask",void 0),_([T()],Bd.prototype,"_normalTask",void 0),_([T()],Bd.prototype,"_updatingObjects",void 0),_([T({readOnly:!0})],Bd.prototype,"updating",null),Bd=_([Z("esri.views.3d.support.ResourceControllerImpl")],Bd);function smt(t){return xAe(t)}function omt(t){return"performanceInfo"in t}var Pa,Ht;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(Pa||(Pa={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(Ht||(Ht={}));const k3=H(),amt=H(),am=H(),lm=H();function lmt(t,e,i=0){const r=t.extent;if(r==null)return!1;if(i===0)return i1e(r,e);const n=Math.min(r[2]-r[0],r[3]-r[1]);return NDe(r,e,i*n)}function m9(t,e,i,r){Ie(k3,i),k3[r]=e[r];const n=Be(k3,k3,e),s=Be(amt,t,e),a=He(s,n),u=He(n,n);let p;p=a<=0?e:u<=a?i:Ue(k3,e,Pe(n,n,a/u));const y=Be(k3,t,p);return Math.PI/2-Math.atan(y[2]/Math.sqrt(y[0]*y[0]+y[1]*y[1]))}function cmt(t,e,i){const r=t.extent;if(r==null)return 0;am[0]=r[0],am[1]=r[1],am[2]=i,lm[0]=r[2],lm[1]=r[3],lm[2]=i;let n=1/0,s=1/0;return e[0]<am[0]?n=m9(e,am,lm,0):e[0]>lm[0]&&(n=m9(e,lm,am,0)),e[1]<am[1]?s=m9(e,am,lm,1):e[1]>lm[1]&&(s=m9(e,lm,am,1)),Math.min(n,s)}function umt(t,e,i){if(t==null)return VZ();if(t.spatialReference.isGeographic&&!uv(t.spatialReference))return new de("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=Mc.checkUnsupported(t);if(r!=null)return r;if(i==null)return new de("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const n=hmt(t,i);if(n)return n;const s=t.spatialReference;return e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new de("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function hmt(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,n=[r*t.size[0],r*t.size[1]],s=[t.origin.x,t.origin.y],a=t1e(e),u=Di();Mc.computeRowColExtent(a,n,s,u);const p=(u[2]-u[0])*(u[3]-u[1]);if(p>fT){const y=i[0].scale*2**i[0].level;let b=Math.max((a[3]-a[1])/t.size[1],(a[2]-a[0])/t.size[0])*y/r;const S=Math.floor(Math.log(b)/Math.log(10));return b=Math.ceil(b/10**S)*10**S,new de("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(y).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+b.toLocaleString()+".",{level0Scale:y,suggestedLevel0Scale:b,requiredNumRootTiles:p,allowedNumRootTiles:fT})}return null}const dmt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:umt,isInsideExtent:lmt,tiltToExtentEdge:cmt},Symbol.toStringTag,{value:"Module"}));function pmt(){return!0}function fmt(){return 0}function mmt(t,e){if(t==null)return VZ();const i=t.lods.length-1,r=t.spatialReference,n=uv(r)||L0(r)||D0(r);if(r.isWebMercator){if(!Mc.makeWebMercatorAuxiliarySphere(i).compatibleWith(t))return new de("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n)return new de("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Mc.makeGCSWithTileSize(t.spatialReference,t.size[0],i).compatibleWith(t))return t.spatialReference.isWGS84?new de("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new de("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new de("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const gmt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:mmt,isInsideExtent:pmt,tiltToExtentEdge:fmt},Symbol.toStringTag,{value:"Module"})),ymt={[ht.Global]:gmt,[ht.Local]:dmt};function Qf(t,e){t||console.warn("Terrain: "+e)}let Ks=!1,I8=!1;function vmt(t){I8=t,Ks=Ks||t}function _mt(t){Ks=t}function tt(t,e){if(Ks&&!t){const i=new Error().stack?.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function Vq(t){return SN(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function $8(t){return t?.type==="imagery-tile"||t?.type==="wcs"}function SN(t){return t?.type==="imagery-tile-3d"}function uee(t){return t?.type==="tile-3d"}function YS(t){return t?.type==="vector-tile-3d"}function TAe(t){return t?.type==="wmts-3d"}function Gq(t){return t?.type==="elevation-3d"}function $C(t){return t?.type==="group"}function xO(t){return t&&(uee(t)||TAe(t)||SN(t)||YS(t))}function Hq(t){return t&&(uee(t)||SN(t)||YS(t)||TAe(t))}function TO(t){return Hq(t)||Gq(t)}function bmt(t){const e=t?.sourceLayerInfo?.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function wmt(t){return SAe(t?.sourceLayerInfo)||!!t?.isVTLBackground}function xmt(t){const e=t?.sourceLayerInfo?.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function Tmt(t){const e=t?.sourceLayerInfo?.data;return e instanceof HTMLImageElement||e instanceof cee||e instanceof HTMLCanvasElement||e instanceof ImageData}function SAe(t){return t?.data!=null&&"type"in t.data&&t.data.type==="vector-tile"}function JT(t){return t!=null&&"release"in t&&t.release(),null}function uue(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function hee(t,e,i,r){return ymt[r].checkIfTileInfoSupportedForViewSR(t,i,e)}function EN(t,e,i){let r=null,n=null;if(t?.type==="wmts"){const s=Smt(t,e,i);r=s.tileInfo,n=s.fullExtent}else{n=$8(t)?t.getCompatibleFullExtent(e):t.fullExtent;const s=i===ht.Local;if($8(t))r=t.getCompatibleTileInfo(e,n,s);else if(t?.type==="vector-tile"){const a=s&&!Emt(e)||Cmt.force512VTL,u=t.tileInfo.spatialReference.isGeographic;r=a?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,u?1:2)}else r=t.tileInfo}return r!=null&&n!=null&&hee(r,n,e,i)==null?{tileInfo:r,fullExtent:n}:null}function Smt(t,e,i){const r=xLe(t);if(r!=null){if(!Dt.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const n=r.find(s=>hee(s.tileInfo,s.fullExtent,e,i)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Emt(t){return t.isWGS84||t.isWebMercator||kme(t)||!oS(t)}const Cmt={force512VTL:!1};function hue(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function cm(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function Uh(t,e,i=Rmt){return Math.abs(t-e)<i}function L8(t){return t===Ht.NORTH_EAST?Ht.SOUTH_WEST:t===Ht.NORTH_WEST?Ht.SOUTH_EAST:t===Ht.SOUTH_WEST?Ht.NORTH_EAST:Ht.NORTH_WEST}function dee(t){return t===Ht.NORTH?Ht.SOUTH:t===Ht.EAST?Ht.WEST:t===Ht.SOUTH?Ht.NORTH:Ht.EAST}function Amt(t){return t===Ht.NORTH_WEST||t===Ht.SOUTH_WEST}function Omt(t){return t===Ht.NORTH_WEST||t===Ht.NORTH_EAST}function due(t){return t===Ht.NORTH_WEST||t===Ht.WEST||t===Ht.SOUTH_WEST}function pue(t){return t===Ht.NORTH_EAST||t===Ht.EAST||t===Ht.SOUTH_EAST}function fue(t){return t===Ht.SOUTH_EAST||t===Ht.SOUTH||t===Ht.SOUTH_WEST}function mue(t){return t===Ht.NORTH_EAST||t===Ht.NORTH||t===Ht.NORTH_WEST}const ag=[Ht.NORTH,Ht.EAST,Ht.SOUTH,Ht.WEST],D8=[Ht.NORTH_EAST,Ht.SOUTH_EAST,Ht.SOUTH_WEST,Ht.NORTH_WEST],Rmt=1e-5;let Mmt=class{constructor(e,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=TO(e)?i.basemapTerrain.getUsedMemoryForLayerView(e):e.usedMemory,omt(e)){const r=e.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}},Pmt=class{constructor(e){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const i=e.resourceController.memoryController;this.totalMemory=(i.maxMemory??0)*EL.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=i.usedCacheMemory}this.terrainMemory=e.basemapTerrain?.usedMemory??0,this.edgesMemory=e?._stage?.renderer?.edgeView?.usedMemory??0,this.fboMemory=e?._stage?.renderer?.memoryInfo?.fbos??0,e.allLayerViews.items.forEach(i=>{(smt(i)||TO(i))&&this.layerPerformanceInfos.push(new Mmt(i,e))}),this.layerPerformanceInfos.sort((i,r)=>r.memory-i.memory)}},Imt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,i,r){const n=r?`gltfPBR:${e}`:`gltf:${e}`,s=this._gltfMemCache.get(n);return s!=null?Promise.resolve(s):this._loadOnce(this._gltfLoading,this._gltfMemCache,n,a=>w5e(new _5e(a.streamDataRequester),e,a,r),i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,n=this._wosrMemCache.get(r);return n!=null?Promise.resolve(n):this._loadOnce(this._wosrLoading,this._wosrMemCache,r,s=>x5e(e,s),i)}async _loadOnce(e,i,r,n,s){oi(s);const a=qs(s,()=>this._abortLoad(e,r));let u=e.get(r);if(u)u.refCount++;else{const p=new AbortController;u={refCount:1,abortController:p,promise:n({...s,signal:p.signal})},e.set(r,u)}try{const p=await u.promise;return i.put(r,p,p.size),e.delete(r),oi(s),p}finally{nn(a)}}_abortLoad(e,i){const r=e.get(i);r!=null&&--r.refCount>0||(e.delete(i),r?.abortController.abort())}},ST=class extends Ke{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=i?.registerTask(Zt.TEXTURE_UNLOAD)??TS}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,i){const r=this.makeUid(e);let n=this._textureRequests.get(r);if(!n){const s=new EAe;s.texture=i(),this._stage&&(s.texture.load(this._stage.renderView.renderingContext),this._stage.add(s.texture)),this._textureRequests.set(r,s),n=s}return n.referenceCount++,{uid:r,texture:n.texture,release:()=>this._release(r)}}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||(i.texture?.unload(),this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return i!=null?`${e}.${i}px`:e}};_([T()],ST.prototype,"_frameTask",void 0),_([T()],ST.prototype,"updating",null),ST=_([Z("esri.views.3d.support.TextureCollection")],ST);let EAe=class{constructor(){this.referenceCount=0}},$mt=class extends ST{constructor(e,i,r){super(i,r),this._streamDataRequester=e}async fromUrl(e,i,r){oi(r);const n=r!=null?r.signal:null,s=this.makeUid(e,i);let a=this._textureRequests.get(s);if(!a){const u=new AbortController,p=this._streamDataRequester.request(e,"image",{uid:s,signal:u.signal});a=new EAe,a.abortController=u;const y=a;this._textureRequests.set(s,a),a.textureAsync=p.then(async b=>{const S=this._createTexture(e,b,i);return y.texture=S,y.abortController=null,await S.load(this._stage.renderView.renderingContext),this._stage.add(S),{uid:s,texture:S,release:()=>this._release(s)}},b=>{throw y.abortController=null,b})}a.referenceCount++;try{return await R0e(a.textureAsync,n)}catch(u){throw this._release(s),u}}_createTexture(e,i,r){const n={width:i.width,height:i.height,wrap:{s:Ai.CLAMP_TO_EDGE,t:Ai.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(bme(e)){if(r||i.width===0&&i.height===0){const s=i.width?i.height/i.width:1;r=r||64,s>1?(i.width=Math.round(r/s),i.height=r):(i.width=r,i.height=Math.round(r*s))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return new Nw(i,n)}},Lmt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(o0.SYMBOLOGY),this.objectResourceCache=new Imt((r,n)=>e.resourceController.memoryController.newCache(r,n)),this.textures=new $mt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const i=Mr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=rTe(e.viewingMode,i),this.screenSizePerspectiveSettingsLabels=xtt(e.viewingMode,i)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Sr();this._graphicsOwners.push(e);const i=Fe(()=>e.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Sr(()=>{i.remove(),A4(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(i=>i.layer?.screenSizePerspectiveEnabled===!0);if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Dg;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([Fe(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,$r),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=ct(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;g9.distance=e.centerOnSurfaceInfrequent.distance,g9.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(g9),this.screenSizePerspectiveSettingsLabels.update(g9),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const g9={distance:0,fovY:0};let Dx=class{constructor(e,i,r=""){this.graphics=e,this._symbol=new Uy({symbolLayers:new Dt([new zy({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new Tw({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})])})}show(e,i){if(i==null)return;this.hide();const r=new Wt({x:e[0],y:e[1],z:e[2],spatialReference:i});this._graphic=new Fp({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},Oy=class extends Ke{constructor(e){super(e)}};_([T({constructOnly:!0})],Oy.prototype,"renderCoordsHelper",void 0),_([T({constructOnly:!0})],Oy.prototype,"surface",void 0),_([T({constructOnly:!0})],Oy.prototype,"state",void 0),Oy=_([Z("esri.views.3d.support.PointOfInterest")],Oy);const Dmt=Array;let Vd=class extends Oy{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Mg({location:Wt,renderLocation:Dmt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=H(),this._tmpPoint=new Wt}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(ga(()=>this.map?.ground?.layers,"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=ct(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,i=un(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Z2(r,i,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map?.ground)return this._updateSurfaceAltitude(0),ya.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const i=(this._tmpPoint.z??0)>Nmt&&this.renderCoordsHelper.viewingMode===ht.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?Fmt:0}).then(n=>this._updateSurfaceAltitude(n.geometry.z??0)).catch(n=>{qn(n)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,ya.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(Kz,this._estimatedSurfaceAltitude,this._camera.eye),pa(this._get("renderLocation"),Kz)||(this._set("renderLocation",Ie(this._propertiesPool.get("renderLocation"),Kz)),this.notifyChange("renderLocation"))}};_([T({constructOnly:!0})],Vd.prototype,"scheduler",void 0),_([T({constructOnly:!0})],Vd.prototype,"cache",void 0),_([T({constructOnly:!0})],Vd.prototype,"task",void 0),_([T({readOnly:!0})],Vd.prototype,"location",null),_([T({constructOnly:!0})],Vd.prototype,"map",void 0),_([T({readOnly:!0})],Vd.prototype,"renderLocation",void 0),_([T({readOnly:!0})],Vd.prototype,"scale",null),_([T({readOnly:!0})],Vd.prototype,"updating",null),Vd=_([Z("esri.views.3d.support.CameraOnSurface")],Vd);const Kz=H(),Nmt=1e5,Fmt=1e6,kmt=Array;let Ah=class extends Oy{constructor(e){super(e),this._propertiesPool=new Mg({location:Wt,renderLocation:kmt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=H(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=nn(this._frameWorker),this._propertiesPool=ct(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,ya.YIELD}_updateRenderLocation(){const e=Umt;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const n=jmt;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,n)&&(Ie(e,n),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=un(this._camera.eye,e):(Pe(e,this._camera.viewForward,this._get("distance")),Ue(e,e,this._camera.eye)),pa(this._get("renderLocation"),e)||this._set("renderLocation",Ie(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){const r=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const n=Mr(this.renderCoordsHelper.spatialReference).radius,s=n+e,a=ha(r.eye),u=a<s*s,p=un(r.eye,i);if(u&&p>n/4){const y=s-Math.sqrt(a);return Pe(i,r.viewForward,y),Ue(i,i,r.eye),!0}}else{const n=this.surface?.ready?this.surface.extent:null;n!=null&&h7(n,this.surface?.spatialReference,LC,this.renderCoordsHelper.spatialReference)&&(i[0]=Je(i[0],LC[0],LC[2]),i[1]=Je(i[1],LC[1],LC[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(Xr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,n=un(r,e),s=un(r,i);if(Math.abs(s-n)/n>zmt)return!0}return!1}};_([T({constructOnly:!0})],Ah.prototype,"scheduler",void 0),_([T({constructOnly:!0})],Ah.prototype,"task",void 0),_([T()],Ah.prototype,"distance",void 0),_([T({constructOnly:!0})],Ah.prototype,"estimateSurfaceAltitudeAtCenter",void 0),_([T({readOnly:!0})],Ah.prototype,"location",null),_([T({readOnly:!0})],Ah.prototype,"renderLocation",void 0),_([T()],Ah.prototype,"updating",void 0),Ah=_([Z("esri.views.3d.support.CenterOnSurface")],Ah);const zmt=.05,Umt=H(),jmt=H(),LC=Di();let Bmt=class{constructor(e){this._handles=new Dg,this.events=new Xn,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=ct(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),e.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",Vmt)}};const Vmt={},Gmt=Array;let kf=class extends Oy{constructor(e){super(e),this._propertiesPool=new Mg({location:Wt,renderLocation:Gmt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([Fe(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),Fe(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(Zt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=ct(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,n=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,gue);const s=Math.max(0,(Math.acos(He(gue,n.viewForward))-.5*Math.PI)*(n.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!j2(e,i)){const y=this._propertiesPool.get("renderLocation");Ie(y,i),this._set("renderLocation",y)}return ya.YIELD}const a=1-Je(s/(.5*Math.PI),0,1),u=a*a*a;this._calculateScreenHorizontalEdgeOnSurface(yue);const p=this._propertiesPool.get("renderLocation");return Ir(p,i,yue,u),e&&j2(e,p)||this._set("renderLocation",p),ya.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(fa());if(r[1]=i.aboveGround?i.padding[zi.BOTTOM]:i.fullHeight-i.padding[zi.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const n=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,DC)){Be(DC,DC,i.eye);const s=We(DC,DC);if(this.renderCoordsHelper.intersectInfiniteManifold(eh(i.eye,s),n,e))return e}return this.renderCoordsHelper.setAltitude(e,n,i.eye)}updateRenderLocation(){this._dirty=!0}};_([T()],kf.prototype,"_dirty",void 0),_([T({constructOnly:!0})],kf.prototype,"scheduler",void 0),_([T({constructOnly:!0})],kf.prototype,"centerOnSurface",void 0),_([T({constructOnly:!0})],kf.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),_([T({readOnly:!0})],kf.prototype,"updating",null),_([T({readOnly:!0})],kf.prototype,"location",null),_([T({readOnly:!0})],kf.prototype,"renderLocation",void 0),kf=_([Z("esri.views.3d.support.pointsOfInterest.Focus")],kf);const gue=H(),DC=H(),yue=H();let Am=class extends Ke{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=H();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([Fe(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),ga(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),this.surfaceView?.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=oY(this.surfaceView.extent),i=new Wt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{qn(r)||r&&r.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",r)})):this._set("location",i)}};_([T({constructOnly:!0})],Am.prototype,"view",void 0),_([T({constructOnly:!0})],Am.prototype,"cache",void 0),_([T()],Am.prototype,"surface",null),_([T()],Am.prototype,"surfaceView",null),_([T({readOnly:!0})],Am.prototype,"location",void 0),_([T({readOnly:!0})],Am.prototype,"renderLocation",null),Am=_([Z("esri.views.3d.terrain.StableSurfaceCenter")],Am);let Om=class extends Ke{constructor(e){super(e),this._tileGeometryUpdateExtent=rd(),this._tileGeometryUpdateSpatialReference=null,this.events=new Xn,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(Zt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Hmt),rd(this._tileGeometryUpdateExtent),this._set("updating",!1)),ya.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Yy(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,n=qmt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,x_,i),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,T_,i),x_[0]<T_[0]?(n[0]=x_[0],n[2]=T_[0]):(n[0]=T_[0],n[2]=x_[0]),x_[1]<T_[1]?(n[1]=x_[1],n[3]=T_[1]):(n[1]=T_[1],n[3]=x_[1]),GD(n,e)}};_([T({constructOnly:!0})],Om.prototype,"state",void 0),_([T({constructOnly:!0})],Om.prototype,"centerOnSurfaces",void 0),_([T({constructOnly:!0})],Om.prototype,"renderCoordsHelper",void 0),_([T({constructOnly:!0})],Om.prototype,"scheduler",void 0),_([T({constructOnly:!0})],Om.prototype,"surface",void 0),_([T({readOnly:!0})],Om.prototype,"updating",void 0),Om=_([Z("esri.views.3d.support.SurfaceGeometryUpdates")],Om);const Hmt={},x_=H(),T_=H(),qmt=rd();let jl=class extends Ke{constructor(e){super(e),this._handles=new Dg,this._tmpRay=oo(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Mg({renderPointOfView:Wmt},this),this.renderPointOfView=H(),this._pois=new Array,this._debugCenters=new Map}initialize(){const{state:e,basemapTerrain:i,renderCoordsHelper:r,map:n}=this.view;this._surfaceIntersector=ad(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Jo.MIN,this._contentIntersector=ad(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),a=this.view.resourceController.scheduler,u=this.view.basemapTerrain?.elevationQueryCache,p={state:e,scheduler:a,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Ah({...p,task:Zt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new Ah({...p,task:Zt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new Ah({...p,task:Zt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new Vd({...p,cache:u,task:Zt.POINT_OF_INTEREST_INFREQUENT,map:n})),this._set("surfaceGeometryUpdates",new Om({...p,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Bmt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new Am({cache:u,view:this.view})),this._set("focus",new kf({state:e,scheduler:a,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(b,S)=>this._estimateSurfaceIntersectionAtRenderPoint(b,this.view.state.contentCamera,S)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const y=this.view.graphics;this._debugCenters.set(this.centerOnContent,new Dx(y,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new Dx(y,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new Dx(y,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new Dx(y,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new Dx(y,"green","Focus")),this._handles.add([Fe(()=>e.contentCamera,b=>this._cameraChanged(b),$r),Fe(()=>i.extent,()=>this._updateCenterPointsOfInterest()),Qu(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),$r),ga(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),ga(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Qu(()=>Xr.SHOW_POI,b=>this._setDebug(b),jr)]),this._cameraChanged(this.view.state.contentCamera);for(const b of this._pois)b.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(e=>e.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,z3,Jmt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(z3):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const i=e.origin,r=Ue(z3,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,r),this._surfaceIntersector.results.min.getIntersectionPoint(z3)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(z3)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const n=$K(i,e,Xmt);if(n==null)return null;const s=n.origin,a=Ue(z3,n.origin,n.direction);return this._surfaceIntersector.resetWithRay(n,i),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,a),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;pa(this.renderPointOfView,i)||this._set("renderPointOfView",Ie(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(i=>i.hide()),void this._handles.remove("debug");for(const i of this._pois)this._handles.add(Fe(()=>i.renderLocation,r=>this._debugCenters.get(i)?.show(r,i.renderCoordsHelper.spatialReference),jr),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};_([T({readOnly:!0})],jl.prototype,"centerOnContent",void 0),_([T({readOnly:!0})],jl.prototype,"centerOnSurfaceFrequent",void 0),_([T({readOnly:!0})],jl.prototype,"centerOnSurfaceInfrequent",void 0),_([T({readOnly:!0})],jl.prototype,"cameraOnSurface",void 0),_([T({readOnly:!0})],jl.prototype,"focus",void 0),_([T({readOnly:!0})],jl.prototype,"renderPointOfView",void 0),_([T({readOnly:!0})],jl.prototype,"surfaceOrigin",void 0),_([T({readOnly:!0})],jl.prototype,"contentGeometryUpdates",void 0),_([T({readOnly:!0})],jl.prototype,"surfaceGeometryUpdates",void 0),_([T({constructOnly:!0})],jl.prototype,"view",void 0),_([T({readOnly:!0})],jl.prototype,"updating",null),jl=_([Z("esri.views.3d.support.PointsOfInterest")],jl);const Wmt=Array,z3=H(),Xmt=oo(),Jmt={exclude:new Set([Ey])},xl=(t=>t)(["operational-layers","basemap","ground"]),Hy=new Dt,g4=new WeakMap;function Ymt(t){Kmt(t)&&Hy.push(new WeakRef(t))}function Zmt(t){const e=Hy.find(i=>i.deref()===t);e&&Hy.remove(e)}function Kmt(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function CAe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:CAe(e,t%e):0}let Qz=0,y9=0;function Qmt(){const t=Date.now();let e=!1;for(const i of Hy){const r=i.deref();r?r.refreshInterval&&t-(g4.get(r)??0)+5>=6e4*r.refreshInterval&&(g4.set(r,t),r.refresh(t)):e=!0}if(e)for(let i=Hy.length-1;i>=0;i--)Hy.at(i).deref()||Hy.removeAt(i)}N0e(()=>{const t=Date.now();let e=0;for(const i of Hy){const r=i.deref();r&&(e=CAe(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?g4.get(r)||g4.set(r,t):g4.delete(r))}if(e!==y9){if(y9=e,clearInterval(Qz),y9===0)return void(Qz=0);Qz=setInterval(Qmt,y9)}});function egt(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const vue=.1,AAe=t=>{let e=class extends t{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=oE(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||Ymt(this)},()=>{})}destroy(){Zmt(this)}castRefreshInterval(i){return i>=vue?i:i<=0?0:vue}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){O4(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{Ee.getLogger(this).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}get test(){const i=this;return{set refreshInterval(r){i._set("refreshInterval",r)}}}};return _([T({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:xl}}}}})],e.prototype,"refreshInterval",void 0),_([Fi("refreshInterval")],e.prototype,"castRefreshInterval",null),_([T({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),_([T({readOnly:!0})],e.prototype,"refreshParameters",null),e=_([Z("esri.layers.mixins.RefreshableLayer")],e),e};let tgt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i,i.values.byteLength+256)}},igt=class{constructor(e,i,r,n){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=i,this.height=r,this.noDataValue=n)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:i}=this;let r=1/0,n=-1/0,s=!0;for(const a of i)a===e?this._hasNoDataValues=!0:(r=a<r?a:r,n=a>n?a:n,s=!1);s?(this._minValue=0,this._maxValue=0):(this._minValue=r,this._maxValue=n>-3e38?n:0)}},OAe=class{constructor(e,i,r,n,s={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=oZ(e,{...s,schedule:n}).then(a=>{if(this._thread===void 0){this._thread=a,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const u of this._listeners)this._connectListener(u)}else a.close()}),this._promise.catch(a=>Ee.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${a}`))}on(e,i){const r={removed:!1,eventName:e,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),Sr(()=>{r.removed=!0,rJ(this._listeners,r),this._thread&&r.threadHandle!=null&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,i){return this.invokeMethod(this._mainMethod,e,i)}invokeMethod(e,i,r){if(this._thread){const n=this._transferLists[e],s=n?n(i):[];return this._thread.invoke(e,i,{transferList:s,signal:r})}return this._promise?this._promise.then(()=>(oi(r),this.invokeMethod(e,i,r))):Promise.reject(null)}broadcast(e,i){return this._thread?Promise.all(this._thread.broadcast(i,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,i)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(i=>{e.removed||(e.threadHandle=i)})}},_ue=class extends OAe{constructor(e=null){super("LercWorker","_decode",{_decode:i=>[i.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,i,r){return e&&e.byteLength!==0?this.invoke({buffer:e,options:i},r):Promise.resolve(null)}release(){--this.ref<=0&&(y4.forEach((e,i)=>{e===this&&y4.delete(i)}),this.destroy())}};const y4=new Map;function rgt(t=null){let e=y4.get(t);return e||(t!=null?(e=new _ue(i=>t.immediate.schedule(i)),y4.set(t,e)):(e=new _ue,y4.set(null,e))),++e.ref,e}var Oc,bue,wue;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(Oc||(Oc={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(bue||(bue={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(wue||(wue={}));let ngt=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},Gzt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function qzt(t,e,i,r,n,s){const a=i-n;if(a>=0)return(e>>a)+(r-(s<<a))*(t>>a);const u=-a;return e-(s-(r<<u))*(t>>u)<<u}let Wzt=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(let s=0;s<this._columns;s++)this.cells[n][s]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),n=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][n]||null}getCellSpan(e,i,r,n){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function sgt(t,e,i,r,n,s){const a=e[r++];for(let u=0;u<a;u++){const p=new ngt(s);p.xTile=e[r++],p.yTile=e[r++],p.hash=e[r++],p.priority=e[r++];const y=e[r++];for(let C=0;C<y;C++){const O=e[r++],P=e[r++],$=e[r++],N=e[r++],z=!!e[r++],U=e[r++],j=i[r++],G=i[r++],q=e[r++],W=e[r++];p.colliders.push({xTile:O,yTile:P,dxPixels:$,dyPixels:N,hard:z,partIndex:U,width:q,height:W,minLod:j,maxLod:G})}const b=t[r++];for(let C=0;C<b;C++)p.textVertexRanges.push([t[r++],t[r++]]);const S=t[r++];for(let C=0;C<S;C++)p.iconVertexRanges.push([t[r++],t[r++]]);n.push(p)}return r}function Jzt(t,e,i){for(const[r,n]of t.symbols)ogt(t,e,i,n,r)}function ogt(t,e,i,r,n){const s=t.layerData.get(n);if(s.type===Oc.SYMBOL){for(const a of r){const u=a.unique;let p;if(a.selectedForRendering){const y=u.parts[0],b=y.startOpacity,S=y.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&S===0;const C=i?Math.floor(127*b)|S<<7:S?255:0;p=C<<24|C<<16|C<<8|C}else p=0;for(const[y,b]of a.iconVertexRanges)for(let S=y;S<y+b;S+=4)s.iconOpacity[S/4]=p;if(a.selectedForRendering){const y=u.parts[1],b=y.startOpacity,S=y.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&S===0;const C=i?Math.floor(127*b)|S<<7:S?255:0;p=C<<24|C<<16|C<<8|C}else p=0;for(const[y,b]of a.textVertexRanges)for(let S=y;S<y+b;S+=4)s.textOpacity[S/4]=p}s.lastOpacityUpdate=e,s.opacityChanged=!0}}let CN=class{constructor(e,i){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let r=1;const n=new Uint32Array(e);this.layerUIDs=[];const s=n[r++];for(let a=0;a<s;a++)this.layerUIDs[a]=n[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},agt=class extends CN{constructor(e,i){super(e,i),this.type=Oc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let n=this.bufferDataOffset;this.lineIndexStart=r[n++],this.lineIndexCount=r[n++];const s=r[n++];if(s>0){this.patternMap=new Map;for(let a=0;a<s;a++){const u=r[n++],p=r[n++],y=r[n++];this.patternMap.set(u,[p,y])}}this.bufferDataOffset=n}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=jt(this.vao)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),a=n[r++],u=xr.createVertex(e,dr.STATIC_DRAW,new Int32Array(s.buffer,4*r,a));r+=a;const p=n[r++],y=xr.createIndex(e,dr.STATIC_DRAW,new Uint32Array(n.buffer,4*r,p));r+=p;const b=this.layer.lineMaterial;this.vao=new cd(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:u},y)}},lgt=class extends CN{constructor(e,i){super(e,i),this.type=Oc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let n=this.bufferDataOffset;this.fillIndexStart=r[n++],this.fillIndexCount=r[n++],this.outlineIndexStart=r[n++],this.outlineIndexCount=r[n++];const s=r[n++];if(s>0){this.patternMap=new Map;for(let a=0;a<s;a++){const u=r[n++],p=r[n++],y=r[n++];this.patternMap.set(u,[p,y])}}this.bufferDataOffset=n}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=jt(this.fillVAO),this.outlineVAO=jt(this.outlineVAO)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),a=n[r++],u=xr.createVertex(e,dr.STATIC_DRAW,new Int32Array(s.buffer,4*r,a));r+=a;const p=n[r++],y=xr.createIndex(e,dr.STATIC_DRAW,new Uint32Array(n.buffer,4*r,p));r+=p;const b=n[r++],S=xr.createVertex(e,dr.STATIC_DRAW,new Int32Array(s.buffer,4*r,b));r+=b;const C=n[r++],O=xr.createIndex(e,dr.STATIC_DRAW,new Uint32Array(n.buffer,4*r,C));r+=C;const P=this.layer,$=P.fillMaterial,N=P.outlineMaterial;this.fillVAO=new cd(e,$.getAttributeLocations(),$.getLayoutInfo(),{geometry:u},y),this.outlineVAO=new cd(e,N.getAttributeLocations(),N.getLayoutInfo(),{geometry:S},O)}},cgt=class extends CN{constructor(e,i,r){super(e,i),this.type=Oc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const n=new Uint32Array(e),s=new Int32Array(e),a=new Float32Array(e);let u=this.bufferDataOffset;this.isIconSDF=!!n[u++];const p=n[u++];for(let C=0;C<p;C++){const O=n[u++],P=n[u++],$=n[u++];this.iconPerPageElementsMap.set(O,[P,$])}const y=n[u++];for(let C=0;C<y;C++){const O=n[u++],P=n[u++],$=n[u++];this.glyphPerPageElementsMap.set(O,[P,$])}const b=n[u++],S=n[u++];this.iconOpacity=new Int32Array(b),this.textOpacity=new Int32Array(S),u=sgt(n,s,a,u,this.symbols,r),this.bufferDataOffset=u}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+rv(this.iconOpacity)+rv(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[i,r]of this.iconPerPageElementsMap)e+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){this.iconVAO=jt(this.iconVAO),this.textVAO=jt(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,i=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===i.byteLength&&i.setSubData(e,0,0,e.length);const r=this.textOpacity,n=this.textVAO.vertexBuffers.opacity;r.length>0&&r.byteLength===n.byteLength&&n.setSubData(r,0,0,r.length)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),a=n[r++],u=xr.createVertex(e,dr.STATIC_DRAW,new Int32Array(s.buffer,4*r,a));r+=a;const p=n[r++],y=xr.createIndex(e,dr.STATIC_DRAW,new Uint32Array(n.buffer,4*r,p));r+=p;const b=n[r++],S=xr.createVertex(e,dr.STATIC_DRAW,new Int32Array(s.buffer,4*r,b));r+=b;const C=n[r++],O=xr.createIndex(e,dr.STATIC_DRAW,new Uint32Array(n.buffer,4*r,C));r+=C;const P=xr.createVertex(e,dr.STATIC_DRAW,this.iconOpacity.buffer),$=xr.createVertex(e,dr.STATIC_DRAW,this.textOpacity.buffer),N=this.layer,z=N.iconMaterial,U=N.textMaterial;this.iconVAO=new cd(e,z.getAttributeLocations(),z.getLayoutInfo(),{geometry:u,opacity:P},y),this.textVAO=new cd(e,U.getAttributeLocations(),U.getLayoutInfo(),{geometry:S,opacity:$},O)}},ugt=class extends CN{constructor(e,i){super(e,i),this.type=Oc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let n=this.bufferDataOffset;this.circleIndexStart=r[n++],this.circleIndexCount=r[n++],this.bufferDataOffset=n}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=jt(this.vao)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),a=n[r++],u=xr.createVertex(e,dr.STATIC_DRAW,new Int32Array(s.buffer,4*r,a));r+=a;const p=n[r++],y=xr.createIndex(e,dr.STATIC_DRAW,new Uint32Array(n.buffer,4*r,p));r+=p;const b=this.layer.circleMaterial;this.vao=new cd(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:u},y)}};const tUt=!0,iUt=32,xue=200,hgt=1/Me("mapview-transitions-duration");let dgt=class extends Xn{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const i=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i?.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Ys(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Ys(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver?.(),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===r)this.computedVisible=this.visible;else{const s=e*hgt;this.computedOpacity=n>r?Math.max(r,n-s):Math.min(r,n+s),this.computedVisible=this.computedOpacity>0;const a=r===this.computedOpacity;this.inFadeTransition=!a,a||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},lw=class mb{static getId(e,i,r,n){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${n}`}constructor(e,i,r,n){this.set(e,i,r,n)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,n){this.set(e,i,r,n)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new mb(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,n){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[s,a,u,p]=e.split("/");this.level=parseFloat(s),this.row=parseFloat(a),this.col=parseFloat(u),this.world=parseFloat(p)}else this.level=+e,this.row=+i,this.col=+r,this.world=+n||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new mb(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,n=this.world;return[new mb(e,i,r,n),new mb(e,i,r+1,n),new mb(e,i+1,r,n),new mb(e,i+1,r+1,n)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};lw.pool=new Ua(lw,null,null,25,50);let RAe=class extends dgt{constructor(e,i,r,n,s,a,u=s,p=a){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new lw(e),this.resolution=i,this.x=r,this.y=n,this.width=s,this.height=a,this.rangeX=u,this.rangeY=p}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*i,u=this.height/this.rangeY*i;CZ(r,a,0,0,0,u,0,n,s,1),IS(this.transforms.dvs,e.displayViewMat3,r)}},eU=class MAe extends RAe{constructor(e,i,r,n,s,a,u,p=null){super(e,i,r,n,s,a,4096,4096),this.styleRepository=u,this._memCache=p,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<xue}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<xue)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){let i=!1;for(const r of e){const n=this.layerData.get(r);n&&(this._memoryUsedByLayerData-=n.memoryUsed,n.type===Oc.SYMBOL&&this.symbols.delete(r)&&(i=!0),n.destroy(),this.layerData.delete(r))}this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){this.status!=="unloaded"&&(PAe.delete(this),MAe._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+256}changeDataImpl(e){let i=!1;if(e){const{bucketsWithData:r,emptyBuckets:n}=e,s=this._createRenderBuckets(r);if(n&&n.byteLength>0){const a=new Uint32Array(n);for(const u of a)this._deleteLayerData(u)}for(const[a,u]of s)this._deleteLayerData(a),u.type===Oc.SYMBOL&&(this.symbols.set(a,u.symbols),i=!0),this._memoryUsedByLayerData+=u.memoryUsed,this.layerData.set(a,u);this._memCache?.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const[r,n]of this.layerData)n.type===Oc.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const i=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,n=this.height/this.rangeY*i,s=[0,0];e.toScreen(s,[this.x,this.y]);const a=this.transforms.tileUnitsToPixels;AZ(a),$L(a,a,s),OZ(a,a,Math.PI*e.rotation/180),RZ(a,a,[r,n,1])}_createTransforms(){return{dvs:za(),tileMat3:za(),tileUnitsToPixels:za()}}static _destroyRenderBuckets(e){if(!e)return;const i=new Set;for(const r of e.values())i.has(r)||(r.destroy(),i.add(r));e.clear()}_createRenderBuckets(e){const i=new Map,r=new Map;for(const n of e){const s=this._deserializeBucket(n,r);for(const a of s.layerUIDs)i.set(a,s)}return i}_deserializeBucket(e,i){let r=i.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case Oc.FILL:r=new lgt(e,this.styleRepository);break;case Oc.LINE:r=new agt(e,this.styleRepository);break;case Oc.SYMBOL:r=new cgt(e,this.styleRepository,this);break;case Oc.CIRCLE:r=new ugt(e,this.styleRepository)}return i.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const i=this.layerData.get(e);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(e)}};const PAe=new Map;function pgt(){PAe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(i=>console.log(i)),console.log("========"),t[1].forEach(i=>console.log(i))})}const sUt={value:.5,readOnly:!0},fgt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let ET=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},mgt=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},ggt=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new mgt(r,i)}computeMinMaxValue(e,i,r,n){n.min=1/0,n.max=-1/0,n.hasNoDataValues=!1;const s=e-this.level;if(s<=0)return n;const a=2**s;if(!(Math.floor(i/a)===this.i&&Math.floor(r/a)===this.j))return n;let u=1/0,p=-1/0;const y=this.samplerData.data.width,b=this.samplerData.data.values,S=.5*Q4;let C=(y-1)/a,O=(r-this.j*a)*C,P=(i-this.i*a)*C;if(C<1){const $=Math.floor(O),N=Math.floor(P),z=$+N*y,U=b[z],j=b[z+1],G=b[z+y],q=b[z+y+1];if(U+j+G+q<S){const W=O-$,K=P-N,se=SM(U,j,G,q,W,K),ae=SM(U,j,G,q,W+C,K),le=SM(U,j,G,q,W,K+C),me=SM(U,j,G,q,W+C,K+C);return n.min=Math.min(se,ae,le,me),n.max=Math.max(se,ae,le,me),n}O=$,P=N,C=1}else O=Math.floor(O),P=Math.floor(P),C=Math.ceil(C);for(let $=O;$<=O+C;$++)for(let N=P;N<=P+C;N++){const z=b[$+N*y];z<S?(u=Math.min(u,z),p=Math.max(p,z)):n.hasNoDataValues=!0}return n.min=u,n.max=p,n}};const ygt=.5*Q4;function Ln(t,e,i){if(i==null)return null;for(const r of i){if(!r)continue;const n=r.safeWidth;let s=Je(r.dy*(r.y1-e),0,n),a=Je(r.dx*(t-r.x0),0,n);const u=Math.floor(s),p=Math.floor(a),y=r.data.width,b=u*y+p,S=r.data.values,C=S[b],O=S[b+1],P=b+y,$=S[P],N=S[P+1];if(C+$+O+N<ygt){s-=u,a-=p;const z=C+(O-C)*a;return z+($+(N-$)*a-z)*s}}return null}let Eh=class extends Ke{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if(r.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const n=IAe(r.fullExtent,this.viewSpatialReference);n!=null&&e.push(t1e(n))}}),e}};function vgt(t,e){return t===ht.Global?new qq(e):new Wq(e)}_([T({readOnly:!0})],Eh.prototype,"layerViewsExtent",null),_([T({readOnly:!0})],Eh.prototype,"tiledLayersExtent",null),_([T({readOnly:!0})],Eh.prototype,"stencilEnabledExtents",null),_([T()],Eh.prototype,"viewSpatialReference",void 0),_([T()],Eh.prototype,"tilingScheme",void 0),_([T()],Eh.prototype,"defaultTiledLayersExtent",void 0),_([T({constructOnly:!0})],Eh.prototype,"layers",void 0),_([T({constructOnly:!0})],Eh.prototype,"layerViews",void 0),Eh=_([Z("esri.views.3d.terrain.ExtentHelper")],Eh);let qq=class extends Eh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?G2e:Lqe}};qq=_([Z("esri.views.3d.terrain.ExtentHelperGlobal")],qq);let Wq=class extends Eh{_computeLayerViewsExtent(){const e=rd(),i=this.viewSpatialReference;this.layerViews.forEach(s=>{const a=s.layer;if(s.isResolved()&&(a.type!=="graphics"||!a.internal)){const u=IAe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,i);Yy(e,u,e)}});const r=lB(e)?e:null,n=this._get("layerViewsExtent");return f2(r,n)?n:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=rd();this.layers.forEach(a=>{if(a.loaded&&MA(a)){const u=EN(a,i,ht.Local);if(u==null)return;const{tileInfo:p,fullExtent:y}=u;p!=null&&y!=null&&($8(a)||e.compatibleWith(p)&&y.spatialReference.equals(e.spatialReference))&&Yy(r,y,r)}}),Yy(r,this.defaultTiledLayersExtent,r);const n=lB(r)?r:null,s=this._get("tiledLayersExtent");return f2(n,s)?s:n}};function IAe(t,e){return t==null||t.spatialReference.equals(e)?t:LA(t,t.spatialReference,e)}Wq=_([Z("esri.views.3d.terrain.ExtentHelperLocal")],Wq);var $i;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})($i||($i={}));const gb=[$i.ELEVATION,$i.MAP];function $Ae(){const t=globalThis.require?.modules;if(t){const e=Object.keys(t);for(const i of e)i.includes(".glsl")&&delete t[i]}}const LAe=1.3,_gt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let P1,kl=class extends Ke{get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Xr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Mr(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return LAe/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=Me("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){const e=this.view;this.renderer=new Ud({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.renderPlugins.add(this.renderer);const i=()=>this.setDrawTexturesDirty();this._groundIntersector=ad(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([Fe(()=>this.renderer.hasHighlights,i),this.renderer.events.on("has-water",r=>e._stage?.renderer.setParameters({hasOverlayWater:r})),this.renderer.events.on("renders-occluded",()=>{i(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",i),Fe(()=>e.state.camera.pixelRatio,i),Fe(()=>e.state.alignPixelEnabled,i),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),Fe(()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),Fe(()=>[e.state?.pixelRatio,e.state?.contentPixelRatio],()=>this.setPlacementDirty(),$r),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(Zt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(ml,r.camera,ns.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(ns.BACKGROUND,r)})]),e._stage.renderer.renderOverlay=r=>this._renderOverlay(r)}_renderOverlay(e){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._dispatchAnimationUpdate(e),this._drawOverlays(ns.UPDATE,this.view.state)}destroy(){this.view?._stage&&(this.view._stage.renderer.renderPlugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{}),P1&&(P1.hide(),P1=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const i=this.view.renderSpatialReference;e!=null&&i!=null?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new av(-20037508342787e-6,20037508342787e-6):new av(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,i,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this.renderer.createDrapeSourceRenderer(e,i,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),n}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,bu)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,ns.UPDATE)}_updateOverlays(e,i,r){if(!this._spatialReference)return ya.YIELD;const n=this._computeOverlayResolution(i);this._computeOverlayExtents(i,n,ff),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,ff.stretch);const s=this._updateOverlay(Ss.INNER,ff.inner,n,1*ff.pixelRatioAdjustment,ff.mapUnitsPerPixel),a=Na(ff.inner)/Na(ff.outer),u=this._updateOverlay(Ss.OUTER,ff.outer,n,a*ff.pixelRatioAdjustment,ff.mapUnitsPerPixel);s!==Wf.EXTENT&&u!==Wf.EXTENT||(this._drapeSources.forEach(p=>this._updateDrapeSourceExtent(p)),this.surface.updateTileOverlayParams(r)),s===Wf.NONE&&u===Wf.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const i=this.view.state.contentPixelRatio*this.view.resolutionScale,r=e.fullWidth/e.pixelRatio*i,n=e.fullHeight/e.pixelRatio*i,s=Math.ceil(1.5*Math.max(r,n));return Math.min(S2(s),this._maxResolution)}_updateOverlay(e,i,r,n,s){if(this.renderer.overlays.length===0)return Wf.NONE;const a=this.renderer.overlays[e],u=a.mapUnitsPerPixel;if(a.mapUnitsPerPixel=s,a.pixelRatio=n,bgt(i,a.extent)&&r===a.resolution)return u===s?Wf.NONE:Wf.RERENDER_ONLY;Sg(a.extent,i),a.resolution=r;const p=oY(a.extent);return a.renderLocalOrigin=g8(p[0],p[1],0,"OV_"+this._latestOriginId++),Wf.EXTENT}setTileParameters(e){const i=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[Ss.INNER],n=this.renderer.overlays[Ss.OUTER],s=e.extent;this._rectInsideRect(r.extent,s)||this._rectanglesOverlap(s,r.extent)||this._rectanglesOverlap(s,n.extent)?(this._setTileOverlayData(s,Ss.INNER,i),this._setTileOverlayData(s,Ss.OUTER,i)):(this._clearTileOverlayData(Ss.INNER,i),this._clearTileOverlayData(Ss.OUTER,i))}else this._clearTileOverlayData(Ss.INNER,i),this._clearTileOverlayData(Ss.OUTER,i)}overlayPixelSizeInMapUnits(e,i){if(this.renderer.overlays.length===0)return i();const r=this.renderer.overlays[Ss.INNER],n=this.renderer.overlays[Ss.OUTER],s=this._pointIsInExtent(e,r.extent)?r:n;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,i,r){if(this.renderer.overlays.length===0)return;const n=this.renderer.overlays[i].extent,s=Na(n),a=Jl(n);let u=e[0];if(this._longitudeCyclical){u=this._longitudeCyclical.minimalMonotonic(n[0],u);const p=this._longitudeCyclical.minimalMonotonic(n[0],e[2]);u>p&&(u=p-(e[2]-e[0]))}r.setScale(i,Na(e)/s,Jl(e)/a),r.setOffset(i,(u-n[0])/s,(e[1]-n[1])/a)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}async reloadShaders(){$Ae(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(ml)}_dispatchAnimationUpdate(e){const i=e-this._animationTimeLast;if(i>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=i/this.surface.view._stage.renderer.animationTimeDilation,n=new STe(this.view.state.camera,r,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(n)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,n){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Sgt,i,r);if(s==null)return!1;const a=s.origin,u=Ue(v9,s.origin,s.direction);return this._groundIntersector.reset(a,u,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,a,u),this._groundIntersector.results.min.getIntersectionPoint(n)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const n=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),a=this.view.pointsOfInterest.centerOnSurfaceFrequent,u=1e-5,p=Je(a.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+u,e.aboveGround?s-u:1/0),y=e.aboveGround;if(this.view.viewingMode==="global"){const b=v9;bE(p7(f7,Mr(this.view.spatialReference).radius+p),eh(e.eye,e.viewForward),b),Be(b,b,e.eye);const S=lv.normalize(K_e(e.viewForward,b,e.viewRight))/e.fovY+.5,C=S<=0||S>=1?.5:n;r=y?C*S:S+C*(1-S)}else{const b=.5*Math.PI-Math.acos(-e.viewForward[2]),S=Math.tan(b),C=vi(0,S,1,0),O=Nu(C,C,e.projectionMatrix)[1],P=Je(.5+.5*O,0,1);r=P===1||P===0?.5:y?P*n:1-(1-P)*n}return!!this._intersectGroundFromView(e,.5,r,i)&&LD(i,e.eye)<a.distance*a.distance}_computeOverlayExtents(e,i,r){const n=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=H();this._findHorizonBasedPointOfInterest(e,s)||Ie(s,n),Xr.OVERLAY_SHOW_CENTER?(P1==null&&(P1=new Dx(this.view.graphics,"red")),P1.show(s,this._renderSR)):P1?.hide();const a=Math.max(.1,un(e.eye,s)),u=xv(this.view.renderCoordsHelper,n,e.eye);this._overlaySREqualsRenderSR||va(s,this._renderSR,s,this._spatialReference);const p=this.surface.extent,y=!this._isSpherical&&this._spatialReference&&this._spatialReference.isGeographic,b=y&&this._spatialReference?1/Mr(this._spatialReference).metersPerDegree:1,S=this.view.state.contentPixelRatio,C=e.perScreenPixelRatio/S*a*b;r.mapUnitsPerPixel=C/this._worldToPCSRatio,r.stretch=this._overlayStretch;let O=i*C/2*r.stretch,P=!1,$=y?90:1/0;this._isSpherical&&p&&this._spatialReference&&(this._spatialReference.isWebMercator?(O/=Math.cos(Z6(s[1])),$=p[3]):(P=!0,O/=Mr(this._spatialReference).metersPerDegree,$=90),O>=$&&(O=$,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let N=1;P&&(N=1/Math.max(.2,Math.cos(Math.abs(gi(s[1])))),O*N>180&&(N=180/O),r.mapUnitsPerPixel*=N);const z=Math.log(2)/12;O=Math.exp(Math.round(Math.log(O)/z)*z);const U=O*N,j=32,G=.5*i/(j*U),q=.5*i/(j*O);s[0]=Math.round(s[0]*G)/G,s[1]=Math.round(s[1]*q)/q;const W=r.inner;W[0]=s[0]-U,W[1]=s[1]-O,W[2]=s[0]+U,W[3]=s[1]+O,this._isSpherical&&this._shiftExtentToFitBounds(W,1/0,$);const K=r.outer;if(6*U>Na(p))Sg(K,p);else if(Math.PI/2-Math.abs(u-Math.PI/2)<=.25*Math.PI)K[0]=W[0]-U,K[1]=W[1]-O,K[2]=W[2]+U,K[3]=W[3]+O;else{va(e.eye,this._renderSR,v9,this._spatialReference),i0(S_,s,v9);let ae=-Math.atan2(S_[1],S_[0])+.125*Math.PI;ae<0&&(ae+=2*Math.PI);const le=Math.floor(ae/(.25*Math.PI));B2(S_,_gt[le],2*O),S_[0]*=N,S_[2]*=N,YJ(K,W,S_)}if(this._isSpherical)K[0]=this._longitudeCyclical.clamp(K[0]),K[2]=this._longitudeCyclical.clamp(K[2]),K[1]=Math.max(K[1],-$),K[3]=Math.min(K[3],$);else{const ae=cB(W,p,xgt),le=cB(K,p,Tgt);Cie(ae,le)&&(K[2]=K[0],K[3]=K[1])}const se=Math.abs(W[2]-W[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,se),r.pixelRatioAdjustment=r.mapUnitsPerPixel/se}_drawOverlays(e,i){if(!this.renderer.hasOverlays)return;if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const r=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const n=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(i),n!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(ns.UPDATE),r?(this.surface.requestRender(e),e===ns.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(ns.BACKGROUND),this.renderer}_rectanglesOverlap(e,i){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(i[0],i[2],e[0])||this._longitudeCyclical.contains(i[0],i[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],i[0]))&&!(e[1]>i[3]||e[3]<i[1]):GD(e,i))}_rectInsideRect(e,i){return i!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],i[0])&&this._longitudeCyclical.contains(e[0],e[2],i[2])&&i[1]>e[1]&&i[3]<e[3]:Cie(e,i))}_pointIsInExtent(e,i){if(this._longitudeCyclical)return this._longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,n=e.y;return r>i[0]&&r<i[2]&&n>i[1]&&n<i[3]}_shiftExtentToFitBounds(e,i,r){let n=0,s=0;e[0]<-i?n=e[0]+i:e[2]>i&&(n=i-e[2]),e[1]<-r?s=e[1]+r:e[3]>r&&(s=r-e[3]),oL(e,n,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask(ml)}}};function bgt(t,e){const r=Xr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}_([T()],kl.prototype,"_spatialReference",void 0),_([T({readOnly:!0})],kl.prototype,"running",null),_([T()],kl.prototype,"_placementDirty",void 0),_([T()],kl.prototype,"_contentUpdated",void 0),_([T()],kl.prototype,"_isSpherical",null),_([T()],kl.prototype,"_worldToPCSRatio",null),_([T({autoDestroy:!0})],kl.prototype,"renderer",void 0),_([T({constructOnly:!0})],kl.prototype,"view",void 0),_([T({constructOnly:!0})],kl.prototype,"surface",void 0),_([T()],kl.prototype,"suspended",null),_([T()],kl.prototype,"updating",null),_([T({type:Boolean})],kl.prototype,"rendersOccluded",null),kl=_([Z("esri.views.3d.terrain.OverlayManager")],kl);let wgt=class{constructor(){this.inner=Di(),this.outer=Di(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=LAe}};const S_=ji(),v9=H(),ff=new wgt,xgt=Di(),Tgt=Di(),Sgt=oo();var Wf;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(Wf||(Wf={}));let Egt=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=cn(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}release(){this.vertexAttributes=Gi(this.vertexAttributes),this.indices=null}},Tue=class{constructor(e,i,r,n,s){this.attributes=e,this.localOrigin=i,this.index0=r,this.stride=n,this.count=s}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return tt(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,i){this.attributes.position.getVec(e,i)}getVertexPos(e,i){this._getVertexRaw(this.getAttributeIndex(i),e),Ue(e,e,this.localOrigin)}getNormal(e,i){const{typedBuffer:r,typedBufferStride:n}=this.attributes.normalCompressed;Plt(e,r,this.getAttributeIndex(i),n)}_setNormal(e,i,r,n){const{typedBuffer:s,typedBufferStride:a}=this.attributes.normalCompressed;aw(s,e,i,r,n,a)}_setUV(e,i,r){Rp(this.attributes.uv0,e,i,r)}setNormalFromValues(e,i,r,n){this._setNormal(this.getAttributeIndex(e),i,r,n)}setVertexFromValuesRawPositionUV(e,i,r,n,s,a){const u=this.getAttributeIndex(e);this.attributes.position.setValues(u,i,r,n),this._setUV(u,s,a)}setVertexFromValuesRawPositionUVNormal(e,i,r,n,s,a,u,p,y){const b=this.getAttributeIndex(e);this.attributes.position.setValues(b,i,r,n),this._setUV(b,s,a),this._setNormal(b,u,p,y)}};const Sue=16384;function Rp(t,e,i,r){t.setValues(e,i*Sue,r*Sue)}function Yh(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}let Cgt=class{constructor(){this.sinLonLUT=new Array(A5+1),this.cosLonLUT=new Array(A5+1),this.sinLatLUT=new Array(A5+1),this.cosLatLUT=new Array(A5+1)}update(e,i,r){const n=i[0],s=i[2];for(let a=0;a<=e;a++){const u=a/e,p=n*(1-u)+s*u;this.sinLonLUT[a]=Math.sin(p),this.cosLonLUT[a]=Math.cos(p);const y=r(u);this.sinLatLUT[a]=Math.sin(y),this.cosLatLUT[a]=Math.cos(y)}}},_9=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},Agt=class{constructor(){this.cornerNeighborData=[new _9,new _9,new _9,new _9],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},Ogt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new Agt}},DAe=class B${constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=ct(this._current),this._next=ct(this._next),this._waiting=ct(this._waiting),this._delayed=ct(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let e=B$.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,vg.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,n=this._next.type!==Hs.FADING,s=e-this._fadeStart>=i;(r||n||s)&&(ct(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=B$.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(e,i=vg.Immediate){this._delayed=ct(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const r=B$.test.fadeMoment||performance.now();return i!==vg.Immediate?(this._delayed=e,void(this._delayedTime=r+i)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(e!=null&&(ct(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}};var vg;DAe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(vg||(vg={}));var ZS;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(ZS||(ZS={}));let NAe=class{constructor(){this._queue=new xi,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e?.[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},Rgt=class{constructor(){this._q=new xi}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.isLeaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function v4(t,e,i){if(e?.fullExtent==null)return!1;const r=e.fullExtent,n=t.extent;if(i){if(n[0]<r.xmin||n[1]<r.ymin||n[2]>r.xmax||n[3]>r.ymax)return!1}else if(r.xmin>n[2]||r.ymin>n[3]||r.xmax<n[0]||r.ymax<n[1])return!1;const s=t.surface.tilingScheme.levels[t.level].scale,a=e.minScale;if(a>0&&s>1.00000001*a)return!1;const u=e.maxScale;return!(u>0&&s<.99999999*u)}function _g(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function FAe(t,e,i=null){i==null||i.length===0?t===ZS.BACK_TO_FRONT?e.sort(Mgt):e.sort(Pgt):e.sort((r,n)=>Igt(r,n,t,i))}function Mgt(t,e){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function Pgt(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function kAe(t,e,i){const r=t.screenDepth,n=e.screenDepth;return r<n?-i:r>n?i:_g(t,e)}function Igt(t,e,i,r){return Eue(t,r)===Eue(e,r)?kAe(t,e,i):t?i:-i}function Eue(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function $gt(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function Lgt(t,e){const i=t.length;for(let r=0;r<i;++r)t.at(r).updateDistanceToPOI(e);t.sort($gt)}function Dgt(t,e,i){let r=1,n=0,s=0;for(;t!==e;)if(r*=.5,n*=.5,s*=.5,1&t.lij[2]&&(n+=.5),!(1&t.lij[1])&&(s+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,n,s,r)}function Ngt(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let n=0;n<4;n++){const s=r.children[n];if(s&&s!==i)return!0}}return!1}function xUt(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,n=i?e:t,s=1<<n[0]-r[0];return Math.floor(n[1]/s)===r[1]&&Math.floor(n[2]/s)===r[2]}let pee=class{get updating(){return!!this._tileRequested}init(e,i,r,n){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=n,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const s=this._findAncestorWithData();this._setUpsampleTile(s)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,i){this._setUpsampleTile(e,i),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,Hs.FADING,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),n=Vq(r),{minLevel:s,maxLevel:a}=r.dataLevelRange,u=this._desiredMinLevelDelta,p=this._progressiveLevelModulo+u,y=this._scaleRangeEnabled?v4:()=>!0;let b=this.tile;const S=b.level;let C;const O=this._tileLayerInfo.upsampleInfo,P=O!=null?O.tile.level:-1,$=O!=null&&P-S>=u,N=n?.tilemapCache,z=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;b&&y(b,n,!1)&&b.level>=s;){const U=b.level,j=S-U,G=b.layerInfo[i][e];if(G.data&&j>=u){(!$||U>P)&&this._setUpsampleTile(b),G.dataInvalidated&&(C=b);break}const q=z?.getLevelRowColumn(b.lij)??b.lij;if(N?.getAvailability(q[0],q[1],b.lij[2])!=="unavailable"&&U<=a&&!G.data&&!G.dataMissing&&((!C||b.level===s||U%V2e==0||S-C.level<u)&&(C=b),j>=p))break;b=b.parent}if(C!=null&&S-C.level<u)if(O)C=null;else{const U=this._findAncestorWithData();U!=null&&(this._setUpsampleTile(U),C=U.layerInfo[i][e].dataInvalidated?U:null)}return C}_findAncestorWithData(){const e=this.tile.elevationLevel,i=this._desiredMinLevelDelta;let r;for(let n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(e-n.level>=i)return n;r=n}return r}_setUpsampleTile(e,i){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,Hs.FADING,i)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},Fgt=class extends pee{get _desiredMinLevelDelta(){throw Cue}get _progressiveLevelModulo(){throw Cue}dispose(){}};const Cue=new Error("Abstract method called on TileAgent"),uc=new Fgt;let zAe=class extends pee{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return PG(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},UAe=class extends pee{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return V2e}};var M2,cw;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(M2||(M2={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(cw||(cw={}));function kgt(t){t.fragment.uniforms.add(new kt("u_colormap",e=>e.u_colormap),new lt("u_colormapOffset",e=>e.colormap.u_colormapOffset),new lt("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new lt("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(F`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function zgt(t){t.fragment.uniforms.add(new kt("u_transformGrid",e=>e.u_transformGrid),new Lr("u_transformSpacing",e=>e.common.u_transformSpacing),new Lr("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(F`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let jAe=class extends Vr{constructor(){super(...arguments),this.scale=1,this.offset=Cg}};function BAe(t){t.attributes.add(X.POSITION,"vec2"),t.attributes.add(X.UV0,"vec2"),t.vertex.uniforms.add(new lt("scale",e=>e.scale)),t.vertex.uniforms.add(new Lr("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(F`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let Ugt=class extends jAe{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function jgt(t,e){t.include(zgt),t.fragment.uniforms.add(new kt("u_image",r=>r.u_image),new y0("u_flipY",r=>r.common.u_flipY),new y0("u_applyTransform",r=>r.common.u_applyTransform));const{requireBilinearWithNN:i}=e;i&&t.fragment.uniforms.add(new Lr("u_srcImageSize",r=>r.common.u_srcImageSize)),t.fragment.code.add(F`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),i?t.fragment.code.add(F`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(F`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var ut;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(ut||(ut={}));const Xq={normal:ut.Normal,average:ut.Average,lighten:ut.Lighten,lighter:ut.Lighter,screen:ut.Screen,plus:ut.Plus,"color-dodge":ut.ColorDodge,darken:ut.Darken,multiply:ut.Multiply,"color-burn":ut.ColorBurn,overlay:ut.Overlay,"soft-light":ut.SoftLight,"hard-light":ut.HardLight,"vivid-light":ut.VividLight,hue:ut.Hue,saturation:ut.Saturation,luminosity:ut.Luminosity,color:ut.Color,difference:ut.Difference,exclusion:ut.Exclusion,minus:ut.Minus,invert:ut.Invert,reflect:ut.Reflect,"destination-over":ut.DestinationOver,"destination-atop":ut.DestinationAtop,"destination-in":ut.DestinationIn,"destination-out":ut.DestinationOut,"source-atop":ut.SourceAtop,"source-in":ut.SourceIn,"source-out":ut.SourceOut,xor:ut.Xor};function Bgt(t){return t===ut.DestinationOver||t===ut.DestinationAtop||t===ut.DestinationIn||t===ut.DestinationOut||t===ut.SourceAtop||t===ut.SourceIn||t===ut.SourceOut||t===ut.Xor}function fee(t){t.code.add(F`
    float lineFactorAtPosition(float value) {
      float pos = value * ${F.float(257)};
      if(pos < 0.5 || pos > ${F.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function Vgt(t,e){const i=e.blendMode;i!==ut.Normal&&(i===ut.Reflect&&t.code.add(F`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==ut.ColorDodge&&i!==ut.VividLight||t.code.add(F`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==ut.ColorBurn&&i!==ut.VividLight||t.code.add(F`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===ut.Overlay&&t.code.add(F`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===ut.HardLight&&t.code.add(F`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===ut.SoftLight&&t.code.add(F`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===ut.VividLight&&t.code.add(F`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==ut.Hue&&i!==ut.Saturation&&i!==ut.Color&&i!==ut.Luminosity||(t.code.add(F`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==ut.Hue&&i!==ut.Saturation||t.code.add(F`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(F`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===ut.Multiply?F`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.Average?F`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.Lighten?F`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.Darken?F`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.Lighter?F`return vec4(cl * ol + cb * ob, ol + ob);`:i===ut.Plus?F`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===ut.Minus?F`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===ut.Screen?F`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.Difference?F`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.Invert?F`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===ut.DestinationOver?F`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===ut.DestinationAtop?F`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===ut.DestinationOut?F`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===ut.SourceAtop?F`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===ut.SourceOut?F`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===ut.Xor?F`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===ut.DestinationIn?F`return vec4(cb * ob * ol, ol * ob);`:i===ut.SourceIn?F`return vec4(cl * ol * ob, ol * ob);`:i===ut.Hue?F`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.Saturation?F`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.Color?F`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.Luminosity?F`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.Exclusion?F`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.Reflect?F`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.ColorDodge?F`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.ColorBurn?F`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.Overlay?F`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.SoftLight?F`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.HardLight?F`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===ut.VividLight?F`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:F``}
    }
  `))}var Rs,ku,ap;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(Rs||(Rs={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(ku||(ku={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(ap||(ap={}));function VAe(t,e){const i=e.output===Rs.GridComposite,r=e.output===Rs.ColorComposite,n=e.output===Rs.GroupBackgroundComposite,s=e.output===Rs.Composite;i&&t.fragment.include(fee),r&&t.fragment.uniforms.add(new _i("backgroundColor",y=>y.backgroundColor));const a=e.baseOpacityMode===ku.Required;a&&t.fragment.uniforms.add(new lt("baseOpacity",y=>y.baseOpacity)),s&&t.fragment.uniforms.add(new kt("fboColor",y=>y.fboTexture));const u=e.blendMode!==ut.Normal,p=e.premultipliedSource===ap.On;t.fragment.include(Vgt,e),t.fragment.code.add(F`
    vec4 getBackground(vec2 uv) {
      return ${a?F`baseOpacity *`:""} ${n?F`vec4(0.0, 0.0, 0.0, 0.0)`:r?F`vec4(backgroundColor, 1.0)`:i?F`vec4(gridColor(uv), 1.0)`:F`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${u?F`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:F`
          float composeAlpha = colorLayer.a * opacity;
          return ${!p&&(s&&!a||n)?F`colorLayer * opacity;`:F`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let AN=class extends Ugt{constructor(e,i,r,n,s,a){super(e,n,s),this.colormap=i,this.symbolizer=r,this.u_colormap=a,this.backgroundColor=Mo,this.fboTexture=null,this.baseOpacity=1}},Ggt=class extends AN{},Hgt=class extends AN{};function qgt(t){const e=new lr;return e.include(BAe),e.include(jgt,t),e.include(kgt,t),e.include(VAe,t),e.fragment.code.add(F`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===M2.Stretch?Xgt(e,t):t.colorizerType===M2.Lut?Wgt(e):t.colorizerType===M2.Hillshade&&Jgt(e,t),e}function Wgt(t){t.fragment.code.add(F`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function Xgt(t,e){t.fragment.uniforms.add(new ER("u_bandCount",r=>r.symbolizer.u_bandCount),new Wl("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new Wl("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new Wl("u_factor",r=>r.symbolizer.u_factor,3),new lt("u_minOutput",r=>r.symbolizer.u_minOutput),new lt("u_maxOutput",r=>r.symbolizer.u_maxOutput),new y0("u_useGamma",r=>r.symbolizer.u_useGamma),new Wl("u_gamma",r=>r.symbolizer.u_gamma,3),new Wl("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new lt("u_opacity",r=>r.common.u_opacity)),t.fragment.code.add(F`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?F`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:F`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(F`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===cw.Noop?F`
        fragColor = applyBackgroundBlend(currentPixel);`:F`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function Jgt(t,e){const i=t.fragment;i.uniforms.add(new kt("u_image",n=>n.u_image),new ER("u_hillshadeType",n=>n.symbolizer.u_hillshadeType),new Wl("u_sinZcosAs",n=>n.symbolizer.u_sinZcosAs,6),new Wl("u_sinZsinAs",n=>n.symbolizer.u_sinZsinAs,6),new Wl("u_cosZs",n=>n.symbolizer.u_cosZs,6),new Wl("u_weights",n=>n.symbolizer.u_weights,6),new Lr("u_factor",n=>n.symbolizer.u_factor),new lt("u_minValue",n=>n.symbolizer.u_minValue),new lt("u_maxValue",n=>n.symbolizer.u_maxValue),new Lr("u_srcImageSize",n=>n.common.u_srcImageSize)),i.include(G0),i.code.add(F`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(F`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?F`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:F`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(F`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const Ygt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:Hgt,ColorizerStretchUniforms:Ggt,ColorizerUniforms:AN,build:qgt},Symbol.toStringTag,{value:"Module"}));function Zgt(t,e,i="nearest",r=!1){const n=!(r&&e.pixelType==="u8"),s=n?Qs.FLOAT:Qs.UNSIGNED_BYTE,a=e.pixels==null||e.pixels.length===0?null:n?e.getAsRGBAFloat():e.getAsRGBA(),u=t.capabilities.textureFloat?.textureFloatLinear,p=new Ar;return p.width=e.width,p.height=e.height,p.internalFormat=t.type===Ji.WEBGL2&&n?Mt.RGBA32F:ei.RGBA,p.samplingMode=!u||i!=="bilinear"&&i!=="cubic"?Si.NEAREST:Si.LINEAR,p.dataType=s,p.wrapMode=Ai.CLAMP_TO_EDGE,new yi(t,p,a)}function Kgt(t,e){const{spacing:i,offsets:r,coefficients:n,size:[s,a]}=e,u=i[0]>1,p=new Ar;p.width=u?4*s:s,p.height=a,p.internalFormat=t.type===Ji.WEBGL2?Mt.RGBA32F:ei.RGBA,p.dataType=Qs.FLOAT,p.samplingMode=Si.NEAREST,p.wrapMode=Ai.CLAMP_TO_EDGE;const y=new Float32Array(u?s*a*16:2*r.length);if(u&&n!=null)for(let b=0,S=0;b<n.length;b++)y[S++]=n[b],b%3==2&&(y[S++]=1);else for(let b=0;b<a;b++)for(let S=0;S<s;S++){const C=4*(b*s+S),O=2*(S*a+b);y[C]=r[O],y[C+1]=r[O+1],y[C+3]=r[O]===-1?0:1}return new yi(t,p,y)}function Aue(t,e){const i=new Ar;return i.internalFormat=ei.RGBA,i.width=e.length/4,i.height=1,i.samplingMode=Si.NEAREST,i.wrapMode=Ai.CLAMP_TO_EDGE,new yi(t,i,e)}function Qgt(t,e,i,r=1,n=!0){return{u_flipY:n,u_applyTransform:!!t,u_opacity:r,u_transformSpacing:t?t.spacing:Cg,u_transformGridSize:t?t.size:Cg,u_targetImageSize:e,u_srcImageSize:i}}function e1t(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function t1t(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function i1t(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const Oue={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let r1t=class{constructor(e,i,r=null,n=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=i,this.width=r||i.width,this.height=n||i.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=jt(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...Oue,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||Oue}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((i,r)=>!!this._bandIds?.[r]&&i===this._bandIds[r])||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const i=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(i==="bilinear"?Si.LINEAR:Si.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=jt(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=Kgt(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:i,width:r,height:n,opacity:s}=this,a=Qgt(i,[r,n],[this.source.width,this.source.height],s),u=e1t(e.colormap,e.colormapOffset),p=this.symbolizerParameters.type==="stretch"?t1t(this.symbolizerParameters):null,y=this.symbolizerParameters.type==="hillshade"?i1t(this.symbolizerParameters):null;return new AN(a,u,p||y,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(i=>i!=null?i.descriptor.width*i.descriptor.height*4:0).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=jt(this._rasterTexture),this._transformGridTexture=jt(this._transformGridTexture),this._colormapTexture=jt(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=jt(this._rasterTexture));const n=i==null&&this.bandIds==null||i!=null&&this.bandIds!=null&&i.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&n)return;this._rasterTexture=jt(this._rasterTexture);const s=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Zgt(e,r,s,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((n,s)=>n!==i[s])?(this._colormapTexture=jt(this._colormapTexture),this._colormapTexture=Aue(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=Aue(e,r),void(this._colormap=r)):(this._colormapTexture=jt(this._colormapTexture),void(this._colormap=null))}},V$=class{constructor(){this.waitingAgents=new xi,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const i=tU.acquire();return i._init(e),i}release(){this.dispose(),G$.delete(this),tU.release(this)}dispose(){this.loadingAgent=jt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=JT(this._data)}static prune(){tU.prune(0)}_init(e){this.waitingAgents.clear(),this._data=JT(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Vc(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,i){if(e!==i&&i!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),Dgt(e,i,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){JT(this._data),this._data=e}};const tU=new Ua(V$,null,()=>{}),G$=new Map;function n1t(){G$.size>0&&(console.log(`${G$.size} live TilePerLayerInfo allocations:`),G$.forEach(t=>console.log(t,`
`)))}let tA=class{constructor(e,i){this._texture=e,this._cache=i,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,this._refCount===0)if(this._cache){const e=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(e,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.gpuMemoryUsage}};var ri;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.RENDERDATA=8]="RENDERDATA",t[t.GEOMETRY=16]="GEOMETRY",t[t.TEXTURE_NOFADING=32]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=64]="TEXTURE_FADING"})(ri||(ri={}));const s1t=.1;let mee=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Di(),this._elevationBounds=Ct(),this.layerInfo=[[],[]],this.extentInRadians=Di(),this.centerAtSeaLevel=H(),this._center=[H(),as(),H()],this.up=WJ(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=H()}static prune(){gee.prune(0),yee.prune(0),V$.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Ts.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,i=e?.frustumVisibility??Pa.INTERSECTS;this._frustumVisibility=i===Pa.INSIDE?Pa.INSIDE:i===Pa.OUTSIDE?Pa.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==Pa.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){return this.isLeaf}init(e,i,r,n,s){this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,this.ellipsoid=Mr(s.tilingScheme.spatialReference),s.tilingScheme.getExtent(e,i,r,this.extent),s.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,s.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Ts.MIDDLE][3]=0,this.elevationLevel=e,n&&n.elevationBounds?$s(this._elevationBounds,n.elevationBounds):Yi(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=n,this.unsetChildren(),this._surface=s,this.updateVisibility();for(const a of gb){const u=s.numLayers(a),p=this.layerInfo[a];for(const y of p)y.release();p.length=u;for(let y=0;y<u;y++)p[y]=V$.acquire(this._surface.upsampleInfoPool),a===$i.ELEVATION&&this.findElevationBoundsForLayer(y,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(s.tilingScheme.pixelSize,A5)}dispose(){Qf(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of gb){for(const i of this.layerInfo[e])i.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[$i.MAP].reduce((e,i)=>e+(i instanceof eU?i.memoryUsed/i.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=this._baseUsedMemory,this._mapTileMemoryInternal=0;let e=0;for(const{data:r}of this.layerInfo[$i.MAP])r instanceof eU?e+=this._getTerrainDataMemory(r):this._mapTileMemoryInternal+=this._getTerrainDataMemory(r);const i=this._cpuImageMemorySize;for(const r of this.layerInfo[$i.ELEVATION])this._usedMemory+=r.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=this.renderData.texture?.usedMemory??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r?.data?e===$i.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):e===$i.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof tA?e.texture.gpuMemoryUsage:e instanceof HTMLImageElement||e instanceof cee?this._cpuImageMemorySize:e instanceof r1t?e.memoryUsage:e instanceof eU?e.memoryUsed/e.referenced:0}updateScreenDepth(e){const i=this._center[Ts.MIDDLE],r=e,n=i[0],s=i[1],a=i[2],u=r[2]*n+r[6]*s+r[10]*a+r[14];this.screenDepth=u<0?0:u/(r[3]*n+r[7]*s+r[11]*a+r[15])}shouldSplit(e,i,r){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===Pa.OUTSIDE))return ri.NONE;const n=this.level;Be(w9,this._center[Ts.MIDDLE],i);let s=ha(w9),a=w9,u=Ts.MIDDLE;Be(iU,this._center[Ts.TOP],i);const p=ha(iU);p<s&&(s=p,a=iU,u=Ts.TOP),Be(rU,this._center[Ts.BOTTOM],i);const y=ha(rU);if(y<s&&(s=y,a=rU,u=Ts.BOTTOM),this._edgeLen2>s&&n<e.maxLod)return ri.SPLIT;const b=r!=null?r-n:1/0,S=Math.sqrt(s),C=e.fovX*S*2,O=this._edgeLen/C,P=()=>{if(n<e.maxLod)return this.elevationLevel=n,ri.NONE;const K=n+Math.ceil(-Math.log2(e.relativeWidthLimit/O));return K!==this.elevationLevel?(this.elevationLevel=K,ri.ELEVATION):ri.NONE};if(b<=.5)return P();const $=He(this.up,w9),N=this._elevationBounds[1]-this._elevationBounds[0],z=N/this.edgeLen;if(e.aboveGround&&$>0&&z<.001&&$/S-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-z>0)return ri.NONE;const U=r!=null?3-Math.min(b,2):1;if(O*U<e.relativeWidthLimit||n>=e.maxLod)return P();if(n<7)return ri.SPLIT;Pe(Lo,this.up,$),Be(Lo,Lo,a);const j=ha(Lo);if(j<=this.radius*this.radius)return ri.SPLIT;Pe(Lo,Lo,this.radius/Math.sqrt(j)),Ue(Lo,Lo,this._center[u]),Be(Lo,i,Lo);const G=Math.min(1,(Math.abs(He(Lo,this.up))+.5*N+this._curvatureHeight)/Qe(Lo)),q=s1t/e.angledSplitBias,W=e.fovY*S*2;return G*(this._edgeLen/W*U)<q*e.relativeHeightLimit?ri.NONE:ri.SPLIT}setChildren(e,i,r,n){Qf(!!(e&&i&&r&&n),"Null child passed"),this._children[0]=e,this._children[1]=i,this._children[2]=r,this._children[3]=n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const e of gb)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const i of gb){const r=this.layerInfo[i];for(const n of r)n.loadingAgent&&n.loadingAgent!==uc&&(b9(n.loadingAgent),n.loadingAgent=null),n.pendingUpdates=0}this.resetPendingUpdate(ri.GEOMETRY),this.resetPendingUpdate(ri.TEXTURE_NOFADING),this.resetPendingUpdate(ri.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[$i.MAP];for(const i of e)i.loadingAgent&&i.loadingAgent!==uc&&(b9(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(f2(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const n=r&&this._isWithinClippingArea,s=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||n||s||this.setPendingUpdate(ri.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!r?.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of gb){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==uc&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(ri.SPLIT)||e!==$i.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===ri.SPLIT||e===ri.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const n=this.layerInfo[i][e];if(n.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,e),!0;if(n.waitingAgents.push(r),n.data&&!n.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,e);const u=n.data&&"type"in n.data&&n.data.type==="vector-tile";return r.dataArrived(this,u),!0}if(n.requestPromise)return!0;Vc(n.requestAbort),n.requestAbort=new AbortController;const s=this._surface.requestTileData(this,e,i,n.requestAbort);if(!s)return n.requestAbort=null,!1;const a=()=>{n.requestPromise===s&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=s,s.then(a,a),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return ha(Be(Lo,this._center[Ts.MIDDLE],e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const n=this.layerInfo[i][e],s=n.waitingAgents,a=s.removeUnordered(r)!=null;Qf(a,"agent has not requested this piece of map data"),s.length<1&&(n.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const n=r!=null&&"type"in r&&r.type==="vector-tile",s=this.layerInfo[i][e];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(a=>a.dataArrived(this,n)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${e} error ${r}`);const n=this.layerInfo[i][e];n.dataMissing=!0,n.waitingAgents.forAll(s=>s.dataMissing()),n.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i,r){switch(r&&this.forEachLoadedNeighbor(n=>n.updateRenderData(e,i)),e){case $i.MAP:return this._updateTexture(i);case $i.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===Hs.FADING?ri.TEXTURE_NOFADING:ri.TEXTURE_FADING),this.setPendingUpdate(e===Hs.FADING?ri.TEXTURE_FADING:ri.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(ri.GEOMETRY);for(const e of this.layerInfo[$i.ELEVATION])e.pendingUpdates|=ri.GEOMETRY}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBounds,i=e[0],r=e[1];Yi(e,1/0,-1/0);const n=this.layerInfo[$i.ELEVATION];let s=!0;for(const a of n)a.elevationBounds!=null&&(e[0]=Math.min(e[0],a.elevationBounds.min),e[1]=Math.max(e[1],a.elevationBounds.max),a.elevationBounds.hasNoDataValues||(s=!1));s&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),i===e[0]&&r===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,i=.5*(e[0]+e[1]),r=this._center;Pe(Lo,this.up,i),Ue(r[Ts.MIDDLE],this.centerAtSeaLevel,Lo),Pe(Lo,this.up,e[0]),Ue(r[Ts.TOP],this.centerAtSeaLevel,Lo),Pe(Lo,this.up,e[1]),Ue(r[Ts.BOTTOM],this.centerAtSeaLevel,Lo)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[$i.ELEVATION][e],n=PG(this.level),s=Math.max(this.elevationLevel-n,0),a=r.elevationBounds;if(a!=null&&a.level>=i&&a.level<=s)return;const u=this._surface.layerViewByIndex(e,$i.ELEVATION),p=Vq(u);if(!v4(this,p,!1))return;const y=a1t;let b=!1;const S=r.data;if(S&&S.level<=s){const C=r.data;y.min=C.samplerData.data.minValue,y.max=C.samplerData.data.maxValue,y.hasNoDataValues=C.samplerData.data.hasNoDataValues,y.level=this.level,b=!0}else{let C,O,P=0;for(let $=this._parent;$&&(!O||P<n)&&(P=this.elevationLevel-$.level,C=O||C,O=$.layerInfo[$i.ELEVATION][e].data,!(!O&&C&&$.level<=s));$=$.parent);O=O||C,O&&(O.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],y),y.min!==1/0&&(y.level=O.level,b=!0))}b&&(r.elevationBounds==null&&(r.elevationBounds=new ET),r.elevationBounds.copyFrom(y))}modifyLayers(e,i,r){const n=this.layerInfo[r];for(const u of n)u.loadingAgent&&u.loadingAgent!==uc&&(b9(u.loadingAgent),u.loadingAgent=null),u.waitingAgents.clear();for(let u=0;u<n.length;++u)e[u]===void 0&&n[u].release();const s=new Array(...n),a=i.length;n.length=a;for(let u=0;u<a;u++){const p=i[u];n[u]=p>-1?s[p]:V$.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,Hs.FADING))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===uc&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of gb){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==uc&&(r.loadingAgent.setSuspension(i),r.loadingAgent===uc&&this.updateRenderData(e,Hs.FADING))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==uc&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=uc,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||cS(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){for(let n=e;n<i;++n){const s=this._surface.layerViewByIndex(n,r);if(xO(s)&&s?.layer?.blendMode!=="normal"||cS(s?.layer?.parent)&&this._hasBlendableAncestor(s?.layer?.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const n=this._isSuspended(i);for(let s=e;s<r.length;++s){const a=r[s];let u=!1;const p=this._surface.layerViewByIndex(s,i),y=Vq(p);if(a.loadingAgent?v4(this,y,!1)?(a.loadingAgent!==uc&&a.loadingAgent.setSuspension(n),a.loadingAgent!==uc&&(u=a.loadingAgent.update())):a.dispose():v4(this,y,!1)&&(a.loadingAgent=o1t(this,s,i,n),u=a.loadingAgent.startLoading(),u?a.loadingAgent===uc&&this.setPendingUpdate(ri.GEOMETRY):(b9(a.loadingAgent),a.loadingAgent=uc)),a.loadingAgent===uc&&this.updateRenderData(i,Hs.FADING),!this._hasBlendModes(e,r.length,i)&&u&&p.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.elevationLevel-this.level,r=Math.max(this.level-e,PG(this.level)-i),n=Je(1+(this.maxTesselation>>r),2,this.maxTesselation+1),s=this.getDefaultVerticesPerSide();return Math.max(n,s)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(r!=null){for(const n of r)if(l1t(n,e)){let s=n,a=e[0]-s.level-1;for(;a>=0&&!s.isLeaf&&!i(s);){const u=e[1]>>a&1,p=e[2]>>a&1;s=s.children[2*u+p],a--}return i(s)?s:null}}return null}findNeighborTile(e,i){const r=this.lij,n=this.getNeighborLIJ(r,e);return n?c1t(r,n)?i(this)?this:null:this._findLIJ(n,i):null}findCorner(e,i){const r=e===Ht.NORTH_EAST?1:e===Ht.NORTH_WEST?0:e===Ht.SOUTH_WEST?2:3;let n=this;for(;n.children[0]&&(!i||!i(n));)n=n.children[r];return n}findNeighborCornerTileExact(e,i){return this.findNeighborTile(e,r=>i(r)||r.level===this.level)?.findCorner(L8(e),i)||null}forAllSubtreeOnSide(e,i){const r=e===Ht.NORTH?[0,1]:e===Ht.NORTH_EAST?[1]:e===Ht.EAST?[1,3]:e===Ht.SOUTH_EAST?[3]:e===Ht.SOUTH?[2,3]:e===Ht.SOUTH_WEST?[2]:e===Ht.WEST?[0,2]:[0],n=s=>{const a=s.children;!i(s)&&a[0]&&r.forEach(u=>n(a[u]))};n(this)}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(tt(!Ks||r>=0),r===0)return 0;const n=2**r,s=(1&e)==1,a=s?0:1,u=i.lij[a+1]*n,p=this.lij[a+1],y=p-u,b=s?n-1-y:y;return Ks&&(tt(u<=p&&p<u+n),tt(0<=b&&b<n)),b}forEachLoadedNeighbor(e){const i=this.level,r=n=>n.level===i||n.isLoaded;ag.forEach(n=>{const s=this.findNeighborTile(n,r);s!=null&&s!==this&&s.forAllSubtreeOnSide(dee(n),a=>!!a.isLoaded&&(e(a,n),!0))}),D8.forEach(n=>{const s=this.findNeighborTile(n,r)?.findCorner(L8(n),a=>a.isLoaded);tt(!s||Jq(this,s,n)),s?.isLoaded&&e(s,n)})}getNeighborLIJ(e,i){const r=mue(i)?-1:fue(i)?1:0,n=due(i)?-1:pue(i)?1:0,s=[e[0],e[1]+r,e[2]+n];return s[1]<0?null:this.surface.isGlobal?this.wrapLIJ(s):s[2]<0?null:s}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){const e=this.surface.extent,i=e?.[1]??null;return i!=null&&this.extent[1]+Ko()>=i}checkGeometryWaterproofness(){I8&&(tt(this.isLoaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,n=.25*(i[2]-i[0]);if(mue(e)&&i[3]+n>=r[3]||fue(e)&&i[1]-n<=r[1])return!1;const s=this.surface.isGlobal;return!(!s&&due(e)&&i[0]-n<=r[0])&&!(!s&&pue(e)&&i[2]+n>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;Ie(this._lastPOI,e);const r=this._center[Ts.MIDDLE],n=e[0]-r[0],s=e[1]-r[1],a=e[2]-r[2];this.distanceToPOI=n*n+s*s+a*a}};function o1t(t,e,i,r){const n=i===$i.ELEVATION?yee.acquire():gee.acquire();return n.init(t,e,i,r),n}function b9(t){t.dispose(),t instanceof zAe?yee.release(t):t instanceof UAe&&gee.release(t)}const gee=new Ua(UAe),yee=new Ua(zAe),a1t=new ET;var Ts;function l1t(t,e){const i=t.level,r=e[0];if(i>r)return!1;const n=r-i,s=Math.floor(e[1]/2**n),a=Math.floor(e[2]/2**n);return s===t.lij[1]&&a===t.lij[2]}function c1t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function u1t(t,e,i){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&i===Ht.EAST||t.isWestEnd&&e.isEastEnd&&i===Ht.WEST))return!0;const r=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(i){case Ht.NORTH:return Uh(t.extent[3],e.extent[1],r);case Ht.SOUTH:return Uh(t.extent[1],e.extent[3],r);case Ht.EAST:return Uh(t.extent[2],e.extent[0],r)||Uh(t.extent[2],-e.extent[0],r);case Ht.WEST:return Uh(t.extent[0],e.extent[2],r)||Uh(t.extent[0],-e.extent[2],r)}}function Jq(t,e,i){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?Rue(t,e,i):Rue(e,t,L8(i)))}function Rue(t,e,i){tt(t.level>=e.level);const r=Amt(i),n=Omt(i),s=t.extent,a=e.extent,u=[r?s[0]:s[2],n?s[3]:s[1]],p=[r?a[2]:a[0],n?a[1]:a[3]],y=1e-5*(s[2]-s[0]),b=Uh(u[0],p[0],y)||t.surface.isGlobal&&Uh(u[0],-p[0],y),S=Uh(u[1],p[1],y);if(b&&S)return!0;if(t.level===e.level||!b&&!S)return tt(!1),!1;const C=b?Mue(a[1],a[3],s[1],s[3],y):Mue(a[0],a[2],s[0],s[2],y);return tt(C),C}function Mue(t,e,i,r,n){return t-n<=i&&i<=r&&r<=e+n}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(Ts||(Ts={}));const w9=H(),iU=H(),rU=H(),Lo=H();let h1t=class{constructor(){this._scales=vi(-1,-1,-1,-1),this._offsets=vi(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};function d1t(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(F`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(F`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(F`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}var h0;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(h0||(h0={}));let p1t=class extends hQ{constructor(){super(...arguments),this.overlayOpacity=1}};function f1t(t,e){const{vertex:i,fragment:r,varyings:n}=t;n.add("vtc","vec2"),i.uniforms.add(new Pue("texOffsetAndScale")),r.uniforms.add(new Iue("tex")),r.uniforms.add(new nU("textureOpacities"));const s=e.textureFadingEnabled&&!e.renderOccluded;s&&(i.uniforms.add(new Pue("nextTexOffsetAndScale")),n.add("nvtc","vec2"),r.uniforms.add(new Iue("texNext")),r.uniforms.add(new nU("nextTexOpacities")),r.uniforms.add(new m1t("fadeFactor")));const a=e.tileBlendInput===h0.ColorComposite,u=e.tileBlendInput===h0.GridComposite;u&&r.include(fee),a&&r.uniforms.add(new nU("backgroundColor")),i.code.add(F`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${s?F`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:F``}
  }`),r.code.add(F`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${u||a?F`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${a?F`backgroundColor`:F`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:F`return color;`}
    }`),s?r.code.add(F`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(F`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let m1t=class extends zn{constructor(e){super(e,"float")}},nU=class extends zn{constructor(e){super(e,"vec3")}},Pue=class extends zn{constructor(e){super(e,"vec4")}},Iue=class extends zn{constructor(e){super(e,"sampler2D")}},GAe=class extends p1t{};function g1t(t){const e=new lr,{vertex:i,fragment:r,varyings:n}=e;e.include(pR),e.include(SR,t),e.include(g0,t);const s=()=>{e.include(vO,t),i.code.add(F`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};Uc(i,t),e.include(Zl,t);const a=t.overlayMode!==u0.Disabled,u=a&&t.invisible;switch(t.output){case oe.Color:{e.include(f1t,t),e.include(rw,t),a&&e.include(yC,{...t,pbrMode:t.pbrMode===Gt.Terrain?Gt.TerrainWithWater:Gt.Water});const p=t.overlayMode===u0.EnabledWithWater;p&&e.include(d1t,t),n.add("vnormal","vec3"),n.add("vpos","vec3"),n.add("vup","vec3"),s(),t.screenSizePerspective&&kS(i);const y=t.receiveShadows&&!t.renderOccluded;y&&e.include(EE,t),t.screenSizePerspective&&(n.add("screenSizeDistanceToCamera","float"),n.add("screenSizeCosAngle","float")),i.code.add(F`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${p?F`forwardVertexTangent(vnormal);`:F``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${a?F`setOverlayVTC(uv);`:""}
          ${t.tileBorders?F`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?F`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${y?F`forwardLinearDepth();`:""}

        }
      `),e.include(ss,t),e.include(rw,t),e.include(CR,t),e.include(nw,t),kp(r,t),AR(r),PE(r),r.uniforms.add(i.uniforms.get("localOrigin"),new _i("viewDirection",(b,S)=>We($ue,$e($ue,S.camera.viewMatrix[12],S.camera.viewMatrix[13],S.camera.viewMatrix[14])))),p&&r.uniforms.add(new kt("ovWaterTex",(b,S)=>S.overlay?.getTexture(bn.WaterNormal)),new w3e("view",(b,S)=>ec(y1t,S.camera.viewMatrix,b.origin))),r.code.add(F`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),jg(r),U0(r),r.code.add(F`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${a?F`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?F`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===Gt.Terrain||t.pbrMode===Gt.TerrainWithWater?F`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:F`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${p?F`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?F`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?F`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:F`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?F`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case oe.Depth:u&&e.include(yC,t),e.include($g,t),_v(e),ew(e),i.code.add(F`
              void main(void) {
                ${u?F`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),r.code.add(F`
              void main() {
                ${u?F`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case oe.Shadow:case oe.ShadowHighlight:case oe.ShadowExcludeHighlight:e.include($g,t),_v(e),ew(e),i.code.add(F`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(F`void main() {
outputDepth(linearDepth);
}`);break;case oe.Normal:u&&e.include(yC,t),n.add("vnormal","vec3"),kS(i),s(),i.code.add(F`
            void main(void) {
              ${u?F`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),r.code.add(F`
            void main() {
              ${u?F`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case oe.Highlight:a&&e.include(yC,t),i.code.add(F`
          void main() {
            ${a?F`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(Bv,t),r.code.add(F`
          void main() {
            ${a?F`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===oe.ObjectAndLayerIdColor&&(a?(e.include(yC,{...t,pbrMode:Gt.Disabled}),i.code.add(F`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),r.code.add(F`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(i.code.add(F`void main(void) {}`),r.code.add(F`void main() {
fragColor = vec4(0.0);
}`))),e}const y1t=Ze(),$ue=H(),v1t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:GAe,build:g1t},Symbol.toStringTag,{value:"Module"}));let HAe=class qAe extends wr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,i){i.spherical=e.viewingMode===ht.Global}initializeProgram(e){return new fr(e.rctx,qAe.shader.get().build(this.configuration),WAe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return mi({blending:i.renderOccluded?Xc(et.ONE,et.ONE_MINUS_SRC_ALPHA):null,culling:r?YZ:null,depthTest:i.renderOccluded?null:{func:Tr.LESS},depthWrite:i.renderOccluded?null:ic,colorWrite:Oi,stencilTest:e?Grt(Kl.IntegratedMeshMaskExcluded):null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};HAe.shader=new pr(v1t,()=>ke(()=>import("./Terrain.glsl-e581578b.js"),[],import.meta.url));const WAe=new Map([[X.POSITION,0],[X.UV0,1],[X.NORMALCOMPRESSED,2]]);let _1t=class{constructor(){this.geometry=new Egt,this.intersectionData=null,this.geometryState=null,this._textureRef=new DAe(()=>this.tile.surface.textureFadeDuration),this.overlay=new h1t,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const i=this.geometry;i.indices=null,i.vertexAttributes=null,cn(i.boundingBox),i.indexCount=0,i.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new Ogt,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Ks&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)tt(this.geometry.outerEdges[i].count===this.geometryState.neighborData.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){const r=this.tile,n=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const p=r.surface.extent;if(p!=null&&(e===0&&r.extent[3]>p[3]||e===1&&r.extent[2]>p[2]||e===2&&r.extent[1]<p[1]||e===3&&r.extent[0]<p[0]))return n}const s=r.level,a=ag[e];if(!i)return tt(r.surface?.rootTiles==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(a)),n;if(i.isLoaded){const p=i,y=p.renderData.geometryState,b=s-p.level;if(tt(b>=0),b===0){const O=y.numVerticesPerSide-1;return Math.max(O,n)}const S=2**b,C=y.neighborData.edgeResolutions[(e+2)%4]/S;return Math.max(1,C)}tt(!i.isLeaf);let u=n;return i.forAllSubtreeOnSide(dee(a),p=>p===r||(p.isLoaded?(u=Math.max(u,2**(p.level-s)),!0):(tt(!p.isLeaf),!1))),u}updateNeighborData(){const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState.neighborData,r=u=>(u.isLoaded||u.level===e.level)&&u?.intersectsClippingArea,n=i.edgePeerNeighbors,s=i.edgePeerNeighborSamplerVersions;for(let u=0;u<4;++u){const p=e.findNeighborTile(ag[u],r),y=Wb(e,p),b=y?.renderData?.geometryState.samplerDataVersion??-1,S=n[u],C=y!==Wb(e,S),O=s[u]!==b;n[u]=p,(C||O)&&(s[u]=b,this._markEdgeDirty(u));const P=i.edgeResolutions[u],$=this._calculateEdgeResolution(u,p);tt(G2($)),tt($>=1),i.edgeResolutions[u]=$,P!==$&&this._markEdgeResolutionDirty(u)}const a=i.cornerPeerNeighbors;for(let u=0;u<4;++u){const p=e.findNeighborTile(D8[u],r);a[u]=p;const y=Wb(e,n[u]),b=Wb(e,n[(u+1)%4]),S=Wb(e,p);Ad[u]=S,Ad[(u+1)%4]=b,Ad[(u+2)%4]=e,Ad[(u+3)%4]=y,tt(Ad.some($=>$?.isLoaded||$===e));const C=Ad.reduce(($,N)=>Math.min($,N?.level??1/0),1/0);Ad.forEach(($,N)=>{$&&$?.level>C&&(Ad[N]=null)}),tt(Ad.some($=>$?.isLoaded||$===e));const O=i.cornerNeighborData[u].cornerTiles,P=i.cornerNeighborData[u].cornerTileSamplerVersions;for(let $=0;$<4;++$){const N=Ad[$],z=N?.renderData.geometryState.samplerDataVersion??-1,U=O[$]!==N,j=!U&&P[$]!==z;(U||j)&&(O[$]=N,P[$]=z,this._markCornerDirty(u))}tt(O.some($=>$?.isLoaded||$===e))}Ks&&tt(this.geometryState.neighborData.edgeResolutions.every(u=>u>0));for(let u=0;u<4;++u)Ad[u]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Ks&&tt(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(p=>p>0)),this.intersectionData=null;const i=this.tile,r=this._vao,n=this.geometry.vertexAttributes,s=!r||!n||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,a=!s&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),u=!a&&this._dirtyCorners!==0;s?(this.releaseGeometry(),this._createGeometry(e)):a||u?i.updateEdgeElevations():u?i.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=jt(this._vao),this.geometry.release(),!0)}ensureTexture(e,i,r){const n=i?ei.RGBA:ei.RGB;return this._texture==null||this._texture.descriptor.width===e&&this._texture.descriptor.pixelFormat===n||this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const i=1<<e;this._dirtyCorners|=i}_markEdgeDirty(e){const i=1<<e;this._dirtyEdges|=i,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const i=1<<e;this._dirtyEdgeResolutions|=i,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.getDefaultVerticesPerSide(),n=Math.max(r,5);let s=i.clippingArea;i.intersectsClippingArea&&!i.isWithinClippingArea||(s=null);const a=this.geometryState;let u=!1;a.numVerticesPerSide!==n&&(this._numVerticesPerSideChanged=!0,a.numVerticesPerSide=n,a.samplerDataVersion++,u=!0),e.changed&&(this._samplerDataChanged=!0,a.samplerData=e.samplerData,a.samplerDataVersion++,u=!0),bg(a.clippingArea,s)||(this._clippingAreaChanged=!0,a.clippingArea=s,u=!0);const p=i.surface.wireframe;return a.wireframe!==p&&(this._wireframeChanged=!0,a.wireframe=p,u=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=u),u&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const i=this.geometry.vertexAttributes,r=this.geometry.indices,n=e.gl;this._vao=new Wp(e,WAe,{geometry:Kc(i.layout)},{geometry:xr.createVertex(e,n.STATIC_DRAW,i.buffer)},xr.createIndex(e,n.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=vg.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,i=this.tile.layerInfo[$i.ELEVATION],r=i.length,n=new Array(r);let s=0,a=0,u=!1;for(let b=0;b<r;b++){const S=i[b];if(S.upsampleInfo!=null){const C=S.upsampleInfo.tile,O=C.layerInfo[$i.ELEVATION][b].data,P=O&&O.samplerData;e&&e[s]===P||(u=!0),n[s++]=P,a=Math.max(a,C.lij[0])}else if(S.data){const C=this.tile.surface.layerViewByIndex(b,$i.ELEVATION);if(v4(this.tile,C.layer,!1)){const O=S.data;e&&e[s]===O.samplerData||(u=!0),n[s++]=O.samplerData,a=this.tile.level}}}e!=null&&e.length!==s&&(u=!0);const p=s>0,y=p?n:null;return p&&(n.length=s),{changed:u,samplerData:y,maxTileLevel:a}}get estimatedGeometryMemoryUsage(){const e=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!Ks)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void tt(e?.isLoaded);const i=e.surface.extent;if(i!=null&&!e.intersectsExtent(i))return;const r=ag.map((u,p)=>i!=null&&(p<2?-1:1)*(e.extent[3-p]-i[3-p])<0),n=e.level;tt(this._dirtyCorners===0),tt(this._dirtyEdges===0),tt(this._dirtyEdgeResolutions===0),tt(!this._numVerticesPerSideChanged),tt(!this._samplerDataChanged),tt(!this._clippingAreaChanged),tt(!this._wireframeChanged);const s=D8.map(u=>e.findNeighborCornerTileExact(u,p=>!p.intersectsClippingArea||p.isLoaded||p.level===e.level)??null).map(u=>u?.intersectsClippingArea?u:null),a=this.geometryState.neighborData;for(let u=0;u<4;++u){const p=a.cornerPeerNeighbors[u],y=s[u];tt(y===p,`Tile[${e.lij}].corner[${u}] out of date: cur=[${p?.lij}] exp=[${y?.lij}]`)}ag.forEach((u,p)=>{if(r[p])return;const y=e.findNeighborTile(u,fe=>(fe.level===n||fe?.isLoaded)&&fe?.intersectsClippingArea);if(!y){const fe=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(u);return void tt(!fe)}tt(y.isLoaded||y.level===e.level),tt(y===this.geometryState.neighborData.edgePeerNeighbors[p]);const b=n-y.level;if(!y.isLoaded)return tt(!y.isLeaf),void tt(b===0);const S=y.renderData;tt(u1t(e,y,u)),tt(b>=0);const C=2**b;if(b<0)return void tt(!1);const O=e.renderData,P=O.geometry,$=P.outerEdges[p],N=P.numVerticesPerSide-1,z=S.geometry;if(!z)return void tt(!1);const U=this.geometryState.neighborData.edgePeerNeighbors[p];if(U?.isLoaded){const fe=U.renderData;tt(U==U),tt(O.geometryState.neighborData.edgePeerNeighborSamplerVersions[p]===fe.geometryState.samplerDataVersion),tt(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[p]===fe.geometryState.samplerDataVersion)}const j=(p+2)%4,G=z.outerEdges[j],q=$.count-1,W=G.count-1;tt(q*C===W,`Tile[${e.lij}]:e${p},res=${q} edgeRes mismatch with Neighbor[${y.lij}]:e${j},res=${W} (expected:${q*C})`);const K=e.extent,se=u===Ht.NORTH||u===Ht.SOUTH,ae=G.count-1,le=ae/2**b,me=$.count-1;if(le<1)return void tt(me===1);tt(le===me),tt(G2(le));const ne=z.numVerticesPerSide-1;tt(b>0||le===Math.max(ne,N));const pe=e.getNeighborEdgeStartVertexIndex(p,y);tt(0<=pe&&pe<C);const ge=pe*le;tt(0<=ge&&ge<=ae-le);let ve=0,Se=ge;$.getVertexPos(mf,0),$.getVertexPos(gf,$.count-1);const ee=un(mf,gf),re=Math.max(b1t,1e-4*ee);for(let fe=0;fe<=le;++fe){$.getVertexPos(mf,ve),G.getVertexPos(gf,Se);const ye=fe/le,we=se?K[0]+ye*(K[2]-K[0]):u===Ht.WEST?K[0]:K[2],Ae=se?u===Ht.SOUTH?K[1]:K[3]:K[1]+ye*(K[3]-K[1]),Oe=e.surface.extent;if(Oe==null||VD(Oe,we,Ae)){const Ve=WO(mf,gf),at=Sc(mf)-ur.radius,Xt=Sc(gf)-ur.radius,ti=Ve<re;if(!ti){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${p}[${ve}/${$.count}] and [${y.lij}].edge${j}[${Se}/${G.count}]`),Oe!=null&&console.warn("  surface extent= ",Oe," x,y=",we,",",Ae);const St=H();Be(St,O.localOrigin,S.localOrigin),Sc(St)>0&&console.warn(`   localOrigins: ${O.localOrigin} vs ${S.localOrigin} d=${Sc(St)} [${St}]`),(()=>{const ze=An(mf),ni=An(gf);e.updateEdgeElevations(),y.updateEdgeElevations(),$.getVertexPos(mf,ve),G.getVertexPos(gf,Se);const Ye=H();Ao(Ye,mf,ze),Sc(Ye)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${ze} vs ${mf} d=${Sc(Ye)} [${Ye}]`),Ao(Ye,gf,ni),Sc(Ye)>0&&console.warn(`  XXX Neighbor[${y.lij}] edge out of date: ${ni} vs ${gf} d=${Sc(Ye)} [${Ye}]`)})(),tt(ti,`Mismatch in tile [${e.lij}].edge[${p}][${ve}/${$.count}] vs neighbor [${y.lij}].edge[${j}][${Se}/${G.count}] ${cm(mf)} vs ${cm(gf)}  dist=${Ve} h(t|n|d)=${at}|${Xt}|${Xt-at}`)}$.getNormal(U3,ve),G.getNormal(j3,Se),We(Lue,U3),We(Due,j3);const Vt=He(Lue,Due),Qt=1-Vt<.01||!1||e===y;if(!Qt){const St=H();Ao(St,U3,j3);const ze=()=>`Mismatch in tile edge normal ${hue(e.lij)} (${ve}/${$.count-1}) edge ${p} vs neighbor ${hue(y.lij)}  (${Se}/${G.count-1}) nedge ${j} :${cm(U3)} vs ${cm(j3)}  dot = ${Vt} : ${cm(St)}`;console.warn("Mismatch in tile edge normal: ",ze());{e.updateEdgeElevations(),y.updateEdgeElevations();const ni=H(),Ye=H();$.getNormal(ni,ve),G.getNormal(Ye,Se),j2(U3,ni)||console.warn("Missing update in tile normal: ",cm(U3)," => ",cm(ni)),j2(j3,Ye)||console.warn("Missing update in neighbor normal: ",cm(j3)," => ",cm(Ye))}tt(Qt,ze())}}ve+=1,Se+=1}})}};const mf=H(),gf=H(),U3=H(),j3=H(),Lue=H(),Due=H(),b1t=1,Ad=[null,null,null,null];function Wb(t,e){return e?.isLoaded||e===t?e:null}const w1t=65536;function x1t(t,e){const i=t.tile,{extent:r,extentInRadians:n,surface:s}=i,a=t.localOrigin,u=t.geometryState,p=s.isWebMercator,y=u.numVerticesPerSide,b=y-1,S=(y-2)**2,C=p&&(e===zh.HAS_SOUTH_POLE||e===zh.HAS_BOTH_POLES),O=p&&(e===zh.HAS_NORTH_POLE||e===zh.HAS_BOTH_POLES),P=6,$=((C?1:0)+(O?1:0))*P*(b+1),N=u.neighborData,z=N.edgeResolutions.reduce((se,ae)=>se+ae+1,0),U=S+$+z,j=s.renderer.tileGeometryCache.acquire(U),G=t.geometry;G.numVerticesPerSide=u.numVerticesPerSide,G.vertexAttributes=j;const q=G.boundingBox;cn(q);const W=vee(t);Vo.update(b,n,W),T1t(t),r4e(t,S),XAe(t);const K=[];if((()=>{let se=S+z;const ae=a[0],le=a[1],me=a[2],ne=i.ellipsoid.radius,pe=r[1],ge=r[3],ve=(Se,ee)=>{const re=ee*y;Yh(-ae,-le,Se*ne-me,q),K.push({connectedRowOffset:re,connectedOuterEdgeOffset:Se===1?0:2,rowOffset:se,latitudeResolution:P});const fe=ZAe(Se===-1?pe:ge,ne),ye=Se*Math.PI/2-fe,we=.99*(Se===1?1:-1),Ae=ne+0,{position:Oe,uv0:Ve}=j,{typedBuffer:at,typedBufferStride:Xt}=j.normalCompressed;for(let ti=1;ti<=P;++ti){const Vt=fe+ye*(ti/P),Qt=Math.cos(Vt),St=Math.sin(Vt);for(let ze=0;ze<=b;ze++){const ni=ze/b,Ye=Vo.sinLonLUT[ze],gt=Vo.cosLonLUT[ze]*Qt,Nt=Ye*Qt,Jt=St,Tt=gt*Ae-ae,Q=Nt*Ae-le,pt=Jt*Ae-me;Yh(Tt,Q,pt,q),Oe.setValues(se,Tt,Q,pt),Rp(Ve,se,ni,we),aw(at,se,gt,Nt,Jt,Xt),++se}}};C&&ve(-1,0),O&&ve(1,b)})(),i4e(G,u.numVerticesPerSide,K,[0,y-1],[0,y-1],u.wireframe),t.intersectionData=null,Ks)for(let se=0;se<4;++se)tt(G.outerEdges[se].count===N.edgeResolutions[se]+1)}function T1t(t){const e=t.tile;if(!e.intersectsClippingArea)return;const i=t.geometryState,r=i.numVerticesPerSide,n=r-2,s=r-1,a=t.geometry,u=a.vertexAttributes,p=u.position,y=u.uv0,{typedBuffer:b,typedBufferStride:S}=u.normalCompressed,C=e.extent,O=C[0],P=C[2],$=C[1],N=C[3],z=e.ellipsoid.radius,U=i.samplerData,j=t.localOrigin,G=j[0],q=j[1],W=j[2],K=p.typedBuffer,se=p.typedBufferStride,ae=1/s,le=a.boundingBox;let me=0;if(1<=n){const ne=ae,pe=$*(1-ne)+N*ne,ge=Vo.sinLatLUT[1],ve=Vo.cosLatLUT[1];for(let Se=1;Se<=n;Se++){const ee=Se*ae,re=O*(1-ee)+P*ee,fe=Vo.sinLonLUT[Se],ye=Vo.cosLonLUT[Se],we=z+Ln(re,pe,U),Ae=we*ye*ve-G,Oe=we*fe*ve-q,Ve=we*ge-W;Yh(Ae,Oe,Ve,le);const at=(Se-1)*se;K[at]=Ae,K[at+1]=Oe,K[at+2]=Ve,Rp(y,Se-1,ee,ne)}}for(let ne=1;ne<=n;ne++){const pe=ne*ae,ge=$*(1-pe)+N*pe,ve=Vo.sinLatLUT[ne],Se=Vo.cosLatLUT[ne],ee=ne+1,re=ee*ae,fe=$*(1-re)+N*re,ye=Vo.sinLatLUT[ee],we=Vo.cosLatLUT[ee],Ae=Vo.sinLonLUT[0],Oe=Vo.cosLonLUT[0],Ve=z+Ln(O,ge,U);let at=Oe*Se*Ve-G,Xt=Ae*Se*Ve-q,ti=ve*Ve-W;const Vt=me*se;let Qt=K[Vt],St=K[Vt+1],ze=K[Vt+2];for(let ni=1;ni<=n;ni++){const Ye=ni*ae,gt=O*(1-Ye)+P*Ye,Nt=Vo.sinLonLUT[ni],Jt=Vo.cosLonLUT[ni];let Tt=0,Q=0,pt=0;if(ni<n){const m=(me+1)*se;Tt=K[m],Q=K[m+1],pt=K[m+2]}else{const m=Vo.sinLonLUT[s],g=Vo.cosLonLUT[s],v=z+Ln(P,ge,U);Tt=g*Se*v-G,Q=m*Se*v-q,pt=ve*v-W}const ii=at,bt=Xt,ci=ti;at=Qt,Xt=St,ti=ze,Qt=Tt,St=Q,ze=pt;const Ot=Tt-ii,It=Q-bt,Rt=pt-ci;let pi=0,Ti=0,Dr=0;if(ne>1){const m=(me-n)*se;pi=K[m],Ti=K[m+1],Dr=K[m+2]}else{const m=Vo.sinLatLUT[0],g=Vo.cosLatLUT[0],v=z+Ln(gt,$,U);pi=Jt*g*v-G,Ti=Nt*g*v-q,Dr=m*v-W}const tr=z+Ln(gt,fe,U),je=Jt*we*tr-G,Bi=Nt*we*tr-q,f=ye*tr-W;if(ne<n){const m=me+n,g=m*se;K[g]=je,K[g+1]=Bi,K[g+2]=f,Yh(je,Bi,f,le),Rp(y,m,Ye,re)}const L=pi-je,x=Ti-Bi,d=Dr-f;let c=Jt*Se,o=Nt*Se,l=ve;l*l<.999&&(c=Rt*x-It*d,o=Ot*d-Rt*L,l=It*L-Ot*x);const h=1/Math.sqrt(c*c+o*o+l*l);aw(b,me,c*h,o*h,l*h,S),++me}}}function S1t(t){t.tile.intersectsClippingArea&&(XAe(t),ON(t))}function E1t(t){t.tile.intersectsClippingArea&&(YAe(t),JAe(t,!0),ON(t))}function XAe(t){t.tile.intersectsClippingArea&&(YAe(t),JAe(t))}function JAe(t,e=!1){const i=t.geometryState,r=t.geometry,n=i.neighborData,s=t.tile,a=s.level,u=s.extent,p=s.ellipsoid.radius,y=s.extentInRadians,b=y[0],S=y[2],C=y[1],O=y[3],P=i.samplerData,$=u[0],N=u[2],z=u[1],U=u[3],j=vee(t),G=r.boundingBox,q=t.localOrigin,W=q[0],K=q[1],se=q[2],ae=r.vertexAttributes,le=ae.position,me=le.typedBuffer,ne=le.typedBufferStride,pe=ae.uv0;for(let ge=0;ge<4;++ge){const ve=ge===1||ge===3,Se=n.edgeResolutions[ge];tt(G2(Se));const ee=Se+1,re=Wb(s,n.edgePeerNeighbors[ge]);if(o4e(s,re,ge)){n4e(t,ge,re);continue}const fe=re!=null;tt(!fe||re.level===s.level),tt(!fe||_g(s,re)<=0);const ye=re?.renderData,we=ye?.geometryState;if(Ks){const Ot=s.surface;if(!re&&Ot&&!Ot.updatingRootTiles){const It=ag[ge],Rt=s.findNeighborTile(It,pi=>pi.isLoaded||pi.isLeaf||pi.level===s.level);Rt?Rt.intersectsClippingArea&&(tt(!Rt.isLoaded),tt(!Rt.isLeaf),tt(Rt.level===a)):tt(Ot?.rootTiles==null||!s.shouldHaveNeighbor(It))}}const Ae=ge===1?u[2]:u[0],Oe=re?.extent,Ve=Oe&&ve?ge===1?Oe[0]:Oe[2]:Ae,at=ge===0?u[3]:u[1],Xt=ge===1?1:0,ti=ge===0?1:0,Vt=ge===1?S:b,Qt=ge===0?O:C,St=Math.sin(Vt),ze=Math.cos(Vt),ni=Math.sin(Qt),Ye=Math.cos(Qt),gt=we?.samplerData,Nt=fe?(Ot,It,Rt)=>.5*(Ln(Ot,It,P)+Ln(Rt,It,gt)):(Ot,It,Rt)=>Ln(Ot,It,P),Jt=r.outerEdges[ge],Tt=e&&ee>3?ee-3:1,Q=P!=null&&P.some(Ot=>Ot!=null),pt=gt!=null&&gt.some(Ot=>Ot!=null),ii=Q||pt,bt=1/Se,ci=Jt.index0;tt(!Oe||Uh(Oe[2]-Oe[0],u[2]-u[0])),(()=>{const Ot=ge===1?-1:ge===3?1:0,It=ge===0?-1:ge===2?1:0,Rt=(u[2]-u[0])*bt,pi=Ot*Rt,Ti=It*Rt,Dr=ve?Ot*((S-b)*bt):0,tr=ve?0:It*bt,je=ti,Bi=ve?Vt+Dr:Vt,f=ve?Math.sin(Bi):St,L=ve?Math.cos(Bi):ze,x=ve?Vt-Dr:Vt,d=ve?Math.sin(x):St,c=ve?Math.cos(x):ze,o=ve?Qt:j(je+tr),l=ve?ni:Math.sin(o),h=ve?Ye:Math.cos(o),m=ve?Qt:j(je-tr),g=ve?ni:Math.sin(m),v=ve?Ye:Math.cos(m);let w=0,E=0,A=0;{const k=0*bt,B=ve?Ae:$*(1-k)+N*k,J=ve?Ve:B,Y=ve?z*(1-k)+U*k:at,V=ve?Vt:b*(1-k)+S*k,te=ve?St:Math.sin(V),he=ve?ze:Math.cos(V),ue=ve?j(k):Qt,xe=ve?Math.sin(ue):ni,be=ve?Math.cos(ue):Ye,Le=p+Nt(B,Y,J);w=he*be*Le,E=te*be*Le,A=xe*Le}let M=0,I=0,D=0;{const k=1*bt,B=ve?Ae:$*(1-k)+N*k,J=ve?Ve:B,Y=ve?z*(1-k)+U*k:at,V=ve?Vt:b*(1-k)+S*k,te=ve?St:Math.sin(V),he=ve?ze:Math.cos(V),ue=ve?j(k):Qt,xe=ve?Math.sin(ue):ni,be=ve?Math.cos(ue):Ye,Le=p+Nt(B,Y,J);M=he*be*Le,I=te*be*Le,D=xe*Le}for(let k=1;k<ee-1;k+=Tt){let B=0,J=0,Y=0;{const Ri=(k+1)*bt,Vi=ve?Ae:$*(1-Ri)+N*Ri,Ei=ve?Ve:Vi,Ki=ve?z*(1-Ri)+U*Ri:at,bi=ve?Vt:b*(1-Ri)+S*Ri,uo=ve?St:Math.sin(bi),Zi=ve?ze:Math.cos(bi),Es=ve?j(Ri):Qt,Er=ve?Math.sin(Es):ni,th=ve?Math.cos(Es):Ye,Qc=p+Nt(Vi,Ki,Ei);B=Zi*th*Qc,J=uo*th*Qc,Y=Er*Qc}const V=B,te=J,he=Y,ue=M,xe=I,be=D;M=V,I=te,D=he;{const Ri=ci+k,Vi=Ri*ne,Ei=ue-W,Ki=xe-K,bi=be-se;me[Vi]=Ei,me[Vi+1]=Ki,me[Vi+2]=bi,Yh(Ei,Ki,bi,G);const uo=k*bt;Rp(pe,Ri,ve?Xt:uo,ve?uo:ti)}const Le=w,Xe=E,qe=A;w=ue,E=xe,A=be;const xt=ue,it=xe,hi=be,ai=1/Math.sqrt(xt*xt+it*it+hi*hi),yt=hi*ai;let Or=0,xn=0,Pr=0;if(ii&&yt*yt<.999){let Ri=0,Vi=0,Ei=0;{const Ki=ge===0?-1:1;Ri=Ki*(V-Le),Vi=Ki*(te-Xe),Ei=Ki*(he-qe)}{const Ki=k*bt,bi=ve?Ae:$*(1-Ki)+N*Ki,uo=ve?Ve:bi,Zi=ve?z*(1-Ki)+U*Ki:at,Es=ve?Vt:b*(1-Ki)+S*Ki,Er=ve?St:Math.sin(Es),th=ve?ze:Math.cos(Es),Qc=ve?j(Ki):Qt,J0=ve?Math.sin(Qc):ni,Io=ve?Math.cos(Qc):Ye;let DE=xt,NE=it,_e=hi;if(fe){const Ge=p+Ln(uo-pi,Zi-Ti,gt),nt=ve?Io:v;DE=(ve?c:th)*nt*Ge,NE=(ve?d:Er)*nt*Ge,_e=(ve?J0:g)*Ge}{const Ge=p+Ln(bi+pi,Zi+Ti,P),nt=ve?Io:h,Qi=(ve?L:th)*nt*Ge,Cs=(ve?f:Er)*nt*Ge,an=(ve?J0:l)*Ge;fe||(DE=2*xt-Qi,NE=2*it-Cs,_e=2*hi-an);const Ha=ge===3?-1:1,qv=Ha*(DE-Qi),pte=Ha*(NE-Cs),fte=Ha*(_e-an);Or=Ei*pte-Vi*fte,xn=Ri*fte-Ei*qv,Pr=Vi*qv-Ri*pte;const XN=1/Math.sqrt(Or*Or+xn*xn+Pr*Pr);Or*=XN,xn*=XN,Pr*=XN}}}else Or=xt*ai,xn=it*ai,Pr=hi*ai;Jt.setNormalFromValues(k,Or,xn,Pr)}})()}}function YAe(t){s4e(t)}function ZAe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function C1t(t,e,i,r){return ZAe(t*(1-r)+e*r,i)}function A1t(t,e,i){return t*(1-i)+e*i}function vee(t){const e=t.tile;if(e.surface.isWebMercator){const r=e.extent,n=e.ellipsoid.radius;return s=>C1t(r[1],r[3],n,s)}const i=e.extentInRadians;return r=>A1t(i[1],i[3],r)}function O1t(t,e){const i=t.tile,{extent:r,surface:n}=i,s=t.geometryState,a=r[0],u=r[1],p=r[2]-a,y=r[3]-u,b=s.clippingArea,S=b!=null?Math.max(0,(b[0]-a)/p):0,C=b!=null?Math.max(0,(b[1]-u)/y):0,O=b!=null?Math.min(1,(b[2]-a)/p):1,P=b!=null?Math.min(1,(b[3]-u)/y):1,$=s.numVerticesPerSide,N=($-2)**2,z=N+s.neighborData.edgeResolutions.reduce((q,W)=>q+W+1,0),U=n.renderer.tileGeometryCache.acquire(z),j=t.geometry,G=j.boundingBox;cn(G),j.numVerticesPerSide=s.numVerticesPerSide,j.vertexAttributes=U,_n(j.uvRange,S,C,O,P),R1t(t),r4e(t,N),KAe(t),i4e(j,s.numVerticesPerSide,[],[0,$-1],[0,$-1],s.wireframe),t.intersectionData=null}function R1t(t){const e=t.tile;if(!e.intersectsClippingArea)return;const i=e.surface,r=t.geometryState,n=r.samplerData,s=t.localOrigin,a=i.isWebMercatorOnPlateeCarree,u=r.clippingArea,p=u??_ee,y=e.extent,b=y[0],S=y[1],C=y[2],O=y[3],P=Math.max(b,p[0]),$=Math.min(C,p[2]),N=Math.max(S,p[1]),z=Math.min(O,p[3]),U=e.ellipsoid.radius,j=e.horizontalScale,G=r.numVerticesPerSide,q=G-1,W=G-2,K=t.geometry,se=K.vertexAttributes,ae=se.position,le=se.uv0,{typedBuffer:me,typedBufferStride:ne}=se.normalCompressed,pe=K.uvRange,ge=pe[0],ve=pe[1],Se=pe[2],ee=pe[3],re=K.boundingBox,fe=s[0],ye=s[1],we=s[2],Ae=ae.typedBuffer,Oe=ae.typedBufferStride;let Ve=0;const at=Je(S,N,z),Xt=a?(Math.PI/2-2*Math.atan(Math.exp(-at/U)))*U:at*j,ti=1/q,Vt=Je(S*(1-ti)+O*ti,N,z);let Qt=Xt,St=a?(Math.PI/2-2*Math.atan(Math.exp(-Vt/U)))*U:Vt*j;for(let ze=1;ze<=W;ze++){const ni=ze/q,Ye=Je(S*(1-ni)+O*ni,N,z),gt=Je(ni,ve,ee),Nt=St,Jt=(ze-1)/q,Tt=Je(S*(1-Jt)+O*Jt,N,z),Q=Qt,pt=(ze+1)/q,ii=Je(S*(1-pt)+O*pt,N,z),bt=a?(Math.PI/2-2*Math.atan(Math.exp(-ii/U)))*U:ii*j,ci=Je(pt,ve,ee);Qt=St,St=bt;const Ot=Je(b,P,$);let It=Ot*j,Rt=Ln(Ot,Ye,n);const pi=1/q,Ti=Je(pi,ge,Se),Dr=Je(b*(1-Ti)+C*Ti,P,$);let tr=Ti,je=Dr,Bi=Dr*j,f=Ln(Dr,Ye,n);if(ze===1){const L=Bi-fe,x=Qt-ye,d=f-we,c=0*Oe;Ae[c]=L,Ae[c+1]=x,Ae[c+2]=d,Yh(L,x,d,re);const o=Je(pi,ge,Se);Rp(le,Ve,o,gt)}for(let L=1;L<=W;L++){const x=Bi,d=f,c=(L+1)/q,o=Je(c,ge,Se),l=Je(b*(1-c)+C*c,P,$),h=je;je=l;{const I=Ve+1,D=I*Oe;if(ze===1||L===W){const k=l*j,B=Ln(l,Ye,n);if(ze===1&&L<W){const J=k-fe,Y=Nt-ye,V=B-we;Ae[D]=J,Ae[D+1]=Y,Ae[D+2]=V,Yh(J,Y,V,re),Rp(le,I,o,gt)}Bi=k,f=B}else Bi=Ae[D]+fe,f=Ae[D+2]+we}const m=Bi,g=f,v=It,w=Rt;It=x,Rt=d;const E=(Ve-W)*Oe,A=ze===1?Ln(h,Tt,n):Ae[E+2]+we,M=Ln(h,ii,n);if(ze<W){const I=Ve+W,D=I*Oe,k=x-fe,B=bt-ye,J=M-we;Ae[D]=k,Ae[D+1]=B,Ae[D+2]=J,Yh(k,B,J,re);const Y=tr;tr=o,Rp(le,I,Y,ci)}{const I=m-v,D=Q-bt,k=D*(g-w),B=I*(A-M),J=-D*I,Y=k*k+B*B+J*J;if(Y===0)aw(me,Ve,0,0,1,ne);else{const V=1/Math.sqrt(Y);aw(me,Ve,k*V,B*V,J*V,ne)}}++Ve}}}function M1t(t,e){t.tile.intersectsClippingArea&&(e4e(t),QAe(t,!0),ON(t))}function P1t(t,e){t.tile.intersectsClippingArea&&(KAe(t),ON(t))}function KAe(t,e){t.tile.intersectsClippingArea&&(e4e(t),QAe(t,!1))}function QAe(t,e){const i=t.geometryState,r=i.neighborData,n=t.tile,s=n.surface,a=n.extent,u=i.clippingArea,p=u??_ee,y=a[0],b=a[2],S=a[1],C=a[3],O=[C>p[3],b>p[2],S<p[1],y<p[0]],P=t.geometry,$=n.horizontalScale,N=t4e(s.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,$),z=P.boundingBox,U=P.uvRange[0],j=P.uvRange[1],G=P.uvRange[2],q=P.uvRange[3],W=Math.max(y,p[0]),K=Math.min(b,p[2]),se=Math.max(S,p[1]),ae=Math.min(C,p[3]),le=t.localOrigin,me=le[0],ne=le[1],pe=le[2],ge=i.samplerData;for(let ve=0;ve<4;++ve){const Se=ve===1||ve===3,ee=r.edgeResolutions[ve];tt(G2(ee));const re=ee+1,fe=O[ve],ye=Wb(n,r.edgePeerNeighbors[ve]);if(!fe&&o4e(n,ye,ve)){n4e(t,ve,ye);continue}const we=ye!=null&&!fe,Ae=ye?.renderData,Oe=Ae?.geometryState;if(Ks&&(tt(!we||ye.level===n.level),tt(!we||_g(n,ye)<=0),n&&!ye&&!s.updatingRootTiles)){const Ot=ag[ve],It=n.findNeighborTile(Ot,Rt=>Rt.isLoaded||Rt.isLeaf||Rt.level===n.level);s.updatingRootTiles||(It?It.intersectsClippingArea&&(tt(!It.isLoaded),tt(!It.isLeaf),tt(It.level===n.level)):tt(s?.rootTiles==null||!n.shouldHaveNeighbor(Ot)))}const Ve=Je(ve===1?b:y,W,K),at=Je(ve===0?C:S,se,ae),Xt=Oe?.samplerData,ti=P.outerEdges[ve],Vt=e&&re>3?re-3:1,Qt=Je(ve===1?1:0,U,G),St=Je(ve===0?1:0,j,q),ze=we?(Ot,It)=>.5*(Ln(Ot,It,Xt)+Ln(Ot,It,ge)):(Ot,It)=>Ln(Ot,It,ge),ni=(b-y)/ee,Ye=Se?ve===1?ni:-ni:0,gt=Se?0:ve===0?ni:-ni,Nt=-Ye,Jt=-gt;let Tt=0,Q=0,pt=0;{const Ot=0/ee,It=Se?Ve:Je(y*(1-Ot)+b*Ot,W,K),Rt=Se?Je(S*(1-Ot)+C*Ot,se,ae):at,pi=ze(It,Rt);Tt=It*$,Q=N(Rt),pt=pi}let ii=0,bt=0,ci=0;{const Ot=1/ee,It=Se?Ve:Je(y*(1-Ot)+b*Ot,W,K),Rt=Se?Je(S*(1-Ot)+C*Ot,se,ae):at,pi=ze(It,Rt);ii=It*$,bt=N(Rt),ci=pi}for(let Ot=1;Ot<re-1;Ot+=Vt){const It=Ot/ee,Rt=ii,pi=bt,Ti=ci;{const o=Se?Qt:Je(It,U,G),l=Se?Je(It,j,q):St,h=Rt-me,m=pi-ne,g=Ti-pe;Yh(Rt,m,g,z),ti.setVertexFromValuesRawPositionUV(Ot,h,m,g,o,l)}{const o=(Ot+1)/ee,l=Se?Ve:Je(y*(1-o)+b*o,W,K),h=Se?Je(S*(1-o)+C*o,se,ae):at,m=ze(l,h);ii=l*$,bt=N(h),ci=m}const Dr=ii,tr=ci,je=Tt,Bi=Q,f=pt;Tt=Rt,Q=pi,pt=Ti;let L=0,x=0,d=0;if(Se){const o=bt-pi,l=tr-Ti,h=Bi-pi,m=f-Ti,g=Je(S*(1-It)+C*It,se,ae),v=Ve+Nt,w=v*$-Rt,E=Ln(v,g,ge)-Ti,A=ve===3?-1:1;if(L=A*(-h+o)*E,x=A*w*(-m+l),d=-A*w*(-h+o),we){const M=Ve+Ye,I=M*$-Rt;L=(-h+o)*(E-(Ln(M,g,Xt)-Ti)),x=(w-I)*(-m+l),d=-(w-I)*(-h+o)}}else{const o=Dr-Rt,l=tr-Ti,h=je-Rt,m=f-Ti,g=Je(y*(1-It)+b*It,W,K),v=at+Jt,w=Ln(g,v,ge)-Ti,E=N(v)-pi,A=ve===2?-1:1;if(L=A*E*(-m+l),x=A*(-h+o)*w,d=-A*E*(-h+o),we){const M=g,I=at+gt,D=N(I)-pi;L=(-E+D)*(-m+l),x=(-h+o)*(-w+(Ln(M,I,Xt)-Ti)),d=-(-E+D)*(-h+o)}}const c=1/Math.sqrt(L*L+x*x+d*d);ti.setNormalFromValues(Ot,L*c,x*c,d*c)}}}function e4e(t,e){s4e(t)}function I1t(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function $1t(t,e){return t*e}function t4e(t,e,i){return t?r=>I1t(r,e):r=>$1t(r,i)}function i4e(t,e,i,r,n,s){const a=e-1,u=t.vertexAttributes.count,p=2*(Math.min(e-2,r[1])-Math.max(1,r[0]))*(Math.min(e-2,n[1])-Math.max(1,n[0])),y=ag.map((j,G)=>G===0&&n[1]<e-2||G===1&&r[1]<e-2||G===2&&n[0]>1||G===3&&r[0]>1),b=t.outerEdges.reduce((j,G,q)=>j+(y[q]?0:a-2+G.count-1),0),S=i.reduce((j,G)=>j+a*(2*(G.latitudeResolution-1)+1),0),C=s?2:1,O=3*(p+b+S)*C,P=u>=w1t?new Uint32Array(O):new Uint16Array(O);let $=0;const N=e-2,z=a-2;tt(z>=0);const U=(j,G,q,W,K,se)=>{const ae=j*K,le=se[ae],me=se[ae+1],ne=se[ae+2],pe=G*K,ge=se[pe],ve=se[pe+1],Se=se[pe+2],ee=q*K,re=se[ee],fe=se[ee+1],ye=se[ee+2],we=W*K,Ae=se[we],Oe=se[we+1],Ve=se[we+2];return(ge-Ae)*(ge-Ae)+(ve-Oe)*(ve-Oe)+(Se-Ve)*(Se-Ve)>(le-re)*(le-re)+(me-fe)*(me-fe)+(ne-ye)*(ne-ye)};if(s){const j=(q,W,K)=>{P[$++]=q,P[$++]=W,P[$++]=W,P[$++]=K,P[$++]=K,P[$++]=q,Ks&&(tt(q<u),tt(W<u),tt(K<u),tt($<=O))};(()=>{for(let q=Math.max(n[0],1)-1;q<Math.min(n[1],e-2)-1;++q){const W=q*N;for(let K=Math.max(r[0],1)-1;K<Math.min(r[1],e-2)-1;++K){const se=q*N+K,ae=se+1,le=ae+N,me=le-1,ne=W+K,pe=ne+1,ge=pe+N,ve=ge-1,Se=t.vertexAttributes.position.typedBuffer,ee=t.vertexAttributes.position.typedBufferStride;U(ne,pe,ge,ve,ee,Se)?(j(se,ae,le),j(le,me,se)):(j(se,ae,me),j(me,le,ae))}}})(),tt($===3*p*C),(()=>{for(let q=0;q<4;++q){const W=$;if(y[q])continue;const K=t.outerEdges[q],se=t.innerEdges[q];let ae=0,le=0;const me=K.count,ne=se.count;tt(ne===a-1);let pe=0;const ge=q===1||q===2?(ve,Se,ee)=>j(ve,Se,ee):(ve,Se,ee)=>j(ve,ee,Se);for(;ae<me-1||le<ne-1;){const ve=se.getVertexIndex(le),Se=K.getVertexIndex(ae),ee=ae<me-1,re=le<ne-1;ee&&(!re||(ee?0+a*(ae+.5)/(me-1):0)<=(re?1+z*(le+.5)/(ne-1):0))?(++ae,Ks&&tt(ae<me),ge(ve,Se,K.getVertexIndex(ae)),pe++):(++le,Ks&&tt(le<ne),ge(ve,Se,se.getVertexIndex(le)),pe++)}Ks&&(tt(ae===me-1),tt(le===ne-1),tt(pe===me+ne-2),tt(pe===a-2+K.count-1),tt($===W+3*pe*C))}})(),tt($===3*(p+b)*C);const G=q=>{const W=t.outerEdges[q.connectedOuterEdgeOffset];let K=W.getVertexIndex(0),se=W.stride;for(let ae=0;ae<q.latitudeResolution;++ae){const le=ae===0?q.rowOffset:K+e;for(let me=0;me<a;me++)j(K,K+1,le+me),ae<q.latitudeResolution-1&&j(K+1,le+me+1,le+me),K+=se;K=le,se=1}};i.forEach(G)}else{(()=>{const G=Math.max(n[0],1)-1,q=Math.min(n[1],e-2)-1,W=Math.max(r[0],1)-1,K=Math.min(r[1],e-2)-1;for(let se=G;se<q;++se){const ae=se*N;for(let le=W;le<K;++le){const me=ae+le,ne=me+1,pe=ne+N,ge=pe-1,ve=t.vertexAttributes.position.typedBuffer,Se=t.vertexAttributes.position.typedBufferStride;U(me,ne,pe,ge,Se,ve)?(P[$]=me,P[$+1]=ne,P[$+2]=pe,P[$+3]=pe,P[$+4]=ge,P[$+5]=me):(P[$]=me,P[$+1]=ne,P[$+2]=ge,P[$+3]=ge,P[$+4]=ne,P[$+5]=pe),$+=6}}})(),tt($===3*p*C),(()=>{for(let G=0;G<4;++G){if(y[G])continue;const q=t.outerEdges[G],W=t.innerEdges[G];let K=0,se=0;const ae=q.count,le=W.count;tt(le===a-1);const me=G===1||G===2,ne=me?1:2,pe=me?2:1,ge=q.index0,ve=q.stride,Se=W.index0,ee=W.stride;for(;K<ae-1||se<le-1;){const re=Se+se*ee,fe=ge+K*ve,ye=K<ae-1,we=se<le-1,Ae=ye&&(!we||(ye?0+a*(K+.5)/(ae-1):0)<=(we?1+z*(se+.5)/(le-1):0));Ae?++K:++se;const Oe=Ae?fe+ve:re+ee;P[$]=re,P[$+ne]=fe,P[$+pe]=Oe,$+=3}}})(),tt($===3*(p+b)*C);const j=G=>{const q=t.outerEdges[G.connectedOuterEdgeOffset];let W=q.getVertexIndex(0),K=q.stride;for(let se=0;se<G.latitudeResolution;++se){const ae=se===0?G.rowOffset:W+e;for(let le=0;le<a;le++){const me=ae+le;P[$]=W,P[$+1]=W+1,P[$+2]=me,se<G.latitudeResolution-1?(P[$+3]=W+1,P[$+4]=me+1,P[$+5]=me,$+=6):$+=3,W+=K}W=ae,K=1}};i.forEach(j)}tt($===O),t.indices=P,t.indexCount=O}function r4e(t,e){const i=t.localOrigin,r=t.geometry,n=t.geometryState.neighborData.edgeResolutions,s=r.numVerticesPerSide-2,a=r.vertexAttributes;let u=e;for(let p=0;p<4;++p){{const y=p===0||p===2,b=(p===0?s-1:0)*s+(p===1?s-1:0),S=(y?0:1)*s+(y?1:0);r.innerEdges[p]=new Tue(a,i,b,S,s)}{const y=u,b=n[p]+1;r.outerEdges[p]=new Tue(a,i,y,1,b),u+=b}}}function n4e(t,e,i){const r=(e+2)%4,n=t.geometryState,s=t.tile,a=n.neighborData,u=s.level-i.level,p=e===1||e===3,y=a.edgeResolutions[e];tt(G2(y));const b=y+1,S=t.geometry,C=S.boundingBox,O=S.outerEdges[e],P=S.uvRange[0],$=S.uvRange[1],N=S.uvRange[2],z=S.uvRange[3],U=Je(e===1?1:0,P,N),j=Je(e===0?1:0,$,z),G=i.renderData,q=G.geometryState,W=G.geometry.outerEdges[r],K=s.getNeighborEdgeStartVertexIndex(e,i)*y,se=y*2**u;tt(q.neighborData.edgeResolutions[r]===se),tt(W.count-1===se);const ae=G.localOrigin[0]-t.localOrigin[0],le=G.localOrigin[1]-t.localOrigin[1],me=G.localOrigin[2]-t.localOrigin[2],ne=O.attributes,pe=O.index0,ge=O.stride,ve=ne.position.typedBuffer,Se=ne.position.typedBufferStride,ee=ne.normalCompressed.typedBuffer,re=ne.normalCompressed.typedBufferStride,fe=ne.uv0,ye=W.attributes,we=W.index0,Ae=W.stride,Oe=ye.position.typedBuffer,Ve=ye.position.typedBufferStride,at=ye.normalCompressed.typedBuffer,Xt=ye.normalCompressed.typedBufferStride;for(let ti=1;ti<b-1;++ti){const Vt=pe+ge*ti,Qt=we+Ae*(K+ti),St=Vt*Se,ze=Qt*Ve,ni=Oe[ze]+ae,Ye=Oe[ze+1]+le,gt=Oe[ze+2]+me;ve[St]=ni,ve[St+1]=Ye,ve[St+2]=gt,Yh(ni,Ye,gt,C);const Nt=Vt*re,Jt=Qt*Xt;ee[Nt]=at[Jt],ee[Nt+1]=at[Jt+1];const Tt=ti/y,Q=p?U:Je(Tt,P,N),pt=p?Je(Tt,$,z):j;Rp(fe,Vt,Q,pt)}}function s4e(t){const e=t.geometryState,i=e.neighborData,r=t.localOrigin,n=i.cornerNeighborData,s=t.geometry,a=s.outerEdges,u=s.boundingBox,p=t.tile,y=t.tile.surface.view?.viewingMode==="local",b=p.ellipsoid.radius,S=p.extentInRadians,C=p.horizontalScale;let O=0,P=0,$=0;const N=(ze,ni,Ye)=>{const gt=S[ni===0?1:3],Nt=S[ze===0?0:2],Jt=Math.cos(gt),Tt=Math.sin(gt),Q=Math.sin(Nt),pt=Math.cos(Nt),ii=b+Ye;O=pt*Jt*ii,P=Q*Jt*ii,$=Tt*ii},z=y?(()=>{const ze=t.geometryState.clippingArea,ni=p.extent,Ye=ze!=null&&(ni[3]>ze[3]||ni[2]>ze[2]||ni[1]<ze[1]||ni[0]<ze[0]),gt=t4e(p.surface.isWebMercatorOnPlateeCarree,p.ellipsoid.radius,C);return(Nt,Jt,Tt)=>{const Q=Nt===0?pe[0]:pe[2],pt=Jt===0?pe[1]:pe[3],ii=Ye?Je(Q,ze[0],ze[2]):Q,bt=Ye?Je(pt,ze[1],ze[3]):pt,ci=Tt;O=ii*C,P=gt(bt),$=ci}})():N;let U=0,j=0,G=0,q=0,W=0,K=0,se=0,ae=0,le=0;const me=y&&t.tile.surface.isWebMercatorOnPlateeCarree,ne=(ze,ni,Ye,gt,Nt)=>{let Jt=0,Tt=0,Q=0;if(y){const pt=ni*C,ii=me?(Math.PI/2-2*Math.atan(Math.exp(-Ye/b)))*b:Ye*C;Jt=pt-O,Tt=ii-P,Q=gt-$}else{const pt=vee(ze),ii=ze.tile,bt=ii.extent,ci=ii.extentInRadians,Ot=(ni-bt[0])/(bt[2]-bt[0]),It=(Ye-bt[1])/(bt[3]-bt[1]),Rt=ci[0]*(1-Ot)+ci[2]*Ot,pi=pt(It),Ti=Math.cos(pi),Dr=Math.sin(pi),tr=Math.sin(Rt),je=Math.cos(Rt),Bi=b+gt;Jt=je*Ti*Bi-O,Tt=tr*Ti*Bi-P,Q=Dr*Bi-$}switch(Nt){case 0:se+=Jt,ae+=Tt,le+=Q;break;case 1:q-=Jt,W-=Tt,K-=Q;break;case 2:se-=Jt,ae-=Tt,le-=Q;break;case 3:q+=Jt,W+=Tt,K+=Q}},pe=p.extent,ge=e.clippingArea??_ee,ve=pe[0],Se=pe[2],ee=pe[1],re=pe[3],fe=[re>ge[3],Se>ge[2],ee<ge[1],ve<ge[0]],ye=Math.max(ve,ge[0]),we=Math.min(Se,ge[2]),Ae=Math.max(ee,ge[1]),Oe=Math.min(re,ge[3]),Ve=ze=>Math.max(ge[0],Math.min(ge[2],ze)),at=ze=>Math.max(ge[1],Math.min(ge[3],ze)),Xt=s.uvRange[0],ti=s.uvRange[1],Vt=s.uvRange[2],Qt=s.uvRange[3],St=ze=>{const ni=n[ze].cornerTiles;U=0,j=0,G=1,q=0,W=0,K=0,se=0,ae=0,le=0;let Ye=1/0;for(let pt=0;pt<4;++pt)Ye=Math.min(Ye,ni[pt]?.level??1/0);for(let pt=0;pt<4;++pt){const ii=ni[pt];NC[pt]=ii?.level===Ye?ii:null}let gt=1,Nt=0;for(let pt=0;pt<4;++pt){const ii=NC[pt];ii&&(gt=Math.max(gt,ii?.renderData.geometryState.numVerticesPerSide),Nt=ii.extent[2]-ii.extent[0])}const Jt=Nt,Tt=gt;tt(Tt>1);const Q=Jt/Tt;for(let pt=0;pt<4;++pt){const ii=NC[(pt+3)%4],bt=NC[pt%4];if(!ii&&!bt)continue;const ci=pt===0?1:pt===1?2:pt===2?3:0,Ot=pt===0?2:pt===1?3:pt===2?0:1;if(ii&&bt){const It=sU[pt][0]*Q,Rt=sU[pt][1]*Q,pi=ii.extent,Ti=Ve(pi[ci===0||ci===1?2:0]+It),Dr=at(pi[ci===0||ci===3?3:1]+Rt),tr=bt.extent,je=Ve(tr[Ot===0||Ot===1?2:0]+It),Bi=at(tr[Ot===0||Ot===3?3:1]+Rt),f=ii.renderData,L=bt.renderData,x=Ln(Ti,Dr,f.geometryState.samplerData),d=Ln(je,Bi,L.geometryState.samplerData);ne(f,Ti,Dr,.5*(x+d),pt)}else{const It=ii??bt,Rt=ii?ci:Ot,pi=It.extent,Ti=sU[pt],Dr=Ve(pi[Rt===0||Rt===1?2:0]+Ti[0]*Q),tr=at(pi[Rt===0||Rt===3?3:1]+Ti[1]*Q),je=It.renderData,Bi=Ln(Dr,tr,je.geometryState.samplerData);ne(je,Dr,tr,Bi,pt)}}if(!y){const pt=Math.sqrt(O*O+P*P+$*$);U=O/pt,j=P/pt,G=$/pt}if(y||G*G<.999){const pt=Math.sqrt(q*q+W*W+K*K);q/=pt,W/=pt,K/=pt;const ii=Math.sqrt(se*se+ae*ae+le*le);se/=ii,ae/=ii,le/=ii,U=K*ae-W*le,j=q*le-K*se,G=W*se-q*ae;const bt=1/Math.sqrt(U*U+j*j+G*G);U*=bt,j*=bt,G*=bt}};for(let ze=0;ze<4;++ze){const ni=ze,Ye=(ze+1)%4,gt=ze===0||ze===1?1:0,Nt=ze===0||ze===3?1:0,Jt=Je(gt,Xt,Vt),Tt=Je(Nt,ti,Qt),Q=a[ni],pt=ze===0||ze===3?Q.count-1:0,ii=a[Ye],bt=ze===0||ze===1?ii.count-1:0,ci=n[ze].cornerTiles;let Ot=-1;for(let pi=0;pi<4;++pi){const Ti=ci[pi];Ti&&(Ot===-1||_g(ci[Ot],Ti)>0)&&(Ot=pi)}const It=Ot,Rt=ci[It];if(Rt!==p){const pi=p.level-Rt.level,Ti=2**pi,Dr=[Rt.lij[0]+pi,Rt.lij[1]*Ti,Rt.lij[2]*Ti],tr=[Dr[1]+Ti===p.lij[1],ze===0&&(It===1||It===0&&Rt!==ci[3])||ze===1&&(It===0||It===1&&Rt!==ci[2]),Dr[1]===p.lij[1]+1,ze===2&&(It===3||It===2&&Rt!==ci[1])||ze===3&&(It===2||It===3&&Rt!==ci[0])],je=tr.reduce((d,c)=>d+(c?1:0),0);tt(je===1||je===2);let Bi=-1,f=-1;const L=Rt.renderData;if(je===1){const d=tr.findIndex(o=>o);tt(0<=d&&d<=3),Bi=(d+2)%4;const c=t.geometryState.neighborData.edgeResolutions[d];f=p.getNeighborEdgeStartVertexIndex(d,Rt)*c+c*(d===0&&ze===0||d===1&&ze===0||d===2&&ze===1||d===3&&ze===3?1:0)}else{tt(tr[1]||tr[3]),Bi=tr[1]?3:1;const d=L.geometryState.neighborData.edgeResolutions[Bi];f=ze===0||ze===3?0:d}const x=L.geometry.outerEdges[Bi];{const d=Q.index0+pt*Q.stride,c=ii.index0+bt*ii.stride,o=x.index0+f*x.stride;{const l=x.attributes.position,h=l.typedBuffer,m=o*l.typedBufferStride,g=t.localOrigin,v=x.localOrigin,w=h[m]+v[0]-g[0],E=h[m+1]+v[1]-g[1],A=h[m+2]+v[2]-g[2];Yh(w,E,A,u);{const M=Q.attributes.position,I=M.typedBuffer,D=d*M.typedBufferStride;I[D]=w,I[D+1]=E,I[D+2]=A}{const M=ii.attributes.position,I=M.typedBuffer,D=c*M.typedBufferStride;I[D]=w,I[D+1]=E,I[D+2]=A}}Rp(Q.attributes.uv0,d,Jt,Tt),Rp(ii.attributes.uv0,c,Jt,Tt);{const l=x.attributes.normalCompressed.typedBuffer,h=o*x.attributes.normalCompressed.typedBufferStride;{const m=Q.attributes.normalCompressed,g=m.typedBuffer,v=d*m.typedBufferStride;g[v]=l[h],g[v+1]=l[h+1]}{const m=ii.attributes.normalCompressed,g=m.typedBuffer,v=c*m.typedBufferStride;g[v]=l[h],g[v+1]=l[h+1]}}}}else{const pi=fe[ni],Ti=fe[Ye];let Dr;if(pi||Ti){const f=Je(ve*(1-gt)+Se*gt,ye,we),L=Je(ee*(1-Nt)+re*Nt,Ae,Oe),x=e.samplerData;Dr=Ln(f,L,x)}else Dr=L1t(ci);z(gt,Nt,Dr),St(ze);const tr=O-r[0],je=P-r[1],Bi=$-r[2];Yh(tr,je,Bi,u),Q.setVertexFromValuesRawPositionUVNormal(pt,tr,je,Bi,Jt,Tt,U,j,G),ii.setVertexFromValuesRawPositionUVNormal(bt,tr,je,Bi,Jt,Tt,U,j,G)}}for(let ze=0;ze<4;++ze)NC[ze]=null}function L1t(t){const e=t.reduce((s,a)=>Math.min(s,a?.level??1/0),1/0);Ks&&(tt(!t[0]||!t[2]||Jq(t[0],t[2],Ht.SOUTH_WEST)),tt(!t[1]||!t[3]||Jq(t[1],t[3],Ht.NORTH_WEST)));let i=0,r=0;for(let s=0;s<4;++s){const a=t[s];if(a&&a.level===e){const u=s===0||s===1,p=s===0||s===3,y=a.extent,b=y[u?0:2],S=y[p?1:3],C=a.renderData?.geometryState?.samplerData;r+=Ln(b,S,C),i++}}const n=i?r/i:0;return tt(n!=null),n}function ON(t){const e=t.vao,i=t.geometry.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(i,0,0,i.length)}const sU=[[0,1],[1,0],[0,-1],[-1,0]],Vo=new Cgt,_ee=nY(-1/0,-1/0,1/0,1/0),NC=[null,null,null,null];function o4e(t,e,i){if(!e)return!1;const r=_g(t,e);return r>0||r===0&&i>=2}let D1t=class extends mee{constructor(e,i,r,n,s){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Di(),this._baseUsedMemory=900,this.init(e,i,r,n,s)}init(e,i,r,n,s){super.init(e,i,r,n,s);const a=s.view.renderSpatialReference,u=s.spatialReference,p=a!=null&&NJ(a)&&u!=null&&u.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=p;const y=this.surface.isWebMercatorOnPlateeCarree,b=this._extentInRenderSR,S=this.extent;if(y){const C=st(S[0],S[1],0);va(C,dt.WebMercator,C,dt.PlateCarree);const O=st(S[2],S[3],0);va(O,dt.WebMercator,O,dt.PlateCarree),b[0]=C[0],b[1]=C[1],b[2]=O[0],b[3]=O[1]}else for(let C=0;C<4;++C)b[C]=S[C]*p;this.centerAtSeaLevel[0]=.5*(b[0]+b[2]),this.centerAtSeaLevel[1]=.5*(b[1]+b[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(b[2]-b[0],b[3]-b[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),n=Math.sqrt(i*i+r*r),s=.5*(this.elevationBounds[0]-this.elevationBounds[1]),a=Math.max(n,s);this._center[Ts.MIDDLE][3]=a}_calculateFrustumVisibilityStatus(e){const i=this._aabb(),r=i[0],n=i[1],s=i[2],a=i[3],u=i[4],p=i[5];let y=!0;for(let b=0;b<6;b++){const S=e[b],C=S[0],O=S[1],P=S[2],$=S[3];if(C*(C>0?r:a)+O*(O>0?n:u)+P*(P>0?s:p)+$>=0)return Pa.OUTSIDE;y=y&&C*(C<0?r:a)+O*(O<0?n:u)+P*(P<0?s:p)+$<=0}return y?Pa.INSIDE:Pa.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return qUe(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,i,r,n){return x9[0]=1/i[0],x9[1]=1/i[1],x9[2]=1/i[2],XK(this._aabb(),e,x9,r,n)}createGeometry(){O1t(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){M1t(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){P1t(this.renderData,this._horizontalScaleFactor)}get horizontalScale(){return this._horizontalScaleFactor}};const x9=H();let N1t=class{constructor(){this.extent=ji(),this.minLevel=0,this.maxLevel=0,this.callback=null}},H$=class extends Ke{constructor(){super(...arguments),this._queries=new xi({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new xi({initialSize:30}),this._queryPool=new Ua(N1t)}queryVisibleLevelRange(e,i,r,n){const s=this._queryPool.acquire();mp(s.extent,e),s.minLevel=i??-Number.MAX_VALUE,s.maxLevel=r??Number.MAX_VALUE,s.callback=n,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const n=this._queries.data[r],s=n.extent;i>=n.minLevel&&i<=n.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};_([T()],H$.prototype,"updating",null),H$=_([Z("esri.views.3d.terrain.ScaleRangeQueries")],H$);function F1t(t,e,i,r){const n=Math.cos(i);t[0]=Math.cos(e)*n*r,t[1]=Math.sin(e)*n*r,t[2]=Math.sin(i)*r}let k1t=class extends mee{constructor(e,i,r,n,s){super(),this._convexHull=new Array(24),this._boundingSphere=as(),this._baseUsedMemory=1816,this.init(e,i,r,n,s)}init(e,i,r,n,s){super.init(e,i,r,n,s);const a=this.ellipsoid.radius,u=this.extentInRadians[0],p=this.extentInRadians[1],y=this.extentInRadians[2],b=this.extentInRadians[3],S=si(p,b,.5),C=si(u,y,.5),O=e===0?0:Math.min(Math.abs(p),Math.abs(b));this._edgeLen=(y-u)*Math.cos(O)*a,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=a-Math.sqrt(a*a-this._edgeLen2/4),F1t(this.centerAtSeaLevel,C,S,this.ellipsoid.radius),We(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)$e(e[Ts.MIDDLE],0,0,0),$e(e[Ts.TOP],0,0,0),$e(e[Ts.BOTTOM],0,0,0),e[Ts.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const i=e[Ts.MIDDLE],r=this.convexHull;let n=0;for(let s=0;s<8;++s)n=Math.max(n,z1t(i,r,3*s));e[Ts.MIDDLE][3]=Math.sqrt(n)}}_calculateFrustumVisibilityStatus(e){if(!By(e,this._boundingSphere))return Pa.OUTSIDE;if(this.lij[0]<10)return Pa.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let n=!0;for(let s=0;s<TE;s++){const a=s===en.NEAR,u=e[s],p=u[0],y=u[1],b=u[2],S=u[3]-(a?r:0);let C=!1;for(let O=0;O<8;++O){const P=3*O;if(p*i[P]+y*i[P+1]+b*i[P+2]+S<0){if(C=!0,!n)break}else n=!1}if(!C)return Pa.OUTSIDE}return n?Pa.INSIDE:Pa.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){x1t(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Ks&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=e,r=this.elevationBounds,n=this.ellipsoid.radius,s=r[1];if(this.level===0)$e(i,0,0,0),e[3]=n+s;else{const a=this.extentInRadians,u=.5*(a[0]+a[2]),p=a[1],y=a[3];E_(kue,u,p,n),E_(zue,u,y,n),Ue(i,kue,zue);const b=.5*(r[0]+r[1]);Pe(i,i,(n+b)/Sc(i));const S=this.convexHull;let C=0;const O=($,N)=>{const z=$[0]-S[3*N],U=$[1]-S[3*N+1],j=$[2]-S[3*N+2];return Math.sqrt(z*z+U*U+j*j)};for(let $=0;$<8;++$){const N=O(i,$);C=Math.max(C,N)}const P=C;e[3]=P+2}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBounds,n=this._getPatchType(),s=this.surface.isWebMercator,a=s&&n===zh.HAS_NORTH_POLE,u=s&&n===zh.HAS_SOUTH_POLE,p=u||a,y=Math.PI/2,b=e[0],S=e[2],C=u?-y:e[1],O=a?y:e[3],P=.5*(b+S),$=r[0],N=i+(p?Math.min(0,$-1):$),z=(Se,ee,re)=>E_(Se,ee,re,N),U=H(),j=H(),G=H(),q=H();z(U,b,C),z(j,b,O),z(G,S,O),z(q,S,C);const W=(Se,ee)=>{for(let re=0;re<3;++re)this._convexHull[3*ee+re]=Se[re]};W(U,0),W(j,1),W(G,2),W(q,3);const K=r[1],se=i+(p?Math.max(0,K+1):K),ae=H(),le=H(),me=H();E_(le,P,O,N),E_(me,P,C,N),Ue(ae,le,me),We(ae,ae);const ne=H(),pe=H(),ge=(Se,ee)=>{Ao(pe,Se,ee),We(pe,pe);const re=-He(Se,ne)/He(pe,ne);tt(re>=0),Pe(pe,pe,re),Ue(Se,Se,pe)};if(2**this.lij[0]>2*this.lij[1]){const Se=me,ee=H();qt(ee,Fue,Se),We(ee,ee),qt(ne,Se,ee),We(ne,ne),tt(Uh(He(ne,Se)/Sc(Se),0)),ge(U,j),ge(q,G),W(U,0),W(q,3)}else if(2**this.lij[0]!==2*this.lij[1]){const Se=le,ee=H();qt(ee,Fue,Se),We(ee,ee),qt(ne,ee,Se),We(ne,ne),ge(j,U),ge(G,q),W(j,1),W(G,2)}const ve=(Se,ee)=>{const re=se/He(ee,ae);for(let fe=0;fe<3;++fe)this._convexHull[3*Se+fe]=ee[fe]*re};ve(4,U),ve(5,j),ve(6,G),ve(7,q)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?zh.HAS_BOTH_POLES:zh.HAS_NORTH_POLE:r?zh.HAS_SOUTH_POLE:zh.REGULAR}intersectsRay(e,i,r,n){const s=this._boundingSphere,a=s[3]+r,u=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],p=s[0]-e[0],y=s[1]-e[1],b=s[2]-e[2],S=(p*i[0]+y*i[1]+b*i[2])/u,C=i[0]*S-p,O=i[1]*S-y,P=i[2]*S-b;return C*C+O*O+P*P<a*a}getDefaultVerticesPerSide(){return this.level<Nue.length?Nue[this.level]+1:2}updateCornerElevations(){E1t(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){S1t(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!Ks||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=e,n=H(),s=this.ellipsoid.radius,a=this.elevationBounds;a[1],a[0];const u=s+a[0],p=1,y=0,b=this._center[Ts.MIDDLE][3],S=this.convexHull,C=(Ye,gt)=>{for(let Nt=0;Nt<3;++Nt)Ye[Nt]=S[3*gt+Nt]};{const Ye=H(),gt=H(),Nt=H(),Jt=H(),Tt=H(),Q=(pt,ii,bt,ci)=>{C(gt,pt),C(Nt,ii),C(Jt,bt),Ao(gt,gt,Nt),Ao(Jt,Jt,Nt),qt(Ye,gt,Jt),We(Ye,Ye);const Ot=He(Ye,Nt);C(Tt,ci);const It=He(Ye,Tt),Rt=Math.abs(It-Ot);tt(Uh(Rt,0),`Non coplanar ${pt},${ii},${bt},${ci} diff = ${Rt}`)};Q(0,1,2,3),Q(4,5,6,7),Q(0,1,4,5),Q(1,2,5,6),Q(2,3,6,7),Q(3,0,7,4)}const O=Ro(24),P=(Ye,gt,Nt)=>{const Jt=4*Ye;for(let Tt=0;Tt<3;++Tt)O[Jt+Tt]=gt[Tt];O[Jt+3]=Nt},$=H(),N=H(),z=H(),U=H(),j=(Ye,gt,Nt,Jt)=>{C($,gt),C(N,Nt),C(z,Jt),Ao($,$,N),We($,$),Ao(z,z,N),We(z,z),qt(U,$,z),We(U,U);const Tt=He(U,N);P(Ye,U,Tt)};j(0,0,1,2),j(1,1,0,4),j(2,1,5,2),j(3,3,2,6),j(4,4,0,3),j(5,4,6,5);const G=1,q=(Ye,gt,Nt,Jt)=>{const Tt=4*Ye;return O[Tt]*gt+O[Tt+1]*Nt+O[Tt+2]*Jt-O[Tt+3]},W=(Ye,gt,Nt,Jt)=>q(Ye,gt,Nt,Jt)>=-G,K=(Ye,gt)=>W(Ye,gt[0],gt[1],gt[2]),se=2**this.lij[0]>2*this.lij[1],ae=(Ye,gt,Nt)=>Math.sqrt(a4e(Ye,gt,Nt,r[0],r[1],r[2]))<i,le=Ye=>ae(Ye[0],Ye[1],Ye[2]),me=(Ye,gt)=>ae(Ye[gt],Ye[gt+1],Ye[gt+2]),ne=this.extentInRadians,pe=.5*(ne[0]+ne[2]),ge=ne[1],ve=ne[3],Se=H(),ee=H();E_(Se,pe,ve,u),E_(ee,pe,ge,u);const re=se?"Upper":"Lower";let fe=!0;for(let Ye=0;Ye<6;++Ye){for(let gt=0;gt<8;++gt){const Nt=3*gt,Jt=W(Ye,S[Nt],S[Nt+1],S[Nt+2]);fe&&(fe=Jt),tt(Jt,`Tile[${this.lij}] Convex hull point ${gt} outside of plane ${Ye}`)}tt(K(Ye,ee),`Tile[${this.lij}] (${re}) bottom mid outside of plane ${Ye}`),tt(K(Ye,Se),`Tile[${this.lij}] (${re}) top mid outside of plane ${Ye}`)}tt(fe,"Not all convex hull points are inside  convex hull polyhedron"),tt(le(ee),`Tile[${this.lij}] (${re}) bottom mid outside of bounding sphere`),tt(le(Se),`Tile[${this.lij}] (${re}) top mid outside of bounding sphere`);for(let Ye=0;Ye<8;++Ye){const gt=me(S,3*Ye);tt(gt,`Tile[${this.lij}] Convex hull point ${Ye} outside of bounding sphere`)}for(let Ye=0;Ye<6;++Ye)for(let gt=0;gt<8;++gt){const Nt=3*gt;W(Ye,S[Nt],S[Nt+1],S[Nt+2])||console.error(`Tile[${this.lij}] Convex hull point ${gt} outside of plane ${Ye}`)}const ye=this.extentInRadians,we=Math.max(ye[2]-ye[0],ye[3]-ye[1]),Ae=Math.round(we*s),Oe=this.renderData;if(!Oe)return;const{geometry:Ve,localOrigin:at}=Oe,Xt=Ve.vertexAttributes?.position;if(!Xt)return;const ti=Xt.count,Vt=H(),Qt=Ve.numVerticesPerSide-2,St=Qt*Qt,ze=Oe.geometryState.neighborData,ni=ze.edgeResolutions.reduce((Ye,gt)=>Ye+gt+1,0);for(let Ye=0;Ye<ti;++Ye){const gt=Ye<St,Nt=!gt&&Ye<St+ni;let Jt=!1,Tt=-1;if(Nt){let je=St;for(let Bi=0;Bi<4;++Bi){const f=ze.edgeResolutions[Bi];if(Ye===je||Ye===je+f-1){Jt=!0;break}if(je+=f,Ye<je){Tt=Bi;break}}}const Q=Nt?ze.edgePeerNeighbors[Tt]:null,pt=Nt&&Q&&_g(this,Q)>0;Xt.getVec(Ye,n),Ue(Vt,n,at);const ii=Sc(Vt)-s;let bt=0,ci=!1;const Ot=a[0]-ii,It=ii-a[1],Rt=Ot>p,pi=It>p,Ti=Rt||pi,Dr=()=>{const je=gt?"internal":Nt&&!Jt?"edge":Jt?"corner":"pole";return`Tile[${this.lij}].vertex[${Ye}]:${je}`+(Rt?"(below)":pi?"(above)":"")+(pt?"(Neighbor)":"")},tr=WO(Vt,r);if(tr>=i+y){const je=tr-i;Ti||(console.error(`${Dr()} is out of the bounding sphere by ${je.toFixed(0)} / ${i.toFixed(0)}[tol=${y}] h=${ii.toFixed(0)} / [${a[0].toFixed(0)}..${a[1].toFixed(0)}] (${(je/i).toFixed(0)})`),ci=!0)}for(let je=0;je<6;++je)if(!W(je,Vt[0],Vt[1],Vt[2])){const Bi=q(je,Vt[0],Vt[1],Vt[2]),f=Ye%Qt,L=(Ye-f)/Qt;je===0&&Ot||je===5&&It||(console.error(`${Dr()} (${f},${L})|${Qt}] is out of the bounding trapezoid plane ${je} h=${Math.round(ii)} / [${Math.round(a[0])}..${Math.round(a[1])}] dist=${Math.round(Bi)} radii = ${Math.round(i)}/${Math.round(b)}} : maxL = ${Ae}`),++bt)}if(ci||bt>0)break}}get convexHull(){return this._convexHull}};const Nue=[128,64,64,32,16,8,8,4];function z1t(t,e,i){return a4e(t[0],t[1],t[2],e[i],e[i+1],e[i+2])}function a4e(t,e,i,r,n,s){const a=r-t,u=n-e,p=s-i;return a*a+u*u+p*p}const E_=(t,e,i,r)=>{const n=Math.cos(e),s=Math.sin(e),a=Math.cos(i),u=Math.sin(i);t[0]=r*a*n,t[1]=r*a*s,t[2]=r*u},Fue=[0,0,1],kue=H(),zue=H();let Gd=class extends Ke{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};_([T()],Gd.prototype,"fovX",void 0),_([T()],Gd.prototype,"fovY",void 0),_([T()],Gd.prototype,"relativeWidthLimit",void 0),_([T()],Gd.prototype,"relativeHeightLimit",void 0),_([T()],Gd.prototype,"maxLod",void 0),_([T()],Gd.prototype,"angledSplitBias",void 0),_([T()],Gd.prototype,"aboveGround",void 0),_([T()],Gd.prototype,"frustum",void 0),Gd=_([Z("esri.views.3d.terrain.SplitLimits")],Gd);const U1t=wn().vec3f(X.POSITION).vec2i16(X.UV0).vec2i16(X.NORMALCOMPRESSED,{glNormalized:!0});let j1t=class{constructor(e){this._storage=new uR((i,r)=>e.newCache(i,r),"TileGeometry")}acquire(e){const r=Math.ceil(e/4)*4,n=this._storage.pop(Uue(r));if(n)return n;const s=U1t.createBuffer(r);return s.release=()=>this._release(s),s}_release(e){const i=e.count;this._storage.put(Uue(i),e)}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function Uue(t){return t.toString()}let l4e=class extends rc{constructor(){super(...arguments),this.blendMode=ut.Normal}};_([ce({count:ut.COUNT})],l4e.prototype,"blendMode",void 0);let _4=class extends l4e{constructor(){super(...arguments),this.output=Rs.Composite,this.baseOpacityMode=ku.NotRequired,this.premultipliedSource=ap.Off}};_([ce({count:Rs.COUNT})],_4.prototype,"output",void 0),_([ce({count:ku.COUNT})],_4.prototype,"baseOpacityMode",void 0),_([ce()],_4.prototype,"premultipliedSource",void 0);var uw;function B1t(t){const e=new lr;if(e.include(BAe),t.background===uw.Only){const i=t.output===Rs.ColorComposite;return i?e.fragment.uniforms.add(new _i("backgroundColor",r=>r.backgroundColor)):e.fragment.include(fee),e.fragment.code.add(F`
    void main() {
      fragColor = vec4(${i?F`backgroundColor`:F`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(VAe,t),e.fragment.uniforms.add(new kt("tex",i=>i.texture)),e.fragment.uniforms.add(new lt("opacity",i=>i.opacity)),e.fragment.code.add(F`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(uw||(uw={}));const V1t=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return uw},build:B1t},Symbol.toStringTag,{value:"Module"}));let G1t=class extends jAe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Mo}},c4e=class u4e extends wr{initializeProgram(e){return new fr(e.rctx,u4e.shader.get().build(this.configuration),ar)}initializePipeline(){return mi({blending:Xc(et.ONE,et.ONE_MINUS_SRC_ALPHA),colorWrite:Oi})}};c4e.shader=new pr(V1t,()=>ke(()=>import("./BlendLayers.glsl-a57c9ee9.js"),[],import.meta.url));let h4e=class extends _4{constructor(){super(...arguments),this.background=uw.BelowLayer}};_([ce()],h4e.prototype,"background",void 0);let oU=class{constructor(e,i,r,n,s,a){this.texture=e,this.type=i,e.retain(),this.offsetAndScale=vi(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=st(n,s,a)}destroy(){this.texture.release()}};function I1(t,e){return[t,e]}function C_(t,e,i){return t[0]=e,t[1]=i,t}function H1t(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}const Od=new lw("0/0/0/0");let q1t=class d4e{static create(e,i,r=null){const n=Sp(e.spatialReference),s=i.origin||I1(e.origin.x,e.origin.y),a=I1(e.size[0]*i.resolution,e.size[1]*i.resolution),u=I1(-1/0,-1/0),p=I1(1/0,1/0),y=I1(1/0,1/0);r!=null&&(C_(u,Math.max(0,Math.floor((r.xmin-s[0])/a[0])),Math.max(0,Math.floor((s[1]-r.ymax)/a[1]))),C_(p,Math.max(0,Math.floor((r.xmax-s[0])/a[0])),Math.max(0,Math.floor((s[1]-r.ymin)/a[1]))),C_(y,p[0]-u[0]+1,p[1]-u[1]+1));const{cols:b,rows:S}=i;let C,O,P,$;return!r&&b&&S&&(C_(u,b[0],S[0]),C_(p,b[1],S[1]),C_(y,b[1]-b[0]+1,S[1]-S[0]+1)),e.isWrappable?(C=I1(Math.ceil(Math.round((n.valid[1]-n.valid[0])/i.resolution)/e.size[0]),y[1]),O=I1(Math.floor((n.origin[0]-s[0])/a[0]),u[1]),P=I1(C[0]+O[0]-1,p[1]),$=!0):(O=u,P=p,C=y,$=!1),new d4e(i.level,i.resolution,i.scale,s,u,p,y,a,O,P,C,$)}constructor(e,i,r,n,s,a,u,p,y,b,S,C){this.level=e,this.resolution=i,this.scale=r,this.origin=n,this.first=s,this.last=a,this.size=u,this.norm=p,this.worldStart=y,this.worldEnd=b,this.worldSize=S,this.wrap=C}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){Od.set(i);const n=r?Od.col:this.denormalizeCol(Od.col,Od.world),s=Od.row;return H1t(e,this.getXForColumn(n),this.getYForRow(s+1),this.getXForColumn(n+1),this.getYForRow(s)),e}getTileCoords(e,i,r=!1){Od.set(i);const n=r?Od.col:this.denormalizeCol(Od.col,Od.world);return Array.isArray(e)?C_(e,this.getXForColumn(n),this.getYForRow(Od.row)):(e.x=this.getXForColumn(n),e.y=this.getYForRow(Od.row)),e}},Yq=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}forEach(e,i){const{spans:r,lodInfo:n}=this,{level:s}=n;if(r.length!==0)for(const{row:a,colFrom:u,colTo:p}of r)for(let y=u;y<=p;y++)e.call(i,s,a,n.normalizeCol(y),n.getWorldForColumn(y))}};Yq.pool=new Ua(Yq);let aU=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const ls=new lw("0/0/0/0");let W1t=class p4e{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,n]=e,[s,a]=i,u=s-r,p=a-n,y=p!==0?u/p:0,b=(Math.ceil(n)-n)*y,S=(Math.floor(n)-n)*y;return new p4e(r,Math.floor(n),Math.ceil(a),y,u<0?b:S,u<0?S:b,u<0?s:r,u<0?r:s)}constructor(e,i,r,n,s,a,u,p){this.x=e,this.ymin=i,this.ymax=r,this.invM=n,this.leftAdjust=s,this.rightAdjust=a,this.leftBound=u,this.rightBound=p}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const au=[[0,0],[0,0],[0,0],[0,0]],X1t=1e-6;let rjt=class{constructor(e,i=null,r=e.lods[0].level,n=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const s=e.lods.filter(u=>u.level>=r&&u.level<=n);this.minScale=s[0].scale,this.maxScale=s[s.length-1].scale;const a=this._lodInfos=s.map(u=>q1t.create(e,u,i));s.forEach((u,p)=>{this._infoByLevel[u.level]=a[p],this._infoByScale[u.scale]=a[p],this.scales[p]=u.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){ls.set(i);const n=this._infoByLevel[ls.level];return n?n.getTileBounds(e,ls,r):e}getTileCoords(e,i,r=!1){ls.set(i);const n=this._infoByLevel[ls.level];return n?n.getTileCoords(e,ls,r):e}getTileCoverage(e,i=192,r=!0,n="closest"){if(!r&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const s=n==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),a=Yq.pool.acquire(s),u=this._wrap;let p,y,b,S=1/0,C=-1/0;const O=a.spans;au[0][0]=au[0][1]=au[1][1]=au[3][0]=-i,au[1][0]=au[2][0]=e.size[0]+i,au[2][1]=au[3][1]=e.size[1]+i;for(const z of au)e.toMap(z,z),z[0]=s.getColumnForX(z[0]),z[1]=s.getRowForY(z[1]);const P=[];let $=3;for(let z=0;z<4;z++){if(au[z][1]===au[$][1]){$=z;continue}const U=W1t.create(au[z],au[$]);S=Math.min(U.ymin,S),C=Math.max(U.ymax,C),P[U.ymin]===void 0&&(P[U.ymin]=[]),P[U.ymin].push(U),$=z}if(S==null||C==null||C-S>100)return null;let N=[];for(p=S;p<C;){P[p]!=null&&(N=N.concat(P[p])),y=1/0,b=-1/0;for(let z=N.length-1;z>=0;z--){const U=N[z];y=Math.min(y,U.getLeftCol()),b=Math.max(b,U.getRightCol())}if(y=Math.floor(y),b=Math.floor(b),p>=s.first[1]&&p<=s.last[1])if(u)if(s.size[0]<s.worldSize[0]){const z=Math.floor(b/s.worldSize[0]);for(let U=Math.floor(y/s.worldSize[0]);U<=z;U++)O.push(new aU(p,Math.max(s.getFirstColumnForWorld(U),y),Math.min(s.getLastColumnForWorld(U),b)))}else O.push(new aU(p,y,b));else y>s.last[0]||b<s.first[0]||(y=Math.max(y,s.first[0]),b=Math.min(b,s.last[0]),O.push(new aU(p,y,b)));p+=1;for(let z=N.length-1;z>=0;z--){const U=N[z];U.ymax>=p?U.incrRow():N.splice(z,1)}}return a}getTileParentId(e){ls.set(e);const i=this._infoByLevel[ls.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(ls,this._lodInfos[r],ls),ls.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){ls.set(i);const r=this._infoByLevel[ls.level],n=e.lodInfo;if(n.resolution>r.resolution){this._getTileIdAtLOD(ls,n,ls);const a=n.denormalizeCol(ls.col,ls.world);for(const u of e.spans)if(u.row===ls.row&&u.colFrom<=a&&u.colTo>=a)return!0}if(n.resolution<r.resolution){const[a,u,p,y]=e.spans.reduce(($,N)=>($[0]=Math.min($[0],N.row),$[1]=Math.max($[1],N.row),$[2]=Math.min($[2],N.colFrom),$[3]=Math.max($[3],N.colTo),$),[1/0,-1/0,1/0,-1/0]),b=r.denormalizeCol(ls.col,ls.world),S=n.getColumnForX(r.getXForColumn(b)),C=n.getRowForY(r.getYForRow(ls.row)),O=n.getColumnForX(r.getXForColumn(b+1))-1,P=n.getRowForY(r.getYForRow(ls.row+1))-1;return!(S>y||O<p||C>u||P<a)}const s=n.denormalizeCol(ls.col,ls.world);return e.spans.some(a=>a.row===ls.row&&a.colFrom<=s&&a.colTo>=s)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const n=Sp(this.tileInfo.spatialReference),s=-r*(n.valid[1]-n.valid[0]);e[0]+=s,e[2]+=s}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+X1t)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,n)=>Math.abs(n-e)<Math.abs(r-e)?n:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,i,r){const n=this._infoByLevel[r.level];return e.set(r),i.resolution<n.resolution?null:(i.resolution===n.resolution||(e.level=i.level,e.col=Math.floor(r.col*n.resolution/i.resolution+.01),e.row=Math.floor(r.row*n.resolution/i.resolution+.01)),e)}},lU=class{constructor(){this._map=new Map,this._observable=new VO}get size(){return di(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const i=this._map.delete(e);return i&&this._observable.notify(),i}entries(){return di(this._observable),this._map.entries()}forEach(e,i){di(this._observable),this._map.forEach((r,n)=>e.call(i,r,n,this),i)}get(e){return di(this._observable),this._map.get(e)}has(e){return di(this._observable),this._map.has(e)}keys(){return di(this._observable),this._map.keys()}set(e,i){return this._map.set(e,i),this._observable.notify(),this}values(){return di(this._observable),this._map.values()}[Symbol.iterator](){return di(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}},J1t=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},Y1t=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new lU,this._controllers=new lU,this._processingItems=new lU,this._pausedSignal=xS(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new SL(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&i&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=nn(this._schedule),this._task=nn(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const n=new AbortController;let s=null;i&&(s=qs(i,()=>n.abort()));const a=()=>{const b=this._processingItems.get(e);b&&b.controller.abort(),u(),y.reject(or())},u=()=>{p.remove(),s?.remove(),this._deferreds.delete(e),this._controllers.delete(e),this._queue.remove(e),this._processingItems.delete(e),this._scheduleNext()},p=kO(n.signal,a),y=Ys();return this._deferreds.set(e,y),this._controllers.set(e,n),y.promise.then(u,u),this._queue.push(e),this._scheduleNext(),y.promise}last(){return this._queue.last()}peek(){return this._queue.peek()}popLast(){return this._queue.popLast()}reset(){const e=[];this._processingItems.forEach(i=>e.push(i)),this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=yw(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let i;const r=new AbortController,n=new J1t(e,r);this._processingItems.set(e,n);try{i=this.process(e,r.signal)}catch(s){this._processError(n,s)}Yc(i)?(n.promise=i,i.then(s=>this._processResult(n,s),s=>this._processError(n,s))):this._processResult(n,i)}get test(){return{update:e=>this.runTask(e)}}};function Z1t(t,e){return t.length=0,e.forEach(i=>t.push(i)),t}const cU=new Set,T9=[],B3=new Map,jue=[0,0];let A_=class extends Ke{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:i,strategy:r}=this;this._queue=new Y1t({concurrency:e,process:(n,s)=>{const a=this._keyToItem.get(n);return i(a,{signal:s})},peeker:r==="scale-first"?n=>this._peekByScaleFirst(n):n=>this._peekByCenterFirst(n)})}destroy(){this.clear(),this._queue=ct(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const i=typeof e=="string"?e:e.id;return this.has(i)&&this._queue.isOngoing(i)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),n=()=>{this._keyToItem.delete(i)};return this._keyToItem.set(i,e),r.then(n,n),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;e.forEach(b=>{const S=this._keyToItem.get(b),C=this.tileInfoView.getTileScale(S.key);B3.has(C)||(B3.set(C,[]),r=Math.max(C,r),n=Math.min(C,n)),B3.get(C).push(S.key),cU.add(C)});let s=this.state.scale;B3.has(s)||(Z1t(T9,cU),T9.sort((b,S)=>b-S),s=T9.reduce((b,S)=>Math.abs(S-s)<Math.abs(b-s)?S:b,T9[0])),s=Math.min(s,r),s=Math.max(s,n);const a=B3.get(s),u=i.getClosestInfoForScale(s),p=u.getColumnForX(this.state.center[0]),y=u.getRowForY(this.state.center[1]);return a.sort((b,S)=>{const C=u.denormalizeCol(b.col,b.world),O=u.denormalizeCol(S.col,S.world);return Math.sqrt((p-C)*(p-C)+(y-b.row)*(y-b.row))-Math.sqrt((p-O)*(p-O)+(y-S.row)*(y-S.row))}),cU.clear(),B3.clear(),a[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView,r=this.state.center;let n,s=Number.POSITIVE_INFINITY;return e.forEach(a=>{const u=this._keyToItem.get(a);i.getTileCoords(jue,u.key);const p=gv(jue,r);p<s&&(s=p,n=u.key)}),n.id}};_([T({constructOnly:!0})],A_.prototype,"concurrency",void 0),_([T({constructOnly:!0})],A_.prototype,"process",void 0),_([T()],A_.prototype,"state",void 0),_([T({constructOnly:!0})],A_.prototype,"strategy",void 0),_([T({constructOnly:!0})],A_.prototype,"tileInfoView",void 0),A_=_([Z("esri.views.2d.tiling.TileQueue")],A_);new lw(0,0,0,0);function K1t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Q1t(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function eyt(t,e,i,r,n,s,a){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=a,t}function f4e(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],u=e[5];let p=i*s-r*n;return p?(p=1/p,t[0]=s*p,t[1]=-r*p,t[2]=-n*p,t[3]=i*p,t[4]=(n*u-s*a)*p,t[5]=(r*a-i*u)*p,t):null}function tyt(t){return t[0]*t[3]-t[1]*t[2]}function m4e(t,e,i){const r=e[0],n=e[1],s=e[2],a=e[3],u=e[4],p=e[5],y=i[0],b=i[1],S=i[2],C=i[3],O=i[4],P=i[5];return t[0]=r*y+s*b,t[1]=n*y+a*b,t[2]=r*S+s*C,t[3]=n*S+a*C,t[4]=r*O+s*P+u,t[5]=n*O+a*P+p,t}function bee(t,e,i){const r=e[0],n=e[1],s=e[2],a=e[3],u=e[4],p=e[5],y=Math.sin(i),b=Math.cos(i);return t[0]=r*b+s*y,t[1]=n*b+a*y,t[2]=r*-y+s*b,t[3]=n*-y+a*b,t[4]=u,t[5]=p,t}function g4e(t,e,i){const r=e[0],n=e[1],s=e[2],a=e[3],u=e[4],p=e[5],y=i[0],b=i[1];return t[0]=r*y,t[1]=n*y,t[2]=s*b,t[3]=a*b,t[4]=u,t[5]=p,t}function wee(t,e,i){const r=e[0],n=e[1],s=e[2],a=e[3],u=e[4],p=e[5],y=i[0],b=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=a,t[4]=r*y+s*b+u,t[5]=n*y+a*b+p,t}function iyt(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function ryt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function xee(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function nyt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function syt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function oyt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function y4e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function ayt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function lyt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t}function cyt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function uyt(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],u=t[5],p=e[0],y=e[1],b=e[2],S=e[3],C=e[4],O=e[5],P=Ko();return Math.abs(i-p)<=P*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-y)<=P*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-b)<=P*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(s-S)<=P*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(a-C)<=P*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(u-O)<=P*Math.max(1,Math.abs(u),Math.abs(O))}const hyt=m4e,dyt=y4e;Object.freeze(Object.defineProperty({__proto__:null,add:oyt,copy:K1t,determinant:tyt,equals:uyt,exactEquals:cyt,frob:syt,fromRotation:iyt,fromScaling:ryt,fromTranslation:xee,identity:Q1t,invert:f4e,mul:hyt,multiply:m4e,multiplyScalar:ayt,multiplyScalarAndAdd:lyt,rotate:bee,scale:g4e,set:eyt,str:nyt,sub:dyt,subtract:y4e,translate:wee},Symbol.toStringTag,{value:"Module"}));function v4e(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function pyt(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function fyt(t,e,i,r,n,s){const a=new Float32Array(6);return a[0]=t,a[1]=e,a[2]=i,a[3]=r,a[4]=n,a[5]=s,a}function myt(t,e){return new Float32Array(t,e,6)}function _4e(t,e,i,r){const n=e[r],s=e[r+1];t[r]=i[0]*n+i[2]*s+i[4],t[r+1]=i[1]*n+i[3]*s+i[5]}function gyt(t,e,i,r=0,n=0,s=2){const a=n||e.length/s;for(let u=r;u<a;u++)_4e(t,e,i,u*s)}Object.freeze(Object.defineProperty({__proto__:null,clone:pyt,create:v4e,createView:myt,fromValues:fyt,transform:_4e,transformMany:gyt},Symbol.toStringTag,{value:"Module"}));function q$(){return[1,0,0,1,0,0]}function yyt(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function vyt(t,e,i,r,n,s){return[t,e,i,r,n,s]}function _yt(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:yyt,create:q$,createView:_yt,fromValues:vyt},Symbol.toStringTag,{value:"Module"}));function byt(t){return t instanceof Float32Array&&t.length>=2}function wyt(t){return Array.isArray(t)&&t.length>=2}function S9(t){return byt(t)||wyt(t)}const E9={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Vh({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:dt.WebMercator}),minus180Line:new Vh({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:dt.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Vh({paths:[[[180,-180],[180,180]]],spatialReference:dt.WGS84}),minus180Line:new Vh({paths:[[[-180,-180],[-180,180]]],spatialReference:dt.WGS84})}};function h2(t,e){return Math.ceil((t-e)/(2*e))}function b4e(t,e){const i=b4(t);for(const r of i)for(const n of r)n[0]+=e;return t}function b4(t){return m2(t)?t.rings:t.paths}async function xyt(t,e,i,r){const n=_Ae(t),s=e[0].spatialReference,a={...r,responseType:"json",query:{...n.query,f:"json",sr:J6(s),target:JSON.stringify({geometryType:ZO(e[0]),geometries:e}),cutter:JSON.stringify(i)}},u=await ir(n.path+"/cut",a),{cutIndexes:p,geometries:y=[]}=u.data;return{cutIndexes:p,geometries:y.map(b=>{const S=E0(b);return S.spatialReference=s,S})}}async function Tyt(t,e,i){const r=typeof t=="string"?Nn(t):t,n=e[0].spatialReference,s=ZO(e[0]),a={...i,query:{...r.query,f:"json",sr:J6(n),geometries:JSON.stringify(D0t(e))}},{data:u}=await ir(r.path+"/simplify",a);return bAe(u.geometries,s,n)}const w4e=Ee.getLogger("esri.geometry.support.normalizeUtils");function Syt(t){return t.type==="polygon"}function Eyt(t){return t[0].type==="polygon"}function Cyt(t){return t[0].type==="polyline"}function Ayt(t,e){if(!(t instanceof Vh||t instanceof nd)){const n="straightLineDensify: the input geometry is neither polyline nor polygon";throw w4e.error(n),new de(n)}const i=b4(t),r=[];for(const n of i){const s=[];r.push(s),s.push([n[0][0],n[0][1]]);for(let a=0;a<n.length-1;a++){const u=n[a][0],p=n[a][1],y=n[a+1][0],b=n[a+1][1],S=Math.sqrt((y-u)*(y-u)+(b-p)*(b-p)),C=(b-p)/S,O=(y-u)/S,P=S/e;if(P>1){for(let U=1;U<=P-1;U++){const j=U*e,G=O*j+u,q=C*j+p;s.push([G,q])}const $=(S+Math.floor(P-1)*e)/2,N=O*$+u,z=C*$+p;s.push([N,z])}s.push([y,b])}}return Syt(t)?new nd({rings:r,spatialReference:t.spatialReference}):new Vh({paths:r,spatialReference:t.spatialReference})}function Bue(t,e,i){if(e){const r=Ayt(t,1e6);t=aT(r,!0)}return i&&(t=b4e(t,i)),t}function Vue(t,e,i){if(Array.isArray(t)){const r=t[0];if(r>e){const n=h2(r,e);t[0]=r+n*(-2*e)}else if(r<i){const n=h2(r,i);t[0]=r+n*(-2*i)}}else{const r=t.x;if(r>e){const n=h2(r,e);t=t.clone().offset(n*(-2*e),0)}else if(r<i){const n=h2(r,i);t=t.clone().offset(n*(-2*i),0)}}return t}function Oyt(t,e){let i=-1;for(let r=0;r<e.cutIndexes.length;r++){const n=e.cutIndexes[r],s=e.geometries[r],a=b4(s);for(let u=0;u<a.length;u++){const p=a[u];p.some(y=>{if(y[0]<180)return!0;{let b=0;for(let C=0;C<p.length;C++){const O=p[C][0];b=O>b?O:b}b=Number(b.toFixed(9));const S=-360*h2(b,180);for(let C=0;C<p.length;C++){const O=s.getPoint(u,C);s.setPoint(u,C,O.clone().offset(S,0))}return!0}})}if(n===i){if(Eyt(t))for(const u of b4(s))t[n]=t[n].addRing(u);else if(Cyt(t))for(const u of b4(s))t[n]=t[n].addPath(u)}else i=n,t[n]=s}return t}async function Ryt(t,e,i){if(!Array.isArray(t))return Ryt([t],e);e&&typeof e!="string"&&w4e.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof e=="string"?e:e?.url??vr.geometryServiceUrl;let n,s,a,u,p,y,b,S,C=0;const O=[],P=[];for(const G of t)if(G!=null)if(n||(n=G.spatialReference,s=Sp(n),a=n.isWebMercator,y=a?102100:4326,u=E9[y].maxX,p=E9[y].minX,b=E9[y].plus180Line,S=E9[y].minus180Line),s)if(G.type==="mesh")P.push(G);else if(G.type==="point")P.push(Vue(G.clone(),u,p));else if(G.type==="multipoint"){const q=G.clone();q.points=q.points.map(W=>Vue(W,u,p)),P.push(q)}else if(G.type==="extent"){const q=G.clone()._normalize(!1,!1,s);P.push(q.rings?new nd(q):q)}else if(G.extent){const q=G.extent,W=h2(q.xmin,p)*(2*u);let K=W===0?G.clone():b4e(G.clone(),W);q.offset(W,0),q.intersects(b)&&q.xmax!==u?(C=q.xmax>C?q.xmax:C,K=Bue(K,a),O.push(K),P.push("cut")):q.intersects(S)&&q.xmin!==p?(C=q.xmax*(2*u)>C?q.xmax*(2*u):C,K=Bue(K,a,360),O.push(K),P.push("cut")):P.push(K)}else P.push(G.clone());else P.push(G);else P.push(G);let $=h2(C,u),N=-90;const z=$,U=new Vh;for(;$>0;){const G=360*$-180;U.addPath([[G,N],[G,-1*N]]),N*=-1,$--}if(O.length>0&&z>0){const G=Oyt(O,await xyt(r,O,U,i)),q=[],W=[];for(let ae=0;ae<P.length;ae++){const le=P[ae];if(le!=="cut")W.push(le);else{const me=G.shift(),ne=t[ae];ne!=null&&ne.type==="polygon"&&ne.rings&&ne.rings.length>1&&me.rings.length>=ne.rings.length?(q.push(me),W.push("simplify")):W.push(a?Xy(me):me)}}if(!q.length)return W;const K=await Tyt(r,q,i),se=[];for(let ae=0;ae<W.length;ae++){const le=W[ae];le!=="simplify"?se.push(le):se.push(a?Xy(K.shift()):K.shift())}return se}const j=[];for(let G=0;G<P.length;G++){const q=P[G];if(q!=="cut")j.push(q);else{const W=O.shift();j.push(a===!0?Xy(W):W)}}return j}function Myt(t,e,i){const r=Sp(i);if(r==null)return t;const[n,s]=r.valid,a=2*s;let u=0,p=0;e>s?u=Math.ceil(Math.abs(e-s)/a):e<n&&(u=-Math.ceil(Math.abs(e-n)/a)),t>s?p=Math.ceil(Math.abs(t-s)/a):t<n&&(p=-Math.ceil(Math.abs(t-n)/a));let y=t+(u-p)*a;const b=y-e;return b>s?y-=a:b<n&&(y+=a),y}const Pyt=96,Iyt=39.37;function Tee(t,e){return e.type?Yi(t,e.x,e.y):$s(t,e)}function $yt(t){return Va(t)}function Lyt(t,e){const i=t.targetGeometry,r=e.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const Dyt=function(){const t=Ct();return function(e,i,r){const n=i.targetGeometry;Tee(t,n);const s=.5*RN(i);return e.xmin=t[0]-s*r[0],e.ymin=t[1]-s*r[1],e.xmax=t[0]+s*r[0],e.ymax=t[1]+s*r[1],e.spatialReference=n.spatialReference,e}}();function RN(t){return t.scale*Nyt(t.targetGeometry)}function Nyt(t){return t!=null&&Fa(t.spatialReference)?1/($yt(t.spatialReference)*Iyt*Pyt):1}function Fyt(t){return PD(t.rotation)||0}const See=function(){const t=Ct(),e=Ct(),i=Ct();return function(r,n,s,a,u,p){return XZ(t,n),Ic(e,s,.5*p),Yi(i,1/a*p,-1/a*p),xee(r,e),u&&bee(r,r,u),g4e(r,r,i),wee(r,r,t),r}}(),kyt=function(){const t=Ct();return function(e,i,r,n){const s=RN(i),a=Fyt(i);return Tee(t,i.targetGeometry),See(e,t,r,s,a,n)}}(),zyt=function(){const t=Ct();return function(e,i,r,n){const s=RN(i);return Tee(t,i.targetGeometry),See(e,t,r,s,0,n)}}();function Uyt(t){const e=Sp(t);return e?e.valid[1]-e.valid[0]:0}function jyt(t,e){return Math.round(Uyt(t)/e)}var Zq;const Xa=[0,0];let oy=Zq=class extends Ne{constructor(t){super(t),this._viewpoint2D={center:Ct(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new rr,this.id=0,this.inverseTransform=q$(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=q$(),this.transformNoRotation=q$(),this.displayMat3=za(),this.displayViewMat3=za(),this.viewMat3=za(),this.viewMat2d=v4e(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,i=t.targetGeometry;e.center[0]=i.x,e.center[1]=i.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=i.spatialReference}this._update()}copy(t){const e=this.size,i=this.viewpoint;return i&&e?(this.viewpoint=Lyt(i,t.viewpoint),this._set("size",$s(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new Zq({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,i){return S9(e)?ry(t,e,this.inverseTransform):(Xa[0]=e,Xa[1]=i,ry(t,Xa,this.inverseTransform))}toScreen(t,e,i){return S9(e)?ry(t,e,this.transform):(Xa[0]=e,Xa[1]=i,ry(t,Xa,this.transform))}toScreenNoRotation(t,e,i){return S9(e)?ry(t,e,this.transformNoRotation):(Xa[0]=e,Xa[1]=i,ry(t,Xa,this.transformNoRotation))}toScreenClosest(t,e,i){S9(e)?(Xa[0]=e[0],Xa[1]=e[1]):(Xa[0]=e,Xa[1]=i);const[r]=Xa,{center:n,extent:s,spatialReference:a,transform:u}=this;return(r<s.xmin||r>s.xmax)&&(Xa[0]=Myt(r,n[0],a)),ry(t,Xa,u)}getScreenTransform(t,e){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,n=this._get("size");return See(t,i,n,e,0,r),t}_update(){const{center:t,spatialReference:e,scale:i,rotation:r}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size"),a=new qc({targetGeometry:new Wt(t[0],t[1],e),scale:i,rotation:r});if(this._set("viewpoint",a),!s||!e||!i)return;this.resolution=RN(a),this.rotation=r,this.scale=i,this.spatialReference=e,$s(this.center,t);const u=s[0]!==0?2/s[0]:0,p=s[1]!==0?-2/s[1]:0;CZ(this.displayMat3,u,0,0,0,p,0,-1,1,1);const y=AZ(this.viewMat3),b=kh(s[0]/2,s[1]/2),S=kh(-s[0]/2,-s[1]/2),C=PD(r);$L(y,y,b),OZ(y,y,C),$L(y,y,S),IS(this.displayViewMat3,this.displayMat3,y);const O=xee(this.viewMat2d,b);return bee(O,O,C),wee(O,O,S),Dyt(this.extent,a,s),kyt(this.transform,a,s,n),f4e(this.inverseTransform,this.transform),zyt(this.transformNoRotation,a,s,n),this.worldScreenWidth=jyt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};_([T({readOnly:!0})],oy.prototype,"id",void 0),_([T({value:1,json:{write:!0}})],oy.prototype,"pixelRatio",null),_([T({json:{write:!0}})],oy.prototype,"size",null),_([T()],oy.prototype,"spatialReference",void 0),_([T({type:qc,json:{write:!0}})],oy.prototype,"viewpoint",null),oy=Zq=_([Z("esri.views.2d.ViewState")],oy);const Byt=oy;var Kq,Qq,Gue,Hue,que,Wue,Xue,Jue,Yue,Zue,Kue,Que,ehe,the,ihe,rhe,nhe,she,ohe,ahe,lhe,che,uhe,hhe,dhe,phe,fhe,mhe,ghe,yhe,vhe,_he,bhe,whe,xhe,The,She,Ehe,Che,Ahe,Ohe,Rhe,Mhe,Phe,Ihe,$he,Lhe,Dhe,Nhe,Fhe,khe,zhe,Uhe,jhe,Bhe,Vhe,Ghe,Hhe,qhe,Whe,Xhe;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(Kq||(Kq={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(Qq||(Qq={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(Gue||(Gue={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(Hue||(Hue={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(que||(que={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(Wue||(Wue={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(Xue||(Xue={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(Jue||(Jue={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(Yue||(Yue={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(Zue||(Zue={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(Kue||(Kue={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(Que||(Que={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(ehe||(ehe={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(the||(the={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(ihe||(ihe={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(rhe||(rhe={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(nhe||(nhe={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(she||(she={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(ohe||(ohe={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(ahe||(ahe={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees"}(lhe||(lhe={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(che||(che={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(uhe||(uhe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(hhe||(hhe={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(dhe||(dhe={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(phe||(phe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(fhe||(fhe={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(mhe||(mhe={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(ghe||(ghe={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(yhe||(yhe={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(vhe||(vhe={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(_he||(_he={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(bhe||(bhe={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(whe||(whe={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(xhe||(xhe={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(The||(The={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(She||(She={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(Ehe||(Ehe={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(Che||(Che={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(Ahe||(Ahe={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(Ohe||(Ohe={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(Rhe||(Rhe={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(Mhe||(Mhe={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(Phe||(Phe={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(Ihe||(Ihe={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}($he||($he={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(Lhe||(Lhe={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(Dhe||(Dhe={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(Nhe||(Nhe={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(Fhe||(Fhe={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(khe||(khe={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(zhe||(zhe={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(Uhe||(Uhe={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(jhe||(jhe={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(Bhe||(Bhe={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(Vhe||(Vhe={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(Ghe||(Ghe={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(Hhe||(Hhe={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(qhe||(qhe={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(Whe||(Whe={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(Xhe||(Xhe={}));var eW,Xb,tW,N8,iW,F8,rW,Jb,nW;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(eW||(eW={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(Xb||(Xb={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(tW||(tW={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(N8||(N8={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(iW||(iW={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(F8||(F8={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(rW||(rW={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(Jb||(Jb={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(nW||(nW={}));let Rd=class{};Rd.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Xb.VISIBLE}},Rd.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Xb.VISIBLE}},Rd.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Xb.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:Kq.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:Qq.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},Rd.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Xb.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:tW.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:F8.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:N8.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:F8.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:iW.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:N8.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:rW.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[nW.HORIZONTAL]}},Rd.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Xb.VISIBLE}},Rd.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},Rd.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:Jb.MAP}},Rd.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:Jb.MAP},"line-width":{type:"number",minimum:0,default:1}},Rd.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:Jb.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:Jb.MAP}},Rd.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},Rd.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:Jb.MAP}};let Vyt=class extends RAe{_createTransforms(){return{dvs:za(),tileMat3:za()}}};const Gyt=.125;let Hyt=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new Byt({viewpoint:new qc({targetGeometry:new Wt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new Vyt(new lw(0,0,0,0),0,0,0,512,512,4096,4096)}dispose(){this._renderParams=null}renderBackground(e,i,r,n,s,a,u,p,y,b){const S=this._backgroundTile;this._updateRenderParams(e,i,S,r,s,a,u,p,y,b),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,S,n)}renderContent(e,i,r,n,s,a,u,p,y,b,S,C){this._stencilSymbols(e,i,r,n,s,a,u,Math.round(1/p),y,b,S,C);let O=1;r.stencilRef=O++,e.setStencilFunction(Tr.EQUAL,r.stencilRef,255),this._render(e,i,r,s,a,u,p,y,b,S,C),n.forAll(P=>{P.sourceLayerInfo.data.stencilRef=O++,this._renderSymbols(e,P.sourceLod,P.sourceLayerInfo.data,s,a,u,Math.round(1/p),P.offset,b,S,C)})}_stencilSymbols(e,i,r,n,s,a,u,p,y,b,S,C){let O=1;r.stencilRef=O++,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(Rn.KEEP,Rn.KEEP,Rn.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(Tr.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(e,i,r,s,a,u,p,y,b,S,C);for(const P of n.toArray()){const{sourceLod:$,offset:N,sourceLayerInfo:z}=P;z.data.stencilRef=O++,e.setStencilFunction(Tr.ALWAYS,z.data.stencilRef,255),this._stencilTileSymbols(e,$,z.data,s,a,u,p,N,b,S,C)}e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,i,r,n,s,a,u,p,y,b,S){e.setStencilFunction(Tr.EQUAL,r.stencilRef,255),this._render(e,i,r,n,s,a,u,p,y,b,S,eW.SYMBOL)}_render(e,i,r,n,s,a,u,p,y,b,S,C){this._updateRenderParams(e,i,r,n,a,u,p,y,b,S),this._renderParams.stencilSymbols=!1,n.drawTile(this._renderParams,r,s,C)}_stencilTileSymbols(e,i,r,n,s,a,u,p,y,b,S){this._updateRenderParams(e,i,r,n,a,u,p,y,b,S),this._renderParams.stencilSymbols=!0,r.triangleCount=0,n.drawSymbols(this._renderParams,r,s)}_updateRenderParams(e,i,r,n,s,a,u,p,y,b){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(e);const S=i[0]-s.getLevelShift(i[0]),C=this._renderParams;C.context=e,C.painter=n,C.glyphMosaic=n.glyphMosaic,C.spriteMosaic=n.spriteMosaic,C.pixelRatio=y*b,C.displayLevel=S,C.requiredLevel=S;const O=s.getScale(i[0]),[P,$]=s.getOffset(i,a*O),N=Gyt*a*O/p,z=r.transforms.dvs;z[0]=N,z[4]=-N,z[6]=-1-P-u[0]*a*2,z[7]=1+$+(1-u[1])*a*2-2,C.state.size[0]=p/b,C.state.size[1]=p/b,C.state.pixelRatio=b}},x4e=class T4e extends wr{initializeProgram(e){return new fr(e.rctx,T4e.shader.get().build(this.configuration),ar)}initializePipeline(){return mi({blending:Xc(et.ONE,et.ONE_MINUS_SRC_ALPHA),colorWrite:Oi})}};x4e.shader=new pr(Ygt,()=>ke(()=>import("./RasterColorizer.glsl-5664cc87.js"),[],import.meta.url));let iA=class extends _4{constructor(){super(...arguments),this.colorizerType=M2.Stretch,this.stretchType=cw.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};_([ce({count:M2.COUNT})],iA.prototype,"colorizerType",void 0),_([ce({count:cw.COUNT})],iA.prototype,"stretchType",void 0),_([ce()],iA.prototype,"applyColormap",void 0),_([ce()],iA.prototype,"requireBilinearWithNN",void 0);let Jhe=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new qp(this._rctx,new Ar(e),new c$(Eo.DEPTH24_STENCIL8,e));return this._fbos.set(e,r),r}};const qyt=Ee.getLogger("esri.views.3d.terrain");let Wyt=class{constructor(e,i){this._rctx=e,this._techniqueRepository=i,this._fbos=[],this._vectorTileHelper=new Hyt,this._bindParameters=new $7(null,null),this._blendLayersTechniqueConfig=new h4e,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=V0(this._rctx,hR)}dispose(){this._fbos.forEach(jt),this._fbos=null,this._vtFBO=jt(this._vtFBO),this._vaoQuad=jt(this._vaoQuad),this._vectorTileHelper=jt(this._vectorTileHelper),this._backgroundTechnique=Gi(this._backgroundTechnique),this._applyOpacityTechnique=Gi(this._applyOpacityTechnique),this._blendLayersTechnique=Gi(this._blendLayersTechnique)}_getBlendLayersTechnique(e,i,r,n=ap.Off,s=uw.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=n,this._blendLayersTechniqueConfig.background=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(c4e,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,i){const r=this._getBlendLayersTechnique(ut.Normal,i?Rs.ColorComposite:Rs.GridComposite,ku.NotRequired,ap.Off,uw.Only),n=this._rctx.bindTechnique(r,e,this._bindParameters);this._render(n)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Hi.TRIANGLE_STRIP,0,dg(this._vaoQuad,"geometry"))}drawGroup(e,i,r,n,s,a=ap.On){i===Rs.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const u=this._getBlendLayersTechnique(n,i,s,a),p=this._rctx.bindTechnique(u,e,this._bindParameters);this._render(p)}drawRasterData(e,i,r,n,s,a=ap.Off){if(e.texture==null)return;e.fboTexture=i===Rs.GroupBackgroundComposite||n===ut.Normal&&s===ku.NotRequired&&a===ap.Off?null:this.switch(r).colorTexture;const u=this._getBlendLayersTechnique(n,i,s,a),p=this._rctx.bindTechnique(u,e,this._bindParameters);this._render(p)}drawImageryTileData(e,i,r,n,s,a){const u=a.sourceLayerInfo.data;if(!u.source||(a.tile.surface.layerViewByIndex(a.layerIndex,$i.MAP).ensureSymbolizerParameters(u),!u.bind(this._rctx)))return;e.fboTexture=n===ut.Normal&&s===ku.NotRequired?null:this.switch(r).colorTexture;const p=this._getRasterColorizerTechnique(u,i,n,s);u.opacity=e.opacity;const y=u.getUniforms();y.scale=a.scale,y.offset=a.offset,y.backgroundColor=e.backgroundColor,y.fboTexture=e.fboTexture,y.baseOpacity=e.baseOpacity;const b=this._rctx.bindTechnique(p,y,null);this._render(b)}_getRasterColorizerTechnique(e,i,r,n){const s=e.symbolizerParameters,a=["stretch","lut","hillshade"].indexOf(s.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new iA,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=n,this._rasterColorizerConfig.colorizerType=a,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?cw.Noop:cw.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(x4e,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,i,r,n,s,a,u,p,y){const b=this._rctx,S=a.sourceLayerInfo.data,C=a.tile.surface.layerViewByIndex(a.layerIndex,$i.MAP),O=s===ku.Required||e.opacity<1||n!==ut.Normal||i!==Rs.Composite,P=O?ap.On:ap.Off,$=this._getBlendLayersTechnique(n,i,s,P);b.setPipelineState($.getPipeline());let N=null,z=null;O?(z=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new Jhe(this._rctx)),N=this._vtFBO.get(r),b.bindFramebuffer(N),this._clearCurrentFBO()):y&&b.clearSafe(tn.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(b,a.sourceLod,C.painter,C.layer.styleRepository,C.schemaHelper,Math.round(1/a.scale),a.offset,p,u,C.contentZoom),S&&this._vectorTileHelper.renderContent(b,a.sourceLod,S,a.vtlNeighborInfos,C.painter,C.layer.styleRepository,C.schemaHelper,Math.round(1/a.scale),a.offset,p,u,C.contentZoom)}catch(U){qyt.warnOnce("A render call containing vector tiles did not resolve correctly.",U)}return N==null||(b.bindFramebuffer(z),e.texture=N.colorTexture,e.offset=Cg,e.scale=1,this.drawRasterData(e,i,r,n,s,P),y)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,yi.TEXTURE_UNIT_FOR_UPDATES),n=e.descriptor;i.gl.copyTexImage2D(Vn.TEXTURE_2D,0,n.pixelFormat,0,0,n.width,n.height,0),e.generateMipmap(),i.bindTexture(r,yi.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clearSafe(tn.COLOR_BUFFER_BIT|tn.DEPTH_BUFFER_BIT|tn.STENCIL_BUFFER_BIT)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let n=this._fbos.length;n<=i;n++)this._fbos.push(new Jhe(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},Xyt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new xi({allocator:e=>e||new Jyt})}},Jyt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},Yyt=class{constructor(e,i,r,n,s,a){this.start=e,this.end=i,this.blendMode=r,this.opacity=n,this.output=s,this.baseOpacity=a}},Zyt=class{constructor(e,i,r,n){this._rctx=e,this.tileSize=i,this._techniques=r,this._cache=n,this._passParameters=new G1t,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new Wyt(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=jt(this._composition),this._backgroundTexture=Gi(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,n=r.baseOpacity;let s=0,a=0,u=this.tileSize,p=!1,y=!1;const b=r.view.state.contentPixelRatio;let S=!1;k8.clear(),V3.length=0;const C=e.layerInfo[$i.MAP];let O=0,P=null;for(;O<C.length;O++){const N=r.layerViewByIndex(O,$i.MAP),z=N.layer.opacity,U=N.fullOpacity;if(y=y||pI(N.layer),xO(N)){let q=N.layer.blendMode!=="normal";if(cS(N.layer.parent)){const W=sW(N.layer.parent);W!=null&&W!==""&&(q=S4e(N.layer.parent)||q)}q&&(S=q,p=!1)}if(z===0&&!S){C[O].pendingUpdates&=~(ri.TEXTURE_NOFADING&ri.TEXTURE_FADING);continue}++a;const j=YS(N),G=uU(e,O,j);if(G){if(C[O].pendingUpdates&=~(ri.TEXTURE_NOFADING&ri.TEXTURE_FADING),cS(N.layer.parent)){const q=sW(N.layer.parent);q!=null&&q!==""&&E4e(N.layer.parent,O)}j?u=Math.max(u,this.tileSize*b):n===1&&U===1&&(N.isOpaque||this._dataToTexture(G)&&G.sourceLayerInfo.data.descriptor.isOpaque)&&(p=!0),++s,P===null&&(P=O)}}const $=u/this.tileSize;s!==0&&P!==null?s===1&&!S&&this._useLayerTexture(e,P)||this._composeMapLayers(e,i,O-1,y,u,$,!p||S,k8,S):this._useBackgroundTexture(e,a)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=Cg,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useBackgroundTexture(e,i){const r=this._ensureBackgroundTexture(this.tileSize);let n=vg.Immediate;(e.surface.view.layerViewManager.updating||i>0)&&(n=vg.Delayed);const s=e.renderData;s.textureReference==null&&(n=vg.Immediate),s.setTextureReference(new oU(r,Hs.FADING,Yhe,e.surface.baseOpacity,0,1),n)}_useLayerTexture(e,i){const r=e.surface.layerViewByIndex(i,$i.MAP),n=pI(r.layer),s=n?e.surface.baseOpacity:1,a=n?1:e.surface.baseOpacity,u=r.fullOpacity,p=uU(e,i,!1);return!!this._dataToTexture(p)&&(e.renderData.setTextureReference(new oU(p.sourceLayerInfo.data,Hs.FADING,p,s,a,u)),!0)}_composeMapLayers(e,i,r,n,s,a,u,p,y){this._composition.ensureBuffer(s);const b=e.surface.baseOpacity;let S=!1,C=Si.LINEAR_MIPMAP_LINEAR,O=!1,P=0;for(let U=r;U>=0;U--){const j=e.surface.layerViewByIndex(U,$i.MAP),G=YS(j),q=uU(e,U,G),W=j.layer.opacity;if(!q||W===0&&!y)continue;const K=!pI(j.layer)&&!S;K&&(S=!0);let se=!1;p.forEach(pe=>{pe.start===U&&(pe.output=n?Rs.Composite:u&&K?this.backgroundIsGrid?Rs.GridComposite:Rs.ColorComposite:Rs.Composite,pe.baseOpacity=K?b:1,V3.push(pe),this._composition.openGroup(s),se=!0)}),this._passParameters.baseOpacity=K&&!se&&b<1?b:1;const ae=this._passParameters.baseOpacity<1?ku.Required:ku.NotRequired,le=P===0,me=se?Rs.GroupBackgroundComposite:u&&le?this.backgroundIsGrid?Rs.GridComposite:Rs.ColorComposite:Rs.Composite,ne=Xq[xO(j)?j.layer.blendMode:"normal"];for(this._passParameters.opacity=W,wmt(q)?O=this._composition.drawVectorData(this._passParameters,me,s,ne,ae,q,a,this.tileSize,O):bmt(q)?(this._composition.drawImageryTileData(this._passParameters,me,s,ne,ae,q),this._hasNearestInterpolation(q)&&(C=Si.NEAREST)):this._dataToTexture(q)&&(this._passParameters.texture=q.sourceLayerInfo.data.texture,this._passParameters.offset=q.offset,this._passParameters.scale=q.scale,this._composition.drawRasterData(this._passParameters,me,s,ne,ae));V3.length>0&&V3[V3.length-1].end===U;){const pe=V3.pop();this._passParameters.baseOpacity=pe.baseOpacity;const ge=this._passParameters.baseOpacity<1?ku.Required:ku.NotRequired;this._passParameters.opacity=pe.opacity,this._passParameters.offset=Cg,this._passParameters.scale=1,this._composition.drawGroup(this._passParameters,pe.output,s,Xq[pe.blendMode],ge)}P++}const $=e.renderData,N=y||S&&b<1,z=$.ensureTexture(s,N,()=>this._buildTexture(s,N,C));this._composition.copyFBOToTexture(z),this._composition.unbind(),$.setTextureReference(new oU(z,i,Yhe,S?1:b,0,1))}_hasNearestInterpolation(e){const i=e.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_dataToTexture(e){if(Tmt(e)){const i=e.sourceLayerInfo;i.data=this._buildTexture(i.data,!0),e.tile.setMemoryDirty()}return xmt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,i,r=Si.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const n=new Ar;n.wrapMode=Ai.CLAMP_TO_EDGE,n.samplingMode=r,n.maxAnisotropy=this._maxAnisotropy,n.preMultiplyAlpha=!0,n.flipped=!0,n.hasMipmap=!0,i||(n.pixelFormat=ei.RGB);const s=this._rctx;let a;if(typeof e=="number"){n.width=n.height=e;const p=`${e} ${n.pixelFormat}`;a=this._cache.pop(p),a?a.retain():a=new tA(new yi(s,n),this._cache)}else if(tmt(e)){n.isOpaque=e.isOpaque,n.isOpaque&&(n.pixelFormat=ei.RGB);const p=`${e} ${n.pixelFormat}`;a=this._cache.pop(p),a?(a.retain(),a.texture.setData(e.image)):a=new tA(new yi(s,n,e.image),this._cache),e.release()}else try{n.width=e.width,n.height=e.height,a=new tA(new yi(s,n,e))}catch{a=new tA(kwe(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const u=s.bindTexture(a.texture,yi.TEXTURE_UNIT_FOR_UPDATES);return a.generateMipmap(),s.bindTexture(u,yi.TEXTURE_UNIT_FOR_UPDATES),a}get test(){return{backgroundTexture:this._backgroundTexture}}};function uU(t,e,i){Sa.layerIndex=e,Sa.vtlNeighborInfos.clear();const r=t.layerInfo[$i.MAP][e];if(Yi(Sa.offset,0,0),Sa.tile=t,Sa.scale=1,Sa.sourceLod=t.lij,Sa.sourceLayerInfo=r,Sa.isVTLBackground=i,r.data)return i&&t.forEachLoadedNeighbor((s,a)=>{if(s.level!==t.level)return;const u=s.layerInfo[$i.MAP][e];if(!SAe(u)||r.data===u.data)return;const p=Sa.vtlNeighborInfos.pushNew();p.offset=Rm[a],p.sourceLod=s.lij,p.sourceLayerInfo=u}),Sa;const n=r.upsampleInfo;if(n){const s=n.tile.layerInfo[$i.MAP][e];return Sa.tile=n.tile,$s(Sa.offset,n.offset),Sa.scale=n.scale,Sa.sourceLod=n.tile.lij,Sa.sourceLayerInfo=s,Sa}return i?Sa:null}function sW(t){return t.uid}function S4e(t){let e=t.blendMode!=="normal";return cS(t.parent)&&(e=S4e(t.parent)||e),e}function E4e(t,e){cS(t.parent)&&E4e(t.parent,e);const i=sW(t);if(i!=null&&i!==""){const r=k8.get(i);r?r.start=e:k8.set(i,new Yyt(e,e,t.blendMode,t.opacity,Rs.Composite,1))}}const k8=new Map,V3=new Array,Sa=new Xyt,Yhe={offset:[0,0],scale:1},Rm=new Array;Rm[Ht.NORTH]=[0,-1],Rm[Ht.NORTH_EAST]=[-1,-1],Rm[Ht.EAST]=[-1,0],Rm[Ht.SOUTH_EAST]=[-1,1],Rm[Ht.SOUTH]=[0,1],Rm[Ht.SOUTH_WEST]=[1,1],Rm[Ht.WEST]=[1,0],Rm[Ht.NORTH_WEST]=[1,-1];const C4e=200,hU=40,Kyt=.8,Qyt=10,rA=1e-6;function evt(t,e,i){const r=e,n=i;let s=0,a=1/0;for(let u=0;u<3;++u){{const p=t[u];if(r[u]<p){if(n[u]<=rA)return!1;const y=(p-r[u])/n[u];s=Math.max(s,y)}else if(n[u]<=-rA){const y=(p-r[u])/n[u];a=Math.min(a,y)}if(s>a)return!1}{const p=t[u+3];if(r[u]>p){if(n[u]>=-rA)return!1;const y=(p-r[u])/n[u];s=Math.max(s,y)}else if(n[u]>=rA){const y=(p-r[u])/n[u];a=Math.min(a,y)}if(s>a)return!1}}return!0}let Zhe=class{constructor(e,i,r,n,s){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=n,this.rightStartIndex=s}},Eee=class oW{constructor(e,i,r,n){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positions=n,this._rayDirection=H(),this.bspNodeTree=new Array;const s=r-i,a=s<=A4e?new Uint16Array(s):new Uint32Array(s);this.indices=a;for(let u=0;u<s;++u)a[u]=u;{const u=svt(e,i,r,n.data,n.stride),p=Je(Math.log2(s/hU),2,Qyt),y=(b,S,C)=>{const O=rvt(a,u,b,S),P=S-b;if(P<=hU){const G=new Zhe(O,void 0,0,b,S);return this.bspNodeTree.push(G),G}const{axis:$,midValue:N}=nvt(O),z=ivt(a,u,b,S,$,N),U=(G,q)=>{if(C>p)return;const W=q-G;return W<hU||W>=Kyt*P?void 0:y(G,q,C+1)},j=new Zhe(O,$,N,z.next,z.mid);return this.bspNodeTree.push(j),j.leftNode=U(b,z.next),j.rightNode=U(z.mid,S),j};y(0,s,0),this.triangleVertexIndices=ovt(a,e,i,r)}}intersectRayTriangleRange(e,i){{if(e>=i)return;const r=this.triangleVertexIndices,n=this.positions.data,s=this.positions.stride,a=this._rayOrigin,u=a[0],p=a[1],y=a[2],b=this._rayDirection,S=b[0],C=b[1],O=b[2];for(let P=e,$=3*e;P<i;++P){let N=r[$++]*s;const z=n[N++],U=n[N++],j=n[N];N=r[$++]*s;const G=n[N++],q=n[N++],W=n[N];N=r[$++]*s;const K=G-z,se=q-U,ae=W-j,le=n[N++]-z,me=n[N++]-U,ne=n[N]-j,pe=C*ne-me*O,ge=O*le-ne*S,ve=S*me-le*C,Se=K*pe+se*ge+ae*ve;if(Math.abs(Se)<=Number.EPSILON)continue;const ee=u-z,re=p-U,fe=y-j,ye=ee*pe+re*ge+fe*ve;if(Se>0){if(ye<0||ye>Se)continue}else if(ye>0||ye<Se)continue;const we=re*ae-se*fe,Ae=fe*K-ae*ee,Oe=ee*se-K*re,Ve=S*we+C*Ae+O*Oe;if(Se>0){if(Ve<0||ye+Ve>Se)continue}else if(Ve>0||ye+Ve<Se)continue;const at=(le*we+me*Ae+ne*Oe)/Se;if(at>=0){const Xt=this.indices[P]+this.firstTriangleIndex,ti=qK(K,se,ae,le,me,ne,tvt);this._callback(at,ti,Xt,!1)}}}oW.numFacesTested+=i-e}intersectRay(e,i){oW.numFacesTested=0;const r=st(e.r0[0],e.r0[1],e.r0[2]),n=st(e.r1[0],e.r1[1],e.r1[2]),s=n[0]-r[0],a=n[1]-r[1],u=n[2]-r[2];if(s*s+a*a+u*u<rA)return;this._rayOrigin=r;const p=this._rayDirection;p[0]=s,p[1]=a,p[2]=u;const y=this.triangleVertexIndices.length/3;this._callback=i;const b=this.bspNodeTree[0];this.intersectRayBSP(b,0,y)}intersectRayBSP(e,i,r){const n=this._rayOrigin,s=this._rayDirection;if(!evt(e.aabb,n,s))return;const a=e.axis,u=e.d;if(n[a]<u||s[a]<0){const p=i,y=e.midStartIndex;if(p<y){const b=e.leftNode;b!==void 0?this.intersectRayBSP(b,p,y):this.intersectRayTriangleRange(p,y)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),n[a]>u||s[a]>0){const p=e.rightStartIndex,y=r;if(p<y){const b=e.rightNode;b!==void 0?this.intersectRayBSP(b,p,y):this.intersectRayTriangleRange(p,y)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};Eee.numFacesTested=0;const tvt=H(),G3=[1/0,1/0,1/0],H3=[-1/0,-1/0,-1/0];function ivt(t,e,i,r,n,s){let a=i,u=r;for(;a<u;){const y=t[a];e[6*y+n+3]<=s?++a:(--u,t[a]=t[u],t[u]=y)}let p=a;for(u=r;p<u;){const y=t[u-1];e[6*y+n]>=s?--u:(t[u-1]=t[p],t[p]=y,++p)}return{next:a,mid:p}}function rvt(t,e,i,r){if(r<=i)return X2(NaN,NaN,NaN,NaN,NaN,NaN);{const n=6*t[i];for(let s=0;s<3;++s)G3[s]=e[n+0+s],H3[s]=e[n+3+s]}for(let n=i+1;n<r;++n){const s=6*t[n];for(let a=0;a<3;++a)G3[a]=Math.min(G3[a],e[s+0+a]),H3[a]=Math.max(H3[a],e[s+3+a])}return X2(G3[0],G3[1],G3[2],H3[0],H3[1],H3[2])}function nvt(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],n=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:n,midValue:(t[n]+t[n+3])/2}}function svt(t,e,i,r,n){const s=i-e,a=new Float32Array(6*s);for(let u=0;u<s;++u){const p=3*(u+e),y=t[p]*n,b=t[p+1]*n,S=t[p+2]*n;for(let C=0;C<3;++C){const O=r[y+C],P=r[b+C],$=r[S+C];a[6*u+C]=Math.min(O,P,$),a[6*u+3+C]=Math.max(O,P,$)}}return a}function ovt(t,e,i,r){const n=r-i;let s=0;for(let u=i;u<r;++u)for(let p=0;p<3;++p)s=Math.max(e[3*u+p],s);const a=s<=A4e?new Uint16Array(3*n):new Uint32Array(3*n);for(let u=0;u<n;++u){const p=3*(t[u]+i);for(let y=0;y<3;++y){const b=e[p+y];a[3*u+y]=b}}return a}const A4e=65535;let hs=class extends _l{constructor(){super(...arguments),this.output=oe.Color,this.overlayMode=u0.Disabled,this.tileBlendInput=h0.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=Gt.Terrain}};_([ce({count:oe.COUNT})],hs.prototype,"output",void 0),_([ce({count:u0.COUNT})],hs.prototype,"overlayMode",void 0),_([ce({count:h0.COUNT})],hs.prototype,"tileBlendInput",void 0),_([ce()],hs.prototype,"spherical",void 0),_([ce()],hs.prototype,"doublePrecisionRequiresObfuscation",void 0),_([ce()],hs.prototype,"receiveShadows",void 0),_([ce()],hs.prototype,"hasSlicePlane",void 0),_([ce()],hs.prototype,"backfaceCullingEnabled",void 0),_([ce()],hs.prototype,"textureFadingEnabled",void 0),_([ce()],hs.prototype,"renderOccluded",void 0),_([ce()],hs.prototype,"hasScreenSpaceReflections",void 0),_([ce()],hs.prototype,"hasCloudsReflections",void 0),_([ce()],hs.prototype,"invisible",void 0),_([ce()],hs.prototype,"tileBorders",void 0),_([ce()],hs.prototype,"visualizeNormals",void 0),_([ce()],hs.prototype,"screenSizePerspective",void 0),_([ce()],hs.prototype,"receiveAmbientOcclusion",void 0),_([ce({count:Gt.COUNT})],hs.prototype,"pbrMode",void 0),_([ce({constValue:_r.Compressed})],hs.prototype,"normalType",void 0),_([ce({constValue:vs.Compressed})],hs.prototype,"textureCoordinateType",void 0),_([ce({constValue:!1})],hs.prototype,"highStepCount",void 0),_([ce({constValue:!1})],hs.prototype,"useCustomDTRExponentForWater",void 0),_([ce({constValue:!1})],hs.prototype,"useFillLights",void 0),_([ce({constValue:!0})],hs.prototype,"hasColorTexture",void 0);const dU=7,avt=10,pU=eo();var dl;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(dl||(dl={}));let Hd=class extends sxe{get _isGlobal(){return this._stage.viewingMode===ht.Global}get _techniques(){return this._context.techniqueRepository}get _rctx(){return this._context.renderContext.rctx}constructor(e,i,r,n,s){super({}),this._overlayRenderer=e,this._stage=i,this._allTiles=r,this._ellipsoidRadius=n,this.type=En.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new hs,this._passParameters=new GAe,this._renderDataPool=new Ua(_1t),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new NAe,this._transparencyState=dl.Opaque,this._castShadows=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=vn.Occlude,this.produces=new Map([[De.OPAQUE_TERRAIN,()=>this._produces()],[De.TRANSPARENT_TERRAIN,()=>this._produces()],[De.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileTextureCache=new uR((a,u)=>s.newCache(a,u),"TileTexture"),this.tileGeometryCache=new j1t(s)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this)}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?ixe:V7}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===dl.TransparentWithDraped||e===dl.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return Ey}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?x8:vn.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,ri.TEXTURE_FADING)}updateTileTexture(e,i){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,i===ri.TEXTURE_FADING?Hs.FADING:Hs.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(i))}updateTileGeometryState(e){for(const r of e.layerInfo[$i.ELEVATION])r.pendingUpdates&=~ri.GEOMETRY;e.resetPendingUpdate(ri.GEOMETRY);const i=e.renderData.updateGeometryState();return i&&this.setDirty(),i}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const i=e.renderData;i&&(i.releaseGeometry(),this._renderDataPool.release(i),i.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const i=avt-dU,r=Math.max(0,Math.floor((e.level-i)/dU)*dU);if(this._isGlobal&&r===0)return Mo;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=ns.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=ns.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=ns.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new Zyt(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=kwe(this._rctx)}uninitializeRenderContext(){this._emptyTex=jt(this._emptyTex),this._tileRenderer=jt(this._tileRenderer)}intersect(e,i,r,n){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==dl.Opaque)return;const s=lvt,a=cvt;Be(s,n,r),$e(a,1/s[0],1/s[1],1/s[2]);const u=e.results.min,p=e.results.max,y=e.results.ground,b=e.options.store===Jo.MIN,S=!!e.results.ground.target,C=VHe(e.verticalOffset),O=e.tolerance;let P,$=b&&u.dist!=null?u.dist:1/0;const N=U=>{const j=U.renderData;if(!j?.vao)return;const G=j.geometry;r7(pU,G.boundingBox);const q=j.localOrigin;C!=null&&(C.localOrigin=q,C.applyToAabb(pU));const W=pU;if(q3[0]=r[0]-q[0],q3[1]=r[1]-q[1],q3[2]=r[2]-q[2],!XK(W,q3,a,O,$))return;const K=(ve,Se,ee)=>{ve.set(this.type,U,Se,ee,Cn),$=b&&u.dist!=null?u.dist:1/0},se=(ve,Se)=>{if(Se!=null&&ve>=0&&(e.options.backfacesTerrain||He(Se,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||i==null||i(r,n,ve))){if((y.dist==null||ve<y.dist)&&K(y,ve,Se),e.options.isFiltered)return;e.options.store===Jo.ALL&&(P==null?(P=FZ(e.ray),K(P,ve,Se),e.results.all.push(P)):ve<P.dist&&K(P,ve,Se)),(u.dist==null||ve<u.dist)&&K(u,ve,Se),e.options.store!==Jo.MIN&&(p.dist==null||ve>p.dist)&&K(p,ve,Se)}},ae=uvt;Be(ae,n,q);const le=G.indices,me=G.vertexAttributes,ne=me.getField(X.POSITION,lo),pe=new cR(ne.typedBuffer,3,me.stride/4),ge=G.indexCount/3;if(!C&&ge>C4e){const ve=U.renderData;ve.intersectionData==null&&(ve.intersectionData=new Eee(le,0,ge,pe)),ve.intersectionData.intersectRay({r0:q3,r1:ae},se)}else _R(q3,ae,0,ge,le,pe,null,C,se)},z=this._rootTiles;z!=null&&(()=>{const U=this._tileIterator;U.reset(z);const j=e.options.invisibleTerrain;for(let G=U.next();G;G=U.next())!(G.visible||j&&G.intersectsClippingArea)||C==null&&!G.intersectsRay(r,s,O,$)||S&&this._useStencilForTile(G)?U.skipSubtree():N(G)})()}processScaleRangeQueries(e,i){if(!i.done)for(this._updatePatchGroups();e.updating&&!i.done;){e.prepare();for(const r of this._visiblePatchesByOrigin.values())for(const n of r)n.renderData?.textureReference!=null&&e.queriesForTile(n);e.process(),i.madeProgress()}}prepareTechnique(e){const i=Me("enable-feature:terrain-shadows")&&e.bindParameters.shadowMap.enabled;if(i!==this._castShadows&&(this._castShadows=i,this._patchesByOriginDirty=!0),e.bindParameters.slot===De.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&x8))return null}else{const r=this.transparency===dl.Opaque?De.OPAQUE_TERRAIN:De.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==r)return null}if(this.transparency===dl.Empty)return null;switch(e.output){case oe.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.lastFrameColor!=null,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssao!=null,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(oe.Color,e.bindParameters.slot===De.OCCLUDED_TERRAIN);case oe.Shadow:case oe.ShadowExcludeHighlight:return this._castShadows?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(oe.Shadow,!1)):null;case oe.Depth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(oe.Depth,!1);case oe.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(oe.Normal,!1);case oe.ObjectAndLayerIdColor:return this._updateTechnique(oe.ObjectAndLayerIdColor,!1);case oe.Highlight:return this._overlayRenderer.hasHighlights?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(oe.Highlight,!1)):null}return null}renderNode(e,i){switch(this._updatePatchGroups(),i.useStencil=!1,e.output){case oe.Color:{const r=e.bindParameters.slot===De.OCCLUDED_TERRAIN?bn.Occluded:bn.Color;this._renderMaterialPass(e,i,r);break}case oe.Depth:case oe.Normal:this._renderAuxiliaryPass(e,i,bn.Color,this._visiblePatchesByOrigin);break;case oe.Highlight:this._renderAuxiliaryPass(e,i,bn.Highlight,this._visiblePatchesByOrigin);break;case oe.Shadow:case oe.ShadowExcludeHighlight:this._renderAuxiliaryPass(e,i,null,this._allPatchesByOrigin);break;case oe.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,i,bn.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;const i=this._tileRenderer;let r;if(e!=null){const n=mt.toUnitRGBA(e);r=st(n[0]||0,n[1]||0,n[2]||0)}i.setBackground(r),this._allTiles.forAll(n=>i.updateTileTexture(n,Hs.FADING)),this._techniqueConfiguration.tileBlendInput=i.backgroundIsGrid?h0.GridComposite:i.backgroundColor!=null?h0.ColorComposite:h0.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==ZS.NONE){const e=Array.from(this._visiblePatchesByOrigin.values()),i=this._stencilEnabledLayerExtents;for(const r of e)FAe(this.renderOrder,r,i);e.sort((r,n)=>kAe(r[0],n[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){const e=this._rootTiles;if(e!=null){e[0]?.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const i=this._tileIterator;for(i.resetOne(e);!i.done;){const r=i.next(),n=r.renderData;if(!n){this._numTilesCulled++;continue}const s=n.localOrigin;if(this._castShadows){let u=this._allPatchesByOrigin.get(s);u||(u=new Array,this._allPatchesByOrigin.set(s,u)),u.push(r)}if(!r.visible){this._numTilesCulled++,i.skipSubtree();continue}let a=this._visiblePatchesByOrigin.get(s);a||(a=new Array,this._visiblePatchesByOrigin.set(s,a)),a.push(r),i.skipSubtree()}}_useStencilForTile(e){for(const i of this._stencilEnabledLayerExtents)if(e.intersectsExtent(i))return!0;return!1}_renderAuxiliaryPass(e,i,r,n){const s=e.rctx;this._passParameters.overlayContent=r,s.bindTechnique(i,this._passParameters,e.bindParameters);const a=this._stencilEnabledLayerExtents.length>0;n.forEach(u=>{const p=u[0].renderData.localOrigin;i.program.bindDraw(new Oq(p),e.bindParameters,this._passParameters);for(let y=0;y<u.length;y++)this._renderPatch(e,i,u[y],Hi.TRIANGLES,a,r)}),e.rctx.bindVAO(null)}_renderMaterialPass(e,i,r){const{rctx:n}=e;this._passParameters.overlayContent=r,n.bindTechnique(i,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const s=e.bindParameters.camera,a=i.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const C=rTe(this._stage.viewingMode,this._ellipsoidRadius),O=this.pointsOfInterest.centerOnSurfaceFrequent.distance;C.update({distance:O,fovY:s.fovY})}const u=this._stencilEnabledLayerExtents.length>0,p=r===bn.Occluded;p&&(a.bindTexture("tex",this._emptyTex),a.setUniform3fv("textureOpacities",Mo),a.setUniform4fv("texOffsetAndScale",qu));const y=this._tileRenderer?.backgroundColor!=null?this._tileRenderer.backgroundColor:Mo;this._techniqueConfiguration.tileBlendInput===h0.ColorComposite&&a.setUniform3fv("backgroundColor",y);const b=this.wireframe?Hi.LINES:Hi.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&a.bindTexture("texNext",this._emptyTex);const S=this._visiblePatchesByOrigin;for(const C of S.values()){const O=C[0].renderData.localOrigin;i.program.bindDraw(new Oq(O),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const P of C){const $=P.renderData,N=$.textureReference;if(N!=null){if(!p){a.setUniform4fv("texOffsetAndScale",N.offsetAndScale),a.bindTexture("tex",N.texture.texture);const z=$.textureFadeFactor,U=z<1?$.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&U!=null&&z<1?(a.setUniform1f("fadeFactor",z),a.setUniform4fv("nextTexOffsetAndScale",U.offsetAndScale),a.setUniform3fv("nextTexOpacities",U.opacities),a.bindTexture("texNext",U.texture.texture)):a.setUniform1f("fadeFactor",1),$.textureIsFading&&this.setNeedsRender(),a.setUniform3fv("textureOpacities",N.opacities)}this._renderPatch(e,i,P,b,u,r),P.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,i,r,n,s,a){const u=r.renderData,p=u.vao,y=p?.indexBuffer;if(y==null)return void(Ks&&console.error("Rendered tile with no indices: ",r.lij," : ",u));const b=i.program;a==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(b,u.overlay),s&&(i.useStencil=this._useStencilForTile(r),e.rctx.setPipelineState(i.getPipeline()));const S=u.geometry.indexCount;e.rctx.bindVAO(p),b.assertCompatibleVertexAttributeLocations(p),e.rctx.drawElements(n,S,y.indexType,0)}_bindOverlayPatchData(e,i){e.setUniform4fv("overlayTexOffset",i.offsets),e.setUniform4fv("overlayTexScale",i.scales)}_updateTechnique(e,i){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=i,this._shaderTechnique=this._techniques.releaseAndAcquire(HAe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};_([T({readOnly:!0})],Hd.prototype,"_isGlobal",null),_([T({value:!1})],Hd.prototype,"renderingDisabled",null),_([T({value:!0})],Hd.prototype,"visible",null),_([T()],Hd.prototype,"renderPatchBorders",null),_([T()],Hd.prototype,"visualizeNormals",null),_([T()],Hd.prototype,"cullBackFaces",null),_([T({value:ZS.FRONT_TO_BACK})],Hd.prototype,"renderOrder",null),_([T()],Hd.prototype,"wireframe",null),Hd=_([Z("esri.views.3d.terrain.TerrainRenderer")],Hd);const lvt=H(),cvt=H(),q3=H(),uvt=H();let hvt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},zf=class extends Ke{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),Fe(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!MA(i)||i.isRejected())&&!(i.isFulfilled()&&!dvt(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!(i?.type==="vector-tile"||$8(i)))),e)if(e.isResolved()){const i=EN(e,this.viewSpatialReference,this.viewingMode);if(i!=null){const r=new Mc(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===ht.Global){const i=e.levels.length-1;e.spatialReference.isWebMercator?e=Mc.makeWebMercatorAuxiliarySphere(i):uv(e.spatialReference)&&(e=Mc.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(Fe(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===ht.Global){const e=this.extentHelper.viewSpatialReference,i=uv(e)||L0(e)||D0(e);e.isWebMercator?this.tilingScheme=Mc.WebMercatorAuxiliarySphere:i&&(this.tilingScheme=Mc.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||f2(e,this.extent)||(this.tilingScheme=Mc.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function dvt(t,e,i){return EN(t,e,i)!=null}_([T()],zf.prototype,"tilingScheme",void 0),_([T({readOnly:!0})],zf.prototype,"extent",void 0),_([T({value:!1})],zf.prototype,"tilingSchemeLocked",void 0),_([T({constructOnly:!0})],zf.prototype,"viewSpatialReference",void 0),_([T({constructOnly:!0})],zf.prototype,"layers",void 0),_([T({constructOnly:!0})],zf.prototype,"extentHelper",void 0),_([T({constructOnly:!0})],zf.prototype,"viewingMode",void 0),zf=_([Z("esri.views.3d.terrain.TilingSchemeLogic")],zf);let pvt=class{constructor(){this.offset=Ct(),this.scale=0,this.tile=null}init(e,i,r,n){this.tile=e,this.offset[0]=i,this.offset[1]=r,this.scale=n}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}};var W$;let Mi=W$=class extends Xn.EventedMixin(Ke){constructor(t){super(t),this._scaleRangeQueries=new H$,this._iteratorPool=new Ua(NAe,e=>e.remove=()=>this._iteratorPool.release(e)),this._postorderIterator=new Rgt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new hvt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=H(),this._eyePosSurfaceSR=H(),this._splitLimits=new Gd,this._frustum=nO(),this._viewProjectionMatrix=Ze(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new Cp,this._frameTask=TS,this._allTiles=new xi,this._upsampleInfoPool=new Ua(pvt),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=Di(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=dt.WebMercator,this.visibleElevationBounds=new ET(1/0,-1/0),this.rootTileElevationBounds=new ET(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this.overlayManager=new kl({...t,surface:this}),this._isGlobal=!t.view?.state?.isLocal,this._tileConstructor=this._isGlobal?k1t:D1t}initialize(){const t=this.view,e=t.resourceController;this._lercDecoder=rgt(e);const i=e.memoryController;this._tileCache=new uR((p,y)=>i.newCache(p,y),"terrain-tile"),this._upsampleMapCache=i.newCache("terrain-upsample",p=>p.unloadMapData()),this._elevationQueryCache=new tgt(i.newCache("elevation-query"));const r=this.overlayManager;this._renderer=new Hd(r.renderer,t._stage,this._allTiles,Mr(t.spatialReference).radius,i),this.addHandles([Fe(()=>r.rendersOccluded,p=>this._renderer.setRenderOccludedOverlay(p)),Fe(()=>r.renderer.isEmpty,()=>this._evaluateTransparency()),Fe(()=>this.renderer.visible,p=>this.suspended=!p)],"overlayManager"),this.addHandles([Fe(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?Hs.UNFADED:Hs.IMMEDIATE)},Ur),Fe(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?Hs.UNFADED:Hs.IMMEDIATE),Ur),Fe(()=>this.backgroundColor,(p,y)=>{p?.equals(y)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(p))},$r),Fe(()=>this.snapLevel,()=>this._viewChanged=!0,$r),Fe(()=>this.view.pointsOfInterest,p=>{this._renderer.pointsOfInterest=p,this._watchUpdatingTracking.removeAll(),p&&this._watchUpdatingTracking.add(()=>p.focus.renderLocation,()=>this._allTilesSorted=!1)}),Fe(()=>Xr.TERRAIN_TILE_TREE_SHOW_TILES,p=>{p&&!this._treeDebugger?ke(()=>import("./TerrainTileTree3DDebugger-2b4ad53b.js"),["./TerrainTileTree3DDebugger-2b4ad53b.js","./TileTreeDebugger-7859146b.js"],import.meta.url).then(({TerrainTileTree3DDebugger:y})=>{!this._treeDebugger&&Xr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new y({view:t}))}):p||(this._treeDebugger=ct(this._treeDebugger))},jr)]);const{spatialReference:n}=t;this._extentHelper=vgt(this.viewingMode,{layers:t.map.allLayers,layerViews:t.allLayerViews,viewSpatialReference:n});const s=new F4({getCollections:()=>t.defaultsFromMap?.mapCollections?.map(({layers:p})=>p),getChildrenFunction:p=>p&&"layers"in p?p.layers:null}),a=new zf({layers:s,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:n});this._set("tilingSchemeLogic",a),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(o0.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(o0.BASEMAP);const u=e.scheduler;this._frameTask=u.registerTask(Zt.TERRAIN_SURFACE,this),this.addHandles([Fe(()=>this._extentHelper.stencilEnabledExtents,p=>this._renderer.setStencilEnabledLayerExtents(p),jr),Fe(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),$r),Fe(()=>this.extent,()=>this._updateRootTiles(),jr),t.on("resize",()=>this._viewChangeUpdate()),Fe(()=>{const p=t.state;return[this._lodBias,this.lodSnapping,t.quality,p.camera,p.contentCamera,p.fixedContentCamera]},()=>this._viewChangeUpdate(),Ur),Fe(()=>t.qualitySettings?.tiledSurface?.textureFadeDuration,p=>this._renderer.textureFadingEnabled=p>0,jr),Fe(()=>t.qualitySettings?.physicallyBasedRenderingEnabled,p=>this._renderer.pbrMode=p?Gt.Terrain:Gt.Disabled,jr),Fe(()=>this._userClippingExtent,()=>this._updateClippingExtent(),$r)]),this.addHandles(t.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Gi(this._lercDecoder),this._removeAllTiles(),this._set("tilingSchemeLogic",ct(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((t,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",ct(this.overlayManager)),this._tileCache=ct(this._tileCache),mee.prune(),this._treeDebugger=ct(this._treeDebugger),this._renderer=ct(this._renderer),this._iteratorPool=ct(this._iteratorPool),this._upsampleMapCache=ct(this._upsampleMapCache),this._elevationQueryCache=ct(this._elevationQueryCache),this._set("view",null),this._extentHelper=ct(this._extentHelper),this._upsampleInfoPool=ct(this._upsampleInfoPool),pgt(),n1t()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===s4.ON){const t=this.view,e=this.tilingScheme,i=t.pointsOfInterest?.cameraOnSurface?.scale;if(e&&i){const r=t.state.contentCamera;let n=O7(t,r.eye,r.viewForward,r.up).tilt;n>90&&(n=180-n);const s=2*(n/90)**2,a=e.levelAtScale(i)-s,u=Math.min(a+t.qualitySettings.tiledSurface.lodBias,this._splitLimits.maxLod||1/0);return u<=0?null:u}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?s4.ON:s4.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:t}=this,{clippingArea:e}=this.view;if(e==null||t==null)return null;const i=Di(),r=uAe(e,i,t)?i:null,n=this._get("extent");return f2(r,n)?n:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const t=cB(this.groundExtent,this._userClippingExtent,Di()),e=this._get("extent");return f2(t,e)?e:t}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(t){this.view.map.ground.opacity=t}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(t){this._renderer.renderOrder=t,this._set("renderOrder",t)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(t){this.view.map.ground.surfaceColor=t}set slicePlaneEnabled(t){this._renderer.slicePlaneEnabled=t,this._set("slicePlaneEnabled",t),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(t){t!==this._renderer.wireframe&&(this._renderer.wireframe=t,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===dl.Opaque}set suspended(t){this._set("suspended",t),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(t,e,i,r){this._renderer.intersect(t,e,i,r)}getElevation(t,e,i,r){const n=this._rootTiles;if(!n?.length||n[0].layerInfo[$i.ELEVATION].length===0)return null;const s=Il;return s[0]=t,s[1]=e,s[2]=i,va(s,r,s,this._spatialReference)?Qhe(n,s[0],s[1]):(Ee.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(t,e,i){const r=this._rootTiles,n=r?r[0].layerInfo[$i.ELEVATION].length:0;if(r?.length&&n!==0)for(let s=0;s<e;++s){const a=3*s;i(s,Qhe(r,t[a],t[a+1]))}else for(let s=0;s<e;++s)i(s,null)}getScale(t){if(!this.tilingScheme)return null;if(!Wc(t,Il,this.spatialReference))return Ee.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const i of e)if(i?.containsPoint(Il)){let r=i;for(;r.children[0]&&!r.rendered;){const n=r.children[0].extent;let s=0;Il[0]>n[2]&&(s+=1),Il[1]<n[1]&&(s+=2),r=r.children[s]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}getSphereElevationBounds(t,e){if(Il[0]=t[0],Il[1]=t[1],Il[2]=t[2],Il[3]=t[3],!va(Il,e,Il,this.tilingScheme?.spatialReference))return Ee.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let i=1/0,r=-1/0;const n=a=>{if(a&&Eie(a.extent,Il))if(a.isLeaf||a.rendered)i=Math.min(i,a.elevationBounds[0]),r=Math.max(r,a.elevationBounds[1]);else for(const u of a.children)n(u)},s=this._rootTiles;if(s!=null)for(const a of s)n(a);return{min:i,max:r}}getRootElevationBounds(){return{min:this.rootTileElevationBounds.min,max:this.rootTileElevationBounds.max}}getSphereScale(t,e){if(!this.tilingScheme)return null;if(!Wc(t,Il,this.spatialReference))return Ee.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Il[3]=e;let i=null;const r=s=>{if(s&&Eie(s.extent,Il)){const a=s.children;if(a[0]&&!s.rendered)for(const u of a)r(u);else{const u=this._getLodBiasCorrectedScale(s.level);i=i==null?u:Math.min(i,u)}}},n=this._rootTiles;if(n!=null)for(const s of n)r(s);return i}queryVisibleScaleRange(t,e,i,r){const n=e?this.tilingScheme.levelAtScale(e):0,s=i?this.tilingScheme.levelAtScale(i):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(t,n+a,s+a,r)}_evaluateTransparency(){const t=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?e?dl.Empty:dl.TransparentWithDraped:t>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?dl.Opaque:dl.Semitransparent,n=i!==r;return n&&(this._renderer.transparency=r,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency})),n}_updateTilingScheme(){const t=this.tilingSchemeLogic.tilingScheme;if(t===this.tilingScheme)return;Qf(!!t,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();const e=t?.spatialReference??dt.WebMercator;this._spatialReference=e,this._isWebMercator=!!e?.isWebMercator,this._isWebMercatorOnPlateeCarree=this._isWebMercator&&NJ(this.view?.renderSpatialReference),this._set("tilingScheme",t),this._updateClippingExtent(),t&&(this._updateTiledLayers(),this._renderer.setTileSize(t.pixelSize),this.overlayManager.setSpatialReference(t.spatialReference),this._updateRootTiles())}_acquireTile(t,e,i,r){const n=this._tileCache.pop(W$._tileMemcacheKey);return n?(n.init(t,e,i,r,this),n):new this._tileConstructor(t,e,i,r,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:t,tilingScheme:e}=this;if(!e)return;const i=gvt;let r=e.rootTilesInExtent(t,i,5*fT);if(this._rootTiles!=null){if(r.length>fT)return void Ee.getLogger(this).warn(Dqe);const n=this._rootTiles.map(a=>a.lij),s=BPe(n,r,Khe);if(this._updatingRootTiles=!0,s.removed.length>0||s.added.length>0){const a=this._rootTiles.filter(u=>!(s.removed.findIndex(p=>Khe(p,u.lij))>-1)||(this._purgeTile(u),!1));s.added.forEach(u=>a.push(this._newRootTile(u))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,r.length>fT&&(Ee.getLogger(this).warn(Nqe),r=e.rootTilesInExtent(t,i,fT)),this._setRootTiles(r.map(n=>this._newRootTile(n)));f2(i,this._rootTilesExtent)||(this._rootTilesExtent=Di(i)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const t=this._allTiles.filter(e=>e.isLoaded&&e.intersectsClippingArea);t.forEach(e=>this._renderer.updateTileGeometryState(e)),t.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(t),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(t){if(t.length===0)return;t.sort(_g);const e=this.renderer;t.forEach(i=>e.updateGeometryIfNeeded(i)),t.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(t){return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===ri.SPLIT}_newRootTile(t){const e=this._acquireTile(0,t[1],t[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(ri.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(t){if(this._rootTiles=t,this._allTiles.clear(),t!=null){const e=this._iteratorPool.acquire();for(e.reset(t);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(t)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(t){t.updateClippingStatus(this.extent)&&t.resetPendingUpdate(ri.GEOMETRY)&&this._updateTileGeometryState(t)}_updateTilesVisibility(t){if(t==null)return;const e=Ngt(t),i=this.visibleElevationBounds;let r=e?i.min:1/0,n=e?i.max:-1/0;const s=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const u=this._iteratorPool.acquire();for(u.reset(t);!u.done;){const p=u.next();p.updateClippingStatus(s)&&p.resetPendingUpdate(ri.GEOMETRY)&&this._updateTileGeometryState(p),p.setPendingUpdate(ri.RENDERDATA),p.computeVisibility(),p.updateScreenDepth(a),p.renderData&&(r=Math.min(p.elevationBounds[0],r),n=Math.max(p.elevationBounds[1],n))}u.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(r)&&isFinite(n)&&(i.min!==r||i.max!==n)&&(this.visibleElevationBounds=new ET(r,n))}_updateRootTileElevationBounds(){let t=1/0,e=-1/0;const i=this._rootTiles;i?.forEach(({elevationBounds:n})=>{t=Math.min(t,n[0]),e=Math.max(e,n[1])});const r=this.rootTileElevationBounds;r.min===t&&r.max===e||(this.rootTileElevationBounds=new ET(t,e))}_updateViewDependentParameters(){const{camera:t,contentCamera:e}=this.view.state,i=Math.tan(.5*e.fovX),r=Math.tan(.5*e.fovY),n=this.tilingScheme.pixelSize,s=2**-this._lodBias*t.pixelRatio;this._splitLimits.aboveGround=t.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=n/t.width*this.maxTextureScale*s,this._splitLimits.relativeHeightLimit=n/t.height*this.maxTextureScale*s,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=BL(this._splitLimits.frustum??nO(),e.frustum):this._splitLimits.frustum=null,BL(this._frustum,t.frustum),Rr(this._viewProjectionMatrix,e.projectionMatrix,e.viewMatrix),Ie(this._eyePosRenderSR,e.eye),va(t.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(t){t.rendered&&!t.shouldLoad&&(O4e(t)?this._loadChildren(t):mvt(t)&&this._loadParent(t))}_updateTileGeometryState(t){t.updateVisibility(),this._renderer.updateTileGeometryState(t)&&this._markTileToUpdate(t),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(t){t.forEachLoadedNeighbor(e=>this._pendingTilesToUpdate.add(e))}_updateTileTexture(t,e){const i=t.resetPendingUpdate(ri.TEXTURE_FADING)?ri.TEXTURE_FADING:!!t.resetPendingUpdate(ri.TEXTURE_NOFADING)&&ri.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(t,i),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const t=mU.extent;rd(t),this._pendingTilesForElevationUpdateEvent.forEach(e=>Yy(t,e.extent,t)),this._pendingTilesForElevationUpdateEvent.clear(),mU.spatialReference=this.spatialReference,this.emit("elevation-change",mU),this._shouldEmitChangeEvent=!1}runTask(t){this._handleLayerViewChanges(t),this._frameTask.processQueue(t),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,t),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(t),this._sortTiles(t);const e=!this.view.state.fixedContentCamera;this._mergeAndSplit(t,e),this._updateElevation(t),this._updateTextures(t),e||this._mergeAndSplit(t,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),t.done&&t.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(t){if(!this._viewChanged||!this._rootTiles||t.done)return;this._viewChanged=!1;const e=this._iteratorPool.acquire();e.reset(this._rootTiles);const i=this.snapLevel,r=this._splitLimits,n=this._eyePosRenderSR;for(;!e.done;){const s=e.next(),a=s.shouldSplit(r,n,i);if(a!==ri.SPLIT){if(s.resetPendingUpdate(ri.SPLIT)&&s.updateAgentSuspension(),a===ri.ELEVATION&&s.updateAgents($i.ELEVATION),e.skipSubtree(),!s.isLeaf){s.setPendingUpdate(ri.MERGE),s.resetPendingUpdate(ri.SPLIT);const u=this._iteratorPool.acquire();u.resetOne(s);const p=this._viewProjectionMatrix;for(let y=u.next();!u.done;y=u.next())this._updateClippingStatus(y),y.updateVisibility(),y.updateScreenDepth(p);u.remove()}}else s.resetPendingUpdate(ri.MERGE),s.isLeaf&&(s.setPendingUpdate(ri.SPLIT),e.skipSubtree()),s.rendered&&s.setPendingUpdate(ri.RENDERDATA)}e.remove(),this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),t.madeProgress()}_sortTiles(t){t.done||this._allTilesSorted||(Lgt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),t.madeProgress())}_markTileToUpdate(t){tt(t.isLoaded),t.intersectsClippingArea&&(this._pendingTilesToUpdate.add(t),this._markAllTileNeighborsForGeometryUpdate(t))}_updatePendingTileGeometries(){const t=this._pendingTilesToUpdate,e=Array.from(t.keys()).filter(n=>n.isLoaded&&n.intersectsClippingArea);if(e.length===0)return void t.clear();const i=(n,s)=>{!s?.isLoaded||!s.intersectsClippingArea||s.level<n.level||t.has(s)||(t.add(s),e.push(s),s.renderData.updateNeighborData())};e.sort(_g);const r=e.length;for(let n=0;n<r;++n){const s=e[n];tt(s.isLoaded),tt(s.intersectsClippingArea);const a=s.renderData;a.updateNeighborData();const u=a._dirtyEdgeResolutions,p=a.geometryState.neighborData.cornerPeerNeighbors,y=b=>{const S=D8[b];i(s,p[b]?.findCorner(L8(S),C=>C.isLoaded))};for(let b=0;b<4;++b)if(u&1<<b){const S=a.geometryState.neighborData.edgePeerNeighbors[b];S&&S?.level>=s.level&&S.forAllSubtreeOnSide(dee(ag[b]),C=>!(!C.isLoaded||!C.intersectsClippingArea)&&(tt(t.has(C)||_g(s,C)<0),i(s,C),!0)),y((b+1)%4),y(b)}}t.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,Ks&&I8&&this.checkAllTilesWaterproofness()}_mergeAndSplit(t,e){if(this.suspended||t.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const r=this.view.state.fixedContentCamera;let n=!1;for(;!t.done;){n=!0;let s=!1;const a=!this._allTiles.some(u=>{if(!i&&!r&&!u.visible)return t.done;let p=u;if(u.resetPendingUpdate(ri.MERGE)){if(!e)return u.setPendingUpdate(ri.MERGE),t.done;for(;p.parent?.resetPendingUpdate(ri.MERGE);)p=p.parent;this._mergeTile(p),s=!0,t.madeProgress()}else u.resetPendingUpdate(ri.SPLIT)&&(this._splitTile(u),s=!0,t.madeProgress());return!t.done&&p===u&&u.resetPendingUpdate(ri.RENDERDATA)&&(this._updateRenderData(u),t.madeProgress()),t.done});if(s&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!i){i=!0;continue}if(!s)break}else this._allTilesDirty=!0}n?t.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(t)}_updateElevation(t){t.done||(this._allTiles.some(e=>(e.resetPendingUpdate(ri.GEOMETRY)&&(this._updateTileGeometryState(e),this._updateTileTexture(e,t),this._shortBatches&&this._updatePendingTileGeometries(),t.madeProgress()),t.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(t){t.done||this._allTiles.some(e=>(this._updateTileTexture(e,t),t.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(ns.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const t=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-t)*$qe}_getLodBiasCorrectedScale(t){const e=this.tilingScheme.levels,i=Je(t-this._lodBias,0,e.length-1),r=i-Math.floor(i);return e[Math.floor(i)].scale*(1-r)+e[Math.ceil(i)].scale*r}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(t=>this._purgeTile(t)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeDescendantTiles(t){if(!t.children[0])return!1;let e=!1;for(let i=0;i<4;++i)e=this._purgeTile(t.children[i])||e;return t.unsetChildren(),e}_purgeTile(t){const e=this._purgeDescendantTiles(t)||t.rendered;return this._allTiles.removeUnordered(t),this._unloadTile(t),this._tileCache.put(W$._tileMemcacheKey,t),e}_unloadTile(t){this._pendingTilesToUpdate.delete(t),this._pendingTilesForElevationUpdateEvent.delete(t),t.unload(this._renderer)}_splitTile(t){Qf(t.isLeaf,"tile that is already split should not be split again!");const e=t.level+1,i=2*t.lij[1],r=2*t.lij[2];t.setChildren(this._createTile(e,i,r,t),this._createTile(e,i,r+1,t),this._createTile(e,i+1,r,t),this._createTile(e,i+1,r+1,t)),t.setPendingUpdate(ri.RENDERDATA),t.updateAgentSuspension(),this._allTiles.pushArray(t.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(t,e=t.level){C9.spatialReference=this.spatialReference,C9.extent=t.extent,C9.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",C9)}_createTile(t,e,i,r){Qf(!!r,"_createTile sanity check");const n=this._acquireTile(t,e,i,r);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(ri.SPLIT),n}get _shortBatches(){return this.view.state.mode!==yr.IDLE}_mergeTile(t){Qf(!t.hasPendingUpdate(ri.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(t)&&(Qf(!t.renderData,"_mergeTile sanity check"),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t),this._shortBatches&&this._updatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(t){Qf(t.rendered,"parent should be rendered"),this._unloadTile(t);const e=t.children;e.forEach(i=>this._loadTile(i)),e.forEach(i=>this._pendingTilesToUpdate.add(i)),this._markAllTileNeighborsForGeometryUpdate(t),this._emitTileScaleChange(t,t.level+1),this._shortBatches&&this._updatePendingTileGeometries()}_loadParent(t){const e=t.parent;this._unloadChildren(e),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e,e.level),this._shortBatches&&this._updatePendingTileGeometries()}_unloadChildren(t){const e=t.children;if(e[0])for(let i=0;i<4;++i){const r=e[i];this._unloadChildren(r),this._unloadTile(r)}}_loadTile(t){t.load(),t.setPendingUpdate(ri.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(t)}_elevationDataArrived(t,e,i){const r=new ggt(t.lij,t.extent,i);t.dataArrived(e,$i.ELEVATION,r);const n=[t],s=t.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const u=a.next();u.findElevationBoundsForLayer(e,s),u.computeElevationBounds()}s===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(t=ml){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const i=new Set;let r=-1;for(const n of this.view.allLayerViews.items)if(i.add(n.uid),TO(n)||$C(n))if(this._basemapLayerViewHandles.has(n.uid)&&!$C(n)){const s=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(s,n.uid);a!=null&&((a<r||r==null)&&(e=!0),r=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(e=!0);this._basemapLayerViewHandles.forEach((n,s)=>{i.has(s)||(this._unregisterTiledLayerView(s),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),t.madeProgress()}_allSurfaceLayersTransparent(){let t=this.view.map?.ground?.opacity===0;for(const e of this.view.allLayerViews.items)if(Hq(e)&&!pI(e.layer)&&e.fullOpacity!==0)return t=!1,t;return t}_hasCompositeBlendMode(){for(const t of this.view.allLayerViews.items)if((xO(t)||$C(t))&&Bgt(Xq[t.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(t){return Gq(t)?$i.ELEVATION:$i.MAP}_registerTiledLayerView(t){const e=[];if((xO(t)||$C(t))&&e.push(Fe(()=>t.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Hs.UNFADED)})),!$C(t)){const i=this._layerClassFromLayerView(t);e.push(Fe(()=>t.suspended,()=>this._updateTiledLayers())),e.push(Fe(()=>t.fullOpacity,()=>this._updateTileTextures(Hs.UNFADED))),e.push(Fe(()=>"effectiveScaleRange"in t.layer?t.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.push(t.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,t.uid);r!=null&&this._invalidateLayerData(r,i)}))}this._unregisterTiledLayerView(t.uid),this._basemapLayerViewHandles.set(t.uid,e)}_unregisterTiledLayerView(t){const e=this._basemapLayerViewHandles.get(t);if(e){for(const i of e)i.remove();this._basemapLayerViewHandles.delete(t)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const t=this.view.allLayerViews,e=[[],[]];let i=null;t.forEach(r=>{if(!r.layer||r.suspended||!TO(r)||!r.fullExtent)return;const n=this._layerClassFromLayerView(r);if(n===$i.MAP){const s=r.displayLevelRange.maxLevel;s!==1/0&&(i===null||s>i)&&(i=s)}e[n].push(r)});for(const r of gb){const n=this._layerViews[r],s=e[r];s.reverse();const a=s.length;let u=n.length!==a;const p=new Array(a),y=new Array(n.length);this._layerIndexByUid[r].clear();for(let b=0;b<a;b++){const S=s[b].uid;this._layerIndexByUid[r].set(S,b);const C=n.indexOf(s[b]);p[b]=C,b!==C&&(u=!0),C>-1&&(y[C]=b)}if(u){const b=this._postorderIterator;for(b.reset(this._rootTiles);!b.done;)b.next().modifyLayers(y,p,r);this._layerViews[r]=s,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(t){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const i=e.next();i.restartAgents(t),t===$i.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(t,e){return this._layerViews[e][t]}numLayers(t){return this._layerViews[t].length}_updateTileTextures(t){this._allTiles.forAll(e=>{e.updateAgents($i.MAP),t===Hs.IMMEDIATE?this.renderer.updateTileTexture(e,ri.TEXTURE_NOFADING):e.updateRenderData($i.MAP,t)}),this._evaluateTransparency()}_invalidateLayerData(t,e){this._allTiles.forAll(i=>i.removeLayerAgent(t,e)),this._allTiles.forAll(i=>i.invalidateLayerData(t,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(t=ns.UPDATE){this.renderer.setNeedsRender(t)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(t,e,i,r){const n=this.layerViewByIndex(e,i),s=n.layer;return!s.tilemapCache||YS(n)?this._requestTileData(t,i,n,r):(++this._asyncWorkItems,s.tilemapCache.fetchAvailability(t.lij[0],t.lij[1],t.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,oi(r),qn(a)||this._dataMissing(t,i,n,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(t,i,n,r),r.signal)))}_requestTileData(t,e,i,r){return e===$i.ELEVATION?Gq(i)?this._requestElevationTileData(t,i,r):Promise.reject():Hq(i)?this._requestMapTileData(t,i,r):Promise.reject()}_requestElevationTileData(t,e,i){++this._asyncWorkItems;const r=a=>{if(Ms(i))return;const u=this._layerIndexByUid[$i.ELEVATION].get(e.uid);u!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(t,u,a)):Ee.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",$i.ELEVATION,t.lij.toString())},n=a=>{qn(a)||(this._dataMissing(t,$i.ELEVATION,e,a),this.requestUpdate())};if(uue(e.layer))return e.layer.fetchTile(t.lij[0],t.lij[1],t.lij[2],{noDataValue:Q4,signal:i.signal}).then(a=>{if(!Ms(i))return this._frameTask.schedule(()=>r(a),i.signal,n);Ee.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},n).finally(()=>{--this._asyncWorkItems});const s=e.getTileUrl(t.lij[0],t.lij[1],t.lij[2]);return this._elevationDataRequester.request(s,"binary",i).then(a=>this._lercDecoder.decode(a,{noDataValue:Q4},i.signal)).then(a=>{a?r(new igt(a)):n(new Error("LERC decoding failed"))},n).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(t,e,i){++this._asyncWorkItems;const r=(y,b)=>{--this._asyncWorkItems,JT(b),Ms(i)||(this._dataMissing(t,$i.MAP,e,y),this.requestUpdate())},n=y=>b=>r(b,y),s=y=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Ms(i)?JT(y):this._mapTileDataArrived(t,e,y)},i.signal,n(y)).catch(n(y)),a=(y,b=null)=>this._frameTask.schedule(()=>r(y,b));if(YS(e)){const y=e.schemaHelper.getLevelRowColumn(t.lij);return e.fetchTile(y[0],y[1],y[2],i).then(s,a)}if(SN(e))return e.fetchTile(t.lij[0],t.lij[1],t.lij[2],i).then(s,a);if(uee(e)&&uue(e.layer))return e.layer.fetchTile(t.lij[0],t.lij[1],t.lij[2],i).then(y=>{if(Ms(i))return Ee.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(or());s(y)},a);let u=e.getTileUrl(t.lij[0],t.lij[1],t.lij[2]);egt(e.layer)&&e.layer.refreshTimestamp&&(u+=`${u.includes("?")?"&":"?"}_ts=${e.layer.refreshTimestamp}`);const p=e.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(u,p,i).then(s,a)}_mapTileDataArrived(t,e,i){const r=this._getLayerIdxByUID($i.MAP,e.uid);r!=null?t.dataArrived(r,$i.MAP,i):(JT(i),Ee.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(t,e){return this._layerIndexByUid[t].get(e)}_dataMissing(t,e,i,r){const n=this._getLayerIdxByUID(e,i.uid);n!=null?t.dataMissing(n,e,r):Ee.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(t){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(t))}get performanceInfo(){const t=this._performanceInfo;return t.numNodes=this._allTiles.length,t.numLeaves=t.numVisible=t.numRendered=t.numLoadedPerLevel.length=t.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.isLeaf&&t.numLeaves++;const i=e.level;e.renderData&&(t.numLoadedPerLevel[i]=(t.numLoadedPerLevel[i]||0)+1),e.visible&&(t.numVisible++,e.rendered&&(t.numRenderedPerLevel[i]=(t.numRenderedPerLevel[i]||0)+1,t.numRendered++))}),t}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((t,e)=>t+e.usedMemory,0)):null}getUsedMemoryForLayerView(t){let e=0;const i=this._layerClassFromLayerView(t),r=this._getLayerIdxByUID(i,t.uid);return r!=null&&this._allTiles.forAll(n=>e+=n.getUsedMemoryForLayer(i,r)),e}getTile(t){if(t==null||this._rootTiles==null)return null;const e=t.split("/").map(a=>+a);if(e[0]===0)return this._rootTiles.find(a=>a.lij[1]===e[1]&&a.lij[2]===e[2]);const i=2**e[0],r=Math.floor(e[1]/i),n=Math.floor(e[2]/i);let s;if(this._rootTiles.some(a=>a.lij[1]===r&&a.lij[2]===n&&(s=a,!0)),s){let a=1<<e[0]-1;for(;s.lij[0]<e[0];){let u=e[1]&a?2:0;if((e[2]&a)>0&&u++,!s.children[u])return null;s=s.children[u],a>>=1}return Qf(s.lij[0]===e[0]&&s.lij[1]===e[1]&&s.lij[2]===e[2],"not the right tile?"),s}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(t){this._renderer.renderPatchBorders=t}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(t){this._renderer.visualizeNormals=t}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(t){this._renderer.renderingDisabled=t}get test(){const t=this;return{renderer:t._renderer,lercDecoder:t._lercDecoder,forceReload:()=>{t._rootTiles!=null&&t._rootTiles.length>0&&(t._mergeTile(t._rootTiles[0]),t._viewChangeUpdate())},getTiles:()=>t._allTiles.toArray(),getRenderedTiles(){fU.clear(),t._allTiles.forAll(i=>{i.visible&&i.rendered&&fU.push(i)});const e=fU.toArray();return FAe(t.renderOrder,e),e},lockTilingScheme(e,i){t._extentHelper.defaultTiledLayersExtent=i,t.tilingSchemeLogic.test.lockTilingScheme(e)}}}checkAllTilesWaterproofness(){if(!I8)return;const t=this._rootTiles;if(t==null)return;const e=s=>s?.renderData?.geometry?.indices?.length>0,i=(s,a)=>{e(s)&&console.error("Tile[",s.lij,"] has geometry although parent[",a.lij,"] has geom")},r=s=>{if(s.intersectsClippingArea)if(s.renderData&&!s.renderData.geometryState&&console.error("Tile[",s.lij,"] has renderData but not geometryState"),s.renderData&&!s.renderData.geometry&&console.error("Tile[",s.lij,"] has renderData but not geometryInfo"),!s.renderData?.geometry||(s.renderData.geometry.indices?.length??0)>0||console.error("Tile[",s.lij,"] has renderData but no indices - geometryInfo: ",s.renderData.geometry),e(s)){s.checkGeometryWaterproofness();for(const a of s.children)i(a,s)}else if(s.isLeaf)console.error("Tile[",s.lij,"] has no geometry and no children, from root to leaf");else for(const a of s.children)r(a)},n=s=>{const a=s.parent?.visible??!0,u=s.visible;s.computeVisibility();const p=s.visible;if(u!==p&&a&&console.error(" Tile[",s.lij,"] has out of date visibility: ",u," instead of ",p),!s.isLeaf)for(const y of s.children)n(y)};for(const s of t)r(s),n(s)}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(t){return this.isGlobal&&t[2]===this.lijEastEnd(t[0])-1}isWestEndWrap(t){return this.isGlobal&&t[2]===0}lijEastEnd(t){return 2**(t+(this.spatialReference!=null&&this.spatialReference.isGeographic?1:0))}wrapEastWest(t){const e=this.lijEastEnd(t[0]),i=t[2];if(0<=i&&i<e)return t;if(!this.isGlobal)return null;const r=(i+(i<0?e:0))%e;return[t[0],t[1],r]}enableInternalChecks(t){_mt(t)}enableWaterproofnessChecks(t){vmt(t)}};Mi._tileMemcacheKey="TerrainTileMemcache",_([T()],Mi.prototype,"_renderer",void 0),_([T({constructOnly:!0})],Mi.prototype,"_scaleRangeQueries",void 0),_([T({constructOnly:!0})],Mi.prototype,"view",void 0),_([T({constructOnly:!0})],Mi.prototype,"overlayManager",void 0),_([T()],Mi.prototype,"_hasPendingUpdates",void 0),_([T()],Mi.prototype,"_asyncWorkItems",void 0),_([T()],Mi.prototype,"_allTilesDirty",void 0),_([T()],Mi.prototype,"_allTilesSorted",void 0),_([T()],Mi.prototype,"_viewChanged",void 0),_([T()],Mi.prototype,"_splitLimits",void 0),_([T({readOnly:!0})],Mi.prototype,"_watchUpdatingTracking",void 0),_([T()],Mi.prototype,"_frameTask",void 0),_([T({readOnly:!0})],Mi.prototype,"snapLevel",null),_([T({readOnly:!0})],Mi.prototype,"lodSnapping",null),_([T()],Mi.prototype,"_userClippingExtent",null),_([T()],Mi.prototype,"_rootTilesExtent",void 0),_([T({readOnly:!0})],Mi.prototype,"extent",null),_([T({readOnly:!0})],Mi.prototype,"groundExtent",null),_([T({readOnly:!0})],Mi.prototype,"_tilingSchemeExtent",null),_([T({readOnly:!0})],Mi.prototype,"updating",null),_([T({readOnly:!0})],Mi.prototype,"running",null),_([T(fgt)],Mi.prototype,"updatingProgress",void 0),_([T({readOnly:!0})],Mi.prototype,"updatingProgressValue",null),_([T()],Mi.prototype,"_maxNumUpdating",void 0),_([T()],Mi.prototype,"baseOpacity",null),_([T()],Mi.prototype,"hasCompositeBlendMode",void 0),_([T({readOnly:!0})],Mi.prototype,"viewingMode",null),_([T()],Mi.prototype,"maxTextureScale",void 0),_([T({readOnly:!0})],Mi.prototype,"ready",null),_([T({value:ZS.FRONT_TO_BACK})],Mi.prototype,"renderOrder",null),_([T({readOnly:!0})],Mi.prototype,"rootTiles",null),_([T()],Mi.prototype,"_rootTiles",void 0),_([T({readOnly:!0})],Mi.prototype,"spatialReference",null),_([T({type:mt})],Mi.prototype,"backgroundColor",null),_([T({value:!1})],Mi.prototype,"slicePlaneEnabled",null),_([T({readOnly:!0})],Mi.prototype,"tilingScheme",void 0),_([T({readOnly:!0})],Mi.prototype,"tilingSchemeLocked",null),_([T({readOnly:!0})],Mi.prototype,"tilingSchemeLogic",void 0),_([T()],Mi.prototype,"wireframe",null),_([T({value:!1})],Mi.prototype,"suspended",null),_([T()],Mi.prototype,"textureFadeDuration",null),_([T()],Mi.prototype,"visibleElevationBounds",void 0),_([T()],Mi.prototype,"rootTileElevationBounds",void 0),_([T()],Mi.prototype,"_layerViewsDirty",void 0),_([T()],Mi.prototype,"renderPatchBorders",null),_([T()],Mi.prototype,"visualizeNormals",null),_([T()],Mi.prototype,"renderingDisabled",null),Mi=W$=_([Z("esri.views.3d.terrain.TerrainSurface")],Mi);const fvt=Mi;function Khe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function O4e(t){const e=t.children;if(!e[0])return!1;for(const i of e)if(i.shouldLoad)return!0;for(const i of e)if(O4e(i))return!0;return!1}function mvt(t){return t.isLeaf&&(t.parent?.shouldLoad??!1)}const Il=ji(),gvt=Di(),fU=new xi,mU={spatialReference:null,extent:Di(),context:"ground"},C9={spatialReference:null,extent:null,scale:0};function Qhe(t,e,i){for(const r of t){if(!r.containsPointXY(e,i))continue;let n=r;for(;n&&!n.renderData;){const a=(e>n.extentMidX?1:0)+(i<n.extentMidY?2:0);n=n.children[a]}const s=n?.renderData?.geometryState.samplerData??null;return Ln(e,i,s)}return null}let yvt=class{constructor(e,i,r,n){this.operation=e,this.geometry=i,this.states=r,this.sync=n}},nA=class extends Ke{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,i){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((n,s)=>{const a=this._ensureGeomRecord(e,s);n.forEach(({geometry:u,operation:p,states:y},b)=>{let S=!1;if(p===Sn.UPDATE){const C=a.get(b);if(C){if(y&Gs.TRANSFORMATION){const O=this.model.getObject(s);this.model.updateRenderGeometryTransformation(O,u,C)&&(S=!0)}S||i.updates.push({renderGeometry:C,updateType:y})}else zt(!1,"ModelDirtySet.commitLayer: invalid update")}if(p===Sn.REMOVE||S){const C=a.get(b);C?(i.removes.push(C),a.delete(b)):p===Sn.REMOVE&&zt(!1,"ModelDirtySet.commitLayer: invalid remove")}if(p===Sn.ADD||S){const C=this.model.getObject(s);if(C!=null){const O=this.model.getRenderGeometry(C,u);i.adds.push(O),a.set(b,O)}}}),a.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(e,i){const r=this._dirtyGeomRecords.get(e);r&&r.forEach((n,s)=>{const a=this._ensureGeomRecord(e,s);n.forEach(({geometry:u,operation:p,states:y,sync:b},S)=>{let C=!1;if(p===Sn.UPDATE&&b){const O=a.get(S);if(O){if(y&Gs.TRANSFORMATION){const P=this.model.getObject(s);this.model.updateRenderGeometryTransformation(P,u,O)&&(C=!0)}C||i.updates.push({renderGeometry:O,updateType:y})}else zt(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,i){const r=this._residentGeomRecords.get(e);r&&r.forEach(n=>n.forEach(s=>i.push(s)))}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,null,Sn.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Gs.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Gs.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Gs.OCCLUDEE,e)}attributesChanged({object:e,geometry:i,sync:r}){this._updateOrCreateDirtyRecord(e,i,null,Sn.UPDATE,Gs.GEOMETRY,r)}layerAdded(e){e.objects.forAll(i=>this._layerObjectAdded(e,i))}layerRemoved(e){e.objects.forAll(i=>this._layerObjectRemoved(e,i))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,i){const r=e.id;for(const n of i.geometries)this._geometryAdded(i,n,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const i of e.objects)this._layerObjectAdded(e.layer,i)}layerObjectsRemoved(e){for(const i of e.objects)this._layerObjectRemoved(e.layer,i)}_layerObjectRemoved(e,i){const r=e.id;for(const n of i.geometries)this._geometryRemoved(i,n,r)}transformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(n=>{this._updateOrCreateDirtyRecord(e,n.geometry,i,Sn.UPDATE,Gs.TRANSFORMATION)})}shaderTransformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(n=>{n.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,Sn.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,Sn.REMOVE)}_updateOrCreateDirtyRecord(e,i,r,n,s=Gs.NONE,a=!1){r=r??this._getParentLayerId(e);const u=e.id,p=i.id,y=this._ensureDirtyRecord(r,u),b=y.get(p);if(b){const S=b.operation;S===Sn.REMOVE&&n===Sn.ADD&&b.states!==Gs.NONE?b.operation=Sn.UPDATE:S===Sn.REMOVE&&n===Sn.ADD||S===Sn.ADD&&n===Sn.REMOVE?y.delete(p):S!==Sn.UPDATE||n!==Sn.REMOVE&&n!==Sn.UPDATE?(zt((S===Sn.REMOVE||S===Sn.ADD)&&n===Sn.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),b.states|=s):(b.operation=n,b.states|=s),b.sync=b.sync||a}else y.set(p,new yvt(n,i,s,a));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let n=r.get(i);return n||(n=new Map,r.set(i,n)),n}get _hasDirtyGeometryRecords(){return Iu(this._dirtyGeomRecords,e=>Iu(e,i=>i&&i.size>0))}_ensureDirtyRecord(e,i){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let n=r.get(i);return n||(n=new Map,r.set(i,n)),n}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:Z9e}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forEach((r,n)=>{r.forEach((s,a)=>{i.length>0&&(i+=`
`),i+=n+"."+a;const u=[];s.forEach(p=>{const y=p.operation;u[y]||(u[y]=[]),u[y].push(p.geometry.id)});for(let p=0;p<u.length;p++)if(u[p]){i+=" "+e[p-1]+": ";for(let y=0;y<u[p].length;y++)i+=u[p][y]+", "}})}),i}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((i,r)=>i+r.size,0)},commit:i=>e._dirtyGeomRecords.forEach((r,n)=>e.commitLayer(n,i))}}};_([T({constructOnly:!0})],nA.prototype,"model",void 0),_([T()],nA.prototype,"dirty",void 0),nA=_([Z("esri.views.3d.webgl-engine.lib.ModelDirtySet")],nA);const vvt=nA;let X$=class extends Ke{constructor(){super(...arguments),this.dirtySet=new vvt({model:this}),this._content=new Map,this._originFactory=new PQ(null)}getObject(e){return this._content.get(e)}add(e){const i=e.id;zt(!this._content.has(i),"Model/Stage already contains object to be added"),this._content.set(i,e),v8(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),v8(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const i of e)i&&(zt(!this._content.has(i.id),"Model/Stage already contains object to be added"),this._content.set(i.id,i))}removeMany(e){for(const i of e)i&&(zt(this._content.has(i.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(i.id))}has(e){return this._content.has(e.id)}forEachOfType(e,i){this._content.forEach(r=>{r.type===e&&i(r)})}getRenderGeometry(e,i){const r=new JS(i,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});r.transformation=e.getCombinedStaticTransformation(i,ede);const{localOrigin:n}=i;return r.localOrigin=n??this._originFactory.getOrigin(r.boundingSphere),r}updateRenderGeometryTransformation(e,i,r){if(e==null)return!1;r.transformation=e.getCombinedStaticTransformation(i,ede);const n=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==n}getStats(){const e={},i=Array.from(this._content.values());for(let r=0;r<Gn.COUNT;++r)e[r]=i.filter(n=>n.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};_([T({constructOnly:!0})],X$.prototype,"dirtySet",void 0),X$=_([Z("esri.views.3d.webgl-engine.parts.Model")],X$);const ede=Ze();let _vt=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];return i}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=bvt(e)}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const n=i[r],s=n+i[r+1];for(let a=n;a<s;a++)if(!e(a))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const n=i[r];if(!e(n,n+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let n=0;n<r.length;n+=2){const s=r[n],a=s+r[n+1],u=e[s],p=e[a];i[n]=u,i[n+1]=p-u}return i}};function bvt(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let n=1;n<t.length;n++){const s=t[n];i+r===s?r+=1:(e.push(i),e.push(r),i=s,r=1)}return e.push(i),e.push(r),e}let wvt=class{constructor(e,i){this.offsets=i,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const r=this.count;this.visibility=new _vt(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let n=0;n<r;n++)this.materialDataIndices[n]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:i}=xvt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=i}}};function xvt(t,e,i){const r=[],n=[];let s=i.length,a=i.length;return e.forEachComponent(u=>(t[u]>0?(s!==u-1&&(r.length&&r.push(i[s+1]-r[r.length-1]),r.push(i[u])),s=u):(a!==u-1&&(n.length&&n.push(i[a+1]-n[n.length-1]),n.push(i[u])),a=u),!0)),r.length&&r.push(i[s+1]-r[r.length-1]),n.length&&n.push(i[a+1]-n[n.length-1]),{highlightRanges:r,defaultRanges:n}}let sA=class extends Ke{constructor(){super(...arguments),this.visible=YT.Hidden}destroy(){this.intersectionGeometry=ct(this.intersectionGeometry)}};var YT;_([T({autoDestroy:!0})],sA.prototype,"renderable",void 0),_([T({autoDestroy:!0})],sA.prototype,"components",void 0),sA=_([Z("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],sA),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(YT||(YT={}));function Tvt(t,e,i,r){if(i>=e)return t;t==null&&(t=Svt());const n=t.isVisibleBit;let s=t.data;const a=M4e(s),u=i/a|0,p=i-a*u,y=(e-1)/a|0,b=s,S=r===n;if(!(i<b.length*a)&&S){const C=u+1,O=Math.ceil(b.length*pD),P=y+1;let $=Math.max(C,O);$=Math.min($,P),s=new Uint32Array($),s.set(b)}return u<s.length&&(s[u]=Cvt(s[u],p,S)),t.data=s,t}function R4e(t,e){if(t==null)return!0;const{isVisibleBit:i,data:r}=t,n=M4e(r);return e<r.length*n?Evt(i,r,e,n):!t.isVisibleBit}function Svt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function Evt(t,e,i,r){const n=i/r|0,s=i-n*r;return Avt(e[n],s)===t}function M4e(t){return t.BYTES_PER_ELEMENT*8}function Cvt(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function Avt(t,e){return(t&1<<e)!=0}let Ovt=class{constructor(e,i){this._components=i,this._indices=e.indices?v0(e.indices):Iw(e.positions.length/3),this._positions=e.positions,this._componentIntersectionData=new Array(i.count)}destroy(){this._positions=null,this._indices=null,this._componentIntersectionData.length=0,this._perComponentAabbs=null}getComponentAabb(e,i){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*e+r];return i}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,n,s,a,u){const p=new cR(this._positions,3),y=this._indices,b=this._components.offsets,S=bTe(e,i,Rvt),C=e[2],O=i[2];this._components.visibility.forEachComponent(P=>{if(!R4e(this._components.pickability,P))return!0;const $=this.getComponentAabb(P,Mvt);if(a!=null){const j=a[P];s!=null?s.componentOffset=j:(e[2]=C-j,i[2]=O-j)}if(s?.applyToAabb($),!WK($,e,S,r))return!0;const N=b[P]/3,z=b[P+1]/3,U=(j,G,q)=>u(P,j,Lc(G,G,n),q);return s==null&&z-N>C4e?(this._componentIntersectionData[P]==null&&(this._componentIntersectionData[P]=new Eee(this._indices,N,z,p)),this._componentIntersectionData[P].intersectRay({r0:e,r1:i},U)):_R(e,i,N,z,y,p,void 0,s,U),!0})}_computePerComponentAabbs(){const e=this._components.count,i=Fn(6*e),r=this._indices,n=this._positions,s=this._components.offsets;let a=0;for(let u=0;u<e;u++){const p=s[u],y=s[u+1];let b=1/0,S=1/0,C=1/0,O=-1/0,P=-1/0,$=-1/0;for(let N=p;N<y;N++){const z=3*r[N],U=n[z],j=n[z+1],G=n[z+2];b=Math.min(b,U),S=Math.min(S,j),C=Math.min(C,G),O=Math.max(O,U),P=Math.max(P,j),$=Math.max($,G)}i[a++]=b,i[a++]=S,i[a++]=C,i[a++]=O,i[a++]=P,i[a++]=$}return i}get positions(){return this._positions}get indices(){return this._indices}};const Rvt=H(),Mvt=eo();let Pvt=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},Ivt=class{constructor(e,i,r,n){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=n}dispose(){this.vao.dispose()}},Cee=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function $vt(t,e){return{near:t,far:e}}function LR(t){return t?SO(t,1/0,-1/0):$vt(1/0,-1/0)}function SO(t,e,i){return t.near=e,t.far=i,t}function KS(t,e){e!=null&&(t.near=Math.min(t.near,e.near),t.far=Math.max(t.far,e.far))}function A9(t,e){return t.near<=e&&e<=t.far}const aW={near:0,far:0};function Lvt(t,e){const i=LR(),{eye:r,frustum:n,viewForward:s}=t;e.forAll(a=>{const u=a.offsetObb!=null?a.offsetObb:a.obb,p=He(Ao(pu,u.center,r),s),y=E7(u,s);if(A9(i,p-y)&&A9(i,p+y))return;const b=zvt(u,n);if(b===-1)return;if(b===0)return um.far=p+y,um.near=p-y,void KS(i,um);const S=O9.pushNew();S.near=p-y,S.far=p+y,S.mask=b,S.object=a});for(let a=0;a<O9.length;a++){const u=O9.data[a];if(A9(i,u.near)&&A9(i,u.far))continue;um.far=u.far,um.near=1/0,kvt(u.object.offsetObb!=null?u.object.offsetObb:u.object.obb,r,Dvt,y=>{let b=Nvt;for(let S=0;S<P4e&&y.length>0;S++){if(!(u.mask&1<<S))continue;Fvt(n[S],y,b);const C=y;y=b,b=C}for(let S=0;S<y.length;S+=3){$e(Bl,y.data[S],y.data[S+1],y.data[S+2]);const C=He(Ao(Bl,Bl,r),s);um.near=Math.min(um.near,C)}})===0&&(um.near=0),KS(i,um)}return O9.length=0,i}const O9=new xi({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),um=LR(),Bl=H(),O_=H(),Dvt=new xi({deallocator:null}),Nvt=new xi({deallocator:null});function Fvt(t,e,i){i.length=0;const r=e.length-3;gU(Bl,e,r);const n=qr(t,Bl);n<=0&&(i.push(Bl[0]),i.push(Bl[1]),i.push(Bl[2]));let s=0,a=n;for(;s<r;s+=3){gU(O_,e,s);const u=qr(t,O_);a*u<0&&(Ir(Bl,O_,Bl,u/(u-a)),Vl(i,Bl)),u<=0&&Vl(i,O_),a=u,Ie(Bl,O_)}a*n<0&&(gU(O_,e,r),Ir(Bl,O_,Bl,n/(n-a)),Vl(i,Bl))}function gU(t,e,i){return $e(t,e.data[i],e.data[i+1],e.data[i+2])}function Vl(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function kvt(t,e,i,r){Y2(ide,t.quaternion),Ao(pu,e,t.center),f0(pu,pu,ide);const n=8*((pu[0]<-t.halfSize[0]?-1:pu[0]>t.halfSize[0]?1:0)+3*(pu[1]<-t.halfSize[1]?-1:pu[1]>t.halfSize[1]?1:0)+9*(pu[2]<-t.halfSize[2]?-1:pu[2]>t.halfSize[2]?1:0)+13),s=tde[n];if(s===0)return s;MZ(R9,t.quaternion),RZ(R9,R9,t.halfSize);const a=(u,p)=>{const y=tde[n+p+1];return $e(u,((1&y)<<1)-1,(2&y)-1,((4&y)>>1)-1),Lc(u,u,R9),Ue(u,t.center,u)};return i.length=0,Vl(i,a(yU,0)),Vl(i,a(rde,1)),Vl(i,a(pu,2)),Vl(i,a(nde,3)),r(i),s===1||(i.length=0,Vl(i,yU),Vl(i,nde),Vl(i,a(pu,4)),Vl(i,a(sde,5)),r(i),s===2||(i.length=0,Vl(i,yU),Vl(i,sde),Vl(i,a(pu,6)),Vl(i,rde),r(i))),s}const tde=(()=>{const t=new Array(216);let e=0;const i=r=>{for(let n=0;n<r.length;n++)t[e+n]=r[n];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),P4e=4;function zvt(t,e){let i=0;for(let r=0;r<P4e;r++){const n=tb(t,e[r]);if(n>0)return-1;n===0&&(i|=1<<r)}return i}const R9=Pn(),ide=pd(),pu=H(),yU=H(),rde=H(),nde=H(),sde=H();let Uvt=class{constructor(e){this._objects=e}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?Lvt(e,this._objects.visibleObjects):null}};function jvt(t){const e=wn().vec3f(X.POSITION);return t.normals&&e.vec2i16(X.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===vs.Default?e.vec2f(X.UV0):t.textureCoordinates===vs.Atlas&&(e.vec2f(X.UV0),e.vec4u16(X.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(X.COLOR,{glNormalized:!0}),e}let Bvt=class{constructor(){this.externalColor=ji(),this.externalColorMixMode=Xs.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},Vvt=class extends zn{constructor(e,i){super(e,"int",hr.Draw,(r,n,s)=>r.setUniform1i(e,i(n,s)))}};var w0;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(w0||(w0={}));const Aee=429496.7296;function I4e(t,e){yO(t/Aee*.5+.5,e)}function Gvt(t,e){switch(e.componentData){case w0.Varying:return Hvt(t,e);case w0.Uniform:return qvt(t);case w0.COUNT:return;default:e.componentData}}function Hvt(t,e){const{vertex:i,fragment:r}=t;i.include(fd),i.uniforms.add(new Wh("componentColorTex",s=>s.componentParameters.texture.texture)),t.attributes.add(X.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const n=e.output===oe.ObjectAndLayerIdColor;n&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(SSe),i.constants.add("elevationScale","float",2*Aee),i.constants.add("stride","float",Me("enable-feature:objectAndLayerId-rendering")?3:2),i.code.add(F`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),i.code.add(F`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${n?F`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:F`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(F`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?F`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function qvt(t){const{vertex:e,fragment:i}=t;e.uniforms.add(new y8("externalColor",r=>r.componentParameters.externalColor)),i.uniforms.add(new Vvt("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(F`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(F`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}var Du;function Wvt(t,e){const i=t.vertex;switch(i.code.add(F`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case Du.None:i.code.add(F`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Du.Opaque:i.code.add(F`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Du.Transparent:i.code.add(F`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Du.COUNT:break;default:e.vertexDiscardMode}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(Du||(Du={}));var x0;function kjt(t){return t&&L0(t)?x0.Mars:t&&D0(t)?x0.Moon:x0.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(x0||(x0={}));var Pu;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(Pu||(Pu={}));let Wi=class extends rc{constructor(){super(...arguments),this.output=oe.Color,this.textureCoordinateType=vs.None,this.componentData=w0.Uniform,this.cullFace=rn.Back,this.vertexDiscardMode=Du.None,this.doubleSidedMode=kn.WindingOrder,this.alphaDiscardMode=zr.Opaque,this.integratedMeshMode=Pu.None,this.transparencyPassType=Ut.NONE,this.ellipsoidMode=x0.Earth,this.pbrMode=Gt.Disabled,this.normalType=_r.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};_([ce({count:oe.COUNT})],Wi.prototype,"output",void 0),_([ce({count:vs.COUNT})],Wi.prototype,"textureCoordinateType",void 0),_([ce({count:w0.COUNT})],Wi.prototype,"componentData",void 0),_([ce({count:rn.COUNT})],Wi.prototype,"cullFace",void 0),_([ce({count:Du.COUNT})],Wi.prototype,"vertexDiscardMode",void 0),_([ce({count:kn.COUNT})],Wi.prototype,"doubleSidedMode",void 0),_([ce({count:zr.COUNT})],Wi.prototype,"alphaDiscardMode",void 0),_([ce({count:Pu.COUNT})],Wi.prototype,"integratedMeshMode",void 0),_([ce({count:Ut.COUNT})],Wi.prototype,"transparencyPassType",void 0),_([ce({count:x0.COUNT})],Wi.prototype,"ellipsoidMode",void 0),_([ce({count:Gt.COUNT})],Wi.prototype,"pbrMode",void 0),_([ce({count:_r.COUNT})],Wi.prototype,"normalType",void 0),_([ce()],Wi.prototype,"spherical",void 0),_([ce()],Wi.prototype,"doublePrecisionRequiresObfuscation",void 0),_([ce()],Wi.prototype,"hasVertexColors",void 0),_([ce()],Wi.prototype,"hasNormals",void 0),_([ce()],Wi.prototype,"hasSlicePlane",void 0),_([ce()],Wi.prototype,"hasColorTexture",void 0),_([ce()],Wi.prototype,"receiveAmbientOcclusion",void 0),_([ce()],Wi.prototype,"receiveShadows",void 0),_([ce()],Wi.prototype,"blendingEnabled",void 0),_([ce()],Wi.prototype,"hasScreenSpaceReflections",void 0),_([ce()],Wi.prototype,"hasPolygonOffset",void 0),_([ce()],Wi.prototype,"hasMetallicRoughnessTexture",void 0),_([ce()],Wi.prototype,"hasEmissionTexture",void 0),_([ce()],Wi.prototype,"hasOcclusionTexture",void 0),_([ce()],Wi.prototype,"hasNormalTexture",void 0),_([ce()],Wi.prototype,"hasOccludees",void 0),_([ce()],Wi.prototype,"multipassEnabled",void 0),_([ce()],Wi.prototype,"cullAboveGround",void 0),_([ce()],Wi.prototype,"hasCloudsReflections",void 0),_([ce()],Wi.prototype,"snowCover",void 0),_([ce()],Wi.prototype,"objectAndLayerIdColor",void 0),_([ce({constValue:!1})],Wi.prototype,"occlusionPass",void 0),_([ce({constValue:hr.Draw})],Wi.prototype,"pbrTextureBindType",void 0),_([ce({constValue:!0})],Wi.prototype,"hasSliceHighlight",void 0),_([ce({constValue:!1})],Wi.prototype,"hasSliceInVertexProgram",void 0),_([ce({constValue:!1})],Wi.prototype,"useCustomDTRExponentForWater",void 0),_([ce({constValue:!1})],Wi.prototype,"hasVertexTangents",void 0),_([ce({constValue:!0})],Wi.prototype,"supportsTextureAtlas",void 0),_([ce({constValue:!1})],Wi.prototype,"highStepCount",void 0),_([ce({constValue:!1})],Wi.prototype,"instancedDoublePrecision",void 0),_([ce({constValue:!1})],Wi.prototype,"hasModelTransformation",void 0),_([ce({constValue:!0})],Wi.prototype,"useFillLights",void 0),_([ce({constValue:!1})],Wi.prototype,"objectAndLayerIdColorInstanced",void 0);function ode(t,e){t.include(Dw,e),t.fragment.include(dO);const i=t.fragment;i.uniforms.add(new y8("baseColor",r=>r.baseColor)),i.uniforms.add(new A2("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(F`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(F`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(F`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function ade(t,e){const i=t.fragment;switch(e.doubleSidedMode){case kn.None:i.code.add(F`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case kn.View:t.include(zT,e),i.code.add(F`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case kn.WindingOrder:i.code.add(F`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case kn.COUNT:}switch(e.normalType){case _r.Attribute:case _r.Compressed:t.include(aN,e),i.code.add(F`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case _r.ScreenDerivative:t.include(zT,e),i.code.add(F`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case _r.Ground:e.spherical?(t.include(zT,e),i.code.add(F`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(F`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),i.code.add(F`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case _r.COUNT:}}function Xvt(t,e){const i=t.fragment;if(e.hasColorTexture&&(e.output===oe.Color||e.alphaDiscardMode!==zr.Opaque)){t.include(iK,e);const r=e.textureCoordinateType===vs.Atlas;i.uniforms.add(new Wh("baseColorTexture",n=>n.texture)),r?(t.include(Vwe),i.code.add(F`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):i.code.add(F`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else i.code.add(F`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function Jvt(t){const e=new lr;e.include(zT,t),e.include(aN,t),e.include(Dw,t),e.include(g0,t),e.include(EE,t),e.include(Gvt,t),e.include(Zrt,t),e.include(eit,t),e.include(Xvt,t),e.include(Wvt,t);const{vertex:i,fragment:r}=e;t.pbrMode!==Gt.Normal&&t.pbrMode!==Gt.Schematic||(e.include(nK,t),t.hasNormalTexture&&e.include(RSe,t));const n=t.output===oe.Shadow||t.output===oe.ShadowHighlight||t.output===oe.ShadowExcludeHighlight;n&&t.componentData===w0.Varying?i.code.add(F`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(F`#define discardShadows(castShadows) {}`);const s=t.integratedMeshMode===Pu.ColorOverlay||t.integratedMeshMode===Pu.ColorOverlayWithWater,a=s&&t.output===oe.Color&&t.pbrMode===Gt.WaterOnIntegratedMesh;return s&&(e.include(rw,t),e.include(Tot,t),t.spherical?i.code.add(F`
      const float invEllipsoidRadius = ${F.float(1/(t.ellipsoidMode===x0.Earth?ur.radius:t.ellipsoidMode===x0.Mars?p0.radius:Tg.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(F`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),a&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),i.code.add(F`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===oe.ObjectAndLayerIdColor?F`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${F.float(Wo)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===oe.ObjectAndLayerIdColor?F`forwardObjectAndLayerIdColor();`:""}
      ${a?t.spherical?F`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:F`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?F`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===oe.Alpha&&(r.include(ld),e.include(Jc,t),e.include(ode,t),s&&r.uniforms.add(new kt("ovColorTex",(u,p)=>Sq(u,p))),r.code.add(F`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?F`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?F`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===oe.Color&&(r.include(ld),e.include(Jc,t),e.include(ode,t),e.include(ade,t),e.include(rw,t),t.receiveShadows?(e.include(uN,t),r.code.add(F`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(F`float evaluateShadow() { return 0.0; }`),s&&r.uniforms.add(new kt("ovColorTex",(u,p)=>Sq(u,p))),r.code.add(F`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?F`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?F`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===Gt.Normal||t.pbrMode===Gt.Schematic?(U0(r),r.code.add(F`
        ${t.pbrMode===Gt.Normal?F`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?r.code.add(F`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(F`vec3 shadingNormal = normalVertex;`),r.code.add(F`${t.spherical?F`vec3 normalGround = normalize(positionWorld());`:F`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(F`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();

        ${t.snowCover?F`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?F` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?r.code.add(F`float shadow = evaluateShadow();`):t.spherical?(PE(r),r.code.add(F`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(F`float shadow = 0.0;`),a&&r.uniforms.add(new kt("ovNormalTex",(u,p)=>p.overlay?.getTexture(bn.WaterNormal))),t.snowCover&&r.code.add(F`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),r.code.add(F`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?F` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${a?F`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(F`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===Ut.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===oe.Depth||n)&&(e.include($g,t),r.code.add(F`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===oe.Normal&&(e.include(ade,t),r.code.add(F`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${t.normalType===_r.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===oe.ObjectAndLayerIdColor&&e.fragment.code.add(F`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?F`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===oe.Highlight&&(e.include(Bv),r.code.add(F`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?F`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}const Yvt=Object.freeze(Object.defineProperty({__proto__:null,build:Jvt},Symbol.toStringTag,{value:"Module"}));let $4e=class L4e extends wr{initializeConfiguration(e,i){i.spherical=e.viewingMode===ht.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new fr(e.rctx,L4e.shader.get().build(this.configuration),D4e)}_setPipelineState(e){const i=this.configuration,r=i.integratedMeshMode!==Pu.None,n=e===Ut.NONE,s=e===Ut.FrontFace;return mi({blending:i.output!==oe.Color&&i.output!==oe.Alpha||!i.blendingEnabled?null:n?Xu:Wg(e),culling:P7(i.cullFace),depthTest:{func:Vv(e)},depthWrite:n||s?ic:null,colorWrite:Oi,stencilWrite:r||i.hasOccludees?P0:null,stencilTest:r?Hrt(Kl.IntegratedMeshMaskExcluded):i.hasOccludees?Gv:null,polygonOffset:n||s?i.hasPolygonOffset?{factor:2,units:2}:null:iN})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};$4e.shader=new pr(Yvt,()=>ke(()=>import("./ComponentShader.glsl-2b467dd6.js"),[],import.meta.url));const D4e=new Map([[X.POSITION,0],[X.NORMAL,1],[X.NORMALCOMPRESSED,1],[X.COLOR,2],[X.UV0,3],[X.UVREGION,4],[X.COMPONENTINDEX,5]]);let Zvt=class extends Vr{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},Oee=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function Bn(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const n=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(s){const a=this[r];if(a==null)this[r]=s;else{if(n.equals(a,s))return;n.copy(a,s)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(n){this[r]!==n&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=n,this._setDirty())}})}}function lde(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let MN=class{constructor(e){this._low=H(),this._high=H(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){Ie(this._low,Ie(cde,e));const i=Ao(cde,e,this._low);Ie(this._high,i)}get(e){return Ue(e,this._low,this._high)}getLowScaled(e){return Pe(e,this._low,1)}};const cde=ts();let go=class extends Zvt{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=vi(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Ma(lN),this.emissiveFactor=st(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new J$,this.componentParameters=new w4,this.textureAlphaCutoff=l8,this.alphaDiscardMode=zr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=x0.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new Wi;const r=new MN(e.position),n=NSe(e.rotationScale);Rw(n,n),this.transformNormalGlobalFromModel=M_e(od(n,n)),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=Gi(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,i,r,n){const s=this._techniqueConfiguration;s.hasVertexColors=n.colors,s.hasNormals=n.normals,s.textureCoordinateType=n.textureCoordinates,s.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,s.hasEmissionTexture=this.emissionTexture!=null,s.hasOcclusionTexture=this.occlusionTexture!=null,s.hasNormalTexture=this.normalTexture!=null,s.transparencyPassType=i.identifier===$c.Material&&r.transparencyPassType!=null?r.transparencyPassType:Ut.NONE,s.multipassEnabled=i.identifier===$c.Material&&r.multipassEnabled,s.cullAboveGround=i.identifier===$c.Material&&r.multipassTerrain.cullAboveGround,s.ellipsoidMode=this.ellipsoidMode,s.componentData=this.componentParameters.type,s.cullFace=this.commonMaterialParameters.cullFace,s.doubleSidedMode=this.commonMaterialParameters.doubleSided?kn.View:kn.None,s.hasColorTexture=this.baseColorTexture!=null;const a=this._computeWhichMaterialPass();if(s.blendingEnabled=a===ol.Transparent||a===ol.OpaqueAndTransparent,s.alphaDiscardMode=this.alphaDiscardMode,s.integratedMeshMode=this.isIntegratedMesh?e_t(r)?Qvt(r)?Pu.ColorOverlayWithWater:Pu.ColorOverlay:Pu.NoOverlay:Pu.None,s.hasPolygonOffset=this.polygonOffsetEnabled,s.pbrMode=s.integratedMeshMode===Pu.ColorOverlayWithWater?Gt.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?Gt.Schematic:Gt.Normal:Gt.Disabled,s.normalType=s.integratedMeshMode===Pu.None?s.hasNormals?_r.Compressed:_r.ScreenDerivative:_r.Ground,s.hasSlicePlane=r.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,i.identifier===$c.ShadowMap)s.output=oe.Shadow,s.vertexDiscardMode=Du.None;else if(i.identifier===$c.Highlight)s.output=oe.Highlight,s.vertexDiscardMode=Du.None;else{switch(a===ol.OpaqueAndTransparent?s.vertexDiscardMode=i.transparent?Du.Opaque:Du.Transparent:s.vertexDiscardMode=Du.None,s.output=i.output,s.receiveAmbientOcclusion=!1,s.receiveShadows=!1,i.output){case oe.Color:s.receiveAmbientOcclusion=r.ssao!=null,s.hasOccludees=r.hasOccludees,s.receiveShadows=r.shadowMap.ready,s.hasScreenSpaceReflections=r.ssr.lastFrameColor!=null,s.hasCloudsReflections=r.cloudsFade.data!=null;break;case oe.Alpha:s.hasOccludees=r.hasOccludees;break;case oe.ObjectAndLayerIdColor:s.objectAndLayerIdColor=!0}s.snowCover=this.hasSnowCover(r)}return this._technique=e.releaseAndAcquire($4e,s,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,i,r){if(this.objectOpacity===0)return;const n=r.renderable.geometry,s=r.components,a=r.renderable.meta.cameraDepthSquared,u=s.geometryRanges,p=s.highlightRanges,y=s.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case ol.Opaque:e.materialOpaque.submitDraw(this,n,u,a);break;case ol.Transparent:e.materialTransparent.submitDraw(this,n,u,a);break;case ol.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,n,u,a),e.materialTransparent.submitDraw(this,n,u,a);break;case ol.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,n,u,a),Kvt(i)&&e.highlightIntegratedMesh.submitDraw(this,n,u,a)}const b=this.componentParameters.castShadows!==so.None;b&&e.shadowMap.submitDraw(this,n,u,a),p!=null&&(e.highlight.submitDraw(this,n,p,a),b&&e.highlightShadowMap.submitDraw(this,n,p,a)),b&&y!=null&&e.defaultShadowMap.submitDraw(this,n,y,a)}_computeWhichMaterialPass(){return this.isIntegratedMesh?ol.IntegratedMesh:this.objectOpacity<1?ol.Transparent:this.componentParameters.opaqueOverride===so.All?ol.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===zr.Blend||this.alphaDiscardMode===zr.MaskBlend?ol.Transparent:this.componentParameters.transparent===so.None?ol.Opaque:this.componentParameters.transparent===so.All?ol.Transparent:ol.OpaqueAndTransparent}};var ol,so;_([Bn({vectorOps:_ge})],go.prototype,"baseColor",void 0),_([Bn()],go.prototype,"usePBR",void 0),_([Bn()],go.prototype,"hasParametersFromSource",void 0),_([Bn({vectorOps:fie})],go.prototype,"mrrFactors",void 0),_([Bn({vectorOps:fie})],go.prototype,"emissiveFactor",void 0),_([Bn({dispose:!0})],go.prototype,"baseColorTexture",void 0),_([Bn({dispose:!0})],go.prototype,"metallicRoughnessTexture",void 0),_([Bn({dispose:!0})],go.prototype,"emissionTexture",void 0),_([Bn({dispose:!0})],go.prototype,"occlusionTexture",void 0),_([Bn({dispose:!0})],go.prototype,"normalTexture",void 0),_([Bn()],go.prototype,"objectOpacity",void 0),_([lde()],go.prototype,"commonMaterialParameters",void 0),_([lde()],go.prototype,"componentParameters",void 0),_([Bn()],go.prototype,"textureAlphaCutoff",void 0),_([Bn()],go.prototype,"alphaDiscardMode",void 0),_([Bn()],go.prototype,"isIntegratedMesh",void 0),_([Bn()],go.prototype,"polygonOffsetEnabled",void 0),_([Bn()],go.prototype,"ellipsoidMode",void 0),_([Bn()],go.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(ol||(ol={}));let J$=class extends Oee{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=rn.Back,this.hasSlicePlane=!0}};_([Bn()],J$.prototype,"doubleSided",void 0),_([Bn()],J$.prototype,"cullFace",void 0),_([Bn()],J$.prototype,"hasSlicePlane",void 0);let w4=class extends Oee{constructor(){super(...arguments),this.externalColor=vi(1,1,1,1),this.externalColorMixMode=Xs.Multiply,this.castShadows=so.All}get transparent(){return this.externalColor[3]<1?so.All:so.None}get opaqueOverride(){return this.externalColorMixMode===Xs.Replace&&this.externalColor[3]===1?so.All:so.None}get visible(){return this.externalColor[3]>0?so.All:so.None}get type(){return w0.Uniform}};_([Bn({vectorOps:_ge})],w4.prototype,"externalColor",void 0),_([Bn()],w4.prototype,"externalColorMixMode",void 0),_([Bn()],w4.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(so||(so={}));let oA=class extends Oee{constructor(){super(...arguments),this.texture=null,this.transparent=so.None,this.opaqueOverride=so.None,this.castShadows=so.None}get type(){return w0.Varying}};function Kvt(t){return t.overlay?.getTexture(bn.Highlight)!=null}function Qvt(t){return t.overlay?.getTexture(bn.WaterNormal)!=null}function e_t(t){return t.overlay?.getTexture(bn.ColorNoRasterImage)!=null}_([Bn()],oA.prototype,"texture",void 0),_([Bn()],oA.prototype,"transparent",void 0),_([Bn()],oA.prototype,"opaqueOverride",void 0),_([Bn()],oA.prototype,"castShadows",void 0);const z8=wn().vec3f(X.POSITION).u16(X.COMPONENTINDEX),N4e=wn().vec2u8(X.SIDENESS),t_t=Kc(N4e),lW=wn().vec3f(X.POSITION0).vec3f(X.POSITION1).vec3f(X.NORMAL).u16(X.COMPONENTINDEX).u8(X.VARIANTOFFSET,{glNormalized:!0}).u8(X.VARIANTSTROKE).u8(X.VARIANTEXTENSION,{glNormalized:!0}),cW=wn().vec3f(X.POSITION0).vec3f(X.POSITION1).vec3f(X.NORMALA).vec3f(X.NORMALB).u16(X.COMPONENTINDEX).u8(X.VARIANTOFFSET,{glNormalized:!0}).u8(X.VARIANTSTROKE).u8(X.VARIANTEXTENSION,{glNormalized:!0}),F4e=new Map([[X.POSITION0,0],[X.POSITION1,1],[X.COMPONENTINDEX,2],[X.VARIANTOFFSET,3],[X.VARIANTSTROKE,4],[X.VARIANTEXTENSION,5],[X.NORMAL,6],[X.NORMALA,6],[X.NORMALB,7],[X.SIDENESS,8]]);function ude(t,e,i){const r=e/3,n=new Uint32Array(i+1),s=new Uint32Array(i+1),a=(z,U)=>{z<U?n[z+1]++:s[U+1]++};for(let z=0;z<r;z++){const U=t[3*z],j=t[3*z+1],G=t[3*z+2];a(U,j),a(j,G),a(G,U)}let u=0,p=0;for(let z=0;z<i;z++){const U=n[z+1],j=s[z+1];n[z+1]=u,s[z+1]=p,u+=U,p+=j}const y=new Uint32Array(6*r),b=n[i],S=(z,U,j)=>{if(z<U){const G=n[z+1]++;y[2*G]=U,y[2*G+1]=j}else{const G=s[U+1]++;y[2*b+2*G]=z,y[2*b+2*G+1]=j}};for(let z=0;z<r;z++){const U=t[3*z],j=t[3*z+1],G=t[3*z+2];S(U,j,z),S(j,G,z),S(G,U,z)}const C=(z,U)=>{const j=2*z,G=U-z;for(let q=1;q<G;q++){const W=y[j+2*q],K=y[j+2*q+1];let se=q-1;for(;se>=0&&y[j+2*se]>W;se--)y[j+2*se+2]=y[j+2*se],y[j+2*se+3]=y[j+2*se+1];y[j+2*se+2]=W,y[j+2*se+3]=K}};for(let z=0;z<i;z++)C(n[z],n[z+1]),C(b+s[z],b+s[z+1]);const O=new Int32Array(3*r),P=(z,U)=>z===t[3*U]?0:z===t[3*U+1]?1:z===t[3*U+2]?2:-1,$=(z,U)=>{const j=P(z,U);O[3*U+j]=-1},N=(z,U,j,G)=>{const q=P(z,U);O[3*U+q]=G;const W=P(j,G);O[3*G+W]=U};for(let z=0;z<i;z++){let U=n[z];const j=n[z+1];let G=s[z];const q=s[z+1];for(;U<j&&G<q;){const W=y[2*U],K=y[2*b+2*G];W===K?(N(z,y[2*U+1],K,y[2*b+2*G+1]),U++,G++):W<K?($(z,y[2*U+1]),U++):($(K,y[2*b+2*G+1]),G++)}for(;U<j;)$(z,y[2*U+1]),U++;for(;G<q;)$(y[2*b+2*G],y[2*b+2*G+1]),G++}return O}let k4e=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?r_t:i_t}write(e,i,r){const n=this._edgeHashFunction(r);P9.seed=n;const s=P9.getIntRange(0,255),a=P9.getIntRange(0,this.settings.variants-1),u=.7,p=P9.getFloat(),y=255*(.5*n_t(-(1-Math.min(p/u,1))+Math.max(0,p-u)/(1-u),1.2)+.5);e.position0.setVec(i,r.position0),e.position1.setVec(i,r.position1),e.componentIndex.set(i,r.componentIndex),e.variantOffset.set(i,s),e.variantStroke.set(i,a),e.variantExtension.set(i,y)}trim(e,i){return e.slice(0,i)}};const Ree=new Float32Array(6),U8=new Uint32Array(Ree.buffer),qy=new Uint32Array(1);function i_t(t){const e=Ree;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],qy[0]=5381;for(let i=0;i<U8.length;i++)qy[0]=31*qy[0]+U8[i];return qy[0]}function r_t(t){const e=Ree;e[0]=W3(t.position0[0]),e[1]=W3(t.position0[1]),e[2]=W3(t.position0[2]),e[3]=W3(t.position1[0]),e[4]=W3(t.position1[1]),e[5]=W3(t.position1[2]),qy[0]=5381;for(let i=0;i<U8.length;i++)qy[0]=31*qy[0]+U8[i];return qy[0]}const hde=1e4;function W3(t){return Math.round(t*hde)/hde}function n_t(t,e){const i=t<0?-1:1;return Math.abs(t)**e*i}let j8=class{constructor(){this._commonWriter=new k4e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return lW.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),Ue(M9,r.faceNormal0,r.faceNormal1),We(M9,M9),e.normal.setVec(i,M9)}trim(e,i){return this._commonWriter.trim(e,i)}};j8.Layout=lW,j8.glLayout=Kc(lW,1);let B8=class{constructor(){this._commonWriter=new k4e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return cW.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),e.normalA.setVec(i,r.faceNormal0),e.normalB.setVec(i,r.faceNormal1)}trim(e,i){return this._commonWriter.trim(e,i)}};B8.Layout=cW,B8.glLayout=Kc(cW,1);const M9=H(),P9=new TA,yb=-1;var V8;function s_t(t,e,i,r=h_t){const n=t.vertices.position,s=t.vertices.componentIndex,a=gi(r.anglePlanar),u=gi(r.angleSignificantEdge),p=Math.cos(u),y=Math.cos(a),b=uW.edge,S=b.position0,C=b.position1,O=b.faceNormal0,P=b.faceNormal1,$=u_t(t),N=c_t(t),z=N.length/4,U=e.allocate(z);let j=0;const G=z,q=i.allocate(G);let W=0,K=0,se=0;const ae=HPe(0,z),le=new Float32Array(z);le.forEach((ve,Se,ee)=>{n.getVec(N[4*Se],S),n.getVec(N[4*Se+1],C),ee[Se]=un(S,C)}),ae.sort((ve,Se)=>le[Se]-le[ve]);const me=new Array,ne=new Array;for(let ve=0;ve<z;ve++){const Se=ae[ve],ee=le[Se],re=N[4*Se],fe=N[4*Se+1],ye=N[4*Se+2],we=N[4*Se+3],Ae=we===yb;if(n.getVec(re,S),n.getVec(fe,C),Ae)$e(O,$[3*ye],$[3*ye+1],$[3*ye+2]),Ie(P,O),b.componentIndex=s.get(re),b.cosAngle=He(O,P);else{if($e(O,$[3*ye],$[3*ye+1],$[3*ye+2]),$e(P,$[3*we],$[3*we+1],$[3*we+2]),b.componentIndex=s.get(re),b.cosAngle=He(O,P),a_t(b,y))continue;b.cosAngle<-.9999&&Ie(P,O)}K+=ee,se++,Ae||o_t(b,p)?(e.write(U,j++,b),me.push(ee)):l_t(b,a)&&(i.write(q,W++,b),ne.push(ee))}const pe=new Float32Array(me.reverse()),ge=new Float32Array(ne.reverse());return{regular:{instancesData:e.trim(U,j),lodInfo:{lengths:pe}},silhouette:{instancesData:i.trim(q,W),lodInfo:{lengths:ge}},averageEdgeLength:K/se}}function o_t(t,e){return t.cosAngle<e}function a_t(t,e){return t.cosAngle>e}function l_t(t,e){const i=co(t.cosAngle),r=uW.fwd,n=uW.ortho;return Ng(r,t.position1,t.position0),i*(He(qt(n,t.faceNormal0,t.faceNormal1),r)>0?-1:1)>e}function c_t(t){const e=t.faces.length/3,i=t.faces,r=t.neighbors;let n=0;for(let u=0;u<e;u++){const p=r[3*u],y=r[3*u+1],b=r[3*u+2],S=i[3*u],C=i[3*u+1],O=i[3*u+2];n+=p===yb||S<C?1:0,n+=y===yb||C<O?1:0,n+=b===yb||O<S?1:0}const s=new Int32Array(4*n);let a=0;for(let u=0;u<e;u++){const p=r[3*u],y=r[3*u+1],b=r[3*u+2],S=i[3*u],C=i[3*u+1],O=i[3*u+2];(p===yb||S<C)&&(s[a++]=S,s[a++]=C,s[a++]=u,s[a++]=p),(y===yb||C<O)&&(s[a++]=C,s[a++]=O,s[a++]=u,s[a++]=y),(b===yb||O<S)&&(s[a++]=O,s[a++]=S,s[a++]=u,s[a++]=b)}return s}function u_t(t){const e=t.faces.length/3,i=t.vertices.position,r=t.faces,n=vU.v0,s=vU.v1,a=vU.v2,u=new Float32Array(3*e);for(let p=0;p<e;p++){const y=r[3*p],b=r[3*p+1],S=r[3*p+2];i.getVec(y,n),i.getVec(b,s),i.getVec(S,a),Be(s,s,n),Be(a,a,n),qt(n,s,a),We(n,n),u[3*p]=n[0],u[3*p+1]=n[1],u[3*p+2]=n[2]}return u}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(V8||(V8={}));const uW={edge:{position0:H(),position1:H(),faceNormal0:H(),faceNormal1:H(),componentIndex:0,cosAngle:0},ortho:H(),fwd:H()},vU={v0:H(),v1:H(),v2:H()},h_t={anglePlanar:4,angleSignificantEdge:35};function d_t(t){const e=p_t(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return dde.updateSettings(t.writerSettings),pde.updateSettings(t.writerSettings),s_t(e,dde,pde)}function p_t(t,e,i,r){if(e){const a=ude(i,r,t.count);return new f_t(i,r,a,t)}const n=xq(t.buffer,t.stride/4,{originalIndices:i,originalIndicesLength:r}),s=ude(n.indices,r,n.uniqueCount);return{faces:n.indices,facesLength:n.indices.length,neighbors:s,vertices:z8.createView(n.buffer)}}let f_t=class{constructor(e,i,r,n){this.faces=e,this.facesLength=i,this.neighbors=r,this.vertices=n}};const dde=new j8,pde=new B8,Zjt=wn().vec3f(X.POSITION0).vec3f(X.POSITION1),m_t=wn().vec3f(X.POSITION0).vec3f(X.POSITION1).u16(X.COMPONENTINDEX);let g_t=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},y_t=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0;const r=new Ar(this.textureWidth,1);r.samplingMode=Si.NEAREST,r.wrapMode=Ai.CLAMP_TO_EDGE,this._texture=new yi(this._rctx,r),this._data=new ja(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,n,s,a){const u=e*this._fieldCount+i;this._dirty=!0,this._data.set(u,0,r),this._data.set(u,1,n),this._data.set(u,2,s),this._data.set(u,3,a)}setDataElement(e,i,r,n){const s=e*this._fieldCount+i;this._dirty=!0,this._data.set(s,r,n)}getDataElement(e,i,r){const n=e*this._fieldCount+i;return this._dirty=!0,this._data.get(n,r)}resizeToFit(e){const i=(e+1)*this._fieldCount;if(i>this._data.count){const r=Math.ceil(i/this.textureWidth)*this.textureWidth,n=new ja(new ArrayBuffer(4*r));n.typedBuffer.set(this._data.typedBuffer),this._data=n}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const z4e=65536;let v_t=class{constructor(e,i=1){this.textureBuffer=new y_t(e,i),this._indexManager=new g_t(z4e)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},U4e=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>z4e)return null;const i=new v_t(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const fde=Ee.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let __t=class{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._objects=[new xi,new xi],this._renderSubmit=new Uvt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=Me("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new U4e(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){zt(this._objects[YT.Hidden].length===0&&this._objects[YT.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();const e=this._objects.flatMap(i=>i.toArray());for(const i of e)i?.destroy()}createObject(e){const i=new sA;return i.toMapSpace=e.toMapSpace,i.transform=e.transform,i.obb=Mne(e.obb),i.components=new wvt(this._componentBufferManager,v0(e.geometry.componentOffsets)),i.renderable=this._createRenderable(e,i.components),i.intersectionGeometry=new Ovt(e.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(e){const i=e;this._objects[i.visible].removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=ao(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.components.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(e,i){const r=e,n=r.renderable.material,s=r.components,a=s.materialDataBuffer,u=s.materialDataIndices,p=new Bvt,y=a.textureBuffer,b=new Uint8Array(4),S=new Uint32Array(b.buffer);let C=0,O=0,P=0,$=s.verticalOffsets,N=1/0,z=-1/0,U=!1,j=!1,G=0;for(let q=0;q<s.count;q++){i(q,p),C+=+(p.externalColor[3]<1),O+=+(p.externalColorMixMode===Xs.Replace&&p.externalColor[3]===1),P+=+p.castShadows,TSe(p.externalColor,p.externalColorMixMode,b),b[2]=254&b[2]|+p.castShadows,y.setData(u[q],0,b[0],b[1],b[2],b[3]),U||(U=q>0&&G!==S[0]),G=S[0],j||(j=p.elevationOffset!==0),j&&$==null&&($=new Array(q).fill(0)),$!=null&&($[q]=p.elevationOffset),N=Math.min(N,p.elevationOffset),z=Math.max(z,p.elevationOffset),I4e(p.elevationOffset,b),y.setData(u[q],1,b[0],b[1],b[2],b[3]);const W=p.objectAndLayerIdColor;W!=null&&y.setData(u[q],2,W[0],W[1],W[2],W[3]),p.pickable!==R4e(s.pickability,q)&&(s.pickability=Tvt(s.pickability,s.count,q,p.pickable))}s.verticalOffsets=j?$:null,r.offsetObb=j?i2e(r.obb,N,z,this._viewingMode,r.offsetObb!=null?r.offsetObb:Mne(r.obb)):null,U||j||this._hasObjectAndLayerId?(n.componentParameters=new oA,n.componentParameters.castShadows=_U(P,s.count),n.componentParameters.transparent=_U(C,s.count),n.componentParameters.opaqueOverride=_U(O,s.count),n.componentParameters.texture=y,y.updateTexture()):(n.componentParameters=new w4,n.componentParameters.castShadows=p.castShadows?so.All:so.None,n.componentParameters.externalColor=p.externalColor,n.componentParameters.externalColorMixMode=p.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,i,r,n=!1){e.intersectionGeometry.getComponentAabb(i,r);const s=e,a=s.components.verticalOffsets;if(n||a==null)return r;const u=a[i];if(this._viewingMode===ht.Local||u===0)return r[2]+=u,r[5]+=u,r;const p=BHe(u);return p.localOrigin=s.transform.position,p.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}intersect(e,i,r,n,s,a){const u=e;s!=null&&(s.localOrigin=u.transform.position);const p=Rw(mde,u.transform.rotationScale);Ao(I9,i,u.transform.position),Ao($9,r,u.transform.position),Lc(I9,I9,p),Lc($9,$9,p);const y=od(mde,p);return u.intersectionGeometry.intersect(I9,$9,n,y,s,u.components.verticalOffsets,a)}addEdges(e,i,r,n){const s=e,{indices:a,positions:u}=s.intersectionGeometry,p=s.components.offsets;return i.addComponentObject(e,s.transform,{center:s.obb.center,radius:FHe(s.obb)},u,a,p,r,n)}async extractEdgeInformation(e,i,r){const n=e,s=n.components.visibility;if(s.allInvisible())return{buffer:m_t.createBuffer(0),origin:[0,0,0]};const{indices:a,positions:u}=n.intersectionGeometry,p=n.components.offsets,y=z8.createBuffer(u.length/3);$R(y.position.typedBuffer,u,y.position.typedBufferStride,3),AEe(y.position,y.position,n.transform.rotationScale),this._setComponentIndices(y.componentIndex,a,p);const b=y.count,S=this._computeVisibilityIndices(a,s,p,b);return{origin:An(n.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:S,indicesLength:S.length,skipDeduplicate:!0,data:y,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let n=0;for(let s=0;s<r.length-1;s++){const a=r[s],u=r[s+1];for(let p=a;p<u;p++){const y=i?i[p]:p;e.set(y,n)}n++}}_computeVisibilityIndices(e,i,r,n){if(e&&i.allVisible())return e;let s=0;i.forEachComponentRange((p,y)=>(s+=r[y]-r[p],!0));const a=Zh(e)?new Array(s):e?.BYTES_PER_ELEMENT===2||n<=65536?new Uint16Array(s):new Uint32Array(s);let u=0;return i.forEachComponentRange((p,y)=>{const b=r[p],S=r[y];for(let C=b;C<S;C++)a[u++]=e?e[C]:C;return!0}),a}addComponentHighlight(e,i){const r=e.components;r.highlightCounts==null&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,i){const r=e.components;if(r.highlightCounts==null)return void fde.warn("Removing non-existing highlight.");const n=r.highlightCounts[i],s=r.highlightCounts[r.count];if(n!==0){if(n>1)return r.highlightCounts[i]=n-1,void(r.highlightCounts[r.count]=s-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),s===1?r.highlightCounts=null:r.highlightCounts[r.count]=s-1}else fde.warn("Removing non-existing highlight.")}clearHighlights(e){const i=e.components;i.highlightCounts!=null&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[YT.Visible]}_createRenderable(e,i){const r=this._renderManager.rctx,n=e.geometry,s=n.vertices.layoutParameters,a=xr.createVertex(r,dr.STATIC_DRAW,n.vertices.data),u=n.indices?xr.createIndex(r,dr.STATIC_DRAW,n.indices):null,p=Kc(jvt(s)),y=new Uint16Array(n.vertices.count);for(let $=0;$<i.count;$++){const N=i.offsets[$],z=i.offsets[$+1],U=i.materialDataIndices[$];if(n.indices!=null)for(let j=N;j<z;j++)y[n.indices[j]]=U;else for(let j=N;j<z;j++)y[j]=U}const b=xr.createVertex(r,dr.STATIC_DRAW,y.buffer),S=new go(e.transform,e.toMapSpace),C=new cd(r,D4e,{data:p,componentIndices:b_t},{data:a,componentIndices:b},u),O=new Ivt(C,Hi.TRIANGLES,s,u!=null),P={cameraDepthSquared:.5,gpuMemoryEstimate:a.byteLength+b.byteLength+(u!=null?u.byteLength:0)};return new Pvt(S,O,P)}_notifyDirty(){this._renderManager.notifyDirty()}};const b_t=Kc(wn().u16(X.COMPONENTINDEX));function _U(t,e){return t===e?so.All:t===0?so.None:so.Some}const mde=za(),I9=H(),$9=H();let Mee=class extends Vr{constructor(){super(...arguments),this.opacity=1}};function w_t(t){const e=new lr;return e.include(Ga),e.fragment.uniforms.add(new kt("tex",i=>i.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new lt("opacity",i=>i.opacity)),e.fragment.code.add(F`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const x_t=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:Mee,build:w_t},Symbol.toStringTag,{value:"Module"}));var Ia;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(Ia||(Ia={}));let G8=class extends rc{constructor(){super(...arguments),this.alphaMode=Ia.None,this.hasOpacityFactor=!1}};_([ce({count:Ia.COUNT})],G8.prototype,"alphaMode",void 0),_([ce()],G8.prototype,"hasOpacityFactor",void 0);let Pee=class j4e extends wr{initializeProgram(e){return new fr(e.rctx,j4e.shader.get().build(this.configuration),ar)}initializePipeline(){switch(this.configuration.alphaMode){case Ia.None:return mi({colorWrite:Oi});case Ia.Alpha:return mi({blending:Zo(et.SRC_ALPHA,et.ONE,et.ONE_MINUS_SRC_ALPHA,et.ONE_MINUS_SRC_ALPHA),colorWrite:Oi});case Ia.PremultipliedAlpha:case Ia.COUNT:return mi({blending:Xc(et.ONE,et.ONE_MINUS_SRC_ALPHA),colorWrite:Oi})}}};Pee.shader=new pr(x_t,()=>ke(()=>import("./Compositing.glsl-d95a4ac8.js"),[],import.meta.url));let B4e=class extends Vr{};function T_t(){const t=new lr;return t.include(Ga),t.fragment.uniforms.add(new kt("tex",e=>e.texture)),t.fragment.code.add(F`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const S_t=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:B4e,build:T_t},Symbol.toStringTag,{value:"Module"}));let V4e=class G4e extends wr{initializeProgram(e){return new fr(e.rctx,G4e.shader.get().build(),ar)}initializePipeline(){return mi({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};V4e.shader=new pr(S_t,()=>ke(()=>import("./HUDCompositing.glsl-87c60dcb.js"),[],import.meta.url));let H4e=class extends Vr{};function E_t(){const t=new lr;return t.include(Ga),t.fragment.uniforms.add(new kt("colorTexture",e=>e.colorTexture),new kt("alphaTexture",e=>e.alphaTexture),new kt("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(F`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const C_t=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:H4e,build:E_t},Symbol.toStringTag,{value:"Module"}));let q4e=class W4e extends wr{initializeProgram(e){return new fr(e.rctx,W4e.shader.get().build(),ar)}initializePipeline(){return mi({blending:Zo(et.SRC_ALPHA,et.ONE,et.ONE_MINUS_SRC_ALPHA,et.ONE_MINUS_SRC_ALPHA),colorWrite:Oi})}};q4e.shader=new pr(C_t,()=>ke(()=>import("./OITCompositing.glsl-0acdf1dc.js"),[],import.meta.url));let A_t=class{constructor(e,i){this._rctx=e,this._techniqueRepository=i,this._configuration=new G8,this._passParameters=new Mee,this._oitParameters=new H4e,this._hudParameters=new B4e}compositeOIT(e,i,r,n){this._oitParameters.colorTexture=i,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=n;const s=this._techniqueRepository.acquire(q4e);this._rctx.bindTechnique(s,this._oitParameters,e),this._rctx.screen.draw(),s.release()}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._techniqueRepository.acquire(V4e);this._rctx.bindTechnique(r,this._hudParameters,e),this._rctx.screen.draw(),r.release()}composite(e,i,r=Ia.None,n=1){this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=n!==1,this._passParameters.texture=i,this._passParameters.opacity=n;const s=this._techniqueRepository.acquire(Pee,this._configuration);this._rctx.bindTechnique(s,this._passParameters,e),this._rctx.screen.draw(),s.release()}};const O_t=1e4,hW=100,R_t=500,M_t=500,P_t=.1;function I_t(t,e,i){return CQ(e,t)*(i[1]-i[0])+i[0]}function $_t(t,e,i){let r=0;if(!e.some(s=>(r+=s.numGeometries,r>=O_t)))return j_t.compute(t,e);const n=LR();return i.forAll(s=>KS(n,L_t(t,s))),n}function L_t(t,e){if(!e.visible)return;const i=LR(),r=e.getSpatialQueryAccelerator();return r?D_t(i,t,r):N_t(i,t,e.objects),i}function D_t(t,e,i){const r=e.eye,n=e.viewForward,s=e.frustum,a=p=>p.visible,u=i.objectCount;if(u<R_t)SO(Mh,e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,n,bp.DepthOrder.FRONT_TO_BACK,Mh,(p,y)=>{dW(t,e,p),Mh.far=t.near,y.setRange(Mh)},s,a),SO(Mh,Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,n,bp.DepthOrder.BACK_TO_FRONT,Mh,(p,y)=>{dW(t,e,p),Mh.near=t.far,y.setRange(Mh)},s,a);else{const p=Math.max(Math.min(u,M_t),Math.ceil(u*P_t)),y=i.findClosest(n,bp.DepthOrder.FRONT_TO_BACK,s,a,p),b=i.findClosest(n,bp.DepthOrder.BACK_TO_FRONT,s,a,p);y&&b&&(gde(t,e,y.boundingVolumeWorldSpace.bounds),gde(t,e,b.boundingVolumeWorldSpace.bounds))}}function N_t(t,e,i){X3.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&X3.add(r)}),X3.empty||(X3.sort(e),SO(Mh,e.near,Math.min(t.near,e.far)),X3.forEachInDepthRange(Mh,bp.DepthOrder.FRONT_TO_BACK,(r,n)=>{n<t.near&&dW(t,e,r)}),SO(Mh,Math.max(t.far,e.near),e.far),X3.forEachInDepthRange(Mh,bp.DepthOrder.BACK_TO_FRONT,(r,n,s)=>{t.far=Math.max(t.far,s)}))}function dW(t,e,i){if(!i.visible||!By(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,n=U_t;i.geometries.forEach(s=>{Rr(n,r,s.transformation);const a=MS(n);X4e(t,e,s.boundingInfo,n,a)})}function X4e(t,e,i,r,n){if(i==null)return;wt(ul,i.center,r);const{eye:s,viewForward:a}=e,u=a[0]*(ul[0]-s[0])+a[1]*(ul[1]-s[1])+a[2]*(ul[2]-s[2]);if(ul[3]=i.radius*n,!(u-ul[3]>t.near&&u+ul[3]<t.far)&&By(e.frustum,ul))if(i.radius>hW&&i.getChildren())for(const p of i.getChildren())X4e(t,e,p,r,n);else pW.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function gde(t,e,i){const r=e.eye,n=e.viewForward,s=(i[0]-r[0])*n[0]+(i[1]-r[1])*n[1]+(i[2]-r[2])*n[2];t.near=Math.min(t.near,s-i[3]),t.far=Math.max(t.far,s+i[3])}let F_t=class{constructor(){this._items=new xi({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(n=>{const s=n.object.boundingVolumeWorldSpace.bounds,a=(s[0]-i[0])*r[0]+(s[1]-i[1])*r[1]+(s[2]-i[2])*r[2];n.distance=a,n.near=a-s[3],n.far=a+s[3]}),this._items.sort((n,s)=>n.distance-s.distance)}forEachInDepthRange(e,i,r){if(i===bp.DepthOrder.FRONT_TO_BACK)for(let n=0;n<this._items.length;++n){const s=this._items.data[n];s.far<e.near||s.near>e.far||r(s.object,s.near,s.far)}else for(let n=this._items.length-1;n>=0;--n){const s=this._items.data[n];s.far<e.near||s.near>e.far||r(s.object,s.near,s.far)}}},k_t=class{constructor(){this._view=Ze(),this._viewProj=Ze(),this._frustum=nO(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,i){this._reset(),bs(this._view,e.viewMatrix),Rr(this._viewProj,e.projectionMatrix,this._view),BL(this._frustum,e.frustum);const r=this._view,n=r[2],s=r[6],a=r[10],u=r[14];i.forAll(C=>C.forEachGeometry(O=>{if(!O.visible||!O.castShadow)return;const P=O.boundingSphere,$=n*P[0]+s*P[1]+a*P[2]+u,N=$-P[3],z=$+P[3];this._geometries.push(O),this._near.push(-z),this._far.push(-N)}));const p=new Cee;if(this._geometries.length===0)return p;for(let C=0;C<this._geometries.length;++C)this._near[C]>p.far&&(p.far=this._near[C]),this._near[C]>2&&this._far[C]<p.near&&(p.near=this._far[C]);const y=this._looseRange;y.near=Math.max(.5*p.near,2),y.far=2*p.far;let b=0,S=0;for(let C=0;C<this._geometries.length;++C)this._near[C]<p.near&&(this._near[C]>=y.near?p.near=this._near[C]:this._nearCandidates[b++]=C),this._far[C]>p.far&&(this._far[C]<=y.far?p.far=this._far[C]:this._farCandidates[S++]=C);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return p;this._nearCandidates.sort((C,O)=>this._near[C]<this._near[O]?-1:this._near[C]>this._near[O]?1:0),this._farCandidates.sort((C,O)=>this._far[C]<this._far[O]?1:this._far[C]>this._far[O]?-1:0);for(let C=0;C<this._nearCandidates.length;++C){const O=this._nearCandidates[C];if(this._near[O]<p.near){const P=this._geometries[O],$=P.boundingInfo;this._includeNearBoundingInfoRec($,P.shaderTransformation,p)}}for(let C=0;C<this._farCandidates.length;++C){const O=this._farCandidates[C];if(this._far[O]>p.far){const P=this._geometries[O],$=P.boundingInfo;this._includeFarBoundingInfoRec($,P.shaderTransformation,p)}}return this._reset(),p}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,i,r){if(e==null)return;const n=e.center;wt(ul,n,i);const s=MS(i),a=ul[0],u=ul[1],p=ul[2],y=e.radius*s,b=this._frustum;if(b[0][0]*a+b[0][1]*u+b[0][2]*p+b[0][3]>y||b[1][0]*a+b[1][1]*u+b[1][2]*p+b[1][3]>y||b[2][0]*a+b[2][1]*u+b[2][2]*p+b[2][3]>y||b[3][0]*a+b[3][1]*u+b[3][2]*p+b[3][3]>y)return;const S=this._view[2]*a+this._view[6]*u+this._view[10]*p+this._view[14],C=S+y;if(!(-(S-y)<2||-C>=r.near))if(-C>this._looseRange.near)r.near=-C;else{if(y>hW){const O=e.getChildren();if(O!==void 0){for(const P of O)this._includeNearBoundingInfoRec(P,i,r);return}}pW.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,i,r){if(e==null)return;let n=e.radius;const s=e.center;wt(ul,s,i);const a=MS(i),u=ul[0],p=ul[1],y=ul[2];n*=a;const b=this._frustum;if(b[0][0]*u+b[0][1]*p+b[0][2]*y+b[0][3]>n||b[1][0]*u+b[1][1]*p+b[1][2]*y+b[1][3]>n||b[2][0]*u+b[2][1]*p+b[2][2]*y+b[2][3]>n||b[3][0]*u+b[3][1]*p+b[3][2]*y+b[3][3]>n)return;const S=this._view[2]*u+this._view[6]*p+this._view[10]*y+this._view[14]-n;if(!(-S<=r.far))if(-S<this._looseRange.far)r.far=-S;else{if(n>hW){const C=e.getChildren();if(C!==void 0){for(const O of C)this._includeFarBoundingInfoRec(O,i,r);return}}pW.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}},z_t=class{constructor(){this._modelViewProj=Ze(),this._clipPosition=[ji(),ji(),ji(),ji(),ji(),ji(),ji(),ji()]}unionDepthRangeWithAABB(e,i,r,n,s){const a=this._modelViewProj;Rr(a,i,r);let u=!1;for(let p=0;p<8;++p){const y=this._clipPosition[p],b=p===0||p===3||p===4||p===7?n[0]:s[0],S=p===0||p===1||p===4||p===5?n[1]:s[1],C=p<4?n[2]:s[2];y[0]=a[0]*b+a[4]*S+a[8]*C+a[12],y[1]=a[1]*b+a[5]*S+a[9]*C+a[13],y[2]=a[2]*b+a[6]*S+a[10]*C+a[14],y[3]=a[3]*b+a[7]*S+a[11]*C+a[15]}for(let p=0;p<12;++p){const y=this._clipPosition[bU[p][0]],b=this._clipPosition[bU[p][1]],S=this._clipPosition[bU[p][2]],C=this._clipTriangle(y,b,S);let O=!0;for(let P=0;P<C.length;++P)if(C[P][3]>=2){O=!1;break}if(!O){u=!0;for(let P=0;P<C.length;++P){const $=C[P][3];Number.isFinite($)&&(e.near=Math.min($,e.near),e.far=Math.max($,e.far))}}}return u}_inside(e,i){return i===0?e[0]>=-e[3]:i===1?e[1]>=-e[3]:i===2?e[0]<=e[3]:i===3?e[1]<=e[3]:void zt(!1)}_intersect(e,i,r){let n=0;return r===0?n=(-e[3]-e[0])/(i[0]-e[0]+i[3]-e[3]):r===1?n=(-e[3]-e[1])/(i[1]-e[1]+i[3]-e[3]):r===2?n=(e[3]-e[0])/(i[0]-e[0]-i[3]+e[3]):r===3&&(n=(e[3]-e[1])/(i[1]-e[1]-i[3]+e[3])),DD(ji(),e,i,n)}_clipTriangle(e,i,r){let n=[e,i,r];for(let s=0;s<4;++s){const a=n;n=[];for(let u=0;u<a.length;++u){const p=a[u],y=a[(u+1)%a.length];this._inside(y,s)?(this._inside(p,s)||n.push(this._intersect(p,y,s)),n.push(y)):this._inside(p,s)&&n.push(this._intersect(p,y,s))}}return n}};const bU=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],ul=as(),U_t=Ze(),Mh=LR(),X3=new F_t,j_t=new k_t,pW=new z_t;let B_t=class{},V_t=class extends Vr{constructor(){super(...arguments),this.textures=new B_t}};function G_t(){const t=new lr;return t.attributes.add(X.POSITION,"vec2"),t.vertex.uniforms.add(new er("drawPosition",(e,i)=>H_t(e,i))),t.varyings.add("vUV","vec2"),t.vertex.code.add(F`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new kt("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new kt("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new kt("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new y0("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new y0("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(F`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function H_t(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,n=t.magnifier.offset.y*i;pp(t.magnifier.position,yde);const s=e.camera.screenToRender(yde,q_t),a=Math.ceil(i*t.magnifier.size),u=e.camera.fullWidth,p=e.camera.fullHeight;return _n(W_t,(s[0]+r)/u*2-1,(s[1]-n)/p*2-1,a/u*2,a/p*2)}const yde=Dn(),q_t=Oge(),W_t=ji();async function X_t(t){const e=ke(()=>import("./mask-svg-023bbc42.js"),[],import.meta.url),i=ke(()=>import("./overlay-svg-d62383f3.js"),[],import.meta.url),r=Lg((await e).default,{signal:t}),n=Lg((await i).default,{signal:t}),s={mask:await r,overlay:await n};return oi(t),s}let Nx=class extends Ke{constructor(){super(...arguments),this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new V_t,this.events=new Xn,this.attributeLocations=new Map([[X.POSITION,0]]),this._tmpScreenPoint=Dn(),this._tmpRenderPoint=Oge()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const i=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this.addHandles(Fe(()=>this._magnifier?.version,i)),i()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,i){const r=this._validMagnifier;if(r==null)return;const n=i.camera.pixelRatio,s=Math.ceil(n*r.size);if(this._updateResources(e,s),this._resources==null)return;const a=this._passParameters.textures,u=Math.ceil(1/this._factor*s);a.input.resize(u,u),pp(r.position,this._tmpScreenPoint);const p=i.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),y=i.camera.fullWidth,b=i.camera.fullHeight,S=.5*u,C=.5*u;p[0]=Je(p[0],S,y-S-1),p[1]=Je(p[1],C,b-C-1);const O=Math.floor(p[0]-S),P=Math.floor(p[1]-C),$=this._resources.program;$.bindTexture("textureInput",a.input),e.gl.copyTexImage2D(a.input.descriptor.target,0,a.input.descriptor.pixelFormat,O,P,u,u,0),this._passParameters.magnifier=r,e.useProgram($),$.bindPass(this._passParameters,i),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Hi.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const i=e.maskUrl,r=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===i&&this._imageLoadTask.overlayUrl===r||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:Pv(async n=>{const s=i==null||r==null?X_t(n):null,a=i!=null?Lg(i,{signal:n}):s.then(p=>p.mask),u=r!=null?Lg(r,{signal:n}):s.then(p=>p.overlay);this._imageSources={mask:await a,overlay:await u},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,i){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==i){const n=this._createTextureResources(e,i);if(n==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=n}return}const r=this._createTextureResources(e,i);r!=null&&(this._resources={program:this._createProgram(e),vao:V0(e,eK,this.attributeLocations,0,1),pipelineState:mi({blending:Xc(et.ONE,et.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Oi})},this._passParameters.textures=r)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,i){if(this._imageSources==null)return null;this._imageSources.overlay.width=i,this._imageSources.overlay.height=i,this._imageSources.mask.width=i,this._imageSources.mask.height=i;const r=new Ar;r.internalFormat=ei.RGBA,r.wrapMode=Ai.CLAMP_TO_EDGE,r.flipped=!0,r.preMultiplyAlpha=!bme(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const n=new yi(e,r,this._imageSources.overlay);r.pixelFormat=r.internalFormat=ei.ALPHA,r.preMultiplyAlpha=!1;const s=new yi(e,r,this._imageSources.mask);return r.pixelFormat=r.internalFormat=ei.RGBA,r.flipped=!1,{input:new yi(e,r),mask:s,overlay:n,size:i}}_createProgram(e){return new fr(e,G_t(),this.attributeLocations)}};_([T()],Nx.prototype,"_imageSources",void 0),_([T()],Nx.prototype,"_imageLoadTask",void 0),_([T({readOnly:!0})],Nx.prototype,"updating",null),Nx=_([Z("esri/views/3d/webgl-engine/lib/MagnifierHelper")],Nx);let J_t=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new ja(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,n,s,a=null,u=null,p=null){if(!(e&&i&&r&&n)||(this._layerUidToId.set(n,r),this._layerUidToPopupEnabled.set(n,s),!s))return;let y=this._layerUidToGraphicsUidToObjectId.get(n);y||(y=new Map,this._layerUidToGraphicsUidToObjectId.set(n,y)),y.set(i,{objectId:e,attributeNodeId:a,attributeIndex:u,subLayerId:p})}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return vi(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(e.layerUid);if(i===void 0)return Ee.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(i===!1)return this.colorZero;let r=this._uidToRenderColor.get(e.layerUid);r||(r=new Map,this._uidToRenderColor.set(e.layerUid,r));let n=r.get(e.graphicUid);if(!n){for(;!n;){const a=Math.floor(16777214*Math.random())+1;this._colorToUID.has(a)||(n=a)}if(n>16777215)throw new Error("Object ID Overflow");r.set(e.graphicUid,n),this._colorToUID.set(n,e)}const s=new ArrayBuffer(4);return new DataView(s).setUint32(0,n,!1),new ja(s)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const n=this._layerUidToGraphicsUidToObjectId.get(r.layerUid);let s=null;n?(s=n.get(r.graphicUid),s||Ee.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+r.graphicUid)):Ee.getLogger(this).warn("getColorMapping: no entry found for layerUid "+r.layerUid);const a=this._layerUidToId.get(r.layerUid);a||Ee.getLogger(this).warn("no layerId found for uid "+r.layerUid),s&&a&&e.set(i,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:s.objectId,lid:a,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",oid:s.objectId,lid:a})}return e}};var EO;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(EO||(EO={}));let $1=class{constructor(e,i,r=EO.FrontToBack){this._rctx=e,this._techniqueRepository=i,this._sorting=r,this._draws=new xi({initialSize:32,allocator:n=>n||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,n){const s=this._draws.pushNew();s.geometry=i,s.geometryRanges=r,s.material=e,s.depthSquaredHint=n,s.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0}prepare(e,i){return this._draws.map(r=>r.material.prepareTechnique(this._techniqueRepository,e,i,r.geometry.parameters))}dispatch(e,i,r){const n=this._rctx;this._previouslyBoundDraw.clear();let s=null;const a=this._draws.length;for(let u=0;u<a;u++){const p=r[u];p===s&&p.configuration.transparencyPassType===Ut.NONE||(n.bindTechnique(p,e,i),s=p);const y=this._draws.data[u],b=y.geometry;n.bindVAO(b.vao),this._previouslyBoundDraw.get(p)!==y.material&&(p.program.bindDraw(y.material,i,e),this._previouslyBoundDraw.set(p,y.material));const S=y.geometryRanges,C=S.length;if(y.indexType!==0){const O=Y$.get(y.indexType);for(let P=0;P<C;P+=2){const $=S[P],N=S[P+1];n.drawElements(b.primitiveType,N,y.indexType,$*O)}}else for(let O=0;O<C;O+=2){const P=S[O],$=S[O+1];n.drawArrays(b.primitiveType,P,$)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===EO.FrontToBack?1:-1;this._draws.sort((i,r)=>{const n=e*(i.depthSquaredHint-r.depthSquaredHint);return n!==0?n:i.geometry.vao.byteSize-r.geometry.vao.byteSize})}get count(){return this._draws.length}};const Y$=new Map;Y$.set(Ft.UNSIGNED_BYTE,1),Y$.set(Ft.UNSIGNED_SHORT,2),Y$.set(Ft.UNSIGNED_INT,4);let fW=class extends FZe{constructor(){super({}),this._passes=null,this.produces=new Map([[De.OPAQUE_MATERIAL,e=>this._produces(e)],[De.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[De.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new yot,this._shadowPassParameters=new vot,this._highlightPassParameters=new _ot,this._systems=new Set}initializeRenderContext(e){this._context=e;const i=e.renderContext.rctx,r=e.techniqueRepository;this._passes={materialOpaque:new $1(i,r),materialTransparent:new $1(i,r,EO.BackToFront),materialIntegratedMesh:new $1(i,r),shadowMap:new $1(i,r),highlight:new $1(i,r),highlightIntegratedMesh:new $1(i,r),highlightShadowMap:new $1(i,r),defaultShadowMap:new $1(i,r)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return this._systems.size!==0&&this._passes!==null&&(e===oe.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==oe.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!==null){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,e.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this._context.techniqueRepository.frameUpdate()}}prepareTechniques(e){if(this._systems.size===0)return null;const i=e.output===oe.Shadow||e.output===oe.ShadowHighlight||e.output===oe.ShadowExcludeHighlight?this._shadowPassParameters:e.output===oe.Highlight?this._highlightPassParameters:this._materialPassParameters,r=e.bindParameters;return this._updateParameters(r.camera,i,r.slot===De.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,(n,s)=>n.prepare(s,e.bindParameters))}renderNode(e,i){this._invoke(e,(r,n)=>r.dispatch(n,e.bindParameters,i))}_invoke(e,i){if(this._passes===null)return null;switch(e.bindParameters.slot){case De.OPAQUE_MATERIAL:switch(e.output){case oe.Color:case oe.Depth:case oe.Normal:case oe.ObjectAndLayerIdColor:return i(this._passes.materialOpaque,this._materialPassParameters);case oe.Highlight:return i(this._passes.highlight,this._highlightPassParameters);case oe.Shadow:return i(this._passes.shadowMap,this._shadowPassParameters);case oe.ShadowHighlight:return i(this._passes.highlightShadowMap,this._shadowPassParameters);case oe.ShadowExcludeHighlight:return i(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case De.TRANSPARENT_MATERIAL:switch(e.output){case oe.Color:case oe.Alpha:case oe.Depth:case oe.Normal:case oe.ObjectAndLayerIdColor:return i(this._passes.materialTransparent,this._materialPassParameters)}break;case De.INTEGRATED_MESH:switch(e.output){case oe.Color:case oe.Depth:case oe.Normal:case oe.ObjectAndLayerIdColor:return i(this._passes.materialIntegratedMesh,this._materialPassParameters);case oe.Highlight:return i(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const i=new Cee;return this._systems.forEach(r=>KS(i,r.queryShadowCasterDepthRange(e))),i}_updateParameters(e,i,r){const n=e.viewInverseTransposeMatrix;$e(wU,n[3],n[7],n[11]),xU.set(wU),Ie(i.transformWorldFromViewTH,xU.high),Ie(i.transformWorldFromViewTL,xU.low),Ie(i.slicePlaneLocalOrigin,wU),sd(i.transformViewFromCameraRelativeRS,e.viewMatrix),bs(i.transformProjFromView,e.projectionMatrix),i.identifier===$c.Material&&(this._materialPassParameters.transparent=r,od(vde,i.transformViewFromCameraRelativeRS),Rw(i.transformNormalViewFromGlobal,vde))}};fW=_([Z("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],fW);const wU=H(),vde=Pn(),xU=new MN;let Y_t=class{constructor(e=null,i=null,r=null){this.composite=e,this.normal=i,this.highlight=r}},Z$=class extends Ke{constructor(e){super({}),this._context=e,this._renderPlugins=new xi,this._slots=new Array;for(let i=0;i<De.MAX_SLOTS;++i)this._slots[i]=[]}normalizeCtorArgs(){return{}}add(e,i){const r=()=>{if(i?.aborted)throw e.uninitializeRenderContext(),or();this._renderPlugins.push(e),e.produces.forEach((s,a)=>{this._slots[a].push(e)}),this._context.requestRender(),this.notifyChange("updating")},n=e.initializeRenderContext(this._context,i);if(Yc(n))return n.then(r);r()}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);e.uninitializeRenderContext(),this._context.requestRender(),this.notifyChange("updating")}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(e)||i)}),i}renderFeatureChanged(){this._renderPlugins.forAll(e=>{e.renderFeatureChanged&&e.renderFeatureChanged()})}prepare(e){this._context.renderContext.bindParameters.slot=e,this._slots[e].forEach(i=>{const r=i.produces.get(e);r&&r(oe.Color)&&(_de(i)&&i.prepareTechnique(this._context.renderContext),bde(i)&&i.prepareTechniques(this._context.renderContext))})}_getRenderables(e){this._context.renderContext.bindParameters.slot=e;const i=new Map;return this._slots[e].forEach(r=>{const n=r.produces.get(e);if(n&&n(oe.Color)&&(!r.isDecoration||this._context.renderContext.bindParameters.decorations!==kc.OFF))if(_de(r)){const s=r.prepareTechnique(this._context.renderContext);s!=null&&i.set(r,s)}else if(bde(r)){const s=r.prepareTechniques(this._context.renderContext);s!=null&&i.set(r,s)}else i.set(r,null)}),i}render(e,i=null,r=null){return this._getRenderables(e).forEach((n,s)=>r=s.renderNode(this._context.renderContext,n,i,r)),r}renderComposition(e,i){const r=this._getRenderables(e);let n=null;return r.forEach((s,a)=>{const u=a.renderNode(this._context.renderContext,s,i,null);n?.release(),n=u,i.composite=n}),n}queryDepthRange(e){const i=new Cee;return this._renderPlugins.forAll(r=>{const n=r.queryDepthRange?.(e);KS(i,n)}),i}get updating(){return this._renderPlugins.some(e=>e.running)}produces(e,i=oe.Color){return this._slots[e].some(r=>{const n=r.produces.get(e);return!!n&&n(i)})}consumes(e){return this._renderPlugins.some(i=>i.consumes().required.includes(e))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|i.renderOccludedFlags,vn.None)}get usedMemory(){return this._renderPlugins.reduce((e,i)=>e+(i.usedMemory??0),0)}};function _de(t){return"prepareTechnique"in t}function bde(t){return"prepareTechniques"in t}_([T({readOnly:!0})],Z$.prototype,"updating",null),Z$=_([Z("esri.views.3d.webgl-engine.lib.RenderPluginManager")],Z$);let Fx=class extends $w{constructor(e){super(e),this._context=null,this.opacity=1,this.alphaMode=Ia.None,this._blitConfiguration=new G8,this._blitParameters=new Mee,this.produces=new Map([[De.BLIT,()=>this._context!=null]])}consumes(){return rxe}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){this._context=null}destroy(){}renderNode(e,i,r,n){const s=r?.composite?.colorTexture;if(!this._context||!s)return n;const a=this._context.techniqueRepository.acquire(Pee,this._blitConfiguration);return a?.compiled?(e.rctx.bindFramebuffer(n?.fbo),this._blitParameters.texture=s,this._blitParameters.opacity=this.opacity,e.rctx.bindTechnique(a,this._blitParameters,e.bindParameters),e.rctx.screen.draw(),a.release(),n):(this._context.requestRender(),n)}};_([T()],Fx.prototype,"_context",void 0),_([T()],Fx.prototype,"opacity",void 0),_([T()],Fx.prototype,"alphaMode",void 0),Fx=_([Z("esri.views.3d.webgl-engine.effects.blit.Blit")],Fx);let J4e=class extends Vr{};function Z_t(){const t=new lr,{outputs:e,fragment:i}=t;return t.include(Ga),i.uniforms.add(new Wh("textureInput",r=>r.input)),i.constants.add("outlineSize","int",Math.ceil(Iee/2)),e.add("fragGrid","vec2"),i.code.add(F`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${F.int(Xf)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -outlineSize; x < cellSize + outlineSize; x += 2) {
        for(int y = -outlineSize; y < cellSize + outlineSize; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`),t}const Xf=32,Iee=9,Y4e=.4,K_t=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:J4e,blurSize:Y4e,build:Z_t,gridCellPixelSize:Xf,outlineSize:Iee},Symbol.toStringTag,{value:"Module"}));function Q_t(){const t=new lr,{vertex:e,fragment:i}=t,r=e.code,n=i.code;return t.attributes.add(X.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(X.UV0,"vec2"),e.uniforms.add(new kt("coverageTex",s=>s.coverageTexture),new Lr("coverageRounding",s=>s.coverageRounding)),r.add(F`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new kt("tex",s=>s.blurTexture),new kt("highlightTexture",s=>s.highlightTexture),new er("uColor",s=>s.color),new er("haloColor",s=>s.haloColor),new er("opacities",s=>_n(ebt,s.haloOpacity,s.haloOpacityOccluded,s.fillOpacity,s.fillOpacityOccluded))),i.constants.add("outlineSize","float",Iee),i.constants.add("blurSize","float",Y4e),n.add(F`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - (outlineSize - blurSize) / outlineSize;
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const ebt=ji(),tbt=Object.freeze(Object.defineProperty({__proto__:null,build:Q_t},Symbol.toStringTag,{value:"Module"}));let Z4e=class K4e extends wr{initializeProgram(e){return new fr(e.rctx,K4e.shader.get().build(),ar)}initializePipeline(){return mi({blending:Zo(et.SRC_ALPHA,et.ONE,et.ONE_MINUS_SRC_ALPHA,et.ONE_MINUS_SRC_ALPHA),colorWrite:Oi})}};Z4e.shader=new pr(tbt,()=>ke(()=>import("./HighlightApply.glsl-ce2a63c0.js"),[],import.meta.url));let Q4e=class extends Vr{constructor(){super(...arguments),this.blurSize=Ct()}};function ibt(){const t=new lr,{attributes:e,varyings:i,vertex:r,fragment:n}=t;return e.add(X.POSITION,"vec2"),e.add(X.UV0,"vec2"),i.add("blurCoordinate","vec3"),r.uniforms.add(new kt("coverageTex",s=>s.coverageTexture),new Lr("coverageRounding",s=>s.coverageRounding)),r.code.add(F`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`),n.uniforms.add(new MSe("blurSize",s=>s.blurSize),new Wh("tex",s=>s.blurInputTexture)),n.code.add(F`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const rbt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:Q4e,build:ibt},Symbol.toStringTag,{value:"Module"}));let eOe=class tOe extends wr{initializeProgram(e){return new fr(e.rctx,tOe.shader.get().build(),ar)}initializePipeline(){return mi({colorWrite:Oi})}};eOe.shader=new pr(rbt,()=>ke(()=>import("./HighlightBlur.glsl-3c596e04.js"),[],import.meta.url));let iOe=class rOe extends wr{initializeProgram(e){return new fr(e.rctx,rOe.shader.get().build(),ar)}initializePipeline(){return mi({colorWrite:Oi})}};iOe.shader=new pr(K_t,()=>ke(()=>import("./HighlightDownsample.glsl-9824aecc.js"),[],import.meta.url));let nbt=class extends Vr{constructor(){super(...arguments),this.color=vi(1,0,1,1),this.haloColor=vi(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.coverageRounding=Xi(1,1)}},aA=class extends $w{constructor(e){super(e),this._context=null,this._passParameters=new nbt,this._downsampleDrawParameters=new J4e,this._blurDrawParameters=new Q4e,this._blurColorFormat=Me("mac")?sr.RGBA:sr.RGBA4,this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0},this.produces=new Map([[De.HIGHLIGHT,()=>!0]])}consumes(){return nxe}initializeRenderContext(e){this._context=e,this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(eOe)),this._downsampleTechnique==null&&(this._downsampleTechnique=this._context.techniqueRepository.acquire(iOe)),this._applyTechnique==null&&(this._applyTechnique=this._context.techniqueRepository.acquire(Z4e)),this.addHandles([Fe(()=>this.view.highlightOptions.color,i=>{this._passParameters.color=tO(i??dAe),this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color),this._context.requestRender()},Ur),Fe(()=>this.view.highlightOptions.haloColor,i=>{this._passParameters.haloColor=i!=null?tO(i):this._passParameters.color,this._context.requestRender()},Ur),Fe(()=>this.view.highlightOptions.haloOpacity,i=>{this._passParameters.haloOpacity=i??pAe,this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity,this._context.requestRender()},Ur),Fe(()=>this.view.highlightOptions.fillOpacity,i=>{this._passParameters.fillOpacity=i??fAe,this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity,this._context.requestRender()},Ur)])}uninitializeRenderContext(){this._context=null}dispose(){this._blurTechnique=Gi(this._blurTechnique),this._downsampleTechnique=Gi(this._downsampleTechnique),this._applyTechnique=Gi(this._applyTechnique),this._grid.coverage=Gi(this._grid.coverage),this._grid.vao=jt(this._grid.vao)}renderNode(e,i,r,n){const s=r?.highlight?.colorTexture;if(!this._context||!s)return;if(!(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled))return void this._context.requestRender();const a=e.bindParameters.camera,u=a.fullWidth,p=a.fullHeight,y=a.pixelRatio,b=Math.ceil(u/y),S=Math.ceil(p/y),C=this._context.fbos,O=C.rctx;this._gridUpdateResources(s),this._gridComputeCoverage(s,e.bindParameters),this._passParameters.highlightTexture=s,this._passParameters.coverageTexture=this._grid.coverage?.colorTexture;const{width:P,height:$}=s.descriptor;Yi(this._passParameters.coverageRounding,P/(Math.ceil(P/Xf)*Xf),$/(Math.ceil($/Xf)*Xf));const N=O.bindTechnique(this._blurTechnique,this._passParameters,e.bindParameters),z=this._grid.vao;O.bindVAO(z);const U=C.acquire(this._blurColorFormat,b,S);O.bindFramebuffer(U.fbo),O.setViewport(0,0,b,S),O.clear(tn.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=s,Yi(this._blurDrawParameters.blurSize,1/b,0),N.bindDraw(this._blurDrawParameters,e.bindParameters,this._passParameters),O.drawArrays(this._blurTechnique.primitiveType,0,dg(z,"geometry"));const j=C.acquire(this._blurColorFormat,b,S);O.bindFramebuffer(j.fbo),O.clear(tn.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=U.colorTexture,Yi(this._blurDrawParameters.blurSize,0,1/S),N.bindDraw(this._blurDrawParameters,e.bindParameters,this._passParameters),O.drawArrays(this._blurTechnique.primitiveType,0,dg(z,"geometry")),O.bindFramebuffer(n?.fbo),O.setViewport4fv(a.fullViewport),this._passParameters.blurTexture=j.colorTexture,O.bindTechnique(this._applyTechnique,this._passParameters,e.bindParameters),O.drawArrays(this._applyTechnique.primitiveType,0,dg(z,"geometry")),j.release(),U.release()}_gridUpdateResources(e){if(!this._context)return;const i=this._context.fbos.rctx,r=this._grid,n=Math.ceil(e.descriptor.height/Xf),s=Math.ceil(e.descriptor.width/Xf);if(r.vao&&r.verticalCellCount===n&&r.horizontalCellCount===s)return;r.verticalCellCount=n,r.horizontalCellCount=s;const a=n+1,u=s+1,p=1/n,y=1/s,b=new Float32Array(6*4*a*u);let S=0;for(let C=0;C<a;C++)for(let O=0;O<u;O++)b[S++]=(O-.5)*y*2-1,b[S++]=(C-.5)*p*2-1,b[S++]=O*y,b[S++]=C*p,b[S++]=(O+.5)*y*2-1,b[S++]=(C-.5)*p*2-1,b[S++]=O*y,b[S++]=C*p,b[S++]=(O-.5)*y*2-1,b[S++]=(C+.5)*p*2-1,b[S++]=O*y,b[S++]=C*p,b[S++]=(O-.5)*y*2-1,b[S++]=(C+.5)*p*2-1,b[S++]=O*y,b[S++]=C*p,b[S++]=(O+.5)*y*2-1,b[S++]=(C-.5)*p*2-1,b[S++]=O*y,b[S++]=C*p,b[S++]=(O+.5)*y*2-1,b[S++]=(C+.5)*p*2-1,b[S++]=O*y,b[S++]=C*p;r.vao?.dispose(),r.vao=new Wp(i,ar,{geometry:hR},{geometry:xr.createVertex(i,dr.STATIC_DRAW,b)})}_gridComputeCoverage(e,i){if(!this._context)return;const r=this._context.fbos.rctx,n=this._grid,s=e.descriptor,a=Math.ceil(s.width/Xf),u=Math.ceil(s.height/Xf);n.coverage?.release(),n.coverage=this._context.fbos.acquire(sr.RG,a,u),this._downsampleDrawParameters.input=e,r.bindFramebuffer(n.coverage.fbo),r.bindTechnique(this._downsampleTechnique,this._passParameters,i).bindDraw(this._downsampleDrawParameters,i,this._passParameters),r.setViewport(0,0,a,u),r.screen.draw()}get test(){return{coverage:this._grid.coverage}}};_([T()],aA.prototype,"_context",void 0),_([T()],aA.prototype,"view",void 0),aA=_([Z("esri.views.3d.webgl-engine.effects.highlight.Highlight")],aA);let $ee=class extends rc{constructor(){super(...arguments),this.receiveShadows=!0}};_([ce()],$ee.prototype,"receiveShadows",void 0);const sbt=.99999,obt=.025;function abt(t){const e=new lr;e.include(nw,t),e.include(cN),e.include(Ga);const i=e.fragment;return i.include(fd),i.include(ld),i.uniforms.add(new kt("defaultDepthTex",(r,n)=>n.shadowMap.getSnapshot(XS.Default)),new kt("highlightDepthTex",(r,n)=>n.shadowMap.getSnapshot(XS.Highlight)),new kt("depthMap",(r,n)=>n.linearDepth?.colorTexture),new kt("highlightTexture",r=>r.highlight),new er("uColor",r=>r.shadowColor),new Lr("nearFar",(r,n)=>n.camera.nearFar),new lt("opacity",r=>r.shadowOpacity),new lt("occludedOpacity",r=>r.occludedShadowOpacity),new lt("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new _i("lightingMainDirectionView",(r,n)=>We(xde,wt(xde,n.lighting.mainLight.direction,n.camera.viewInverseTransposeMatrix))),new On("inverseViewMatrix",(r,n)=>Ps(wde,ec(wde,n.camera.viewMatrix,n.camera.center)))),i.constants.add("unoccludedHighlightFlag","vec4",KK),i.code.add(F`
    vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, ivec2 iuv) {
      float leftPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(-1, 0), 0), nearFar);
      float rightPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(1, 0), 0), nearFar);
      float bottomPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, -1), 0), nearFar);
      float topPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, 1), 0), nearFar);

      bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
      bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);

      vec3 fragCoordHorizontal = pickLeft
                                  ? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
                                  : vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
      vec3 fragCoordVertical = pickBottom
                                  ? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
                                  : vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);

      vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
      vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);

      vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
      // Flip normal depending on triangle winding order for consistency
      return pickLeft == pickBottom ? normal : -normal;
    }

    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${F.float(sbt)}) {
        discard;
      }

      ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
      float depth = rgba2float(texelFetch(depthMap, iuv, 0));
      // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth == 0.0) {
        discard;
      }

      float currentPixelDepth = linearDepthFromFloat(depth, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        discard;
      }

      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);

      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;

      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, iuv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${F.float(obt)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `),e}const wde=Ze(),xde=H(),lbt=Object.freeze(Object.defineProperty({__proto__:null,build:abt},Symbol.toStringTag,{value:"Module"}));let cbt=class extends hQ{constructor(){super(...arguments),this.shadowColor=vi(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},nOe=class sOe extends wr{constructor(e){super(e,new $ee,()=>this.destroy())}initializeProgram(e){return new fr(e.rctx,sOe.shader.get().build(this.configuration),ar)}initializePipeline(){return mi({blending:Zo(et.SRC_ALPHA,et.ONE,et.ONE_MINUS_SRC_ALPHA,et.ONE_MINUS_SRC_ALPHA),colorWrite:Oi,depthTest:null,depthWrite:null})}get primitiveType(){return Hi.TRIANGLE_STRIP}};nOe.shader=new pr(lbt,()=>ke(()=>import("./ShadowHighlight.glsl-c6d1c2a9.js"),[],import.meta.url));const ubt=.001953125,hbt=4e4,dbt=5e4;let kx=class extends $w{constructor(e){super(e),this._maxOpacity=1,this._passParameters=new cbt,this._drawParameters=new mnt,this._shadowDifference=.2,this._context=null,this.produces=new Map([[De.SHADOW_HIGHLIGHT,()=>this._isVisible]])}consumes(){return nxe}initializeRenderContext(e){this._context=e,this.addHandles([Fe(()=>this.view.highlightOptions.shadowOpacity,i=>{this._passParameters.shadowOpacity=i??gAe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},Ur),Fe(()=>this.view.highlightOptions.shadowDifference,i=>{this._shadowDifference=i??yAe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},Ur),Fe(()=>this.view.highlightOptions.shadowColor,i=>{this._passParameters.shadowColor=tO(i??mAe),this._updateMaxOpacity()},Ur)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}uninitializeRenderContext(){this._context=null}enable(){this._context&&this._technique==null&&(this._technique=this._context.techniqueRepository.acquire(nOe))}renderNode(e,i,r,n){const s=r?.highlight?.colorTexture;if(!(this._context&&r&&s&&this._isVisible))return;if(!this._technique?.compiled)return void this._context.requestRender();const a=e.bindParameters;if(!a.shadowMap.enabled||!a.linearDepth)return;const u=e.rctx,p=this._technique;this._passParameters.highlight=s,this._drawParameters.origin=a.camera.center,u.bindFramebuffer(n?.fbo),u.bindTechnique(p,this._passParameters,a).bindDraw(this._drawParameters,a,this._passParameters),u.screen.draw()}updateParameters(e,i){this._passParameters.opacityElevation=1-D4(hbt,dbt,e.relativeElevation);const r=this.viewingMode===ht.Global?We(Tde,e.center):$e(Tde,0,0,1),n=He(r,i);this._passParameters.dayNightTerminator=D4(0,1,Je(30*n,0,1)),this._isVisible&&this.enable()}get _isVisible(){const{opacityElevation:e,dayNightTerminator:i}=this._passParameters;return this._maxOpacity*e*i>=ubt}};_([T()],kx.prototype,"_context",void 0),_([T()],kx.prototype,"view",void 0),_([T()],kx.prototype,"viewingMode",void 0),kx=_([Z("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],kx);const Tde=H(),J3={maxSearchSteps:8,maxDistanceAreaTex:16};function pbt(){const t=new lr;return t.include(Ga),t.fragment.uniforms.add(new kt("edgesTexture",e=>e.inputTexture)),t.fragment.uniforms.add(new kt("areaTexture",e=>e.areaTexture)),t.fragment.uniforms.add(new kt("searchTexture",e=>e.searchTexture)),t.fragment.code.add(F`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
        return texture(tex, coord + offset.x * resolution, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${F.int(J3.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${F.int(J3.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${F.int(J3.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${F.int(J3.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${F.int(J3.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        vec2 size = vec2(textureSize(edgesTexture, 0));
        vec2 resolution = 1.0 / size;
        vec2 pixelCoord = uv * size;
        vec4 offsets[2];
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${F.int(J3.maxSearchSteps)} );

        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
          d.y = coords.x;
          d = d * size.x - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
          d.y = coords.y;
          d = d * size.y - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `),t}const fbt=Object.freeze(Object.defineProperty({__proto__:null,build:pbt},Symbol.toStringTag,{value:"Module"}));let oOe=class aOe extends wr{initializeProgram(e){return new fr(e.rctx,aOe.shader.get().build(),ar)}initializePipeline(){return mi({colorWrite:Oi})}};oOe.shader=new pr(fbt,()=>ke(()=>import("./BlendWeights.glsl-59e698ff.js"),[],import.meta.url));function mbt(){const t=new lr;return t.include(Ga),t.fragment.uniforms.add(new kt("blendWeightsTexture",e=>e.inputTexture),new kt("colorTexture",e=>e.color)),t.fragment.code.add(F`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const gbt=Object.freeze(Object.defineProperty({__proto__:null,build:mbt},Symbol.toStringTag,{value:"Module"}));let lOe=class cOe extends wr{initializeProgram(e){return new fr(e.rctx,cOe.shader.get().build(),ar)}initializePipeline(){return mi({colorWrite:Oi})}};lOe.shader=new pr(gbt,()=>ke(()=>import("./Blur.glsl-aa173b7c.js"),[],import.meta.url));const Sde={threshold:.05,localConstrastAdaption:2};function ybt(){const t=new lr;return t.include(Ga),t.fragment.uniforms.add(new kt("colorTexture",e=>e.color)),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(F`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${F.float(Sde.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${F.float(Sde.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `),t}const vbt=Object.freeze(Object.defineProperty({__proto__:null,build:ybt},Symbol.toStringTag,{value:"Module"}));let uOe=class hOe extends wr{initializeProgram(e){return new fr(e.rctx,hOe.shader.get().build(),ar)}initializePipeline(){return mi({colorWrite:Oi})}};uOe.shader=new pr(vbt,()=>ke(()=>import("./EdgeDetect.glsl-262de06c.js"),[],import.meta.url));let _bt=class extends Vr{},vb=class extends $w{constructor(e){super(e),this._context=null,this._areaTexture=null,this._searchTexture=null,this._isEnabled=!1,this._smaaParameters=new _bt,this.produces=new Map([[De.ANTIALIASING,()=>this._isEnabled&&this._context!=null]])}consumes(){return rxe}get updating(){return this._abortController!=null}initializeRenderContext(e){this._context=e,this.addHandles([Fe(()=>this.view.qualitySettings.antialiasingEnabled,i=>i||this._context?.isFeatureEnabled(Os.Antialiasing)?this.enable():this.disable(),Ur)])}renderFeatureChanged(){this.view.qualitySettings.antialiasingEnabled||this._context?.isFeatureEnabled(Os.Antialiasing)?this.enable():this.disable()}uninitializeRenderContext(){this.disable(),this._context=null}enable(){if(this._isEnabled||!this._context||this._abortController)return;if(this._edgeTechnique==null&&(this._edgeTechnique=this._context.techniqueRepository.acquire(uOe)),this._blendTechnique==null&&(this._blendTechnique=this._context.techniqueRepository.acquire(oOe)),this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(lOe)),this._areaTexture&&this._searchTexture)return void(this._isEnabled=!0);this._abortController=new AbortController;const e=this._abortController.signal;ke(()=>import("./SMAAData-660b7d34.js"),[],import.meta.url).then(i=>this._loadTextures(this._context,i,e)).then(()=>{this._context?.requestRender(),this._abortController=null}).catch(i=>{qn(i)||this._disposeTextures()})}_loadTextures(e,i,r){return oi(r),e?Promise.all([Lg(i.areaTexture).then(n=>Ede(e.fbos.rctx,Si.LINEAR,ei.RGB,n)),Lg(i.searchTexure).then(n=>Ede(e.fbos.rctx,Si.NEAREST,ei.LUMINANCE,n))]).then(([n,s])=>{Ms(r)?(n.dispose(),s.dispose(),oi(r)):(this._areaTexture=n,this._searchTexture=s,this._isEnabled=!0)}):Promise.reject()}_disposeTextures(){this._areaTexture=jt(this._areaTexture),this._searchTexture=jt(this._searchTexture)}disable(){this._abortController=Vc(this._abortController),this._isEnabled=!1}destroy(){this.disable(),this._disposeTextures()}renderNode(e,i,r,n){const s=r?.composite?.colorTexture;if(!(this._isEnabled&&this._context&&r&&s))return n;if(!(this._edgeTechnique?.compiled&&this._blendTechnique?.compiled&&this._blurTechnique?.compiled))return this._context.requestRender(),n;const a=s.descriptor.width,u=s.descriptor.height,p=this._context.fbos,y=e.rctx;y.setViewport(0,0,a,u);const b=p.acquire(sr.RG,a,u);y.bindFramebuffer(b.fbo),y.setClearColor(0,0,0,1),y.clear(tn.COLOR_BUFFER_BIT),this._smaaParameters.color=s,y.bindTechnique(this._edgeTechnique,this._smaaParameters),y.screen.draw();const S=p.acquire(sr.RGBA,a,u);return y.bindFramebuffer(S.fbo),y.setClearColor(0,0,1,1),y.clear(tn.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=b.colorTexture,this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,y.bindTechnique(this._blendTechnique,this._smaaParameters),y.screen.draw(),y.bindFramebuffer(n?.fbo),b.release(),y.setClearColor(0,1,0,1),y.clear(tn.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=S.colorTexture,y.bindTechnique(this._blurTechnique,this._smaaParameters),y.screen.draw(),S.release(),n}};function Ede(t,e,i,r){const n=new Ar;return n.pixelFormat=i,n.wrapMode=Ai.CLAMP_TO_EDGE,n.width=r.width,n.height=r.height,n.samplingMode=e,new yi(t,n,r)}_([T()],vb.prototype,"view",void 0),_([T()],vb.prototype,"_context",void 0),_([T()],vb.prototype,"_abortController",void 0),_([T({readOnly:!0})],vb.prototype,"updating",null),vb=_([Z("esri.views.3d.webgl-engine.effects.smaa.SMAA")],vb);let bbt=class{constructor(){this._step=Ode,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,Me("disable-feature:high-quality-idle"))this._dilation=1;else{const n=i?performance.now()-this._firstIdleTime:0;if(n>=Cde+xbt)return this._step=1/0,void(this._dilation=1);this._dilation=n>=Cde?Tbt:1}const r=Je(e/wbt,Ode,Ebt);this._step===1/0?this._step=r:this._step=this._step*Ade+r*(1-Ade)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const wbt=.5,Cde=12e4,xbt=1e4,Tbt=10,Ade=.9,Sbt=30,Ode=1e3/1,Ebt=1e3/Sbt;let Cbt=class{constructor(e,i){this._fbos=e,this.compositingHelper=i,this._width=4,this._height=4}dispose(){this._color=Gi(this._color),this.releaseBuffers()}get framebuffer(){return this.color.detachDepth(),this.color.attachDepth(this.depth),this.color.fbo}get colorTexture(){return this.color.colorTexture}get depthTexture(){return this.depth.attachment}initializeFrame(e,i,r){this._fbos.interactive=!r;const n=this._fbos.rctx;this._width=e.fullWidth,this._height=e.fullHeight,o2(this,n.parameters.maxTextureSize);const s=this._color;return this._color=null,this.releaseBuffers(),this.bindFbo(),n.setClearStencil(0),n.setClearColor(i[0],i[1],i[2],i[3]),n.clearSafe(tn.COLOR_BUFFER_BIT|tn.DEPTH_BUFFER_BIT|tn.STENCIL_BUFFER_BIT),s}releaseBuffers(){this._color?.detachDepth(),this._depth=Gi(this._depth)}renderHUDVisibility(e,i,r){return e?.fbo.width===this._width&&e?.fbo.height===this._height||(e?.release(),e=this._fbos.acquire(sr.RGBA4,this._width,this._height)),e.attachDepth(r||this.depth),this._fbos.rctx.bindFramebuffer(e.fbo),this.renderToFBO(i,Abt),e.detachDepth(),e}compositeToHUDVisibility(e,i){this._fbos.rctx.bindFramebuffer(e.hudVisibility?.fbo),this.compositingHelper.compositeHUD(e,i)}renderOITPass(e,i,r){let n,s;switch(i){case Ut.Color:n=this._fbos.acquire(sr.RGBA16F,this._width,this._height),s=[0,0,0,0];break;case Ut.Alpha:n=this._fbos.acquire(sr.R16F,this._width,this._height),s=[1,1,1,1];break;case Ut.FrontFace:n=this._fbos.acquire(sr.RGBA,this._width,this._height),s=[0,0,0,0]}return r?(n.acquireDepth(Vs.DEPTH16_BUFFER),this._fbos.rctx.bindFramebuffer(n.fbo),this.renderToFBO(e,s,!0,!0),n.releaseDepth()):(n.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(n.fbo),this.renderToFBO(e,s),n.detachDepth()),n}compositeToFramebuffer(e,i,r,n){this.bindFbo(),this.compositingHelper.composite(e,i,r,n)}compositeTransparentOntoOpaque(e,i,r,n,s){s?(this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.setClearColor(0,0,0,1e-13),this._fbos.rctx.clearSafe(tn.COLOR_BUFFER_BIT)):this.bindFbo(),this.compositingHelper.compositeOIT(e,i.colorTexture,r.colorTexture,n.colorTexture)}renderDepthDetached(e){this._bindTarget(this.color),e(),this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,i,r,n=sr.RGBA,s=Vs.DEPTH16_BUFFER,a=this._width,u=this._height,p=null){return e?.fbo.width===a&&e?.fbo.height===u||(e=Gi(e)),e=e??this._fbos.acquire(n,a,u),s!=null&&e.acquireDepth(s),p?.forEach(y=>{e.acquireColor(y.format,y.attachment)}),this._fbos.rctx.bindFramebuffer(e.fbo),this.renderToFBO(i,r,!0,!0),e}renderToFBO(e,i,r=!1,n=!1){const s=this._fbos.rctx;let a=0;if(i){const p=Math.max(1e-13,i[3]);s.setClearColor(i[0],i[1],i[2],p),a|=tn.COLOR_BUFFER_BIT}r&&(a|=tn.DEPTH_BUFFER_BIT),n===!1?n=0:(n===!0&&(n=255),a|=tn.STENCIL_BUFFER_BIT),a&&s.clearSafe(a,n),e(),s.gl.flush()}renderToTargets(e,i,r,n,s=!1,a=!1){this._bindTarget(i,r),this.renderToFBO(e,n,s,a),i.detachDepth()}bindFbo(){this._bindTarget(this.color,this.depth)}_bindTarget(e,i){e.detachDepth(),e.attachDepth(i),this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._color||(this._color=this._fbos.acquire(sr.RGBA,this._width,this._height)),this._color}get depth(){return this._depth||(this._depth=this._fbos.acquireDepth(Vs.DEPTH_STENCIL_TEXTURE,this._width,this._height)),this._depth}};const Abt=[0,1,0,1],PN=255,Obt=1/PN;function Rbt(t){const e=new lr,i=e.fragment;return i.include(fd),i.include(ld),e.include(cN),e.include(Ga),e.include(uN,t),i.uniforms.add(new kt("depthMap",(r,n)=>n.linearDepth?.colorTexture),new On("inverseViewMatrix",(r,n)=>Ps(Rde,ec(Rde,n.camera.viewMatrix,n.camera.center))),new Lr("nearFar",(r,n)=>n.camera.nearFar)),i.constants.add("sampleValue","float",Obt),e.outputs.add("sampleCount","float"),i.code.add(F`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMapTex, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`),e}const Rde=Ze(),Mbt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:PN,build:Rbt},Symbol.toStringTag,{value:"Module"}));var QS;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(QS||(QS={}));let mW=class extends rc{constructor(){super(...arguments),this.visualization=QS.Gradient,this.bandsEnabled=!1}};_([ce({count:QS.COUNT})],mW.prototype,"visualization",void 0),_([ce()],mW.prototype,"bandsEnabled",void 0);let dOe=class extends Vr{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=aR(Pbt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const Pbt=vi(.01,0,.25,1);function Ibt(t){const e=new lr,i=e.fragment;i.include(fd),i.include(ld),e.include(cN),e.include(Ga);const{visualization:r,bandsEnabled:n}=t;i.constants.add("inverseSampleValue","float",PN),i.uniforms.add(new kt("shadowCastMap",u=>u.shadowCastMap),new lt("sampleScale",u=>u.sampleScale),new lt("opacityFromElevation",u=>u.opacityFromElevation),new er("uColor",u=>u.color));const s=r===QS.Gradient,a=r===QS.Threshold;return s&&n?i.uniforms.add(new lt("bandSize",u=>u.bandSize)):a&&i.uniforms.add(new lt("threshold",u=>u.threshold)),i.code.add(F`
      void main(void) {
        float record = texture(shadowCastMap, uv).r;
        float pixelSamples = record * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${a?F`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${s&&n?F`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${s?F`* strength`:""});
      }
    `),e}const $bt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:dOe,build:Ibt},Symbol.toStringTag,{value:"Module"}));let pOe=class fOe extends wr{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new fr(e.rctx,fOe.shader.get().build(this.configuration),ar)}initializePipeline(){return mi({blending:Xu,colorWrite:Oi,depthTest:null,depthWrite:null})}get primitiveType(){return Hi.TRIANGLE_STRIP}};pOe.shader=new pr($bt,()=>ke(()=>import("./ShadowCastVisualize.glsl-7740d0cd.js"),[],import.meta.url));const Lbt=4e4,Dbt=5e4,mOe=1/512;let K$=class extends Ke{constructor(e,i,r,n){super({}),this._techniqueRepository=e,this._rctx=i,this._data=r,this._requestRender=n,this._passParameters=new dOe(this._data),this._techniqueConfig=new mW,this._enabled=!1,this._vao=V0(i)}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=jt(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(pOe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const i=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(i,this._passParameters,e),this._rctx.drawArrays(i.primitiveType,0,dg(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>mOe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const i=this._passParameters.color;IT(e,i)||(mp(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};_([T()],K$.prototype,"opacityFromElevation",null),K$=_([Z("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],K$);let gOe=class yOe extends wr{constructor(e){super(e,new $ee,()=>this.destroy())}initializeProgram(e){return new fr(e.rctx,yOe.shader.get().build(this.configuration),ar)}initializePipeline(){return mi({blending:Zo(et.ONE,et.ONE,et.ONE,et.ONE),colorWrite:Oi,depthTest:null,depthWrite:null})}get primitiveType(){return Hi.TRIANGLE_STRIP}};gOe.shader=new pr(Mbt,()=>ke(()=>import("./ShadowCastAccumulate.glsl-b277f1fa.js"),[],import.meta.url));let zl=class extends Ke{constructor(e,i,r,n,s,a){super({}),this.fbos=e,this._stage=r,this._prepareForShadowMapPass=n,this._renderToShadowMap=s,this._requestRender=a,this._progress=0,this._sampleCount=0,this._passParameters=new hQ,this._cachedLightDirections=[],this._depthRange=aW,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new $7(new IQ(e,r.viewingMode),null),this._bindParameters.shadowMap.enabled=!0,this._vao=V0(this._rctx),this._accumulationRenderer=new K$(i,this._rctx,this,a);const u=this._stage.view.resourceController.scheduler;this.addHandles([u.registerTask(Zt.SHADOW_ACCUMULATOR,this),Fe(()=>r.renderView,p=>{this.removeHandles(Mde),p!=null&&this.addHandles(p.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),Mde)},Ur),Fe(()=>this._previewing,()=>this._requestRenderIfEnabled(),$r)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=jt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=jt(this._fbo),this._vao=jt(this._vao),this._accumulationTechniqueCached=Gi(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new gOe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._bindParameters.linearDepth?.colorTexture!==null&&this._depthRange!==aW&&this._opacityFromElevation>mOe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const i=this._cachedLightDirections;if(bg(i,e,j2))return;const r=Math.min(PN,e.length);i.length=r,this._sampleCount=r;for(let n=0;n<r;++n)i[n]=Ie(i[n]??H(),e[n]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,i,r,n){if(this._depthRange=i,this._updateCamera(r),this._bindParameters.contentCamera=n,this._bindParameters.linearDepth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(Nbt,this._sampleCount-this._progress);for(let a=0;a<s;++a)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const i=this._fbo!=null;e.enabled!==i&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||i<0||i>=this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,ei.RED,Qs.UNSIGNED_BYTE,Pde),Pde[0]/this._progress)}_enable(){this._progress=0;const e=new Ar;e.pixelFormat=ei.RED,e.internalFormat=Mt.R8,e.wrapMode=Ai.CLAMP_TO_EDGE,this._fbo=new qp(this._rctx,e)}_disable(){this._fbo=jt(this._fbo)}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(tn.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,dg(this._vao,"geometry"))}_updateCamera(e){!e.equals(this._bindParameters.camera)&&this._fbo&&(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-D4(Lbt,Dbt,e.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};_([T()],zl.prototype,"_progress",void 0),_([T()],zl.prototype,"_sampleCount",void 0),_([T()],zl.prototype,"_fbo",void 0),_([T()],zl.prototype,"_depthRange",void 0),_([T()],zl.prototype,"_previewing",void 0),_([T()],zl.prototype,"_accumulationRenderer",void 0),_([T()],zl.prototype,"_isRefining",null),_([T()],zl.prototype,"_isActive",null),_([T()],zl.prototype,"canAccumulate",null),_([T()],zl.prototype,"_isDoneAccumulating",null),_([T()],zl.prototype,"_opacityFromElevation",null),_([T()],zl.prototype,"running",null),zl=_([Z("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],zl);const Nbt=6,Mde="renderView",Pde=new Uint8Array(1),Ide=zg();let Fbt=class{constructor(){this._plane=zg()}get isEnabled(){return!gbe(this.plane,Ide)}get plane(){return this._plane}set plane(e){Aw(e||Ide,this._plane)}};function kbt(t,e){const i=-t[0],r=-t[1],n=-t[2],s=e[3],a=e[7],u=e[11],p=e[15];e[0]+=s*i,e[1]+=s*r,e[2]+=s*n,e[4]+=a*i,e[5]+=a*r,e[6]+=a*n,e[8]+=u*i,e[9]+=u*r,e[10]+=u*n,e[12]+=p*i,e[13]+=p*r,e[14]+=p*n}function zbt(t,e){const i=t[0],r=t[1],n=t[2];e[12]+=i*e[0]+r*e[4]+n*e[8],e[13]+=i*e[1]+r*e[5]+n*e[9],e[14]+=i*e[2]+r*e[6]+n*e[10],e[14]+=i*e[3]+r*e[7]+n*e[11]}let Ubt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const i=this._originData.get(e.id)||new jbt(e);return i.refCount++,this._originData.has(i.origin.id)||this._originData.set(i.origin.id,i),i}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(i=>{bs(i.viewMatrix,e),zbt(i.origin.vec3,i.viewMatrix)})}},jbt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=Ze()}},Bbt=class extends S3e{constructor(e,i){super(),this.distanceFalloffFactor=e,this.transparency=i,this.transformNormalViewFromGlobal=Pn()}},Vbt=class extends E3e{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Pn(),this.slicePlaneLocalOrigin=H(),this.transformNormalGlobalFromModel=Pn()}};function Gbt(t){const e=F`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const Hbt=Xi(.5,-4e-4);function qbt(t,e){const i=t.vertex;i.include(Gbt),i.constants.add("depthBias","vec2",Hbt),i.uniforms.add(new Lr("inverseViewport",(r,n)=>n.inverseViewport)),e.legacy?(i.uniforms.add(new On("proj",(r,n)=>n.camera.projectionMatrix)),i.code.add(F`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new Xp("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal),new On("transformProjFromView",r=>r.transformProjFromView)),i.code.add(F`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(F`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function Wbt(t,e){const i=t.fragment;i.constants.add("coverageTestThreshold","float",.01),e.antialiasing?i.code.add(F`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(F`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function Xbt(t,e){const i=t.vertex;e.silhouette?(i.code.add(F`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?i.code.add(F`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(F`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(F`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function Jbt(t,e){const i=t.vertex;i.include(fd),i.uniforms.add(new lt("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(F`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new Wh("componentDataTex",r=>r.componentDataTexture)),t.attributes.add(X.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("verticalOffsetScale","float",2*Aee),i.code.add(F`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),e.legacy?i.code.add(F`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new rO("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(F`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(X.NORMALA,"vec3"),t.attributes.add(X.NORMALB,"vec3"),i.code.add(F`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(X.NORMAL,"vec3"),i.code.add(F`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?i.code.add(F`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(lK,e),i.uniforms.add(new Xp("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new rO("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Wu("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new Wu("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new _i("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new _i("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)),i.code.add(F`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?F`normalize(transformWorldFromModelTL + rotatedModelPosition);`:F`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new On("transformProjFromView",(r,n)=>n.camera.projectionMatrix)),i.code.add(F`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(F`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function Ybt(t){return t.mode===Js.SKETCH||t.mode===Js.MIXED}var Js,Yb;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(Js||(Js={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(Yb||(Yb={}));function Lee(t,e){const i=t.vertex;switch(t.attributes.add(X.SIDENESS,"vec2"),e.mode===Js.MIXED?i.code.add(F`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(F`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case Js.MIXED:i.code.add(F`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Js.SKETCH:i.code.add(F`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Js.SOLID:i.code.add(F`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Js.COUNT:break;default:e.mode}}function Zbt(t,e){const i=t.vertex;switch(t.include(Lee,e),e.mode){case Js.SOLID:i.code.add(F`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Js.SKETCH:i.uniforms.add(new A2("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(F`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Js.MIXED:i.uniforms.add(new A2("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(F`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function Kbt(t,e){t.include(Lee,e);const{vertex:i,fragment:r}=t;switch(Ybt(e)&&(i.uniforms.add(new Wh("strokesTexture",n=>n.strokesTexture.texture)),i.uniforms.add(new A2("strokesLog2Resolution",n=>Math.log2(n.strokesTexture.resolution)),new A2("strokeVariants",n=>n.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),r.uniforms.add(new Wh("strokesTexture",n=>n.strokesTexture.texture),new A2("strokesNormalizationScale",n=>n.strokesTexture.normalizationScale)),i.code.add(F`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(fd),r.code.add(F`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case Js.SOLID:i.code.add(F`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(F`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Js.SKETCH:i.code.add(F`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(F`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Js.MIXED:t.varyings.add("vType","float"),i.code.add(F`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(F`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function Qbt(t){const e=new lr,{vertex:i,fragment:r}=e;return t.legacy&&i.uniforms.add(new $de("model"),new $de("localView")),e.include(qbt,t),e.include(Jbt,t),e.include(Zbt,t),e.include(Lee,t),e.include(Kbt,t),e.include(ss,t),e.include(Xbt,t),e.include(Wbt,t),e.include(Jc,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),t.multipassEnabled&&e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add(new Lr("pixelToNDC",(n,s)=>Yi(e2t,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new er("viewport",(n,s)=>s.camera.fullViewport),new lt("pixelRatio",(n,s)=>s.camera.pixelRatio)),e.attributes.add(X.POSITION0,"vec3"),e.attributes.add(X.POSITION1,"vec3"),e.attributes.add(X.VARIANTOFFSET,"float"),e.attributes.add(X.VARIANTSTROKE,"float"),e.attributes.add(X.VARIANTEXTENSION,"float"),i.code.add(F`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      ${t.multipassEnabled?"vViewPos = viewPos;":""}

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?F`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:F`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===Js.SKETCH?F`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===Js.MIXED?F`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),r.code.add(F`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.multipassEnabled?"terrainDepthTest(vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const e2t=Ct();let $de=class extends zn{constructor(e){super(e,"mat4")}};const t2t=Object.freeze(Object.defineProperty({__proto__:null,build:Qbt},Symbol.toStringTag,{value:"Module"}));let vOe=class _Oe extends wr{initializeProgram(e){return new fr(e.rctx,_Oe.shader.get().build(this.configuration),F4e)}initializePipeline(e){return e.blendMinMax?mi({blending:Zo(et.ONE,et.ONE,et.ZERO,et.ONE,R0.ADD,e.blendMinMax.MAX),depthTest:{func:Tr.LEQUAL},colorWrite:Oi}):mi({depthTest:{func:Tr.LEQUAL},depthWrite:ic,colorWrite:Oi})}};vOe.shader=new pr(t2t,()=>ke(()=>import("./EdgeShader.glsl-17a9f6a0.js"),[],import.meta.url));let qd=class extends _l{constructor(){super(...arguments),this.mode=Js.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.spherical=!1}};_([ce({count:Js.COUNT})],qd.prototype,"mode",void 0),_([ce()],qd.prototype,"hasSlicePlane",void 0),_([ce()],qd.prototype,"silhouette",void 0),_([ce()],qd.prototype,"legacy",void 0),_([ce()],qd.prototype,"antialiasing",void 0),_([ce()],qd.prototype,"doublePrecisionRequiresObfuscation",void 0),_([ce()],qd.prototype,"multipassEnabled",void 0),_([ce()],qd.prototype,"cullAboveGround",void 0),_([ce()],qd.prototype,"spherical",void 0),_([ce({constValue:!1})],qd.prototype,"occlusionPass",void 0);const i2t=8,TU=128,r2t={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},n2t={solid:Js.SOLID,sketch:Js.SKETCH,uber:Js.MIXED};let SU=class bOe{constructor(e,i,r){this._rctx=e,this._shaderTechniqueRepository=i,this._configuration=new qd,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[Pi.TRANSPARENT]:{[Pi.TRANSPARENT]:new xi,[Pi.OPAQUE]:new xi},[Pi.OPAQUE]:{[Pi.TRANSPARENT]:new xi,[Pi.OPAQUE]:new xi}},this._renderablesDirty=!1,this._drawParameters=new Vbt,this._settings={...r2t,...r},this.key=bOe.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const n=this._settings.strokesTexture.variants;this.writerSettings={variants:n,reducedPrecision:Xr.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=n2t[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=r.spherical}dispose(){this._technique=Gi(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,i){this._renderablesDirty&&this._sortRenderables();const r=this._sortedRenderables[i];r[Pi.TRANSPARENT].forAll(e),r[Pi.OPAQUE].forAll(e)}updateTechnique(e,i){return this._configuration.multipassEnabled=!!e.multipassEnabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=i,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(vOe,this._configuration,this._technique),this._technique}bindRegularEdges(e,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!1),e,i)}bindSilhouetteEdges(e,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!0),e,i)}renderRegularEdges(e,i,r,n,s){this._render(e,i,i.regular.vao,r,n,s)}renderSilhouetteEdges(e,i,r,n,s){this._render(e,i,i.silhouette.vao,r,n,s)}_render(e,i,r,n,s,a){a>0&&(this._bindDraw(e,i,n,s),this._rctx.bindVAO(r),this._rctx.drawArraysInstanced(Hi.TRIANGLE_FAN,0,4,a))}_bindDraw(e,i,r,n){if(this._drawParameters.componentDataTexture=i.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in i.transform)this._lastOriginId!==i.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",i.transform.origin.viewMatrix),this._lastOriginId=i.transform.origin.origin.id),e.setUniformMatrix4fv("model",i.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=i.transform.origin.origin.vec3;else{const s=new MN(i.transform.position),a=od(Lde,Rw(Lde,i.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=s.low,this._drawParameters.transformWorldFromModelTH=s.high,this._drawParameters.transformWorldFromModelRS=i.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=a;const u=n.camera.viewInverseTransposeMatrix;$e(this._drawParameters.slicePlaneLocalOrigin,u[3],u[7],u[11])}e.bindDraw(this._drawParameters,n,r)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[Pi.TRANSPARENT][Pi.TRANSPARENT].clear(),this._sortedRenderables[Pi.TRANSPARENT][Pi.OPAQUE].clear(),this._sortedRenderables[Pi.OPAQUE][Pi.TRANSPARENT].clear(),this._sortedRenderables[Pi.OPAQUE][Pi.OPAQUE].clear(),this._renderables.forEach(i=>{i.objectTransparency!==Pi.INVISIBLE&&i.edgeTransparency!==Pi.INVISIBLE&&this._sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const e=(i,r)=>"origin"in i.transform?"origin"in r.transform?i.transform.origin.origin.id<r.transform.origin.origin.id?-1:i.transform.origin.origin.id>r.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[Pi.TRANSPARENT][Pi.TRANSPARENT].sort(e),this._sortedRenderables[Pi.TRANSPARENT][Pi.OPAQUE].sort(e),this._sortedRenderables[Pi.OPAQUE][Pi.TRANSPARENT].sort(e),this._sortedRenderables[Pi.OPAQUE][Pi.OPAQUE].sort(e)}static getKey(e,i,r){return`edges-t:${e}:${i}:${r}`}};const Lde=za();function BBt(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new NYe(t.layout)}}function L9(t){return new j3e(t.layout).createView(t.buffer)}let s2t=class extends OAe{constructor(e){super("EdgeProcessingWorker","extract",{extract:i=>[i.dataBuffer],extractComponentsEdgeLocations:i=>[i.dataBuffer],extractEdgeLocations:i=>[i.dataBuffer]},e)}async process(e,i,r){if(r)return d_t(e);const n=await this.invoke(new EU(e),i);return this._unpackOutput(n)}async extractEdgeLocations(e,i){const r=await this.invokeMethod("extractEdgeLocations",new EU(e),i);return L9(r)}async extractComponentsEdgeLocations(e,i){const r=await this.invokeMethod("extractComponentsEdgeLocations",new EU(e),i);return L9(r)}_unpackOutput(e){return{regular:{instancesData:L9(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:L9(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},EU=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=Zh(e.indices)?e.indices:e.indices.buffer,this.indicesType=Zh(e.indices)?"Array":gD(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function o2t(t){const i=FC.resolution,r=i/2,n=new Uint8Array(4*i*i),s=4*i*r,a=FC.amplitude,u=2*a,p=4*i,y=Math.log2(i)+1,b=FC.strokes.length;let S=(y-1)*b*p;for(const{distance:O,pressure:P}of FC.strokes){let $=O,N=P,z=S;for(let U=0;U<y;U++){U!==0&&($=Dde($,CO.DISTANCE),N=Dde(N,CO.PRESSURE));for(let j=0;j<FC.resolution;j++){const G=.5+($?$[j%$.length]/u:0),q=N?N[j%N.length]:1;yO(G,n,z),yO(q,n,z+s),z+=4}z-=p*(b+1)}S+=p}const C=new yi(t,new Ar(i),n);return new l2t(i,u,a,b,C)}function Dde(t,e){if(!t)return null;const i=t.length/2,r=a2t*i,n=new Array(i);let s=0;const a=e===CO.PRESSURE;for(let u=0;u<t.length;u+=2){const p=(t[u]+t[u+1])/2;n[s++]=a?Math.min(r,1-(1-p)*Nde):Math.min(r,p*Nde)}return n}var CO;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(CO||(CO={}));const a2t=.1,Nde=.5;let l2t=class{constructor(e,i,r,n,s){this.resolution=e,this.normalizationScale=i,this.amplitude=r,this.variants=n,this.texture=s}dispose(){this.texture=jt(this.texture)}};const FC={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function Fde(t){let e=null;for(const i of t){const r=i.type;if(c2t(i)){if(e==null)e=r;else if(e!==r)return"uber"}}return e??"uber"}function kde(t){let e=Pi.INVISIBLE;for(const{material:i}of t)if(wOe(i)){if(i.color[3]*i.opacity<1)return Pi.TRANSPARENT;e=Pi.OPAQUE}return e}function zde(t){let e=Pi.INVISIBLE;for(const{material:i}of t)if(wOe(i)){switch(i.objectTransparency){case Pi.TRANSPARENT:case Pi.INVISIBLE:return Pi.TRANSPARENT;case Pi.OPAQUE:if(i.opacity<1)return Pi.TRANSPARENT}e=Pi.OPAQUE}return e}function wOe(t){return t.size*t.color[3]*t.opacity>0}function c2t(t){return t.size*t.color[3]>0}function Ude(t,e,i,r){for(let n=0;n<t.length;n++){const s=t[n].index,a=e[n],u=e[n+1];if(r)for(let p=a;p<u;p++){const y=r[p];i.set(y,s)}else for(let p=a;p<u;p++)i.set(p,s)}}let Wd=class extends Ke{constructor(t){super(t),this._updatingHandles=new Cp,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=H(),this._localOrigins=new Ubt(new PQ(t.renderSR))}initialize(){this._worker=new s2t(this.schedule),this._componentColorManager=new U4e(this.rctx,3);const t=N4e.createBuffer(4);for(let e=0;e<4;e++)t.sideness.set(e,0,e===0||e===3?0:1),t.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=xr.createVertex(this.rctx,dr.STATIC_DRAW,t.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(t=>this._discardObjectEntry(t)),this._perObjectData.clear(),this._strokesTexture=jt(this._strokesTexture),this._componentColorManager=ct(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=jt(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",f2t))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(t,e,i,r,n,s,a,u){if(this.hasObject(t))return this.getObjectMemoryUsage(t);let p;const y=new Bde(new Promise(S=>p=S),i.center,i.radius);this._perObjectData.set(t,y);const b=await this._updatingHandles.addPromise(this._addComponentGeometry(e,y,r,n,s,a,u));return this.setNeedsRender(),p(),b}async addOrUpdateObject3D(t,e,i,r){if(this.destroyed)return void Ee.getLogger(this).warn("Attempt to add an object to a destroyed instance");const n=this._perObjectData.get(t);let s;n?.renderables.length>0&&this._perObjectDataEvictionCache.add(n);const a=t.boundingVolumeWorldSpace.bounds,u=new Bde(new Promise(y=>s=y),a,ug(a));this._perObjectData.set(t,u);const p=new Array;if(i.mergeGeometries&&t.geometries.length>1&&u2t(t))p.push(this._addObjectMergedGeometries(t,u,e,i,r));else for(let y=0;y<t.geometries.length;y++){const b=t.geometries[y];b.material.supportsEdges&&p.push(this._addGeometry(t,u,b,e[0],i,r))}await this._updatingHandles.addPromise(Promise.all(p)),this._perObjectDataEvictionCache.delete(u),this._discardObjectEntry(n),this.setNeedsRender(),s()}fastUpdateObject3DEdgesTransform(t){if(this.destroyed)return!1;const e=this._perObjectData.get(t);if(!e)return!1;const{geometries:i}=t,{renderables:r}=e;if(i.length===0||r.length===0)return!0;if(r.length>1)return!1;const[n]=r,s=n.transform;if(!(s instanceof CU))return!1;const[a]=i;if(a.localOrigin!==s.origin.origin)return!1;const u=Ze(),p=this._computeModelTransformWithLocalOrigin(t,a,u);return n.transform=new CU(u,p),this.setNeedsRender(),!0}_discardObjectEntry(t){t&&(t.renderables.length&&(t.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),t.loaded=null)}hasObject(t){return this._perObjectData.has(t)}async updateAllComponentOpacities(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));if(i==null)return;const r=e instanceof Array?n=>e[n]:()=>e;i.renderables.forEach(n=>{const s=n.components.meta.length;for(let a=0;a<s;a++){const u=r(a),p=n.components.meta[a],y=p.index;p.material.opacity=u,n.components.buffer.textureBuffer.setDataElement(y,1,3,255*u)}this._updateTransparency(n)}),this.setNeedsRender()}async getObjectMemoryUsage(t){const e=await this._getObjectEntry(t);return e!=null?e.renderables.reduce((i,r)=>i+r.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(t,e,i,r){const n=t instanceof Xg,s=!!i.hasSlicePlane,a=Fde(e),u=SU.getKey(a,s,n),p=await this._updatingHandles.addPromise(this._getObjectEntry(t));p!=null&&(p.renderables.forEach(y=>{if(u!==y.rendererKey){const b=this._renderers.get(y.rendererKey),S=this._acquireRenderer(a,s,n);b.removeRenderable(y),--b.refCount,y.rendererKey=u,S.addRenderable(y)}for(let b=0;b<e.length;b++)y.components.meta[b].material=e[b];r&&this._updateComponentBuffer(y.components),this._updateTransparency(y)}),this.setNeedsRender())}async updateAllVerticalOffsets(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));i!=null&&(i.renderables.forEach(r=>{const n=r.components.meta;for(let s=0;s<n.length;s++)r.components.meta[s].verticalOffset=e?.[s]??0;this._updateComponentBuffer(r.components)}),this.setNeedsRender())}async updateObjectVisibility(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));i!=null&&(i.renderables.forEach(r=>r.visible=e),this.setNeedsRender())}removeObject(t){const e=this._perObjectData.get(t);e&&(this._perObjectData.delete(t),this._discardObjectEntry(e))}async _getObjectEntry(t){const e=this._perObjectData.get(t);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(t,e){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(t.camera.viewMatrix);const i=t.camera.viewInverseTransposeMatrix,r=H(),n=new MN;let s=0,a=0;if(this._renderers.forEach(p=>{if(p.refCount===0)return this._renderers.delete(p.key),void p.dispose();let y=!0,b=!0;p.forEachRenderable(S=>{S.visible&&(s+=S.statistics.averageEdgeLength,a++,y&&S.regular&&(p.updateTechnique(t,!1),y=!1),b&&S.silhouette&&(p.updateTechnique(t,!0),b=!1))},e)}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),a===0)return;const u=new Bbt(40*s/a,e);$e(r,i[3],i[7],i[11]),n.set(r),Ie(u.transformWorldFromViewTH,n.high),Ie(u.transformWorldFromViewTL,n.low),sd(u.transformViewFromCameraRelativeRS,t.camera.viewMatrix),od(qde,u.transformViewFromCameraRelativeRS),Rw(u.transformNormalViewFromGlobal,qde),u.transformProjFromView=t.camera.projectionMatrix,this._updateObjectCameraDistances(t),this._renderers.forEach(p=>{this._renderRegularEdges(p,t,u),this._renderSilhouetteEdges(p,t,u)})}_updateTransparency(t){const e=kde(t.components.meta),i=zde(t.components.meta);e===t.edgeTransparency&&i===t.objectTransparency||(t.edgeTransparency=e,t.objectTransparency=i,this._renderers.get(t.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(t,e,i){t.getCombinedShaderTransformation(e,i);const r=e.localOrigin!=null?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire($e(this._tmpModelPosition,i[12],i[13],i[14]));return e.localOrigin=r.origin,kbt(r.origin.vec3,i),r}_updateComponentBuffer(t){const{meta:e,buffer:i}=t,r=new Uint8Array(4);for(let n=0;n<e.length;n++){const s=e[n].material,a=e[n].index,u=Je(Math.round(s.size*i2t),0,255),p=Je(s.extensionLength,-TU,255-TU)+TU,y=s.type==="solid"?V8.SOLID:V8.SKETCH,b=255*s.opacity,S=s.color,C=255*S[0],O=255*S[1],P=255*S[2],$=255*S[3];i.textureBuffer.setData(a,0,C,O,P,$),i.textureBuffer.setData(a,1,u,p,y,b),I4e(e[n].verticalOffset,r),i.textureBuffer.setData(a,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(t){if(this._componentColorManager==null)return null;const e=new Array,i=this._componentColorManager.getBuffer(t.length);for(let n=0;n<t.length;n++){const s=t[n],a=i.acquireIndex();e.push({index:a,verticalOffset:0,material:s})}const r=new h2t(i,e);return this._updateComponentBuffer(r),r}_extractEdges(t,e,i,r,n,s=n.length){return this._worker.process({data:e,indices:n,indicesLength:s,writerSettings:t,skipDeduplicate:i},this._workerAbort.signal,r)}_createRenderable(t,e,i,r,n){const s=y=>this._verticesBufferObject!=null?new d2t(new Wp(this.rctx,F4e,{vertices:t_t,instances:y===Yb.REGULAR?j8.glLayout:B8.glLayout},{vertices:this._verticesBufferObject,instances:xr.createVertex(this.rctx,dr.STATIC_DRAW,y===Yb.REGULAR?t.regular.instancesData.buffer:t.silhouette.instancesData.buffer)}),y===Yb.REGULAR?t.regular.lodInfo:t.silhouette.lodInfo):null,a=t.regular.lodInfo.lengths.length>0?s(Yb.REGULAR):null,u=t.silhouette.lodInfo.lengths.length>0?s(Yb.SILHOUETTE):null,p=(a?.vao.usedMemory??0)+(u?.vao.usedMemory??0);return new p2t(a,u,{gpuMemoryUsage:p,externalMemoryUsage:n,averageEdgeLength:t.averageEdgeLength},i,kde(e.meta),zde(e.meta),e,r)}async _addGeometry(t,e,i,r,n,s){if(i.edgeIndicesLength<=0)return;const a=i.attributes.get(X.POSITION),u=Ze(),p=this._computeModelTransformWithLocalOrigin(t,i,u),y=new Hde(a,u,p);return this._addPositionData(e,y,i.edgeIndicesLength,r,n,s)}async _addPositionData(t,e,i,r,n,s=!1){if(t.loaded==null)return;const a=this._createComponentBuffers([r]);if(a==null)return;const u=this._acquireRenderer(r.type,!!n.hasSlicePlane,!0),{modelTransform:p,origin:y}=e,b=e.position.indices,S=e.position,C=S.data.length/S.size,O=z8.createBuffer(C);for(let N=0;N<C;N++)O.position.set(N,0,S.data[N*S.size]),O.position.set(N,1,S.data[N*S.size+1]),O.position.set(N,2,S.data[N*S.size+2]);Ude(a.meta,[0,O.componentIndex.count],O.componentIndex);const P=await this._updatingHandles.addPromise(this._extractEdges(u.writerSettings,O,!1,s,b,i));if(t.loaded==null)return;const $=this._createRenderable(P,a,new CU(p,y),u.key,!1);t.renderables.push($),u.addRenderable($),this._gpuMemoryUsage+=$.statistics.gpuMemoryUsage}async _addComponentGeometry(t,e,i,r,n,s,a){if(e.loaded==null)return 0;const u=this._createComponentBuffers(s);if(u==null)return 0;const p=Fde(s),y=this._acquireRenderer(p,a.hasSlicePlane||!1,!1),b=z8.createBuffer(i.length/3);$R(b.position.typedBuffer,i,b.position.typedBufferStride,3),Ude(u.meta,n,b.componentIndex,r);const S=!0,C=y.writerSettings,O=await this._updatingHandles.addPromise(this._extractEdges(C,b,S,!1,r));if(e.loaded==null)return 0;const P=this._createRenderable(O,u,t,y.key,!0);return e.renderables.push(P),y.addRenderable(P),P.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(t,e,i,r,n){const s=new Map;let a=0,u=null,p=0;const y=t.geometries.filter(U=>{if(U.edgeIndicesLength<=0||!U.material.supportsEdges)return!1;!u&&U.localOrigin&&(u=U);const j=U.attributes.get(X.POSITION);return p+=j.data.length/j.size,a+=U.edgeIndicesLength,!0});if(y.length===0)return;const b=p>=65536?Uint32Array:Uint16Array,S=a?new b(a):null,C=[];let O=0;y.forEach(U=>{const j=U.attributes.get(X.POSITION),G=j.indices;let q=s.get(j.data);if(q==null){q=C.length/3;for(let W=0;W<j.data.length;W+=j.size)C.push(j.data[W]),C.push(j.data[W+1]),C.push(j.data[W+2]);s.set(j.data,q)}for(let W=0;W<U.edgeIndicesLength;W++)S[O++]=q+G[W]});const P=u||t.geometries[0],$=Ze(),N=this._computeModelTransformWithLocalOrigin(t,P,$);for(let U=0;U<t.geometries.length;U++)t.geometries[U].localOrigin=N.origin;const z=new Hde(new Et(C,S,3),$,N);await this._updatingHandles.addPromise(this._addPositionData(e,z,S.length,i[0],r,n))}_acquireRenderer(t,e,i){const r=SU.getKey(t,e,i);let n=this._renderers.get(r);return this._strokesTexture==null&&(this._strokesTexture=o2t(this.rctx)),n||(n=new SU(this.rctx,this.techniqueRepository,{type:t,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:i,spherical:this.viewingMode===ht.Global}),this._renderers.set(r,n)),++n.refCount,n}_removeRenderable(t){jde(t.regular),jde(t.silhouette);const e=this._renderers.get(t.rendererKey);if(e){e.removeRenderable(t),--e.refCount,"origin"in t.transform&&this._localOrigins.release(t.transform.origin),this._gpuMemoryUsage-=t.statistics.externalMemoryUsage?0:t.statistics.gpuMemoryUsage;for(const i of t.components.meta)t.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(t){const e=t.camera.eye,i=t.camera.viewForward,r=H(),n=s=>{Ao(r,s.center,e);const a=He(r,i),u=s.radius,p=a<-u?1/0:a<u?0:a-u;s.renderables.forEach(y=>y.distanceToCamera=p)};this._perObjectData.forEach(n),this._perObjectDataEvictionCache.forEach(n)}_renderRegularEdges(t,e,i){const r=t.bindRegularEdges(i,e),n=i.transparency,s=e.camera.perScreenPixelRatio;t.forEachRenderable(a=>{if(!Vde(a)||!a.visible)return;const u=D9(a.regular.lod.lengths,a.distanceToCamera,s);t.renderRegularEdges(r,a,i,e,u)},n)}_renderSilhouetteEdges(t,e,i){const r=t.bindSilhouetteEdges(i,e),n=i.transparency,s=e.camera.perScreenPixelRatio;t.forEachRenderable(a=>{if(!Gde(a)||!a.visible)return;const u=D9(a.silhouette.lod.lengths,a.distanceToCamera,s);t.renderSilhouetteEdges(r,a,i,e,u)},n)}get test(){return{hasRenderedPrimitives:t=>{let e=!1;const i=t.perScreenPixelRatio,r=(n,s)=>n.forEachRenderable(a=>{a.visible&&!e&&(Vde(a)&&(e=D9(a.regular.lod.lengths,a.distanceToCamera,i)>0),!e&&Gde(a)&&(e=D9(a.silhouette.lod.lengths,a.distanceToCamera,i)>0))},s);return this._renderers.forEach(n=>{e||(r(n,Pi.OPAQUE),r(n,Pi.TRANSPARENT))}),e},getObjectData:t=>this._perObjectData.get(t)}}};function jde(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.disposeVAOOnly(),t.vao=null)}function u2t(t){let e=null,i=null;for(let r=0;r<t.geometries.length;r++){const n=t.geometries[r];if(n.material.supportsEdges){if(e){if(!bg(e,n.transformation))return!1}else e=n.transformation;if(i||n.localOrigin==null){if(i?.localOrigin!=null&&n.localOrigin!=null&&i.localOrigin.id!==n.localOrigin.id)return!1}else i=n}}return!0}_([T({constructOnly:!0})],Wd.prototype,"rctx",void 0),_([T({constructOnly:!0})],Wd.prototype,"renderSR",void 0),_([T({constructOnly:!0})],Wd.prototype,"viewingMode",void 0),_([T({constructOnly:!0})],Wd.prototype,"techniqueRepository",void 0),_([T({constructOnly:!0})],Wd.prototype,"setNeedsRender",void 0),_([T({constructOnly:!0})],Wd.prototype,"schedule",void 0),_([T({readOnly:!0})],Wd.prototype,"_updatingHandles",void 0),_([T({readOnly:!0})],Wd.prototype,"updating",null),Wd=_([Z("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Wd);class Bde{constructor(e,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}class h2t{constructor(e,i){this.buffer=e,this.meta=i}}class d2t{constructor(e,i){this.vao=e,this.lod=i}}let CU=class{constructor(e,i){this.modelMatrix=e,this.origin=i}};class p2t{constructor(e,i,r,n,s,a,u,p){this.regular=e,this.silhouette=i,this.statistics=r,this.transform=n,this.edgeTransparency=s,this.objectTransparency=a,this.components=u,this.rendererKey=p,this.distanceToCamera=0,this.visible=!0}}function Vde(t){return t.regular!=null}function Gde(t){return t.silhouette!=null}function D9(t,e,i){const r=e*i,n=qPe(t,r,!0);return n===-1?r<t[0]?t.length:0:t.length-n}class Hde{constructor(e,i,r){this.position=e,this.modelTransform=i,this.origin=r}}const qde=Pn(),f2t=()=>Promise.reject();function Jp(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let Wde=class{constructor(e,i,r,n,s,a,u,p,y){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=n,this.disjoint=s,this.beginTimeElapsed=a,this.endTimeElapsed=u,this.createTimestamp=p,this.timestampBits=y}},Mm=!1;function m2t(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i&&Jp(t)?new Wde(()=>t.createQuery(),r=>{t.deleteQuery(r),Mm=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{Mm||(Mm=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),Mm=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new Wde(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),Mm=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{Mm||(Mm=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),Mm=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function g2t(t,e){const i=t.capabilities.disjointTimerQuery;return i==null?null:new y2t(i,e)}let y2t=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const n=this._timer.createQuery(),s=this._timer.createQuery();this._queryPool.push(n,s),this._queryResults.set(r,null)})}start(){Mm||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(i==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var dn;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINES="laser lines",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(dn||(dn={}));const Xde="Total";let v2t=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new ig(Xde),this._cpuTimeSamplers=new Map(Object.values(dn).map(i=>[i,new ig(i)])),this._enableGPUTimer=0,this._totalGPUTime=new ig("GPU"),this._gpuTimeSamplers=new Map(Object.values(dn).map(i=>[i,new ig(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const i=[...Object.values(dn),Xde];this._gpuTimerPool=g2t(this._rctx,i)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=jt(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).record(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const i=this._gpuTimerPool.stop(dn.FINISH);this._gpuTimeSamplers.get(dn.FINISH).record(i),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}},fu=class extends Ke{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(t=null,e=!Me("disable-feature:high-quality-idle")){this._renderStateFeatures=Rk(e,t),this.notifyChange("_renderStateFeatures"),this._renderPlugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(t,e=this._state){return this._renderStateFeatures.get(e,t)??!1}setFeatureEnabled(t,e,i){this._renderStateFeatures.set(e,t,i),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Os.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(Os.WaterReflection))}get hasDecorations(){return this._materialRenderersHas.decorations||this._renderPlugins.hasDecorations}get hasHighlights(){return this._materialRenderersHas.highlights||this._renderPlugins.produces(De.OPAQUE_MATERIAL,oe.Highlight)||this._renderPlugins.produces(De.DRAPED_MATERIAL,oe.Highlight)}get hasShadowHighlights(){return this._materialRenderersHas.highlights||this._renderPlugins.produces(De.OPAQUE_MATERIAL,oe.ShadowHighlight)}get _magnifierEnabled(){return this._bindParameters.decorations===kc.ON&&this._magnifierHelper.enabled}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(Os.HighResolutionAtmosphere)}get hasWater(){return this._materialRenderersHas.water||this._hasOverlayWater}constructor(t,e,i,r,n,s,a,u){super({}),this._stage=t,this._techniqueRepository=r,this._rctx=n,this._compositingHelper=s,this._magnifierHelper=a,this._requestRender=u,this._materialRenderers=new xi,this._needsTransparentPass=!1,this._materialRenderersHas={hudElements:!1,highlights:!1,water:!1,decorations:!1,occludees:!1},this._hasOverlayWater=!1,this.renderOverlay=p=>{},this._isRendering=!1,this._backgroundColor=vi(0,0,0,1),this._sliceHelper=new Fbt,this._state=yr.IDLE,this._highQualityTransparencyEnabled=!0,this._terrainTransparency=dl.Opaque,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new bbt,this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new Y_t,this._releaseGeometryLinearDepth=p=>p?.release(),this._geometryLinearDepthFormat=Vs.DEPTH16_BUFFER,this.fboCache=new uJe(n),this._renderStateFeatures=Rk(!Me("disable-feature:high-quality-idle"),t.view.qualityProfile),this._offscreen=new Cbt(this.fboCache,this._compositingHelper),this.performanceInfo=new v2t(this._rctx),this._shadowMap=new IQ(this.fboCache,t.viewingMode),this._highlight=new aA({view:t.view}),this._shadowHighlight=new kx({view:t.view,viewingMode:t.viewingMode}),this._shadowAccumulator=new zl(this.fboCache,r,t,p=>{const y=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(p.camera,p.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=y},(p,y,b)=>{p.shadowMap.start(p.camera,y,b,!0,this._stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(oe.Shadow,p.shadowMap),p.shadowMap.finish(),p.camera.setGLViewport(this._rctx),this._prepare(p.camera,p.contentCamera)},u),this._ssao=new V5({view:this._stage.view}),this._renderContext=new Hat(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper),this._renderPlugins=new Z$({renderContext:this._renderContext,techniqueRepository:r,textureRepository:i,materialRepository:e,requestRender:u,controller:t,fbos:this.fboCache,isFeatureEnabled:p=>this.isFeatureEnabled(p)}),this.renderPassManager=new fW,this._renderPlugins.add(this.renderPassManager),this._smaa=new vb({view:this._stage.view}),this._renderPlugins.add(this._smaa),this._blit=new Fx({opacity:1,alphaMode:Ia.None}),this._renderPlugins.add(this._blit),this._renderPlugins.add(this._ssao),this._renderPlugins.add(this._highlight),this._renderPlugins.add(this._shadowHighlight),this.addHandles([Fe(()=>this._stage.view.state.camera,()=>u(),Ur),Fe(()=>Xr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,p=>{this._renderHiddenTransparentEdges=p?()=>this._renderEdges(Pi.TRANSPARENT):()=>{},u()},jr),Fe(()=>this._stage.view.environment.background?.color,p=>{const y=p?tO(p):qu;_n(this._backgroundColor,y[0]*y[3],y[1]*y[3],y[2]*y[3],y[3]),u()},Ur)])}normalizeCtorArgs(){return{}}destroy(){this._smaa.destroy(),this._blit.destroy(),this._gpuTimerHandle=nn(this._gpuTimerHandle),this._materialRenderers.forAll(t=>t.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._shadowMap.dispose(),this._ssao.destroy(),this._highlight.dispose(),this._shadowHighlight.destroy(),this._shadowAccumulator.dispose(),this._edgeView=ct(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),W3e.prune()}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=Gi(this._bindParameters.ssr.lastFrameColor),this._bindParameters.multipassTerrain.linearDepth=Gi(this._bindParameters.multipassTerrain.linearDepth),this._bindParameters.multipassGeometry.linearDepth=Gi(this._bindParameters.multipassGeometry.linearDepth)}_disposeOffscreenBuffers(){this._offscreen.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.linearDepth=Gi(this._bindParameters.linearDepth),this._bindParameters.hudVisibility=Gi(this._bindParameters.hudVisibility)}get updating(){return this._smaa.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const t=this._stage.view.resourceController;this._edgeView=new Wd({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:_2t(t)}),this.addHandles(Fe(()=>this._edgeView?.updating,()=>this._requestRender(),$r)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return zD(this._bindParameters.ssr.reprojectionMatrix,Cn)}set _reprojectionMatrix(t){iJ(this._bindParameters.ssr.reprojectionMatrix,t)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(t){const{_shadowMap:e,_bindParameters:i}=this;if(t.qualitySettings?.reflections!==void 0&&this._ssrEnabled!==t.qualitySettings.reflections&&(this._ssrEnabled=t.qualitySettings.reflections,this._requestRender()),t.shadowMap!==void 0&&this._shadowMap.enabled!==t.shadowMap&&(this._shadowMap.enabled=t.shadowMap,this._requestRender()),t.shadowMapMaxCascades!==void 0&&e.maxCascades!==t.shadowMapMaxCascades&&(e.maxCascades=t.shadowMapMaxCascades,this._requestRender()),t.environment!=null){t.environment.weather!=null&&(this._bindParameters.weather=t.environment.weather,this._bindParameters.weatherVisible=!!t.weatherVisible);const r=t.environment.lighting.type!=="virtual";i.enableFillLights!==r&&(i.enableFillLights=r,this._requestRender())}t.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==t.highQualityTransparency&&(this._highQualityTransparencyEnabled=t.highQualityTransparency,this._requestRender()),t.hasOverlayWater!==void 0&&this._hasOverlayWater!==t.hasOverlayWater&&(this._hasOverlayWater=t.hasOverlayWater,this._requestRender()),t.slicePlane!==void 0&&this._sliceHelper.plane!==t.slicePlane&&(this._sliceHelper.plane=t.slicePlane,this._requestRender()),t.terrainTransparency!==void 0&&this._terrainTransparency!==t.terrainTransparency&&(this._terrainTransparency=t.terrainTransparency,this._requestRender()),t.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(t.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(t,e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:r,updates:n}=t;if(i.length===0&&r.length===0&&n.length===0)return;const s=fCe(t);let a=!1;s.forEach((u,p)=>{if(e.done)return;let y=this._materialRenderers.find(b=>b.material===p);if(y==null&&u.adds.length>0){const b=new a4({material:p});b.initializeRenderContext(this._renderPlugins._context),y=b,this._materialRenderers.push(y)}y&&(y.modify(u),y.isEmpty&&(a=!0)),u.removes.forEach(b=>t.removes.removeUnordered(b)),u.adds.forEach(b=>t.adds.removeUnordered(b)),u.updates.forEach(b=>t.updates.removeUnordered(b)),e.madeProgress()}),a&&this._materialRenderers.filterInPlace(u=>!u.isEmpty||(u.dispose(),!1)),this._updateHasFlags(),this._requestRender()}_updateHasFlags(){const t=this._materialRenderersHas;t.decorations=!1,t.highlights=!1,t.hudElements=!1,t.water=!1,t.occludees=!1,this._materialRenderers.forAll(e=>{t.highlights||(t.highlights=e.hasHighlights),t.occludees||(t.occludees=e.hasOccludees),t.water||(t.water=e.hasWater),t.decorations||(t.decorations=e.isDecoration),t.hudElements||(t.hudElements=e.material.produces(De.LINE_CALLOUTS_HUD_DEPTH,oe.Color)||e.material.produces(De.HUD_MATERIAL,oe.Color)||e.material.produces(De.LABEL_MATERIAL,oe.Color))}),this._bindParameters.hasOccludees=t.occludees}updateAnimation(t){const e=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(i=>this._hasAnimations=i.updateAnimation(t)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(t)||this._hasAnimations,this._hasAnimations!==e&&(this._gpuTimerHandle=e?nn(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(t,e,i,r,n){const s=t!=null;this._isRendering=!0,this.performanceInfo.startFrame(),this.fboCache.frame(),this._disposeBindBuffers();const a=this._offscreen,{camera:u,contentCamera:p,mode:y,alignPixelEnabled:b}=i;this._state=y,this._bindParameters.overlay=this.renderOverlay(n),this.performanceInfo.advance(dn.OVERLAY),this._renderContext.time=n,this._bindParameters.transparencyPassType=Ut.NONE,this._bindParameters.alignPixelEnabled=b,this._bindParameters.decorations=r;const S=zg(this._sliceHelper.plane);r===kc.OFF&&(this._sliceHelper.plane=null),u.setGLViewport(this._rctx);const C=a.initializeFrame(u,this._backgroundColor,s);this.hasReflections?this._bindParameters.ssr.lastFrameColor=C:C?.release(),this._prepare(u,p),this._renderPlugins.prepareRender(),this.performanceInfo.advance(dn.PREPARE);const O=this._computeDepthRange(u);this._renderShadowMap(u,this._bindParameters.lighting.mainLight.direction,O),this.performanceInfo.advance(dn.SHADOW_MAP),this._ensureBindParameters(u,p);const P=this._renderPlugins.produces(De.OPAQUE_TERRAIN)&&(this._terrainTransparency===dl.Semitransparent||this._terrainTransparency===dl.TransparentWithDraped),$=this._highQualityTransparency&&P,N=this._needsTransparentPass||this._renderPlugins.produces(De.TRANSPARENT_MATERIAL);this._prepareShaders($,N),this._renderLinearDepth(),this.performanceInfo.advance(dn.LINEAR_DEPTH),this._renderShadowAccumulation(O,u,p),this.performanceInfo.advance(dn.ACCUMULATED_SHADOWS),this._ensureBindParametersSSR(n),this._renderSSAO(),this.performanceInfo.advance(dn.SSAO),this._renderContext.output=oe.Color,a.bindFbo(),this._renderOpaqueGeometry(),this._renderPlugins.render(De.ENVIRONMENT_OPAQUE),this.performanceInfo.advance(dn.OPAQUE),this._renderTerrainLinearDepth($),this._setMultipassTerrain($),this._renderEdges(Pi.OPAQUE),this.performanceInfo.advance(dn.OPAQUE_EDGES),a.bindFbo(),this._renderPlugins.render(De.VOXEL),this.performanceInfo.advance(dn.VOXEL),this._renderHiddenTransparentEdges(),N&&(this._oitEnabled?this._renderOITPass(CT.Geometry):this._renderTransparentMaterial()),this.performanceInfo.advance(dn.TRANSPARENT);const z=this._renderGeometryLinearDepth($);this._renderHUDVisibility(z),$||this._renderInternalSlot(De.LINE_CALLOUTS),this.performanceInfo.advance(dn.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(e),this.performanceInfo.advance(dn.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(Pi.TRANSPARENT,z),this._releaseGeometryLinearDepth(z),this.performanceInfo.advance(dn.TRANSPARENT_EDGES);const U=P?this._renderTransparentTerrain():null;U&&this._bindParameters.hudVisibility&&($?this._renderLineCallouts(xc.Occluded):a.compositeToHUDVisibility(this._bindParameters,U.colorTexture),this._renderHUD(xc.Occluded,a.color),this.performanceInfo.advance(dn.HUD_OCCLUDED)),this.performanceInfo.advance(dn.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),U&&(a.compositeToFramebuffer(this._bindParameters,U.colorTexture,Ia.PremultipliedAlpha,1),U.release(),$&&(this._renderEdges(Pi.OPAQUE),this.performanceInfo.advance(dn.OPAQUE_EDGES),N&&(this._oitEnabled?this._renderOITPass(CT.Geometry):this._renderTransparentMaterial()),this.performanceInfo.advance(dn.TRANSPARENT),this._renderEdges(Pi.TRANSPARENT),this.performanceInfo.advance(dn.TRANSPARENT_EDGES))),this._bindParameters.ssao=Gi(this._bindParameters.ssao),$&&this._renderLineCallouts(xc.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),a.bindFbo(),this._renderInternalSlot(De.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderPlugins.render(De.ENVIRONMENT_TRANSPARENT),this.performanceInfo.advance(dn.ENVIRONMENT),this._renderLaserlines(),this.performanceInfo.advance(dn.LASER_LINES),this._renderOccluded(),this.performanceInfo.advance(dn.OCCLUDED);const j=this._magnifierEnabled&&t==null?this.fboCache.acquire(sr.RGBA,this._offscreen.width,this._offscreen.height):null,G=this._renderComposite(j??t,this._offscreen.color)??t;this.performanceInfo.advance(dn.ANTIALIASING),this._renderHUD(xc.NotOccluded,G),this.performanceInfo.advance(dn.HUD),this._renderHighlights(G,this._bindParameters),this.performanceInfo.advance(dn.HIGHLIGHTS),this._magnifierEnabled&&this._magnifierHelper.render(this._rctx,this._bindParameters),G!==t&&(this._rctx.bindFramebuffer(t?.fbo),this._compositingHelper.composite(this._bindParameters,j?.colorTexture,Ia.None)),j!==t&&j?.release(),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),this._offscreen.releaseBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=S,this._isRendering=!1,this.performanceInfo.finishFrame(),s&&(this._releaseFBOs(),this._disposeOffscreenBuffers())}_prepareShaders(t,e){this._renderContext.output=oe.Color,this._prepareOpaqueGeometrySlots(),this._setMultipassTerrain(t),this._renderPlugins.prepare(De.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),t||this._prepareInternalSlots(this._materialRenderers,De.LINE_CALLOUTS),e&&this._prepareTransparencySlots(),this._prepareInternalSlots(this._materialRenderers,De.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderPlugins.prepare(De.ENVIRONMENT_TRANSPARENT),this._renderPlugins.prepare(De.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(t){if(t==null||!Me("enable-feature:objectAndLayerId-rendering"))return;const e=this._renderContext.output;this._rctx.bindFramebuffer(t.fbo),this._offscreen.renderToFBO(()=>this._renderAllGeometry(oe.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(t.fbo),this._offscreen.renderToFBO(()=>{this._bindParameters.hudRenderStyle=xc.NotOccluded,this._renderInternalSlot(De.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=e}finish(t){this._hasAnimations||this._animationTimestep.clear();const e=this.performanceInfo.gpuSamplingEnabled,i=t===ns.BACKGROUND;if(i||e){const r=i?this.performanceInfo.elapsedTime:0,n=e?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),s=Math.max(r,n);this._animationTimestep.frame(s,i)}}readDepthPixels(t,e,i){const r=this._bindParameters.linearDepth?.fbo;if(r?.colorTexture)return void r.readPixels(e[0],e[1],e[2],e[3],ei.RGBA,Qs.UNSIGNED_BYTE,i);const n=this.fboCache.acquire(sr.RGBA,this._offscreen.width,this._offscreen.height).acquireDepth(Vs.DEPTH16_BUFFER);this._rctx.bindFramebuffer(n.fbo),this._ensureBindParameters(t,t),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=tn.COLOR_BUFFER_BIT|tn.DEPTH_BUFFER_BIT|tn.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderAllGeometry(oe.Depth),n.fbo.readPixels(e[0],e[1],e[2],e[3],ei.RGBA,Qs.UNSIGNED_BYTE,i),n.release()}readHUDVisibility(t,e,i,r,n){this._bindParameters.hudVisibility?.fbo.readPixels(t,e,i,r,ei.RGBA,Qs.UNSIGNED_BYTE,n)}readAccumulatedShadow(t){return this._shadowAccumulator.readAccumulatedShadow(t[0],t[1])}_setMultipassTerrain(t){this._setMultipassEnabled(t),this._setTerrainCulling(t)}_setMultipassEnabled(t){this._bindParameters.multipassEnabled=t}_setTerrainCulling(t){this._bindParameters.multipassTerrain.cullAboveGround=t}_renderEdges(t,e){const i=this._edgeView;if(i?.shouldRender()){const{width:r,height:n,depth:s}=this._offscreen,a=this.fboCache.acquire(sr.RGBA,r,n),u=()=>i.render(this._bindParameters,t);this._offscreen.renderToTargets(u,a,e??s,Jde),this._offscreen.compositeToFramebuffer(this._bindParameters,a.colorTexture,Ia.Alpha,1),a.release()}}_renderShadowMap(t,e,i){const r=this._shadowMap;r.enabled&&(r.start(t,e,i,this.isFeatureEnabled(Os.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(t,e),this._needsShadowHighlight?(this._renderShadowCascades(oe.ShadowHighlight,this._shadowMap),r.moveSnapshot(XS.Highlight),r.clear(),this._renderShadowCascades(oe.ShadowExcludeHighlight,this._shadowMap),r.copySnapshot(XS.Default),this._renderShadowCascades(oe.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(oe.Shadow),r.finish(),t.setGLViewport(this._rctx))}_renderShadowCascades(t,e=this._shadowMap){for(const i of e.cascades)i.camera.setGLViewport(this._rctx),this._prepare(i.camera,i.camera),this._renderAllGeometry(t)}get _needsLinearDepth(){return this._renderPlugins.consumes(oe.Depth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?(this._bindParameters.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.linearDepth,()=>this._renderAllGeometry(oe.Depth),[0,0,0,0],sr.RGBA,Vs.DEPTH_STENCIL_BUFFER),this._bindParameters.linearDepth.releaseDepth(),this._offscreen.bindFbo()):this._bindParameters.linearDepth=Gi(this._bindParameters.linearDepth)}_renderTerrainLinearDepth(t){if(t){const e=this._renderContext.output;this._renderContext.output=oe.Depth,this._bindParameters.multipassTerrain.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassTerrain.linearDepth,()=>this._renderTransparentTerrain(),[-1e10,-1e10,-1e10,1]),this._bindParameters.multipassTerrain.linearDepth.releaseDepth(),this._renderContext.output=e}else this._bindParameters.multipassTerrain.linearDepth=Gi(this._bindParameters.multipassTerrain.linearDepth)}_renderGeometryLinearDepth(t){if(!t)return void(this._bindParameters.multipassGeometry.linearDepth=Gi(this._bindParameters.multipassGeometry.linearDepth));const e=this._renderContext.output;return this._bindParameters.multipassGeometry.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassGeometry.linearDepth,()=>this._renderOpaqueGeometryAndTransparentMaterial(oe.Depth),[1,1,1,1],sr.RGBA,this._geometryLinearDepthFormat),this._renderContext.output=e,this._bindParameters.multipassGeometry.linearDepth.detachDepth()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(t){if(!this._needsDepthRange)return aW;const e=$_t(t,this._materialRenderers,this._stage.layers);return KS(e,this._renderPlugins.queryDepthRange(t)),e.near=Math.max(t.near,e.near),e.far=Math.min(t.far,e.far),e}_renderAllGeometry(t){this._renderContext.output=t,this._renderPlugins.prepare(De.TRANSPARENT_TERRAIN),this._renderOpaqueGeometryAndTransparentMaterial(t),this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(t){this._renderContext.output=t,this._renderPlugins.prepare(De.TRANSPARENT_MATERIAL),this._renderOpaqueGeometry(),this._renderTransparentMaterial()}_renderSSAO(){if(!this._renderPlugins.produces(De.SSAO))return;const t=this._offscreen.renderToCachedFBO(null,()=>this._renderAllGeometry(oe.Normal),[0,0,0,0],sr.RGBA4,Vs.DEPTH24_BUFFER);t.releaseDepth(),this._offscreen.bindFbo(),this._pluginInput.normal=t,this._bindParameters.ssao=this._renderPlugins.render(De.SSAO,this._pluginInput),t.release()}_prepareOpaqueGeometrySlots(){this._renderPlugins.prepare(De.INTEGRATED_MESH),this._renderPlugins.prepare(De.OPAQUE_TERRAIN),this._renderPlugins.prepare(De.OPAQUE_MATERIAL),this._renderPlugins.prepare(De.ENVIRONMENT_OPAQUE),this._prepareInternalSlots(this._materialRenderers,De.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderPlugins.render(De.INTEGRATED_MESH),this._renderPlugins.render(De.OPAQUE_TERRAIN),this._renderInternalSlot(De.OPAQUE_MATERIAL),this._renderPlugins.render(De.OPAQUE_MATERIAL)}_renderTransparentMaterial(){this._renderInternalSlot(De.TRANSPARENT_MATERIAL),this._renderPlugins.render(De.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){if(!this._renderPlugins.produces(De.TRANSPARENT_TERRAIN))return;const t=()=>this._renderPlugins.render(De.TRANSPARENT_TERRAIN,null);if(this._renderContext.output!==oe.Color)return void t();const{width:e,height:i,depth:r}=this._offscreen,n=this.fboCache.acquire(sr.RGBA,e,i);return this._offscreen.renderToTargets(t,n,r,[0,0,0,0]),n}_renderHUDVisibility(t){this._shouldRenderInternalSlot(this._materialRenderers,De.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._renderInternalSlot(De.OCCLUSION_PIXELS),t),this._offscreen.bindFbo()):this._bindParameters.hudVisibility=Gi(this._bindParameters.hudVisibility)}_renderLineCallouts(t){if(this._bindParameters.hudRenderStyle=t,t===xc.Occluded){const e=()=>this._renderInternalSlot(De.LINE_CALLOUTS),{width:i,height:r,color:n}=this._offscreen,s=this.fboCache.acquireDepth(Vs.DEPTH16_BUFFER,i,r);this._offscreen.renderToTargets(e,n,s,void 0,!0,!0),s.release()}else this._renderInternalSlot(De.LINE_CALLOUTS)}_renderLaserlines(){if(this._renderPlugins.render(De.LASERLINES),this._renderPlugins.produces(De.LASERLINES_CONTRAST_CONTROL)){const t=this._offscreen,{width:e,height:i,depth:r}=t,n=this.fboCache.acquire(sr.RGBA,e,i),s=()=>this._renderPlugins.render(De.LASERLINES_CONTRAST_CONTROL);t.renderToTargets(s,n,r,Jde),t.compositeToFramebuffer(this._bindParameters,n.colorTexture,Ia.PremultipliedAlpha,1),n.release()}}_renderHUD(t,e){if(this._materialRenderersHas.hudElements)if(this._oitEnabled){const i=this._renderOITPass(CT.HUD,t);this._rctx.bindFramebuffer(e?.fbo),this._compositingHelper.composite(this._bindParameters,i.colorTexture,Ia.PremultipliedAlpha),i.release()}else if(t===xc.Occluded){const i=()=>this._renderHUDElements(t),{width:r,height:n,color:s}=this._offscreen,a=this.fboCache.acquireDepth(Vs.DEPTH16_BUFFER,r,n);this._offscreen.renderToTargets(i,s,a,void 0,!0,!0),a.release()}else this._rctx.bindFramebuffer(null),e?.acquireDepth(Vs.DEPTH16_BUFFER),this._rctx.bindFramebuffer(e?.fbo),this._renderHUDElements(t),e?.releaseDepth()}_renderHUDElements(t){this._bindParameters.hudRenderStyle=t,this._prepareInternalSlots(this._materialRenderers,De.LINE_CALLOUTS_HUD_DEPTH,De.HUD_MATERIAL,De.LABEL_MATERIAL),this._renderInternalSlot(De.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(De.HUD_MATERIAL),this._renderInternalSlot(De.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._renderPlugins.produces(De.SHADOW_HIGHLIGHT)&&this.hasShadowHighlights}_renderHighlights(t,e){if(!this.hasHighlights||e.decorations===kc.OFF)return;const i=()=>{this._renderAllGeometry(oe.Highlight),this._rctx.clearSafe(tn.DEPTH_BUFFER_BIT),this._renderHUDElements(xc.Both)},r=this._offscreen.renderToCachedFBO(null,i,[0,0,0,0],sr.RGBA4,Vs.DEPTH_STENCIL_BUFFER);r.releaseDepth(),this._needsShadowHighlight&&(this._pluginInput.highlight=r,this._renderPlugins.render(De.SHADOW_HIGHLIGHT,this._pluginInput,t)),this._renderPlugins.produces(De.HIGHLIGHT)&&(this._pluginInput.composite=null,this._pluginInput.normal=null,this._pluginInput.highlight=r,this._renderPlugins.render(De.HIGHLIGHT,this._pluginInput,t)),r.release()}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(t,e,i){this._needsShadowCast&&this._bindParameters.linearDepth?.colorTexture&&this._shadowAccumulator.renderAccumulation(this._bindParameters.linearDepth,t,e,i)}_prepareTransparencySlots(){this._renderContext.output=oe.Alpha,this._bindParameters.transparencyPassType=Ut.Alpha,this._prepareInternalSlots(this._materialRenderers,De.TRANSPARENT_MATERIAL),this._renderPlugins.prepare(De.TRANSPARENT_MATERIAL),this._renderContext.output=oe.Color,this._bindParameters.transparencyPassType=Ut.Color,this._prepareInternalSlots(this._materialRenderers,De.TRANSPARENT_MATERIAL),this._renderPlugins.prepare(De.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=Ut.FrontFace,this._prepareInternalSlots(this._materialRenderers,De.TRANSPARENT_MATERIAL),this._renderPlugins.prepare(De.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=Ut.NONE}_renderOITPass(t,e=xc.Both){const i=t===CT.HUD,r=i?this.fboCache.acquire(sr.RGBA,this._offscreen.width,this._offscreen.height):null,n=i?()=>this._renderHUDElements(e):()=>this._renderTransparentMaterial(),s=this._renderContext.output;this._renderContext.output=oe.Alpha,this._bindParameters.transparencyPassType=Ut.Alpha;const a=this._offscreen.renderOITPass(n,Ut.Alpha,i);this._renderContext.output=oe.Color,this._bindParameters.transparencyPassType=Ut.Color;const u=this._offscreen.renderOITPass(n,Ut.Color,i);this._bindParameters.transparencyPassType=Ut.FrontFace;const p=this._offscreen.renderOITPass(n,Ut.FrontFace,i);return this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,u,a,p,r),r?.releaseDepth(),p.release(),u.release(),a.release(),this._bindParameters.transparencyPassType=Ut.NONE,this._renderContext.output=s,r}_renderOccluded(){let t=0;lu.clear(),this._materialRenderers.forAll(s=>{s.material&&s.material.isVisible()&&s.material.parameters.renderOccluded===vn.OccludeAndTransparentStencil&&(t|=s.material.parameters.renderOccluded,lu.push(s))});const e=this._offscreen,i=(s,a,u,p,y)=>{if(!(t&a))return;const{width:b,height:S,depth:C}=e,O=this.fboCache.acquire(sr.RGBA,b,S);e.renderToTargets(u,O,C,[0,0,0,0],p,y),e.compositeToFramebuffer(this._bindParameters,O.colorTexture,Ia.PremultipliedAlpha,s),O.release()};lu.length!==0&&(this._prepareInternalSlots(lu,De.OCCLUDER_MATERIAL,De.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(De.OCCLUDER_MATERIAL,lu),i(.5,vn.OccludeAndTransparentStencil,()=>this._renderInternalSlot(De.TRANSPARENT_OCCLUDER_MATERIAL,lu),!1,!1)),lu.clear(),this._materialRenderers.forAll(s=>{s.material&&s.material.isVisible()&&(s.material.parameters.renderOccluded===vn.OccludeAndTransparent||s.material.parameters.renderOccluded===vn.Transparent||s.material.parameters.renderOccluded===vn.Opaque)&&(t|=s.material.parameters.renderOccluded,lu.push(s))});const r=this._renderPlugins.renderOccludedFlags;if(t|=r,!t)return;const n=s=>{this._renderContext.renderOccludedMask=s,this._prepareInternalSlots(lu,De.OPAQUE_MATERIAL,De.TRANSPARENT_MATERIAL,De.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),r>vn.Occlude&&this._renderPlugins.render(De.OCCLUDED_TERRAIN),this._renderInternalSlot(De.OPAQUE_MATERIAL,lu),this._renderInternalSlot(De.TRANSPARENT_MATERIAL,lu),this._renderInternalSlot(De.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,lu),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=oe.Color,i(.5,vn.OccludeAndTransparent,()=>n(vn.OccludeAndTransparent),!0,Kl.OutlineVisualElementMask),i(.5,vn.Transparent,()=>n(vn.Transparent),!0,Kl.OutlineVisualElementMask),i(1,vn.Opaque,()=>n(vn.Opaque),!0,Kl.OutlineVisualElementMask),lu.clear()}_renderComposite(t,e){this._renderPlugins.consumes(oe.CompositeColor)&&(this._pluginInput.composite=e);let i=null;const r=this._renderPlugins.produces(De.COMPOSITE);r&&(i=this._renderPlugins.renderComposition(De.COMPOSITE,this._pluginInput),this._pluginInput.composite=i);const n=this._renderPlugins.produces(De.ANTIALIASING),s=this._renderPlugins.render(n?De.ANTIALIASING:De.BLIT,this._pluginInput,t);return r&&i?.release(),s}_prepare(t,e){this._needsTransparentPass=this._materialRenderers.some(i=>i.material.produces(De.TRANSPARENT_MATERIAL,oe.Color)),this._bindParameters.camera=t,this._bindParameters.contentCamera=e}_ensureBindParameters(t,e){this._bindParameters.camera=t,this._bindParameters.contentCamera=e;const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.mainColor=i.colorTexture,this._bindParameters.mainDepth=i.depthTexture}_ensureBindParametersSSR(t){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=t),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Cn:(Ps(Zde,this._bindParameters.camera.viewMatrix),Ps(Yde,this._bindParameters.camera.projectionMatrix),Rr(Y3,Zde,Yde),Rr(Y3,this._renderContext.lastFrameCamera.viewMatrix,Y3),Rr(Y3,this._renderContext.lastFrameCamera.projectionMatrix,Y3),this._reprojectionMatrix=Y3);const e=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=e>0?Math.min(e,t-this._ssrEnableTime)/e:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=Cn,this._ssrEnableTime=null}_shouldRenderInternalSlot(t,e){return this._bindParameters.slot=e,t.some(i=>i.prepareTechnique(this._renderContext)!=null)}_prepareInternalSlots(t,...e){for(const i of e)this._bindParameters.slot=i,t.forAll(r=>r.prepareTechnique(this._renderContext)!=null)}_renderInternalSlot(t,e=this._materialRenderers){this._bindParameters.slot=t,e.forAll(i=>{const r=i.prepareTechnique(this._renderContext);r&&i.renderNode(this._renderContext,r)})}get memoryInfo(){return{fbos:this.fboCache.usedMemory,vaos:this._materialRenderers.reduce((t,e)=>t+e.usedMemory,0),plugins:this._renderPlugins.usedMemory}}getMemoryForMaterial(t){return t==null?0:this._materialRenderers.find(i=>i.material===t)?.usedMemory??0}get usedMemory(){return this.fboCache.usedMemory+(this.edgeView?.usedMemory??0)+this._renderPlugins.usedMemory}get test(){const t=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{t._renderStateFeatures=Rk(),this._renderPlugins.renderFeatureChanged(),this._requestRender()},releaseGeometryLinearDepth(e){t._releaseGeometryLinearDepth=e??(i=>i?.release()),t._geometryLinearDepthFormat=e?Vs.DEPTH_STENCIL_TEXTURE:Vs.DEPTH16_BUFFER},getFramebufferTexture:e=>{switch(e){case AT.Color:return t._offscreen.colorTexture;case AT.LinearDepth:return t._bindParameters.linearDepth?.colorTexture;case AT.ShadowMap:return t._shadowMap.depthTexture;case AT.HudVisibility:return t._bindParameters.hudVisibility?.colorTexture}}}}};var CT,AT;_([T()],fu.prototype,"_renderPlugins",void 0),_([T()],fu.prototype,"_shadowAccumulator",void 0),_([T()],fu.prototype,"_state",void 0),_([T()],fu.prototype,"_renderStateFeatures",void 0),_([T({readOnly:!0})],fu.prototype,"fullResolutionAtmosphere",null),_([T()],fu.prototype,"_smaa",void 0),_([T()],fu.prototype,"_blit",void 0),_([T({autoDestroy:!0})],fu.prototype,"_edgeView",void 0),_([T()],fu.prototype,"updating",null),_([T()],fu.prototype,"isCameraFinal",null),fu=_([Z("esri.views.3d.webgl-engine.lib.Renderer")],fu),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(CT||(CT={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.ShadowMap=2]="ShadowMap",t[t.HudVisibility=3]="HudVisibility"}(AT||(AT={}));const Jde=[0,0,0,0],lu=new xi,Yde=Ze(),Zde=Ze(),Y3=Ze();function _2t(t){return e=>t.immediate.schedule(e)}let b2t=class{constructor(e){this._rctx=e,this._vao=pJe(e)}destroy(){this._vao=jt(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(Hi.TRIANGLES,0,3))}get test(){return{cachedWebGLObjects:AU(this._vao?.glName)+AU(this._vao?.indexBuffer?.glName)+AU(this._vao?.vertexBuffers.geometry)}}};function AU(t){return t!=null?1:0}let xOe=class TOe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=TOe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return xr.createIndex(this._rctx,dr.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,li.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Hi.POINTS,1,Ft.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){return{cachedWebGLObjects:this._indexBuffer?.glName?1:0}}},Kde=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:et.ONE,dstRGB:et.ZERO,srcAlpha:et.ONE,dstAlpha:et.ZERO},this.blendEquation={mode:R0.ADD,modeAlpha:R0.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=_p.BACK,this.frontFace=FS.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Tr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:_p.FRONT_AND_BACK,func:Tr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:_p.FRONT_AND_BACK,fail:Rn.KEEP,zFail:Rn.KEEP,zPass:Rn.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},w2t=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const i=new Map;this._allocations.forEach(r=>{i.set(r,(i.get(r)??0)+1)}),i.forEach((r,n)=>{const s=n.split(`
`);s.shift(),s.shift(),e+=`${r}: ${s.shift()}
`,s.forEach(a=>e+=`   ${a}
`)})}return e}};const x2t={RECORD_ALLOCATIONS:!1};let T2t=class{constructor(){for(this._current=new Array,this._allocations=new w2t(x2t.RECORD_ALLOCATIONS);this._current.length<gs.COUNT;)this._current.push(0)}increment(e,i,r=1){this._current[e]+=r,this._allocations.add(i)}decrement(e,i,r=1){this._current[e]-=r,this._allocations.remove(i)}get current(){return this._current}get total(){return this.current.reduce((e,i,r)=>e+(r<gs.UNCOUNTED?i:0),0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let i=0;i<gs.COUNT;++i){const r=this._current[i];r>0&&(e+=`${gs[i]}: ${r}
`)}}return e+=this._allocations.information,e}},S2t=class{constructor(e,i,r){const n=i.textureFilterAnisotropic,s=r.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=n?Math.min(e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY),s):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),Jp(e)?(this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)):(this.maxUniformBufferBindings=0,this.maxVertexUniformBlocks=0,this.maxFragmentUniformBlocks=0,this.maxUniformBlockSize=0,this.uniformBufferOffsetAlignment=1,this.maxArrayTextureLayers=1,this.maxSamples=1)}};const E2t=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Qde,SOe={exports:{}};(Qde=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(SOe.exports=Qde);const C2t=CE(SOe.exports);var epe,gW={exports:{}};gW.exports,epe=gW,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(epe.exports=e)}();const tpe=CE(gW.exports);var EOe={exports:{}};(function(t){(function(e){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();i!==void 0&&(t.exports=i)})()})(EOe);const A2t=CE(EOe.exports);var Md=999,ipe=9999,OU=0,RU=1,rpe=2,npe=3,spe=4,N9=5,O2t=6,R2t=7,M2t=8,ope=9,P2t=10,ape=11,I2t=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function $2t(){var t,e,i,r=0,n=0,s=Md,a=[],u=[],p=1,y=0,b=0,S=!1,C=!1,O="";return function(ne){return u=[],ne!==null?$(ne.replace?ne.replace(/\r\n/g,`
`):ne):N()};function P(ne){ne.length&&u.push({type:I2t[s],data:ne,position:b,line:p,column:y})}function $(ne){var pe;for(r=0,i=(O+=ne).length;t=O[r],r<i;){switch(pe=r,s){case OU:r=q();break;case RU:r=G();break;case rpe:r=j();break;case npe:r=W();break;case spe:r=ae();break;case ape:r=se();break;case N9:r=le();break;case ipe:r=me();break;case ope:r=U();break;case Md:r=z()}pe!==r&&(O[pe]===`
`?(y=0,++p):++y)}return n+=r,O=O.slice(r),u}function N(ne){return a.length&&P(a.join("")),s=P2t,P("(eof)"),u}function z(){return a=a.length?[]:a,e==="/"&&t==="*"?(b=n+r-1,s=OU,e=t,r+1):e==="/"&&t==="/"?(b=n+r-1,s=RU,e=t,r+1):t==="#"?(s=rpe,b=n+r,r):/\s/.test(t)?(s=ope,b=n+r,r):(S=/\d/.test(t),C=/[^\w_]/.test(t),b=n+r,s=S?spe:C?npe:ipe,r)}function U(){return/[^\s]/g.test(t)?(P(a.join("")),s=Md,r):(a.push(t),e=t,r+1)}function j(){return t!=="\r"&&t!==`
`||e==="\\"?(a.push(t),e=t,r+1):(P(a.join("")),s=Md,r)}function G(){return j()}function q(){return t==="/"&&e==="*"?(a.push(t),P(a.join("")),s=Md,r+1):(a.push(t),e=t,r+1)}function W(){if(e==="."&&/\d/.test(t))return s=N9,r;if(e==="/"&&t==="*")return s=OU,r;if(e==="/"&&t==="/")return s=RU,r;if(t==="."&&a.length){for(;K(a););return s=N9,r}if(t===";"||t===")"||t==="("){if(a.length)for(;K(a););return P(t),s=Md,r+1}var ne=a.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||ne){for(;K(a););return s=Md,r}return a.push(t),e=t,r+1}function K(ne){for(var pe,ge,ve=0;;){if(pe=tpe.indexOf(ne.slice(0,ne.length+ve).join("")),ge=tpe[pe],pe===-1){if(ve--+ne.length>0)continue;ge=ne.slice(0,1).join("")}return P(ge),b+=ge.length,(a=a.slice(ge.length)).length}}function se(){return/[^a-fA-F0-9]/.test(t)?(P(a.join("")),s=Md,r):(a.push(t),e=t,r+1)}function ae(){return t==="."||/[eE]/.test(t)?(a.push(t),s=N9,e=t,r+1):t==="x"&&a.length===1&&a[0]==="0"?(s=ape,a.push(t),e=t,r+1):/[^\d]/.test(t)?(P(a.join("")),s=Md,r):(a.push(t),e=t,r+1)}function le(){return t==="f"&&(a.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(a.push(t),e=t,r+1):/[^\d]/.test(t)?(P(a.join("")),s=Md,r):(a.push(t),e=t,r+1)}function me(){if(/[^\d\w_]/.test(t)){var ne=a.join("");return s=C2t.indexOf(ne)>-1?M2t:A2t.indexOf(ne)>-1?R2t:O2t,P(a.join("")),s=Md,r}return a.push(t),e=t,r+1}}function L2t(t){var e=$2t(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function D2t(t){return L2t(t)}function N2t(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const MU=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function F2t(t,e="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of t)if(n.type==="preprocessor"){const s=r.exec(n.data);if(s){const a=s[1].replaceAll(/\s\s+/g," ");if(a===i)return a;if(a===e)return n.data="#version "+i,e;throw new Error("unknown glsl version: "+a)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function k2t(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function lA(t,e,i,r){r=r||i;for(const n of t)if(n.type==="ident"&&n.data===i)return r in e?e[r]++:e[r]=0,lA(t,e,r+"_"+e[r],r);return i}function COe(t,e,i="afterVersion"){function r(p,y){for(let b=y;b<p.length;b++){const S=p[b];if(S.type==="operator"&&S.data===";")return b}return null}function n(p){let y=-1,b=0,S=-1;for(let C=0;C<p.length;C++){const O=p[C];if(O.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(O.data)?++b:/\#endif\s*.*/.test(O.data)&&--b),i!=="afterVersion"&&i!=="afterPrecision"||O.type==="preprocessor"&&O.data.startsWith("#version")&&(S=Math.max(S,C)),i==="afterPrecision"&&O.type==="keyword"&&O.data==="precision"){const P=r(p,C);if(P===null)throw new Error("precision statement not followed by any semicolons!");S=Math.max(S,P)}y<S&&b===0&&(y=C)}return y+1}const s={data:`
`,type:"whitespace"},a=p=>p<t.length&&/[^\r\n]$/.test(t[p].data);let u=n(t);a(u-1)&&t.splice(u++,0,s);for(const p of e)t.splice(u++,0,p);a(u-1)&&a(u)&&t.splice(u,0,s)}function z2t(t,e,i,r="lowp"){COe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function U2t(t,e,i,r,n="lowp"){COe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function j2t(t,e){let i,r,n=-1;for(let s=e;s<t.length;s++){const a=t[s];if(a.type==="operator"&&(a.data==="["&&(i=s),a.data==="]")){r=s;break}a.type==="integer"&&(n=parseInt(a.data,10))}return i&&r&&t.splice(i,r-i+1),n}function lpe(t,e){if(t.startsWith("#version 300"))return t;const i=D2t(t);if(F2t(i,"100","300 es")==="300 es")return t;let r=null,n=null;const s={},a={};for(let u=0;u<i.length;++u){const p=i[u];switch(p.type){case"keyword":e===Mu.VERTEX_SHADER&&p.data==="attribute"?p.data="in":p.data==="varying"&&(p.data=e===Mu.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(p.data.trim())&&(p.data=p.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===Mu.FRAGMENT_SHADER&&p.data==="gl_FragColor"&&(r||(r=lA(i,s,"fragColor"),z2t(i,r,"vec4")),p.data=r),e===Mu.FRAGMENT_SHADER&&p.data==="gl_FragData"){const y=j2t(i,u+1),b=lA(i,s,"fragData");U2t(i,b,"vec4",y,"mediump"),p.data=b}else e===Mu.FRAGMENT_SHADER&&p.data==="gl_FragDepthEXT"&&(n||(n=lA(i,s,"gl_FragDepth")),p.data=n);break;case"ident":if(E2t.includes(p.data)){if(e===Mu.VERTEX_SHADER&&k2t(i,u))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");p.data in a||(a[p.data]=lA(i,s,p.data)),p.data=a[p.data]}}}for(let u=i.length-1;u>=0;--u){const p=i[u];if(p.type==="preprocessor"){const y=p.data.match(/\#extension\s+(.*)\:/);if(y&&y[1]&&MU.has(y[1].trim())){const C=i[u+1];i.splice(u,C&&C.type==="whitespace"?2:1)}const b=p.data.match(/\#ifdef\s+(.*)/);b&&b[1]&&MU.has(b[1].trim())&&(p.data="#if 1");const S=p.data.match(/\#ifndef\s+(.*)/);S&&S[1]&&MU.has(S[1].trim())&&(p.data="#if 0")}}return B2t(t,N2t(i))}function B2t(t,e){return e}const V2t=4294967295;let G2t=class{constructor(e,i,r,n,s=new Map){this._context=e,this._locations=n,this._uniformBlockBindings=s,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===Ji.WEBGL2&&(i=lpe(i,Mu.VERTEX_SHADER),r=lpe(r,Mu.FRAGMENT_SHADER)),this._vShader=cpe(this._context,Mu.VERTEX_SHADER,i),this._fShader=cpe(this._context,Mu.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(gs.Shader,this),HG()&&(this.vertexShader=i,this.fragmentShader=r);const a=this._context.gl,u=a.createProgram();if(a.attachShader(u,this._vShader),a.attachShader(u,this._fShader),this._locations.forEach((p,y)=>a.bindAttribLocation(u,p,y)),a.linkProgram(u),HG()&&!a.getProgramParameter(u,a.LINK_STATUS)&&console.error(`Could not link shader
validated: ${a.getProgramParameter(u,a.VALIDATE_STATUS)}, gl error ${a.getError()}, vertex: ${a.getShaderParameter(this._vShader,a.COMPILE_STATUS)}, fragment: ${a.getShaderParameter(this._fShader,a.COMPILE_STATUS)}, info log: ${a.getProgramInfoLog(u)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===Ji.WEBGL2){const p=a;for(const[y,b]of this._uniformBlockBindings){const S=p.getUniformBlockIndex(u,y);S<V2t&&p.uniformBlockBinding(u,S,b)}}this._glName=u,this._context.instanceCounter.increment(gs.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,i=this._context.instanceCounter;this._nameToUniformLocation.forEach(r=>r&&i.decrement(gs.Uniform,r)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(i.decrement(gs.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,i.decrement(gs.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,i.decrement(gs.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const i=this._nameToUniformLocation.get(e);if(i!==void 0)return i;if(this.glName){const r=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,r),r&&this._context.instanceCounter.increment(gs.Uniform,r),r}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1iv(e,i){yf(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i){yf(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i){yf(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i){yf(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1fv(e,i){yf(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r){const n=this._nameToUniform2.get(e);n===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===n[0]&&r===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),n[0]=i,n[1]=r)}setUniform2fv(e,i){yf(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,n){const s=this._nameToUniform3.get(e);s===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,n),this._nameToUniform3.set(e,[i,r,n])):i===s[0]&&r===s[1]&&n===s[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,n),s[0]=i,s[1]=r,s[2]=n)}setUniform3fv(e,i){yf(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(this._getUniformLocation(e),i)}setUniform4f(e,i,r,n,s){const a=this._nameToUniform4.get(e);a===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,n,s),this._nameToUniform4.set(e,[i,r,n,s])):a!==void 0&&i===a[0]&&r===a[1]&&n===a[2]&&s===a[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,n,s),a[0]=i,a[1]=r,a[2]=n,a[3]=s)}setUniform4fv(e,i){yf(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(this._getUniformLocation(e),i)}setUniformMatrix3fv(e,i,r=!1){yf(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),r,i)}setUniformMatrix4fv(e,i,r=!1){yf(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),r,i)}stop(){}};function cpe(t,e,i){const r=t.gl,n=r.createShader(e);return r.shaderSource(n,i),r.compileShader(n),HG()&&!r.getShaderParameter(n,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Mu.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(n)),console.error(H2t(i))),n}function H2t(t){let e=2;return t.replaceAll(`
`,()=>`
`+q2t(e++)+":")}function q2t(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function yf(t,e,i){const r=t.get(e);return r?iJ(r,i):(t.set(e,Array.from(i)),!0)}let W2t=class{constructor(e){this._rctx=e,this._store=new RE}dispose(){this._store.forEach(e=>e.forEach(i=>i.dispose())),this._store.clear()}acquire(e,i,r,n){const s=this._store.get(e,i);if(s!=null)return s.ref(),s;const a=new G2t(this._rctx,e,i,r,n);return a.ref(),this._store.set(e,i,a),a}get test(){let e=0;return this._store.forEach(i=>i.forEach(r=>e+=r.hasGLName?2:1)),{cachedWebGLProgramObjects:e}}},DR=class{constructor(){this._result=!1}dispose(){this._program=jt(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},X2t=class extends DR{constructor(e){super(),this._rctx=e,this._helperProgram=null,this._rctx.type===Ji.WEBGL2&&Me("mac")&&Me("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(e){const i=this._rctx,r=i.getBoundFramebufferObject(),{x:n,y:s,width:a,height:u}=i.getViewport();i.resetState();const p=new Ar(1);p.wrapMode=Ai.CLAMP_TO_EDGE,p.samplingMode=Si.NEAREST;const y=new qp(i,p),b=xr.createIndex(this._rctx,dr.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(y),i.setViewport(0,0,1,1),i.useProgram(this._helperProgram),i.bindBuffer(b,li.ELEMENT_ARRAY_BUFFER),i.drawElements(Hi.POINTS,1,Ft.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(Hi.TRIANGLES,0,258);const S=new Uint8Array(4);return y.readPixels(0,0,1,1,ei.RGBA,Qs.UNSIGNED_BYTE,S),i.setViewport(n,s,a,u),i.bindFramebuffer(r),y.dispose(),b.dispose(),S[0]===255}_prepareProgram(){const i=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${F.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${F.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareHelperProgram(){const e=xOe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},J2t=class extends DR{constructor(e){super(),this._rctx=e,this._program=upe(this._rctx,!1),this._obfuscated=upe(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=jt(this._obfuscated)}_test(e){if(Me("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const i=this._runProgram(e),r=this._runProgram(this._obfuscated);return i!==0&&(r===0||i/r>5)}_runProgram(e){const i=this._rctx;i.resetState();const r=new Ar(1);r.wrapMode=Ai.CLAMP_TO_EDGE,r.samplingMode=Si.NEAREST;const n=new qp(i,r),s=xr.createVertex(i,dr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new cd(i,new Map([["position",0]]),{geometry:[new Yo("position",2,Ft.UNSIGNED_SHORT,0,4)]},{geometry:s}),u=st(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),p=st(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),y=new Float32Array(6);QG(u,y,3);const b=new Float32Array(6);QG(p,b,3),i.useProgram(e),e.setUniform3f("u_highA",y[0],y[2],y[4]),e.setUniform3f("u_lowA",y[1],y[3],y[5]),e.setUniform3f("u_highB",b[0],b[2],b[4]),e.setUniform3f("u_lowB",b[1],b[3],b[5]),i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.bindVAO(a),i.drawArrays(Hi.TRIANGLE_STRIP,0,4);const S=new Uint8Array(4);n.readPixels(0,0,1,1,ei.RGBA,Qs.UNSIGNED_BYTE,S),a.dispose(),n.dispose();const C=(u[2]-p[2])/25,O=CQ(S);return Math.abs(C-O)}};function upe(t,e){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,r=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(i,r,new Map([["position",0]]))}let Y2t=class extends DR{constructor(e){if(super(),this._rctx=e,!e.gl)return;if(e.type===Ji.WEBGL1)return void(this._result=!(!e.capabilities.textureFloat?.textureFloat||!e.capabilities.colorBufferFloat?.textureFloat));if(!(e.capabilities.textureFloat?.textureFloat&&e.capabilities.colorBufferFloat?.textureFloat&&e.capabilities.colorBufferFloat?.floatBlend))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new Ar(1);r.wrapMode=Ai.CLAMP_TO_EDGE,r.dataType=Qs.FLOAT,r.internalFormat=Mt.RGBA32F,r.samplingMode=Si.NEAREST;const n=new qp(i,r),s=xr.createVertex(i,dr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new cd(i,new Map([["a_pos",0]]),{geometry:[new Yo("a_pos",2,Ft.UNSIGNED_SHORT,0,4)]},{geometry:s});i.useProgram(e);const u=i.getBoundFramebufferObject(),{x:p,y,width:b,height:S}=i.getViewport();i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.bindVAO(a),i.drawArrays(Hi.TRIANGLE_STRIP,0,4);const C=mi({blending:zTe});i.setPipelineState(C),i.drawArrays(Hi.TRIANGLE_STRIP,0,4);const O=i.gl.getError();return i.setViewport(p,y,b,S),i.bindFramebuffer(u),a.dispose(),n.dispose(),O!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},Z2t=class extends DR{constructor(e){super(),this._rctx=e;const i=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,r=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new Ar(1);r.wrapMode=Ai.CLAMP_TO_EDGE,r.samplingMode=Si.NEAREST;const n=new qp(i,r),s=new Uint8Array(4),a=xr.createVertex(i,dr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),u=new cd(i,new Map([["a_position",0]]),{geometry:[new Yo("a_position",2,Ft.SHORT,0,4)]},{geometry:a});i.useProgram(e);const p=new yi(i,r,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),i.bindTexture(p,0);const y=i.getBoundFramebufferObject();i.bindFramebuffer(n),i.useProgram(e);const{x:b,y:S,width:C,height:O}=i.getViewport();i.setViewport(0,0,1,1),i.bindVAO(u),i.drawArrays(Hi.TRIANGLE_STRIP,0,4),i.setViewport(b,S,C,O),n.readPixels(0,0,1,1,ei.RGBA,Qs.UNSIGNED_BYTE,s),u.dispose(),n.dispose();const P=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return P&&Ee.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),i.bindFramebuffer(y),P}};new Yo("a_pos",2,Ft.BYTE,0,2);new Yo("a_pos",2,Ft.BYTE,0,4),new Yo("a_tex",2,Ft.BYTE,2,4);const K2t={geometry:[new Yo("a_pos",2,Ft.UNSIGNED_SHORT,0,4)]};let Q2t=class extends DR{constructor(e){super(),this._rctx=e;const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new Ar(1);r.wrapMode=Ai.CLAMP_TO_EDGE,r.samplingMode=Si.NEAREST;const n=new qp(i,r),s=xr.createVertex(i,dr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new cd(i,new Map([["a_pos",0]]),K2t,{geometry:s}),u=new Ar;u.samplingMode=Si.LINEAR,u.wrapMode=Ai.CLAMP_TO_EDGE;const p=new yi(i,u,cA);i.useProgram(e),i.bindTexture(p,0),e.setUniform1i("u_texture",0);const y=i.getBoundFramebufferObject(),{x:b,y:S,width:C,height:O}=i.getViewport();i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clearSafe(tn.COLOR_BUFFER_BIT),i.bindVAO(a),i.drawArrays(Hi.TRIANGLE_STRIP,0,4);const P=new Uint8Array(4);return n.readPixels(0,0,1,1,ei.RGBA,Qs.UNSIGNED_BYTE,P),a.dispose(),n.dispose(),p.dispose(),i.setViewport(b,S,C,O),i.bindFramebuffer(y),P[0]!==255}};const cA=new Image;cA.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",cA.width=5,cA.height=5,cA.decode();let ewt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new Y2t(e),this.svgPremultipliesAlpha=new Q2t(e),this.doublePrecisionRequiresObfuscation=new J2t(e),this.ignoresSamplerPrecision=new Z2t(e),this.drawArraysRequiresIndicesTypeReset=new X2t(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function twt(t,e){if(e.disjointTimerQuery)return null;if(Jp(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const i=t.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function iwt(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function rwt(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function nwt(t,e){if(Jp(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const i=t.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function swt(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function owt(t,e){if(Jp(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const i=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function awt(t,e){if(Jp(t)){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),r=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function hpe(t,e,i,r,n){if(r&&Jp(t))return!0;if(e[i])return!1;for(const s of n)if(t.getExtension(s))return!0;return!1}function lwt(t,e){if(!Jp(t)||e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function cwt(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function uwt(t,e){if(Jp(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const i=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}let hwt=class{constructor(e,i){this._gl=e,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=twt(this._gl,this._disabledExtensions)),this._drawBuffers}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=uwt(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=iwt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=rwt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=swt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=m2t(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=owt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=awt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=nwt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=hpe(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=cwt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=lwt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=hpe(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},dwt=class{constructor(e,i){this.gl=e,this.instanceCounter=new T2t,this.programCache=new W2t(this),this._state=new Kde,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=Jp(e)?Ji.WEBGL2:Ji.WEBGL1,this._loadExtensions(),this.configure(i)}get gl2(){return this.type===Ji.WEBGL1?null:this.gl}configure(e){this._capabilities=new hwt(this.gl,e),this._parameters=new S2t(this.gl,this._capabilities,e),yi.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Kde,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new HXe({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const n=r.color;this.setBlendColor(n.r,n.g,n.b,n.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const n=r.function;this.setStencilFunction(n.func,n.ref,n.mask);const s=r.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)},setDrawBuffers:r=>{const{drawBuffers:n}=this._capabilities;if(r)n?.drawBuffers(r.buffers);else{const{drawFramebuffer:s}=this._state;s===null||s.colorAttachments.length===0?n?.drawBuffers([VG.BACK]):n?.drawBuffers([Gl.COLOR_ATTACHMENT0])}}}),this.enforceState(),jt(this._driverTest),this._driverTest=new ewt(this)}dispose(){jt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(li.ARRAY_BUFFER),this.unbindBuffer(li.ELEMENT_ARRAY_BUFFER),this.type===Ji.WEBGL2&&(this.unbindBuffer(li.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(li.PIXEL_PACK_BUFFER),this.unbindBuffer(li.PIXEL_UNPACK_BUFFER),this.unbindBuffer(li.COPY_READ_BUFFER),this.unbindBuffer(li.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,np()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,n){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&n===this._state.blendColor.a||(this.gl.blendColor(e,i,r,n),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=n,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,n){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===n||(this.gl.blendFuncSeparate(e,i,r,n),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=n,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,n){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===n||(this.gl.colorMask(e,i,r,n),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=n,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,n){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===n||(this.gl.clearColor(e,i,r,n),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=n)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,n){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===n||(this.gl.scissor(e,i,r,n),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=n)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=_p.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,n){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===n||(this.gl.stencilFuncSeparate(e,i,r,n),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===_p.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=_p.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,n){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===n||(this.gl.stencilOpSeparate(e,i,r,n),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(XF+e),this._state.activeTexture=e),r}clear(e){e&&this.gl.clear(e)}clearSafe(e,i=255){e&&(e&tn.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&tn.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&tn.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(e))}drawArrays(e,i,r){np()&&(this._numOfDrawCalls++,this._numOfTriangles+=dpe(e,r)),this.gl.drawArrays(e,i,r),r0(this.gl)}drawArraysInstanced(e,i,r,n){this.gl2?.drawArraysInstanced(e,i,r,n),r0(this.gl)}drawElements(e,i,r,n){if(np()&&(this._numOfDrawCalls++,this._numOfTriangles+=dpe(e,i)),this.gl.drawElements(e,i,r,n),np()){const s=ZXe(this);if(s){const a=this.getBoundVAO(),u=a?.indexBuffer,p=a?.vertexBuffers,y={indexBuffer:u,vertexBuffers:p},b={mode:e,count:i,type:r,offset:n},S=u?.size??0,C=n+i,O=S<C?`. Buffer is too small. Attempted to draw index ${C} of ${S}`:"";console.error(`drawElements: ${s}${O}`,{args:b,vao:y})}}}logInfo(){np()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){np()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,n){r=Math.max(Math.round(r),1),n=Math.max(Math.round(n),1);const s=this._state.viewport;s.x===e&&s.y===i&&s.width===r&&s.height===n||(s.x=e,s.y=i,s.width=r,s.height=n,this.gl.viewport(e,i,r,n))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){this._state.program!==e&&(this._state.program?.stop(),this._state.program=e,this.gl.useProgram(e?.glName??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const n=this._state.textureUnitMap[i];return e?.glName==null?(n!=null&&(this.setActiveTexture(i,r),this.gl.bindTexture(n.descriptor.target,null)),this._state.textureUnitMap[i]=null,n):r||n!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,n):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),n)}unbindTexture(e){if(e!=null)for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),e==null)return this.gl.bindFramebuffer(la.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(la.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const n=i===la.READ_FRAMEBUFFER,s=n?this._state.readFramebuffer:this._state.drawFramebuffer;(r||s!==e)&&(e==null?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),n?this._state.readFramebuffer=e??null:this._state.drawFramebuffer=e??null)}blitFramebuffer(e,i,r=0,n=0,s=e.width,a=e.height,u=0,p=0,y=i.width,b=i.height,S=tn.COLOR_BUFFER_BIT,C=Si.NEAREST){this.bindFramebufferSeparate(e,la.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,la.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,n,s,a,u,p,y,b,S,C)}bindBuffer(e,i){if(e)switch(i??(i=e.bufferType),i){case li.ARRAY_BUFFER:this._state.vertexBuffer=hc(this.gl,e,i,this._state.vertexBuffer);break;case li.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=hc(this.gl,e,i,this._state.indexBuffer);break;case li.UNIFORM_BUFFER:this._state.uniformBuffer=hc(this.gl,e,i,this._state.uniformBuffer);break;case li.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=hc(this.gl,e,i,this._state.pixelPackBuffer);break;case li.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=hc(this.gl,e,i,this._state.pixelUnpackBuffer);break;case li.COPY_READ_BUFFER:this._state.copyReadBuffer=hc(this.gl,e,i,this._state.copyReadBuffer);break;case li.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=hc(this.gl,e,i,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let n=r[i];return n==null&&(n={buffer:null,offset:0,size:0},r[i]=n),n}bindBufferBase(e,i,r){const n=this._getBufferBinding(e,i);n!=null&&(n.buffer===r&&n.offset===0&&n.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),n.buffer=r,n.offset=0,n.size=0))}bindBufferRange(e,i,r,n,s){const a=this._getBufferBinding(e,i);if(a!=null&&!(a.buffer===r&&a.offset===n&&a.size===s)){if(n%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,i,r.glName,n,s),a.buffer=r,a.offset=n,a.size=s}}bindUBO(e,i,r,n){i!=null?(np()&&(n??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&n!==void 0?this.bindBufferRange(li.UNIFORM_BUFFER,e,i.buffer,r,n):this.bindBufferBase(li.UNIFORM_BUFFER,e,i.buffer)):this.bindBufferBase(li.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const n=this._state.uniformBufferBindingPoints[i];n!=null&&n.buffer===e.buffer&&this.bindBufferBase(li.UNIFORM_BUFFER,i,null)}}unbindBuffer(e){switch(e){case li.ARRAY_BUFFER:this._state.vertexBuffer=hc(this.gl,null,e,this._state.vertexBuffer);break;case li.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=hc(this.gl,null,e,this._state.indexBuffer);break;case li.UNIFORM_BUFFER:this._state.uniformBuffer=hc(this.gl,null,e,this._state.uniformBuffer);break;case li.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=hc(this.gl,null,e,this._state.pixelPackBuffer);break;case li.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=hc(this.gl,null,e,this._state.pixelUnpackBuffer);break;case li.COPY_READ_BUFFER:this._state.copyReadBuffer=hc(this.gl,null,e,this._state.copyReadBuffer);break;case li.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=hc(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}async clientWaitAsync(e=10){const i=this.gl,r=i.fenceSync(GG.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let n;this.instanceCounter.increment(gs.Sync,r),i.flush();do await R4(e),n=i.clientWaitSync(r,0,0);while(n===UL.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(gs.Sync,r),i.deleteSync(r),n===UL.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=la.FRAMEBUFFER){return e===la.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(li.ARRAY_BUFFER),this.unbindBuffer(li.ELEMENT_ARRAY_BUFFER),this.type===Ji.WEBGL2&&(this.unbindBuffer(li.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(li.PIXEL_PACK_BUFFER),this.unbindBuffer(li.PIXEL_UNPACK_BUFFER),this.unbindBuffer(li.COPY_READ_BUFFER),this.unbindBuffer(li.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(et.ONE,et.ZERO),this.setBlendEquation(R0.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(_p.BACK),this.setFrontFace(FS.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Tr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Tr.ALWAYS,0,0),this.setStencilOp(Rn.KEEP,Rn.KEEP,Rn.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:i,gl2:r}=this;for(let s=0;s<this.parameters.maxVertexAttributes;s++)i.disableVertexAttribArray(s);if(this._state.vertexBuffer?i.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):i.bindBuffer(li.ARRAY_BUFFER,null),this._state.indexBuffer?i.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):i.bindBuffer(li.ELEMENT_ARRAY_BUFFER,null),r!=null){this._state.uniformBuffer?r.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):r.bindBuffer(li.UNIFORM_BUFFER,null);for(let s=0;s<this._parameters.maxUniformBufferBindings;s++){const a=this._state.uniformBufferBindingPoints[s];if(a!=null){const{buffer:u,offset:p,size:y}=a;u!==null?p===0&&y===0?r.bindBufferBase(li.UNIFORM_BUFFER,s,u.glName):r.bindBufferRange(li.UNIFORM_BUFFER,s,u.glName,p,y):r.bindBufferBase(li.UNIFORM_BUFFER,s,null)}}this._state.pixelPackBuffer?r.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):r.bindBuffer(li.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?r.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):r.bindBuffer(li.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?r.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):r.bindBuffer(li.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?r.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):r.bindBuffer(li.COPY_WRITE_BUFFER,null),r.bindFramebuffer(la.READ_FRAMEBUFFER,null),r.readBuffer(r.BACK),this._state.readFramebuffer&&(r.bindFramebuffer(la.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),r.readBuffer(Gl.COLOR_ATTACHMENT0)),r.bindFramebuffer(la.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,i.bindFramebuffer(la.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(e&&this._state.vertexArrayObject){const s=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(s)}i.useProgram(this._state.program?.glName??null),i.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),i.bindRenderbuffer(i.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?i.enable(this.gl.BLEND):i.disable(this.gl.BLEND),i.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),i.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),i.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),i.clearDepth(this._state.clearDepth),i.clearStencil(this._state.clearStencil),i.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),i.cullFace(this._state.cullFace),i.depthFunc(this._state.depthFunction),i.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),i.depthMask(this._state.depthWrite),i.frontFace(this._state.frontFace),i.lineWidth(1),this._state.faceCulling===!0?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),i.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?i.enable(i.POLYGON_OFFSET_FILL):i.disable(i.POLYGON_OFFSET_FILL),i.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?i.enable(i.SCISSOR_TEST):i.disable(i.SCISSOR_TEST),i.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),i.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),i.stencilMask(this._state.stencilWriteMask);for(let s=0;s<this.parameters.maxTextureImageUnits;s++){i.activeTexture(XF+s),i.bindTexture(Vn.TEXTURE_2D,null),i.bindTexture(Vn.TEXTURE_CUBE_MAP,null),this.type===Ji.WEBGL2&&(i.bindTexture(Vn.TEXTURE_3D,null),i.bindTexture(Vn.TEXTURE_2D_ARRAY,null));const a=this._state.textureUnitMap[s];a!=null&&i.bindTexture(a.descriptor.target,a.glName)}i.activeTexture(XF+this._state.activeTexture);const n=this._state.viewport;i.viewport(n.x,n.y,n.width,n.height),this.resetInfo()}_loadExtensions(){this.type===Ji.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}};function hc(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function dpe(t,e){switch(t){case Hi.POINTS:return 2*e;case Hi.TRIANGLES:return e/3;case Hi.TRIANGLE_STRIP:case Hi.TRIANGLE_FAN:return e-2;default:return 0}}let pwt=class extends dwt{constructor(e,i,r){super(e,i),this.gl=e,this.newCache=r,this._appleAmdDriverHelper=null,this._refCount=1,this.screen=new b2t(this)}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){super.dispose(),this._appleAmdDriverHelper?.dispose(),this.screen.destroy()}bindTechnique(e,i,r,n){return this.useProgram(e.program),this.setPipelineState(e.getPipeline(!!n)),e.program.bindPass(i,r),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new xOe(this)),this._appleAmdDriverHelper.run())}get test(){return{cachedWebGLObjects:this.programCache.test.cachedWebGLProgramObjects+this.screen.test.cachedWebGLObjects+(this._appleAmdDriverHelper?.test.cachedWebGLObjects??0)}}};function ppe(t){return!!t.frameUpdate}let zx=class extends Ke{constructor(e,i,r){super({}),this._stage=e,this._techniqueRepository=i,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Xn,this._frameTask=e.view.resourceController.scheduler.registerTask(Zt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Gn.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(DQ,new NQ)),this._textureTechnique}acquire(e){const i=this._textures.get(e);return i?(i.ref(),i.loadingPromise??i):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(i=>{const r=i.texture.frameUpdate(i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e&&this.events.emit("changed",ns.BACKGROUND)}_createNewRef(e){const i=this._stage.getObject(e);if(i==null)return zt(i!==void 0),null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),n=new fwt(e,()=>{this._frameTask.schedule(()=>{n.isUnreferenced&&i.unload()})});return this._textures.set(e,n),n.ref(),i.glTexture?(this._updateGLTexture(n,i.glTexture),ppe(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),n):(this._loadingCount++,n.loadingPromise=this._stage.schedule(()=>{const s=i.load(this._rctx),a=p=>(this._loadingCount--,n.loadingPromise=null,this._updateGLTexture(n,p),ppe(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),n),u=p=>(this._loadingCount--,n.loadingPromise=null,qn(p)||Ee.getLogger(this).error(p),null);return Yc(s)?s.then(a,u):a(s)}),n.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",ns.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};_([T()],zx.prototype,"_loadingCount",void 0),_([T()],zx.prototype,"_frameTask",void 0),_([T()],zx.prototype,"updating",null),zx=_([Z("esri.views.3d.webgl-engine.lib.TextureRepository")],zx);let fwt=class{constructor(e,i){this.id=e,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(Ee.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function mwt(t,e){return new HEe(i=>$at(i,t),i=>i,e)}let uA=class extends Ke{constructor(){super(...arguments),this._passParameters=new gwt,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=Vc(this._resourcesTask),this._passParameters.waveNormal=jt(this._passParameters.waveNormal),this._passParameters.wavePerturbation=jt(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=Pv(async i=>{await Promise.allSettled([this._loadImageResource(e,Kr("esri/images/materials/water/normals.jpg"),r=>this._passParameters.waveNormal=r,i),this._loadImageResource(e,Kr("esri/images/materials/water/perturbation.jpg"),r=>this._passParameters.wavePerturbation=r,i)])})),this._resourcesTask.finished?yv.LOADED:yv.LOADING}async _loadImageResource(e,i,r,n){try{const s=await Lg(i,{signal:n});oi(n);const a=new Ar(s.width,s.height);a.pixelFormat=ei.RGB,a.samplingMode=Si.LINEAR_MIPMAP_LINEAR,a.hasMipmap=!0,a.maxAnisotropy=8,r(new yi(e,a,s))}catch(s){Ee.getLogger(this).error("Failed to load water material normal texture.",s)}}};_([T()],uA.prototype,"_resourcesTask",void 0),_([T({type:Boolean,readOnly:!0})],uA.prototype,"updating",null),uA=_([Z("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],uA);let gwt=class extends Vr{};const fpe=2048,ywt=1.5,vwt=8;function _wt(t,e){const{format:i,quality:r,rotation:n,disableDecorations:s}=t||{},a=Dee(t,e.padding),u=Cwt(t,{width:e.width-a.left-a.right,height:e.height-a.top-a.bottom}),{width:p,height:y}=Ewt(t,u),b=Rwt(i),S=Lwt[b];return{format:b,quality:Je(r??S,0,100),area:u,width:p,height:y,rotation:n,disableDecorations:!!s,ignoreBackground:!!t?.ignoreBackground,ignorePadding:!!t?.ignorePadding}}function bwt(t,e){const i=_wt(t,e),r=i.area,n=i.width/r.width,s=Dee(i,e.padding),a=s.left+s.right,u=s.top+s.bottom,p=e.width-a,y=e.height-u,b=Math.floor(p*n+a),S=Math.floor(y*n+u),C=t?.layers??[],O=i.ignoreBackground,P=i.ignorePadding;return{framebufferWidth:b,framebufferHeight:S,region:{x:Math.floor(r.x*n)+s.left,y:Math.floor(r.y*n)+s.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:n,layers:C,disableDecorations:i.disableDecorations,ignoreBackground:O,ignorePadding:P,objectAndLayerIdColor:!1}}function PU(t,e,i){const{ctx:r,canvas:n}=AOe(t,i),s=r.getImageData(0,0,t.width,t.height),a=xwt(n,e);return OOe(n),{dataUrl:a,data:s}}function IU(t,e){const{ctx:i,canvas:r}=AOe(t,e),n=i.getImageData(0,0,t.width,t.height);return OOe(r),n}function AOe(t,e){const i=wwt();e.premultipliedAlpha&&Pwt(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&Mwt(r),{ctx:r,canvas:i}}function OOe(t){t.width=0,t.height=0}function wwt(){return $U==null&&($U=document.createElement("canvas")),$U}let $U=null;function xwt(t,e){const i=Iwt[e.format],r=e.quality/100;return t.toDataURL(i,r)}function Twt(t,e,i,r=0,n=0,s=t.width-r,a=t.height-n,u=!1){const{data:p}=t,{width:y,height:b,data:S}=e,C=s/y,O=a/b,P=Math.ceil(C/2),$=Math.ceil(O/2),N=t.width;for(let z=0;z<b;z++)for(let U=0;U<y;U++){const j=4*(U+(u?b-z-1:z)*y);let G=0,q=0,W=0,K=0,se=0,ae=0;const le=(z+.5)*O;for(let me=Math.floor(z*O);me<(z+1)*O;me++){const ne=Math.abs(le-(me+.5))/$,pe=(U+.5)*C,ge=ne*ne;for(let ve=Math.floor(U*C);ve<(U+1)*C;ve++){const Se=Math.abs(pe-(ve+.5))/P,ee=Math.sqrt(ge+Se*Se);if(ee>=1)continue;let re=2*ee*ee*ee-3*ee*ee+1;const fe=4*(r+ve+(n+me)*N);ae+=re*p[fe+3],q+=re,!i&&p[fe+3]<255&&(re=re*p[fe+3]/255),W+=re*p[fe],K+=re*p[fe+1],se+=re*p[fe+2],G+=re}}S[j]=W/G,S[j+1]=K/G,S[j+2]=se/G,S[j+3]=ae/q}return e}function Swt(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:n,pixelRatio:s,region:a}=t,u=Dee(t,i),p=u.left+u.right,y=u.top+u.bottom,b=r-p,S=n-y,C=Math.min(vwt,Math.min((fpe-p)/b,(fpe-y)/S));return C<ywt?t:{...t,framebufferWidth:Math.round(b*C)+p,framebufferHeight:Math.round(S*C)+y,pixelRatio:s*C,resample:{region:{x:Math.round((a.x-u.left)*C)+u.left,y:Math.round((a.y-u.top)*C)+u.top,width:Math.round(a.width*C),height:Math.round(a.height*C)},width:r,height:n}}}function Ewt(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const n=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/n)}:{width:Math.floor(r*n),height:Math.floor(r)}}function Cwt(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t?.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,n=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&n!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,n);else if(r==null&&n!=null){const s=Math.min(i.width,r);i.height=s/i.width*i.height,i.width=s}else if(r!=null&&n==null){const s=Math.min(i.height,n);i.width=s/i.height*i.width,i.height=s}}return Awt(Owt(i,t),e)}function Awt(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),n={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},s=n.width/n.height,a=t.width/t.height;if(a===s)return n;if(a>s){const y=Math.floor(n.width/a),b=n.height-y;return{x:n.x,y:Math.floor(n.y+b/2),width:n.width,height:y}}const u=Math.floor(n.height*a),p=n.width-u;return{x:Math.floor(n.x+p/2),y:n.y,width:u,height:n.height}}function Owt(t,e){if(e?.width==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const s=Math.floor(t.height*i);return t.x-=(s-t.width)/2,t.width=s,t}const n=Math.floor(t.width/i);return t.y-=(n-t.height)/2,t.height=n,t}function Dee(t,e){return!e||t&&t.ignorePadding?Dwt:e}function Rwt(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return $wt}}function Mwt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function Pwt(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const n=e[r+3];if(n!==255&&n>0){const s=255/n;e[r]=e[r]*s,e[r+1]=e[r+1]*s,e[r+2]=e[r+2]*s}}}const Iwt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},mpe=98,$wt="png",Lwt={png:100,jpg:mpe,jpeg:mpe},Dwt={top:0,right:0,bottom:0,left:0};let Nwt=class{constructor(e,i,r){this.parameters=e,this.frameHasDecorations=i,this.fbos=r}},Fwt=class{constructor(e,i,r){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(ns.BACKGROUND);const i=Ys();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const n={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},s=this._renderScreenshot(e,n,i);r.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const n=e.getContext("2d"),s=r.pixelRatio;return n.save(),n.translate(0,i.height),n.scale(1,-1),r.region&&n.translate(-r.region.x,-r.region.y),n.scale(s,s),i=this._renderFunctions.renderOverlay(e,r.disableDecorations?kc.OFF:kc.ON,i),n.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:n,region:s,resample:a}=e,u=this._ensureScreenshotEncodeCanvas();let p=Sz(r,n,u);this._rctx.gl.readPixels(0,0,r,n,ei.RGBA,Ft.UNSIGNED_BYTE,new Uint8Array(p.data.buffer)),i(),p=this._renderScreenshotOverlay(u,p,{...e,region:void 0});const y=Sz(s.width,s.height,u);return Twt(p,y,!0,a.region.x,n-(a.region.y+a.region.height),a.region.width,a.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:n}=e,s=this._ensureScreenshotEncodeCanvas(),a=Sz(n.width,n.height,s);return this._rctx.gl.readPixels(n.x,r-(n.y+n.height),n.width,n.height,ei.RGBA,Ft.UNSIGNED_BYTE,new Uint8Array(a.data.buffer)),i(),this._renderScreenshotOverlay(s,a,e)}_renderScreenshot(e,i,r){const n=e.parameters.camera,s={width:i.framebufferWidth,height:i.framebufferHeight};o2(s,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let a=!1;const u=i.disableDecorations&&e.frameHasDecorations,p=s.width!==n.fullWidth||s.height!==n.fullHeight,y=i.ignorePadding&&n.pixelRatio!==i.pixelRatio,b=p||u||y||i.objectAndLayerIdColor;let S=null;i.objectAndLayerIdColor&&(S=e.fbos.acquire(sr.RGBA,s.width,s.height),S.acquireDepth(Vs.DEPTH_STENCIL_BUFFER));let C=null;if(b){const N=n.clone();if(i.ignorePadding){const q=aR(N.padding);for(let W=0;W<4;W++)q[W]=Math.round(q[W]/N.pixelRatio*i.pixelRatio);N.padding=q}N.fullWidth=s.width,N.fullHeight=s.height,N.pixelRatio=i.pixelRatio;const z=n.fovX-N.fovX,U=n.fovY-N.fovY;z<0&&z<U?N.fovX=n.fovX:U<0&&U<z&&(N.fovY=n.fovY);const j={camera:N,contentCamera:N,mode:yr.IDLE,alignPixelEnabled:!0,contentPixelRatio:N.pixelRatio};this._forceCameraHook(j),a=!0,C=e.fbos.acquire(sr.RGBA,s.width,s.height);const G=i.disableDecorations?kc.OFF:kc.ON;this._renderFunctions.renderScene(C,S,j,G,r)}const O=()=>{this._rctx.bindFramebuffer(null),C?.release()};this._rctx.bindFramebuffer(C?.fbo);const P=this._readbackScreenshot(i,O);let $=null;if(i.objectAndLayerIdColor){const N=()=>{this._rctx.bindFramebuffer(null),S?.release()};this._rctx.bindFramebuffer(S?.fbo),$=this._readbackScreenshot(i,N),this._rctx.bindFramebuffer(null)}if(b&&!this._rctx.contextAttributes.alpha)for(let N=3;N<P.data.length;N+=4)P.data[N]=255;if($&&!this._rctx.contextAttributes.alpha)for(let N=3;N<$.data.length;N+=4)$.data[N]=255;return a&&this._forceCameraHook(e.parameters),[P,$]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},zo=class extends Ke{constructor(e){super({}),this.events=new Xn,this.waterTextureRepository=new uA,this._magnifierHelper=new Nx,this.objectAndLayerIdRenderHelper=Me("enable-feature:objectAndLayerId-rendering")?new J_t:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),this.addHandles([Fe(()=>this.waterTextureRepository?.updating,()=>this.requestRender(),jr),Fe(()=>e.view.qualityProfile,n=>this.renderer?.updateRenderFeatures(n),Ur),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:i}=e.view.resourceController;this.stippleTextureRepository=Bot(this._rctx,i),this.markerTextureRepository=mwt(this._rctx,i),this._shaderTechniqueRepository=new zEe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository}),this._textureRepository=new zx(e,this._shaderTechniqueRepository,this._rctx),this.addHandles(this._textureRepository.events.on("changed",n=>this.requestRender(n))),this._materialRepository=new UEe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new A_t(this._rctx,this._shaderTechniqueRepository),this.renderer=new fu(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,n=>this.requestRender(n));const r={renderScene:(n,s,a,u,p)=>this.renderer.render(n,s,a,u,p),requestRenderScene:n=>this.requestRender(n),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(n,s,a)=>e.options.screenshot.renderOverlay(n,s,a)};this._screenshotManager=new Fwt(this._rctx,r,n=>this.events.emit("force-camera-for-screenshot",n)),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=nn(this._frameTask),this._shaderTechniqueRepository=ct(this._shaderTechniqueRepository)}requestRender(e=ns.UPDATE){this._needsRender=!0,e===ns.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(i=>i[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,n,s,a=s){const u=n.constrainWindowSize(i,r,s*n.pixelRatio,a*n.pixelRatio),p=this._ensureDepthBuffer(u);this.renderer.readDepthPixels(n,u,p);let y=Number.MAX_VALUE;for(let b=0;b<u[2]*u[3];b++){const S=I_t(4*b,p,n.nearFar);y>S&&S!==n.nearFar[0]&&S!==n.nearFar[1]&&(y=S)}if(e){const b=e.pickDepth(i*n.pixelRatio,r*n.pixelRatio,n);b!=null&&y>b&&b!==n.nearFar[0]&&b!==n.nearFar[1]&&(y=b)}return y===Number.MAX_VALUE?void 0:y}_ensureDepthBuffer(e){const i=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){$Ae(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,n=ns.BACKGROUND,s=!1;const a={preRender:({time:u})=>{r=this.updating,n=this._needsUpdate?ns.UPDATE:ns.BACKGROUND,e.commitSyncLayers();const p=u-this._lastAnimationUpdate;if(p>this.renderer.animationTimestep||i.forcedAnimationTime!=null||r||this._needsRender){const y=p/this.renderer.animationTimeDilation,b=new STe(i.camera,y,i.forcedAnimationTime);this.renderer.updateAnimation(b)&&this.requestRender(ns.BACKGROUND),this._lastAnimationUpdate=u}},render:({time:u})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const p=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,i,kc.ON,u),s=!0,p&&this.renderer.hasReflections&&(this.requestRender(ns.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:u})=>{const p=this.renderer.hasSlicePlane||this._magnifierHelper.enabled||this.renderer.hasDecorations||this.renderer.hasHighlights,y=new Nwt(i,p,this.renderer.fboCache);this._textureRepository.update(),this._screenshotManager.update(y,u)},finish:()=>{s&&(this.renderer.finish(i.mode===yr.IDLE?n:ns.UPDATE),s=!1)}};this._frameTask=$2(a)}_initializeContext(e){const i=e.options;this._canvas=i.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},n=JXe("3d",this._canvas,r);n!=null&&Jp(n)?(this._rctx=this._newRenderingContext(n,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&Ee.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&Me("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):Ee.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(e,i){const r={disabledExtensions:i.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:i.options.debugWebGLExtensions||{},maxAnisotropy:8},n=(s,a)=>i.view.resourceController.memoryController.newCache(s,a);return new pwt(e,r,n)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new __t(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};_([T({type:Boolean,readOnly:!0})],zo.prototype,"updating",null),_([T({autoDestroy:!0})],zo.prototype,"_rctx",void 0),_([T({autoDestroy:!0})],zo.prototype,"_container",void 0),_([T({autoDestroy:!0})],zo.prototype,"_canvas",void 0),_([T({autoDestroy:!0})],zo.prototype,"stippleTextureRepository",void 0),_([T({autoDestroy:!0})],zo.prototype,"markerTextureRepository",void 0),_([T({autoDestroy:!0})],zo.prototype,"waterTextureRepository",void 0),_([T({autoDestroy:!0})],zo.prototype,"_magnifierHelper",void 0),_([T({readOnly:!0})],zo.prototype,"objectAndLayerIdRenderHelper",void 0),_([T({autoDestroy:!0})],zo.prototype,"_textureRepository",void 0),_([T({autoDestroy:!0,readOnly:!0})],zo.prototype,"renderer",void 0),_([T({autoDestroy:!0})],zo.prototype,"_screenshotManager",void 0),_([T()],zo.prototype,"componentObjectCollection",null),_([T({autoDestroy:!0})],zo.prototype,"_componentObjectCollection",void 0),_([T()],zo.prototype,"_needsUpdate",void 0),_([T()],zo.prototype,"_needsWaterReflectionUpdate",void 0),zo=_([Z("esri.views.3d.webgl-engine.parts.RenderView")],zo);let mu=class extends Ke{constructor(e){super(e),this._model=new X$,this._layers=new xi,this._asyncChangeSet=new Aq,this._syncChangeSet=new Aq,this._layerSyncSet=new Set}initialize(){this._set("renderView",new zo(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(Zt.STAGE,this),this.addHandles(this._frameTask)}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(e){this._model.add(e),v8(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(v8(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){e!=null&&(this._model?.removeMany(e),this.renderView?.requestRender())}forEachOfType(e,i){this._model.forEachOfType(e,i)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const n=this._layerSyncSet.has(r.id)||r.updatePolicy===ev.SYNC,s=n?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,s),this._layerSyncSet.delete(r.id),s.empty||(this.renderer.modify(s,n?ml:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,ml),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==ev.ASYNC||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(i=>{this._layerSyncSet.has(i.id)||i.updatePolicy===ev.SYNC?(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id)):e.commitSyncUpdates(i.id,this._syncChangeSet)});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,ml),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,ml),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,ml))}addRenderPlugin(e,i){const r=this.renderer.renderPlugins.add(e,i),n=()=>{oue(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(Yc(r))return r.then(n);n()}removeRenderPlugin(e){this.destroyed||(oue(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){const e=this;return{getCount:i=>e._model.test.content.filter(r=>r.type===i).length,model:e._model}}};mu.DebugSettings={endFrameContentValidation:!1},_([T({constructOnly:!0})],mu.prototype,"view",void 0),_([T({constructOnly:!0})],mu.prototype,"options",void 0),_([T({readOnly:!0})],mu.prototype,"viewingMode",null),_([T({constructOnly:!0})],mu.prototype,"container",void 0),_([T({readOnly:!0})],mu.prototype,"updating",null),_([T({constructOnly:!0})],mu.prototype,"_model",void 0),_([T({autoDestroy:!0})],mu.prototype,"renderView",void 0),_([T({readOnly:!0})],mu.prototype,"renderer",null),_([T({readOnly:!0})],mu.prototype,"running",null),mu=_([Z("esri.views.3d.webgl-engine.Stage")],mu);let wVt=class extends x7{constructor(e,i,r,n){super(i,r),this.point=e,this.createGraphic=n}};function ROe(t){return Hp(t)&&t.intersector===En.PCL&&!!t.target}let TVt=class extends qbe{constructor(e,i,r,n,s){super(e),this.layerUid=e,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=n,this.triangleNr=s}},EVt=class extends x7{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}};function IN(t){return Hp(t)&&t.intersector===En.I3S&&!!t.target}function MOe(t){return Hp(t)&&t.intersector===En.VOXEL&&!!t.target}function gpe(t,e){return T7(t)||S7(t)?AO(t.target?.object,e):Kat(t)?e.map?.ground:ROe(t)||IN(t)||pCe(t)||MOe(t)?AO(t.target,e):null}function AVt(t,e){const i=yW(t,e);return i!=null&&i.type==="graphic"?i.graphic:null}function yW(t,e){if(t==null)return null;if(T7(t)||S7(t))return ype(t.target?.object,e);if(ROe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(MOe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return pCe(t)||tee(t)?ype(t.target,e):IN(t)?kwt(t.target,e):null}function ype(t,e){if(t?.graphicUid==null)return null;const i=AO(t,e);if(i==null)return null;if(i===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const r=e.allLayerViews.find(n=>n.layer===i);return!r||r.suspended||t.graphicUid==null?null:"getHit"in r?r.getHit(t.graphicUid):null}function kwt(t,e){const i=AO(t,e);if(i==null)return null;const r=e.allLayerViews.find(n=>n.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?Uwt(r.getGraphicFromIntersectorTarget(t)):null}function zwt(t,e){const i=AO(t,e);if(i==null)return null;const r=e.allLayerViews.find(n=>n.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function Uwt(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function AO(t,e){return t?.layerUid==null?null:e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid)}function OVt(t,e){if(T7(t)||S7(t))return ug(t.target.object.boundingVolumeWorldSpace.bounds);if(tee(t)){Ige(F9,t.transformation);const i=Math.max(F9[0],F9[1],F9[2]);return t.target.baseBoundingSphere.radius*i}if(IN(t)){const i=zwt(t.target,e);return i?.5*Xve(i):null}return null}function RVt(t){return!T7(t)&&!S7(t)&&(tee(t)?t.target.numLodLevels>1:!!IN(t))}const F9=H();async function jwt(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=(i.results[0].distance??0)*(1+Bwt),n=i.results.findIndex(s=>(s.distance??0)>r);return n!==-1&&(i.results=i.results.slice(0,n)),i}const Bwt=.05;function MVt(t){return t&&typeof t.highlight=="function"}function Vwt(t){return t&&typeof t.maskOccludee=="function"}function PVt(t,e,i){return t==null||t>i&&(e===0||t<e)}function IVt(t,e){return t!=null&&t>0||e!=null&&e>0}function $Vt(t){const e=t.effectiveScaleRange;return{minScale:e?.minScale??0,maxScale:e?.maxScale??0}}let LU,DU;function Gwt(t){const e=$we(t);for(;e.length>1;){const i=vpe(e.shift());if(i.available)return i}return vpe(e.shift())}function vpe(t){switch(t){case Ji.WEBGL1:return Hwt();case Ji.WEBGL2:return qwt()}}function Hwt(){return LU||(LU=Jwt()),LU}function qwt(){return DU||(DU=Ywt()),DU}let POe=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},Wwt=class extends POe{constructor(){super(...arguments),this.type=Ji.WEBGL1}},Xwt=class extends POe{constructor(){super(...arguments),this.type=Ji.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function IOe(t,e){if(t===Ji.WEBGL1&&typeof WebGLRenderingContext>"u"||t===Ji.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const i=document.createElement("canvas");if(!i)return null;let r=qG(i,t,{failIfMajorPerformanceCaveat:!0});if(r==null&&(r=qG(i,t),r!=null&&(e.majorPerformanceCaveat=!0)),r==null)return r;if(t===Ji.WEBGL1){const s=r.getParameter(r.VERSION),a=s?.match(/^WebGL\s+([\d.]*)/);if(a){const u=parseFloat(a[1]);e.available=u>=.94}}else e.available=!0;e.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const n=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return n&&(e.supportsHighPrecisionFragment=n.precision>0),r}function Jwt(){const t=new Wwt,e=IOe(Ji.WEBGL1,t);return e==null||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function Ywt(){const t=new Xwt,e=IOe(Ji.WEBGL2,t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function Zwt(t){const e=Gwt(t);if(!e.available)return new de("webgl:required",t==="3d"?"WebGL2 is required but not supported.":"WebGL is required but not supported.",new Error().stack);if(t==="3d"&&e.majorPerformanceCaveat)return new de("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new de("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new de("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===Ji.WEBGL1){if(!e.supportsElementIndexUint)return new de("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new de("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new de("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function Kwt(t){return t&&"nodeType"in t}function Qwt(t){return t&&typeof t.render=="function"}const _pe={component:"esri-component"};let _b=class extends Ke{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(e){this._set("id",e)}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(_pe.component),i&&i.classList.remove(_pe.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||Kwt(e)?(this._set("widget",null),u7(e)):(Qwt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};_([T()],_b.prototype,"id",null),_([T()],_b.prototype,"node",null),_([Fi("node")],_b.prototype,"castNode",null),_([T({readOnly:!0})],_b.prototype,"widget",void 0),_b=_([Z("esri.views.ui.Component")],_b);const Q$=_b,$Oe="calcite-mode-";function e3t(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function t3t(){return e3t().startsWith("dark")}function i3t(){return`${$Oe}${t3t()?"dark":"light"}`}function r3t(t){n3t(t),t.classList.add(i3t())}function n3t(t){Array.from(t.classList).forEach(e=>{e.startsWith($Oe)&&t.classList.remove(e)})}const s3t={left:0,top:0,bottom:0,right:0},LOe={bottom:30,top:15,right:15,left:15},hm="esri-ui",dc={ui:hm,corner:`${hm}-corner`,innerContainer:`${hm}-inner-container`,manualContainer:`${hm}-manual-container`,cornerContainer:`${hm}-corner-container`,topLeft:`${hm}-top-left`,topRight:`${hm}-top-right`,bottomLeft:`${hm}-bottom-left`,bottomRight:`${hm}-bottom-right`};function o3t(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function k9(t){return t===0?"0":`${t}px`}function NU(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function FU(t,{top:e,bottom:i,left:r,right:n}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=n}let Uf=class extends Xn.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=Bu(),this.view=null,this._applyViewPadding=()=>{const i=this.container;i&&FU(i,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const i=this._innerContainer;i&&FU(i,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([Fe(()=>[this.view?.padding,this.container],this._applyViewPadding,jr),Fe(()=>this.padding,this._applyUIPadding,jr),Fe(()=>[this.container,this._locale],([e,i])=>{e&&e.setAttribute("lang",i)},jr),BJ(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const i=this._get("container");e!==i&&(e&&(e.classList.add(dc.ui),r3t(e),this._attachContainers(e)),i&&(i.classList.remove(dc.ui),FU(i,{top:"",bottom:"",left:"",right:""}),S_e(i)),this._set("container",e))}get height(){const e=this.view?.height??0;if(e===0)return e;const i=this._getViewPadding(),{top:r,bottom:n}=i;return Math.max(e-r-n,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...LOe,...e}}get width(){const e=this.view?.width??0;if(e===0)return e;const i=this._getViewPadding(),{left:r,right:n}=i;return Math.max(e-r-n,0)}add(e,i){let r,n,s;if(Array.isArray(e))return void e.forEach(u=>this.add(u,i));const a=NU(e);a&&({index:r,position:i,component:e,key:n}=a),i&&typeof i=="object"&&({index:r,key:n,position:i,internal:s}=i),!e||i&&!this._isValidPosition(i)||this._add(e,i,r,n,s)}remove(e,i){if(!e)return;if(Array.isArray(e))return e.map(n=>this.remove(n,i));const r=this._find(e);if(r){if(this._componentMap.has(r)&&this._componentMap.get(r)?.key!==i)return;const n=this._components.indexOf(r);return r.node.parentNode?.removeChild(r.node),this._componentMap.delete(r),this._components.splice(n,1)[0]}}empty(e,i={removeInternal:!1}){if(Array.isArray(e)){for(const s of e)this.empty(s,i);return}const r=this._positionNameToContainerLookup[e??"manual"],n=Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(s=>s==null?!1:!(this._componentMap.get(s)?.internal??!1)||i.removeInternal);for(const s of n)this.remove(s)}move(e,i){if(Array.isArray(e)&&e.forEach(a=>this.move(a,i)),!e)return;let r;const n=NU(e)||NU(i);if(n&&(r=n.index,i=n.position,e=n.component||e),i&&!this._isValidPosition(i))return;const s=this.remove(e);s&&this.add(s,{position:i,index:r})}find(e){if(!e)return null;const i=this._findById(e);return i&&(i.widget||i.node)}getComponents(e,i={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(r=>this._getComponentsAtPosition(r,i)):this._getComponentsAtPosition(e,i):this._components.filter(r=>i.includeInternal||!this._componentMap.get(r)?.internal).map(({widget:r,node:n})=>r??n)}getPosition(e){for(const i in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[i].contains(e))return i;return null}_add(e,i,r,n,s){e instanceof Q$||(e=new Q$({node:e})),this._place({component:e,position:i,index:r}),this._components.push(e),this._componentMap.set(e,{key:n,internal:s})}_find(e){return e?e instanceof Q$?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.view?.padding??s3t}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(dc.innerContainer,dc.cornerContainer);const i=document.createElement("div");i.classList.add(dc.innerContainer,dc.manualContainer);const r=document.createElement("div");r.classList.add(dc.topLeft,dc.corner),e.appendChild(r);const n=document.createElement("div");n.classList.add(dc.topRight,dc.corner),e.appendChild(n);const s=document.createElement("div");s.classList.add(dc.bottomLeft,dc.corner),e.appendChild(s);const a=document.createElement("div");a.classList.add(dc.bottomRight,dc.corner),e.appendChild(a),this._innerContainer=e,this._manualContainer=i;const u=dGe();this._cornerNameToContainerLookup={"top-left":r,"top-right":n,"bottom-left":s,"bottom-right":a,"top-leading":u?n:r,"top-trailing":u?r:n,"bottom-leading":u?a:s,"bottom-trailing":u?s:a},this._positionNameToContainerLookup={manual:i,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const i=e.position??"manual",{component:r,index:n}=e,s=this._positionNameToContainerLookup[i],a=n!=null&&n>-1;if(o3t(r.widget)&&r.widget.startup(),!a)return void s.appendChild(r.node);const u=Array.from(s.children);if(n===0)return void(s.firstChild?Bre(r.node,s.firstChild):s.appendChild(r.node));n>=u.length?s.appendChild(r.node):Bre(r.node,u[n])}_toPixelPosition(e){return{top:k9(e.top),left:k9(e.left),right:k9(e.right),bottom:k9(e.bottom)}}_findByComponent(e){return this._components.find(i=>i===e)??null}_findById(e){return this._components.find(({id:i})=>i===e)??null}_findByNode(e){return this._components.find(({node:i})=>i===e)??null}_getComponentsAtPosition(e,i){const r=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(r.children).map(n=>this._findByNode(n)).filter(gw).filter(n=>i.includeInternal||!this._componentMap.get(n)?.internal).map(({widget:n,node:s})=>n??s)}};_([T()],Uf.prototype,"_locale",void 0),_([T()],Uf.prototype,"container",null),_([T()],Uf.prototype,"height",null),_([T({value:LOe})],Uf.prototype,"padding",null),_([Fi("padding")],Uf.prototype,"castPadding",null),_([T()],Uf.prototype,"view",void 0),_([T()],Uf.prototype,"width",null),Uf=_([Z("esri.views.ui.UI")],Uf);const a3t=Uf,l3t={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},c3t={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}},u3t=t=>({...c3t,...t}),h3t=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},d3t=(t,e)=>t.find(e),bpe=(t,e,i=!1)=>{let r=t;return e.forEach((n,s)=>{const a=r?.children?d3t(r.children,u=>u.domNode===n):void 0;i&&!a&&s!==e.length-1||(r=a)}),r},p3t=t=>{let e;const i={...l3t,...t},r=u3t(i),n=r.performanceLogger;let s,a=!0,u=!1;const p=[],y=[],b=(C,O,P)=>{let $;r.eventHandlerInterceptor=(z,U,j,G)=>function(q){let W;n("domEvent",q);const K=h3t(q.currentTarget,$.domNode),se=K.some(le=>customElements.get(le?.tagName?.toLowerCase()));if(q.eventPhase===Event.CAPTURING_PHASE||!se)K.reverse(),W=bpe($.getLastRender(),K);else{const le=q.composedPath(),me=le.slice(le.indexOf(q.currentTarget),le.indexOf($.domNode)).reverse();W=bpe($.getLastRender(),me,!0)}let ae;return W&&(ae=i.handleInterceptedEvent(e,W,this,q)),n("domEventProcessed",q),ae},i.postProcessProjectionOptions?.(r);const N=P();$=C(O,N,r),r.eventHandlerInterceptor=void 0,p.push($),y.push(P),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered($,N)};let S=()=>{if(s=void 0,a){a=!1,n("renderStart",void 0);for(let C=0;C<p.length;C++){const O=y[C]();n("rendered",void 0),p[C].update(O),n("patched",void 0)}n("renderDone",void 0),a=!0}};return i.modifyDoRenderImplementation&&(S=i.modifyDoRenderImplementation(S,p,y)),e={renderNow:S,scheduleRender:()=>{s||u||(s=requestAnimationFrame(S))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),u=!0},resume:()=>{u=!1,a=!0,e.scheduleRender()},append:(C,O)=>{b(jy.append,C,O)},insertBefore:(C,O)=>{b(jy.insertBefore,C,O)},merge:(C,O)=>{b(jy.merge,C,O)},replace:(C,O)=>{b(jy.replace,C,O)},detach:C=>{for(let O=0;O<y.length;O++)if(y[O]===C)return y.splice(O,1),p.splice(O,1)[0];throw new Error("renderFunction was not found")}},e},Ux={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let jx,DOe,$N,NOe=!1,H8=!1,Nee=!1,Ou=!1,wpe=null,vW=!1;const Fee=t=>{const e=new URL(t,_a.$resourcesUrl$);return e.origin!==kR.location.origin?e.href:e.pathname},f3t=t=>_a.$resourcesUrl$=t,hw=(t,e="")=>()=>{},xpe="http://www.w3.org/1999/xlink",Tpe={},m3t="http://www.w3.org/2000/svg",g3t="http://www.w3.org/1999/xhtml",y3t=t=>t!=null,kee=t=>(t=typeof t,t==="object"||t==="function");function v3t(t){var e,i,r;return(r=(i=(e=t.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||i===void 0?void 0:i.getAttribute("content"))!==null&&r!==void 0?r:void 0}const _t=(t,e,...i)=>{let r=null,n=null,s=null,a=!1,u=!1;const p=[],y=S=>{for(let C=0;C<S.length;C++)r=S[C],Array.isArray(r)?y(r):r!=null&&typeof r!="boolean"&&((a=typeof t!="function"&&!kee(r))&&(r=String(r)),a&&u?p[p.length-1].$text$+=r:p.push(a?q8(null,r):r),u=a)};if(y(i),e){e.key&&(n=e.key),e.name&&(s=e.name);{const S=e.className||e.class;S&&(e.class=typeof S!="object"?S:Object.keys(S).filter(C=>S[C]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,p,b3t);const b=q8(t,null);return b.$attrs$=e,p.length>0&&(b.$children$=p),b.$key$=n,b.$name$=s,b},q8=(t,e)=>{const i={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return i.$attrs$=null,i.$key$=null,i.$name$=null,i},Jg={},_3t=t=>t&&t.$tag$===Jg,b3t={forEach:(t,e)=>t.map(Spe).forEach(e),map:(t,e)=>t.map(Spe).map(e).map(w3t)},Spe=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),w3t=t=>{if(typeof t.vtag=="function"){const i=Object.assign({},t.vattrs);return t.vkey&&(i.key=t.vkey),t.vname&&(i.name=t.vname),_t(t.vtag,i,...t.vchildren||[])}const e=q8(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},x3t=t=>J3t.map(e=>e(t)).find(e=>!!e),T3t=(t,e)=>t!=null&&!kee(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,S3t=t=>t,_W=(t,e,i)=>{const r=S3t(t);return{emit:n=>E3t(r,e,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:n})}},E3t=(t,e,i)=>{const r=_a.ce(e,i);return t.dispatchEvent(r),r},Epe=new WeakMap,C3t=(t,e,i)=>{let r=X8.get(t);K3t&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=e:r.replaceSync(e)):r=e,X8.set(t,r)},A3t=(t,e,i,r)=>{var n;let s=FOe(e,i);const a=X8.get(s);if(t=t.nodeType===11?t:Mp,a)if(typeof a=="string"){t=t.head||t;let u=Epe.get(t),p;if(u||Epe.set(t,u=new Set),!u.has(s)){{p=Mp.createElement("style"),p.innerHTML=a;const y=(n=_a.$nonce$)!==null&&n!==void 0?n:v3t(Mp);y!=null&&p.setAttribute("nonce",y),t.insertBefore(p,t.querySelector("link"))}u&&u.add(s)}}else t.adoptedStyleSheets.includes(a)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,a]);return s},O3t=t=>{const e=t.$cmpMeta$,i=t.$hostElement$,r=e.$flags$,n=hw("attachStyles",e.$tagName$),s=A3t(i.shadowRoot?i.shadowRoot:i.getRootNode(),e,t.$modeName$);r&10&&(i["s-sc"]=s,i.classList.add(s+"-h"),r&2&&i.classList.add(s+"-s")),n()},FOe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),Cpe=(t,e,i,r,n,s)=>{if(i!==r){let a=Mpe(t,e),u=e.toLowerCase();if(e==="class"){const p=t.classList,y=Ape(i),b=Ape(r);p.remove(...y.filter(S=>S&&!b.includes(S))),p.add(...b.filter(S=>S&&!y.includes(S)))}else if(e==="style"){for(const p in i)(!r||r[p]==null)&&(p.includes("-")?t.style.removeProperty(p):t.style[p]="");for(const p in r)(!i||r[p]!==i[p])&&(p.includes("-")?t.style.setProperty(p,r[p]):t.style[p]=r[p])}else if(e!=="key")if(e==="ref")r&&r(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):Mpe(kR,u)?e=u.slice(2):e=u[2]+e.slice(3),i&&_a.rel(t,e,i,!1),r&&_a.ael(t,e,r,!1);else{const p=kee(r);if((a||p&&r!==null)&&!n)try{if(t.tagName.includes("-"))t[e]=r;else{const b=r??"";e==="list"?a=!1:(i==null||t[e]!=b)&&(t[e]=b)}}catch{}let y=!1;u!==(u=u.replace(/^xlink\:?/,""))&&(e=u,y=!0),r==null||r===!1?(r!==!1||t.getAttribute(e)==="")&&(y?t.removeAttributeNS(xpe,e):t.removeAttribute(e)):(!a||s&4||n)&&!p&&(r=r===!0?"":r,y?t.setAttributeNS(xpe,e,r):t.setAttribute(e,r))}}},R3t=/\s/,Ape=t=>t?t.split(R3t):[],kOe=(t,e,i,r)=>{const n=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||Tpe,a=e.$attrs$||Tpe;for(r in s)r in a||Cpe(n,r,s[r],void 0,i,e.$flags$);for(r in a)Cpe(n,r,s[r],a[r],i,e.$flags$)},W8=(t,e,i,r)=>{const n=e.$children$[i];let s=0,a,u,p;if(NOe||(Nee=!0,n.$tag$==="slot"&&(jx&&r.classList.add(jx+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)a=n.$elm$=Mp.createTextNode(n.$text$);else if(n.$flags$&1)a=n.$elm$=Mp.createTextNode("");else{if(Ou||(Ou=n.$tag$==="svg"),a=n.$elm$=Mp.createElementNS(Ou?m3t:g3t,n.$flags$&2?"slot-fb":n.$tag$),Ou&&n.$tag$==="foreignObject"&&(Ou=!1),kOe(null,n,Ou),y3t(jx)&&a["s-si"]!==jx&&a.classList.add(a["s-si"]=jx),n.$children$)for(s=0;s<n.$children$.length;++s)u=W8(t,n,s,a),u&&a.appendChild(u);n.$tag$==="svg"?Ou=!1:a.tagName==="foreignObject"&&(Ou=!0)}return a["s-hn"]=$N,n.$flags$&3&&(a["s-sr"]=!0,a["s-cr"]=DOe,a["s-sn"]=n.$name$||"",p=t&&t.$children$&&t.$children$[i],p&&p.$tag$===n.$tag$&&t.$elm$&&OO(t.$elm$,!1)),a},OO=(t,e)=>{_a.$flags$|=1;const i=t.childNodes;for(let r=i.length-1;r>=0;r--){const n=i[r];n["s-hn"]!==$N&&n["s-ol"]&&(jOe(n).insertBefore(n,zee(n)),n["s-ol"].remove(),n["s-ol"]=void 0,Nee=!0),e&&OO(n,e)}_a.$flags$&=-2},zOe=(t,e,i,r,n,s)=>{let a=t["s-cr"]&&t["s-cr"].parentNode||t,u;for(a.shadowRoot&&a.tagName===$N&&(a=a.shadowRoot);n<=s;++n)r[n]&&(u=W8(null,i,n,t),u&&(r[n].$elm$=u,a.insertBefore(u,zee(e))))},UOe=(t,e,i,r,n)=>{for(;e<=i;++e)(r=t[e])&&(n=r.$elm$,GOe(r),H8=!0,n["s-ol"]?n["s-ol"].remove():OO(n,!0),n.remove())},M3t=(t,e,i,r)=>{let n=0,s=0,a=0,u=0,p=e.length-1,y=e[0],b=e[p],S=r.length-1,C=r[0],O=r[S],P,$;for(;n<=p&&s<=S;)if(y==null)y=e[++n];else if(b==null)b=e[--p];else if(C==null)C=r[++s];else if(O==null)O=r[--S];else if(z9(y,C))Bx(y,C),y=e[++n],C=r[++s];else if(z9(b,O))Bx(b,O),b=e[--p],O=r[--S];else if(z9(y,O))(y.$tag$==="slot"||O.$tag$==="slot")&&OO(y.$elm$.parentNode,!1),Bx(y,O),t.insertBefore(y.$elm$,b.$elm$.nextSibling),y=e[++n],O=r[--S];else if(z9(b,C))(y.$tag$==="slot"||O.$tag$==="slot")&&OO(b.$elm$.parentNode,!1),Bx(b,C),t.insertBefore(b.$elm$,y.$elm$),b=e[--p],C=r[++s];else{for(a=-1,u=n;u<=p;++u)if(e[u]&&e[u].$key$!==null&&e[u].$key$===C.$key$){a=u;break}a>=0?($=e[a],$.$tag$!==C.$tag$?P=W8(e&&e[s],i,a,t):(Bx($,C),e[a]=void 0,P=$.$elm$),C=r[++s]):(P=W8(e&&e[s],i,s,t),C=r[++s]),P&&jOe(y.$elm$).insertBefore(P,zee(y.$elm$))}n>p?zOe(t,r[S+1]==null?null:r[S+1].$elm$,i,r,s,S):s>S&&UOe(e,n,p)},z9=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,zee=t=>t&&t["s-ol"]||t,jOe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,Bx=(t,e)=>{const i=e.$elm$=t.$elm$,r=t.$children$,n=e.$children$,s=e.$tag$,a=e.$text$;let u;a===null?(Ou=s==="svg"?!0:s==="foreignObject"?!1:Ou,s==="slot"||kOe(t,e,Ou),r!==null&&n!==null?M3t(i,r,e,n):n!==null?(t.$text$!==null&&(i.textContent=""),zOe(i,null,e,n,0,n.length-1)):r!==null&&UOe(r,0,r.length-1),Ou&&s==="svg"&&(Ou=!1)):(u=i["s-cr"])?u.parentNode.textContent=a:t.$text$!==a&&(i.data=a)},BOe=t=>{const e=t.childNodes;let i,r,n,s,a,u;for(r=0,n=e.length;r<n;r++)if(i=e[r],i.nodeType===1){if(i["s-sr"]){for(a=i["s-sn"],i.hidden=!1,s=0;s<n;s++)if(u=e[s].nodeType,e[s]["s-hn"]!==i["s-hn"]||a!==""){if(u===1&&a===e[s].getAttribute("slot")){i.hidden=!0;break}}else if(u===1||u===3&&e[s].textContent.trim()!==""){i.hidden=!0;break}}BOe(i)}},dp=[],VOe=t=>{let e,i,r,n,s,a,u=0;const p=t.childNodes,y=p.length;for(;u<y;u++){if(e=p[u],e["s-sr"]&&(i=e["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,n=e["s-sn"],a=r.length-1;a>=0;a--)i=r[a],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==e["s-hn"]&&(Ope(i,n)?(s=dp.find(b=>b.$nodeToRelocate$===i),H8=!0,i["s-sn"]=i["s-sn"]||n,s?s.$slotRefNode$=e:dp.push({$slotRefNode$:e,$nodeToRelocate$:i}),i["s-sr"]&&dp.map(b=>{Ope(b.$nodeToRelocate$,i["s-sn"])&&(s=dp.find(S=>S.$nodeToRelocate$===i),s&&!b.$slotRefNode$&&(b.$slotRefNode$=s.$slotRefNode$))})):dp.some(b=>b.$nodeToRelocate$===i)||dp.push({$nodeToRelocate$:i}));e.nodeType===1&&VOe(e)}},Ope=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",GOe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(GOe)},P3t=(t,e)=>{const i=t.$hostElement$,r=t.$cmpMeta$,n=t.$vnode$||q8(null,null),s=_3t(e)?e:_t(null,null,e);$N=i.tagName,r.$attrsToReflect$&&(s.$attrs$=s.$attrs$||{},r.$attrsToReflect$.map(([a,u])=>s.$attrs$[u]=i[a])),s.$tag$=null,s.$flags$|=4,t.$vnode$=s,s.$elm$=n.$elm$=i.shadowRoot||i,jx=i["s-sc"],DOe=i["s-cr"],NOe=(r.$flags$&1)!==0,H8=!1,Bx(n,s);{if(_a.$flags$|=1,Nee){VOe(s.$elm$);let a,u,p,y,b,S,C=0;for(;C<dp.length;C++)a=dp[C],u=a.$nodeToRelocate$,u["s-ol"]||(p=Mp.createTextNode(""),p["s-nr"]=u,u.parentNode.insertBefore(u["s-ol"]=p,u));for(C=0;C<dp.length;C++)if(a=dp[C],u=a.$nodeToRelocate$,a.$slotRefNode$){for(y=a.$slotRefNode$.parentNode,b=a.$slotRefNode$.nextSibling,p=u["s-ol"];p=p.previousSibling;)if(S=p["s-nr"],S&&S["s-sn"]===u["s-sn"]&&y===S.parentNode&&(S=S.nextSibling,!S||!S["s-nr"])){b=S;break}(!b&&y!==u.parentNode||u.nextSibling!==b)&&u!==b&&(!u["s-hn"]&&u["s-ol"]&&(u["s-hn"]=u["s-ol"].parentNode.nodeName),y.insertBefore(u,b))}else u.nodeType===1&&(u.hidden=!0)}H8&&BOe(s.$elm$),_a.$flags$&=-2,dp.length=0}},I3t=(t,e)=>{},Uee=(t,e)=>(t.$flags$|=16,I3t(t,t.$ancestorComponent$),ext(()=>$3t(t,e))),$3t=(t,e)=>{const i=t.$hostElement$,r=hw("scheduleUpdate",t.$cmpMeta$.$tagName$),n=i;let s;return e?s=ZT(n,"componentWillLoad"):s=ZT(n,"componentWillUpdate"),s=Rpe(s,()=>ZT(n,"componentWillRender")),r(),Rpe(s,()=>L3t(t,n,e))},L3t=async(t,e,i)=>{const r=t.$hostElement$,n=hw("update",t.$cmpMeta$.$tagName$);r["s-rc"],i&&O3t(t);const s=hw("render",t.$cmpMeta$.$tagName$);D3t(t,e,r),s(),n(),N3t(t)},D3t=(t,e,i)=>{try{wpe=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(Ux.hasRenderFn||Ux.reflect)&&(Ux.vdomRender||Ux.reflect)&&(Ux.hydrateServerSide||P3t(t,e))}catch(u){FR(u,t.$hostElement$)}return wpe=null,null},N3t=t=>{const e=t.$cmpMeta$.$tagName$,i=t.$hostElement$,r=hw("postUpdate",e),n=i;t.$ancestorComponent$,ZT(n,"componentDidRender"),t.$flags$&64?(ZT(n,"componentDidUpdate"),r()):(t.$flags$|=64,ZT(n,"componentDidLoad"),r())},HOe=t=>{{const e=NR(t),i=e.$hostElement$.isConnected;return i&&(e.$flags$&18)===2&&Uee(e,!1),i}},ZT=(t,e,i)=>{if(t&&t[e])try{return t[e](i)}catch(r){FR(r)}},Rpe=(t,e)=>t&&t.then?t.then(e):e(),F3t=(t,e)=>NR(t).$instanceValues$.get(e),k3t=(t,e,i,r)=>{const n=NR(t),s=t,a=n.$instanceValues$.get(e),u=n.$flags$,p=s;i=T3t(i,r.$members$[e][0]);const y=Number.isNaN(a)&&Number.isNaN(i);if(i!==a&&!y){n.$instanceValues$.set(e,i);{if(r.$watchers$&&u&128){const S=r.$watchers$[e];S&&S.map(C=>{try{p[C](i,a,e)}catch(O){FR(O,s)}})}if((u&18)===2){if(p.componentShouldUpdate&&p.componentShouldUpdate(i,a,e)===!1)return;Uee(n,!1)}}}},z3t=(t,e,i)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const r=Object.entries(e.$members$),n=t.prototype;r.map(([s,[a]])=>{(a&31||a&32)&&Object.defineProperty(n,s,{get(){return F3t(this,s)},set(u){k3t(this,s,u,e)},configurable:!0,enumerable:!0})});{const s=new Map;n.attributeChangedCallback=function(a,u,p){_a.jmp(()=>{const y=s.get(a);if(this.hasOwnProperty(y))p=this[y],delete this[y];else if(n.hasOwnProperty(y)&&typeof this[y]=="number"&&this[y]==p)return;this[y]=p===null&&typeof this[y]=="boolean"?!1:p})},t.observedAttributes=r.filter(([a,u])=>u[0]&15).map(([a,u])=>{const p=u[1]||a;return s.set(p,a),u[0]&512&&e.$attrsToReflect$.push([a,p]),p})}}return t},U3t=async(t,e,i,r,n)=>{if(!(e.$flags$&32)&&(n=t.constructor,e.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>e.$flags$|=128),n.style)){let a=n.style;typeof a!="string"&&(a=a[e.$modeName$=x3t(t)]);const u=FOe(i,e.$modeName$);if(!X8.has(u)){const p=hw("registerStyles",i.$tagName$);C3t(u,a,!!(i.$flags$&1)),p()}}e.$ancestorComponent$,(()=>Uee(e,!0))()},j3t=t=>{},B3t=t=>{if(!(_a.$flags$&1)){const e=NR(t),i=e.$cmpMeta$,r=hw("connectedCallback",i.$tagName$);e.$flags$&1?(WOe(t,e,i.$listeners$),j3t(e.$lazyInstance$)):(e.$flags$|=1,i.$flags$&12&&V3t(t),i.$members$&&Object.entries(i.$members$).map(([n,[s]])=>{if(s&31&&t.hasOwnProperty(n)){const a=t[n];delete t[n],t[n]=a}}),U3t(t,e,i)),r()}},V3t=t=>{const e=t["s-cr"]=Mp.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},G3t=t=>{if(!(_a.$flags$&1)){const e=NR(t);e.$rmListeners$&&(e.$rmListeners$.map(i=>i()),e.$rmListeners$=void 0)}},W0=(t,e)=>{const i={$flags$:e[0],$tagName$:e[1]};i.$members$=e[2],i.$listeners$=e[3],i.$watchers$=t.$watchers$,i.$attrsToReflect$=[];const r=t.prototype.connectedCallback,n=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){X3t(this,i)},connectedCallback(){B3t(this),r&&r.call(this)},disconnectedCallback(){G3t(this),n&&n.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)})}}),t.is=i.$tagName$,z3t(t,i)},qOe=(t,e)=>e,WOe=(t,e,i,r)=>{i&&i.map(([n,s,a])=>{const u=q3t(t,n),p=H3t(e,a),y=W3t(n);_a.ael(u,s,p,y),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>_a.rel(u,s,p,y))})},H3t=(t,e)=>i=>{try{Ux.lazyLoad||t.$hostElement$[e](i)}catch(r){FR(r)}},q3t=(t,e)=>e&4?Mp:e&8?kR:e&16?Mp.body:t,W3t=t=>Y3t?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,XOe=new WeakMap,NR=t=>XOe.get(t),X3t=(t,e)=>{const i={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return WOe(t,i,e.$listeners$),XOe.set(t,i)},Mpe=(t,e)=>e in t,FR=(t,e)=>(0,console.error)(t,e),X8=new Map,J3t=[],kR=typeof window<"u"?window:{},Mp=kR.document||{head:{}},X0=kR.HTMLElement||class{},_a={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,i,r)=>t.addEventListener(e,i,r),rel:(t,e,i,r)=>t.removeEventListener(e,i,r),ce:(t,e)=>new CustomEvent(t,e)},Y3t=(()=>{let t=!1;try{Mp.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),Z3t=t=>Promise.resolve(t),K3t=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),bW=[],JOe=[],YOe=(t,e)=>i=>{t.push(i),vW||(vW=!0,e&&_a.$flags$&4?Q3t(wW):_a.raf(wW))},Ppe=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(i){FR(i)}t.length=0},wW=()=>{Ppe(bW),Ppe(JOe),(vW=bW.length>0)&&_a.raf(wW)},Q3t=t=>Z3t().then(t),zVt=YOe(bW,!1),ext=YOe(JOe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function txt(t){return t.map(e=>{let i="";for(let r=0;r<e;r++)i+=((1+Math.random())*65536|0).toString(16).substring(1);return i}).join("-")}const ZOe=()=>txt([2,1,1,1,3]);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const KOe="calcite-mode-auto",QOe="calcite-mode-dark",ixt="calcite-mode-light",xW={autoMode:KOe,darkMode:QOe,lightMode:ixt,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var eRe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],J8=eRe.join(","),tRe=typeof Element>"u",dw=tRe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Y8=!tRe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},Z8=function t(e,i){var r;i===void 0&&(i=!0);var n=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),s=n===""||n==="true",a=s||i&&e&&t(e.parentNode);return a},rxt=function(e){var i,r=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return r===""||r==="true"},iRe=function(e,i,r){if(Z8(e))return[];var n=Array.prototype.slice.apply(e.querySelectorAll(J8));return i&&dw.call(e,J8)&&n.unshift(e),n=n.filter(r),n},rRe=function t(e,i,r){for(var n=[],s=Array.from(e);s.length;){var a=s.shift();if(!Z8(a,!1))if(a.tagName==="SLOT"){var u=a.assignedElements(),p=u.length?u:a.children,y=t(p,!0,r);r.flatten?n.push.apply(n,y):n.push({scopeParent:a,candidates:y})}else{var b=dw.call(a,J8);b&&r.filter(a)&&(i||!e.includes(a))&&n.push(a);var S=a.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(a),C=!Z8(S,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(a));if(S&&C){var O=t(S===!0?a.children:S.children,!0,r);r.flatten?n.push.apply(n,O):n.push({scopeParent:a,candidates:O})}else s.unshift.apply(s,a.children)}}return n},nRe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},sRe=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||rxt(e))&&!nRe(e)?0:e.tabIndex},nxt=function(e,i){var r=sRe(e);return r<0&&i&&!nRe(e)?0:r},sxt=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},oRe=function(e){return e.tagName==="INPUT"},oxt=function(e){return oRe(e)&&e.type==="hidden"},axt=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},lxt=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},cxt=function(e){if(!e.name)return!0;var i=e.form||Y8(e),r=function(u){return i.querySelectorAll('input[type="radio"][name="'+u+'"]')},n;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")n=r(window.CSS.escape(e.name));else try{n=r(e.name)}catch(a){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",a.message),!1}var s=lxt(n,e.form);return!s||s===e},uxt=function(e){return oRe(e)&&e.type==="radio"},hxt=function(e){return uxt(e)&&!cxt(e)},dxt=function(e){var i,r=e&&Y8(e),n=(i=r)===null||i===void 0?void 0:i.host,s=!1;if(r&&r!==e){var a,u,p;for(s=!!((a=n)!==null&&a!==void 0&&(u=a.ownerDocument)!==null&&u!==void 0&&u.contains(n)||e!=null&&(p=e.ownerDocument)!==null&&p!==void 0&&p.contains(e));!s&&n;){var y,b,S;r=Y8(n),n=(y=r)===null||y===void 0?void 0:y.host,s=!!((b=n)!==null&&b!==void 0&&(S=b.ownerDocument)!==null&&S!==void 0&&S.contains(n))}}return s},Ipe=function(e){var i=e.getBoundingClientRect(),r=i.width,n=i.height;return r===0&&n===0},pxt=function(e,i){var r=i.displayCheck,n=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=dw.call(e,"details>summary:first-of-type"),a=s?e.parentElement:e;if(dw.call(a,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof n=="function"){for(var u=e;e;){var p=e.parentElement,y=Y8(e);if(p&&!p.shadowRoot&&n(p)===!0)return Ipe(e);e.assignedSlot?e=e.assignedSlot:!p&&y!==e.ownerDocument?e=y.host:e=p}e=u}if(dxt(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return Ipe(e);return!1},fxt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var n=i.children.item(r);if(n.tagName==="LEGEND")return dw.call(i,"fieldset[disabled] *")?!0:!n.contains(e)}return!0}i=i.parentElement}return!1},K8=function(e,i){return!(i.disabled||Z8(i)||oxt(i)||pxt(i,e)||axt(i)||fxt(i))},TW=function(e,i){return!(hxt(i)||sRe(i)<0||!K8(e,i))},mxt=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},gxt=function t(e){var i=[],r=[];return e.forEach(function(n,s){var a=!!n.scopeParent,u=a?n.scopeParent:n,p=nxt(u,a),y=a?t(n.candidates):u;p===0?a?i.push.apply(i,y):i.push(u):r.push({documentOrder:s,tabIndex:p,item:n,isScope:a,content:y})}),r.sort(sxt).reduce(function(n,s){return s.isScope?n.push.apply(n,s.content):n.push(s.content),n},[]).concat(i)},yxt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=rRe([e],i.includeContainer,{filter:TW.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:mxt}):r=iRe(e,i.includeContainer,TW.bind(null,i)),gxt(r)},UVt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=rRe([e],i.includeContainer,{filter:K8.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=iRe(e,i.includeContainer,K8.bind(null,i)),r},jVt=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return dw.call(e,J8)===!1?!1:TW(i,e)},vxt=eRe.concat("iframe").join(","),BVt=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return dw.call(e,vxt)===!1?!1:K8(i,e)};const _xt={getShadowRoot:!0};function bxt(t){return Fw(t,`.${xW.darkMode}, .${xW.lightMode}`)?.classList.contains("calcite-mode-dark")?"dark":"light"}function aRe(t){const e="dir",i=`[${e}]`,r=Fw(t,i);return r?r.getAttribute(e):"ltr"}function lRe(t){return t.getRootNode()}function cRe(t){return t.host||null}function uRe(t,{selector:e,id:i}){function r(n){if(!n)return null;n.assignedSlot&&(n=n.assignedSlot);const s=lRe(n),a=i?"getElementById"in s?s.getElementById(i):null:e?s.querySelector(e):null,u=cRe(s);return a||(u?r(u):null)}return r(t)}function Fw(t,e){function i(r){return r?r.closest(e)||i(cRe(lRe(r))):null}return i(t)}function wxt(t,e){return hRe(t,e)}function hRe(t,e){if(!t)return;const i=e(t);if(i!==void 0)return i;const{parentNode:r}=t;return hRe(r instanceof ShadowRoot?r.host:r,e)}function xxt(t,e){return!!wxt(e,i=>i===t?!0:void 0)}function Txt(t){return typeof t?.setFocus=="function"}async function dRe(t){if(t)return Txt(t)?t.setFocus():t.focus()}function VVt(t){t&&(yxt(t,_xt)[0]||t).focus()}const RO=":not([slot])";function GVt(t,e,i){e&&!Array.isArray(e)&&typeof e!="string"&&(i=e,e=null);const r=e?Array.isArray(e)?e.map(n=>`[slot="${n}"]`).join(","):`[slot="${e}"]`:RO;return i?.all?Sxt(t,r,i):Ext(t,r,i)}function pRe(t,e){return t?Array.from(t.children||[]).filter(i=>i?.matches(e)):[]}function Sxt(t,e,i){let r=e===RO?pRe(t,RO):Array.from(t.querySelectorAll(e));r=i&&i.direct===!1?r:r.filter(s=>s.parentElement===t),r=i?.matches?r.filter(s=>s?.matches(i.matches)):r;const n=i?.selector;return n?r.map(s=>Array.from(s.querySelectorAll(n))).reduce((s,a)=>[...s,...a],[]).filter(s=>!!s):r}function Ext(t,e,i){let r=e===RO?pRe(t,RO)[0]||null:t.querySelector(e);r=i&&i.direct===!1||r?.parentElement===t?r:null,r=i?.matches?r?.matches(i.matches)?r:null:r;const n=i?.selector;return n?r?.querySelector(n):r}function HVt(t,e,i){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[i]}function e6(t){return(!!t).toString()}function qVt(t){return jf(t)||Axt(t)}function Cxt(t){return Oxt(t).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join("").trim()}function Axt(t){return!!Cxt(t)}function Oxt(t){return t.target.assignedNodes({flatten:!0})}function jf(t){return!!jee(t).length}function jee(t){return t.target.assignedElements({flatten:!0})}function WVt(t){return!!(t.isPrimary&&t.button===0)}const U9=(t,e,i,r=!0)=>{const n=t.indexOf(e),s=n===0,a=n===t.length-1;r&&(i=i==="previous"&&s?"last":i==="next"&&a?"first":i);let u;return i==="previous"?u=t[n-1]||t[r?t.length-1:n]:i==="next"?u=t[n+1]||t[r?0:n]:i==="last"?u=t[t.length-1]:u=t[0],dRe(u),u};function Rxt(t,e){if(t.parentNode!==e.parentNode)return!1;const i=Array.from(t.parentNode.children);return i.indexOf(t)<i.indexOf(e)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function $pe(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(QOe)||t.contains(KOe)&&e?"dark":"light",r=a=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:a}})),n=a=>{s!==a&&r(a),s=a};let s=i();r(s),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",a=>n(a.matches?"dark":"light")),new MutationObserver(()=>n(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function Mxt(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?$pe():document.addEventListener("DOMContentLoaded",()=>$pe(),{once:!0}))}const Pxt=Mxt;Pxt();let fRe;function Ixt(){try{Fee(".")}catch{f3t(fl(Kr(fRe)))}}function $xt(t){const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push(t[i]?.());return e.length>0?Promise.all(e):null}fRe="components/assets";const mRe=Symbol("widget"),gRe=Symbol("widget-test-data"),Lxt=[],Dxt={},Q8=new WeakMap;function yRe(t,e){let i=e.children;if(i?.length)for(let n=0;n<i.length;++n)i[n]=yRe(t,i[n]);else i=Lxt;const r=e.vnodeSelector;if(eD(r)){const n=e.properties||Dxt,s=n.key||r;return{vnodeSelector:"div",properties:{key:s,afterCreate:Nxt,afterUpdate:Fxt,afterRemoved:vRe,parentWidget:t,widgetConstructor:r,widgetProperties:{...n,key:s,children:i}},children:void 0,text:void 0,domNode:null}}return e}function Nxt(t,e,i,{parentWidget:r,widgetConstructor:n,widgetProperties:s}){const a=new n(s);a.container=t,Q8.set(t,a),a.afterCreate?.(a,t),r.addHandles(Sr(()=>vRe(t))),queueMicrotask(()=>{a[gRe].projector.renderNow()})}function Fxt(t,e,i,{widgetProperties:r}){const n=Q8.get(t);n&&(n.set(r),n.afterUpdate?.(n,t))}function vRe(t){const e=Q8.get(t);e&&(e.afterRemoved?.(e,t),e.destroy(),Q8.delete(t))}function eD(t){return typeof t=="function"&&t[mRe]}const zc={arrowDown:"esri-icon-arrow-down",arrowUp:"esri-icon-arrow-up",basemap:"esri-icon-basemap",bookmark:"esri-icon-bookmark",calendar:"esri-icon-calendar",checkMark:"esri-icon-check-mark",checkboxUnchecked:"esri-icon-checkbox-unchecked",close:"esri-icon-close",collapse:"esri-icon-collapse",defaultAction:"esri-icon-default-action",description:"esri-icon-description",directions:"esri-icon-directions",dockBottom:"esri-icon-dock-bottom",dockLeft:"esri-icon-dock-left",dockRight:"esri-icon-dock-right",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",download:"esri-icon-download",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",edit:"esri-icon-edit",elevationProfile:"esri-icon-elevation-profile",environmentSettings:"esri-icon-environment-settings",erase:"esri-icon-erase",error:"esri-icon-error",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",gear:"esri-icon-gear",handleHorizontal:"esri-icon-handle-horizontal",handleVertical:"esri-icon-handle-vertical",home:"esri-icon-home",icon:"esri-icon",launchLinkExternal:"esri-icon-launch-link-external",layerList:"esri-icon-layer-list",layers:"esri-icon-layers",left:"esri-icon-left",leftArrows:"esri-icon-left-arrow",leftTriangleArrow:"esri-icon-left-triangle-arrow",lineOfSight:"esri-icon-line-of-sight",link:"esri-icon-link",linkExternal:"esri-icon-link-external",linkHorizontal:"esri-icon-link-horizontal",loadingIndicator:"esri-icon-loading-indicator",locate:"esri-icon-locate",locateCircled:"esri-icon-locate-circled",locked:"esri-icon-locked",mapPin:"esri-icon-map-pin",maximize:"esri-icon-maximize",measure:"esri-icon-measure",measureArea:"esri-icon-measure-area",measureBuildingHeightShadow:"esri-icon-measure-building-height-shadow",measureLine:"esri-icon-measure-line",menu:"esri-icon-menu",minimize:"esri-icon-minimize",minus:"esri-icon-minus",nonVisible:"esri-icon-non-visible",northNavigation:"esri-icon-north-navigation",noticeTriangle:"esri-icon-notice-triangle",organization:"esri-icon-organization",pan:"esri-icon-pan",pan2:"esri-icon-pan2",partlyCloudy:"esri-icon-partly-cloudy",pause:"esri-icon-pause",play:"esri-icon-play",playCircled:"esri-icon-play-circled",plus:"esri-icon-plus",polyline:"esri-icon-polyline",printer:"esri-icon-printer",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",rightArrow:"esri-icon-right-arrow",rightTriangleArrow:"esri-icon-right-triangle-arrow",rotate:"esri-icon-rotate",save:"esri-icon-save",search:"esri-icon-search",settings2:"esri-icon-settings2",slice:"esri-icon-slice",swap:"esri-icon-swap",table:"esri-icon-table",timeClock:"esri-icon-time-clock",tracking:"esri-icon-tracking",trash:"esri-icon-trash",unlockedLinkHorizontal:"esri-icon-unlocked-link-horizontal",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",vertexGps:"esri-icon-vertex-gps",visible:"esri-icon-visible",zoomInFixed:"esri-icon-zoom-in-fixed",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomOutFixed:"esri-icon-zoom-out-fixed",zoomToObject:"esri-icon-zoom-to-object"},Lpe=new Set;function kxt(t){Lpe.add(t),t.finally(()=>Lpe.delete(t))}var _Re;const zxt="esri.widgets.Widget";let Uxt=0;const jxt={widgetIcon:zc.checkboxUnchecked};function bRe(t,e){for(const i in e)t[i]!=null&&(typeof t[i]=="object"&&typeof e[i]=="object"?bRe(t[i],e?.[i]):t[i]=e[i]);return t}const Bxt=p3t({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,n,s,a)=>{const u=e?.(r,n,s,a),p=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in s)||p){const y=r[2].toLowerCase()+r.slice(3),b=O=>u?.call(s,O);s.addEventListener(y,b,p);const S=()=>s.removeEventListener(y,b,p),C=a.afterRemoved;a.afterRemoved=O=>{C?.(O),S()}}return u}},handleInterceptedEvent(t,e,i,r){const{eventPhase:n,type:s}=r,a=n===Event.CAPTURING_PHASE;let u=`on${s}${a?"capture":""}`;const p=e.properties;(p&&u in p||(u=`on${s[0].toUpperCase()}${s.slice(1)}${a?"Capture":""}`,p&&u in p))&&(Fbe(),t.scheduleRender(),p[u].call(p.bind||i,r))}});let kU=!1,yo=class extends GO(Xn.EventedAccessor){constructor(e,i){super(e,i),this._attached=!1,this._projector=Bxt,this._readyForTrueRender=!1,this.iconClass=jxt.widgetIcon,this.icon=null,this.key=this,this._loadLocale=oE(async()=>{if(this._messageBundleProps?.length){const u=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:p,propertyName:y})=>{if(this.destroyed)return;let b=await HJ(p);this.uiStrings&&Object.keys(this.uiStrings)&&(b=bRe(Ce(b),this.uiStrings)),this[y]=b}));if(this.destroyed)return;for(const p of u)p.status==="rejected"&&Ee.getLogger(this).error("widget-intl:locale-error",this.declaredClass,p.reason)}await this.loadLocale()}),Ixt();const r="esri-widget-uid-"+EY(),n=this.render.bind(this);this._trackingTarget=new TD(()=>this.scheduleRender());const s=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const u=n();let{properties:p}=u;p||(u.properties=p={});const{key:y}=p;if(y||(p.key=r),eD(u.vnodeSelector)){if(!this.visible)return{vnodeSelector:"div",properties:{key:`${r}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}}else this.visible?p.styles||(p.styles={}):(p.class="",p.styles={display:"none"}),p.styles.display||(p.styles.display="");let b=0;return u.children?.forEach(S=>{if(eD(S.vnodeSelector))return;let{properties:C}=S;C||(S.properties=C={}),C.key||(C.key=`${this.id}--${b++}`)}),yRe(this,u)};this.render=()=>{if(kU)return s();let u=lGe(this)??null;if(u)return u;this._trackingTarget.clear(),kU=!0;try{u=wg(this._trackingTarget,s)}catch(p){throw console.error(p),p}finally{kU=!1}return u&&cGe(this,u),u};const a=this.beforeFirstRender();a?this._resourcesFetch=a.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),kxt(this._resourcesFetch)}normalizeCtorArgs(e,i){const r={...e};return i&&(r.container=i),r}postInitialize(){}beforeFirstRender(){const e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(Mte):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(ct(this._trackingTarget),ct(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,kF(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return u7(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+Uxt++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(_Re=mRe,gRe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(kF(this),this._projector.scheduleRender())}own(e){f0e(Ee.getLogger(this.declaredClass),"`Widget.own()` is deprecated in favor of Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(e)}classes(...e){return hGe.apply(this,e)}renderNow(){kF(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles(Fe(()=>this.viewModel,(i,r)=>{r&&this.removeHandles("delegated-events"),i&&wD(i)&&this.addHandles(this._delegatedEventNames.map(n=>lg(i,n,s=>{this.emit(n,s)})),"delegated-events")},Ur)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(Mte),this.scheduleRender()};this.addHandles([BJ(e),Fe(()=>this.uiStrings,e),Qu(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};yo[_Re]=!0,_([T()],yo.prototype,"_readyForTrueRender",void 0),_([T({value:null})],yo.prototype,"container",null),_([Fi("container")],yo.prototype,"castContainer",null),_([T()],yo.prototype,"iconClass",void 0),_([T()],yo.prototype,"icon",void 0),_([T()],yo.prototype,"id",null),_([T()],yo.prototype,"label",null),_([T()],yo.prototype,"renderable",null),_([T()],yo.prototype,"uiStrings",void 0),_([T()],yo.prototype,"viewModel",void 0),_([T({value:!0})],yo.prototype,"visible",null),_([T()],yo.prototype,"key",void 0),_([T()],yo.prototype,"children",void 0),_([T()],yo.prototype,"afterCreate",void 0),_([T()],yo.prototype,"afterUpdate",void 0),_([T()],yo.prototype,"afterRemoved",void 0),yo=_([Z(zxt)],yo);const Yg=yo;function Dpe(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function Vxt(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function j9(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function Gxt(t){return t.type==="bing-maps"}const L1=[];let Vx=class extends Ke{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Dt,this.view=null,this._allLayerViewsChange=i=>{this.removeHandles("suspension");const r=this.view?.allLayerViews;r&&this.addHandles(r.map(n=>Fe(()=>[n.suspended,n.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension"),i?.removed&&i.removed.forEach(n=>{this._pendingAttributions.delete(n),this._fetchedAttributionData.delete(n)}),this._updateAttributionItems()},this.addHandles([ga(()=>this.view?.allLayerViews,"change",i=>this._allLayerViewsChange(i),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Qu(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.view?.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,i=e?.allLayerViews;L1.length=0,e&&i?(i.forEach(r=>{if(r.suspended||!r.layer?.attributionVisible)return;const n=r.layer;if(Dpe(n,"user"))return void j9(L1,r,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(r)){const a=this._fetchedAttributionData.get(r);return void(a?j9(L1,r,this._getDynamicAttribution(a,e,n)):Dpe(n)&&j9(L1,r,n.copyright))}return void this._fetchAttributionData(r)}const s="portalItem"in n?n.portalItem?.accessInformation:void 0;j9(L1,r,s||n.copyright)}),Vxt(this.items,L1)&&(this.items.removeAll(),this.items.addMany(L1)),L1.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const i=await Gc(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=i.ok?this._createContributionIndex(i.value,Gxt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,i){const r=e.contributors,n={};if(!r)return n;for(let s=0;s<r.length;s++){const a=r[s],u=a.coverageAreas;if(!u)return;for(const p of u){const y=p.bbox,b=p.zoomMin-(i&&p.zoomMin?1:0),S=p.zoomMax-(i&&p.zoomMax?1:0),C=new rr({xmin:y[1],ymin:y[0],xmax:y[3],ymax:y[2],spatialReference:dt.WGS84}),O={extent:Xy(C),attribution:a.attribution||"",score:p.score!=null?p.score:100,id:s};for(let P=b;P<=S;P++)n[P]??(n[P]=[]),n[P].push(O)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(e,i,r){const{extent:n,scale:s}=i;let a=r.tileInfo?.scaleToZoom(s)??0;if(a=Math.min(e.maxKey??0,Math.round(a)),!n||a==null||a<=-1)return"";const u=e[a],p=HO(n.center.clone().normalize(),i.spatialReference),y=new Set;return u?u.filter(b=>{const S=b.id,C=!y.has(S)&&p&&b.extent&&jJ(b.extent,p);return C&&y.add(S),C}).sort((b,S)=>S.score-b.score||b.objectId-S.objectId).map(b=>b.attribution).join(", "):""}};_([T({readOnly:!0,type:Dt})],Vx.prototype,"items",void 0),_([T({readOnly:!0})],Vx.prototype,"state",null),_([T()],Vx.prototype,"view",void 0),Vx=_([Z("esri.widgets.Attribution.AttributionViewModel")],Vx);const wRe=Vx,vl={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",disabledElement:"esri-disabled-element",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",noBookmarksIcon:"esri-widget__no-bookmark-icon",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function LN(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:qxt(t[e])}}}function Hxt(t){const e=t?.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function qxt(t){return function(e,...i){Hxt(e)?gGe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}function kw(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var Wxt=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},xRe=function(t,e){for(var i=0,r=t.length;i<r;i++){var n=t[i];Array.isArray(n)?xRe(n,e):n!=null&&n!==!1&&(n.hasOwnProperty("vnodeSelector")||(n=Wxt(n)),e.push(n))}},Xxt=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var n=[];return xRe(i,n),{vnodeSelector:t,properties:e||void 0,children:n,text:void 0,domNode:null}};function Li(t,e,...i){return typeof t!="function"||eD(t)?Xxt(t,e,...i):t(e,...i)}function YVt(...t){return t}const Z3="esri-attribution",R_={base:Z3,poweredBy:`${Z3}__powered-by`,sources:`${Z3}__sources`,open:`${Z3}--open`,sourcesOpen:`${Z3}__sources--open`,link:`${Z3}__link`,widgetIcon:zc.description};let nl=class extends Yg{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:n})=>this._checkSourceTextOverflow(n))),this.iconClass=R_.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new wRe}initialize(){this.addHandles(ga(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[R_.open]:this._isOpen};return Li("div",{bind:this,class:this.classes(R_.base,vl.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return Li("div",{class:R_.poweredBy},"Powered by"," ",Li("a",{class:R_.link,href:"http://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?0:void 0,{attributionText:n}=this,s={[R_.sourcesOpen]:e,[vl.interactive]:i};return Li("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(R_.sources,s),innerHTML:n,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:n,scrollWidth:s}=e,a=s>n,u=this._attributionTextOverflowed!==a;if(this._attributionTextOverflowed=a,u&&(i=!0),this._isOpen){const p=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,p&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};_([T()],nl.prototype,"_isOpen",void 0),_([T()],nl.prototype,"_isInteractive",null),_([T()],nl.prototype,"_attributionTextOverflowed",void 0),_([T()],nl.prototype,"_prevSourceNodeHeight",void 0),_([T({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],nl.prototype,"attributionText",null),_([T()],nl.prototype,"iconClass",void 0),_([T()],nl.prototype,"icon",void 0),_([T()],nl.prototype,"itemDelimiter",void 0),_([T()],nl.prototype,"label",null),_([T(),kw("esri/widgets/Attribution/t9n/Attribution")],nl.prototype,"messages",void 0),_([T()],nl.prototype,"view",null),_([T({type:wRe})],nl.prototype,"viewModel",void 0),_([LN()],nl.prototype,"_toggleState",null),nl=_([Z("esri.widgets.Attribution")],nl);const Jxt=nl;function Yxt(t){return t?.spatialReference?.isWebMercator||t?.spatialReference?.isGeographic||!1}const Zxt=t=>{let e=class extends t{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return _D(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return _([T()],e.prototype,"goToOverride",void 0),_([T()],e.prototype,"view",void 0),e=_([Z("esri.widgets.support.GoTo")],e),e},Kxt="esri.widgets.CompassViewModel";let bb=class extends Zxt(Ke){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(Fe(()=>this.view,this._updateRotationWatcher,jr))}destroy(){this.view=null}get canShowNorth(){return Yxt(this.view)}get state(){return!this.view?.ready||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){if(!this.view?.ready)return;const e={};this.view?.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this.orientation={x:0,y:0,z:i}}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?Fe(()=>e?.rotation,this._updateForRotation,jr):Fe(()=>e?.camera,this._updateForCamera,jr))}};_([T({readOnly:!0})],bb.prototype,"canShowNorth",null),_([T()],bb.prototype,"orientation",void 0),_([T({readOnly:!0})],bb.prototype,"state",null),_([T()],bb.prototype,"view",void 0),bb=_([Z(Kxt)],bb);const TRe=bb,Npe="esri-compass",zU={base:Npe,widgetIcon:zc.locateCircled,iconContainer:`${Npe}__icon-container`};let Bf=class extends Yg{constructor(e,i){super(e,i),this.iconClass=zU.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new TRe,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=r=>({transform:`rotateZ(${r.z}deg)`})}loadDependencies(){return $xt({button:()=>ke(()=>import("./calcite-button-496ae14c.js"),[],import.meta.url),icon:()=>ke(()=>import("./calcite-icon-56a3b357.js"),[],import.meta.url)})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,r=i==="rotation"?"arrow-up":"compass-needle",{messages:n}=this;return Li("div",{class:this.classes(zU.base,vl.widget)},Li("calcite-button",{"aria-label":n.reset,class:vl.widgetButton,disabled:i==="disabled",kind:"neutral",onclick:this._reset,round:!0,scale:"s",title:n.reset},Li("div",{"aria-hidden":"true",class:zU.iconContainer,title:n.reset},Li("calcite-icon",{icon:r,scale:"m",styles:this._toRotationTransform(e)}))))}};_([T()],Bf.prototype,"goToOverride",null),_([T()],Bf.prototype,"iconClass",void 0),_([T()],Bf.prototype,"icon",void 0),_([T()],Bf.prototype,"label",null),_([T(),kw("esri/widgets/Compass/t9n/Compass")],Bf.prototype,"messages",void 0),_([T()],Bf.prototype,"view",null),_([T({type:TRe})],Bf.prototype,"viewModel",void 0),Bf=_([Z("esri.widgets.Compass")],Bf);const Qxt=Bf,K3="esri-navigation-toggle",dm={base:K3,widgetIcon:zc.pan2,button:`${K3}__button`,activeButton:`${K3}__button--active`,panButton:`${K3}__button--pan`,rotateButton:`${K3}__button--rotate`,isLayoutHorizontal:`${K3}--horizontal`};let Gx=class extends Ke{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.addHandles(Qu(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.view?.ready&&this.view?.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){const e=this.view?.inputManager;e&&(e.primaryDragAction=this.navigationMode==="pan"?"pan":"rotate")}};_([T({readOnly:!0})],Gx.prototype,"state",null),_([T()],Gx.prototype,"navigationMode",void 0),_([T()],Gx.prototype,"view",void 0),Gx=_([Z("esri.widgets.NavigationToggleViewModel")],Gx);const SRe=Gx;let Xd=class extends Yg{constructor(e,i){super(e,i),this.iconClass=dm.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new SRe}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.viewModel?.state==="disabled",i=this.viewModel?.navigationMode==="pan",r={[vl.disabled]:e,[dm.isLayoutHorizontal]:this.layout==="horizontal"},n={[dm.activeButton]:i},s={[dm.activeButton]:!i},a=e?-1:0,u=this.messages.toggle;return Li("div",{"aria-label":u,bind:this,class:this.classes(dm.base,vl.widget,r),onclick:this._toggle,onkeydown:this._toggle,tabIndex:a,title:u},Li("div",{class:this.classes(dm.button,vl.widgetButton,dm.panButton,n)},Li("span",{class:zc.pan})),Li("div",{class:this.classes(dm.button,vl.widgetButton,dm.rotateButton,s)},Li("span",{class:zc.rotate})))}_toggle(){this.toggle()}};_([T()],Xd.prototype,"iconClass",void 0),_([T()],Xd.prototype,"icon",void 0),_([T()],Xd.prototype,"label",null),_([T({value:"vertical"})],Xd.prototype,"layout",null),_([T(),kw("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Xd.prototype,"messages",void 0),_([T()],Xd.prototype,"view",null),_([T({type:SRe})],Xd.prototype,"viewModel",void 0),_([LN()],Xd.prototype,"_toggle",null),Xd=_([Z("esri.widgets.NavigationToggle")],Xd);const eTt=Xd,ta="esri-feature",tTt={base:ta,container:`${ta}__size-container`,title:`${ta}__title`,main:`${ta}__main-container`,btn:`${ta}__button`,icon:`${ta}__icon`,content:`${ta}__content`,contentNode:`${ta}__content-node`,contentNodeText:`${ta}__content-node--text`,contentElement:`${ta}__content-element`,text:`${ta}__text`,lastEditedInfo:`${ta}__last-edited-info`,fields:`${ta}__fields`,fieldHeader:`${ta}__field-header`,fieldData:`${ta}__field-data`,fieldDataDate:`${ta}__field-data--date`,loadingSpinnerContainer:`${ta}__loading-container`,spinner:`${ta}__loading-spinner`};let Pm=class extends Yg{constructor(){super(...arguments),this.enabled=!0,this.iconClass=null,this.icon=null,this.title=""}render(){const e=this.enabled?0:-1,i={[vl.disabled]:!this.enabled,[vl.interactive]:this.enabled};return Li("div",{bind:this,class:this.classes(vl.widgetButton,vl.widget,i),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},Li("span",{"aria-hidden":"true",class:this.classes(tTt.icon,this.iconClass??""),role:"presentation"}),Li("span",{class:zc.fontFallbackText},this.title))}_triggerAction(){this.action.call(this)}};_([T()],Pm.prototype,"action",void 0),_([T()],Pm.prototype,"enabled",void 0),_([T()],Pm.prototype,"iconClass",void 0),_([T()],Pm.prototype,"icon",void 0),_([T()],Pm.prototype,"title",void 0),_([LN()],Pm.prototype,"_triggerAction",null),Pm=_([Z("esri.widgets.IconButton")],Pm);const Fpe=Pm;let wb=class extends Ke{get canZoomIn(){if(!this.view?.ready)return!1;const i=this.view?.constraints?.effectiveMaxScale;return i===0||this._scale>i}get canZoomOut(){const{view:e}=this;if(!e?.ready)return!1;const r=e.constraints?.effectiveMinScale;return r===0||this._scale<r}get _scale(){const e=this.view?.animation?.target;return(e&&"then"in e?void 0:e?.scale)??this.view?.scale??0}};_([T({readOnly:!0})],wb.prototype,"canZoomIn",null),_([T({readOnly:!0})],wb.prototype,"canZoomOut",null),_([T()],wb.prototype,"view",void 0),_([T()],wb.prototype,"_scale",null),wb=_([Z("esri.widgets.Zoom.ZoomConditions2D")],wb);const iTt=wb;let Hx=class extends Ke{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};_([T({readOnly:!0})],Hx.prototype,"canZoomIn",null),_([T({readOnly:!0})],Hx.prototype,"canZoomOut",null),_([T()],Hx.prototype,"view",void 0),Hx=_([Z("esri.widgets.Zoom.ZoomConditions3D")],Hx);const rTt=Hx;let ay=class extends Ke{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new iTt({view:e}):e.type==="3d"&&(this._zoomConditions=new rTt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():O4(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():O4(e.goTo({zoomFactor:.5}))}};_([T()],ay.prototype,"_zoomConditions",void 0),_([T()],ay.prototype,"canZoomIn",null),_([T()],ay.prototype,"canZoomOut",null),_([T({readOnly:!0})],ay.prototype,"state",null),_([T()],ay.prototype,"view",null),ay=_([Z("esri.widgets.Zoom.ZoomViewModel")],ay);const ERe=ay,UU={base:"esri-zoom",widgetIcon:zc.zoomInMagnifyingGlass,horizontalLayout:"esri-zoom--horizontal"};let Vf=class extends Yg{constructor(e,i){super(e,i),this.iconClass=UU.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new ERe}initialize(){this._zoomInButton=new Fpe({action:this.zoomIn.bind(this),iconClass:zc.plus}),this._zoomOutButton=new Fpe({action:this.zoomOut.bind(this),iconClass:zc.minus})}destroy(){this._zoomInButton=ct(this._zoomInButton),this._zoomOutButton=ct(this._zoomOutButton)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,i={[UU.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:r,canZoomOut:n}=e;this._zoomInButton.enabled=r,this._zoomOutButton.enabled=n;const{zoomIn:s,zoomOut:a}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=a,Li("div",{class:this.classes(UU.base,vl.widget,i)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};_([T()],Vf.prototype,"iconClass",void 0),_([T()],Vf.prototype,"icon",void 0),_([T()],Vf.prototype,"label",null),_([T({value:"vertical"})],Vf.prototype,"layout",null),_([T(),kw("esri/widgets/Zoom/t9n/Zoom")],Vf.prototype,"messages",void 0),_([T()],Vf.prototype,"view",null),_([T({type:ERe})],Vf.prototype,"viewModel",void 0),Vf=_([Z("esri.widgets.Zoom")],Vf);const nTt=Vf;function sTt(t){return t?.view!==void 0}let t6=class extends a3t{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=i=>{this.components.forEach(r=>{const n=this._find(r),s=n?.widget;sTt(s)&&(s.view=i)})},this._componentsWatcher=(i,r)=>{this._removeComponents(r),this._addComponents(i),this._adjustPadding(i)}}initialize(){this.addHandles([Fe(()=>this.components,this._componentsWatcher,jr),Fe(()=>this.view,this._updateViewAwareWidgets,jr)])}_add(e,i,r,n,s){let a=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;a=this._createComponent(e)}super._add(a,i,r,n,s)}_removeComponents(e){e.forEach(i=>{const r=this._find(i);r&&(this.remove(r),r.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:i}=this.padding;this.padding=i}}_addComponents(e){this.constructed&&e.forEach(i=>this.add(this._createComponent(i),this._defaultPositionLookup[i]))}_createComponent(e){const i=this._createWidget(e);return new Q$({id:e,node:i})}_createWidget(e){const{view:i}=this;switch(e){case"attribution":return new Jxt({view:i});case"compass":return new Qxt({view:i});case"navigation-toggle":return new eTt({view:i});case"zoom":return new nTt({view:i})}}};_([T()],t6.prototype,"components",void 0),t6=_([Z("esri.views.ui.DefaultUI")],t6);const CRe=t6;let i6=class extends CRe{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};_([T()],i6.prototype,"components",void 0),i6=_([Z("esri.views.ui.3d.DefaultUI3D")],i6);const ARe=i6;let At=class extends mVe(Kqe(PGe(yWe))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new Mg({slicePlane:cbe},this),this._resourceController=nmt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new uq({view:this}),this.labeler=new pb({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new PS,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new Gb,this.environmentManager=new kd,this.floors=new Dt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new bWe({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new O0t,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new ARe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new vAe,Hje(),t?.environment||(this._defaults.environment=new Sx,this.environment=this._defaults.environment);const e=(i=null)=>{i!=null&&i.type===Hr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.addHandles([ga(()=>this.map?.allLayers,"after-changes",i=>e(i),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),Fe(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new ytt({view:this}),this.stateManager=new Ns({view:this})}initialize(){this.groundView=new Uqe({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(ga(()=>this.map?.allLayers,"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},jr),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},jr),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>H9e(e>0?1e3/Math.ceil(e):0),jr),this.updatingHandles.add(()=>this.map?.ground,t,Ur),this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),Ur),this.addHandles(Fe(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),$r))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=ct(this.sharedSymbolResources),this._set("labeler",ct(this.labeler)),this._set("deconflictor",ct(this.deconflictor)),this._resourceController=ct(this._resourceController),this._set("stateManager",ct(this.stateManager)),this._set("inputManager",ct(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",ct(this.environmentManager)),this._set("environment",ct(this.environment)),this.groundView=ct(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){return this.stateManager?.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;const t=this.map;let e=this._userClippingArea||wte(t,"clippingArea");return!this._userClippingArea&&!wte(t,"clippingEnabled")||e==null?(this._clippingArea=null,null):e instanceof rr?this.spatialReference&&(e=B9(e,this.spatialReference),e==null)?(Ee.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),e.intersection(this._groundAndLayersExtent)==null&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(Ee.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?Ee.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===ht.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:B9(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||dt.WGS84,i=B9(this.clippingArea,e);i!=null&&(t=t!=null?t.intersection(i):i);const r=this._get("dataExtent");return t!=null&&t.equals(r)?r:t}get _groundAndLayersExtent(){const t=this.spatialReference||dt.WGS84;let e;const i=s=>{const a=B9(s,t);a!=null&&(e!=null?e.union(a):e=a.clone())},r=this.basemapTerrain;if(r?.spatialReference){const s=r.groundExtent;i(new rr({xmin:s[0],ymin:s[1],zmin:0,xmax:s[2],ymax:s[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const s=a=>{a.fullExtent==null||a.type==="graphics"&&a.internal||i(a.fullExtent)};this.map.allLayers.forEach(a=>s(a))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const n=this._get("_groundAndLayersExtent");return e.equals(n)?n:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof Sx?t:t instanceof wS?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):Sx.fromWebsceneEnvironment(t):os(Sx,t):new Sx}get extent(){return this.stateManager?.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){z$.isValidProfile(t)&&(z$.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||z$.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");Aw(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?cVe(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?$v.deriveUnitFromSR(t,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,i=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(n=>{if(n.isFulfilled()){if(n.updating){if(e=!0,n.suspended||TO(n))return;++i,t+=n.updatingProgress}}else++i});for(const n of this._updatingObjects)n!=null&&n.updating&&(i+=.1,t+=.5*.1);for(const n of this._updatingObjectsWithProgress)n!=null&&n.updating&&(++i,t+=n.updatingProgress);const r=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(n=>!n.isFulfilled())||this.textures?.updating),e?(this._numUpdating=Math.max(i,this._numUpdating),t+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const n=performance.now();if(t<1){const s=Math.min((n-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-s)+t*s}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?n:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){const t=this._predeterminedViewingMode;if(t!=null)return fF(t);const e=this.spatialReference;return e?this.defaultsFromMap?.viewingMode!=null&&e.equals(this.defaultsFromMap.spatialReference)?fF(this.defaultsFromMap.viewingMode):B4(e,ht.Global)?"global":"local":"global"}set viewingMode(t){this.ready?Ee.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new Pmt(this)}on(t,e,i,r){return this.viewEvents.on(t,e,i,r)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return Ee.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,r=i.graphics!=null&&(i.graphics.include!=null||i.graphics.exclude!=null),n=Yne(t)?Jne(this,t):t,s=pp(n);i.enableDraped=i.include&&!i.include.has(Ey)||i.exclude&&i.exclude.has(Ey);const a=this.sceneIntersectionHelper,u=ad(this.state.viewingMode);if(u.options.selectionMode=!0,u.options.store=r?Jo.ALL:Jo.MIN,a.intersectIntersectorScreen(s,u,i),r){for(const p of u.results.all){const y=yW(p,this);if(y==null)return this._intersectResultToMapPoint(p);if(y.type!=="graphic"||this._testGraphicUidFilter(i.graphics,y.graphic))return this._intersectResultToMapPoint(p)}return null}return this._intersectResultToMapPoint(u.results.min)}toScreen(t){if(!this.ready)return Ee.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?a0(this.elevationProvider,t):null)??0;return Wc(t,Q3,this.renderSpatialReference,e),this.state.camera.projectToScreen(Q3,jU),td(jU[0],jU[1])}pixelSizeAt(t){return this.ready?t?(Wc(t,Q3,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(Q3)):0:(Ee.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t,()=>this.pixelSizeAt(t)):1}hitTest(t,e){if(!this.ready)return Ee.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=Yne(t)?Jne(this,t):t,r=Dn(i.x,i.y),n=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;n.requiresGroundFeedback=!0,n.enableDraped=!0;const s=ad(this.state.viewingMode);s.options.selectionMode=!0,s.options.store=Jo.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,s,n);const a=this._intersectResultsToHits(s.results.all,n.graphics),u=s.results.ground,p=gpe(u,this),y=p!=null&&"type"in p&&p.type==="integrated-mesh"?p:null,b={screenPoint:i,results:a,ground:{mapPoint:this._intersectResultToMapPoint(u),distance:Hp(u)?u.distanceInRenderSpace:0,layer:y}};return Xr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(b.intersector=s),Promise.resolve(b)}async popupHitTest(t){const{results:e,ground:i}=await jwt(this,t);let r=null;return!(e.length===0||Math.abs((e[0].distance??0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:e,screenPoint:t,mapPoint:r}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new de("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return PU(i,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return IU(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e);return[IU(i[0],this._pixelFormat()),IU(i[1],this._pixelFormat())]}_completeSettings(t){const e=bwt(t,this);return e.pixelRatio/=this.state.pixelRatio,Swt(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!Me("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e),r=PU(i[0],e,this._pixelFormat()),n=this._completeSettings(t);return n.format="png",[r,PU(i[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return rse.importLayerView(t)}hasLayerViewModule(t){return rse.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let t=Zwt(this.type);const e=Me("safari");if(e&&e<9&&(t=new de("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw Ee.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return t!=null?zie(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const i=this._predeterminedViewingMode;if(i!=null)return this._validateSpatialReferenceForViewingMode(t,e,i)?{constraints:this._makeSpatialReferenceConstraints(t,e,i)}:null;const r=this._validateSpatialReferenceForViewingMode(t,e,ht.Local),n=this._validateSpatialReferenceForViewingMode(t,e,ht.Global);return r||n?r&&n?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(t,e,ht.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,ht.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,i){return!!B4(t,i)&&(e==null||!!hie(e)||(!MA(e)||EN(e,t,i)!=null)&&(!uie(e)||i!==ht.Global))}_makeSpatialReferenceConstraints(t,e,i){if(e==null)return[{spatialReference:t,viewingMode:i}];const r=t.isWebMercator,n=t.isWGS84;return hie(e)&&(r||n)?!n||i===ht.Local||hee(e.tileInfo,e.fullExtent,t,ht.Global)===null?[{spatialReference:t,viewingMode:i},{spatialReference:dt.WebMercator,viewingMode:i}]:[{spatialReference:r?dt.WGS84:dt.WebMercator,viewingMode:i}]:MA(e)||uie(e)||!r&&!n?MA(e)&&r&&i!==ht.Global?[{spatialReference:t,viewingMode:i},{spatialReference:dt.WGS84,viewingMode:ht.Local}]:[{spatialReference:t,viewingMode:i}]:[{spatialReference:t,viewingMode:i},{spatialReference:r?dt.WGS84:dt.WebMercator,viewingMode:i}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport({spatialReference:t})!=null,i=this._predeterminedViewingMode;return e||(i!=null?Ee.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${fF(i)} viewing mode.`):t.isGeographic&&Ee.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let i=this.spatialReference||dt.WGS84;return va(t,this.renderSpatialReference,t,i)||(i=dt.WGS84,va(t,this.renderSpatialReference,t,i)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=i):e=new Wt(t,i),e}trackGraphicState(t){if(!t.graphic)return Ee.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let i=null,r=!1;const n=s=>{!r&&s!=null&&"processor"in s&&s.processor?.type==="graphics-3d"&&s.processor.graphicsCore&&(i=s.processor.graphicsCore.trackGraphicState(t))};return e!=null?n(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),Sr(()=>{r=!0,i!=null&&(i.remove(),i=null)})}highlight(t){if(Array.isArray(t))return nv(t.map(i=>this.highlight(i)));if(Dt.isCollection(t))return nv(t.toArray().map(i=>this.highlight(i)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):Sr()}maskOccludee(t){if(!t)return Ee.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let i=null,r=!1;const n=s=>{!r&&s!=null&&Vwt(s)&&(i=s.maskOccludee(t))};return e!=null?n(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),Sr(()=>{r=!0,i!=null&&(i.remove(),i=null)})}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await gS(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new de("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((i,r)=>{const n=this.map.allLayers.on("change",s=>{s.added.includes(t.layer)&&(n.remove(),this.whenLayerView(t.layer).then(i,r))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,x4.INCLUDE),i=this._externalToInternalRenderItems(t.exclude,x4.EXCLUDE);return{include:e.layerUids,exclude:i.layerUids,graphics:{include:e.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(Q3)?(e=this.computeMapPointFromVec3d(Q3,e),t.intersector===En.TERRAIN&&this.basemapTerrain&&(e.z=a0(this.basemapTerrain,e)??0),e):null}_intersectResultsToHits(t,e){const i=new Array;let r=null;for(let n=0;n<t.length;n++){const s=t[n],a=gpe(s,this);if(a!=null&&(a===this.map.ground||"type"in a&&a.type==="integrated-mesh"))break;const u=yW(s,this);if(u==null)continue;if(u.type==="graphic"){if(r==null&&n!==t.length-1&&(r=new Set),r!=null){const b=this._getGraphicFilterUid(u.graphic);if(r.has(b))continue;r.add(b)}if(!this._testGraphicUidFilter(e,u.graphic))continue}const p=this._intersectResultToMapPoint(s),y=s.distanceInRenderSpace;if(u.type==="media"){const b=u.element.toSource(p);i.push({...u,mapPoint:p,distance:y,sourcePoint:b})}else i.push({...u,mapPoint:p,distance:y})}return i}_getGraphicFilterUid(t){const e=t.sourceLayer,i=t.layer,r=e&&"objectIdField"in e?e:i&&"objectIdField"in i?i:e;if(r){const n=r.objectIdField??pVe,s=t.attributes?.[n];if(s)return`o-${r.id}-${s}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const i=this._getGraphicFilterUid(e);return t==null||(t.include==null||t.include.has(i))&&(t.exclude==null||!t.exclude.has(i))}_externalToInternalRenderItems(t,e,i={layerUids:void 0,graphicUids:void 0}){if(!t)return i;if(t instanceof Fp)oTt(i,this._getGraphicFilterUid(t)),e===x4.INCLUDE&&(this.graphicsView!=null&&t.layer===this?kC(i,this.graphicsView.processor.layer.id):t.layer&&kC(i,t.layer.uid));else if(fj(t))for(const r of t)r===this.graphics&&this.graphicsView!=null?kC(i,this.graphicsView.processor.layer.id):r===this.map.ground?kC(i,Ey):this._externalToInternalRenderItems(r,e,i);else"uid"in t&&kC(i,t.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new fvt({view:this})),this._set("elevationProvider",new eA({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new jl({view:this})),this._set("featureTiles",new Bo({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{const e=this.basemapTerrain?.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?F0(BD(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>Xr.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(ke(()=>import("./FeatureTileTree3DDebugger-bd6c1349.js"),["./FeatureTileTree3DDebugger-bd6c1349.js","./TileTreeDebugger-7859146b.js"],import.meta.url)).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&Xr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||!this._featureTreeDebugger||Xr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Ur),this.updatingHandles.add(()=>this.clippingArea,t,Ur),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Ur)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new z0t(this.map,t));const e=this.state.isGlobal,i=lVe(e,t);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",V0t.create(this.state.viewingMode,i)),e||this.addHandles(Fe(()=>this.basemapTerrain?.extent,r=>{const n=this.renderCoordsHelper.spatialReference;r==null||r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!h7(r,this.basemapTerrain.spatialReference,kpe,n)||(this.renderCoordsHelper.extent=kpe)},$r),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(LS/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===Hr.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(Fe(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),$r),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e,i){if(!this.overlay||!this.overlay.hasVisibleItems)return i;const r=t.getContext("2d");return r.putImageData(i,0,0),this.overlay.renderCanvas(t,{disableDecorations:e===kc.OFF}),r.getImageData(0,0,i.width,i.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(r,n,s)=>this._renderScreenshotOverlay(r,n,s)}},e=new R0t(this.state.viewingMode,r=>this._stage.layers.forAll(r),this);this._set("sceneIntersectionHelper",e);const i=u7(this.surface);this._stage=new mu({view:this,options:t,container:i}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,r=>this._stage.renderer.setParameters({highQualityTransparency:r}),jr),Fe(()=>this.magnifier,r=>this._stage.renderView.magnifier=r,Ur),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),lg(this._stage.renderView.canvas,"webglcontextlost",r=>this.fatalError=new de("webgl-context-lost",r.statusMessage))],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(LS/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=ct(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Lmt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await ke(()=>import("./GraphicsView3D-30b49672.js"),["./GraphicsView3D-30b49672.js","./GraphicsProcessor-fc9ef2b4.js","./Graphics3DObjectStates-c0ae2c22.js","./optimizedFeatureQueryEngineAdapter-66ec8a44.js","./PooledRBush-46c240a2.js","./quickselect-4a5a9977.js","./popupUtils-424614c6.js"],import.meta.url)).default;oi(t),await gS(()=>this.basemapTerrain?.ready,t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=zie(this.viewingMode);if(t===ht.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(ga(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const{map:i}=this,r=i&&"initialViewProperties"in i?i.initialViewProperties?.environment:void 0;r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new ST(this._stage,this.resourceController.scheduler));const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",ct(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Ey);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Ey);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}};function kC(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function oTt(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function B9(t,e){return t!=null&&$p(t.spatialReference,e)?F0(t,e):null}var x4;At.type="3d",_([T()],At.prototype,"_userClippingArea",void 0),_([T()],At.prototype,"_resourceController",void 0),_([T()],At.prototype,"_stage",void 0),_([T({readOnly:!0})],At.prototype,"deconflictor",void 0),_([T({readOnly:!0})],At.prototype,"labeler",void 0),_([T(hG(PS,"analyses"))],At.prototype,"analyses",void 0),_([T({type:NS,readOnly:!0})],At.prototype,"animation",null),_([T({readOnly:!0})],At.prototype,"basemapTerrain",void 0),_([T({readOnly:!0})],At.prototype,"elevationProvider",void 0),_([T()],At.prototype,"camera",null),_([T({type:Ku})],At.prototype,"contentCamera",null),_([T({readOnly:!0})],At.prototype,"canvas",void 0),_([T({type:Wt})],At.prototype,"center",null),_([T({type:rr})],At.prototype,"clippingArea",null),_([T({type:Gb})],At.prototype,"constraints",void 0),_([T({type:rr,readOnly:!0})],At.prototype,"renderDataExtent",null),_([T({type:rr,readOnly:!0})],At.prototype,"dataExtent",null),_([T({type:rr,readOnly:!0})],At.prototype,"_groundAndLayersExtent",null),_([T({value:null,type:Sx})],At.prototype,"environment",null),_([Fi("environment")],At.prototype,"castEnvironment",null),_([T({readOnly:!0})],At.prototype,"environmentManager",void 0),_([T({type:rr})],At.prototype,"extent",null),_([T()],At.prototype,"floors",void 0),_([T()],At.prototype,"screenCenter",null),_([T()],At.prototype,"frustum",null),_([T({type:Number,readOnly:!0})],At.prototype,"fullOpacity",void 0),_([T({readOnly:!0})],At.prototype,"graphicsView",void 0),_([T({readOnly:!0})],At.prototype,"analysisViewManager",void 0),_([T()],At.prototype,"groundView",void 0),_([T({type:Boolean})],At.prototype,"initialExtentRequired",null),_([T()],At.prototype,"_defaultsFromMapSettings",null),_([T()],At.prototype,"interacting",null),_([T()],At.prototype,"stationary",null),_([T()],At.prototype,"navigating",null),_([T()],At.prototype,"map",void 0),_([T({readOnly:!0})],At.prototype,"mapCoordsHelper",void 0),_([T()],At.prototype,"padding",null),_([T({type:jl,readOnly:!0})],At.prototype,"pointsOfInterest",void 0),_([T({type:Bo,readOnly:!0})],At.prototype,"featureTiles",void 0),_([T()],At.prototype,"_featureTreeDebugger",void 0),_([T({type:Boolean})],At.prototype,"screenSizePerspectiveEnabled",void 0),_([T({constructOnly:!0})],At.prototype,"deactivatedWebGLExtensions",void 0),_([T({constructOnly:!0})],At.prototype,"debugWebGLExtensions",void 0),_([T({constructOnly:!0})],At.prototype,"renderCanvas",void 0),_([T({constructOnly:!0})],At.prototype,"state",void 0),_([T({readOnly:!0})],At.prototype,"inputManager",void 0),_([T({readOnly:!0})],At.prototype,"stateManager",void 0),_([T({type:["low","medium","high"]})],At.prototype,"qualityProfile",null),_([T({type:aue,get(){let t=this._get("qualitySettings");return t||(t=new aue,z$.apply(this.qualityProfile,t)),t}})],At.prototype,"qualitySettings",void 0),_([T()],At.prototype,"slicePlane",null),_([T({readOnly:!0})],At.prototype,"typeSpecificPreconditionsReady",null),_([T({readOnly:!0})],At.prototype,"renderCoordsHelper",void 0),_([T({readOnly:!0})],At.prototype,"sceneIntersectionHelper",void 0),_([T({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],At.prototype,"resolution",null),_([T({type:Number})],At.prototype,"scale",null),_([T()],At.prototype,"heightModelInfo",null),_([T()],At.prototype,"spatialReference",void 0),_([T({type:Boolean,constructOnly:!0})],At.prototype,"alphaCompositingEnabled",void 0),_([T({constructOnly:!0})],At.prototype,"preserveDrawingBufferEnabled",void 0),_([T({type:Boolean})],At.prototype,"supersampleScreenshotsEnabled",void 0),_([T({readOnly:!0})],At.prototype,"type",void 0),_([T(),Fi(t=>t instanceof CRe?t:L2(ARe,t))],At.prototype,"ui",void 0),_([T({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],At.prototype,"updating",null),_([T()],At.prototype,"_updatingObjects",null),_([T()],At.prototype,"_updatingObjectsWithProgress",null),_([T({type:Number,readOnly:!0,dependsOn:["updating"]})],At.prototype,"updatingProgress",void 0),_([T({type:["global","local"]})],At.prototype,"viewingMode",null),_([T({type:qc})],At.prototype,"viewpoint",null),_([T({type:Number})],At.prototype,"zoom",null),_([T({type:vAe})],At.prototype,"highlightOptions",void 0),_([T({readOnly:!0})],At.prototype,"quality",null),_([T({readOnly:!0})],At.prototype,"resolutionScale",null),_([T()],At.prototype,"textures",void 0),At=_([Z("esri.views.SceneView")],At),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(x4||(x4={}));const Q3=H(),jU=Dn(),kpe=Di(),aTt=At;function lTt(t){return t&&typeof t.render=="function"}function cGt(t){return t&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}let Im=class extends Ke{constructor(e){super(e),this._vendorInfo=null,this._fullscreenStyle="width: 100%; height: 100%;",this.view=null,this._errorHandler=this._errorHandler.bind(this),this._stateHandler=this._stateHandler.bind(this)}destroy(){this._removeFullscreenListeners(),this.view=null}get element(){return this.view?.container??null}set element(e){this._override("element",e)}get state(){return this.element?this._isSupported()?this._isActive()?"active":"ready":"feature-unsupported":"disabled"}enter(){this._enterFullscreen()}exit(){this._exitFullscreen()}toggle(){this._isActive()?this._exitFullscreen():this._enterFullscreen()}_isSupported(){this._removeFullscreenListeners();const e=this._getVendorInfo(this.element);return this._addFullscreenListeners(e),this._vendorInfo=e,!!e}_isActive(){return!!this._vendorInfo&&!!document[this._vendorInfo.propertyName]}_stateHandler(){this.notifyChange("state"),this.state==="active"?this._addStyle():this._removeStyle()}_errorHandler(e){Ee.getLogger(this).error("fullscreen request failed",e)}_getVendorInfo(e){if(e)return e.requestFullscreen?{enterName:"requestFullscreen",exitName:"exitFullscreen",errorEventName:"fullscreenerror",changeEventName:"fullscreenchange",propertyName:"fullscreen"}:e.webkitRequestFullScreen?{enterName:"webkitRequestFullscreen",exitName:"webkitCancelFullScreen",errorEventName:"webkitfullscreenerror",changeEventName:"webkitfullscreenchange",propertyName:"webkitIsFullScreen"}:e.mozRequestFullScreen?{enterName:"mozRequestFullScreen",exitName:"mozCancelFullScreen",errorEventName:"mozfullscreenerror",changeEventName:"mozfullscreenchange",propertyName:"mozFullScreen"}:void 0}_enterFullscreen(){if(this.state==="feature-unsupported")return void Ee.getLogger(this).warn("The fullscreen API is not supported in this browser.");const{element:e}=this;e&&(this._vendorInfo&&e[this._vendorInfo.enterName].call(e),this.notifyChange("state"))}_addStyle(){const{element:e}=this;e&&e.setAttribute("style",this._fullscreenStyle)}_removeStyle(){const{element:e}=this;e&&e.removeAttribute("style")}_exitFullscreen(){if(this.state==="feature-unsupported")return;const{element:e}=this;e&&(this._vendorInfo&&document[this._vendorInfo.exitName].call(document),this.notifyChange("state"))}_addFullscreenListeners(e){e&&(document.addEventListener(e.changeEventName,this._stateHandler),document.addEventListener(e.errorEventName,this._errorHandler))}_removeFullscreenListeners(){const{_vendorInfo:e}=this;e&&(document.removeEventListener(e.changeEventName,this._stateHandler),document.removeEventListener(e.errorEventName,this._errorHandler))}};_([T()],Im.prototype,"element",null),_([T({readOnly:!0})],Im.prototype,"state",null),_([T()],Im.prototype,"view",void 0),_([T()],Im.prototype,"enter",null),_([T()],Im.prototype,"exit",null),_([T()],Im.prototype,"toggle",null),Im=_([Z("esri.widgets.Fullscreen.FullscreenViewModel")],Im);const ORe=Im,cTt={base:"esri-fullscreen"};let Gf=class extends Yg{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new ORe}get element(){return this.viewModel.element}set element(e){this.viewModel.element=e}get fullscreenTitle(){const e=this.viewModel?.state;return e==="active"?this.messages.exit:e==="ready"?this.messages.enter:""}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.viewModel?.state,{fullscreenTitle:i}=this,r={[vl.disabled]:e==="disabled"||e==="feature-unsupported"};return Li("div",{"aria-label":i,bind:this,class:this.classes(cTt.base,vl.widget,vl.widgetButton,r),onclick:this._toggle,onkeydown:this._toggle,role:"button",tabIndex:0,title:i},this._renderIcon(),this._renderTitle())}_renderIcon(){const e=this.viewModel?.state,i={[zc.zoomOutFixed]:e==="ready"||e==="disabled"||e==="feature-unsupported",[zc.zoomInFixed]:e==="active"};return Li("span",{"aria-hidden":"true",class:this.classes(zc.icon,i)})}_renderTitle(){return Li("span",{class:zc.fontFallbackText},this.fullscreenTitle)}_toggle(){this.viewModel.toggle()}};_([T()],Gf.prototype,"element",null),_([T({readOnly:!0})],Gf.prototype,"fullscreenTitle",null),_([T()],Gf.prototype,"label",null),_([T(),kw("esri/widgets/Fullscreen/t9n/Fullscreen")],Gf.prototype,"messages",void 0),_([T()],Gf.prototype,"view",null),_([T({type:ORe})],Gf.prototype,"viewModel",void 0),_([LN()],Gf.prototype,"_toggle",null),Gf=_([Z("esri.widgets.Fullscreen")],Gf);const uTt=Gf;var hTt=Object.defineProperty,dTt=Object.getOwnPropertyDescriptor,pTt=(t,e,i,r)=>{for(var n=r>1?void 0:r?dTt(e,i):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(n=(r?a(e,i,n):a(n))||n);return r&&n&&hTt(e,i,n),n};let tD=class extends Yg{constructor(t){super(t)}};tD=pTt([Z("arcgis-core-template..Widget")],tD);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function fTt(){return navigator.userAgentData}function mTt(){const t=fTt();return t?.brands?t.brands.map(({brand:e,version:i})=>`${e}/${i}`).join(" "):navigator.userAgent}const zw=/firefox/i.test(mTt()),zR=zw?new WeakMap:null;function gTt(){const{disabled:t}=this;t||HTMLElement.prototype.click.call(this)}function RRe(t){const e=t.target;if(zw&&!zR.get(e))return;const{disabled:i}=e;i&&t.preventDefault()}const MRe=["mousedown","mouseup","click"];function PRe(t){if(zw&&!zR.get(t.target))return;const{disabled:e}=t.target;e&&(t.stopImmediatePropagation(),t.preventDefault())}const iD={capture:!0};function IRe(t,e=!1){if(t.disabled){t.el.setAttribute("tabindex","-1"),t.el.setAttribute("aria-disabled","true"),t.el.contains(document.activeElement)&&document.activeElement.blur(),$Re(t);return}DRe(t),typeof e=="function"?t.el.setAttribute("tabindex",e.call(t)?"0":"-1"):e===!0?t.el.setAttribute("tabindex","0"):e===!1&&t.el.removeAttribute("tabindex"),t.el.removeAttribute("aria-disabled")}function $Re(t){t.el.click=gTt,yTt(zw?LRe(t):t.el)}function yTt(t){t&&(t.addEventListener("pointerdown",RRe,iD),MRe.forEach(e=>t.addEventListener(e,PRe,iD)))}function LRe(t){return zR.get(t.el)}function DRe(t){delete t.el.click,vTt(zw?LRe(t):t.el)}function vTt(t){t&&(t.removeEventListener("pointerdown",RRe,iD),MRe.forEach(e=>t.removeEventListener(e,PRe,iD)))}function NRe(t){if(!t.disabled||!zw)return;const e=t.el.parentElement||t.el;zR.set(t.el,e),$Re(t)}function FRe(t){zw&&(zR.delete(t.el),DRe(t))}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const kRe=new WeakMap,zRe=new WeakMap;function Uw(t){zRe.set(t,new Promise(e=>kRe.set(t,e)))}function jw(t){kRe.get(t)()}function _Tt(t){return zRe.get(t)}async function Bw(t){return await _Tt(t),HOe(t),new Promise(e=>requestAnimationFrame(()=>e()))}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function dGt(t){return t==="Enter"||t===" "}const URe=["0","1","2","3","4","5","6","7","8","9"];/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function eE(t,e,i){const r=bTt(t);return new r(e,i)}function bTt(t){class e extends window.MutationObserver{constructor(r){super(r),this.observedEntry=[],this.callback=r}observe(r,n){return this.observedEntry.push({target:r,options:n}),super.observe(r,n)}unobserve(r){const n=this.observedEntry.filter(s=>s.target!==r);this.observedEntry=[],this.callback(super.takeRecords(),this),this.disconnect(),n.forEach(s=>this.observe(s.target,s.options))}}return function(){return t==="intersection"?window.IntersectionObserver:t==="mutation"?e:window.ResizeObserver}()}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const wTt=new RegExp("\\.(0+)?$"),xTt=new RegExp("0+$");class pn{constructor(e){if(e instanceof pn)return e;const[i,r]=OTt(e).split(".").concat("");this.value=BigInt(i+r.padEnd(pn.DECIMALS,"0").slice(0,pn.DECIMALS))+BigInt(pn.ROUNDED&&r[pn.DECIMALS]>="5"),this.isNegative=e.charAt(0)==="-"}getIntegersAndDecimals(){const e=this.value.toString().replace("-","").padStart(pn.DECIMALS+1,"0"),i=e.slice(0,-pn.DECIMALS),r=e.slice(-pn.DECIMALS).replace(xTt,"");return{integers:i,decimals:r}}toString(){const{integers:e,decimals:i}=this.getIntegersAndDecimals();return`${this.isNegative?"-":""}${e}${i.length?"."+i:""}`}formatToParts(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),n=e.numberFormatter.formatToParts(BigInt(i));return this.isNegative&&n.unshift({type:"minusSign",value:e.minusSign}),r.length&&(n.push({type:"decimal",value:e.decimal}),r.split("").forEach(s=>n.push({type:"fraction",value:s}))),n}format(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),n=`${this.isNegative?e.minusSign:""}${e.numberFormatter.format(BigInt(i))}`,s=r.length?`${e.decimal}${r.split("").map(a=>e.numberFormatter.format(Number(a))).join("")}`:"";return`${n}${s}`}add(e){return pn.fromBigInt(this.value+new pn(e).value)}subtract(e){return pn.fromBigInt(this.value-new pn(e).value)}multiply(e){return pn._divRound(this.value*new pn(e).value,pn.SHIFT)}divide(e){return pn._divRound(this.value*pn.SHIFT,new pn(e).value)}}pn.DECIMALS=100;pn.ROUNDED=!0;pn.SHIFT=BigInt("1"+"0".repeat(pn.DECIMALS));pn._divRound=(t,e)=>pn.fromBigInt(t/e+(pn.ROUNDED?t*BigInt(2)/e%BigInt(2):BigInt(0)));pn.fromBigInt=t=>Object.assign(Object.create(pn.prototype),{value:t,isNegative:t<BigInt(0)});function Bee(t){return!(!t||isNaN(Number(t)))}function pGt(t){return!t||!RTt(t)?"":rD(t,e=>{let i=!1;const r=e.split("").filter((n,s)=>n.match(/\./g)&&!i?(i=!0,!0):n.match(/\-/g)&&s===0?!0:URe.includes(n)).join("");return Bee(r)?new pn(r).toString():""})}const jRe=/^([-0])0+(?=\d)/,TTt=/(?!^\.)\.$/,STt=/(?!^-)-/g,ETt=/^-\b0\b\.?0*$/,CTt=/0*$/,fGt=t=>rD(t,e=>{const i=e.replace(STt,"").replace(TTt,"").replace(jRe,"$1");return Bee(i)?ETt.test(i)?i:ATt(i):e});function ATt(t){const e=t.split(".")[1],i=new pn(t).toString(),[r,n]=i.split(".");return e&&n!==e?`${r}.${e}`:i}function rD(t,e){if(!t)return t;const i=t.toLowerCase().indexOf("e")+1;return i?t.replace(/[eE]*$/g,"").substring(0,i).concat(t.slice(i).replace(/[eE]/g,"")).split(/[eE]/).map((r,n)=>e(n===1?r.replace(/\./g,""):r)).join("e").replace(/^e/,"1e"):e(t)}function OTt(t){const e=t.split(/[eE]/);if(e.length===1)return t;const i=+t;if(Number.isSafeInteger(i))return`${i}`;const r=t.charAt(0)==="-",n=+e[1],s=e[0].split("."),a=(r?s[0].substring(1):s[0])||"",u=s[1]||"",p=(S,C)=>{const O=Math.abs(C)-S.length,P=O>0?`${"0".repeat(O)}${S}`:S;return`${P.slice(0,C)}.${P.slice(C)}`},y=(S,C)=>{const O=C>S.length?`${S}${"0".repeat(C-S.length)}`:S;return`${O.slice(0,C)}.${O.slice(C)}`},b=n>0?`${a}${y(u,n)}`:`${p(a,n)}${u}`;return`${r?"-":""}${b.charAt(0)==="."?"0":""}${b.replace(wTt,"").replace(jRe,"")}`}function RTt(t){return URe.some(e=>t.includes(e))}function mGt(t,e,i){const r=e.split(".")[1];if(r){const n=r.match(CTt)[0];if(n&&i.delocalize(t).length!==e.length&&r.indexOf("e")===-1){const s=i.decimal;return t=t.includes(s)?t:`${t}${s}`,t.padEnd(t.length+n.length,i.localize("0"))}}return t}const Rv="en",MTt=["ar","bg","bs","ca","cs","da","de","el",Rv,"es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","no","nl","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"],PTt=["ar","bg","bs","ca","cs","da","de","de-AT","de-CH","el",Rv,"en-AU","en-CA","en-GB","es","es-MX","et","fi","fr","fr-CH","he","hi","hr","hu","id","it","it-CH","ja","ko","lt","lv","mk","no","nl","pl","pt","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"],ITt=["arab","arabext","bali","beng","deva","fullwide","gujr","guru","hanidec","khmr","knda","laoo","latn","limb","mlym","mong","mymr","orya","tamldec","telu","thai","tibt"],BRe=t=>ITt.includes(t),BU=new Intl.NumberFormat().resolvedOptions().numberingSystem,VRe=BU==="arab"||!BRe(BU)?"latn":BU,$Tt=t=>BRe(t)?t:VRe;function GRe(t,e="cldr"){const i=e==="cldr"?PTt:MTt;return t?i.includes(t)?t:(t=t.toLowerCase(),t==="nb"?"no":e==="t9n"&&t==="pt"?"pt-BR":(t.includes("-")&&(t=t.replace(/(\w+)-(\w+)/,(r,n,s)=>`${n}-${s.toUpperCase()}`),i.includes(t)||(t=t.split("-")[0])),t==="zh"?"zh-CN":i.includes(t)?t:(console.warn(`Translations for the "${t}" locale are not available and will fall back to the default, English (en).`),Rv))):Rv}const MO=new Set;function DN(t){LTt(t),MO.size===0&&HRe?.observe(document.documentElement,{attributes:!0,attributeFilter:["lang"],subtree:!0}),MO.add(t)}function LTt(t){t.effectiveLocale=DTt(t)}function NN(t){MO.delete(t),MO.size===0&&HRe.disconnect()}const HRe=eE("mutation",t=>{t.forEach(e=>{const i=e.target;MO.forEach(r=>{if(!xxt(i,r.el))return;const s=Fw(r.el,"[lang]");if(!s){r.effectiveLocale=Rv;return}const a=s.lang;r.effectiveLocale=s.hasAttribute("lang")&&a===""?Rv:a})})});function DTt(t){return t.el.lang||Fw(t.el,"[lang]")?.lang||document.documentElement.lang||Rv}class NTt{constructor(){this.delocalize=e=>this._numberFormatOptions?rD(e,i=>i.replace(new RegExp(`[${this._minusSign}]`,"g"),"-").replace(new RegExp(`[${this._group}]`,"g"),"").replace(new RegExp(`[${this._decimal}]`,"g"),".").replace(new RegExp(`[${this._digits.join("")}]`,"g"),this._getDigitIndex)):e,this.localize=e=>this._numberFormatOptions?rD(e,i=>Bee(i.trim())?new pn(i.trim()).format(this).replace(new RegExp(`[${this._actualGroup}]`,"g"),this._group):i):e}get group(){return this._group}get decimal(){return this._decimal}get minusSign(){return this._minusSign}get digits(){return this._digits}get numberFormatter(){return this._numberFormatter}get numberFormatOptions(){return this._numberFormatOptions}set numberFormatOptions(e){if(e.locale=GRe(e?.locale),e.numberingSystem=$Tt(e?.numberingSystem),!this._numberFormatOptions&&e.locale===Rv&&e.numberingSystem===VRe&&Object.keys(e).length===2||JSON.stringify(this._numberFormatOptions)===JSON.stringify(e))return;this._numberFormatOptions=e,this._numberFormatter=new Intl.NumberFormat(this._numberFormatOptions.locale,this._numberFormatOptions),this._digits=[...new Intl.NumberFormat(this._numberFormatOptions.locale,{useGrouping:!1,numberingSystem:this._numberFormatOptions.numberingSystem}).format(9876543210)].reverse();const i=new Map(this._digits.map((n,s)=>[n,s])),r=new Intl.NumberFormat(this._numberFormatOptions.locale,{numberingSystem:this._numberFormatOptions.numberingSystem}).formatToParts(-123456789e-1);this._actualGroup=r.find(n=>n.type==="group").value,this._group=this._actualGroup.trim().length===0||this._actualGroup==" "?"Â ":this._actualGroup,this._decimal=r.find(n=>n.type==="decimal").value,this._minusSign=r.find(n=>n.type==="minusSign").value,this._getDigitIndex=n=>i.get(n)}}const gGt=new NTt;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const V9={};async function FTt(t,e){const i=`${e}_${t}`;return V9[i]||(V9[i]=fetch(Fee(`./assets/${e}/t9n/messages_${t}.json`)).then(r=>(r.ok||zpe(),r.json())).catch(()=>zpe())),V9[i]}function zpe(){throw new Error("could not fetch component message bundle")}function Vee(t){t.messages={...t.defaultMessages,...t.messageOverrides}}async function FN(t){t.defaultMessages=await qRe(t,t.effectiveLocale),Vee(t)}async function qRe(t,e){const{el:i}=t,n=i.tagName.toLowerCase().replace("calcite-","");return FTt(GRe(e,"t9n"),n)}async function kN(t,e){t.defaultMessages=await qRe(t,e),Vee(t)}function zN(t){t.onMessagesChange=kTt}function UN(t){t.onMessagesChange=void 0}function kTt(){Vee(this)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const zTt={icon:"icon",flipRtl:"flip-rtl"},VU={},GU={},WRe={s:16,m:24,l:32};async function UTt({icon:t,scale:e}){const i=WRe[e],r=jTt(t),n=r.charAt(r.length-1)==="F",a=`${n?r.substring(0,r.length-1):r}${i}${n?"F":""}`;if(VU[a])return VU[a];GU[a]||(GU[a]=fetch(Fee(`./assets/icon/${a}.json`)).then(p=>p.json()).catch(()=>(console.error(`"${a}" is not a valid calcite-ui-icon name`),"")));const u=await GU[a];return VU[a]=u,u}function jTt(t){const e=!isNaN(Number(t.charAt(0))),i=t.split("-");if(i.length>0){const n=/[a-z]/i;t=i.map((s,a)=>s.replace(n,function(p,y){return a===0&&y===0?p:p.toUpperCase()})).join("")}return e?`i${t}`:t}const BTt=":host{display:inline-flex;color:var(--calcite-ui-icon-color)}:host([scale=s]){block-size:1rem;inline-size:1rem;min-inline-size:1rem;min-block-size:1rem}:host([scale=m]){block-size:1.5rem;inline-size:1.5rem;min-inline-size:1.5rem;min-block-size:1.5rem}:host([scale=l]){block-size:2rem;inline-size:2rem;min-inline-size:2rem;min-block-size:2rem}.flip-rtl{transform:scaleX(-1)}.svg{display:block}:host([hidden]){display:none}[hidden]{display:none}",VTt=W0(class extends X0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.icon=null,this.flipRtl=!1,this.scale="m",this.textLabel=void 0,this.pathData=void 0,this.visible=!1}connectedCallback(){this.waitUntilVisible(()=>{this.visible=!0,this.loadIconPathData()})}disconnectedCallback(){this.intersectionObserver?.disconnect(),this.intersectionObserver=null}async componentWillLoad(){this.loadIconPathData()}render(){const{el:t,flipRtl:e,pathData:i,scale:r,textLabel:n}=this,s=aRe(t),a=WRe[r],u=!!n,p=[].concat(i||"");return _t(Jg,{"aria-hidden":e6(!u),"aria-label":u?n:null,role:u?"img":null},_t("svg",{"aria-hidden":"true",class:{[zTt.flipRtl]:s==="rtl"&&e,svg:!0},fill:"currentColor",height:"100%",viewBox:`0 0 ${a} ${a}`,width:"100%",xmlns:"http://www.w3.org/2000/svg"},p.map(y=>typeof y=="string"?_t("path",{d:y}):_t("path",{d:y.d,opacity:"opacity"in y?y.opacity:1}))))}async loadIconPathData(){const{icon:t,scale:e,visible:i}=this;!t||!i||(this.pathData=await UTt({icon:t,scale:e}))}waitUntilVisible(t){if(this.intersectionObserver=eE("intersection",e=>{e.forEach(i=>{i.isIntersecting&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,t())})},{rootMargin:"50px"}),!this.intersectionObserver){t();return}this.intersectionObserver.observe(this.el)}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{icon:["loadIconPathData"],scale:["loadIconPathData"]}}static get style(){return BTt}},[1,"calcite-icon",{icon:[513],flipRtl:[516,"flip-rtl"],scale:[513],textLabel:[1,"text-label"],pathData:[32],visible:[32]}]);function Vw(){if(typeof customElements>"u")return;["calcite-icon"].forEach(e=>{switch(e){case"calcite-icon":customElements.get(e)||customElements.define(e,VTt);break}})}Vw();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const GTt='@charset "UTF-8";@media (prefers-reduced-motion: reduce){:root{--calcite-internal-duration-factor:0}}:host{position:relative;margin-inline:auto;display:none;align-items:center;justify-content:center;opacity:1;min-block-size:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke:var(--calcite-ui-brand);stroke-width:3;fill:none;transform:scale(1, 1);animation:loader-color-shift calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 2 / var(--calcite-internal-duration-factor)) alternate-reverse infinite linear;padding-block:var(--calcite-loader-padding, 4rem)}:host([scale=s]){--calcite-loader-font-size:var(--calcite-font-size--2);--calcite-loader-size:2rem;--calcite-loader-size-inline:0.75rem}:host([scale=m]){--calcite-loader-font-size:var(--calcite-font-size-0);--calcite-loader-size:4rem;--calcite-loader-size-inline:1rem}:host([scale=l]){--calcite-loader-font-size:var(--calcite-font-size-2);--calcite-loader-size:6rem;--calcite-loader-size-inline:1.5rem}:host([no-padding]){padding-block:0px}:host{display:flex}.loader__text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;color:var(--calcite-ui-text-1);margin-block-start:calc(var(--calcite-loader-size) + 1.5rem)}.loader__percentage{position:absolute;display:block;text-align:center;color:var(--calcite-ui-text-1);font-size:var(--calcite-loader-font-size);inline-size:var(--calcite-loader-size);inset-inline-start:50%;margin-inline-start:calc(var(--calcite-loader-size) / 2 * -1);line-height:0.25;transform:scale(1, 1)}.loader__svgs{position:absolute;overflow:visible;opacity:1;inline-size:var(--calcite-loader-size);block-size:var(--calcite-loader-size);inset-inline-start:50%;margin-inline-start:calc(var(--calcite-loader-size) / 2 * -1);animation-iteration-count:infinite;animation-timing-function:linear;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 6.66 / var(--calcite-internal-duration-factor));animation-name:loader-clockwise}.loader__svg{position:absolute;inset-block-start:0px;transform-origin:center;overflow:visible;inset-inline-start:0;inline-size:var(--calcite-loader-size);block-size:var(--calcite-loader-size);animation-iteration-count:infinite;animation-timing-function:linear}@supports (display: grid){.loader__svg--1{animation-name:loader-offset-1}.loader__svg--2{animation-name:loader-offset-2}.loader__svg--3{animation-name:loader-offset-3}}:host([type=determinate]){animation:none;stroke:var(--calcite-ui-border-3)}:host([type=determinate]) .loader__svgs{animation:none}:host([type=determinate]) .loader__svg--3{animation:none;stroke:var(--calcite-ui-brand);stroke-dasharray:150.79632;transform:rotate(-90deg);transition:all var(--calcite-internal-animation-timing-fast) linear}:host([inline]){position:relative;margin:0px;animation:none;stroke:currentColor;stroke-width:2;padding-block:0px;block-size:var(--calcite-loader-size-inline);min-block-size:var(--calcite-loader-size-inline);inline-size:var(--calcite-loader-size-inline);margin-inline-end:calc(var(--calcite-loader-size-inline) * 0.5);vertical-align:calc(var(--calcite-loader-size-inline) * -1 * 0.2)}:host([inline]) .loader__svgs{inset-block-start:0px;margin:0px;inset-inline-start:0;inline-size:var(--calcite-loader-size-inline);block-size:var(--calcite-loader-size-inline)}:host([inline]) .loader__svg{inline-size:var(--calcite-loader-size-inline);block-size:var(--calcite-loader-size-inline)}:host([complete]){opacity:0;transform:scale(0.75, 0.75);transform-origin:center;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms}:host([complete]) .loader__svgs{opacity:0;transform:scale(0.75, 0.75);transform-origin:center;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms}:host([complete]) .loader__percentage{color:var(--calcite-ui-brand);transform:scale(1.05, 1.05);transform-origin:center;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear}.loader__svg--1{stroke-dasharray:27.9252444444 139.6262222222;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 4.8 / var(--calcite-internal-duration-factor))}@keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444 251.3272;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222 139.6262222222;stroke-dashoffset:-83.7757333333}100%{stroke-dasharray:27.9252444444 251.3272;stroke-dashoffset:-279.2524444444}}.loader__svg--2{stroke-dasharray:55.8504888889 139.6262222222;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 6.4 / var(--calcite-internal-duration-factor))}@keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889 223.4019555556;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222 139.6262222222;stroke-dashoffset:-97.7383555556}100%{stroke-dasharray:55.8504888889 223.4019555556;stroke-dashoffset:-279.2524444444}}.loader__svg--3{stroke-dasharray:13.9626222222 139.6262222222;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 7.734 / var(--calcite-internal-duration-factor))}@keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222 265.2898222222;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222 139.6262222222;stroke-dashoffset:-76.7944222222}100%{stroke-dasharray:13.9626222222 265.2898222222;stroke-dashoffset:-279.2524444444}}@keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@keyframes loader-clockwise{100%{transform:rotate(360deg)}}:host([hidden]){display:none}[hidden]{display:none}',HTt=W0(class extends X0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.inline=!1,this.label=void 0,this.scale="m",this.type=void 0,this.value=0,this.text=""}render(){const{el:t,inline:e,label:i,scale:r,text:n,type:s,value:a}=this,u=t.id||ZOe(),p=.45,y=e?this.getInlineSize(r):this.getSize(r),b=y*p,S=`0 0 ${y} ${y}`,C=s==="determinate",O=2*b*Math.PI,P=a/100*O,$=O-P,N=Math.floor(a),z={"aria-valuenow":N,"aria-valuemin":0,"aria-valuemax":100,complete:N===100},U={r:b,cx:y/2,cy:y/2},j={"stroke-dasharray":`${P} ${$}`};return _t(Jg,{"aria-label":i,id:u,role:"progressbar",...C?z:{}},_t("div",{class:"loader__svgs"},_t("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--1",viewBox:S},_t("circle",{...U})),_t("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--2",viewBox:S},_t("circle",{...U})),_t("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--3",viewBox:S,...C?{style:j}:{}},_t("circle",{...U}))),n&&_t("div",{class:"loader__text"},n),C&&_t("div",{class:"loader__percentage"},a))}getSize(t){return{s:32,m:56,l:80}[t]}getInlineSize(t){return{s:12,m:16,l:20}[t]}get el(){return this}static get style(){return GTt}},[1,"calcite-loader",{inline:[516],label:[1],scale:[513],type:[513],value:[2],text:[1]}]);function UR(){if(typeof customElements>"u")return;["calcite-loader"].forEach(e=>{switch(e){case"calcite-loader":customElements.get(e)||customElements.define(e,HTt);break}})}UR();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const pm={button:"button",buttonTextVisible:"button--text-visible",buttonCompact:"button--compact",indicatorText:"indicator-text",iconContainer:"icon-container",slotContainer:"slot-container",slotContainerHidden:"slot-container--hidden",textContainer:"text-container",textContainerVisible:"text-container--visible"},qTt={tooltip:"tooltip"},WTt=`:host{box-sizing:border-box;background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-2);font-size:var(--calcite-font-size--1)}:host *{box-sizing:border-box}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex;background-color:transparent;--calcite-action-indicator-color:var(--calcite-ui-brand)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.button{position:relative;margin:0px;display:flex;inline-size:auto;cursor:pointer;align-items:center;justify-content:flex-start;border-style:none;background-color:var(--calcite-ui-foreground-1);fill:var(--calcite-ui-text-3);font-family:var(--calcite-sans-family);font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-3);outline-color:transparent;text-align:unset;flex:1 0 auto}.button:hover{background-color:var(--calcite-ui-foreground-2);fill:var(--calcite-ui-text-1);color:var(--calcite-ui-text-1)}.button:focus{background-color:var(--calcite-ui-foreground-2);fill:var(--calcite-ui-text-1);color:var(--calcite-ui-text-1);outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.button:active{background-color:var(--calcite-ui-foreground-3)}.button .icon-container{pointer-events:none;margin:0px;display:flex;align-items:center;justify-content:center;min-inline-size:1rem;min-block-size:1rem}.button .text-container{margin:0px;inline-size:0px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:1.5rem;opacity:0;transition-property:opacity;transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-property:margin;transition-property:inline-size}.button .text-container--visible{inline-size:auto;flex:1 1 auto;opacity:1;margin-inline-end:1rem}:host([scale=s]) .button{padding-inline:0.5rem;padding-block:0.25rem;font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-normal)}:host([scale=s]) .button--text-visible .icon-container{margin-inline-end:0.5rem}:host([scale=m]) .button{padding-inline:1rem;padding-block:0.75rem;font-size:var(--calcite-font-size--1);line-height:1rem;font-weight:var(--calcite-font-weight-normal)}:host([scale=m]) .button--text-visible .icon-container{margin-inline-end:0.75rem}:host([scale=l]) .button{padding:1.25rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-normal)}:host([scale=l]) .button--text-visible .icon-container{margin-inline-end:1rem}:host([alignment=center]) .button{justify-content:center}:host([alignment=end]) .button{justify-content:flex-end}:host([alignment=center]) .button .text-container--visible,:host([alignment=end]) .button .text-container--visible{flex:0 1 auto}:host([scale=s][compact]) .button,:host([scale=m][compact]) .button,:host([scale=l][compact]) .button{padding-inline:0px}.slot-container{display:flex}.slot-container--hidden{display:none}.button--text-visible{inline-size:100%}:host([active]) .button,:host([active]) .button:hover,:host([active]) .button:focus,:host([active][loading]) .button{background-color:var(--calcite-ui-foreground-3);fill:var(--calcite-ui-text-1);color:var(--calcite-ui-text-1)}:host([active]) .button:active{background-color:var(--calcite-ui-foreground-1)}:host([appearance=transparent]) .button{background-color:transparent;transition-property:box-shadow;transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1)}:host([appearance=transparent]) .button:hover,:host([appearance=transparent]) .button:focus{background-color:transparent;box-shadow:0 0 0 2px var(--calcite-ui-border-1) inset}:host([active][appearance=transparent]) .button,:host([active][appearance=transparent]) .button:hover,:host([active][appearance=transparent]) .button:focus{background-color:var(--calcite-ui-foreground-3);fill:var(--calcite-ui-text-1);color:var(--calcite-ui-text-1)}:host([appearance=transparent][loading]) .button,:host([appearance=transparent][disabled]) .button{background-color:transparent}:host([loading]) .button,:host([loading]) .button:hover,:host([loading]) .button:focus{background-color:var(--calcite-ui-foreground-1)}:host([loading]) .button .text-container,:host([loading]) .button:hover .text-container,:host([loading]) .button:focus .text-container{opacity:var(--calcite-ui-opacity-disabled)}:host([loading]) calcite-loader[inline]{color:var(--calcite-ui-text-3);margin-inline-end:0px}:host([disabled]) .button,:host([disabled]) .button:hover,:host([disabled]) .button:focus{cursor:default;background-color:var(--calcite-ui-foreground-1);opacity:var(--calcite-ui-opacity-disabled)}:host([disabled][active]) .button,:host([disabled][active]) .button:hover,:host([disabled][active]) .button:focus{background-color:var(--calcite-ui-foreground-3);opacity:var(--calcite-ui-opacity-disabled)}:host([indicator]) .button::after{content:"";position:absolute;block-size:0.5rem;inline-size:0.5rem;border-radius:9999px;border-width:2px;background-color:var(--calcite-action-indicator-color);border-color:var(--calcite-ui-foreground-1);inset-block-end:0.75rem;inset-inline-end:0.75rem}:host([indicator]) .button--text-visible::after{inset-block-end:auto}:host([indicator]) .button:hover::after,:host([indicator]) .button:focus::after{border-color:var(--calcite-ui-foreground-1)}:host([indicator][scale=s]) .button::after{inset-block-end:0.25rem;inset-inline-end:0.25rem}:host([indicator][scale=s]) .button--text-visible::after{inset-block-end:auto;inset-inline-end:0.5rem}:host([indicator][active]) .button::after{border-color:var(--calcite-ui-foreground-3)}.indicator-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}`,XTt=W0(class extends X0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.mutationObserver=eE("mutation",()=>HOe(this)),this.guid=`calcite-action-${ZOe()}`,this.indicatorId=`${this.guid}-indicator`,this.buttonId=`${this.guid}-button`,this.handleTooltipSlotChange=t=>{const i=t.target.assignedElements({flatten:!0}).filter(r=>r?.matches("calcite-tooltip"))[0];i&&(i.referenceElement=this.buttonEl)},this.active=!1,this.alignment=void 0,this.appearance="solid",this.compact=!1,this.disabled=!1,this.icon=void 0,this.iconFlipRtl=!1,this.indicator=!1,this.label=void 0,this.loading=!1,this.scale="m",this.text=void 0,this.textEnabled=!1,this.messages=void 0,this.messageOverrides=void 0,this.effectiveLocale="",this.defaultMessages=void 0}onMessagesChange(){}effectiveLocaleChange(){kN(this,this.effectiveLocale)}connectedCallback(){NRe(this),DN(this),zN(this),this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}async componentWillLoad(){Uw(this),await FN(this)}componentDidLoad(){jw(this)}disconnectedCallback(){FRe(this),NN(this),UN(this),this.mutationObserver?.disconnect()}componentDidRender(){IRe(this)}async setFocus(){await Bw(this),this.buttonEl?.focus()}renderTextContainer(){const{text:t,textEnabled:e}=this,i={[pm.textContainer]:!0,[pm.textContainerVisible]:e};return t?_t("div",{class:i,key:"text-container"},t):null}renderIndicatorText(){const{indicator:t,messages:e,indicatorId:i,buttonId:r}=this;return _t("div",{"aria-labelledby":r,"aria-live":"polite",class:pm.indicatorText,id:i,role:"region"},t?e.indicator:null)}renderIconContainer(){const{loading:t,icon:e,scale:i,el:r,iconFlipRtl:n}=this,s=i==="l"?"m":"s",a=i==="l"?"l":"m",u=t?_t("calcite-loader",{inline:!0,label:this.messages.loading,scale:a}):null,p=e?_t("calcite-icon",{flipRtl:n,icon:e,scale:s}):null,y=u||p,b=y||r.children?.length,S=_t("div",{class:{[pm.slotContainer]:!0,[pm.slotContainerHidden]:t}},_t("slot",null));return b?_t("div",{"aria-hidden":"true",class:pm.iconContainer,key:"icon-container"},y,S):null}render(){const{active:t,compact:e,disabled:i,loading:r,textEnabled:n,label:s,text:a,indicator:u,indicatorId:p,buttonId:y,messages:b}=this,S=`${s||a}${u?` (${b.indicator})`:""}`,C={[pm.button]:!0,[pm.buttonTextVisible]:n,[pm.buttonCompact]:e};return _t(Jg,null,_t("button",{"aria-busy":e6(r),"aria-controls":u?p:null,"aria-disabled":e6(i),"aria-label":S,"aria-pressed":e6(t),class:C,disabled:i,id:y,ref:O=>this.buttonEl=O},this.renderIconContainer(),this.renderTextContainer()),_t("slot",{name:qTt.tooltip,onSlotchange:this.handleTooltipSlotChange}),this.renderIndicatorText())}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return WTt}},[1,"calcite-action",{active:[516],alignment:[513],appearance:[513],compact:[516],disabled:[516],icon:[1],iconFlipRtl:[516,"icon-flip-rtl"],indicator:[516],label:[1],loading:[516],scale:[513],text:[1],textEnabled:[516,"text-enabled"],messages:[1040],messageOverrides:[1040],effectiveLocale:[32],defaultMessages:[32],setFocus:[64]}]);function Gee(){if(typeof customElements>"u")return;["calcite-action","calcite-icon","calcite-loader"].forEach(e=>{switch(e){case"calcite-action":customElements.get(e)||customElements.define(e,XTt);break;case"calcite-icon":customElements.get(e)||Vw();break;case"calcite-loader":customElements.get(e)||UR();break}})}Gee();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */(function(t){if(typeof t.requestSubmit=="function")return;t.requestSubmit=function(r){r?(e(r,this),r.click()):(r=document.createElement("input"),r.type="submit",r.hidden=!0,this.appendChild(r),r.click(),this.removeChild(r))};function e(r,n){r instanceof HTMLElement||i(TypeError,"parameter 1 is not of type 'HTMLElement'"),r.type=="submit"||i(TypeError,"The specified element is not a submit button"),r.form==n||i(DOMException,"The specified element is not owned by this form element","NotFoundError")}function i(r,n,s){throw new r("Failed to execute 'requestSubmit' on 'HTMLFormElement': "+n+".",s)}})(HTMLFormElement.prototype);const SW="hidden-form-input";function Hee(t){return"checked"in t}const EW=new WeakMap,qee=new WeakSet;function JTt(t,e){if(Fw(e.parentElement,"[form]"))return!0;const r="calciteInternalFormComponentRegister";let n=!1;return t.addEventListener(r,s=>{n=s.composedPath().some(a=>qee.has(a)),s.stopPropagation()},{once:!0}),e.dispatchEvent(new CustomEvent(r,{bubbles:!0,composed:!0})),n}function YTt(t){const{formEl:e}=t;return e?(e.requestSubmit(),!0):!1}function ZTt(t){t.formEl?.reset()}function yGt(t){const{el:e,value:i}=t,r=XRe(t);if(!r||JTt(r,e))return;t.formEl=r,t.defaultValue=i,Hee(t)&&(t.defaultChecked=t.checked);const n=(t.onFormReset||KTt).bind(t);r.addEventListener("reset",n),EW.set(t.el,n),qee.add(e)}function XRe(t){const{el:e,form:i}=t;return i?uRe(e,{id:i}):Fw(e,"form")}function KTt(){if(Hee(this)){this.checked=this.defaultChecked;return}this.value=this.defaultValue}function vGt(t){const{el:e,formEl:i}=t;if(!i)return;const r=EW.get(e);i.removeEventListener("reset",r),EW.delete(e),t.formEl=null,qee.delete(e)}const JRe=t=>{t.target.dispatchEvent(new CustomEvent("calciteInternalHiddenInputChange",{bubbles:!0}))},Upe=t=>t.removeEventListener("change",JRe);function QTt(t){const{el:e,formEl:i,name:r,value:n}=t,{ownerDocument:s}=e,a=e.querySelectorAll(`input[slot="${SW}"]`);if(!i||!r){a.forEach(S=>{Upe(S),S.remove()});return}const u=Array.isArray(n)?n:[n],p=[],y=new Set;a.forEach(S=>{const C=u.find(O=>O==S.value);C!=null?(y.add(C),jpe(t,S,C)):p.push(S)});let b;u.forEach(S=>{if(y.has(S))return;let C=p.pop();C||(C=s.createElement("input"),C.slot=SW),b||(b=s.createDocumentFragment()),b.append(C),C.addEventListener("change",JRe),jpe(t,C,S)}),b&&e.append(b),p.forEach(S=>{Upe(S),S.remove()})}function jpe(t,e,i){const{defaultValue:r,disabled:n,form:s,name:a,required:u}=t;e.defaultValue=r,e.disabled=n,e.name=a,e.required=u,e.tabIndex=-1,s?e.setAttribute("form",s):e.removeAttribute("form"),Hee(t)?(e.checked=t.checked,e.defaultChecked=t.defaultChecked,e.value=t.checked?i||"on":""):e.value=i||"",t.syncHiddenFormInput?.(e)}const _Gt=({component:t})=>(QTt(t),_t("slot",{name:SW}));/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const YRe="calciteInternalLabelClick",Wee="calciteInternalLabelConnected",CW="calciteInternalLabelDisconnected",Bpe="calcite-label",PO=new WeakMap,T4=new WeakMap,IO=new WeakMap,nD=new WeakMap,KT=new WeakSet,eSt=t=>{const{id:e}=t,i=e&&uRe(t,{selector:`${Bpe}[for="${e}"]`});if(i)return i;const r=Fw(t,Bpe);return!r||tSt(r,t)?null:r};function tSt(t,e){let i;const r="custom-element-ancestor-check",n=a=>{a.stopImmediatePropagation();const u=a.composedPath();i=u.slice(u.indexOf(e),u.indexOf(t))};return t.addEventListener(r,n,{once:!0}),e.dispatchEvent(new CustomEvent(r,{composed:!0,bubbles:!0})),t.removeEventListener(r,n),i.filter(a=>a!==e&&a!==t).filter(a=>a.tagName?.includes("-")).length>0}function ZRe(t){const e=eSt(t.el);if(T4.has(e)&&e===t.labelEl||!e&&KT.has(t))return;const i=sSt.bind(t);if(e){t.labelEl=e;const r=PO.get(e)||[];r.push(t),PO.set(e,r.sort(KRe)),T4.has(t.labelEl)||(T4.set(t.labelEl,Vpe),t.labelEl.addEventListener(YRe,Vpe)),KT.delete(t),document.removeEventListener(Wee,IO.get(t)),nD.set(t,i),document.addEventListener(CW,i)}else KT.has(t)||(i(),document.removeEventListener(CW,nD.get(t)))}function iSt(t){if(KT.delete(t),document.removeEventListener(Wee,IO.get(t)),document.removeEventListener(CW,nD.get(t)),IO.delete(t),nD.delete(t),!t.labelEl)return;const e=PO.get(t.labelEl);e.length===1&&(t.labelEl.removeEventListener(YRe,T4.get(t.labelEl)),T4.delete(t.labelEl)),PO.set(t.labelEl,e.filter(i=>i!==t).sort(KRe)),t.labelEl=null}function KRe(t,e){return Rxt(t.el,e.el)?-1:1}function rSt(t){return t.label||t.labelEl?.textContent?.trim()||""}function Vpe(t){const e=t.detail.sourceEvent.target,i=PO.get(this),r=i.find(a=>a.el===e);if(i.includes(r))return;const s=i[0];s.disabled||s.onLabelClick(t)}function nSt(){KT.has(this)&&ZRe(this)}function sSt(){KT.add(this);const t=IO.get(this)||nSt.bind(this);IO.set(this,t),document.addEventListener(Wee,t)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const oSt=["lang","role","aria-expanded"],sD=new Map;let QT;function QRe(t,e,i=!1){const{el:r}=t,n=i?t.globalAttributes:{};e.filter(s=>!!oSt.includes(s)&&!!r.hasAttribute(s)).forEach(s=>{const a=r.getAttribute(s);a!==null&&(n[s]=a)}),t.globalAttributes=n}function eMe(t){t.forEach(({target:e})=>{const[i,r]=sD.get(e);QRe(i,r.attributeFilter)})}function tMe(t,e){const{el:i}=t,r={attributeFilter:e};sD.set(i,[t,r]),QRe(t,e,!0),QT||(QT=eE("mutation",eMe)),QT.observe(i,r)}function iMe(t){sD.delete(t.el),eMe(QT.takeRecords()),QT.disconnect();for(const[e,[,i]]of sD.entries())QT.observe(e,i)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const cu={buttonLoader:"calcite-button--loader",content:"content",contentSlotted:"content--slotted",icon:"icon",iconStart:"icon--start",iconEnd:"icon--end",loadingIn:"loading-in",loadingOut:"loading-out",iconStartEmpty:"icon-start-empty",iconEndEmpty:"icon-end-empty",buttonPadding:"button-padding",buttonPaddingShrunk:"button-padding--shrunk"},aSt=`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([loading]) *,:host([disabled]) *,:host([loading]) ::slotted(*),:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline-block;inline-size:auto;vertical-align:middle}:host([round]){border-radius:50px}:host([round]) a,:host([round]) button{border-radius:50px}:host button,:host a{outline-color:transparent}:host button:focus,:host a:focus{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}:host button,:host a{--calcite-button-content-margin-internal:0.5rem;--calcite-button-padding-x-internal:7px;--calcite-button-padding-y-internal:3px;padding-block:var(--calcite-button-padding-y-internal);padding-inline:var(--calcite-button-padding-x-internal);position:relative;box-sizing:border-box;display:flex;block-size:100%;inline-size:100%;cursor:pointer;-webkit-user-select:none;user-select:none;-webkit-appearance:none;appearance:none;align-items:center;justify-content:center;border-radius:0px;border-style:none;text-align:center;font-family:inherit;font-weight:var(--calcite-font-weight-normal);text-decoration-line:none;transition:color var(--calcite-animation-timing) ease-in-out, background-color var(--calcite-animation-timing) ease-in-out, box-shadow var(--calcite-animation-timing) ease-in-out, outline-color var(--calcite-internal-animation-timing-fast) ease-in-out}:host button:hover,:host a:hover{text-decoration-line:none}:host button span,:host a span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.content{margin-inline:var(--calcite-button-content-margin-internal)}.icon-start-empty .content{margin-inline-start:unset}.icon-end-empty .content{margin-inline-end:unset}:host([scale=m]) button,:host([scale=m]) a{--calcite-button-content-margin-internal:0.75rem}:host([scale=l]) button,:host([scale=l]) a{--calcite-button-content-margin-internal:1rem}:host([width=auto]){inline-size:auto}:host([width=half]){inline-size:50%}:host([width=full]){inline-size:100%}:host([alignment=center]:not([width=auto])) a,:host([alignment=center]:not([width=auto])) button{justify-content:center}:host([alignment=start]:not([width=auto])) a,:host([alignment=start]:not([width=auto])) button{justify-content:flex-start}:host([alignment=end]:not([width=auto])) a,:host([alignment=end]:not([width=auto])) button{justify-content:flex-end}:host([alignment*=space-between]:not([width=auto])) a,:host([alignment*=space-between]:not([width=auto])) button{justify-content:space-between}:host([alignment=icon-start-space-between]:not([width=auto])) .icon--start{margin-inline-end:auto}:host([alignment=icon-start-space-between]:not([width=auto])) a,:host([alignment=icon-start-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=icon-end-space-between]:not([width=auto])) .icon--end{margin-inline-start:auto}:host([alignment=icon-end-space-between]:not([width=auto])) a,:host([alignment=icon-end-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=center]) a:not(.content--slotted) .icon--start+.icon--end,:host([alignment=center]) button:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:var(--calcite-button-content-margin-internal)}.icon{position:relative;margin:0px;display:inline-flex;font-weight:var(--calcite-font-weight-normal);line-height:inherit}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host([loading]) button,:host([loading]) a{opacity:var(--calcite-ui-opacity-disabled)}@keyframes loader-in{0%{inline-size:0;opacity:0;transform:scale(0.5)}100%{inline-size:1em;opacity:1;transform:scale(1)}}@keyframes loader-out{0%{inline-size:1em;opacity:1;transform:scale(1)}100%{inline-size:0;opacity:0;transform:scale(0.5)}}.calcite-button--loader{display:flex}.calcite-button--loader calcite-loader{margin:0px;transition:inline-size var(--calcite-internal-animation-timing-slow) ease-in-out, opacity var(--calcite-internal-animation-timing-slow) ease-in-out, transform var(--calcite-internal-animation-timing-slow) ease-in-out}.calcite-button--loader calcite-loader.loading-in{animation-name:loader-in;animation-duration:var(--calcite-internal-animation-timing-slow)}.calcite-button--loader calcite-loader.loading-out{animation-name:loader-out;animation-duration:var(--calcite-internal-animation-timing-slow)}:host([loading]) button.content--slotted .calcite-button--loader calcite-loader,:host([loading]) a.content--slotted .calcite-button--loader calcite-loader{margin-inline-end:var(--calcite-button-content-margin-internal)}:host([loading]) button:not(.content--slotted) .icon--start,:host([loading]) button:not(.content--slotted) .icon--end,:host([loading]) a:not(.content--slotted) .icon--start,:host([loading]) a:not(.content--slotted) .icon--end{display:none}:host([appearance]) button,:host([appearance]) a{border-width:1px;border-style:solid;border-color:transparent}:host([kind=brand]) button,:host([kind=brand]) a{background-color:var(--calcite-ui-brand);color:var(--calcite-ui-text-inverse)}:host([kind=brand]) button:hover,:host([kind=brand]) button:focus,:host([kind=brand]) a:hover,:host([kind=brand]) a:focus{background-color:var(--calcite-ui-brand-hover)}:host([kind=brand]) button:active,:host([kind=brand]) a:active{background-color:var(--calcite-ui-brand-press)}:host([kind=brand]) button calcite-loader,:host([kind=brand]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([kind=danger]) button,:host([kind=danger]) a{background-color:var(--calcite-ui-danger);color:var(--calcite-ui-text-inverse)}:host([kind=danger]) button:hover,:host([kind=danger]) button:focus,:host([kind=danger]) a:hover,:host([kind=danger]) a:focus{background-color:var(--calcite-ui-danger-hover)}:host([kind=danger]) button:active,:host([kind=danger]) a:active{background-color:var(--calcite-ui-danger-press)}:host([kind=danger]) button calcite-loader,:host([kind=danger]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([kind=neutral]) button,:host([kind=neutral]) a{background-color:var(--calcite-ui-foreground-3);color:var(--calcite-ui-text-1)}:host([kind=neutral]) button:hover,:host([kind=neutral]) button:focus,:host([kind=neutral]) a:hover,:host([kind=neutral]) a:focus{background-color:var(--calcite-ui-foreground-2)}:host([kind=neutral]) button:active,:host([kind=neutral]) a:active{background-color:var(--calcite-ui-foreground-1)}:host([kind=neutral]) button calcite-loader,:host([kind=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([kind=inverse]) button,:host([kind=inverse]) a{color:var(--calcite-ui-text-inverse);background-color:var(--calcite-ui-inverse)}:host([kind=inverse]) button:hover,:host([kind=inverse]) button:focus,:host([kind=inverse]) a:hover,:host([kind=inverse]) a:focus{background-color:var(--calcite-ui-inverse-hover)}:host([kind=inverse]) button:active,:host([kind=inverse]) a:active{background-color:var(--calcite-ui-inverse-press)}:host([kind=inverse]) button calcite-loader,:host([kind=inverse]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([appearance=outline-fill]) button,:host([appearance=outline-fill]) a{border-width:1px;border-style:solid;background-color:var(--calcite-ui-foreground-1);box-shadow:inset 0 0 0 1px transparent}:host([appearance=outline-fill][kind=brand]) button,:host([appearance=outline-fill][kind=brand]) a{border-color:var(--calcite-ui-brand);background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-brand)}:host([appearance=outline-fill][kind=brand]) button:hover,:host([appearance=outline-fill][kind=brand]) a:hover{border-color:var(--calcite-ui-brand-hover);color:var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}:host([appearance=outline-fill][kind=brand]) button:focus,:host([appearance=outline-fill][kind=brand]) a:focus{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand)}:host([appearance=outline-fill][kind=brand]) button:active,:host([appearance=outline-fill][kind=brand]) a:active{border-color:var(--calcite-ui-brand-press);color:var(--calcite-ui-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press)}:host([appearance=outline-fill][kind=brand]) button calcite-loader,:host([appearance=outline-fill][kind=brand]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=outline-fill][kind=danger]) button,:host([appearance=outline-fill][kind=danger]) a{border-color:var(--calcite-ui-danger);background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-danger)}:host([appearance=outline-fill][kind=danger]) button:hover,:host([appearance=outline-fill][kind=danger]) a:hover{border-color:var(--calcite-ui-danger-hover);color:var(--calcite-ui-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover)}:host([appearance=outline-fill][kind=danger]) button:focus,:host([appearance=outline-fill][kind=danger]) a:focus{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger)}:host([appearance=outline-fill][kind=danger]) button:active,:host([appearance=outline-fill][kind=danger]) a:active{border-color:var(--calcite-ui-danger-press);color:var(--calcite-ui-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press)}:host([appearance=outline-fill][kind=danger]) button calcite-loader,:host([appearance=outline-fill][kind=danger]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=outline-fill][kind=neutral]) button,:host([appearance=outline-fill][kind=neutral]) a{background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-border-1)}:host([appearance=outline-fill][kind=neutral]) button:hover,:host([appearance=outline-fill][kind=neutral]) a:hover{box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:focus,:host([appearance=outline-fill][kind=neutral]) a:focus{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:active,:host([appearance=outline-fill][kind=neutral]) a:active{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button calcite-loader,:host([appearance=outline-fill][kind=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline-fill][kind=inverse]) button,:host([appearance=outline-fill][kind=inverse]) a{background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-inverse)}:host([appearance=outline-fill][kind=inverse]) button:hover,:host([appearance=outline-fill][kind=inverse]) a:hover{border-color:var(--calcite-ui-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover)}:host([appearance=outline-fill][kind=inverse]) button:focus,:host([appearance=outline-fill][kind=inverse]) a:focus{border-color:var(--calcite-ui-inverse);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse)}:host([appearance=outline-fill][kind=inverse]) button:active,:host([appearance=outline-fill][kind=inverse]) a:active{border-color:var(--calcite-ui-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press)}:host([appearance=outline-fill][kind=inverse]) button calcite-loader,:host([appearance=outline-fill][kind=inverse]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline]) button,:host([appearance=outline]) a{border-width:1px;border-style:solid;background-color:transparent;box-shadow:inset 0 0 0 1px transparent}:host([appearance=outline][kind=brand]) button,:host([appearance=outline][kind=brand]) a{border-color:var(--calcite-ui-brand);background-color:transparent;color:var(--calcite-ui-brand)}:host([appearance=outline][kind=brand]) button:hover,:host([appearance=outline][kind=brand]) a:hover{border-color:var(--calcite-ui-brand-hover);color:var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}:host([appearance=outline][kind=brand]) button:focus,:host([appearance=outline][kind=brand]) a:focus{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand)}:host([appearance=outline][kind=brand]) button:active,:host([appearance=outline][kind=brand]) a:active{border-color:var(--calcite-ui-brand-press);color:var(--calcite-ui-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press)}:host([appearance=outline][kind=brand]) button calcite-loader,:host([appearance=outline][kind=brand]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=outline][kind=danger]) button,:host([appearance=outline][kind=danger]) a{border-color:var(--calcite-ui-danger);background-color:transparent;color:var(--calcite-ui-danger)}:host([appearance=outline][kind=danger]) button:hover,:host([appearance=outline][kind=danger]) a:hover{border-color:var(--calcite-ui-danger-hover);color:var(--calcite-ui-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover)}:host([appearance=outline][kind=danger]) button:focus,:host([appearance=outline][kind=danger]) a:focus{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger)}:host([appearance=outline][kind=danger]) button:active,:host([appearance=outline][kind=danger]) a:active{border-color:var(--calcite-ui-danger-press);color:var(--calcite-ui-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press)}:host([appearance=outline][kind=danger]) button calcite-loader,:host([appearance=outline][kind=danger]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=outline][kind=neutral]) button,:host([appearance=outline][kind=neutral]) a{background-color:transparent;color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-border-1)}:host([appearance=outline][kind=neutral]) button:hover,:host([appearance=outline][kind=neutral]) a:hover{box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3)}:host([appearance=outline][kind=neutral]) button:focus,:host([appearance=outline][kind=neutral]) a:focus{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline][kind=neutral]) button:active,:host([appearance=outline][kind=neutral]) a:active{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline][kind=neutral]) button calcite-loader,:host([appearance=outline][kind=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline][kind=inverse]) button,:host([appearance=outline][kind=inverse]) a{background-color:transparent;color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-inverse)}:host([appearance=outline][kind=inverse]) button:hover,:host([appearance=outline][kind=inverse]) a:hover{border-color:var(--calcite-ui-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover)}:host([appearance=outline][kind=inverse]) button:focus,:host([appearance=outline][kind=inverse]) a:focus{border-color:var(--calcite-ui-inverse);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse)}:host([appearance=outline][kind=inverse]) button:active,:host([appearance=outline][kind=inverse]) a:active{border-color:var(--calcite-ui-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press)}:host([appearance=outline][kind=inverse]) button calcite-loader,:host([appearance=outline][kind=inverse]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline-fill][split-child=primary]) button,:host([appearance=outline][split-child=primary]) button{border-inline-end-width:0;border-inline-start-width:1px}:host([appearance=outline-fill][split-child=secondary]) button,:host([appearance=outline][split-child=secondary]) button{border-inline-start-width:0;border-inline-end-width:1px}:host([appearance=transparent]:not(.enable-editing-button)) button,:host([appearance=transparent]:not(.enable-editing-button)) a{background-color:transparent}:host([appearance=transparent]:not(.enable-editing-button)) button:hover,:host([appearance=transparent]:not(.enable-editing-button)) button:focus,:host([appearance=transparent]:not(.enable-editing-button)) a:hover,:host([appearance=transparent]:not(.enable-editing-button)) a:focus{background-color:var(--calcite-button-transparent-hover)}:host([appearance=transparent]:not(.enable-editing-button)) button:active,:host([appearance=transparent]:not(.enable-editing-button)) a:active{background-color:var(--calcite-button-transparent-press)}:host([appearance=transparent][kind=brand]) button,:host([appearance=transparent][kind=brand]) a{color:var(--calcite-ui-brand)}:host([appearance=transparent][kind=brand]) button:hover,:host([appearance=transparent][kind=brand]) a:hover{color:var(--calcite-ui-brand-hover)}:host([appearance=transparent][kind=brand]) button:focus,:host([appearance=transparent][kind=brand]) a:focus{color:var(--calcite-ui-brand)}:host([appearance=transparent][kind=brand]) button:active,:host([appearance=transparent][kind=brand]) a:active{color:var(--calcite-ui-brand-press)}:host([appearance=transparent][kind=brand]) button calcite-loader,:host([appearance=transparent][kind=brand]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=transparent][kind=danger]) button,:host([appearance=transparent][kind=danger]) a{color:var(--calcite-ui-danger)}:host([appearance=transparent][kind=danger]) button:hover,:host([appearance=transparent][kind=danger]) a:hover{color:var(--calcite-ui-danger-hover)}:host([appearance=transparent][kind=danger]) button:focus,:host([appearance=transparent][kind=danger]) a:focus{color:var(--calcite-ui-danger)}:host([appearance=transparent][kind=danger]) button:active,:host([appearance=transparent][kind=danger]) a:active{color:var(--calcite-ui-danger-press)}:host([appearance=transparent][kind=danger]) button calcite-loader,:host([appearance=transparent][kind=danger]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) button,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) a,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=transparent][kind=neutral].cancel-editing-button) button{border-block-start-width:1px;border-block-end-width:1px;color:var(--calcite-ui-text-3);border-block-start-color:var(--calcite-ui-border-input);border-block-end-color:var(--calcite-ui-border-input);border-block-style:solid}:host([appearance=transparent][kind=neutral].cancel-editing-button) button:not(.content--slotted){--calcite-button-padding-y-internal:0}:host([appearance=transparent][kind=neutral].cancel-editing-button) button:hover{color:var(--calcite-ui-text-1)}:host([appearance=transparent][kind=neutral].enable-editing-button) button{background-color:transparent}:host(.confirm-changes-button) button:focus,:host(.cancel-editing-button) button:focus,:host(.enable-editing-button) button:focus{outline-offset:-2px}:host([appearance=transparent][kind=inverse]) button,:host([appearance=transparent][kind=inverse]) a,:host([appearance=transparent][kind=inverse]) calcite-loader{color:var(--calcite-ui-text-inverse)}:host([scale=s]) button.content--slotted,:host([scale=s]) a.content--slotted{font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s][appearance=transparent]) button.content--slotted,:host([scale=s][appearance=transparent]) a.content--slotted{--calcite-button-padding-x-internal:0.5rem}:host([scale=s]) button,:host([scale=s]) a{--calcite-button-padding-y-internal:3px}:host([scale=m]) button.content--slotted,:host([scale=m]) a.content--slotted{--calcite-button-padding-x-internal:11px;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) button,:host([scale=m]) a{--calcite-button-padding-y-internal:7px}:host([scale=m][appearance=transparent]) button.content--slotted,:host([scale=m][appearance=transparent]) a.content--slotted{--calcite-button-padding-x-internal:0.75rem}:host([scale=l]) button.content--slotted,:host([scale=l]) a.content--slotted{--calcite-button-padding-x-internal:15px;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) .button-padding{--calcite-button-padding-x-internal:1rem;--calcite-button-padding-y-internal:11px}:host([scale=l]) .button-padding--shrunk{--calcite-button-padding-y-internal:9px}:host([scale=s]) button:not(.content--slotted),:host([scale=s]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:3px;inline-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:1.5rem}:host([scale=m]) button:not(.content--slotted),:host([scale=m]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:7px;inline-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2rem}:host([scale=l]) button:not(.content--slotted),:host([scale=l]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:9px;inline-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2.75rem}:host([scale=l][appearance=transparent]) button:not(.content--slotted),:host([scale=l][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-y-internal:0.625rem}:host([scale=s][icon-start][icon-end]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:23px;block-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=s][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:1.5rem}:host([scale=m][icon-start][icon-end]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:2rem;block-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=m][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:33px}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:43px;block-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted) .icon--start+.icon--end,:host([scale=l][icon-start][icon-end]) a:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:1rem}:host([scale=l][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:2.75rem}:host([hidden]){display:none}[hidden]{display:none}`,lSt=W0(class extends X0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.mutationObserver=eE("mutation",()=>this.updateHasContent()),this.resizeObserver=eE("resize",()=>this.setTooltipText()),this.handleClick=()=>{const{type:t}=this;this.href||(t==="submit"?YTt(this):t==="reset"&&ZTt(this))},this.setTooltipText=()=>{const{contentEl:t}=this;t&&(this.tooltipText=t.offsetWidth<t.scrollWidth?this.el.innerText:null)},this.setChildEl=t=>{this.childEl=t,t&&this.resizeObserver?.observe(t)},this.alignment="center",this.appearance="solid",this.label=void 0,this.kind="brand",this.disabled=!1,this.form=void 0,this.href=void 0,this.iconEnd=void 0,this.iconFlipRtl=void 0,this.iconStart=void 0,this.loading=!1,this.name=void 0,this.rel=void 0,this.round=!1,this.scale="m",this.splitChild=!1,this.target=void 0,this.type="button",this.width="auto",this.messages=void 0,this.messageOverrides=void 0,this.hasContent=!1,this.hasLoader=!1,this.effectiveLocale="",this.defaultMessages=void 0,this.tooltipText=void 0,this.globalAttributes={ariaExpanded:void 0}}loadingChanged(t,e){t&&!e&&(this.hasLoader=!0),!t&&e&&window.setTimeout(()=>{this.hasLoader=!1},300)}onMessagesChange(){}async connectedCallback(){NRe(this),DN(this),zN(this),tMe(this,["aria-expanded"]),this.hasLoader=this.loading,this.setupTextContentObserver(),ZRe(this),this.formEl=XRe(this)}disconnectedCallback(){this.mutationObserver?.disconnect(),FRe(this),iSt(this),NN(this),UN(this),this.resizeObserver?.disconnect(),this.formEl=null,iMe(this)}async componentWillLoad(){Uw(this),this.updateHasContent(),await FN(this)}componentDidLoad(){jw(this),this.setTooltipText()}componentDidRender(){IRe(this)}render(){const t=this.href?"a":"button",e=t,i=this.hasLoader?_t("div",{class:cu.buttonLoader},_t("calcite-loader",{class:this.loading?cu.loadingIn:cu.loadingOut,inline:!0,label:this.messages.loading,scale:this.scale==="l"?"m":"s"})):null,r=!this.iconStart&&!this.iconEnd,n=_t("calcite-icon",{class:{[cu.icon]:!0,[cu.iconStart]:!0},flipRtl:this.iconFlipRtl==="start"||this.iconFlipRtl==="both",icon:this.iconStart,scale:this.scale==="l"?"m":"s"}),s=_t("calcite-icon",{class:{[cu.icon]:!0,[cu.iconEnd]:!0},flipRtl:this.iconFlipRtl==="end"||this.iconFlipRtl==="both",icon:this.iconEnd,scale:this.scale==="l"?"m":"s"}),a=_t("span",{class:cu.content,ref:u=>this.contentEl=u},_t("slot",null));return _t(e,{"aria-label":this.loading?this.messages.loading:rSt(this),"aria-live":"polite",class:{[cu.buttonPadding]:r,[cu.buttonPaddingShrunk]:!r,[cu.contentSlotted]:this.hasContent,[cu.iconStartEmpty]:!this.iconStart,[cu.iconEndEmpty]:!this.iconEnd},disabled:this.disabled||this.loading,href:t==="a"&&this.href,name:t==="button"&&this.name,onClick:this.handleClick,ref:this.setChildEl,rel:t==="a"&&this.rel,tabIndex:this.disabled||this.loading?-1:null,target:t==="a"&&this.target,title:this.tooltipText,type:t==="button"&&this.type,...this.globalAttributes},i,this.iconStart?n:null,this.hasContent?a:null,this.iconEnd?s:null)}async setFocus(){await Bw(this),this.childEl?.focus()}effectiveLocaleChange(){kN(this,this.effectiveLocale)}updateHasContent(){const t=this.el.textContent.trim().length>0||this.el.childNodes.length>0;this.hasContent=this.el.childNodes.length===1&&this.el.childNodes[0]?.nodeName==="#text"?this.el.textContent?.trim().length>0:t}setupTextContentObserver(){this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}onLabelClick(){this.handleClick(),this.setFocus()}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{loading:["loadingChanged"],messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return aSt}},[1,"calcite-button",{alignment:[513],appearance:[513],label:[1],kind:[513],disabled:[516],form:[513],href:[513],iconEnd:[513,"icon-end"],iconFlipRtl:[513,"icon-flip-rtl"],iconStart:[513,"icon-start"],loading:[516],name:[513],rel:[513],round:[516],scale:[513],splitChild:[520,"split-child"],target:[513],type:[513],width:[513],messages:[1040],messageOverrides:[1040],hasContent:[32],hasLoader:[32],effectiveLocale:[32],defaultMessages:[32],tooltipText:[32],globalAttributes:[32],setFocus:[64]}]);function cSt(){if(typeof customElements>"u")return;["calcite-button","calcite-icon","calcite-loader"].forEach(e=>{switch(e){case"calcite-button":customElements.get(e)||customElements.define(e,lSt);break;case"calcite-icon":customElements.get(e)||Vw();break;case"calcite-loader":customElements.get(e)||UR();break}})}cSt();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const uSt=":host{display:flex}ul{margin:0px;display:inline-flex;block-size:100%;align-items:center;padding:0px}:host([layout=vertical]) ul{display:flex;inline-size:100%;flex-direction:column}:host([hidden]){display:none}[hidden]{display:none}",hSt=W0(class extends X0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.menuItems=[],this.handleMenuSlotChange=t=>{this.menuItems=jee(t),this.setMenuItemLayout(this.menuItems,this.layout)},this.label=void 0,this.layout="horizontal",this.messageOverrides=void 0,this.messages=void 0,this.defaultMessages=void 0,this.effectiveLocale="",this.globalAttributes={role:"menubar"}}handleLayoutChange(t){this.setMenuItemLayout(this.menuItems,t)}onMessagesChange(){}effectiveLocaleChange(){kN(this,this.effectiveLocale)}connectedCallback(){DN(this),zN(this),tMe(this,["role"])}async componentWillLoad(){Uw(this),await FN(this)}componentDidLoad(){jw(this)}disconnectedCallback(){NN(this),UN(this),iMe(this)}async setFocus(){await Bw(this),this.el.focus()}calciteInternalNavMenuItemKeyEvent(t){const e=t.target,i=t.detail.children,r=t.detail.event.key;t.stopPropagation(),r==="ArrowDown"?e.layout==="vertical"?U9(this.menuItems,e,"next",!1):t.detail.isSubmenuOpen&&i[0].setFocus():r==="ArrowUp"?this.layout==="vertical"?U9(this.menuItems,e,"previous",!1):t.detail.isSubmenuOpen&&i[i.length-1].setFocus():r==="ArrowRight"?this.layout==="horizontal"?U9(this.menuItems,e,"next",!1):t.detail.isSubmenuOpen&&i[0].setFocus():r==="ArrowLeft"?this.layout==="horizontal"?U9(this.menuItems,e,"previous",!1):t.detail.isSubmenuOpen&&this.focusParentElement(t.target):r==="Escape"&&this.focusParentElement(t.target),t.preventDefault()}focusParentElement(t){const e=t.parentElement;e&&(dRe(e),e.open=!1)}setMenuItemLayout(t,e){t.forEach(i=>{i.layout=e,this.globalAttributes.role==="menubar"&&(i.isTopLevelItem=!0,i.topLevelMenuLayout=this.layout)})}render(){return _t(Jg,null,_t("ul",{"aria-label":this.label,...this.globalAttributes},_t("slot",{onSlotchange:this.handleMenuSlotChange})))}static get delegatesFocus(){return!0}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{layout:["handleLayoutChange"],messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return uSt}},[17,"calcite-menu",{label:[1],layout:[513],messageOverrides:[1040],messages:[1040],defaultMessages:[32],effectiveLocale:[32],globalAttributes:[32],setFocus:[64]},[[0,"calciteInternalMenuItemKeyEvent","calciteInternalNavMenuItemKeyEvent"]]]);function rMe(){if(typeof customElements>"u")return;["calcite-menu"].forEach(e=>{switch(e){case"calcite-menu":customElements.get(e)||customElements.define(e,hSt);break}})}rMe();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const Jn={container:"container",content:"content",dropdownVertical:"dropdown--vertical",dropdownMenuItems:"dropdown-menu-items",dropdownAction:"dropdown-action",layoutVertical:"layout--vertical",hoverHrefIcon:"hover-href-icon",icon:"icon",iconBreadcrumb:"icon--breadcrumb",iconDropdown:"icon--dropdown",iconEnd:"icon--end",iconStart:"icon--start",isParentVertical:"parent--vertical",itemContent:"item-content",open:"open",nested:"nested",textContainer:"text-container"},dSt=`:host{position:relative;box-sizing:border-box;display:flex;align-items:center;flex-shrink:0}:host .container,:host .item-content,:host .content{min-block-size:3rem}:host([layout=vertical]){inline-size:100%}:host(:not([layout=vertical])){block-size:100%}.container,.item-content{display:flex;block-size:100%;inline-size:100%;flex-direction:row;align-items:stretch}.content{position:relative;box-sizing:border-box;display:flex;block-size:100%;inline-size:100%;cursor:pointer;align-items:center;justify-content:center;background-color:var(--calcite-ui-foreground-1);padding-inline:1rem;font-size:var(--calcite-font-size-0);color:var(--calcite-ui-text-2);outline:2px solid transparent;outline-offset:2px;text-decoration:none;border-block-end:0.125rem solid transparent;padding-block-start:0.125rem}.content:hover{background-color:var(--calcite-ui-foreground-2);color:var(--calcite-ui-text-2)}.content:focus{background-color:var(--calcite-ui-foreground-2);color:var(--calcite-ui-text-2);outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.content:active{background-color:var(--calcite-ui-foreground-3);color:var(--calcite-ui-text-1)}.content span{display:inline-flex}.content.layout--vertical{display:flex;inline-size:100%;justify-content:flex-start;padding-block:1rem;border-block-end:0;border-inline-end:0.25rem solid transparent}:host([active]) .content{color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-brand)}:host([active]) .content .icon{--calcite-ui-icon-color:var(--calcite-ui-brand)}:host([layout=vertical]) .content{padding-inline:0.75rem}.icon--start{margin-inline-end:0.75rem}.icon--end{margin-inline-start:0.75rem}:host([layout=vertical]) .icon--end{margin-inline-start:auto;padding-inline-start:0.75rem}.icon--dropdown{position:relative;margin-inline-start:auto;margin-inline-end:0px;padding-inline-start:0.5rem;--calcite-ui-icon-color:var(--calcite-ui-text-3)}:host([layout=vertical]) .icon--end~.icon--dropdown{margin-inline-start:0.75rem}:host([layout=vertical]) .hover-href-icon{padding-inline-start:0.5rem}:host([layout=vertical]) .hover-href-icon~.icon--end{margin-inline-start:0.5rem}:host([layout=vertical]) .hover-href-icon~.icon--breadcrumb{margin-inline-start:0.75rem}.icon--breadcrumb{margin-inline-end:0px;padding-inline-start:0.5rem;--calcite-ui-icon-color:var(--calcite-ui-text-3)}:host([layout=vertical]) .icon--breadcrumb{margin-inline-start:auto}:host([layout=vertical]) .icon--breadcrumb~.icon--dropdown{margin-inline-start:0.5rem}:host([layout=vertical]) .icon--end~.icon--breadcrumb{margin-inline-start:0.5rem}:host([breadcrumb]) .content{padding-inline-end:0.75rem}calcite-action{position:relative;block-size:auto;border-inline-start:1px solid var(--calcite-ui-foreground-1)}calcite-action:after{position:absolute;inset-inline-start:-1px;display:block;inline-size:1px;content:"";inset-block:0.75rem;background-color:var(--calcite-ui-border-3)}calcite-action:hover:after{block-size:100%;inset-block:0}.content:focus~calcite-action,.content:hover~calcite-action{color:var(--calcite-ui-text-1);border-inline-start:1px solid var(--calcite-ui-border-3)}.container:hover .dropdown-action{background-color:var(--calcite-ui-foreground-2)}.dropdown-menu-items{position:absolute;display:none;block-size:auto;min-inline-size:100%;flex-direction:column;overflow:visible;border:1px solid var(--calcite-ui-border-3);background:var(--calcite-ui-foreground-1);inset-block-start:100%;z-index:var(--calcite-app-z-index-dropdown)}.dropdown-menu-items.open{display:block}.dropdown-menu-items.nested{position:absolute;inset-block-start:-1px;transform:translateX(calc(100% - 2px))}.parent--vertical{flex-direction:column}.dropdown--vertical.dropdown-menu-items{position:relative;border-radius:0px;box-shadow:none;inset-block-start:0;transform:none}.dropdown--vertical.dropdown-menu-items:last-of-type{border-inline:0}:host([layout=vertical]:last-of-type) .dropdown-menu-items{border-block-end:0}:host([slot=submenu-item]) .parent--vertical{padding-inline-start:1.5rem}.dropdown-menu-items.nested.calcite--rtl{transform:translateX(calc(-100% + 2px))}.dropdown--vertical.dropdown-menu-items.nested.calcite--rtl{transform:none}.hover-href-icon{position:relative;inset-inline-end:0.25rem;margin-inline-start:auto;opacity:0;transition:all var(--calcite-internal-animation-timing-medium) ease-in-out}.content:focus .hover-href-icon,.content:hover .hover-href-icon{inset-inline-end:-0.25rem;opacity:1}:host([hidden]){display:none}[hidden]{display:none}`,pSt=W0(class extends X0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteInternalMenuItemKeyEvent=_W(this,"calciteInternalMenuItemKeyEvent",7),this.calciteMenuItemSelect=_W(this,"calciteMenuItemSelect",7),this.clickHandler=t=>{(this.href&&t.target===this.dropdownActionEl||!this.href&&this.hasSubmenu)&&(this.open=!this.open),this.selectMenuItem(t)},this.handleMenuItemSlotChange=t=>{this.submenuItems=jee(t),this.submenuItems.forEach(e=>{e.topLevelMenuLayout||(e.topLevelMenuLayout=this.topLevelMenuLayout)}),this.hasSubmenu=this.submenuItems.length>0},this.keyDownHandler=async t=>{if(t.key===" "||t.key==="Enter")this.selectMenuItem(t),this.hasSubmenu&&(!this.href||this.href&&t.target===this.dropdownActionEl)&&(this.open=!this.open),t.preventDefault();else if(t.key==="Escape"){if(this.open){this.open=!1;return}this.calciteInternalMenuItemKeyEvent.emit({event:t}),t.preventDefault()}else if(t.key==="ArrowDown"||t.key==="ArrowUp"){if(t.preventDefault(),(t.target===this.dropdownActionEl||!this.href)&&this.hasSubmenu&&!this.open&&this.layout==="horizontal"){this.open=!0;return}this.calciteInternalMenuItemKeyEvent.emit({event:t,children:this.submenuItems,isSubmenuOpen:this.open&&this.hasSubmenu})}else if(t.key==="ArrowLeft")t.preventDefault(),this.calciteInternalMenuItemKeyEvent.emit({event:t,children:this.submenuItems,isSubmenuOpen:!0});else if(t.key==="ArrowRight"){if(t.preventDefault(),(t.target===this.dropdownActionEl||!this.href)&&this.hasSubmenu&&!this.open&&this.layout==="vertical"){this.open=!0;return}this.calciteInternalMenuItemKeyEvent.emit({event:t,children:this.submenuItems,isSubmenuOpen:this.open&&this.hasSubmenu})}},this.active=void 0,this.breadcrumb=void 0,this.href=void 0,this.iconEnd=void 0,this.iconFlipRtl=void 0,this.iconStart=void 0,this.isTopLevelItem=!1,this.label=void 0,this.layout=void 0,this.messageOverrides=void 0,this.messages=void 0,this.open=!1,this.rel=void 0,this.target=void 0,this.text=void 0,this.topLevelMenuLayout=void 0,this.defaultMessages=void 0,this.effectiveLocale="",this.hasSubmenu=!1,this.submenuItems=void 0}onMessagesChange(){}effectiveLocaleChange(){kN(this,this.effectiveLocale)}async setFocus(){await Bw(this),this.anchorEl.focus()}handleClickOut(t){this.topLevelMenuLayout!=="vertical"&&this.hasSubmenu&&this.open&&!t.composedPath().includes(this.el)&&(this.open=!1)}handleFocusOut(t){this.topLevelMenuLayout!=="vertical"&&!this.el.contains(t.relatedTarget)&&(this.open=!1)}connectedCallback(){DN(this),zN(this)}async componentWillLoad(){Uw(this),await FN(this)}componentDidLoad(){jw(this)}disconnectedCallback(){NN(this),UN(this)}blurHandler(){this.isFocused=!1}focusHandler(t){const e=t.target;this.isFocused=!0,e.open&&!this.open&&(e.open=!1)}selectMenuItem(t){t.target!==this.dropdownActionEl&&this.calciteMenuItemSelect.emit()}renderIconStart(){return _t("calcite-icon",{class:`${Jn.icon} ${Jn.iconStart}`,flipRtl:this.iconFlipRtl==="start"||this.iconFlipRtl==="both",icon:this.iconStart,key:Jn.iconStart,scale:"s"})}renderIconEnd(){return _t("calcite-icon",{class:`${Jn.icon} ${Jn.iconEnd}`,flipRtl:this.iconFlipRtl==="end"||this.iconFlipRtl==="both",icon:this.iconEnd,key:Jn.iconEnd,scale:"s"})}renderBreadcrumbIcon(t){return _t("calcite-icon",{class:`${Jn.icon} ${Jn.iconBreadcrumb}`,icon:t==="rtl"?"chevron-left":"chevron-right",key:Jn.iconBreadcrumb,scale:"s"})}renderDropdownIcon(t){const e=t==="rtl"?"chevron-left":"chevron-right";return _t("calcite-icon",{class:`${Jn.icon} ${Jn.iconDropdown}`,icon:this.topLevelMenuLayout==="vertical"||this.isTopLevelItem?this.open?"chevron-up":"chevron-down":e,key:Jn.iconDropdown,scale:"s"})}renderDropdownAction(t){const e=t==="rtl"?"chevron-left":"chevron-right";return _t("calcite-action",{class:Jn.dropdownAction,icon:this.topLevelMenuLayout==="vertical"||this.isTopLevelItem?this.open?"chevron-up":"chevron-down":e,key:Jn.dropdownAction,onClick:this.clickHandler,onKeyDown:this.keyDownHandler,text:this.messages.open,ref:i=>this.dropdownActionEl=i})}renderSubmenuItems(t){return _t("calcite-menu",{class:{[Jn.dropdownMenuItems]:!0,[Jn.open]:this.open,[Jn.nested]:!this.isTopLevelItem,[xW.rtl]:t==="rtl",[Jn.dropdownVertical]:this.topLevelMenuLayout==="vertical"},label:this.messages.submenu,layout:"vertical",role:"menu"},_t("slot",{name:"submenu-item",onSlotchange:this.handleMenuItemSlotChange}))}renderHrefIcon(t){return _t("calcite-icon",{class:Jn.hoverHrefIcon,icon:t==="rtl"?"arrow-left":"arrow-right",key:Jn.hoverHrefIcon,scale:"s"})}renderItemContent(t){const e=this.href&&(this.topLevelMenuLayout==="vertical"||!this.isTopLevelItem);return _t(qOe,null,this.iconStart&&this.renderIconStart(),_t("div",{class:Jn.textContainer},_t("span",null,this.text)),e&&this.renderHrefIcon(t),this.iconEnd&&this.renderIconEnd(),this.breadcrumb?this.renderBreadcrumbIcon(t):null,!this.href&&this.hasSubmenu?this.renderDropdownIcon(t):null)}render(){const t=aRe(this.el);return _t(Jg,{onBlur:this.blurHandler,onFocus:this.focusHandler},_t("li",{class:{[Jn.container]:!0,[Jn.isParentVertical]:this.topLevelMenuLayout==="vertical"},role:"none"},_t("div",{class:Jn.itemContent},_t("a",{"aria-current":this.isFocused?"page":!1,"aria-expanded":this.open,"aria-haspopup":this.hasSubmenu,"aria-label":this.label,class:{[Jn.layoutVertical]:this.layout==="vertical",[Jn.content]:!0},href:this.href,onClick:this.clickHandler,onKeyDown:this.keyDownHandler,rel:this.rel,role:"menuitem",tabIndex:this.isTopLevelItem?0:-1,target:this.target,ref:e=>this.anchorEl=e},this.renderItemContent(t)),this.href&&this.hasSubmenu?this.renderDropdownAction(t):null),this.renderSubmenuItems(t)))}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return dSt}},[1,"calcite-menu-item",{active:[516],breadcrumb:[516],href:[1],iconEnd:[513,"icon-end"],iconFlipRtl:[513,"icon-flip-rtl"],iconStart:[513,"icon-start"],isTopLevelItem:[4,"is-top-level-item"],label:[1],layout:[513],messageOverrides:[1040],messages:[1040],open:[1540],rel:[513],target:[513],text:[1],topLevelMenuLayout:[1,"top-level-menu-layout"],defaultMessages:[32],effectiveLocale:[32],hasSubmenu:[32],submenuItems:[32],setFocus:[64]},[[8,"click","handleClickOut"],[0,"focusout","handleFocusOut"]]]);function fSt(){if(typeof customElements>"u")return;["calcite-menu-item","calcite-action","calcite-icon","calcite-loader","calcite-menu"].forEach(e=>{switch(e){case"calcite-menu-item":customElements.get(e)||customElements.define(e,pSt);break;case"calcite-action":customElements.get(e)||Gee();break;case"calcite-icon":customElements.get(e)||Vw();break;case"calcite-loader":customElements.get(e)||UR();break;case"calcite-menu":customElements.get(e)||rMe();break}})}fSt();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const fm={container:"container",containerContent:"container-content",hasProgress:"progress-bar",hide:"hide",primary:"primary",secondary:"secondary",tertiary:"tertiary"},Ja={logo:"logo",user:"user",progress:"progress",navigationAction:"navigation-action",contentStart:"content-start",contentEnd:"content-end",contentCenter:"content-center",navSecondary:"navigation-secondary",navTertiary:"navigation-tertiary"},mSt={hamburger:"hamburger"},gSt=":host([hidden]){display:none}[hidden]{display:none}.container{margin-inline:auto;display:flex;inline-size:100%;flex-direction:column;margin-block:0;margin-inline:auto;background-color:var(--calcite-navigation-background, var(--calcite-ui-foreground-1))}.container.primary,.container.secondary,.container.tertiary{border-block-end:1px solid;border-block-end-color:var(--calcite-navigation-border-color, var(--calcite-ui-border-3))}.user,.logo{display:flex}.hide{display:none}.primary{block-size:4rem}.secondary{block-size:3rem}.tertiary{block-size:3rem}.container-content{margin-inline:auto;display:flex;block-size:100%;inline-size:100%;margin-block:0;inline-size:var(--calcite-navigation-width, 100%);max-inline-size:100%}.container-content.progress-bar{margin-block-start:0.125rem}slot[name]{display:flex;flex-direction:row}slot[name=navigation-secondary]::slotted(calcite-navigation),slot[name=navigation-tertiary]::slotted(calcite-navigation){inline-size:100%}slot[name=content-start]::slotted(*),slot[name=content-center]::slotted(*),slot[name=content-end]::slotted(*){display:flex;flex-direction:row;align-items:center}slot[name=progress],slot[name=progress] calcite-progress{inset-block-start:0;inset-inline:0}slot[name=content-end]{margin-inline-start:auto}slot[name=content-start]{margin-inline-end:auto}slot[name=content-end],slot[name=logo]~slot[name=user],slot[name=user]:only-child{margin-inline-start:auto}slot[name=content-center]{margin-inline-start:auto;margin-inline-end:auto}slot[name=content-start]~slot[name=content-center]{margin-inline-start:0px}slot[name=content-start]~slot[name=content-end],slot[name=content-center]~slot[name=content-end],slot[name=content-center]~slot[name=user],slot[name=content-end]~slot[name=user]{margin:0px}",ySt=W0(class extends X0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteNavigationActionSelect=_W(this,"calciteNavigationActionSelect",6),this.actionClickHandler=()=>{this.calciteNavigationActionSelect.emit()},this.handleUserSlotChange=t=>{this.isPrimaryLevel()&&(this.userSlotHasElements=jf(t))},this.handleLogoSlotChange=t=>{this.isPrimaryLevel()&&(this.logoSlotHasElements=jf(t))},this.handleContentStartSlotChange=t=>{this.isPrimaryLevel()&&(this.primaryContentStartSlotHasElements=jf(t))},this.handleContentEndSlotChange=t=>{this.isPrimaryLevel()&&(this.primaryContentEndSlotHasElements=jf(t))},this.handleContentCenterSlotChange=t=>{this.isPrimaryLevel()&&(this.primaryContentCenterSlotHasElements=jf(t))},this.handleSecondarySlotChange=t=>{this.secondarySlotHasElements=jf(t)},this.handleTertiarySlotChange=t=>{this.tertiarySlotHasElements=jf(t)},this.handleMenuActionSlotChange=t=>{this.isPrimaryLevel()&&(this.navigationActionSlotHasElements=jf(t),this.navigationActionSlotHasElements&&(this.navigationAction=!1))},this.handleProgressSlotChange=t=>{this.isPrimaryLevel()&&(this.progressSlotHasElement=jf(t))},this.label=void 0,this.navigationAction=!1,this.logoSlotHasElements=void 0,this.navigationActionSlotHasElements=void 0,this.primaryContentCenterSlotHasElements=void 0,this.primaryContentEndSlotHasElements=void 0,this.primaryContentStartSlotHasElements=void 0,this.progressSlotHasElement=void 0,this.secondarySlotHasElements=void 0,this.tertiarySlotHasElements=void 0,this.userSlotHasElements=void 0}async setFocus(){return await Bw(this),this.navigationActionEl?.setFocus()}componentWillLoad(){Uw(this)}componentDidLoad(){jw(this)}isPrimaryLevel(){return this.el.slot!==Ja.navSecondary&&this.el.slot!==Ja.navTertiary}renderMenuAction(){return _t("slot",{name:Ja.navigationAction,onSlotchange:this.handleMenuActionSlotChange},this.navigationAction&&_t("calcite-action",{icon:mSt.hamburger,onClick:this.actionClickHandler,text:this.label,ref:t=>this.navigationActionEl=t}))}render(){const t=this.logoSlotHasElements||this.userSlotHasElements||this.navigationActionSlotHasElements||this.primaryContentCenterSlotHasElements||this.primaryContentEndSlotHasElements||this.primaryContentStartSlotHasElements||this.navigationAction,e=this.el.slot;return _t(Jg,null,_t("div",{class:{[fm.container]:!0,[fm.secondary]:e===Ja.navSecondary,[fm.tertiary]:e===Ja.navTertiary,[fm.primary]:t}},_t("div",{class:{[fm.hide]:!this.progressSlotHasElement,[Ja.progress]:!0}},_t("slot",{name:Ja.progress,onSlotchange:this.handleProgressSlotChange})),_t("div",{class:{[fm.containerContent]:!0,[fm.hasProgress]:this.progressSlotHasElement}},this.renderMenuAction(),_t("div",{class:{[fm.hide]:!this.logoSlotHasElements,[Ja.logo]:!0}},_t("slot",{name:Ja.logo,onSlotchange:this.handleLogoSlotChange})),_t("slot",{name:Ja.contentStart,onSlotchange:this.handleContentStartSlotChange}),_t("slot",{name:Ja.contentCenter,onSlotchange:this.handleContentCenterSlotChange}),_t("slot",{name:Ja.contentEnd,onSlotchange:this.handleContentEndSlotChange}),_t("div",{class:{[fm.hide]:!this.userSlotHasElements,[Ja.user]:!0}},_t("slot",{name:Ja.user,onSlotchange:this.handleUserSlotChange})))),_t(qOe,null,_t("slot",{name:Ja.navSecondary,onSlotchange:this.handleSecondarySlotChange}),_t("slot",{name:Ja.navTertiary,onSlotchange:this.handleTertiarySlotChange})))}get el(){return this}static get style(){return gSt}},[1,"calcite-navigation",{label:[1],navigationAction:[516,"navigation-action"],logoSlotHasElements:[32],navigationActionSlotHasElements:[32],primaryContentCenterSlotHasElements:[32],primaryContentEndSlotHasElements:[32],primaryContentStartSlotHasElements:[32],progressSlotHasElement:[32],secondarySlotHasElements:[32],tertiarySlotHasElements:[32],userSlotHasElements:[32],setFocus:[64]}]);function vSt(){if(typeof customElements>"u")return;["calcite-navigation","calcite-action","calcite-icon","calcite-loader"].forEach(e=>{switch(e){case"calcite-navigation":customElements.get(e)||customElements.define(e,ySt);break;case"calcite-action":customElements.get(e)||Gee();break;case"calcite-icon":customElements.get(e)||Vw();break;case"calcite-loader":customElements.get(e)||UR();break}})}vSt();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const D1={container:"container",heading:"heading",description:"description",anchor:"anchor",image:"image",standalone:"standalone"},_St=`:host{display:inline-flex;outline:2px solid transparent;outline-offset:2px}.anchor{margin:0px;display:flex;cursor:pointer;align-items:center;justify-content:center;font-size:var(--calcite-font-size-0);line-height:1.25rem;text-decoration-line:none;outline-color:transparent;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;border-block-end:2px solid transparent}.anchor:hover,.anchor:focus{background-color:var(--calcite-ui-foreground-2)}.anchor:focus{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.anchor:active{background-color:var(--calcite-ui-foreground-3)}.image{margin:0px;display:flex;block-size:1.75rem;padding-inline:1rem}.image~.container{padding-inline-start:0px}:host(:active) .anchor{color:var(--calcite-ui-text-1)}:host([active]) .anchor{color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-brand);--calcite-ui-icon-color:var(--calcite-ui-brand)}.container{margin-block-start:0.125rem;display:flex;flex-direction:column;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-inline:1rem;text-align:start}.heading{margin-inline-start:0px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:var(--calcite-font-size-0);font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-1)}.standalone{font-size:var(--calcite-font-size-1)}.description{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:var(--calcite-ui-text-2);font-size:var(--calcite-font-size--1)}:host([hidden]){display:none}[hidden]{display:none}`,bSt=W0(class extends X0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.active=void 0,this.href=void 0,this.label=void 0,this.rel=void 0,this.description=void 0,this.target=void 0,this.heading=void 0,this.thumbnail=void 0}async setFocus(){await Bw(this),this.href&&this.el.focus()}componentWillLoad(){Uw(this)}componentDidLoad(){jw(this)}render(){const{heading:t,description:e,thumbnail:i}=this;return _t(Jg,null,_t("a",{class:D1.anchor,href:this.href,rel:this.rel,target:this.target},i&&_t("img",{alt:this.label||"",class:D1.image,src:i}),(t||e)&&_t("div",{class:D1.container},t&&_t("span",{"aria-label":this.heading,class:{[D1.heading]:!0,[D1.standalone]:!this.description},key:D1.heading},t),e&&_t("span",{"aria-label":this.description,class:D1.description,key:D1.description},e))))}static get delegatesFocus(){return!0}get el(){return this}static get style(){return _St}},[17,"calcite-navigation-logo",{active:[516],href:[513],label:[1],rel:[513],description:[1],target:[513],heading:[1],thumbnail:[1],setFocus:[64]}]);function wSt(){if(typeof customElements>"u")return;["calcite-navigation-logo"].forEach(e=>{switch(e){case"calcite-navigation-logo":customElements.get(e)||customElements.define(e,bSt);break}})}wSt();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const xSt=/^#[0-9A-F]{3}$/i,TSt=/^#[0-9A-F]{6}$/i,SSt=/^#[0-9A-F]{4}$/i,ESt=/^#[0-9A-F]{8}$/i;function AW(t,e=!1){return CSt(t,e)||ASt(t,e)}function nMe(t,e,i){return t?t.length===e&&i.test(t):!1}function CSt(t,e=!1){return nMe(t,e?5:4,e?SSt:xSt)}function ASt(t,e=!1){return nMe(t,e?9:7,e?ESt:TSt)}function OSt(t,e=!1){if(!AW(t,e))return null;t=t.replace("#","");let i,r,n,s;if(t.length===3||t.length===4){const[u,p,y,b]=t.split("");i=parseInt(`${u}${u}`,16),r=parseInt(`${p}${p}`,16),n=parseInt(`${y}${y}`,16),s=parseInt(`${b}${b}`,16)/255}else i=parseInt(t.slice(0,2),16),r=parseInt(t.slice(2,4),16),n=parseInt(t.slice(4,6),16),s=parseInt(t.slice(6,8),16)/255;return isNaN(s)?{r:i,g:r,b:n}:{r:i,g:r,b:n,a:s}}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function RSt(t){let e=0;for(let r=0;r<t.length;r++)e=t.charCodeAt(r)+((e<<5)-e);let i="#";for(let r=0;r<3;r++){const n=e>>r*8&255;i+=("00"+n.toString(16)).substr(-2)}return i}function MSt(t){let{r:e,g:i,b:r}=t;e/=255,i/=255,r/=255;const n=Math.max(e,i,r),s=Math.min(e,i,r),a=n-s;if(n===s)return 0;let u=(n+s)/2;switch(n){case e:u=(i-r)/a+(i<r?6:0);break;case i:u=(r-e)/a+2;break;case r:u=(e-i)/a+4;break}return Math.round(u*60)}function PSt(t){return MSt(OSt(t))}const ISt=":host{display:inline-block;overflow:hidden;border-radius:50%}:host([scale=s]){block-size:1.5rem;inline-size:1.5rem;font-size:var(--calcite-font-size--3)}:host([scale=m]){block-size:2rem;inline-size:2rem;font-size:var(--calcite-font-size--2)}:host([scale=l]){block-size:2.75rem;inline-size:2.75rem;font-size:var(--calcite-font-size-0)}.icon{display:flex}.background{display:flex;block-size:100%;inline-size:100%;align-items:center;justify-content:center;border-radius:50%}.initials{font-weight:var(--calcite-font-weight-bold);text-transform:uppercase;color:var(--calcite-ui-text-2)}.thumbnail{block-size:100%;inline-size:100%;border-radius:50%}:host([hidden]){display:none}[hidden]{display:none}",$St=W0(class extends X0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.scale="m",this.thumbnail=void 0,this.fullName=void 0,this.username=void 0,this.userId=void 0,this.label=void 0,this.thumbnailFailedToLoad=!1}render(){return this.determineContent()}determineContent(){if(this.thumbnail&&!this.thumbnailFailedToLoad)return _t("img",{alt:this.label||"",class:"thumbnail",onError:()=>this.thumbnailFailedToLoad=!0,src:this.thumbnail});const t=this.generateInitials(),e=this.generateFillColor();return _t("span",{"aria-label":this.label||this.fullName,class:"background",role:"figure",style:{backgroundColor:e}},t?_t("span",{"aria-hidden":"true",class:"initials"},t):_t("calcite-icon",{class:"icon",icon:"user",scale:this.scale}))}generateFillColor(){const{userId:t,username:e,fullName:i,el:r}=this,n=bxt(r),s=t&&`#${t.substr(t.length-6)}`,a=e||i||"",u=s&&AW(s)?s:RSt(a);return!t&&!a||!AW(u)?"var(--calcite-ui-foreground-2)":`hsl(${PSt(u)}, 60%, ${n==="dark"?20:90}%)`}generateInitials(){const{fullName:t,username:e}=this;return t?t.trim().split(" ").map(i=>i.substring(0,1)).join(""):e?e.substring(0,2):!1}get el(){return this}static get style(){return ISt}},[1,"calcite-avatar",{scale:[513],thumbnail:[513],fullName:[513,"full-name"],username:[513],userId:[513,"user-id"],label:[1],thumbnailFailedToLoad:[32]}]);function sMe(){if(typeof customElements>"u")return;["calcite-avatar","calcite-icon"].forEach(e=>{switch(e){case"calcite-avatar":customElements.get(e)||customElements.define(e,$St);break;case"calcite-icon":customElements.get(e)||Vw();break}})}sMe();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const ex={textContainer:"text-container",fullName:"full-name",username:"username",button:"button"},LSt=`:host{display:inline-flex;outline:2px solid transparent;outline-offset:2px}:host .button{background-color:transparent;border:none;margin:0px;display:flex;cursor:pointer;align-items:center;justify-content:center;font-family:var(--calcite-sans-family);font-size:var(--calcite-font-size-0);line-height:1.25rem;outline-color:transparent;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;border-block-end:2px solid transparent}:host(:hover) .button,:host(:focus) .button{background-color:var(--calcite-ui-foreground-2)}:host(:focus) .button{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}:host(:active) .button{background-color:var(--calcite-ui-foreground-3);color:var(--calcite-ui-text-1)}calcite-avatar{padding-inline:1rem}calcite-avatar~.text-container{padding-inline-start:0px}:host([active]) .button{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-text-1);--calcite-ui-icon-color:var(--calcite-ui-brand)}.text-container{margin-block-start:0.125rem;display:flex;flex-direction:column;padding-inline:1rem;text-align:start}.full-name{margin-inline-start:0px;font-size:var(--calcite-font-size-0);font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-1)}.username{color:var(--calcite-ui-text-2);font-size:var(--calcite-font-size--1)}:host([hidden]){display:none}[hidden]{display:none}`,DSt=W0(class extends X0{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.active=void 0,this.fullName=void 0,this.label=void 0,this.textDisabled=!1,this.thumbnail=void 0,this.userId=void 0,this.username=void 0}async setFocus(){await Bw(this),this.el.focus()}componentWillLoad(){Uw(this)}componentDidLoad(){jw(this)}render(){return _t(Jg,null,_t("button",{"aria-label":this.label,class:ex.button},_t("calcite-avatar",{"full-name":this.fullName,label:this.label,thumbnail:this.thumbnail,"user-id":this.userId,username:this.username}),(this.fullName||this.username)&&!this.textDisabled&&_t("div",{class:ex.textContainer},this.fullName&&_t("span",{class:ex.fullName,key:ex.fullName},this.fullName),this.username&&_t("span",{class:ex.username,key:ex.username},this.username))))}static get delegatesFocus(){return!0}get el(){return this}static get style(){return LSt}},[17,"calcite-navigation-user",{active:[516],fullName:[1,"full-name"],label:[1],textDisabled:[516,"text-disabled"],thumbnail:[1],userId:[1,"user-id"],username:[1],setFocus:[64]}]);function NSt(){if(typeof customElements>"u")return;["calcite-navigation-user","calcite-avatar","calcite-icon"].forEach(e=>{switch(e){case"calcite-navigation-user":customElements.get(e)||customElements.define(e,DSt);break;case"calcite-avatar":customElements.get(e)||sMe();break;case"calcite-icon":customElements.get(e)||Vw();break}})}NSt();var FSt=Object.defineProperty,kSt=Object.getOwnPropertyDescriptor,Xee=(t,e,i,r)=>{for(var n=r>1?void 0:r?kSt(e,i):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(n=(r?a(e,i,n):a(n))||n);return r&&n&&FSt(e,i,n),n};let $O=class extends tD{constructor(t){super(t),this.userMenuOpen=!1,this.closeUserMenu=()=>{this.userMenuOpen=!1};const e=t.store.view.container;e.addEventListener("mousedown",this.closeUserMenu),this.addHandles([{remove:()=>{e.removeEventListener("mousedown",this.closeUserMenu)}}])}signOut(){this.store.userStore.signOut(),this.closeUserMenu()}openScene(){const t=this.store.map.portalItem.itemPageUrl;t&&window.open(t,"new")}render(){const t=this.userMenuOpen?"":"hide";return Li("div",null,Li("calcite-navigation",{slot:"header"},Li("calcite-navigation-logo",{slot:"logo",heading:this.store.map.portalItem.title,description:"ArcGIS Maps SDK for JavaScript",thumbnail:"./icon-64.svg",onclick:()=>{this.openScene()}}),this.renderUserProfile()),Li("calcite-menu",{id:"user-menu",layout:"vertical",label:"Application menu",class:t},Li("calcite-menu-item",{"icon-start":"sign-out",text:"Sign Out",onclick:()=>this.signOut()})))}renderUserProfile(){const t=this.store.userStore;if(t.authenticated){const e=t.user;return Li("calcite-navigation-user",{slot:"user",active:this.userMenuOpen,onclick:()=>{this.userMenuOpen=!this.userMenuOpen},thumbnail:e?.thumbnailUrl,"full-name":e?.fullName,username:e?.username})}else return Li("calcite-menu",{slot:"content-end"},Li("calcite-menu-item",{onclick:()=>t.signIn(),text:"Sign in","icon-start":"user","text-enabled":!0}))}};Xee([T()],$O.prototype,"store",2);Xee([T()],$O.prototype,"userMenuOpen",2);$O=Xee([Z("arcgis-core-template.Header")],$O);const zSt=$O;var USt=Object.defineProperty,jSt=Object.getOwnPropertyDescriptor,oMe=(t,e,i,r)=>{for(var n=r>1?void 0:r?jSt(e,i):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(n=(r?a(e,i,n):a(n))||n);return r&&n&&USt(e,i,n),n};let oD=class extends tD{postInitialize(){const t=this.store.view,e=new uTt({view:t});t.ui.add(e,"top-right")}render(){return Li("div",null,Li(zSt,{store:this.store}))}};oMe([T()],oD.prototype,"store",2);oD=oMe([Z("arcgis-core-template.App")],oD);const BSt=oD;function VSt(t,e){for(var i=0;i<e.length;i++){const r=e[i];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in t)){const s=Object.getOwnPropertyDescriptor(r,n);s&&Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}var aMe={exports:{}};(function(t,e){function i(){function n(f){if(typeof f=="number")return Q.Tc.Zg(f);if(f==null)return null;if(Ti[f]!=null)return Q.Tc.Zg(Ti[f]);throw Error("Unrecognised Unit Type")}function s(f){if(typeof f=="number")return Q.Tc.Zg(f);if(f==null)return null;if(Dr[f]!=null)return Q.Tc.Zg(Dr[f]);throw Error("Unrecognised Unit Type")}function a(f){if(f)switch(f){case"loxodrome":return 1;case"great-elliptic":return 2;case"normal-section":return 3;case"shape-preserving":return 4}return 0}function u(f,L,x,d){if(x==null||x.B())return null;switch(x.getType()){case Q.qn.Point:return f.exportPoint(L,x,d);case Q.qn.Polygon:return f.exportPolygon(L,x,d);case Q.qn.Polyline:return f.exportPolyline(L,x,d);case Q.qn.MultiPoint:return f.exportMultipoint(L,x,d);case Q.qn.Envelope:return f.exportExtent(L,x,d)}return null}function p(f,L,x,d){if(x.getType()!==Q.qn.Point)throw Error("Geometry not Point");return f.exportPoint(L,x,d)}function y(f,L,x){return f.convertToGEGeometry(L,x)}function b(f){var L=f.wkid;f=f.wkt2||f.wkt;var x=tr.get(L||f);return x==null&&(L!==-1&&L!=null?(x=Q.Eg.create(L),tr.set(L,x)):f&&(x=Q.Eg.qP(f),tr.set(f,x)),Bi.has(L||f)&&x.VW(Bi.get(L||f))),x}function S(f){var L,x,d;if(f==null)return null;var c=b(f);return f=c.Hd(),c=c.Kn(),(L={}).tolerance=c,L.unitType=f==null?-1:f.od,L.unitID=f==null?-1:f.Ec(),L.unitBaseFactor=f==null?0:f.ai,L.unitSquareDerivative=f==null?0:(d=(x=Q.Tc.aG(f))===null||x===void 0?void 0:x.Ec())!==null&&d!==void 0?d:0,L}function C(f,L,x,d){return x==null?null:(x=Q.$b.clip(y(f,je,x),y(f,je,d),b(L)),u(f,je,x,L))}function O(f,L,x,d){x=Q.$b.dl(y(f,je,x),y(f,je,d),b(L)),d=[];for(var c=0;c<x.length;c++)d.push(u(f,je,x[c],L));return d}function P(f,L,x,d){if(x==null||d==null)throw Error("Illegal Argument Exception");return Q.$b.contains(y(f,je,x),y(f,je,d),b(L))}function $(f,L,x,d){if(x==null||d==null)throw Error("Illegal Argument Exception");return Q.$b.BP(y(f,je,x),y(f,je,d),b(L))}function N(f,L,x,d,c){if(x==null||d==null)throw Error("Illegal Argument Exception");return Q.$b.tb(y(f,je,x),y(f,je,d),b(L),n(c))}function z(f,L,x,d){return!(x==null&&d!=null||d==null&&x!=null)&&Q.$b.Nb(y(f,je,x),y(f,je,d),b(L))}function U(f,L,x,d){if(x==null||d==null)throw Error("Illegal Argument Exception");return Q.$b.TS(y(f,je,x),y(f,je,d),b(L))}function j(f,L,x,d){if(x==null||d==null)throw Error("Illegal Argument Exception");return Q.$b.touches(y(f,je,x),y(f,je,d),b(L))}function G(f,L,x,d){if(x==null||d==null)throw Error("Illegal Argument Exception");return Q.$b.qY(y(f,je,x),y(f,je,d),b(L))}function q(f,L,x,d){if(x==null||d==null)throw Error("Illegal Argument Exception");return Q.$b.TP(y(f,je,x),y(f,je,d),b(L))}function W(f,L,x,d){if(x==null||d==null)throw Error("Illegal Argument Exception");return Q.$b.DU(y(f,je,x),y(f,je,d),b(L))}function K(f,L,x,d,c){if(x==null||d==null)throw Error("Illegal Argument Exception");return Q.$b.yB(y(f,je,x),y(f,je,d),b(L),c)}function se(f,L,x){if(x==null)throw Error("Illegal Argument Exception");return Q.$b.dT(y(f,je,x),b(L))}function ae(f,L,x){if(x==null)throw Error("Illegal Argument Exception");return x=Q.$b.eC(y(f,je,x),b(L)),u(f,je,x,L)}function le(f,L,x,d){if(d===void 0&&(d=!1),x==null)throw Error("Illegal Argument Exception");if(Array.isArray(x)){var c=d,o=[];for(d=0;d<x.length;d++)o.push(y(f,je,x[d]));for(x=Q.$b.jP(o,c),c=Array(x.length),d=0;d<x.length;d++)c[d]=u(f,je,x[d],L);return c}return d=Q.$b.iP(y(f,je,x),b(L)),u(f,je,d,L)}function me(f,L,x,d){if(x==null||d==null)throw Error("Illegal Argument Exception");if(Array.isArray(x)){for(var c=[],o=0;o<x.length;o++)c.push(y(f,je,x[o]));for(x=Q.$b.QP(c,y(f,je,d),b(L)),d=Array(x.length),o=0;o<x.length;o++)d[o]=u(f,je,x[o],L);return d}return o=Q.$b.im(y(f,je,x),y(f,je,d),b(L)),u(f,je,o,L)}function ne(f,L,x,d){if(x==null||d==null)throw Error("Illegal Argument Exception");if(Array.isArray(x)){for(var c=[],o=0;o<x.length;o++)c.push(y(f,je,x[o]));for(x=Q.$b.VX(c,y(f,je,d),b(L)),d=Array(x.length),o=0;o<x.length;o++)d[o]=u(f,je,x[o],L);return d}return o=Q.$b.ep(y(f,je,x),y(f,je,d),b(L)),u(f,je,o,L)}function pe(f,L,x,d){if(x==null||d==null)throw Error("Illegal Argument Exception");if(Array.isArray(x)){for(var c=[],o=0;o<x.length;o++)c.push(y(f,je,x[o]));for(x=Q.$b.RS(c,y(f,je,d),b(L)),d=Array(x.length),o=0;o<x.length;o++)d[o]=u(f,je,x[o],L);return d}return o=Q.$b.Ea(y(f,je,x),y(f,je,d),b(L)),u(f,je,o,L)}function ge(f,L,x,d){if(x==null)return null;var c=[];if(Array.isArray(x)){if(x.length===0)return null;for(d=0;d<x.length;d++)c.push(y(f,je,x[d]))}else c.push(y(f,je,x)),d!=null&&c.push(y(f,je,d));return u(f,je,Q.$b.jY(c,b(L)),L)}function ve(f,L,x,d,c,o,l,h){var m=0;if(o!=null)switch(o){case"round":m=0;break;case"bevel":m=1;break;case"miter":m=2;break;case"square":m=3}if(Array.isArray(x)){if(x==null)f=null;else if(x.length===0)f=[];else{var g=[];for(o=0;o<x.length;o++)g.push(y(f,je,x[o]));for(x=Q.$b.BU(g,b(L),d,m,l,h,n(c)),d=Array(x.length),o=0;o<x.length;o++)d[o]=u(f,je,x[o],L);f=d}return f}return x=Q.$b.offset(y(f,je,x),b(L),d,m,l,h,n(c)),u(f,je,x,L)}function Se(f,L,x,d,c,o){if(o===void 0&&(o=!1),Array.isArray(x)){if(!Array.isArray(d)){for(var l=[],h=0;h<x.length;h++)l.push(d);d=l}if(d.length!=x.length){if(d.length==0)throw Error("Illegal Argument Exception");l=[];var m=0;for(h=0;h<x.length;h++)d[h]===void 0?l.push(m):(l.push(d[h]),m=d[h]);d=l}return re(f,L,x,d,c,!1,o,"geodesic",NaN)}return x=Q.$b.buffer(y(f,je,x),b(L),d,n(c),!1,0,NaN),u(f,je,x,L)}function ee(f,L,x,d,c,o,l,h){if(Array.isArray(x)){if(!Array.isArray(d)){for(var m=[],g=0;g<x.length;g++)m.push(d);d=m}if(d.length!==x.length){if(d.length===0)throw Error("Illegal Argument Exception");m=[];var v=0;for(g=0;g<x.length;g++)d[g]===void 0?m.push(v):(m.push(d[g]),v=d[g]);d=m}return re(f,L,x,d,c,!0,o,l,h)}return l===void 0&&(l=NaN),x=Q.$b.buffer(y(f,je,x),b(L),d,n(c),!0,a(o),l),u(f,je,x,L)}function re(f,L,x,d,c,o,l,h,m){if(m===void 0&&(m=NaN),x==null)return null;if(x.length===0)return[];for(var g=[],v=0;v<x.length;v++)g.push(y(f,je,x[v]));for(x=Q.$b.MN(g,b(L),d,n(c),o,l,a(h),m),d=Array(x.length),v=0;v<x.length;v++)d[v]=u(f,je,x[v],L);return d}function fe(f,L,x,d,c){var o;return c===void 0&&(c=!0),x=Q.$b.nz(y(f,je,x),y(f,je,d),c),(o={}).coordinate=p(f,je,x.fz(),L),o.distance=x.hz(),o.isRightSide=x.Sz(),o.vertexIndex=x.Ua(),o.isEmpty=x.B(),o}function ye(f,L,x,d){var c;return x=Q.$b.oz(y(f,je,x),y(f,je,d)),(c={}).coordinate=p(f,je,x.fz(),L),c.distance=x.hz(),c.isRightSide=x.Sz(),c.vertexIndex=x.Ua(),c.isEmpty=x.B(),c}function we(f,L,x,d,c,o){var l;for(x=Q.$b.pz(y(f,je,x),y(f,je,d),c,o),d=[],c=0;c<x.length;c++)x[c].B()===!1&&d.push(((l={}).coordinate=p(f,je,x[c].fz(),L),l.distance=x[c].hz(),l.isRightSide=x[c].Sz(),l.vertexIndex=x[c].Ua(),l.isEmpty=x[c].B(),l));return d}function Ae(f,L,x,d,c,o){return x=Q.$b.QQ(y(f,je,x),b(L),d,c,n(o)),u(f,je,x,L)}function Oe(f,L,x,d,c){return x=Q.$b.Qr(y(f,je,x),b(L),d,n(c)),u(f,je,x,L)}function Ve(f,L,x,d,c,o){return o===void 0&&(o=0),x=Q.$b.Wy(y(f,je,x),b(L),d,n(c),o),u(f,je,x,L)}function at(f,L,x,d){if(x==null)throw Error("Illegal Argument Exception");return Q.$b.JU(y(f,je,x),b(L),s(d))}function Xt(f,L,x,d){if(x==null)throw Error("Illegal Argument Exception");return Q.$b.KU(y(f,je,x),b(L),n(d))}function ti(f,L,x,d,c){if(x==null)throw Error("Illegal Argument Exception");return Q.$b.WQ(y(f,je,x),b(L),s(d),a(c))}function Vt(f,L,x,d,c){if(x==null)throw Error("Illegal Argument Exception");return Q.$b.ZQ(y(f,je,x),b(L),n(d),a(c))}function Qt(f){Q.NL.bind(f)}function St(f,L,x,d,c){var o=null,l=null;if(d){if(!c)throw Q.i.N("AOI missing Spatial Reference");o=y(f,je,d),l=b(c).fh()}return(f=Q.gu.XR(b(L).fh(),b(x).fh(),o,l))!==null?f:null}function ze(f,L,x,d,c){var o=null,l=null;if(d){if(!c)throw Q.i.N("AOI missing Spatial Reference");o=y(f,je,d),l=b(c).fh()}return Q.gu.YR(b(L).fh(),b(x).fh(),o,l)}function ni(f,L,x,d,c,o){if(c===void 0&&(c=null),o===void 0&&(o=null),o){var l=new Q.yC;l.Vu=o.densificationStep,l.Jr=o.centralMeridianOfOutputGCS,o.clipWithInputHorizon&&l.PW(o.clipWithInputHorizon),o.clipWithOutputHorizon&&l.QW(o.clipWithOutputHorizon)}if(this.KY===!1)throw Error("Projection Engine must be enabled using enableProjection");if(L.length===0)return[];if(c){if(!(o=c.getCachedGeTransformation(x,d)))e:{if(o=c,c=null,o){var h=o.getGTListEntry();if(h!==null){c=new Q.wC(null);for(var m=0,g=h.steps;m<g.length;m++){h=g[m];var v=new Q.Dx(h.geogtran);h.isInverse&&v.Qz(),c.add(v)}l=Q.vr.Nr(b(x).fh(),b(d).fh(),c,l),o.assignCachedGe(x,d,l),o=l;break e}}if(c===null&&o&&o.steps&&0<o.steps.length){for(c=new Q.wC(null),m=0,g=o.steps;m<g.length;m++)(h=g[m]).wkid!=-1&&h.wkid!=null?c.add(Q.Dx.create(h.wkid,h.isInverse)):c.add(Q.Dx.uP(h.wkt,h.isInverse));l=Q.vr.Nr(b(x).fh(),b(d).fh(),c,l),o.assignCachedGe(x,d,l),o=l}else o=Q.vr.Nr(b(x).fh(),b(d).fh(),c,l)}for(x=[],c=0;c<L.length;c++)l=L[c],x.push(Ye(f,l,d,o))}else for(o=Q.vr.Nr(b(x).fh(),b(d).fh(),null),x=[],c=0;c<L.length;c++)l=L[c],x.push(Ye(f,l,d,o));return x}function Ye(f,L,x,d){return L=Q.$b.zh(y(f,je,L),d),u(f,je,L,x)}function gt(f,L){f!=null&&(f=f.wkid||f.wkt2||f.wkt,Bi.has(f),Bi.set(f,L),tr.has(f)&&tr.delete(f))}function Nt(f){f!=null&&(f=f.wkid||f.wkt2||f.wkt,Bi.has(f)&&(Bi.delete(f),tr.has(f)&&tr.delete(f)))}function Jt(f,L,x,d){if(x==null||d==null)return[];var c=[],o=0;for(x=Q.$b.QS(y(f,je,x),y(f,je,d),b(L))||[];o<x.length;o++)c.push(u(f,je,x[o],L));return c}var Tt,Q,pt,ii,bt=this&&this.__extends||function(){function f(L,x){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,c){d.__proto__=c}||function(d,c){for(var o in c)c.hasOwnProperty(o)&&(d[o]=c[o])})(L,x)}return function(L,x){function d(){this.constructor=L}f(L,x),L.prototype=x===null?Object.create(x):(d.prototype=x.prototype,new d)}}();(function(f){var L;(L=f.qn||(f.qn={}))[L.Unknown=0]="Unknown",L[L.Point=33]="Point",L[L.Line=322]="Line",L[L.Envelope=197]="Envelope",L[L.MultiPoint=550]="MultiPoint",L[L.Polyline=1607]="Polyline",L[L.Polygon=1736]="Polygon",function(d){d[d.enumMild=0]="enumMild",d[d.enumMedium=1]="enumMedium",d[d.enumHot=2]="enumHot"}(f.YK||(f.YK={}));var x=function(){function d(){this.description=null,this.VA=0}return d.prototype.getType=function(){return 0},d.prototype.Db=function(){return-1},d.prototype.Nf=function(c){this.vc(),c!=this.description&&this.sn(c)},d.prototype.sn=function(){},d.prototype.Jl=function(c){this.vc(),c!=this.description&&(c=f.ee.CR(this.description,c))!=this.description&&this.sn(c)},d.prototype.hasAttribute=function(c){return this.description.hasAttribute(c)},d.prototype.re=function(c){this.vc(),this.description.hasAttribute(c)||(c=f.ee.BR(this.description,c),this.sn(c))},d.prototype.Tg=function(){return null},d.prototype.bn=function(){},d.prototype.A=function(){},d.prototype.Qo=function(){},d.prototype.xc=function(c){this.A(c)},d.prototype.B=function(){return!0},d.prototype.Oa=function(){},d.prototype.Oc=function(){},d.prototype.Ia=function(){return null},d.prototype.copyTo=function(){},d.prototype.Ke=function(){return 0},d.prototype.Qb=function(){return 0},d.prototype.iG=function(){return this.hasAttribute(1)},d.tf=function(c){return 1+((192&c)>>6)>>1},d.Rn=function(c){return(32&c)!=0},d.US=function(c){return(128&c)!=0},d.yd=function(c){return(256&c)!=0},d.xj=function(c){return(512&c)!=0},d.Hc=function(c){return(1024&c)!=0},d.prototype.Of=function(){var c=this.Ia();return this.copyTo(c),c},d.prototype.mg=function(){return null},d.jg=function(c){var o=c.Ia();return c.copyTo(o),o},d.prototype.vc=function(){0<=this.VA&&(this.VA+=2147483649)},d.Ax=function(c){var o=c.getType();if(d.xj(o))return c.I();if(c.B())return 0;if(o==197)return 4;if(o==33)return 1;if(d.yd(o))return 2;throw f.i.fa("missing type")},d}();f.aa=x})(Q||(Q={})),pt=Q||(Q={}),ii=function(){function f(){this.y=this.x=0}return f.construct=function(L,x){var d=new f;return d.x=L,d.y=x,d},f.al=function(L){var x=new f;return x.x=L.x,x.y=L.y,x},f.prototype.ma=function(L,x){this.x=L,this.y=x},f.prototype.L=function(L){this.x=L.x,this.y=L.y},f.prototype.fq=function(L,x){return this.x===L&&this.y===x},f.prototype.Rz=function(L){return 2220446049250313e-31>=Math.abs(this.x-L.x)&&2220446049250313e-31>=Math.abs(this.y-L.y)},f.prototype.qb=function(L){return this.x===L.x&&this.y===L.y},f.prototype.Nb=function(L){return L==this||L instanceof f&&this.x==L.x&&this.y==L.y},f.prototype.sub=function(L){this.x-=L.x,this.y-=L.y},f.prototype.uc=function(L,x){this.x=L.x-x.x,this.y=L.y-x.y},f.prototype.add=function(L,x){x!==void 0?(this.x=L.x+x.x,this.y=L.y+x.y):(this.x+=L.x,this.y+=L.y)},f.prototype.Sq=function(){this.x=-this.x,this.y=-this.y},f.prototype.mt=function(L){this.x=-L.x,this.y=-L.y},f.prototype.NS=function(L,x,d){this.x=L.x*(1-d)+x.x*d,this.y=L.y*(1-d)+x.y*d},f.prototype.Ct=function(L,x){this.x=this.x*L+x.x,this.y=this.y*L+x.y},f.prototype.HW=function(L,x,d){this.x=x.x*L+d.x,this.y=x.y*L+d.y},f.prototype.scale=function(L){this.x*=L,this.y*=L},f.prototype.compare=function(L){return this.y<L.y?-1:this.y>L.y?1:this.x<L.x?-1:this.x>L.x?1:0},f.prototype.normalize=function(){var L=this.length();L==0&&(this.x=1,this.y=0),this.x/=L,this.y/=L},f.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},f.prototype.Sk=function(){return this.x*this.x+this.y*this.y},f.tb=function(L,x){return Math.sqrt(this.yc(L,x))},f.Oy=function(L,x,d,c){return L-=d,x-=c,Math.sqrt(L*L+x*x)},f.prototype.Qh=function(L){return this.x*L.x+this.y*L.y},f.prototype.fD=function(L){return Math.abs(this.x*L.x)+Math.abs(this.y*L.y)},f.prototype.wi=function(L){return this.x*L.y-this.y*L.x},f.prototype.Bt=function(L,x){var d=-this.x*x+this.y*L;this.x=this.x*L+this.y*x,this.y=d},f.prototype.Hv=function(){var L=this.x;this.x=-this.y,this.y=L},f.prototype.MG=function(L){this.x=-L.y,this.y=L.x},f.prototype.ar=function(){var L=this.x;this.x=this.y,this.y=-L},f.prototype.qu=function(){return 0<this.x?0<=this.y?1:4:0<this.y?2:this.x==0?4:3},f.nu=function(L,x){var d=L.qu(),c=x.qu();return c==d?0>(L=L.wi(x))?1:0<L?-1:0:d<c?-1:1},f.yc=function(L,x){var d=L.x-x.x;return d*d+(L=L.y-x.y)*L},f.prototype.toString=function(){return"("+this.x+" , "+this.y+")"},f.prototype.Rc=function(){this.y=this.x=NaN},f.prototype.isNaN=function(){return isNaN(this.x)||isNaN(this.y)},f.prototype.offset=function(L,x){var d=f.tb(L,x),c=f.construct(this.x,this.y);if(d==0)return f.tb(c,L);var o=new f;return o.L(x),o.sub(L),c.sub(L),c.wi(o)/d},f.Uq=function(L,x,d){var c=new pt.Wb;c.set(x.x),c.sub(L.x);var o=new pt.Wb;o.set(d.y),o.sub(L.y);var l=new pt.Wb;l.set(x.y),l.sub(L.y);var h=new pt.Wb;return h.set(d.x),h.sub(L.x),c.Ag(o),l.Ag(h),c.sub(l),c.ps()?(c=new pt.hp(x.x),o=new pt.hp(L.x),l=new pt.hp(L.y),c=c.jt(o),L=(L=new pt.hp(d.y)).jt(l),x=(x=new pt.hp(x.y)).jt(l),d=(d=new pt.hp(d.x)).jt(o),c=c.lr(L),x=x.lr(d),(c=c.lr(x)).nT()?-1:c.fS()?1:0):0>(d=c.value())?-1:0<d?1:0},f.prototype.cc=function(){return pt.O.uj(pt.O.uj())},f}(),pt.h=ii,function(f){var L=function(){function x(d){this.Fy=this.Mt=0,this.OX=d}return x.prototype.reset=function(){this.Fy=this.Mt=0},x.prototype.add=function(d){d-=this.Fy;var c=this.Mt+d;this.Fy=c-this.Mt-d,this.Mt=c},x.prototype.sub=function(d){this.add(-d)},x.prototype.rm=function(){return this.OX+this.Mt},x}();f.Fx=L,f.lc=function(){function x(){}return x.Cn=function(d,c){return 0<=c?Math.abs(d):-Math.abs(d)},x.sign=function(d){return 0>d?-1:0<d?1:0},x.RK=function(d){return d-360*Math.floor(d/360)},x.round=function(d){return Math.floor(d+.5)},x.ox=function(d){return d*d},x.hq=function(d,c,o){return .5>=o?d+(c-d)*o:c-(c-d)*(1-o)},x.OG=function(d,c,o,l){.5>=o?(l.x=d.x+(c.x-d.x)*o,l.y=d.y+(c.y-d.y)*o):(l.x=c.x-(c.x-d.x)*(1-o),l.y=c.y-(c.y-d.y)*(1-o))},x.lT=function(d,c,o,l,h,m){.5>=h?(m.x=d+(o-d)*h,m.y=c+(l-c)*h):(m.x=o-(o-d)*(1-h),m.y=l-(l-c)*(1-h))},x}()}(Q||(Q={})),function(f){var L=function(x){function d(){var c=x.call(this)||this;return c.sa=0,c.na=0,c.pa=0,c.la=0,c.ka=null,c}return bt(d,x),d.prototype.ac=function(){return f.h.construct(this.sa,this.na)},d.prototype.Yp=function(c){c.x=this.sa,c.y=this.na},d.prototype.Dc=function(c){this.em(0,c)},d.prototype.ZB=function(c,o){this.em(0,f.h.construct(c,o))},d.prototype.To=function(c){this.hD(0,c)},d.prototype.setStart=function(c){this.uD(0,c)},d.prototype.wv=function(c,o){return this.Od(0,c,o)},d.prototype.YB=function(c,o,l){this.tn(0,c,o,l)},d.prototype.wc=function(){return f.h.construct(this.pa,this.la)},d.prototype.Tr=function(c){c.x=this.pa,c.y=this.la},d.prototype.Qc=function(c){this.em(1,c)},d.prototype.Ql=function(c,o){this.em(1,f.h.construct(c,o))},d.prototype.Po=function(c){this.hD(1,c)},d.prototype.setEnd=function(c){this.uD(1,c)},d.prototype.gv=function(c,o){return this.Od(1,c,o)},d.prototype.OB=function(c,o,l){this.tn(1,c,o,l)},d.prototype.Db=function(){return 1},d.prototype.B=function(){return this.Ac()},d.prototype.Oa=function(){},d.prototype.Ke=function(){return 0},d.prototype.Ea=function(c,o,l,h,m){return this.KM(c,o,l,h,m)},d.prototype.isIntersecting=function(c,o){return this.zr(c,o,!1)!=0},d.prototype.qs=function(c,o){return this.ru(c,o,!1)},d.prototype.ru=function(){return null},d.prototype.Ac=function(){return!1},d.prototype.ay=function(c){if(this.vc(),this.ka==null&&0<c)this.ka=f.O.lg(2*c);else if(this.ka!=null&&this.ka.length<2*c){for(var o=this.ka.slice(0),l=this.ka.length;l<2*c;l++)o[l]=0;this.ka=o}},d.gM=function(c,o,l){if(0<l)var h=0;for(var m=0;m<l;m++)o[0+h]=c[0],h++},d.prototype.em=function(c,o){c!=0?(this.pa=o.x,this.la=o.y):(this.sa=o.x,this.na=o.y)},d.prototype.sn=function(c){if(this.ka!=null){for(var o=f.ee.Iw(c,this.description),l=[],h=d.Gg(this.description,0),m=d.Gg(this.description,1),g=d.Gg(c,0),v=d.Gg(c,1),w=0,E=1,A=c.Aa;E<A;E++){var M=c.kd(E),I=f.ra.Va(M);if(o[E]==-1){var D=f.ra.se(M);for(M=0;M<I;M++)l[g+w]=D,l[v+w]=D,w++}else for(D=this.description.$j(o[E])-2,M=0;M<I;M++)l[g+w]=this.ka[h+D],l[v+w]=this.ka[m+D],w++,D++}this.ka=l}this.description=c},d.prototype.hD=function(c,o){if(this.Ac())throw f.i.fa("empty geometry");o.Nf(this.description),o.Ac()&&o.un();for(var l=0;l<this.description.Aa;l++)for(var h=this.description.Ed(l),m=0,g=f.ra.Va(h);m<g;m++){var v=this.Od(c,h,m);o.setAttribute(h,m,v)}},d.prototype.uD=function(c,o){if(this.vc(),o.Ac())throw f.i.fa("empty geometry");for(var l=o.description,h=0,m=l.Aa;h<m;h++)for(var g=l.Ed(h),v=f.ra.Va(g),w=0;w<v;w++){var E=o.Uc(g,w);this.tn(c,g,w,E)}},d.prototype.Od=function(c,o,l){if(this.Ac())throw f.i.fa("This operation was performed on an Empty Geometry.");if(o==0)return c!=0?l!=0?this.la:this.pa:l!=0?this.na:this.sa;if(l>=f.ra.Va(o))throw f.i.ce();var h=this.description.Pf(o);return 0<=h?(this.ka!=null&&this.ay(this.description.Ae.length-2),this.ka[d.Gg(this.description,c)+this.description.$j(h)-2+l]):f.ra.se(o)},d.prototype.tn=function(c,o,l,h){if(this.vc(),l>=f.ra.Va(o))throw f.i.ce();var m=this.description.Pf(o);0>m&&(this.re(o),m=this.description.Pf(o)),o==0?c!=0?l!=0?this.la=h:this.pa=h:l!=0?this.na=h:this.sa=h:(this.ka==null&&this.ay(this.description.Ae.length-2),this.ka[d.Gg(this.description,c)+this.description.$j(m)-2+l]=h)},d.prototype.copyTo=function(c){if(c.getType()!=this.getType())throw f.i.N();c.description=this.description,c.ay(this.description.Ae.length-2),d.gM(this.ka,c.ka,2*(this.description.Ae.length-2)),c.sa=this.sa,c.na=this.na,c.pa=this.pa,c.la=this.la,c.vc(),this.op(c)},d.prototype.Tg=function(c,o){var l=new f.Nc;return this.Ac()?(l.Oa(),l):(l.oa=this.Od(0,c,o),l.va=l.oa,l.Lk(this.Od(1,c,o)),l)},d.prototype.ZI=function(c){this.Ac()?c.Oa():(c.oa=this.Od(0,0,0),c.va=c.oa,c.Lk(this.Od(1,0,0)))},d.prototype.Tw=function(c,o){o.Nf(this.description),o.Cb(this.hc(c));for(var l=1,h=this.description.Aa;l<h;l++)for(var m=this.description.Ed(l),g=f.ra.Va(m),v=0;v<g;v++){var w=this.Uc(c,m,v);o.setAttribute(m,v,w)}},d.prototype.FM=function(c){if(this.description!=c.description||this.sa!=c.sa||this.pa!=c.pa||this.na!=c.na||this.la!=c.la)return!1;for(var o=0;o<2*(this.description.Ae.length-2);o++)if(this.ka[o]!=c.ka[o])return!1;return!0},d.prototype.BG=function(){return this.sa==this.pa&&this.na==this.la},d.prototype.reverse=function(){var c=this.sa;this.sa=this.pa,this.pa=c,c=this.na,this.na=this.la,this.la=c,c=1;for(var o=this.description.Aa;c<o;c++)for(var l=this.description.kd(c),h=0,m=f.ra.Va(l);h<m;h++){var g=this.Od(0,l,h),v=this.Od(1,l,h);this.tn(0,l,h,v),this.tn(1,l,h,g)}},d.prototype.zr=function(c,o,l){var h=this.getType(),m=c.getType();if(h===322){if(m==322)return f.yb.OM(this,c,o,l);throw f.i.Qa()}throw f.i.Qa()},d.prototype.KM=function(c,o,l,h,m){var g=this.getType(),v=c.getType();if(g===322){if(v==322)return f.yb.Zx(this,c,o,l,h,m);throw f.i.Qa()}throw f.i.Qa()},d.prototype.Tx=function(){return null},d.Gg=function(c,o){return o*(c.Ae.length-2)},d.prototype.hc=function(c,o){if(o===void 0)return o=new f.h,this.hc(c,o),o;f.lc.lT(this.sa,this.na,this.pa,this.la,c,o)},d.prototype.fe=function(){return null},d.prototype.eG=function(){return null},d.prototype.cq=function(){return null},d.prototype.Bi=function(){return null},d.prototype.Pn=function(){return null},d.prototype.kg=function(){return null},d.prototype.Ux=function(c,o){return o!==void 0?this.vx(o)-this.vx(c):this.vx(c)},d.prototype.op=function(){},d.prototype.dl=function(){return null},d.prototype.ah=function(){},d.prototype.Uc=function(){return null},d.prototype.Pe=function(){return null},d.prototype.vx=function(){return null},d.prototype.NG=function(){return null},d.prototype.tb=function(c,o){if(!o&&this.zr(c,0,!1)!=0)return 0;o=17976931348623157e292;var l=this.ac(),h=c.fe(l,!1);return l.sub(c.hc(h)),(l=l.length())<o&&(o=l),l=this.wc(),h=c.fe(l,!1),l.sub(c.hc(h)),(l=l.length())<o&&(o=l),l=c.ac(),h=this.fe(l,!1),l.sub(this.hc(h)),(l=l.length())<o&&(o=l),l=c.wc(),h=this.fe(l,!1),l.sub(this.hc(h)),(l=l.length())<o&&(o=l),o},d.prototype.mg=function(){return f.pi.gm(this,null)},d}(f.aa);f.SC=L}(Q||(Q={})),new Q.h,function(f){var L;(L=f.$K||(f.$K={}))[L.Unknown=-1]="Unknown",L[L.Not=0]="Not",L[L.Weak=1]="Weak",L[L.Strong=2]="Strong",function(d){d[d.DirtyIsKnownSimple=1]="DirtyIsKnownSimple",d[d.IsWeakSimple=2]="IsWeakSimple",d[d.IsStrongSimple=4]="IsStrongSimple",d[d.DirtyOGCFlags=8]="DirtyOGCFlags",d[d.DirtyVerifiedStreams=32]="DirtyVerifiedStreams",d[d.DirtyExactIntervals=64]="DirtyExactIntervals",d[d.DirtyLooseIntervals=128]="DirtyLooseIntervals",d[d.DirtyIntervals=192]="DirtyIntervals",d[d.DirtyIsEnvelope=256]="DirtyIsEnvelope",d[d.DirtyLength2D=512]="DirtyLength2D",d[d.DirtyRingAreas2D=1024]="DirtyRingAreas2D",d[d.DirtyCoordinates=1993]="DirtyCoordinates",d[d.DirtyAllInternal=65535]="DirtyAllInternal",d[d.DirtyAll=16777215]="DirtyAll"}(f.MK||(f.MK={}));var x=function(d){function c(){var o=d.call(this)||this;return o.Hm=65535,o.wa=0,o.Pg=-1,o.Bb=null,o}return bt(c,d),c.prototype.op=function(){},c.prototype.$x=function(){},c.prototype.iy=function(){},c.prototype.I=function(){return this.wa},c.prototype.B=function(){return this.Ac()},c.prototype.Ac=function(){return this.wa==0},c.prototype.ak=function(o){return(this.Hm&o)!=0},c.prototype.Lf=function(o,l){this.Hm=l?this.Hm|o:this.Hm&~o},c.prototype.mc=function(){this.ak(32)&&this.bN()},c.prototype.wx=function(){if(this.Ac())throw f.i.fa("This operation was performed on an Empty Geometry.")},c.prototype.ve=function(o,l){if(0>o||o>=this.wa)throw f.i.fa("index out of bounds");this.mc(),l.Nf(this.description),l.B()&&l.un();for(var h=0;h<this.description.Aa;h++)for(var m=this.description.Ed(h),g=0,v=f.ra.Va(m);g<v;g++){var w=this.za[h].eg(v*o+g);l.setAttribute(m,g,w)}},c.prototype.Ht=function(o,l){this.mc();for(var h=l.description,m=0;m<h.Aa;m++)for(var g=h.Ed(m),v=f.ra.Va(g),w=0;w<v;w++){var E=l.Uc(g,w);this.setAttribute(g,o,w,E)}},c.prototype.D=function(o,l){if(0>o||o>=this.I())throw f.i.ce();this.mc(),this.za[0].tc(2*o,l)},c.prototype.Na=function(o){var l=new f.h;return this.D(o,l),l},c.prototype.Gc=function(o,l){this.za[0].tc(2*o,l)},c.prototype.Cb=function(o,l,h){if(0>o||o>=this.wa)throw f.i.ce();this.mc();var m=this.za[0];h!==void 0?(m.write(2*o,l),m.write(2*o+1,h)):m.Tt(2*o,l),this.Pc(1993)},c.prototype.Cz=function(){if(void 0>=this.I())throw f.i.ce();this.mc();var o=this.za[0],l=new f.Nd;return l.x=o.read(NaN),l.y=o.read(NaN),l.z=this.hasAttribute(1)?this.za[1].eg():f.ra.se(1),l},c.prototype.dC=function(o){if(0>o||o>=this.I())throw f.i.ce();this.re(1),this.mc(),this.Pc(1993);var l=this.za[0];l.write(2*o,(void 0).x),l.write(2*o+1,(void 0).y),this.za[1].pr(o,(void 0).z)},c.prototype.Uc=function(o,l,h){if(0>l||l>=this.wa)throw f.i.ce();var m=f.ra.Va(o);if(h>=m)throw f.i.ce();this.mc();var g=this.description.Pf(o);return 0<=g?this.za[g].eg(l*m+h):f.ra.se(o)},c.prototype.yF=function(o,l){return this.Uc(o,l)},c.prototype.setAttribute=function(o,l,h,m){if(0>l||l>=this.wa)throw f.i.ce();var g=f.ra.Va(o);if(h>=g)throw f.i.ce();this.re(o),this.mc(),o=this.description.Pf(o),this.Pc(1993),this.za[o].pr(l*g+h,m)},c.prototype.ub=function(o){return this.wx(),this.re(o),this.mc(),this.za[this.description.Pf(o)]},c.prototype.hn=function(o,l){if(l!=null&&f.ra.Tp(o)!=l.Tp())throw f.i.N();this.re(o),o=this.description.Pf(o),this.za==null&&(this.za=f.Yc.qI(this.description.Aa)),this.za[o]=l,this.Pc(16777215)},c.prototype.sn=function(o){var l=null;if(this.za!=null){var h=f.ee.Iw(o,this.description);l=[];for(var m=0,g=o.Aa;m<g;m++)h[m]!=-1&&(l[m]=this.za[h[m]])}this.description=o,this.za=l,this.Pg=-1,this.Pc(16777215)},c.prototype.AD=function(o){this.wu(!0),o instanceof f.l?this.$.A(o):this.$.Qo(o)},c.prototype.aN=function(o){this.wu(!1),o instanceof f.l?this.$.A(o):this.$.Qo(o)},c.prototype.bn=function(o){this.wu(!0),this.$.copyTo(o)},c.prototype.A=function(o){this.AD(o)},c.prototype.Qo=function(o){this.AD(o)},c.prototype.xc=function(o){this.aN(o)},c.prototype.Tg=function(o,l){var h=new f.Nc;return this.Ac()?(h.Oa(),h):(this.wu(!0),this.$.Tg(o,l))},c.prototype.cc=function(){var o=this.description.cc();if(!this.Ac())for(var l=this.I(),h=0,m=this.description.Aa;h<m;h++)o=this.za[h].An(o,0,l*f.ra.Va(this.description.Ed(h)));return o},c.prototype.Nb=function(o){if(o==this)return!0;if(!(o instanceof c&&this.description.Nb(o.description))||this.Ac()!=o.Ac())return!1;if(this.Ac())return!0;var l=this.I();if(l!=o.I())return!1;for(var h=0;h<this.description.Aa;h++){var m=this.description.kd(h),g=this.ub(m),v=o.ub(m);if(!g.Nb(v,0,l*f.ra.Va(m)))return!1}return!0},c.prototype.copyTo=function(o){if(o.getType()!=this.getType())throw f.i.N();this.dD(o)},c.prototype.dD=function(o){this.mc(),o.description=this.description,o.za=null;var l=this.description.Aa,h=null;if(this.za!=null){h=[];for(var m=0;m<l;m++)this.za[m]!=null&&(h[m]=this.za[m].GB(this.I()*f.ra.Va(this.description.Ed(m))))}this.$!=null?(o.$=this.$.Ia(),this.$.copyTo(o.$)):o.$=null,o.wa=this.wa,o.Hm=this.Hm,o.za=h;try{this.op(o)}catch{throw o.Oa(),f.i.fu()}},c.prototype.wD=function(){this.wa=0,this.Pg=-1,this.za=null,this.Pc(16777215)},c.prototype.Pc=function(o){o==16777215&&(this.Pg=-1,this.$x()),this.Hm|=o,this.lM(),this.vc()},c.prototype.wu=function(o){if(this.mc(),this.ak(192))if(this.$==null?this.$=new f.Fh(this.description):this.$.Nf(this.description),this.B())this.$.Oa();else{this.hy(o);for(var l=1;l<this.description.Aa;l++)for(var h=this.description.Ed(l),m=f.ra.Va(h),g=this.za[l],v=0;v<m;v++){var w=new f.Nc;w.Oa();for(var E=0;E<this.wa;E++){var A=g.eg(E*m+v);w.Zb(A)}this.$.setInterval(h,v,w)}o&&this.Lf(192,!1)}},c.prototype.hy=function(){this.$.Oa();for(var o=this.za[0],l=new f.h,h=0;h<this.wa;h++)o.tc(2*h,l),this.$.Zb(l)},c.prototype.yp=function(o){o.Oa();for(var l=this.za[0],h=new f.h,m=0;m<this.wa;m++)l.tc(2*m,h),o.Zb(h)},c.prototype.bN=function(){if(this.Pg<this.wa){this.za==null&&(this.za=f.Yc.qI(this.description.Aa)),this.Pg=2147483647;for(var o=0;o<this.description.Aa;o++){var l=this.description.Ed(o);if(this.za[o]!=null){var h=f.ra.Va(l),m=f.O.truncate(this.za[o].size/h);m<this.wa&&(m=f.O.truncate(this.Pg>this.wa+5?(5*this.wa+3)/4:this.wa),this.za[o].resize(m*h,f.ra.se(l))),m<this.Pg&&(this.Pg=m)}else this.za[o]=f.Yc.YE(l,this.wa),this.Pg=this.wa}}this.iy(),this.Lf(32,!1)},c.prototype.dm=function(o){if(0>o)throw f.i.N();o!=this.wa&&(this.wa=o,this.Pc(65535))},c.prototype.om=function(o){if(!this.ak(1)){if(!this.ak(2))return 0;if(this.QT>=o)return this.ak(8)?1:2}return-1},c.prototype.Ch=function(o,l){if(this.QT=l,o==-1)this.Lf(1,!0),this.Lf(8,!0);else if(this.Lf(1,!1),this.Lf(8,!0),o==0)this.Lf(2,!1),this.Lf(4,!1);else if(o==1)this.Lf(2,!0),this.Lf(4,!1);else{if(o!=2)throw f.i.fa("internal error.");this.Lf(2,!0),this.Lf(4,!0)}},c.prototype.lM=function(){this.Bb!=null&&(this.Bb=null)},c.prototype.kD=function(o,l,h,m){if(0>o||o>=this.wa||0>l||l>=this.wa)throw f.i.fa("index out of bounds");this.mc(),m.Nf(this.description),m.B()&&m.un();for(var g=0;g<this.description.Aa;g++)for(var v=this.description.Ed(g),w=0,E=f.ra.Va(v);w<E;w++){var A=this.za[g].eg(E*o+w),M=this.za[g].eg(E*l+w);m.setAttribute(v,w,f.lc.hq(A,M,h))}},c.prototype.yr=function(o,l){var h=this.za[0].o,m=h[2*o]-h[2*l];return o=h[2*o+1]-h[2*l+1],Math.sqrt(m*m+o*o)},c.prototype.KR=function(o){if(0>o||o>=this.wa)throw f.i.ce();this.mc();var l=new f.Sa;l.Nf(this.description),l.B()&&l.un();for(var h=0;h<this.description.Aa;h++)for(var m=this.description.kd(h),g=0,v=f.ra.Va(m);g<v;g++){var w=this.za[h].eg(v*o+g);l.setAttribute(m,g,w)}return l},c.prototype.Dh=function(o,l){if(0>o||o>=this.wa)throw f.i.ce();if(l.B())throw f.i.N();this.mc();for(var h=l.description,m=0;m<h.Aa;m++)for(var g=h.kd(m),v=f.ra.Va(g),w=0;w<v;w++){var E=l.Uc(g,w);this.setAttribute(g,o,w,E)}},c.prototype.lu=function(){return null},c.prototype.fj=function(){return null},c}(f.aa);f.Gx=x}(Q||(Q={})),function(f){var L=function(){function x(){this.ob=this.Zn=null,this.Tm=124234251,this.Rv=!0,this.Qe=-1,this.ob=new f.$c(7),this.Zn=null}return x.prototype.Vo=function(d){this.Zn=d},x.prototype.RP=function(){this.Rv=!1},x.prototype.De=function(d){this.ob.De(d)},x.prototype.Pr=function(d){var c=this.ob.Ce();return this.rX(c),this.uX(d,c),c},x.prototype.MP=function(d){this.ob.jd(d)},x.prototype.addElement=function(d,c){return c==-1&&(this.Qe==-1&&(this.Qe=this.Pr(-1)),c=this.Qe),this.FD(d,0,c)},x.prototype.KD=function(d){return this.Qe==-1&&(this.Qe=this.Pr(-1)),this.FD(d,1,this.Qe)},x.prototype.xn=function(d){this.Qe==-1&&(this.Qe=this.Pr(-1));var c=this.Qe,o=this.ob.o;if(c==-1||o[7*c]==-1)return d=this.ob.Ll([-1,-1,-1,d,this.gl(),-1,-1]),(o=this.ob.o)[7*c]=d,this.vp(-1,d,c,o),d;var l=c==-1?-1:o[7*c+2];return d=this.ob.Ll([-1,-1,l,d,this.gl(),-1,-1]),(o=this.ob.o)[7*l+1]=d,this.oy(d,o),o[7*d+2]===-1&&(o[7*c]=d),this.vp(-1,d,c,o),d},x.prototype.zu=function(d,c,o,l){var h=-1;h==-1&&(this.Qe==-1&&(this.Qe=this.Pr(-1)),h=this.Qe);var m=this.ob.o;if(h==-1||m[7*h]==-1)return o=this.ob.Ll([-1,-1,-1,o,this.gl(),-1,-1]),(m=this.ob.o)[7*h]=o,this.vp(-1,o,h,m),o;if(l){l=c!=-1?this.Zn.compare(this,o,c):-1;var g=d!=-1?this.Zn.compare(this,o,d):1}else l=-1,g=1;if(l==0||g==0)return m[7*h+3]=l==0?c:d,-1;for((c!=-1&&d!=-1?this.Tm>f.O.bB(this.Tm)>>1:c!=-1)?d=c:l=g,c=!0;;){if(0>l){if((g=m[7*d])==-1){l=d,o=this.ob.Ll([-1,-1,d,o,this.gl(),-1,-1]),(m=this.ob.o)[7*d]=o;break}d=g}else{if((g=m[7*d+1])==-1){l=m[7*d+6],o=this.ob.Ll([-1,-1,d,o,this.gl(),-1,-1]),(m=this.ob.o)[7*d+1]=o;break}d=g}c&&(l*=-1,c=!1)}return this.oy(o,m),m[7*o+2]===-1&&(m[7*h]=o),this.vp(l,o,h,m),o},x.prototype.FF=function(){return this.iR(this.Qe)},x.prototype.vd=function(d,c){c=c==-1?this.Qe:c,this.Rv?this.LP(d,c):this.iY(d,c)},x.prototype.search=function(d,c){for(c=this.sv(c);c!=-1;){var o=this.Zn.compare(this,d,c);if(o==0)return c;c=0>o?this.ll(c):this.Xp(c)}return-1},x.prototype.IW=function(d){for(var c=this.sv(-1),o=-1;c!=-1;){var l=d.compare(this,c);if(l==0)return c;0>l?c=this.ll(c):(o=c,c=this.Xp(c))}return o},x.prototype.uJ=function(d){for(var c=this.sv(-1),o=-1;c!=-1;){var l=d.compare(this,c);if(l==0)return c;0>l?(o=c,c=this.ll(c)):c=this.Xp(c)}return o},x.prototype.ja=function(d){return this.ob.T(d,3)},x.prototype.ll=function(d){return this.ob.T(d,0)},x.prototype.Xp=function(d){return this.ob.T(d,1)},x.prototype.getParent=function(d){return this.ob.T(d,2)},x.prototype.lb=function(d){return this.ob.T(d,6)},x.prototype.we=function(d){return this.ob.T(d,5)},x.prototype.rc=function(d){return d==-1?this.kl(this.Qe):this.kl(d)},x.prototype.Fc=function(d){return d==-1?this.Zr(this.Qe):this.Zr(d)},x.prototype.ZR=function(d){return d==-1?this.bG(this.Qe):this.bG(d)},x.prototype.Sj=function(d,c){this.NB(d,c)},x.prototype.sv=function(d){return d==-1?this.YF(this.Qe):this.YF(d)},x.prototype.clear=function(){this.ob.mj(!1),this.Qe=-1},x.prototype.size=function(d){return d==-1?this.$F(this.Qe):this.$F(d)},x.prototype.KN=function(d,c){for(var o=c[7*d],l=c[7*d+1],h=c[7*d+4];o!=-1||l!=-1;){var m=o!=-1?c[7*o+4]:2147483647;if(l=l!=-1?c[7*l+4]:2147483647,h<=Math.min(m,l))break;m<=l?this.sJ(o,c):this.rJ(d,c),o=c[7*d],l=c[7*d+1]}},x.prototype.oy=function(d,c){if(this.Rv)for(var o=c[7*d+4],l=c[7*d+2];l!=-1&&c[7*l+4]>o;)c[7*l]==d?this.sJ(d,c):this.rJ(l,c),l=c[7*d+2]},x.prototype.rJ=function(d,c){var o=c[7*d+1];c[7*o+2]=c[7*d+2],c[7*d+2]=o;var l=c[7*o];c[7*d+1]=l,l!=-1&&(c[7*l+2]=d),c[7*o]=d,(l=c[7*o+2])!=-1&&(c[7*l]==d?c[7*l]=o:c[7*l+1]=o)},x.prototype.sJ=function(d,c){var o=c[7*d+2];c[7*d+2]=c[7*o+2],c[7*o+2]=d;var l=c[7*d+1];c[7*o]=l,l!=-1&&(c[7*l+2]=o),c[7*d+1]=o,(l=c[7*d+2])!=-1&&(c[7*l]===o?c[7*l]=d:c[7*l+1]=d)},x.prototype.Pk=function(d,c){this.ob.S(d,2,c)},x.prototype.TB=function(d,c){this.ob.S(d,0,c)},x.prototype.XB=function(d,c){this.ob.S(d,1,c)},x.prototype.WB=function(d,c){this.ob.S(d,5,c)},x.prototype.ex=function(d,c){this.ob.S(d,6,c)},x.prototype.XJ=function(d,c){this.ob.S(c,0,d)},x.prototype.rX=function(d){this.ob.S(d,4,0)},x.prototype.uX=function(d,c){this.ob.S(c,5,d)},x.prototype.YF=function(d){return d==-1?-1:this.ob.T(d,0)},x.prototype.kl=function(d){return d==-1?-1:this.ob.T(d,1)},x.prototype.Zr=function(d){return d==-1?-1:this.ob.T(d,2)},x.prototype.iR=function(d){return d==-1?-1:this.ob.T(d,3)},x.prototype.$F=function(d){return d==-1?0:this.ob.T(d,4)},x.prototype.bG=function(d){return this.ob.T(d,5)},x.prototype.Pw=function(){return this.ob.Ll([-1,-1,-1,void 0,this.gl(),-1,-1])},x.prototype.fl=function(d){d!=-1&&this.ob.jd(d)},x.prototype.gl=function(){return this.Tm=f.O.bB(this.Tm),1073741823&this.Tm},x.prototype.FD=function(d,c,o){var l=this.ob.o;if(o==-1||l[7*o]==-1)return d=this.ob.Ll([-1,-1,-1,d,this.gl(),-1,-1]),(l=this.ob.o)[7*o]=d,this.vp(-1,d,o,l),d;for(var h=o==-1?-1:l[7*o];;){var m=c==-1?1:this.Zn.compare(this,d,h);if(0>m){if((m=this.ll(h))==-1){c=h,d=this.ob.Ll([-1,-1,h,d,this.gl(),-1,-1]),(l=this.ob.o)[7*h]=d;break}h=m}else{if(c==1&&m==0)return l[7*o+3]=h,-1;if((m=l[7*h+1])==-1){c=l[7*h+6],d=this.ob.Ll([-1,-1,h,d,this.gl(),-1,-1]),(l=this.ob.o)[7*h+1]=d;break}h=m}}return this.oy(d,l),l[7*d+2]===-1&&(l[7*o]=d),this.vp(c,d,o,l),d},x.prototype.vp=function(d,c,o,l){if(d!=-1){var h=l[7*d+5];l[7*d+5]=c}else h=o==-1?-1:l[7*o+2];l[7*c+5]=h,h!=-1&&(l[7*h+6]=c),l[7*c+6]=d,d==(o==-1?-1:l[7*o+1])&&(l[7*o+1]=c),d==-1&&(l[7*o+2]=c),l[7*o+4]=(o==-1?0:l[7*o+4])+1},x.prototype.AB=function(d,c){var o=this.ob.o,l=o[7*d+5];d=o[7*d+6],l!=-1?o[7*l+6]=d:o[7*c+1]=d,d!=-1?o[7*d+5]=l:o[7*c+2]=l,o[7*c+4]=c===-1?-1:o[7*c+4]-1},x.prototype.iY=function(d,c){this.AB(d,c);var o=this.ll(d),l=this.Xp(d),h=this.getParent(d),m=d;if(o!=-1&&l!=-1){this.Tm=f.O.bB(this.Tm);var g=1073741823<this.Tm?this.lb(d):this.we(d),v=this.getParent(g)==d;this.ob.gC(d,g,0),this.ob.gC(d,g,1),this.ob.gC(d,g,2),h!=-1?this.ll(h)==d?this.TB(h,g):this.XB(h,g):this.XJ(g,c),v?(o==g?(this.TB(g,d),this.Pk(l,g)):l==g&&(this.XB(g,d),this.Pk(o,g)),this.Pk(d,g),h=g):(this.Pk(o,g),this.Pk(l,g),h=this.getParent(d),m=g),o=this.ll(d),l=this.Xp(d),o!=-1&&this.Pk(o,d),l!=-1&&this.Pk(l,d)}o=o!=-1?o:l,h==-1?this.XJ(o,c):this.ll(h)==m?this.TB(h,o):this.XB(h,o),o!=-1&&this.Pk(o,h),this.fl(d)},x.prototype.LP=function(d,c){var o=this.ob.o;o[7*d+4]=2147483647;var l=-1,h=-1,m=c===-1?-1:o[7*c],g=m==d;if(g&&(l=o[7*m],h=o[7*m+1],l==-1&&h==-1))return this.AB(m,c),this.fl(m),void(o[7*c]=-1);this.KN(d,o),(m=o[7*d+2])!=-1&&(o[7*m]==d?o[7*m]=-1:o[7*m+1]=-1),this.AB(d,c),this.fl(d),g&&(o[7*c]=l==-1||o[7*l+2]!=-1?h:l)},x.prototype.NB=function(d,c){this.ob.S(d,3,c)},x}();f.Yj=L}(Q||(Q={})),function(f){var L=function(){function x(d,c){d!==void 0&&this.K(d,c)}return x.prototype.K=function(d,c){this.oa=d,this.va=c,this.normalize()},x.prototype.isIntersecting=function(d){return this.oa<=d.oa?this.va>=d.oa:d.va>=this.oa},x.prototype.move=function(d){this.B()||(this.oa+=d,this.va+=d)},x.prototype.normalize=function(){if(!isNaN(this.oa)){if(this.oa>this.va){var d=this.oa;this.oa=this.va,this.va=d}isNaN(this.va)&&this.Oa()}},x.prototype.Oa=function(){this.va=this.oa=NaN},x.prototype.B=function(){return isNaN(this.oa)},x.prototype.Zb=function(d){typeof d=="number"?this.B()?this.va=this.oa=d:this.Lk(d):d.B()||(this.B()?(this.oa=d.oa,this.va=d.va):(this.oa>d.oa&&(this.oa=d.oa),this.va<d.va&&(this.va=d.va),this.oa>this.va&&this.Oa()))},x.prototype.Lk=function(d){d<this.oa?this.oa=d:d>this.va&&(this.va=d)},x.prototype.contains=function(d){return typeof d=="number"?d>=this.oa&&d<=this.va:d.oa>=this.oa&&d.va<=this.va},x.prototype.Ea=function(d){this.B()||d.B()?this.Oa():(this.oa<d.oa&&(this.oa=d.oa),this.va>d.va&&(this.va=d.va),this.oa>this.va&&this.Oa())},x.prototype.W=function(d){this.B()||(this.oa-=d,this.va+=d,this.va<this.oa&&this.Oa())},x.prototype.xr=function(){return this.B()?2220446049250313e-29:2220446049250313e-29*(Math.abs(this.oa)+Math.abs(this.va)+1)},x.prototype.KB=function(d,c){d>c?(this.oa=c,this.va=d):(this.oa=d,this.va=c)},x.prototype.It=function(d){return f.O.Rk(d,this.oa,this.va)},x.prototype.R=function(){return this.va-this.oa},x.prototype.sf=function(){return .5*(this.oa+this.va)},x.prototype.Nb=function(d){return d==this||d instanceof x&&(!(!this.B()||!d.B())||this.oa==d.oa&&this.va==d.va)},x.prototype.cc=function(){return f.O.uj(f.O.uj())},x}();f.Nc=L}(Q||(Q={})),function(f){var L=new f.Nc,x=new f.Nc,d=function(){this.ne=null,this.pb=-1,this.sb=new f.yb,this.qA=55555555,this.Tv=this.Vv=!1,this.Uf=new f.Nc,this.Uf.KB(0,0)};f.IY=d;var c=function(){function o(l,h,m){this.g=l,this.Hk=NaN,this.NH=this.Kq=0,this.OH=NaN,this.qa=h,this.Nq=10*h,this.PH=this.QH=NaN,this.rg=!1,this.Dm=this.gt=this.Lo=this.Xs=this.Ws=-1,this.gA=m,this.TA=new d,this.YH=new d,f.O.truncate(3*l.fd/2)}return o.prototype.mG=function(l,h,m,g){l.ne=g===null?null:g[m[5*h]],l.Tv=l.ne!=null,l.Tv||((g=m[5*h+2])!==-1&&this.g.mW(m[5*h],m[5*g],l.sb),l.ne=l.sb,l.Uf.KB(l.sb.sa,l.sb.pa),l.Uf.va+=this.qa,l.sb.rI(),l.Vv=l.sb.la==l.sb.na,l.Vv||(l.qA=(l.sb.pa-l.sb.sa)/(l.sb.la-l.sb.na)))},o.prototype.OO=function(l,h){var m=l.zr(h,this.qa,!0);return m!=0?m==2?this.Qy():this.xi():(l.Yp(Ot),l.Tr(It),h.Yp(Rt),h.Tr(pi),ci.ma(this.Kq,this.Hk),Ot.qb(Rt)&&this.Hk==Ot.y?0>It.compare(pi)?ci.L(It):ci.L(pi):Ot.qb(pi)&&this.Hk==Ot.y?0>It.compare(Rt)?ci.L(It):ci.L(Rt):Rt.qb(It)&&this.Hk==Rt.y?0>Ot.compare(pi)?ci.L(Ot):ci.L(pi):It.qb(pi)&&this.Hk==It.y&&(0>Ot.compare(Rt)?ci.L(Ot):ci.L(Rt)),l.Pe(ci.y,ci.x)<h.Pe(ci.y,ci.x)?-1:1)},o.prototype.MO=function(l,h){if(l.sb.na==h.sb.na&&l.sb.sa==h.sb.sa)return l.sb.la==h.sb.la&&l.sb.pa==h.sb.pa?this.gA?this.Qy():0:this.PE(l,h);if(l.sb.la==h.sb.la&&l.sb.pa==h.sb.pa)return this.OE(l,h);var m=this.OE(l,h);return l=this.PE(l,h),0>m&&0>l?-1:0<m&&0<l?1:this.xi()},o.prototype.IO=function(l,h){if(l.pa>h.pa){if(h.pa>h.sa&&h.la-h.na<2*this.qa&&l.vi(h.pa,h.la,this.qa))return this.xi()}else if((h.la-h.na)/(h.pa-h.sa)*(l.pa-l.sa)<this.Nq&&h.vi(l.pa,l.la,this.qa))return this.xi();return 1},o.prototype.JO=function(l,h){if(l.sa<h.sa){if(h.pa>h.sa&&h.la-h.na<2*this.qa&&l.vi(h.pa,h.la,this.qa))return this.xi()}else if((h.la-h.na)/(h.pa-h.sa)*(l.sa-l.pa)<this.Nq&&h.vi(l.sa,l.na,this.qa))return this.xi();return-1},o.prototype.KO=function(l,h){var m=new f.h;m.uc(h.wc(),h.ac()),m.ar(),m.normalize();var g=new f.h;g.uc(l.ac(),h.ac());var v=new f.h;v.uc(l.wc(),h.ac()),g=g.Qh(m),m=v.Qh(m),v=Math.abs(g);var w=Math.abs(m);if(v<w){if(v<this.Nq&&h.vi(l.sa,l.na,this.qa))return this.xi()}else if(w<this.Nq&&h.vi(l.pa,l.la,this.qa))return this.xi();return 0>g&&0>m?-1:0<g&&0<m?1:this.xi()},o.prototype.NE=function(l,h){return l.na==h.na&&l.sa==h.sa?this.IO(l,h):l.la==h.la&&l.pa==h.pa?this.JO(l,h):this.KO(l,h)},o.prototype.LO=function(l,h){return l.la==h.la&&l.pa==h.pa&&l.na==h.na&&l.sa==h.sa?this.gA?this.Qy():0:this.xi()},o.prototype.OE=function(l,h){var m=1;if(l.sb.na<h.sb.na){m=-1;var g=l;l=h,h=g}l=l.sb,g=h.sb;var v=l.sa-g.sa;h=h.qA*(l.na-g.na);var w=this.Nq;return v<h-w?-m:v>h+w?m:g.vi(l.sa,l.na,this.qa)?this.xi():v<h?-m:m},o.prototype.PE=function(l,h){var m=1;if(h.sb.la<l.sb.la){m=-1;var g=l;l=h,h=g}l=l.sb,g=h.sb;var v=l.pa-g.sa;h=h.qA*(l.la-g.na);var w=this.Nq;return v<h-w?-m:v>h+w?m:g.vi(l.pa,l.la,this.qa)?this.xi():v<h?-m:m},o.prototype.Qy=function(){return this.rg=!0,this.Ni=new f.Md(5,this.Lo,this.gt),-1},o.prototype.xi=function(){return this.rg=!0,this.gA?this.Ni=new f.Md(4,this.Lo,this.gt):this.gt=this.Lo=this.Xs=this.Ws=-1,-1},o.prototype.NO=function(l,h,m,g){if(this.rg)return-1;var v=this.OH==this.Hk&&this.NH==this.Kq;if(v&&l==this.Ws)var w=this.PH;else w=NaN,this.Ws=-1;return v&&h==this.Xs?v=this.QH:(v=NaN,this.Xs=-1),m.ne.ZI(L),g.ne.ZI(x),L.va<x.oa?-1:x.va<L.oa?1:(this.OH=this.Hk,this.NH=this.Kq,isNaN(w)&&(this.Ws=l,this.PH=w=l=m.ne.Pe(this.Hk,this.Kq)),isNaN(v)&&(this.Xs=h,this.QH=v=l=g.ne.Pe(this.Hk,this.Kq)),Math.abs(w-v)<=this.qa?this.OO(m.ne,g.ne):w<v?-1:w>v?1:0)},o.prototype.Kr=function(){this.rg=!1},o.prototype.rm=function(){return this.Ni},o.prototype.$J=function(l,h){this.Hk=l,this.Kq=h,this.gt=this.Lo=this.Xs=this.Ws=-1},o.prototype.compare=function(l,h,m){return this.rg?-1:(l=l.ja(m),this.Dm=m,this.RE(h,h,l,l))},o.prototype.RE=function(l,h,m,g){if(this.Lo==h)var v=this.TA;else this.Lo=h,v=this.TA,this.TA.pb=l,this.mG(v,h,this.g.td.o,this.g.We);if(w==null){this.gt=g;var w=this.YH;this.YH.pb=m,this.mG(w,g,this.g.td.o,this.g.We)}return v.Tv||w.Tv?this.NO(h,g,v,w):v.Uf.va<w.Uf.oa?-1:w.Uf.va<v.Uf.oa?1:(l=v.Vv?1:0,(l|=w.Vv?2:0)==0?this.MO(v,w):l==1?this.NE(v.sb,w.sb):l==2?-1*this.NE(w.sb,v.sb):this.LO(v.sb,w.sb))},o}();f.UC=c}(Q||(Q={})),function(f){var L=function(){function x(d,c){this.g=d,this.qa=c,this.rg=!1,this.Lo=-1,this.Uf=new f.Nc,this.Gq=new f.h,this.Gq.Rc(),this.ie=new f.yb,this.Dm=-1,this.BA=17976931348623157e292}return x.prototype.Kr=function(){this.rg=!1,this.BA=17976931348623157e292},x.prototype.Dh=function(d){this.Gq.L(d)},x.prototype.compare=function(d,c){return this.SE(c,d.ja(c))},x.prototype.SE=function(d,c){var o=this.g.bc(c)!=null;if(o||(this.g.ed(c,this.ie),this.Uf.KB(this.ie.sa,this.ie.pa)),o)throw f.i.fa("not implemented");if(this.Gq.x+this.qa<this.Uf.oa)return-1;if(this.Gq.x-this.qa>this.Uf.va)return 1;if(this.ie.na==this.ie.la)return this.Dm=d,this.rg=!0,0;this.ie.rI(),o=this.ie.ac(),(c=new f.h).uc(this.ie.wc(),o),c.ar();var l=new f.h;return l.uc(this.Gq,o),o=c.Qh(l),(o/=c.length())<10*-this.qa?-1:o>10*this.qa?1:this.ie.qs(this.Gq,this.qa)&&((c=Math.abs(o))<this.BA&&(this.Dm=d,this.BA=c),this.rg=!0,c<.25*this.qa)?0:0>o?-1:1},x}();f.aM=L}(Q||(Q={})),function(f){function L(d,c,o,l){o=new Float64Array(d.subarray(o,l)),d.set(o,c)}var x=function(){function d(c){this.Pb=this.pk=!1,this.o=null;var o=c;2>o&&(o=2),this.o=new Float64Array(o),this.size=c}return d.prototype.rotate=function(c,o,l){if(this.Pb)throw f.i.fa("invalid_call");if(o<c||o>l||c>l)throw f.i.N();c!=o&&l!=o&&(this.ni(c,o-c,1),this.ni(o,l-o,1),this.ni(c,l-c,1))},d.qf=function(c,o){var l=new d(c),h=l.o;if(2>c&&(c=2),o!==0)for(var m=0;m<c;m++)h[m]=o;return l},d.Bn=function(c){var o=new d(0);return o.o=new Float64Array(c.o),o.size=c.size,o},d.Lr=function(c,o){var l=new d(0);return l.size=c.size,l.size>o&&(l.size=o),2>(o=l.size)&&(o=2),l.o=new Float64Array(o),l.o.set(c.o.length<=o?c.o:c.o.subarray(0,o),0),l},d.prototype.Jb=function(c){0>=c||(this.o==null?this.o=new Float64Array(c):c<=this.o.length||(0<this.o.length?((c=new Float64Array(c)).set(this.o),this.o=c):this.o=new Float64Array(c)))},d.prototype.read=function(c){return this.o[c]},d.prototype.tc=function(c,o){o.x=this.o[c],o.y=this.o[c+1]},d.prototype.get=function(c){return this.o[c]},d.prototype.write=function(c,o){if(this.Pb)throw f.i.Hb();this.o[c]=o},d.prototype.set=function(c,o){if(this.Pb)throw f.i.Hb();this.o[c]=o},d.prototype.Tt=function(c,o){if(this.Pb)throw f.i.Hb();this.o[c]=o.x,this.o[c+1]=o.y},d.prototype.add=function(c){this.resize(this.size+1),this.o[this.size-1]=c},d.prototype.GB=function(c){return d.Lr(this,c)},d.prototype.eg=function(c){return this.read(c)},d.prototype.resize=function(c,o){if(o===void 0&&(o=0),this.pk)throw f.i.fa("invalid call. Attribute Stream is locked and cannot be resized.");if(c<=this.size){if(30<this.o.length&&5*c/4<this.o.length){var l=new Float64Array(this.o,0,c);this.o=l}}else{c>this.o.length&&(l=f.O.truncate(64>c?Math.max(2*c,4):5*c/4),(l=new Float64Array(l)).set(this.o),this.o=l),l=this.o;for(var h=this.size;h<c;h++)l[h]=o}this.size=c},d.prototype.Bh=function(c){if((this.o==null||c>this.o.length)&&this.resize(c),this.pk)throw f.i.fa("invalid call. Attribute Stream is locked and cannot be resized.");this.size=c},d.prototype.pr=function(c,o){this.write(c,o)},d.prototype.An=function(c,o,l){for(var h=this.size;o<h&&o<l;o++)c=f.O.uj(this.read(o));return c},d.prototype.Nb=function(c,o,l){if(c==null||!(c instanceof d))return!1;var h=this.size,m=c.size;if(l>h||l>m&&h!=m)return!1;for(l>h&&(l=h);o<l;o++)if(this.read(o)!=c.read(o))return!1;return!0},d.prototype.addRange=function(c,o,l,h,m){if(this.Pb)throw f.i.Hb();if(!h&&(1>m||l%m!=0))throw f.i.N();var g=this.size;if(this.resize(g+l),h)this.o.set(c.o.subarray(o,o+l),g);else{h=l;for(var v=0;v<l;v+=m){h-=m;for(var w=0;w<m;w++)this.o[g+v+w]=c.o[o+h+w]}}},d.prototype.Mn=function(c,o,l,h,m,g,v){if(this.Pb)throw f.i.Hb();if(!m&&(1>g||h%g!=0))throw f.i.N();var w=this.size-v;if(w<h&&this.resize(this.size+h-w),L(this.o,c+h,c,c+(v-c)),this.o==o.o&&c<l&&(l+=h),m)this.o.set(o.o.subarray(l,l+h),c);else for(m=h,v=0;v<h;v+=g)for(m-=g,w=0;w<g;w++)this.o[c+v+w]=o.o[l+m+w]},d.prototype.Iz=function(c,o,l,h,m,g){if(this.Pb)throw f.i.Hb();if(0>g&&(g=this.size),this.size+2*h>this.o.length?this.resize(this.size+2*h):this.size+=2*h,L(this.o,c+2*h,c,c+(g-c)),m)for(m=0;m<h;m++)g=o[l++],this.o[c++]=g.x,this.o[c++]=g.y;else{m=0;for(var v=h-1;m<h;++m)g=o[l+v],this.o[c++]=g.x,this.o[c++]=g.y,v--}},d.prototype.Ln=function(c,o,l,h){if(this.Pb)throw f.i.Hb();for(h-=c,L(this.o,c+h,c,c+h),h=0;h<l;h++)this.o[c+h]=o},d.prototype.vj=function(c,o,l){if(this.Pb)throw f.i.Hb();L(this.o,c+2,c,c+(l-c)),this.o[c]=o.x,this.o[c+1]=o.y},d.prototype.Ut=function(c,o,l,h,m,g){if(0>c||0>o||0>h||!m&&(0>=g||o%g!=0)||l.size<h+o)throw f.i.N();if(o!=0)if(this.size<o+c&&this.resize(o+c),l==this)this.Ar(c,o,h,m,g);else if(m)for(m=0;m<o;m++)this.o[c]=l.o[h],c++,h++;else if(h=h+o-g,g==1)for(m=0;m<o;m++)this.o[c]=l.o[h],c++,h--;else for(m=0,o=f.O.truncate(o/g);m<o;m++){for(var v=0;v<g;v++)this.o[c+v]=l.o[h+v];c+=g,h-=g}},d.prototype.En=function(c,o,l){if(this.Pb||c+o>this.size)throw f.i.Hb();0<l-(c+o)&&L(this.o,c,c+o,c+(l-(c+o))+o),this.size-=o},d.prototype.ni=function(c,o,l){if(this.Pb||1>l||o%l!=0)throw f.i.Hb();for(var h=o>>1,m=0;m<h;m+=l){o-=l;for(var g=0;g<l;g++){var v=this.o[c+m+g];this.o[c+m+g]=this.o[c+o+g],this.o[c+o+g]=v}}},d.prototype.Wj=function(c,o,l){if(0>o||0>l||0>o||l+o>this.size)throw f.i.N();for(var h=o;h<o+l;h++)this.o[h]=c},d.prototype.Ar=function(c,o,l,h,m){if(!(h&&c==l||(this.o.set(this.o.subarray(l,l+o),c),h)))for(l=c,c=c+o-m,h=0,o=f.O.truncate(o/2);h<o;h++){for(var g=0;g<m;g++){var v=this.o[l+g];this.o[l+g]=this.o[c+g],this.o[c+g]=v}l+=m,c-=m}},d.prototype.vC=function(c,o,l,h,m){if(0>c||0>o||0>h)throw f.i.N();if(o!=0)for(this.size<(o<<1)+c&&this.resize((o<<1)+c),m||(c+=o-1<<1),m=m?2:-2,o+=h;h<o;h++)this.o[c]=l[h].x,this.o[c+1]=l[h].y,c+=m},d.prototype.uC=function(c,o,l){if(0>c||0>o)throw f.i.N();if(o!=0){this.size<(o<<1)+c&&this.resize((o<<1)+c),o+=0;for(var h=0;h<o;h++)this.o[c]=l[h][0],this.o[c+1]=l[h][1],c+=2}},d.prototype.Vw=function(c,o,l,h,m){if(0>c||0>o||0>h||this.size<o+c)throw f.i.N();if(m)for(m=0;m<o;m++)l[h+m]=this.o[c+m];else for(h=h+o-1;c<o;c++)l[h]=this.o[c],h--},d.prototype.uB=function(c,o,l){if(0>c||0>o||this.size<(o>>1)+c)throw f.i.N();if(o!=0){o=0+o;for(var h=0;h<o;h++)l[h][0]=this.o[c],l[h][1]=this.o[c+1],c+=2}},d.prototype.clear=function(c){c?this.resize(0):this.Bh(0)},d.prototype.ix=function(){this.pk=this.Pb=!0},d.prototype.Vd=function(c,o,l){Array.prototype.sort.call(this.o.subarray(c,o),l)},d.prototype.Tp=function(){return 1},d}();f.be=x}(Q||(Q={})),function(f){function L(d,c,o,l){o=new Int32Array(d.subarray(o,l)),d.set(o,c)}f.rY=function(){this.random=1973};var x=function(){function d(c){this.Pb=this.pk=!1,this.o=null;var o=c;2>o&&(o=2),this.o=new Int32Array(o),this.size=c}return d.prototype.rotate=function(c,o,l){if(this.Pb)throw f.i.fa("invalid_call");if(o<c||o>l||c>l)throw f.i.N();c!=o&&l!=o&&(this.ni(c,o-c,1),this.ni(o,l-o,1),this.ni(c,l-c,1))},d.qf=function(c,o){var l=new d(c),h=l.o;if(2>c&&(c=2),o!==0)for(var m=0;m<c;m++)h[m]=o;return l},d.Bn=function(c){var o=new d(0);return o.o=new Int32Array(c.o),o.size=c.size,o},d.Lr=function(c,o){var l=new d(0);return l.size=c.size,l.size>o&&(l.size=o),2>(o=l.size)&&(o=2),l.o=new Int32Array(o),l.o.set(c.o.length<=o?c.o:c.o.subarray(0,o),0),l},d.prototype.Jb=function(c){0>=c||(this.o==null?this.o=new Int32Array(c):c<=this.o.length||(0<this.o.length?((c=new Int32Array(c)).set(this.o),this.o=c):this.o=new Int32Array(c)))},d.prototype.read=function(c){return this.o[c]},d.prototype.tc=function(c,o){o.x=this.o[c],o.y=this.o[c+1]},d.prototype.get=function(c){return this.o[c]},d.prototype.write=function(c,o){if(this.Pb)throw f.i.Hb();this.o[c]=o},d.prototype.set=function(c,o){if(this.Pb)throw f.i.Hb();this.o[c]=o},d.prototype.Tt=function(c,o){if(this.Pb)throw f.i.Hb();this.o[c]=o.x,this.o[c+1]=o.y},d.prototype.add=function(c){this.resize(this.size+1),this.o[this.size-1]=c},d.prototype.GB=function(c){return d.Lr(this,c)},d.prototype.eg=function(c){return this.read(c)},d.prototype.resize=function(c,o){if(o===void 0&&(o=0),this.pk)throw f.i.fa("invalid call. Attribute Stream is locked and cannot be resized.");if(c<=this.size){if(30<this.o.length&&5*c/4<this.o.length){var l=new Int32Array(this.o,0,c);this.o=l}}else{c>this.o.length&&(l=f.O.truncate(64>c?Math.max(2*c,4):5*c/4),(l=new Int32Array(l)).set(this.o),this.o=l),l=this.o;for(var h=this.size;h<c;h++)l[h]=o}this.size=c},d.prototype.Bh=function(c){if((this.o==null||c>this.o.length)&&this.resize(c),this.pk)throw f.i.fa("invalid call. Attribute Stream is locked and cannot be resized.");this.size=c},d.prototype.pr=function(c,o){this.write(c,o)},d.prototype.An=function(c,o,l){for(var h=this.size;o<h&&o<l;o++)c=f.O.Th(this.read(o),c);return c},d.prototype.Nb=function(c,o,l){if(c==null||!(c instanceof d))return!1;var h=this.size,m=c.size;if(l>h||l>m&&h!=m)return!1;for(l>h&&(l=h);o<l;o++)if(this.read(o)!=c.read(o))return!1;return!0},d.prototype.addRange=function(c,o,l,h,m){if(this.Pb)throw f.i.Hb();if(!h&&(1>m||l%m!=0))throw f.i.N();var g=this.size;if(this.resize(g+l),h)this.o.set(c.o.subarray(o,o+l),g);else{h=l;for(var v=0;v<l;v+=m){h-=m;for(var w=0;w<m;w++)this.o[g+v+w]=c.o[o+h+w]}}},d.prototype.Mn=function(c,o,l,h,m,g,v){if(this.Pb)throw f.i.Hb();if(!m&&(1>g||h%g!=0))throw f.i.N();if(L(this.o,c+h,c,c+(v-c)),this.o==o.o&&c<l&&(l+=h),m)this.o.set(o.o.subarray(l,l+h),c);else for(m=h,v=0;v<h;v+=g){m-=g;for(var w=0;w<g;w++)this.o[c+v+w]=o.o[l+m+w]}},d.prototype.Iz=function(c,o,l,h,m,g){if(this.Pb)throw f.i.Hb();if(0>g&&(g=this.size),this.size+2*h>this.o.length?this.resize(this.size+2*h):this.size+=2*h,L(this.o,c+2*h,c,c+(g-c)),m)for(m=0;m<h;m++)g=o[l++],this.o[c++]=g.x,this.o[c++]=g.y;else{m=0;for(var v=h-1;m<h;++m)g=o[l+v],this.o[c++]=g.x,this.o[c++]=g.y,v--}},d.prototype.Ln=function(c,o,l,h){if(this.Pb)throw f.i.Hb();for(h-=c,L(this.o,c+h,c,c+h),h=0;h<l;h++)this.o[c+h]=o},d.prototype.vj=function(c,o,l){if(this.Pb)throw f.i.Hb();L(this.o,c+2,c,c+(l-c)),this.o[c]=o.x,this.o[c+1]=o.y},d.prototype.Ut=function(c,o,l,h,m,g){if(0>c||0>o||0>h||!m&&(0>=g||o%g!=0)||l.size<h+o)throw f.i.N();if(o!=0)if(this.size<o+c&&this.resize(o+c),l==this)this.Ar(c,o,h,m,g);else if(m)for(m=0;m<o;m++)this.o[c]=l.o[h],c++,h++;else if(h=h+o-g,g==1)for(m=0;m<o;m++)this.o[c]=l.o[h],c++,h--;else for(m=0,o=f.O.truncate(o/g);m<o;m++){for(var v=0;v<g;v++)this.o[c+v]=l.o[h+v];c+=g,h-=g}},d.prototype.En=function(c,o,l){if(this.Pb||c+o>this.size)throw f.i.Hb();0<l-(c+o)&&L(this.o,c,c+o,c+(l-(c+o))+o),this.size-=o},d.prototype.ni=function(c,o,l){if(this.Pb||1>l||o%l!=0)throw f.i.Hb();for(var h=o>>1,m=0;m<h;m+=l){o-=l;for(var g=0;g<l;g++){var v=this.o[c+m+g];this.o[c+m+g]=this.o[c+o+g],this.o[c+o+g]=v}}},d.prototype.Wj=function(c,o,l){if(0>o||0>l||0>o||l+o>this.size)throw f.i.N();for(var h=o;h<o+l;h++)this.o[h]=c},d.prototype.Ar=function(c,o,l,h,m){if(!(h&&c==l||(this.o.set(this.o.subarray(l,l+o),c),h)))for(l=c,c=c+o-m,h=0,o=f.O.truncate(o/2);h<o;h++){for(var g=0;g<m;g++){var v=this.o[l+g];this.o[l+g]=this.o[c+g],this.o[c+g]=v}l+=m,c-=m}},d.prototype.vC=function(c,o,l,h,m){if(0>c||0>o||0>h)throw f.i.N();if(o!=0)for(this.size<(o<<1)+c&&this.resize((o<<1)+c),m||(c+=o-1<<1),m=m?2:-2,o+=h;h<o;h++)this.o[c]=l[h].x,this.o[c+1]=l[h].y,c+=m},d.prototype.Vw=function(c,o,l,h,m){if(0>c||0>o||0>h||this.size<o+c)throw f.i.N();if(m)for(m=0;m<o;m++)l[h+m]=this.o[c+m];else for(h=h+o-1;c<o;c++)l[h]=this.o[c],h--},d.prototype.clear=function(c){c?this.resize(0):this.Bh(0)},d.prototype.ix=function(){this.pk=this.Pb=!0},d.prototype.Vd=function(c,o,l){10>o-c?d.rG(this.o,c,o,l):d.qB(this.o,c,o-1,l)},d.prototype.Tp=function(){return 2},d.prototype.Fc=function(){return this.o[this.size-1]},d.prototype.If=function(){this.resize(this.size-1)},d.prototype.bX=function(c){this.o[this.size-1]=c},d.prototype.SV=function(c){c<this.size-1&&(this.o[c]=this.o[this.size-1]),this.resize(this.size-1)},d.prototype.lF=function(c){for(var o=0,l=this.size;o<l;o++)if(this.o[o]==c)return o;return-1},d.prototype.hG=function(c){return 0<=this.lF(c)},d.rG=function(c,o,l,h){for(var m=o;m<l;m++){for(var g=c[m],v=m-1;v>=o&&0<h(c[v],g);)c[v+1]=c[v],v--;c[v+1]=g}},d.tx=function(c,o,l){var h=c[l];c[l]=c[o],c[o]=h},d.qB=function(c,o,l,h){if(!(o>=l))for(;;){if(9>l-o){d.rG(c,o,l+1,h);break}var m=c[o];d.tx(c,o,l);for(var g=o,v=o;v<l;v++)0>=h(c[v],m)&&(d.tx(c,g,v),g+=1);d.tx(c,g,l),g-o<l-g?(d.qB(c,o,g-1,h),o=g+1):(d.qB(c,g+1,l,h),l=g-1)}},d}();f.ia=x}(Q||(Q={})),function(f){function L(d,c,o,l){o=new Int8Array(d.subarray(o,l)),d.set(o,c)}var x=function(){function d(c){this.o=null;var o=c;2>o&&(o=2),this.o=new Int8Array(o),this.size=c}return d.prototype.rotate=function(c,o,l){if(this.Pb)throw f.i.fa("invalid_call");if(o<c||o>l||c>l)throw f.i.N();c!=o&&l!=o&&(this.ni(c,o-c,1),this.ni(o,l-o,1),this.ni(c,l-c,1))},d.qf=function(c,o){var l=new d(c),h=l.o;if(2>c&&(c=2),o!==0)for(var m=0;m<c;m++)h[m]=o;return l},d.Bn=function(c){var o=new d(0);return o.o=new Int8Array(c.o),o.size=c.size,o},d.Lr=function(c,o){var l=new d(0);return l.size=c.size,l.size>o&&(l.size=o),2>(o=l.size)&&(o=2),l.o=new Int8Array(o),l.o.set(c.o.length<=o?c.o:c.o.subarray(0,o),0),l},d.prototype.Jb=function(c){0>=c||(this.o==null?this.o=new Int8Array(c):c<=this.o.length||(0<this.o.length?((c=new Int8Array(c)).set(this.o),this.o=c):this.o=new Int8Array(c)))},d.prototype.read=function(c){return this.o[c]},d.prototype.tc=function(c,o){o.x=this.o[c],o.y=this.o[c+1]},d.prototype.get=function(c){return this.o[c]},d.prototype.write=function(c,o){if(this.Pb)throw f.i.Hb();this.o[c]=o},d.prototype.set=function(c,o){if(this.Pb)throw f.i.Hb();this.o[c]=o},d.prototype.Tt=function(c,o){if(this.Pb)throw f.i.Hb();this.o[c]=o.x,this.o[c+1]=o.y},d.prototype.add=function(c){this.resize(this.size+1),this.o[this.size-1]=c},d.prototype.GB=function(c){return d.Lr(this,c)},d.prototype.eg=function(c){return this.read(c)},d.prototype.resize=function(c,o){if(o===void 0&&(o=0),this.pk)throw f.i.fa("invalid call. Attribute Stream is locked and cannot be resized.");if(c<=this.size){if(30<this.o.length&&5*c/4<this.o.length){var l=new Int8Array(this.o,0,c);this.o=l}}else{c>this.o.length&&(l=f.O.truncate(64>c?Math.max(2*c,4):5*c/4),(l=new Int8Array(l)).set(this.o),this.o=l),l=this.o;for(var h=this.size;h<c;h++)l[h]=o}this.size=c},d.prototype.Bh=function(c){if((this.o==null||c>this.o.length)&&this.resize(c),this.pk)throw f.i.fa("invalid call. Attribute Stream is locked and cannot be resized.");this.size=c},d.prototype.pr=function(c,o){this.write(c,o)},d.prototype.An=function(c,o,l){for(var h=this.size;o<h&&o<l;o++)c=f.O.Th(this.read(o),c);return c},d.prototype.Nb=function(c,o,l){if(c==null||!(c instanceof d))return!1;var h=this.size,m=c.size;if(l>h||l>m&&h!=m)return!1;for(l>h&&(l=h);o<l;o++)if(this.read(o)!=c.read(o))return!1;return!0},d.prototype.addRange=function(c,o,l,h,m){if(this.Pb)throw f.i.Hb();if(!h&&(1>m||l%m!=0))throw f.i.N();var g=this.size;if(this.resize(g+l),h)this.o.set(c.o.subarray(o,o+l),g);else{h=l;for(var v=0;v<l;v+=m){h-=m;for(var w=0;w<m;w++)this.o[g+v+w]=c.o[o+h+w]}}},d.prototype.Mn=function(c,o,l,h,m,g,v){if(this.Pb)throw f.i.Hb();if(!m&&(1>g||h%g!=0))throw f.i.N();if(L(this.o,c+h,c,c+(v-c)),this.o==o.o&&c<l&&(l+=h),m)this.o.set(o.o.subarray(l,l+h),c);else for(m=h,v=0;v<h;v+=g){m-=g;for(var w=0;w<g;w++)this.o[c+v+w]=o.o[l+m+w]}},d.prototype.Ln=function(c,o,l,h){if(this.Pb)throw f.i.Hb();for(h-=c,L(this.o,c+h,c,c+h),h=0;h<l;h++)this.o[c+h]=o},d.prototype.Iz=function(c,o,l,h,m,g){if(this.Pb)throw f.i.Hb();if(0>g&&(g=this.size),this.size+2*h>this.o.length?this.resize(this.size+2*h):this.size+=2*h,L(this.o,c+2*h,c,c+(g-c)),m)for(m=0;m<h;m++)g=o[l++],this.o[c++]=g.x,this.o[c++]=g.y;else{m=0;for(var v=h-1;m<h;++m)g=o[l+v],this.o[c++]=g.x,this.o[c++]=g.y,v--}},d.prototype.vj=function(c,o,l){if(this.Pb)throw f.i.Hb();L(this.o,c+2,c,c+(l-c)),this.o[c]=o.x,this.o[c+1]=o.y},d.prototype.Ut=function(c,o,l,h,m,g){if(0>c||0>o||0>h||!m&&(0>=g||o%g!=0)||l.size<h+o)throw f.i.N();if(o!=0)if(this.size<o+c&&this.resize(o+c),l==this)this.Ar(c,o,h,m,g);else if(m)for(m=0;m<o;m++)this.o[c]=l.o[h],c++,h++;else if(h=h+o-g,g==1)for(m=0;m<o;m++)this.o[c]=l.o[h],c++,h--;else for(m=0,o=f.O.truncate(o/g);m<o;m++){for(var v=0;v<g;v++)this.o[c+v]=l.o[h+v];c+=g,h-=g}},d.prototype.En=function(c,o,l){if(this.Pb||c+o>this.size)throw f.i.Hb();0<l-(c+o)&&L(this.o,c,c+o,c+(l-(c+o))+o),this.size-=o},d.prototype.ni=function(c,o,l){if(this.Pb||1>l||o%l!=0)throw f.i.Hb();for(var h=o>>1,m=0;m<h;m+=l){o-=l;for(var g=0;g<l;g++){var v=this.o[c+m+g];this.o[c+m+g]=this.o[c+o+g],this.o[c+o+g]=v}}},d.prototype.Wj=function(c,o,l){if(0>o||0>l||0>o||l+o>this.size)throw f.i.N();for(var h=o;h<o+l;h++)this.o[h]=c},d.prototype.Ar=function(c,o,l,h,m){if(!(h&&c==l||(this.o.set(this.o.subarray(l,l+o),c),h)))for(l=c,c=c+o-m,h=0,o=f.O.truncate(o/2);h<o;h++){for(var g=0;g<m;g++){var v=this.o[l+g];this.o[l+g]=this.o[c+g],this.o[c+g]=v}l+=m,c-=m}},d.prototype.vC=function(c,o,l,h,m){if(0>c||0>o||0>h)throw f.i.N();if(o!=0)for(this.size<(o<<1)+c&&this.resize((o<<1)+c),m||(c+=o-1<<1),m=m?2:-2,o+=h;h<o;h++)this.o[c]=l[h].x,this.o[c+1]=l[h].y,c+=m},d.prototype.Vw=function(c,o,l,h,m){if(0>c||0>o||0>h||this.size<o+c)throw f.i.N();if(m)for(m=0;m<o;m++)l[h+m]=this.o[c+m];else for(h=h+o-1;c<o;c++)l[h]=this.o[c],h--},d.prototype.clear=function(c){c?this.resize(0):this.Bh(0)},d.prototype.ix=function(){this.pk=this.Pb=!0},d.prototype.Vd=function(c,o,l){o=this.o.subarray(c,o),Array.prototype.sort.call(o,l),this.o.set(o,c)},d.prototype.zJ=function(c,o){if(this.Pb)throw f.i.fa("invalid call. Attribute Stream is read only.");this.o[c]|=o},d.prototype.KE=function(c,o){if(this.Pb)throw f.i.fa("invalid call. Attribute Stream is read only.");this.o[c]&=~o},d.prototype.Tp=function(){return 1},d}();f.pn=x}(Q||(Q={})),function(f){f.Yc=function(){function L(){}return L.Mr=function(x,d){return f.pn.qf(x,d)},L.Dn=function(x,d){return f.be.qf(x,d)},L.pP=function(x,d,c){switch(x){case 1:x=f.be.qf(d,c);break;case 2:x=f.ia.qf(d,c);break;case 4:x=f.pn.qf(d,c);break;default:throw f.i.Qa()}return x},L.YE=function(x,d){return L.pP(f.ra.Tp(x),d*f.ra.Va(x),f.ra.se(x))},L.Oh=function(x,d){return f.ia.qf(x,d)},L.qI=function(x){var d,c=[];for(d=0;d<x;d++)c.push(null);return c},L}()}(Q||(Q={})),function(f){f.ga=function(L){L===void 0&&(L=0),this.u=L}}(Q||(Q={})),function(f){f.NL=function(){function L(){}return L.bind=function(x){f.Sc=x.PeDefs,f.pf=x.PeFactory,f.NC=x.PeVertcs,f.ej=x.PeCSTransformations,f.MC=x.PeGTTransformations,f.LL=x.PeGeogtran,f.KL=x.PeFactoryCodechange,f.LC=x.PeGCSExtent,f.Cg=x.PePCSInfo,f.ML=x.PeHorizon,f.JL=x.PeCoordsys,f.lp=x.PeGTlistExtended,f.lp.PE_GTLIST_OPTS_USE_DEFAULT=128,f.pf.initialize(null),f.Mx=x.PeGTlistExtendedEntry,f.pf.fromString(f.Sc.PE_TYPE_UNIT,'UNIT["Meter",1.0]')},L}(),f.pf=null,f.NC=null,f.JL=null,f.ML=null,f.Cg=null,f.lp=null,f.Mx=null,f.LC=null,f.KL=null,f.LL=null,f.Sc=null,f.MC=null,f.ej=null}(Q||(Q={})),function(f){var L=function(){function x(){}return x.Mb=function(d,c){return 0<=c?x.P(d):-x.P(d)},x.P=function(d){return 0>d?-d:d},x.ti=function(d){return 3552713678800501e-30>d},x.KC=function(d,c,o){return x.P(d-c)<=o*(1+(x.P(d)+x.P(c))/2)},x.Y=function(d,c){return x.KC(d,c,3552713678800501e-30)},x.FL=function(d){return 3552713678800501e-30>=x.P(d)},x.Cd=function(d){return x.FL(d)},x}();f.s=L,f.F=function(){function x(){}return x.gp=function(d,c){var o=0;return(d=L.P(d))+(c=L.P(c))!=0&&(d>c?(o=c/d,o=d*Math.sqrt(1+o*o)):(o=d/c,o=c*Math.sqrt(1+o*o))),o},x.Wq=function(d,c,o,l,h){for(var m=[0,0,0],g=[0,0,0],v=0;2>=v;v++)c[v]-=d[v],o[v]-=c[v];o=m[1]*g[2]-m[2]*g[1],c=m[2]*g[0]-m[0]*g[2],m=m[0]*g[1]-m[1]*g[0],d=-1*(o*d[0]+c*d[1]+m*d[2]),l[0]=o,l[1]=c,l[2]=m,l[3]=d,g=x.on(l),l[0]/=g,l[1]/=g,l[2]/=g,l[3]/=g,h!=0&&(g=L.Cd(m)?L.Cd(d)?L.Mb(1,c):-L.Mb(1,d):L.Mb(1,m),g*=L.Mb(1,h),l[0]*=g,l[1]*=g,l[2]*=g,l[3]*=g)},x.zx=function(d,c,o){o[0]=d[1]*c[2]-c[1]*d[2],o[1]=d[2]*c[0]-c[2]*d[0],o[2]=d[0]*c[1]-c[0]*d[1]},x.St=function(d,c){return d[0]*c[0]+d[1]*c[1]+d[2]*c[2]},x.on=function(d){return x.gp(x.gp(d[0],d[1]),d[2])},x.cl=function(d,c,o,l,h,m,g,v){d=x.n(d,c,o);var w=Math.cos(o);m.u=(d+h)*w*Math.cos(l),g.u=(d+h)*w*Math.sin(l),v.u=(d*(1-c)+h)*Math.sin(o)},x.jO=function(d,c,o,l,h,m,g){var v=x.gp(c,o),w=1*Math.sqrt(1-d),E=w/1;if(L.Y(v,0))m.u=0,h.u=L.Mb(1.570796326794897,l),g.u=L.P(l)-w;else{m.u=Math.atan2(o,c),o=Math.atan2(1*l,w*v),m=Math.cos(o);var A=Math.sin(o);c=w*d/(1-d),d*=1,o=Math.atan2(l+c*A*A*A,v-d*m*m*m),3.141592653589793<L.P(o)&&(o=L.Mb(3.141592653589793,o)-o),o=Math.atan(E*Math.tan(o)),A=Math.sin(o),m=Math.cos(o),h.u=Math.atan2(l+c*A*A*A,v-d*m*m*m),1.570796326794897<L.P(h.u)&&(h.u=L.Mb(3.141592653589793,h.u)-h.u),o=Math.atan(E*Math.tan(h.u)),A=Math.sin(o),m=Math.cos(o),g.u=(l-w*A)*Math.sin(h.u)+(v-1*m)*Math.cos(h.u)}},x.n=function(d,c,o){return o=Math.sin(o),d/Math.sqrt(1-c*o*o)},x.ot=function(d,c){return Math.atan2(Math.sin(c)*(1-d),Math.cos(c))},x.Qj=function(d,c){return Math.atan2(Math.sin(c),Math.cos(c)*(1-d))},x.Rq=function(d,c){if(L.ti(d)||c==0||L.Y(L.P(c),1.570796326794897))return c;if(.006884661117170036>d){var o=Math.sqrt(1-d),l=(1-o)/(1+o),h=l*l,m=l*h,g=l*m,v=l*g,w=l*v,E=l*w,A=1.572916666666667*m-3.2578125*v+4.295068359375*E;d=2.142578125*g-6.071484375*w,o=3.129296875*v-11.249837239583334*E;var M=4.775276692708333*w,I=7.958636765252976*E,D=Math.cos(2*c);return c+Math.sin(2*c)*(1.5*l-.84375*m+.525390625*v-.2688395182291667*E-A+o-I+D*(2*(1.3125*h-1.71875*g+1.650146484375*w)-4*d+6*M+D*(4*A-12*o+24*I+D*(8*d-32*M+D*(16*o-80*I+D*(32*M+64*D*I))))))}for(o=1-d,l=d/2,m=(h=L.P(c))*x.Zu(d)/(1.570796326794897*o),g=9999,w=h,h=0;1e-16<g&&50>h;h++)E=x.w(d,w),v=w-(A=(v=(x.kG(w,d)-l*Math.sin(2*w)/E)/o-m)/(E=1/(E*E*E))),g=L.P(A),w=v;return 0<=c?w:-w},x.qW=function(d,c){return L.ti(c)?d:d*x.Zu(c)/1.570796326794897},x.ba=function(d){return 0>(d=x.pF(d,6.283185307179586))?d+6.283185307179586:3.141592653589793>L.P(d)||L.Y(L.P(d),3.141592653589793)?d:d-6.283185307179586},x.pF=function(d,c){return d-Math.floor(d/c)*c},x.Ah=function(d,c){if(.006884661117170036>c){var o=(c=(1-(c=Math.sqrt(1-c)))/(1+c))*c,l=o*o;return d/(1+c)*(1+.25*o+.015625*l+.00390625*o*l)*1.570796326794897}return d*x.Zu(c)},x.Vq=function(d,c){var o=L.Mb(1,Math.sin(c));return c=1.570796326794897>=(c=L.P(x.pF(c,3.141592653589793)))?c:3.141592653589793-c,(L.Y(c,1.570796326794897)?c:Math.atan(Math.sqrt(1-d)*Math.tan(c)))*o},x.q=function(d,c,o){if(.006884661117170036>c){var l=(c=(1-(c=Math.sqrt(1-c)))/(1+c))*c,h=c*l,m=c*h,g=c*m,v=c*g,w=c*v,E=-.7291666666666666*h+.2278645833333333*g+.03987630208333334*w,A=.615234375*m-.21533203125*v,M=-.54140625*g+.20302734375*w,I=.48876953125*v,D=-.4488699776785715*w,k=Math.cos(2*o);return d/(1+c)*((1+.25*l+.015625*m+.00390625*v)*o+Math.sin(2*o)*(-1.5*c+.1875*h+.0234375*g+.00732421875*w-E+M-D+k*(2*(.9375*l-.234375*m-.03662109375*v)-4*A+6*I+k*(4*E-12*M+24*D+k*(8*A-32*I+k*(16*M-80*D+k*(32*I+64*k*D)))))))}return d*(x.kG(o,c)-.5*c*Math.sin(2*o)/x.w(c,o))},x.w=function(d,c){return c=Math.sin(c),Math.sqrt(1-d*c*c)},x.Zu=function(d){return L.KC(d,1,2220446049250313e-31)?1:1>d?x.Xw(0,1-d)-d/3*x.Uw(0,1-d):NaN},x.kG=function(d,c){var o=L.Mb(1,d);d=L.P(d);var l=Math.floor(d/1.570796326794897);if(1<c)c=d==0?0:NaN;else if(L.Cd(l))c=(d=x.sin(d))*x.Xw(1-d*d,1-c*d*d)-c/3*d*d*d*x.Uw(1-d*d,1-c*d*d);else{var h=f.O.truncate(l%2),m=x.Zu(c);0<h?(d=1.570796326794897*(l+1)-d,c=m*(l+1)-(c=(d=Math.sin(d))*x.Xw(1-d*d,1-c*d*d)-c/3*d*d*d*x.Uw(1-d*d,1-c*d*d))):(d-=1.570796326794897*l,c=m*l+(c=(d=Math.sin(d))*x.Xw(1-d*d,1-c*d*d)-c/3*d*d*d*x.Uw(1-d*d,1-c*d*d)))}return c*o},x.sin=function(d){d=x.ba(d);var c=L.Mb(1,d);return d=L.P(d),L.Y(d,3.141592653589793)?0:L.Y(d,1.570796326794897)?1*c:Math.sin(d)*c},x.Uw=function(d,c){var o,l,h,m,g=d,v=c,w=1;for(c=0,d=1;l=((o=.2*(g+v+3*w))-g)/o,h=(o-v)/o,m=(o-w)/o,!(1e-4>L.P(l)&&1e-4>L.P(h)&&1e-4>L.P(m));)m=Math.sqrt(v),c+=d/((o=Math.sqrt(w))*(w+(m=Math.sqrt(g)*(m+o)+m*o))),d*=.25,g=.25*(g+m),v=.25*(v+m),w=.25*(w+m);return v=(g=l*h)-(w=m*m),3*c+d*(1+(w=g-6*w)*(.10227272727272728*w-.2142857142857143-.1730769230769231*m*(l=w+v+v))+m*(.1666666666666667*l+m*(-.4090909090909091*v+.1153846153846154*m*g)))/(o*Math.sqrt(o))},x.Xw=function(d,c){for(var o,l,h,m,g=1;l=2-((o=(d+c+g)/3)+d)/o,h=2-(o+c)/o,m=2-(o+g)/o,!(1e-4>L.P(l)&&1e-4>L.P(h)&&1e-4>L.P(m));g=.25*(g+o))o=Math.sqrt(c),l=Math.sqrt(g),d=.25*(d+(o=Math.sqrt(d)*(o+l)+o*l)),c=.25*(c+o);return(1+(.04166666666666666*(d=l*h-m*m)-.1-.06818181818181818*(c=l*h*m))*d+.07142857142857142*c)/Math.sqrt(o)},x.Qw=function(d,c){if(L.ti(d)||c==0||L.Y(L.P(c),1.570796326794897))return c;if(.006884661117170036>d){var o=d*d,l=d*o,h=d*l,m=d*h,g=d*m,v=d*g,w=-(.02708333333333333*l+.03430059523809524*h+.03149181547619048*m+.02634359154541446*g+.02156896735835538*v),E=.007669890873015873*h+.01299603174603175*m+.0148051353064374*g+.01454454953803912*v,A=-(.002275545634920635*m+.004830845032667949*g+.006558395368616723*v),M=.0006957236677288761*g+.001775193002406544*v,I=-.000217324089394402*v,D=Math.cos(2*c);return c+Math.sin(2*c)*(-(.5*d+.2083333333333333*o+.09375*l+.04878472222222222*h+.02916666666666667*m+.01938905423280423*g+.01388255931712963*v)-w+A-I+D*(2*(.1041666666666667*o+.0875*l+.06050347222222222*h+.04151785714285714*m+.02958958540013228*g+.02203667534722222*v)-4*E+6*M+D*(4*w-12*A+24*I+D*(8*E-32*M+D*(16*A-80*I+D*(32*M+64*D*I))))))}return c==0||L.Y(L.P(c),1.570796326794897)?o=c:(h=(l=Math.sqrt(d))*Math.sin(c),o=Math.tan(.7853981633974483+c/2)*Math.pow((1-h)/(1+h),l/2),o=2*Math.atan(o)-1.570796326794897),o},x.yO=function(d,c){if(L.ti(d)||c==0||L.Y(L.P(c),1.570796326794897))return c;if(.006884661117170036>d){var o=d*(M=d*(A=d*(D=d*d))),l=d*(I=d*o),h=.05833333333333333*A+.07232142857142858*M+.05634300595238095*o+.0355325796406526*I+.020235546186067*l,m=.02653149801587302*M+.04379960317460317*o+.0429211791776896*I+.03255384637546096*l,g=.01294022817460318*o+.02668104344536636*I+.03155651254609588*l,v=.00659454790965208*I+.0163075268674227*l,w=.003463473736911237*l,E=Math.cos(2*c);return c+Math.sin(2*c)*(.5*d+.2083333333333333*D+.08333333333333333*A+.03611111111111111*M+.01875*o+.01195601851851852*I+.008863673941798942*l-h+g-w+E*(2*(.1458333333333333*D+.1208333333333333*A+.07039930555555556*M+.03616071428571429*o+.01839451058201058*I+.01017113095238095*l)-4*m+6*v+E*(4*h-12*g+24*w+E*(8*m-32*v+E*(16*g-80*w+E*(32*v+64*E*w))))))}var A=Math.sqrt(d),M=A/2,I=Math.tan(.7853981633974483+c/2);d=0,h=1;for(var D=c;h!=0;D=l)o=A*Math.sin(D),l=I*Math.pow((1+o)/(1-o),M),l=2*Math.atan(l)-1.570796326794897,d++,(L.Y(l,D)||3e4<d)&&(h=0);return D},x}()}(Q||(Q={})),function(f){var L=function(){function x(d){this.ul=this.Us=null,this.Iv=!1,this.GA=this.HA=0,this.HH=new f.h,this.XH=new f.h,this.KA=!1,this.vq=new f.l,this.wH=this.sw=0,this.tw=null,this.zl=!1,this.Eo=null,this.bA=0,this.Ue=d,this.As=f.zb.xv(this.Ue,0,!0),this.HH.Rc(),this.XH.Rc(),this.RH=NaN;var c=d.getCode();0<c?(this.Kk=c,f.pf.getCode(d)):this.Kk=f.pf.getCode(d),0>this.Kk&&(this.Kk=0);var o=this.Ue.getType();if(this.jH=o==f.Sc.PE_TYPE_PROJCS?2:1,o==f.Sc.PE_TYPE_PROJCS&&!d.loadConstants())throw f.i.N("PeProjcs.loadConstants failed");c=o==f.Sc.PE_TYPE_GEOGCS?this.Ue:this.Ue.getGeogcs(),o!=f.Sc.PE_TYPE_GEOGCS&&f.pf.getCode(c),this.Eo=d.getUnit(),this.RH=c.getPrimem().getLongitude(),this.wH=d=c.getUnit().getUnitFactor(),d=Math.PI/(180*d),1e-10>Math.abs(d-1)&&(d=1),this.GA=d,o&f.Sc.PE_TYPE_PROJCS?(c=this.Ue,this.HA=1/c.getUnit().getUnitFactor(),this.sw=.001/this.Ue.getUnit().getUnitFactor(),this.tw=f.Cg.generate(c,f.Cg.PE_PCSINFO_OPTION_NONE),this.zl=this.tw.isPannableRectangle(),this.bA=f.zb.qN(this.tw.getCentralMeridian(),this.GA)):(this.KA=this.zl=!0,this.HA=0,o=1/c.getUnit().getUnitFactor(),this.sw=.001/c.getDatum().getSpheroid().getAxis()*o,this.bA=0),this.zl&&(this.xx(),this.DK(),this.nY(),this.CK(),this.lY(),this.mY())}return x.prototype.$r=function(){return this.Kk},x.prototype.kk=function(){return this.tw},x.Py=function(d,c){return d==c||d!=null&&c!=null&&d.Kk==0&&c.Kk==0&&d.As===c.As},x.prototype.Wc=function(){return this.zl},x.prototype.gh=function(d){d.K(this.so)},x.prototype.pv=function(){return this.so.v},x.prototype.ov=function(){return this.so.C},x.prototype.GR=function(d){d.K(this.uw)},x.prototype.lY=function(){var d=this.Ue.getType();if(d==f.Sc.PE_TYPE_PROJCS){d=this.Ue;var c=this.kk().getCentralMeridian(),o=d.getGeogcs();if(o==null)throw f.i.fa("internal error");c=[[c+(o=1/o.getUnit().getUnitFactor()*Math.PI),0]],f.ej.geogToProj(d,1,c),c=c[0][0],o=d.getParameters()[f.Sc.PE_PARM_X0].getValue();var l=this.ml();d=new f.l,l.A(d),c=(l=Math.abs(c-o))+o,o=-1*l+o,l=d.H,d=d.G;var h=new f.l;h.K(o,d,c,l),this.so==null&&(this.so=h)}else{if(d!=f.Sc.PE_TYPE_GEOGCS)throw f.i.fa("internal error");o=1/this.Ue.getUnit().getUnitFactor()*Math.PI,(d=new f.l).K(-o,-o/2,o,o/2),this.so==null&&(this.so=d)}},x.prototype.mY=function(){var d=this.Ue.getType();if(d==f.Sc.PE_TYPE_PROJCS){var c=this.Ue;if(d=this.kk().getCentralMeridian(),(c=c.getGeogcs())==null)throw f.i.fa("internal error");c=1/c.getUnit().getUnitFactor()*Math.PI;var o=this.Vr(),l=new f.l;o.A(l),(o=new f.l).K(d-c,l.G,d+c,l.H),this.uw==null&&(this.uw=o)}else{if(d!=f.Sc.PE_TYPE_GEOGCS)throw f.i.fa("internal error");c=1/this.Ue.getUnit().getUnitFactor()*Math.PI,(d=new f.l).K(-c,-c/2,c,c/2),this.uw==null&&(this.uw=d)}},x.prototype.bf=function(){return this.GA},x.prototype.pm=function(){return this.HA},x.prototype.Vr=function(){if(this.zl)return this.ul;var d=this.ul;return d??(this.xx(),this.ul)},x.prototype.Wr=function(){return this.zl?null:(this.ul!=null||this.xx(),this.YG)},x.prototype.xx=function(){if(this.Ue.getType()==f.Sc.PE_TYPE_PROJCS){var d=this.Ue,c=d.getGeogcs(),o=d.horizonGcsGenerate();if(o!=null){var l=o[0].getNump(),h=o[0].getKind();d=0<o[0].getInclusive();var m=this.bf(),g=90*m,v=360*m,w=370*m,E=180*m*f.Sc.PE_HORIZON_DELTA/Math.PI,A=new f.l,M=null;if(1<l){for(var I=1;I<l;I++)if(o[I].getKind()==f.Sc.PE_HORIZON_LINE){M==null&&(M=new f.Ta);var D=o[I].getCoord();M.sx(D[0][0],D[0][1]),M.yj(D[1][0],D[1][1])}}if(h==f.Sc.PE_HORIZON_RECT)o=o[0].getCoord(),A.K(o[0][0],o[0][1]),A.Zb(o[1][0],o[1][1]),Math.abs(A.H-g)<1e-7*E&&(A.H=g),Math.abs(A.G+g)<1e-7*E&&(A.G=-g),A.R()>w&&(o=-400*m,A.K(o,A.G,o+5*v,A.H)),o=new f.Fh(A),this.ul==null&&(this.ul=o,this.Iv=d);else{if(w=new f.Da,v=this.kk().isGcsHorizonMultiOverlap(),A=f.gu.bF(c,f.hu.Integer64),v){for(w=new f.gL,E=f.Gh.local().V(w,A,null),I=0;I<l;I++)if(o[I].getKind()==f.Sc.PE_HORIZON_POLY){for(c=o[I].getSize(),m=o[I].getCoord(),h=[],g=0;g<c;g++)h[g]=f.h.construct(m[g][0],m[g][1]);o[I].getInclusive(),v&&((m=new f.Da).Yk(h,c-1),w.ZX(m),E.qe())}w=E.next()}else for(I=0;I<l;I++)if(o[I].getKind()==f.Sc.PE_HORIZON_POLY){for(c=o[I].getSize(),m=o[I].getCoord(),v=[],g=0;g<c;g++)v[g]=f.h.construct(m[g][0],m[g][1]);o[I].getInclusive(),w.Yk(v,c-1)}d?f.Xj.local().wn(w,A,1):f.kp.local().wn(w,A,1),f.dj.local().wn(w,A,1),this.ul==null&&(this.ul=w,this.Iv=d,this.YG=M)}}}},x.prototype.hv=function(){return this.zl||this.ul==null&&this.xx(),this.Iv},x.prototype.DK=function(){if(this.jH==2){var d=this.Ue.horizonPcsGenerate();if(d!=null){var c=d[0].getKind();d[0].getInclusive();var o=d[0].getNump(),l=!1;if(c==f.Sc.PE_HORIZON_RECT)d=d[0].getCoord(),(o=new f.l).K(d[0][0],d[0][1]),o.Zb(d[1][0],d[1][1]),d=new f.Fh(o);else{for(c=-1,l=0;l<o;l++)d[l].getKind()==f.Sc.PE_HORIZON_POLY&&(c=l);for(l=d[c].getSize()-1,d=d[c].getCoord(),o=[],c=0;c<l;c++)o[c]=f.h.construct(d[c][0],d[c][1]);d=c=new f.Da,c.Yk(o,l),l=!0}this.kk().isDensificationNeeded()&&(o=1e5*this.pm(),d=f.Xl.local().V(d,o,null)),l&&(l=new f.Fh,d.bn(l),d.Ke(),d.Qb(),d.qR(),f.Xj.local().wn(d,null,1)),this.Us==null&&(this.Us=d)}}},x.prototype.ml=function(){if(this.zl)return this.Us;var d=this.Us;return d??(this.DK(),this.Us)},x.prototype.nY=function(){if(this.Ue.getType()==f.Sc.PE_TYPE_PROJCS){var d=90*this.bf();d=[[0,d],[0,-d]],f.ej.geogToProj(this.Ue,2,d);var c=this.kk(),o=c.getNorthPoleLocation()!=f.Cg.PE_POLE_OUTSIDE_BOUNDARY;c=c.getSouthPoleLocation()!=f.Cg.PE_POLE_OUTSIDE_BOUNDARY,this.KA||(o&&this.HH.ma(d[0][0],d[0][1]),c&&this.XH.ma(d[1][0],d[1][1]))}this.KA=!0},x.prototype.CK=function(){if(this.jH==1){var d=400*this.bf();this.vq.K(-d,-d,d,d)}else d=f.Cg.generate(this.Ue,f.Cg.PE_PCSINFO_OPTION_DOMAIN),d=f.l.construct(d.getDomainMinx(),d.getDomainMiny(),d.getDomainMaxx(),d.getDomainMaxy()),this.vq.B()&&this.vq.K(d)},x.prototype.hR=function(d){this.zl&&d.K(this.vq),this.vq.B()&&this.CK(),d.K(this.vq)},x.prototype.Up=function(){return this.RH},x.prototype.zi=function(){return this.bA},x.prototype.Hd=function(){return this.Eo},x.prototype.Xr=function(){return this.wH},x}();f.OC=L}(Q||(Q={})),function(f){var L=function(){function x(d){this.KT=d,this.As=f.zb.xv(d,0,!0);var c=d.getCode();this.ss=0<c?c:f.pf.getCode(d),0>this.ss&&(this.ss=0),this.Eo=c=this.KT.getUnit(),this.IH=1/c.getUnitFactor(),f.pf.getCode(d)}return x.Py=function(d,c){return d==c||d!=null&&c!=null&&d.ss==0&&c.ss==0&&d.As===c.As},x.prototype.$r=function(){return this.ss},x}();f.PL=L}(Q||(Q={})),function(f){f.Yg=function(){function L(){}return L.tb=function(x,d,c,o,l,h,m,g){if(h!=null||m!=null||g!=null){o=f.F.ba(o),d=f.F.ba(d),c=f.F.ba(c),l=f.F.ba(l),1.570796326794897<f.s.P(c)&&(c=f.s.Mb(3.141592653589793,c)-c,d=f.F.ba(d+3.141592653589793)),1.570796326794897<f.s.P(l)&&(l=f.s.Mb(3.141592653589793,l)-l,o=f.F.ba(o+3.141592653589793));var v=f.F.ba(o-d);if(f.s.Y(c,l)&&(f.s.Y(d,o)||f.s.Y(f.s.P(c),1.570796326794897)))h!=null&&(h.u=0),m!=null&&(m.u=0),g!=null&&(g.u=0);else{if(f.s.Y(c,-l)){if(f.s.Y(f.s.P(c),1.570796326794897))return h!=null&&(h.u=3.141592653589793*x),m!=null&&(m.u=0<c?f.F.ba(3.141592653589793-f.F.ba(o)):f.F.ba(o)),void(g!=null&&(g.u=0<c?f.F.ba(o):f.F.ba(3.141592653589793-f.F.ba(o))));if(f.s.Y(f.s.P(v),3.141592653589793))return h!=null&&(h.u=3.141592653589793*x),m!=null&&(m.u=0),void(g!=null&&(g.u=0))}var w=f.s.P(c)==1.570796326794897?0:Math.cos(c),E=Math.sin(c),A=f.s.P(l)==1.570796326794897?0:Math.cos(l),M=Math.sin(l),I=f.s.P(v)==1.570796326794897?0:Math.cos(v),D=f.s.P(v)==3.141592653589793?0:Math.sin(v);if(h!=null){var k=Math.sin((l-c)/2);v=Math.sin(v/2),h.u=2*Math.asin(Math.sqrt(k*k+w*A*v*v))*x}m!=null&&(m.u=f.s.Y(f.s.P(c),1.570796326794897)?0>c?o:f.F.ba(3.141592653589793-o):Math.atan2(A*D,w*M-E*A*I)),g!=null&&(f.s.Y(f.s.P(l),1.570796326794897)?g.u=0>l?d:f.F.ba(3.141592653589793-d):(g.u=Math.atan2(w*D,M*w*I-A*E),g.u=f.F.ba(g.u+3.141592653589793)))}}},L.rf=function(x,d,c,o,l,h,m){if(h!=null||m!=null){d=f.F.ba(d),c=f.F.ba(c),1.570796326794897<f.s.P(c)&&(c=f.s.Mb(3.141592653589793,c)-c,d=f.F.ba(d+3.141592653589793)),f.s.Y(f.s.P(c),1.570796326794897)&&(d=0),l=f.F.ba(l);var g=f.s.Y(f.s.P(l),1.570796326794897)?0:Math.cos(l),v=f.s.Y(f.s.P(l),3.141592653589793)?0:Math.sin(l),w=f.s.Y(f.s.P(c),1.570796326794897)?0:Math.cos(c),E=Math.sin(c);x=o/x,o=f.s.Y(f.s.P(x),1.570796326794897)?0:Math.cos(x);var A=f.s.Y(f.s.P(x),3.141592653589793)?0:Math.sin(x),M=Math.asin(E*o+w*A*g);m!=null&&(m.u=M),h!=null&&(h.u=f.s.Y(f.s.P(M),1.570796326794897)?f.s.Y(c,-M)?0>M?l:f.F.ba(3.141592653589793-l):d:f.s.Y(f.s.P(c),1.570796326794897)&&f.s.Y(x,3.141592653589793)?0>c?l:f.F.ba(3.141592653589793-l):f.F.ba(d+Math.atan2(A*v,w*o-E*A*g)))}},L}()}(Q||(Q={})),function(f){f.Wk=function(){function L(){}return L.tb=function(x,d,c,o,l,h,m,g,v){var w=new f.ga(0),E=new f.ga(0),A=[0,0,0],M=[0,0,0],I=[0,0,0],D=new f.ga(0),k=new f.ga(0),B=new f.ga(0),J=new f.ga(0),Y=new f.ga(0);if(m!=null||g!=null||v!=null)if(f.s.ti(d))f.Yg.tb(x,c,o,l,h,m,g,v);else{l=f.F.ba(l),c=f.F.ba(c);var V=f.F.ba(l-c);if(f.s.Y(o,h)&&(f.s.Y(c,l)||f.s.Y(f.s.P(o),1.570796326794897)))m!=null&&(m.u=0),g!=null&&(g.u=0),v!=null&&(v.u=0);else{if(f.s.Y(o,-h)){if(f.s.Y(f.s.P(o),1.570796326794897))return m!=null&&(m.u=2*f.F.Ah(x,d)),g!=null&&(g.u=0<o?f.F.ba(3.141592653589793-f.F.ba(l)):f.F.ba(l)),void(v!=null&&(v.u=0<o?f.F.ba(l):f.F.ba(3.141592653589793-f.F.ba(l))));f.s.Y(f.s.P(V),3.141592653589793)&&(m!=null&&(m.u=2*f.F.Ah(x,d)),g!=null&&(g.u=0),v!=null&&(v.u=0))}else(f.s.Y(f.s.P(o),1.570796326794897)||f.s.Y(f.s.P(h),1.570796326794897))&&(f.s.Y(f.s.P(o),1.570796326794897)?c=l:l=c);var te=0;if(0>V){te=1;var he=c;c=l,l=he,he=o,o=h,h=he}V=f.F.ot(d,o);var ue=f.F.ot(d,h);g==null&&v==null||(f.Yg.tb(x,c,V,l,ue,null,w,E),w=Math.atan2(Math.sin(w.u)*Math.cos(o-V),Math.cos(w.u)),E=Math.atan2(Math.sin(E.u)*Math.cos(h-ue),Math.cos(E.u)),te!=0&&(he=w,w=E,E=he),g!=null&&(g.u=w),v!=null&&(v.u=E)),m!=null&&(f.F.cl(1,d,o,c,0,B,J,Y),A[0]=B.u,A[1]=J.u,A[2]=Y.u,f.F.cl(1,d,h,l,0,B,J,Y),M[0]=B.u,M[1]=J.u,M[2]=Y.u,I[0]=A[1]*M[2]-M[1]*A[2],I[1]=-(A[0]*M[2]-M[0]*A[2]),I[2]=A[0]*M[1]-M[0]*A[1],d=1-f.F.w(d,f.F.Vq(d,f.F.Qj(d,Math.acos(I[2]/Math.sqrt(I[0]*I[0]+I[1]*I[1]+I[2]*I[2]))))),d*=2-d,g=Math.atan2(-I[1],-I[0]),I=f.F.ba(g-1.570796326794897),g=f.F.ba(g+1.570796326794897),I=f.s.P(f.F.ba(c-I))<=f.s.P(f.F.ba(c-g))?I:g,f.Yg.tb(1,I,0,c,V,D,null,null),f.Yg.tb(1,I,0,l,ue,k,null,null),3.141592653589793<D.u+k.u&&(I=f.F.ba(I+3.141592653589793),f.Yg.tb(1,I,0,c,V,D,null,null),f.Yg.tb(1,I,0,l,ue,k,null,null)),D.u*=f.s.Mb(1,o),k.u*=f.s.Mb(1,h),D.u=f.F.Qj(d,D.u),k.u=f.F.Qj(d,k.u),c=f.F.q(x,d,D.u),x=f.F.q(x,d,k.u),m.u=f.s.P(x-c))}}},L.rf=function(x,d,c,o,l,h,m,g){var v=0,w=new f.ga(0),E=new f.ga(0),A=[0,0,0],M=[0,0,0],I=new f.ga(0),D=new f.ga(0),k=new f.ga(0);if(m!=null||g!=null)if(f.s.ti(d))f.Yg.rf(x,c,o,l,h,m,g);else if(f.s.Cd(l))m!=null&&(m.u=c),g!=null&&(g.u=o);else if(h=f.F.ba(h),0>l&&(l=f.s.P(l),h=f.F.ba(h+3.141592653589793)),c=f.F.ba(c),o=f.F.ba(o),1.570796326794897<f.s.P(o)&&(c=f.F.ba(c+3.141592653589793),o=f.s.Mb(3.141592653589793,o)-o),f.s.Y(f.s.P(o),1.570796326794897)&&(c=0),f.s.Cd(o)){var B=f.s.P(1.570796326794897-f.s.P(h));B=f.F.Qj(d,B),B=1-f.F.w(d,f.F.Vq(d,B)),B*=2-B,x=l/f.F.Ah(x,B)*1.570796326794897,x=f.F.Rq(B,x),x=f.F.ot(B,x),f.Yg.rf(1,c,o,x,h,m,w),g!=null&&(v=w.u),g!=null&&(g.u=f.F.Qj(d,v))}else if(f.s.Y(f.s.P(o),1.570796326794897))w=2*(v=f.F.Ah(x,d)),h=0<(x=f.s.Mb(1.570796326794897,o))?f.F.ba(3.141592653589793-h):h,o=v-l,f.s.P(o)<=v?m!=null&&(m.u=h):(o=Math.floor(l/w),f.O.truncate(o%2)==0?(m!=null&&(m.u=h),l-=o*w):(m!=null&&(m.u=f.F.ba(h+3.141592653589793)),l=(o+1)*w-l),o=v-l),g!=null&&(g.u=f.F.Rq(d,o/v*x));else{B=f.F.ot(d,o),h=Math.atan2(Math.sin(h),Math.cos(h)*Math.cos(o-B));var J=f.O.truncate(f.s.Mb(1,B))*(1.570796326794897>=f.s.P(h)?1:-1);h=f.F.ba(c+Math.atan(Math.tan(h)*-Math.sin(B))),f.Yg.tb(x,h,0,c,B,null,E,null),B=f.s.P(1.570796326794897-f.s.P(E.u)),B=f.F.Qj(d,B),B=1-f.F.w(d,f.F.Vq(d,B)),B*=2-B,f.F.cl(1,d,0,h,0,I,D,k),A[0]=I.u,A[1]=D.u,A[2]=k.u,f.F.cl(1,d,o,c,0,I,D,k),M[0]=I.u,M[1]=D.u,M[2]=k.u,o=Math.acos((A[0]*M[0]+A[1]*M[1]+A[2]*M[2])/Math.sqrt(M[0]*M[0]+M[1]*M[1]+M[2]*M[2])),o=f.F.Qj(B,o),l=0<(o=f.F.q(x,B,o)+l*J)?E.u:f.F.ba(E.u+3.141592653589793),x=f.s.P(o)/f.F.Ah(x,B)*1.570796326794897,x=f.F.Rq(B,x),x=f.F.ot(B,x),f.Yg.rf(1,h,0,x,l,m,w),g!=null&&(v=w.u),g!=null&&(g.u=f.F.Qj(d,v))}},L}()}(Q||(Q={})),function(f){f.cu=function(){function L(){}return L.tb=function(x,d,c,o,l,h,m,g,v){var w=0,E=0,A=0;if(m!=null||g!=null||v!=null)if(f.s.ti(d))f.Yg.tb(x,c,o,l,h,m,g,v);else{var M=f.F.ba(l-c);if(f.s.Y(o,h)&&(f.s.Cd(M)||f.s.Y(f.s.P(o),1.570796326794897)))m!=null&&(m.u=0),g!=null&&(g.u=0),v!=null&&(v.u=0);else{if(f.s.Y(o,-h)){if(f.s.Y(f.s.P(o),1.570796326794897))return m!=null&&(m.u=2*f.F.Ah(x,d)),g!=null&&(g.u=0<o?f.F.ba(3.141592653589793-f.F.ba(l)):f.F.ba(l)),void(v!=null&&(v.u=0<o?f.F.ba(l):f.F.ba(3.141592653589793-f.F.ba(l))));f.s.Y(f.s.P(M),3.141592653589793)&&(m!=null&&(m.u=2*f.F.Ah(x,d)),g!=null&&(g.u=0),v!=null&&(v.u=0))}else if(f.s.Y(f.s.P(o),1.570796326794897)||f.s.Y(f.s.P(h),1.570796326794897)||f.s.Cd(M)||f.s.Y(f.s.P(M),3.141592653589793))return void f.Wk.tb(x,d,c,o,l,h,m,g,v);var I=1-Math.sqrt(1-d),D=d/(1-d),k=x*(1-I);x=f.F.Vq(d,o);var B=f.F.Vq(d,h);d=f.s.P(x)==1.570796326794897?0:Math.cos(x);var J=Math.sin(x),Y=f.s.P(B)==1.570796326794897?0:Math.cos(B),V=Math.sin(B),te=M,he=Math.cos(te),ue=Math.sin(te),xe=1,be=0;do{var Le=te,Xe=Math.sqrt(Math.pow(Y*ue,2)+Math.pow(d*V-J*Y*he,2)),qe=J*V+d*Y*he,xt=Math.atan2(Xe,qe);if(Xe==0){xe=0;break}var it=d*Y*ue/Xe;if(w=Math.cos(Math.asin(it)),E=qe-2*J*V/(w*=w),1<f.s.P(E)&&(E=f.s.Mb(1,E)),te=M+(1-(te=I/16*w*(4+I*(4-3*w))))*I*it*(xt+te*Xe*(E+te*qe*(2*(A=E*E)-1))),he=Math.cos(te),ue=Math.sin(te),be++,3.141592653589793<f.s.P(te)&&30<be){xe=0;break}}while(5e3>=be&&!f.s.Y(Le,te));if(xe!=0)I=(D*=w)*(256+D*(D*(74-47*D)-128))/1024,m!=null&&(m.u=k*(1+D*(4096+D*(D*(320-175*D)-768))/16384)*(xt-I*Xe*(E+I/4*(qe*(2*A-1)-I/6*E*(4*Xe*Xe-3)*(4*A-3))))),g!=null&&(g.u=f.s.Y(f.s.P(o),1.570796326794897)?0>o?l:f.F.ba(3.141592653589793-l):Math.atan2(Y*ue,d*V-J*Y*he)),v!=null&&(f.s.Y(f.s.P(h),1.570796326794897)?v.u=0>h?c:f.F.ba(3.141592653589793-c):(v.u=Math.atan2(d*ue,d*V*he-J*Y),v.u=f.F.ba(v.u+3.141592653589793)));else{te=f.s.Mb(3.141592653589793,M),qe=J*V-d*Y,xt=Math.acos(qe),Xe=Math.sin(xt),w=1,be=it=0;do A=it,he=1-.25*(it=I*(w*=w)*(1+I+I*I))+.1875*(E=I*I*(he=w*w)*(1+2.25*I))-.1953125*(xe=I*I*I*he*w),it=.25*it-.25*E+.29296875*xe,ue=.03125*E-.05859375*xe,xe*=.00651041666666667,E=qe-2*J*V/w,1<f.s.P(E)&&(E=f.s.Mb(1,E)),w=Math.acos(E),qe=Math.cos(2*w),Le=Math.cos(3*w),ue=(it=f.s.Y(o,-h)?f.F.ba(3.141592653589793-M)/(3.141592653589793*I*he):f.F.ba(te-M)/(I*(he*xt+it*Xe*E+ue*Math.sin(2*xt)*qe+xe*Math.sin(3*xt)*Le)))*Xe/(d*Y),te=1.570796326794897<f.s.P(M)?f.s.Mb(3.141592653589793,ue)-Math.asin(ue):Math.asin(ue),he=Math.cos(te),Xe=Math.sqrt(Math.pow(Y*ue,2)+Math.pow(d*V-J*Y*he,2)),xt=3.141592653589793-Math.asin(f.s.P(Xe)),qe=Math.cos(xt),w=Math.cos(Math.asin(it)),be++;while(70>=be&&!f.s.Y(A,it));m!=null&&(he=1+(D*=w*=w)*(4096+D*(D*(320-175*D)-768))/16384,f.s.Y(o,-h)?m.u=3.141592653589793*k*he:(E=qe-2*J*V/w,w=Math.acos(E),qe=Math.cos(2*w),Le=Math.cos(3*w),m.u=k*(he*xt+D*(D*(128+D*(35*D-60))-512)/2048*Xe*E+D*(5*D-4)/6144*D*D*Math.sin(2*xt)*qe+xe*Math.sin(3*xt)*Le+-762939453125e-16*D*D*D*D*Math.sin(4*xt)*Math.cos(4*w)))),g!=null&&(f.s.Cd(o)&&f.s.Cd(h)?(w=Math.sqrt(1-it*it),g.u=Math.acos(w),0>M&&(g.u*=-1)):f.s.Y(f.s.P(o),1.570796326794897)?g.u=0>o?l:f.F.ba(3.141592653589793-l):(m=it/d,k=Math.sqrt(1-m*m),0>d*V-J*Y*Math.cos(te)&&(k*=-1),g.u=Math.atan2(m,k),f.s.Y(o,-h)&&f.s.P(f.F.ba(c-l))>3.141592653589793*(1-I*Math.cos(o))&&(0<o&&1.570796326794897>f.s.P(g.u)||0>o&&1.570796326794897<f.s.P(g.u))&&(g.u=f.s.Mb(3.141592653589793,g.u)-g.u))),v!=null&&(f.s.Cd(o)&&f.s.Cd(h)?(w=Math.sqrt(1-it*it),v.u=Math.acos(w),0<=M&&(v.u*=-1)):f.s.Y(f.s.P(h),1.570796326794897)?v.u=0>h?c:f.F.ba(3.141592653589793-c):(M=it/Y,m=Math.sqrt(1-M*M),k=Math.sin(te/2),0>Math.sin(B-x)-2*d*V*k*k&&(m*=-1),v.u=Math.atan2(M,m),v.u=f.F.ba(v.u+3.141592653589793),f.s.Y(o,-h)&&!f.s.Cd(o)&&!f.s.Y(f.s.P(o),1.570796326794897)&&f.s.P(f.F.ba(c-l))>3.141592653589793*(1-I*Math.cos(o))&&(g!=null?k=g.u:(m=it/d,k=Math.sqrt(1-m*m),0>d*V-J*Y*Math.cos(te)&&(k*=-1),k=Math.atan2(m,k),f.s.Y(o,-h)&&f.s.P(f.F.ba(c-l))>3.141592653589793*(1-I*Math.cos(o))&&(0<o&&1.570796326794897>f.s.P(k)||0>o&&1.570796326794897<f.s.P(k))&&(k=f.s.Mb(3.141592653589793,k)-k)),1.570796326794897>=f.s.P(k)&&1.570796326794897<f.s.P(v.u)||1.570796326794897<=f.s.P(k)&&1.570796326794897>f.s.P(v.u))&&(v.u=-1*f.F.ba(v.u+3.141592653589793))))}}}},L.rf=function(x,d,c,o,l,h,m,g){if(m!=null||g!=null)if(f.s.ti(d))f.Yg.rf(x,c,o,l,h,m,g);else if(h=f.F.ba(h),f.s.Y(f.s.P(o),1.570796326794897)||f.s.Cd(h)||f.s.Y(f.s.P(h),3.141592653589793))f.Wk.rf(x,d,c,o,l,h,m,g);else{var v=f.s.P(h)==1.570796326794897?0:Math.cos(h),w=f.s.P(h)==3.141592653589793?0:Math.sin(h);f.s.Y(f.s.P(o),1.570796326794897)&&(c=0),h=1-Math.sqrt(1-d);var E=f.F.Vq(d,o);o=f.s.P(E)==1.570796326794897?0:Math.cos(E);var A=Math.sin(E);E=Math.atan2(Math.tan(E),v);var M=o*w,I=M*M,D=1-I,k=d/(1-d)*D,B=(d=k*(256+k*(k*(74-47*k)-128))/1024)/4,J=d/6,Y=l/(x*(1-h)*(1+k*(4096+k*(k*(320-175*k)-768))/16384)),V=Y;do{var te=V;l=f.s.P(V)==1.570796326794897?0:Math.cos(V);var he=(k=f.s.P(V)==3.141592653589793?0:Math.sin(V))*k;V=d*k*((x=Math.cos(2*E+V))+B*(l*(2*(V=x*x)-1)-J*x*(4*he-3)*(4*V-3)))+Y}while(!f.s.Y(te,V));l=f.s.P(V)==1.570796326794897?0:Math.cos(V),k=f.s.P(V)==3.141592653589793?0:Math.sin(V),m!=null&&(w=Math.atan2(k*w,o*l-A*k*v),D=h/16*D*(4+h*(4-3*D)),x=Math.cos(2*E+V),m.u=f.F.ba(c+(w-(1-D)*h*M*(V+D*k*(x+D*l*(2*x*x-1)))))),g!=null&&(D=A*k-o*l*v,D=(1-h)*Math.sqrt(I+D*D),g.u=Math.atan2(A*l+o*k*v,D))}},L}()}(Q||(Q={})),function(f){f.PC=function(){function L(){}return L.tb=function(x,d,c,o,l,h,m,g,v){var w=f.F.ba(l-c),E=f.s.Y(f.s.P(o),1.570796326794897),A=f.s.Y(f.s.P(h),1.570796326794897);if(f.s.Y(o,h)&&(f.s.Cd(w)||E))m!=null&&(m.u=0),g!=null&&(g.u=0),v!=null&&(v.u=0);else{if(f.s.ti(d)){var M=Math.sin(o),I=Math.sin(h);M=Math.sqrt((1+M)/(1-M)),I=Math.sqrt((1+I)/(1-I)),M=Math.log(I)-Math.log(M),M=Math.atan2(w,M),m!=null&&(m.u=f.s.Y(o,h)?f.s.P(x*Math.cos(o)*w):f.s.P((x*h-x*o)/Math.cos(M)))}else I=f.F.Qw(d,h),M=Math.sin(f.F.Qw(d,o)),I=Math.sin(I),M=Math.sqrt((1+M)/(1-M)),I=Math.sqrt((1+I)/(1-I)),M=Math.log(I)-Math.log(M),M=Math.atan2(w,M),m!=null&&(f.s.Y(o,h)?m.u=f.s.P(x*w*Math.cos(o)/f.F.w(d,o)):(w=f.F.q(x,d,o),x=f.F.q(x,d,h),m.u=f.s.P((x-w)/Math.cos(M))));g==null&&v==null||(m=f.F.ba(M+3.141592653589793),E&&A||!E&&!A||(E?M=0>o?l:f.F.ba(3.141592653589793-l):A&&(m=0>h?c:f.F.ba(3.141592653589793-c))),g!=null&&(g.u=M),v!=null&&(v.u=m))}},L.rf=function(x,d,c,o,l,h,m,g){h=f.F.ba(h),0>l&&(l=f.s.P(l),h=f.F.ba(h+3.141592653589793)),f.s.ti(d)?f.s.Y(f.s.P(o),1.570796326794897)?(c=0>o?h:f.F.ba(3.141592653589793-h),3.141592653589793>=(h=l/x%6.283185307179586)?x=o-f.s.Mb(h,o):(c=f.F.ba(c+3.141592653589793),x=-o+f.s.Mb(h-3.141592653589793,o))):f.s.Y(f.s.P(h),1.570796326794897)?(c=f.F.ba(c+f.s.Mb(l,h)/(x*Math.cos(o))),x=o):(x=o+l*Math.cos(h)/x,1.570796326794897<f.s.P(x)&&(x=1.570796326794897),f.s.Y(f.s.P(x),1.570796326794897)&&(f.s.Cd(h)||f.s.Y(f.s.P(h),3.141592653589793))||(1.570796316258184<f.s.P(x)&&(x=f.s.Mb(1.570796316258184,x)),d=Math.sin(o),o=Math.sin(x),d=Math.sqrt((1+d)/(1-d)),o=Math.sqrt((1+o)/(1-o)),d=Math.log(o)-Math.log(d),c=f.F.ba(c+Math.tan(h)*d))):f.s.Y(f.s.P(o),1.570796326794897)?(c=0>o?h:f.F.ba(3.141592653589793-h),h=l/f.F.qW(x,d),3.141592653589793>=(h%=6.283185307179586)?x=o-f.s.Mb(h,o):(c=f.F.ba(c+3.141592653589793),x=-o+f.s.Mb(h-3.141592653589793,o)),x=f.F.Rq(d,x)):f.s.Y(f.s.P(h),1.570796326794897)?(c=f.F.ba(c+f.s.Mb(l,h)*f.F.w(d,o)/(x*Math.cos(o))),x=o):(x=1.570796326794897*(l*Math.cos(h)+f.F.q(x,d,o))/f.F.Ah(x,d),1.570796326794897<f.s.P(x)&&(x=f.s.Mb(1.570796326794897,x)),x=f.F.Rq(d,x),f.s.Y(f.s.P(x),1.570796326794897)&&(f.s.Cd(h)||f.s.Y(f.s.P(h),3.141592653589793))||(l=f.F.Qw(d,o),o=f.F.Qw(d,x),1.570796316258184<f.s.P(o)&&(o=f.s.Mb(1.570796316258184,x),x=f.F.yO(d,o)),d=Math.sin(l),o=Math.sin(o),d=Math.sqrt((1+d)/(1-d)),o=Math.sqrt((1+o)/(1-o)),d=Math.log(o)-Math.log(d),c=f.F.ba(c+Math.tan(h)*d))),m!=null&&(m.u=c),g!=null&&(g.u=x)},L}()}(Q||(Q={})),function(f){f.kb=function(){function L(){}return L.Xy=function(x,d,c,o,l,h,m){f.cu.tb(x,d,c,o,l,h,null,m,null)},L.yi=function(x,d,c,o,l,h,m,g){f.cu.rf(x,d,c,o,l,h,m,g)},L.wd=function(x,d,c,o,l,h,m,g,v,w){switch(w){case 2:f.Wk.tb(x,d,c,o,l,h,m,g,v);break;case 3:f.QC.tb(x,d,c,o,l,h,m,g,v);break;case 1:f.PC.tb(x,d,c,o,l,h,m,g,v);break;default:f.cu.tb(x,d,c,o,l,h,m,g,v)}},L.oj=function(x,d,c,o,l,h,m,g,v){switch(v){case 2:f.Wk.rf(x,d,c,o,l,h,m,g);break;case 3:f.QC.rf(x,d,c,o,l,h,m,g);break;case 1:f.PC.rf(x,d,c,o,l,h,m,g);break;default:f.cu.rf(x,d,c,o,l,h,m,g)}},L}()}(Q||(Q={})),function(f){var L=function(){function d(){this.y=this.x=null}return d.construct=function(c){var o=new d;return o.x=new f.Wb,o.x.set(c.x),o.y=new f.Wb,o.y.set(c.y),o},d.VE=function(c,o){var l=new d;return l.x=new f.Wb,l.x.set(c),l.y=new f.Wb,l.y.set(o),l},d.prototype.qg=function(){return this.x.qg()&&this.y.qg()},d.prototype.value=function(){return f.h.construct(this.x.value(),this.y.value())},d}();f.vY=L;var x=function(){function d(){this.z=this.y=this.x=null}return d.construct=function(c){var o=new d;return o.x=new f.Wb,o.x.set(c.x),o.y=new f.Wb,o.y.set(c.y),o.z=new f.Wb,o.z.set(c.z),o},d.VE=function(c,o,l){var h=new d;return h.x=new f.Wb,h.x.set(c),h.y=new f.Wb,h.y.set(o),h.z=new f.Wb,h.z.set(l),h},d.prototype.qg=function(){return this.x.qg()&&this.y.qg()&&this.z.qg()},d.prototype.value=function(){return new f.Nd(this.x.value(),this.y.value(),this.z.value())},d.prototype.Qh=function(c){var o=new f.Wb,l=new f.Wb,h=new f.Wb;return o.Kl(this.x,c.x),l.Kl(this.y,c.y),h.Kl(this.z,c.z),(c=new f.Wb).dN(o,l),c.add(h),c},d.prototype.cF=function(c){var o=new d;o.x.Kl(this.y,c.z),o.y.Kl(this.z,c.x),o.z.Kl(this.x,c.y);var l=new f.Wb,h=new f.Wb,m=new f.Wb;return l.Kl(this.z,c.y),h.Kl(this.x,c.z),m.Kl(this.y,c.x),o.x.sub(l),o.y.sub(h),o.z.sub(m),o},d}();f.wY=x,f.Ox=function(){function d(){}return d.EP=function(c,o,l){var h=o.x;o=o.y,d.cl(1,c,Math.cos(h),Math.sin(h),Math.cos(o),Math.sin(o),l)},d.DP=function(c,o){var l=new f.Nd;return d.EP(c,o,l),l},d.cl=function(c,o,l,h,m,g,v){c/=Math.sqrt(1-o*g*g),v.K(c*m*l,c*m*h,c*(1-o)*g)},d.Yu=function(c,o){var l=new f.Wb,h=new f.Wb,m=new f.Wb,g=new f.Wb;l.cos(o.x),h.sin(o.x),m.cos(o.y),g.sin(o.y);var v=new f.Wb;return v.set(g),v.Ag(g),v.No(c),v.No(-1),v.kN(),v.sqrt(),(o=new f.Wb).set(1),o.jm(v),(v=new f.Wb).set(o),v.Ag(m),v.Ag(l),(l=new f.Wb).set(o),l.Ag(m),l.Ag(h),(h=new f.Wb).set(o),h.No(1-c),h.Ag(g),x.VE(v,l,h)},d.SS=function(c,o,l,h){if(Math.abs(o.x-l.x)>Math.PI||Math.abs(o.y)>.5*Math.PI||Math.abs(l.y)>.5*Math.PI||(Math.abs(o.y)==.5*Math.PI||Math.abs(l.y)==.5*Math.PI)&&o.x!=l.x)return NaN;if(h=d.cB(h,Math.min(o.x,l.x),Math.max(o.x,l.x)),!new f.Nc(o.x,l.x).contains(h))return NaN;var m=L.construct(o);if(l=L.construct(l),m=d.Yu(c,m),l=d.Yu(c,l),(l=m.cF(l)).z.qg())return o.y;var g=new f.Wb;g.set(l.x),g.jm(l.z),g.No(-1);var v=new f.Wb;v.set(l.y),v.jm(l.z),v.No(-1);var w=new f.Wb;return w.set(v),w.Ag(v),(m=new f.Wb).set(g),m.Ag(g),m.add(w),m.sqrt(),m.qg()||g.qg()&&v.qg()?o.y:(o=Math.atan2(v.value(),g.value()),o=Math.atan2(m.value()*Math.cos(o-h),1-c),h=d.DP(c,f.h.construct(h,o)),c=new f.Nd(h.x,h.y,-h.z),h=l.value().Qh(h),c=l.value().Qh(c),Math.abs(c)<Math.abs(h)&&(o=-o),o)},d.Oz=function(c,o,l,h,m){if(m[0]=NaN,m[1]=NaN,Math.abs(o.x-l.x)>Math.PI||Math.abs(o.y)>.5*Math.PI||Math.abs(l.y)>.5*Math.PI||(Math.abs(o.y)==.5*Math.PI||Math.abs(l.y)==.5*Math.PI)&&o.x!=l.x||Math.abs(h)>=.5*Math.PI||0<o.y&&0<l.y&&o.y>h&&l.y>h||0>o.y&&0>l.y&&o.y<h&&l.y<h)return 0;var g=L.construct(o),v=L.construct(l);g=d.Yu(c,g),v=d.Yu(c,v);var w=g.cF(v);if(w.z.qg())return new f.Nc(o.y,l.y).contains(h)?(m[0]=o.x,1):0;(v=new f.Wb).set(w.x),v.jm(w.z),v.No(-1),(g=new f.Wb).set(w.y),g.jm(w.z),g.No(-1),(w=new f.Wb).set(g),w.Ag(g);var E=new f.Wb;return E.set(v),E.Ag(v),E.add(w),E.sqrt(),E.qg()||v.qg()&&g.qg()?h==0?(m[0]=o.x,m[1]=l.x,2):0:(c=(1-c)*Math.tan(h)/E.value(),1<Math.abs(c)?0:(c=Math.acos(c),w=Math.atan2(g.value(),v.value()),v=Math.min(o.x,l.x),g=Math.max(o.x,l.x),l=d.cB(w-c,v,g),c=h!=0?d.cB(w+c,v,g):l,h=0,v<=l&&l<=g&&(m[h]=l,h++),c!=l&&v<=c&&c<=g&&(m[h]=c,++h==2&&Math.abs(m[0]-o.x)>Math.abs(m[1]-o.x)&&(o=m[0],m[0]=m[1],m[1]=o)),h))},d.cB=function(c,o,l){return c>l?c-=2*(o=Math.ceil((c-l)/(2*Math.PI)))*Math.PI:c<o&&(c+=2*(o=Math.ceil((o-c)/(2*Math.PI)))*Math.PI),c},d}()}(Q||(Q={})),function(f){f.XK=function(){function L(){}return L.$X=function(x,d){var c=8,o=[0,0,0,0],l=new f.h;l.L(d),l.scale(f.cb.sc(x).Hd().Ec()==9102?1:f.cb.sc(x).Hd().ai/3.141592653589793*180),-180>l.x?(l.x-=l.x%360,-180>l.x&&(l.x+=360)):180<l.x&&(l.x-=l.x%360,180<l.x&&(l.x-=360)),90<l.y&&(l.y=90),-90>l.y&&(l.y=-90);for(var h=-180,m=180,g=(x=5*c)-1,v=(d=(x+31)/32)-1;0<=v;v--)for(var w=g-32*v,E=Math.min(32,x-32*v),A=1;A<E;A+=2){var M=.5*(m+h);l.x>=M?(o[v]|=1<<w,h=M):m=M,w-=2,g-=2}for(h=-90,m=90,g=x-2,v=d-1;0<=v;v--)for(w=g-32*v,E=Math.min(32,x-32*v),A=0;A<E;A+=2)M=.5*(m+h),l.y>=M?(o[v]|=1<<w,h=M):m=M,w-=2,g-=2;return L.$P(o,c,c)},L.$P=function(x,d,c){for(var o=[],l=0;l<d;l++)o[l]="";for(var h=l=0,m=0;m<d;m++){var g=x[l]>>h&31;if(31<(h+=5)){var v=37-h;g&=(1<<v)-1,h-=32,g|=(x[++l]&(1<<h)-1)<<v}o[d-1-m]="0123456789bcdefghjkmnpqrstuvwxyz".split("")[g]}if(c>d)for(m=0;m<c-d;m++)o.push("0");else c<d&&(o.length=c);return o.join("")},L}()}(Q||(Q={})),function(f){var L={gcstol:[0,2e-9,1,2241706620489156e-24,2,2313672246530541e-24,3,898240164660333e-23,4,8982433838020134e-24,5,8982439417325895e-24,6,8982466029667677e-24,7,8982476760268133e-24,8,8982492642167149e-24,9,898251968292634e-23,10,898253685210448e-23,11,8982546725256576e-24,12,8982557456049832e-24,13,898257333682596e-23,14,8982575482995276e-24,15,8982578488197342e-24,16,8982579775336987e-24,17,89825840676828e-22,18,8982599090925448e-24,19,8982605529473397e-24,20,8982609220517402e-24,21,8982611968030573e-24,22,8982616260407152e-24,23,8982620552787834e-24,24,8982633429954492e-24,25,8982637722351582e-24,26,898264416095491e-23,27,8982646307158072e-24,28,8982654891980968e-24,29,8982667769246082e-24,30,8982674207892485e-24,31,8982680646548117e-24,32,8982682792768713e-24,33,8982685798042582e-24,34,8982689231436652e-24,35,898269137766135e-23,36,898269266624163e-23,37,8982705114087017e-24,38,8982706830791106e-24,39,8982711958374661e-24,40,8982712839964735e-24,41,8982717991496125e-24,42,8982721424914803e-24,43,8982723571154887e-24,44,8982727863638127e-24,45,8982730868942154e-24,46,8982734302370678e-24,47,8982745033612112e-24,48,8982751472369276e-24,49,8982755764879183e-24,50,8982762203651733e-24,51,8982764776628385e-24,52,8982766496171896e-24,53,898277722749025e-23,54,898278152002477e-23,55,898279933943848e-23,56,89829143024805e-22,57,8982922161948598e-24,58,898292327314211e-23,59,8982925667349601e-24,60,8982932222965576e-24,61,8982961298941316e-24,62,8982965524049989e-24,63,8982994818246099e-24,64,8982994895706967e-24,65,898299489597736e-23,66,8983000733443498e-24,67,8983055097289157e-24,68,8983064111047368e-24,69,8983111996941178e-24,70,8983120447446023e-24,71,898312748954554e-23,72,8983134531656096e-24,73,8983141573777694e-24,74,8983148615910332e-24,75,8983152841195215e-24,76,8983153545409748e-24,77,8983153827095593e-24,78,898315396793852e-23,79,8983154249624393e-24,80,8983155658054012e-24,81,8983960794340072e-24,82,8984061344391998e-24,83,8984072829255685e-24,84,8984194981201908e-24,85,8984275233099427e-24,86,8984326127007554e-24,87,8984330099816539e-24,88,898433275258421e-23,89,8984333047023206e-24,90,8984333885258723e-24,91,8984337959508212e-24,92,8984365176209457e-24,93,8984727360418079e-24,94,8984901041679577e-24,95,898542662091587e-23,96,898610024130669e-23,97,8992894229037531e-24,98,8993203677616635e-24,99,8993206178094346e-24,100,8993216059187305e-24,101,899322029394808e-23,102,8994627867045891e-24,103,9467559984315793e-24,104,946881168618118e-23,105,9980888154931644e-24,106,9981105353606775e-24,107,9983807356573187e-24,108,1687060485811522e-23,109,1688447560354875e-23,110,2176606011487185e-23,111,2225078816042032e-23,112,2348476432064694e-23,113,2348765250187846e-23,114,2378108974103778e-23,115,314559636297708e-22,116,3297788621680806e-23,117,3667892343788279e-23,118,4235973644320739e-23,119,4794625900676345e-23,120,7262742998235812e-23,121,7499447580246377e-23,122,7525056410964318e-23,123,7979913581209237e-23,124,9662020153976783e-23,125,9799175562353741e-23,126,9897353517547472e-23,127,102313891987647e-21,128,1081460541960784e-22,129,121905913857622e-21,130,2246893314238523e-22,131,2297344808062643e-22,132,242984645941825e-21,133,2754604784282804e-22,134,2884548130346993e-22,135,3370339971357784e-22,136,4307953346848296e-22,137,5208707228462029e-22,138,5509209568565608e-22,139,6452227422644406e-22,140,6740679942715567e-22,141,6861770001566745e-22,142,7252630318111686e-22,143,7441010326374328e-22,144,7742672907173287e-22,145,9629542775307953e-22,146,1061032953945969e-21,147,1143628333594458e-21,148,1162186197019925e-21,149,136418522650196e-20,150,1367441038498385e-21,151,1432394487827058e-21,152,1736235742820677e-21,153,1848250952034914e-21,154,1909859317102744e-21,155,1975716534933873e-21,156,2122065907891938e-21,157,272837045300392e-20,158,3183098861837907e-21,159,3580986219567645e-21,160,3819718634205488e-21,161,409255567950588e-20,162,4407367654852486e-21,163,4774648292756861e-21,164,5161781938115525e-21,165,520870722846203e-20,166,5729577951308232e-21,167,6031134685587613e-21,168,6987290184522236e-21,169,9241254760174569e-21,170,1145915590261646e-20],pcstol:[0,6666666666666667e-24,1,2e-8,2,4970973863636364e-20,3,4970978156565657e-20,4,4970980410559237e-20,5,.001,6,.001093615055555556,7,.001093615194444445,8,.001093619003239988,9,.001093623110088878,10,.003280833333333333,11,.003280839895013123,12,.003280843014596366,13,.003280845583333334,14,.003280869330266636,15,.00497101413676763],newtoold:[2154,102110,2195,102200,2204,32036,2205,26979,2225,102641,2226,102642,2227,102643,2228,102644,2229,102645,2230,102646,2231,102653,2232,102654,2233,102655,2234,102656,2235,102657,2236,102658,2237,102659,2238,102660,2239,102666,2240,102667,2241,102668,2242,102669,2243,102670,2246,102679,2247,102680,2248,102685,2249,102686,2250,102687,2254,102694,2255,102695,2257,102712,2258,102713,2259,102714,2260,102715,2261,102716,2262,102717,2263,102718,2264,102719,2267,102724,2268,102725,2271,102728,2272,102729,2274,102736,2275,102737,2276,102738,2277,102739,2278,102740,2279,102741,2283,102746,2284,102747,2285,102748,2286,102749,2287,102752,2288,102753,2289,102754,2312,23433,2326,102140,2395,2091,2396,2092,2397,2166,2398,2167,2399,2168,2759,102229,2760,102230,2761,102248,2762,102249,2763,102250,2764,102251,2765,102252,2766,102241,2767,102242,2768,102243,2769,102244,2770,102245,2771,102246,2772,102253,2773,102254,2774,102255,2775,102256,2776,102257,2777,102258,2778,102259,2779,102260,2780,102266,2781,102267,2782,102261,2783,102262,2784,102263,2785,102264,2786,102265,2787,102268,2788,102269,2789,102270,2790,102271,2791,102272,2792,102273,2793,102274,2794,102275,2795,102276,2796,102277,2797,102278,2798,102279,2799,102280,2800,102281,2801,102282,2802,102283,2803,102284,2804,102285,2805,102286,2806,102287,2807,102288,2808,102289,2809,102290,2810,102291,2811,102292,2812,102293,2813,102294,2814,102295,2815,102296,2816,102297,2817,102298,2818,102300,2819,102304,2820,102307,2821,102308,2822,102309,2823,102310,2824,102311,2825,102312,2826,102313,2827,102314,2828,102315,2829,102316,2830,102317,2831,102318,2832,102320,2833,102321,2834,102322,2835,102323,2836,102324,2837,102325,2838,102326,2839,102327,2840,102330,2841,102334,2842,102335,2843,102336,2844,102337,2845,102338,2846,102339,2847,102340,2848,102341,2849,102342,2850,102343,2851,102344,2852,102345,2853,102346,2854,102347,2855,102348,2856,102349,2857,102350,2858,102351,2859,102352,2860,102353,2861,102354,2862,102355,2863,102356,2864,102357,2865,102358,2866,102361,2942,102167,2943,102169,2944,2139,2945,2140,2946,2141,2947,2142,2948,2143,2949,2144,2950,2145,2951,2146,2952,2147,2953,2036,2954,2291,2955,2153,2956,2152,2957,2151,2958,2150,2959,2149,2960,2037,2961,2038,2962,2148,2965,2244,2966,2245,3003,102091,3004,102092,3005,102190,3060,2982,3067,102139,3072,102606,3074,102608,3075,102208,3077,102210,3078,102123,3080,102119,3081,102603,3082,102602,3083,102601,3088,65163,3089,102763,3090,102363,3092,102151,3093,102152,3094,102153,3095,102154,3096,102155,3097,102145,3098,102146,3099,102147,3100,102148,3101,102149,3102,2155,3107,102172,3110,102170,3111,102171,3119,2214,3158,102234,3159,102235,3160,102236,3336,2979,3338,102006,3346,2600,3370,102126,3371,102127,3372,102130,3373,102131,3389,2577,3390,2694,3400,102184,3401,102185,3404,3359,3407,3366,3417,102675,3418,102676,3419,102677,3420,102678,3421,102707,3422,102708,3423,102709,3424,102711,3433,102651,3434,102652,3435,102671,3436,102672,3437,102710,3438,102730,3448,102095,3451,102681,3452,102682,3455,102735,3461,2063,3462,2064,3463,3073,3464,3076,3560,102742,3566,102743,3567,102744,3734,102722,3735,102723,3736,102755,3737,102756,3738,102757,3739,102758,3741,102205,3742,102206,3743,102207,3748,102211,3750,102202,3751,102203,3759,102663,3760,102463,3764,102112,3770,102090,3771,102180,3772,102181,3773,102182,3775,102186,3776,102187,3777,102188,3800,102183,3801,102189,3812,102199,3814,102609,3815,102469,3819,104990,3821,104136,3824,104137,3825,102444,3826,102443,3827,102442,3828,102441,3857,102100,3889,104991,3906,104992,4048,103201,4049,103202,4050,103203,4051,103204,4056,103205,4057,103206,4058,103207,4059,103208,4060,103209,4061,103210,4062,103211,4063,103212,4071,103213,4082,103214,4083,103215,4093,103216,4094,103217,4095,103218,4096,103219,4167,104108,4169,37252,4171,104107,4189,104110,4197,4234,4223,37223,4304,104304,4414,102201,4415,102762,4417,102764,4434,102765,4437,102647,4455,32029,4456,32018,4457,3454,4462,102439,4463,4466,4470,4469,4484,103794,4485,103795,4486,103796,4487,103797,4488,103798,4489,103799,4611,104104,4612,104111,4613,37255,4615,37247,4616,37250,4617,4140,4618,4291,4620,37211,4626,37235,4647,102362,4658,37204,4668,37201,4669,4126,4672,37217,4673,104125,4675,37220,4684,37232,4698,4631,4707,37213,4708,37231,4709,37212,4710,37238,4711,37214,4712,37237,4713,37208,4714,37215,4715,37253,4716,37216,4717,37239,4719,37219,4722,37242,4724,37233,4725,37222,4727,37224,4728,37246,4729,37226,4730,37227,4731,37228,4732,37229,4733,37230,4734,37251,4735,37259,4736,37254,4739,37205,4758,104133,4760,37001,4762,104114,4826,102214,5013,104142,5014,102331,5015,102332,5016,102333,5173,102085,5174,102086,5175,102087,5176,102088,5177,102089,5178,102040,5179,102080,5185,102081,5186,102082,5187,102083,5188,102084,5221,102066,5246,104100,5247,102490,5324,104144,5325,102420,5329,2934,5365,104143,5367,102305,5451,104132,5513,102065,5514,102067,5519,102111,5520,31461,5646,102745,5839,5388,5858,5532,5879,4474,6207,104256,6244,102769,6245,102790,6246,102770,6247,102771,6248,102793,6249,102796,6250,102772,6251,102788,6252,102775,6253,102795,6254,102781,6255,102767,6256,102774,6257,102768,6258,102797,6259,102789,6260,102780,6261,102783,6262,102787,6263,102791,6264,102777,6265,102798,6266,102779,6267,102784,6268,102792,6269,102782,6270,102785,6271,102794,6272,102773,6273,102778,6274,102786,6275,102776,6311,104141,6318,104145,6322,104287,6325,104286,6328,102046,6329,102047,6330,102048,6331,102049,6332,102050,6333,102051,6334,102052,6335,102053,6336,102054,6337,102055,6338,102056,6339,102057,6340,102058,6341,102059,6342,102382,6343,102383,6344,102384,6345,102385,6346,102386,6347,102387,6348,102388,6350,102965,6355,102975,6356,102976,6391,6141,6393,102966,6394,102977,6395,102978,6396,102979,6397,102980,6398,102981,6399,102982,6400,102983,6401,102984,6402,102985,6403,102986,6404,102988,6405,102991,6406,102987,6407,102990,6408,102989,6409,102992,6410,102993,6411,102995,6412,102994,6413,102996,6414,102962,6415,102997,6416,103003,6417,102998,6418,103004,6419,102999,6420,103005,6421,103e3,6422,103006,6423,103001,6424,103007,6425,103002,6426,103008,6427,103010,6428,103013,6429,103009,6430,103012,6431,103011,6432,103014,6433,103015,6434,103016,6435,103017,6436,103018,6437,103019,6438,103022,6439,102967,6440,103021,6441,103024,6442,103020,6443,103023,6444,103025,6445,103027,6446,103026,6447,103028,6448,103030,6449,103033,6450,103029,6451,103032,6452,103031,6453,103034,6454,103035,6455,103037,6456,103036,6457,103038,6458,103039,6459,103041,6460,103040,6461,103042,6462,103043,6463,103045,6464,103044,6465,103046,6466,103047,6467,103049,6468,103048,6469,103050,6470,103051,6471,103052,6472,103053,6473,103054,6474,103055,6475,103056,6476,103057,6477,103059,6478,103058,6479,103060,6480,103066,6481,103065,6482,103067,6483,103061,6484,103063,6485,103062,6486,103064,6487,103068,6488,103069,6489,103071,6490,103073,6491,103070,6492,103072,6493,103075,6494,103078,6495,103074,6496,103077,6497,102968,6498,103076,6499,103079,6500,103081,6501,103084,6502,103080,6503,103083,6504,103082,6505,103085,6506,103086,6507,103088,6508,102963,6509,103087,6510,103089,6511,103091,6512,103090,6513,103092,6514,103093,6515,103094,6516,103095,6518,103098,6519,103101,6520,103097,6521,103100,6522,103099,6523,103102,6524,103103,6525,103104,6526,103105,6527,103106,6528,103108,6529,103111,6530,103107,6531,103110,6532,103109,6533,103112,6534,103114,6535,103118,6536,103113,6537,103117,6538,103116,6539,103120,6540,103115,6541,103119,6542,103121,6543,103122,6544,103123,6545,103125,6546,103124,6547,103126,6548,103127,6549,103129,6550,103128,6551,103130,6552,103131,6553,103133,6554,103132,6555,103134,6556,102969,6557,102970,6558,103135,6559,103137,6560,103136,6561,103138,6562,103139,6563,103140,6564,103141,6565,103142,6566,103200,6567,103143,6568,103144,6569,103145,6570,103146,6571,103147,6572,103149,6573,103148,6574,103150,6575,103151,6576,103152,6577,103155,6578,103160,6579,102971,6580,102972,6581,103153,6582,103158,6583,103154,6584,103159,6585,103157,6586,103162,6587,103156,6588,103161,6589,103172,6590,103173,6592,103174,6593,103176,6594,103175,6595,103177,6596,103178,6597,103180,6598,103179,6599,103181,6600,103182,6601,103184,6602,103183,6603,103185,6605,103190,6606,103186,6607,103189,6608,103188,6609,103191,6610,102973,6611,103192,6612,103196,6613,103193,6614,103197,6615,103195,6616,103199,6617,103194,6618,103198,6619,103164,6620,103163,6621,103165,6625,103170,6626,103169,6627,103171,6628,102520,6629,102521,6630,102522,6631,102523,6632,102524,6633,102527,6634,102493,6635,102494,6636,102496,6637,102495,6668,104020,6669,102610,6670,102611,6671,102612,6672,102613,6673,102614,6674,102615,6675,102616,6676,102617,6677,102618,6678,102619,6679,102620,6680,102621,6681,102622,6682,102623,6683,102624,6684,102625,6685,102626,6686,102627,6687,102628,6688,102593,6689,102594,6690,102595,6691,102596,6692,102597,6783,104223,6784,102530,6785,102500,6788,102532,6789,102502,6792,102533,6793,102503,6796,102531,6797,102501,6800,102534,6801,102504,6804,102535,6805,102505,6808,102536,6809,102506,6812,102537,6813,102507,6816,102538,6817,102508,6820,102539,6821,102509,6824,102540,6825,102510,6828,102541,6829,102511,6832,102542,6833,102512,6836,102543,6837,102513,6840,102544,6841,102514,6844,102546,6845,102516,6848,102545,6849,102515,6852,102547,6853,102517,6856,102548,6857,102518,6860,102549,6861,102519,6867,102380,6868,102381,6879,103187,6880,103096,6884,102376,6885,102378,6886,102377,6887,102379,7136,6980,7139,6987,7142,102706,7692,102557,7693,102558,7694,102559,7695,102560,7696,102561,8090,103318,8091,103418,8092,103317,8093,103417,8095,103371,8096,103471,8097,103369,8098,103469,8099,103368,8100,103468,8101,103367,8102,103467,8103,103366,8104,103466,8105,103365,8106,103465,8107,103364,8108,103464,8109,103363,8110,103463,8111,103362,8112,103462,8113,103361,8114,103461,8115,103360,8116,103460,8117,103359,8118,103459,8119,103357,8120,103457,8121,103356,8122,103456,8123,103355,8124,103455,8125,103354,8126,103454,8127,103353,8128,103453,8129,103352,8130,103452,8131,103350,8132,103450,8133,103349,8134,103449,8135,103348,8136,103448,8139,103343,8140,103443,8141,103342,8142,103442,8143,103341,8144,103441,8145,103339,8146,103439,8147,103337,8148,103437,8149,103336,8150,103436,8151,103334,8152,103434,8153,103333,8154,103433,8155,103331,8156,103431,8161,103326,8162,103426,8163,103325,8164,103425,8165,103324,8166,103424,8171,103321,8172,103421,8173,103320,8177,103420,8179,103316,8180,103416,8181,103315,8182,103415,8184,103314,8185,103414,8191,103312,8193,103412,8196,103311,8197,103411,8198,103310,8200,103410,8201,103309,8202,103409,8203,103308,8204,103408,8207,103306,8208,103406,8209,103305,8210,103405,8212,103304,8213,103404,8214,103303,8216,103403,8218,103302,8220,103402,8222,103301,8224,103401,8431,104248,8441,102590,8693,102449,8826,102605,8857,54035,8858,54036,8859,54037,8860,8449,8988,104115,8989,104116,8990,104117,8991,104118,8992,104119,8993,104120,8994,104121,8995,104122,8996,104123,8997,104124,8998,104896,8999,104257,9e3,104019,9014,104010,9019,104021,9053,104011,9054,104012,9055,104013,9056,104014,9057,104015,9059,104258,9060,104179,9061,104180,9062,104181,9063,104182,9064,104183,9065,104184,9066,104185,9067,104186,21896,21891,21897,21892,21898,21893,21899,21894,26701,102124,26702,102125,26799,26747,26847,102683,26848,102684,26849,102691,26850,102692,26851,102693,26852,102704,26853,102750,26854,102751,26857,102466,26858,102467,26859,102468,26901,102128,26902,102129,27493,27492,29101,29100,29168,29118,29169,29119,29170,29120,29171,29121,29172,29122,29187,29177,29188,29178,29189,29179,29190,29180,29191,29181,29192,29182,29193,29183,29194,29184,29195,29185,29902,29900,31279,31278,31281,31291,31282,31292,31283,31293,31284,31294,31285,31295,31286,31296,31287,31297,31466,31462,31467,31463,31468,31464,31469,31465,31986,31917,31987,31918,31988,31919,31989,31920,31990,31921,31991,31922,32064,32074,32065,32075,32066,32076,32067,32077,102550,2181,102551,2182,102552,2183,102553,2184,102554,2185,102555,2186,102556,2187],pcsid:[2066,15,2136,12,2155,10,2157,5,2158,5,2159,12,2160,12,2219,5,2220,5,2244,10,2245,10,2256,11,2265,11,2266,11,2269,11,2270,11,2273,11,2290,5,2291,5,2294,5,2295,5,2313,5,2314,14,2899,10,2900,10,2901,11,2909,11,2910,11,2911,10,2912,10,2913,11,2914,11,2964,10,2967,10,2968,10,2991,5,2992,11,2993,5,2994,11,3073,5,3076,5,3079,5,3091,10,3106,5,3108,5,3109,5,3141,5,3142,5,3167,4,3337,5,3347,5,3348,5,3359,10,3360,5,3361,11,3362,5,3363,10,3364,5,3365,10,3366,14,3402,5,3403,5,3405,5,3406,5,3439,5,3440,5,3447,5,3449,5,3450,5,3453,10,3454,10,3460,5,3479,11,3480,5,3481,11,3482,5,3483,11,3484,5,3485,10,3486,5,3487,10,3488,5,3489,5,3490,10,3491,5,3492,10,3493,5,3494,10,3495,5,3496,10,3497,5,3498,10,3499,5,3500,10,3501,5,3502,10,3503,5,3504,10,3505,5,3506,10,3507,5,3508,10,3509,5,3510,10,3511,5,3512,10,3513,5,3514,5,3515,10,3516,5,3517,10,3518,5,3519,10,3520,5,3521,10,3522,5,3523,10,3524,5,3525,10,3526,5,3527,10,3528,5,3529,10,3530,5,3531,10,3532,5,3533,10,3534,5,3535,10,3536,5,3537,10,3538,5,3539,10,3540,5,3541,10,3542,5,3543,10,3544,5,3545,10,3546,5,3547,10,3548,5,3549,10,3550,5,3551,10,3552,5,3553,10,3582,10,3583,5,3584,10,3585,5,3586,10,3587,5,3588,11,3589,5,3590,11,3591,5,3592,5,3593,11,3598,10,3599,5,3600,10,3605,11,3606,5,3607,5,3608,10,3609,5,3610,10,3611,5,3612,10,3613,5,3614,10,3615,5,3616,10,3617,5,3618,10,3619,5,3620,10,3621,5,3622,10,3623,5,3624,10,3625,5,3626,10,3627,5,3628,10,3629,5,3630,10,3631,5,3632,10,3633,5,3634,11,3635,5,3636,11,3640,10,3641,5,3642,10,3643,5,3644,11,3645,5,3646,11,3647,5,3648,11,3649,5,3650,10,3651,5,3652,10,3653,5,3654,10,3655,5,3656,11,3657,5,3658,10,3659,5,3660,10,3661,5,3662,10,3663,5,3664,10,3668,10,3669,5,3670,10,3671,5,3672,10,3673,5,3674,10,3675,5,3676,11,3677,10,3678,5,3679,11,3680,10,3681,5,3682,11,3683,10,3684,5,3685,5,3686,10,3687,5,3688,10,3689,5,3690,10,3691,5,3692,10,3696,10,3697,5,3698,10,3699,5,3700,10,3740,5,3749,5,3783,5,3784,5,3793,5,3794,5,3802,5,3816,5,3829,5,3854,5,3911,5,3912,5,3920,5,3978,5,3979,5,3991,10,3992,10,4026,5,4037,5,4038,5,4087,5,4088,5,4217,10,4438,10,4439,10,4467,5,4471,5,4474,5,4559,5,4822,5,4839,5,5018,5,5048,5,5167,5,5168,5,5223,5,5234,5,5235,5,5243,5,5266,5,5316,5,5320,5,5321,5,5330,5,5331,5,5337,5,5361,5,5362,5,5382,5,5383,5,5396,5,5456,5,5457,5,5469,5,5472,9,5490,5,5518,5,5523,5,5559,5,5588,11,5589,14,5596,5,5627,5,5629,5,5641,5,5643,5,5644,5,5654,10,5655,10,5659,5,5700,5,5825,5,5836,5,5837,5,5842,5,5844,5,5880,5,5887,5,5890,5,6128,11,6129,11,6141,11,6204,5,6210,5,6211,5,6307,5,6312,5,6316,5,6362,5,6591,5,6646,5,6703,5,6786,5,6787,11,6790,5,6791,11,6794,5,6795,11,6798,5,6799,11,6802,5,6803,11,6806,5,6807,11,6810,5,6811,11,6814,5,6815,11,6818,5,6819,11,6822,5,6823,11,6826,5,6827,11,6830,5,6831,11,6834,5,6835,11,6838,5,6839,11,6842,5,6843,11,6846,5,6847,11,6850,5,6851,11,6854,5,6855,11,6858,5,6859,11,6862,5,6863,11,6870,5,6875,5,6876,5,6915,5,6922,5,6923,10,6924,5,6925,10,6962,5,6984,5,6991,5,7128,10,7131,5,7132,10,7257,5,7258,10,7259,5,7260,10,7261,5,7262,10,7263,5,7264,10,7265,5,7266,10,7267,5,7268,10,7269,5,7270,10,7271,5,7272,10,7273,5,7274,10,7275,5,7276,10,7277,5,7278,10,7279,5,7280,10,7281,5,7282,10,7283,5,7284,10,7285,5,7286,10,7287,5,7288,10,7289,5,7290,10,7291,5,7292,10,7293,5,7294,10,7295,5,7296,10,7297,5,7298,10,7299,5,7300,10,7301,5,7302,10,7303,5,7304,10,7305,5,7306,10,7307,5,7308,10,7309,5,7310,10,7311,5,7312,10,7313,5,7314,10,7315,5,7316,10,7317,5,7318,10,7319,5,7320,10,7321,5,7322,10,7323,5,7324,10,7325,5,7326,10,7327,5,7328,10,7329,5,7330,10,7331,5,7332,10,7333,5,7334,10,7335,5,7336,10,7337,5,7338,10,7339,5,7340,10,7341,5,7342,10,7343,5,7344,10,7345,5,7346,10,7347,5,7348,10,7349,5,7350,10,7351,5,7352,10,7353,5,7354,10,7355,5,7356,10,7357,5,7358,10,7359,5,7360,10,7361,5,7362,10,7363,5,7364,10,7365,5,7366,10,7367,5,7368,10,7369,5,7370,10,7877,5,7878,5,7882,5,7883,5,7887,5,7899,5,7991,5,7992,5,8035,10,8036,10,8058,5,8059,5,8082,5,8083,5,8088,5,8137,5,8138,10,8157,5,8158,10,8159,5,8160,10,8167,5,8168,10,8169,5,8170,10,8187,5,8189,10,8205,5,8206,10,8225,5,8226,10,8311,5,8312,11,8313,5,8314,11,8315,5,8316,11,8317,5,8318,11,8319,5,8320,11,8321,5,8322,11,8323,5,8324,11,8325,5,8326,11,8327,5,8328,11,8329,5,8330,11,8331,5,8332,11,8333,5,8334,11,8335,5,8336,11,8337,5,8338,11,8339,5,8340,11,8341,5,8342,11,8343,5,8344,11,8345,5,8346,11,8347,5,8348,11,8352,5,8353,5,8379,5,8380,10,8381,5,8382,10,8383,5,8384,10,8385,5,8387,10,8391,5,8395,5,8433,5,8455,5,8456,5,8531,10,8682,5,8687,5,8692,5,8903,5,8950,5,8951,5,9039,5,9040,5,9141,5,9149,5,9150,5,9191,5,9221,5,9222,5,20499,5,20538,5,20539,5,20790,5,20791,5,21291,5,21292,5,21500,5,21817,5,21818,5,22032,5,22033,5,22091,5,22092,5,22332,5,22391,5,22392,5,22700,5,22770,5,22780,5,22832,5,23090,5,23095,5,23239,5,23240,5,23433,5,23700,5,24047,5,24048,5,24100,14,24200,5,24305,5,24306,5,24382,6,24383,5,24500,5,24547,5,24548,5,24571,2,24600,5,25e3,5,25231,5,25884,5,25932,5,26237,5,26331,5,26332,5,26591,5,26592,5,26632,5,26692,5,26855,10,26856,10,27120,5,27200,5,27291,7,27292,7,27429,5,27492,5,27500,5,27700,5,28232,5,28600,5,28991,5,28992,5,29100,5,29220,5,29221,5,29333,5,29635,5,29636,5,29701,5,29738,5,29739,5,29849,5,29850,5,29871,3,29872,13,29873,5,29900,5,29901,5,29903,5,30200,15,30339,5,30340,5,30791,5,30792,5,31028,5,31121,5,31154,5,31170,5,31171,5,31370,5,31528,5,31529,5,31600,5,31700,5,31838,5,31839,5,31901,5,32061,5,32062,5,32098,5,32099,10,32100,5,32104,5,32161,5,32766,5,53048,5,53049,5,54090,5,54091,5,65061,10,65062,10,65161,5,65163,5,102041,10,102064,8,102068,1,102069,0,102118,10,102119,11,102120,10,102121,10,102217,10,102218,5,102219,10,102220,10,102378,11,102379,11,102380,5,102381,11,102498,5,102499,5,102589,10,102590,5,102599,10,102600,10,102604,10,102605,5,102606,5,102647,5,102704,10,102705,10,102706,5,102733,10,102761,10,102762,5,102763,10,102764,5,102765,5,102766,10,102962,5,102963,5,102970,11,102974,10,102993,5,102994,5,102995,10,102996,10,103015,5,103016,10,103017,5,103018,10,103025,5,103026,5,103027,10,103028,10,103035,5,103036,5,103037,10,103038,10,103039,5,103040,5,103041,10,103042,10,103043,5,103044,5,103045,10,103046,10,103047,5,103048,5,103049,10,103050,10,103051,5,103052,10,103053,5,103054,10,103055,5,103056,10,103057,5,103058,5,103059,10,103060,10,103061,5,103062,5,103063,10,103064,10,103069,10,103070,5,103071,5,103072,10,103073,10,103086,5,103087,5,103088,10,103089,10,103094,11,103095,5,103096,10,103103,5,103104,10,103105,5,103106,10,103121,5,103122,10,103123,5,103124,5,103125,11,103126,11,103127,5,103128,5,103129,10,103130,10,103131,5,103132,5,103133,10,103134,10,103135,5,103136,5,103137,11,103138,11,103139,5,103140,10,103141,5,103142,10,103143,5,103144,10,103145,5,103146,11,103147,5,103148,5,103149,10,103150,10,103151,5,103152,10,103172,5,103173,10,103174,5,103175,5,103176,10,103177,10,103178,5,103179,5,103180,10,103181,10,103182,5,103183,5,103184,10,103185,10,103228,5,103229,5,103230,10,103231,10,103250,5,103251,10,103252,5,103253,10,103260,5,103261,5,103262,10,103263,10,103270,5,103271,5,103272,10,103273,10,103274,5,103275,5,103276,10,103277,10,103278,5,103279,5,103280,10,103281,10,103282,5,103283,5,103284,10,103285,10,103286,5,103287,10,103288,5,103289,10,103290,5,103291,10,103292,5,103293,5,103294,10,103295,10,103296,5,103297,5,103298,10,103299,10,103376,10,103377,5,103378,5,103379,10,103380,10,103393,5,103394,5,103395,10,103396,10,103472,5,103473,11,103474,5,103475,10,103482,5,103483,10,103484,5,103485,10,103500,5,103501,10,103502,5,103503,5,103504,11,103505,11,103506,5,103507,5,103508,10,103509,10,103510,5,103511,5,103512,10,103513,10,103514,5,103515,10,103516,5,103517,10,103518,5,103519,10,103520,5,103521,11,103522,5,103523,5,103524,10,103525,10,103526,5,103527,10,103561,10,103562,10,103563,5,103564,5,103565,10,103566,10,103567,5,103568,5,103569,10,103570,10,103585,10,103586,5,103587,10,103588,11,103589,5,103590,10,103591,11,103592,5,103593,10,103594,11,103695,10,103846,5,103946,10],pcsidc:[[2e3,2045,5],[2056,2065,5],[2067,2135,5],[2137,2153,5],[2161,2170,5],[2172,2193,5],[2196,2198,5],[2200,2203,5],[2206,2217,5],[2222,2224,11],[2251,2253,11],[2280,2282,11],[2308,2311,5],[2315,2325,5],[2327,2394,5],[2400,2491,5],[2494,2758,5],[2867,2869,11],[2870,2888,10],[2891,2895,10],[2896,2898,11],[2902,2908,10],[2915,2920,10],[2921,2923,11],[2924,2930,10],[2931,2941,5],[2969,2973,5],[2975,2982,5],[2984,2988,5],[2995,3002,5],[3006,3051,5],[3054,3059,5],[3061,3066,5],[3068,3071,5],[3084,3087,5],[3112,3118,5],[3120,3138,5],[3146,3151,5],[3153,3157,5],[3161,3166,5],[3168,3172,5],[3174,3203,5],[3294,3313,5],[3315,3335,5],[3339,3345,5],[3350,3358,5],[3367,3369,5],[3374,3388,5],[3391,3399,5],[3408,3416,5],[3425,3432,10],[3441,3446,10],[3456,3459,10],[3465,3478,5],[3554,3559,5],[3561,3565,10],[3568,3570,10],[3571,3581,5],[3594,3597,5],[3601,3604,5],[3637,3639,5],[3665,3667,5],[3693,3695,5],[3701,3727,5],[3728,3733,10],[3744,3747,5],[3753,3758,10],[3761,3763,5],[3765,3769,5],[3779,3781,5],[3788,3791,5],[3797,3799,5],[3832,3841,5],[3844,3852,5],[3873,3885,5],[3890,3893,5],[3942,3950,5],[3968,3970,5],[3973,3976,5],[3986,3989,5],[3994,3997,5],[4390,4398,5],[4399,4413,10],[4418,4433,10],[4491,4554,5],[4568,4589,5],[4652,4656,5],[4766,4800,5],[5069,5072,5],[5105,5130,5],[5180,5184,5],[5253,5259,5],[5269,5275,5],[5292,5311,5],[5343,5349,5],[5355,5357,5],[5387,5389,5],[5459,5463,5],[5479,5482,5],[5530,5539,5],[5550,5552,5],[5562,5583,5],[5623,5625,10],[5631,5639,5],[5649,5653,5],[5663,5680,5],[5682,5685,5],[5875,5877,5],[5896,5899,5],[5921,5940,5],[6050,6125,5],[6351,6354,5],[6366,6372,5],[6381,6387,5],[6622,6624,5],[6707,6709,5],[6720,6723,5],[6732,6738,5],[6931,6933,5],[7005,7007,5],[7057,7070,10],[7074,7082,5],[7109,7118,5],[7119,7127,11],[7374,7376,5],[7528,7586,5],[7587,7645,10],[7755,7787,5],[7791,7795,5],[7799,7801,5],[7803,7805,5],[7825,7831,5],[7845,7859,5],[8013,8032,5],[8065,8068,11],[8518,8529,10],[8533,8536,10],[8538,8540,10],[8677,8679,5],[8836,8840,5],[8908,8910,5],[9154,9159,5],[9205,9218,5],[20002,20032,5],[20062,20092,5],[20135,20138,5],[20248,20258,5],[20348,20358,5],[20436,20440,5],[20822,20824,5],[20934,20936,5],[21035,21037,5],[21095,21097,5],[21148,21150,5],[21413,21423,5],[21473,21483,5],[21780,21782,5],[21891,21894,5],[22171,22177,5],[22181,22187,5],[22191,22197,5],[22234,22236,5],[22521,22525,5],[22991,22994,5],[23028,23038,5],[23830,23853,5],[23866,23872,5],[23877,23884,5],[23886,23894,5],[23946,23948,5],[24311,24313,5],[24342,24347,5],[24370,24374,6],[24375,24381,5],[24718,24721,5],[24817,24821,5],[24877,24882,5],[24891,24893,5],[25391,25395,5],[25828,25838,5],[26191,26195,5],[26391,26393,5],[26703,26722,5],[26729,26760,10],[26766,26798,10],[26860,26870,10],[26891,26899,5],[26903,26923,5],[26929,26946,5],[26948,26998,5],[27037,27040,5],[27205,27232,5],[27258,27260,5],[27391,27398,5],[27561,27564,5],[27571,27574,5],[27581,27584,5],[27591,27594,5],[28191,28193,5],[28348,28358,5],[28402,28432,5],[28462,28492,5],[29118,29122,5],[29177,29185,5],[30161,30179,5],[30491,30494,5],[30729,30732,5],[31251,31259,5],[31265,31268,5],[31275,31278,5],[31288,31297,5],[31461,31465,5],[31491,31495,5],[31917,31922,5],[31965,31985,5],[31992,32e3,5],[32001,32003,10],[32005,32031,10],[32033,32060,10],[32074,32077,10],[32081,32086,5],[32107,32130,5],[32133,32158,5],[32164,32167,10],[32180,32199,5],[32201,32260,5],[32301,32360,5],[32601,32662,5],[32664,32667,10],[32701,32761,5],[53001,53004,5],[53008,53019,5],[53021,53032,5],[53034,53037,5],[53042,53046,5],[53074,53080,5],[54001,54004,5],[54008,54019,5],[54021,54032,5],[54034,54037,5],[54042,54046,5],[54048,54053,5],[54074,54080,5],[54098,54101,5],[102001,102040,5],[102042,102063,5],[102065,102067,5],[102070,102112,5],[102114,102117,5],[102122,102208,5],[102210,102216,5],[102221,102300,5],[102304,102377,5],[102382,102388,5],[102389,102398,10],[102399,102444,5],[102445,102447,10],[102448,102458,5],[102459,102468,10],[102469,102496,5],[102500,102519,11],[102520,102524,5],[102525,102529,10],[102530,102549,5],[102557,102588,5],[102593,102598,5],[102601,102603,5],[102608,102628,5],[102629,102646,10],[102648,102672,10],[102675,102700,10],[102701,102703,5],[102707,102730,10],[102735,102758,10],[102767,102900,5],[102965,102969,5],[102971,102973,5],[102975,102989,5],[102990,102992,11],[102997,103002,5],[103003,103008,10],[103009,103011,5],[103012,103014,10],[103019,103021,5],[103022,103024,10],[103029,103031,5],[103032,103034,10],[103065,103068,5],[103074,103076,5],[103077,103079,11],[103080,103082,5],[103083,103085,10],[103090,103093,5],[103097,103099,5],[103100,103102,10],[103107,103109,5],[103110,103112,10],[103113,103116,5],[103117,103120,10],[103153,103157,5],[103158,103162,10],[103163,103165,5],[103166,103168,11],[103169,103171,10],[103186,103188,5],[103189,103191,10],[103192,103195,5],[103196,103199,10],[103200,103224,5],[103225,103227,11],[103232,103237,5],[103238,103243,10],[103244,103246,5],[103247,103249,10],[103254,103256,5],[103257,103259,10],[103264,103266,5],[103267,103269,10],[103300,103375,5],[103381,103383,5],[103384,103386,11],[103387,103389,5],[103390,103392,10],[103397,103399,5],[103400,103471,10],[103476,103478,5],[103479,103481,10],[103486,103488,5],[103489,103491,10],[103492,103495,5],[103496,103499,10],[103539,103543,5],[103544,103548,10],[103549,103551,5],[103552,103554,11],[103555,103557,10],[103558,103560,5],[103571,103573,5],[103574,103576,10],[103577,103580,5],[103581,103583,10],[103595,103597,5],[103600,103694,5],[103696,103698,5],[103700,103793,10],[103794,103799,5]],gcsid:[4001,81,4002,85,4003,70,4004,84,4005,82,4006,83,4007,60,4008,67,4009,39,4010,57,4011,63,4012,64,4013,64,4014,63,4015,92,4016,90,4018,86,4019,75,4020,68,4021,70,4022,55,4023,75,4024,66,4025,73,4027,95,4028,59,4029,58,4031,75,4032,78,4033,77,4034,65,4035,100,4036,70,4042,88,4044,87,4045,89,4046,75,4047,99,4052,101,4053,97,4054,61,4075,75,4081,75,4120,84,4121,75,4122,80,4123,55,4124,84,4126,75,4130,75,4131,92,4132,64,4133,75,4134,64,4140,75,4141,75,4142,64,4143,64,4144,92,4145,87,4146,89,4147,66,4148,75,4149,84,4150,84,4151,75,4152,75,4153,55,4154,55,4155,63,4156,84,4157,60,4162,84,4163,75,4164,66,4165,55,4166,75,4168,58,4170,75,4172,75,4173,75,4174,58,4175,64,4176,75,4178,66,4179,66,4180,75,4188,81,4190,75,4191,66,4192,55,4193,63,4198,64,4199,55,4200,66,4201,64,4202,70,4203,70,4204,55,4205,66,4206,63,4207,55,4208,55,4209,64,4210,64,4211,84,4212,64,4213,63,4214,66,4215,55,4216,67,4218,55,4219,84,4220,64,4221,55,4222,64,4224,55,4225,55,4229,68,4230,55,4231,55,4232,64,4234,64,4235,55,4236,55,4237,70,4238,70,4239,92,4240,92,4241,65,4242,67,4243,88,4244,92,4245,86,4246,64,4250,64,4251,64,4252,63,4253,67,4254,55,4255,55,4256,64,4257,84,4258,75,4259,55,4260,64,4261,106,4262,84,4263,64,4265,55,4266,63,4267,67,4269,75,4270,64,4271,55,4272,55,4273,82,4274,55,4275,63,4276,73,4280,84,4281,57,4282,63,4283,75,4284,66,4285,55,4286,68,4288,55,4289,84,4291,70,4292,55,4293,83,4294,84,4295,84,4296,63,4297,55,4298,90,4299,85,4300,85,4301,84,4302,60,4303,68,4306,84,4307,64,4308,84,4309,55,4310,63,4311,55,4312,84,4313,55,4314,84,4315,63,4316,55,4317,66,4318,75,4319,75,4322,80,4324,80,4326,75,4466,75,4469,75,4475,55,4483,75,4490,75,4555,66,4558,75,4608,67,4609,67,4610,74,4614,55,4619,75,4624,75,4625,55,4627,75,4636,55,4637,55,4638,67,4639,55,4657,93,4659,75,4660,55,4661,75,4666,84,4667,75,4670,75,4671,63,4674,75,4679,64,4680,64,4682,92,4683,67,4686,75,4687,75,4693,75,4694,75,4695,67,4696,64,4697,64,4702,75,4703,64,4704,55,4705,55,4706,68,4718,55,4720,80,4721,55,4723,67,4726,67,4737,75,4738,60,4740,79,4741,55,4742,75,4743,64,4744,64,4745,84,4746,84,4747,75,4748,56,4749,75,4750,75,4751,91,4752,56,4753,55,4754,55,4759,75,4761,75,4801,84,4802,55,4803,55,4804,84,4805,84,4806,55,4807,106,4808,84,4809,55,4810,105,4811,106,4816,106,4817,82,4818,84,4820,84,4821,106,4823,55,4824,55,4901,107,4902,107,4903,59,4904,84,5228,84,5229,84,5233,92,5252,75,5264,75,5340,75,5354,75,5360,75,5371,75,5373,75,5381,75,5393,75,5464,60,5467,67,5489,75,5524,55,5527,70,5546,75,5561,66,5593,75,5681,84,5886,75,6135,75,6365,75,6706,75,6881,64,6882,64,6883,55,6892,64,6894,64,6980,75,6983,75,6987,75,6990,75,7035,75,7037,75,7039,75,7041,75,7073,75,7084,75,7086,75,7133,75,7373,75,7683,76,7798,75,7844,75,7881,75,7886,75,8042,96,8043,96,8086,75,8232,75,8237,75,8240,75,8246,75,8249,75,8252,75,8255,75,8351,84,8427,75,8428,55,8449,75,8545,75,8685,75,8694,64,8699,75,8818,75,8888,75,8900,75,8902,75,8907,75,8949,75,9003,75,9006,75,9009,75,9012,75,9017,75,9068,75,9069,75,9140,75,9148,75,9153,75,37001,73,37002,69,37003,72,37004,71,37005,62,37006,91,37007,94,37008,101,37201,55,37202,92,37203,87,37204,55,37205,55,37206,64,37207,71,37208,64,37211,64,37220,67,37221,55,37222,55,37223,63,37224,55,37225,106,37226,55,37227,55,37228,64,37229,62,37230,55,37231,70,37232,55,37233,55,37235,55,37237,55,37238,55,37239,67,37240,64,37241,55,37242,55,37243,67,37252,67,37253,55,37254,64,37255,84,37257,66,37259,55,37260,67,104017,79,104018,79,104024,75,104027,75,104047,98,104050,75,104100,75,104101,84,104102,84,104103,64,104104,55,104105,84,104106,55,104107,75,104108,75,104109,67,104110,75,104111,75,104112,67,104113,67,104128,102,104129,75,104130,55,104131,84,104132,67,104133,75,104134,75,104135,66,104136,70,104137,75,104138,55,104139,106,104140,106,104223,75,104248,55,104256,92,104261,63,104286,75,104287,75,104304,63,104700,49,104701,9,104702,24,104703,15,104704,28,104705,32,104706,53,104707,46,104708,37,104709,54,104710,11,104711,14,104712,30,104713,52,104714,4,104715,4,104716,23,104717,14,104718,48,104719,29,104720,22,104721,21,104722,35,104723,21,104724,46,104725,22,104726,49,104727,45,104728,52,104729,10,104730,10,104731,21,104732,31,104733,26,104734,40,104735,19,104736,30,104737,34,104738,27,104739,46,104740,5,104741,12,104742,50,104743,9,104744,43,104745,21,104746,26,104747,25,104748,21,104749,7,104750,53,104751,6,104752,33,104753,29,104754,19,104755,41,104756,31,104757,3,104758,41,104759,25,104760,49,104761,41,104762,44,104763,50,104764,46,104765,6,104766,40,104767,16,104768,8,104769,17,104770,48,104771,42,104772,50,104773,25,104774,29,104775,25,104776,32,104777,13,104778,36,104779,47,104780,14,104781,29,104782,23,104783,38,104784,42,104785,18,104786,20,104808,51,104896,75,104900,112,104901,104,104902,103,104903,116,104904,109,104905,108,104906,169,104907,164,104908,0,104909,168,104910,141,104911,166,104912,114,104913,160,104914,151,104915,117,104916,110,104917,140,104918,115,104919,170,104920,163,104921,154,104922,158,104923,161,104924,148,104925,0,104926,159,104927,167,104928,127,104929,131,104930,145,104931,159,104932,136,104933,123,104934,139,104935,134,104936,166,104937,150,104938,137,104939,147,104940,121,104941,165,104942,128,104943,111,104944,1,104945,126,104946,152,104947,157,104948,162,104949,153,104950,156,104951,149,104952,132,104953,122,104954,160,104955,146,104956,143,104957,156,104958,120,104959,125,104960,2,104961,144,104962,142,104963,138,104964,155,104965,135,104966,133,104967,151,104968,118,104969,119,104970,124,104971,108,104972,129,104973,130,104974,113,104975,0,104990,84,104991,75,104992,84],gcsidc:[[4127,4129,67],[4135,4139,67],[4158,4161,55],[4181,4185,55],[4194,4196,55],[4226,4228,63],[4247,4249,55],[4277,4279,81],[4600,4607,64],[4621,4623,55],[4628,4633,55],[4641,4646,55],[4662,4665,55],[4676,4678,66],[4688,4692,55],[4699,4701,64],[4755,4757,75],[4763,4765,75],[4813,4815,84],[8972,8987,75],[37212,37219,55],[37245,37247,55],[37249,37251,55],[104009,104015,75],[104019,104022,75],[104114,104124,75],[104125,104127,55],[104141,104145,75],[104179,104186,75],[104257,104260,75]]},x={c:[[2e3,2035,9001],[2039,2045,9001],[2056,2062,9001],[2067,2090,9001],[2093,2135,9001],[2161,2165,9001],[2172,2180,9001],[2188,2193,9001],[2195,2198,9001],[2200,2203,9001],[2205,2213,9001],[2215,2217,9001],[2222,2224,9002],[2225,2243,9003],[2246,2250,9003],[2251,2253,9002],[2257,2264,9003],[2274,2279,9003],[2280,2282,9002],[2283,2289,9003],[2308,2313,9001],[2315,2491,9001],[2494,2576,9001],[2578,2599,9001],[2601,2693,9001],[2695,2866,9001],[2867,2869,9002],[2870,2888,9003],[2891,2895,9003],[2896,2898,9002],[2902,2908,9003],[2915,2920,9003],[2921,2923,9002],[2924,2930,9003],[2931,2933,9001],[2935,2962,9001],[2964,2968,9003],[2969,2973,9001],[2975,2978,9001],[2984,2988,9001],[2995,3051,9001],[3054,3072,9001],[3077,3079,9001],[3081,3088,9001],[3092,3101,9001],[3106,3138,9001],[3146,3151,9001],[3153,3166,9001],[3168,3172,9001],[3174,3203,9001],[3294,3313,9001],[3315,3348,9001],[3350,3358,9001],[3367,3403,9001],[3408,3416,9001],[3417,3438,9003],[3441,3446,9003],[3447,3450,9001],[3451,3453,9003],[3455,3459,9003],[3460,3478,9001],[3554,3559,9001],[3560,3570,9003],[3571,3581,9001],[3594,3597,9001],[3601,3604,9001],[3637,3639,9001],[3665,3667,9001],[3693,3695,9001],[3701,3727,9001],[3728,3739,9003],[3740,3751,9001],[3753,3760,9003],[3761,3773,9001],[3775,3777,9001],[3779,3781,9001],[3788,3791,9001],[3797,3802,9001],[3814,3816,9001],[3825,3829,9001],[3832,3841,9001],[3844,3852,9001],[3873,3885,9001],[3890,3893,9001],[3942,3950,9001],[3968,3970,9001],[3973,3976,9001],[3986,3989,9001],[3994,3997,9001],[4001,4016,9102],[4018,4025,9102],[4027,4029,9102],[4031,4036,9102],[4044,4047,9102],[4048,4051,9001],[4052,4054,9102],[4056,4063,9001],[4093,4096,9001],[4120,4124,9102],[4127,4139,9102],[4141,4176,9102],[4178,4185,9102],[4188,4216,9102],[4218,4232,9102],[4235,4260,9102],[4265,4267,9102],[4269,4286,9102],[4292,4304,9102],[4306,4319,9102],[4390,4398,9001],[4399,4413,9003],[4418,4433,9003],[4455,4457,9003],[4484,4489,9001],[4491,4554,9001],[4568,4589,9001],[4600,4630,9102],[4636,4639,9102],[4641,4646,9102],[4652,4656,9001],[4657,4680,9102],[4682,4684,9102],[4686,4765,9102],[4766,4800,9001],[4801,4806,9102],[4813,4815,9102],[5014,5016,9001],[5069,5072,9001],[5105,5130,9001],[5173,5188,9001],[5253,5259,9001],[5269,5275,9001],[5292,5311,9001],[5329,5331,9001],[5343,5349,9001],[5355,5357,9001],[5459,5463,9001],[5479,5482,9001],[5518,5520,9001],[5533,5539,9001],[5550,5552,9001],[5562,5583,9001],[5623,5625,9003],[5631,5639,9001],[5649,5653,9001],[5663,5680,9001],[5682,5685,9001],[5875,5877,9001],[5896,5899,9001],[5921,5940,9001],[6050,6125,9001],[6244,6275,9001],[6328,6348,9001],[6350,6356,9001],[6366,6372,9001],[6381,6387,9001],[6393,6404,9001],[6480,6483,9001],[6511,6514,9001],[6579,6581,9001],[6619,6624,9001],[6625,6627,9003],[6628,6632,9001],[6634,6637,9001],[6669,6692,9001],[6707,6709,9001],[6720,6723,9001],[6732,6738,9001],[6881,6883,9102],[6931,6933,9001],[7005,7007,9001],[7057,7070,9003],[7074,7082,9001],[7109,7118,9001],[7119,7127,9002],[7374,7376,9001],[7528,7586,9001],[7587,7645,9003],[7692,7696,9001],[7755,7787,9001],[7791,7795,9001],[7799,7801,9001],[7803,7805,9001],[7825,7831,9001],[7845,7859,9001],[8013,8032,9001],[8065,8068,9002],[8518,8529,9003],[8533,8536,9003],[8538,8540,9003],[8677,8679,9001],[8836,8840,9001],[8857,8859,9001],[8908,8910,9001],[8972,9e3,9102],[9053,9057,9102],[9059,9069,9102],[9154,9159,9001],[9205,9218,9001],[20002,20032,9001],[20062,20092,9001],[20135,20138,9001],[20248,20258,9001],[20348,20358,9001],[20436,20440,9001],[20822,20824,9001],[20934,20936,9001],[21035,21037,9001],[21095,21097,9001],[21148,21150,9001],[21413,21423,9001],[21473,21483,9001],[21780,21782,9001],[21896,21899,9001],[22171,22177,9001],[22181,22187,9001],[22191,22197,9001],[22234,22236,9001],[22521,22525,9001],[22991,22994,9001],[23028,23038,9001],[23830,23853,9001],[23866,23872,9001],[23877,23884,9001],[23886,23894,9001],[23946,23948,9001],[24311,24313,9001],[24342,24347,9001],[24370,24374,9084],[24375,24381,9001],[24718,24721,9001],[24817,24821,9001],[24877,24882,9001],[24891,24893,9001],[25391,25395,9001],[25828,25838,9001],[26191,26195,9001],[26391,26393,9001],[26701,26722,9001],[26729,26746,9003],[26748,26760,9003],[26766,26799,9003],[26847,26870,9003],[26891,26899,9001],[26901,26923,9001],[26929,26946,9001],[26948,26978,9001],[26980,26998,9001],[27037,27040,9001],[27205,27232,9001],[27258,27260,9001],[27391,27398,9001],[27561,27564,9001],[27571,27574,9001],[27581,27584,9001],[27591,27594,9001],[28191,28193,9001],[28348,28358,9001],[28402,28432,9001],[28462,28492,9001],[29168,29172,9001],[29187,29195,9001],[29901,29903,9001],[30161,30179,9001],[30491,30494,9001],[30729,30732,9001],[31251,31259,9001],[31265,31268,9001],[31275,31277,9001],[31281,31290,9001],[31466,31469,9001],[31491,31495,9001],[31965,32e3,9001],[32001,32003,9003],[32005,32017,9003],[32019,32028,9003],[32033,32035,9003],[32037,32060,9003],[32064,32067,9003],[32081,32086,9001],[32107,32130,9001],[32133,32158,9001],[32164,32167,9003],[32180,32199,9001],[32201,32260,9001],[32301,32360,9001],[32601,32662,9001],[32664,32667,9003],[32701,32761,9001],[37002,37008,9102],[53001,53004,9001],[53008,53019,9001],[53021,53032,9001],[53034,53037,9001],[53042,53046,9001],[53074,53080,9001],[54001,54004,9001],[54008,54019,9001],[54021,54032,9001],[54042,54046,9001],[54048,54053,9001],[54074,54080,9001],[54098,54101,9001],[102001,102005,9001],[102007,102039,9001],[102042,102045,9001],[102060,102063,9001],[102070,102079,9001],[102096,102099,9001],[102101,102109,9001],[102114,102117,9001],[102132,102138,9001],[102141,102144,9001],[102156,102166,9001],[102173,102179,9001],[102191,102198,9001],[102221,102228,9001],[102231,102233,9001],[102237,102240,9001],[102364,102375,9001],[102389,102398,9003],[102399,102419,9001],[102421,102438,9001],[102445,102447,9003],[102450,102458,9001],[102459,102462,9003],[102470,102489,9001],[102550,102556,9001],[102562,102588,9001],[102629,102640,9003],[102648,102650,9003],[102688,102690,9003],[102696,102700,9003],[102701,102703,9001],[102799,102900,9001],[103166,103168,9002],[103220,103224,9001],[103225,103227,9002],[103232,103237,9001],[103238,103243,9003],[103244,103246,9001],[103247,103249,9003],[103254,103256,9001],[103257,103259,9003],[103264,103266,9001],[103267,103269,9003],[103327,103330,9001],[103344,103347,9001],[103372,103375,9001],[103381,103383,9001],[103384,103386,9002],[103387,103389,9001],[103390,103392,9003],[103397,103399,9001],[103427,103430,9003],[103444,103447,9003],[103476,103478,9001],[103479,103481,9003],[103486,103488,9001],[103489,103491,9003],[103492,103495,9001],[103496,103499,9003],[103539,103543,9001],[103544,103548,9003],[103549,103551,9001],[103552,103554,9002],[103555,103557,9003],[103558,103560,9001],[103571,103573,9001],[103574,103576,9003],[103577,103580,9001],[103581,103583,9003],[103595,103597,9001],[103600,103694,9001],[103696,103698,9001],[103700,103793,9003],[104101,104103,9102],[104126,104131,9102],[104259,104261,9102],[104700,104786,9102],[104900,104975,9102]],nc:[2065,9001,2066,9039,2136,9094,2137,9001,2138,9001,2154,9001,2157,9001,2158,9001,2159,9094,2160,9094,2169,9001,2170,9001,2204,9003,2219,9001,2220,9001,2254,9003,2255,9003,2256,9002,2265,9002,2266,9002,2267,9003,2268,9003,2269,9002,2270,9002,2271,9003,2272,9003,2273,9002,2290,9001,2294,9001,2295,9001,2314,9005,2899,9003,2900,9003,2901,9002,2909,9002,2910,9002,2911,9003,2912,9003,2913,9002,2914,9002,2980,9001,2981,9001,2991,9001,2992,9002,2993,9001,2994,9002,3074,9001,3075,9001,3080,9002,3089,9003,3090,9001,3091,9003,3102,9003,3141,9001,3142,9001,3167,9301,3360,9001,3361,9002,3362,9001,3363,9003,3364,9001,3365,9003,3404,9003,3405,9001,3406,9001,3407,9005,3439,9001,3440,9001,3479,9002,3480,9001,3481,9002,3482,9001,3483,9002,3484,9001,3485,9003,3486,9001,3487,9003,3488,9001,3489,9001,3490,9003,3491,9001,3492,9003,3493,9001,3494,9003,3495,9001,3496,9003,3497,9001,3498,9003,3499,9001,3500,9003,3501,9001,3502,9003,3503,9001,3504,9003,3505,9001,3506,9003,3507,9001,3508,9003,3509,9001,3510,9003,3511,9001,3512,9003,3513,9001,3514,9001,3515,9003,3516,9001,3517,9003,3518,9001,3519,9003,3520,9001,3521,9003,3522,9001,3523,9003,3524,9001,3525,9003,3526,9001,3527,9003,3528,9001,3529,9003,3530,9001,3531,9003,3532,9001,3533,9003,3534,9001,3535,9003,3536,9001,3537,9003,3538,9001,3539,9003,3540,9001,3541,9003,3542,9001,3543,9003,3544,9001,3545,9003,3546,9001,3547,9003,3548,9001,3549,9003,3550,9001,3551,9003,3552,9001,3553,9003,3582,9003,3583,9001,3584,9003,3585,9001,3586,9003,3587,9001,3588,9002,3589,9001,3590,9002,3591,9001,3592,9001,3593,9002,3598,9003,3599,9001,3600,9003,3605,9002,3606,9001,3607,9001,3608,9003,3609,9001,3610,9003,3611,9001,3612,9003,3613,9001,3614,9003,3615,9001,3616,9003,3617,9001,3618,9003,3619,9001,3620,9003,3621,9001,3622,9003,3623,9001,3624,9003,3625,9001,3626,9003,3627,9001,3628,9003,3629,9001,3630,9003,3631,9001,3632,9003,3633,9001,3634,9002,3635,9001,3636,9002,3640,9003,3641,9001,3642,9003,3643,9001,3644,9002,3645,9001,3646,9002,3647,9001,3648,9002,3649,9001,3650,9003,3651,9001,3652,9003,3653,9001,3654,9003,3655,9001,3656,9002,3657,9001,3658,9003,3659,9001,3660,9003,3661,9001,3662,9003,3663,9001,3664,9003,3668,9003,3669,9001,3670,9003,3671,9001,3672,9003,3673,9001,3674,9003,3675,9001,3676,9002,3677,9003,3678,9001,3679,9002,3680,9003,3681,9001,3682,9002,3683,9003,3684,9001,3685,9001,3686,9003,3687,9001,3688,9003,3689,9001,3690,9003,3691,9001,3692,9003,3696,9003,3697,9001,3698,9003,3699,9001,3700,9003,3783,9001,3784,9001,3793,9001,3794,9001,3812,9001,3819,9102,3821,9102,3824,9102,3854,9001,3857,9001,3889,9102,3906,9102,3911,9001,3912,9001,3920,9001,3978,9001,3979,9001,3991,9003,3992,9003,4026,9001,4037,9001,4038,9001,4042,9102,4071,9001,4075,9102,4081,9102,4082,9001,4083,9001,4087,9001,4088,9001,4217,9003,4261,9105,4262,9102,4263,9102,4288,9102,4289,9102,4322,9102,4324,9102,4326,9102,4414,9001,4415,9001,4417,9001,4434,9001,4437,9001,4438,9003,4439,9003,4462,9001,4463,9102,4467,9001,4470,9102,4471,9001,4475,9102,4483,9102,4490,9102,4555,9102,4558,9102,4559,9001,4632,9102,4633,9102,4647,9001,4807,9105,4808,9102,4809,9102,4810,9105,4811,9105,4816,9105,4817,9102,4818,9102,4820,9102,4821,9105,4822,9001,4823,9102,4824,9102,4826,9001,4839,9001,4901,9105,4902,9105,4903,9102,4904,9102,5013,9102,5018,9001,5048,9001,5167,9001,5168,9001,5221,9001,5223,9001,5228,9102,5229,9102,5233,9102,5234,9001,5235,9001,5243,9001,5246,9102,5247,9001,5252,9102,5264,9102,5266,9001,5316,9001,5320,9001,5321,9001,5324,9102,5325,9001,5337,9001,5340,9102,5354,9102,5360,9102,5361,9001,5362,9001,5365,9102,5367,9001,5371,9102,5373,9102,5381,9102,5382,9001,5383,9001,5387,9001,5389,9001,5393,9102,5396,9001,5451,9102,5456,9001,5457,9001,5464,9102,5467,9102,5469,9001,5472,9037,5489,9102,5490,9001,5513,9001,5514,9001,5523,9001,5524,9102,5527,9102,5530,9001,5531,9001,5546,9102,5559,9001,5561,9102,5588,9002,5589,9005,5593,9102,5596,9001,5627,9001,5629,9001,5641,9001,5643,9001,5644,9001,5646,9003,5654,9003,5655,9003,5659,9001,5681,9102,5700,9001,5825,9001,5836,9001,5837,9001,5839,9001,5842,9001,5844,9001,5858,9001,5879,9001,5880,9001,5886,9102,5887,9001,5890,9001,6128,9002,6129,9002,6135,9102,6204,9001,6207,9102,6210,9001,6211,9001,6307,9001,6311,9102,6312,9001,6316,9001,6318,9102,6322,9102,6325,9102,6362,9001,6365,9102,6391,9002,6405,9002,6406,9001,6407,9002,6408,9001,6409,9002,6410,9001,6411,9003,6412,9001,6413,9003,6414,9001,6415,9001,6416,9003,6417,9001,6418,9003,6419,9001,6420,9003,6421,9001,6422,9003,6423,9001,6424,9003,6425,9001,6426,9003,6427,9001,6428,9003,6429,9001,6430,9003,6431,9001,6432,9003,6433,9001,6434,9003,6435,9001,6436,9003,6437,9001,6438,9003,6439,9001,6440,9001,6441,9003,6442,9001,6443,9003,6444,9001,6445,9003,6446,9001,6447,9003,6448,9001,6449,9003,6450,9001,6451,9003,6452,9001,6453,9003,6454,9001,6455,9003,6456,9001,6457,9003,6458,9001,6459,9003,6460,9001,6461,9003,6462,9001,6463,9003,6464,9001,6465,9003,6466,9001,6467,9003,6468,9001,6469,9003,6470,9001,6471,9003,6472,9001,6473,9003,6474,9001,6475,9003,6476,9001,6477,9003,6478,9001,6479,9003,6484,9003,6485,9001,6486,9003,6487,9001,6488,9003,6489,9001,6490,9003,6491,9001,6492,9003,6493,9001,6494,9002,6495,9001,6496,9002,6497,9001,6498,9001,6499,9002,6500,9001,6501,9003,6502,9001,6503,9003,6504,9001,6505,9003,6506,9001,6507,9003,6508,9001,6509,9001,6510,9003,6515,9002,6516,9001,6518,9001,6519,9003,6520,9001,6521,9003,6522,9001,6523,9003,6524,9001,6525,9003,6526,9001,6527,9003,6528,9001,6529,9003,6530,9001,6531,9003,6532,9001,6533,9003,6534,9001,6535,9003,6536,9001,6537,9003,6538,9001,6539,9003,6540,9001,6541,9003,6542,9001,6543,9003,6544,9001,6545,9002,6546,9001,6547,9002,6548,9001,6549,9003,6550,9001,6551,9003,6552,9001,6553,9003,6554,9001,6555,9003,6556,9001,6557,9002,6558,9001,6559,9002,6560,9001,6561,9002,6562,9001,6563,9003,6564,9001,6565,9003,6566,9001,6567,9001,6568,9003,6569,9001,6570,9002,6571,9001,6572,9003,6573,9001,6574,9003,6575,9001,6576,9003,6577,9001,6578,9003,6582,9003,6583,9001,6584,9003,6585,9001,6586,9003,6587,9001,6588,9003,6589,9001,6590,9003,6591,9001,6592,9001,6593,9003,6594,9001,6595,9003,6596,9001,6597,9003,6598,9001,6599,9003,6600,9001,6601,9003,6602,9001,6603,9003,6605,9003,6606,9001,6607,9003,6608,9001,6609,9003,6610,9001,6611,9001,6612,9003,6613,9001,6614,9003,6615,9001,6616,9003,6617,9001,6618,9003,6633,9003,6646,9001,6668,9102,6703,9001,6706,9102,6783,9102,6784,9001,6785,9002,6786,9001,6787,9002,6788,9001,6789,9002,6790,9001,6791,9002,6792,9001,6793,9002,6794,9001,6795,9002,6796,9001,6797,9002,6798,9001,6799,9002,6800,9001,6801,9002,6802,9001,6803,9002,6804,9001,6805,9002,6806,9001,6807,9002,6808,9001,6809,9002,6810,9001,6811,9002,6812,9001,6813,9002,6814,9001,6815,9002,6816,9001,6817,9002,6818,9001,6819,9002,6820,9001,6821,9002,6822,9001,6823,9002,6824,9001,6825,9002,6826,9001,6827,9002,6828,9001,6829,9002,6830,9001,6831,9002,6832,9001,6833,9002,6834,9001,6835,9002,6836,9001,6837,9002,6838,9001,6839,9002,6840,9001,6841,9002,6842,9001,6843,9002,6844,9001,6845,9002,6846,9001,6847,9002,6848,9001,6849,9002,6850,9001,6851,9002,6852,9001,6853,9002,6854,9001,6855,9002,6856,9001,6857,9002,6858,9001,6859,9002,6860,9001,6861,9002,6862,9001,6863,9002,6867,9001,6868,9002,6870,9001,6875,9001,6876,9001,6879,9001,6880,9003,6884,9001,6885,9002,6886,9001,6887,9002,6892,9102,6894,9102,6915,9001,6922,9001,6923,9003,6924,9001,6925,9003,6962,9001,6983,9102,6984,9001,6990,9102,6991,9001,7035,9102,7037,9102,7039,9102,7041,9102,7073,9102,7084,9102,7086,9102,7128,9003,7131,9001,7132,9003,7133,9102,7136,9102,7139,9102,7142,9001,7257,9001,7258,9003,7259,9001,7260,9003,7261,9001,7262,9003,7263,9001,7264,9003,7265,9001,7266,9003,7267,9001,7268,9003,7269,9001,7270,9003,7271,9001,7272,9003,7273,9001,7274,9003,7275,9001,7276,9003,7277,9001,7278,9003,7279,9001,7280,9003,7281,9001,7282,9003,7283,9001,7284,9003,7285,9001,7286,9003,7287,9001,7288,9003,7289,9001,7290,9003,7291,9001,7292,9003,7293,9001,7294,9003,7295,9001,7296,9003,7297,9001,7298,9003,7299,9001,7300,9003,7301,9001,7302,9003,7303,9001,7304,9003,7305,9001,7306,9003,7307,9001,7308,9003,7309,9001,7310,9003,7311,9001,7312,9003,7313,9001,7314,9003,7315,9001,7316,9003,7317,9001,7318,9003,7319,9001,7320,9003,7321,9001,7322,9003,7323,9001,7324,9003,7325,9001,7326,9003,7327,9001,7328,9003,7329,9001,7330,9003,7331,9001,7332,9003,7333,9001,7334,9003,7335,9001,7336,9003,7337,9001,7338,9003,7339,9001,7340,9003,7341,9001,7342,9003,7343,9001,7344,9003,7345,9001,7346,9003,7347,9001,7348,9003,7349,9001,7350,9003,7351,9001,7352,9003,7353,9001,7354,9003,7355,9001,7356,9003,7357,9001,7358,9003,7359,9001,7360,9003,7361,9001,7362,9003,7363,9001,7364,9003,7365,9001,7366,9003,7367,9001,7368,9003,7369,9001,7370,9003,7373,9102,7683,9102,7798,9102,7844,9102,7877,9001,7878,9001,7881,9102,7882,9001,7883,9001,7886,9102,7887,9001,7899,9001,7991,9001,7992,9001,8035,9003,8036,9003,8042,9102,8043,9102,8058,9001,8059,9001,8082,9001,8083,9001,8086,9102,8088,9001,8090,9001,8091,9003,8092,9001,8093,9003,8095,9001,8096,9003,8097,9001,8098,9003,8099,9001,8100,9003,8101,9001,8102,9003,8103,9001,8104,9003,8105,9001,8106,9003,8107,9001,8108,9003,8109,9001,8110,9003,8111,9001,8112,9003,8113,9001,8114,9003,8115,9001,8116,9003,8117,9001,8118,9003,8119,9001,8120,9003,8121,9001,8122,9003,8123,9001,8124,9003,8125,9001,8126,9003,8127,9001,8128,9003,8129,9001,8130,9003,8131,9001,8132,9003,8133,9001,8134,9003,8135,9001,8136,9003,8137,9001,8138,9003,8139,9001,8140,9003,8141,9001,8142,9003,8143,9001,8144,9003,8145,9001,8146,9003,8147,9001,8148,9003,8149,9001,8150,9003,8151,9001,8152,9003,8153,9001,8154,9003,8155,9001,8156,9003,8157,9001,8158,9003,8159,9001,8160,9003,8161,9001,8162,9003,8163,9001,8164,9003,8165,9001,8166,9003,8167,9001,8168,9003,8169,9001,8170,9003,8171,9001,8172,9003,8173,9001,8177,9003,8179,9001,8180,9003,8181,9001,8182,9003,8184,9001,8185,9003,8187,9001,8189,9003,8191,9001,8193,9003,8196,9001,8197,9003,8198,9001,8200,9003,8201,9001,8202,9003,8203,9001,8204,9003,8205,9001,8206,9003,8207,9001,8208,9003,8209,9001,8210,9003,8212,9001,8213,9003,8214,9001,8216,9003,8218,9001,8220,9003,8222,9001,8224,9003,8225,9001,8226,9003,8232,9102,8237,9102,8240,9102,8246,9102,8249,9102,8252,9102,8255,9102,8311,9001,8312,9002,8313,9001,8314,9002,8315,9001,8316,9002,8317,9001,8318,9002,8319,9001,8320,9002,8321,9001,8322,9002,8323,9001,8324,9002,8325,9001,8326,9002,8327,9001,8328,9002,8329,9001,8330,9002,8331,9001,8332,9002,8333,9001,8334,9002,8335,9001,8336,9002,8337,9001,8338,9002,8339,9001,8340,9002,8341,9001,8342,9002,8343,9001,8344,9002,8345,9001,8346,9002,8347,9001,8348,9002,8351,9102,8352,9001,8353,9001,8379,9001,8380,9003,8381,9001,8382,9003,8383,9001,8384,9003,8385,9001,8387,9003,8391,9001,8395,9001,8427,9102,8428,9102,8431,9102,8433,9001,8441,9001,8455,9001,8456,9001,8531,9003,8545,9102,8682,9001,8685,9102,8687,9001,8692,9001,8693,9001,8694,9102,8699,9102,8818,9102,8826,9001,8860,9102,8888,9102,8900,9102,8902,9102,8903,9001,8907,9102,8949,9102,8950,9001,8951,9001,9003,9102,9006,9102,9009,9102,9012,9102,9014,9102,9017,9102,9019,9102,9039,9001,9040,9001,9140,9102,9141,9001,9148,9102,9149,9001,9150,9001,9153,9102,9191,9001,9221,9001,9222,9001,20499,9001,20538,9001,20539,9001,20790,9001,20791,9001,21291,9001,21292,9001,21500,9001,21817,9001,21818,9001,22032,9001,22033,9001,22091,9001,22092,9001,22332,9001,22391,9001,22392,9001,22700,9001,22770,9001,22780,9001,22832,9001,23090,9001,23095,9001,23239,9001,23240,9001,23700,9001,24047,9001,24048,9001,24100,9005,24200,9001,24305,9001,24306,9001,24382,9084,24383,9001,24500,9001,24547,9001,24548,9001,24571,9062,24600,9001,25e3,9001,25231,9001,25884,9001,25932,9001,26237,9001,26331,9001,26332,9001,26591,9001,26592,9001,26632,9001,26692,9001,27120,9001,27200,9001,27291,9040,27292,9040,27429,9001,27493,9001,27500,9001,27700,9001,28232,9001,28600,9001,28991,9001,28992,9001,29101,9001,29220,9001,29221,9001,29333,9001,29635,9001,29636,9001,29701,9001,29738,9001,29739,9001,29849,9001,29850,9001,29871,9042,29872,9041,29873,9001,30200,9039,30339,9001,30340,9001,30791,9001,30792,9001,31028,9001,31121,9001,31154,9001,31170,9001,31171,9001,31279,9001,31370,9001,31528,9001,31529,9001,31600,9001,31700,9001,31838,9001,31839,9001,31901,9001,32030,9003,32031,9003,32061,9001,32062,9001,32098,9001,32099,9003,32100,9001,32104,9001,32161,9001,32766,9001,37202,9102,37203,9102,37206,9102,37207,9102,37218,9102,37221,9102,37225,9105,37240,9102,37241,9102,37243,9102,37245,9102,37249,9102,37257,9102,37260,9102,53048,9001,53049,9001,54034,9001,54090,9001,54091,9001,65061,9003,65062,9003,65161,9001,102041,9003,102064,9085,102068,109030,102069,109031,102093,9001,102094,9001,102118,9003,102120,9003,102121,9003,102122,9001,102150,9001,102168,9001,102204,9001,102212,9001,102213,9001,102215,9001,102216,9001,102217,9003,102218,9001,102219,9003,102220,9003,102247,9001,102299,9001,102306,9001,102319,9001,102328,9001,102329,9001,102359,9001,102360,9001,102440,9001,102448,9001,102464,9003,102465,9003,102491,9001,102492,9001,102498,9001,102499,9001,102525,9003,102526,9003,102528,9003,102529,9003,102589,9003,102598,9001,102599,9003,102600,9003,102604,9003,102661,9003,102662,9003,102664,9003,102665,9003,102705,9003,102720,9003,102721,9003,102726,9003,102727,9003,102733,9003,102761,9003,102766,9003,102974,9003,103228,9001,103229,9001,103230,9003,103231,9003,103250,9001,103251,9003,103252,9001,103253,9003,103260,9001,103261,9001,103262,9003,103263,9003,103270,9001,103271,9001,103272,9003,103273,9003,103274,9001,103275,9001,103276,9003,103277,9003,103278,9001,103279,9001,103280,9003,103281,9003,103282,9001,103283,9001,103284,9003,103285,9003,103286,9001,103287,9003,103288,9001,103289,9003,103290,9001,103291,9003,103292,9001,103293,9001,103294,9003,103295,9003,103296,9001,103297,9001,103298,9003,103299,9003,103300,9001,103307,9001,103313,9001,103319,9001,103322,9001,103323,9001,103332,9001,103335,9001,103338,9001,103340,9001,103351,9001,103358,9001,103370,9001,103376,9003,103377,9001,103378,9001,103379,9003,103380,9003,103393,9001,103394,9001,103395,9003,103396,9003,103400,9003,103407,9003,103413,9003,103419,9003,103422,9003,103423,9003,103432,9003,103435,9003,103438,9003,103440,9003,103451,9003,103458,9003,103470,9003,103472,9001,103473,9002,103474,9001,103475,9003,103482,9001,103483,9003,103484,9001,103485,9003,103500,9001,103501,9003,103502,9001,103503,9001,103504,9002,103505,9002,103506,9001,103507,9001,103508,9003,103509,9003,103510,9001,103511,9001,103512,9003,103513,9003,103514,9001,103515,9003,103516,9001,103517,9003,103518,9001,103519,9003,103520,9001,103521,9002,103522,9001,103523,9001,103524,9003,103525,9003,103526,9001,103527,9003,103561,9003,103562,9003,103563,9001,103564,9001,103565,9003,103566,9003,103567,9001,103568,9001,103569,9003,103570,9003,103585,9003,103586,9001,103587,9003,103588,9002,103589,9001,103590,9003,103591,9002,103592,9001,103593,9003,103594,9002,103695,9003,103846,9001,103946,9003,104009,9102,104017,9102,104018,9102,104022,9102,104024,9102,104027,9102,104047,9102,104050,9102,104105,9102,104106,9102,104109,9102,104112,9102,104113,9102,104134,9102,104135,9102,104138,9102,104139,9105,104140,9105,104808,9102]};f.wr=function(){function d(){}return d.Sy=function(c){d.xp===!1&&d.yt();var o=d.FQ(c);if(o==-1){var l=d.Bx(c);l!=c&&(o=d.Sy(l))}return o==-1&&(l=d.FK(c))!=c&&(o=d.Sy(l)),o},d.FQ=function(c){return d.Fw[c]!==void 0?d.Fw[c]:-1},d.CQ=function(c){d.xp===!1&&d.yt();var o=d.nF(c);if(o==1e38){var l=d.Bx(c);if(l!=c&&(o=d.nF(l)),o==1e38)return 1e-10}return o},d.ZS=function(c){if(d.Is[c]!==void 0)return!0;var o=d.Bx(c);return o!=c&&d.Is[o]!==void 0},d.aT=function(c){if(d.xo[c]!==void 0)return!0;var o=d.Bx(c);return o!=c&&d.xo[o]!==void 0},d.nF=function(c){return d.xp===!1&&d.yt(),d.Is[c]!==void 0?d.Is[c]:d.xo[c]!==void 0?d.xo[c]:1e38},d.FK=function(c){return d.xp===!1&&d.yt(),d.WA[c]!==void 0?d.WA[c]:c},d.Bx=function(c){return d.xp===!1&&d.yt(),d.XA[c]!==void 0?d.XA[c]:c},d.yt=function(){for(var c,o=L,l=0;l<o.pcsid.length;l+=2)d.xo[o.pcsid[l]]=o.pcstol[2*o.pcsid[l+1]+1];for(l=0;l<o.pcsidc.length;l+=1)for(var h=(c=o.pcsidc[l])[0];h<=c[1];h++)d.xo[h]=o.pcstol[2*c[2]+1];for(l=0;l<o.gcsid.length;l+=2)d.Is[o.gcsid[l]]=o.gcstol[2*o.gcsid[l+1]+1];for(l=0;l<o.gcsidc.length;l+=1)for(h=(c=o.gcsidc[l])[0];h<=c[1];h++)d.xo[h]=o.gcstol[2*c[2]+1];for(l=0;l<x.c.length;l+=1)for(h=(c=x.c[l])[0];h<=c[1];h++)d.Fw[h]=c[2];for(l=0;l<x.nc.length;l+=2)d.Fw[x.nc[l]]=x.nc[l+1];for(x=null,l=0;l<o.newtoold.length;l+=2)d.WA[o.newtoold[l+1]]=o.newtoold[l],d.XA[o.newtoold[l]]=o.newtoold[l+1];L=null,d.xp=!0},d.xp=!1,d.Is=[],d.xo=[],d.WA=[],d.XA=[],d.Fw=[],d}()}(Q||(Q={})),function(f){function L(d){return d.length===0?'""':d[0]=='"'||d[0]=="."||"0"<=d[0]&&"9">=d[0]?d:'"'+d.trim()+'"'}var x=[];f.XC=function(){function d(){}return d.EQ=function(c){try{for(var o=0;o<x.length;o++)if(x[o].wkttext===c)return x[o].unit;for(var l,h=o="",m=!1,g=0;g<c.length;g++){var v=c[g];m===!0?v=='"'?c[g+1]=='"'?o+=v:m=m=!1:o+=v:/[\s]/.test(v)||(v==","?(h=o!==""?h+(L(o)+","):h+",",o=""):v==")"||v=="]"?(h=o!==""?h+(L(o)+"]}"):h+"]}",o=""):v=="("||v=="["?(h+='{ "entity": "'+o.toUpperCase().trim()+'", "values":[',o=""):v=='"'?(m=!0,o=""):o+=v)}l=JSON.parse(h);var w=d.mF(l);if(w===null)return null;for(l=null,v=0;v<w.values.length;v++)if(typeof w.values[v]=="object"&&(w.values[v].entity==="UNIT"||w.values[v].entity==="ANGLEUNIT"||w.values[v].entity==="LENGTHUNIT")){l=w.values[v];break}if(l===null)return null;var E=f.Tc.ZO(w.entity==="GEOGCS"||w.entity==="GEOGCRS"?1:0,l.values[1],l.values[2]);return x.push({wkttext:c,unit:E}),10<x.length&&x.shift(),E}catch{return null}},d.mF=function(c){if(c===null)return null;switch(c.entity){case"GEOGCRS":case"GEOGCS":case"PROJCRS":case"PROJCS":return c}for(var o=[],l=0;l<c.values.length;l++)if(typeof c.values[l]=="object"&&c.values[l].entity!==void 0)switch(c.values[l].entity){case"GEOGCRS":case"GEOGCS":case"PROJCRS":case"PROJCS":return c.values[l];default:o.push(c.values[l])}for(c=0;c<o.length;c++)if((l=d.mF(o[c]))!==null)return l;return null},d.DQ=function(c){var o=-1;if(c!=null&&0<c.length){var l=c.search(/PROJCR?S/);if(0<=l){var h=0;if(0<=(l=c.lastIndexOf("UNIT"))&&0<(l=c.indexOf(",",l+4))){l++;var m=c.indexOf("]",l+1);if(0<m)try{h=parseFloat(c.substring(l,m))}catch{h=0}}0<h&&(o=.001/h)}else if(0<=(l=c.search(/GEOGCR?S/))){var g=0;if(h=0,(l=c.indexOf("SPHEROID",l+6))===-1&&(l=c.indexOf("ELLIPSOID",l+7)),0<l&&0<(l=c.indexOf(",",l+8))){if(l++,0<(m=c.indexOf(",",l+1)))try{g=parseFloat(c.substring(l,m))}catch{g=0}if(0<g&&((l=c.lastIndexOf("ANGLEUNIT",m+1))===-1&&(l=c.lastIndexOf("UNIT",m+1)),0<=l&&0<(l=c.indexOf(",",l+4))&&(l++,0<(m=c.indexOf("]",l+1)))))try{h=parseFloat(c.substring(l,m))}catch{h=0}}0<g&&0<h&&(o=.001/(g*h))}}return o},d}()}(Q||(Q={})),function(f){var L;(L=f.eL||(f.eL={}))[L.NONE=0]="NONE",L[L.LINEAR=1]="LINEAR",L[L.ANGULAR=2]="ANGULAR",function(d){d[d.enumFloat=0]="enumFloat",d[d.enumDouble=1]="enumDouble",d[d.enumInt32=2]="enumInt32",d[d.enumInt64=3]="enumInt64",d[d.enumInt8=4]="enumInt8",d[d.enumInt16=5]="enumInt16"}(f.QL||(f.QL={})),function(d){d[d.POSITION=0]="POSITION",d[d.Z=1]="Z",d[d.M=2]="M",d[d.ID=3]="ID",d[d.NORMAL=4]="NORMAL",d[d.TEXTURE1D=5]="TEXTURE1D",d[d.TEXTURE2D=6]="TEXTURE2D",d[d.TEXTURE3D=7]="TEXTURE3D",d[d.ID2=8]="ID2",d[d.MAXSEMANTICS=10]="MAXSEMANTICS"}(f.Ih||(f.Ih={}));var x=function(){function d(c,o){if(this.Vs=this.Ae=null,this.Oq=this.Aa=0,this.uh=this.bg=null,this.wl=0,o!==void 0){for(this.Aa=o.Aa,this.Oq=o.Oq,this.bg=o.bg.slice(0),this.uh=o.uh.slice(0),this.wl=o.wl,this.Vs=[],c=o=0;c<this.Aa;c++)this.Vs[c]=o,o+=d.Va(this.bg[c]);for(this.Oq=o,this.Ae=[],c=0;c<this.Aa;c++){o=d.Va(this.kd(c));for(var l=d.se(this.kd(c)),h=0;h<o;h++)this.Ae[this.Vs[c]+h]=l}}else this.Oq=this.Aa=0}return d.prototype.kd=function(c){if(0>c||c>this.Aa)throw f.i.N();return this.bg[c]},d.prototype.Pf=function(c){return this.uh[c]},d.lz=function(c){return d.JM[c]},d.Tp=function(c){return d.SM[c]},d.Va=function(c){return d.rM[c]},d.prototype.hasAttribute=function(c){return 0<=this.uh[c]},d.prototype.iG=function(){return this.hasAttribute(1)},d.se=function(c){return d.eD[c]},d.prototype.LR=function(c){return this.Vs[c]},d.DG=function(c,o){return d.eD[c]===o},d.prototype.Nb=function(c){return this===c},d.prototype.An=function(){for(var c=f.O.Th(this.bg[0]),o=1;o<this.Aa;o++)c=f.O.Th(this.bg[o],c);return c},d.prototype.$j=function(c){return this.Vs[c]},d.prototype.cc=function(){return this.wl},d.prototype.Ed=function(c){return this.bg[c]},d.eD=[0,0,NaN,0,0,0,0,0,0],d.JM=[1,1,1,0,2,1,1,1,0],d.SM=[1,1,1,2,0,0,0,0,2],d.rM=[2,1,1,1,3,1,2,3,2],d}();f.ra=x}(Q||(Q={})),function(f){function L(m,g,v){var w=g-(m=new h(m)).e,E=m.c;for(E.length>++g&&x(m,w,h.eu),E[0]?v?w=g:(E=m.c,w=m.e+w+1):++w;E.length<w;E.push(0));return w=m.e,v===1||v&&(g<=w||w<=c)?(0>m.Bd&&E[0]?"-":"")+(1<E.length?E[0]+"."+E.join("").slice(1):E[0])+(0>w?"e":"e+")+w:m.toString()}function x(m,g,v,w){var E=m.c,A=m.e+g+1;if(v===1?w=5<=E[A]:v===2?w=5<E[A]||E[A]==5&&(w||0>A||E[A+1]!==void 0||1&E[A-1]):v===3?w=w||E[A]!==void 0||0>A:(w=!1,v!==0&&d("!Big.RM!")),1>A||!E[0])w?(m.e=-g,m.c=[1]):m.c=[m.e=0];else{if(E.length=A--,w)for(;9<++E[A];)E[A]=0,A--||(++m.e,E.unshift(1));for(A=E.length;!E[--A];E.pop());}return m}function d(m){throw(m=Error(m)).name="BigError",m}var c=-7,o=21,l=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,h=function(){function m(g){if(g instanceof m)this.Bd=g.Bd,this.e=g.e,this.c=g.c.slice();else{var v,w,E;for(g===0&&0>1/g?g="-0":l.test(g+="")||d(NaN),this.Bd=g.charAt(0)=="-"?(g=g.slice(1),-1):1,-1<(v=g.indexOf("."))&&(g=g.replace(".","")),0<(w=g.search(/e/i))?(0>v&&(v=w),v+=+g.slice(w+1),g=g.substring(0,w)):0>v&&(v=g.length),w=0;g.charAt(w)=="0";w++);if(w==(E=g.length))this.c=[this.e=0];else{for(;g.charAt(--E)=="0";);for(this.e=v-w-1,this.c=[],v=0;w<=E;this.c[v++]=+g.charAt(w++));}}}return m.prototype.abs=function(){var g=new m(this);return g.Bd=1,g},m.prototype.cmp=function(g){var v=this.c,w=(g=new m(g)).c,E=this.Bd,A=g.Bd,M=this.e,I=g.e;if(!v[0]||!w[0])return v[0]?E:w[0]?-A:0;if(E!=A)return E;if(g=0>E,M!=I)return M>(I^g)?1:-1;for(E=-1,A=(M=v.length)<(I=w.length)?M:I;++E<A;)if(v[E]!=w[E])return v[E]>(w[E]^g)?1:-1;return M==I?0:M>(I^g)?1:-1},m.prototype.jm=function(g){var v=this.c,w=(g=new m(g)).c,E=this.Bd==g.Bd?1:-1,A=m.rr;if((A!==~~A||0>A||1e6<A)&&d("!Big.DP!"),!v[0]||!w[0])return v[0]==w[0]&&d(NaN),w[0]||d(E/0),new m(0*E);var M,I,D=w.slice(),k=M=w.length,B=v.length,J=v.slice(0,M),Y=J.length,V=g,te=V.c=[],he=0,ue=A+(V.e=this.e-g.e)+1;for(V.Bd=E,E=0>ue?0:ue,D.unshift(0);Y++<M;J.push(0));do{for(I=0;10>I;I++){if(M!=(Y=J.length))var xe=M>Y?1:-1;else{var be=-1;for(xe=0;++be<M;)if(w[be]!=J[be]){xe=w[be]>J[be]?1:-1;break}}if(!(0>xe))break;for(g=Y==M?w:D;Y;){if(J[--Y]<g[Y]){for(be=Y;be&&!J[--be];J[be]=9);--J[be],J[Y]+=10}J[Y]-=g[Y]}for(;!J[0];J.shift());}te[he++]=xe?I:++I,J[0]&&xe?J[Y]=v[k]||0:J=[v[k]]}while((k++<B||J[0]!==void 0)&&E--);return te[0]||he==1||(te.shift(),V.e--),he>ue&&x(V,A,m.eu,J[0]!==void 0),V},m.prototype.fS=function(){return 0<this.cmp(0)},m.prototype.nT=function(){return 0>this.cmp(0)},m.prototype.jt=function(g){var v,w=this.Bd,E=(g=new m(g)).Bd;if(w!=E)return g.Bd=-E,this.tI(g);var A=this.c.slice(),M=this.e,I=g.c,D=g.e;if(!A[0]||!I[0])return I[0]?(g.Bd=-E,g):new m(A[0]?this:0);if(w=M-D){for((v=0>w)?(w=-w,M=A):(D=M,M=I),M.reverse(),E=w;E--;M.push(0));M.reverse()}else for(M=((v=A.length<I.length)?A:I).length,w=E=0;E<M;E++)if(A[E]!=I[E]){v=A[E]<I[E];break}if(v&&(M=A,A=I,I=M,g.Bd=-g.Bd),0<(E=(M=I.length)-(v=A.length)))for(;E--;A[v++]=0);for(E=v;M>w;){if(A[--M]<I[M]){for(v=M;v&&!A[--v];A[v]=9);--A[v],A[M]+=10}A[M]-=I[M]}for(;A[--E]==0;A.pop());for(;A[0]==0;)A.shift(),--D;return A[0]||(g.Bd=1,A=[D=0]),g.c=A,g.e=D,g},m.prototype.tI=function(g){var v=this.Bd,w=(g=new m(g)).Bd;if(v!=w)return g.Bd=-w,this.jt(g);w=this.e;var E=this.c,A=g.e,M=g.c;if(!E[0]||!M[0])return M[0]?g:new m(E[0]?this:0*v);if(E=E.slice(),v=w-A){for(0<v?(A=w,w=M):(v=-v,w=E),w.reverse();v--;w.push(0));w.reverse()}for(0>E.length-M.length&&(w=M,M=E,E=w),v=M.length,w=0;v;)w=(E[--v]=E[v]+M[v]+w)/10|0,E[v]%=10;for(w&&(E.unshift(w),++A),v=E.length;E[--v]==0;E.pop());return g.c=E,g.e=A,g},m.prototype.pow=function(g){var v=this,w=new m(1),E=w,A=0>g;for((g!==~~g||-1e6>g||1e6<g)&&d("!pow!"),g=A?-g:g;1&g&&(E=E.lr(v)),g>>=1;)v=v.lr(v);return A?w.jm(E):E},m.prototype.round=function(g,v){var w=this;return g==null?g=0:(g!==~~g||0>g||1e6<g)&&d("!round!"),x(w=new m(w),g,v??m.eu),w},m.prototype.sqrt=function(){var g=this.c,v=this.Bd,w=this.e,E=new m("0.5");if(!g[0])return new m(this);0>v&&d(NaN),(v=Math.sqrt(this.toString()))==0||v==1/0?((v=g.join("")).length+w&1||(v+="0"),(g=new m(Math.sqrt(v).toString())).e=((w+1)/2|0)-(0>w||1&w)):g=new m(v.toString()),v=g.e+(m.rr+=4);do w=g,g=E.lr(w.tI(this.jm(w)));while(w.c.slice(0,v).join("")!==g.c.slice(0,v).join(""));return x(g,m.rr-=4,m.eu),g},m.prototype.lr=function(g){var v=this.c,w=(g=new m(g)).c,E=v.length,A=w.length,M=this.e,I=g.e;if(g.Bd=this.Bd==g.Bd?1:-1,!v[0]||!w[0])return new m(0*g.Bd);if(g.e=M+I,E<A){var D=v;v=w,w=D,I=E,E=A,A=I}for(D=Array(I=E+A);I--;D[I]=0);for(M=A;M--;){for(A=0,I=E+M;I>M;)A=D[I]+w[M]*v[I-M-1]+A,D[I--]=A%10,A=A/10|0;D[I]=(D[I]+A)%10}for(A&&++g.e,D[0]||D.shift(),M=D.length;!D[--M];D.pop());return g.c=D,g},m.prototype.toString=function(){var g=this.e,v=this.c.join(""),w=v.length;if(g<=c||g>=o)v=v.charAt(0)+(1<w?"."+v.slice(1):"")+(0>g?"e":"e+")+g;else if(0>g){for(;++g;v="0"+v);v="0."+v}else if(0<g)if(++g>w)for(g-=w;g--;v+="0");else g<w&&(v=v.slice(0,g)+"."+v.slice(g));else 1<w&&(v=v.charAt(0)+"."+v.slice(1));return 0>this.Bd&&this.c[0]?"-"+v:v},m.prototype.toExponential=function(g){return g==null?g=this.c.length-1:(g!==~~g||0>g||1e6<g)&&d("!toExp!"),L(this,g,1)},m.prototype.toFixed=function(g){var v=c,w=o;if(c=-(o=1/0),g==null)var E=this.toString();else g===~~g&&0<=g&&1e6>=g&&(E=L(this,this.e+g),0>this.Bd&&this.c[0]&&0>E.indexOf("-")&&(E="-"+E));return c=v,o=w,E||d("!toFix!"),E},m.prototype.toPrecision=function(g){return g==null?this.toString():((g!==~~g||1>g||1e6<g)&&d("!toPre!"),L(this,g-1,2))},m.rr=20,m.eu=1,m}();f.hp=h}(Q||(Q={})),function(f){var L=function(){function x(d){this.lf=d}return x.prototype.nr=function(d,c,o){var l=new f.h,h=new f.h,m=this.lf;o.Vd(d,c,function(g,v){return m.tc(2*g,l),m.tc(2*v,h),l.compare(h)})},x.prototype.$p=function(d){return this.lf.read(2*d+1)},x}();f.pi=function(){function x(){}return x.aq=function(d){if(d.B())return!1;var c=d.getType();return c==1736?d.Ke()!=0:c==1607?(c=[!1],x.sE(d,!0,c),c[0]):!(c!=197&&(!f.aa.yd(c)||d.BG()))},x.gm=function(d){var c=d.getType();if(c==1736)return c=new f.Ta(d.description),d.B()||d.dD(c),c;if(c==1607)return x.sE(d,!1,null);if(c==197)return c=new f.Ta(d.description),d.B()||c.ad(d,!1),c;if(f.aa.yd(c)){if(c=new f.de(d.description),!d.B()&&!d.BG()){var o=new f.Sa;d.To(o),c.add(o),d.Po(o),c.add(o)}return c}if(f.aa.Rn(c))return null;throw f.i.N()},x.sE=function(d,c,o){o!=null&&(o[0]=!1);var l=null;if(c||(l=new f.de(d.description)),!d.B()){var h=new f.ia(0);h.Jb(2*d.da());for(var m=0,g=d.da();m<g;m++)if(0<d.Ja(m)&&!d.Nn(m)){var v=d.Ba(m);h.add(v),v=d.Vc(m)-1,h.add(v)}if(0<h.size){g=new f.Xt,m=d.ub(0),g.sort(h,0,h.size,new L(m)),g=new f.h,m.tc(2*h.get(0),g),v=0;for(var w=1,E=new f.Sa,A=new f.h,M=1,I=h.size;M<I;M++)if(m.tc(2*h.get(M),A),A.qb(g))h.get(v)>h.get(M)?(h.set(v,2147483647),v=M):h.set(M,2147483647),w++;else{if(!(1&w))h.set(v,2147483647);else if(c)return o!=null&&(o[0]=!0),null;g.L(A),v=M,w=1}if(!(1&w))h.set(v,2147483647);else if(c)return o!=null&&(o[0]=!0),null;if(!c)for(h.Vd(0,h.size,function(D,k){return D-k}),M=0,I=h.size;M<I&&h.get(M)!=2147483647;M++)d.ve(h.get(M),E),l.add(E)}}return c?null:l},x}()}(Q||(Q={})),function(f){var L=function(){function x(){this.yf=new f.ia(0),this.ys=new f.ia(0),this.EH=1,this.Es=NaN}return x.prototype.sort=function(d,c,o,l){if(32>o-c)l.nr(c,o,d);else{var h=!0;try{for(var m=1/0,g=-1/0,v=c;v<o;v++){var w=l.$p(d.get(v));w<m&&(m=w),w>g&&(g=w)}if(this.reset(o-c,m,g,o-c)){for(v=c;v<o;v++){var E=d.get(v);w=l.$p(E);var A=this.zF(w);this.yf.set(A,this.yf.get(A)+1),this.ys.write(v-c,E)}var M=this.yf.get(0);this.yf.set(0,0),v=1;for(var I=this.yf.size;v<I;v++){var D=this.yf.get(v);this.yf.set(v,M),M+=D}for(v=c;v<o;v++){E=this.ys.read(v-c),w=l.$p(E),A=this.zF(w);var k=this.yf.get(A);d.set(k+c,E),this.yf.set(A,k+1)}h=!1}}catch{this.yf.resize(0),this.ys.resize(0)}if(h)l.nr(c,o,d);else{for(v=o=0,I=this.yf.size;v<I;v++)h=o,(o=this.yf.get(v))>h&&l.nr(c+h,c+o,d);100<this.yf.size&&(this.yf.resize(0),this.ys.resize(0))}}},x.prototype.reset=function(d,c,o,l){return!(2>d||o==c)&&(d=Math.min(x.hL,d),this.yf.Jb(d),this.yf.resize(d),this.yf.Wj(0,0,this.yf.size),this.EH=c,this.ys.resize(l),this.Es=(o-c)/(d-1),!0)},x.prototype.zF=function(d){return f.O.truncate((d-this.EH)/this.Es)},x.hL=65536,x}();f.Xt=L}(Q||(Q={})),function(f){var L,x;(x=L||(L={}))[x.enum_line=1]="enum_line",x[x.enum_arc=2]="enum_arc",x[x.enum_dummy=4]="enum_dummy",x[x.enum_concave_dip=8]="enum_concave_dip",x[x.enum_connection=3]="enum_connection";var d=function(){function m(){}return m.Qu=function(g,v,w,E,A,M){var I=new m;return I.Im=new f.h,I.Vm=new f.h,I.aw=new f.h,I.Im.L(g),I.Vm.L(v),I.aw.L(w),I.Co=E,I.qh=A,I.sh=M,I},m.construct=function(g,v,w,E){var A=new m;return A.Im=new f.h,A.Vm=new f.h,A.aw=new f.h,A.Im.L(g),A.Vm.L(v),A.aw.Rc(),A.Co=4,A.qh=w,A.sh=E,A},m}(),c=function(){function m(g,v,w,E,A,M){this.Yv=null,this.ya=0,this.EA=g,this.bI=this.$H=0,this.Ka=v,this.Mj=w,this.vk=E,this.Dq=A,this.Ub=M}return m.prototype.next=function(){for(var g=new f.Sa;;){if(this.ya==this.EA.I())return null;if(this.EA.ve(this.ya,g),this.ya++,!g.B())break}var v=!1;if(this.Yv==null&&(this.$H=g.Lg(),this.bI=g.ih(),this.Yv=h.buffer(g,this.Ka,this.Mj,this.vk,this.Dq,this.Ub),v=!0),this.ya<this.EA.I()){var w=new f.Da;this.Yv.copyTo(w)}else w=this.Yv;if(!v){v=new f.Dd;var E=g.Lg()-this.$H;g=g.ih()-this.bI,v.gg(E,g),w.Oc(v)}return w},m.prototype.La=function(){return 0},m.prototype.qe=function(){},m}(),o=function(){function m(g,v){this.Wa=g,this.ya=0,this.oq=v}return m.prototype.next=function(){var g=this.Wa.X;if(this.ya<g.da()){var v=this.ya;if(this.ya++,!g.Nn(v))for(var w=g.Na(g.Vc(v)-1);this.ya<g.da();){var E=g.Na(g.Ba(this.ya));if(g.Nn(this.ya)||E!=w)break;w=g.Na(g.Vc(this.ya)-1),this.ya++}if(this.ya-v==1)return this.Wa.kE(this.Wa.X,v,this.oq);for((w=new f.Ta(this.Wa.X.description)).addPath(this.Wa.X,v,!0),v+=1;v<this.ya;v++)w.Dr(this.Wa.X,v,0,g.rv(v),!1);return this.Wa.kE(w,0,this.oq)}return null},m.prototype.La=function(){return 0},m.prototype.qe=function(){},m}(),l=function(){function m(g){this.Wa=g,this.ya=0}return m.prototype.next=function(){var g=this.Wa.X;if(this.ya<g.da()){var v=this.ya;for(g.Ir(this.ya),this.ya++;this.ya<g.da()&&!(0<g.Ir(this.ya));)this.ya++;return v==0&&this.ya==g.da()?this.Wa.py(g,0,g.da()):this.Wa.py(g,v,this.ya)}return null},m.prototype.La=function(){return 0},m.prototype.qe=function(){},m}(),h=function(){function m(g){this.Ks=this.lw=this.Ls=this.Id=null,this.Zd=[],this.Ub=g,this.rb=this.Kv=this.JT=this.Ka=this.tA=this.ct=this.qa=0,this.oA=this.vk=-1,this.oq=!0}return m.buffer=function(g,v,w,E,A,M){if(g==null||0>E)throw f.i.N();if(g.B())return new f.Da(g.description);var I=new f.l;return g.xc(I),0<v&&I.W(v,v),(M=new m(M)).Mj=w,M.X=g,M.qa=f.ta.Wd(w,I,!0),M.ct=f.ta.Wd(null,I,!0),M.Ka=v,M.JT=g.getType(),0>=A&&(A=96),M.rb=Math.abs(M.Ka),M.Kv=M.rb!=0?1/M.rb:0,isNaN(E)||E==0?E=1e-5*M.rb:E>.5*M.rb&&(E=.5*M.rb),12>A&&(A=12),(g=Math.abs(v)*(1-Math.cos(Math.PI/A)))>E?E=g:(g=Math.PI/Math.acos(1-E/Math.abs(v)))<A-1&&12>(A=f.O.truncate(g))&&(A=12,E=Math.abs(v)*(1-Math.cos(Math.PI/A))),M.vk=E,M.Dq=A,M.tA=Math.min(M.ct,.25*E),M.lE()},m.prototype.cv=function(){if(this.Id==null)this.Id=[];else if(this.Id.length!==0)return;var g=this.qE();g=f.O.truncate((g+3)/4);var v=.5*Math.PI/g;this.oA=v;for(var w=0;w<4*g;w++)this.Id.push(null);var E=Math.cos(v);v=Math.sin(v);var A=f.h.construct(0,1);for(w=0;w<g;w++)this.Id[w+0*g]=f.h.construct(A.y,-A.x),this.Id[w+1*g]=f.h.construct(-A.x,-A.y),this.Id[w+2*g]=f.h.construct(-A.y,A.x),this.Id[w+3*g]=A,(A=f.h.construct(A.x,A.y)).Bt(E,v)},m.prototype.lE=function(){var g=this.X.getType();if(f.aa.yd(g))return(g=new f.Ta(this.X.description)).oc(this.X,!0),this.X=g,this.lE();if(this.Ka<=this.qa){if(!f.aa.US(g))return new f.Da(this.X.description);if(0>=this.Ka&&(g=new f.l,this.X.A(g),g.R()<=2*-this.Ka||g.ca()<=2*this.Ka))return new f.Da(this.X.description)}switch(this.X.getType()){case 33:return this.PN();case 550:return this.ON();case 1607:return this.RN();case 1736:return this.QN();case 197:return this.LN();default:throw f.i.Qa()}},m.prototype.RN=function(){if(this.EG(this.X)){var g=new f.Sa;this.X.ve(0,g);var v=new f.l;return this.X.A(v),g.Cb(v.sf()),this.Gu(g)}return this.X=this.WV(this.X),g=new o(this,this.oq),f.Gh.local().V(g,this.Mj,this.Ub).next()},m.prototype.QN=function(){if(this.Ka==0)return this.X;var g=f.Yl.local();if(this.cv(),this.X=g.V(this.X,null,!1,this.Ub),0>this.Ka){var v=this.X;return v=this.py(v,0,v.da()),g.V(v,this.Mj,!1,this.Ub)}return this.EG(this.X)?(g=new f.Sa,this.X.ve(0,g),v=new f.l,this.X.A(v),g.Cb(v.sf()),this.Gu(g)):(g=new l(this),f.Gh.local().V(g,this.Mj,this.Ub).next())},m.prototype.py=function(g,v,w){for(var E=new f.Da(g.description);v<w;v++)if(!(1>g.Ja(v))){var A=g.Ir(v),M=new f.l;if(g.Rj(v,M),0<this.Ka){if(0<A)if(this.FG(g,v))A=new f.Sa,g.ve(g.Ba(v),A),A.Cb(M.sf()),this.yu(E,A);else{var I=A=new f.Ta(g.description);I=f.Zt.JG(this.X,v)||this.zn(this.X,v,I,!0,1)==2?this.jE(g,v):this.yn(A),E.add(I,!1)}else if(!(M.R()+this.qa<=2*this.rb||M.ca()+this.qa<=2*this.rb||(I=A=new f.Ta(g.description),this.zn(this.X,v,I,!0,1),A.B()))){var D=new f.l;for(D.K(M),D.W(this.rb,this.rb),I.tp(D),M=1,A=(I=this.yn(A)).da();M<A;M++)E.addPath(I,M,!0)}}else if(0<A){if(!(M.R()+this.qa<=2*this.rb||M.ca()+this.qa<=2*this.rb||(I=A=new f.Ta(g.description),this.zn(this.X,v,I,!0,-1),A.B())))for(D=new f.l,I.xc(D),D.W(this.rb,this.rb),I.tp(D),M=1,A=(I=this.yn(A)).da();M<A;M++)E.addPath(I,M,!0)}else for(I=A=new f.Ta(g.description),this.zn(this.X,v,I,!0,-1),M=0,A=(I=this.yn(A)).da();M<A;M++)E.addPath(I,M,!0)}if(0<this.Ka)return 1<E.da()?E=this.yn(E):m.kx(E);if(g=new f.l,E.xc(g),E.B())return m.kx(E);for(g.W(this.rb,this.rb),E.tp(g),E=this.yn(E),g=new f.Da(E.description),M=1,A=E.da();M<A;M++)g.addPath(E,M,!1);return m.kx(g)},m.prototype.PN=function(){return this.Gu(this.X)},m.prototype.Gu=function(g){var v=new f.Da(this.X.description);return this.yu(v,g),this.sX(v)},m.prototype.ON=function(){var g=new c(this.X,this.Ka,this.Mj,this.vk,this.Dq,this.Ub);return f.Gh.local().V(g,this.Mj,this.Ub).next()},m.prototype.LN=function(){var g=new f.Da(this.X.description);if(0>=this.Ka){if(this.Ka==0)g.ad(this.X,!1);else{var v=new f.Fh;this.X.bn(v),v.W(this.Ka,this.Ka),g.ad(v,!1)}return g}return g.ad(this.X,!1),this.X=g,this.jE(g,0)},m.prototype.jE=function(g,v){this.cv();var w=new f.Da(g.description),E=new f.h,A=new f.h,M=new f.h,I=new f.h,D=new f.h,k=new f.h,B=new f.h,J=new f.h,Y=g.Ja(v),V=g.Ba(v),te=0;for(v=g.Ja(v);te<v;te++){if(g.D(V+te,A),g.D(V+(te+1)%Y,I),g.D(V+(te+2)%Y,k),B.uc(I,A),B.length()==0||(B.Hv(),B.normalize(),B.scale(this.rb),E.add(B,A),M.add(B,I),te==0?w.Lt(E):w.Ci(E),w.Ci(M),J.uc(k,I),J.length()==0))throw f.i.Qa();J.Hv(),J.normalize(),J.scale(this.rb),D.add(J,I),this.GD(w,I,M,D,!1)}return m.kx(w)},m.prototype.kE=function(g,v,w){if(this.cv(),1>g.Ja(v))return null;if(this.FG(g,v)&&0<this.Ka){w=new f.Sa,g.ve(g.Ba(v),w);var E=new f.l;return g.Rj(v,E),w.Cb(E.sf()),this.Gu(w)}if(E=new f.Ta(g.description),g.Nn(v))this.zn(g,v,E,w,1),this.zn(g,v,E,w,-1);else{var A=new f.Ta(g.description);A.addPath(g,v,!1),A.Dr(g,v,0,g.rv(v),!1),this.zn(A,0,E,w,1)}return this.yn(E)},m.prototype.Xq=function(){if(this.Ys++,this.Ys%1024==0&&this.Ub!=null&&!this.Ub.progress(-1,-1))throw f.i.fu("user_canceled")},m.prototype.yn=function(g){return f.Fg.Mk(g,this.ct,!0,!0,this.Ub)},m.prototype.qE=function(){if(this.vk==0)return this.Dq;var g=1-this.vk*Math.abs(this.Kv);return 4>(g=-1>g?4:2*Math.PI/Math.acos(g)+.5)?g=4:g>this.Dq&&(g=this.Dq),f.O.truncate(g)},m.prototype.GD=function(g,v,w,E,A){this.cv();var M=new f.h;M.uc(w,v),M.scale(this.Kv);var I=new f.h;I.uc(E,v),I.scale(this.Kv),0>(M=Math.atan2(M.y,M.x)/this.oA)&&(M=this.Id.length+M),M=this.Id.length-M,0>(I=Math.atan2(I.y,I.x)/this.oA)&&(I=this.Id.length+I),(I=this.Id.length-I)<M&&(I+=this.Id.length);var D=f.O.truncate(I);I=f.O.truncate(Math.ceil(M)),(M=new f.h).L(this.Id[I%this.Id.length]),M.Ct(this.rb,v);var k=10*this.qa;for(M.sub(w),M.length()<k&&(I+=1),M.L(this.Id[D%this.Id.length]),M.Ct(this.rb,v),M.sub(E),M.length()<k&&--D,w=D-I,w++,D=0,I%=this.Id.length;D<w;D++,I=(I+1)%this.Id.length)M.L(this.Id[I]),M.Ct(this.rb,v),g.Ci(M),this.Xq();A&&g.Ci(E)},m.prototype.zn=function(g,v,w,E,A){var M=new f.gd,I=M.mN(g,v);if(M.Gp(this.tA,!1,!1),2>M.I(I))return 0>A||(A=g,M=new f.Sa,A.ve(A.Ba(v),M),this.yu(w,M)),1;var D=M.Na(M.Xa(M.Ob(I))),k=new f.Dd;if(k.gg(-D.x,-D.y),M.Oc(k),E&&(this.tQ(M,I,A),2>M.I(I)))return 0>A||(A=g,M=new f.Sa,A.ve(A.Ba(v),M),this.yu(w,M)),1;this.Zd.length=0;var B=M.Ob(I);v=M.Xa(B);var J=A==1?M.Ma(v):M.U(v);g=A==1?M.U(v):M.Ma(v);var Y=!0;E=new f.h,I=new f.h;var V=new f.h,te=new f.h,he=new f.h,ue=new f.h,xe=new f.h,be=new f.h,Le=new f.h,Xe=new f.h,qe=this.rb;B=M.Ja(B);for(var xt=0;xt<B;xt++)M.D(g,I),Y&&(M.D(v,E),M.D(J,V),be.uc(E,V),be.normalize(),Xe.MG(be),Xe.scale(qe),te.add(Xe,E)),xe.uc(I,E),xe.normalize(),Le.MG(xe),Le.scale(qe),he.add(E,Le),J=be.wi(xe),Y=be.Qh(xe),0>J||0>Y&&J==0?this.Zd.push(d.Qu(te,he,E,2,this.Zd.length+1,this.Zd.length-1)):te.qb(he)||(this.Zd.push(d.construct(te,E,this.Zd.length+1,this.Zd.length-1,"dummy")),this.Zd.push(d.construct(E,he,this.Zd.length+1,this.Zd.length-1,"dummy"))),ue.add(I,Le),this.Zd.push(d.Qu(he,ue,E,1,this.Zd.length+1,this.Zd.length-1)),te.L(ue),Xe.L(Le),V.L(E),E.L(I),be.L(xe),J=v,v=g,Y=!1,g=A==1?M.U(v):M.Ma(v);return this.Zd[this.Zd.length-1].qh=0,this.Zd[0].sh=this.Zd.length-1,this.YV(w),k.gg(D.x,D.y),w.YD(k,w.da()-1),1},m.prototype.YV=function(g){for(var v=this.zO(),w=!0,E=v+1,A=v;E!=v;A=E){var M=this.Zd[A];E=M.qh!=-1?M.qh:(A+1)%this.Zd.length,M.Co!=0&&(w&&g.Lt(M.Im),M.Co==2?this.GD(g,M.aw,M.Im,M.Vm,!0):g.Ci(M.Vm),w=!1)}},m.prototype.zO=function(){this.Ks==null&&(this.Ks=[null,null,null,null,null,null,null,null,null]);for(var g=0,v=0,w=this.Zd.length;v<w;){var E=this.Zd[v];if(3&E.Co){g=v;break}v=E.qh}for(w=g+1,v=g;w!=g;v=w){w=(E=this.Zd[v]).qh;for(var A=1,M=null;w!=v&&!(3&(M=this.Zd[w]).Co);)w=M.qh,A++;A!=1&&(E.Co&M.Co)==1&&(this.Ls==null&&(this.Ls=new f.yb,this.lw=new f.yb),this.Ls.Dc(E.Im),this.Ls.Qc(E.Vm),this.lw.Dc(M.Im),this.lw.Qc(M.Vm),this.Ls.Ea(this.lw,this.Ks,null,null,this.ct)==1&&(E.Vm.L(this.Ks[0]),M.Im.L(this.Ks[0]),E.qh=w,M.sh=v))}return g},m.prototype.Fv=function(g,v,w){var E=new f.h;if(E.uc(w,g),w=E.length(),0<(w=this.rb*this.rb-w*w*.25)){w=Math.sqrt(w),E.normalize(),E.ar();var A=new f.h;if(A.uc(v,g),A.Qh(E)+w>=this.rb)return!0}return!1},m.prototype.tQ=function(g,v,w){for(var E=0;1>E;E++){var A=!1,M=g.Ob(v),I=g.Ja(M);if(I==0)break;var D=I;if(3>I)break;!g.dc(M)&&(D=I-1),M=g.Xa(M),I=0<w?g.Ma(M):g.U(M);for(var k=0<w?g.U(M):g.Ma(M),B=I,J=!0,Y=new f.h,V=new f.h,te=new f.h,he=new f.h,ue=new f.h,xe=f.h.construct(0,0),be=new f.h,Le=new f.h,Xe=new f.h,qe=new f.h,xt=this.rb,it=0,hi=0;hi<D&&(g.D(k,V),J&&(g.D(M,Y),g.D(I,te),B=I),Le.uc(Y,te),Le.normalize(),be.uc(V,Y),be.normalize(),B!=k);){var ai=Le.wi(be),yt=Le.Qh(be),Or=!0;if(0>ai||0>yt&&ai==0||!this.Fv(te,Y,V)||(xe.L(V),Or=!1,++it,A=!0),Or){if(0<it)for(;(ai=0<w?g.Ma(B):g.U(B))!=M;){if(g.D(ai,he),!this.Fv(he,te,xe)){ai!=k&&this.Fv(he,te,V)&&this.Fv(he,Y,V)&&(te.L(he),B=ai,Or=!1,++it);break}te.L(he),B=ai,Or=!1,++it}if(!Or)continue;if(0<it){for(B=0<w?g.Ma(I):g.U(I),J=1;J<it;J++)Or=0<w?g.Ma(B):g.U(B),g.pd(B,!0),B=Or;Xe.uc(Y,te),it=xt*xt-(it=Xe.length())*it*.25,xt-(it=Math.sqrt(it))>.5*this.vk?(ue.add(te,Y),ue.scale(.5),Xe.normalize(),Xe.ar(),qe.L(Xe),qe.scale(xt-it),ue.add(qe),g.mf(I,ue)):g.pd(I,!0),it=0}te.L(Y),B=M}Y.L(V),I=M,M=k,k=0<w?g.U(M):g.Ma(M),hi++,J=!1}if(0<it){for(B=0<w?g.Ma(I):g.U(I),J=1;J<it;J++)Or=0<w?g.Ma(B):g.U(B),g.pd(B,!0),B=Or;ue.add(te,Y),ue.scale(.5),Xe.uc(Y,te),it=xt*xt-(it=Xe.length())*it*.25,it=Math.sqrt(it),Xe.normalize(),Xe.ar(),qe.L(Xe),qe.scale(xt-it),ue.add(qe),g.mf(I,ue)}if(g.Gp(this.tA,!1,!1),!A)break}},m.prototype.FG=function(g,v){if(g.Ja(v)==1)return!0;var w=new f.l;return g.Rj(v,w),Math.max(w.R(),w.ca())<.5*this.vk},m.prototype.EG=function(g){var v=new f.l;return g.A(v),Math.max(v.R(),v.ca())<.5*this.vk},m.prototype.WV=function(g){for(var v=0,w=0,E=(g=f.EC.local().V(g,.25*this.vk,!1,this.Ub)).da();w<E;w++)v=Math.max(g.Ja(w),v);return 32>v?(this.oq=!1,g):(this.oq=!0,f.Fg.Mk(g,this.ct,!1,!0,this.Ub))},m.prototype.yu=function(g,v){if(v=v.D(),this.Id!=null&&this.Id.length!==0){var w=new f.h;w.L(this.Id[0]),w.Ct(this.rb,v),g.Lt(w);for(var E=1,A=this.Id.length;E<A;E++)w.L(this.Id[E]),w.Ct(this.rb,v),g.Ci(w)}else{E=this.qE(),w=f.O.truncate((E+3)/4),E=.5*Math.PI/w,A=Math.cos(E);for(var M=Math.sin(E),I=new f.h,D=3;0<=D;D--){switch(I.ma(0,this.rb),D){case 0:for(E=0;E<w;E++)g.yj(I.x+v.x,I.y+v.y),I.Bt(A,M);break;case 1:for(E=0;E<w;E++)g.yj(-I.y+v.x,I.x+v.y),I.Bt(A,M);break;case 2:for(E=0;E<w;E++)g.yj(-I.x+v.x,-I.y+v.y),I.Bt(A,M);break;default:for(g.sx(I.y+v.x,-I.x+v.y),E=1;E<w;E++)I.Bt(A,M),g.yj(I.y+v.x,-I.x+v.y)}this.Xq()}}},m.kx=function(g){return g.Ch(1,0),g},m.prototype.sX=function(g){return g.Ch(2,this.qa),g.fm(),g},m}();f.HK=h}(Q||(Q={})),function(f){var L=function(){function x(d){this.Ca=d,this.g=new f.gd,this.dd=new f.ia(0)}return x.prototype.Lh=function(d,c,o){switch(c){case 0:if(d.v<o&&d.C<=o)break;return d.v>=o?1:-1;case 1:if(d.G<o&&d.H<=o)break;return d.G>=o?1:-1;case 2:if(d.v>=o&&d.C>o)break;return d.C<=o?1:-1;case 3:if(!(d.G>=o&&d.H>o))return d.H<=o?1:-1}return 0},x.prototype.Ay=function(d,c){return d.getType()==1736?this.Cy(d,c):this.Dy(d)},x.prototype.Cy=function(d,c){if(this.Ca.R()==0||this.Ca.ca()==0)return d.Ia();var o=new f.l;d.xc(o),this.X=this.g.Ib(d);var l=new f.l,h=new f.l,m=new f.h,g=new f.h,v=[0,0,0,0,0,0,0,0,0],w=[0,0,0,0,0,0,0,0,0];new f.ig;var E=new f.yb,A=new f.ia(0);A.Jb(Math.min(100,d.I()));for(var M=!1,I=0;!M&&4>I;I++){var D=!1,k=(1&I)!=0,B=0;switch(I){case 0:B=this.Ca.v,D=o.v<=B&&o.C>=B;break;case 1:B=this.Ca.G,D=o.G<=B&&o.H>=B;break;case 2:B=this.Ca.C,D=o.v<=B&&o.C>=B;break;case 3:B=this.Ca.H,D=o.G<=B&&o.H>=B}if(D)for(M=!0,D=this.g.Ob(this.X);D!=-1;){var J=-1,Y=-1,V=this.g.Xa(D),te=V;do{var he=this.g.bc(te);he==null&&(he=E,this.g.D(te,m),he.Dc(m),this.g.D(this.g.U(te),g),he.Qc(g)),he.A(l);var ue=this.Lh(l,I,B),xe=0,be=-1;if(ue==-1){xe=0<(he=he.cq(k,B,v,w))?this.g.Ul(te,w,he):0,xe+=1;var Le=te,Xe=this.g.U(Le);for(he=0;he<xe;he++){if(this.g.D(Le,m),this.g.D(Xe,g),(be=this.g.bc(Le))==null&&((be=E).Dc(m),be.Qc(g)),be.A(h),(be=this.Lh(h,I,B))==-1){if(k)(be=Math.abs(m.y-B))<(qe=Math.abs(g.y-B))?(m.y=B,this.g.mf(Le,m)):(g.y=B,this.g.mf(Xe,g));else{be=Math.abs(m.x-B);var qe=Math.abs(g.x-B);be<qe?(m.x=B,this.g.mf(Le,m)):(g.x=B,this.g.mf(Xe,g))}(be=this.g.bc(Le))==null&&((be=E).Dc(m),be.Qc(g)),be.A(h),be=this.Lh(h,I,B)}qe=J,J=be,Y==-1&&(Y=J),qe==0&&J==1||qe==1&&J==0||qe!=0||J!=0||A.add(Le),J==1&&(M=!1),be=Le=Xe,Xe=this.g.U(Xe)}}xe==0&&(qe=J,J=ue,Y==-1&&(Y=J),qe==0&&J==1||qe==1&&J==0||qe!=0||J!=0||A.add(te),J==1&&(M=!1),be=this.g.U(te)),te=be}while(te!=V);for(Y==0&&J==0&&A.add(V),he=0,J=A.size;he<J;he++)Y=A.get(he),this.g.pd(Y,!1);A.clear(!1),D=3>this.g.Ja(D)?this.g.Zq(D):this.g.Rb(D)}}return M?d.Ia():(this.FB(),0<c&&this.My(c),this.g.Ne(this.X))},x.prototype.Dy=function(d){var c=new f.l,o=new f.l,l=[0,0,0,0,0,0,0,0,0],h=[0,0,0,0,0,0,0,0,0],m=new f.ig,g=d,v=new f.l;d.xc(v);for(var w=0;4>w;w++){var E=!1,A=(1&w)!=0,M=0;switch(w){case 0:M=this.Ca.v,E=v.v<=M&&v.C>=M;break;case 1:M=this.Ca.G,E=v.G<=M&&v.H>=M;break;case 2:M=this.Ca.C,E=v.v<=M&&v.C>=M;break;case 3:M=this.Ca.H,E=v.G<=M&&v.H>=M}if(E){E=g,g=d.Ia(),(E=E.Ga()).Zi();for(var I,D=new f.h;E.$a();)for(var k,B=!0;E.Ha();){var J=E.ha();J.A(c);var Y=this.Lh(c,w,M);if(Y==-1){if(0<(Y=J.cq(A,M,l,h))){var V=0;I=J.ac();for(var te=0;te<=Y;te++)if(V!=(k=te<Y?h[te]:1)){J.ah(V,k,m);var he=m.get();he.Dc(I),te<Y&&(A?(D.x=l[te],D.y=M):(D.x=M,D.y=l[te]),he.Qc(D)),he.A(o);var ue=this.Lh(o,w,M);if(ue==-1){if(I=he.ac(),V=he.wc(),A)(ue=Math.abs(I.y-M))<(xe=Math.abs(V.y-M))?(I.y=M,he.Dc(I)):(V.y=M,he.Qc(V));else{ue=Math.abs(I.x-M);var xe=Math.abs(V.x-M);ue<xe?(I.x=M,he.Dc(I)):(V.x=M,he.Qc(V))}he.A(o),ue=this.Lh(o,w,M)}I=he.wc(),V=k,(k=ue)==1?(g.oc(he,B),B=!1):B=!0}}}else(k=Y)==1?(g.oc(J,B),B=!1):B=!0}}}return g},x.prototype.FB=function(){this.ji=-1,this.Vl(!1,this.Ca.v),this.Vl(!1,this.Ca.C),this.Vl(!0,this.Ca.G),this.Vl(!0,this.Ca.H),this.dd.resize(0),this.dd.Jb(100),this.ji=this.g.Gd();for(var d=new f.h,c=this.g.Ob(this.X);c!=-1;c=this.g.Rb(c))for(var o=this.g.Xa(c),l=0,h=this.g.Ja(c);l<h;l++,o=this.g.U(o))this.g.D(o,d),(this.Ca.v==d.x||this.Ca.C==d.x||this.Ca.G==d.y||this.Ca.H==d.y)&&(this.g.Ra(o,this.ji,this.dd.size),this.dd.add(o));this.Nl(!1,this.Ca.v),this.Nl(!1,this.Ca.C),this.Nl(!0,this.Ca.G),this.Nl(!0,this.Ca.H),this.Ty()},x.prototype.My=function(d){for(var c=new f.h,o=new f.h,l=f.O.lg(2048,0),h=this.g.Ob(this.X);h!=-1;h=this.g.Rb(h)){var m=this.g.Xa(h),g=m;do{var v=this.g.U(g);this.g.D(g,c);var w=-1;if(c.x==this.Ca.v?(this.g.D(v,o),o.x==this.Ca.v&&(w=1)):c.x==this.Ca.C&&(this.g.D(v,o),o.x==this.Ca.C&&(w=1)),c.y==this.Ca.G?(this.g.D(v,o),o.y==this.Ca.G&&(w=0)):c.y==this.Ca.H&&(this.g.D(v,o),o.y==this.Ca.H&&(w=0)),w!=-1&&(w=f.h.tb(c,o),!(1>=(w=f.O.truncate(Math.min(Math.ceil(w/d),2048)))))){for(var E=1;E<w;E++)l[E-1]=1*E/w;this.g.Ul(g,l,w-1)}g=v}while(g!=m)}},x.prototype.Vl=function(d,c){var o=this.g.Gd(),l=new f.h,h=new f.ia(0);h.Jb(100);for(var m=this.g.Ob(this.X);m!=-1;m=this.g.Rb(m))for(var g=this.g.Xa(m),v=0,w=this.g.Ja(m);v<w;v++){var E=this.g.U(g);this.g.D(g,l),(d?l.y==c:l.x==c)&&(this.g.D(E,l),(d?l.y==c:l.x==c)&&(this.g.Pa(g,o)!=1&&(h.add(g),this.g.Ra(g,o,1)),this.g.Pa(E,o)!=1&&(h.add(E),this.g.Ra(E,o,1)))),g=E}if(this.g.Td(o),!(3>h.size)){var A=this;h.Vd(0,h.size,function(ue,xe){return A.Mh(ue,xe)}),o=new f.h,m=new f.h,g=new f.h,m.Rc();var M=-1;v=new f.ia(0),w=new f.ia(0),E=this.g.Gd();for(var I=this.g.Gd(),D=0,k=h.size;D<k;D++){var B=h.get(D);if(this.g.D(B,l),!l.qb(m)){if(M!=-1){for(var J=M;J<D;J++){M=h.get(J);var Y=this.g.U(M);B=this.g.Ma(M);var V=!1;0>this.Mh(M,Y)&&(this.g.D(Y,o),d?o.y==c:o.x==c)&&(v.add(M),V=!0,this.g.Ra(M,I,1)),0>this.Mh(M,B)&&(this.g.D(B,o),d?o.y==c:o.x==c)&&(V||v.add(M),this.g.Ra(M,E,1))}for(J=0,V=v.size;J<V;J++){if(M=v.get(J),B=this.g.Pa(M,E),Y=this.g.Pa(M,I),B==1){B=this.g.Ma(M),this.g.D(B,g);var te=[0];if(te[0]=0,!g.qb(l)){var he=f.h.tb(m,g);te[0]=f.h.tb(g,l)/he,te[0]==0?te[0]=2220446049250313e-31:te[0]==1&&(te[0]=.9999999999999998),this.g.Ul(B,te,1),B=this.g.Ma(M),this.g.mf(B,l),w.add(B),this.g.Ra(B,E,1),this.g.Ra(B,I,-1)}}Y==1&&(Y=this.g.U(M),this.g.D(Y,g),(te=[0])[0]=0,g.qb(l)||(he=f.h.tb(m,g),te[0]=f.h.tb(m,l)/he,te[0]==0?te[0]=2220446049250313e-31:te[0]==1&&(te[0]=.9999999999999998),this.g.Ul(M,te,1),B=this.g.U(M),this.g.mf(B,l),w.add(B),this.g.Ra(B,E,-1),this.g.Ra(B,I,1)))}M=v,v=w,(w=M).clear(!1)}M=D,m.L(l)}}this.g.Td(E),this.g.Td(I)}},x.prototype.Nl=function(d,c){var o=new f.h,l=new f.ia(0);l.Jb(100);for(var h=this.g.Gd(),m=0,g=this.dd.size;m<g;m++){var v=this.dd.get(m);if(v!=-1){var w=this.g.U(v);this.g.D(v,o),(d?o.y==c:o.x==c)&&(this.g.D(w,o),(d?o.y==c:o.x==c)&&(this.g.Pa(v,h)!=-2&&(l.add(v),this.g.Ra(v,h,-2)),this.g.Pa(w,h)!=-2&&(l.add(w),this.g.Ra(w,h,-2))))}}if(l.size!=0){var E=this;for(l.Vd(0,l.size,function(xe,be){return E.Mh(xe,be)}),m=0,g=l.size;m<g;m++){var A=l.get(m);this.g.Ra(A,h,m)}v=new f.h,(w=new f.h).Rc();var M=-1;for(m=0,g=l.size;m<g;m++)if((A=l.get(m))!=-1&&(this.g.D(A,o),!o.qb(w))){if(M!=-1)for(;;){A=!1;for(var I=1<m-M?m-1:m,D=M;D<I;D++){var k=l.get(D);if(k!=-1){var B=-1,J=this.g.U(k);0>this.Mh(k,J)&&(this.g.D(J,v),d?v.y==c:v.x==c)&&(B=J),J=-1;var Y=this.g.Ma(k);if(0>this.Mh(k,Y)&&(this.g.D(Y,v),d?v.y==c:v.x==c)&&(J=Y),B!=-1&&J!=-1)this.Kh(k,l,h),this.g.pd(k,!1),this.Kh(B,l,h),this.g.pd(B,!1),A=!0;else if(B!=-1||J!=-1){for(Y=D+1;Y<m;Y++){var V=l.get(Y);if(V!=-1){var te=this.g.U(V),he=-1;0>this.Mh(V,te)&&(this.g.D(te,v),d?v.y==c:v.x==c)&&(he=te),te=this.g.Ma(V);var ue=-1;if(0>this.Mh(V,te)&&(this.g.D(te,v),d?v.y==c:v.x==c)&&(ue=te),he!=-1&&ue!=-1){this.Kh(V,l,h),this.g.pd(V,!1),this.Kh(he,l,h),this.g.pd(he,!1),A=!0;break}if(B!=-1&&ue!=-1){this.zt(l,k,B,V,ue,h),A=!0;break}if(J!=-1&&he!=-1){this.zt(l,V,he,k,J,h),A=!0;break}}}if(A)break}}}if(!A)break}M=m,w.L(o)}}this.g.Td(h)},x.prototype.Kh=function(d,c,o){o=this.g.Pa(d,o),c.set(o,-1),o=this.g.Pa(d,this.ji),this.dd.set(o,-1),(c=this.g.bd(d))!=-1&&this.g.Xa(c)==d&&(this.g.Jf(c,-1),this.g.Wg(c,-1))},x.prototype.zt=function(d,c,o,l,h,m){this.g.Bc(c,l),this.g.Cc(l,c),this.g.Cc(o,h),this.g.Bc(h,o),this.Kh(l,d,m),this.g.mi(l,!1),this.Kh(h,d,m),this.g.mi(h,!0)},x.prototype.Ty=function(){for(var d=0,c=this.dd.size;d<c;d++){var o=this.dd.get(d);o!=-1&&this.g.aj(o,-1)}for(var l=0,h=0,m=this.g.Ob(this.X);m!=-1;){var g=this.g.Xa(m);if(g==-1||m!=this.g.bd(g)){var v=m;m=this.g.Rb(m),this.g.Jf(v,-1),this.g.$q(v)}else{o=g,v=0;do this.g.aj(o,m),v++,o=this.g.U(o);while(o!=g);2>=v?(o=this.g.Pa(g,this.ji),this.dd.set(o,-1),g=this.g.pd(g,!1),v==2&&(o=this.g.Pa(g,this.ji),this.dd.set(o,-1),this.g.pd(g,!1)),v=m,m=this.g.Rb(m),this.g.Jf(v,-1),this.g.$q(v)):(this.g.cp(m,!1),this.g.Wg(m,this.g.Ma(g)),this.g.Vj(m,v),h+=v,l++,m=this.g.Rb(m))}}for(d=0,c=this.dd.size;d<c;d++)if((o=this.dd.get(d))!=-1&&(m=this.g.bd(o))==-1){m=this.g.vf(this.X,-1),v=0,g=o;do this.g.aj(o,m),v++,o=this.g.U(o);while(o!=g);2>=v?(o=this.g.Pa(g,this.ji),this.dd.set(o,-1),g=this.g.pd(g,!1),v==2&&(0<=(o=this.g.Pa(g,this.ji))&&this.dd.set(o,-1),this.g.pd(g,!1)),v=m,this.g.Jf(v,-1),this.g.$q(v)):(this.g.kn(m,!0),this.g.Vj(m,v),this.g.Jf(m,g),this.g.Wg(m,this.g.Ma(g)),this.g.cp(m,!1),h+=v,l++)}for(this.g.Rl(this.X,l),this.g.Tj(this.X,h),d=0,c=this.g.ld;c!=-1;c=this.g.ue(c))d+=this.g.I(c);this.g.bC(d)},x.By=function(d,c,o){return new x(c).Ay(d,o)},x.clip=function(d,c,o,l){if(d.B())return d;if(c.B())return d.Ia();if((o=d.getType())==33)return l=d.D(),c.contains(l)?d:d.Ia();if(o==197)return l=new f.l,d.A(l),l.Ea(c)?(c=new f.Fh,d.copyTo(c),c.Xo(l),c):d.Ia();var h=new f.l;if(d.xc(h),c.contains(h))return d;if(!c.isIntersecting(h))return d.Ia();if((h=d.Bb)!=null&&(h=h.Fk)!=null){if((h=h.Ro(c))==1){if(o!=1736)throw f.i.Qa();return(d=new f.Da(d.description)).tp(c),d}if(h==0)return d.Ia()}switch(o){case 550:o=null,h=d.I();for(var m=d.ub(0),g=0,v=0;v<h;v++)l=new f.h,m.tc(2*v,l),c.contains(l)||(g==0&&(o=d.Ia()),g<v&&o.Fd(d,g,v),g=v+1);return 0<g&&o.Fd(d,g,h),g==0?d:o;case 1736:case 1607:return x.By(d,c,l);default:throw f.i.Qa()}},x.prototype.Mh=function(d,c){var o=new f.h;return this.g.D(d,o),d=new f.h,this.g.D(c,d),o.compare(d)},x}();f.Ud=L}(Q||(Q={})),function(f){var L=function(){function x(d,c){this.Ca=d,this.g=new f.gd,this.dd=new f.ia(0),this.nd=c}return x.prototype.Lh=function(d,c,o){switch(c){case 0:if(d.v<o&&d.C<=o)break;return d.v>=o?1:-1;case 1:if(d.G<o&&d.H<=o)break;return d.G>=o?1:-1;case 2:if(d.v>=o&&d.C>o)break;return d.C<=o?1:-1;case 3:if(!(d.G>=o&&d.H>o))return d.H<=o?1:-1}return 0},x.prototype.Ay=function(d,c){return d.getType()==1736?this.Cy(d,c):this.Dy(d)},x.prototype.Cy=function(d,c){if(this.Ca.R()==0||this.Ca.ca()==0)return d.Ia();var o=new f.l;d.xc(o),this.X=this.g.Ib(d);var l=new f.l,h=new f.l,m=new f.h,g=new f.h,v=[0,0,0,0,0,0,0,0,0],w=[0,0,0,0,0,0,0,0,0],E=new f.yb,A=new f.ia(0);A.Jb(256);for(var M=!1,I=0;!M&&4>I;I++){var D=!1,k=(1&I)!=0,B=0;switch(I){case 0:B=this.Ca.v,D=o.v<=B&&o.C>=B;break;case 1:B=this.Ca.G,D=o.G<=B&&o.H>=B;break;case 2:B=this.Ca.C,D=o.v<=B&&o.C>=B;break;case 3:B=this.Ca.H,D=o.G<=B&&o.H>=B}if(D)for(M=!0,D=this.g.Ob(this.X);D!=-1;){var J=!0,Y=-1,V=-1,te=this.g.Xa(D),he=te;do{var ue=this.g.bc(he);ue==null&&(ue=E,this.g.D(he,m),ue.Dc(m),this.g.D(this.g.U(he),g),ue.Qc(g)),ue.A(l);var xe=this.Lh(l,I,B),be=0,Le=-1;if(xe==-1){be=0<(ue=ue.cq(k,B,v,w))?this.g.LX(he,w,ue):0,be+=1;var Xe=he,qe=this.g.U(Xe);for(ue=0;ue<be;ue++){if(this.g.D(Xe,m),this.g.D(qe,g),(Le=this.g.bc(Xe))==null&&((Le=E).Dc(m),Le.Qc(g)),Le.A(h),(Le=this.Lh(h,I,B))==-1){if(k)(Le=Math.abs(m.y-B))<(xt=Math.abs(g.y-B))?(m.y=B,this.g.mf(Xe,m)):(g.y=B,this.g.mf(qe,g));else{Le=Math.abs(m.x-B);var xt=Math.abs(g.x-B);Le<xt?(m.x=B,this.g.mf(Xe,m)):(g.x=B,this.g.mf(qe,g))}(Le=this.g.bc(Xe))==null&&((Le=E).Dc(m),Le.Qc(g)),Le.A(h),Le=this.Lh(h,I,B)}xt=Y,Y=Le,V==-1&&(V=Y),xt==0&&Y==1||xt==1&&Y==0||xt!=0||Y!=0||A.add(Xe),Y==1&&(J=M=!1),Le=Xe=qe,qe=this.g.U(qe)}}if(be==0&&(xt=Y,Y=xe,V==-1&&(V=Y),xt==0&&Y==1||xt==1&&Y==0||xt!=0||Y!=0||A.add(he),Y==1&&(J=M=!1),Le=this.g.U(he)),he=Le,256<=A.size){for(ue=1,xe=A.size-1;ue<xe;ue++)be=A.get(ue),this.g.pd(be,!1);A.set(1,A.Fc()),A.Bh(2)}}while(he!=te);if(!J)for(V==0&&Y==0&&A.add(te),ue=0,xe=A.size;ue<xe;ue++)be=A.get(ue),this.g.pd(be,!1);A.clear(!1),D=J||this.g.Ja(D)==0?this.g.Zq(D):this.g.Rb(D)}}return M?d.Ia():(this.FB(),0<c&&this.My(c),this.g.Ne(this.X))},x.prototype.Dy=function(d){var c=new f.l,o=new f.l,l=[0,0,0,0,0,0,0,0,0],h=[0,0,0,0,0,0,0,0,0],m=new f.ig,g=d,v=new f.l;d.xc(v);for(var w=new f.h,E=new f.h,A=null,M=null,I=0;4>I;I++){var D=!1,k=(1&I)!=0,B=0;switch(I){case 0:B=this.Ca.v,D=v.v<=B&&v.C>=B;break;case 1:B=this.Ca.G,D=v.G<=B&&v.H>=B;break;case 2:B=this.Ca.C,D=v.v<=B&&v.C>=B;break;case 3:B=this.Ca.H,D=v.G<=B&&v.H>=B}if(D)for(D=g,g=d.Ia(),(D=D.Ga()).Zi();D.$a();)for(var J,Y=!0;D.Ha();){var V=D.ha();V.A(c);var te=this.Lh(c,I,B);if(te==-1){if(0<(te=V.cq(k,B,l,h))){var he=0;V.Yp(w);for(var ue=0;ue<=te;ue++)if(he!=(J=ue<te?h[ue]:1)){V.ah(he,J,m);var xe=m.get();xe.Dc(w),ue<te&&(k?(E.x=l[ue],E.y=B):(E.x=B,E.y=l[ue]),xe.Qc(E)),xe.A(o);var be=this.Lh(o,I,B);be==-1&&(A==null&&(A=new f.h),M==null&&(M=new f.h),xe.Yp(A),xe.Tr(M),k?(he=Math.abs(A.y-B))<(be=Math.abs(M.y-B))?(A.y=B,xe.Dc(A)):(M.y=B,xe.Qc(M)):(he=Math.abs(A.x-B))<(be=Math.abs(M.x-B))?(A.x=B,xe.Dc(A)):(M.x=B,xe.Qc(M)),xe.A(o),be=this.Lh(o,I,B)),xe.Tr(w),he=J,(J=be)==1?(g.oc(xe,Y),Y=!1):Y=!0}}}else(J=te)==1?(g.oc(V,Y),Y=!1):Y=!0}}return g},x.prototype.FB=function(){this.ji=-1,this.Vl(!1,this.Ca.v),this.Vl(!1,this.Ca.C),this.Vl(!0,this.Ca.G),this.Vl(!0,this.Ca.H),this.dd.resize(0),this.dd.Jb(100),this.ji=this.g.Gd();for(var d=new f.h,c=this.g.Ob(this.X);c!=-1;c=this.g.Rb(c))for(var o=this.g.Xa(c),l=0,h=this.g.Ja(c);l<h;l++,o=this.g.U(o))this.g.D(o,d),(this.Ca.v==d.x||this.Ca.C==d.x||this.Ca.G==d.y||this.Ca.H==d.y)&&(this.g.Ra(o,this.ji,this.dd.size),this.dd.add(o));this.Nl(!1,this.Ca.v),this.Nl(!1,this.Ca.C),this.Nl(!0,this.Ca.G),this.Nl(!0,this.Ca.H),this.Ty()},x.prototype.My=function(d){for(var c=new f.h,o=new f.h,l=null,h=null,m=f.O.lg(2048,0),g=this.g.Ob(this.X);g!=-1;g=this.g.Rb(g)){var v=this.g.Xa(g),w=v;do{var E=this.g.U(w);this.g.D(w,c);var A=-1;if(c.x==this.Ca.v?(this.g.D(E,o),o.x==this.Ca.v&&(A=1)):c.x==this.Ca.C&&(this.g.D(E,o),o.x==this.Ca.C&&(A=1)),c.y==this.Ca.G?(this.g.D(E,o),o.y==this.Ca.G&&(A=0)):c.y==this.Ca.H&&(this.g.D(E,o),o.y==this.Ca.H&&(A=0)),A!=-1){if(l==null&&(l=new f.h),h==null&&(h=new f.h),l.L(c),h.ma(0,0),A==0){var M=c.x-this.Ca.v;h.x=f.lc.sign(o.x-c.x),l.x=d*f.lc.Cn(Math.floor(Math.abs(M/d)),M)+this.Ca.v,0>l.x&&(l.x+=d)}else M=c.y-this.Ca.G,h.y=f.lc.sign(o.y-c.y),l.y=d*f.lc.Cn(Math.floor(Math.abs(M/d)),M)+this.Ca.G,0>l.y&&(l.y+=d);M=A!=0?o.y-c.y:o.x-c.x;var I=Math.abs(M);if(65536<I/d)throw f.i.fa("internal error");if(0<I){I=f.O.truncate(I/d)+2,m.length<I&&(m=f.O.lg(I));for(var D=I=0;;D++){var k=new f.h;if(k.x=l.x+h.x*D*d,k.y=l.y+h.y*D*d,1<=(k=(A!=0?k.y-c.y:k.x-c.x)/M))break;0>=k||(m[I]=k,I++)}I!=0&&this.g.Ul(w,m,I)}}w=E}while(w!=v)}},x.prototype.Vl=function(d,c){for(var o=-1,l=new f.h,h=null,m=this.g.Ob(this.X);m!=-1;m=this.g.Rb(m))for(var g=this.g.Xa(m),v=0,w=this.g.Ja(m);v<w;v++){var E=this.g.U(g);this.g.D(g,l),(d?l.y==c:l.x==c)&&(this.g.D(E,l),(d?l.y==c:l.x==c)&&(o==-1&&(o=this.g.Gd()),h==null&&(h=new f.ia(0)).Jb(100),this.g.Pa(g,o)!=1&&(h.add(g),this.g.Ra(g,o,1)),this.g.Pa(E,o)!=1&&(h.add(E),this.g.Ra(E,o,1)))),g=E}if(o!=-1&&this.g.Td(o),!(h==null||3>h.size)){var A=this;h.Vd(0,h.size,function(ue,xe){return A.Mh(ue,xe)}),o=new f.h,m=new f.h,g=new f.h,m.Rc();var M=-1;v=new f.ia(0),w=new f.ia(0),E=null;for(var I=this.g.Gd(),D=this.g.Gd(),k=0,B=h.size;k<B;k++){var J=h.get(k);if(this.g.D(J,l),!l.qb(m)){if(M!=-1){for(var Y=M;Y<k;Y++){M=h.get(Y);var V=this.g.U(M);J=this.g.Ma(M);var te=!1;this.g.D(V,o),0>m.compare(o)&&(d?o.y==c:o.x==c)&&(v.add(M),te=!0,this.g.Ra(M,D,1)),this.g.D(J,o),0>m.compare(o)&&(d?o.y==c:o.x==c)&&(te||v.add(M),this.g.Ra(M,I,1))}for(Y=0,te=v.size;Y<te;Y++){if(M=v.get(Y),J=this.g.Pa(M,I),V=this.g.Pa(M,D),J==1&&(J=this.g.Ma(M),this.g.D(J,g),!g.qb(l))){E==null&&(E=[]);var he=f.h.tb(m,g);E[0]=f.h.tb(g,l)/he,E[0]==0?E[0]=2220446049250313e-31:E[0]==1&&(E[0]=.9999999999999998),this.g.Ul(J,E,1),J=this.g.Ma(M),this.g.mf(J,l),w.add(J),this.g.Ra(J,I,1),this.g.Ra(J,D,-1)}V==1&&(V=this.g.U(M),this.g.D(V,g),g.qb(l)||(E==null&&(E=[]),he=f.h.tb(m,g),E[0]=f.h.tb(m,l)/he,E[0]==0?E[0]=2220446049250313e-31:E[0]==1&&(E[0]=.9999999999999998),this.g.Ul(M,E,1),J=this.g.U(M),this.g.mf(J,l),w.add(J),this.g.Ra(J,I,-1),this.g.Ra(J,D,1)))}M=v,v=w,(w=M).clear(!1)}M=k,m.L(l)}}this.g.Td(I),this.g.Td(D)}},x.prototype.Nl=function(d,c){for(var o=new f.h,l=null,h=-1,m=0,g=this.dd.size;m<g;m++){var v=this.dd.get(m);if(v!=-1){var w=this.g.U(v);this.g.D(v,o),(d?o.y==c:o.x==c)&&(this.g.D(w,o),(d?o.y==c:o.x==c)&&(h==-1&&(h=this.g.Gd()),l==null&&(l=new f.ia(0)).Jb(100),this.g.Pa(v,h)!=-2&&(l.add(v),this.g.Ra(v,h,-2)),this.g.Pa(w,h)!=-2&&(l.add(w),this.g.Ra(w,h,-2))))}}if(l==null)h!=-1&&this.g.Td(h);else{var E=this;for(l.Vd(0,l.size,function(xe,be){return E.Mh(xe,be)}),m=0,g=l.size;m<g;m++){var A=l.get(m);this.g.Ra(A,h,m)}v=new f.h,(w=new f.h).Rc();var M=-1;for(m=0,g=l.size;m<g;m++)if((A=l.get(m))!=-1&&(this.g.D(A,o),!o.qb(w))){if(M!=-1)for(;;){A=!1;for(var I=1<m-M?m-1:m,D=M;D<I;D++){var k=l.get(D);if(k!=-1){var B=-1,J=this.g.U(k);this.g.D(J,v),0>w.compare(v)&&(d?v.y==c:v.x==c)&&(B=J),J=-1;var Y=this.g.Ma(k);if(this.g.D(Y,v),0>w.compare(v)&&(d?v.y==c:v.x==c)&&(J=Y),B!=-1&&J!=-1)this.Kh(k,l,h),this.g.pd(k,!1),this.Kh(B,l,h),this.g.pd(B,!1),A=!0;else if(B!=-1||J!=-1){for(Y=D+1;Y<m;Y++){var V=l.get(Y);if(V!=-1){var te=this.g.U(V),he=-1;this.g.D(te,v),0>w.compare(v)&&(d?v.y==c:v.x==c)&&(he=te),te=this.g.Ma(V);var ue=-1;if(this.g.D(te,v),0>w.compare(v)&&(d?v.y==c:v.x==c)&&(ue=te),he!=-1&&ue!=-1){this.Kh(V,l,h),this.g.pd(V,!1),this.Kh(he,l,h),this.g.pd(he,!1),A=!0;break}if(B!=-1&&ue!=-1){this.zt(l,k,B,V,ue,h),A=!0;break}if(J!=-1&&he!=-1){this.zt(l,V,he,k,J,h),A=!0;break}}}if(A)break}}}if(!A)break}M=m,w.L(o)}this.g.Td(h)}},x.prototype.Kh=function(d,c,o){o=this.g.Pa(d,o),c.set(o,-1),o=this.g.Pa(d,this.ji),this.dd.set(o,-1),(c=this.g.bd(d))!=-1&&this.g.Xa(c)==d&&(this.g.Jf(c,-1),this.g.Wg(c,-1))},x.prototype.zt=function(d,c,o,l,h,m){this.g.Bc(c,l),this.g.Cc(l,c),this.g.Cc(o,h),this.g.Bc(h,o),this.Kh(l,d,m),this.g.mi(l,!1),this.Kh(h,d,m),this.g.mi(h,!0)},x.prototype.Ty=function(){for(var d=0,c=this.dd.size;d<c;d++){var o=this.dd.get(d);o!=-1&&this.g.aj(o,-1)}for(var l=0,h=0,m=this.g.Ob(this.X);m!=-1;){var g=this.g.Xa(m);if(g==-1||m!=this.g.bd(g)){var v=m;m=this.g.Rb(m),this.g.Jf(v,-1),this.g.$q(v)}else{o=g,v=0;do this.g.aj(o,m),v++,o=this.g.U(o);while(o!=g);this.g.cp(m,!1),this.g.Wg(m,this.g.Ma(g)),this.g.Vj(m,v),h+=v,l++,m=this.g.Rb(m)}}for(d=0,c=this.dd.size;d<c;d++)if((o=this.dd.get(d))!=-1&&(m=this.g.bd(o))==-1){m=this.g.vf(this.X,-1),v=0,g=o;do this.g.aj(o,m),v++,o=this.g.U(o);while(o!=g);2>=v?(o=this.g.Pa(g,this.ji),this.dd.set(o,-1),g=this.g.pd(g,!1),v==2&&(0<=(o=this.g.Pa(g,this.ji))&&this.dd.set(o,-1),this.g.pd(g,!1)),v=m,this.g.Jf(v,-1),this.g.$q(v)):(this.g.kn(m,!0),this.g.Vj(m,v),this.g.Jf(m,g),this.g.Wg(m,this.g.Ma(g)),this.g.cp(m,!1),h+=v,l++)}for(this.g.Rl(this.X,l),this.g.Tj(this.X,h),d=0,c=this.g.ld;c!=-1;c=this.g.ue(c))d+=this.g.I(c);this.g.bC(d)},x.By=function(d,c,o,l){return new x(c,l).Ay(d,o)},x.clip=function(d,c,o,l,h){return x.Nu(d,c,null,o,l,h)},x.Nu=function(d,c,o,l,h,m){var g=d.getType();if(g==33)return h=d.D(),c.contains(h)?d:d.Ia();if(g==197)return h=new f.l,d.A(h),h.Ea(c)?(c=new f.Fh,d.copyTo(c),c.Xo(h),c):d.Ia();if(d.B())return d;if(c.B())return d.Ia();var v=new f.l;if(d.xc(v),c.contains(v))return d;if(!c.isIntersecting(v))return d.Ia();if((o!=null||isNaN(l))&&f.ta.ty(o,c,!1),!f.aa.xj(g))throw f.i.N();if((o=d.Bb)!=null&&(o=o.Fk)!=null){if((o=o.Ro(c))==1){if(g!=1736)throw f.i.fa("internal error");return(d=new f.Da(d.description)).tp(c),d}if(o==0)return d.Ia()}switch(g){case 550:for(m=null,g=d.I(),o=d.ub(0),l=0,h=new f.h,v=0;v<g;v++)o.tc(2*v,h),c.contains(h)||(l==0&&(m=d.Ia()),l<v&&m.Fd(d,l,v),l=v+1);return 0<l&&m.Fd(d,l,g),l==0?d:m;case 1736:case 1607:return x.By(d,c,h,m);default:throw f.i.fa("internal error")}},x.prototype.Mh=function(d,c){var o=new f.h;return this.g.D(d,o),d=new f.h,this.g.D(c,d),o.compare(d)},x}();f.ri=L}(Q||(Q={})),function(f){var L=new f.h,x=function(){function c(o,l,h,m,g){this.Pm=new f.h,this.Dk=new f.h,this.Pi=new f.h,this.g=o,this.Aw=h,this.no=m,this.Pm=l,this.yl=g,this.Dk.Rc(),this.Pi.Rc()}return c.prototype.xE=function(o){this.g.D(o,this.Dk),o=f.O.truncate((this.Dk.x-this.Pm.x)*this.no+.5);var l=f.O.truncate((this.Dk.y-this.Pm.y)*this.no+.5);return d.jG(o,l)},c.prototype.jz=function(o){return this.g.Pa(o,this.yl)},c.prototype.Py=function(o,l){return this.g.D(o,this.Dk),this.g.D(l,this.Pi),d.Cv(this.Dk.x,this.Dk.y,this.Pi.x,this.Pi.y,this.Aw)},c}();f.sY=function(){};var d=function(){function c(){this.Pm=new f.h,this.pq=[0,0,0,0],this.xs=[0,0,0,0],this.qo=this.yl=-1}return c.iQ=function(o,l){var h=new c;return h.g=o,h.qa=l,h.Aw=l*l,h.$v=2*l,h.no=1/h.$v,h.BO()},c.Cv=function(o,l,h,m,g){return(o-=h)*o+(l-=m)*l<=g},c.jG=function(o,l){return f.O.Th(l,f.O.Th(o))},c.prototype.DO=function(o,l){this.g.Gc(o,L);for(var h=(L.y-this.Pm.y)*this.no,m=f.O.truncate((L.x-this.Pm.x)*this.no),g=f.O.truncate(h),v=h=0;1>=v;v+=1)for(var w=0;1>=w;w+=1){var E=c.jG(m+v,g+w),A=this.xl.rR(E);A!=-1&&(this.pq[h]=A,this.xs[h]=E,h++)}for(m=h-1;1<=m;m--)for(A=this.pq[m],g=m-1;0<=g;g--)if(A==this.pq[g]){this.xs[g]=-1,m!=--h&&(this.xs[m]=this.xs[h],this.pq[m]=this.pq[h]);break}for(g=0;g<h;g++)this.EO(o,this.xs[g],L,this.pq[g],l)},c.prototype.EO=function(o,l,h,m,g){for(var v=new f.h;m!=-1;m=this.xl.ER(m)){var w=this.xl.ja(m);o==w||l!=-1&&this.g.Pa(w,this.yl)!=l||(this.g.Gc(w,v),c.Cv(h.x,h.y,v.x,v.y,this.Aw)&&g.add(m))}},c.prototype.Xm=function(o,l,h){var m=this.g.Pa(o,this.qo),g=this.g.Pa(l,this.qo);return m==-1&&(m=this.zd.Ph(),this.zd.addElement(m,o),this.g.Ra(o,this.qo,m)),g==-1?this.zd.addElement(m,l):this.zd.Hy(m,g),this.g.Ra(l,this.qo,-2),l=this.YT(o,l),h&&(h=this.kw.xE(o),this.g.Ra(o,this.yl,h)),l},c.WT=function(o,l,h){o.Nb(l),h=o;var m=new f.h;c.XT(o.D(),l.D(),m),h.Cb(m)},c.XT=function(o,l,h){var m=o.x;o.x!=l.x&&(m=(1*o.x+1*l.x)/2);var g=o.y;o.y!=l.y&&(g=(1*o.y+1*l.y)/2),h.ma(m,g)},c.prototype.YT=function(o,l){var h=new f.h;this.g.D(o,h);var m=new f.h;this.g.D(l,m);var g=this.g.cG(o),v=g+(l=this.g.cG(l)),w=0,E=h.x;h.x!=m.x&&(E=(h.x*g+m.x*l)/v,w++);var A=h.y;return h.y!=m.y&&(A=(h.y*g+m.y*l)/v,w++),0<w&&this.g.Cb(o,E,A),this.g.vX(o,v),w!=0},c.prototype.BO=function(){var o=this.g.fd,l=this.g.IF();for(this.Pm=l.mz(),l=Math.max(l.ca(),l.R())/2147483646,this.$v<l&&(this.$v=l,this.no=1/this.$v),this.zd=new f.au,this.zd.At(f.O.truncate(this.g.fd/3+1)),this.zd.fn(f.O.truncate(this.g.fd/3+1)),this.yl=this.g.Gd(),this.qo=this.g.Gd(),this.kw=new x(this.g,this.Pm,this.Aw,this.no,this.yl),this.xl=new f.dL(f.O.truncate(4*o/3),this.kw),this.xl.AW(this.g.fd),o=!1,l=this.g.ld;l!=-1;l=this.g.ue(l))for(var h=this.g.Ob(l);h!=-1;h=this.g.Rb(h))for(var m=this.g.Xa(h),g=0,v=this.g.Ja(h);g<v;g++){var w=this.kw.xE(m);this.g.Ra(m,this.yl,w),this.xl.addElement(m,w),m=this.g.U(m)}var E=new f.ia(0);for(E.Jb(10),l=this.g.ld;l!=-1;l=this.g.ue(l))for(h=this.g.Ob(l);h!=-1;h=this.g.Rb(h))for(m=this.g.Xa(h),g=0,v=this.g.Ja(h);g<v;g++){if(this.g.Pa(m,this.qo)!=-2)for(w=this.g.Pa(m,this.yl),this.xl.jd(m,w);this.DO(m,E),E.size!=0;){w=!1;for(var A=0,M=E.size;A<M;A++){var I=E.get(A),D=this.xl.ja(I);this.xl.vd(I),w=this.Xm(m,D,A+1==M)||w}if(o=o||w,E.clear(!1),!w)break}m=this.g.U(m)}return o&&this.vN(),this.kw=this.xl=null,this.g.Td(this.yl),this.g.Td(this.qo),o},c.prototype.vN=function(){for(var o=new f.h,l=this.zd.je;l!=-1;l=this.zd.qz(l)){var h=this.zd.rc(l);for(this.g.D(this.zd.ja(h),o),h=this.zd.lb(h);h!=-1;h=this.zd.lb(h))this.g.mf(this.zd.ja(h),o)}},c}();f.Yt=d}(Q||(Q={})),function(f){var L=function(){function x(d){d===void 0&&(d=null),this.yg=null,this.Pb=!1,this.yg=d===null?[]:d}return x.prototype.copyTo=function(d){if(d.Pb)throw f.i.fa("CompositeGeographicTransformation is read-only");for(var c=0;c<this.yg.length;c++)d.yg.push(this.yg[c].Of())},x.prototype.count=function(){return this.yg.length},x.prototype.add=function(d){if(this.Pb)throw f.i.fa("CompositeGeographicTransformation is read-only");this.yg.push(d.Of())},x.prototype.clear=function(){if(this.Pb)throw f.i.fa("CompositeGeographicTransformation is read-only");this.yg.length=0},x.prototype.remove=function(d){if(this.Pb)throw f.i.fa("CompositeGeographicTransformation is read-only");this.yg.splice(d,1)},x.prototype.jg=function(){var d=new x;return this.copyTo(d),d},x.prototype.Of=function(){return this.jg()},x.prototype.transform=function(d,c,o,l){if(d.length<c)throw f.i.fa("invalid Argument");var h=o;for(o=0;o<this.yg.length;o++){var m=this.yg[o];if(m.qm()!=null){var g=m.Un,v=g?1:0,w=g?m.qm().getGeogcs2():m.qm().getGeogcs1();if(w=h/(w=w.getUnit().getUnitFactor()),3552713678800501e-30<Math.abs(w-1))for(h=0;h<c;h++)d[h][0]*=w,d[h][1]*=w;f.MC.geogToGeog(m.qm(),c,d,null,v),h=(g?m.qm().getGeogcs1():m.qm().getGeogcs2()).getUnit().getUnitFactor()}}if(w=h/l,3552713678800501e-30<Math.abs(w-1))for(h=0;h<c;h++)d[h][0]*=w,d[h][1]*=w;return c},x.prototype.Nb=function(d){if(d==this)return!0;if(!(d instanceof x)||this.yg.length!=d.yg.length)return!1;for(var c=0;c<this.yg.length;c++)if(!this.yg[c].Nb(d.yg[c]))return!1;return!0},x.prototype.ix=function(){this.Pb=!0},x.prototype.toString=function(){for(var d="CGT ("+this.count()+") ",c=0,o=this.count();c<o;++c)d+=this.yg[c].toString()+", ";return 200<d.length?d.substring(0,197)+"... ("+d.length.toString()+" characters)":d},x.create=function(){return new x},x}();f.wC=L}(Q||(Q={})),function(f){var L,x=Math.PI,d=2*Math.PI,c=Math.PI/2,o=function(){function m(){}return m.TO=function(g,v){var w=new m;return w.x=g,w.y=v,w.type=0,w.Uh=0,w},m.al=function(g){var v=new m;return v.x=g.x,v.y=g.y,v.type=0,v.Uh=0,v},m.SO=function(g){var v=new m;return v.x=g.x,v.y=g.y,v.type=g.type,v.Uh=g.Uh,v},m.Pd=function(g,v,w){var E=new m;return E.x=g.x+v*Math.cos(w),E.y=g.y+v*Math.sin(w),E.type=g.type,E.Uh=g.Uh,E},m.Pu=function(g,v){var w=new m;return w.x=.5*(g.x+v.x),w.y=.5*(g.y+v.y),w.type=g.type,w.Uh=g.Uh,w},m.TE=function(g,v){var w=new m;return w.x=g.x+.001*(v.x-g.x),w.y=g.y+.001*(v.y-g.y),w.type=g.type,w.Uh=g.Uh,w},m}(),l=function(){};(L=f.fL||(f.fL={}))[L.Round=0]="Round",L[L.Bevel=1]="Bevel",L[L.Miter=2]="Miter",L[L.Square=3]="Square";var h=function(){function m(g){this.NA=this.Yb=this.wg=null,this.nd=g}return m.V=function(g,v,w,E,A,M){if(g==null||1>g.Db())throw f.i.N();return v==0||g.B()?g:((M=new m(M)).ko=g,M.Ka=v,M.qa=A,M.Ki=w,M.CA=E,M.Rx())},m.prototype.eM=function(){var g=this.ko,v=g.ac(),w=g.wc(),E=new f.h;return E.uc(w,v),E.normalize(),E.Hv(),E.scale(this.Ka),v.add(E),w.add(E),E=g.Ia(),g.Dc(v),g.Qc(w),E},m.prototype.dM=function(){var g=this.ko;if(0<this.Ka&&this.Ki!=2){var v=new f.Da;return v.ad(g,!1),this.ko=v,this.Rx()}return(g=new f.Fh(g.$)).W(this.Ka,this.Ka),g},m.prototype.tJ=function(g,v,w,E){return(v.x-g.x)*(E.x-w.x)+(v.y-g.y)*(E.y-w.y)},m.prototype.fc=function(g,v){if(v===void 0)this.Yb.push(g),this.gf++;else if(this.gf==0)this.fc(g);else{var w=this.Bw,E=this.wg[v==0?w-1:v-1],A=this.wg[v],M=this.tJ(E,A,this.Yb[this.gf-1],g);0<M?this.fc(g):0>M&&(0<this.tJ(E,A,A,this.Yb[this.gf-1])?(A=this.wg[v==0?w-2:v==1?w-1:v-2],w=o.Pd(E,this.Ka,Math.atan2(E.y-A.y,E.x-A.x)-c),this.Yb[this.gf-1]=w,this.Ki==1||this.Ki==2?(w=o.Pu(w,E),this.fc(w),w=o.Pd(E,this.Ka,this.Jv+c),(E=o.Pu(w,E)).type|=256,this.fc(E)):(w=o.Pd(E,this.Ka,this.Jv+c)).type|=256,this.fc(w),this.fc(g,v)):(w=o.Pd(A,this.Ka,this.Jv+c),this.fc(w),this.Ki==1||this.Ki==2?(w=o.Pu(w,A),this.fc(w),w=o.Pd(A,this.Ka,this.aA-c),(E=o.Pu(w,A)).type|=256,this.fc(E)):(w=o.Pd(A,this.Ka,this.aA-c)).type|=256,this.fc(w)))}},m.prototype.mE=function(){var g,v=this.Bw;this.gf=0;var w=.5*this.qa,E=0,A=0;for(g=0;g<v;g++){var M=this.wg[g],I=g==0?this.wg[v-1]:this.wg[g-1],D=g==v-1?this.wg[0]:this.wg[g+1],k=I.x-M.x,B=I.y-M.y,J=D.x-M.x,Y=D.y-M.y,V=Math.atan2(B,k),te=Math.atan2(Y,J);if(this.Jv=V,this.aA=te,g==0&&(E=V,A=te),k=k*Y-J*B,B=te,te<V&&(te+=d),0<k*this.Ka)this.Ki==1||this.Ki==2?(V=o.Pd(M,this.Ka,V+c),this.fc(V),V=o.TE(M,V),this.fc(V),V=o.Pd(M,this.Ka,te-c),(M=o.TE(M,V)).type|=256,this.fc(M),this.fc(V)):(k=.5*(te-V),k=this.Ka/Math.abs(Math.sin(k)),V=o.Pd(M,k,.5*(V+te)),this.fc(V,g));else if(512&M.type){for(k=1-w/Math.abs(this.Ka),I=1,D=0>this.Ka?-x:x,-1<k&&1>k&&(.017453292519943295>(B=2*Math.acos(k))&&(B=.017453292519943295),1<(I=f.O.truncate(x/B+1.5))&&(D/=I)),B=V+c,V=o.Pd(M,this.Ka,B),g==0&&(V.type|=1024),this.fc(V,g),k=this.Ka/Math.cos(D/2),B+=D/2,(V=o.Pd(M,k,B)).type|=1024,this.fc(V);0<--I;)B+=D,(V=o.Pd(M,k,B)).type|=1024,this.fc(V);(V=o.Pd(M,this.Ka,te-c)).type|=1024,this.fc(V)}else if(this.Ki==1)V=o.Pd(M,this.Ka,V+c),this.fc(V,g),V=o.Pd(M,this.Ka,te-c),this.fc(V);else if(this.Ki==0)for(k=1-w/Math.abs(this.Ka),I=1,D=te-c-(V+c),-1<k&&1>k&&(.017453292519943295>(B=2*Math.acos(k))&&(B=.017453292519943295),1<(I=f.O.truncate(Math.abs(D)/B+1.5))&&(D/=I)),k=this.Ka/Math.cos(.5*D),B=V+c+.5*D,V=o.Pd(M,k,B),this.fc(V,g);0<--I;)B+=D,V=o.Pd(M,k,B),this.fc(V);else this.Ki==2?(k=I.x-M.x,B=I.y-M.y,.99999999<(I=(k*(J=D.x-M.x)+B*(Y=D.y-M.y))/Math.sqrt(k*k+B*B)/Math.sqrt(J*J+Y*Y))?(V=o.Pd(M,1.4142135623730951*this.Ka,te-.25*x),this.fc(V,g),V=o.Pd(M,1.4142135623730951*this.Ka,te+.25*x),this.fc(V)):(I=Math.abs(this.Ka/Math.sin(.5*Math.acos(I))))>(D=Math.abs(this.CA*this.Ka))?(k=.5*(te-V),k=this.Ka/Math.abs(Math.sin(k)),V=o.Pd(M,k,.5*(V+te)),te=f.h.construct(V.x,V.y),V=f.h.construct(M.x,M.y),(M=new f.h).uc(te,V),(te=new f.h).HW(D/M.length(),M,V),V=(I-D)*Math.abs(this.Ka)/Math.sqrt(I*I-this.Ka*this.Ka),0<this.Ka?M.Hv():M.ar(),M.scale(V/M.length()),(V=new f.h).add(te,M),(I=new f.h).uc(te,M),V=o.al(V),this.fc(V,g),V=o.al(I),this.fc(V)):(k=.5*(te-V),k=this.Ka/Math.abs(Math.sin(k)),V=o.Pd(M,k,.5*(V+te)),this.fc(V,g))):(te=B,0<this.Ka?(te>V&&(te-=d),I=V-te<c):(te<V&&(te+=d),I=te-V<c),I?(B=0>(k=1.4142135623730951*this.Ka)?V+.25*x:V+.75*x,V=o.Pd(M,k,B),this.fc(V,g),B=0>k?te-.25*x:te-.75*x,V=o.Pd(M,k,B),this.fc(V)):(k=.5*(te-V),k=this.Ka/Math.abs(Math.sin(k)),te<V&&(te+=d),V=o.Pd(M,k,(V+te)/2),this.fc(V,g)))}return this.Jv=E,this.aA=A,this.fc(this.Yb[0],0),M=o.SO(this.Yb[this.gf-1]),this.Yb[0]=M,this.wW()},m.prototype.Au=function(g,v){if(!(2>v))for(var w=0;w<v;w++){var E=this.Yb[g+w];w!=0?this.NA.Ci(f.h.construct(E.x,E.y)):this.NA.Lt(f.h.construct(E.x,E.y))}},m.prototype.fM=function(g,v,w){var E=g.Ba(v),A=g.Vc(v);if(this.Yb=[],this.NA=w,g.dc(v)){for(v=g.Na(E);g.Na(A-1).qb(v);)A--;if(2<=A-E){for(this.Bw=A-E,this.wg=[],v=E;v<A;v++)this.wg.push(o.al(g.Na(v)));this.mE()&&this.Au(0,this.gf-1)}}else{for(v=g.Na(E);E<A&&g.Na(E+1).qb(v);)E++;for(v=g.Na(A-1);E<A&&g.Na(A-2).qb(v);)A--;if(2<=A-E){for(this.Bw=2*(A-E)-2,this.wg=[],(w=o.al(g.Na(E))).type|=1536,this.wg.push(w),v=E+1;v<A-1;v++)w=o.al(g.Na(v)),this.wg.push(w);for((w=o.al(g.Na(A-1))).type|=512,this.wg.push(w),v=A-2;v>=E+1;v--)(w=o.al(g.Na(v))).type|=1024,this.wg.push(w);if(this.mE())if(2<=this.Yb.length){for(g=-1,(A=(1024&this.Yb[this.gf-1].type)!=0)||(g=0),v=1;v<this.gf;v++)(E=(1024&this.Yb[v].type)!=0)?A||1<(A=v-1)-g+1&&this.Au(g,A-g+1):A&&(g=v-1),A=E;A||1<(A=this.gf-1)-g+1&&this.Au(g,A-g+1)}else g=0,A=this.gf-1,0<=g&&1<=A-g&&this.Au(g,A-g+1)}}this.wg=null,this.Bw=0,this.Yb=null,this.gf=0},m.prototype.wW=function(){for(var g=!1,v=0;v<this.gf;v++){var w=this.Yb[v];w.qh=v+1,w.sh=v-1,this.Yb[v]=w}for((w=this.Yb[0]).sh=this.gf-2,this.Yb[0]=w,(w=this.Yb[this.gf-2]).qh=0,this.Yb[this.gf-2]=w,v=w=0;v<this.gf;v++)if(256&this.Yb[w].type){var E=this.GP(w);if(E==-1){g=!0;break}w=E}else w=this.Yb[w].qh;return!g&&(this.QO(w),!0)},m.prototype.GP=function(g){for(var v,w,E=this.gf-1,A=g,M=1;M<=E-2;M++){v=A=this.Yb[A].qh,w=g;for(var I=1;I<=M;I++){if(w=this.Yb[w].sh,(256&this.Yb[w].type)==0&&(256&this.Yb[v].type)==0){var D=this.gS(w,v);if(D!=-1)return D}v=this.Yb[v].sh}}return-1},m.prototype.gS=function(g,v){var w=this.Yb[this.Yb[g].sh],E=this.Yb[g],A=this.Yb[this.Yb[v].sh],M=this.Yb[v];if(!this.JW(w,E,A,M))return-1;var I=new l;return this.xQ(w,E,A,M,I)&&!I.bE&&f.O.bK((E.x-w.x)*(M.y-A.y)-(E.y-w.y)*(M.x-A.x))!=f.O.bK(this.Ka)?(w=this.Yb[g].sh,I.an.type=E.type,I.an.qh=v,I.an.sh=w,this.Yb[g]=I.an,I.an=this.Yb[v],I.an.sh=g,this.Yb[v]=I.an,v):-1},m.prototype.JW=function(g,v,w,E){return Math.max(g.x,v.x)>=Math.min(w.x,E.x)&&Math.max(w.x,E.x)>=Math.min(g.x,v.x)&&Math.max(g.y,v.y)>=Math.min(w.y,E.y)&&Math.max(w.y,E.y)>=Math.min(g.y,v.y)},m.prototype.xQ=function(g,v,w,E,A){A.bE=!1;var M=(v.y-g.y)*(E.x-w.x)-(v.x-g.x)*(E.y-w.y),I=(w.y-g.y)*(v.x-g.x)-(w.x-g.x)*(v.y-g.y);if(0<=(M=M==0?2:I/M)&&1>=M){var D=M;if(M=(E.y-w.y)*(v.x-g.x)-(E.x-w.x)*(v.y-g.y),I=(g.y-w.y)*(E.x-w.x)-(g.x-w.x)*(E.y-w.y),0<=(M=M==0?2:I/M)&&1>=M)return A.an=o.TO(g.x+M*(v.x-g.x),g.y+M*(v.y-g.y)),A.an.Uh=w.Uh+D*(E.Uh-w.Uh),D!=0&&D!=1||M!=0&&M!=1||(A.bE=!0),A.VY=M,A.WY=D,!((D==0||D==1)&&0<M&&1>M||(M==0||M==1)&&0<D&&1>D)}return!1},m.prototype.QO=function(g){for(;this.Yb[g].sh<g;)g=this.Yb[g].sh;var v=0,w=g;do w=this.Yb[w],this.Yb[v]=w,w=w.qh,v++;while(w!=g);this.Yb[v]=this.Yb[0],this.gf=v+1},m.prototype.$C=function(g){var v=this.ko,w=v.Ga();if(w!=null){w.Zi();for(var E=-1;w.$a();)E++,this.fM(v,E,g)}},m.prototype.Rx=function(){var g=this.ko.getType();return g==322?this.eM():g==197?this.dM():f.aa.yd(g)?((g=new f.Ta).oc(this.ko,!0),this.ko=g,this.Rx()):g==1607?(g=new f.Ta,this.$C(g),g):g==1736?(g=new f.Da,this.$C(g),g):null},m}();f.IK=h}(Q||(Q={})),function(f){var L=function(){function o(l){this.qk=l}return o.prototype.D=function(l,h){this.qk.g.D(l,h)},o.prototype.vd=function(l){var h=this.qk.Fa.ja(l);this.qk.Fa.vd(l,-1),this.qk.g.pd(h,!1)},o}(),x=function(){function o(l){this.qk=l}return o.prototype.D=function(l,h){this.qk.IT.D(l,h)},o.prototype.vd=function(l){this.qk.Fa.vd(l,-1)},o}(),d=function(){function o(l){this.qk=l}return o.prototype.D=function(l,h){h.L(this.qk.LT[l])},o.prototype.vd=function(l){this.qk.Fa.vd(l,-1)},o}(),c=function(){function o(l){l===void 0?(this.Fa=new f.Yj,this.Fa.De(20),this.g=new f.gd,this.xT=this.g.Ig(550),this.Ss=this.g.vf(this.xT,-1),this.Xh=new L(this)):l instanceof Array?(this.Fa=new f.Yj,this.Fa.De(20),this.LT=l,this.Xh=new d(this)):(this.Fa=new f.Yj,this.Fa.De(20),this.IT=l,this.Xh=new x(this))}return o.prototype.Ib=function(l){var h=l.getType();if(f.Gx.xj(h))this.jN(l);else if(f.Vk.yd(h))this.oN(l);else if(h==197)this.gN(l);else{if(h!=33)throw f.i.N("invalid shape type");this.nN(l)}},o.prototype.cR=function(){var l=new f.Sa,h=this.Fa.rc(-1),m=new f.Da(this.g.ht);for(this.g.Vi(this.Fa.ja(h),l),m.nf(l),h=this.Fa.lb(h);h!=-1;h=this.Fa.lb(h))this.g.Vi(this.Fa.ja(h),l),m.lineTo(l);return m},o.RO=function(l){var h=new o(l),m=l.I(),g=1,v=new f.h,w=new f.h,E=new f.h;for(l.D(0,v);l.D(g,w),w.Rz(v)&&g<m-1;)g++;for(h.Fa.addElement(0,-1),h.Fa.xn(g),m=g+1;m<l.I();m++)l.D(m,E),(g=h.pC(E))!=-1&&h.Fa.Sj(g,m);for(E=new f.Sa,g=h.Fa.rc(-1),m=new f.Da(l.description),l.ve(h.Fa.ja(g),E),m.nf(E),g=h.Fa.lb(g);g!=-1;g=h.Fa.lb(g))l.ve(h.Fa.ja(g),E),m.lineTo(E);return m},o.construct=function(l,h,m){for(var g=new o(l),v=1,w=l[0];l[v].Rz(w)&&v<h-1;)v++;for(g.Fa.addElement(0,-1),g.Fa.xn(v),v+=1;v<h;v++)(w=g.pC(l[v]))!=-1&&g.Fa.Sj(w,v);for(l=0,h=g.Fa.rc(-1);h!=-1;h=g.Fa.lb(h))m[l++]=g.Fa.ja(h);return l},o.JG=function(l,h){var m=l.Ba(h),g=l.Vc(h);if(h=!l.dc(h)&&l.Nn(h),l=l.ub(0),g*=2,h&&(g-=2),6>g-(m*=2))return!0;h=new f.h;var v=new f.h,w=new f.h;l.tc(m,h),l.tc(m+2,v),l.tc(m+4,w);var E=o.Wu(v,w,h);if(E.ps()||!o.um(E.value()))return!1;var A=f.h.construct(v.x,v.y),M=new f.h;for(m+=6;m<g;m+=2)if(M.L(v),v.L(w),l.tc(m,w),(E=o.Wu(v,w,h)).ps()||!o.um(E.value())||(E=o.Wu(A,w,h)).ps()||!o.um(E.value())||(E=o.Wu(v,w,M)).ps()||!o.um(E.value()))return!1;return!0},o.prototype.jN=function(l){for(var h=new f.Sa,m=new f.h,g=0;g<l.I();g++){l.D(g,m);var v=this.Cr(m);if(v!=-1){l.ve(g,h);var w=this.g.fc(this.Ss,h);this.Fa.Sj(v,w)}}},o.prototype.gN=function(l){for(var h=new f.Sa,m=new f.h,g=0;4>g;g++){l.mB(g,m);var v=this.Cr(m);if(v!=-1){l.Hf(g,h);var w=this.g.fc(this.Ss,h);this.Fa.Sj(v,w)}}},o.prototype.oN=function(l){var h=new f.Sa,m=l.ac();if((m=this.Cr(m))!=-1){l.To(h);var g=this.g.fc(this.Ss,h);this.Fa.Sj(m,g)}m=l.wc(),(m=this.Cr(m))!=-1&&(l.Po(h),l=this.g.fc(this.Ss,h),this.Fa.Sj(m,l))},o.prototype.nN=function(l){var h=l.D();(h=this.Cr(h))!=-1&&(l=this.g.fc(this.Ss,l),this.Fa.Sj(h,l))},o.prototype.Cr=function(l){var h=-1;if(this.Fa.size(-1)==0)return this.Fa.addElement(-4,-1);if(this.Fa.size(-1)==1){var m=this.g.Na(this.Fa.ja(this.Fa.rc(-1)));return l.Rz(m)||(h=this.Fa.xn(-5)),h}return this.pC(l)},o.prototype.pC=function(l){var h=-1;do{var m=this.Fa.rc(-1),g=this.Fa.Fc(-1),v=this.Fa.ja(m),w=this.Fa.ja(g),E=new f.h,A=new f.h;if(this.Xh.D(v,E),this.Xh.D(w,A),v=f.h.Uq(A,l,E),o.um(v))h=this.Fa.xn(-1),(E=this.nC(l,g,m))!=m&&this.oC(l,m,this.Fa.we(E));else if(o.CG(v)){A=this.Fa.sv(-1);var M=this.Fa.rc(-1),I=this.Fa.Fc(-1);for(v=new f.h,w=new f.h;M!=this.Fa.we(I);){var D=this.Fa.ja(A);this.Xh.D(D,v),D=f.h.Uq(v,l,E),o.CG(D)?(I=A,A=this.Fa.ll(A)):(M=A,A=this.Fa.Xp(A))}if(A=I,E=M,D=this.Fa.ja(A),M=this.Fa.ja(E),this.Xh.D(D,v),this.Xh.D(M,w),E!=m&&(v=f.h.Uq(w,l,v),!o.um(v)))continue;h=this.Fa.zu(E,A,-2,!1),this.oC(l,A,g),this.nC(l,E,m)}else this.sb==null&&(this.sb=new f.yb),this.sb.Dc(A),this.sb.Qc(E),0>(E=this.sb.fe(l,!0))?(E=this.Fa.we(g),this.Fa.vd(g,-1),h=this.Fa.xn(-3),this.nC(l,E,m)):1<E&&(E=this.Fa.lb(m),this.Fa.vd(m,-1),h=this.Fa.zu(-1,E,-3,!1),this.oC(l,E,g))}while(0);return h},o.prototype.oC=function(l,h,m){if(h!=m){var g=this.Fa.ja(h),v=this.Fa.lb(h),w=new f.h,E=new f.h;for(this.Xh.D(g,w);h!=m&&2<this.Fa.size(-1)&&(this.Xh.D(this.Fa.ja(v),E),g=f.h.Uq(E,l,w),!o.um(g));)g=h,h=v,w.L(E),v=this.Fa.lb(h),this.Xh.vd(g)}},o.prototype.nC=function(l,h,m){if(h==m)return m;var g=this.Fa.ja(h),v=this.Fa.we(h),w=new f.h,E=new f.h;for(this.Xh.D(g,w);h!=m&&2<this.Fa.size(-1)&&(this.Xh.D(this.Fa.ja(v),E),g=f.h.Uq(w,l,E),!o.um(g));)g=h,h=v,w.L(E),v=this.Fa.we(h),this.Xh.vd(g);return h},o.Wu=function(l,h,m){var g=new f.Wb;g.set(h.x),g.sub(l.x);var v=new f.Wb;v.set(m.y),v.sub(l.y);var w=new f.Wb;return w.set(h.y),w.sub(l.y),(h=new f.Wb).set(m.x),h.sub(l.x),g.Ag(v),w.Ag(h),g.sub(w),g},o.um=function(l){return 0>l},o.CG=function(l){return 0<l},o}();f.Zt=c}(Q||(Q={})),function(f){var L=function(){function x(d){this.g=null,this.tH=!0,this.nd=d}return x.zU=function(d,c,o){return d=f.ta.Er(d),f.Yt.Cv(c.Lg(),c.ih(),o.Lg(),o.ih(),f.lc.ox(d))},x.CO=function(d,c){var o=new f.Sa;return f.Yt.WT(d,c,o),o},x.V=function(d,c,o,l){return(o=new x(o)).g=d,o.qa=c,o.tH=l,o.EM()},x.prototype.nM=function(d){return f.Yt.iQ(this.g,d)},x.prototype.sM=function(d){return f.$t.V(this.g,d,this.nd)},x.prototype.EM=function(){var d=this.qa,c=f.ta.Er(d),o=1.00001*(d=f.ta.rN(d));d*=1.000001;for(var l=!1,h=30<this.g.fd+10?1e3:(this.g.fd+10)*(this.g.fd+10),m=0,g=this.g.jS();;m++){if(m>h)throw f.i.fa("Internal Error: max number of iterations exceeded");var v=this.nM(c);if(l=l||v,this.tH&&(v=this.g.Gp(c,!0,!1)!=0,l=l||v),v=!1,(m==0||g||f.$t.kI(!0,this.g,d,null,this.nd))&&(v=this.sM(o),l=l||v),!v)break;f.mp.zp(this.nd)}return l},x}();f.Tk=L}(Q||(Q={})),function(f){var L=function(){function d(c){this.$d=this.Mc=null,this.Ys=0,this.Ub=c,this.cA=!0}return d.prototype.uv=function(c,o){var l=this.g.bc(c);if(l==null){if(!this.g.ed(c,o))return null;l=o}return l},d.prototype.Xq=function(){var c;c===void 0&&(c=!1),this.Ys++,(c||!(4095&this.Ys))&&(this.Ys=0,f.mp.zp(this.Ub))},d.prototype.nP=function(){var c=this.g.Yq(!1),o=!1,l=new f.yb,h=new f.yb,m=new f.l;m.Oa();var g=new f.l;g.Oa();for(var v=new f.Sa,w=new f.TC,E=c.next();E!=-1;E=c.next()){f.mp.zp(this.Ub);var A=null,M=!1;if(!f.aa.Rn(this.g.ic(c.ck))){if((A=this.uv(E,l))==null)continue;if(A.A(m),m.W(this.qa,this.qa),A.Bi(this.qa)){if(!A.Bi(0))continue;M=!0,A=null}}var I=this.g.Yq(c),D=I.next();for(D!=-1&&(D=I.next());D!=-1;D=I.next()){var k=null,B=!1;if(!f.aa.Rn(this.g.ic(I.ck))){if((k=this.uv(D,h))==null)continue;if(k.A(g),k.Bi(this.qa)){if(!k.Bi(0))continue;B=!0,k=null}}var J=0,Y=0;if(A!=null&&k!=null)m.HG(g)&&(w.Oo(A),w.Oo(k),w.Ea(this.qa,!1),0<(J=w.ol(0))+(Y=w.ol(1))&&(this.g.jr(E,w,0,!0),this.g.jr(D,w,1,!0)),w.clear());else if(A!=null){var V=new f.h;if(this.g.D(D,V),m.contains(V)){if(w.Oo(A),this.g.Vi(D,v),w.Kz(this.qa,v,!1),0<(J=w.ol(0)))if(this.g.jr(E,w,0,!0),B){for(B=-1,V=this.g.U(D);V!=-1&&V!=D&&(B=V,(k=this.uv(V,h))!=null&&k.Bi(0));V=this.g.U(V));for(V=D;V!=-1&&(this.g.Dh(V,w.Bf),V!=B);V=this.g.U(V));}else this.g.Dh(D,w.Bf);w.clear()}}else{if(k==null)continue;if(V=new f.h,this.g.D(E,V),g.W(this.qa,this.qa),g.contains(V)){if(w.Oo(k),this.g.Vi(E,v),w.Kz(this.qa,v,!1),0<(Y=w.ol(0)))if(this.g.jr(D,w,0,!0),M){for(B=-1,V=this.g.U(E);V!=-1&&V!=E&&(B=V,(k=this.uv(V,h))!=null&&k.Bi(0));V=this.g.U(V));for(V=E;V!=-1&&(this.g.Dh(V,w.Bf),V!=B);V=this.g.U(V));}else this.g.Dh(E,w.Bf);w.clear()}}if(J+Y!=0){if(J!=0){if((A=this.g.bc(E))==null){if(!this.g.ed(E,l))continue;A=l,l.A(m)}else A.A(m);if(A.Bi(this.qa))break}o=!0}}}return o},d.prototype.oP=function(){return this.QU()},d.prototype.QU=function(){return new f.RC().PX(this.g,this.qa)},d.prototype.lI=function(){var c=!1;this.Mc==null&&(this.Mc=new f.Yj);var o=new f.ia(0);o.Jb(this.g.fd+1);for(var l=this.g.Yq(),h=l.next();h!=-1;h=l.next())o.add(h);this.g.nx(o,o.size),o.add(-1),l=this.g.Gd(),h=this.g.Gd(),this.$d=new f.UC(this.g,this.qa,!this.cA),this.Mc.Vo(this.$d);var m=new f.ia(0),g=new f.ia(0),v=0;new f.h;var w=this.g.td;this.g.vb.mc();for(var E,A,M=this.g.vb.za[0].o,I=o.get(v++);I!=-1;){var D=E=M[2*(A=w.T(I,0))],k=A=M[2*A+1];do{var B=w.T(I,2),J=w.T(I,1);if(B!=-1){var Y=w.T(B,0),V=M[2*Y];0>(k<(Y=M[2*Y+1])?-1:k>Y?1:D<V?-1:D>V?1:0)&&(g.add(I),g.add(B))}J!=-1&&(V=M[2*(Y=w.T(J,0))],0>(k<(Y=M[2*Y+1])?-1:k>Y?1:D<V?-1:D>V?1:0)&&(g.add(J),g.add(J))),(V=this.g.Pa(I,l))!=-1&&(m.add(V),this.g.Ra(I,l,-1)),(V=this.g.Pa(I,h))!=-1&&(m.add(V),this.g.Ra(I,h,-1)),(I=o.get(v++))!==-1&&(D=M[2*(k=w.T(I,0))],k=M[2*k+1])}while(I!=-1&&D===E&&k===A);for(D=m.size==1&&g.size==2,V=k=-1,B=0,J=m.size;B<J;B++){Y=m.get(B);var te=this.Mc.we(Y);if(te==-1||m.hG(te)||(k=te),(Y=this.Mc.lb(Y))==-1||m.hG(Y)||(V=Y),k!=-1&&V!=-1)break}for(this.$d.$J(A,E),B=0,J=m.size;B<J;B++)Y=m.get(B),this.Mc.vd(Y,-1);if(m.clear(!1),!D&&k!=-1&&V!=-1&&this.qO(k,V)){c=!0,this.Ni=this.$d.rm();break}for(B=0,J=g.size;B<J;B+=2){if(A=g.get(B),E=g.get(B+1),D?(A=this.Mc.zu(k,V,A,!0),D=!1):A=this.Mc.addElement(A,-1),this.$d.rg){this.Ni=this.$d.rm(),c=!0;break}this.g.Pa(E,l)==-1?this.g.Ra(E,l,A):this.g.Ra(E,h,A)}if(c)break;g.Bh(0)}return this.g.Td(l),this.g.Td(h),c},d.prototype.qO=function(c,o){return this.$d.compare(this.Mc,this.Mc.ja(c),o),c=this.$d.rg,this.$d.Kr(),c},d.yE=function(c){for(var o=c.ld;o!=-1;o=c.ue(o))if(f.aa.Hc(c.ic(o)))return!0;return!1},d.fQ=function(c,o,l,h){return!!d.yE(c)&&((o=new d(h)).g=c,o.qa=l,15>c.fd?c=o.nP():o.oP())},d.V=function(c,o,l){return d.fQ(c,c.IF(),o,l)},d.kI=function(c,o,l,h,m){if(!d.yE(o))return!1;var g=new d(m);if(g.g=o,g.qa=l,g.cA=c,g.lI())return h?.Wt(g.Ni),!0;var v=new f.Dd;return v.$B(),o.Oc(v),(g=new d(m)).g=o,g.qa=l,g.cA=c,c=g.lI(),v.$B(),o.Oc(v),!!c&&(h?.Wt(g.Ni),!0)},d.Ml=function(c,o){return!(16>(c=c.I()))&&2*c+Math.log(c)*Math.LOG10E/Math.log(2)*o<1*c*o},d.lP=function(c,o,l,h){var m=o.getType();if(f.aa.Hc(m))return new d(h).mP(c,o,l);throw f.i.fa("crack_A_with_B")},d.prototype.mP=function(c,o,l){var h=new f.l;c.xc(h);var m=new f.l;if(o.xc(m),m.W(l,l),!m.isIntersecting(h))return c;var g=c.Bb,v=null;g!=null&&(v=g.Fb),d.Ml(c,c.I())&&(v=f.ta.jj(c,m));var w=v!=null?v.getIterator():null,E=o.Ga();o=c.Ga();var A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(m=[];E.$a();)for(;E.Ha();){var M=E.ha();if(v!=null){for(w.Uo(M,l),g=w.next();g!=-1;g=w.next())if(this.Xq(),o.Vb(v.ja(g),-1),o.Ha()){var I=(g=o.ha()).Ea(M,null,A,null,l);for(g=0;g<I;++g){var D=A[g];if(D!=0&&D!=1){var k=o.wb(),B=new x;B.t=D,B.index=k,m.push(B)}}}}else{var J=new f.l;if(M.xc(J),J.W(l,l),h.isIntersecting(J)){for(o.Zi();o.$a();)for(;o.Ha();)if(this.Xq(),g=o.ha(),D=new f.l,g.xc(D),D.isIntersecting(J))for(I=g.Ea(M,null,A,null,l),g=0;g<I;++g)(D=A[g])!=0&&D!=1&&(k=o.wb(),(B=new x).t=D,B.index=k,m.push(B))}}}if(m.length==0)return c;for(m=m.sort(x.Ey),c=c.Ia(),o.Zi();o.$a()&&!o.Ha(););for(l=o.ha(),h=new f.ig,v=-1,g=0,w=m.length;g<w;){for(A=m[g].index,E=g+1;E<w&&m[E].index==A;)++E;for(;o.wb()<A;){if(this.Xq(),M=o.Ha(),D=o.gb,(J=M||!o.On()||o.Pn())&&c.oc(l,v!=D),v=D,!M)for(;o.$a()&&!o.Ha(););l=o.ha()}for(A=0;g<E;g++)(D=m[g].t)!=A&&(l.ah(A,D,h),A=D,D=o.gb,c.oc(h.get(),v!=D),v=D);if((J=(M=o.Ha())||!o.On()||o.Pn())&&(l.ah(A,1,h),c.oc(h.get(),!1)),M)l=o.ha();else{for(;o.$a()&&!o.Ha(););l=o.Ha()?o.ha():null}g=E}for(l!=null&&(D=o.gb,(J=(M=o.Ha())||!o.On()||o.Pn())&&c.oc(l,v!=D),v=D),M=o.Ha();;){if(!M){for(;o.$a()&&!(M=o.Ha()););if(!M)break}l=o.ha(),D=o.gb,(J=(M=o.Ha())||!o.On()||o.Pn())&&c.oc(l,v!=D),v=D}return c},d}();f.$t=L;var x=function(){function d(){}return d.Ey=function(c,o){return c.index==o.index?c.t>o.t?1:c.t<o.t?-1:0:c.index>o.index?1:-1},d}()}(Q||(Q={})),function(f){var L;(L=f.KK||(f.KK={}))[L.Left=0]="Left",L[L.Right=1]="Right",L[L.Coincident=2]="Coincident",L[L.Undefined=3]="Undefined",L[L.Uncut=4]="Uncut";var x=function(o,l,h,m,g,v,w,E,A,M,I){this.X=o,this.bt=l,this.Ns=h,this.tg=m,this.Lm=M,this.Al=I};f.uY=x;var d=function(){function o(l,h){this.JH=l,this.Hi=h}return o.prototype.qM=function(l,h){var m=new f.h;this.Hi.D(l,m);var g=new f.h;return this.Hi.D(h,g),(m=m.compare(g))!=0?m:(l=this.Hi.Pa(l,this.JH))<(h=this.Hi.Pa(h,this.JH))?-1:l==h?0:1},o}(),c=function(o,l,h,m,g,v,w,E,A){this.tg=o,this.Ns=l,this.OA=h,this.UH=m,this.Ei=g,this.Al=v,this.Lm=w,this.VH=E,this.OT=A};f.tY=c,f.LK=function(){function o(){}return o.JK=function(l,h,m,g,v,w){if(h.B())l=new x(h,4,-1,-1,NaN,4,-1,-1,NaN,-1,-1),v.push(l);else if(m.B())l=new x(h,4,-1,-1,NaN,4,-1,-1,NaN,-1,-1),v.push(l);else{var E=new f.gd;if(E.Ib(h),E.Ib(m),f.Tk.V(E,g,w,!0),E.fd==0)l=new x(h.Ia(),4,-1,-1,NaN,4,-1,-1,NaN,-1,-1),v.push(l);else{for(h=0,m=E.Gd(),g=E.ld;g!=-1;g=E.ue(g))for(w=E.Ob(g);w!=-1;w=E.Rb(w))for(var A=E.Xa(w),M=0,I=E.Ja(w);M<I;A=E.U(A),M++)E.Ra(A,m,h++);h=o.HM(m,E),o.cM(l,h,E,v)}}},o.HM=function(l,h){for(var m=h.fd,g=new f.ia(0),v=h.ld;v!=-1;v=h.ue(v))for(var w=h.Ob(v);w!=-1;w=h.Rb(w))for(var E=h.Xa(w),A=0,M=h.Ja(w);A<M;E=h.U(E),A++)g.add(E);var I=new d(l,h);g.Vd(0,m,function(Xe,qe){return I.qM(Xe,qe)}),l=[];var D=[],k=h.Gd(),B=h.Gd();v=h.ld,w=h.ue(v),M=new f.h;var J=new f.h,Y=g.get(0),V=h.bd(Y),te=h.Qf(V);h.D(Y,M);var he=1;for(E=0;he<m-1;){var ue=!1;for(A=he;A<m;A++)if(A!=E){var xe=g.get(A),be=h.bd(xe),Le=h.Qf(be);if(h.D(xe,J),!M.qb(J))break;te==v&&Le==w&&(ue=o.uM(k,B,h,l,D,V,Y,be,xe))}if(ue||E==he-1){if(ue&&E==he-1&&he--,++E==m)break;Y=g.get(E),V=h.bd(Y),te=h.Qf(V),h.D(Y,M)}ue||(he=E+1)}for(m=[],v=h.ld;v!=-1;v=h.ue(v))for(w=h.Ob(v);w!=-1;w=h.Rb(w))for(g=h.Xa(w),A=0,M=h.Ja(w);A<M;g=h.U(g),A++){if(0<=(E=h.Pa(g,B)))for(;E<D.length&&D[E].tg==g;)m.push(D[E++]);if(0<=(E=h.Pa(g,k)))for(;E<l.length&&l[E].tg==g;)m.push(l[E++])}return h.Td(k),h.Td(B),m},o.uM=function(l,h,m,g,v,w,E,A,M){var I=m.rj(w),D=m.rj(A),k=m.Xa(w),B=m.Xa(A),J=m.Ma(E),Y=m.Ma(M),V=!1,te=!1,he=!1,ue=!1;return E!=k&&(M!=B&&(V=o.vM(l,m,g,w,J,A,Y)),M!=D&&(te=o.wM(l,m,g,w,J,A,M))),E!=I&&(M!=B&&(he=o.xM(h,m,v,w,E,A,Y,k)),M!=D&&(ue=o.yM(h,m,v,w,E,A,M,k))),V&&te&&he?(l=g.length-1,v[ue?v.length-2:v.length-1].Ei==2&&(g[l-1]=g[l],--g.length)):V&&te&&ue&&v[v.length-1].Ei==2&&(v=g[g.length-1],--g.length,m.Pa(v.tg,l)==g.length&&m.Ra(v.tg,l,-1)),V||te||he||ue},o.vM=function(l,h,m,g,v,w,E){var A=new f.yb,M=new f.yb,I=[0,0],D=[0,0],k=h.bc(v);return k==null&&(h.ed(v,A),k=A),(A=h.bc(E))==null&&(h.ed(E,M),A=M),2>(k=k.Ea(A,null,I,D,0))&&(g=new c(v,g,I[0],NaN,k,E,w,D[0],NaN),m.push(g),0>(g=h.Pa(v,l))&&h.Ra(v,l,m.length-1)),!0},o.wM=function(l,h,m,g,v,w,E){var A=new f.yb,M=new f.yb,I=[0,0],D=[0,0],k=h.bc(v);return k==null&&(h.ed(v,A),k=A),(A=h.bc(E))==null&&(h.ed(E,M),A=M),2>(k=k.Ea(A,null,I,D,0))&&(g=new c(v,g,I[0],NaN,k,E,w,D[0],NaN),m.push(g),0>(g=h.Pa(v,l))&&h.Ra(v,l,m.length-1),!0)},o.xM=function(l,h,m,g,v,w,E,A){var M=new f.yb,I=new f.yb,D=[0,0],k=[0,0],B=h.bc(v);return B==null&&(h.ed(v,M),B=M),(M=h.bc(E))==null&&(h.ed(E,I),M=I),(B=B.Ea(M,null,D,k,0))==2?(g=new c(v,g,D[0],D[1],B,E,w,k[0],k[1]),m.push(g),0>(g=h.Pa(v,l))&&h.Ra(v,l,m.length-1),!0):(I=!1,v==A&&(g=new c(v,g,D[0],NaN,B,E,w,k[0],NaN),m.push(g),0>(g=h.Pa(v,l))&&h.Ra(v,l,m.length-1),I=!0),I)},o.yM=function(l,h,m,g,v,w,E,A){var M=new f.yb,I=new f.yb,D=[0,0],k=[0,0],B=h.bc(v);return B==null&&(h.ed(v,M),B=M),(M=h.bc(E))==null&&(h.ed(E,I),M=I),(B=B.Ea(M,null,D,k,0))==2?(g=new c(v,g,D[0],D[1],B,E,w,k[0],k[1]),m.push(g),0>(g=h.Pa(v,l))&&h.Ra(v,l,m.length-1),!0):(I=!1,v==A&&(g=new c(v,g,D[0],NaN,B,E,w,k[0],NaN),m.push(g),0>(g=h.Pa(v,l))&&h.Ra(v,l,m.length-1),I=!0),I)},o.cM=function(l,h,m,g){var v=[];v[0]=new f.h,v[1]=new f.h,v[2]=new f.h,v[3]=new f.h;var w=new f.h,E=new f.h,A=new f.h,M=new f.h,I=null;g!=null&&(I=new f.ig).Or();var D=0,k=null,B=new f.yb;new f.yb;for(var J=m.Ob(m.ld);J!=-1;J=m.Rb(J)){for(var Y=4,V=-1,te=-1,he=-1,ue=-1,xe=NaN,be=!0,Le=!1,Xe=!0,qe=!0,xt=!0,it=0,hi=J,ai=0,yt=m.Xa(J),Or=m.Ja(J),xn=0;xn<Or;yt=m.U(yt),xn++){var Pr=m.bc(yt);if(Pr==null){if(!m.ed(yt,B))continue;Pr=B}te==-1&&(te=yt);for(var Ri=0;D<h.length&&yt==h[D].tg;){V=h[D].Ns;var Vi=h[D].tg,Ei=h[D].OA,Ki=h[D].Lm,bi=h[D].Al,uo=h[D].VH;if(h[D].Ei==2){if(Le||(hi=V,te=Vi,ai=Ei,he=Ki,ue=bi,xe=uo,Y=2,g!=null?k=new f.Ta:it=0,xt=!1,qe=!0),Ei=h[D].UH,uo=h[D].OT,g!=null?(Pr.ah(Ri,h[D].UH,I),k.oc(I.get(),qe)):it++,Ri=Ei,Le=!0,qe=be=!1,D+1==h.length||h[D+1].Ei!=2||h[D+1].tg==Vi&&h[D+1].OA!=Ri){if(g!=null){var Zi=new x(k,2,V,Vi,Ei,Y,hi,te,ai,Ki,bi);g.push(Zi)}else null.add(it);hi=V,te=Vi,ai=Ei,he=Ki,ue=bi,xe=uo,Y=2,Le=be=!1,qe=xt=!0}}else{var Es=m.U(Vi);if(D<h.length-1&&h[D+1].tg==Es&&h[D+1].Al==bi&&h[D+1].Ei==2)Ei!=Ri&&(xt&&(g!=null?k=new f.Ta:it=0),be=0<D&&h[D-1].Ns==V?Y==1?0:Y==0?1:3:3,g!=null?(Pr.ah(Ri,Ei,I),k.oc(I.get(),qe),Zi=new x(k,be,V,Vi,Ei,Y,hi,te,ai,Ki,bi),g.push(Zi)):(it++,null.add(it)),Ri=Ei,hi=V,te=Vi,ai=Ei,he=Ki,ue=bi,xe=uo,Y=be,be=Xe=!1,qe=xt=!0);else if(!o.CM(l,m,h,D,w,E)){o.zM(m,h,D,J,yt,A,M);var Er=!1;if(Es=!1,Zi=!0,!(w.qb(A)||E.qb(A)||w.qb(M)||E.qb(M))){v[0].L(w),v[1].L(E),v[2].L(A),v[3].L(M),v.sort(f.h.nu);var th=v[0],Qc=v[1],J0=v[2],Io=v[3];th.qb(w)?Qc.qb(E)?l?(Es=Er=!0,Zi=!1):Er=!1:Io.qb(E)?l?Zi=Es=Er=!0:Er=!1:(Er=!0,Zi=Qc.qb(A)):Qc.qb(w)?J0.qb(E)?l?(Es=Er=!0,Zi=!1):Er=!1:th.qb(E)?l?Zi=Es=Er=!0:Er=!1:(Er=!0,Zi=J0.qb(A)):J0.qb(w)?Io.qb(E)?l?(Es=Er=!0,Zi=!1):Er=!1:Qc.qb(E)?l?Zi=Es=Er=!0:Er=!1:(Er=!0,Zi=Io.qb(A)):th.qb(E)?l?(Es=Er=!0,Zi=!1):Er=!1:J0.qb(E)?l?Zi=Es=Er=!0:Er=!1:(Er=!0,Zi=th.qb(A))}Er&&(Er=yt==Vi,(Ei!=Ri||Er&&Ri==0)&&(xt&&(g!=null?k=new f.Ta:it=0),g!=null?(Pr.ah(Ri,Ei,I),k.oc(I.get(),qe)):it++),Zi?Y!=1?((Ei!=Ri||Er&&Ri==0)&&(g!=null?(Zi=new x(k,1,V,Vi,Ei,Y,hi,te,ai,Ki,bi),g.push(Zi)):null.add(it)),Es?(D>=h.length-2||h[D+2].Ns!=V)&&(Y=0):Y=1):((Ei!=Ri||Er&&Ri==0)&&(g!=null?(Zi=new x(k,3,V,Vi,Ei,Y,hi,te,ai,Ki,bi),g.push(Zi)):null.add(it)),Y=1):Y!=0?((Ei!=Ri||Er&&Ri==0)&&(g!=null?(Zi=new x(k,0,V,Vi,Ei,Y,hi,te,ai,Ki,bi),g.push(Zi)):null.add(it)),Es?(D>=h.length-2||h[D+2].Ns!=V)&&(Y=1):Y=0):((Ei!=Ri||Er&&Ri==0)&&(g!=null?(Zi=new x(k,3,V,Vi,Ei,Y,hi,te,ai,Ki,bi),g.push(Zi)):null.add(it)),Y=0),(Ei!=Ri||Er&&Ri==0)&&(Ri=Ei,hi=V,te=Vi,ai=Ei,he=Ki,ue=bi,xe=uo,be=Xe=!1,qe=xt=!0))}}D++}Ri!=1&&(xt&&(g!=null?k=new f.Ta:it=0),g!=null?(Pr.ah(Ri,1,I),k.oc(I.get(),qe)):it++,qe=xt=!1,Xe=!0)}Xe&&(Ei=1,Vi=m.rj(J),Vi=m.Ma(Vi),bi=Ki=-1,uo=NaN,be?g!=null?(Zi=new x(k,4,V,Vi,Ei,Y,hi,te,ai,Ki,bi),g.push(Zi)):null.add(it):(be=Y==1?0:Y==0?1:3,g!=null?(Zi=new x(k,be,V,Vi,Ei,Y,hi,te,ai,Ki,bi),g.push(Zi)):null.add(it)))}},o.CM=function(l,h,m,g,v,w){var E=m[g].VH;if(E==1)return o.AM(l,h,m,g,v,w);if(E==0)return o.BM(l,h,m,g,v,w);throw f.i.Qa()},o.AM=function(l,h,m,g,v,w){var E=new f.yb,A=m[g].tg,M=m[g].Lm,I=m[g].Al,D=-1,k=-1,B=-1,J=-1;if(!l&&0<g){var Y=m[g-1];D=Y.tg,k=Y.Lm,B=Y.Al,J=Y.Ei}var V=-1,te=-1,he=-1,ue=-1;g<m.length-1&&(V=(Y=m[g+1]).tg,te=Y.Lm,he=Y.Al,ue=Y.Ei);var xe=h.U(A);return Y=h.U(I),l?g==m.length-1||V!=A||te!=M||he!=Y||ue==2?((l=h.bc(I))==null&&(h.ed(I,E),l=E),w.L(l.kg()),v.mt(w),w.normalize(),v.normalize(),!1):((l=h.bc(I))==null&&(h.ed(I,E),l=E),v.L(l.kg()),(l=h.bc(Y))==null&&(h.ed(Y,E),l=E),w.L(l.kg()),v.Sq(),w.normalize(),v.normalize(),!1):0<g&&D==A&&k==M&&B==Y&&J==2||g<m.length-1&&V==xe&&te==M&&he==Y&&ue==2?((l=h.bc(I))==null&&(h.ed(I,E),l=E),w.L(l.kg()),v.mt(w),w.normalize(),v.normalize(),!1):!(g<m.length-1&&V==A&&te==M&&he==Y)||((l=h.bc(I))==null&&(h.ed(I,E),l=E),v.L(l.kg()),(l=h.bc(Y))==null&&(h.ed(Y,E),l=E),w.L(l.kg()),v.Sq(),w.normalize(),v.normalize(),!1)},o.BM=function(l,h,m,g,v,w){var E=new f.yb,A=m[g].tg,M=m[g].Lm,I=m[g].Al,D=-1,k=-1,B=-1,J=-1;if(!l&&g<m.length-1){var Y=m[g+1];D=Y.tg,k=Y.Lm,B=Y.Al,J=Y.Ei}var V=-1,te=-1,he=-1;Y=-1,0<g&&(V=(Y=m[g-1]).tg,te=Y.Lm,he=Y.Al,Y=Y.Ei);var ue=h.U(A),xe=h.Ma(I);return l?g!=0&&V==A&&te==M&&he==xe&&Y!=2||((l=h.bc(I))==null&&(h.ed(I,E),l=E),w.L(l.kg()),v.mt(w),w.normalize(),v.normalize(),!1):!(0<g&&V==A&&te==M&&he==xe&&Y==2||g<m.length-1&&D==ue&&k==M&&B==xe&&J==2)||((l=h.bc(I))==null&&(h.ed(I,E),l=E),w.L(l.kg()),v.mt(w),w.normalize(),v.normalize(),!1)},o.zM=function(l,h,m,g,v,w,E){var A=new f.yb,M=l.bc(v);if(M==null&&(l.ed(v,A),M=A),h=(m=h[m]).tg,m=m.OA,v=l.U(h),m==1)w.L(M.kg()),v!=-1&&v!=l.rj(g)?((M=l.bc(v))==null&&(l.ed(v,A),M=A),E.L(M.kg()),(M=l.bc(h))==null&&l.ed(h,A)):E.L(w),w.Sq(),E.normalize(),w.normalize();else{if(m!=0)throw f.i.Qa();E.L(M.kg()),w.mt(E),E.normalize(),w.normalize()}},o}()}(Q||(Q={})),function(f){var L;(L=f.bM||(f.bM={}))[L.Linear=0]="Linear",L[L.Angular=1]="Angular",L[L.Area=2]="Area";var x=function(){function g(v,w,E){this.od=w,this.ai=E,this.vA=v}return g.prototype.Nb=function(v){return v instanceof g&&this.ai===v.ai},g.aG=function(v){return v.od!==0?null:v.vA===-1?new g(-1,2,v.ai*v.ai):g.Zg(h[v.vA])},g.Zg=function(v){return(v=l[v])===void 0?null:v},g.ZO=function(v,w,E){var A=null;if(E!=null)try{E.values[0]==="EPSG"&&(A=g.Zg(parseInt(E.values[1])))}catch{}return A===null&&(A=new g(-1,v,w)),A},g.prototype.Ec=function(){return this.vA},g.prototype.CF=function(v){if(v.od!=this.od)throw f.i.Hb();return this.ai/v.ai},g.Nh=function(v,w,E){return w.CF(E)*v},g.XE=function(v,w,E,A,M){for(E=E.CF(A),A=0;A<w;A++)M[A]=v[A]*E},g}();f.Tc=x;for(var d=[109401,1e4,109402,4046.8564224,109403,4046.87260987425,109404,1,109405,.09290304,109406,.09290341161327487,109407,.09290137299531805,109408,3.34450944,109409,3429904,109410,1.000027193184865,109411,404.6872609874253,109412,.04046872609874253,109413,2.5899984703195216e6,109414,1e6,109415,.8361123569578626,109416,404.67838076760535,109417,.04046783807676053,109418,.8361244606523066,109419,.09290271785025629,109420,404.68423895571647,109421,.04046842389557164,109422,.83612589696064,109423,.0929028774400711,109424,404.6849341289498,109425,.04046849341289498,109426,.836125904805842,109427,.09290287831176021,109428,404.68493792602754,109429,.04046849379260275,109430,.09290354800069446,109431,.09290274144751023,109432,.09290207073852812,109433,.09290279616016,109434,.09290273520025,109435,.836124673027592,109436,.836118636646753,109437,.8361251654414399,109438,.83612461680225,109439,2589988110336e-6,109440,.09290286332673177,109441,.09290349665192114,109442,.83612736,109443,.8361307045194736,109444,404.68564224000005,109445,.04046856422400001,109446,.8361237024040001,109447,.0929026336004445,109448,404.683871963536,109449,.0404683871963536,109450,.01,109451,1e-4,109452,1e-6,109453,64516e-8,109454,.0006451625806477421,109455,25.292852640000003,109456,25.29295381171408,109457,3.4345281495040003e6,109458,3434290937856e-6,109459,2.89612324,109460,25e8,109461,225e8,109462,.7168473118308245,109463,100,109464,1244521604938272e-22,109465,1e-12,109466,1e-18],c=[1031,484813681109536e-23,9101,1,9102,.0174532925199433,9103,.0002908882086657216,9104,484813681109536e-20,9105,.01570796326794897,9106,.01570796326794897,9109,1e-6,9112,.0001570796326794897,9113,1570796326794897e-21,9114,.0009817477042468104],o=[1025,.001,109452,1033,.01,109451,9001,1,109404,9002,.3048,109405,9003,.3048006096012192,109406,9005,.3047972654,109407,9014,1.8288,109408,9030,1852,109409,9031,1.0000135965,109410,9033,20.11684023368047,109411,9034,.2011684023368047,109412,9035,1609.3472186944375,109413,9036,1e3,109414,9037,.9143917962000001,109415,9038,20.1166195164,109416,9039,.201166195164,109417,9040,.9143984146160287,109418,9041,.304799471538676,109419,9042,20.116765121552632,109420,9043,.2011676512155263,109421,9050,.9143992,109422,9051,.3047997333333333,109423,9052,20.1167824,109424,9053,.201167824,109425,9060,.9143992042898124,109426,9061,.3047997347632708,109427,9062,20.116782494375872,109428,9063,.2011678249437587,109429,9070,.3048008333333334,109430,9080,.3047995102481469,109431,9081,.30479841,109432,9082,.3047996,109433,9083,.3047995,109434,9084,.9143985307444408,109435,9085,.91439523,109436,9086,.9143988,109437,9087,.9143985,109438,9093,1609.344,109439,9094,.3047997101815088,109440,9095,.3048007491,109441,9096,.9144,109442,9097,20.1168,109444,9098,.201168,109445,9099,.914398,109446,9300,.3047993333333334,109447,9301,20.116756,109448,9302,.20116756,109449,109001,.9144,109442,109002,.9144018288036576,109443,109003,20.1168,109444,109004,.201168,109445,109005,.1,109450,109006,.01,109451,109007,.001,109452,109008,.0254,109453,109009,.0254000508001016,109454,109010,5.0292,109455,109011,5.029210058420118,109456,109012,1853.248,109457,109013,1853.184,109458,109014,1.7018,109459,109015,.8466683600033867,109462,109016,.0003527777777777778,109464,109017,1e-6,109465,109018,1e-9,109466,109030,5e4,109460,109031,15e4,109461],l=[],h=[],m=0;m<d.length;m+=2)l[d[m]]=new x(d[m],2,d[m+1]);for(d=null,m=0;m<c.length;m+=2)l[c[m]]=new x(c[m],1,c[m+1]);for(c=null,m=0;m<o.length;m+=3)l[o[m]]=new x(o[m],0,o[m+1]),h[o[m]]=o[m+2];o=null}(Q||(Q={})),function(f){var L=function(){function x(){this.xb=this.pb=0}return x.prototype.set=function(d,c){c!==void 0?(this.pb=d,this.xb=c):typeof d=="number"?(this.pb=d,this.xb=0):(this.pb=d.pb,this.xb=d.xb)},x.prototype.value=function(){return this.pb},x.prototype.add=function(d){var c=this.pb+d.pb;d=this.xb+d.xb+2220446049250313e-31*Math.abs(c),this.pb=c,this.xb=d},x.prototype.kN=function(){var d=this.pb+1,c=this.xb+2220446049250313e-31*Math.abs(d);this.pb=d,this.xb=c},x.prototype.dN=function(d,c){this.pb=d.pb+c.pb,this.xb=d.xb+c.xb+2220446049250313e-31*Math.abs(this.pb)},x.prototype.sub=function(d){if(typeof d=="number"){var c=this.pb-d;d=this.xb+2220446049250313e-31*Math.abs(c)}else c=this.pb-d.pb,d=this.xb+d.xb+2220446049250313e-31*Math.abs(c);this.pb=c,this.xb=d},x.prototype.Ag=function(d){var c=this.pb*d.pb;this.xb=this.xb*Math.abs(d.pb)+d.xb*Math.abs(this.pb)+this.xb*d.xb+2220446049250313e-31*Math.abs(c),this.pb=c},x.prototype.No=function(d){var c=this.pb*d;this.xb=this.xb*Math.abs(d)+2220446049250313e-31*Math.abs(c),this.pb=c},x.prototype.Kl=function(d,c){var o=Math.abs(d.pb)*Math.abs(c.pb);this.xb=d.xb*Math.abs(c.pb)+c.xb*Math.abs(d.pb)+d.xb*c.xb+2220446049250313e-31*Math.abs(o),this.pb=o},x.prototype.jm=function(d){var c=Math.abs(d.pb),o=this.pb/d.pb,l=(this.xb+Math.abs(o)*d.xb)/c;d.xb>.01*c&&(l*=1+(1+(d=d.xb/c))*d),this.pb=o,this.xb=l+2220446049250313e-31*Math.abs(o)},x.prototype.sqrt=function(){if(0<=this.pb){var d=Math.sqrt(this.pb),c=this.pb>10*this.xb?.5*this.xb/d:this.pb>this.xb?d-Math.sqrt(this.pb-this.xb):Math.max(d,Math.sqrt(this.pb+this.xb)-d);c+=2220446049250313e-31*Math.abs(d)}else this.pb<-1*this.xb?c=d=NaN:(d=0,c=Math.sqrt(this.xb));this.pb=d,this.xb=c},x.prototype.sin=function(d){var c=Math.sin(d.pb),o=Math.cos(d.pb);this.pb=c,c=Math.abs(c),this.xb=(Math.abs(o)+.5*c*d.xb)*d.xb+2220446049250313e-31*c},x.prototype.cos=function(d){var c=Math.sin(d.pb),o=Math.cos(d.pb);this.pb=o,o=Math.abs(o),this.xb=(Math.abs(c)+.5*o*d.xb)*d.xb+2220446049250313e-31*o},x.prototype.qg=function(){return Math.abs(this.pb)<=this.xb},x.prototype.ps=function(){return this.qg()&&this.xb!=0},x}();f.Wb=L}(Q||(Q={}));var ci=new Q.h,Ot=new Q.h,It=new Q.h,Rt=new Q.h,pi=new Q.h;(function(f){var L,x;(x=L||(L={}))[x.closedPath=1]="closedPath",x[x.exteriorPath=2]="exteriorPath",x[x.ringAreaValid=4]="ringAreaValid";var d=function(){function c(o,l,h,m,g,v,w){l!==void 0?(this.ib=o,this.ck=l,this.bl=h,this.ii=m,this.ya=v,this.hA=w,this.ew=g):(this.ib=o.ib,this.ck=o.ck,this.bl=o.bl,this.ii=o.ii,this.ya=o.ya,this.hA=o.hA,this.ew=o.ew),this.bH=!0}return c.prototype.next=function(){return this.bH?(this.bH=!1,this.ii):this.ii!=-1?(this.ii=this.ib.U(this.ii),this.ya++,this.ii!=-1&&this.ii!=this.ew?this.ii:this.$T()):-1},c.prototype.$T=function(){for(this.bl=this.ib.Rb(this.bl),this.ya=0;this.ck!=-1;){for(;this.bl!=-1;this.bl=this.ib.Rb(this.bl))if(this.ew=this.ii=this.ib.Xa(this.bl),this.ii!=-1)return this.ii;if(this.ck=this.ib.ue(this.ck),this.ck==-1)break;this.hA&&!f.aa.Hc(this.ib.ic(this.ck))||(this.bl=this.ib.Ob(this.ck))}return-1},c.AP=function(o,l,h,m,g,v,w){return new c(o,l,h,m,g,v,w)},c}();f.zY=d,L=function(){function c(){this.jo=this.Am=this.wk=this.cd=this.Ck=this.vo=this.Oi=this.md=this.bi=this.Sg=this.We=this.Il=null,this.qw=this.ld=-1,this.fd=0,this.fA=!1,this.ht=this.it=this.vb=null}return c.prototype.Sh=function(o){return this.We!=null?this.We[o]:null},c.prototype.Xg=function(o,l){if(this.We==null){if(l==null)return;this.We=[];for(var h=0,m=this.vb.I();h<m;h++)this.We.push(null)}this.We[o]=l},c.prototype.bp=function(o,l){this.md.S(o,1,l)},c.prototype.ap=function(o,l){this.md.S(o,2,l)},c.prototype.VB=function(o,l){this.md.S(o,6,l)},c.prototype.Sp=function(o){return this.md.T(o,6)},c.prototype.gx=function(o,l){this.md.S(o,7,l)},c.prototype.qv=function(o){return this.md.T(o,0)},c.prototype.OJ=function(o,l){this.cd.S(o,1,l)},c.prototype.SJ=function(o,l){this.cd.S(o,0,l)},c.prototype.JF=function(o){return this.cd.T(o,7)},c.prototype.Zo=function(o,l){this.cd.S(o,3,l)},c.prototype.$o=function(o,l){this.cd.S(o,4,l)},c.prototype.uU=function(o){this.cd==null&&(this.cd=new f.$c(8));var l=this.cd.Ce();return this.cd.S(l,2,o),this.cd.S(l,5,0),this.cd.S(l,6,0),this.cd.S(l,7,l),l},c.prototype.OQ=function(o){this.cd.jd(o)},c.prototype.wU=function(o){this.md==null&&(this.md=new f.$c(8),this.td=new f.$c(5),this.Oi=new f.be(0),this.vo=new f.be(0));var l=this.md.Ce();return this.md.S(l,0,l),this.md.S(l,3,0),this.md.S(l,6,0),this.gx(l,o),l>=this.Oi.size&&(o=16>l?16:f.O.truncate(3*l/2),this.Oi.resize(o),this.vo.resize(o)),this.Oi.set(l,0),this.vo.set(l,0),l},c.prototype.sF=function(o){this.md.jd(o)},c.prototype.Vy=function(o){this.td.jd(o),this.fd--},c.prototype.oI=function(o){this.md==null&&(this.md=new f.$c(8),this.td=new f.$c(5),this.Oi=new f.be(0),this.vo=new f.be(0));var l=this.td.Ce(),h=0<=o?o:l;if(this.td.S(l,0,h),0>o){if(h>=this.vb.I()){if(o=16>h?16:f.O.truncate(3*h/2),this.vb.resize(o),this.We!=null)for(var m=0;m<o;m++)this.We.push(null);this.Sg!=null&&this.Sg.resize(o),this.it=this.vb.ub(0)}this.vb.Cb(h,-1e38,-1e38),this.We!=null&&(this.We[h]=null),this.Sg!=null&&this.Sg.write(h,1)}return this.td.S(l,4,2*h),this.fd++,l},c.prototype.wj=function(o,l,h){var m=l!=-1?this.Ma(l):this.rj(o),g=m!=-1?this.U(m):-1,v=this.oI(h==null?this.fd:-1),w=this.Ua(v);return h!=null&&this.vb.Ht(w,h),this.aj(v,o),this.Bc(v,g),this.Cc(v,m),g!=-1&&this.Cc(g,v),m!=-1&&this.Bc(m,v),h=this.dc(o),m=this.Xa(o),l==-1&&this.Wg(o,v),l==m&&this.Jf(o,v),h&&g==-1&&(this.Bc(v,v),this.Cc(v,v)),this.Vj(o,this.Ja(o)+1),o=this.Qf(o),this.Tj(o,this.I(o)+1),v},c.prototype.nm=function(){return this.jo==null&&(this.jo=new f.Sa(this.vb.description)),this.jo},c.prototype.Yo=function(o,l){this.cd.S(o,2,-134217729&this.cd.T(o,2)||(l==1?134217728:0))},c.prototype.In=function(o){return 134217728&this.cd.T(o,2)?1:0},c.prototype.hN=function(o){var l=this.Ig(o.getType(),o.description);return o.getType()==1736&&this.Yo(l,o.In()),this.UD(l,o),l},c.prototype.iN=function(o){var l=this.Ig(o.getType(),o.description);return this.VD(l,o),l},c.prototype.XV=function(o,l){this.md==null&&(this.md=new f.$c(8),this.td=new f.$c(5),this.Oi=new f.be(0),this.vo=new f.be(0)),this.md.De(this.md.Hg+o),this.td.De(this.td.Hg+l),this.Oi.Jb(this.Oi.size+o),this.vo.Jb(this.vo.size+o)},c.prototype.UD=function(o,l){this.XV(l.da(),l.I()),this.Il.Fd(l,0,l.I()),this.it=this.vb.ub(0);for(var h=this.We!=null&&l.Ve!=null,m=0,g=l.da();m<g;m++)if(!(2>l.Ja(m))){var v=this.vf(o,-1);this.kn(v,l.dc(m));for(var w=l.Ba(m),E=l.Vc(m);w<E;w++){var A=this.wj(v,-1,null);if(h)if(A=this.Ua(A),(1&l.ZF(w))!=0)this.Xg(A,null);else{var M=new f.ig;l.bc(w,M,!0),this.Xg(A,M.get())}}}},c.prototype.VD=function(o,l){this.Il.Fd(l,0,l.I()),this.it=this.vb.ub(0),o=this.vf(o,-1);var h=0;for(l=l.I();h<l;h++)this.wj(o,-1,null)},c.prototype.NX=function(o,l,h){var m=this.U(o);if(m==-1)throw f.i.Qa();for(var g=this.nm(),v=this.bd(o),w=0,E=l.ol(h);w<E;w++){var A=this.Ua(o),M=this.U(o),I=l.Vp(h,w);w==0&&(I.To(g),this.Dh(o,g)),I.getType()==322?this.Xg(A,null):this.Xg(A,f.aa.jg(I)),I.Po(g),w<E-1?o=this.wj(v,M,g):this.Dh(m,g)}},c.prototype.MX=function(o,l,h){var m=this.U(o);if(m==-1)throw f.i.Qa();for(var g=this.nm(),v=this.bd(o),w=0,E=l.ol(h);w<E;w++){var A=this.Ua(o),M=this.U(o),I=l.Vp(h,E-w-1);w==0&&(I.Po(g),this.Dh(o,g)),I.getType()==322?this.Xg(A,null):this.Xg(A,f.aa.jg(I)),I.To(g),w<E-1?o=this.wj(v,M,g):this.Dh(m,g)}},c.prototype.IF=function(){var o=new f.l;o.Oa();for(var l=this.Yq(),h=new f.h,m=!0,g=l.next();g!=-1;g=l.next())this.D(g,h),m?o.Zb(h.x,h.y):o.Lk(h.x,h.y),m=!1;return o},c.prototype.Ib=function(o){var l=o.getType();if(f.aa.Hc(l))return this.hN(o);if(l==550)return this.iN(o);throw f.i.Qa()},c.prototype.uN=function(o,l){var h=l.getType();if(f.aa.Hc(h))this.UD(o,l);else{if(h!=550)throw f.i.Qa();this.VD(o,l)}},c.prototype.mN=function(o,l){var h=this.Ig(1736,o.description);if(2>o.Ja(l))return h;this.Il.Fd(o,o.Ba(l),o.Vc(l)),this.it=this.vb.ub(0);var m=this.vf(h,-1);this.kn(m,o.dc(l)||!0);var g=this.We!=null&&o.Ve!=null,v=o.Ba(l);for(l=o.Vc(l);v<l;v++){var w=this.wj(m,-1,null);if(g)if(w=this.Ua(w),(1&o.ZF(v))!=0)this.Xg(w,null);else{var E=new f.ig;o.bc(v,E,!0),this.Xg(w,E.get())}}return h},c.prototype.Ne=function(o){var l=this.ic(o),h=f.ZK.Ig(l,this.Il.description),m=this.I(o);if(m==0)return h;if(f.aa.Hc(l)){l=this.da(o);for(var g=f.Yc.Oh(l+1),v=f.Yc.Mr(l+1,0),w=h.description,E=0,A=w.Aa;E<A;E++){for(var M=w.kd(E),I=f.ra.Va(M),D=f.Yc.YE(M,m),k=this.vb.ub(M),B=0,J=0,Y=0,V=this.Ob(o);V!=-1;V=this.Rb(V)){var te=0;this.dc(V)&&(te|=1),this.YS(V)&&(te|=4),te!=0&&v.zJ(J,te);var he=this.Ja(V);if(g.write(J++,Y),Y+=he,M==0){he=k;var ue=D,xe=new f.h;for(te=this.Xa(V);B<Y;te=this.U(te),B++){var be=this.Ua(te);he.tc(2*be,xe),ue.Tt(2*B,xe)}}else for(te=this.Xa(V);B<Y;te=this.U(te),B++)for(be=this.Ua(te),ue=0;ue<I;ue++)xe=k.eg(be*I+ue),D.pr(B*I+ue,xe)}h.hn(M,D),g.write(l,m)}h.PJ(v),h.QJ(g),h.Pc(16777215)}else if(l==550){for(w=h.description,h.resize(m),E=0,A=w.Aa;E<A;E++){for(M=w.kd(E),I=f.ra.Va(M),D=h.ub(M),k=this.vb.ub(M),B=0,V=this.Ob(o),he=this.Ja(V),te=this.Xa(V);B<he;te=this.U(te),B++)for(be=this.Ua(te),ue=0;ue<I;ue++)xe=k.eg(be*I+ue),D.pr(B*I+ue,xe);h.hn(M,D)}h.Pc(16777215)}return h},c.prototype.BB=function(o){for(var l=this.Ob(o);l!=-1;l=this.Zq(l));l=this.PR(o);var h=this.ue(o);l!=-1?this.OJ(l,h):this.ld=h,h!=-1?this.SJ(h,l):this.qw=l,this.OQ(o)},c.prototype.Ig=function(o,l){return l===void 0?this.$E(o,f.ee.og()):this.$E(o,l)},c.prototype.$E=function(o,l){return o=this.uU(o),this.vb==null?this.vb=this.Il=new f.de(l):this.Il.Jl(l),this.ht=this.Il.description,this.fA=1<this.ht.Aa,this.ld==-1?this.ld=o:(this.SJ(o,this.qw),this.OJ(this.qw,o)),this.qw=o},c.prototype.ue=function(o){return this.cd.T(o,1)},c.prototype.PR=function(o){return this.cd.T(o,0)},c.prototype.ic=function(o){return 2147483647&this.cd.T(o,2)},c.prototype.HJ=function(o,l,h){l=this.wk[l],(o=this.JF(o))>=l.size&&l.resize(Math.max(f.O.truncate(1.25*o),16),-1),l.write(o,h)},c.prototype.KF=function(o,l){return(o=this.JF(o))<(l=this.wk[l]).size?l.read(o):-1},c.prototype.aF=function(){this.wk==null&&(this.wk=[]);for(var o=0;o<this.wk.length;o++)if(this.wk[o]==null)return this.wk[o]=f.Yc.Oh(0),o;return this.wk.push(f.Yc.Oh(0)),this.wk.length-1},c.prototype.xW=function(o){this.wk[o]=null},c.prototype.Ob=function(o){return this.cd.T(o,3)},c.prototype.kv=function(o){return this.cd.T(o,4)},c.prototype.I=function(o){return this.cd.T(o,5)},c.prototype.da=function(o){return this.cd.T(o,6)},c.prototype.Gp=function(o,l,h){for(var m=0,g=this.ld;g!=-1;g=this.ue(g)){var v=this.ic(g);if(f.aa.Hc(v)&&(!h||v==1736)){v=this.ic(g)==1736;for(var w=this.Ob(g);w!=-1;){for(var E=0,A=this.Xa(w);E<f.O.truncate(this.Ja(w)/2);){var M=this.U(A);if(M==-1)break;var I=this.Ua(A),D=this.Sh(I);D!=null?I=D.Qb():(D=this.Ua(M),I=this.vb.yr(I,D)),I<=o?(I==0?m==0&&(m=-1):m=1,M!=this.rj(w)&&(this.lC(M,A),this.pd(M,!0))):A=this.U(A),E++}for(E=this.Xa(w),A=this.dc(w)?E:this.rj(w);0<this.Ja(w);){if((M=this.Ma(A))==-1){this.pd(A,!0),m==0&&(m=-1);break}var k=this.Ua(M);if((D=this.Sh(k))!=null?I=D.Qb():(I=this.Ua(A),I=this.vb.yr(I,k)),I<=o)I==0?m==0&&(m=-1):m=1,this.lC(M,A),this.pd(M,!1),E==M&&(E=this.Xa(w));else if((A=this.Ma(A))==E)break}A=this.Ja(w),l&&(v?3>A:2>A)?(w=this.Zq(w),m=0<A?1:m==0?-1:m):w=this.Rb(w)}}}return m},c.prototype.lC=function(o,l){var h=this.Ua(o),m=this.Ua(l);if(this.Sg!=null&&(h=this.Sg.read(h),this.Sg.write(m,h)),this.bi!=null){for(m=0,h=this.bi.length;m<h;m++)if(this.bi[m]!=null){var g=this.Pa(o,m);g!=-1&&this.Ra(l,m,g)}}},c.prototype.Ul=function(o,l,h){var m=0,g=this.U(o);if(g==-1)throw f.i.Qa();for(var v=this.Ua(o),w=this.Ua(g),E=this.Sh(v),A=E==null?this.vb.yr(v,w):E.Qb(),M=0;M<h;M++){var I=l[M];if(0<I&&1>I){var D=I;E!=null&&(D=0<A?E.Ux(I)/A:0),this.vb.kD(v,w,D,this.nm());var k=this.wj(this.bd(o),g,this.nm());if(m++,E!=null){var B=E.dl(0,I);D=this.Ua(this.Ma(k)),this.Xg(D,B),this.mf(k,B.wc()),M!=h-1&&l[M+1]!=1||(I=E.dl(I,1),this.Xg(D,I))}}}return m},c.prototype.LX=function(o,l,h){var m=0,g=this.U(o);if(g==-1)throw f.i.fa("internal error");var v=this.Ua(o),w=this.Ua(g),E=this.Sh(v),A=E==null?this.vb.yr(v,w):E.Qb(),M=0;o=this.bd(o);for(var I=0;I<h;I++){var D=l[I];if(M<D&&1>D){var k=D;if(E!=null&&(k=0<A?E.Ux(D)/A:0),this.vb.kD(v,w,k,this.nm()),k=this.yS(o,g,this.nm()),m++,E!=null){M=E.dl(M,D);var B=this.Ua(this.Ma(k));this.Xg(B,M),this.Cb(k,M.pa,M.la),I!=h-1&&l[I+1]!=1||(M=E.dl(D,1),k=this.Ua(k),this.Xg(k,M))}}M=D}return m},c.prototype.yS=function(o,l,h){var m=l!=-1?this.Ma(l):this.rj(o),g=m!=-1?this.U(m):-1,v=this.oI(h==null?this.fd:-1),w=this.Ua(v);return h!=null&&this.vb.Ht(w,h),this.aj(v,o),this.Bc(v,g),this.Cc(v,m),g!=-1&&this.Cc(g,v),m!=-1&&this.Bc(m,v),h=this.dc(o),m=this.Xa(o),l==-1&&this.Wg(o,v),l==m&&(h&&m!=-1||this.Jf(o,v)),h&&g==-1&&(this.Bc(v,v),this.Cc(v,v)),this.Vj(o,this.Ja(o)+1),o=this.Qf(o),this.Tj(o,this.I(o)+1),v},c.prototype.uE=function(o,l,h){var m=this.Ua(l),g=this.Ua(h);if(0>m||g>this.fd-1)throw f.i.N("invalid call");if(m>g&&!this.dc(o))throw f.i.N("cannot iterate across an open path");for(o=0;l!=h;l=this.U(l))m=this.Ua(l),(g=this.Sh(m))!=null?o+=g.Qb():(g=this.Ua(this.U(l)),o+=this.vb.yr(m,g));return o},c.prototype.Dh=function(o,l){var h=this.Ua(o);this.vb.Ht(h,l),(h=this.Sh(h))!=null&&h.setStart(l),(o=this.Ma(o))!=-1&&(o=this.Ua(o),this.Sh(o)!=null&&h.setEnd(l))},c.prototype.Vi=function(o,l){o=this.Ua(o),this.vb.ve(o,l)},c.prototype.mf=function(o,l){this.Cb(o,l.x,l.y)},c.prototype.Cb=function(o,l,h){var m=this.Ua(o);this.vb.Cb(m,l,h),(m=this.Sh(m))!=null&&m.ZB(l,h),(o=this.Ma(o))!=-1&&(o=this.Ua(o),this.Sh(o)!=null&&m.Ql(l,h))},c.prototype.D=function(o,l){this.vb.D(this.td.T(o,0),l)},c.prototype.Gc=function(o,l){this.vb.za[0].tc(2*this.td.T(o,0),l)},c.prototype.Na=function(o){var l=new f.h;return this.vb.D(this.td.T(o,0),l),l},c.prototype.dG=function(o,l){this.it.tc(2*o,l)},c.prototype.Uc=function(o,l,h){return this.vb.Uc(o,this.Ua(l),h)},c.prototype.setAttribute=function(o,l,h,m){this.vb.setAttribute(o,this.Ua(l),h,m)},c.prototype.Ua=function(o){return this.td.T(o,0)},c.prototype.ih=function(){var o=new f.h;return this.D(void 0,o),o.y},c.prototype.fq=function(o,l){o=this.Ua(o),l=this.Ua(l);var h=this.vb.za[0].o;return h[2*o]===h[2*l]&&h[2*o+1]===h[2*l+1]},c.prototype.Dv=function(o,l){o=this.Ua(o);var h=this.vb.za[0].o;return h[2*o]===l.x&&h[2*o+1]===l.y},c.prototype.vX=function(o,l){if(1>l&&(l=1),this.Sg==null){if(l==1)return;this.Sg=f.Yc.Dn(this.vb.I(),1)}(o=this.Ua(o))>=this.Sg.size&&this.Sg.resize(o+1,1),this.Sg.write(o,l)},c.prototype.cG=function(o){return o=this.Ua(o),this.Sg==null||o>=this.Sg.size?1:this.Sg.read(o)},c.prototype.Ra=function(o,l,h){l=this.bi[l],o=this.Ua(o),l.size<this.vb.I()&&l.resize(this.vb.I(),-1),l.write(o,h)},c.prototype.Pa=function(o,l){return(o=this.Ua(o))<(l=this.bi[l]).size?l.read(o):-1},c.prototype.Gd=function(){this.bi==null&&(this.bi=[]);for(var o=0;o<this.bi.length;o++)if(this.bi[o]==null)return this.bi[o]=f.Yc.Oh(0,-1),o;return this.bi.push(f.Yc.Oh(0,-1)),this.bi.length-1},c.prototype.Td=function(o){this.bi[o]=null},c.prototype.bc=function(o){return this.We!=null?(o=this.Ua(o),this.We[o]):null},c.prototype.ed=function(o,l){var h=this.td.T(o,2);if(h==-1)return!1;if(this.fA){var m=new f.Sa;this.Vi(o,m),l.setStart(m),this.Vi(h,m),l.setEnd(m)}else this.vb.Gc(this.td.T(o,0),ci),l.em(0,ci),this.vb.Gc(this.td.T(h,0),ci),l.em(1,ci);return!0},c.prototype.mW=function(o,l,h){if(this.fA){var m=new f.Sa;this.Vi(o,m),h.setStart(m),this.Vi(l,m),h.setEnd(m)}else this.vb.Gc(o,ci),h.em(0,ci),this.vb.Gc(l,ci),h.em(1,ci)},c.prototype.vf=function(o,l){if(l!=-1){if(o!=this.Qf(l))throw f.i.Qa();var h=this.cs(l)}else h=this.kv(o);var m=this.wU(o);return l!=-1&&this.bp(l,m),this.ap(m,l),this.bp(m,h),h!=-1?this.ap(h,m):this.Zo(o,m),l==-1&&this.$o(o,m),this.Rl(o,this.da(o)+1),m},c.prototype.nG=function(o,l,h,m){o=this.vf(o,-1);for(var g=0,v=l,w=!1;v==h&&(w=!0),this.aj(v,o),g++,(v=this.U(v))!=l;);return this.kn(o,!0),this.Vj(o,g),w&&(l=h),this.Jf(o,l),this.Wg(o,this.Ma(l)),this.cp(o,!1),m!=null&&(m[0]=w),o},c.prototype.Zq=function(o){var l=this.cs(o),h=this.Rb(o),m=this.Qf(o);return l!=-1?this.ap(l,h):this.Zo(m,h),h!=-1?this.bp(h,l):this.$o(m,l),this.AO(o),this.Rl(m,this.da(m)-1),this.sF(o),h},c.prototype.AO=function(o){var l=this.Xa(o);if(l!=-1){for(var h=0,m=this.Ja(o);h<m;h++){var g=l;l=this.U(l),this.Vy(g)}l=this.Qf(o),this.Tj(l,this.I(l)-this.Ja(o))}this.Vj(o,0)},c.prototype.Rb=function(o){return this.md.T(o,2)},c.prototype.cs=function(o){return this.md.T(o,1)},c.prototype.Ja=function(o){return this.md.T(o,3)},c.prototype.dc=function(o){return(1&this.Sp(o))!=0},c.prototype.kn=function(o,l){if(this.dc(o)!=l){if(0<this.Ja(o)){var h=this.Xa(o),m=this.rj(o);l?(this.Bc(m,h),this.Cc(h,m),h=this.Ua(m)):(this.Bc(m,-1),this.Cc(h,-1),h=this.Ua(m)),this.Xg(h,null)}this.VB(o,(1|this.Sp(o))-1|(l?1:0))}},c.prototype.Qf=function(o){return this.md.T(o,7)},c.prototype.YS=function(o){return(2&this.Sp(o))!=0},c.prototype.PB=function(o,l){this.VB(o,(2|this.Sp(o))-2|(l?2:0))},c.prototype.wz=function(o){if(this.cT(o))return this.Oi.get(this.qv(o));var l=new f.yb,h=this.Xa(o);if(h==-1)return 0;var m=new f.h;this.D(h,m);for(var g=0,v=0,w=this.Ja(o);v<w;v++,h=this.U(h)){var E=this.bc(h);if(E==null){if(!this.ed(h,l))continue;E=l}g+=E.Tx(m.x,m.y)}return this.cp(o,!0),this.Oi.set(this.qv(o),g),g},c.prototype.gr=function(o,l,h){l=this.Ck[l],o=this.qv(o),l.size<this.Oi.size&&l.resize(this.Oi.size,-1),l.write(o,h)},c.prototype.sj=function(o,l){return(o=this.qv(o))<(l=this.Ck[l]).size?l.read(o):-1},c.prototype.Ky=function(){this.Ck==null&&(this.Ck=[]);for(var o=0;o<this.Ck.length;o++)if(this.Ck[o]==null)return this.Ck[o]=f.Yc.Oh(0),o;return this.Ck.push(f.Yc.Oh(0)),this.Ck.length-1},c.prototype.CB=function(o){this.Ck[o]=null},c.prototype.ZT=function(o,l,h){if(h==-1)throw f.i.N();if(l!=h){var m=this.Rb(h),g=this.cs(h),v=this.Qf(h);g==-1?this.Zo(v,m):this.ap(g,m),m==-1?this.$o(v,g):this.bp(m,g),this.Tj(v,this.I(v)-this.Ja(h)),this.Rl(v,this.da(v)-1),g=l==-1?this.kv(o):this.cs(l),this.bp(h,g),this.ap(h,l),l==-1?this.$o(o,h):this.bp(l,h),g==-1?this.Zo(o,h):this.ap(g,h),this.Tj(o,this.I(o)+this.Ja(h)),this.Rl(o,this.da(o)+1),this.gx(h,o)}},c.prototype.ij=function(o,l){this.vb.ve(this.Ua(l),this.nm()),this.wj(o,-1,this.nm())},c.prototype.pd=function(o,l){var h=this.bd(o),m=this.Ma(o),g=this.U(o);m!=-1&&this.Bc(m,g);var v=this.Ja(h);if(o==this.Xa(h)&&this.Jf(h,1<v?g:-1),g!=-1&&this.Cc(g,m),o==this.rj(h)&&this.Wg(h,1<v?m:-1),m!=-1&&g!=-1){m=this.Ua(m);var w=this.Ua(g);l?(l=this.Sh(m))!=null&&(m=new f.h,this.vb.D(w,m),l.Qc(m)):(w=this.Ua(o),l=this.Sh(w),this.Xg(m,l),l!=null&&(m=this.vb.Na(m),l.Dc(m)))}return this.Vj(h,v-1),h=this.Qf(h),this.Tj(h,this.I(h)-1),this.Vy(o),g},c.prototype.Xa=function(o){return this.md.T(o,4)},c.prototype.rj=function(o){return this.md.T(o,5)},c.prototype.U=function(o){return this.td.T(o,2)},c.prototype.Ma=function(o){return this.td.T(o,1)},c.prototype.bd=function(o){return this.td.T(o,3)},c.prototype.fc=function(o,l){return this.wj(o,-1,l)},c.prototype.Yq=function(o){if(o===void 0)return this.Yq(!1);if(o instanceof d)return new d(o);var l,h=-1,m=-1,g=-1,v=0,w=!1;for(l=this.ld;l!=-1;l=this.ue(l))if(!o||f.aa.Hc(this.ic(l))){for(h=this.Ob(l);h!=-1;h=this.Rb(h))if(g=m=this.Xa(h),v=0,m!=-1){w=!0;break}if(w)break}return d.AP(this,l,h,m,g,v,o)},c.prototype.Oc=function(o){if(this.Il.Oc(o),this.We!=null)for(var l=0,h=this.We.length;l<h;l++)this.We[l]!=null&&this.We[l].Oc(o)},c.prototype.jr=function(o,l,h,m){m?this.NX(o,l,h):this.MX(o,l,h)},c.prototype.Cc=function(o,l){this.td.S(o,1,l)},c.prototype.Bc=function(o,l){this.td.S(o,2,l)},c.prototype.aj=function(o,l){this.td.S(o,3,l)},c.prototype.Vj=function(o,l){this.md.S(o,3,l)},c.prototype.Jf=function(o,l){this.md.S(o,4,l)},c.prototype.Wg=function(o,l){this.md.S(o,5,l)},c.prototype.Rl=function(o,l){this.cd.S(o,6,l)},c.prototype.Tj=function(o,l){this.cd.S(o,5,l)},c.prototype.pJ=function(o){var l=o;do{var h=this.U(l);this.Bc(l,this.Ma(l)),this.Cc(l,h),l=h}while(l!=o)},c.prototype.bC=function(o){this.fd=o},c.prototype.$q=function(o){var l=this.cs(o),h=this.Rb(o),m=this.Qf(o);l!=-1?this.ap(l,h):this.Zo(m,h),h!=-1?this.bp(h,l):this.$o(m,l),this.Jf(o,-1),this.Wg(o,-1),this.sF(o)},c.prototype.mi=function(o,l){var h=this.Ma(o),m=this.U(o);if(h!=-1&&this.Bc(h,m),m!=-1&&this.Cc(m,h),h!=-1&&m!=-1)if(h=this.Ua(h),m=this.Ua(m),l){if((l=this.Sh(h))!=null){var g=new f.h;this.vb.D(m,g),l.Qc(g)}}else l=this.Ua(o),l=this.Sh(l),this.Xg(h,l),l!=null&&(g=new f.h,this.vb.D(h,g),l.Dc(g));this.Vy(o)},c.prototype.cT=function(o){return(4&this.Sp(o))!=0},c.prototype.cp=function(o,l){this.VB(o,(4|this.Sp(o))-4|(l?4:0))},c.prototype.nx=function(o,l){var h=this.td.o;this.vb.mc();var m=this.vb.za[0].o;o.Vd(0,l,function(g,v){var w=h[5*g];g=h[5*v],v=m[2*w],w=m[2*w+1];var E=m[2*g];return w<(g=m[2*g+1])?-1:w>g?1:v<E?-1:v>E?1:0})},c.prototype.jS=function(){for(var o=this.ld;o!=-1;o=this.ue(o))if(!f.aa.Hc(this.ic(o)))return!0;return!1},c.prototype.hC=function(o,l){for(var h=this.Ob(o),m=this.Ob(l),g=this.kv(o),v=this.kv(l),w=this.Ob(o);w!=-1;w=this.Rb(w))this.gx(w,l);for(w=this.Ob(l);w!=-1;w=this.Rb(w))this.gx(w,o);this.Zo(o,m),this.Zo(l,h),this.$o(o,v),this.$o(l,g),h=this.I(o),m=this.da(o),g=this.da(l),this.Tj(o,this.I(l)),this.Tj(l,h),this.Rl(o,g),this.Rl(l,m),h=this.cd.T(o,2),this.cd.S(o,2,this.cd.T(l,2)),this.cd.S(l,2,h)},c}(),f.gd=L})(Q||(Q={})),function(f){var L=function(x){function d(c,o,l,h){var m=x.call(this)||this;return m.$=new f.l,c===void 0?m.UE():typeof c=="number"?m.VO(c,o,l,h):c instanceof f.Sa?o!==void 0?m.Qu(c,o,l):m.WO(c):c instanceof f.ra?o!==void 0?m.YO(c,o):m.XO(c):c instanceof f.l?m.UO(c):m.UE(),m}return bt(d,x),d.prototype.Qu=function(c,o,l){this.description=f.ee.og(),this.$.Oa(),c.B()||this.tu(c,o,l)},d.prototype.UO=function(c){this.description=f.ee.og(),this.$.K(c),this.$.normalize()},d.prototype.XO=function(c){if(c==null)throw f.i.N();this.description=c,this.$.Oa()},d.prototype.YO=function(c,o){if(c==null)throw f.i.N();this.description=c,this.$.K(o),this.$.normalize()},d.prototype.UE=function(){this.description=f.ee.og(),this.$.Oa()},d.prototype.WO=function(c){this.description=f.ee.og(),this.$.Oa(),c.B()||this.tu(c)},d.prototype.VO=function(c,o,l,h){this.description=f.ee.og(),this.K(c,o,l,h)},d.prototype.K=function(c,o,l,h){if(this.vc(),typeof c=="number")this.$.K(c,o,l,h);else for(this.Oa(),o=0,l=c.length;o<l;o++)this.Zb(c[o])},d.prototype.Xo=function(c){if(this.vc(),!c.fT())throw f.i.N();this.$.K(c)},d.prototype.Oa=function(){this.vc(),this.$.Oa()},d.prototype.B=function(){return this.$.B()},d.prototype.R=function(){return this.$.R()},d.prototype.ca=function(){return this.$.ca()},d.prototype.gk=function(){return this.$.gk()},d.prototype.Jp=function(){return this.$.Jp()},d.prototype.Ip=function(){return this.$.sf()},d.prototype.Zb=function(c){if(c instanceof f.h)this.vc(),this.$.Zb(c);else if(c instanceof f.l)this.vc(),this.$.Zb(c);else if(c instanceof f.Sa){if(this.vc(),!c.Ac()){var o=c.description;if(this.description!=o&&this.Jl(o),this.B())this.tu(c);else{this.$.Zb(c.D());for(var l=1,h=o.Aa;l<h;l++)for(var m=o.Ed(l),g=f.ra.Va(m),v=0;v<g;v++){var w=c.Uc(m,v),E=this.Tg(m,v);E.Zb(w),this.setInterval(m,v,E)}}}}else if(c instanceof d&&!c.B())for((o=c.description)!=this.description&&this.Jl(o),this.$.Zb(c.$),l=1,h=o.Aa;l<h;l++)for(m=o.kd(l),g=f.ra.Va(m),v=0;v<g;v++)w=c.Tg(m,v),(E=this.Tg(m,v)).Zb(w),this.setInterval(m,v,E)},d.prototype.tu=function(c,o,l){if(o!==void 0){this.$.K(c.D(),o,l),l=1;for(var h=(o=c.description).Aa;l<h;l++)for(var m=o.Ed(l),g=f.ra.Va(m),v=0;v<g;v++){var w=c.Uc(m,v);this.setInterval(m,v,w,w)}}else for(this.$.K(c.ka[0],c.ka[1]),l=1,h=(o=c.description).Aa;l<h;l++)for(m=o.Ed(l),g=f.ra.Va(m),v=0;v<g;v++)w=c.Uc(m,v),this.setInterval(m,v,w,w)},d.prototype.setInterval=function(c,o,l,h){if(l=typeof l=="number"?new f.Nc(l,h):l,this.vc(),c==0)if(o==0)this.$.v=l.oa,this.$.C=l.va;else{if(o!=1)throw f.i.ce();this.$.G=l.oa,this.$.H=l.va}else this.vD(0,c,o,l.oa),this.vD(1,c,o,l.va)},d.prototype.W=function(c,o){this.vc(),this.$.W(c,o)},d.prototype.Oc=function(c){if(c instanceof f.Dd)this.vc(),c.mC(this.$);else if(this.vc(),!this.$.B()){var o=new f.OK;this.Qo(o),o.XS()?o.Oa():c.mC(o)}},d.prototype.copyTo=function(c){if(c.getType()!=this.getType())throw f.i.N();if(c.vc(),c.description=this.description,c.$.K(this.$),c.ka=null,this.ka!=null){c.ou();for(var o=0;o<2*(this.description.Ae.length-2);o++)c.ka[o]=this.ka[o]}},d.prototype.Ia=function(){return new d(this.description)},d.prototype.Ke=function(){return this.$.wF()},d.prototype.Qb=function(){return this.$.yR()},d.prototype.getType=function(){return 197},d.prototype.Db=function(){return 2},d.prototype.bn=function(c){this.copyTo(c)},d.prototype.A=function(c){c.v=this.$.v,c.G=this.$.G,c.C=this.$.C,c.H=this.$.H},d.prototype.Qo=function(c){c.v=this.$.v,c.G=this.$.G,c.C=this.$.C,c.H=this.$.H,c.K(this.$.v,this.$.G,this.Od(0,1,0),this.$.C,this.$.H,this.Od(1,1,0))},d.prototype.Tg=function(c,o){var l=new f.Nc;return l.K(this.Od(0,c,o),this.Od(1,c,o)),l},d.prototype.Hf=function(c,o){o.Nf(this.description);var l=this.description.Aa-1;switch(c){case 0:for(c=0;c<l;c++)for(var h=this.description.kd(c),m=f.ra.Va(h),g=0;g<m;g++)o.setAttribute(h,g,this.Od(0,h,g));o.Cb(this.$.v,this.$.G);break;case 1:for(c=0;c<l;c++)for(h=this.description.kd(c),m=f.ra.Va(h),g=0;g<m;g++)o.setAttribute(h,g,this.Od(1,h,g));o.Cb(this.$.v,this.$.H);break;case 2:for(c=0;c<l;c++)for(h=this.description.kd(c),m=f.ra.Va(h),g=0;g<m;g++)o.setAttribute(h,g,this.Od(0,h,g));o.Cb(this.$.C,this.$.H);break;case 3:for(c=0;c<l;c++)for(h=this.description.kd(c),m=f.ra.Va(h),g=0;g<m;g++)o.setAttribute(h,g,this.Od(1,h,g));o.Cb(this.$.C,this.$.G);break;default:throw f.i.ce()}},d.prototype.mB=function(c,o){c=this.$.mB(c),o.ma(c.x,c.y)},d.prototype.kR=function(c,o){return o*(c.Oq-2)},d.prototype.xF=function(c,o,l){if(this.$.B())throw f.i.fa("empty geometry");if(o==0)return c!=0?l!=0?this.$.H:this.$.C:l!=0?this.$.G:this.$.v;if(l>=f.ra.Va(o))throw f.i.N();var h=this.description.Pf(o);return this.ou(),0<=h?this.ka[this.kR(this.description,c)+this.description.LR(h)-2+l]:f.ra.se(o)},d.prototype.ou=function(){if(this.vc(),this.ka==null&&2<this.description.Ae.length){this.ka=[];for(var c=d.Gg(this.description,0),o=d.Gg(this.description,1),l=0,h=1,m=this.description.Aa;h<m;h++){var g=this.description.kd(h),v=f.ra.Va(g);g=f.ra.se(g);for(var w=0;w<v;w++)this.ka[c+l]=g,this.ka[o+l]=g,l++}}},d.prototype.sn=function(c){if(this.ka!=null)if(2<c.Ae.length){for(var o=f.ee.Iw(c,this.description),l=[],h=d.Gg(this.description,0),m=d.Gg(this.description,1),g=d.Gg(c,0),v=d.Gg(c,1),w=0,E=1,A=c.Aa;E<A;E++){var M=c.kd(E),I=f.ra.Va(M);if(o[E]==-1){var D=f.ra.se(M);for(M=0;M<I;M++)l[g+w]=D,l[v+w]=D,w++}else for(D=this.description.$j(o[E])-2,M=0;M<I;M++)l[g+w]=this.ka[h+D],l[v+w]=this.ka[m+D],w++,D++}this.ka=l}else this.ka=null;this.description=c},d.prototype.Od=function(c,o,l){if(this.$.B())throw f.i.fa("This operation was performed on an Empty Geometry.");if(o==0)return c!=0?l!=0?this.$.H:this.$.C:l!=0?this.$.G:this.$.v;if(l>=f.ra.Va(o))throw f.i.ce();var h=this.description.Pf(o);return 0<=h?(this.ou(),this.ka[d.Gg(this.description,c)+this.description.$j(h)-2+l]):f.ra.se(o)},d.prototype.vD=function(c,o,l,h){if(this.vc(),o==0)c!=0?l!=0?this.$.H=h:this.$.C=h:l!=0?this.$.G=h:this.$.v=h;else{if(l>=f.ra.Va(o))throw f.i.ce();if(!this.hasAttribute(o)){if(f.ra.DG(o,h))return;this.re(o)}o=this.description.Pf(o),this.ou(),this.ka[d.Gg(this.description,c)+this.description.$j(o)-2+l]=h}},d.Gg=function(c,o){return o*(c.Ae.length-2)},d.prototype.Ea=function(c){this.vc();var o=new f.l;return c.A(o),this.$.Ea(o)},d.prototype.isIntersecting=function(c){return c instanceof f.l?this.$.isIntersecting(c):this.$.isIntersecting(c.$)},d.prototype.Ju=function(c,o){this.vc(),c.B()?this.Oa():o!==void 0?this.tu(c,o):this.$.Ju(c.Lg(),c.ih())},d.prototype.offset=function(c,o){this.vc(),this.$.offset(c,o)},d.prototype.normalize=function(){this.vc(),this.$.normalize()},d.prototype.sf=function(c){if(c===void 0){if(c=new f.Sa(this.description),this.B())return c;for(o=this.description.Aa,l=1;l<o;l++)for(h=this.description.Ed(l),m=f.ra.Va(h),g=0;g<m;g++)v=.5*(this.Od(0,h,g)+this.Od(1,h,g)),c.setAttribute(h,g,v);return c.Cb(this.$.gk(),this.$.Jp()),c}if(c.Nf(this.description),this.B())c.Oa();else{for(var o=this.description.Aa,l=1;l<o;l++)for(var h=this.description.kd(l),m=f.ra.Va(h),g=0;g<m;g++){var v=.5*(this.xF(0,h,g)+this.xF(1,h,g));c.setAttribute(h,g,v)}c.Cb(this.$.sf())}},d.prototype.mz=function(){return new f.Sa(this.$.mz())},d.prototype.contains=function(c){return c instanceof f.Sa?!c.B()&&this.$.contains(c.Lg(),c.ih()):this.$.contains(c.$)},d.prototype.dP=function(c){return this.$.contains(c)},d.prototype.Nb=function(c){if(c==this)return!0;if(!(c instanceof d)||this.description!=c.description)return!1;if(this.B())return!!c.B();if(!this.$.Nb(c.$))return!1;for(var o=0,l=2*(this.description.Ae.length-2);o<l;o++)if(this.ka[o]!=c.ka[o])return!1;return!0},d.prototype.cc=function(){var c=this.description.cc();if(c=f.O.Th(c,this.$.cc()),!this.B()&&this.ka!=null)for(var o=0,l=2*(this.description.Ae.length-2);o<l;o++)c=f.O.Th(c,this.ka[o]);return c},d.prototype.es=function(){return this.$.v},d.prototype.gs=function(){return this.$.G},d.prototype.ds=function(){return this.$.C},d.prototype.fs=function(){return this.$.H},d.prototype.mg=function(){return f.pi.gm(this,null)},d.prototype.toString=function(){return this.B()?"Envelope: []":"Envelope: ["+this.$.v+", "+this.$.G+", "+this.$.C+", "+this.$.H+"]"},d}(f.aa);f.Fh=L}(Q||(Q={})),function(f){var L=function(){function x(d,c,o,l){d===void 0?this.Oa():(this.v=d,this.G=c,this.C=o,this.H=l)}return x.construct=function(d,c,o,l){var h=new x;return h.v=d,h.G=c,h.C=o,h.H=l,h},x.prototype.K=function(d,c,o,l){typeof d=="number"?o!==void 0?(this.v=d,this.G=c,this.C=o,this.H=l,this.normalize()):(this.v=d,this.G=c,this.C=d,this.H=c):d instanceof f.h?c!==void 0?(this.v=d.x-.5*c,this.C=this.v+c,this.G=d.y-.5*o,this.H=this.G+o,this.normalize()):(this.v=d.x,this.G=d.y,this.C=d.x,this.H=d.y):d instanceof x?this.K(d.v,d.G,d.C,d.H):d instanceof f.Nc&&(d.B()||c.B()?this.Oa():(this.v=d.oa,this.C=d.va,this.G=c.oa,this.H=c.va))},x.prototype.Zw=function(d,c){if(c!==void 0)if(c==0)this.Oa();else{this.v=d[0].x,this.G=d[0].y,this.C=this.v,this.H=this.G;for(var o=1;o<c;o++){var l=d[o];l.x<this.v?this.v=l.x:l.x>this.C&&(this.C=l.x),l.y<this.G?this.G=l.y:l.y>this.H&&(this.H=l.y)}}else if(d==null||d.length==0)this.Oa();else for(l=d[0],this.K(l.x,l.y),o=1;o<d.length;o++)c=d[o],this.Lk(c.x,c.y)},x.prototype.Oa=function(){this.H=this.C=this.G=this.v=NaN},x.prototype.B=function(){return isNaN(this.v)},x.prototype.Zb=function(d,c){typeof d=="number"?this.B()?(this.v=d,this.G=c,this.C=d,this.H=c):(this.v>d?this.v=d:this.C<d&&(this.C=d),this.G>c?this.G=c:this.H<c&&(this.H=c)):d instanceof f.h||d instanceof f.Nd?this.Zb(d.x,d.y):d instanceof x&&!d.B()&&(this.Zb(d.v,d.G),this.Zb(d.C,d.H))},x.prototype.Lk=function(d,c){this.v>d?this.v=d:this.C<d&&(this.C=d),this.G>c?this.G=c:this.H<c&&(this.H=c)},x.prototype.W=function(d,c){this.B()||(this.v-=d,this.C+=d,this.G-=c,this.H+=c,(this.v>this.C||this.G>this.H)&&this.Oa())},x.prototype.scale=function(d){0>d&&this.Oa(),this.B()||(this.v*=d,this.C*=d,this.G*=d,this.H*=d)},x.prototype.zoom=function(d,c){this.B()||this.K(this.sf(),d*this.R(),c*this.ca())},x.prototype.isIntersecting=function(d){return!this.B()&&!d.B()&&(this.v<=d.v?this.C>=d.v:d.C>=this.v)&&(this.G<=d.G?this.H>=d.G:d.H>=this.G)},x.prototype.HG=function(d){return(this.v<=d.v?this.C>=d.v:d.C>=this.v)&&(this.G<=d.G?this.H>=d.G:d.H>=this.G)},x.prototype.Ea=function(d){return!this.B()&&!d.B()&&(d.v>this.v&&(this.v=d.v),d.C<this.C&&(this.C=d.C),d.G>this.G&&(this.G=d.G),d.H<this.H&&(this.H=d.H),(d=this.v<=this.C&&this.G<=this.H)||this.Oa(),d)},x.prototype.mB=function(d){switch(d){case 0:return f.h.construct(this.v,this.G);case 1:return f.h.construct(this.v,this.H);case 2:return f.h.construct(this.C,this.H);case 3:return f.h.construct(this.C,this.G);default:throw f.i.ce()}},x.prototype.nB=function(d){if(d==null||4>d.length)throw f.i.N();d[0]!=null?d[0].ma(this.v,this.G):d[0]=f.h.construct(this.v,this.G),d[1]!=null?d[1].ma(this.v,this.H):d[1]=f.h.construct(this.v,this.H),d[2]!=null?d[2].ma(this.C,this.H):d[2]=f.h.construct(this.C,this.H),d[3]!=null?d[3].ma(this.C,this.G):d[3]=f.h.construct(this.C,this.G)},x.prototype.wF=function(){return this.B()?0:this.R()*this.ca()},x.prototype.yR=function(){return this.B()?0:2*(this.R()+this.ca())},x.prototype.gk=function(){return(this.C+this.v)/2},x.prototype.Jp=function(){return(this.H+this.G)/2},x.prototype.R=function(){return this.C-this.v},x.prototype.ca=function(){return this.H-this.G},x.prototype.move=function(d,c){this.B()||(this.v+=d,this.G+=c,this.C+=d,this.H+=c)},x.prototype.Ju=function(d,c){if(c!==void 0)this.move(d-this.gk(),c-this.Jp());else if(d instanceof f.h)this.Ju(d.x,d.y);else{if(!(d instanceof f.Sa))throw f.i.N();c=(this.C-this.v)/2;var o=(this.H-this.G)/2;this.v=d.Lg()-c,this.C=d.Lg()+c,this.G=d.ih()-o,this.H=d.ih()+o}},x.prototype.offset=function(d,c){this.v+=d,this.C+=d,this.G+=c,this.H+=c},x.prototype.normalize=function(){if(!this.B()){var d=Math.min(this.v,this.C),c=Math.max(this.v,this.C);this.v=d,this.C=c,d=Math.min(this.G,this.H),c=Math.max(this.G,this.H),this.G=d,this.H=c}},x.prototype.dn=function(d){d.ma(this.v,this.G)},x.prototype.$I=function(d){d.ma(this.C,this.G)},x.prototype.cJ=function(d){d.ma(this.v,this.H)},x.prototype.en=function(d){d.ma(this.C,this.H)},x.prototype.fT=function(){return this.B()||this.v<=this.C&&this.G<=this.H},x.prototype.sf=function(){return f.h.construct((this.C+this.v)/2,(this.H+this.G)/2)},x.prototype.mz=function(){return f.h.construct(this.v,this.G)},x.prototype.contains=function(d,c){if(c!==void 0)return d>=this.v&&d<=this.C&&c>=this.G&&c<=this.H;if(d instanceof f.Sa)return this.contains(d.Lg(),d.ih());if(d instanceof f.h)return this.contains(d.x,d.y);if(d instanceof x)return d.v>=this.v&&d.C<=this.C&&d.G>=this.G&&d.H<=this.H;throw f.i.N()},x.prototype.hm=function(d,c){if(c!==void 0)return d>this.v&&d<this.C&&c>this.G&&c<this.H;if(d instanceof f.h)return this.hm(d.x,d.y);if(d instanceof x)return d.v>this.v&&d.C<this.C&&d.G>this.G&&d.H<this.H;throw f.i.N()},x.prototype.Nb=function(d){return d==this||d instanceof x&&(!(!this.B()||!d.B())||this.v==d.v&&this.G==d.G&&this.C==d.C&&this.H==d.H)},x.prototype.cc=function(){var d=this.v;d=f.O.truncate(d^d>>>32);var c=f.O.Th(d);return d=this.C,d=f.O.truncate(d^d>>>32),c=f.O.Th(d,c),d=this.G,d=f.O.truncate(d^d>>>32),c=f.O.Th(d,c),d=this.H,d=f.O.truncate(d^d>>>32),f.O.Th(d,c)},x.prototype.xr=function(){return this.B()?2220446049250313e-29:2220446049250313e-29*(Math.abs(this.v)+Math.abs(this.C)+Math.abs(this.G)+Math.abs(this.H)+1)},x.prototype.zy=function(d,c){var o=this.Zj(d),l=this.Zj(c);if(o&l)return 0;if(!(o|l))return 4;var h=(o!=0?1:0)|(l!=0?2:0);do{var m=c.x-d.x,g=c.y-d.y;if(m>g?o&x.YC?(o&x.ju?(d.y+=g*(this.v-d.x)/m,d.x=this.v):(d.y+=g*(this.C-d.x)/m,d.x=this.C),o=this.Zj(d)):l&x.YC?(l&x.ju?(c.y+=g*(this.v-c.x)/m,c.x=this.v):(c.y+=g*(this.C-c.x)/m,c.x=this.C),l=this.Zj(c)):o!=0?(o&x.ku?(d.x+=m*(this.G-d.y)/g,d.y=this.G):(d.x+=m*(this.H-d.y)/g,d.y=this.H),o=this.Zj(d)):(l&x.ku?(c.x+=m*(this.G-c.y)/g,c.y=this.G):(c.x+=m*(this.H-c.y)/g,c.y=this.H),l=this.Zj(c)):o&x.ZC?(o&x.ku?(d.x+=m*(this.G-d.y)/g,d.y=this.G):(d.x+=m*(this.H-d.y)/g,d.y=this.H),o=this.Zj(d)):l&x.ZC?(l&x.ku?(c.x+=m*(this.G-c.y)/g,c.y=this.G):(c.x+=m*(this.H-c.y)/g,c.y=this.H),l=this.Zj(c)):o!=0?(o&x.ju?(d.y+=g*(this.v-d.x)/m,d.x=this.v):(d.y+=g*(this.C-d.x)/m,d.x=this.C),o=this.Zj(d)):(l&x.ju?(c.y+=g*(this.v-c.x)/m,c.x=this.v):(c.y+=g*(this.C-c.x)/m,c.x=this.C),l=this.Zj(c)),(o&l)!=0)return 0}while(o|l);return h},x.prototype.Zj=function(d){return(d.x<this.v?1:0)|(d.x>this.C?1:0)<<1|(d.y<this.G?1:0)<<2|(d.y>this.H?1:0)<<3},x.prototype.Bi=function(d){return!this.B()&&(this.R()<=d||this.ca()<=d)},x.prototype.tb=function(d){return d instanceof f.h?Math.sqrt(this.iK(d)):Math.sqrt(this.px(d))},x.prototype.px=function(d){var c=0,o=0,l=this.v-d.C;return l>c&&(c=l),(l=this.G-d.H)>o&&(o=l),(l=d.v-this.C)>c&&(c=l),(l=d.G-this.H)>o&&(o=l),c*c+o*o},x.prototype.iK=function(d){var c=0,o=0,l=this.v-d.x;return l>c&&(c=l),(l=this.G-d.y)>o&&(o=l),(l=d.x-this.C)>c&&(c=l),(l=d.y-this.H)>o&&(o=l),c*c+o*o},x.prototype.cn=function(d){this.B()?d.Oa():d.K(this.v,this.C)},x.ju=1,x.ku=4,x.YC=3,x.ZC=12,x}();f.l=L}(Q||(Q={})),function(f){var L,x;(x=L||(L={}))[x.initialize=0]="initialize",x[x.initializeRed=1]="initializeRed",x[x.initializeBlue=2]="initializeBlue",x[x.initializeRedBlue=3]="initializeRedBlue",x[x.sweep=4]="sweep",x[x.sweepBruteForce=5]="sweepBruteForce",x[x.sweepRedBlueBruteForce=6]="sweepRedBlueBruteForce",x[x.sweepRedBlue=7]="sweepRedBlue",x[x.sweepRed=8]="sweepRed",x[x.sweepBlue=9]="sweepBlue",x[x.iterate=10]="iterate",x[x.iterateRed=11]="iterateRed",x[x.iterateBlue=12]="iterateBlue",x[x.iterateBruteForce=13]="iterateBruteForce",x[x.iterateRedBlueBruteForce=14]="iterateRedBlueBruteForce",x[x.resetRed=15]="resetRed",x[x.resetBlue=16]="resetBlue";var d=function(){function c(o,l){this.ci=o,this.dH=l}return c.prototype.nr=function(o,l,h){this.ci.JX(h,o,l,this.dH)},c.prototype.$p=function(o){return this.ci.Rr(o,this.dH)},c}();L=function(){function c(){this.ow=this.oo=this.ff=this.rd=null,this.wq=new f.l,this.Am=this.Hj=this.Ij=this.Ad=this.Ef=this.Ld=this.cw=this.fo=this.qd=this.Eb=null,this.Xb=-1,this.qa=0,this.Nk()}return c.prototype.kr=function(){this.Nk(),this.Pv=!0,this.Eb==null?(this.fo=new f.ia(0),this.Eb=[]):(this.fo.Bh(0),this.Eb.length=0)},c.prototype.ad=function(o,l){if(!this.Pv)throw f.i.Hb();var h=new f.l;h.K(l),this.fo.add(o),this.Eb.push(h)},c.prototype.Fp=function(){if(!this.Pv)throw f.i.Hb();this.Pv=!1,this.Eb!=null&&0<this.Eb.length&&(this.Xb=0,this.Ic=!1)},c.prototype.pK=function(){this.Nk(),this.Ov=!0,this.Eb==null?(this.fo=new f.ia(0),this.Eb=[]):(this.fo.Bh(0),this.Eb.length=0)},c.prototype.JD=function(o,l){if(!this.Ov)throw f.i.Hb();var h=new f.l;h.K(l),this.fo.add(o),this.Eb.push(h)},c.prototype.iF=function(){if(!this.Ov)throw f.i.Hb();this.Ov=!1,this.Eb!=null&&0<this.Eb.length&&this.qd!=null&&0<this.qd.length&&(this.Xb==-1||this.Xb==2?this.Xb=3:this.Xb!=3&&(this.Xb=1),this.Ic=!1)},c.prototype.oK=function(){this.Nk(),this.Nv=!0,this.qd==null?(this.cw=new f.ia(0),this.qd=[]):(this.cw.Bh(0),this.qd.length=0)},c.prototype.ED=function(o,l){if(!this.Nv)throw f.i.Hb();var h=new f.l;h.K(l),this.cw.add(o),this.qd.push(h)},c.prototype.hF=function(){if(!this.Nv)throw f.i.Hb();this.Nv=!1,this.Eb!=null&&0<this.Eb.length&&this.qd!=null&&0<this.qd.length&&(this.Xb==-1||this.Xb==1?this.Xb=3:this.Xb!=3&&(this.Xb=2),this.Ic=!1)},c.prototype.next=function(){if(this.Ic)return!1;for(var o=!0;o;)switch(this.Xb){case 0:o=this.Gz();break;case 1:o=this.rS();break;case 2:o=this.oS();break;case 3:o=this.qS();break;case 4:o=this.UX();break;case 5:o=this.QX();break;case 6:o=this.RX();break;case 7:o=this.SX();break;case 8:o=this.ux();break;case 9:o=this.iC();break;case 10:o=this.Uz();break;case 11:o=this.jT();break;case 12:o=this.gT();break;case 13:o=this.hT();break;case 14:o=this.iT();break;case 15:o=this.kJ();break;case 16:o=this.jJ();break;default:throw f.i.Qa()}return!this.Ic},c.prototype.aC=function(o){this.qa=o},c.prototype.uz=function(o){return this.Eb[o]},c.prototype.az=function(o){return this.qd[o]},c.prototype.nl=function(o){return this.fo.read(o)},c.prototype.hl=function(o){return this.cw.read(o)},c.Tz=function(o){return(1&o)==1},c.eq=function(o){return(1&o)==0},c.prototype.Nk=function(){this.Pv=this.Nv=this.Ov=!1,this.Cf=this.Df=this.Rg=this.pe=-1,this.Ic=!0},c.prototype.Gz=function(){if(this.Af=this.Vf=-1,10>this.Eb.length)return this.pe=this.Eb.length,this.Xb=5,!0;this.rd==null&&(this.rd=new f.sr(!0),this.oo=this.rd.getIterator(),this.Ld=new f.ia(0)),this.rd.kr();for(var o=0;o<this.Eb.length;o++){var l=this.Eb[o];this.rd.Br(l.v,l.C)}for(this.rd.Fp(),this.Ld.Jb(2*this.Eb.length),this.Ld.resize(0),o=0;o<2*this.Eb.length;o++)this.Ld.add(o);return this.Kt(this.Ld,2*this.Eb.length,!0),this.pe=2*this.Eb.length,this.Xb=4,!0},c.prototype.rS=function(){if(this.Af=this.Vf=-1,10>this.Eb.length||10>this.qd.length)return this.pe=this.Eb.length,this.Xb=6,!0;this.rd==null&&(this.rd=new f.sr(!0),this.oo=this.rd.getIterator(),this.Ld=new f.ia(0)),this.rd.kr();for(var o=0;o<this.Eb.length;o++){var l=this.Eb[o];this.rd.Br(l.v,l.C)}for(this.rd.Fp(),this.Ld.Jb(2*this.Eb.length),this.Ld.resize(0),o=0;o<2*this.Eb.length;o++)this.Ld.add(o);return this.Kt(this.Ld,this.Ld.size,!0),this.pe=this.Ld.size,this.Df!=-1&&(this.Ad.bh(this.Df),this.Ij.resize(0),this.Df=-1),this.Xb=7,this.jJ()},c.prototype.oS=function(){if(this.Af=this.Vf=-1,10>this.Eb.length||10>this.qd.length)return this.pe=this.Eb.length,this.Xb=6,!0;this.ff==null&&(this.ff=new f.sr(!0),this.ow=this.ff.getIterator(),this.Ef=new f.ia(0)),this.ff.kr();for(var o=0;o<this.qd.length;o++){var l=this.qd[o];this.ff.Br(l.v,l.C)}for(this.ff.Fp(),this.Ef.Jb(2*this.qd.length),this.Ef.resize(0),o=0;o<2*this.qd.length;o++)this.Ef.add(o);return this.Kt(this.Ef,this.Ef.size,!1),this.Rg=this.Ef.size,this.Cf!=-1&&(this.Ad.bh(this.Cf),this.Hj.resize(0),this.Cf=-1),this.Xb=7,this.kJ()},c.prototype.qS=function(){if(this.Af=this.Vf=-1,10>this.Eb.length||10>this.qd.length)return this.pe=this.Eb.length,this.Xb=6,!0;this.rd==null&&(this.rd=new f.sr(!0),this.oo=this.rd.getIterator(),this.Ld=new f.ia(0)),this.ff==null&&(this.ff=new f.sr(!0),this.ow=this.ff.getIterator(),this.Ef=new f.ia(0)),this.rd.kr();for(var o=0;o<this.Eb.length;o++){var l=this.Eb[o];this.rd.Br(l.v,l.C)}for(this.rd.Fp(),this.ff.kr(),o=0;o<this.qd.length;o++)l=this.qd[o],this.ff.Br(l.v,l.C);for(this.ff.Fp(),this.Ld.Jb(2*this.Eb.length),this.Ef.Jb(2*this.qd.length),this.Ld.resize(0),this.Ef.resize(0),o=0;o<2*this.Eb.length;o++)this.Ld.add(o);for(o=0;o<2*this.qd.length;o++)this.Ef.add(o);return this.Kt(this.Ld,this.Ld.size,!0),this.Kt(this.Ef,this.Ef.size,!1),this.pe=this.Ld.size,this.Rg=this.Ef.size,this.Df!=-1&&(this.Ad.bh(this.Df),this.Ij.resize(0),this.Df=-1),this.Cf!=-1&&(this.Ad.bh(this.Cf),this.Hj.resize(0),this.Cf=-1),this.Xb=7,!0},c.prototype.UX=function(){var o=this.Ld.get(--this.pe),l=o>>1;return c.eq(o)?(this.rd.remove(l),this.pe!=0||(this.Af=this.Vf=-1,this.Ic=!0,!1)):(this.oo.EB(this.Eb[l].v,this.Eb[l].C,this.qa),this.Vf=l,this.Xb=10,!0)},c.prototype.QX=function(){return--this.pe==-1?(this.Af=this.Vf=-1,this.Ic=!0,!1):(this.Rg=this.Vf=this.pe,this.Xb=13,!0)},c.prototype.RX=function(){return--this.pe==-1?(this.Af=this.Vf=-1,this.Ic=!0,!1):(this.Vf=this.pe,this.Rg=this.qd.length,this.Xb=14,!0)},c.prototype.SX=function(){var o=this.Ld.get(this.pe-1),l=this.Ef.get(this.Rg-1),h=this.Rr(o,!0),m=this.Rr(l,!1);return h>m?this.ux():h<m?this.iC():c.Tz(o)?this.ux():c.Tz(l)?this.iC():this.ux()},c.prototype.ux=function(){var o=this.Ld.get(--this.pe),l=o>>1;if(c.eq(o))return this.Df!=-1&&this.Ij.get(l)!=-1?(this.Ad.jd(this.Df,this.Ij.get(l)),this.Ij.set(l,-1)):this.rd.remove(l),this.pe!=0||(this.Af=this.Vf=-1,this.Ic=!0,!1);if(this.Cf!=-1&&0<this.Ad.bs(this.Cf))for(o=this.Ad.rc(this.Cf);o!=-1;){var h=this.Ad.getData(o);this.ff.vj(h),this.Hj.set(h,-1),h=this.Ad.lb(o),this.Ad.jd(this.Cf,o),o=h}return 0<this.ff.size()?(this.ow.EB(this.Eb[l].v,this.Eb[l].C,this.qa),this.Vf=l,this.Xb=12):(this.Df==-1&&(this.Ad==null&&(this.Ad=new f.jp),this.Ij=new f.ia(0),this.Ij.resize(this.Eb.length,-1),this.Ij.Wj(-1,0,this.Eb.length),this.Df=this.Ad.Ph(1)),this.Ij.set(l,this.Ad.addElement(this.Df,l)),this.Xb=7),!0},c.prototype.iC=function(){var o=this.Ef.get(--this.Rg),l=o>>1;if(c.eq(o))return this.Cf!=-1&&this.Hj.get(l)!=-1?(this.Ad.jd(this.Cf,this.Hj.get(l)),this.Hj.set(l,-1)):this.ff.remove(l),this.Rg!=0||(this.Af=this.Vf=-1,this.Ic=!0,!1);if(this.Df!=-1&&0<this.Ad.bs(this.Df))for(o=this.Ad.rc(this.Df);o!=-1;){var h=this.Ad.getData(o);this.rd.vj(h),this.Ij.set(h,-1),h=this.Ad.lb(o),this.Ad.jd(this.Df,o),o=h}return 0<this.rd.size()?(this.oo.EB(this.qd[l].v,this.qd[l].C,this.qa),this.Af=l,this.Xb=11):(this.Cf==-1&&(this.Ad==null&&(this.Ad=new f.jp),this.Hj=new f.ia(0),this.Hj.resize(this.qd.length,-1),this.Hj.Wj(-1,0,this.qd.length),this.Cf=this.Ad.Ph(0)),this.Hj.set(l,this.Ad.addElement(this.Cf,l)),this.Xb=7),!0},c.prototype.Uz=function(){if(this.Af=this.oo.next(),this.Af!=-1)return!1;var o=this.Ld.get(this.pe)>>1;return this.rd.vj(o),this.Xb=4,!0},c.prototype.jT=function(){if(this.Vf=this.oo.next(),this.Vf!=-1)return!1;this.Af=this.Vf=-1;var o=this.Ef.get(this.Rg)>>1;return this.ff.vj(o),this.Xb=7,!0},c.prototype.gT=function(){if(this.Af=this.ow.next(),this.Af!=-1)return!1;var o=this.Ld.get(this.pe)>>1;return this.rd.vj(o),this.Xb=7,!0},c.prototype.hT=function(){if(--this.Rg==-1)return this.Xb=5,!0;this.wq.K(this.Eb[this.pe]);var o=this.Eb[this.Rg];return this.wq.W(this.qa,this.qa),!this.wq.isIntersecting(o)||(this.Af=this.Rg,!1)},c.prototype.iT=function(){if(--this.Rg==-1)return this.Xb=6,!0;this.wq.K(this.Eb[this.pe]);var o=this.qd[this.Rg];return this.wq.W(this.qa,this.qa),!this.wq.isIntersecting(o)||(this.Af=this.Rg,!1)},c.prototype.kJ=function(){return this.rd==null?(this.Ic=!0,!1):(this.pe=this.Ld.size,0<this.rd.size()&&this.rd.reset(),this.Df!=-1&&(this.Ad.bh(this.Df),this.Ij.resize(0),this.Df=-1),this.Ic=!1,!0)},c.prototype.jJ=function(){return this.ff==null?(this.Ic=!0,!1):(this.Rg=this.Ef.size,0<this.ff.size()&&this.ff.reset(),this.Cf!=-1&&(this.Ad.bh(this.Cf),this.Hj.resize(0),this.Cf=-1),this.Ic=!1,!0)},c.prototype.Kt=function(o,l,h){this.Am==null&&(this.Am=new f.Xt),h=new d(this,h),this.Am.sort(o,0,l,h)},c.prototype.JX=function(o,l,h,m){var g=this;o.Vd(l,h,function(v,w){var E=g.Rr(v,m),A=g.Rr(w,m);return E<A||E==A&&c.eq(v)&&c.Tz(w)?-1:1})},c.prototype.Rr=function(o,l){var h=.5*this.qa;return l?(l=this.Eb[o>>1],c.eq(o)?l.G-h:l.H+h):(l=this.qd[o>>1],c.eq(o)?l.G-h:l.H+h)},c}(),f.xC=L}(Q||(Q={})),function(f){var L=function(){function x(){}return x.construct=function(d,c,o,l,h,m){var g=new x;return g.v=d,g.G=c,g.Ye=o,g.C=l,g.H=h,g.Bg=m,g},x.prototype.Oa=function(){this.Ye=this.v=NaN},x.prototype.B=function(){return isNaN(this.v)},x.prototype.XS=function(){return isNaN(this.Ye)},x.prototype.K=function(d,c,o,l,h,m){l!==void 0?typeof d=="number"?(this.v=d,this.G=c,this.Ye=o,this.C=l,this.H=h,this.Bg=m):(this.v=d.x-.5*c,this.C=this.v+c,this.G=d.y-.5*o,this.H=this.G+o,this.Ye=d.z-.5*l,this.Bg=this.Ye+l):(this.v=d,this.G=c,this.Ye=o,this.C=d,this.H=c,this.Bg=o)},x.prototype.move=function(d){this.v+=d.x,this.G+=d.y,this.Ye+=d.z,this.C+=d.x,this.H+=d.y,this.Bg+=d.z},x.prototype.copyTo=function(d){d.v=this.v,d.G=this.G,d.C=this.C,d.H=this.H},x.prototype.Lk=function(d,c,o){this.v>d?this.v=d:this.C<d&&(this.C=d),this.G>c?this.G=c:this.H<c&&(this.H=c),isNaN(this.Ye)==0?this.Ye>o?this.Ye=o:this.Bg<o&&(this.Bg=o):this.Bg=this.Ye=o},x.prototype.Zb=function(d,c,o){if(typeof d=="number")this.B()?(this.v=d,this.G=c,this.Ye=o,this.C=d,this.H=c,this.Bg=o):this.Lk(d,c,o);else if(d instanceof f.Nd)this.Zb(d.x,d.y,d.z);else{if(!(d instanceof x))throw f.i.N();d.B()||(this.Zb(d.v,d.G,d.Ye),this.Zb(d.C,d.H,d.Bg))}},x.prototype.construct=function(d,c,o){d.B()||c.B()?this.Oa():(this.v=d.oa,this.C=d.va,this.G=c.oa,this.H=c.va,this.Ye=o.oa,this.Bg=o.va)},x.prototype.nB=function(d){if(d==null||8>d.length)throw f.i.N();d[0]=new f.Nd(this.v,this.G,this.Ye),d[1]=new f.Nd(this.v,this.H,this.Ye),d[2]=new f.Nd(this.C,this.H,this.Ye),d[3]=new f.Nd(this.C,this.G,this.Ye),d[4]=new f.Nd(this.v,this.G,this.Bg),d[5]=new f.Nd(this.v,this.H,this.Bg),d[6]=new f.Nd(this.C,this.H,this.Bg),d[7]=new f.Nd(this.C,this.G,this.Bg)},x.prototype.Zw=function(d){if(d==null||d.length==0)this.Oa();else{var c=d[0];for(this.K(c.x,c.y,c.z),c=1;c<d.length;c++){var o=d[c];this.Lk(o.x,o.y,o.z)}}},x}();f.OK=L}(Q||(Q={})),function(f){(function(L){L.Qa=function(){var x=Error();return x.message="Internal Error",x},L.Ie=function(){var x=Error();return x.message="Not Implemented",x},L.Xk=function(){var x=Error();return x.message="The input unit and the spatial reference unit are not of the same unit type.ie Linear vs.Angular",x},L.Hb=function(){var x=Error();return x.message="Invalid Call",x},L.N=function(x){var d=Error();return d.message="Illegal Argument Exception",x!==void 0&&(d.message+=": "+x),d},L.fu=function(x){var d=Error();return d.message=x!==void 0?"Runtime Exception: "+x:"Runtime Exception.",d},L.fa=function(x){var d=Error();return d.message="Geometry Exception: "+x,d},L.GK=function(){var x=Error();return x.message="Assert Failed Exception",x},L.ce=function(){var x=Error();return x.message="IndexOutOfBoundsException",x},L.WC=function(){var x=Error();return x.message="UserCancelException",x}})(f.i||(f.i={}))}(Q||(Q={})),function(f){(f=f.bm||(f.bm={}))[f.forward=0]="forward",f[f.reverse=1]="reverse"}(Q||(Q={})),function(f){var L=function(){function c(o,l){this.Wa=o,this.FH=l,this.LH=-1,this.sl=!1}return c.prototype.qe=function(){},c.prototype.next=function(){if(++this.LH==this.FH.I())return null;var o=this.FH.Na(this.LH);o.scale(this.Wa.ec);var l=new f.Da;return this.Wa.sy(o,this.sl,l),l},c.prototype.La=function(){return 0},c}(),x=function(){function c(o,l,h){this.Wa=o,this.rw=l,this.Xn=!1,this.co=h,this.bw=[0],this.sk=[0],this.Nj=[0],this.Gs=[0],this.sl=!1,this.qq=new f.Da,this.uk=[]}return c.prototype.qe=function(){},c.prototype.next=function(){if(this.Xn){this.Xn=!1,this.sd.ha();var o=f.aa.jg(this.qq);return f.Fg.Mk(o,this.Wa.Aq,!0,!0,this.Wa.Ub)}if(this.sd==null&&(this.sd=this.rw.Ga(),this.sd.$a(),this.co!=null&&this.co.Yk(null,0)),!this.sd.Ha()){if(!this.sd.$a())return null;this.co!=null&&this.co.Yk(null,0)}o=null,this.sk[0]=0,this.FA=this.bw[0]=0,this.di=NaN,this.Xn=!1;for(var l=this.uk.length=0,h=new f.h,m=new f.h,g=[0];this.sd.Ha()&&8>this.FA;){var v=this.sd.ha();if(h.L(v.ac()),m.L(v.wc()),h.scale(this.Wa.ec),m.scale(this.Wa.ec),f.cj.Mu(h,m)?h.x=m.x:f.cj.Ku(h,m)&&(m.x=h.x),this.uk.length=0,f.cj.tF(this.Wa.Tb,this.Wa.kc,this.Wa.ze,h,m,this.Wa.QA,this.Wa.Zs,g,this.Nj,this.Gs,this.uk,this.bw),this.co!=null&&(v=this.uk.slice(0),this.co.qG(this.co.da()-1,v,v.length-1)),f.cj.Lu(h,m)?(this.qq.Oa(),this.Wa.sy(h,this.sl,this.qq),this.Xn=!0):(this.qq.Oa(),this.Xn=this.xy(g[0],this.qq)),this.Xn){if(this.sd.li(),this.sd.Ez()){this.sd.li(),this.sd.ha();break}this.sd.DW();break}o==null&&(o=new f.Da).Yk(null,0),this.OD(o),l++}if(this.bw[0]=0,0<l){for(g=this.sd.wb();0<l;)this.sd.li(),h.L(this.rw.Na(this.sd.wb())),m.L(this.rw.Na(this.sd.ik())),h.scale(this.Wa.ec),m.scale(this.Wa.ec),this.sl&&(f.cj.Mu(h,m)?h.x=m.x:f.cj.Ku(h,m)&&(m.x=h.x)),this.uk.length=0,f.cj.tF(this.Wa.Tb,this.Wa.kc,this.Wa.ze,m,h,this.Wa.QA,this.Wa.Zs,null,this.Nj,this.Gs,this.uk,this.bw),this.OD(o),l--;return h.L(this.rw.Na(this.sd.wb())),h.scale(this.Wa.ec),d.Hr(this.Wa.Tb,this.Wa.kc,this.Wa.ec,this.Wa.rb,h,this.di+1.570796326794897,this.di+4.71238898038469,this.Wa.ao,this.sl,this.sk,o,NaN,NaN),this.sd.Vb(g),this.sd.ha(),l=f.ta.kj(null,o,!0),f.Fg.Mk(o,l,!0,!0,this.Wa.Ub)}return this.Xn=!1,this.sd.ha(),o=f.aa.jg(this.qq),f.Fg.Mk(o,this.Wa.Aq,!0,!0,this.Wa.Ub)},c.prototype.OD=function(o){var l=this.uk[0],h=this.Nj[0]-1.570796326794897,m=this.Gs[0]+1.570796326794897;if(!isNaN(this.di)){if(this.di>=this.Nj[0]){var g=this.di+1.570796326794897;h=g+3.141592653589793-(this.di-this.Nj[0])}else h=(g=this.di+1.570796326794897)+3.141592653589793-(6.283185307179586-(this.Nj[0]-this.di));var v=!(this.di>=this.Nj[0]&&3.141592653589793>=this.di-this.Nj[0])&&!(this.di<this.Nj[0]&&3.141592653589793<=this.Nj[0]-this.di),w=!1;if(Math.abs(h-g)<=.5*this.Wa.ao)if(v){var E=o.Na(o.I()-2);E.scale(this.Wa.ec);var A=new f.ga(0);for(f.kb.Xy(this.Wa.Tb,this.Wa.kc,l.x,l.y,E.x,E.y,A),E=A.u;E<=g;)E+=6.283185307179586;for(;E>g;)E-=6.283185307179586;E<h&&(w=!0)}else w=!0;w?(o.DB(0,o.I()-1),this.sl||((l=new f.h).L(o.Na(o.I()-1)),l.scale(this.Wa.ec),-3.141592653589793>l.x-this.sk[0]?this.sk[0]-=6.283185307179586:3.141592653589793<l.x-this.sk[0]&&(this.sk[0]+=6.283185307179586)),v||(h=.5*(h+g))):(v?((g=new f.h).L(l),g.scale(1/this.Wa.ec),o.wf(0,-1,g)):d.Hr(this.Wa.Tb,this.Wa.kc,this.Wa.ec,this.Wa.rb,this.uk[0],g,h,this.Wa.ao,this.sl,this.sk,o,NaN,NaN),this.FA+=1)}d.qy(this.Wa.Tb,this.Wa.kc,this.Wa.ec,this.Wa.rb,this.Wa.ze,this.uk,h,m,this.sl,this.sk,o),this.di=this.Gs[0]},c.prototype.xy=function(o,l){return this.Wa.xy(this.uk,o,this.Nj[0],this.Gs[0],this.sl,l)},c.prototype.La=function(){return 0},c}(),d=function(){function c(){}return c.buffer=function(o,l,h,m,g,v){if(o==null)throw f.i.N("Geometry::Geodesic_bufferer::buffer");if(o.B())return new f.Da(o.description);var w=new c;w.Qg=l,w.Jc=f.cb.sc(l);var E=f.cb.vv(w.Jc);if(w.Ub=v,w.Tb=f.cb.ev(w.Jc),w.kc=E*(2-E),w.ec=w.Jc.Hd().ai,w.qa=w.Qg.Kn(),w.Aq=w.Jc.Kn(),w.Zs=w.Aq*w.ec,w.zq=1.570796326794897/w.ec,w.OY=3.141592653589793/w.ec,w.Js=6.283185307179586/w.ec,w.PY=w.Js/6,w.LA=0,w.NY=1.5707963267948966*w.Tb/w.LA,h==4?(w.ze=2,w.Wv=!0):(w.ze=h,w.Wv=!1),w.Ka=m,w.rb=Math.abs(m),isNaN(g)||.001>g?w.xX():w.$n=g,h=o.getType(),f.aa.yd(h)?((h=new f.Ta(o.description)).oc(o,!0),o=h,h=1607):h==197&&(h=new f.l,o.A(h),h.R()<=w.qa||h.ca()<=w.qa?((h=new f.Ta(o.description)).ad(o,!1),o=h,h=1607):((h=new f.Da(o.description)).ad(o,!1),o=h,h=1736)),w.yX(),f.aa.Rn(h)||w.zX(),w.rb<=.5*w.$n)return h!=1736?new f.Da(o.description):w.Wv?o:f.cj.Qr(o,w.Qg,w.ze,w.QA,-1,v);if(0>w.Ka&&h!=1736)return new f.Da(o.description);if(w.Wv&&f.aa.Hc(h)?(l=f.cj.Qr(o,l,4,NaN,w.$n,v),o=f.cb.zh(l,w.Qg,w.Jc)):o=f.cb.zh(o,w.Qg,w.Jc),(o=f.Hh.lj(o,w.Jc)).B())return new f.Da(o.description);switch(!w.Wv&&f.aa.Hc(h)&&(o=f.cj.pI(w.ec,o)),o=c.KX(o,w.Jc),h){case 1736:l=w.UN(o);break;case 1607:l=w.VN(o);break;case 550:l=w.SN(o);break;case 33:l=w.TN(o);break;default:throw f.i.fa("corrupted_geometry")}return(w=f.cb.zh(l,w.Jc,w.Qg)).Jl(o.description),w},c.prototype.UN=function(o){var l=new f.Da;o=new x(this,o,l),o=f.Gh.local().V(o,this.Jc,this.Ub).next(),o=f.ip.nj(o,this.Jc,2);var h=new f.Dd;return h.scale(1/this.ec,1/this.ec),l.Oc(h),l=f.ip.nj(l,this.Jc,2),0<=this.Ka?f.Gh.local().V(l,o,this.Jc,this.Ub):f.kp.local().V(l,o,this.Jc,this.Ub)},c.prototype.VN=function(o){return o=new x(this,o,null),o=f.Gh.local().V(o,this.Jc,this.Ub).next(),f.ip.nj(o,this.Jc,2)},c.prototype.SN=function(o){return o=new L(this,o),o=f.Gh.local().V(o,this.Jc,this.Ub).next(),f.ip.nj(o,this.Jc,2)},c.prototype.TN=function(o){(o=o.D()).scale(this.ec);var l=new f.Da;return this.sy(o,!1,l),f.ip.nj(l,this.Jc,2)},c.prototype.xy=function(o,l,h,m,g,v){var w=o[0],E=o[o.length-1],A=w.y>E.y?w.y:E.y,M=f.F.q(this.Tb,this.kc,w.y<E.y?w.y:E.y);if(A=f.F.q(this.Tb,this.kc,A),.001<this.LA-(M+l+this.rb)&&.001<this.LA+(A-l-this.rb))return!1;M=(l=h-1.570796326794897)-3.141592653589793,A=l+3.141592653589793;var I=(h=m+1.570796326794897)+3.141592653589793,D=[NaN],k=[NaN],B=[NaN],J=[NaN];if(m=!1,c.dJ(this.Tb,this.kc,this.rb,w,l,M,E,h,D,k),c.dJ(this.Tb,this.kc,this.rb,E,I,h,w,M,B,J),(h<D[0]&&D[0]<I||h<k[0]&&k[0]<I)&&(m=!0),m||(M<B[0]&&B[0]<l||M<J[0]&&J[0]<l)&&(m=!0),!m&&g)return!1;for(var Y=[],V=o.length-1;0<=V;V--)Y.push(o[V]);return v.Oa(),v.Yk(null,0),V=[0],c.qy(this.Tb,this.kc,this.ec,this.rb,this.ze,o,l,h,g,V,v),c.Hr(this.Tb,this.kc,this.ec,this.rb,E,h,I,this.ao,g,V,v,D[0],k[0]),c.qy(this.Tb,this.kc,this.ec,this.rb,this.ze,Y,I,A,g,V,v),c.Hr(this.Tb,this.kc,this.ec,this.rb,w,M,l,this.ao,g,V,v,B[0],J[0]),o=!1,g||(o=this.IE(this.ec,v)),m||o},c.prototype.sy=function(o,l,h){h.Oa(),h.Yk(null,0),c.Hr(this.Tb,this.kc,this.ec,this.rb,o,-this.ao,6.283185307179586,this.ao,l,[0],h,NaN,NaN),l||this.IE(this.ec,h)},c.prototype.IE=function(o,l){var h=this.vO(o,l);return o=this.wO(o,l),h||o},c.prototype.vO=function(o,l){var h=l.I(),m=!1,g=new f.l;if(l.A(g),!f.s.Y(g.H*o,1.570796326794897)&&!f.s.Y(g.G*o,-1.570796326794897))return!1;var v=new f.h;for(--h;0<=h;h--)l.D(h,v),(v.y==g.H&&f.s.Y(v.y*o,1.570796326794897)||v.y==g.G&&f.s.Y(v.y*o,-1.570796326794897))&&(m=!0,this.OI(v,h,l));return m},c.prototype.wO=function(o,l){var h=l.Na(0),m=l.Na(l.I()-1);return 3.141592653589793<Math.abs(h.x-m.x)*o?(this.VV(l),!0):this.uO(l)},c.prototype.uO=function(o){return 0>o.Ke()&&(this.UV(o),!0)},c.prototype.OI=function(o,l,h){var m=h.I(),g=0<l?l-1:m-1;if(m=h.Na(l<m-1?l+1:0),g=h.Na(g),!f.s.Y(m.y,o.y)&&!f.s.Y(m.x,o.x)){var v=new f.h;v.ma(m.x,o.y),h.Cb(l,v)}f.s.Y(g.y,o.y)||f.s.Y(g.x,o.x)||((m=new f.h).ma(g.x,o.y),h.wf(0,l,m))},c.prototype.VV=function(o){var l=new f.Da,h=new f.Da,m=new f.Dd,g=o.Na(0),v=o.Na(o.I()-1),w=new f.h;g.x>v.x?(v=this.zq,m.gg(-this.Js,0)):(v=-this.zq,m.gg(this.Js,0)),l.add(o,!1),o.Oa(),h.add(l,!1),h.Oc(m),g=new f.l,h.A(g),g.W((this.Js-g.R())/2,0),g.G=-this.zq,g.H=this.zq;for(var E=0;E<h.I();E++)h.D(E,w),l.wf(0,-1,w);for(h.Oc(m),E=0;E<h.I();E++)h.D(E,w),l.wf(0,-1,w);h=l.Na(0),m=l.Na(l.I()-1),w.ma(m.x,v),l.wf(0,-1,w),w.ma(.5*(m.x+h.x),v),l.wf(0,-1,w),w.ma(h.x,v),l.wf(0,-1,w),l=f.Hh.ks(l,this.Jc,2,!0,g.v),l=f.Hh.ks(l,this.Jc,2,!0,g.C),l=f.Ud.clip(l,g,this.Aq,NaN),o.add(l,!1)},c.prototype.UV=function(o){var l=new f.l;o.A(l),l.W((this.Js-l.R())/2,0),l.G=-this.zq,l.H=this.zq,o.Yk(null,0);var h=new f.h;h.ma(l.v,l.G),o.wf(1,-1,h),h.ma(l.v,l.H),o.wf(1,-1,h),h.ma(.5*(l.v+l.C),l.H),o.wf(1,-1,h),h.ma(l.C,l.H),o.wf(1,-1,h),h.ma(l.C,l.G),o.wf(1,-1,h),h.ma(.5*(l.v+l.C),l.G),o.wf(1,-1,h)},c.qy=function(o,l,h,m,g,v,w,E,A,M,I){var D=null;A||((D=new f.h).Rc(),0<I.I()&&(D.L(I.Na(I.I()-1)),D.scale(h)));var k=new f.ga(0),B=new f.ga(0),J=new f.ga(0),Y=new f.h,V=new f.h,te=v[v.length-1];h=1/h;for(var he=0;he<v.length;he++){var ue=v[he];if(he==0)var xe=w;else he==v.length-1?xe=E:(f.kb.wd(o,l,te.x,te.y,ue.x,ue.y,null,null,k,g),xe=k.u-1.570796326794897);f.kb.yi(o,l,ue.x,ue.y,m,xe,B,J),A?V.ma(B.u,J.u):(Y.ma(B.u,J.u),c.gJ(ue.x,Y.x,D.x,M),V.ma(M[0]+Y.x,Y.y),D.L(V)),V.scale(h),I.wf(0,-1,V)}},c.Hr=function(o,l,h,m,g,v,w,E,A,M,I,D,k){if(!(w-v<E)){var B=new f.ga(0),J=new f.ga(0),Y=new f.h,V=new f.h,te=null;A||((te=new f.h).Rc(),0<I.I()&&(te.L(I.Na(I.I()-1)),te.scale(h)));var he=f.O.truncate(Math.ceil(v/E)),ue=he++*E;for(ue==v&&(ue=he++*E),h=1/h;ue<w+E&&(v<D&&D<ue?(ue=D,he--):v<k&&k<ue&&(ue=k,he--),!(ue>=w));)f.kb.yi(o,l,g.x,g.y,m,ue,B,J),A?V.ma(B.u,J.u):(Y.ma(B.u,J.u),c.gJ(g.x,Y.x,te.x,M),V.ma(M[0]+Y.x,Y.y),te.L(V)),V.scale(h),I.wf(0,-1,V),v=ue,ue=he++*E}},c.dJ=function(o,l,h,m,g,v,w,E,A,M){var I=new f.h,D=new f.h,k=new f.ga(0),B=new f.ga(0);for(f.kb.yi(o,l,m.x,m.y,h,g,k,B),I.ma(k.u,B.u),f.kb.yi(o,l,m.x,m.y,h,v,k,B),D.ma(k.u,B.u),h=new f.ga(0),f.kb.Xy(o,l,w.x,w.y,I.x,I.y,h),A[0]=h.u,f.kb.Xy(o,l,w.x,w.y,D.x,D.y,h),M[0]=h.u;A[0]<=M[0];)A[0]+=6.283185307179586;for(;A[0]>M[0];)A[0]-=6.283185307179586;for(;A[0]>=E;)A[0]-=6.283185307179586,M[0]-=6.283185307179586;for(;A[0]<E;)A[0]+=6.283185307179586,M[0]+=6.283185307179586},c.gJ=function(o,l,h,m){if(isNaN(h)){for(;3.141592653589793<m[0]+l-o;)m[0]-=6.283185307179586;for(;3.141592653589793<o-(m[0]+l);)m[0]+=6.283185307179586}else 3.141592653589793<m[0]+l-h?m[0]-=6.283185307179586:3.141592653589793<h-(m[0]+l)&&(m[0]+=6.283185307179586)},c.KX=function(o,l){var h=o.getType(),m=f.aa.Hc(h)?o.da():h==550?o.I():1;if(m==1)return o;var g=new f.ia(0);g.resize(m);for(var v=[],w=new f.l,E=0;E<m;E++){if(g.write(E,E),f.aa.Hc(h)){o.Rj(E,w);var A=w.sf()}else A=o.Na(E);A=f.XK.$X(l,A),v[E]=A}for(g.Vd(0,g.size,function(M,I){return v[M]<v[I]?-1:v[M]>v[I]?1:0}),l=o.Ia(),E=0;E<m;E++)w=g.read(E),f.aa.Hc(h)?l.addPath(o,w,!0):l.Fd(o,w,w+1);return l},c.prototype.yX=function(){var o=Math.min(3.141592653589793*this.Tb-this.rb,this.rb);o=Math.min(o,.39269908169872414*this.Tb);var l=new f.h;l.ma(0,10*this.ec);var h=45*this.ec,m=new f.ga(0),g=new f.ga(0),v=new f.ga(0),w=new f.ga(0),E=new f.ga(0),A=new f.ga(0),M=new f.ga(0),I=new f.ga(0),D=new f.h,k=new f.h,B=new f.h,J=new f.h;f.kb.yi(this.Tb,this.kc,l.x,l.y,o,0,m,g),D.ma(m.u,g.u),f.kb.yi(this.Tb,this.kc,l.x,l.y,o,h,v,w),k.ma(v.u,w.u),m=new f.ga(0),g=new f.ga(0);for(var Y=new f.ga(0);f.kb.yi(this.Tb,this.kc,l.x,l.y,o,.5*(0+h),E,A),B.ma(E.u,A.u),f.kb.wd(this.Tb,this.kc,D.x,D.y,k.x,k.y,m,g,null,2),f.kb.oj(this.Tb,this.kc,D.x,D.y,.5*m.u,g.u,M,I,2),J.ma(M.u,I.u),f.kb.wd(this.Tb,this.kc,B.x,B.y,J.x,J.y,Y,null,null,2),!(Y.u<=this.$n);)h*=.9,f.kb.yi(this.Tb,this.kc,l.x,l.y,o,h,v,w),k.ma(v.u,w.u);this.ao=6.283185307179586/Math.ceil(6.283185307179586/(h-0))},c.prototype.zX=function(){var o=Math.min(3.141592653589793*this.Tb-this.rb,this.rb);o=Math.min(o,.39269908169872414*this.Tb);var l=new f.h,h=new f.h;l.ma(0,10*this.ec),h.ma(10*this.ec,10*this.ec);var m=new f.ga(0),g=new f.ga(0),v=new f.ga(0);f.kb.wd(this.Tb,this.kc,l.x,l.y,h.x,h.y,v,m,g,this.ze);var w=new f.ga(0),E=new f.ga(0),A=new f.ga(0),M=new f.ga(0),I=new f.h,D=new f.ga(0),k=new f.ga(0),B=new f.ga(0),J=new f.ga(0),Y=new f.ga(0),V=new f.ga(0),te=new f.ga(0),he=new f.ga(0),ue=new f.ga(0),xe=new f.h,be=new f.h,Le=new f.h,Xe=new f.h,qe=1;m=m.u,g=g.u+1.570796326794897,v=v.u,f.kb.yi(this.Tb,this.kc,l.x,l.y,o,m-1.570796326794897,k,B),xe.ma(k.u,B.u),f.kb.yi(this.Tb,this.kc,h.x,h.y,o,g,J,Y),be.ma(J.u,Y.u),k=new f.ga(0),B=new f.ga(0),g=new f.ga(0);for(var xt=new f.ga(0);f.kb.oj(this.Tb,this.kc,l.x,l.y,.5*(0+qe)*v,m,w,E,this.ze),I.ma(w.u,E.u),f.kb.wd(this.Tb,this.kc,l.x,l.y,I.x,I.y,null,null,D,this.ze),f.kb.yi(this.Tb,this.kc,I.x,I.y,o,D.u+1.570796326794897,V,te),Le.ma(V.u,te.u),f.kb.wd(this.Tb,this.kc,xe.x,xe.y,be.x,be.y,k,B,null,2),f.kb.oj(this.Tb,this.kc,xe.x,xe.y,.5*k.u,B.u,he,ue,2),Xe.ma(he.u,ue.u),f.kb.wd(this.Tb,this.kc,Le.x,Le.y,Xe.x,Xe.y,g,null,null,2),!(g.u<=this.$n);)qe*=.9,f.kb.oj(this.Tb,this.kc,l.x,l.y,qe*v,m,A,M,this.ze),h.ma(A.u,M.u),f.kb.wd(this.Tb,this.kc,l.x,l.y,h.x,h.y,null,null,xt,this.ze),f.kb.yi(this.Tb,this.kc,h.x,h.y,o,xt.u+1.570796326794897,J,Y),be.ma(J.u,Y.u);1e5<(o=qe*v)&&(o=1e5),this.QA=o},c.prototype.xX=function(){var o=5e4<this.rb?100:1e4<this.rb?10:1;500>this.rb/o&&(o=this.rb/500),.01>o&&(o=.01),this.$n=o},c}();f.VK=d}(Q||(Q={})),function(f){var L=function(){function x(){}return x.Mf=function(d,c){var o=new f.h;o.L(c),d.push(o)},x.up=function(d,c){d.add(c.x),d.add(c.y)},x.hB=function(d){d.Bh(d.size-2)},x.oB=function(d,c){c.ma(d.get(d.size-2),d.get(d.size-1))},x.Qr=function(d,c,o,l,h,m){if(d==null)throw f.i.N();var g=d.getType();if(d.B()||f.aa.Rn(g))return d;var v=new x;v.Qg=c,v.Jc=f.cb.sc(c);var w=f.cb.vv(v.Jc);if(v.Ub=m,v.Tb=f.cb.ev(v.Jc),v.kc=w*(2-w),v.ec=v.Jc.Hd().ai,v.Aq=v.Jc.Kn(),v.Zs=v.Aq*v.ec,v.AA=l,v.zA=h,v.ze=o,g==197?(o=new f.Da(d.description)).ad(d,!1):f.aa.yd(g)?(o=new f.Ta(d.description)).oc(d,!0):o=d,v.ze!=4){if((c=v.Qg.Nb(v.Jc)==0?f.cb.zh(o,v.Qg,v.Jc):f.Hh.lj(o,v.Jc)).B())return c;c=x.pI(v.ec,c),c=v.Zy(c),c=f.ip.nj(c,v.Jc,v.ze),v=f.cb.zh(c,v.Jc,v.Qg)}else{if(f.Eg.Sb(c)==2?(d=f.cb.ml(),(c=f.Xj.local().V(o,d,c,m))==d&&(c=new f.Da,d.copyTo(c))):c=f.Hh.lj(o,v.Jc),c.B())return c;v=v.CX(c)}return v},x.pI=function(d,c){var o=new f.l;if(c.xc(o),3.141592653589793>o.R()*d)return c;var l=!1;o=c.Ga();for(var h=new f.h,m=new f.h;o.$a();)for(;o.Ha();){var g=o.ha();if(h.L(g.ac()),m.L(g.wc()),h.scale(d),m.scale(d),3.141592653589793<Math.abs(h.x-m.x)){var v=x.Lu(h,m);if(!v){l=!0;break}if(6.283185307179586<Math.abs(h.x-m.x)){l=!0;break}}}if(!l)return c;l=c.Ia();var w=1<c.description.Aa,E=new f.h,A=new f.h,M=new f.h,I=new f.h,D=new f.Sa;for(o.Zi();o.$a();)for(var k=NaN,B=[0];o.Ha();){if(g=o.ha(),h.L(g.ac()),m.L(g.wc()),h.scale(d),m.scale(d),isNaN(k)?(x.Wi(h.x,NaN,B),A.L(h)):A.L(M),k=A.x,v=x.Lu(h,m)){if(6.283185307179586<m.x-h.x)for(;6.283185307179586<m.x-h.x;)m.x-=6.283185307179586;if(-6.283185307179586>m.x-h.x)for(;-6.283185307179586>m.x-h.x;)m.x+=6.283185307179586;x.Wi(m.x,NaN,B),M.L(m)}else E.L(m),x.AU(E),x.Wi(E.x,k,B),M.ma(B[0]+E.x,E.y);.5>Math.abs(M.x-m.x)&&M.L(m),w?(g.Tw(0,D),I.L(A),I.scale(1/d),D.Cb(I),(v=o.vm())?l.nf(D):l.lineTo(D),o.Qn()&&!c.dc(o.gb)&&(g.Tw(1,D),I.L(M),I.scale(1/d),D.Cb(I),l.lineTo(D))):((v=o.vm())&&l.Hz(null,0),g=l.da()-1,I.L(A),I.scale(1/d),l.wf(g,-1,I),o.Qn()&&!c.dc(o.gb)&&(I.L(M),I.scale(1/d),l.wf(g,-1,I)))}return l},x.tF=function(d,c,o,l,h,m,g,v,w,E,A,M){var I=new f.h,D=new f.h,k=0<l.compare(h);x.fJ(k,l,h,I,D),x.uF(d,c,o,I,D,m,NaN,g,v,w,E,null,A,M),k&&x.fC(w,E,null,A)},x.prototype.Zy=function(d){var c=d.Ia(),o=d.Ga(),l=[],h=null,m=null,g=1<d.description.Aa;g&&(h=new f.be(0),m=new f.ig);for(var v=[0],w=new f.h,E=new f.h,A=new f.h,M=new f.h;o.$a();)for(v[0]=0;o.Ha();){var I=o.ha();w.L(I.ac()),E.L(I.wc()),w.scale(this.ec),E.scale(this.ec);var D=0<w.compare(E);x.fJ(D,w,E,A,M),l.length=0,h?.Bh(0),0<this.AA?x.uF(this.Tb,this.kc,this.ze,A,M,this.AA,this.zA,this.Zs,null,null,null,g?h:null,l,v):x.aR(this.Tb,this.kc,this.ze,A,M,this.zA,this.Zs,g?h:null,l,v),D&&x.fC(null,null,g?h:null,l),l[0].L(I.ac()),l[l.length-1].L(I.wc());for(var k=1;k<l.length-1;k++)l[k].scale(1/this.ec);g?(D=x.eJ(D,I,m),x.TD(o.vm(),o.Qn()&&!d.dc(o.gb),I,D,h,l,c)):x.SD(o.vm(),o.Qn()&&!d.dc(o.gb),l,c)}return c},x.prototype.CX=function(d){var c=d.Ia(),o=d.Ga(),l=[],h=null,m=new f.ig,g=1<d.description.Aa;for(g&&(h=new f.be(0));o.$a();)for(;o.Ha();){var v=o.ha(),w=v.ac(),E=v.wc();w=0<w.compare(E),E=x.eJ(w,v,m),l.length=0,h?.Bh(0),x.BX(this.Tb,this.kc,this.ec,E,this.Qg,this.AA,this.zA,g?h:null,l),w&&x.fC(null,null,g?h:null,l),g?x.TD(o.vm(),o.Qn()&&!d.dc(o.gb),v,E,h,l,c):x.SD(o.vm(),o.Qn()&&!d.dc(o.gb),l,c)}return c},x.SD=function(d,c,o,l){d&&l.Hz(null,0),d=l.da()-1;var h=o.slice(0);l.qG(d,h,h.length-1),c&&l.wf(d,-1,o[o.length-1])},x.TD=function(d,c,o,l,h,m,g){var v=new f.Sa;if(o.To(v),d?g.nf(v):g.lineTo(v),2<m.length){d=l.Qb();for(var w=1;w<m.length-1;w++){var E=l.NG(h.get(w)*d);l.Tw(E,v),v.Cb(m[w]),g.lineTo(v)}}c&&(o.Po(v),g.lineTo(v))},x.uF=function(d,c,o,l,h,m,g,v,w,E,A,M,I,D){var k=new f.ga(0),B=new f.ga(0),J=new f.ga(0);f.kb.wd(d,c,l.x,l.y,h.x,h.y,J,k,B,o),J=J.u;var Y=k=k.u;0>Y&&(Y+=6.283185307179586),0>(B=B.u)&&(B+=6.283185307179586),w!=null&&(w[0]=J),E!=null&&(E[0]=Y),A!=null&&(A[0]=B),E=w=NaN,M!=null&&(w=((E=f.F.Ah(d,c))-(A=f.F.q(d,c,l.y)))/J,E=(E+A)/J),A=x.Mu(l,h),B=x.Ku(l,h),Y=A||B;var V=x.FE(l,h,v),te=new f.ga(0),he=new f.ga(0),ue=new f.h,xe=new f.h,be=new f.h;x.Wi(l.x,NaN,D);var Le=[D[0]];if(J<=m)x.Mf(I,l),x.Wi(h.x,NaN,D),M?.add(0),Y?(A&&x.kB(l,h,M,I),B&&x.iB(l,h,M,I)):V?x.jB(l,h,k,w,E,M,I):0<g&&(xe.ma(l.x-Le[0],l.y),ue.ma(h.x-D[0],h.y),x.Yy(d,c,o,l,J,k,xe,ue,0,1,g,M,I,Le)),x.Mf(I,h);else{var Xe=J/((m=1+f.O.truncate(Math.ceil(J/m)))-1),qe=new f.h,xt=0;x.Mf(I,l),qe.L(l),xe.ma(l.x-D[0],l.y),M?.add(0);for(var it=1;it<m;it++){if(it<m-1){f.kb.oj(d,c,l.x,l.y,it*Xe,k,te,he,o),ue.ma(te.u,he.u),x.Wi(ue.x,qe.x,D),be.ma(D[0]+ue.x,ue.y);var hi=it/(m-1)}else x.Wi(h.x,NaN,D),ue.ma(h.x-D[0],h.y),be.L(h),hi=1;Y?(it==1&&A&&x.kB(l,be,M,I),it==m-1&&B&&x.iB(qe,h,M,I)):V?x.EE(qe,be,v)&&(l.x<h.x?qe.x>be.x&&(D[0]+=6.283185307179586,be.ma(D[0]+ue.x,ue.y)):qe.x<be.x&&(D[0]-=6.283185307179586,be.ma(D[0]+ue.x,ue.y)),x.jB(qe,be,k,w,E,M,I)):0<g&&x.Yy(d,c,o,l,J,k,xe,ue,xt,hi,g,M,I,Le),x.Mf(I,be),M?.add(hi),qe.L(be),xe.L(ue),Le[0]=D[0],xt=hi}}},x.aR=function(d,c,o,l,h,m,g,v,w,E){var A=new f.ga(0),M=new f.ga(0),I=new f.ga(0);f.kb.wd(d,c,l.x,l.y,h.x,h.y,I,A,M,o),M=I.u,A=A.u;var D=I=NaN;if(v!=null){D=f.F.Ah(d,c);var k=f.F.q(d,c,l.y);I=(D-k)/M,D=(D+k)/M}k=x.Mu(l,h);var B=x.Ku(l,h),J=k||B;g=x.FE(l,h,g);var Y=x.Lu(l,h);Y=J||g||Y,x.Wi(l.x,NaN,E);var V=new f.h;x.Mf(w,l),V.L(l),v?.add(0),Y?(J?(k&&x.kB(l,h,v,w),B&&x.iB(l,h,v,w)):g&&x.jB(l,h,A,I,D,v,w),x.Wi(h.x,NaN,E),x.Mf(w,h)):M<=m?(x.Wi(h.x,NaN,E),x.Mf(w,h)):(I=new f.h,g=new f.h,I.L(l),g.L(h),I.x-=E[0],g.x-=E[0],-3.141592653589793>g.x?g.x+=6.283185307179586:3.141592653589793<g.x&&(g.x-=6.283185307179586),x.Yy(d,c,o,l,M,A,I,g,0,1,m,v,w,E),x.Mf(w,h),x.Wi(h.x,NaN,E)),v?.add(1)},x.Yy=function(d,c,o,l,h,m,g,v,w,E,A,M,I,D){var k=new f.h,B=new f.h;k.ma(g.x+D[0],g.y),new f.ga(0),new f.ga(0),new f.ga(0),new f.ga(0);var J=new f.ga(0),Y=new f.ga(0),V=new f.ga(0),te=new f.h,he=new f.h,ue=new f.h,xe=new f.h;te.L(g),he.L(v),g=new f.be(0),v=new f.be(0),x.up(g,he),v.add(E);var be=new f.h,Le=new f.yb,Xe=[];for(x.YJ(4,Xe);0<g.size;){for(var qe,xt=!1,it=NaN,hi=0;3>hi;hi++)if(qe=Xe[hi]*E+(1-Xe[hi])*w,f.kb.oj(d,c,l.x,l.y,qe*h,m,J,Y,o),ue.ma(J.u,Y.u),hi==0&&(it=qe,xe.L(ue)),x.WW(te,ue,he,Le),Le.hc(Le.fe(ue,!0),be),f.kb.wd(d,c,ue.x,ue.y,be.x,be.y,V,null,null,2),V.u>A){xt=!0;break}xt?(he.L(xe),E=it,x.up(g,he),v.add(E)):(x.hB(g),v.En(v.size-1,1,v.size-1),0<g.size&&(x.Wi(he.x,k.x,D),B.ma(D[0]+he.x,he.y),x.Mf(I,B),k.L(B),M?.add(E),te.L(he),w=E,x.oB(g,he),E=v.get(v.size-1)))}},x.BX=function(d,c,o,l,h,m,g,v,w){var E=new f.h,A=new f.h,M=new f.h,I=new f.h,D=new f.h,k=new f.h,B=new f.h,J=new f.h,Y=new f.h,V=new f.h,te=new f.ga(0),he=new f.ga(0),ue=new f.h,xe=[[],[]],be=f.Eg.Sb(h)==1;h=h.Xd(0);var Le=l.ac(),Xe=l.wc();be?(k.ma(Le.x*o,Le.y*o),B.ma(Xe.x*o,Xe.y*o)):(xe[0][0]=Le.x,xe[0][1]=Le.y,xe[1][0]=Xe.x,xe[1][1]=Xe.y,f.cb.vt(),k.x=xe[0][0]*o,k.y=xe[0][1]*o,B.x=xe[1][0]*o,B.y=xe[1][1]*o);var qe=0,xt=0,it=1,hi=l.Pn();E.L(Le),A.L(Xe),Xe=new f.be(0);var ai=new f.be(0),yt=new f.be(0);x.up(Xe,A),x.up(ai,B),yt.add(it),x.Mf(w,E),v?.add(xt);var Or=[],xn=0<g?hi?5:3:hi?5:1;x.YJ(xn,Or);for(var Pr=new f.ga(0),Ri=new f.ga(0),Vi=new f.ga(0),Ei=new f.ga(0),Ki=new f.ga(0),bi=new f.ga(0),uo=new f.ga(0);0<ai.size;){var Zi=!1,Es=NaN;for(f.kb.wd(d,c,k.x,k.y,B.x,B.y,Pr,Ri,null,2),Le=0;Le<xn&&!(Le==0&&(!hi&&0>=g&&Pr.u<=m&&3.141592653589793>Math.abs(k.x-B.x)||l.Ux(xt,it)<=h));Le++){var Er=Or[Le]*it+(1-Or[Le])*xt;if(l.hc(Er,M),be?J.ma(M.x*o,M.y*o):(xe[0][0]=M.x,xe[0][1]=M.y,f.cb.vt(),J.x=xe[0][0]*o,J.y=xe[0][1]*o),Le==0&&(Es=Er,D.L(M),V.L(J),0<m&&(Pr.u>m||3.141592653589793<=Math.abs(k.x-B.x)))){Zi=!0;break}if(hi&&0<m){if(f.kb.wd(d,c,k.x,k.y,J.x,J.y,Vi,null,null,2),Vi.u>m||3.141592653589793<=Math.abs(k.x-J.x)){Zi=!0;break}}else if(0<g){if(hi?(I.NS(E,A,Or[Le]),be?Y.ma(I.x*o,I.y*o):(xe[0][0]=I.x,xe[0][1]=I.y,f.cb.vt(),Y.x=xe[0][0]*o,Y.y=xe[0][1]*o)):(I.L(M),Y.L(J)),f.kb.wd(d,c,k.x,k.y,Y.x,Y.y,Ei,null,null,2),!(Ei.u<=Pr.u)){Zi=!0;break}if(f.kb.oj(d,c,k.x,k.y,Ei.u,Ri.u,te,he,2),ue.ma(te.u,he.u),f.kb.wd(d,c,ue.x,ue.y,J.x,J.y,Ki,null,null,2),Ki.u>g){Zi=!0;break}if(hi){if(f.kb.wd(d,c,ue.x,ue.y,Y.x,Y.y,bi,null,null,2),bi.u>g){Zi=!0;break}if(f.kb.wd(d,c,Y.x,Y.y,J.x,J.y,uo,null,null,2),uo.u>g){Zi=!0;break}}}}Zi?(A.L(D),B.L(V),it=Es,x.up(Xe,A),x.up(ai,B),yt.add(it)):(x.hB(Xe),x.hB(ai),yt.En(yt.size-1,1,yt.size-1),x.Mf(w,A),qe+=Pr.u,v?.add(qe),0<ai.size&&(E.L(A),k.L(B),xt=it,x.oB(Xe,A),x.oB(ai,B),it=yt.get(yt.size-1)))}if(v!=null)for(d=1/qe,Le=0;Le<v.size;Le++)v.write(Le,v.read(Le)*d)},x.fC=function(d,c,o,l){l.reverse(),o?.ni(0,o.size,1),o=d!=null?d[0]:NaN,l=c!=null?c[0]:NaN,d!=null&&(d[0]=l),c!=null&&(c[0]=o)},x.fJ=function(d,c,o,l,h){d?(l.L(o),h.L(c)):(l.L(c),h.L(o))},x.eJ=function(d,c,o){return d?(o.create(c.getType()),c.copyTo(o.get()),o.get().reverse(),o.get()):c},x.Wi=function(d,c,o){if(isNaN(c)){for(;3.141592653589793<o[0]-d;)o[0]-=6.283185307179586;for(;3.141592653589793<d-o[0];)o[0]+=6.283185307179586}else 3.141592653589793<o[0]+d-c?o[0]-=6.283185307179586:3.141592653589793<c-(o[0]+d)&&(o[0]+=6.283185307179586)},x.WW=function(d,c,o,l){3.141592653589793>Math.abs(c.x-d.x)?(l.Dc(d),3.141592653589793<=o.x-d.x?l.Ql(o.x-6.283185307179586,o.y):3.141592653589793<=d.x-o.x?l.Ql(o.x+6.283185307179586,o.y):l.Ql(o.x,o.y)):(l.Dc(o),3.141592653589793<=d.x-o.x?l.Ql(d.x-6.283185307179586,d.y):3.141592653589793<=o.x-d.x?l.Ql(d.x+6.283185307179586,d.y):l.Ql(d.x,d.y))},x.YJ=function(d,c){for(var o=0;o<d;o++){var l=Math.ceil(o/2)/(d+1);o%2!=0&&(l=-l),c[o]=.5+l}},x.Mu=function(d,c){return!!(f.s.Y(d.y,1.570796326794897)&&!f.s.Y(c.y,1.570796326794897)||f.s.Y(d.y,-1.570796326794897)&&!f.s.Y(c.y,-1.570796326794897))},x.Ku=function(d,c){return!!(f.s.Y(c.y,1.570796326794897)&&!f.s.Y(d.y,1.570796326794897)||f.s.Y(c.y,-1.570796326794897)&&!f.s.Y(d.y,-1.570796326794897))},x.FE=function(d,c,o){return!(!x.EE(d,c,o)||f.s.Y(d.y,1.570796326794897)||f.s.Y(d.y,-1.570796326794897)||f.s.Y(c.y,1.570796326794897)||f.s.Y(c.y,-1.570796326794897))},x.EE=function(d,c,o){return Math.abs(Math.abs(d.x-c.x)-3.141592653589793)<=o},x.Lu=function(d,c){return!!(f.s.Y(d.y,1.570796326794897)&&f.s.Y(c.y,1.570796326794897)||f.s.Y(d.y,-1.570796326794897)&&f.s.Y(c.y,-1.570796326794897))},x.kB=function(d,c,o,l){if(0<d.y){var h=new f.h;h.ma(c.x,1.570796326794897)}else(h=new f.h).ma(c.x,-1.570796326794897);f.s.Y(d.x,h.x)||f.s.Y(c.y,h.y)||(x.Mf(l,h),o?.add(0))},x.iB=function(d,c,o,l){if(0<c.y){var h=new f.h;h.ma(d.x,1.570796326794897)}else(h=new f.h).ma(d.x,-1.570796326794897);f.s.Y(c.x,h.x)||f.s.Y(d.y,h.y)||(x.Mf(l,h),o?.add(1))},x.jB=function(d,c,o,l,h,m,g){f.s.Cd(o)?(0<1.570796326794897-d.y&&((o=new f.h).ma(d.x,1.570796326794897),x.Mf(g,o),m?.add(l)),0<1.570796326794897-c.y&&((o=new f.h).ma(c.x,1.570796326794897),x.Mf(g,o),m?.add(l))):(0<1.570796326794897+d.y&&((o=new f.h).ma(d.x,-1.570796326794897),x.Mf(g,o),m?.add(h)),0<1.570796326794897+c.y&&((o=new f.h).ma(c.x,-1.570796326794897),x.Mf(g,o),m?.add(h)))},x.AU=function(d){if(-3.141592653589793>d.x)for(;-3.141592653589793>d.x;)d.x+=6.283185307179586;if(3.141592653589793<d.x)for(;3.141592653589793<d.x;)d.x-=6.283185307179586},x}();f.cj=L}(Q||(Q={})),function(f){f.ip=function(){function L(){}return L.nj=function(x,d,c){if(x==null||d==null||!f.cb.Wc(d))throw f.i.N();if(x.B())return x;var o=x,l=o.getType();if(f.aa.Hc(l)){o=f.Hh.lj(x,d),x=new f.l,o.A(x),l=f.ta.Wd(d,x,!1);for(var h=f.cb.gh(d),m=Math.floor((x.v-h.v)/h.R())*h.R()+h.v;m<x.C;)m>x.v+l&&m<x.C-l&&(o=f.Hh.ks(o,d,c,!0,m)),m+=h.R()}else{if(l==197)return(x=new f.Da(o.description)).ad(o,!1),L.nj(x,d,c);if(f.aa.yd(l))return(x=new f.Ta(o.description)).oc(o,!0),L.nj(x,d,c)}return L.Uy(o,d)},L.Uy=function(x,d){if(x==null||d==null||!f.cb.Wc(d))throw f.i.N();if(x.B())return x;var c=x.getType();return c==197?(c=new f.Da(x.description)).ad(x,!1):f.aa.yd(c)?(c=new f.Ta(x.description)).oc(x,!0):c=x,(c=f.Hh.lj(c,d)).B()?c:f.Eg.Sb(d)==1?f.Hh.Fn(c,d,0,c!=x,0):L.NQ(c,d,c!=x)},L.NQ=function(x,d,c){if(!f.cb.Wc(d))throw f.i.N();if(x.B())return x;var o=f.cb.bf(d),l=-180*o;return o*=360,f.Eg.Sb(d)==2&&(o=(l=f.cb.gh(d)).C,o-=l=l.v),f.Hh.Hp(x,l,o,d,c,0,!0)},L}()}(Q||(Q={})),function(f){f.BY=function(){function L(){}return L.P=function(x){return 0>x?-x:x},L.Mb=function(x,d){return 0<=d?L.P(x):-L.P(x)},L.Y=function(x,d){return x==d||L.P(x-d)<=L.JC*(1+(L.P(x)+L.P(d))/2)},L.Cd=function(x){return x==0||L.P(x)<=L.JC},L.Ah=function(x,d){var c=(d=(1-(d=Math.sqrt(1-d)))/(1+d))*d;return x/(1+d)*(1+c*(.25+c*(.015625+1/256*c)))*L.EL},L.EL=1.5707963267948966,L.JC=3552713678800501e-30,L}()}(Q||(Q={})),function(f){var L=function(d){this.Wf=d,this.Kk=this.Wf.getCode(),0>this.Kk&&(this.Kk=0)};f.DY=L;var x=function(){function d(c){c===void 0&&(c=null),this.Cj=null,this.Un=!1,c!==null&&(this.Cj=new L(c))}return d.prototype.Ec=function(){return this.Cj!=null?this.Cj.Kk:0},d.prototype.Of=function(){var c=new d;return this.copyTo(c),c},d.prototype.copyTo=function(c){c.Cj=this.Cj,c.Un=this.Un},d.prototype.Qz=function(){this.Un=!this.Un},d.prototype.qm=function(){return this.Cj!=null?this.Cj.Wf:null},d.prototype.LJ=function(c){if(0>=c)throw f.i.N();if(c!=this.Ec()){if((c=f.pf.geogtran(c))==null)throw f.i.N("Geogtran not found.");this.Cj=new L(c)}},d.prototype.Bz=function(){return this.Cj==null?null:this.Cj.Wf.toString()},d.prototype.tX=function(c){if(c==null)throw f.i.N();var o=null;try{o=f.pf.fromString(f.Sc.PE_TYPE_GEOGTRAN,c)}catch{throw f.i.N()}this.Cj=new L(o)},d.prototype.Nb=function(c){return c==this||!(!(c instanceof d)||(0>=this.Ec()||this.Ec()!=c.Ec())&&!this.qm().isEqual(c.qm()))&&this.Un==c.Un},d.prototype.toString=function(){var c="GeographicTransformation: "+this.Bz();return 200<c.length?c.substring(0,197)+"... ("+c.length.toString()+" characters)":c},d.create=function(c,o){var l=new d;return l.LJ(c),o&&l.Qz(),l},d.uP=function(c,o){var l=new d;return l.tX(c),o&&l.Qz(),l},d}();f.Dx=x}(Q||(Q={})),function(f){var L=function(){function d(){}return d.construct=function(c,o,l,h){var m=new d;return m.hw=c,m.iw=o,m.QY=l,m.RY=h,m},d.Ey=function(c,o){return c.hw==o.hw?c.iw==o.iw?0:c.iw<o.iw?-1:1:c.hw<o.hw?-1:1},d}(),x=function(){function d(){this.yT=[],this.zT=[],this.qp()}return d.kz=function(){return d.jK==null&&(d.jK=new d),d.jK},d.prototype.qp=function(){this.iD(this.yT),this.iD(this.zT)},d.prototype.iD=function(c){try{var o=[];o=o.sort(L.Ey);for(var l=0;l<o.length;l++)c.push(o[l])}catch{}},d}();f.CY=x}(Q||(Q={})),function(f){var L=function(){function x(){}return x.prototype.yD=function(d){this.Fk=d},x.prototype.WM=function(d){this.Fb=d},x.prototype.xD=function(d){this.zo=d},x.CE=function(d){return!(d.B()||d.getType()!=1607&&d.getType()!=1736)},x.AE=function(d){return!(d.B()||d.getType()!=1607&&d.getType()!=1736||20>d.I())},x.BE=function(d){return!(d.B()||d.getType()!=1607&&d.getType()!=1736||20>d.I())},x}();f.Uk=L}(Q||(Q={})),function(f){f.$b=function(){function L(){}return L.TT=function(x){var d=new f.Da;return d.sx(x.es(),x.gs()),d.yj(x.es(),x.fs()),d.yj(x.ds(),x.fs()),d.yj(x.ds(),x.gs()),d},L.zh=function(x,d){return x===null?null:f.Hx.local().V(x,d,null)},L.jY=function(x,d){var c=f.Gh.local();return x=new f.Zc(x),c.V(x,d,null).next()},L.im=function(x,d,c){return f.kp.local().V(x,d,c,null)},L.ep=function(x,d,c){return f.Kx.local().V(x,d,c,null)},L.VX=function(x,d,c){var o=f.Kx.local();for(x=new f.Zc(x),d=new f.Zc(d),c=o.V(x,d,c,null),o=[];(d=c.next())!=null;)o.push(d);return o},L.Nb=function(x,d,c){return f.dj.local().V(3,x,d,c,null)},L.TP=function(x,d,c){return f.dj.local().V(4,x,d,c,null)},L.RS=function(x,d,c){var o=f.Xj.local();for(x=new f.Zc(x),d=new f.Zc(d),c=o.V(x,d,c,null),o=[];(d=c.next())!=null;)o.push(d);return o},L.QP=function(x,d,c){var o=f.kp.local();for(x=new f.Zc(x),d=new f.Zc(d),c=o.V(x,d,c,null),o=[];(d=c.next())!=null;)o.push(d);return o},L.Ea=function(x,d,c){return f.Xj.local().V(x,d,c,null)},L.QS=function(x,d,c){if((x=f.Xj.local().V(x,d,c,null,1))===null)return[];if(x.getType()===550){for(d=[],c=0;c<x.wa;c++)d.push(x.KR(c));return d}return x.getType()===33?[x]:[]},L.qY=function(x,d,c){return f.dj.local().V(2,x,d,c,null)},L.contains=function(x,d,c){return f.dj.local().V(1,x,d,c,null)},L.BP=function(x,d,c){return f.dj.local().V(16,x,d,c,null)},L.touches=function(x,d,c){return f.dj.local().V(8,x,d,c,null)},L.DU=function(x,d,c){return f.dj.local().V(32,x,d,c,null)},L.TS=function(x,d,c){return f.dj.local().V(1073741824,x,d,c,null)},L.yB=function(x,d,c,o){return f.zL.local().V(x,d,c,o,null)},L.tb=function(x,d,c,o){var l=null;if(c!=null){if(l=c.Hd(),o!=null&&l.Ec()!=o.Ec()&&l.od!=o.od)throw f.i.Xk()}else if(o!=null)throw f.i.N();return x=f.rL.local().V(x,d,null),l!==null&&o!==null&&(x=f.Tc.Nh(x,l,o)),x},L.clip=function(x,d,c){return f.kL.local().V(x,f.l.construct(d.es(),d.gs(),d.ds(),d.fs()),c,null)},L.dl=function(x,d,c){if(x==null||d==null)return null;for(x=f.mL.local().V(!0,x,d,c,null),d=[];(c=x.next())!=null;)c.B()||d.push(c);return d.slice(0)},L.MN=function(x,d,c,o,l,h,m,g){if(l===!0)return L.NN(x,d,c,o,h,m,g);if(l=c,d!=null){if(m=d.Hd(),o!=null&&m.Ec()!=o.Ec()){if(m.od!=o.od)throw f.i.Xk();l=[],f.Tc.XE(c,c.length,o,m,l)}}else if(o!=null)throw f.i.N();if(c=f.AC.local(),h){for(x=new f.Zc(x),d=c.V(x,d,l,h,null),x=[];(h=d.next())!=null;)x.push(h);h=x.slice(0)}else for(h=[],o=0;o<x.length;o++)h[o]=c.V(x[o],d,l[o],null);return h},L.NN=function(x,d,c,o,l,h,m){if(d===null||(o==null&&(o=d.Ec()!==4326?d.Hd():f.Tc.Zg(9001)),o.od!==0))throw f.i.N();if(f.Tc.XE(c,c.length,o,f.Tc.Zg(9001),c),o=f.FC.local(),l){for(x=new f.Zc(x),d=o.V(x,d,h,c,m,!1,l,null),c=[];(h=d.next())!=null;)c.push(h);l=c.slice(0)}else{l=[];for(var g=0;g<x.length;g++)l[g]=o.V(x[g],d,h,c[g],m,!1,null)}return l},L.buffer=function(x,d,c,o,l,h,m){var g=c;if(l===!1){if(d!=null){if(l=d.Hd(),o!=null&&l.Ec()!=o.Ec()){if(l.od!=o.od)throw f.i.Xk();g=f.Tc.Nh(c,o,l)}}else if(o!=null)throw f.i.N();x=f.AC.local().V(x,d,g,null)}else{if(d===null||(o==null&&(o=d.Ec()!==4326?d.Hd():f.Tc.Zg(9001)),o.od!==0))throw f.i.N();g=f.Tc.Nh(c,o,f.Tc.Zg(9001)),x=f.FC.local().V(x,d,h,g,m,!1,null)}return x},L.BU=function(x,d,c,o,l,h,m){if(d!=null){var g=d.Hd();if(m!=null&&g.Ec()!=m.Ec()){if(g.od!=m.od)throw f.i.Xk();c=f.Tc.Nh(c,m,g)}}else if(m!=null)throw f.i.N();for(x=new f.Zc(x),d=f.IC.local().V(x,d,c,o,l,h,null),c=[];(o=d.next())!=null;)c.push(o);return c.slice(0)},L.offset=function(x,d,c,o,l,h,m){if(d!=null){var g=d.Hd();if(m!=null&&g.Ec()!=m.Ec()){if(g.od!=m.od)throw f.i.Xk();c=f.Tc.Nh(c,m,g)}}else if(m!=null)throw f.i.N();return f.IC.local().V(x,d,c,o,l,h,null)},L.iP=function(x){return f.CC.local().V(x,null)},L.jP=function(x,d){var c=f.CC.local();for(x=new f.Zc(x),d=c.V(x,d,null),c=[];(x=d.next())!=null;)c.push(x);return c},L.nz=function(x,d,c){return f.Ix.local().nz(x,d,c)},L.oz=function(x,d){return f.Ix.local().oz(x,d)},L.pz=function(x,d,c,o){return f.Ix.local().pz(x,d,c,o)},L.eC=function(x,d){return f.Yl.local().V(x,d,!1,null)},L.dT=function(x,d){return f.Yl.local().rs(x,d,null)},L.QQ=function(x,d,c,o,l){var h=f.EC.local();if(d!=null){if(d=d.Hd(),l!=null&&d.Ec()!=l.Ec()){if(d.od!=l.od)throw f.i.Xk();c=f.Tc.Nh(c,l,d)}}else if(l!=null)throw f.i.N();return h.V(x,c,o,null)},L.Qr=function(x,d,c,o){var l=f.Xl.local();if(d!=null){if(d=d.Hd(),o!=null&&d.Ec()!=o.Ec()){if(d.od!=o.od)throw f.i.Xk();c=f.Tc.Nh(c,o,d)}}else if(o!=null)throw f.i.N();return l.V(x,c,null)},L.Wy=function(x,d,c,o,l){l===void 0&&(l=0);var h=f.tL.local();if(l==4||l!==0)throw f.i.Ie();if(o!==null){if(o.od!==0)throw f.i.N("Unit must be a linear unit type");c=f.Tc.Nh(c,o,f.Tc.Zg(9001))}return h.V(x,c,d,l,null)},L.WQ=function(x,d,c,o){if(x===null)return 0;if(o==4||o!==0)throw f.i.Ie();if(x.getType()==197)x=L.TT(x);else if(x.getType()!=1736)return 0;if(o=f.cb.sc(d),x=f.cb.zh(x,d,o),x=f.UK.XQ([x])[0],c!==null){if(c.od!==2)throw f.i.N("Unit must be a area unit type");x=f.Tc.Nh(x,f.Tc.Zg(109404),c)}return x},L.ZQ=function(x,d,c,o){if(x=f.vL.local().V(x,d,o,null),c!==null){if(c.od!==0)throw f.i.N("Unit must be a linear unit type");x=f.Tc.Nh(x,f.Tc.Zg(9001),c)}return x},L.JU=function(x,d,c){if(x===null)return 0;var o=null;if(d!=null){if((o=d.Hd()).od==0&&(o=f.Tc.aG(o))==null&&c!==null)throw f.i.N();if(c!=null&&o.Ec()!=c.Ec()&&o.od!=c.od)throw f.i.Xk()}else if(c!=null)throw f.i.N();return x.getType()==1736||x.getType()==197?(x=x.Ke(),c!==null?f.Tc.Nh(x,o,c):x):0},L.KU=function(x,d,c){if(x===null||x.B()||1>x.Db())return 0;var o=null;if(d!=null){if(o=d.Hd(),c!=null&&o.Ec()!=c.Ec()&&o.od!=c.od)throw f.i.Xk()}else if(c!=null)throw f.i.N();x.getType()==1736||x.getType()==197?d=x.mg():f.aa.yd(x.getType())?(d=new f.Ta(x.description)).oc(x,!0):d=x,x=0,d=d.Ga();for(var l=new f.h,h=new f.h;d.$a();)for(;d.Ha();){var m=d.ha();m.Yp(l),m.Tr(h),x+=f.h.tb(l,h)}return o!==null&&c!==null&&(x=f.Tc.Nh(x,o,c)),x},L.fP=function(x){return x.points!==void 0?L.mS(x,x.hasZ!==void 0&&x.hasZ,x.hasM!==void 0&&x.hasM):x.rings!==void 0?L.lG(x.rings,x.hasZ!==void 0&&x.hasZ,x.hasM!==void 0&&x.hasM,"P"):x.paths!==void 0?L.lG(x.paths,x.hasZ!==void 0&&x.hasZ,x.hasM!==void 0&&x.hasM,"L"):x.x!==void 0?L.nS(x):x.xmin!==void 0?L.lS(x):null},L.nS=function(x){if(x.x==null||x.x=="NaN")return new f.Sa;var d=new f.Sa(x.x,x.y);return x.z!==void 0&&x.z!==null&&d.wX(x.z),x.m!==void 0&&x.m!==null&&d.hX(x.m),d},L.lS=function(x){if(x.xmin==null||x.xmin=="NaN")return new f.Fh;var d=new f.Fh(x.xmin,x.ymin,x.xmax,x.ymax);return x.zmin!==void 0&&x.zmin!==null&&d.setInterval(1,0,x.zmin,x.zmax),x.mmin!==void 0&&x.mmin!==null&&d.setInterval(2,0,x.mmin,x.mmax),d},L.mS=function(x,d,c){var o=0,l=new f.de,h=3*x.points.length;h%2!=0&&h++,2>h&&(h=2);var m=f.O.truncate(3*x.points.length/2);4>m?m=4:16>m&&(m=16),h=f.Yc.Dn(h,0);var g=f.Yc.Dn(m);m=f.Yc.Dn(m);for(var v=0;v<x.points.length;v++)h.write(2*v,x.points[v][0]),h.write(2*v+1,x.points[v][1]),g.write(v,d||c?x.points[v][2]:NaN),m.write(v,c&&d?x.points[v][3]:NaN),o++;return o!=0&&(l.resize(o),l.hn(0,h)),d&&(l.re(1),l.hn(1,g)),c&&(l.re(2),l.hn(2,d==0?g:m)),l.Pc(16777215),l},L.lG=function(x,d,c,o){var l=0,h=2;if(o=="P"){var m=new f.Da;l=1,h=3}else m=new f.Ta;for(var g=f.Yc.Oh(0),v=f.Yc.Mr(0),w=0,E=0,A=[],M=[],I=0;I<x.length;I++){var D=x[I].length;if(A[I]=!1,o==="P"&&x[I][0][0]===x[I][x[I].length-1][0]&&x[I][0][1]===x[I][x[I].length-1][1]){var k=c==0||x[I][0][3]===x[I][x[I].length-1][3]||x[I][0][3]===void 0&&x[I][x[I].length-1][3]===void 0;(d==0||x[I][0][2]===x[I][x[I].length-1][2]||x[I][0][2]===void 0&&x[I][x[I].length-1][2]===void 0)&&k&&(A[I]=!0,--D)}D>=h?(M[I]=!1,E+=1,g.add(w),v.add(l),w+=D):M[I]=!0}for((o=3*w)%2!=0&&o++,2>o&&(o=2),4>(I=f.O.truncate(3*w/2))?I=4:16>I&&(I=16),o=f.Yc.Dn(o,0),l=f.Yc.Dn(I),h=f.Yc.Dn(I),I=D=0;I<x.length;I++)if(M[I]===!1)for(k=0;k<x[I].length;k++){var B=!1;k===x[I].length-1&&A[I]===!0&&(B=!0),B||(o.write(2*D,x[I][k][0]),o.write(2*D+1,x[I][k][1]),l.write(D,d||c?x[I][k][2]:NaN),h.write(D,c&&d?x[I][k][3]:NaN),D++)}return w!=0&&(x=m,g.resize(E),v.resize(E),0<w&&(g.add(w),v.add(0)),x.hn(0,o),x.PJ(v),x.QJ(g)),d&&(m.re(1),m.hn(1,l)),c&&(m.re(2),m.hn(2,d==0?l:h)),m.Pc(16777215),m},L}()}(Q||(Q={})),function(f){f.Ex=function(){function L(){}return L.br=function(x){var d,c=0,o=x.length,l=x[0];for(d=0;d<o-1;d++){var h=x[d+1];c+=(h[0]-l[0])*(h[1]+l[1]),l=h}return 0<=c},L.rotate=function(x,d,c){d=d*Math.PI/180;var o=Math.cos(d),l=Math.sin(d);if(x.paths!==void 0){d={paths:[]};for(var h=0;h<x.paths.length;h++){for(var m=x.paths[h],g=[],v=0;v<m.length;v++){var w=m[v].slice(0);g.push(w);var E=o*(m[v][0]-c.x)-l*(m[v][1]-c.y)+c.x,A=l*(m[v][0]-c.x)+o*(m[v][1]-c.y)+c.y;w[0]=E,w[1]=A}d.paths.push(g),x.hasZ!==void 0&&(d.hasZ=x.hasZ),x.hasM!==void 0&&(d.hasM=x.hasM)}return d}if(x.rings!==void 0){for(d={rings:[]},h=0;h<x.rings.length;h++){m=x.rings[h],g=[];var M=L.br(m);for(v=0;v<m.length;v++)w=m[v].slice(0),g.push(w),E=o*(m[v][0]-c.x)-l*(m[v][1]-c.y)+c.x,A=l*(m[v][0]-c.x)+o*(m[v][1]-c.y)+c.y,w[0]=E,w[1]=A;L.br(g)!==M&&g.reverse(),d.rings.push(g),x.hasZ!==void 0&&(d.hasZ=x.hasZ),x.hasM!==void 0&&(d.hasM=x.hasM)}return d}if(x.x!==void 0)return d={x:o*(x.x-c.x)-l*(x.y-c.y)+c.x,y:l*(x.x-c.x)+o*(x.y-c.y)+c.y},x.z!==void 0&&(d.z=x.z),x.m!==void 0&&(d.m=x.m),x.hasZ!==void 0&&(d.hasZ=x.hasZ),x.hasM!==void 0&&(d.hasM=x.hasM),d;if(x.points!==void 0){for(d={points:[]},h=x.points,v=0;v<h.length;v++)(m=h[v].slice(0))[0]=o*(h[v][0]-c.x)-l*(h[v][1]-c.y)+c.x,m[1]=l*(h[v][0]-c.x)+o*(h[v][1]-c.y)+c.y,d.points.push(m);return x.hasZ!==void 0&&(d.hasZ=x.hasZ),x.hasM!==void 0&&(d.hasM=x.hasM),d}return null},L.JQ=function(x,d){if(x.paths!==void 0){for(var c={paths:[]},o=0;o<x.paths.length;o++){for(var l=x.paths[o],h=[],m=0;m<l.length;m++){var g=l[m].slice(0);h.push(g);var v=d.x-l[m][0];g[0]=l[m][0]+2*v}c.paths.push(h)}return x.hasZ!==void 0&&(c.hasZ=x.hasZ),x.hasM!==void 0&&(c.hasM=x.hasM),c}if(x.rings!==void 0){for(c={rings:[]},o=0;o<x.rings.length;o++){l=x.rings[o];var w=L.br(l);for(h=[],m=0;m<l.length;m++)g=l[m].slice(0),h.push(g),v=d.x-l[m][0],g[0]=l[m][0]+2*v;L.br(h)!==w&&h.reverse(),c.rings.push(h)}return x.hasZ!==void 0&&(c.hasZ=x.hasZ),x.hasM!==void 0&&(c.hasM=x.hasM),c}if(x.x!==void 0)return v=d.x-x.x,c={x:x.x+2*v,y:x.y},x.z!==void 0&&(c.z=x.z),x.m!==void 0&&(c.m=x.m),x.hasZ!==void 0&&(c.hasZ=x.hasZ),x.hasM!==void 0&&(c.hasM=x.hasM),c;if(x.points!==void 0){for(c={points:[]},o=x.points,m=0;m<o.length;m++)l=o[m].slice(0),v=d.x-l[0],l[0]+=2*v,c.points.push(l);return x.hasZ!==void 0&&(c.hasZ=x.hasZ),x.hasM!==void 0&&(c.hasM=x.hasM),c}return x.xmin!==void 0?(c={v:x.xmin,G:x.ymin,C:x.xmax,H:x.ymax},x.zmin!==void 0&&(c.zmin=x.zmin,c.zmax=x.zmax),x.mmin!==void 0&&(c.mmin=x.mmin,c.mmax=x.mmax),v=d.x-x.xmin,c.xmax=x.xmin+2*v,v=d.x-x.xmax,c.xmin=x.xmax+2*v,x.zmin!==void 0&&(c.zmin=x.zmin),x.zmax!==void 0&&(c.zmax=x.zmax),x.mmin!==void 0&&(c.mmin=x.mmin),x.mmax!==void 0&&(c.mmax=x.mmax),x.hasZ!==void 0&&(c.hasZ=x.hasZ),x.hasM!==void 0&&(c.hasM=x.hasM),c):null},L.KQ=function(x,d){if(x.paths!==void 0){for(var c={paths:[]},o=0;o<x.paths.length;o++){for(var l=x.paths[o],h=[],m=0;m<l.length;m++){var g=l[m].slice(0);h.push(g);var v=d.y-l[m][1];g[1]=l[m][1]+2*v}c.paths.push(h)}return x.hasZ!==void 0&&(c.hasZ=x.hasZ),x.hasM!==void 0&&(c.hasM=x.hasM),c}if(x.rings!==void 0){for(c={rings:[]},o=0;o<x.rings.length;o++){l=x.rings[o];var w=L.br(l);for(h=[],m=0;m<l.length;m++)g=l[m].slice(0),h.push(g),v=d.y-l[m][1],g[1]=l[m][1]+2*v;L.br(h)!==w&&h.reverse(),c.rings.push(h)}return x.hasZ!==void 0&&(c.hasZ=x.hasZ),x.hasM!==void 0&&(c.hasM=x.hasM),c}if(x.x!==void 0)return v=d.y-x.y,c={y:x.y+2*v,x:x.x},x.z!==void 0&&(c.z=x.z),x.m!==void 0&&(c.m=x.m),x.hasZ!==void 0&&(c.hasZ=x.hasZ),x.hasM!==void 0&&(c.hasM=x.hasM),c;if(x.points!==void 0){for(c={points:[]},o=x.points,m=0;m<o.length;m++)l=o[m].slice(0),v=d.y-l[1],l[1]+=2*v,c.points.push(l);return x.hasZ!==void 0&&(c.hasZ=x.hasZ),x.hasM!==void 0&&(c.hasM=x.hasM),c}return x.xmin!==void 0?(c={v:x.xmin,G:x.ymin,C:x.xmax,H:x.ymax},x.zmin!==void 0&&(c.zmin=x.zmin,c.zmax=x.zmax),x.mmin!==void 0&&(c.mmin=x.mmin,c.mmax=x.mmax),v=d.y-x.ymin,c.ymax=x.ymin+2*v,v=d.y-x.ymax,c.ymin=x.ymax+2*v,x.zmin!==void 0&&(c.zmin=x.zmin),x.zmax!==void 0&&(c.zmax=x.zmax),x.mmin!==void 0&&(c.mmin=x.mmin),x.mmax!==void 0&&(c.mmax=x.mmax),x.hasZ!==void 0&&(c.hasZ=x.hasZ),x.hasM!==void 0&&(c.hasM=x.hasM),c):null},L}()}(Q||(Q={})),function(f){f.ZK=function(){function L(){}return L.Ig=function(x,d){switch(d==null&&(d=f.ee.og()),x){case 33:return new f.Sa(d);case 322:return new f.yb(d);case 197:return new f.Fh(d);case 550:return new f.de(d);case 1607:return new f.Ta(d);case 1736:return new f.Da(d);default:throw f.i.fa("invalid argument.")}},L}()}(Q||(Q={})),function(f){var L=function(){function x(d,c){this.Te=f.ia.qf(d,-1),this.ua=new f.au,this.wl=c}return x.prototype.AW=function(d){this.ua.At(Math.min(this.Te.size,d)),this.ua.fn(d)},x.prototype.addElement=function(d,c){if(c===void 0)return this.eN(d);c=f.O.truncate(c%this.Te.size);var o=this.Te.get(c);return o==-1&&(o=this.ua.Ph(),this.Te.set(c,o)),this.ua.addElement(o,d)},x.prototype.eN=function(d){var c=this.wl.jz(d);c=f.O.truncate(c%this.Te.size);var o=this.Te.get(c);return o==-1&&(o=this.ua.Ph(),this.Te.set(c,o)),this.ua.addElement(o,d)},x.prototype.jd=function(d,c){if(c===void 0)this.KP(d);else{c=f.O.truncate(c%this.Te.size);var o=this.Te.get(c);if(o==-1)throw f.i.N();for(var l=this.ua.rc(o),h=-1;l!=-1;){var m=this.ua.lb(l);this.ua.ja(l)==d?(this.ua.jd(o,h,l),this.ua.rc(o)==-1&&(this.ua.bh(o),this.Te.set(c,-1))):h=l,l=m}}},x.prototype.KP=function(d){var c=this.wl.jz(d);c=f.O.truncate(c%this.Te.size);var o=this.Te.get(c);if(o==-1)throw f.i.N();for(var l=this.ua.rc(o),h=-1;l!=-1;){var m=this.ua.lb(l);this.ua.ja(l)==d?(this.ua.jd(o,h,l),this.ua.rc(o)==-1&&(this.ua.bh(o),this.Te.set(c,-1))):h=l,l=m}},x.prototype.rR=function(d){return d=f.O.truncate(d%this.Te.size),(d=this.Te.get(d))==-1?-1:this.ua.rc(d)},x.prototype.ER=function(d){return this.ua.lb(d)},x.prototype.vd=function(d){var c=this.wl.jz(this.ja(d));c=f.O.truncate(c%this.Te.size);var o=this.Te.get(c);if(o==-1)throw f.i.N();for(var l=this.ua.rc(o),h=-1;l!=-1;){if(l==d)return this.ua.jd(o,h,l),void(this.ua.rc(o)==-1&&(this.ua.bh(o),this.Te.set(c,-1)));h=l,l=this.ua.lb(l)}throw f.i.N()},x.prototype.ja=function(d){return this.ua.ja(d)},x.prototype.clear=function(){this.Te=f.ia.qf(this.Te.size,-1),this.ua.clear()},x.prototype.size=function(){return this.ua.TF()},x}();f.dL=L}(Q||(Q={})),function(f){var L=function(){function x(){this.Li=new f.$c(3),this.ua=new f.$c(6),this.sT=!1,this.je=-1}return x.prototype.fl=function(d){this.Li.jd(d)},x.prototype.Pw=function(){return this.Li.Ce()},x.prototype.bv=function(d){this.ua.jd(d)},x.prototype.$A=function(){return this.ua.Ce()},x.prototype.WB=function(d,c){this.Li.S(d,1,c)},x.prototype.ex=function(d,c){this.Li.S(d,2,c)},x.prototype.gX=function(d,c){this.Li.S(d,3,c)},x.prototype.UB=function(d,c){this.ua.S(d,4,c)},x.prototype.jX=function(d,c){this.ua.S(d,3,c)},x.prototype.TJ=function(d,c){this.ua.S(d,2,c)},x.prototype.Ph=function(d){var c=this.$A();return this.ua.S(c,3,this.je),this.ua.S(c,4,0),this.ua.S(c,5,d),this.je!=-1&&this.TJ(this.je,c),this.je=c},x.prototype.bh=function(d){this.LE(d);var c=this.ua.T(d,2),o=this.ua.T(d,3);return c!=-1?this.jX(c,o):this.je=o,o!=-1&&this.TJ(o,c),this.bv(d),o},x.prototype.At=function(d){this.ua.De(d)},x.prototype.PF=function(d){return this.ua.T(d,5)},x.prototype.fX=function(d,c){this.ua.S(d,5,c)},x.prototype.addElement=function(d,c){return this.tS(d,c)},x.prototype.tS=function(d,c){var o=this.Pw();this.ex(o,-1),this.ua.T(d,0)==-1&&this.ua.S(d,0,o);var l=this.ua.T(d,1);return this.WB(o,l),l!=-1&&this.ex(l,o),this.ua.S(d,1,o),this.setData(o,c),this.UB(d,this.bs(d)+1),this.sT&&this.gX(o,d),o},x.prototype.jd=function(d,c){var o=this.we(c),l=this.lb(c);return o!=-1?this.ex(o,l):this.ua.S(d,0,l),l!=-1?this.WB(l,o):this.ua.S(d,1,o),this.fl(c),this.UB(d,this.bs(d)-1),l},x.prototype.fn=function(d){this.Li.De(d)},x.prototype.getData=function(d){return this.Li.T(d,0)},x.prototype.setData=function(d,c){this.Li.S(d,0,c)},x.prototype.lb=function(d){return this.Li.T(d,2)},x.prototype.we=function(d){return this.Li.T(d,1)},x.prototype.rc=function(d){return this.ua.T(d,0)},x.prototype.Fc=function(d){return this.ua.T(d,1)},x.prototype.clear=function(){for(var d=this.je;d!=-1;)d=this.bh(d)},x.prototype.LE=function(d){for(var c=this.Fc(d);c!=-1;){var o=c;c=this.we(o),this.fl(o)}this.ua.S(d,0,-1),this.ua.S(d,1,-1),this.UB(d,0)},x.prototype.B=function(){return this.Li.size==0},x.prototype.TF=function(){return this.Li.size},x.prototype.bs=function(d){return this.ua.T(d,4)},x.prototype.qz=function(d){return this.ua.T(d,3)},x}();f.jp=L}(Q||(Q={})),function(f){var L=function(){function x(d){d===void 0?(this.ug=new f.$c(2),this.ua=new f.$c(4),this.je=-1,this.Qv=!0):(this.ug=new f.$c(2),this.ua=new f.$c(d?4:2),this.je=-1,this.Qv=d)}return x.prototype.fl=function(d){this.ug.jd(d)},x.prototype.Pw=function(){return this.ug.Ce()},x.prototype.bv=function(d){this.ua.jd(d)},x.prototype.$A=function(){return this.ua.Ce()},x.prototype.Ph=function(){var d=this.$A();return this.Qv&&(this.ua.S(d,3,this.je),this.je!=-1&&this.ua.S(this.je,2,d),this.je=d),d},x.prototype.bh=function(d){for(var c=this.rc(d);c!=-1;){var o=c;c=this.lb(c),this.fl(o)}this.Qv&&(c=this.ua.T(d,2),o=this.ua.T(d,3),c!=-1?this.ua.S(c,3,o):this.je=o,o!=-1&&this.ua.S(o,2,c)),this.bv(d)},x.prototype.At=function(d){this.ua.De(d)},x.prototype.addElement=function(d,c){var o=this.ua.T(d,1),l=this.Pw();return o!=-1?this.ug.S(o,1,l):this.ua.S(d,0,l),this.ua.S(d,1,l),this.ug.S(l,0,c),l},x.prototype.fn=function(d){this.ug.De(d)},x.prototype.jd=function(d,c,o){c!=-1?(this.ug.S(c,1,this.ug.T(o,1)),this.ua.T(d,1)==o&&this.ua.S(d,1,c)):(this.ua.S(d,0,this.ug.T(o,1)),this.ua.T(d,1)==o&&this.ua.S(d,1,-1)),this.fl(o)},x.prototype.Hy=function(d,c){var o=this.ua.T(d,1),l=this.ua.T(c,0);l!=-1&&(o!=-1?this.ug.S(o,1,l):this.ua.S(d,0,l),this.ua.S(d,1,this.ua.T(c,1))),this.Qv&&(d=this.ua.T(c,2),o=this.ua.T(c,3),d!=-1?this.ua.S(d,3,o):this.je=o,o!=-1&&this.ua.S(o,2,d)),this.bv(c)},x.prototype.ja=function(d){return this.ug.T(d,0)},x.prototype.Sj=function(d,c){this.ug.S(d,0,c)},x.prototype.lb=function(d){return this.ug.T(d,1)},x.prototype.rc=function(d){return this.ua.T(d,0)},x.prototype.Jn=function(d){return this.ja(this.rc(d))},x.prototype.clear=function(){this.ug.mj(!0),this.ua.mj(!0),this.je=-1},x.prototype.B=function(){return this.ug.size==0},x.prototype.TF=function(){return this.ug.size},x.prototype.qz=function(d){return this.ua.T(d,3)},x}();f.au=L}(Q||(Q={})),function(f){f.ta=function(){function L(){}return L.Wd=function(x,d,c){return d=d.xr(),x=x!=null&&x.Xd!==void 0?x.Xd(0):0,c&&(d*=4,x*=1.1),Math.max(x,d)},L.Er=function(x){return 2*Math.sqrt(2)*x},L.rN=function(x){return Math.sqrt(2)*x},L.kj=function(x,d,c){var o=new f.l;return d.A(o),L.Wd(x,o,c)},L.wE=function(x,d,c){return d=d.Tg(1,0).xr(),x=x!=null?x.Xd(1):0,c&&(d*=4,x*=1.1),Math.max(x,d)},L.mv=function(x,d){var c=new f.l;return x.xc(c),x=new f.l,d.xc(x),c.Zb(x),c},L.YN=function(x){var d=new f.l;if(x.xc(d),d.B())return null;var c=new f.du(d,8),o=-1,l=new f.l,h=!1;do for(var m=0,g=x.da();m<g;m++){if(x.Rj(m,l),(o=c.Jz(m,l,o))==-1){if(h)throw f.i.fa("internal error");x.yp(d,!1),h=!0,c.reset(d,8);break}h=!1}while(h);return c},L.nE=function(x){var d=new f.l;x.xc(d);for(var c=new f.du(d,8),o=-1,l=x.Ga(),h=new f.l,m=!1;l.$a();)for(;l.Ha();){var g=l.ha(),v=l.wb();if(g.A(h),(o=c.Jz(v,h,o))==-1){if(m)throw f.i.Qa();x.yp(d,!1),m=!0,c.reset(d,8),l.Zi();break}}return c},L.jj=function(x,d){var c=new f.l;x.xc(c);for(var o=new f.du(c,8),l=-1,h=new f.l,m=x.Ga(),g=!1;m.$a();)for(;m.Ha();){var v=m.ha(),w=m.wb();if(v.A(h),h.isIntersecting(d)&&(l=o.Jz(w,h,l))==-1){if(g)throw f.i.fa("internal error.");x.yp(c,!1),g=!0,o.reset(c,8),m.Zi();break}}return o},L.oE=function(x,d){for(var c=new f.du(d,8),o=new f.h,l=!1,h=new f.l,m=0;m<x.I();m++)if(x.D(m,o),d.contains(o)&&(h.K(o),c.vj(m,h)==-1)){if(l)throw f.i.Qa();l=!0,m=new f.l,x.yp(m,!1),c.reset(m,8),m=-1}return c},L.lR=function(x,d,c){var o=new f.l,l=new f.l;x.xc(o),d.xc(l),o.W(c,c),l.W(c,c);var h=new f.l;h.K(o),h.Ea(l),x=x.Ga(),d=d.Ga();var m=new f.xC;m.aC(c);var g=!1;for(m.pK();x.$a();)for(;x.Ha();)x.ha().A(o),o.isIntersecting(h)&&(g=!0,(c=new f.l).K(o),m.JD(x.wb(),c));if(m.iF(),!g)return null;for(o=!1,m.oK();d.$a();)for(;d.Ha();)d.ha().A(l),l.isIntersecting(h)&&(o=!0,(c=new f.l).K(l),m.ED(d.wb(),c));return m.hF(),o?m:null},L.mR=function(x,d,c,o,l){var h=x.getType(),m=d.getType(),g=new f.l,v=new f.l;x.xc(g),d.xc(v),g.W(c,c),v.W(c,c);var w=new f.l;w.K(g),w.Ea(v);var E=new f.xC;E.aC(c);var A=!1;E.pK();var M=0;for(c=x.da();M<c;M++)o&&h==1736&&!x.Ev(M)||(x.Rj(M,g),g.isIntersecting(w)&&(A=!0,E.JD(M,g)));if(E.iF(),!A)return null;for(x=!1,E.oK(),o=0,c=d.da();o<c;o++)l&&m==1736&&!d.Ev(o)||(d.Rj(o,v),v.isIntersecting(w)&&(x=!0,E.ED(o,v)));return E.hF(),x?E:null},L.Ru=function(x,d,c){if(x!=d)for(var o=0;o<c;o++)x[o]==null?x[o]=f.h.al(d[o]):x[o].L(d[o])},L.Jy=function(x,d,c,o){var l=0;for(o+=0;l<o;c++,l++)x[l]==null&&(x[l]=[0,0]),x[l][0]=d[c].x,x[l][1]=d[c].y},L.Iy=function(x,d,c,o){var l=d,h=0;for(d=o+d;l<d;h++,l++)x[l]==null?x[l]=f.h.construct(c[h][0],c[h][1]):x[l].ma(c[h][0],c[h][1])},L.kP=function(x,d,c){if(x!=d)for(var o=0;o<c;o++)x[o]==null?x[o]=new f.Sa(d[o]):d[o].copyTo(x[o])},L.vE=function(x,d,c,o){var l=0;return x!=null&&(l=x.Xd(0),o&&!c||x==null||(l+=1.01*x.vz(0))),c&&(d*=4,l*=1.01),Math.max(l,d)},L.ty=function(x,d,c){return L.vE(x,d.xr(),c,!1)},L.gO=function(x,d){var c=new f.l;return d.A(c),L.ty(x,c,!0)},L.uy=function(x,d){return L.vE(x,d.xr(),!1,!0)},L.Hu=function(x,d){var c=new f.l;return d.A(c),L.uy(x,c)},L.AG=function(x,d,c,o){o*=o;var l=new f.h;if(l.uc(x,d),(x=new f.h).uc(c,d),d=l.Sk(),c=x.Sk(),d<=o&&c<=o)return!0;var h=f.lc.ox(l.wi(x));return(h<=o*d||h<=o*c)&&0<=l.Qh(x)},L.dK=function(x,d,c,o){for(var l=0;l<d;l++){var h=x[l].y,m=f.O.Rk(h,c,o);m!=h&&(x[l].y=m)}},L}()}(Q||(Q={})),function(f){var L,x,d=function(){function h(m){this.Ya=m}return h.prototype.compare=function(m,g,v){m=m.ja(v),v=this.Ya.nk(g);var w=this.Ya.nk(m);return v<w?-1:v==w?l.gq(g)&&l.Gv(m)?-1:l.gq(m)&&l.Gv(g)?1:0:1},h}(),c=function(){function h(m){this.Ya=m}return h.prototype.nr=function(m,g,v){this.Ya.GX(v,m,g)},h.prototype.$p=function(m){return this.Ya.nk(m)},h}();(x=L||(L={}))[x.initialize=0]="initialize",x[x.pIn=1]="pIn",x[x.pL=2]="pL",x[x.pR=3]="pR",x[x.pT=4]="pT",x[x.right=5]="right",x[x.left=6]="left",x[x.all=7]="all";var o=function(){function h(){this.Ya=null,this.Qi=new f.Nc,this.hi=new f.ia(0),this.sg=[0,0]}return h.prototype.Xi=function(m,g){this.Qi.oa=m.oa-g,this.Qi.va=m.va+g,this.hi.resize(0),this.he=0,this.sg[0]=0},h.prototype.EB=function(m,g,v){if(m>g)throw f.i.N();this.Qi.oa=m-v,this.Qi.va=g+v,this.hi.resize(0),this.he=0,this.sg[0]=0},h.prototype.Uo=function(m,g){this.Qi.oa=m-g,this.Qi.va=m+g,this.hi.resize(0),this.he=0,this.sg[0]=0},h.prototype.next=function(){if(!this.Ya.lq)throw f.i.Hb();if(0>this.he)return-1;for(var m=!0;m;)switch(this.sg[this.he]){case 1:m=this.FU();break;case 2:m=this.GU();break;case 3:m=this.HU();break;case 4:m=this.IU();break;case 5:m=this.GW();break;case 6:m=this.kT();break;case 7:m=this.tN();break;case 0:m=this.Gz();break;default:throw f.i.Qa()}return this.Og!=-1?this.Mp()>>1:-1},h.construct=function(m){var g=new h;return g.Ya=m,g.hi.Jb(20),g.he=-1,g},h.prototype.Gz=function(){return this.Og=this.vH=this.Mi=this.Lc=-1,this.Ya.me!=null&&0<this.Ya.me.size?(this.sg[0]=1,this.Mi=this.Ya.kf,!0):(this.he=-1,!1)},h.prototype.FU=function(){if(this.Lc=this.Mi,this.Lc==-1)return this.Og=this.he=-1,!1;var m=this.Ya.Np(this.Lc);return this.Qi.va<m?(m=this.Ya.mk(this.Lc),this.Mi=this.Ya.qj(this.Lc),m!=-1&&(this.ei=this.Ya.kl(m),this.sg[++this.he]=6),!0):m<this.Qi.oa?(m=this.Ya.mk(this.Lc),this.Mi=this.Ya.lk(this.Lc),m!=-1&&(this.ei=this.Ya.Zr(m),this.sg[++this.he]=5),!0):(this.sg[this.he]=2,this.vH=this.Lc,m=this.Ya.mk(this.Lc),this.Mi=this.Ya.qj(this.Lc),m!=-1&&(this.ei=this.Ya.kl(m),this.sg[++this.he]=7),!0)},h.prototype.GU=function(){if(this.Lc=this.Mi,this.Lc==-1)return this.sg[this.he]=3,this.Mi=this.Ya.lk(this.vH),!0;if(this.Ya.Np(this.Lc)<this.Qi.oa){var m=this.Ya.mk(this.Lc);return this.Mi=this.Ya.lk(this.Lc),m!=-1&&(this.ei=this.Ya.Zr(m),this.sg[++this.he]=5),!0}return m=this.Ya.mk(this.Lc),this.Mi=this.Ya.qj(this.Lc),m!=-1&&(this.ei=this.Ya.kl(m),this.sg[++this.he]=7),(m=this.Ya.lk(this.Lc))!=-1&&this.hi.add(m),!0},h.prototype.HU=function(){if(this.Lc=this.Mi,this.Lc==-1)return this.sg[this.he]=4,!0;if(this.Qi.va<this.Ya.Np(this.Lc)){var m=this.Ya.mk(this.Lc);return this.Mi=this.Ya.qj(this.Lc),m!=-1&&(this.ei=this.Ya.kl(m),this.sg[++this.he]=6),!0}return m=this.Ya.mk(this.Lc),this.Mi=this.Ya.lk(this.Lc),m!=-1&&(this.ei=this.Ya.kl(m),this.sg[++this.he]=7),(m=this.Ya.qj(this.Lc))!=-1&&this.hi.add(m),!0},h.prototype.IU=function(){if(this.hi.size==0)return this.Og=this.he=-1,!1;this.Lc=this.hi.get(this.hi.size-1),this.hi.resize(this.hi.size-1);var m=this.Ya.mk(this.Lc);return m!=-1&&(this.ei=this.Ya.kl(m),this.sg[++this.he]=7),this.Ya.qj(this.Lc)!=-1&&this.hi.add(this.Ya.qj(this.Lc)),this.Ya.lk(this.Lc)!=-1&&this.hi.add(this.Ya.lk(this.Lc)),!0},h.prototype.kT=function(){return this.Og=this.ei,this.Og!=-1&&l.gq(this.Mp())&&this.Ya.nk(this.Mp())<=this.Qi.va?(this.ei=this.SF(),!1):(this.he--,!0)},h.prototype.GW=function(){return this.Og=this.ei,this.Og!=-1&&l.Gv(this.Mp())&&this.Ya.nk(this.Mp())>=this.Qi.oa?(this.ei=this.QR(),!1):(this.he--,!0)},h.prototype.tN=function(){return this.Og=this.ei,this.Og!=-1&&l.gq(this.Mp())?(this.ei=this.SF(),!1):(this.he--,!0)},h.prototype.SF=function(){return this.Ya.Sf?this.Ya.$f.lb(this.Og):this.Ya.Ti.lb(this.Og)},h.prototype.QR=function(){return this.Ya.Sf?this.Ya.$f.we(this.Og):this.Ya.Ti.we(this.Og)},h.prototype.Mp=function(){return this.Ya.Sf?this.Ya.$f.ja(this.Og):this.Ya.Ti.getData(this.Og)},h}();f.EY=o;var l=function(){function h(m){this.Am=this.$h=this.$f=this.Ti=this.Km=this.Ej=this.me=this.Fj=null,this.Sf=m,this.lq=this.Sv=!1}return h.prototype.kr=function(){this.Nk(!0)},h.prototype.Br=function(m,g){if(!this.Sv)throw f.i.Hb();this.Fj.push(new f.Nc(m,g))},h.prototype.Fp=function(){if(!this.Sv)throw f.i.fa("invalid call");this.Sv=!1,this.lq=!0,this.Sf||(this.vS(),this.Zv=this.Fj.length)},h.prototype.vj=function(m){if(!this.Sf||!this.lq)throw f.i.N("invalid call");if(this.kf==-1){var g=this.Fj.length;if(this.iA){var v=new f.ia(0);v.Jb(2*g),this.bJ(v),this.$h.Jb(2*g),this.$h.resize(0),this.aJ(v),this.Km.resize(g,-1),this.Km.Wj(-1,0,g),this.iA=!1}else this.Km.Wj(-1,0,g);this.kf=this.Tu()}g=this.pG(m<<1,this.kf),v=this.$f.addElement(1+(m<<1),this.xz(g)),this.VJ(g,v),this.Km.set(m,g),this.Zv++},h.prototype.remove=function(m){if(!this.Sf||!this.lq)throw f.i.fa("invalid call");var g=this.Km.get(m);if(g==-1)throw f.i.N("the interval does not exist in the interval tree");this.Km.set(m,-1),this.Zv--;var v=this.xz(g),w=this.$f.ZR(v);this.$f.vd(this.wR(g),v),this.$f.vd(this.TR(g),v),(m=this.$f.size(v))==0&&(this.$f.MP(v),this.ZJ(w,-1)),this.Ej.jd(g),v=this.UF(w);var E=this.qj(w),A=this.lk(w);for(g=0;!(0<m||w==this.kf||E!=-1&&A!=-1);)w==this.qj(v)?E!=-1?(this.Ok(v,E),this.Uj(E,v),this.Ok(w,-1)):A!=-1?(this.Ok(v,A),this.Uj(A,v),this.Qk(w,-1)):this.Ok(v,-1):E!=-1?(this.Qk(v,E),this.Uj(E,v),this.Ok(w,-1)):A!=-1?(this.Qk(v,A),this.Uj(A,v),this.Qk(w,-1)):this.Qk(v,-1),this.Uj(w,-1),g++,w=v,m=(v=this.mk(w))!=-1?this.$f.size(v):0,E=this.qj(w),A=this.lk(w),v=this.UF(w)},h.prototype.reset=function(){if(!this.Sf||!this.lq)throw f.i.N("invalid call");this.Nk(!1)},h.prototype.size=function(){return this.Zv},h.prototype.getIterator=function(){return o.construct(this)},h.prototype.bJ=function(m){for(var g=this.Fj.length,v=0;v<2*g;v++)m.add(v);this.HX(m,2*g)},h.prototype.aJ=function(m){for(var g=NaN,v=0;v<m.size;v++){var w=m.get(v),E=this.nk(w);E!=g&&(this.$h.add(w),g=E)}},h.prototype.vS=function(){var m=this.Fj.length,g=new f.ia(0);g.Jb(2*m),this.bJ(g),this.$h.Jb(2*m),this.$h.resize(0),this.aJ(g),this.Ej.De(m),this.Ti.fn(2*m);var v=f.Yc.Oh(m);for(v.Wj(-1,0,m),this.kf=this.Tu(),m=0;m<g.size;m++){var w=g.get(m),E=v.get(w>>1);E!=-1?this.VJ(E,this.Ti.addElement(this.xz(E),w)):(E=this.pG(w,this.kf),v.set(w>>1,E))}},h.prototype.pG=function(m,g){var v=g,w=g,E=-1,A=0,M=this.$h.size-1,I=0,D=m>>1,k=NaN,B=NaN,J=!0,Y=this.DR(D);for(D=this.AR(D);J;){A<M?(I=A+f.O.truncate((M-A)/2),this.gz(v)==-1&&this.FJ(v,this.$h.get(I),this.$h.get(I+1))):this.gz(v)==-1&&this.FJ(v,this.$h.get(A),this.$h.get(A));var V=this.Np(v);if(D<V)g!=-1&&(g==v?(w=v,k=V,B=(g=this.qj(v))!=-1?this.Np(g):NaN):B>V&&(V<k?this.Ok(w,v):this.Qk(w,v),this.Qk(v,g),this.Sf&&(this.Uj(v,w),this.Uj(g,v)),w=v,k=V,g=-1,B=NaN)),(M=this.xR(v))==-1&&(M=this.Tu(),this.dX(v,M)),v=M,M=I;else if(Y>V)g!=-1&&(g==v?(w=v,k=V,B=(g=this.lk(v))!=-1?this.Np(g):NaN):B<V&&(V<k?this.Ok(w,v):this.Qk(w,v),this.Ok(v,g),this.Sf&&(this.Uj(v,w),this.Uj(g,v)),w=v,k=V,g=-1,B=NaN)),(A=this.UR(v))==-1&&(A=this.Tu(),this.oX(v,A)),v=A,A=I+1;else{(J=this.mk(v))==-1&&(J=this.zP(v),this.ZJ(v,J));var te=this.fN(J,m);E=this.xP(),this.qX(E,J),this.cX(E,te),v!=g&&(V<k?this.Ok(w,v):this.Qk(w,v),this.Sf&&this.Uj(v,w),g!=-1&&(B<V?this.Ok(v,g):this.Qk(v,g),this.Sf&&this.Uj(g,v))),J=!1}}return E},h.prototype.Tu=function(){return this.me.Ce()},h.prototype.zP=function(m){return this.Sf?this.$f.Pr(m):this.Ti.Ph(m)},h.prototype.xP=function(){return this.Ej.Ce()},h.prototype.Nk=function(m){m?(this.Sv=this.iA=!0,this.lq=!1,this.$h==null?this.$h=f.Yc.Oh(0):this.$h.resize(0),this.Fj==null?this.Fj=[]:this.Fj.length=0):this.iA=!1,this.Sf?this.Km==null?(this.Km=f.Yc.Oh(0),this.$f=new f.Yj,this.$f.Vo(new d(this))):this.$f.clear():this.Ti==null?this.Ti=new f.jp:this.Ti.clear(),this.me==null?(this.Ej=new f.$c(3),this.me=new f.$c(this.Sf?8:7)):(this.Ej.mj(!1),this.me.mj(!1)),this.kf=-1,this.Zv=0},h.prototype.FJ=function(m,g,v){this.XW(m,g),this.YW(m,v)},h.prototype.Np=function(m){var g=this.gz(m);return g==-1?NaN:(g=this.nk(g))==(m=this.nk(this.gR(m)))?g:.5*(g+m)},h.prototype.XW=function(m,g){this.me.S(m,0,g)},h.prototype.YW=function(m,g){this.me.S(m,1,g)},h.prototype.dX=function(m,g){this.me.S(m,3,g)},h.prototype.oX=function(m,g){this.me.S(m,4,g)},h.prototype.ZJ=function(m,g){this.me.S(m,2,g)},h.prototype.Ok=function(m,g){this.me.S(m,5,g)},h.prototype.Qk=function(m,g){this.me.S(m,6,g)},h.prototype.Uj=function(m,g){this.me.S(m,7,g)},h.prototype.qX=function(m,g){this.Ej.S(m,0,g)},h.prototype.fN=function(m,g){return this.Sf?this.$f.addElement(g,m):this.Ti.addElement(m,g)},h.prototype.cX=function(m,g){this.Ej.S(m,1,g)},h.prototype.VJ=function(m,g){this.Ej.S(m,2,g)},h.prototype.kl=function(m){return this.Sf?this.$f.rc(m):this.Ti.rc(m)},h.prototype.Zr=function(m){return this.Sf?this.$f.Fc(m):this.Ti.Fc(m)},h.gq=function(m){return(1&m)==0},h.Gv=function(m){return(1&m)==1},h.prototype.gz=function(m){return this.me.T(m,0)},h.prototype.gR=function(m){return this.me.T(m,1)},h.prototype.mk=function(m){return this.me.T(m,2)},h.prototype.xR=function(m){return this.me.T(m,3)},h.prototype.UR=function(m){return this.me.T(m,4)},h.prototype.qj=function(m){return this.me.T(m,5)},h.prototype.lk=function(m){return this.me.T(m,6)},h.prototype.UF=function(m){return this.me.T(m,7)},h.prototype.xz=function(m){return this.Ej.T(m,0)},h.prototype.wR=function(m){return this.Ej.T(m,1)},h.prototype.TR=function(m){return this.Ej.T(m,2)},h.prototype.DR=function(m){return this.Fj[m].oa},h.prototype.AR=function(m){return this.Fj[m].va},h.prototype.HX=function(m,g){this.Am==null&&(this.Am=new f.Xt);var v=new c(this);this.Am.sort(m,0,g,v)},h.prototype.GX=function(m,g,v){var w=this;m.Vd(g,v,function(E,A){var M=w.nk(E),I=w.nk(A);return M<I||M==I&&h.gq(E)&&h.Gv(A)?-1:1})},h.prototype.nk=function(m){var g=this.Fj[m>>1];return h.gq(m)?g.oa:g.va},h}();f.sr=l}(Q||(Q={})),function(f){var L=function(){function x(d){if(d==null)throw f.i.fa("Invalid arguement");this.hf=d;var c=d.nR();c.hS()?d.ef.IG()?this.lo=f.si.PannableFold:this.lo=f.si.Clip:this.lo=f.si.DontClip,c.iS()?d.Yf.IG()?this.Qm=f.si.PannableFold:this.Qm=f.si.Clip:this.Qm=f.si.DontClip,this.Bm=c.Jr,this.mH=c.Vu,d=this.hf.sH,this.aH=d.hs(2147483648),this.Uv=d.hs(1073741824)}return x.zh=function(d,c,o){return c.ww.zh(d,o)},x.Rt=function(d,c,o,l){return d.ww.Rt(c,o,l)},x.Qt=function(d,c,o,l){if(o=0>o?c.length:o,(d=d.ww.Rt(c,o,l))==o)return d;for(var h=c=0;h<o;h++){var m=l[h];m.isNaN()||(c<h&&l[c].L(m),c++)}for(;c<o;c++)l[c].Rc();return d},x.transform=function(d,c,o,l,h){if(d.isIdentity())return f.ta.kP(l,c,o),o;for(var m=[],g=0,v=0;v<o;){for(var w=Math.min(m.length,o-v),E=v,A=0;E<w;E++,A++)m[A]==null?m[A]=c[E].D():c[E].D(m[A]);var M=h?x.Qt(d,m,w,m):x.Rt(d,m,w,m);for(A=E=0;E<M;E++,A++)l[v]==null&&(l[v]=new f.Sa(c[v])),l[v].Cb(m[A]);v+=w,g+=M}return g},x.prototype.Rt=function(d,c,o){if(this.hf.isIdentity())return d!=o&&f.ta.Ru(o,d,c),c;var l=this.hf.ef,h=this.hf.Yf,m=l.Sb(),g=h.Sb();if(m==0&&m===g){var v=l.Qp();return h=v/(h=h.Qp()),(v=new f.Dd).setScale(h,h),v.eY(d,c,o),c}if(v=f.O.Fu(Math.min(c,64)),m==3){var w=l.Ji;m=(l=w.fk()).Sb(),o!=d&&f.ta.Ru(o,d,c),f.zb.$k(w,o,c,!0),w.Qt(f.bm.forward,o,c),f.zb.Zk(w,o,c,!0)}if(m==3||g===3)throw f.i.fa("image: transform_in_place_");if(m==2)this.lo==f.si.Clip?(o!=d&&f.ta.Ru(o,d,c),d=l.ml(),f.zb.OS(d,l,o,c)):(o!=d&&f.ta.Ru(o,d,c),l.Wc()&&(m=l.Xd(0),w=l.Oe(),f.zb.EX(o,c,w,m),f.zb.qF(o,c,l,0))),f.zb.IL(l,o,c,v);else for(m=l.Xd(0),w=l.Oe(),l=0;l<c;l++)f.zb.FX(d[l],w,m,o[l]);for(f.zb.GL(this.hf,o,c,v),d=0,(g=g==2)?d=h.zi():isNaN(this.Bm)||(d=this.Bm),g&&this.Qm!=f.si.Clip||f.zb.qF(o,c,h.sc(),d),g&&(f.zb.yG(o,c,h,this.Qm),f.zb.HL(h,o,c,v)),d=c,l=0;l<c;++l)o[l].isNaN()&&d--;return d},x.prototype.zh=function(d,c){if(this.hf.isIdentity()||d.B())return d;if(d.getType()==33)return this.XI(d);var o=this.hf.ef,l=this.hf.Yf,h=o.Sb(),m=l.Sb();if(h==0&&h==m)return c=o.Qp(),c/=l=l.Qp(),(l=new f.Dd).setScale(c,c),(d=f.aa.jg(d)).Oc(l),d;switch(d.getType()){case 1607:case 1736:d=this.VI(d,c);break;case 550:d=this.fW(d,c);break;case 197:d=this.eW(d,c);break;default:throw f.i.fa("")}return d},x.prototype.XI=function(d){var c=d.D(),o=[];return o[0]=c,this.Rt(o,1,o),(d=new f.Sa(d)).Cb(o[0]),d},x.prototype.VI=function(d,c){if(d.tm())throw f.i.fa("curves not supported");var o=d.getType();if(o==1736)return this.gW(d,c);if(o==1607)return this.hW(d,c);throw f.i.fa("projectMultiPath")},x.prototype.gW=function(d,c){var o=this.hf.ef,l=this.hf.Yf,h=o.Sb(),m=l.Sb(),g=f.O.Fu(Math.min(d.I(),64)),v=f.Da.jg(d);h==3&&(h=(o=(d=o.Ji).fk()).Sb(),v=d.$k(v,!0),this.wp(d,f.bm.forward,v),v=d.Zk(v,!0)),d=null,m==3&&(m=(l=(d=l.Ji).fk()).Sb());var w=h==2,E=m==2,A=E?l.sc():l,M=!E&&!this.Uv;m=!1;var I=v;if(w){if((I=f.zb.UI(I,o,this.lo,c)).B())return I}else{if(v=new f.l,I.xc(v),h=o.Oe(),v.G<h.G||v.H>h.H){var D=f.l.construct(v.v-1,h.G,v.C+1,h.H);if((I=f.ri.Nu(I,D,o,NaN,0,c)).B())return I}v.R()>2*h.R()&&(I=f.zb.Hp(I,-2*h.R(),2*h.R(),o,!0,0,!0,c))}v=this.mH,(h=!isNaN(v))&&(I=f.Xl.local().V(I,v,c)),D=E?l.kk():null;var k=NaN;w&&(k=o.zi());var B=l.Wr()!=null;if(this.aH)w&&(f.zb.ur(o,k,I,g),h&&(w=o.hh(),v*=(k=o.sc().hh())/w)),f.zb.tr(this.hf,I,M,g),h&&(w=o.sc().hh(),v*=(k=l.sc().hh())/w),o=I;else{var J=new f.Ta(I.description);J.DD(I),w&&(f.zb.ur(o,k,J,g),h&&(w=o.hh(),v*=(k=o.sc().hh())/w)),f.zb.tr(this.hf,J,M,g),h&&(w=o.sc().pm(),v*=(k=l.sc().pm())/w),M=NaN,E?(D=l.kk(),M=l.zi()):isNaN(this.Bm)||(M=this.Bm),w=x.tv(o)|x.tv(l),k=10*A.Xd(0),this.Uv&&(w=3,k=0),o=f.zb.UQ(I,o,J,A,M,c,w,k)}return B&&(o=f.zb.XD(o,l,c)),E&&(m||(E=A.Oe().R(),o.Tg(0,0).R()>=E-A.Xd(0)&&(A=D.getNorthPoleLocation(),E=D.getSouthPoleLocation(),I=D.getNorthPoleGeometry(),D=D.getSouthPoleGeometry(),M=0,I==f.Cg.PE_POLE_POINT&&A!=f.Cg.PE_POLE_OUTSIDE_BOUNDARY&&(M=1),D==f.Cg.PE_POLE_POINT&&E!=f.Cg.PE_POLE_OUTSIDE_BOUNDARY&&(M|=2),M!==0&&(m=!0))),o=f.zb.Mz(o,l,this.Qm,c),h&&(o=f.Xl.local().V(o,v,c)),f.zb.Lx(l,o,g)),o.B()||(m&&(o=f.Yl.local().V(o,l,!1,c)),d!=null&&(o=d.Zk(o,!1),this.wp(d,f.bm.reverse,o),o=d.$k(o,!1))),o},x.tv=function(d){if(d.Sb()!=2)return 0;var c=0,o=d.kk();d=o.getNorthPoleLocation();var l=o.getSouthPoleLocation(),h=o.getNorthPoleGeometry();return o=o.getSouthPoleGeometry(),h==f.Cg.PE_POLE_POINT&&d!=f.Cg.PE_POLE_OUTSIDE_BOUNDARY&&(c=1),o==f.Cg.PE_POLE_POINT&&l!=f.Cg.PE_POLE_OUTSIDE_BOUNDARY&&(c|=2),c},x.prototype.hW=function(d,c){var o=this.hf.ef,l=this.hf.Yf,h=o.Sb(),m=l.Sb(),g=f.O.Fu(Math.min(d.I(),64)),v=f.Ta.jg(d);h==3&&(h=(o=(d=o.Ji).fk()).Sb(),v=d.$k(v,!0),this.wp(d,f.bm.forward,v),v=d.Zk(v,!0)),d=null,m==3&&(m=(l=(d=l.Ji).fk()).Sb());var w=h==2;h=(m=m==2)?l.sc():l;var E=!m&&!this.Uv;if(w){if((v=f.zb.UI(v,o,this.lo,c)).B())return v}else{var A=new f.l;v.xc(A);var M=o.Oe();if((A.G<M.G||A.H>M.H)&&(A=f.l.construct(A.v-1,M.G,A.C+1,M.H),(v=f.ri.Nu(v,A,o,NaN,0,c)).B()))return v}var I=NaN;w&&(I=o.zi()),A=l.Wr()!=null,M=this.mH;var D=!isNaN(M);if(D&&(v=f.Xl.local().V(v,M,c)),this.aH)w&&f.zb.ur(o,I,v,g),D&&(w=o.hh(),M*=(I=o.sc().hh())/w),f.zb.tr(this.hf,v,E,g),D&&(w=o.sc().hh(),M*=(I=l.sc().hh())/w),o=v;else{var k=new f.Ta(v.description);k.DD(v),w&&(f.zb.ur(o,I,k,g),D&&(w=o.hh(),M*=(I=o.sc().hh())/w)),f.zb.tr(this.hf,k,E,g),D&&(w=o.sc().hh(),M*=(I=l.sc().hh())/w),E=NaN,m?E=l.zi():isNaN(this.Bm)||(E=this.Bm),w=x.tv(o)|x.tv(l),I=10*h.Xd(0),this.Uv&&(w=3,I=0),o=f.zb.VQ(v,o,k,h,E,c,w,I)}return A&&(o=f.zb.XD(o,l,c)),m&&(o=f.zb.Mz(o,l,this.Qm,c),D&&(o=f.Xl.local().V(o,M,c)),f.zb.Lx(l,o,g)),o.B()||d!=null&&(o=d.Zk(o,!1),this.wp(d,f.bm.reverse,o),o=d.$k(o,!1)),o},x.prototype.eW=function(d,c){var o=(d.ca()+d.R())/400;return o!=0?(o=f.Xl.local().V(d,o,c),o=this.VI(o,c),c=d.Ia(),o.bn(c)):(c=new f.Sa(d.Ip()),o=this.XI(c),c=d.Ia(),o.B()?c.Oa():(d.copyTo(c),d=o.D(),c.K(d.x,d.y,d.x,d.y))),c},x.prototype.fW=function(d,c){d=f.aa.jg(d);var o=this.hf.ef,l=this.hf.Yf,h=o.Sb(),m=l.Sb(),g=f.O.Fu(Math.min(d.I(),64));if(h==3){var v=o.Ji;h=(o=v.fk()).Sb(),d=v.Zk(d,!0),this.wp(v,f.bm.forward,d),d=v.$k(d,!0)}if(h==2){if(this.lo==f.si.Clip?d=f.Xj.local().V(d,o.ml(),o,c):o.Wc()&&(h=new f.l,d.xc(h),o.Oe().contains(h)||(this.lo==f.si.PannableFold&&(d=f.zb.lj(d,o)),f.zb.Jt(d,o.Oe(),o.Xd(0),!0),d=f.zb.Fn(d,o,0,!0,0,c))),d.B())return d;f.zb.ur(o,0,d,g)}else f.zb.Jt(d,o.Oe(),o.Xd(0),!0);return f.zb.tr(this.hf,d,!1,g),o=0,h=!1,v=null,m==3&&(h=!0,m=(l=(v=l.Ji).fk()).Sb()),(m=m==2)?o=l.zi():isNaN(this.Bm)||(o=this.Bm),m&&this.Qm!=f.si.Clip||(d=f.zb.Fn(d,l.sc(),o,!1,0,c)),m&&(d=f.zb.Mz(d,l,this.Qm,c),f.zb.Lx(l,d,g),d.B())||h&&(d=v.Zk(d,!0),this.wp(v,f.bm.reverse,d),d=v.$k(d,!0)),d},x.prototype.wp=function(d,c,o){var l=o.I();if(l!=0){for(var h=o.ub(0),m=f.O.lg(200,0),g=[],v=0;v<l;){var w=Math.min(100,l-v);h.Vw(2*v,2*w,m,2,!0);for(var E=0;E<w;++E)g[E]=f.h.construct(m[2*v],m[2*v+1]);d.Qt(c,g,w),v+=w}o.Pc(1993)}},x.Uy=function(d,c,o){if(d==null||c==null||!c.Wc())throw f.i.fa("Invalid Arguement");if(d.B())return d;var l=d.getType();return l==197?(l=new f.Da(d.description)).ad(d,!1):f.aa.yd(l)?(l=new f.Ta(d.description)).oc(d,!0):l=d,(l=f.zb.lj(l,c)).B()?l:f.zb.Fn(l,c,0,l!=d,0,o)},x.nj=function(d,c,o,l){if(d==null||c==null||!c.Wc())throw f.i.fa("Invalid Arguement");if(d.B())return d;var h=d.getType();if(f.aa.Hc(h)){d=f.zb.lj(d,c),h=new f.l,d.A(h);for(var m=f.ta.ty(c,h,!1),g=c.gh(),v=Math.floor((h.v-g.v)/g.R())*g.R()+g.v;v<h.C;)v>h.v+m&&v<h.C-m&&(d=f.zb.uS(d,c,o,v)),v+=g.R()}else{if(h==197)return(h=new f.Da(d.description)).ad(d,!1),x.nj(h,c,o,l);if(f.aa.yd(h))return(h=new f.Ta(d.description)).oc(d,!0),x.nj(h,c,o,l)}return x.Uy(d,c,l)},x}();f.bu=L}(Q||(Q={})),function(f){var L=function(x){function d(c,o,l,h){var m=x.call(this)||this;return c===void 0?m.description=f.ee.og():l===void 0?m.description=c:(m.description=f.ee.og(),m.ZB(c,o),m.Ql(l,h)),m}return bt(d,x),d.prototype.getType=function(){return 322},d.prototype.Qb=function(){var c=this.sa-this.pa,o=this.na-this.la;return Math.sqrt(c*c+o*o)},d.prototype.Bi=function(c){var o=this.sa-this.pa,l=this.na-this.la;return Math.sqrt(o*o+l*l)<=c},d.prototype.Pn=function(){return!1},d.prototype.kg=function(){var c=new f.h;return c.uc(this.wc(),this.ac()),c},d.cP=function(c,o){return new d(c.x,c.y,o.x,o.y)},d.prototype.bn=function(c){c.Oa(),c.Nf(this.description);var o=new f.l;this.A(o),c.Xo(o),o=1;for(var l=this.description.Aa;o<l;o++)for(var h=this.description.kd(o),m=f.ra.Va(h);o<m;o++){var g=this.Tg(h,0);c.setInterval(h,0,g)}},d.prototype.A=function(c){c.K(this.sa,this.na,this.pa,this.la),c.normalize()},d.prototype.Qo=function(c){c.Oa(),c.Zb(this.sa,this.na,this.Od(0,1,0)),c.Zb(this.pa,this.la,this.Od(1,1,0))},d.prototype.Oc=function(c){if(c instanceof f.Dd){this.vc();var o=new f.h;o.x=this.sa,o.y=this.na,c.Eh(o,o),this.sa=o.x,this.na=o.y,o.x=this.pa,o.y=this.la,c.Eh(o,o),this.pa=o.x,this.la=o.y}else this.vc(),(o=new f.Nd).x=this.sa,o.y=this.na,o.z=this.Od(0,1,0),o=c.fp(o),this.sa=o.x,this.na=o.y,this.tn(0,1,0,o.z),o.x=this.pa,o.y=this.la,o.z=this.Od(1,1,0),o=c.fp(o),this.pa=o.x,this.la=o.y,this.tn(1,1,0,o.z)},d.prototype.Ia=function(){return new d(this.description)},d.prototype.Tx=function(c,o){return(this.pa-c-(this.sa-c))*(this.la-o+(this.na-o))*.5},d.prototype.vx=function(c){return c*this.Qb()},d.prototype.NG=function(c){return c/this.Qb()},d.prototype.DF=function(c){return f.lc.hq(this.sa,this.pa,c)},d.prototype.fR=function(c){return f.lc.hq(this.na,this.la,c)},d.prototype.dl=function(c,o){var l=new f.ig;return this.ah(c,o,l),l.get()},d.prototype.ah=function(c,o,l){if(l==null)throw f.i.N();l.Or(),(l=l.get()).Nf(this.description);var h=new f.h;this.hc(c,h),l.ZB(h.x,h.y),this.hc(o,h),l.Ql(h.x,h.y),h=1;for(var m=this.description.Aa;h<m;h++)for(var g=this.description.Ed(h),v=f.ra.Va(g),w=0;w<v;w++){var E=this.Uc(c,g,w);l.YB(g,w,E),E=this.Uc(o,g,w),l.OB(g,w,E)}},d.prototype.Uc=function(c,o,l){if(o==0)return l==0?this.hc(c).x:this.hc(c).y;switch(f.ra.lz(o)){case 0:return .5>c?this.wv(o,l):this.gv(o,l);case 1:var h=this.wv(o,l);return o=this.gv(o,l),f.lc.hq(h,o,c);case 2:throw f.i.fa("not implemented")}throw f.i.Qa()},d.prototype.fe=function(c,o){var l=this.pa-this.sa,h=this.la-this.na,m=l*l+h*h;return m==0?.5:(c=((c.x-this.sa)*l+(c.y-this.na)*h)/m,o||(0>c?c=0:1<c&&(c=1)),c)},d.prototype.cq=function(c,o,l,h){if(c){if((c=this.la-this.na)==0)return o==this.la?-1:0;if(0>(o=(o-this.na)/c)||1<o)return 0;l!=null&&(l[0]=this.DF(o))}else{if((c=this.pa-this.sa)==0)return o==this.pa?-1:0;if(0>(o=(o-this.sa)/c)||1<o)return 0;l!=null&&(l[0]=this.fR(o))}return h!=null&&(h[0]=o),1},d.prototype.Pe=function(c,o){var l=this.la-this.na;return l==0?c==this.la?o:NaN:(c=(c-this.na)/l,o=this.DF(c),c==1&&(o=this.pa),o)},d.prototype.ru=function(c,o,l){return 0<=this.rp(c.x,c.y,o,l)},d.prototype.vi=function(c,o,l){return 0<=this.rp(c,o,l,!0)},d.prototype.qs=function(c,o){return this.ru(c,o,!1)},d.prototype.rI=function(){if(this.la<this.na||this.la==this.na&&this.pa<this.sa){var c=this.sa;this.sa=this.pa,this.pa=c,c=this.na,this.na=this.la,this.la=c,c=0;for(var o=this.description.Oq-2;c<o;c++){var l=this.ka[c];this.ka[c]=this.ka[c+o],this.ka[c+o]=l}}},d.prototype.uu=function(c,o){(o=f.h.construct(c,o)).sub(this.ac());var l=new f.h;return l.uc(this.wc(),this.ac()),(c=l.wi(o))>(o=8881784197001252e-31*(Math.abs(l.x*o.y)+Math.abs(l.y*o.x)))?-1:c<-o?1:0},d.prototype.rp=function(c,o,l,h){var m=this.sa,g=this.na,v=c-m,w=o-g;if((v=Math.sqrt(v*v+w*w))<=Math.max(l,6661338147750939e-31*v))return h&&v==0?NaN:0;if(v=c-this.pa,w=o-this.la,(v=Math.sqrt(v*v+w*w))<=Math.max(l,6661338147750939e-31*v))return h&&v==0?NaN:1;if(v=this.pa-this.sa,w=this.la-this.na,0<(h=Math.sqrt(v*v+w*w))){var E=1/h,A=c-m,M=o-g,I=A*(v*=E)+M*(w*=E),D=17763568394002505e-31*(Math.abs(A*v)+Math.abs(M*w)),k=v;if(v=-w,w=k,I<-(D=Math.max(l,D))||I>h+D)return NaN;if(Math.abs(A*v+M*w)<=Math.max(l,17763568394002505e-31*(Math.abs(A*v)+Math.abs(M*w)))&&(.5>=(v=f.O.Rk(I*E,0,1))?(w=this.sa+(this.pa-this.sa)*v,h=this.na+(this.la-this.na)*v):(w=this.pa-(this.pa-this.sa)*(1-v),h=this.la-(this.la-this.na)*(1-v)),f.h.Oy(w,h,c,o)<=l)){if(.5>v){if(f.h.Oy(w,h,m,g)<=l)return 0}else if(f.h.Oy(w,h,this.pa,this.la)<=l)return 1;return v}}return NaN},d.prototype.Nb=function(c){return c!=null&&(c==this||c.constructor===this.constructor&&this.FM(c))},d.prototype.rD=function(c,o,l){var h=l?this.sa:this.pa;l=l?this.na:this.la;var m=new f.h;return m.x=c.pa-h,m.y=c.la-l,!(o.Qh(m)>6661338147750939e-31*o.fD(m))||(m.x=c.sa-h,m.y=c.na-l,o.Qh(m)<=6661338147750939e-31*o.fD(m))},d.prototype.qD=function(c){var o=new f.h;return o.x=this.pa-this.sa,o.y=this.la-this.na,!!this.rD(c,o,!1)&&(o.Sq(),!!this.rD(c,o,!0))},d.NM=function(c,o){var l=c.uu(o.sa,o.na),h=c.uu(o.pa,o.la);return!(0>l&&0>h||0<l&&0<h)&&(l=o.uu(c.sa,c.na),h=o.uu(c.pa,c.la),!(0>l&&0>h||0<l&&0<h)&&((l=c.Qb())>(h=o.Qb())?c.qD(o):o.qD(c)))},d.LM=function(c,o,l){var h=f.h.construct(NaN,NaN),m=c.pa-c.sa,g=c.la-c.na,v=o.pa-o.sa,w=o.la-o.na,E=v*g-m*w;if(E==0)return h;var A=8881784197001252e-31*(Math.abs(v*g)+Math.abs(m*w)),M=o.sa-c.sa,I=o.na-c.na,D=v*I-M*w,k=D/E,B=Math.abs(E);return k<-(v=(8881784197001252e-31*(Math.abs(v*I)+Math.abs(M*w))*B+A*Math.abs(D))/(E*E)+2220446049250313e-31*Math.abs(k))||k>1+v||(v=(w=m*I-M*g)/E)<-(m=(8881784197001252e-31*(Math.abs(m*I)+Math.abs(M*g))*B+A*Math.abs(w))/(E*E)+2220446049250313e-31*Math.abs(v))||v>1+m||(k=f.O.Rk(k,0,1),m=f.O.Rk(v,0,1),g=c.hc(k),E=o.hc(m),(A=new f.h).uc(g,E),A.length()>l&&(A.add(g,E),A.scale(.5),k=c.fe(A,!1),m=o.fe(A,!1),c=c.hc(k),o=o.hc(m),c.sub(o),c.length()>l)||h.ma(k,m)),h},d.OM=function(c,o,l,h){var m=0;if((c.sa==o.sa&&c.na==o.na||c.sa==o.pa&&c.na==o.la)&&(m++,!h))return 1;if(c.pa==o.sa&&c.la==o.na||c.pa==o.pa&&c.la==o.la){if(++m==2)return 2;if(!h)return 1}return o.vi(c.sa,c.na,l)||o.vi(c.pa,c.la,l)||c.vi(o.sa,o.na,l)||c.vi(o.pa,o.la,l)?1:h&&m!=0||d.NM(c,o)==0?0:1},d.Zx=function(c,o,l,h,m,g){var v=0,w=c.rp(o.sa,o.na,g,!1),E=c.rp(o.pa,o.la,g,!1),A=o.rp(c.sa,c.na,g,!1),M=o.rp(c.pa,c.la,g,!1);return isNaN(w)||(h!=null&&(h[v]=w),m!=null&&(m[v]=0),l!=null&&(l[v]=f.h.construct(o.sa,o.na)),v++),isNaN(E)||(h!=null&&(h[v]=E),m!=null&&(m[v]=1),l!=null&&(l[v]=f.h.construct(o.pa,o.la)),v++),v==2||isNaN(A)||w==0&&A==0||E==0&&A==1||(h!=null&&(h[v]=0),m!=null&&(m[v]=A),l!=null&&(l[v]=f.h.construct(c.sa,c.na)),v++),v==2||isNaN(M)||w==1&&M==0||E==1&&M==1||(h!=null&&(h[v]=1),m!=null&&(m[v]=M),l!=null&&(l[v]=f.h.construct(o.pa,o.la)),v++),0<v?(v==2&&h!=null&&h[0]>h[1]&&(c=h[0],h[0]=h[1],h[1]=c,m!=null&&(h=m[0],m[0]=m[1],m[1]=h),l!=null&&(m=f.h.construct(l[0].x,l[0].y),l[0]=l[1],l[1]=m)),v):(v=d.LM(c,o,g),isNaN(v.x)?0:(l!=null&&(l[0]=c.hc(v.x)),h!=null&&(h[0]=v.x),m!=null&&(m[0]=v.y),1))},d.prototype.eG=function(){return 0},d.prototype.op=function(){},d.prototype.toString=function(){return"Line: ["+this.sa.toString()+", "+this.na.toString()+", "+this.pa.toString()+", "+this.la.toString()+"]"},d}(f.SC);f.yb=L}(Q||(Q={})),function(f){var L=function(){function x(){this.Jm=[],this.ya=-1}return x.prototype.La=function(){return this.ya},x.prototype.next=function(){if(this.Jm!=null&&this.Jm.length!=0){this.ya++;var d=this.Jm[0];return this.Jm=1>=this.Jm.length?[]:this.Jm.slice(1),d}return this.Jm=null},x.prototype.ZX=function(d){this.Jm.push(d)},x.prototype.qe=function(){},x}();f.gL=L}(Q||(Q={})),function(f){var L;(L=f.SL||(f.SL={}))[L.enumFillRuleOddEven=0]="enumFillRuleOddEven",L[L.enumFillRuleWinding=1]="enumFillRuleWinding";var x=function(d){function c(o,l){var h=d.call(this)||this;if(h.xf=!1,h.Eq=null,h.sq=0,h.rq=0,h.Aj=null,h.Mg=!1,h.nb=null,h.mb=null,h.Ve=null,h.Lj=null,h.Sd=null,h.tq=0,h.gb=0,h.xq=0,l===void 0)h.xf=o,h.Mg=!1,h.tq=0,h.sq=0,h.rq=0,h.wa=0,h.description=f.ee.og();else{if(l==null)throw f.i.N();h.xf=o,h.Mg=!1,h.tq=0,h.sq=0,h.rq=0,h.wa=0,h.description=l}return h.Aj=null,h.gb=0,h}return bt(c,d),c.prototype.tm=function(){return 0<this.tq},c.prototype.Yx=function(){this.vc(),this.Eq==null?this.Eq=new f.Sa(this.description):this.Eq.Nf(this.description)},c.prototype.sx=function(o,l){var h=new f.h;h.x=o,h.y=l,this.Lt(h)},c.prototype.Lt=function(o){this.Yx(),this.Eq.Cb(o),this.Mg=!0},c.prototype.nf=function(o){if(o.B())throw f.i.N();this.Jl(o.description),this.Yx(),o.copyTo(this.Eq),this.Mg=!0},c.prototype.Sx=function(){var o=1;this.Mg&&(this.Yx(),this.nb==null?(this.nb=f.Yc.Oh(2),this.nb.write(0,0),this.mb=f.Yc.Mr(2,0)):(this.nb.resize(this.nb.size+1,0),this.mb.resize(this.mb.size+1,0)),this.xf&&this.mb.write(this.mb.size-2,1),o++);var l=this.wa;this.nb.write(this.nb.size-1,this.wa+o),this.dm(l+o),this.mb.write(this.nb.size-1,0),this.Mg&&(this.Ht(l,this.Eq),this.Mg=!1)},c.prototype.yj=function(o,l){this.Sx(),this.Cb(this.wa-1,o,l)},c.prototype.Ci=function(o){this.Sx(),this.Cb(this.wa-1,o)},c.prototype.lineTo=function(o){this.Sx(),this.Ht(this.wa-1,o)},c.prototype.CU=function(o){if(this.vc(),this.xf)throw f.i.Qa();var l=this.da();if(o>l)throw f.i.Qa();if(this.dc(o)){if(this.mb==null)throw f.i.Qa();var h=this.wa,m=this.Ba(o),g=this.Vc(o);this.dm(this.wa+1),this.mc();for(var v=0,w=this.description.Aa;v<w;v++)if(this.za[v]!=null){var E=f.ra.Va(this.description.Ed(v));this.za[v].Mn(E*g,this.za[v],E*m,E,!0,1,E*h)}for(;l>o;l--)h=this.nb.read(l),this.nb.write(l,h+1);this.mb.KE(o,1)}},c.prototype.Ap=function(){if(this.wx(),o===void 0){this.Mg=!1;var o=this.da()-1}var l=this.mb.read(o);this.mb.write(o,1|l),this.Ve!=null&&(o=this.Vc(o)-1,this.Ve.write(o,1),this.Lj.write(o,-1))},c.prototype.dc=function(o){return(1&this.mb.read(o))!=0},c.prototype.Nn=function(o){if(this.dc(o))return!0;var l=this.Ba(o);return!(l>(o=this.Vc(o)-1))&&(l=this.Na(l),o=this.Na(o),l.qb(o))},c.prototype.yv=function(o){return(2&this.mb.read(o))!=0},c.prototype.oc=function(o,l){if(this.Jl(o.description),o.getType()!=322)throw f.i.Qa();var h=new f.Sa;(l||this.B())&&(o.To(h),this.nf(h)),o.Po(h),this.lineTo(h)},c.prototype.tp=function(o){var l=this.wa==0;this.sx(o.v,o.G),this.yj(o.v,o.H),this.yj(o.C,o.H),this.yj(o.C,o.G),this.Ap(),this.Mg=!1,l&&this.Lf(256,!1)},c.prototype.ad=function(o,l){if(!o.B()){for(var h=this.wa==0,m=new f.Sa(this.description),g=0;4>g;g++)o.Hf(l?4-g-1:g,m),g==0?this.nf(m):this.lineTo(m);this.Ap(),this.Mg=!1,h&&!l&&this.Lf(256,!1)}},c.prototype.add=function(o,l){for(var h=0;h<o.da();h++)this.addPath(o,h,!l)},c.prototype.addPath=function(o,l,h){this.vf(-1,o,l,h)},c.prototype.Yk=function(o,l){this.Hz(o,l)},c.prototype.Dr=function(o,l,h,m,g){if(g||this.da()!=0||(g=!0),0>l&&(l=o.da()-1),l>=o.da()||0>h||0>m||m>o.rv(l))throw f.i.fa("index out of bounds");if(m!=0){var v=o.dc(l)&&h+m==o.rv(l);if(!v||m!=1){if(this.Mg=!1,this.Jl(o.description),h=o.Ba(l)+h+1,g&&(m++,h--),v&&m--,v=this.wa,this.dm(this.wa+m),this.mc(),g){if(m==0)return;this.nb.add(this.wa),g=o.mb.read(l),g&=-5,this.xf&&(g|=1),this.mb.write(this.mb.size-1,g),this.mb.add(0)}else this.nb.write(this.mb.size-1,this.wa);g=0;for(var w=this.description.Aa;g<w;g++){var E=this.description.kd(g),A=f.ra.Va(E),M=o.description.Pf(E);0>M||o.za[M]==null?this.za[g].Ln(A*v,f.ra.se(E),m*A,A*v):this.za[g].Mn(A*v,o.za[M],A*h,m*A,!0,A,A*v)}if(this.tm()||o.yv(l))throw f.i.Qa();this.Pc(1993)}}},c.prototype.oJ=function(){for(var o=0,l=this.da();o<l;o++)this.FW(o)},c.prototype.FW=function(o){if(this.mc(),o>=this.da())throw f.i.N();var l=this.Ba(o),h=this.Ja(o);o=this.dc(o)?1:0;for(var m=0,g=this.description.Aa;m<g;m++)if(this.za[m]!=null){var v=f.ra.Va(this.description.Ed(m));this.za[m].ni(v*(l+o),v*(h-o),v)}this.Pc(1993)},c.prototype.Zq=function(o){this.mc();var l=this.da();if(0>o&&(o=l-1),o>=l)throw f.i.N();for(var h=this.Ba(o),m=this.Ja(o),g=0,v=this.description.Aa;g<v;g++)if(this.za[g]!=null){var w=f.ra.Va(this.description.Ed(g));this.za[g].En(w*h,w*m,w*this.wa)}for(h=o+1;h<=l;h++)g=this.nb.read(h),this.nb.write(h-1,g-m);if(this.mb==null)for(h=o+1;h<=l;h++)o=this.mb.read(h),this.mb.write(h-1,o);this.nb.resize(l),this.mb.resize(l),this.wa-=m,this.Pg-=m,this.Pc(1993)},c.prototype.vf=function(o,l,h,m){if(l==this||h>=l.da())throw f.i.N();var g=this.da();if(o>g)throw f.i.N();0>o&&(o=g),0>h&&(h=l.da()-1),this.Mg=!1,this.Jl(l.description),l.mc();var v=l.Ba(h),w=l.Ja(h),E=this.wa,A=l.dc(h)&&!m?1:0;this.dm(this.wa+w),this.mc();for(var M=o<g?this.Ba(o):E,I=0,D=this.description.Aa;I<D;I++){var k=this.description.Ed(I),B=l.description.Pf(k),J=f.ra.Va(k);0<=B&&l.za[B]!=null?(A!=0&&this.za[I].Mn(M*J,l.za[B],J*v,J,!0,J,J*E),this.za[I].Mn((M+A)*J,l.za[B],J*(v+A),J*(w-A),m,J,J*(E+A))):this.za[I].Ln(M*J,f.ra.se(k),J*w,J*E)}for(this.nb.add(E+w),m=g;m>=o+1;m--)v=this.nb.read(m-1),this.nb.write(m,v+w);for(l.yv(h),this.mb.add(0),m=g-1;m>=o+1;m--)g=this.mb.read(m),g&=-5,this.mb.write(m+1,g);g=l.JR().read(h),g&=-5,this.xf&&(g|=1),this.mb.write(o,g)},c.prototype.Hz=function(o,l){var h=-1,m=this.da();if(h>m)throw f.i.N();0>h&&(h=m),this.Mg=!1;var g=this.wa;this.dm(this.wa+l),this.mc();var v=h<m?this.Ba(h):g;if(o!=null)this.za[0].Iz(2*v,o,0,l,!0,2*g);else{var w=f.ra.se(0);this.za[0].Ln(2*v,w,2*l,2*g)}o=1;for(var E=this.description.Aa;o<E;o++){w=this.description.kd(o);var A=f.ra.Va(w);w=f.ra.se(w),this.za[o].Ln(v*A,w,A*l,A*g)}for(this.nb.add(this.wa),g=m;g>=h+1;g--)v=this.nb.read(g-1),this.nb.write(g,v+l);for(this.mb.add(0),g=m-1;g>=h+1;g--)l=this.mb.read(g),l&=-5,this.mb.write(g+1,l);this.xf&&this.mb.write(h,1)},c.prototype.qG=function(o,l,h){var m=-1;if(0>o&&(o=this.da()),o>this.da()||m>this.Ja(o)||h>l.length)throw f.i.fa("index out of bounds");if(h!=0){o==this.da()&&(this.nb.add(this.wa),this.xf?this.mb.add(1):this.mb.add(0)),0>m&&(m=this.Ja(o)),this.mc();var g=this.wa;this.dm(this.wa+h),this.mc();for(var v=0,w=this.description.Aa;v<w;v++){var E=this.description.Ed(v),A=f.ra.Va(E);this.za[v].Ut(A*(this.Ba(o)+m+h),(g-this.Ba(o)-m)*A,this.za[v],A*(this.Ba(o)+m),!0,A),v==0?this.za[v].vC(A*(this.Ba(o)+m),h,l,0,!0):this.za[v].Wj(f.ra.se(E),(this.Ba(o)+m)*A,h*A)}for(this.tm()&&(this.Ve.Ut(this.Ba(o)+m+h,g-this.Ba(o)-m,this.Ve,this.Ba(o)+m,!0,1),this.Lj.Ut(this.Ba(o)+m+h,g-this.Ba(o)-m,this.Lj,this.Ba(o)+m,!0,1),this.Ve.Wj(1,this.Ba(o)+m,h),this.Lj.Wj(-1,this.Ba(o)+m,h)),o+=1,l=this.da();o<=l;o++)this.nb.write(o,this.nb.read(o)+h)}},c.prototype.wf=function(o,l,h){var m=this.da();if(0>o&&(o=this.da()),o>=m||l>this.Ja(o))throw f.i.fa("index out of bounds");o==this.da()&&(this.nb.add(this.wa),this.xf?this.mb.add(1):this.mb.add(0)),0>l&&(l=this.Ja(o));var g=this.wa;this.dm(this.wa+1),this.mc();var v=this.Ba(o);this.za[0].vj(2*(v+l),h,2*g),h=1;for(var w=this.description.Aa;h<w;h++){var E=this.description.Ed(h),A=f.ra.Va(E);this.za[h].Ln(A*(v+l),f.ra.se(E),A,A*g)}for(o+=1;o<=m;o++)this.nb.write(o,this.nb.read(o)+1)},c.prototype.DB=function(o,l){var h=this.da();if(0>o&&(o=h-1),o>=h||l>=this.Ja(o))throw f.i.fa("index out of bounds");this.mc();var m=this.Ba(o);0>l&&(l=this.Ja(o)-1),l=m+l,m=0;for(var g=this.description.Aa;m<g;m++)if(this.za[m]!=null){var v=f.ra.Va(this.description.Ed(m));this.za[m].En(v*l,v,v*this.wa)}for(;h>=o+1;h--)l=this.nb.read(h),this.nb.write(h,l-1);this.wa--,this.Pg--,this.Pc(1993)},c.prototype.uE=function(o,l,h){var m=this.Ba(o)+l;if((h=this.Ba(h)+void 0)<m||0>m||h>this.I()-1)throw f.i.N();l=0,(o=this.Ga()).Vb(m);do{for(;o.Ha()&&(m=o.ha(),o.wb()!=h);)l+=m=m.Qb();if(o.wb()==h)break}while(o.$a());return l},c.prototype.fO=function(o,l,h){if(l=this.Ba(o)+l,h=this.Ba(o)+h,0>l||h>this.I()-1)throw f.i.N();var m=this.Ga();if(l>h){if(!this.dc(o))throw f.i.N("cannot iterate across an open path");m.JB()}var g=o=0;m.Vb(l);do g+=o,o=m.ha().Qb();while(m.wb()!=h);return g},c.prototype.mg=function(){return f.pi.gm(this,null)},c.prototype.KS=function(o,l,h){for(var m=o;m<h-1;m++)if(this.dc(m))throw f.i.N("cannot interpolate across closed paths");if((m=this.description.Aa)!=1){var g=this.uE(o,l,h);if(g!=0)for(var v=1;v<m;v++){var w=this.description.kd(v);if(f.ra.lz(w)!=2)for(var E=f.ra.Va(w),A=0;A<E;A++)this.MS(w,o,l,h,g,A)}}},c.prototype.JS=function(o,l,h){var m=this.description.Aa;if(m!=1){var g=this.fO(o,l,h);if(g!=0)for(var v=1;v<m;v++){var w=this.description.kd(v);if(f.ra.lz(w)!=2)for(var E=f.ra.Va(w),A=0;A<E;A++)this.LS(w,o,l,h,g,A)}}},c.prototype.MS=function(o,l,h,m,g,v){var w=this.Ga(),E=this.Ba(l)+h;m=this.Ba(m)+void 0,l=this.Uc(o,E,v),h=this.Uc(o,m,v);var A=l,M=0;w.Vb(E);do if(w.Ha()){if(w.ha(),w.wb()==m)break;this.setAttribute(o,w.wb(),v,A),w.li();do{if(E=w.ha(),w.ik()==m)return;M+=E=E.Qb(),A=f.lc.hq(l,h,M/g),w.On()||this.setAttribute(o,w.ik(),v,A)}while(w.Ha())}while(w.$a())},c.prototype.LS=function(o,l,h,m,g,v){var w=this.Ga(),E=this.Ba(l)+h;if((l=this.Ba(l)+m)!=E){m=this.Uc(o,E,v),h=this.Uc(o,l,v);var A=0;w.Vb(E),w.JB(),E=m;do{var M=w.ha();this.setAttribute(o,w.wb(),v,E),A+=E=M.Qb(),E=f.lc.hq(m,h,A/g)}while(w.ik()!=l)}},c.prototype.Oa=function(){this.tq=0,this.Mg=!1,this.Sd=this.Ve=this.Lj=this.mb=this.nb=null,this.wD()},c.prototype.Oc=function(o){o instanceof f.Dd?this.YD(o,-1):this.wN(o)},c.prototype.YD=function(o,l){if(!this.B()&&!o.isIdentity()){this.mc();var h=this.za[0],m=new f.h,g=new f.h;if(0>l){var v=this.tm(),w=0;l=this.wa}else v=this.yv(l),w=this.Ba(l),l=this.Vc(l);for(;w<l;w++){if(m.x=h.read(2*w),m.y=h.read(2*w+1),v){var E=this.Lj.read(w);if(0<=E)switch(7&this.Ve.read(w)){case 2:g.x=this.Sd.read(E),g.y=this.Sd.read(E+1),o.Eh(g,g),this.Sd.write(E,g.x),this.Sd.write(E+1,g.y),g.x=this.Sd.read(E+3),g.y=this.Sd.read(E+4),o.Eh(g,g),this.Sd.write(E+3,g.x),this.Sd.write(E+4,g.y);break;case 4:throw f.i.Qa()}}o.Eh(m,m),h.write(2*w,m.x),h.write(2*w+1,m.y)}this.Pc(1993)}},c.prototype.wN=function(o){if(!this.B()){this.re(1),this.mc();for(var l=this.za[0],h=this.za[1],m=new f.Nd,g=new f.Nd,v=this.tm(),w=0;w<this.wa;w++){if(m.x=l.read(2*w),m.y=l.read(2*w+1),m.z=h.read(w),v){var E=this.Lj.read(w);if(0<=E)switch(7&this.Ve.read(w)){case 2:g.x=this.Sd.read(E),g.y=this.Sd.read(E+1),g.z=this.Sd.read(E+2),g=o.fp(g),this.Sd.write(E,g.x),this.Sd.write(E+1,g.y),this.Sd.write(E+1,g.z),g.x=this.Sd.read(E+3),g.y=this.Sd.read(E+4),g.z=this.Sd.read(E+5),g=o.fp(g),this.Sd.write(E+3,g.x),this.Sd.write(E+4,g.y),this.Sd.write(E+5,g.z);break;case 4:throw f.i.Qa()}}m=o.fp(m),l.write(2*w,m.x),l.write(2*w+1,m.y),h.write(w,m.z)}this.Pc(1993)}},c.prototype.iy=function(){this.nb==null&&(this.nb=f.Yc.Oh(1,0),this.mb=f.Yc.Mr(1,0)),this.Ve!=null&&(this.Ve.resize(this.Pg,1),this.Lj.resize(this.Pg,-1))},c.prototype.op=function(o){o.Mg=!1,o.tq=this.tq,o.xq=this.xq,o.nb=this.nb!=null?f.ia.Bn(this.nb):null,o.mb=this.mb!=null?f.pn.Bn(this.mb):null,o.Lj=this.Lj!=null?f.ia.Bn(this.Lj):null,o.Ve=this.Ve!=null?f.pn.Bn(this.Ve):null,o.Sd=this.Sd!=null?f.be.Bn(this.Sd):null,o.sq=this.sq,o.rq=this.rq,o.Aj=this.ak(1024)?null:this.Aj},c.prototype.Qb=function(){if(!this.ak(512))return this.sq;for(var o=this.Ga(),l=new f.Fx(0);o.$a();)for(;o.Ha();)l.add(o.ha().Qb());return this.sq=l.rm(),this.Lf(512,!1),l.rm()},c.prototype.Nb=function(o){if(o==this)return!0;if(!(o instanceof c&&d.prototype.Nb.call(this,o)))return!1;var l=this.da();return!(l!=o.da()||this.nb!=null&&!this.nb.Nb(o.nb,0,l+1)||this.xq!=o.xq||this.mb!=null&&!this.mb.Nb(o.mb,0,l))&&d.prototype.Nb.call(this,o)},c.prototype.Ga=function(){return new f.YL(this)},c.prototype.hy=function(o){if(d.prototype.hy.call(this,o),this.tm())for(o=this.Ga();o.$a();)o.Ha()},c.prototype.yp=function(o,l){if(d.prototype.yp.call(this,o,l),this.tm())for(o=this.Ga();o.$a();)o.Ha()},c.prototype.$x=function(){this.wa=this.nb==null||this.nb.size==0?0:this.nb.read(this.nb.size-1)},c.prototype.Ke=function(){return this.xf?(this.xu(),this.rq):0},c.prototype.Ev=function(o){return!!this.xf&&(this.ak(8)?(this.xu(),0<this.Aj.read(o)):(4&this.mb.read(o))!=0)},c.prototype.Ir=function(o){return this.xf?(this.xu(),this.Aj.read(o)):0},c.prototype.xu=function(){if(this.ak(1024)){var o=this.da();this.Aj==null?this.Aj=new f.be(o):this.Aj.size!=o&&this.Aj.resize(o),o=new f.Fx(0);for(var l=new f.Fx(0),h=new f.h,m=0,g=this.Ga();g.$a();){for(l.reset(),this.D(this.Ba(g.gb),h);g.Ha();)l.add(g.ha().Tx(h.x,h.y));o.add(l.rm());var v=m++;this.Aj.write(v,l.rm())}this.rq=o.rm(),this.Lf(1024,!1)}},c.prototype.FR=function(){if(this.xf){this.fm();for(var o=this.da(),l=0;l<o;l++)4&this.mb.read(l)}},c.prototype.fm=function(){if(this.ak(8)){this.xu();var o=this.da();(this.mb==null||this.mb.size<o)&&(this.mb=f.Yc.Mr(o+1));for(var l=1,h=0;h<o;h++){var m=this.Aj.read(h);h==0&&(l=0<m?1:-1),0<m*l?this.mb.zJ(h,4):this.mb.KE(h,4)}this.Lf(8,!1)}},c.prototype.sz=function(o){var l=this.gb,h=this.da();if(0<=l&&l<h){if(o<this.Vc(l)){if(o>=this.Ba(l))return l;l--}else l++;if(0<=l&&l<h&&o>=this.Ba(l)&&o<this.Vc(l))return this.gb=l}if(5>h){for(l=0;l<h;l++)if(o<this.Vc(l))return this.gb=l;throw f.i.fa("corrupted geometry")}for(l=0,--h;h>l;){var m=l+(h-l>>1);if(o<this.Ba(m))h=m-1;else{if(!(o>=(l=this.Vc(m))))return this.gb=m;l=m+1}}return this.gb=l},c.prototype.yz=function(){var o=this.I();if(!this.xf){o-=this.da();for(var l=0,h=this.da();l<h;l++)this.dc(l)&&o++}return o},c.prototype.rv=function(o){var l=this.Ja(o);return this.dc(o)||l--,l},c.prototype.Ia=function(){return new c(this.xf,this.description)},c.prototype.Db=function(){return this.xf?2:1},c.prototype.getType=function(){return this.xf?1736:1607},c.prototype.QJ=function(o){this.nb=o,this.Pc(16777215)},c.prototype.VR=function(){return this.wx(),this.Ve},c.prototype.JR=function(){return this.wx(),this.mb},c.prototype.PJ=function(o){this.mb=o,this.Pc(16777215)},c.prototype.da=function(){return this.nb!=null?this.nb.size-1:0},c.prototype.Vc=function(o){return this.nb.read(o+1)},c.prototype.Ja=function(o){return this.nb.read(o+1)-this.nb.read(o)},c.prototype.Ba=function(o){return this.nb.read(o)},c.prototype.lu=function(o,l){this.Bb==null&&(this.Bb=new f.Uk),l=f.Nx.pW(l);var h=this.Bb.Fk;if(h!=null){if(!(h.Ik<o||l>h.RR()))return!0;this.Bb.yD(null)}return h=f.Nx.create(this,o,l),this.Bb.yD(h),!0},c.prototype.cc=function(){var o=d.prototype.cc.call(this);if(!this.Ac()){var l=this.da();this.nb!=null&&this.nb.An(o,0,l+1),this.mb!=null&&this.mb.An(o,0,l)}return o},c.prototype.ZF=function(o){return this.Ve!=null?this.Ve.read(o):1},c.prototype.bc=function(o,l,h){var m=this.sz(o);if(o==this.Vc(m)-1&&!this.dc(m))throw f.i.fa("index out of bounds");this.mc();var g=this.Ve,v=1;if(g!=null&&(v=7&g.read(o)),v!==1)throw f.i.Qa();if(l.Or(),l=l.get(),h?l.Nf(f.ee.og()):l.Nf(this.description),m=o==this.Vc(m)-1&&this.dc(m)?this.Ba(m):o+1,g=new f.h,this.D(o,g),l.Dc(g),this.D(m,g),l.Qc(g),!h)for(h=1,g=this.description.Aa;h<g;h++){v=this.description.Ed(h);for(var w=f.ra.Va(v),E=0;E<w;E++){var A=this.Uc(v,o,E);l.YB(v,E,A),A=this.Uc(v,m,E),l.OB(v,E,A)}}},c.prototype.Rj=function(o,l){if(o>=this.da())throw f.i.N();if(this.B())l.Oa();else{if(this.yv(o))throw f.i.fa("not implemented");var h=this.ub(0),m=new f.h,g=new f.l;g.Oa();var v=this.Ba(o);for(o=this.Vc(o);v<o;v++)h.tc(2*v,m),g.Zb(m);l.K(g)}},c.prototype.fj=function(o){return this.Bb==null&&(this.Bb=new f.Uk),!(o==0||16>this.I())&&(o=f.ta.nE(this),this.Bb.WM(o),!0)},c.prototype.hM=function(){if(this.Bb==null&&(this.Bb=new f.Uk),this.Bb.zo==null){this.Bb.xD(null);var o=f.ta.YN(this);this.Bb.xD(o)}},c.prototype.Yo=function(o){this.xq=o},c.prototype.In=function(){return this.xq},c.prototype.DD=function(o){if(this==o)throw f.i.fa("MultiPathImpl.add");for(var l=this.da(),h=0;h<o.da();h++)this.addPath(o,h,!0),this.CU(l),l++},c.prototype.kO=function(o){var l=this.sz(o),h=this.Ba(l);if(h!=o){if(o>=(l=this.Vc(l))||o<h)throw f.i.fa("change_ring_start_point");for(var m=0,g=this.description.Aa;m<g;m++){var v=this.description.kd(m);v=f.ra.Va(v),this.za[m].rotate(h*v,o*v,l*v)}}},c}(f.Gx);f.Vk=x}(Q||(Q={})),function(f){var L=function(x){function d(c){var o=x.call(this)||this;if(c!==void 0){if(c==null)throw f.i.N();o.description=c}else o.description=f.ee.og();return o.wa=0,o}return bt(d,x),d.prototype.Ia=function(){return new d(this.description)},d.prototype.add=function(c){this.resize(this.wa+1),this.Dh(this.wa-1,c)},d.prototype.Bu=function(c,o){this.resize(this.wa+1);var l=new f.h;l.ma(c,o),this.Cb(this.wa-1,l)},d.prototype.Fd=function(c,o,l){if(l=0>l?c.I():l,0>o||o>c.I()||l<o)throw f.i.N();if(o!=l){this.Jl(c.description),l-=o;var h=this.wa;this.resize(this.wa+l),this.mc();for(var m=0,g=c.description.Aa;m<g;m++){var v=c.description.Ed(m),w=f.ra.Va(v),E=this.ub(v);v=c.ub(v),E.Mn(h*w,v,o*w,l*w,!0,1,h*w)}}},d.prototype.HD=function(c,o){var l=c.length;if(o=0>o?l:o,0>l||0>o)throw f.i.N();if(o!=0){l=o-0,o=this.wa,this.resize(this.wa+l);for(var h=0;h<l;h++)this.Cb(o+h,c[0+h])}},d.prototype.DB=function(c){if(0>c||c>=this.I())throw f.i.fa("index out of bounds");this.mc();for(var o=0,l=this.description.Aa;o<l;o++)if(this.za[o]!=null){var h=f.ra.Va(this.description.Ed(o));this.za[o].En(h*c,h,h*this.wa)}this.wa--,this.Pg--,this.Pc(1993)},d.prototype.resize=function(c){this.dm(c)},d.prototype.op=function(){},d.prototype.Oa=function(){x.prototype.wD.call(this)},d.prototype.Oc=function(c){if(c instanceof f.Dd){if(this.B())return;this.mc();for(var o=this.za[0],l=new f.h,h=0;h<this.wa;h++)l.x=o.read(2*h),l.y=o.read(2*h+1),c.Eh(l,l),o.write(2*h,l.x),o.write(2*h+1,l.y)}else{if(this.B())return;this.mc(),this.re(1),this.mc(),o=this.za[0],l=this.za[1];var m=new f.Nd;for(h=0;h<this.wa;h++){m.x=o.read(2*h),m.y=o.read(2*h+1),m.z=l.read(h);var g=c.fp(m);o.write(2*h,g.x),o.write(2*h+1,g.y),l.write(h,g.z)}}this.Pc(1993)},d.prototype.Db=function(){return 0},d.prototype.getType=function(){return 550},d.prototype.Ke=function(){return 0},d.prototype.Qb=function(){return 0},d.prototype.Nb=function(c){return c==this||c instanceof d&&x.prototype.Nb.call(this,c)},d.prototype.lW=function(c,o){var l=this.wa;if(l=Math.min(l,o+1e3),0>o||o>=this.wa||l<o||c.length!=1e3)throw f.i.N();var h=l-o,m=[];for(this.ub(0).Vw(2*o,2*h,m,0,!0),o=0;o<h;o++)c[o]=f.h.construct(m[2*o],m[2*o+1]);return l},d.prototype.$x=function(){},d.prototype.iy=function(){},d.prototype.lu=function(){return!1},d.prototype.fj=function(){return!1},d.prototype.mg=function(){return null},d}(f.Gx);f.de=L}(Q||(Q={})),function(f){var L;(L=f.iL||(f.iL={}))[L.NotDetermined=0]="NotDetermined",L[L.Structure=1]="Structure",L[L.DegenerateSegments=2]="DegenerateSegments",L[L.Clustering=3]="Clustering",L[L.Cracking=4]="Cracking",L[L.CrossOver=5]="CrossOver",L[L.RingOrientation=6]="RingOrientation",L[L.RingOrder=7]="RingOrder",L[L.OGCPolylineSelfTangency=8]="OGCPolylineSelfTangency",L[L.OGCPolygonSelfTangency=9]="OGCPolygonSelfTangency",L[L.OGCDisconnectedInterior=10]="OGCDisconnectedInterior";var x=function(){function d(c,o,l){c===void 0?(this.Jj=0,this.Ko=this.Jo=-1):(this.Jj=c,this.Jo=o,this.Ko=l)}return d.prototype.Wt=function(c){this.Jj=c.Jj,this.Jo=c.Jo,this.Ko=c.Ko},d}();f.Md=x}(Q||(Q={})),function(f){f.O=function(){function L(){}return L.assert=function(x){if(x===!1)throw f.i.GK()},L.bK=function(x){return isNaN(x)?NaN:x===0?x:0<x?1:-1},L.Fu=function(x){var d;d===void 0&&(d=0);for(var c=[],o=0;o<x;o++)c[o]=L.lg(2,d);return c},L.lg=function(x,d){d===void 0&&(d=0);for(var c=[],o=0;o<x;o++)c[o]=d;return c},L.$u=function(x,d){var c,o;for(c===void 0&&(c=0),o===void 0&&(o=x.length-1);c<=o;c++)x[c]=d},L.Rk=function(x,d,c){return x<d?d:x>c?c:x},L.Th=function(x,d){var c=5381;return((c=((c=((c=d!==void 0?(d<<5)+d+(255&x):(c<<5)+c+(255&x))<<5)+c+(x>>8&255))<<5)+c+(x>>16&255))<<5)+c+(x>>24&255)&2147483647},L.uj=function(){throw Error("Not Implemented")},L.bB=function(x){return L.aU(x)+12345&2147483647},L.XG=function(x){var d=32,c=x%L.Qx|0,o=x/L.Qx|0;return(d&=63)==0?x:(32>d?(x=c>>>d|o<<32-d,d=o>>d):(x=o>>d-32,d=0<=o?0:-1),d*L.Qx+(x>>>0))},L.aU=function(x){var d=1103515245,c=65535&d;return((d-c)*(x|=0)|0)+(c*x|0)|0},L.truncate=function(x){return 0>x?-1*Math.floor(Math.abs(x)):Math.floor(x)},L.MAX_SAFE_INTEGER=Math.pow(2,53)-1,L.MIN_SAFE_INTEGER=-L.MAX_SAFE_INTEGER,L.VC=65536,L.Qx=L.VC*L.VC,L}()}(Q||(Q={})),function(f){var L;(L=f.CL||(f.CL={}))[L.Project=0]="Project",L[L.Union=1]="Union",L[L.Difference=2]="Difference",L[L.Proximity2D=3]="Proximity2D",L[L.Relate=4]="Relate",L[L.Equals=5]="Equals",L[L.Disjoint=6]="Disjoint",L[L.Intersects=7]="Intersects",L[L.Within=8]="Within",L[L.Contains=9]="Contains",L[L.Crosses=10]="Crosses",L[L.Touches=11]="Touches",L[L.Overlaps=12]="Overlaps",L[L.Buffer=13]="Buffer",L[L.Distance=14]="Distance",L[L.Intersection=15]="Intersection",L[L.Clip=16]="Clip",L[L.Cut=17]="Cut",L[L.DensifyByLength=18]="DensifyByLength",L[L.DensifyByAngle=19]="DensifyByAngle",L[L.LabelPoint=20]="LabelPoint",L[L.GeodesicBuffer=21]="GeodesicBuffer",L[L.GeodeticDensifyByLength=22]="GeodeticDensifyByLength",L[L.ShapePreservingDensify=23]="ShapePreservingDensify",L[L.GeodeticLength=24]="GeodeticLength",L[L.GeodeticArea=25]="GeodeticArea",L[L.Simplify=26]="Simplify",L[L.SimplifyOGC=27]="SimplifyOGC",L[L.Offset=28]="Offset",L[L.Generalize=29]="Generalize",L[L.SymmetricDifference=30]="SymmetricDifference",L[L.ConvexHull=31]="ConvexHull",L[L.Boundary=32]="Boundary",L[L.SimpleRelation=33]="SimpleRelation";var x=function(){function d(){}return d.prototype.getType=function(){return null},d.prototype.wn=function(){},d.prototype.Iu=function(){return!1},d}();f.Je=x}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.prototype.getType=function(){return 13},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.V=function(c,o,l,h,m){return c instanceof f.aa?(m=new f.Zc(c),this.V(m,o,[l],!1,h).next()):h===!0?(l=new f.BC(c,o,l,!1,m),f.Gh.local().V(l,o,m)):new f.BC(c,o,l,!1,m)},d.instance=null,d}(f.Je);f.AC=L}(Q||(Q={})),function(f){var L=function(){function x(d,c,o,l,h){this.ya=-1,this.Rd=d,this.$z=c,this.Cs=o,this.tT=new f.l,this.tT.Oa(),this.eo=-1,this.Ub=h}return x.prototype.next=function(){for(var d;(d=this.Rd.next())!=null;)return this.ya=this.Rd.La(),this.eo+1<this.Cs.length&&this.eo++,this.buffer(d,this.Cs[this.eo]);return null},x.prototype.La=function(){return this.ya},x.prototype.buffer=function(d,c){return f.HK.buffer(d,c,this.$z,NaN,96,this.Ub)},x.prototype.qe=function(){},x}();f.BC=L}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.prototype.getType=function(){return 16},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.V=function(c,o,l,h){return c instanceof f.aa?(c=new f.Zc(c),this.V(c,o,l,h).next()):new f.lL(c,o,l,h)},d.instance=null,d}(f.Je);f.kL=L}(Q||(Q={})),function(f){var L=function(){function x(d,c,o){if(this.ya=-1,d==null)throw f.i.N();this.$=c,this.yk=d,this.qa=f.ta.Wd(o,c,!1)}return x.prototype.next=function(){var d;return(d=this.yk.next())!=null?(this.ya=this.yk.La(),f.Ud.clip(d,this.$,this.qa,0)):null},x.prototype.La=function(){return this.ya},x.prototype.qe=function(){},x}();f.lL=L}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.prototype.getType=function(){return 31},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.V=function(c,o,l){return c instanceof f.aa?f.DC.rE(c):new f.DC(o,c,l)},d.instance=null,d}(f.Je);f.CC=L}(Q||(Q={})),function(f){var L=function(){function x(d,c,o){if(this.uA=new f.Zt,this.ya=-1,c==null)throw f.i.N();this.cH=d,this.Ic=!1,this.yk=c,this.Ub=o}return x.prototype.next=function(){if(this.cH){if(!this.Ic){var d=this.dO(this.yk);return this.Ic=!0,d}return null}if(!this.Ic){if((d=this.yk.next())!=null)return this.ya=this.yk.La(),x.rE(d);this.Ic=!0}return null},x.prototype.La=function(){return this.ya},x.prototype.dO=function(d){for(var c;(c=d.next())!=null;)this.uA.Ib(c);return this.uA.cR()},x.prototype.qe=function(){if(!this.Ic){if(!this.cH)throw f.i.fa("Invalid call for non merging convex hull.");var d=this.yk.next();if(d==null)throw f.i.fa("Expects a non-null geometry.");this.uA.Ib(d)}},x.rE=function(d){if(x.VS(d))return d;var c=d.getType();if(f.Vk.yd(c))return(c=new f.Ta(d.description)).oc(d,!0),c;if(c==550&&d.I()==2){var o=new f.Sa;return c=new f.Ta(d.description),d.ve(0,o),c.nf(o),d.ve(1,o),c.lineTo(o),c}return f.Zt.RO(d)},x.VS=function(d){if(d.B())return!0;var c=d.getType();return c==33||c==197||!f.Vk.yd(c)&&(c==550?d.I()==1:c==1607?d.da()==1&&2>=d.I():d.da()==1&&(2>=d.I()||f.Zt.JG(d,0)))},x}();f.DC=L}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.prototype.getType=function(){return 17},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.V=function(c,o,l,h,m){return new f.nL(c,o,l,h,m)},d.instance=null,d}(f.Je);f.mL=L}(Q||(Q={})),function(f){var L=function(){function x(d,c,o,l,h){if(this.Tf=null,c==null||o==null)throw f.i.fa("invalid argument");this.qT=d,this.nA=c,this.lH=o,d=f.ta.mv(c,o),this.qa=f.ta.Wd(l,d,!0),this.kH=-1,this.nd=h}return x.prototype.La=function(){return 0},x.prototype.next=function(){return this.RQ(),++this.kH<this.Tf.length?this.Tf[this.kH]:null},x.prototype.RQ=function(){if(this.Tf==null)switch(this.Tf=[],this.nA.getType()){case 1607:this.TQ();break;case 1736:this.SQ()}},x.prototype.TQ=function(){var d=new f.Ta,c=new f.Ta,o=new f.Ta;this.Tf.push(d),this.Tf.push(c);var l=[];f.LK.JK(this.qT,this.nA,this.lH,this.qa,l,this.nd);for(var h=0;h<l.length;h++){var m=l[h];if(m.bt==0)d.add(m.X,!1);else if(m.bt==1||m.bt==2)c.add(m.X,!1);else if(m.bt==3)this.Tf.push(m.X);else{if(m.bt!=4)throw f.i.fa("internal");o.add(m.X,!1)}}o.B()||d.B()&&c.B()&&!(3<=this.Tf.length)||this.Tf.push(o),d.B()&&c.B()&&3>this.Tf.length&&(this.Tf.length=0)},x.prototype.SQ=function(){var d=new f.ia(0),c=new f.gd,o=c.aF(),l=c.Ib(this.nA),h=c.Ib(this.lH),m=new f.Fg;try{m.Ft(c,this.qa,this.nd),m.dl(o,l,h,d);var g=c.Ne(l),v=new f.Da,w=new f.Da;for(this.Tf.length=0,this.Tf.push(v),this.Tf.push(w),l=0;l<d.size;l++){var E=new f.gd,A=E.Ib(g),M=E.Ib(c.Ne(d.get(l)));m.dr(E,this.nd);var I=m.Av(A,M),D=E.Ne(I);if(!D.B()){var k=c.KF(d.get(l),o);k==2?v.add(D,!1):k==1?w.add(D,!1):this.Tf.push(D);var B=new f.gd;A=B.Ib(g),M=B.Ib(c.Ne(d.get(l))),m.dr(B,this.nd),g=B.Ne(m.im(A,M))}}!g.B()&&0<d.size&&this.Tf.push(g),v.B()&&w.B()&&(this.Tf.length=0)}finally{m.Ug()}},x.prototype.qe=function(){},x}();f.nL=L}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.prototype.getType=function(){return 18},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.V=function(c,o,l){if(c instanceof f.aa)return c=new f.Zc(c),this.V(c,o,l).next();if(0>=o)throw f.i.N();return new f.oL(c,o,l)},d.instance=null,d}(f.Je);f.Xl=L}(Q||(Q={})),function(f){var L=function(){function x(d,c){this.ya=-1,this.Rd=d,this.Ps=c}return x.prototype.La=function(){return this.ya},x.prototype.next=function(){var d;return(d=this.Rd.next())!=null?(this.ya=this.Rd.La(),this.NP(d)):null},x.prototype.NP=function(d){if(d.B()||1>d.Db())return d;var c=d.getType();if(c==1736||c==1607)return this.Ny(d);if(f.aa.yd(c))return this.PP(d);if(c==197)return this.OP(d);throw f.i.Qa()},x.prototype.PP=function(d){if(d.Qb()<=this.Ps)return d;var c=new f.Ta(d.description);return c.oc(d,!0),this.Ny(c)},x.prototype.OP=function(d){var c=new f.Da(d.description);c.ad(d,!1);var o=new f.l;return d.A(o),d=o.ca(),o.R()<=this.Ps&&d<=this.Ps?c:this.Ny(c)},x.prototype.Ny=function(d){for(var c=d.Ia(),o=d.Ga();o.$a();)for(var l=!0;o.Ha();){var h=o.ha();if(h.getType()!=322)throw f.i.fa("not implemented");var m=o.On(),g=h.Qb();if(g>this.Ps){var v=Math.ceil(g/this.Ps);g=new f.Sa(d.description),l&&(h.To(g),c.nf(g));var w=l=1/v,E=0;for(--v;E<v;E++)h.Tw(w,g),c.lineTo(g),w+=l;m?c.Ap():(h.Po(g),c.lineTo(g))}else m?c.Ap():c.oc(h,l);l=!1}return c},x.prototype.qe=function(){},x}();f.oL=L}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.getType=function(){return 2},d.prototype.V=function(c,o,l,h){return c instanceof f.aa?(c=new f.Zc(c),o=new f.Zc(o),this.V(c,o,l,h).next()):new f.qL(c,o,l,h)},d.im=function(c,o,l,h){if(c.B()||o.B())return c;var m=c.Db(),g=o.Db();if(m>g)return c;var v=c.getType(),w=o.getType(),E=new f.l,A=new f.l,M=new f.l;c.A(E),o.A(A),M.K(E),M.Zb(A);var I=(M=f.ta.Wd(l,M,!0))*Math.sqrt(2)*1.00001,D=new f.l;if(D.K(E),D.W(I,I),!D.isIntersecting(A))return c;if(m==1&&g==2)return d.KV(c,o,w,l,h);if(v==33)switch(f.Vk.yd(w)?(l=new f.Ta(o.description),l.oc(o,!0)):l=o,w){case 1736:return d.XU(c,l,M);case 1607:return d.YU(c,l,M);case 550:return d.VU(c,l,M);case 197:return d.UU(c,l,M);case 33:return d.WU(c,l,M);default:throw f.i.N()}else if(v==550)switch(w){case 1736:return d.nU(c,o,M);case 197:return d.lU(c,o,M);case 33:return d.mU(c,o,M)}return f.Fg.im(c,o,l,h)},d.XU=function(c,o,l){return f.hd.KG(o,c,l)==0?c:c.Ia()},d.YU=function(c,o,l){var h=c.D();o=o.Ga();for(var m=l*Math.sqrt(2)*1.00001,g=m*m,v=new f.l;o.$a();)for(;o.Ha();){var w=o.ha();if(w.A(v),v.W(m,m),v.contains(h)){if(w.qs(h,l))return c.Ia();var E=w.ac();if(f.h.yc(h,E)<=g||(E=w.wc(),f.h.yc(h,E)<=g))return c.Ia()}}return c},d.VU=function(c,o,l){var h=o.ub(0);o=o.I();var m=c.D(),g=new f.h;l=l*Math.sqrt(2)*1.00001,l*=l;for(var v=0;v<o;v++)if(h.tc(2*v,g),f.h.yc(g,m)<=l)return c.Ia();return c},d.UU=function(c,o,l){var h=new f.l;return o.A(h),h.W(l,l),o=c.D(),h.contains(o)?c.Ia():c},d.WU=function(c,o,l){l=l*Math.sqrt(2)*1.00001,l*=l;var h=c.D();return o=o.D(),f.h.yc(h,o)<=l?c.Ia():c},d.nU=function(c,o,l){var h=new f.l;o.A(h),h.W(l,l);for(var m=c.I(),g=!1,v=[],w=0;w<m;w++)v[w]=!1;var E=new f.h;for(w=0;w<m;w++)c.D(w,E),h.contains(E)&&f.hd.Yd(o,E,l)!=0&&(g=!0,v[w]=!0);if(!g)return c;for(o=c.Ia(),w=0;w<m;w++)v[w]||o.Fd(c,w,w+1);return o},d.lU=function(c,o,l){var h=new f.l;o.A(h),h.W(l,l),o=c.I();var m=!1;l=[];for(var g=0;g<o;g++)l[g]=!1;var v=new f.h;for(g=0;g<o;g++)c.D(g,v),h.contains(v)&&(m=!0,l[g]=!0);if(!m)return c;for(h=c.Ia(),g=0;g<o;g++)l[g]||h.Fd(c,g,g+1);return h},d.mU=function(c,o,l){var h=c.ub(0),m=c.I(),g=o.D(),v=new f.h,w=!1;o=[];for(var E=0;E<m;E++)o[E]=!1;for(l=(E=l*Math.sqrt(2)*1.00001)*E,E=0;E<m;E++)h.tc(2*E,v),f.h.yc(v,g)<=l&&(w=!0,o[E]=!0);if(!w)return c;for(h=c.Ia(),E=0;E<m;E++)o[E]||h.Fd(c,E,E+1);return h},d.KV=function(c,o,l,h,m){var g=new f.Fh;c.bn(g);var v=new f.l;return o.A(v),g.Zb(v),g.W(.1*g.R(),.1*g.ca()),(v=new f.Da).ad(g,!1),l==1736?v.add(o,!0):v.ad(o,!0),f.Xj.local().V(c,v,h,m)},d.instance=null,d}(f.Je);f.kp=L}(Q||(Q={})),function(f){var L=function(){function x(d,c,o,l){this.ts=c==null,this.ya=-1,this.Rd=d,this.$z=o,this.wT=c.next(),this.Ub=l}return x.prototype.next=function(){return this.ts?null:(d=this.Rd.next())!=null?(this.ya=this.Rd.La(),f.kp.im(d,this.wT,this.$z,this.Ub)):null;var d},x.prototype.La=function(){return this.ya},x.prototype.qe=function(){},x}();f.qL=L}(Q||(Q={})),function(f){var L=function(){function d(c){this.nd=c,this.Bj=new f.l,this.Bj.Oa(),this.oh=new f.l,this.oh.Oa()}return d.prototype.Nt=function(){var c=this.Bj.v;this.Bj.v=this.oh.v,this.oh.v=c,c=this.Bj.C,this.Bj.C=this.oh.C,this.oh.C=c,c=this.Bj.G,this.Bj.G=this.oh.G,this.oh.G=c,c=this.Bj.H,this.Bj.H=this.oh.H,this.oh.H=c},d.prototype.eQ=function(c,o){if(this.nd!=null&&!this.nd.progress(-1,-1))throw f.i.fu("user_canceled");var l=!this.Bj.isIntersecting(this.oh);return f.aa.Hc(c.getType())&&f.aa.Hc(o.getType())?c.I()>o.I()?this.gE(c,o,l):(this.Nt(),c=this.gE(o,c,l),this.Nt(),c):c.getType()==550&&f.aa.Hc(o.getType())?(c=this.hE(o,c,l),this.Nt(),c):o.getType()==550&&f.aa.Hc(c.getType())?this.hE(c,o,l):c.getType()==550&&o.getType()==550?c.I()>o.I()?this.iE(c,o):(this.Nt(),c=this.iE(o,c),this.Nt(),c):0},d.prototype.gE=function(c,o,l){var h=c.Ga(),m=o.Ga(),g=new f.l,v=new f.l,w=17976931348623157e292;if(!l&&this.pY(c,o,h,m))return 0;for(;h.$a();)for(;h.Ha();)if((c=h.ha()).A(g),!(g.px(this.oh)>w)){for(;m.$a();)for(;m.Ha();)if((o=m.ha()).A(v),g.px(v)<w&&(o=c.tb(o,l),(o*=o)<w)){if(o==0)return 0;w=o}m.Zi()}return Math.sqrt(w)},d.prototype.hE=function(c,o,l){var h=c.Ga(),m=new f.l,g=17976931348623157e292,v=new f.h,w=o.I();for(l=!l&&c.getType()==1736;h.$a();)for(;h.Ha();){var E=h.ha();if(E.A(m),!(1<w&&m.px(this.oh)>g)){for(var A=0;A<w;A++){if(o.D(A,v),l&&f.hd.Yd(c,v,0)!=0)return 0;var M=E.fe(v,!1);if(v.sub(E.hc(M)),(M=v.Sk())<g){if(M==0)return 0;g=M}}l=!1}}return Math.sqrt(g)},d.prototype.iE=function(c,o){for(var l,h=17976931348623157e292,m=new f.h,g=new f.h,v=c.I(),w=o.I(),E=0;E<v;E++)if(c.D(E,m),!(1<w&&this.oh.iK(m)>h)){for(var A=0;A<w;A++)if(o.D(A,g),(l=f.h.yc(m,g))<h){if(l==0)return 0;h=l}}return Math.sqrt(h)},d.prototype.pY=function(c,o,l,h){if(c.getType()==1736){for(;h.$a();)if(h.Ha()){var m=h.ha();if(f.hd.Yd(c,m.wc(),0)!=0)return!0}h.Zi()}if(o.getType()==1736){for(;l.$a();)if(l.Ha()&&(c=l.ha(),f.hd.Yd(o,c.wc(),0)!=0))return!0;l.Zi()}return!1},d.prototype.gm=function(c,o){return c.B()||o.B()?NaN:(c.A(this.Bj),o.A(this.oh),this.eQ(c,o))},d}(),x=function(d){function c(){return d!==null&&d.apply(this,arguments)||this}return bt(c,d),c.prototype.V=function(o,l,h){if(o==null||l==null)throw f.i.N();if(o.B()||l.B())return NaN;var m=o.getType(),g=l.getType();if(m==33){if(g==33)return f.h.tb(o.D(),l.D());if(g==197)return h=new f.l,l.A(h),h.tb(o.D());(m=new f.de).add(o),o=m}else if(m==197){if(g==197)return g=new f.l,o.A(g),h=new f.l,l.A(h),h.tb(g);(m=new f.Da).ad(o,!1),o=m}return g==33?((g=new f.de).add(l),l=g):g==197&&((g=new f.Da).ad(l,!1),l=g),new L(h).gm(o,l)},c.local=function(){return c.instance===null&&(c.instance=new c),c.instance},c.prototype.getType=function(){return 14},c.instance=null,c}(f.Je);f.rL=x}(Q||(Q={})),function(f){var L=function(){function x(d,c,o,l){this.zH=d,this.DH=c,this.nd=l,this.$G=o}return x.prototype.next=function(){var d=this.zH.next();return d==null?null:this.zC(d)},x.prototype.La=function(){return this.zH.La()},x.prototype.zC=function(d){var c=d.getType();if(f.aa.Rn(c))return d;if(c==197)return(c=new f.Da(d.description)).ad(d,!1),this.zC(c);if(d.B())return d;if(d==null)throw f.i.Qa();c=d.Ia();for(var o=new f.yb,l=0,h=d.da();l<h;l++)this.TK(d,l,c,o);return c},x.prototype.TK=function(d,c,o,l){if(!(2>d.Ja(c))){var h=d.Ba(c),m=d.Vc(c)-1,g=d.ub(0),v=d.dc(c),w=new f.ia(0);w.Jb(d.Ja(c)+1);var E=new f.ia(0);for(E.Jb(d.Ja(c)+1),w.add(v?h:m),w.add(h),h=new f.h;1<w.size;){var A=w.Fc();w.If();var M=w.Fc();d.D(A,h),l.Dc(h),d.D(M,h),l.Qc(h),0<=(M=this.SK(l,h,g,A,M,m))?(w.add(M),w.add(A)):E.add(A)}if(v||E.add(w.get(0)),E.size==w.size)o.addPath(d,c,!0);else if(2<=E.size&&(!this.$G||E.size!=2||!(v||f.h.tb(d.Na(E.get(0)),d.Na(E.get(1)))<=this.DH))){for(c=new f.Sa,l=0,m=E.size;l<m;l++)d.ve(E.get(l),c),l==0?o.nf(c):o.lineTo(c);v&&(this.$G||E.size!=2||o.lineTo(c),o.Ap())}}},x.prototype.SK=function(d,c,o,l,h,m){var g=h-1;for(h<=l&&(g=m),m=h=-1,l+=1;l<=g;l++){o.tc(2*l,c);var v=c.x,w=c.y;d.hc(d.fe(c,!1),c),c.x-=v,c.y-=w,(v=c.length())>this.DH&&v>m&&(h=l,m=v)}return h},x.prototype.qe=function(){},x}();f.sL=L}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.prototype.getType=function(){return 29},d.prototype.V=function(c,o,l,h){return c instanceof f.aa?(c=new f.Zc(c),this.V(c,o,l,h).next()):new f.sL(c,o,l,h)},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.instance=null,d}(f.Je);f.EC=L}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.prototype.getType=function(){return 21},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.V=function(c,o,l,h,m,g,v,w){return c instanceof f.aa?(w=new f.Zc(c),this.V(w,o,l,[h],m,g,!1,v).next()):v===!0?(l=new f.GC(c,o,l,h,m,!1,!1,w),f.Gh.local().V(l,o,w)):new f.GC(c,o,l,h,m,!1,!1,w)},d.instance=null,d}(f.Je);f.FC=L}(Q||(Q={})),function(f){var L=function(){function x(d,c,o,l,h,m,g,v){if(m)throw f.i.Ie();if(c==null)throw f.i.N();this.ya=-1,this.Ms=d,this.vg=c,this.ze=o,this.Cs=l,this.$n=h,this.eo=-1,this.Ub=v,this.uT=new f.l,this.uT.Oa()}return x.prototype.next=function(){for(var d;(d=this.Ms.next())!=null;)return this.ya=this.Ms.La(),this.eo+1<this.Cs.length&&this.eo++,this.$Q(d,this.Cs[this.eo]);return null},x.prototype.La=function(){return this.ya},x.prototype.$Q=function(d,c){return f.VK.buffer(d,this.vg,this.ze,c,this.$n,this.Ub)},x.prototype.qe=function(){},x}();f.GC=L}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.prototype.getType=function(){return 24},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.V=function(c,o,l){if(o==null)throw f.i.N();if(c.B()||1>c.Db())return 0;if(l==4)throw f.i.Ie();var h=f.cb.sc(o),m=f.cb.vv(h),g=f.cb.ev(h);m*=2-m;var v=h.Hd().ai,w=c.getType();if(w==1736||w==197)var E=c.mg();else f.aa.yd(w)?(E=new f.Ta(c.description)).oc(c,!0):E=c;if(h.Nb(o)==0){if(f.cb.Wc(o)){E=f.Hh.lj(E,o),w==1607&&E==c&&(E=f.aa.jg(c)),c=new f.Nc,f.cb.gh(o).cn(c),w=0;for(var A=E.I();w<A;w++){var M=E.Na(w);M.x=f.Hh.Zm(M.x,c),E.Cb(w,M)}}c=E.Ia(),E=f.Hh.WI(o,h,E,c)?c:f.cb.zh(E,o,h)}return this.hQ(E,l,g,m,v)},d.prototype.hQ=function(c,o,l,h,m){var g=new f.ga(0),v=0;for(c=c.Ga();c.$a();)for(;c.Ha();){var w=c.ha(),E=w.ac();w=w.wc(),E.scale(m),w.scale(m),f.kb.wd(l,h,E.x,E.y,w.x,w.y,g,null,null,o),v+=g.u}return v},d.instance=null,d}(f.Je);f.vL=L}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.prototype.getType=function(){return 18},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.V=function(c,o,l,h,m){return c instanceof f.aa?(c=new f.Zc(c),this.V(c,o,l,h,m).next()):new f.uL(c,l,h,o,-1,-1,m)},d.instance=null,d}(f.Je);f.tL=L}(Q||(Q={})),function(f){var L=function(){function x(d,c,o,l,h,m){if(0<m||o!=4&&0<h)throw f.i.Ie();if(c==null)throw f.i.N();this.ya=-1,this.Ms=d,this.vg=c,this.ze=o,this.DT=l,this.CT=h}return x.prototype.next=function(){for(var d;(d=this.Ms.next())!=null;)return this.ya=this.Ms.La(),this.Zy(d);return null},x.prototype.La=function(){return this.ya},x.prototype.Zy=function(d){return f.cj.Qr(d,this.vg,this.ze,this.DT,this.CT,this.Ub)},x.prototype.qe=function(){},x}();f.uL=L}(Q||(Q={})),function(f){(function(L){L[L.Unknown=0]="Unknown",L[L.Contains=1]="Contains",L[L.Within=2]="Within",L[L.Equals=3]="Equals",L[L.Disjoint=4]="Disjoint",L[L.Touches=8]="Touches",L[L.Crosses=16]="Crosses",L[L.Overlaps=32]="Overlaps",L[L.NoThisRelation=64]="NoThisRelation",L[L.Intersects=1073741824]="Intersects",L[L.IntersectsOrDisjoint=1073741828]="IntersectsOrDisjoint"})(f.cL||(f.cL={})),f.wL=function(){function L(){}return L.nW=function(x,d){var c=x.getType(),o=d.getType();if(f.aa.xj(c)){var l=x.Bb;if(l!=null&&(l=l.Fk)!=null){if(o==33){var h=d.D();l=l.So(h.x,h.y)}else h=new f.l,d.A(h),l=l.Ro(h);if(l==1)return 1;if(l==0)return 4}}if(f.aa.xj(o)&&(l=d.Bb)!=null&&(l=l.Fk)!=null){if(c==33?(x=x.D(),l=l.So(x.x,x.y)):(d=new f.l,x.A(d),l=l.Ro(d)),l==1)return 2;if(l==0)return 4}return 0},L}()}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.getType=function(){return 15},d.prototype.V=function(c,o,l,h,m){return c instanceof f.aa?(c=new f.Zc(c),o=new f.Zc(o),this.V(c,o,l,h,m===void 0?-1:m).next()):m===void 0?new f.HC(c,o,l,h,-1):new f.HC(c,o,l,h,m)},d.prototype.wn=function(c,o,l){this.Iu(c)&&(o=f.ta.kj(o,c,!1),c.fj(l)||c.lu(o,l))},d.prototype.Iu=function(c){return f.Nx.zE(c)},d.instance=null,d}(f.Je);f.Xj=L}(Q||(Q={})),function(f){var L=function(){function x(d,c,o,l,h){if(this.ts=c==null,this.ya=-1,this.Rd=d,this.vg=o,this.Se=c.next(),this.Dj=this.Se.getType(),this.Ub=l,this.Fi=h,this.Fi!=-1&&(0>=this.Fi||7<this.Fi))throw f.i.N("bad dimension mask")}return x.prototype.next=function(){if(this.ts)return null;if(this.zw!=null){var d=this.zw.next();if(d!=null)return d;this.zw=null}for(;(d=this.Rd.next())!=null;)return this.ya=this.Rd.La(),this.Fi==-1?d=this.Ea(d):(this.zw=this.PS(d),d=this.zw.next()),d;return null},x.prototype.La=function(){return this.ya},x.prototype.Ea=function(d){var c=this.zK(d);if(c!=null)return c;c=f.ta.mv(this.Se,d);var o=f.ta.Wd(this.vg,c,!0);c=new f.l,this.Se.A(c);var l=new f.l;return d.A(l),c.W(2*o,2*o),c.Ea(l),c.W(100*o,100*o),o=f.Ud.clip(this.Se,c,0,0),d=f.Ud.clip(d,c,0,0),f.Fg.Av(d,o,this.vg,this.Ub)},x.prototype.QI=function(d,c,o){var l=0;if(1&c)o[0]==null&&(o[0]=new f.de(d)),l++;else for(var h=0;h<o.length-1;h++)o[h]=o[h+1];if(2&c)o[l]==null&&(o[l]=new f.Ta(d)),l++;else for(h=l;h<o.length-1;h++)o[h]=o[h+1];if(4&c)o[l]==null&&(o[l]=new f.Da(d)),l++;else for(h=l;h<o.length-1;h++)o[h]=o[h+1];if(l!=3){for(d=[],h=0;h<l;h++)d[h]=o[h];return new f.Zc(d)}return new f.Zc(o)},x.prototype.PS=function(d){var c=this.zK(d);if(c!=null){var o=[null,null,null];return o[c.Db()]=c,this.QI(d.description,this.Fi,o)}c=f.ta.mv(this.Se,d),o=f.ta.Wd(this.vg,c,!0),c=new f.l,this.Se.A(c),c.W(2*o,2*o);var l=new f.l;return d.A(l),c.Ea(l),c.W(100*o,100*o),o=f.Ud.clip(this.Se,c,0,0),c=f.Ud.clip(d,c,0,0),o=f.Fg.Pz(c,o,this.vg,this.Ub),this.QI(d.description,this.Fi,o)},x.prototype.zK=function(d){var c=f.ta.mv(d,this.Se),o=f.ta.Wd(this.vg,c,!0);c=d.getType();var l=d.B(),h=this.Se.B();if(!(h=l||h)){h=new f.l,d.A(h);var m=new f.l;this.Se.A(m),m.W(2*o,2*o),h=!h.isIntersecting(m)}if(!h)if((m=f.wL.nW(this.Se,d))==4)h=!0;else{if(2&m)return this.Se;if(1&m)return d}if(h)return(o=f.aa.tf(c))<(h=f.aa.tf(this.Dj))?x.HB(d,l):o>h||o==0&&c==550&&this.Dj==33?this.nJ():x.HB(d,l);if((this.Fi==-1||this.Fi==4)&&c==197&&this.Dj==197)return o=this.Se,c=new f.l,d.A(c),l=new f.l,o.A(l),c.Ea(l),o=new f.Fh,d.copyTo(o),o.Xo(c),o;if(c==197&&f.aa.tf(this.Dj)==0||this.Dj==197&&f.aa.tf(c)==0)return l=c==197?d:this.Se,d=c==197?this.Se:d,c=new f.l,l.A(c),f.Ud.clip(d,c,o,0);if(f.aa.tf(c)==0&&0<f.aa.tf(this.Dj)||0<f.aa.tf(c)&&f.aa.tf(this.Dj)==0){if(o=f.ta.kj(this.vg,d,!1),c==550||c==33)return f.Fg.zG(d,this.Se,o);if(this.Dj==550||this.Dj==33)return f.Fg.zG(this.Se,d,o);throw f.i.Qa()}return this.Fi!=-1&&this.Fi!=2||c!=1607||this.Dj!=1736?this.Fi!=-1&&this.Fi!=2||c!=1736||this.Dj!=1607?null:this.wK(this.Se,d):this.wK(d,this.Se)},x.prototype.wK=function(d,c){var o=d,l=c,h=f.ta.kj(this.vg,c,!1),m=new f.l;l.A(m);var g=new f.l;o.A(g),g.W(2*h,2*h),m.Ea(g),m.W(10*h,10*h),o=d=f.Ud.clip(d,m,0,0),g=new f.ia(0);var v=-1,w=l.Bb;if(w!=null){var E=w.Fk;if(E!=null){v=0,g.Jb(o.I()+o.da());for(var A=new f.l,M=o.Ga();M.$a();)for(;M.Ha();){M.ha().A(A);var I=E.Ro(A);I==1?g.add(1):I==0?g.add(0):(g.add(-1),v++)}}}if(5<c.I()&&(w=(l=c=f.Ud.clip(c,m,0,0)).Bb),0>v&&(v=o.yz()),m=o.I()+l.I(),v*l.I()>Math.log(m)*m*4)return null;m=null,v=l.Ga(),w!=null&&w.Fb!=null&&(m=w.Fb),m==null&&20<l.I()&&(m=f.ta.nE(l)),d=d.Ia(),l=null,w=o.Ga(),E=[0,0,0,0,0,0,0,0,0],A=new f.be(0),M=new f.ig,I=-1;for(var D=0,k=0,B=0<g.size,J=-1;w.$a();){J=w.gb;var Y=0;for(I=-1,D=0;w.Ha();){var V=B?f.O.truncate(g.get(k)):-1;k++;var te=w.ha();if(0>V){if(m!=null)for(l==null?l=m.vR(te,h):l.Uo(te,h),V=l.next();V!=-1;V=l.next()){v.Vb(m.ja(V)),V=v.ha();var he=te.Ea(V,null,E,null,h);for(V=0;V<he;V++)A.add(E[V])}else for(v.Zi();v.$a();)for(;v.Ha();)for(V=v.ha(),he=te.Ea(V,null,E,null,h),V=0;V<he;V++)A.add(E[V]);if(0<A.size){A.Vd(0,A.size,function(Xe,qe){return Xe-qe});var ue=0;A.add(1),he=-1,V=0;for(var xe=A.size;V<xe;V++){var be=A.get(V);if(be!=ue){var Le=!1;if(ue!=0||be!=1?(te.ah(ue,be,M),ue=M.get()):(ue=te,Le=!0),2<=Y){if(d.Dr(o,J,I,D,Y==3),this.QD(c,ue.ac(),h)!=1&&this.RD(c,ue,h)!=1)return null;d.oc(ue,!1),Y=1,D=0}else switch(he=this.RD(c,ue,h),he){case 1:Le?2>Y?(I=w.wb()-o.Ba(J),D=1,Y=Y==0?3:2):D++:(d.oc(ue,Y==0),Y=1);break;case 0:Y=0,I=-1,D=0;break;default:return null}ue=be}}}else{if(0>(V=this.QD(c,te.ac(),h)))return null;V==1?(2>Y&&(I=w.wb()-o.Ba(J),Y=Y==0?3:2),D++):(I=-1,D=0)}A.clear(!1)}else V!=0&&V==1&&(Y==0?(Y=3,I=w.wb()-o.Ba(J)):Y==1?(Y=2,I=w.wb()-o.Ba(J)):D++)}2<=Y&&(d.Dr(o,J,I,D,Y==3),I=-1)}return d},x.prototype.QD=function(d,c,o){return f.Dg.wm(d,c,o)},x.prototype.RD=function(d,c,o){var l=c.ac();c=c.wc();var h=f.Dg.wm(d,l,o),m=f.Dg.wm(d,c,o);return h==1&&m==0||h==0&&m==1?-1:h==0||m==0?0:h==1||m==1?1:((h=new f.h).add(l,c),h.scale(.5),(d=f.Dg.wm(d,h,o))==0?0:d==1?1:-1)},x.HB=function(d,c){return c?d:d.Ia()},x.prototype.nJ=function(){return this.yH==null&&(this.yH=this.Se.Ia()),this.yH},x.prototype.qe=function(){},x}();f.HC=L}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.prototype.getType=function(){return 28},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.V=function(c,o,l,h,m,g,v){return c instanceof f.aa?(c=new f.Zc(c),this.V(c,o,l,h,m,g,v).next()):new f.xL(c,o,l,h,m,g,v)},d.instance=null,d}(f.Je);f.IC=L}(Q||(Q={})),function(f){var L=function(){function x(d,c,o,l,h,m,g){this.ya=-1,this.Rd=d,this.Mj=c,this.Ka=o,this.Ki=l,this.CA=h,this.uH=m,this.nd=g}return x.prototype.next=function(){var d=this.Rd.next();return d!=null?(this.ya=this.Rd.La(),this.jL(d)):null},x.prototype.La=function(){return this.ya},x.prototype.jL=function(d){var c=0>=this.uH?f.ta.kj(this.Mj,d,!1):this.uH;return f.IK.V(d,this.Ka,this.Ki,this.CA,c,this.nd)},x.prototype.qe=function(){},x}();f.xL=L}(Q||(Q={})),function(f){var L;(L=f.NK||(f.NK={}))[L.clipToDomainOnly=1]="clipToDomainOnly",L[L.clipWithHorizon=2]="clipWithHorizon",L[L.foldAndClipWithHorizon=3]="foldAndClipWithHorizon";var x=function(d){function c(){return d!==null&&d.apply(this,arguments)||this}return bt(c,d),c.prototype.getType=function(){return 0},c.local=function(){return c.instance===null&&(c.instance=new c),c.instance},c.prototype.V=function(o,l,h){return o instanceof f.aa?(o=new f.Zc(o),this.V(o,l,h).next()):new f.yL(o,l,h)},c.prototype.transform=function(o,l,h,m){return f.bu.transform(o,l,h,m,!0)},c.prototype.Qt=function(o,l,h,m){return f.bu.Qt(o,l,h,m)},c.instance=null,c}(f.Je);f.Hx=x}(Q||(Q={})),function(f){var L=function(){function x(d,c,o){this.ya=-1,this.Rd=d,this.MT=c,this.nd=o}return x.prototype.next=function(){var d=this.Rd.next();return d!=null?(this.ya=this.Rd.La(),f.bu.zh(d,this.MT,this.nd)):null},x.prototype.La=function(){return this.ya},x.prototype.qe=function(){},x}();f.yL=L}(Q||(Q={})),function(f){var L=function(){function d(){}return d.prototype.reset=function(){this.ph=this.xk=-1,this.us=this.kq=!1},d.prototype.AQ=function(c,o,l){for(c.Vb(o,l);c.Ha();){var h=c.ha();if((h=h.Qb())!=0)return c.wb()}for(c.Vb(o,l);c.Ez();)if((h=(h=c.li()).Qb())!=0)return c.wb();return-1},d.prototype.BQ=function(c,o){for(c.Vb(o,-1);c.Ez();)if(c.li().Qb()!=0)return c.wb();return-1},d.prototype.zQ=function(c,o){for(c.Vb(o,-1),c.ha();c.Ha();)if(c.ha().Qb()!=0)return c.wb();return-1},d.prototype.yQ=function(c,o,l,h){if(this.xk=this.AQ(o,l,h),this.xk!=-1){o.Vb(this.xk,-1);var m=o.ha(),g=m.hc(m.fe(c,!1));if(l=f.h.yc(g,c),(h=new f.h).L(g),h.sub(m.ac()),(g=new f.h).L(c),g.sub(m.ac()),this.kq=0>h.wi(g),this.ph=this.zQ(o,this.xk),this.ph!=-1){o.Vb(this.ph,-1);var v=(m=o.ha()).fe(c,!1);v=m.hc(v);var w=f.h.yc(v,c);w>l?this.ph=-1:(h.L(v),h.sub(m.ac()),g.L(c),g.sub(m.ac()),this.us=0>h.wi(g))}this.ph==-1&&(this.ph=this.BQ(o,this.xk),this.ph!=-1&&(o.Vb(this.ph,-1),v=(m=o.ha()).fe(c,!1),v=m.hc(v),(w=f.h.yc(v,c))>l?this.ph=-1:(h.L(v),h.sub(m.ac()),g.L(c),g.sub(m.ac()),this.us=0>h.wi(g),c=this.xk,this.xk=this.ph,this.ph=c,c=this.kq,this.kq=this.us,this.us=c)))}},d.prototype.cO=function(c,o,l,h,m){return l=l.Ga(),this.yQ(c,l,h,m),this.xk!=-1&&this.ph==-1?this.kq:this.xk!=-1&&this.ph!=-1?this.kq==this.us?this.kq:(l.Vb(this.xk,-1),c=l.ha().kg(),l.Vb(this.ph,-1),o=l.ha().kg(),0<=c.wi(o)):o},d}(),x=function(d){function c(){return d!==null&&d.apply(this,arguments)||this}return bt(c,d),c.local=function(){return c.instance===null&&(c.instance=new c),c.instance},c.prototype.getType=function(){return 3},c.prototype.nz=function(o,l,h){var m;if(m===void 0&&(m=!1),o.B())return new f.$l;l=l.D();var g=o,v=o.getType();switch(v==197&&((g=new f.Da).ad(o,!1),v=1736),v){case 33:return this.xI(g,l);case 550:return this.jI(g,l);case 1607:case 1736:return this.bU(g,l,h,m);default:throw f.i.fa("not implemented")}},c.prototype.oz=function(o,l){if(o.B())return new f.$l;l=l.D();var h=o,m=o.getType();switch(m==197&&((h=new f.Da).ad(o,!1),m=1736),m){case 33:return this.xI(h,l);case 550:case 1607:case 1736:return this.jI(h,l);default:throw f.i.fa("not implemented")}},c.prototype.pz=function(o,l,h,m){if(0>m)throw f.i.N();if(o.B())return[];l=l.D();var g=o,v=o.getType();switch(v==197&&((g=new f.Da).ad(o,!1),v=1736),v){case 33:return this.TU(g,l,h,m);case 550:case 1607:case 1736:return this.tU(g,l,h,m);default:throw f.i.fa("not implemented")}},c.prototype.bU=function(o,l,h,m){if(o.getType()==1736&&h&&(h=new f.l,o.A(h),h=f.ta.Wd(null,h,!1),(m?f.hd.Yd(o,l,0):f.hd.Yd(o,l,h))!=0)){var g=new f.$l(l,0,0);return m&&g.WJ(!0),g}var v=o.Ga();g=new f.h;for(var w=h=-1,E=17976931348623157e292,A=0;v.$a();)for(;v.Ha();){var M=v.ha();M=M.hc(M.fe(l,!1));var I=f.h.yc(M,l);I<E?(A=1,g=M,h=v.wb(),w=v.gb,E=I):I==E&&A++}return g=new f.$l(g,h,Math.sqrt(E)),m&&(v.Vb(h,w),M=v.ha(),m=0>f.h.Uq(l,M.ac(),M.wc()),1<A&&((A=new L).reset(),m=A.cO(l,m,o,h,w)),g.WJ(m)),g},c.prototype.xI=function(o,l){return o=o.D(),l=f.h.tb(o,l),new f.$l(o,0,l)},c.prototype.jI=function(o,l){for(var h=o.ub(0),m=o.I(),g=o=0,v=0,w=17976931348623157e292,E=0;E<m;E++){var A=new f.h;h.tc(2*E,A);var M=f.h.yc(A,l);M<w&&(g=A.x,v=A.y,o=E,w=M)}return(l=new f.$l).ey(g,v,o,Math.sqrt(w)),l},c.prototype.TU=function(o,l,h,m){return m==0?[]:(h*=h,o=o.D(),(l=f.h.yc(o,l))<=h?(h=[],(m=new f.$l).ey(o.x,o.y,0,Math.sqrt(l)),h[0]=m):h=[],h)},c.prototype.tU=function(o,l,h,m){if(m==0)return[];var g=o.ub(0),v=o.I();o=[],h*=h;for(var w=0;w<v;w++){var E=g.read(2*w),A=g.read(2*w+1),M=l.x-E,I=l.y-A;(M=M*M+I*I)<=h&&((I=new f.$l).ey(E,A,w,Math.sqrt(M)),o.push(I))}return l=o.length,o.sort(function(D,k){return D.Ka<k.Ka?-1:D.Ka==k.Ka?0:1}),m>=l||(o.length=m),o.slice(0)},c.instance=null,c}(f.Je);f.Ix=x}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.prototype.getType=function(){return 4},d.prototype.V=function(c,o,l,h,m){return f.am.yB(c,o,l,h,m)},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.Iu=function(c){return f.Vt.wy(c)},d.prototype.wn=function(c,o,l){f.Vt.CD(c,o,l)},d.instance=null,d}(f.Je);f.zL=L}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.prototype.getType=function(){return 33},d.prototype.V=function(c,o,l,h,m){return c===1073741824?!f.ud.zB(o,l,h,4,m):f.ud.zB(o,l,h,c,m)},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.Iu=function(c){return f.Vt.wy(c)},d.prototype.wn=function(c,o,l){f.Vt.CD(c,o,l)},d.instance=null,d}(f.Je);f.dj=L}(Q||(Q={})),function(f){var L=function(){function x(d,c,o,l){if(this.nd=l,this.rT=o,this.ya=-1,d==null)throw f.i.N();this.yk=d,this.Mj=c}return x.prototype.next=function(){var d;if((d=this.yk.next())!=null){if(this.ya=this.yk.La(),this.nd!=null&&!this.nd.progress(-1,-1))throw f.i.fu("user_canceled");return this.eC(d)}return null},x.prototype.La=function(){return this.ya},x.prototype.eC=function(d){if(d==null)throw f.i.N();return f.Jx.cK(d,this.Mj,this.rT,this.nd)},x.prototype.qe=function(){},x}();f.AL=L}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.prototype.getType=function(){return 26},d.prototype.V=function(c,o,l,h){return c instanceof f.aa?(c=new f.Zc(c),this.V(c,o,l,h).next()):new f.AL(c,o,l,h)},d.prototype.rs=function(c,o,l,h,m){return 0<(h!==void 0?f.Jx.rs(c,o,l,h,m):f.Jx.rs(c,o,!1,null,l))},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.instance=null,d}(f.Je);f.Yl=L}(Q||(Q={})),function(f){var L=function(){function m(){this.yq=0}return m.prototype.nX=function(g){this.yq&=-2,this.yq|=g?1:0},m.prototype.Wp=function(){return(1&this.yq)!=0},m.prototype.XF=function(){return this.Wp()?0:1},m}();f.xY=L;var x=function(){},d=function(m,g,v,w){this.x=m,this.y=g,this.Ai=v,this.xm=w},c=function(){function m(g){this.Be=g}return m.prototype.compare=function(g,v,w){return g=g.ja(w),v=this.Be.lf.read(2*v),0>(v-=g=this.Be.lf.read(2*g))?-1:0<v?1:0},m}(),o=function(){function m(g){this.Be=g}return m.prototype.compare=function(g,v,w){v=this.Be.hb[v],g=this.Be.hb[g.ja(w)];var E=v.Wp(),A=g.Wp();w=v.ne.Pe(this.Be.Mo,0);var M=g.ne.Pe(this.Be.Mo,0);return w==M&&((E=.5*((w=Math.min(E?v.ne.na:v.ne.la,A?g.ne.na:g.ne.la))-this.Be.Mo)+this.Be.Mo)==this.Be.Mo&&(E=w),w=v.ne.Pe(E,0),M=g.ne.Pe(E,0)),w<M?-1:w>M?1:0},m}(),l=function(){function m(g,v){this.YI=new f.h,this.parent=g,this.dS=v}return m.prototype.nr=function(g,v,w){var E=this.parent,A=this.dS;w.Vd(g,v,function(M,I){return E.Mh(M,I,A)})},m.prototype.$p=function(g){return g=this.parent.gi.get(g),this.parent.lf.tc(2*(g>>1),this.YI),this.YI.y+(1&g?this.parent.Oj:-this.parent.Oj)},m}(),h=function(){function m(g,v,w,E,A){this.nH=g.description,this.X=g,this.Qg=v,this.Oj=f.ta.kj(this.Qg,g,!1),this.Bo=f.ta.kj(this.Qg,g,!0),this.xA=w,this.oT=this.nH.Aa,this.hb=[],this.po=[],this.mh=new f.jp,this.fb=new f.Yj,this.ke=new f.Md,this.ZG=this.ql=A}return m.prototype.eT=function(){return this.ZG=!0,(!f.aa.Hc(this.X.getType())||this.GE()&&this.DE(!1))&&this.mO()?f.aa.Hc(this.X.getType())?this.pO()?this.X.getType()==1607?this.rO()?2:0:this.sO()?this.tO():0:0:2:0},m.prototype.kC=function(g,v){var w=this.lf.read(2*g);g=this.lf.read(2*g+1);var E=this.lf.read(2*v);v=this.lf.read(2*v+1);var A=!f.Yt.Cv(w,g,E,v,this.Oj*this.Oj);return A||this.X.Db()!=0&&w==E&&g==v},m.prototype.GE=function(){for(var g=this.X,v=g.xf?3:2,w=0,E=g.da();w<E;w++)if(g.Ja(w)<v)return this.ke=new f.Md(1,w,0),!1;return!0},m.prototype.DE=function(g){var v=this.X,w=v.Ga(),E=v.hasAttribute(1);for(v=E?f.ta.wE(this.Qg,v,!1):0;w.$a();)for(;w.Ha();){var A=w.ha();if(!(A.Qb()>this.Oj)){if(g&&E){var M=A.wv(1,0);if(A=A.wv(1,0),Math.abs(A-M)>v)continue}return this.ke=new f.Md(2,w.wb(),-1),!1}}return!0},m.prototype.mO=function(){var g=this.X,v=null;f.aa.Hc(this.X.getType())&&(v=this.X);var w=(this.ZG||this.ql)&&v!=null,E=g.I();this.lf=g.ub(0),this.gi=new f.ia(0),this.gi.Jb(2*E),this.fi=new f.ia(0),this.fi.Jb(2*E),w&&(this.Fl==null&&(this.Fl=new f.ia(0)),this.Fl.Jb(E));for(var A=g=0;A<E;A++)if(this.gi.add(2*A),this.gi.add(2*A+1),this.fi.add(2*A),this.fi.add(2*A+1),w){for(;A>=v.Vc(g);)g++;this.Fl.add(g)}for(new f.Xt().sort(this.fi,0,2*E,new l(this,w)),this.fb.clear(),this.fb.Vo(new c(this)),this.fb.De(E),v=0,E*=2;v<E;v++)if(w=this.fi.get(v),w=(g=this.gi.get(w))>>1,(1&g)==0){if(g=this.fb.addElement(w,-1),(A=this.fb.we(g))!=-1&&!this.kC(this.fb.ja(A),w))return this.ke=new f.Md(3,w,this.fb.ja(A)),!1;var M=this.fb.lb(g);if(M!=-1&&!this.kC(this.fb.ja(M),w))return this.ke=new f.Md(3,w,this.fb.ja(M)),!1}else if(g=this.fb.search(w,-1),A=this.fb.we(g),M=this.fb.lb(g),this.fb.vd(g,-1),A!=-1&&M!=-1&&!this.kC(this.fb.ja(A),this.fb.ja(M)))return this.ke=new f.Md(3,this.fb.ja(A),this.fb.ja(M)),!1;return!0},m.prototype.pO=function(){return 10>this.X.I()?this.nO():this.oO()},m.prototype.oO=function(){var g=new f.gd;g.Ib(this.X);var v=new f.Md;return!f.$t.kI(!1,g,this.Oj,v,this.nd)||(v.Jo=g.Ua(v.Jo),v.Ko=g.Ua(v.Ko),this.ke.Wt(v),!1)},m.prototype.nO=function(){var g=this.X,v=g.Ga();for(g=g.Ga();v.$a();)for(;v.Ha();){var w=v.ha();if(!v.Qn()||!v.$S()){g.BW(v);do for(;g.Ha();){var E=g.ha();if((E=w.zr(E,this.Oj,!0))!=0)return this.ke=new f.Md(E==2?5:4,v.wb(),g.wb()),!1}while(g.$a())}}return!0},m.prototype.sO=function(){var g=this.X;this.hb.length=0,this.po.length=0,this.Zf=g.Ga(),this.Zf.JB();var v=new f.ia(0);v.Jb(10);var w=NaN,E=0,A=0;for(g=2*g.I();A<g;A++){var M=this.fi.get(A);if(!(1&(M=this.gi.get(M)))){M>>=1;var I=this.lf.read(2*M),D=this.lf.read(2*M+1);if(v.size!=0&&(I!=w||D!=E)){if(!this.RI(v))return!1;v?.clear(!1)}v.add(M),w=I,E=D}}return!!this.RI(v)},m.prototype.rO=function(){for(var g=this.X,v=Array(g.da()),w=0,E=g.da();w<E;w++)v[w]=g.Nn(w);E=new x;var A=new f.h;w=this.fi.get(0);var M=(w=this.gi.get(w))>>1;this.lf.tc(2*M,A);var I=v[w=this.Fl.get(M)],D=g.Ba(w),k=g.Vc(w)-1;E.el=M==D||M==k,E.ny=this.ql?!I&&E.el:E.el,E.Ai=w,E.x=A.x,E.y=A.y,E.xm=M;for(var B=new x,J=1,Y=this.fi.size;J<Y;J++)if(w=this.fi.get(J),(1&(w=this.gi.get(w)))==0){M=w>>1,this.lf.tc(2*M,A),(w=this.Fl.get(M))!=E.Ai&&(I=v[w],D=g.Ba(w),k=g.Vc(w)-1);var V=M==D||M==k,te=this.ql?!I&&E.el:E.el;if(B.x=A.x,B.y=A.y,B.Ai=w,B.xm=M,B.ny=te,B.el=V,B.x==E.x&&B.y==E.y){if(this.ql){if(!(B.ny&&E.ny||B.Ai==E.Ai&&(B.el||E.el)))return this.ke=new f.Md(8,B.xm,E.xm),!1}else if(!B.el||!E.el)return this.ke=new f.Md(5,B.xm,E.xm),!1}w=E,E=B,B=w}return!0},m.prototype.JE=function(){for(var g=this.X,v=[],w=-1,E=!1,A=0,M=g.da();A<M;A++)g.Ev(A)&&(E=!1,w++,A<M-1&&(g.Ev(A+1)||(E=!0))),v[A]=E?w:-1;E=new f.h,A=this.fi.get(0);var I=(A=this.gi.get(A))>>1;this.lf.tc(2*I,E),A=this.Fl.get(I),w=new d(E.x,E.y,A,I,v[A]),g=[];var D=1;for(M=this.fi.size;D<M;D++)if(A=this.fi.get(D),(1&(A=this.gi.get(A)))==0){if(I=A>>1,this.lf.tc(2*I,E),A=this.Fl.get(I),(A=new d(E.x,E.y,A,I,v[A])).x==w.x&&A.y==w.y){if(A.Ai==w.Ai)return this.ke=new f.Md(9,A.xm,w.xm),!1;0<=v[A.Ai]&&v[A.Ai]==v[w.Ai]&&(g.length!=0&&g[g.length-1]==w||g.push(w),g.push(A))}w=A}if(g.length==0)return!0;for(A=new f.jp(!0),f.O.$u(v,-1),E=-1,(D=new f.h).Rc(),w=0,M=g.length;w<M;w++){(I=g[w]).x==D.x&&I.y==D.y||(E=A.Ph(0),D.x=I.x,D.y=I.y);var k=v[I.Ai];k==-1&&(k=A.Ph(2),v[I.Ai]=k),A.addElement(k,E),A.addElement(E,k)}for((M=new f.ia(0)).Jb(10),w=A.je;w!=-1;w=A.qz(w))if(!(1&(g=A.PF(w)))&&2&g){for(g=-1,M.add(w),M.add(-1);0<M.size;){if(E=M.Fc(),M.If(),D=M.Fc(),M.If(),(1&(I=A.PF(D)))!=0){g=2&I?D:E;break}for(A.fX(D,1|I),I=A.rc(D);I!=-1;I=A.lb(I))(k=A.getData(I))!=E&&(M.add(k),M.add(D))}if(g!=-1){for(A=-1,w=0,M=v.length;w<M;w++)if(v[w]==g){A=w;break}return this.ke=new f.Md(10,A,-1),!1}}return!0},m.prototype.tO=function(){var g=this.X;if(0>=g.Ke())return this.ke=new f.Md(6,g.da()==1?1:-1,-1),0;if(g.da()==1)return this.ql&&!this.JE()?0:2;this.to=f.ia.qf(g.da(),0),this.JA=f.ia.qf(g.da(),-1);for(var v=-1,w=0,E=0,A=g.da();E<A;E++){var M=g.Ir(E);if(this.to.write(E,0>M?0:256),0<M)v=E,w=M;else{if(M==0)return this.ke=new f.Md(6,E,-1),0;if((0>v||w<Math.abs(M))&&(this.ke=new f.Md(7,E,-1),this.ql))return 0;this.JA.write(E,v)}}for(this.dt=g.da(),this.Om=new f.ia(0),this.Om.Jb(10),A=g.I(),this.Mo=NaN,(g=new f.ia(0)).Jb(10),this.Qq=f.ia.qf(A,-1),this.Hw=f.ia.qf(A,-1),this.zj!=null?this.zj.clear(!1):this.zj=new f.ia(0),this.zj.Jb(10),this.fb.clear(),this.fb.Vo(new o(this)),v=0,A*=2;0<this.dt&&v<A;v++)if(w=this.fi.get(v),(1&(w=this.gi.get(w)))==0){if(w>>=1,(E=this.lf.read(2*w+1))!=this.Mo&&g.size!=0){if(!this.ut(g))return 0;g?.clear(!1)}g.add(w),this.Mo=E}return 0<this.dt&&!this.ut(g)?0:this.ql?this.ke.Jj==0&&this.JE()?2:0:this.ke.Jj==0?2:1},m.prototype.RI=function(g){if(g.size==1)return!0;for(var v=0,w=g.size;v<w;v++){var E=g.get(v);this.Zf.Vb(E);var A=this.Zf.li();this.hb.push(this.Su(A,E,this.Zf.gb,!0)),this.Zf.ha(),A=this.Zf.ha(),this.hb.push(this.Su(A,E,this.Zf.gb,!1))}var M=this;for(this.hb.sort(function(k,B){return M.XP(k,B)}),(E=this.mh.je)==-1&&(E=this.mh.Ph(0)),this.mh.fn(this.hb.length),v=0,w=this.hb.length;v<w;v++)this.mh.addElement(E,v);v=!0;for(var I=w=-1;v&&(v=!1,(A=this.mh.rc(E))!=-1);)for(var D=this.mh.lb(A);D!=-1;)if(w=this.mh.getData(A),I=this.mh.getData(D),(w=this.hb[w].Io)!=(I=this.hb[I].Io))A=D,D=this.mh.lb(A);else if(v=!0,this.mh.jd(E,A),A=this.mh.we(D),(D=this.mh.jd(E,D))==-1||A==-1)break;if(v=this.mh.bs(E),this.mh.LE(E),0<v)return this.ke=new f.Md(5,w,I),!1;for(v=0,w=g.size;v<w;v++)this.vB(this.hb[v]);return this.hb.length=0,!0},m.prototype.ut=function(g){for(var v=0,w=g.size;v<w;v++){var E=g.get(v),A=this.Qq.read(E);if(A!=-1){var M=this.fb.ja(A);this.zj.add(M),this.fb.vd(A,-1),this.vB(this.hb[M]),this.hb[M]=null,this.Qq.write(E,-1)}(A=this.Hw.read(E))!=-1&&(M=this.fb.ja(A),this.zj.add(M),this.fb.vd(A,-1),this.vB(this.hb[M]),this.hb[M]=null,this.Hw.write(E,-1))}for(v=0,w=g.size;v<w;v++){if(E=g.get(v),this.Zf.Vb(E),(A=this.Zf.li()).na>A.la){var I=this.Zf.wb(),D=this.Su(A,E,this.Zf.gb,!0);0<this.zj.size?(M=this.zj.Fc(),this.zj.If(),this.hb[M]=D):(M=this.hb.length,this.hb.push(D)),A=this.fb.addElement(M,-1),this.Qq.read(I)==-1?this.Qq.write(I,A):this.Hw.write(I,A),!(3&this.to.read(this.Zf.gb))&&this.Om.add(A)}this.Zf.ha(),(A=this.Zf.ha()).na<A.la&&(I=this.Zf.ik(),D=this.Su(A,E,this.Zf.gb,!1),0<this.zj.size?(M=this.zj.Fc(),this.zj.If(),this.hb[M]=D):(M=this.hb.length,this.hb.push(D)),A=this.fb.addElement(M,-1),this.Qq.read(I)==-1?this.Qq.write(I,A):this.Hw.write(I,A),!(3&this.to.read(this.Zf.gb))&&this.Om.add(A))}for(v=0,w=this.Om.size;v<w&&0<this.dt;v++)if(A=this.Om.get(v),(3&this.to.read(this.hb[this.fb.ja(A)].IA))==0){g=-1,E=this.fb.we(A);var k=A;D=null,M=-1;for(var B=0;E!=-1&&(M=this.fb.ja(E),M=(D=this.hb[M]).IA,(3&(B=this.to.read(M)))==0);)k=E,E=this.fb.we(E);E==-1?(I=1,E=k):(g=(3&B)==1?M:this.JA.read(M),I=D.XF()!=0?0:1,E=this.fb.lb(E));do{if(M=this.fb.ja(E),M=(D=this.hb[M]).IA,(3&(k=this.to.read(M)))==0){if(I!=D.XF())return this.ke=new f.Md(6,M,-1),!1;if(k=252&k|(B=I==0||D.Wp()?2:1),this.to.write(M,B),B==2&&this.ke.Jj==0&&this.JA.read(M)!=g&&(this.ke=new f.Md(7,M,-1),this.ql))return!1;if(this.dt--,this.dt==0)return!0}(3&k)==1&&(g=M),k=E,E=this.fb.lb(E),I=I!=0?0:1}while(k!=A)}return this.Om!=null?this.Om.clear(!1):this.Om=new f.ia(0),!0},m.prototype.Su=function(g,v,w,E){if(g.getType()!=322)throw f.i.Qa();return(g=this.sP(g)).Io=v,g.IA=w,g.yq=0,g.nX(E),g},m.prototype.sP=function(g){if(0<this.po.length){var v=this.po[this.po.length-1];--this.po.length,g.copyTo(v.ne)}else(v=new L).ne=f.SC.jg(g);return v},m.prototype.vB=function(g){g.ne.getType()==322&&this.po.push(g)},m.prototype.kU=function(){for(var g=this.X.I(),v=new f.ia(0),w=0;w<g;w++)v.add(w);var E=this;for(v.Vd(0,g,function(A,M){return E.Ou(A,M)}),w=1;w<g;w++)if(this.Ou(v.get(w-1),v.get(w))==0)return this.ke=new f.Md(3,v.get(w-1),v.get(w)),0;return 2},m.prototype.JV=function(){return this.GE()&&this.DE(!0)?2:0},m.prototype.oV=function(){return this.eT()},m.prototype.pU=function(){for(var g=this.X.I(),v=new f.ia(0),w=0;w<g;w++)v.add(w);var E=this;v.Vd(0,g,function(k,B){return E.PO(k,B)});var A=Array(g);for(f.O.$u(A,!1),A[v.get(0)]=!0,w=1;w<g;w++){var M=v.get(w-1),I=v.get(w);this.Ou(M,I)==0?A[I]=!1:A[I]=!0}v=this.X.Ia(),M=this.X,I=0;var D=1;for(w=0;w<g;w++)A[w]?D=w+1:(I<D&&v.Fd(M,I,D),I=w+1);return I<D&&v.Fd(M,I,D),v.Ch(2,this.Bo),v},m.prototype.NV=function(){var g=this.X,v=g.Ga(),w=g.Ga(),E=this.X.Ia(),A=this.X,M=g.hasAttribute(1),I=M?f.ta.wE(this.Qg,g,!0):0,D=new f.ia(0),k=new f.ia(0);for(D.Jb(f.O.truncate(g.I()/2+1)),k.Jb(f.O.truncate(g.I()/2+1));v.$a();)if(w.$a(),!(2>g.Ja(v.gb))){w.EW();for(var B,J,Y=!0;v.Ha();){var V=v.ha(),te=w.li();if(v.wb()>w.wb())break;Y&&(D.add(v.wb()),k.add(w.ik()),Y=!1),J=D.Fc();var he=v.ik();if(1<he-J){var ue=new f.h;ue.uc(g.Na(J),g.Na(he)),B=ue.length()}else B=V.Qb();J=k.Fc(),1<(he=w.wb())-J?((ue=new f.h).uc(g.Na(J),g.Na(he)),J=ue.length()):J=te.Qb(),B>this.Bo?D.add(v.ik()):M&&(B=g.Uc(1,D.Fc(),0),V=V.gv(1,0),Math.abs(V-B)>I&&D.add(v.ik())),J>this.Bo?k.add(w.wb()):M&&(B=g.Uc(1,k.Fc(),0),V=te.gv(1,0),Math.abs(V-B)>I&&k.add(w.wb()))}if(D.Fc()<k.Fc()?D.size>k.size?D.If():k.If():(D.Fc()!=k.Fc()&&k.If(),k.If()),2<=k.size+D.size){for(Y=new f.Sa,te=0,V=D.size;te<V;te++)A.ve(D.get(te),Y),te==0?E.nf(Y):E.lineTo(Y);for(te=k.size-1;0<te;te--)A.ve(k.get(te),Y),E.lineTo(Y);A.dc(v.gb)?E.Ap():0<k.size&&(A.ve(k.get(0),Y),E.lineTo(Y))}D?.clear(!1),k?.clear(!1)}return E.Ch(2,this.Bo),E},m.prototype.rV=function(){return this.DX()},m.prototype.DX=function(){return this.X.getType()==1736&&this.X.In()==1?f.Fg.Mk(this.X,this.Bo,!0,!1,this.nd):(this.Hi=new f.gd,this.Hi.Ib(this.X),this.Hi.fd!=0&&(this.xA!=1&&f.Tk.V(this.Hi,this.Bo,this.nd,!0),this.X.getType()==1736&&f.rn.V(this.Hi,this.Hi.ld,this.xA,!1,this.nd)),this.X=this.Hi.Ne(this.Hi.ld),this.X.getType()==1736&&(this.X.fm(),this.X.Yo(0)),this.X.Ch(2,this.Bo),this.X)},m.rs=function(g,v,w,E,A){if(E!=null&&(E.Jj=0,E.Jo=-1,E.Ko=-1),g.B())return 1;var M=g.getType();if(M==33)return 1;var I=f.ta.kj(v,g,!1);if(M==197)return v=new f.l,g.A(v),v.Bi(I)?(E!=null&&(E.Jj=2,E.Jo=-1,E.Ko=-1),0):1;if(f.aa.yd(M))return(I=new f.Ta(g.description)).oc(g,!0),m.rs(I,v,w,E,A);var D=g.om(I);if((w=w?-1:D)!=-1)return w;if(v=new m(g,v,w,A,!1),M==550)w=v.kU();else if(M==1607)w=v.JV();else{if(M!=1736)throw f.i.Qa();w=v.oV()}return g.Ch(w,I),E!=null&&w==0&&E.Wt(v.ke),w},m.cK=function(g,v,w,E){if(g.B())return g;var A=g.getType();if(A==33)return g;var M=f.ta.kj(v,g,!1);if(A==197)return v=new f.l,g.A(v),v.Bi(M)?g.Ia():g;if(f.aa.yd(A))return(A=new f.Ta(g.description)).oc(g,!0),m.cK(A,v,w,E);if(M=g.om(M),(w=w?-1:M)==2)return g;if(g=new m(g,v,w,E,!1),A==550)g=g.pU();else if(A==1607)g=g.NV();else{if(A!=1736)throw f.i.Qa();g=g.rV()}return g},m.prototype.Mh=function(g,v,w){if(g==v)return 0;g=this.gi.get(g);var E=this.gi.get(v);v=g>>1;var A=E>>1,M=new f.h,I=new f.h;return this.lf.tc(2*v,M),M.y+=1&g?this.Oj:-this.Oj,this.lf.tc(2*A,I),I.y+=1&E?this.Oj:-this.Oj,(g=M.compare(I))==0&&w?0>(w=this.Fl.get(v)-this.Fl.get(A))?-1:0<w?1:0:g},m.prototype.Ou=function(g,v){if(g==v)return 0;var w=this.X,E=w.Na(g),A=w.Na(v);if(E.x<A.x)return-1;if(E.x>A.x)return 1;if(E.y<A.y)return-1;if(E.y>A.y)return 1;for(E=1;E<this.oT;E++){A=this.nH.kd(E);for(var M=f.ra.Va(A),I=0;I<M;I++){var D=w.Uc(A,g,I),k=w.Uc(A,v,I);if(D<k)return-1;if(D>k)return 1}}return 0},m.prototype.PO=function(g,v){var w=this.Ou(g,v);return w==0?g<v?-1:1:w},m.prototype.XP=function(g,v){if(g===v)return 0;var w=g.ne.kg();g.Wp()&&w.Sq(),g=v.ne.kg(),v.Wp()&&g.Sq(),v=w.qu();var E=g.qu();return E==v?(v=w.wi(g),Math.abs(v)<=8881784197001252e-31*(Math.abs(g.x*w.y)+Math.abs(g.y*w.x))&&(v--,v++),0>v?1:0<v?-1:0):v<E?-1:1},m}();f.Jx=h}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.prototype.getType=function(){return 30},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.prototype.V=function(c,o,l,h){return c instanceof f.aa?(c=new f.Zc(c),o=new f.Zc(o),this.V(c,o,l,h).next()):new f.BL(c,o,l,h)},d.ep=function(c,o,l,h){var m=c.Db(),g=o.Db();if(c.B()&&o.B())return m>g?c:o;if(c.B())return o;if(o.B())return c;var v=new f.l,w=new f.l,E=new f.l;return c.A(v),o.A(w),E.K(v),E.Zb(w),v=f.ta.Wd(l,E,!0),w=c.getType(),E=o.getType(),w==33&&E==33?d.aV(c,o,v):w!=E?0<m||0<g?m>g?c:o:w==550?d.iI(c,o,v):d.iI(o,c,v):f.Fg.ep(c,o,l,h)},d.aV=function(c,o,l){l=l*Math.sqrt(2)*1.00001,l*=l;var h=c.D(),m=o.D(),g=new f.de(c.description);return f.h.yc(h,m)>l&&(g.add(c),g.add(o)),g},d.iI=function(c,o,l){var h=c.ub(0),m=c.I(),g=o.D(),v=c.Ia();l=l*Math.sqrt(2)*1.00001;var w=new f.l;if(c.A(w),w.W(l,l),w.contains(g)){l*=l,w=!1;for(var E=[],A=0;A<m;A++)E[A]=!1;for(A=0;A<m;A++){var M=h.read(2*A),I=h.read(2*A+1);(M-=g.x)*M+(I-=g.y)*I<=l&&(w=!0,E[A]=!0)}if(w)for(A=0;A<m;A++)E[A]||v.Fd(c,A,A+1);else v.Fd(c,0,m),v.add(o)}else v.Fd(c,0,m),v.add(o);return v},d.instance=null,d}(f.Je);f.Kx=L}(Q||(Q={})),function(f){var L=function(){function x(d,c,o,l){this.ts=c==null,this.ya=-1,this.Rd=d,this.vg=o,this.NT=c.next(),this.Ub=l}return x.prototype.next=function(){return this.ts?null:(d=this.Rd.next())!=null?(this.ya=this.Rd.La(),f.Kx.ep(d,this.NT,this.vg,this.Ub)):null;var d},x.prototype.La=function(){return this.ya},x.prototype.qe=function(){},x}();f.BL=L}(Q||(Q={})),function(f){var L=function(){function c(){}return c.prototype.Fz=function(){this.$y=null,this.Ax=-1,this.AK=!1},c}(),x=function(){function c(){this.Gr=0,this.pj=[]}return c.prototype.pN=function(o){this.Gr+=o.Ax,this.pj.push(o)},c.prototype.TV=function(){this.Gr-=this.pj[this.pj.length-1].Ax,--this.pj.length},c.prototype.my=function(){return this.pj[this.pj.length-1]},c.prototype.Nb=function(o){return o===this},c}(),d=function(){function c(o,l,h){this.ya=-1,this.Ic=!1,this.AH=[!1,!1,!1,!1],this.uq=[0,0,0,0],this.jA=!1,this.zk=-1,this.iq=0,this.bo=-1,this.Do=[],this.Rd=o,this.vg=l,this.Ub=h}return c.dE=function(o){var l=[],h=0;for(o=Object.keys(o);h<o.length;h++)l.push(Number(o[h]));return l.sort(function(m,g){return m-g}),l},c.prototype.fG=function(o){var l=this.Do[o],h=c.dE(l)[0],m=l[h],g=m.my().$y;return m=m.my().AK,delete l[h],m&&(g=f.Yl.local().V(g,this.vg,!1,this.Ub),o==0&&g.getType()==33&&(o=new f.de(g.description),g.B()||o.add(g),g=o)),g},c.prototype.next=function(){if(this.Ic&&this.bo==this.zk)return null;for(;!this.qK(););if(this.zk==-1)return null;if(this.jA){for(this.bo++;;){if(this.bo>this.zk||0>this.bo)throw f.i.Qa();if(this.AH[this.bo])break}return this.ya++,this.fG(this.bo)}return this.ya=0,this.bo=this.zk,this.fG(this.zk)},c.prototype.La=function(){return this.ya},c.prototype.qK=function(){if(this.Ic)return!0;var o=null;if(this.Rd!=null&&(o=this.Rd.next())==null&&(this.Ic=!0,this.Rd=null),f.mp.zp(this.Ub),o!=null){var l=o.Db();this.AH[l]=!0,l>=this.zk&&!this.jA&&(this.ND(l,!1,o),l>this.zk&&!this.jA&&this.zW(l))}if(0<this.iq)for(l=0;l<=this.zk;l++)for(;1<this.uq[l]&&(o=this.FO(l)).length!=0;)o=f.Fg.VP(o,this.vg,this.Ub),this.ND(l,!0,o);return this.Ic},c.prototype.FO=function(o){for(var l=[],h=[],m=this.Do[o],g=c.dE(m),v=0;v<g.length;v++){var w=g[v],E=m[w];if(this.Ic||1e4<E.Gr&&1<E.pj.length){for(this.uq[o]-=E.pj.length,this.iq-=E.pj.length;0<E.pj.length;)l.push(E.my().$y),E.TV();h.push(w)}}for(v=0;v<h.length;v++)delete m[h[v]];return l},c.prototype.zW=function(o){for(var l=0;l<o;l++)this.Do[l]=[],this.iq-=this.uq[l],this.uq[l]=0},c.prototype.ND=function(o,l,h){var m=new L;if(m.Fz(),m.$y=h,h=c.eS(h),m.Ax=h,h=c.cS(h),o+1>this.Do.length)for(var g=0,v=Math.max(2,o+1);g<v;g++)this.Do.push([]);(g=this.Do[o][h])===void 0&&(g=new x,this.Do[o][h]=g),m.AK=l,g.pN(m),this.uq[o]++,this.iq++,this.zk=Math.max(this.zk,o)},c.cS=function(o){return 0<o?f.O.truncate(Math.log(o)/Math.log(4)+.5):0},c.eS=function(o){var l=o.getType();if(f.aa.xj(l))return o.I();if(l==33)return 1;if(l==197)return 4;if(f.aa.yd(l))return 2;throw f.i.Qa()},c.prototype.qe=function(){this.qK()},c}();f.DL=d}(Q||(Q={})),function(f){var L=function(x){function d(){return x!==null&&x.apply(this,arguments)||this}return bt(d,x),d.prototype.getType=function(){return 1},d.prototype.V=function(c,o,l,h){return h===void 0?new f.DL(c,o,l):this.gQ(c,o,l,h)},d.prototype.gQ=function(c,o,l,h){return c=new f.Zc([c,o]),this.V(c,l,h).next()},d.local=function(){return d.instance===null&&(d.instance=new d),d.instance},d.instance=null,d}(f.Je);f.Gh=L}(Q||(Q={})),function(f){var L,x;(x=L||(L={}))[x.nextPath=0]="nextPath",x[x.nextSegment=1]="nextSegment",x[x.iterate=2]="iterate",L=function(){function d(c,o,l,h){this.Ts=new f.l,this.GT=c,this.HT=o,this.mq=h,this.uo=-1,this.rl=!1;var m=c.Bb;m!=null&&(m=h?m.zo:m.Fb)!=null&&(this.Ic=!1,this.qa=l,this.Fb=m,this.xw=this.Fb.getIterator(),this.nq=this.rl=!0,this.Xb=0,h?this.uo=o.da():this.sd=o.Ga()),this.rl||(m=o.Bb)!=null&&(m=h?m.zo:m.Fb)!=null&&(this.Ic=!1,this.qa=l,this.Fb=m,this.xw=this.Fb.getIterator(),this.rl=!0,this.nq=!1,this.Xb=0,h?this.uo=c.da():this.sd=c.Ga()),this.rl||(this.ci=h?f.ta.mR(c,o,l,1<=c.om(0),1<=o.om(0)):f.ta.lR(c,o,l))}return d.prototype.next=function(){if(this.rl){if(this.Ic)return!1;for(var c=!0;c;)switch(this.Xb){case 0:c=this.xU();break;case 1:c=this.yU();break;case 2:c=this.Uz();break;default:throw f.i.fa("internal error")}return!this.Ic}return this.ci!=null&&this.ci.next()},d.prototype.nl=function(){return this.rl?this.nq?this.Fb.ja(this.Fs):this.mq?this.uo:this.sd.wb():this.ci.nl(this.ci.Vf)},d.prototype.hl=function(){return this.rl?this.nq?this.mq?this.uo:this.sd.wb():this.Fb.ja(this.Fs):this.ci.hl(this.ci.Af)},d.prototype.uz=function(){if(!this.mq)throw f.i.fa("internal error");return this.rl?this.nq?this.Fb.GF(this.Fs):this.Ts:this.ci.uz(this.ci.Vf)},d.prototype.az=function(){if(!this.mq)throw f.i.fa("internal error");return this.rl?this.nq?this.Ts:this.Fb.GF(this.Fs):this.ci.az(this.ci.Af)},d.prototype.xU=function(){return this.mq?--this.uo==-1?(this.Ic=!0,!1):(this.nq?this.HT.Rj(this.uo,this.Ts):this.GT.Rj(this.uo,this.Ts),this.xw.Xi(this.Ts,this.qa),this.Xb=2,!0):this.sd.$a()?(this.Xb=1,!0):(this.Ic=!0,!1)},d.prototype.yU=function(){if(!this.sd.Ha())return this.Xb=0,!0;var c=this.sd.ha();return this.xw.Uo(c,this.qa),this.Xb=2,!0},d.prototype.Uz=function(){return this.Fs=this.xw.next(),this.Fs==-1&&(this.Xb=this.mq?0:1,!0)},d}(),f.Zl=L}(Q||(Q={})),function(f){(f=f.OL||(f.OL={}))[f.enumClosed=1]="enumClosed",f[f.enumHasNonlinearSegments=2]="enumHasNonlinearSegments",f[f.enumOGCStartPolygon=4]="enumOGCStartPolygon",f[f.enumCalcMask=4]="enumCalcMask"}(Q||(Q={})),function(f){f.QC=function(){function L(){}return L.tb=function(x,d,c,o,l,h,m,g,v){var w=[0,0,0],E=[0,0,0],A=[0,0,0],M=[0,0,0,0],I=new f.ga(0),D=new f.ga(0),k=new f.ga(0);if(m!=null||g!=null||v!=null)if(f.s.ti(d))f.Yg.tb(x,c,o,l,h,m,g,v);else{l=f.F.ba(l),c=f.F.ba(c);var B=f.F.ba(l-c);if(f.s.Y(o,h)&&(f.s.Y(c,l)||f.s.Y(f.s.P(o),1.570796326794897)))m!=null&&(m.u=0),g!=null&&(g.u=0),v!=null&&(v.u=0);else{if(f.s.Y(o,-h)){if(f.s.Y(f.s.P(o),1.570796326794897))return m!=null&&(m.u=2*f.F.Ah(x,d)),g!=null&&(g.u=0<o?f.F.ba(3.141592653589793-f.F.ba(l)):f.F.ba(l)),void(v!=null&&(v.u=0<o?f.F.ba(l):f.F.ba(3.141592653589793-f.F.ba(l))));f.s.Y(f.s.P(B),3.141592653589793)&&(m!=null&&(m.u=2*f.F.Ah(x,d)),g!=null&&(g.u=0),v!=null&&(v.u=0))}else if(f.s.Y(f.s.P(o),1.570796326794897)||f.s.Y(f.s.P(h),1.570796326794897)||f.s.Y(c,l)||f.s.Y(f.s.P(B),3.141592653589793)||f.s.Cd(o))return void f.Wk.tb(x,d,c,o,l,h,m,g,v);var J=Math.sqrt(1-d);l=f.F.ba(l-c),c=0,f.F.cl(1,d,o,c,0,I,D,k),w[0]=I.u,w[1]=D.u,w[2]=k.u,f.F.cl(1,d,h,l,0,I,D,k),E[0]=I.u,E[1]=D.u,E[2]=k.u,A[0]=0,A[1]=0,A[2]=-1*d*f.F.n(1,d,o)*Math.sin(o),0>l?f.F.Wq(A,E,w,M,0):f.F.Wq(A,w,E,M,0),D=[0,0,0],k=[0,0,0];var Y=[0,0,0];w=[0,0,0],I=[0,0,0];var V=Math.acos(M[2]/1),te=1-d,he=Math.tan(V),ue=1+he*he/te,xe=2*A[2]*he/te;for(te=(-xe+(he=Math.sqrt(xe*xe-4*ue*(A[2]*A[2]/te-1))))/(ue*=2),xe=(-xe-he)/ue,he=Math.tan(V),V=(te+xe)/2,A=((ue=he*te+A[2])+(he*xe+A[2]))/2,he=f.F.gp(te-V,ue-A),te=A/J*1.570796326794897,xe=0;100>xe&&(ue=(ue=f.F.w(d,te))*ue/Math.cos(te)*(Math.sin(te)-A*ue/(1-d)),!f.s.Cd(ue));xe++)te-=ue;A=f.F.n(1,d,te)*Math.cos(te),he=1-he/(A=Math.sqrt((A-V)*(A+V))),he*=2-he,ue=f.F.on(D),V=f.F.on(k),te=f.F.on(Y);var be=f.F.St(Y,D);xe=f.F.St(Y,k),f.F.zx(Y,D,w),f.F.zx(Y,k,I),D=Math.acos(be/(te*ue)),k=Math.acos(xe/(te*V)),k*=f.s.Mb(1,f.F.St(w,I)),(1.570796326794897<=f.s.P(D)&&1.570796326794897<=f.s.P(k)||3.141592653589793<f.s.P(D-k))&&(D=(3.141592653589793-f.s.P(D))*f.s.Mb(1,D),k=(3.141592653589793-f.s.P(k))*f.s.Mb(1,k)),w=f.F.Qj(he,k),I=f.F.q(A,he,f.F.Qj(he,D)),w=f.F.q(A,he,w),w=f.s.P(w-I)*x,D=new f.ga(0),k=new f.ga(0),Y=M[1]/1,Y*=-f.s.Mb(1,B),I=Math.acos(Y)*f.s.Mb(1,B),L.rf(x,d,c,o,w,I,D,k),f.s.Y(l,D.u)&&f.s.Y(h,k.u)||(he=f.F.gp(f.F.ba(l-D.u),h-k.u),L.rf(x,d,c,o,w,f.F.ba(I+3.141592653589793),D,k),(ue=f.F.gp(f.F.ba(l-D.u),h-k.u))<he&&(I=f.F.ba(I+3.141592653589793))),D=[0,0,0,0],k=[0,0,0,0],he=[0,0,0],x=[0,0,0],c=[0,0,0],o=[0,0,0],Y=[0,0,0],(A=[0,0,0])[0]=0,A[1]=0,A[2]=J,he[0]=0,he[1]=0,he[2]=0,f.F.Wq(he,A,E,D,0),f.s.Cd(h)?(x[0]=E[0],x[1]=E[1],x[2]=1,c[0]=1*Math.cos(l)-1*Math.sin(l),c[1]=1*Math.sin(l)+1*Math.cos(l)):(d=f.F.n(1,d,h)*Math.cos(h),x[0]=0,x[1]=0,E[2]+=Math.tan(1.570796326794897-f.s.P(h))*d*f.s.Mb(1,h),c[0]=d*Math.cos(l)-d*Math.sin(l),c[1]=d*Math.sin(l)+d*Math.cos(l)),c[2]=E[2],f.F.Wq(E,c,x,k,1),f.F.zx(k,D,o),f.F.zx(k,M,Y),Y=f.F.St(o,Y)/(f.F.on(o)*f.F.on(Y)),Y*=f.s.Mb(1,B),l=Math.acos(Y)*-f.s.Mb(1,B),(0<I&&0<l||0>I&&0>l)&&(l=f.F.ba(l+3.141592653589793)),m!=null&&(m.u=w),g!=null&&(g.u=I),v!=null&&(v.u=l)}}},L.rf=function(x,d,c,o,l,h,m,g){var v=[0,0,0],w=[0,0,0],E=[0,0,0],A=[0,0,0],M=[0,0,0],I=[0,0,0],D=[0,0,0],k=[0,0,0,0],B=new f.ga(0),J=new f.ga(0),Y=new f.ga(0),V=new f.ga(0),te=new f.ga(0),he=new f.ga(0);if(m!=null&&g!=null)if(f.s.ti(d))f.Yg.rf(x,c,o,l,h,m,g);else if(f.s.Cd(l))m!=null&&(m.u=c),g!=null&&(g.u=o);else if(h=f.F.ba(h),0>l&&(l=f.s.P(l),h=f.F.ba(h+3.141592653589793)),c=f.F.ba(c),o=f.F.ba(o),1.570796326794897<f.s.P(o)&&(c=f.F.ba(c+3.141592653589793),o=f.s.Mb(3.141592653589793,o)-o),f.s.Y(f.s.P(o),1.570796326794897)||f.s.Cd(o)||f.s.Cd(h)||f.s.Y(f.s.P(h),3.141592653589793))f.Wk.rf(x,d,c,o,l,h,m,g);else{var ue=Math.sqrt(1-d);for(x=l/x,f.F.cl(1,d,o,0,0,V,te,he),v[0]=V.u,v[1]=te.u,v[2]=te.u,D[0]=0,D[1]=0,D[2]=-1*d*f.F.n(1,d,o)*Math.sin(o),V=f.F.n(1,d,o),te=f.F.ba(1.570796326794897-h),he=Math.sin(te),l=Math.cos(o),o=Math.sin(o),M[0]=V*l-o*he,M[1]=Math.cos(te),M[2]=(1-d)*V*o+l*he,0>h?f.F.Wq(D,M,v,k,0):f.F.Wq(D,v,M,k,0),v=Math.acos(k[2]/1),k=Math.atan2(-k[1],-k[0]),o=1-d,te=1+(M=Math.tan(v))*M/o,o=(-(V=2*D[2]*M/o)+(M=Math.sqrt(V*V-4*te*(D[2]*D[2]/o-1))))/(te*=2),V=(-V-M)/te,M=Math.tan(v),v=(o+V)/2,D=((te=M*o+D[2])+(M*V+D[2]))/2,M=f.F.gp(o-v,te-D),ue=D/ue*1.570796326794897,o=0;100>o&&(V=(V=f.F.w(d,ue))*V/Math.cos(ue)*(Math.sin(ue)-D*V/(1-d)),!f.s.Cd(V));o++)ue-=V;ue=f.F.n(1,d,ue)*Math.cos(ue),D=1-M/(ue=Math.sqrt((ue-v)*(ue+v))),D*=2-D,I=Math.acos(f.F.St(I,w)/(f.F.on(I)*f.F.on(w))),I*=f.s.Mb(1,w[0]),h=(f.F.q(ue,D,f.F.Qj(D,I))+x*f.s.Mb(1,h))/f.F.Ah(ue,D),h=f.F.ba(1.570796326794897*h),h=f.F.Rq(D,h),f.F.n(ue,D,h),M=f.F.ba(k+c),c=Math.cos(M),h=Math.sin(M),E[0]=A[0]*c+A[1]*-h,E[1]=A[0]*h+A[1]*c,E[2]=A[2],f.F.jO(d,E[0],E[1],E[2],Y,J,B),m!=null&&(m.u=J.u),g!=null&&(g.u=Y.u)}},L}()}(Q||(Q={})),function(f){var L=function(){function l(h){this.Ya=null,this.wt=new f.h,this.xt=new f.h,this.g=h}return l.prototype.compare=function(h,m,g){return this.g.Gc(m,this.wt),this.g.Gc(h.ja(g),this.xt),this.wt.compare(this.xt)},l}(),x=function(){function l(h){this.Bf=new f.h,this.Dk=new f.h,this.g=h}return l.prototype.Dh=function(h){this.Bf.L(h)},l.prototype.compare=function(h,m){return this.g.Gc(h.ja(m),this.Dk),this.Bf.compare(this.Dk)},l}(),d=function(l){function h(m){var g=l.call(this,m.g,m.qa,!1)||this;return g.ib=m,g}return bt(h,l),h.prototype.compare=function(m,g,v){if(this.rg)return-1;var w=this.ib.Qd.Jn(this.ib.Rh(g));m=m.ja(v);var E=this.ib.Qd.Jn(this.ib.Rh(m));return this.Dm=v,this.RE(g,w,m,E)},h}(f.UC),c=function(l){function h(m){var g=l.call(this,m.g,m.qa)||this;return g.ib=m,g}return bt(h,l),h.prototype.compare=function(m,g){return this.rg?-1:(m=this.ib.Qd.Jn(this.ib.Rh(m.ja(g))),this.Dm=g,this.SE(g,m))},h}(f.aM),o=function(){function l(){this.Mc=this.df=this.jo=this.Qd=this.lh=this.zd=this.hb=this.g=null,this.Ng=!1,this.vh=this.Nm=this.ie=this.Gk=this.nh=this.Ak=this.Ff=this.$d=null,this.xh=this.Jq=this.UA=this.qa=0,this.Xv=this.Wn=!1,this.yo=new f.h,this.Pi=new f.h,this.hb=new f.$c(8),this.zd=new f.$c(5),this.lh=new f.au,this.Qd=new f.au,this.Ng=!1,this.vh=new f.h,this.vh.ma(0,0),this.qa=0,this.xh=-1,this.Wn=!1,this.g=null,this.df=new f.Yj,this.Mc=new f.Yj,this.nh=new f.ia(0),this.Gk=new f.TC,this.Ff=new f.ia(0),this.Ak=new f.ia(0),this.jo=new f.Sa}return l.prototype.PX=function(h,m){var g=new f.Dd;return g.$B(),h.Oc(g),this.er(h),this.Wn=!1,this.qa=m,this.UA=m*m,m=this.jC(),h.Oc(g),m||(this.qQ(),m||this.jC()),this.xh!=-1&&(this.g.Td(this.xh),this.xh=-1),this.g=null,this.Wn},l.prototype.TX=function(h,m){this.er(h),this.Wn=!1,this.qa=m,this.UA=m*m,this.Ng=!1,this.jC(),this.Ng||(this.Ng=h.Gp(m,!0,!1)==1),this.xh!=-1&&(this.g.Td(this.xh),this.xh=-1),this.g=null},l.prototype.pg=function(h,m){return this.hb.T(h,0+m)},l.prototype.LB=function(h,m,g){this.hb.S(h,0+m,g)},l.prototype.Rh=function(h){return this.hb.T(h,2)},l.prototype.ZW=function(h,m){this.hb.S(h,2,m)},l.prototype.RF=function(h,m){return this.hb.T(h,3+m)},l.prototype.Pp=function(h){return this.hb.T(h,7)},l.prototype.Pl=function(h,m){this.hb.S(h,7,m)},l.prototype.Rp=function(h,m){return this.hb.T(h,3+this.Op(h,m))},l.prototype.fr=function(h,m,g){this.hb.S(h,3+this.Op(h,m),g)},l.prototype.NR=function(h,m){return this.hb.T(h,5+this.Op(h,m))},l.prototype.hr=function(h,m,g){this.hb.S(h,5+this.Op(h,m),g)},l.prototype.Sr=function(h){return this.zd.T(h,0)},l.prototype.UW=function(h,m){this.zd.S(h,0,m)},l.prototype.ez=function(h){return this.zd.T(h,4)},l.prototype.cr=function(h,m){this.zd.S(h,4,m)},l.prototype.il=function(h){return this.zd.T(h,1)},l.prototype.ln=function(h,m){this.zd.S(h,1,m)},l.prototype.dz=function(h){return this.zd.T(h,3)},l.prototype.Et=function(h,m){this.zd.S(h,3,m)},l.prototype.Ym=function(h){var m=this.zd.Ce(),g=this.lh.Ph();return this.UW(m,g),h!=-1?(this.lh.addElement(g,h),this.g.Ra(h,this.xh,m),this.cr(m,this.g.Ua(h))):this.cr(m,-1),m},l.prototype.HP=function(h){this.zd.jd(h)},l.prototype.LD=function(h,m){this.lh.addElement(this.Sr(h),m),this.g.Ra(m,this.xh,h)},l.prototype.nt=function(h){var m=this.hb.Ce(),g=this.Qd.Ph();return this.ZW(m,g),h!=-1&&this.Qd.addElement(g,h),m},l.prototype.MD=function(h,m){this.Qd.addElement(this.Rh(h),m)},l.prototype.Uu=function(h){this.hb.jd(h),0<=(h=this.nh.lF(h))&&this.nh.SV(h)},l.prototype.hj=function(h,m){if(this.pg(h,0)==-1)this.LB(h,0,m);else{if(this.pg(h,1)!=-1)throw f.i.Qa();this.LB(h,1,m)}this.ky(h,m)},l.prototype.ky=function(h,m){var g=this.il(m);if(g!=-1){var v=this.Rp(g,m);this.hr(v,m,h),this.fr(h,m,v),this.fr(g,m,h),this.hr(h,m,g)}else this.hr(h,m,h),this.fr(h,m,h),this.ln(m,h)},l.prototype.Op=function(h,m){return this.pg(h,0)==m?0:1},l.prototype.Xm=function(h,m){var g,v=this.dz(m);if(v!=-1&&(this.df.vd(v,-1),this.Et(m,-1)),(v=this.il(m))!=-1){var w=g=v;do{var E=!1,A=this.Op(g,m),M=this.RF(g,A);if(this.pg(g,A+1&1)==h){if(this.Xu(g),this.Qd.bh(this.Rh(g)),this.Uu(g),g==M){v=-1;break}v==g&&(v=this.il(m),w=M,E=!0)}g=M}while(g!=w||E);if(v!=-1){do A=this.Op(g,m),M=this.RF(g,A),this.LB(g,A,h),g=M;while(g!=w);(g=this.il(h))!=-1?(w=this.Rp(g,h),E=this.Rp(v,h),w==g?(this.ln(h,v),this.ky(g,h),this.ln(h,g)):E==v&&this.ky(v,h),this.fr(v,h,w),this.hr(w,h,v),this.fr(g,h,E),this.hr(E,h,g)):this.ln(h,v)}}for(v=this.Sr(h),g=this.Sr(m),w=this.lh.rc(g);w!=-1;w=this.lh.lb(w))this.g.Ra(this.lh.ja(w),this.xh,h);this.lh.Hy(v,g),this.HP(m)},l.prototype.UT=function(h,m){var g=this.pg(h,0),v=this.pg(h,1),w=this.pg(m,0),E=this.pg(m,1);this.Qd.Hy(this.Rh(h),this.Rh(m)),m==this.il(g)&&this.ln(g,h),m==this.il(v)&&this.ln(v,h),this.Xu(m),this.Uu(m),g==w&&v==E||v==w&&g==E||(this.Hn(g,this.yo),this.Hn(w,this.Pi),this.yo.qb(this.Pi)?(g!=w&&this.Xm(g,w),v!=E&&this.Xm(v,E)):(v!=w&&this.Xm(v,w),g!=E&&this.Xm(g,E)))},l.prototype.Xu=function(h){var m=this.pg(h,1);this.dF(h,this.pg(h,0)),this.dF(h,m)},l.prototype.dF=function(h,m){var g=this.Rp(h,m),v=this.NR(h,m),w=this.il(m);g!=h?(this.fr(v,m,g),this.hr(g,m,v),w==h&&this.ln(m,g)):this.ln(m,-1)},l.prototype.WD=function(h,m,g){var v=this.Qd.rc(h),w=this.Qd.ja(v);h=this.Le(w);var E=this.Le(this.g.U(w));for(this.g.jr(w,m,g,!0),v=this.Qd.lb(v);v!=-1;v=this.Qd.lb(v)){w=this.Qd.ja(v);var A=this.Le(w)==h;this.g.jr(w,m,g,A)}v=m.Vp(g,0).ac(),m=m.Vp(g,m.ol(g)-1).wc(),this.BK(h,v),this.BK(E,m)},l.prototype.ZE=function(h,m,g){var v=this.Rh(h),w=this.pg(h,0),E=this.pg(h,1),A=this.nt(-1);for(this.nh.add(A),this.Pl(A,-3),this.Ff.add(A),this.hj(A,w),h=1,m=m.ol(g);h<m;h++)g=this.Ym(-1),this.Ak.add(g),this.Ff.add(g),this.hj(A,g),A=this.nt(-1),this.nh.add(A),this.Pl(A,-3),this.Ff.add(A),this.hj(A,g);for(this.hj(A,E),v=this.Qd.rc(v);v!=-1;v=this.Qd.lb(v))if(E=this.Qd.ja(v),this.Le(E)==w){h=0;do 0<h&&(A=this.Ff.get(h-1),this.LD(A,E),this.ez(A)==-1&&this.cr(A,this.g.Ua(E))),A=this.Ff.get(h),h+=2,this.MD(A,E),E=this.g.U(E);while(h<this.Ff.size)}else{h=this.Ff.size-1;do h<this.Ff.size-2&&(A=this.Ff.get(h+1),this.LD(A,E),0>this.ez(A)&&this.cr(A,this.g.Ua(E))),A=this.Ff.get(h),h-=2,this.MD(A,E),E=this.g.U(E);while(0<=h)}this.Ff.clear(!1)},l.prototype.Le=function(h){return this.g.Pa(h,this.xh)},l.prototype.TI=function(h,m,g){var v=this.pg(m,0),w=new f.h;this.Hn(v,w);var E=new f.h,A=this.pg(m,1);this.Hn(A,E);var M=g.ol(h),I=g.Vp(h,0),D=new f.h;if(I.Yp(D),!w.qb(D)){if(!this.Ng){var k=w.compare(this.vh);0>k*(D=D.compare(this.vh))&&(this.Ng=!0)}this.vF(v,this.Ff),this.Ak.add(v)}for(!this.Ng&&1<M&&(k=w.compare(E),I=I.wc(),(w.compare(I)!=k||I.compare(E)!=k||0>I.compare(this.vh))&&(this.Ng=!0)),h=(I=g.Vp(h,M-1)).wc(),E.qb(h)||(this.Ng||0>(k=E.compare(this.vh))*(D=h.compare(this.vh))&&(this.Ng=!0),this.vF(A,this.Ff),this.Ak.add(A)),this.Ff.add(m),E=0,A=this.Ff.size;E<A;E++)h=this.Ff.get(E),g=this.Pp(h),f.$c.LG(g)&&(this.Mc.vd(g,-1),this.Pl(h,-1)),h!=m&&this.Pp(h)!=-3&&(this.nh.add(h),this.Pl(h,-3));this.Ff.clear(!1)},l.prototype.lO=function(h,m){this.$d.compare(this.Mc,this.Mc.ja(h),m),this.$d.rg&&(this.$d.Kr(),this.oF(h,m))},l.prototype.oF=function(h,m){this.Wn=!0,h=this.Mc.ja(h),m=this.Mc.ja(m);var g=this.Qd.Jn(this.Rh(h)),v=this.Qd.Jn(this.Rh(m)),w=this.g.bc(g);w==null&&(this.ie==null&&(this.ie=new f.yb),this.g.ed(g,this.ie),w=this.ie),(g=this.g.bc(v))==null&&(this.Nm==null&&(this.Nm=new f.yb),this.g.ed(v,this.Nm),g=this.Nm),this.Gk.Oo(w),this.Gk.Oo(g),this.Gk.Ea(this.qa,!0)&&(this.Ng=!0),this.hK(h,m,-1,this.Gk),this.Gk.clear()},l.prototype.GQ=function(h,m){this.Wn=!0,m=this.Mc.ja(m);var g=this.Qd.Jn(this.Rh(m)),v=this.g.bc(g);v==null&&(this.ie==null&&(this.ie=new f.yb),this.g.ed(g,this.ie),v=this.ie),g=this.BF(h),this.Gk.Oo(v),this.g.Vi(g,this.jo),this.Gk.Kz(this.qa,this.jo,!0),this.hK(m,-1,h,this.Gk),this.Gk.clear()},l.prototype.xS=function(){if(this.nh.size!=0)for(;this.nh.size!=0;){if(this.nh.size>Math.max(100,this.g.fd)){this.nh.clear(!1),this.Ng=!0;break}var h=this.nh.Fc();this.nh.If(),this.Pl(h,-1),this.WS(h)!=-1&&this.wS(h),this.Vn=!1}},l.prototype.wS=function(h){if(this.Vn){var m=this.Mc.zu(this.MH,this.GH,h,!0);this.Vn=!1}else m=this.Mc.KD(h);m==-1?this.UT(this.Mc.ja(this.Mc.FF()),h):(this.Pl(h,m),this.$d.rg&&(this.$d.Kr(),this.oF(this.$d.Dm,m)))},l.prototype.WS=function(h){var m=this.pg(h,0);if(h=this.pg(h,1),this.Hn(m,this.yo),this.Hn(h,this.Pi),f.h.yc(this.yo,this.Pi)<=this.UA)return this.Ng=!0,-1;var g=this.yo.compare(this.vh),v=this.Pi.compare(this.vh);return 0>=g&&0<v?h:0>=v&&0<g?m:-1},l.prototype.oQ=function(){var h=new f.ia(0);h.Jb(this.g.fd);for(var m=this.g.Yq(),g=m.next();g!=-1;g=m.next())this.g.Pa(g,this.xh)!=-1&&h.add(g);this.g.nx(h,h.size),this.pQ(h)},l.prototype.pQ=function(h){this.df.clear(),this.df.De(h.size),this.df.Vo(new L(this.g));var m=new f.h;m.Rc();for(var g=-1,v=new f.h,w=0,E=h.size;w<E;w++){var A=h.get(w);this.g.Gc(A,v),v.qb(m)?(A=this.g.Pa(A,this.xh),this.Xm(g,A)):(g=this.Le(A),this.g.Gc(A,m),A=this.df.xn(A),this.Et(g,A))}},l.prototype.qQ=function(){var h=new f.ia(0);h.Jb(this.g.fd);for(var m=this.df.rc(-1);m!=-1;m=this.df.lb(m))h.add(this.df.ja(m));this.df.clear(),this.g.nx(h,h.size),m=0;for(var g=h.size;m<g;m++){var v=h.get(m),w=this.Le(v);v=this.df.xn(v),this.Et(w,v)}},l.prototype.vF=function(h,m){var g=this.il(h);if(g!=-1){var v=g;do f.$c.LG(this.Pp(v))&&m.add(v),v=this.Rp(v,h);while(v!=g)}},l.prototype.BK=function(h,m){for(h=this.lh.rc(this.Sr(h));h!=-1;h=this.lh.lb(h))this.g.mf(this.lh.ja(h),m)},l.prototype.hK=function(h,m,g,v){this.Xu(h),m!=-1&&this.Xu(m),this.TI(0,h,v),m!=-1&&this.TI(1,m,v),g!=-1&&(v.Bf.D(this.yo),this.Hn(g,this.Pi),this.Pi.qb(this.yo)||this.Ak.add(g)),g=0;for(var w=this.Ak.size;g<w;g++){var E=this.Ak.get(g),A=this.dz(E);A!=-1&&(this.df.vd(A,-1),this.Et(E,-1))}for(g=this.Rh(h),w=m!=-1?this.Rh(m):-1,this.WD(g,v,0),m!=-1&&this.WD(w,v,1),this.ZE(h,v,0),m!=-1&&this.ZE(m,v,1),this.Qd.bh(g),this.Uu(h),m!=-1&&(this.Qd.bh(w),this.Uu(m)),g=0,w=this.Ak.size;g<w;g++)(E=this.Ak.get(g))==this.Jq&&(this.Xv=!0),(A=this.dz(E))==-1&&((A=this.df.KD(this.BF(E)))==-1?(h=this.Le(this.df.ja(this.df.FF())),this.Xm(h,E)):this.Et(E,A));this.Ak.clear(!1)},l.prototype.Hn=function(h,m){this.g.dG(this.ez(h),m)},l.prototype.BF=function(h){return this.lh.Jn(this.Sr(h))},l.prototype.jC=function(){this.Xv=!1,this.Jq=-1,this.$d==null&&(this.Mc.Rv=!1,this.$d=new d(this),this.Mc.Zn=this.$d);var h=new f.ia(0),m=null,g=null;this.GH=this.MH=-1,this.Vn=!1;for(var v=this.df.rc(-1);v!=-1;){this.Vn=!1;var w=this.df.ja(v);this.Jq=this.Le(w),this.g.Gc(w,this.vh),this.$d.$J(this.vh.y,this.vh.x);var E=this.il(this.Jq),A=E==-1;if(!A){w=E;do{var M=this.Pp(w);M==-1?(this.nh.add(w),this.Pl(w,-3)):M!=-3&&h.add(M),w=this.Rp(w,this.Jq)}while(w!=E)}if(0<h.size){for(this.Vn=h.size==1&&this.nh.size==1,A=0,E=h.size;A<E;A++)w=this.Mc.ja(h.get(A)),this.Pl(w,-2);var I=-2,D=-2;for(A=0,E=h.size;A<E;A++){if(M=h.get(A),I==-2){var k=this.Mc.we(M);k!=-1?(w=this.Mc.ja(k),(w=this.Pp(w))!=-2&&(I=k)):I=-1}if(D==-2&&((M=this.Mc.lb(M))!=-1?(w=this.Mc.ja(M),(w=this.Pp(w))!=-2&&(D=M)):D=-1),I!=-2&&D!=-2)break}for(A=0,E=h.size;A<E;A++)M=h.get(A),w=this.Mc.ja(M),this.Mc.vd(M,-1),this.Pl(w,-1);h.clear(!1),this.MH=I!=-1?I:-1,this.GH=D!=-1?D:-1,I!=-1&&D!=-1?this.Vn||this.lO(I,D):I==-1&&D==-1&&(this.Vn=!1)}else A&&(m==null&&(m=new c(this)),m.Dh(this.vh),this.Mc.uJ(m),m.rg&&(m.Kr(),this.GQ(this.Jq,m.Dm)));this.xS(),this.Xv?(this.Xv=!1,g==null&&(g=new x(this.g)),g.Dh(this.vh),v=this.df.uJ(g)):v=this.df.lb(v)}return this.Wn},l.prototype.er=function(h){for(this.g=h,this.xh=this.g.Gd(),this.hb.De(h.fd+32),this.zd.De(h.fd),this.lh.At(h.fd),this.lh.fn(h.fd),this.Qd.At(h.fd+32),this.Qd.fn(h.fd+32),h=this.g.ld;h!=-1;h=this.g.ue(h))if(f.aa.Hc(this.g.ic(h)))for(M=this.g.Ob(h);M!=-1;M=this.g.Rb(M)){var m=this.g.Ja(M),g=this.g.Xa(M),v=this.Ym(g),w=this.nt(g);for(this.hj(w,v),I=this.g.U(g),g=0,m-=2;g<m;g++){var E=this.g.U(I),A=this.Ym(I);this.hj(w,A),w=this.nt(I),this.hj(w,A),I=E}this.g.dc(M)?(A=this.Ym(I),this.hj(w,A),w=this.nt(I),this.hj(w,A),this.hj(w,v)):(A=this.Ym(I),this.hj(w,A))}else for(var M=this.g.Ob(h);M!=-1;M=this.g.Rb(M)){var I=this.g.Xa(M);for(v=0,m=this.g.Ja(M);v<m;v++)this.Ym(I),I=this.g.U(I)}this.oQ()},l}();f.RC=o}(Q||(Q={})),function(f){var L=function(x){function d(c,o,l){var h=x.call(this)||this;if(c!==void 0)if(l!==void 0){h.description=f.ee.og();var m=new f.Nd;m.K(c,o,l),h.dC(m)}else if(o!==void 0)h.description=f.ee.og(),h.Cb(c,o);else if(c instanceof f.ra)h.description=c;else if(c instanceof f.h)h.description=f.ee.og(),h.Cb(c);else{if(!(c instanceof d))throw f.i.N();h.description=c.description,h.Cb(c.Lg(),c.ih()),c.ka!==null&&(h.ka=c.ka.slice(0))}else h.description=f.ee.og();return h}return bt(d,x),d.prototype.D=function(c){if(c===void 0){if(this.Ac())throw f.i.fa("This operation should not be performed on an empty geometry.");return(c=new f.h).ma(this.ka[0],this.ka[1]),c}if(this.Ac())throw f.i.fa("This operation should not be performed on an empty geometry.");c.ma(this.ka[0],this.ka[1])},d.prototype.Cb=function(c,o){typeof c=="number"?(this.vc(),this.ka==null&&this.un(),this.ka[0]=c,this.ka[1]=o):(this.vc(),this.Cb(c.x,c.y))},d.prototype.Cz=function(){if(this.Ac())throw f.i.fa("This operation should not be performed on an empty geometry.");var c=new f.Nd;return c.x=this.ka[0],c.y=this.ka[1],c.z=this.description.iG()?this.ka[2]:f.ra.se(1),c},d.prototype.dC=function(c){this.vc();var o=this.hasAttribute(1);o||f.ra.DG(1,c.z)||(this.re(1),o=!0),this.ka==null&&this.un(),this.ka[0]=c.x,this.ka[1]=c.y,o&&(this.ka[2]=c.z)},d.prototype.Lg=function(){if(this.Ac())throw f.i.fa("This operation should not be performed on an empty geometry.");return this.ka[0]},d.prototype.cC=function(c){this.setAttribute(0,0,c)},d.prototype.ih=function(){if(this.Ac())throw f.i.fa("This operation should not be performed on an empty geometry.");return this.ka[1]},d.prototype.aK=function(c){this.setAttribute(0,1,c)},d.prototype.bS=function(){return this.Uc(1,0)},d.prototype.wX=function(c){this.setAttribute(1,0,c)},d.prototype.zR=function(){return this.Uc(2,0)},d.prototype.hX=function(c){this.setAttribute(2,0,c)},d.prototype.Ec=function(){return this.yF(3,0)},d.prototype.LJ=function(c){this.setAttribute(3,0,c)},d.prototype.Uc=function(c,o){var l=this.description.Pf(c);return 0<=l?this.ka[this.description.$j(l)+o]:f.ra.se(c)},d.prototype.yF=function(c,o){var l=this.description.Pf(c);return 0<=l?this.ka[this.description.$j(l)+o]:f.ra.se(c)},d.prototype.setAttribute=function(c,o,l){this.vc();var h=this.description.Pf(c);0>h&&(this.re(c),h=this.description.Pf(c)),this.ka==null&&this.un(),this.ka[this.description.$j(h)+o]=l},d.prototype.getType=function(){return 33},d.prototype.Db=function(){return 0},d.prototype.Oa=function(){this.vc(),this.ka!=null&&(this.ka[0]=NaN,this.ka[1]=NaN)},d.prototype.sn=function(c){if(this.ka!=null){for(var o=f.ee.Iw(c,this.description),l=[],h=0,m=0,g=c.Aa;m<g;m++){var v=c.kd(m),w=f.ra.Va(v);if(o[m]==-1){var E=f.ra.se(v);for(v=0;v<w;v++)l[h]=E,h++}else for(E=this.description.$j(o[m]),v=0;v<w;v++)l[h]=this.ka[E],h++,E++}this.ka=l}this.description=c},d.prototype.un=function(){this.lJ(this.description.Ae.length),d.cE(this.description.Ae,this.ka,this.description.Ae.length),this.ka[0]=NaN,this.ka[1]=NaN},d.prototype.Oc=function(c){if(c instanceof f.Dd){if(!this.Ac()){var o=this.D();c.Eh(o,o),this.Cb(o)}}else this.Ac()||(this.re(1),o=this.Cz(),this.dC(c.fp(o)))},d.prototype.copyTo=function(c){if(c.getType()!=33)throw f.i.N();c.vc(),this.ka==null?(c.Oa(),c.ka=null,c.Nf(this.description)):(c.Nf(this.description),c.lJ(this.description.Ae.length),d.cE(this.ka,c.ka,this.description.Ae.length))},d.prototype.Ia=function(){return new d(this.description)},d.prototype.B=function(){return this.Ac()},d.prototype.Ac=function(){return this.ka==null||isNaN(this.ka[0])||isNaN(this.ka[1])},d.prototype.bn=function(c){c.Oa(),this.description!=c.description&&c.Nf(this.description),c.Zb(this)},d.prototype.A=function(c){this.Ac()?c.Oa():(c.v=this.ka[0],c.G=this.ka[1],c.C=this.ka[0],c.H=this.ka[1])},d.prototype.Qo=function(c){if(this.Ac())c.Oa();else{var o=this.Cz();c.v=o.x,c.G=o.y,c.Ye=o.z,c.C=o.x,c.H=o.y,c.Bg=o.z}},d.prototype.Tg=function(c,o){var l=new f.Nc;return this.Ac()?(l.Oa(),l):(c=this.Uc(c,o),l.oa=c,l.va=c,l)},d.prototype.lJ=function(c){if(this.ka==null)this.ka=f.O.lg(c);else if(this.ka.length<c){for(var o=this.ka.slice(0),l=this.ka.length;l<c;l++)o[l]=0;this.ka=o}},d.cE=function(c,o,l){if(0<l)for(l=0;l<c.length;l++)o[l]=c[l]},d.prototype.Nb=function(c){if(c==this)return!0;if(!(c instanceof d)||this.description!=c.description)return!1;if(this.Ac())return!!c.Ac();for(var o=0,l=this.description.Ae.length;o<l;o++)if(this.ka[o]!=c.ka[o])return!1;return!0},d.prototype.cc=function(){var c=this.description.cc();if(!this.Ac())for(var o=0,l=this.description.Ae.length;o<l;o++){var h=this.ka[o];h=f.O.truncate(h^h>>>32),c=f.O.Th(h,c)}return c},d.prototype.mg=function(){return null},d}(f.aa);f.Sa=L}(Q||(Q={})),function(f){var L=function(){function x(d,c,o){d!==void 0&&(this.x=d,this.y=c,this.z=o)}return x.construct=function(d,c,o){var l=new x;return l.x=d,l.y=c,l.z=o,l},x.prototype.K=function(d,c,o){this.x=d,this.y=c,this.z=o},x.prototype.lx=function(){this.z=this.y=this.x=0},x.prototype.normalize=function(){var d=this.length();d==0&&(this.x/=d,this.y/=d,this.z/=d)},x.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},x.prototype.sub=function(d){return new x(this.x-d.x,this.y-d.y,this.z-d.z)},x.prototype.Ag=function(d){new x(this.x*d,this.y*d,this.z*d)},x.prototype.Qh=function(d){return this.x*d.x+this.y*d.y+this.z*d.z},x}();f.Nd=L}(Q||(Q={})),function(f){var L=function(){function x(d,c,o){this.Gw=this.DA=null,this.Xf=c,this.FT=c.y-o,this.ET=c.y+o,this.Ew=0,this.dA=d,this.qa=o,this.RT=o*o,this.eA=o!=0,this.Lv=!1}return x.prototype.result=function(){return this.Ew!=0?1:0},x.prototype.ZM=function(d){return d=d.hc(d.fe(this.Xf,!1)),f.h.yc(d,this.Xf)<=this.RT},x.prototype.fF=function(d){if(!this.eA&&(this.dA&&this.Xf.qb(d.ac())||this.Xf.qb(d.wc())))this.Lv=!0;else if(d.na==this.Xf.y&&d.na==d.la){if(this.dA&&!this.eA){var c=Math.max(d.sa,d.pa);this.Xf.x>Math.min(d.sa,d.pa)&&this.Xf.x<c&&(this.Lv=!0)}}else{var o=!1;if(c=Math.max(d.sa,d.pa),this.Xf.x>c?o=!0:this.Xf.x>=Math.min(d.sa,d.pa)&&(o=0<d.cq(!0,this.Xf.y,this.Gw,null)&&this.Gw[0]<=this.Xf.x),o){if(this.Xf.y==d.ac().y){if(this.Xf.y<d.wc().y)return}else if(this.Xf.y==d.wc().y&&this.Xf.y<d.ac().y)return;this.Ew=this.dA?1^this.Ew:this.Ew+(d.ac().y>d.wc().y?1:-1)}}},x.prototype.SI=function(d){var c=d.Tg(0,1);if(c.oa>this.ET||c.va<this.FT)return!1;if(this.eA&&this.ZM(d))return!0;if(c.oa>this.Xf.y||c.va<this.Xf.y)return!1;if(this.DA==null&&(this.DA=[null,null,null,null,null]),this.Gw==null&&(this.Gw=[0,0,0]),0<(c=d.eG()))for(d=0;d<c;d++){var o=this.DA[d].get();if(this.fF(o),this.Lv)return!0}else if(this.fF(d),this.Lv)return!0;return!1},x.PM=function(d,c,o){for(c=new x(d.In()==0,c,o),d=d.Ga();d.$a();)for(;d.Ha();)if(o=d.ha(),c.SI(o))return-1;return c.result()},x.QM=function(d,c,o,l){var h=new f.l;d.xc(h),h.W(l,l);var m=new x(d.In()==0,o,l);d=d.Ga();var g=new f.l;for(g.K(h),g.C=o.x+l,g.G=o.y-l,g.H=o.y+l,l=(o=c.MF(g,l)).next();l!=-1;l=o.next())if(d.Vb(c.ja(l)),d.Ha()&&(l=d.ha(),m.SI(l)))return-1;return m.result()},x.wm=function(d,c,o){if(d.B())return 0;var l=new f.l;if(d.xc(l),l.W(o,o),!l.contains(c))return 0;if((l=d.Bb)!=null){var h=l.Fk;if(h!=null){if((h=h.So(c.x,c.y))==1)return 1;if(h==0)return 0}if((l=l.Fb)!=null)return x.QM(d,l,c,o)}return x.PM(d,c,o)},x.bT=function(d,c,o){return c.B()?0:x.wm(d,c.D(),o)},x.Ml=function(d,c){return!(16>(d=d.I()))&&2*d+Math.log(d)/Math.log(2)*c<1*d*c},x}();f.Dg=L}(Q||(Q={})),function(f){var L=function(x){function d(c){return x.call(this,!0,c)||this}return bt(d,x),d.prototype.Ia=function(){return new d(this.description)},d.prototype.Db=function(){return 2},d.prototype.getType=function(){return 1736},d.prototype.xG=function(c,o,l){this.JS(c,o,l)},d.prototype.qR=function(){this.FR()},d}(f.Vk);f.Da=L}(Q||(Q={})),function(f){(function(L){L[L.PiPOutside=0]="PiPOutside",L[L.PiPInside=1]="PiPInside",L[L.PiPBoundary=2]="PiPBoundary"})(f.RL||(f.RL={})),f.hd=function(){function L(){}return L.KG=function(x,d,c){return(x=f.Dg.bT(x,d,c))==0?0:x==1?1:2},L.Yd=function(x,d,c){return(x=f.Dg.wm(x,d,c))==0?0:x==1?1:2},L.WX=function(x,d,c,o,l){if(d.length<c||l.length<c)throw f.i.N();for(var h=0;h<c;h++)l[h]=L.Yd(x,d[h],o)},L.sK=function(x,d,c,o,l){if(x.getType()==1736)L.WX(x,d,c,o,l);else{if(x.getType()!=197)throw f.i.fa("invalid_call");var h=new f.l;x.A(h),L.$M(h,d,c,o,l)}},L.$M=function(x,d,c,o,l){if(d.length<c||l.length<c)throw f.i.N();if(x.B())for(o=0;o<c;o++)l[o]=0;else for(x.W(.5*-o,.5*-o),x.W(.5*o,.5*o),o=0;o<c;o++)x.contains(d[o])?l[o]=1:x.contains(d[o])?l[o]=2:l[o]=0},L.YX=function(x,d,c,o,l){for(var h=0;h<c;h++)l[h]=x.qs(d[h],o)?2:0},L.XX=function(x,d,c,o,l){var h=x.Bb,m=null;h!=null&&(m=h.Fk),h=c;for(var g=0;g<c;g++)if(l[g]=1,m!=null){var v=d[g];m.So(v.x,v.y)==0&&(l[g]=0,h--)}if(h!=0)for(x=x.Ga();x.$a()&&h!=0;)for(;x.Ha()&&h!=0;)for(m=x.ha(),g=0;g<c&&h!=0;g++)l[g]==1&&m.qs(d[g],o)&&(l[g]=2,h--);for(g=0;g<c;g++)l[g]==1&&(l[g]=0)},L.tK=function(x,d,c,o,l){var h=x.getType();if(h==1607)L.XX(x,d,c,o,l);else{if(!f.aa.yd(h))throw f.i.fa("Invalid call.");L.YX(x,d,c,o,l)}},L}()}(Q||(Q={})),function(f){var L=function(x){function d(c,o){if(arguments.length==2){var l=x.call(this,!1,c.description)||this;l.nf(c),l.lineTo(o)}else l=x.call(this,!1,c)||this;return l}return bt(d,x),d.prototype.Ia=function(){return new d(this.description)},d.prototype.Db=function(){return 1},d.prototype.getType=function(){return 1607},d.prototype.xG=function(c,o,l){this.KS(c,o,l)},d}(f.Vk);f.Ta=L}(Q||(Q={})),function(f){var L=function(){function x(){}return x.prototype.progress=function(){return!0},x.zp=function(d){if(d!=null&&!d.progress(-1,-1))throw f.i.WC()},x}();f.mp=L}(Q||(Q={})),function(f){var L;(L=f.PK||(f.PK={}))[L.clipWithInputHorizon=1]="clipWithInputHorizon",L[L.clipWithOutputHorizon=2]="clipWithOutputHorizon";var x=function(){function o(){this.Kg=3,this.Vu=this.Jr=NaN}return o.prototype.PW=function(l){this.QB(1,l)},o.prototype.QW=function(l){this.QB(2,l)},o.prototype.hS=function(){return this.hs(1)},o.prototype.iS=function(){return this.hs(2)},o.prototype.QB=function(l,h){this.Kg=h?this.Kg|l:this.Kg&~l},o.prototype.hs=function(l){return(this.Kg&l)!=0},o.prototype.Of=function(){var l=new o;return l.Jr=this.Jr,l.Vu=this.Vu,l.Kg=this.Kg,l},o}();f.yC=x,function(o){o[o.Dont_Geonomalize_Polygon=2147483648]="Dont_Geonomalize_Polygon",o[o.Dont_Adjust_At_Poles=1073741824]="Dont_Adjust_At_Poles"}(f.QK||(f.QK={}));var d=function(){function o(){this.Kg=0}return o.prototype.QB=function(l,h){this.Kg=h?this.Kg|l:this.Kg&~l},o.prototype.hs=function(l){return(this.Kg&l)!=0},o.jg=function(l){var h=new o;return h.Kg=l.Kg,h},o.prototype.mM=function(l){this.Kg=l.Kg},o}();f.AY=d;var c=function(){function o(l,h,m){this.ef=l,this.Yf=h,this.Uf=new f.l,this.Uf.K(m),this.AT=l.cc()+h.cc()+this.Uf.cc().toString()}return o.prototype.cc=function(){return this.AT},o.prototype.Nb=function(l){return this==l||this.ef.Nb(l.ef)&&this.Yf.Nb(l.Yf)&&this.Uf.Nb(l.Uf)},o}();f.FY=c,c=function(){function o(){this.Yf=this.ef=null,this.rH=new x,this.sH=new d,this.ww=this.Wf=null,this.mw=this.Tn=!0}return o.Nr=function(l,h,m,g){var v;g===void 0&&(g=null),v===void 0&&(v=null);var w=new o;return w.qp(l,h,m,g,v),w},o.prototype.qp=function(l,h,m,g,v){if(l==null||h==null)throw f.i.fa("invalidArgument");if(this.ef=l,this.Yf=h,this.mw=this.Tn=!1,g!=null&&(this.rH=g.Of()),v!=null&&this.sH.mM(v),v=!1,h.Sb()==1&&g!=null&&(g=g.Jr,isNaN(g)||g==0||(v=!0)),l==h)this.Tn=!v,this.mw=!0;else{g=l.Sb();var w=h.Sb();if(g==0||w==0){if(m!=null)throw f.i.N();l.Hd()!=null&&h.Hd()!=null&&(this.Tn=l.Hd().Nb(h.Hd()))}else g==3||w==3?this.Tn=l.Nb(h):this.ef.kS(this.Yf)?this.Tn=!v:this.Tn=!1,this.Wf=m,this.Wf!=null&&this.Wf.ix(),this.mw=(this.Wf==null||this.Wf.count()==0)&&this.ef.sc().Nb(this.Yf.sc())}this.oY()},o.prototype.isIdentity=function(){return this.Tn},o.prototype.nR=function(){return this.rH.Of()},o.prototype.Nb=function(l){return l==this||!!(l instanceof o&&this.ef.Nb(l.ef)&&this.Yf.Nb(l.Yf))&&(this.Wf==l.Wf||!(this.Wf==null||l.Wf==null||!this.Wf.Nb(l.Wf)))},o.prototype.oY=function(){this.ww=new f.bu(this)},o}(),f.vr=c}(Q||(Q={})),function(f){var L=function(){function x(){}return x.Cp=function(d){return d*x.oW},x.mx=function(d,c){return x.gP(c-d)},x.hP=function(d){return-360<=d&&720>d?(0>d?d+=360:360<=d&&(d-=360),d):(0>(d=f.lc.RK(d))&&(d+=360),d)},x.gP=function(d){return 180<(d=x.hP(d))&&(d-=360),d},x.oW=57.29577951308232,x}();f.qr=L,f.Hh=function(){function x(){}return x.lj=function(d,c){var o=new f.l;d.A(o);var l=f.cb.gh(c),h=new f.l;return h.K(l),h.v=o.v,h.C=o.C,h.W(.01*h.ca(),0),c=f.ta.Wd(c,o,!1),h.contains(o)?d:f.Ud.clip(d,h,c,0)},x.ks=function(d,c,o,l,h){if(!f.cb.Wc(c))throw f.i.N();var m=f.ta.kj(c,d,!1),g=f.cb.gh(c),v=f.cb.sc(c),w=v.Hd().ai,E=f.cb.vv(v);v=f.cb.ev(v),E*=2-E;var A=new f.Nc;g.cn(A);var M=[[0,0],[0,0]];if(f.Eg.Sb(c)==2?l?(M[0][0]=x.Zm(h,A),M[0][1]=g.Jp(),f.cb.vt(),g=M[0][0]*w):(M[0][0]=g.gk(),M[0][1]=h,f.cb.vt(),g=M[0][1]*w):g=h*w,!l&&g!=0)throw f.i.N();var I=new f.ga,D=new f.gd;d=D.Ib(d);for(var k=[0],B=new f.h,J=new f.h,Y=new f.h,V=new f.h,te=new f.h,he=new f.h,ue=D.Ob(d);ue!=-1;ue=D.Rb(ue)){var xe=D.Xa(ue);D.D(xe,Y);for(var be=!1,Le=xe=D.U(xe);Le!=-1;Le=D.U(Le)){if(Le==xe){if(be)break;be=!0}if(D.D(Le,V),l&&m<h-Y.x&&V.x-h>m||m<h-V.x&&Y.x-h>m||!l&&m<-Y.y&&V.y>m||m<-V.y&&Y.y>m)do if(!(Math.abs(Y.x-V.x)>=.5*A.R())){if(f.Eg.Sb(c)==2?(M[0][0]=x.Zm(Y.x,A),M[0][1]=Y.y,M[1][0]=x.Zm(V.x,A),M[1][1]=V.y,f.cb.dW(),te.x=M[0][0]*w,te.y=M[0][1]*w,he.x=M[1][0]*w,he.y=M[1][1]*w):(te.x=Y.x*w,te.y=Y.y*w,he.x=V.x*w,he.y=V.y*w),he.x=6.283185307179586*(V.x-Y.x)/A.R()+te.x,l){if(J.x=g,J.y=x.Nz(v,E,te,he,g,o),isNaN(J.y))break}else{if(J.x=x.Lz(v,E,te,he,o),isNaN(J.x))break;J.y=0}f.kb.wd(v,E,te.x,te.y,he.x,he.y,I,null,null,o);var Xe=I.u;f.kb.wd(v,E,te.x,te.y,J.x,J.y,I,null,null,o);var qe=I.u;f.Eg.Sb(c)==2?(M[0][0]=J.x/w,M[0][1]=J.y/w,f.cb.bR(),l?(B.y=M[0][1],B.x=h):(B.x=x.os(M[0][0],Y.x,V.x,A),B.y=h)):l?(B.x=h,B.y=J.y/w):(B.x=x.os(J.x/w,Y.x,V.x,A),B.y=h),k[0]=0<Xe?f.O.Rk(qe/Xe,0,1):.5,k[0]!=0&&k[0]!=1&&(Xe=D.Ma(Le),D.Ul(Xe,k,1),D.Cb(D.U(Xe),B.x,B.y))}while(0);Y.L(V)}}return D.Ne(d)},x.Fn=function(d,c,o,l,h){if(d.B())return d;var m=f.cb.bf(c);return x.Hp(d,o-180*m,360*m,c,l,h,!0)},x.Nz=function(d,c,o,l,h,m){if(3.141592653589793<=Math.abs(o.x-l.x)||!x.Sn(o.x,l.x,h))return NaN;if(o.x>l.x)var g=l;else g=o,o=l;l=new f.ga(0);var v=new f.ga(0),w=new f.ga(0);f.kb.wd(d,c,g.x,g.y,o.x,o.y,v,l,null,m);var E=v.u,A=0,M=1,I=new f.h;for(I.L(g);E*(M-A)>1e-12*d;){var D=.5*(A+M);if(f.kb.oj(d,c,g.x,g.y,E*D,l.u,v,w,m),I.x=v.u,I.y=w.u,I.x==h)break;if(x.Sn(g.x,I.x,h))M=D;else{if(!x.Sn(o.x,I.x,h))return NaN;A=D}}return I.y},x.Sn=function(d,c,o){return d=L.Cp(d),c=L.mx(d,L.Cp(c)),(o=L.mx(d,L.Cp(o)))==0||0<c&&0<o&&o<=c||0>c&&0>o&&o>=c},x.Zm=function(d,c){var o=c.va-c.oa;return c.It(d-Math.floor((d-c.oa)/o)*o)},x.os=function(d,c,o,l){var h=new f.Nc;for(h.K(c,o),o=l.R(),d=Math.floor((d-c)/o)*o+d,h=h.sf();Math.abs(d-h)>Math.abs(d+o-h);)d+=o;return d},x.Lz=function(d,c,o,l,h){if(o.y>l.y)var m=l;else m=o,o=l;if((l=new f.Nc).K(m.y,o.y),!l.contains(0)||3.141592653589793<=Math.abs(m.x-o.x))return NaN;if(m.x==o.x)return m.x;var g=new f.ga(0),v=new f.ga(0),w=new f.ga(0);f.kb.wd(d,c,m.x,m.y,o.x,o.y,v,g,null,h);var E=v.u,A=0,M=1,I=new f.h;for(I.L(m);E*(M-A)>1e-12*d;){var D=.5*(A+M);if(f.kb.oj(d,c,m.x,m.y,E*D,g.u,v,w,h),I.x=v.u,I.y=w.u,l.K(m.y,I.y),I.y==0)break;if(l.contains(0))M=D;else{if(l.K(o.y,I.y),!l.contains(0))return NaN;A=D}}return I.x},x.Hp=function(d,c,o,l,h,m,g){var v=new f.l;if(d.A(v),v.B())return d;var w=new f.Nc;v.cn(w);var E=new f.Nc;if(E.K(c,c+o),E.contains(w)&&E.va!=w.va)return d;var A=new f.l;A.K(v);var M=d.getType();if(M==33)return((v=(A=h?d:d.Of()).Lg())<E.oa||v>=E.va||g&&v==E.va)&&(v+=Math.ceil((E.oa-v)/o)*o,v=E.It(v),A.cC(v)),A;if(M==550){for(l=(A=h?d:d.Of()).ub(0),M=2*A.I(),d=!1,h=0;h<M;h+=2)((v=l.read(h))<E.oa||v>=E.va||g&&v==E.va)&&(d=!0,v+=Math.ceil((E.oa-v)/o)*o,v=E.It(v),l.write(h,v));return d&&A.Pc(1993),A}if(E.contains(w))return d;if(M==197)return o=h?d:d.Of(),v.Ea(A),o.Xo(v),o;var I=.1*Math.max(v.ca(),v.R());for(A.W(0,I),g=d,E=l.Xd(0),d=f.Gh.local(),h=new f.Dd;;){var D=Math.floor((w.oa-c)/o),k=Math.ceil((w.va-c)/o);if(!(3<k-D))break;D=Math.floor(.5*(k+D)),A.v=v.v-I,A.C=c+o*D;var B=f.Ud.clip(g,A,E,m);A.v=A.C,A.C=v.C+I;var J=f.Ud.clip(g,A,E,m);h.gg((D-k)*o,0),J.Oc(h),M==1736?g=d.V(B,J,l,null):(g=B).add(J,!1),g.A(v),v.cn(w)}for(A.v=c,A.C=c+o,(c=new f.l).K(A),c.W(E,0),(c=Math.floor((v.v-A.v)/o)*o)!=0?(A.move(c,0),h.gg(-c,0)):h.RB(),c=M==1607?new f.Ta(g.description):new f.Da(g.description),m=new f.l,w=new f.l;v.C>A.v;)(I=f.Ud.clip(g,A,E,0)).A(w),(M==1607?!I.B()&&(w.R()>E||w.ca()>E):!I.B()&&(M!=1736||w.R()>E))&&(I.Oc(h),I.A(w),c.A(m),m.W(E,E),m.isIntersecting(w)&&M==1736?c=d.V(c,I,l,null):c.add(I,!1)),A.move(o,0),h.shift(-o,0);return c},x.WI=function(d,c,o,l){var h=new f.de(o.description);h.Fd(o,0,-1),h=f.cb.zh(h,d,c);var m=o.I();if(l.Oa(),!f.cb.Wc(d)||m!=h.I())return!1;var g=new f.l;o.A(g);var v=new f.l;if(h.A(v),g=g.R(),v=v.R(),g!=0&&v!=0){if(v/=g,d=f.cb.gh(c).R()/f.cb.gh(d).R(),1e-10<Math.abs(v/d-1))return!1}else if(g!=0||v!=0)return!1;for(l.add(o,!1),o=0;o<m;o++)d=h.Na(o),l.Cb(o,d);return!0},x.Oz=function(){throw f.i.Ie()},x}()}(Q||(Q={})),function(f){var L,x,d;(x=L=f.si||(f.si={}))[x.Clip=0]="Clip",x[x.DontClip=1]="DontClip",x[x.PannableFold=2]="PannableFold",function(c){c[c.Geodesic=0]="Geodesic",c[c.Loxodrome=1]="Loxodrome",c[c.GreatElliptic=2]="GreatElliptic",c[c.NormalSection=3]="NormalSection",c[c.ShapePreserving=4]="ShapePreserving"}(d=f.WK||(f.WK={})),f.zb=function(){function c(){}return c.xv=function(o,l,h){if(h||0<l){for(o=o.toString(f.Sc.PE_STR_NAME_CANON|f.Sc.PE_STR_AUTH_NONE),l=[],h=0;h<o.length;h++)l[h]="a"<=o[h]&&"z">=o[h]?l[h]=o[h].toUpperCase():o[h];return l.join()}return o.toString(f.Sc.PE_STR_AUTH_TOP)},c.ur=function(o,l,h,m){var g=m.length,v=h.I();if(v!=0){var w=h.ub(0),E=Math.min(v,g),A=0,M=o.eh();isNaN(l)&&(l=0);for(var I=o.Wc(),D=179*(o=I?o.sc().Oe().R():0)/360;0<v;){if(w.uB(A<<1,E,m),f.ej.projToGeogCenter(M,E,m,l),I)for(var k=0;k<E;k++){var B=m[k][0]-l,J=f.lc.sign(B),Y=w.read(2*(A+k));0>J*f.lc.sign(Y)&&Math.abs(B)>D&&(m[k][0]+=-J*o)}w.uC(A<<1,E,m),A+=E,v-=E,E=Math.min(v,g)}h.Pc(1993)}},c.IL=function(o,l,h,m){var g=0,v=o.eh();isNaN(g)&&(g=0);var w=o.Wc(),E=o.bf();o=360*E,E*=179;for(var A=m.length,M=0;M<h;){for(var I=M;I<h&&l[I].isNaN();++I)M++;var D=Math.min(A,h-M);if(0<D){I=1;for(var k=M+1;I<D;++I,++k)if(l[k].isNaN()){D=I;break}if(f.ta.Jy(m,l,M,D),f.ej.projToGeogCenter(v,D,m,g),w)for(I=0,k=M;I<D;++I,++k){var B=l[k].x,J=m[I][0]-g,Y=f.lc.sign(J);0>Y*f.lc.sign(B)&&Math.abs(J)>E&&(m[I][0]-=Y*o)}f.ta.Iy(l,M,m,D),M+=D}}},c.Lx=function(o,l,h){var m=h.length,g=l.I();if(!(1>g)){var v=l.ub(0),w=Math.min(g,m),E=0,A=o.eh(),M=o.Wc(),I=M?o.Oe().R():0,D=179*I/360,k=0;for(M&&(k=o.zi());0<g;){if(v.uB(E<<1,w,h),f.ej.geogToProj(A,w,h),M)for(o=0;o<w;o++){var B=h[o][0],J=f.lc.sign(B),Y=v.read(2*(E+o))-k;0>J*f.lc.sign(Y)&&Math.abs(B)>D&&(h[o][0]+=-J*I)}v.uC(E<<1,w,h),E+=w,g-=w,w=Math.min(g,m)}l.Pc(1993)}},c.HL=function(o,l,h,m){if(h!=0){var g=o.eh(),v=o.Wc(),w=v?o.Oe().R():0,E=179*w/360,A=0;for(v&&(A=o.zi()),o=0;o<h;){for(var M=o;M<h&&l[M].isNaN();++M)o++;var I=Math.min(m.length,h-o);if(0<I){M=1;for(var D=o+1;M<I;++M,++D)if(l[D].isNaN()){I=M;break}if(f.ta.Jy(m,l,o,I),f.ej.geogToProj(g,I,m),v)for(M=0,D=o;M<I;M++){var k=m[M][0],B=f.lc.sign(k);0>B*f.lc.sign(l[D].x-A)&&Math.abs(k)>E&&(m[M][0]-=B*w)}f.ta.Iy(l,o,m,I),o+=I}}}},c.tr=function(o,l,h,m){var g=l.I();if(g!=0){var v=l.ub(0),w=o.ef,E=o.Yf,A=w.sc().Qp(),M=E.sc().Qp(),I=w.bf(),D=E.bf();if((o=o.Wf)==null||o.count()==0){for(h=A/M,m=(w.Up()-E.Up())*D,M=-90*I,o=90*I,A=!1,D=1,w=2*g;D<w;)I=v.get(D),(E=f.O.Rk(I,M,o))!=I&&(v.set(D,E),A=!0),D+=2;if(m!=0||h!=1)for(A=!0,M=new f.h,D=0;D<g;D++)v.tc(2*D,M),M.x*=h,M.x+=m,M.y*=h,v.Tt(2*D,M);A&&l.Pc(1993)}else{w=m.length,E=Math.min(g,w);var k=f.O.lg(E),B=null,J=0,Y=NaN,V=NaN,te=360*D,he=D/I;h&&(V=90*D,Y=89.9*I,B=f.O.lg(E));for(var ue=!0,xe=0;g!=0;){for(I=!1,v.uB(J<<1,E,m),D=0;D<E;D++)k[D]=m[D][0];if(h)for(D=0;D<E;D++){var be=Math.abs(m[D][1])-Y;0<be&&(I=m[D][1],m[D][1]=f.lc.Cn(Y,I),B[D]=f.lc.Cn(be,I),I=!0)}for(D=m[0][0],o.transform(m,E,A,M),ue&&(xe=m[0][0]-he*D,ue=!1),D=0;D<E;D++)be=m[D][0]-k[D]*he-xe,200<Math.abs(be)&&(m[D][0]=0<be?m[D][0]-te:m[D][0]+te);if(I){for(D=0;D<E;D++)B[D]!=0&&(m[D][1]+=he*B[D],m[D][1]>V?m[D][1]=V:m[D][1]<-V&&(m[D][1]=-V));for(I=0;I<E;I++)B[I]=0}v.uC(J<<1,E,m),J+=E,g-=E,E=Math.min(g,w)}l.Pc(1993)}}},c.GL=function(o,l,h,m){if(o.mw)m=90*o.ef.bf(),f.ta.dK(l,h,-m,m);else{var g=o.Wf,v=o.ef,w=o.Yf;o=v.Xr();var E=w.Xr(),A=v.bf(),M=90*A,I=w.bf();if(g==null||g.count()==0){if(m=o/E,g=(v.Up()-w.Up())*I,f.ta.dK(l,h,-M,M),g!=0||m!=1)for(I=0;I<h;I++)l[I].x*=m,l[I].x+=g,l[I].y*=m}else{v=Math.min(h,m.length),M=f.O.lg(v),w=360*I,A=I/A;for(var D=!0,k=0,B=0;h!=0;){for(I=0;I<v;I++)M[I]=l[I+B].x;for(I=l[0].x,f.ta.Jy(m,l,B,v),g.transform(m,v,o,E),f.ta.Iy(l,B,m,v),D&&(k=l[0].x-A*I,D=!1),I=0;I<v;I++){var J=l[B+I].x-M[I]*A-k;200<Math.abs(J)&&(l[B+I].x=0<J?l[B+I].x-w:l[B+I].x+w)}B+=v,h-=v,v=Math.min(h,m.length)}}}},c.dv=function(o,l){return o=o.gh(),isNaN(l)||o.Ju(l,0),o},c.UQ=function(o,l,h,m,g,v,w,E){for(var A=c.dv(m,g),M=A.R(),I=M/360,D=c.pE*I,k=o.ub(0),B=l.Wc(),J=B?M/l.Oe().R():0,Y=!1,V=new f.Da(h.description),te=0,he=h.da();te<he;++te){var ue=B,xe=new f.Ta(h.description);if(xe.addPath(h,te,!0),w!=0){var be=c.PD(!0,xe,A.H-E,A.H,w);(Y=Y||be)&&(ue=!1)}var Le=-1;ue&&(Le=o.Ba(te));var Xe=xe.ub(0),qe=xe.I(),xt=0,it=Xe.read(0),hi=0;be=3*m.Xd(0);var ai=!1,yt=new f.h;yt.Rc();var Or=new f.h;Or.Rc();for(var xn=!1,Pr=1;Pr<qe;++Pr){var Ri=f.h.construct(Xe.eg(2*Pr),Xe.eg(2*Pr+1)),Vi=Ri.x,Ei=Vi+xt,Ki=Ei-it;if(Ri.x=Ei,Math.abs(Ki)>D){if(ue){var bi=Le+(Pr+1<qe?Pr:0),uo=k.read(2*(Le+Pr-1));bi=(k.read(2*bi)-uo)*J,Math.abs(Ki-bi)>1*I&&(ue=!1)}ue||(Ei=Vi+(xt-=f.lc.Cn(M,Ei-it)),++hi,xn=xt!=0,Ri.x=Ei)}else ai||f.ta.AG(Or,yt,Ri,be)&&(ai=!0);xn&&Xe.write(2*Pr,Ei),it=Ei,Or.L(yt),yt.L(Ri)}0<hi&&xe.Pc(1993),ue=xe.Na(0),qe=xe.Na(qe-1),xe=f.h.tb(ue,qe)<be?c.uQ(xe,m,g,v,ai):c.vQ(o,te,xe,m,g),V.add(xe,!1)}return g=m.Xd(0),h=A.R()/180,c.Jt(V,A,.1*g,!1),V=V!=(g=f.ri.clip(V,A,g,h,v)),o=o.Ke(),w=0,0<(E=g.Ke())&&0>o?w=1:0>=E&&0<o&&(E==0?(E=NaN,l.Sb()==2?E=l.ml().Ke():l.Sb()==1&&(E=l.Oe().wF()),o>.99*E&&(w=-1)):w=-1),w!=0&&((l=new f.Da(g.description)).tp(A),(l=f.Xl.local().V(l,h,v)).add(g,!1),V=!0,g=l),V&&(g=f.Yl.local().V(g,m,!1,v)),g},c.vQ=function(o,l,h,m,g){var v=h.I(),w=h.Na(0),E=h.Na(v-1);g=(m=c.dv(m,g)).R(),w=f.lc.sign(E.x-w.x);var A=new f.l;h.xc(A);var M=m.gk();if(E=M-g,M+=g,0<=w){var I=Math.ceil((E-A.v)/g);for(I*=g;E>A.v+I;)I+=g;for(;E<A.C+I;)I-=g;var D=I;720<A.R()&&(M=E+360*Math.ceil(A.R()/360))}else{for(I=Math.ceil((M-A.C)/g),I*=g;M<A.C+I;)I-=g;for(;M>A.v+I;)I+=g;D=I,720<A.R()&&(E=M-360*Math.ceil(A.R()/360))}I=w*g;var k=f.l.construct(A.v,A.G,A.C,A.H);k.move(D,0);var B=new f.Dd;B.gg(D,0),h.Oc(B),(A=new f.Ta(h.description)).add(h,!1),D=h.Na(v-1),g=0;for(var J=A.Na(0).x,Y=0;0<w?k.C<M:k.v>E;)1024<=Y&&(Y=0),k.move(I,0),B.Gb=I,h.Oc(B),J+=I,m.v<=J&&m.C>=J&&(g=A.I()-1),h.Cb(0,D),D=h.Na(v-1),A.Dr(h,0,0,v-1,!1);return h=new f.Da(A.description),v=0<o.Ir(l),h.add(A,!1),o=A.Na(0),E=A.Na(A.I()-1),l=h.da()-1,(0>w?v:!v)?(w=f.h.construct(E.x,m.H),h.Ci(w),w=f.h.construct(m.gk(),m.H),h.Ci(w),m=f.h.construct(o.x,m.H)):(w=f.h.construct(E.x,m.G),h.Ci(w),w=f.h.construct(m.gk(),m.G),h.Ci(w),m=f.h.construct(o.x,m.G)),h.Ci(m),h.xG(0,l,0),h.kO(g),h},c.uQ=function(o,l,h,m,g){var v=new f.Da(o.description);v.add(o,!1),v.DB(0,v.I()-1);var w=new f.l;v.xc(w);var E=(h=c.dv(l,h)).R(),A=Math.ceil((h.v-w.v)/E);for(A*=E;h.v>w.v+A;)A+=E;for(;h.v<w.C+A;)A-=E;if((A+=E)!=0){w.move(A,0);var M=new f.Dd;M.gg(A,0),v.Oc(M)}if(h.v<=w.v&&h.C>w.C)return g&&(g=v.Ke(),l=(v=f.Yl.local().V(v,l,!0,m)).Ke(),(l=f.lc.sign(g)!=f.lc.sign(l))&&v.oJ()),v;for((o=new f.Da(o.description)).add(v,!1),g=g||w.R()>E-l.Xd(0);w.v<h.C;)w.move(E,0),(M=new f.Dd).gg(E,0),v.Oc(M),o.add(v,!1);return g&&(g=o.Ke(),o.Yo(1),l=(o=f.Yl.local().V(o,l,!0,m)).Ke(),(l=f.lc.sign(g)!=f.lc.sign(l))&&o.oJ()),o},c.PD=function(o,l,h,m,g){for(var v=l.ub(0),w=l.I(),E=!1,A=0;A<w;A++){var M=f.h.construct(v.eg(2*A),v.eg(2*A+1));if(1&g&&M.y>=h){E=!0;break}if(2&g&&M.y<=-h){E=!0;break}}if(!E)return!1;v=!1,o&&(v=l.Nn(0)),w=(o=new f.gd).Ib(l),E=o.Ob(w);var I=-1,D=!0,k=new f.h;k.Rc(),A=new f.Sa;for(var B=-1,J=o.Xa(E);J!=-1;J=o.U(J)){M=o.Na(J);var Y=1&g&&90<=M.y?1:0;if(Y|=2&g&&M.y<=-h?2:0,0<I&&I!=Y){if(k.x!=M.x){k.x=M.x,o.Vi(o.Ma(J),A);var V=o.wj(E,J,A);o.mf(V,k)}if(v)for(B=B!=-1?o.U(B):o.Xa(E),V=o.Ma(J);B!=V;)B=o.pd(B,!1);B=-1}0<Y&&(M.y=f.lc.Cn(m,M.y),o.mf(J,M),D||I==Y||(M.x!=k.x?(o.Vi(J,A),V=o.wj(E,J,A),o.Cb(V,k.x,M.y),B=V):B=J)),I=Y,k=M,D=!1}if(v){if(B!=-1)for(B=o.U(B);B!=-1;)B=o.pd(B,!1);h=o.Xa(E),o.fq(h,o.rj(E))||(o.Vi(h,A),o.wj(E,-1,A))}return o.Ne(w).copyTo(l),!0},c.Mz=function(o,l,h,m){var g=o;if(g.B()||h==L.DontClip)return g;var v=g.getType();if(v==33)return g=[(m=g).D()],c.yG(g,1,l,h),g[0].isNaN()?m.Oa():m.Cb(g[0]),o;var w=(o=l.sc()).bf(),E=90*w,A=180*w,M=360*w,I=l.zi(),D=.5*w,k=new f.l;g.A(k);var B=l.Vr(),J=l.PQ(),Y=B.getType()==197;if(l=new f.l,B.A(l),h==L.PannableFold&&(h=o.Oe().R(),l.v=I-.5*h,l.C=l.v+h),k.G<-E||k.H>E){if(new f.l().K(k.v-w,-E,k.C+w,E),(g=f.ri.Nu(g,l,o,NaN,0,m)).B())return g;g.A(k)}if(J&&(l.H<k.G||l.G>k.H))return g.Ia();if(k.R()>M&&(g=c.Hp(g,I-A,M,o,!0,0,!0,m)).A(k),(E=c.eO(k.v,k.C,l.v,l.C,M))!=0&&k.move(E,0),k.C>l.C||k.v<l.v){if(k.C>l.C)for(;k.v>=l.C;)k.move(-M,0),E-=M;for(;k.v<l.C-M;)k.move(M,0),E+=M}if(h=f.ta.Hu(o,B),E!=0&&((w=new f.Dd).gg(E,0),g.Oc(w)),J){if(Y&&l.contains(k))return g;for(J=[null,null],E=0;2>E;E++){if(Y?w=f.aa.Hc(v)?f.ri.clip(g,l,h,D,m):f.ri.clip(g,l,h,0,m):(w=f.Xj.local().V(g,B,o,m))==B&&(w=f.aa.jg(w)),l.v<=k.v&&l.C>=k.C||l.v>=k.v&&l.C<=k.C)return w;J[E]=w,E==0&&(k.move(-M,0),(w=new f.Dd).gg(-M,0),g.Oc(w))}if(v==550)J[0].Fd(J[1],0,-1);else if(f.aa.Hc(v))J[0].add(J[1],!1);else{if(v!=33)throw f.i.fa("intersect_with_GCS_horizon: unexpected geometry type");J[0].B()&&(J[0]=J[1])}return J[0]}if(l.H<k.G||l.G>k.H)return g;for(v=0;!g.B()&&k.C>l.v;)v!=0&&((w=new f.Dd).gg(v,0),g.Oc(w)),f.dj.local().V(4,g,B,o,m)||B==(g=f.kp.local().V(g,B,o,m))&&(g=f.aa.jg(g)),v!=0&&((D=new f.Dd).gg(-v,0),g.Oc(D)),v-=M,k.move(-M,0);return g},c.yG=function(o,l,h,m){if(l!=0&&m!=L.DontClip)if(m==L.PannableFold){m=h.HR();for(var g=l,v=0;v<l;v++)(o[v].y>m.H||o[v].y<m.G)&&(o[v].Rc(),g--);g!=0&&c.av(o,l,m.v,m.R())}else{var w=90*(m=h.bf()),E=180*m;for(m*=360,g=l,v=0;v<l;v++)(o[v].y>w||o[v].y<-w)&&(o[v].Rc(),g--);if(g!=0){(g=new f.l).Zw(o,l),w=h.Vr();var A=h.hv();v=w.getType()==197;var M=new f.l;if(w.A(M),!A||!(M.H<g.G||M.G>g.H))if(A)if(c.av(o,l,M.gk()-E,m),g=l,v)for(v=0;v<l;v++)M.contains(o[v])||(o[v].Rc(),g--);else for(h=f.ta.Hu(h.sc(),w),v=0;v<l;v++)(E=f.hd.Yd(w,o[v],h)!=0)||(o[v].Rc(),g--);else for(c.av(o,l,-E,m),g=l,h=f.ta.Hu(h.sc(),w),v=0;v<l;v++)(E=o[v]).isNaN()&&g--,A=c.tE(E.x,M.v,M.C,m),E.x+=A,(E=f.hd.Yd(w,E,h)!=0)&&(o[v].Rc(),g--)}}},c.Hp=function(o,l,h,m,g,v,w,E){var A=o.getType(),M=l+h;if(A===33){var I=(m=g?o:o.Of()).Lg();return(I<l||I>=M||w&&I==M)&&(I+=Math.ceil((l-I)/h)*h,I=f.O.Rk(I,l,M),m.cC(I)),m}if(o.B()||(I=new f.l,o.A(I),I.B()))return o;var D=new f.Nc;I.cn(D);var k=new f.Nc;if(k.K(l,M),k.contains(D))return o;if((M=new f.l).K(I),A===550){for(E=(m=g?o:o.Of()).ub(0),A=2*m.I(),M=!1,l=0;l<A;l+=2)((I=E.read(l))<k.oa||I>=k.va||w&&I==k.va)&&(M=!0,I+=Math.ceil((k.oa-I)/h)*h,I=k.It(I),E.write(l,I));return M&&m.Pc(1993),m}if(A==197)return h=g?o:o.Of(),I.Ea(M),h.Xo(I),h;var B=.1*Math.max(I.ca(),I.R());for(M.W(0,B),w=o,k=m.Xd(0),o=f.Gh.local(),g=new f.Dd;;){var J=Math.floor((D.oa-l)/h),Y=Math.ceil((D.va-l)/h);if(!(3<Y-J))break;J=Math.floor(.5*(Y+J)),M.v=I.v-B,M.C=l+h*J;var V=f.ri.clip(w,M,k,v,E);M.v=M.C,M.C=I.C+B;var te=f.ri.clip(w,M,k,v,E);g.gg((J-Y)*h,0),te.Oc(g),A==1736?w=o.V(V,te,m,null):(w=V).add(te,!1),w.A(I),I.cn(D)}for(M.v=l,M.C=l+h,(l=new f.l).K(M),l.W(k,0),(l=Math.floor((I.v-M.v)/h)*h)!=0?(M.move(l,0),g.gg(-l,0)):g.RB(),l=A==1607?new f.Ta(w.description):new f.Da(w.description),v=new f.l,D=new f.l;I.C>M.v;)(B=f.ri.clip(w,M,k,0,E)).A(D),(A==1607?!B.B()&&(D.R()>k||D.ca()>k):!B.B()&&(A!=1736||D.R()>k))&&(B.Oc(g),B.A(D),l.A(v),v.W(k,k),v.isIntersecting(D)&&A==1736?l=o.V(l,B,m,null):l.add(B,!1)),M.move(h,0),g.shift(-h,0);return l},c.av=function(o,l,h,m){for(var g=h+m,v=0;v<l;v++){var w=o[v].x;h<=w&&w<g||!(w<h||w>g||w==g)||(w+=Math.ceil((h-w)/m)*m,w=f.O.Rk(w,h,g),o[v].x=w)}},c.Fn=function(o,l,h,m,g,v){if(!l.Wc())throw f.i.fa("fold_into_360_degree_range");if(o.B())return o;if(l.Sb()==2){h=l.pv();var w=l.ov()-h}else{var E=l.bf();w=360*E,h-=180*E}return c.Hp(o,h,w,l,m,g,!0,v)},c.qF=function(o,l,h,m){if(h.Sb()==2)m=h.pv(),h=h.ov()-m;else{var g=h.bf();h=360*g,m-=180*g}c.av(o,l,m,h)},c.lj=function(o,l){var h=l.Oe();if(o.getType()==33){var m=o.ih();return h.G<=m&&m<=h.H?o:o.Ia()}m=new f.l,o.A(m);var g=new f.l;return g.K(h),g.v=m.v,g.C=m.C,g.W(.01*g.ca(),0),h=f.ta.uy(l,m),g.contains(m)?o:f.ri.clip(o,g,h,0,null)},c.ir=function(o,l,h){return o>l.C&&o-l.C<h?l.C:o<l.v&&l.v-o<h?l.v:o},c.FX=function(o,l,h,m){m.x=c.ir(o.x,l,h),m.y=o.y},c.EX=function(o,l,h,m){for(var g=0;g<l;g++)o[g].y<h.G||o[g].y>h.H?o[g].Rc():o[g].x=c.ir(o[g].x,h,m)},c.Jt=function(o,l,h,m){if(!o.B()){var g=o.getType();if(!m||g!=1736)if(f.aa.xj(g)){m=o.ub(0),g=0;for(var v=o.I();g<v;g++){var w=m.read(2*g),E=c.ir(w,l,h);E!=w&&m.write(2*g,E)}o.Pc(1993)}else if(g==197)m=new f.l,o.A(m),m.v=c.ir(m.v,l,h),m.C=c.ir(m.C,l,h),o.Xo(m);else{if(g!=33)throw f.i.fa("internal error");o.cC(c.ir(o.Lg(),l,h))}}},c.uS=function(o,l,h,m){var g=new f.gd,v=g.Ib(o);return o=f.ta.Hu(l,o),c.ks(g,v,l,o,h,!0,m),g.Ne(v)},c.ks=function(o,l,h,m,g,v,w){if(!h.Wc())throw f.i.N("invalid call");var E=h.Oe(),A=h.sc(),M=A.eh().getDatum().getSpheroid();A=A.Hd().ai;var I=M.getFlattening();M=M.getAxis(),I*=2-I;var D=new f.Nc;E.cn(D);var k=null,B=[[0,0],[0,0]];if(h.Sb()==2?(k=h.eh(),v?(B[0][0]=c.Zm(w,D),B[0][1]=E.Jp(),f.ej.projToGeog(k,1,B),E=B[0][0]*A):(B[0][0]=E.gk(),B[0][1]=w,f.ej.projToGeog(k,1,B),E=B[0][1]*A)):E=w*A,!v&&E!=0&&g!=d.GreatElliptic)throw f.i.fa("invalid argument");var J=new f.ga,Y=[0],V=new f.h,te=new f.h,he=new f.h,ue=[null,null],xe=new f.h,be=new f.h,Le=new f.h,Xe=new f.h;for(l=o.Ob(l);l!=-1;l=o.Rb(l)){var qe=o.Xa(l);o.D(qe,xe);for(var xt=!1,it=qe=o.U(qe);it!=-1;it=o.U(it)){if(it==qe){if(xt)break;xt=!0}if(o.D(it,be),v&&(m<w-xe.x&&be.x-w>m||m<w-be.x&&xe.x-w>m)||!v&&(w!=0||m<-xe.y&&be.y>m||m<-be.y&&xe.y>m))do if(!(Math.abs(xe.x-be.x)>=.5*D.R())){if(h.Sb()==2?(B[0][0]=c.Zm(xe.x,D),B[0][1]=xe.y,B[1][0]=c.Zm(be.x,D),B[1][1]=be.y,f.ej.projToGeogCenter(k,2,B,0),Le.x=B[0][0]*A,Le.y=B[0][1]*A,Xe.y=B[1][1]*A):(Le.x=xe.x*A,Le.y=xe.y*A,Xe.y=be.y*A),Xe.x=2*(be.x-xe.x)*Math.PI/D.R()+Le.x,v){if(te.x=E,te.y=c.Nz(M,I,Le,Xe,E,g),isNaN(te.y))break;ue[0]=te;var hi=1}else if(g==d.GreatElliptic){var ai=[0,0];if((hi=f.Ox.Oz(I,Le,Xe,E,ai))==0)break;te.x=ai[0],te.y=E,ue[0]=te,hi==2&&(he.x=ai[1],he.y=E,ue[1]=he)}else{if(te.x=c.Lz(M,I,Le,Xe,g),isNaN(te.x))break;te.y=0,ue[0]=te,hi=1}var yt=-1;for(ai=0;ai<hi;ai++){f.kb.wd(M,I,Le.x,Le.y,Xe.x,Xe.y,J,null,null,g);var Or=J.u;f.kb.wd(M,I,Le.x,Le.y,ue[ai].x,ue[ai].y,J,null,null,g);var xn=J.u;if(h.Sb()==2?(B[0][0]=ue[ai].x/A,B[0][1]=ue[ai].y/A,f.ej.geogToProj(k,1,B),v?(V.y=B[0][1],V.x=w):(V.x=c.os(B[0][0],xe.x,be.x,D),V.y=w)):v?(V.x=w,V.y=ue[ai].y/A):(V.x=c.os(ue[ai].x/A,xe.x,be.x,D),V.y=w),Y[0]=0<Or?f.O.Rk(xn/Or,0,1):.5,Y[0]==0||Y[0]==1)break;yt>Y[0]||(yt=o.Ma(it),o.Ul(yt,Y,1),o.Cb(o.U(yt),V.x,V.y),yt=Y[0])}}while(0);xe.L(be)}}},c.Zm=function(o,l){var h=l.va-l.oa;return l.It(o-Math.floor((o-l.oa)/h)*h)},c.os=function(o,l,h,m){var g=new f.Nc;for(g.K(l,h),h=m.R(),o=Math.floor((o-l)/h)*h+o,g=g.sf();Math.abs(o-g)>Math.abs(o+h-g);)o+=h;return o},c.Sn=function(o,l,h){return o=f.qr.Cp(o),l=f.qr.mx(o,f.qr.Cp(l)),(h=f.qr.mx(o,f.qr.Cp(h)))==0||0<l&&0<h&&h<=l||0>l&&0>h&&h>=l},c.Nz=function(o,l,h,m,g,v){if(v==d.GreatElliptic)return f.Ox.SS(l,h,m,g);if(Math.abs(h.x-m.x)>=Math.PI||!c.Sn(h.x,m.x,g))return NaN;if(h.x>m.x)var w=m;else w=h,h=m;m=new f.ga;var E=new f.ga,A=new f.ga;f.kb.wd(o,l,w.x,w.y,h.x,h.y,E,m,null,v);var M=E.u,I=0,D=1,k=new f.h;for(k.L(w);M*(D-I)>1e-12*o;){var B=.5*(I+D);if(f.kb.oj(o,l,w.x,w.y,M*B,m.u,E,A,v),k.x=E.u,k.y=A.u,k.x==g)break;if(c.Sn(w.x,k.x,g))D=B;else{if(!c.Sn(h.x,k.x,g))return NaN;I=B}}return k.y},c.Lz=function(o,l,h,m,g){if(g==d.GreatElliptic)return o=[0,0],f.Ox.Oz(l,h,m,0,o),o[0];if(h.y>m.y)var v=m;else v=h,h=m;if((m=new f.Nc).K(v.y,h.y),!m.contains(0)||Math.abs(v.x-h.x)>=Math.PI)return NaN;if(v.x==h.x)return v.x;var w=new f.ga,E=new f.ga,A=new f.ga;f.kb.wd(o,l,v.x,v.y,h.x,h.y,E,w,null,g);var M=E.u,I=0,D=1,k=new f.h;for(k.L(v);M*(D-I)>1e-12*o;){var B=.5*(I+D);if(f.kb.oj(o,l,v.x,v.y,M*B,w.u,E,A,g),k.x=E.u,k.y=A.u,m.K(v.y,k.y),k.y==0)break;if(m.contains(0))D=B;else{if(m.K(h.y,k.y),!m.contains(0))return NaN;I=B}}return k.x},c.WI=function(o,l,h,m){if(!o.ef.Wc())return!1;var g=new f.de(l.description);if(g.Fd(l,0,-1),m=f.Hx.local().V(g,o,m),g=l.I(),h.Oa(),g!=m.I())return!1;var v=new f.l;l.A(v);var w=new f.l;if(m.A(w),v=v.R(),w=w.R(),v!=0&&w!=0){if(w/=v,o=o.Yf.gh().R()/o.ef.gh().R(),1e-10<Math.abs(w/o-1))return!1}else if(v!=0||w!=0)return!1;for(h.add(l,!1),l=new f.h,o=0;o<g;o++)m.D(o,l),h.Cb(o,l);return!0},c.qN=function(o,l){return(o%=360*l)>=180*l&&(o-=360*l),o},c.UI=function(o,l,h,m){if(h==L.Clip){var g=l.ml();g.getType()==197?(h=new f.l,g.A(h),g=f.ta.uy(l,h),o=f.ri.clip(o,h,g,5e4*l.pm(),m)):f.dj.local().V(1,g,o,l,m)||(o=f.Xj.local().V(o,g,l,m))==g&&(o=f.Vk.jg(o))}else l.Wc()&&(m=new f.l,o.xc(m),l.Oe().contains(m)||(c.Jt(o,l.Oe(),l.Xd(0),!0),h==L.PannableFold&&(o=c.lj(o,l)),o=c.Fn(o,l,0,!0,1e5*l.pm(),null)));return o},c.XD=function(o,l,h){var m=l.Wr();if(m==null)return o;var g=(l=l.sc()).Oe().R(),v=new f.l;o.xc(v);var w=new f.Nc;v.cn(w),v=m.Ga(),m=null;for(var E=new f.Dd;v.$a();)for(;v.Ha();){var A=v.ha(),M=A.Tg(0,0),I=new f.Nc;for(I.K(M.oa,M.va),M=0;I.va>w.oa;)I.move(-g),--M;for(;I.oa<=w.va;){if(I.isIntersecting(w)){m==null&&(m=new f.Ta);var D=f.yb.cP(A.ac(),A.wc());M!=0&&(E.gg(M*g,0),D.Oc(E)),m.oc(D,!0)}I.move(g),++M}}return m!=null?(l=f.ta.gO(l,m),l=f.ta.Er(l),f.$t.lP(o,m,l,h)):o},c.eO=function(o,l,h,m,g){return o>=h&&l<=m?0:c.tE(.5*(l+o),h,m,g)},c.tE=function(o,l,h,m){return f.lc.round((.5*(h+l)-o)/m)*m},c.VQ=function(o,l,h,m,g,v,w,E){var A=c.dv(m,g),M=A.R(),I=M/360,D=c.pE*I,k=o.ub(0),B=l.Wc(),J=B?M/l.Oe().R():0;l=o.Ia();for(var Y=0,V=h.da();Y<V;++Y){var te=B,he=new f.Ta(h.description);he.addPath(h,Y,!0);var ue=h.dc(Y);w!=0&&(ue=c.PD(ue,he,A.H-E,A.H,w))&&(te=!1);var xe=-1;ue=he.I();var be=!1;te&&(xe=o.Ba(Y),be=o.dc(Y));var Le=he.ub(0),Xe=0,qe=Le.read(0),xt=0,it=3*m.Xd(0),hi=!1,ai=new f.h;ai.Rc();var yt=new f.h;yt.Rc();for(var Or=!1,xn=1;xn<ue;++xn){var Pr=f.h.construct(Le.eg(2*xn),Le.eg(2*xn+1)),Ri=Pr.x,Vi=Ri+Xe,Ei=Vi-qe;if(Pr.x=Vi,Math.abs(Ei)>D){if(te){var Ki=xe+xn-1,bi=xe;(!be||xn+1<ue)&&(bi+=xn),Ki=k.read(2*Ki),bi=(k.read(2*bi)-Ki)*J,Math.abs(Ei-bi)>1*I&&(B=!1)}te||(Vi=Ri+(Xe-=f.lc.Cn(M,Vi-qe)),++xt,Or=Xe!=0,Pr.x=Vi)}else hi||f.ta.AG(ai,yt,Pr,it)&&(hi=!0);Or&&Le.write(2*xn,Vi),qe=Vi,ai.L(yt),yt.L(Pr)}xt!=0&&he.Pc(1993),te=he.Na(0),ue=he.Na(ue-1),f.h.tb(te,ue),he=c.wQ(he,m,isNaN(g)?0:g,v),l.add(he,!1)}return o=m.Xd(0),h=A.R()/180,c.Jt(l,A,.1*o,!1),f.ri.clip(l,A,o,h,v)},c.wQ=function(o,l,h,m){return c.Fn(o,l,h,!0,0,m)},c.OS=function(o,l,h,m){var g=o.getType();if(g==1736)for(l=l!=null?l.Xd(0):0,g=0;g<m;g++)f.hd.Yd(o,h[g],l)!=1&&h[g].Rc();else{if(g!=197)throw f.i.N();for(g=0;g<m;g++)o.dP(h[g])||h[g].Rc()}},c.$k=function(o,l,h,m){if(32>h)for(var g=new f.Sa,v=0;v<h;v++)g.Cb(l[v]),o.$k(g,m).D(l[v]);else{var w=new f.de;for(w.re(3),w.HD(l,h),g=w.ub(3),v=0;v<h;v++)g.write(v,v);for(v=o.$k(w,m),o=v.ub(0),g=v.ub(3),m=f.h.construct(NaN,NaN),w=0;w<h;w++)l[w]=m;for(h=v.I(),v=0;v<h;v++)m=g.read(v),o.tc(2*v,l[m])}},c.Zk=function(o,l,h,m){if(32>h)for(var g=new f.Sa,v=0;v<h;v++)g.Cb(l[v]),o.Zk(g,m).D(l[v]);else{var w=new f.de;for(w.re(3),w.HD(l,h),g=w.ub(3),v=0;v<h;v++)g.write(v,v);for(v=o.Zk(w,m),o=v.ub(0),g=v.ub(3),m=f.h.construct(NaN,NaN),w=0;w<h;w++)l[w]=m;for(h=v.I(),v=0;v<h;v++)m=g.read(v),o.tc(2*v,l[m])}},c.pE=210,c}()}(Q||(Q={})),function(f){var L;(L=f.UL||(f.UL={}))[L.rightSide=1]="rightSide";var x=function(){function d(c,o,l){this.Bs=new f.h,c===void 0?this.Io=-1:(this.Bs.L(c),this.Io=o,this.Ka=l,this.nw=0)}return d.prototype.WJ=function(c){this.nw=c?1|this.nw:-2&this.nw},d.prototype.B=function(){return 0>this.Io},d.prototype.fz=function(){if(this.B())throw f.i.fa("invalid call");return new f.Sa(this.Bs.x,this.Bs.y)},d.prototype.Ua=function(){if(this.B())throw f.i.fa("invalid call");return this.Io},d.prototype.hz=function(){if(this.B())throw f.i.fa("invalid call");return this.Ka},d.prototype.Sz=function(){return(1&this.nw)!=0},d.prototype.ey=function(c,o,l,h){this.Bs.x=c,this.Bs.y=o,this.Io=l,this.Ka=h},d}();f.$l=x}(Q||(Q={})),function(f){var L=function(){function d(){}return d.prototype.Uo=function(c,o){if(this.th.resize(0),this.Ii.length=0,this.tk=-1,c.xc(this.Ek),this.Ek.W(o,o),this.Ek.isIntersecting(this.Fb.Ca)){var l=c.getType();(this.vs=f.aa.yd(l))?(this.TH=c.ac(),this.SH=c.wc(),this.qa=o):this.qa=NaN,this.th.add(this.Fb.kf),this.Ii.push(this.Fb.Ca),this.Qs=this.Fb.Ur(this.Fb.kf)}else this.Qs=-1},d.prototype.Xi=function(c,o){this.th.resize(0),this.Ii.length=0,this.tk=-1,this.Ek.K(c),this.Ek.W(o,o),this.qa=NaN,this.Ek.isIntersecting(this.Fb.Ca)?(this.th.add(this.Fb.kf),this.Ii.push(this.Fb.Ca),this.Qs=this.Fb.Ur(this.Fb.kf),this.vs=!1):this.Qs=-1},d.prototype.next=function(){if(this.th.size==0)return-1;this.tk=this.Qs;var c=null,o=null,l=null,h=null;this.vs&&(c=new f.h,o=new f.h,l=new f.l);for(var m=!1;!m;){for(;this.tk!=-1;){var g=this.Fb.bz(this.Fb.fv(this.tk));if(g.isIntersecting(this.Ek)){if(!this.vs){m=!0;break}if(c.L(this.TH),o.L(this.SH),l.K(g),l.W(this.qa,this.qa),0<l.zy(c,o)){m=!0;break}}this.tk=this.Fb.nv(this.tk)}if(this.tk==-1){g=this.th.Fc();var v=this.Ii[this.Ii.length-1];for(h==null&&((h=[])[0]=new f.l,h[1]=new f.l,h[2]=new f.l,h[3]=new f.l),x.EJ(v,h),this.th.If(),--this.Ii.length,v=0;4>v;v++){var w=this.Fb.Lp(g,v);if(w!=-1&&0<this.Fb.WR(w)&&h[v].isIntersecting(this.Ek))if(this.vs){if(c.L(this.TH),o.L(this.SH),l.K(h[v]),l.W(this.qa,this.qa),0<l.zy(c,o)){var E=new f.l;E.K(h[v]),this.th.add(w),this.Ii.push(E)}}else(E=new f.l).K(h[v]),this.th.add(w),this.Ii.push(E)}if(this.th.size==0)return-1;this.tk=this.Fb.Ur(this.th.get(this.th.size-1))}}return this.Qs=this.Fb.nv(this.tk),this.tk},d.bP=function(c,o,l){var h=new d;return h.Fb=c,h.Ek=new f.l,h.th=new f.ia(0),h.Ii=[],h.Uo(o,l),h},d.aP=function(c,o,l){var h=new d;return h.Fb=c,h.Ek=new f.l,h.th=new f.ia(0),h.Ii=[],h.Xi(o,l),h},d.$O=function(c){var o=new d;return o.Fb=c,o.Ek=new f.l,o.th=new f.ia(0),o.Ii=[],o},d}();f.GY=L;var x=function(){function d(c,o){this.jf=new f.$c(11),this.Zh=new f.$c(5),this.ws=[],this.gw=new f.ia(0),this.Ca=new f.l,this.Nk(c,o)}return d.prototype.reset=function(c,o){this.jf.mj(!1),this.Zh.mj(!1),this.ws.length=0,this.gw.clear(!1),this.Nk(c,o)},d.prototype.vj=function(c,o){return this.zv(c,o,0,this.Ca,this.kf,!1,-1)},d.prototype.Jz=function(c,o,l){l=l==-1?this.kf:this.WF(l);var h=this.ca(l),m=this.oR(l);return this.zv(c,o,h,m,l,!1,-1)},d.prototype.ja=function(c){return this.jR(c)},d.prototype.GF=function(c){return this.bz(this.fv(c))},d.prototype.ca=function(c){return this.jv(c)},d.prototype.oR=function(c){var o=new f.l;o.K(this.Ca);var l=this.jv(c);c=this.QF(c);for(var h=0;h<2*l;h+=2){var m=f.O.truncate(3&c>>h);m==0?(o.v=.5*(o.v+o.C),o.G=.5*(o.G+o.H)):m==1?(o.C=.5*(o.v+o.C),o.G=.5*(o.G+o.H)):(m==2?o.C=.5*(o.v+o.C):o.v=.5*(o.v+o.C),o.H=.5*(o.G+o.H))}return o},d.prototype.WR=function(c){return this.Az(c)},d.prototype.vR=function(c,o){return L.bP(this,c,o)},d.prototype.MF=function(c,o){return L.aP(this,c,o)},d.prototype.getIterator=function(){return L.$O(this)},d.prototype.Nk=function(c,o){if(0>o||32<2*o)throw f.i.N("invalid height");this.BT=o,this.Ca.K(c),this.kf=this.jf.Ce(),this.jx(this.kf,0),this.ax(this.kf,0),this.NJ(this.kf,0),this.KJ(this.kf,0)},d.prototype.zv=function(c,o,l,h,m,g,v){if(!h.contains(o))return l==0?-1:this.zv(c,o,0,this.Ca,this.kf,g,v);if(!g)for(var w=m;w!=-1;w=this.IR(w))this.jx(w,this.Az(w)+1);(w=new f.l).K(h),h=m;var E=[];for(E[0]=new f.l,E[1]=new f.l,E[2]=new f.l,E[3]=new f.l;l<this.BT&&this.iO(h);l++){d.EJ(w,E);for(var A=!1,M=0;4>M;M++)if(E[M].contains(o)){A=!0;var I=this.Lp(h,M);I==-1&&(I=this.rP(h,M)),this.jx(I,this.Az(I)+1),h=I,w.K(E[M]);break}if(!A)break}return this.sS(c,o,l,w,h,g,m,v)},d.prototype.sS=function(c,o,l,h,m,g,v,w){var E=this.NF(m);if(g){if(m==v)return w;this.SP(w),g=w}else g=this.tP(),this.NB(g,c),this.KW(this.fv(g),o);return this.mX(g,m),E!=-1?(this.hx(g,E),this.bx(E,g)):this.GJ(m,g),this.SB(m,g),this.ax(m,this.lv(m)+1),this.hO(m)&&this.MQ(l,h,m),g},d.prototype.SP=function(c){var o=this.WF(c),l=this.NF(o),h=this.OR(c),m=this.nv(c);this.Ur(o)==c?(m!=-1?this.hx(m,-1):this.SB(o,-1),this.GJ(o,m)):l==c?(this.bx(h,-1),this.SB(o,h)):(this.hx(m,h),this.bx(h,m)),this.hx(c,-1),this.bx(c,-1),this.ax(o,this.lv(o)-1)},d.EJ=function(c,o){var l=.5*(c.v+c.C),h=.5*(c.G+c.H);o[0].K(l,h,c.C,c.H),o[1].K(c.v,h,l,c.H),o[2].K(c.v,c.G,l,h),o[3].K(l,c.G,c.C,h)},d.prototype.hO=function(c){return this.lv(c)==8&&!this.gG(c)},d.prototype.MQ=function(c,o,l){var h=this.Ur(l);do{var m=this.fv(h),g=this.Zh.T(h,0);m=this.bz(m),this.zv(g,m,c,o,l,!0,h),h=g=this.nv(h)}while(h!=-1)},d.prototype.iO=function(c){return 8<=this.lv(c)||this.gG(c)},d.prototype.gG=function(c){return this.Lp(c,0)!=-1||this.Lp(c,1)!=-1||this.Lp(c,2)!=-1||this.Lp(c,3)!=-1},d.prototype.rP=function(c,o){var l=this.jf.Ce();return this.OW(c,o,l),this.jx(l,0),this.ax(l,0),this.Pk(l,c),this.KJ(l,this.jv(c)+1),this.NJ(l,o<<2*this.jv(c)|this.QF(c)),l},d.prototype.tP=function(){var c=this.Zh.Ce();if(0<this.gw.size){var o=this.gw.Fc();this.gw.If()}else o=this.ws.length,this.ws.push(new f.l);return this.LW(c,o),c},d.prototype.Lp=function(c,o){return this.jf.T(c,o)},d.prototype.OW=function(c,o,l){this.jf.S(c,o,l)},d.prototype.Ur=function(c){return this.jf.T(c,4)},d.prototype.GJ=function(c,o){this.jf.S(c,4,o)},d.prototype.NF=function(c){return this.jf.T(c,5)},d.prototype.SB=function(c,o){this.jf.S(c,5,o)},d.prototype.QF=function(c){return this.jf.T(c,6)},d.prototype.NJ=function(c,o){this.jf.S(c,6,o)},d.prototype.lv=function(c){return this.jf.T(c,7)},d.prototype.Az=function(c){return this.jf.T(c,8)},d.prototype.ax=function(c,o){this.jf.S(c,7,o)},d.prototype.jx=function(c,o){this.jf.S(c,8,o)},d.prototype.IR=function(c){return this.jf.T(c,9)},d.prototype.Pk=function(c,o){this.jf.S(c,9,o)},d.prototype.jv=function(c){return this.jf.T(c,10)},d.prototype.KJ=function(c,o){this.jf.S(c,10,o)},d.prototype.jR=function(c){return this.Zh.T(c,0)},d.prototype.NB=function(c,o){this.Zh.S(c,0,o)},d.prototype.OR=function(c){return this.Zh.T(c,1)},d.prototype.nv=function(c){return this.Zh.T(c,2)},d.prototype.hx=function(c,o){this.Zh.S(c,1,o)},d.prototype.bx=function(c,o){this.Zh.S(c,2,o)},d.prototype.WF=function(c){return this.Zh.T(c,3)},d.prototype.mX=function(c,o){this.Zh.S(c,3,o)},d.prototype.fv=function(c){return this.Zh.T(c,4)},d.prototype.LW=function(c,o){this.Zh.S(c,4,o)},d.prototype.bz=function(c){return this.ws[c]},d.prototype.KW=function(c,o){this.ws[c].K(o)},d}();f.du=x}(Q||(Q={})),function(f){var L;(L=f.aL||(f.aL={}))[L.Outside=0]="Outside",L[L.Inside=1]="Inside",L[L.Border=2]="Border";var x=function(){function c(o,l){this.PT=l,this.Vh=o}return c.prototype.setColor=function(o,l){this.iH!=l&&o.flush(),this.iH=l},c.prototype.gF=function(o,l){for(var h=0;h<l;)for(var m=o[h++],g=o[h++],v=o[h++]*this.PT;m<g;m++)this.Vh[v+(m>>4)]|=this.iH<<2*(15&m)},c}();f.HY=x;var d=function(){function c(o,l,h){this.Vh=null,this.SA=this.Ik=this.cI=this.aI=this.Es=this.qH=this.Gf=this.Um=0,this.Ri=this.Jk=this.vl=null,this.Fz(o,l,h)}return c.create=function(o,l,h){if(!c.zE(o))throw f.i.N();return c.wP(o,l,h)},c.pW=function(o){switch(o){case 0:o=1024;break;case 1:o=16384;break;case 2:o=262144;break;default:throw f.i.fa("Internal Error")}return o},c.zE=function(o){return!(o.B()||o.getType()!=1607&&o.getType()!=1736)},c.prototype.rQ=function(o,l){l=l.Ga();for(var h=new f.h,m=new f.h;l.$a();)for(;l.Ha();){var g=l.ha();if(g.getType()!=322)throw f.i.fa("Internal Error");o.Eh(g.ac(),h),o.Eh(g.wc(),m),this.Ri.jy(h.x,h.y,m.x,m.y)}this.Ri.iJ(f.Px.Cx)},c.prototype.sQ=function(){throw f.i.fa("Internal Error")},c.prototype.Ry=function(o,l){for(var h=1;4>h;h++)o.jy(l[h-1].x,l[h-1].y,l[h].x,l[h].y);o.jy(l[3].x,l[3].y,l[0].x,l[0].y),this.Ri.iJ(f.Px.Cx)},c.prototype.rK=function(o,l,h){for(var m=[null,null,null,null],g=0;g<m.length;g++)m[g]=new f.h;l=l.Ga(),h=this.Jk.dY(h)+1.5,g=new f.h;for(var v=new f.h,w=new f.h,E=new f.h,A=new f.h,M=new f.l,I=new f.h;l.$a();){var D=!1,k=!0;for(I.ma(0,0);l.Ha();){var B=l.ha();if(E.x=B.sa,E.y=B.na,A.x=B.pa,A.y=B.la,M.Oa(),M.Zb(E.x,E.y),M.Lk(A.x,A.y),this.vl.HG(M)){this.Jk.Eh(A,A),k?(this.Jk.Eh(E,E),I.L(E),k=!1):E.L(I),g.uc(A,E);var J=.5>(B=g.length());B==0?g.ma(1,0):(J||I.L(A),g.scale(h/B),v.ma(-g.y,g.x),w.ma(g.y,-g.x),E.sub(g),A.add(g),m[0].add(E,v),m[1].add(E,w),m[2].add(A,w),m[3].add(A,v),J?D=!0:this.Ry(o,m))}else D&&(this.Ry(o,m),D=!1),k=!0}D&&this.Ry(o,m)}},c.prototype.sC=function(o){return f.O.truncate(o*this.qH+this.aI)},c.prototype.tC=function(o){return f.O.truncate(o*this.Es+this.cI)},c.wP=function(o,l,h){return new c(o,l,h)},c.prototype.Fz=function(o,l,h){this.Gf=Math.max(f.O.truncate(2*Math.sqrt(h)+.5),64),this.Um=f.O.truncate((2*this.Gf+31)/32),this.vl=new f.l,this.Ik=l,h=0;for(var m=this.Gf,g=this.Um;8<=m;)h+=m*g,m=f.O.truncate(m/2),g=f.O.truncate((2*m+31)/32);this.Vh=f.O.lg(h,0),this.Ri=new f.Px,h=new x(this.Vh,this.Um,this),this.Ri.AX(this.Gf,this.Gf,h),o.A(this.vl),this.vl.W(l,l),m=new f.l;var v=l*(g=f.l.construct(1,1,this.Gf-2,this.Gf-2)).R();switch(l*=g.ca(),m.K(this.vl.sf(),Math.max(v,this.vl.R()),Math.max(l,this.vl.ca())),this.SA=this.Ik,this.Jk=new f.Dd,this.Jk.pS(m,g),new f.Dd,o.getType()){case 550:h.setColor(this.Ri,2),this.sQ();break;case 1607:h.setColor(this.Ri,2),this.rK(this.Ri,o,this.SA);break;case 1736:h.setColor(this.Ri,1),this.rQ(this.Jk,o),h.setColor(this.Ri,2),this.rK(this.Ri,o,this.SA)}this.qH=this.Jk.bb,this.Es=this.Jk.ab,this.aI=this.Jk.Gb,this.cI=this.Jk.Lb,this.XN()},c.prototype.XN=function(){this.Ri.flush();for(var o=0,l=this.Gf*this.Um,h=this.Gf,m=f.O.truncate(this.Gf/2),g=this.Um,v=f.O.truncate((2*m+31)/32);8<h;){for(h=0;h<m;h++)for(var w=2*h,E=2*h+1,A=0;A<m;A++){var M=2*A,I=2*A+1,D=M>>4;M=2*(15&M);var k=I>>4;I=2*(15&I);var B=this.Vh[o+g*w+D]>>M&3;B|=this.Vh[o+g*w+k]>>I&3,B|=this.Vh[o+g*E+D]>>M&3,B|=this.Vh[o+g*E+k]>>I&3,this.Vh[l+v*h+(A>>4)]|=B<<2*(15&A)}h=m,g=v,o=l,m=f.O.truncate(h/2),v=f.O.truncate((2*m+31)/32),l=o+g*h}},c.prototype.So=function(o,l){return this.vl.contains(o,l)?(o=this.sC(o),l=this.tC(l),0>o||o>=this.Gf||0>l||l>=this.Gf||(l=this.Vh[this.Um*l+(o>>4)]>>2*(15&o)&3)==0?0:l==1?1:2):0},c.prototype.Ro=function(o){if(!o.Ea(this.vl))return 0;var l=this.sC(o.v),h=this.sC(o.C),m=this.tC(o.G);if(o=this.tC(o.H),0>l&&(l=0),0>m&&(m=0),h>=this.Gf&&(h=this.Gf-1),o>=this.Gf&&(o=this.Gf-1),l>h||m>o)return 0;for(var g=Math.max(h-l,1)*Math.max(o-m,1),v=0,w=this.Um,E=this.Gf,A=0;;){if(32>g||16>E){for(g=m;g<=o;g++)for(var M=l;M<=h;M++)if(1<(A=this.Vh[v+w*g+(M>>4)]>>2*(15&M)&3))return 2;if(A==0)return 0;if(A==1)return 1}v+=w*E,E=f.O.truncate(E/2),w=f.O.truncate((2*E+31)/32),l=f.O.truncate(l/2),m=f.O.truncate(m/2),h=f.O.truncate(h/2),o=f.O.truncate(o/2),g=Math.max(h-l,1)*Math.max(o-m,1)}},c.prototype.RR=function(){return this.Gf*this.Um},c}();f.Nx=d}(Q||(Q={})),function(f){var L;(L=f.VL||(f.VL={}))[L.contains=1]="contains",L[L.within=2]="within",L[L.equals=3]="equals",L[L.disjoint=4]="disjoint",L[L.touches=8]="touches",L[L.crosses=16]="crosses",L[L.overlaps=32]="overlaps",L[L.unknown=0]="unknown",L[L.intersects=1073741824]="intersects";var x=function(){function c(){}return c.construct=function(o,l,h,m,g,v,w,E){var A=new c;return A.pw=o,A.Mm=l,A.Kj=h,A.Si=m,A.BH=g,A.SY=v,A.TY=w,A.UY=E,A},c}();f.Vt=function(){function c(){}return c.CD=function(o,l,h){if(c.wy(o)){var m=f.ta.kj(l,o,!1);l=!1,f.Uk.CE(o)&&(l=l||o.lu(m,h)),(m=o.getType())!=1736&&m!=1607||!f.Uk.AE(o)||h==0||(l=l||o.fj(h)),m!=1736&&m!=1607||!f.Uk.BE(o)||h==0||l||o.hM()}},c.wy=function(o){return f.Uk.CE(o)||f.Uk.AE(o)||f.Uk.BE(o)},c}();var d=function(){function c(){this.rh=[]}return c.zB=function(o,l,h,m,g){var v=o.getType(),w=l.getType();if(v==197){if(w==197)return c.tW(o,l,h,m);if(w==33)return m==2?m=1:m==1&&(m=2),c.hJ(l,o,h,m)}else if(v==33){if(w==197)return c.hJ(o,l,h,m);if(w==33)return c.vW(o,l,h,m)}if(o.B()||l.B())return m==4;var E=new f.l;o.A(E);var A=new f.l;l.A(A);var M=new f.l;if(M.K(E),M.Zb(A),h=f.ta.Wd(h,M,!1),c.dk(E,A,h))return m==4;switch(E=!1,f.Vk.yd(v)&&((v=new f.Ta(o.description)).oc(o,!0),o=v,v=1607),f.Vk.yd(w)&&((w=new f.Ta(l.description)).oc(l,!0),l=w,w=1607),v!=197&&w!=197?(o.Db()<l.Db()||v==33&&w==550)&&(m==2?m=1:m==1&&(m=2)):v!=1736&&w!=197&&(m==2?m=1:m==1&&(m=2)),v){case 1736:switch(w){case 1736:E=c.rt(o,l,h,m,g);break;case 1607:E=c.$m(o,l,h,m,g);break;case 33:E=c.qt(o,l,h,m);break;case 550:E=c.pt(o,l,h,m,g);break;case 197:E=c.GI(o,l,h,m,g)}break;case 1607:switch(w){case 1736:E=c.$m(l,o,h,m,g);break;case 1607:E=c.gB(o,l,h,m,g);break;case 33:E=c.tt(o,l,h,m,g);break;case 550:E=c.st(o,l,h,m,g);break;case 197:E=c.MI(o,l,h,m)}break;case 33:switch(w){case 1736:E=c.qt(l,o,h,m);break;case 1607:E=c.tt(l,o,h,m,g);break;case 550:E=c.lt(l,o,h,m)}break;case 550:switch(w){case 1736:E=c.pt(l,o,h,m,g);break;case 1607:E=c.st(l,o,h,m,g);break;case 550:E=c.ZA(o,l,h,m,g);break;case 33:E=c.lt(o,l,h,m);break;case 197:E=c.hI(o,l,h,m)}break;case 197:switch(w){case 1736:E=c.GI(l,o,h,m,g);break;case 1607:E=c.MI(l,o,h,m);break;case 550:E=c.hI(l,o,h,m)}}return E},c.tW=function(o,l,h,m){if(o.B()||l.B())return m==4;var g=new f.l,v=new f.l,w=new f.l;switch(o.A(g),l.A(v),w.K(g),w.Zb(v),o=f.ta.Wd(h,w,!1),m){case 4:return c.dk(g,v,o);case 2:return c.jF(v,g,o);case 1:return c.jF(g,v,o);case 3:return c.ek(g,v,o);case 8:return c.cQ(g,v,o);case 32:return c.bQ(g,v,o);case 16:return c.aQ(g,v,o)}return!1},c.hJ=function(o,l,h,m){if(o.B()||l.B())return m==4;o=o.D();var g=new f.l,v=new f.l;switch(l.A(g),v.K(o),v.Zb(g),l=f.ta.Wd(h,v,!1),m){case 4:return c.Rw(o,g,l);case 2:return c.eB(o,g,l);case 1:return c.RU(o,g,l);case 3:return c.vI(o,g,l);case 8:return c.dB(o,g,l)}return!1},c.vW=function(o,l,h,m){if(o.B()||l.B())return m==4;o=o.D(),l=l.D();var g=new f.l;switch(g.K(o),g.Zb(l),h=f.ta.Wd(h,g,!1),m){case 4:return c.SU(o,l,h);case 2:return c.uI(l,o,h);case 1:return c.uI(o,l,h);case 3:return c.wI(o,l,h)}return!1},c.rt=function(o,l,h,m,g){switch(m){case 4:return c.kV(o,l,h);case 2:return c.Sw(l,o,h,g);case 1:return c.Sw(o,l,h,g);case 3:return c.nV(o,l,h);case 8:return c.vV(o,l,h);case 32:return c.qV(o,l,h,g)}return!1},c.$m=function(o,l,h,m,g){switch(m){case 4:return c.lV(o,l,h);case 1:return c.fB(o,l,h,g);case 8:return c.wV(o,l,h,g);case 16:return c.gV(o,l,h)}return!1},c.qt=function(o,l,h,m){switch(m){case 4:return c.jV(o,l,h);case 1:return c.dV(o,l,h);case 8:return c.uV(o,l,h)}return!1},c.pt=function(o,l,h,m){switch(m){case 4:return c.iV(o,l,h);case 1:return c.cV(o,l,h);case 8:return c.tV(o,l,h);case 16:return c.fV(o,l,h)}return!1},c.GI=function(o,l,h,m,g){if(c.hV(o,l,h))return m==4;if(m==4)return!1;switch(m){case 2:return c.xV(o,l,h);case 1:return c.bV(o,l,h);case 3:return c.mV(o,l,h);case 8:return c.sV(o,l,h,g);case 32:return c.pV(o,l,h,g);case 16:return c.eV(o,l,h,g)}return!1},c.gB=function(o,l,h,m){switch(m){case 4:return c.GV(o,l,h);case 2:return c.KI(l,o,h);case 1:return c.KI(o,l,h);case 3:return c.IV(o,l,h);case 8:return c.NI(o,l,h);case 32:return c.MV(o,l,h);case 16:return c.LI(o,l,h)}return!1},c.tt=function(o,l,h,m){switch(m){case 4:return c.FV(o,l,h);case 1:return c.AV(o,l,h);case 8:return c.QV(o,l,h)}return!1},c.st=function(o,l,h,m){switch(m){case 4:return c.EV(o,l,h);case 1:return c.zV(o,l,h);case 8:return c.PV(o,l,h);case 16:return c.CV(o,l,h)}return!1},c.MI=function(o,l,h,m){if(c.DV(o,l,h))return m==4;if(m==4)return!1;switch(m){case 2:return c.RV(o,l,h);case 1:return c.yV(o,l,h);case 3:return c.HV(o,l,h);case 8:return c.OV(o,l,h);case 32:return c.LV(o,l,h);case 16:return c.BV(o,l,h)}return!1},c.ZA=function(o,l,h,m){switch(m){case 4:return c.gU(o,l,h);case 2:return c.eI(l,o,h);case 1:return c.eI(o,l,h);case 3:return c.iU(o,l,h);case 32:return c.oU(o,l,h)}return!1},c.lt=function(o,l,h,m){switch(m){case 4:return c.fI(o,l,h);case 2:return c.sU(o,l,h);case 1:return c.dU(o,l,h);case 3:return c.Nw(o,l,h)}return!1},c.hI=function(o,l,h,m){switch(m){case 4:return c.fU(o,l,h);case 2:return c.rU(o,l,h);case 1:return c.cU(o,l,h);case 3:return c.hU(o,l,h);case 8:return c.qU(o,l,h);case 16:return c.eU(o,l,h)}return!1},c.nV=function(o,l,h){var m=new f.l,g=new f.l;return o.A(m),l.A(g),!!c.ek(m,g,h)&&(m=c.qc(o,l,!1))!=4&&m!=1&&m!=2&&(!!c.dI(o,l,h)||(m=o.Qb(),g=l.Qb(),!(Math.abs(m-g)>4*Math.max(o.I(),l.I())*h)&&c.Wz(o,l,h,!0)))},c.kV=function(o,l,h){var m=c.qc(o,l,!0);return m==4||m!=1&&m!=2&&m!=1073741824&&c.EI(o,l,h)},c.vV=function(o,l,h){var m=c.qc(o,l,!1);return m!=4&&m!=1&&m!=2&&c.II(o,l,h,null)},c.qV=function(o,l,h,m){var g=c.qc(o,l,!1);return g!=4&&g!=1&&g!=2&&c.FI(o,l,h,m)},c.Sw=function(o,l,h,m){var g=new f.l,v=new f.l;return o.A(g),l.A(v),!!c.zc(g,v,h)&&(g=c.qc(o,l,!1))!=4&&g!=2&&(g==1||c.BI(o,l,h,m))},c.lV=function(o,l,h){var m=c.qc(o,l,!0);return m==4||m!=1&&m!=1073741824&&c.EI(o,l,h)},c.wV=function(o,l,h,m){var g=c.qc(o,l,!1);return g!=4&&g!=1&&c.JI(o,l,h,m)},c.gV=function(o,l,h){var m=c.qc(o,l,!1);return m!=4&&m!=1&&c.DI(o,l,h,null)},c.fB=function(o,l,h,m){var g=new f.l,v=new f.l;return o.A(g),l.A(v),!!c.zc(g,v,h)&&(g=c.qc(o,l,!1))!=4&&(g==1||c.CI(o,l,h,m))},c.jV=function(o,l,h){return f.hd.KG(o,l,h)==0},c.uV=function(o,l,h){return l=l.D(),c.HI(o,l,h)},c.dV=function(o,l,h){return l=l.D(),c.AI(o,l,h)},c.iV=function(o,l,h){var m=c.qc(o,l,!1);if(m==4)return!0;if(m==1)return!1;m=new f.l,o.A(m),m.W(h,h);for(var g=new f.h,v=0;v<l.I();v++)if(l.D(v,g),m.contains(g)){var w=f.hd.Yd(o,g,h);if(w==1||w==2)return!1}return!0},c.tV=function(o,l,h){var m=this.qc(o,l,!1);if(m==4||m==1)return!1;m=new f.l,o.A(m),m.W(h,h);for(var g=!1,v=o,w=!1,E=0;E<l.I();E++){var A=l.Na(E);if(m.contains(A)){if((A=f.hd.Yd(v,A,h))==2)g=!0;else if(A==1)return!1}w||(!f.Dg.Ml(o,l.I()-1)||o.Bb!=null&&o.Bb.Fb!=null?v=o:(v=new f.Da,o.copyTo(v),v.fj(1)),w=!0)}return!!g},c.fV=function(o,l,h){var m=this.qc(o,l,!1);if(m==4||m==1)return!1;var g=new f.l;m=new f.l;var v=new f.l;o.A(g),l.A(v),m.K(g),m.W(h,h),v=g=!1;for(var w=o,E=!1,A=0;A<l.I();A++){var M=l.Na(A);if(m.contains(M)?(M=f.hd.Yd(w,M,h))==0?v=!0:M==1&&(g=!0):v=!0,g&&v)return!0;E||(!f.Dg.Ml(o,l.I()-1)||o.Bb!=null&&o.Bb.Fb!=null?w=o:(w=new f.Da,o.copyTo(w),w.fj(1)),E=!0)}return!1},c.cV=function(o,l,h){var m=new f.l,g=new f.l;if(o.A(m),l.A(g),!this.zc(m,g,h)||(g=this.qc(o,l,!1))==4)return!1;if(g==1)return!0;g=!1;for(var v=o,w=!1,E=0;E<l.I();E++){var A=l.Na(E);if(!m.contains(A))return!1;if((A=f.hd.Yd(v,A,h))==1)g=!0;else if(A==0)return!1;w||(!f.Dg.Ml(o,l.I()-1)||o.Bb!=null&&o.Bb.Fb!=null?v=o:(v=new f.Da,o.copyTo(v),v.fj(1)),w=!0)}return g},c.mV=function(o,l,h){var m=new f.l,g=new f.l;return o.A(m),l.A(g),!!c.ek(m,g,h)&&((m=new f.Da).ad(l,!1),c.Wz(o,m,h,!0))},c.hV=function(o,l,h){var m=c.qc(o,l,!1);if(m==4)return!0;if(m==1||m==2)return!1;var g=new f.l;if(m=new f.l,o.A(g),l.A(m),c.zc(m,g,h)||(g=new f.h,m.dn(g),(l=f.hd.Yd(o,g,h))!=0)||(m.$I(g),(l=f.hd.Yd(o,g,h))!=0)||(m.en(g),(l=f.hd.Yd(o,g,h))!=0)||(m.cJ(g),(l=f.hd.Yd(o,g,h))!=0))return!1;l=o.ub(0),(g=new f.l).K(m),g.W(h,h);for(var v=0,w=o.I();v<w;v++){var E=l.read(2*v),A=l.read(2*v+1);if(g.contains(E,A))return!1}return!c.TG(o,m,h)},c.sV=function(o,l,h,m){var g=c.qc(o,l,!1);if(g==4||g==1||g==2)return!1;g=new f.l;var v=new f.l;return o.A(g),l.A(v),!c.zc(v,g,h)&&(v.R()<=h&&v.ca()<=h?(l=l.Ip(),c.HI(o,l,h)):v.R()<=h||v.ca()<=h?(g=new f.Ta,v=new f.Sa,l.Hf(0,v),g.nf(v),l.Hf(2,v),g.lineTo(v),c.JI(o,g,h,m)):((g=new f.Da).ad(l,!1),c.II(o,g,h,m)))},c.pV=function(o,l,h,m){var g=c.qc(o,l,!1);if(g==4||g==1||g==2)return!1;g=new f.l;var v=new f.l;return o.A(g),l.A(v),!(c.zc(v,g,h)||v.R()<=h||v.ca()<=h)&&((g=new f.Da).ad(l,!1),c.FI(o,g,h,m))},c.xV=function(o,l,h){var m=new f.l,g=new f.l;return o.A(m),l.A(g),c.zc(g,m,h)},c.bV=function(o,l,h){var m=new f.l,g=new f.l;return o.A(m),l.A(g),!!c.zc(m,g,h)&&(m=c.qc(o,l,!1))!=4&&m!=2&&(m==1||(g.R()<=h&&g.ca()<=h?(l=l.Ip(),c.AI(o,l,h)):g.R()<=h||g.ca()<=h?(g=new f.Ta,m=new f.Sa,l.Hf(0,m),g.nf(m),l.Hf(2,m),g.lineTo(m),c.CI(o,g,h,null)):((g=new f.Da).ad(l,!1),c.BI(o,g,h,null))))},c.eV=function(o,l,h,m){var g=new f.l,v=new f.l;return o.A(g),l.A(v),!(c.zc(v,g,h)||v.ca()>h&&v.R()>h||v.ca()<=h&&v.R()<=h)&&(g=new f.Ta,v=new f.Sa,l.Hf(0,v),g.nf(v),l.Hf(2,v),g.lineTo(v),c.DI(o,g,h,m))},c.IV=function(o,l,h){var m=new f.l,g=new f.l;return o.A(m),l.A(g),!(!c.ek(m,g,h)||c.qc(o,l,!1)==4)&&(!!c.dI(o,l,h)||c.Wz(o,l,h,!1))},c.GV=function(o,l,h){return this.qc(o,l,!1)==4||!!new f.Zl(o,l,h,!0).next()&&!this.UG(o,l,h)},c.NI=function(o,l,h){if(c.qc(o,l,!1)==4)return!1;var m=new f.be(0);if(c.Xz(o,l,h,m)!=0)return!1;for(var g=new f.de,v=0;v<m.size;v+=2){var w=m.read(v),E=m.read(v+1);g.Bu(w,E)}return o=o.mg(),l=l.mg(),o.Fd(l,0,l.I()),c.Mw(o,g,h)},c.LI=function(o,l,h){if(c.qc(o,l,!1)==4)return!1;var m=new f.be(0);if(c.Xz(o,l,h,m)!=0)return!1;for(var g=new f.de,v=0;v<m.size;v+=2){var w=m.read(v),E=m.read(v+1);g.Bu(w,E)}return o=o.mg(),l=l.mg(),o.Fd(l,0,l.I()),!c.Mw(o,g,h)},c.MV=function(o,l,h){return c.qc(o,l,!1)!=4&&c.WG(o,l,h)},c.KI=function(o,l,h){var m=new f.l,g=new f.l;return o.A(m),l.A(g),!(!c.zc(m,g,h)||c.qc(o,l,!1)==4)&&c.ym(l,o,h,!1)},c.FV=function(o,l,h){return c.qc(o,l,!1)==4||(l=l.D(),!c.Yz(o,l,h))},c.QV=function(o,l,h){return c.qc(o,l,!1)!=4&&(l=l.D(),c.Zz(o,l,h))},c.AV=function(o,l,h){return c.qc(o,l,!1)!=4&&(l=l.D(),c.SG(o,l,h))},c.EV=function(o,l,h){return c.qc(o,l,!1)==4||!c.VG(o,l,h,!1)},c.PV=function(o,l,h){if(this.qc(o,l,!1)==4)return!1;var m=o.Ga(),g=new f.l,v=new f.l,w=new f.l;o.A(g),l.A(v),g.W(h,h),v.W(h,h),w.K(g),w.Ea(v),g=null;var E=o.Bb;if(E!=null){var A=E.Fb;g=E.zo,A==null&&(A=E=f.ta.jj(o,w))}else A=E=f.ta.jj(o,w);var M=A.getIterator(),I=null;g!=null&&(I=g.getIterator());var D=new f.h,k=new f.h,B=!1,J=h*h;for(g=new f.pn(l.I()),E=0;E<l.I();E++)g.write(E,0);for(E=0;E<l.I();E++)if(l.D(E,D),w.contains(D)){if(v.K(D.x,D.y,D.x,D.y),I!=null&&(I.Xi(v,h),I.next()==-1))continue;M.Xi(v,h);for(var Y=M.next();Y!=-1;Y=M.next())if(m.Vb(A.ja(Y)),(Y=m.ha()).hc(Y.fe(D,!1),k),f.h.yc(D,k)<=J){g.write(E,1),B=!0;break}}if(!B)return!1;for(o=o.mg(),m=new f.de,v=new f.h,E=0;E<l.I();E++)g.read(E)!=0&&(l.D(E,v),m.Bu(v.x,v.y));return this.Mw(o,m,h)},c.CV=function(o,l,h){if(this.qc(o,l,!1)==4)return!1;var m=o.Ga(),g=new f.l,v=new f.l,w=new f.l;o.A(g),l.A(v),g.W(h,h),v.W(h,h),w.K(g),w.Ea(v),g=null;var E=o.Bb;if(E!=null){var A=E.Fb;g=E.zo,A==null&&(A=E=f.ta.jj(o,w))}else A=E=f.ta.jj(o,w);var M=A.getIterator(),I=null;g!=null&&(I=g.getIterator());var D=new f.h,k=new f.h,B=!1,J=!1,Y=h*h;for(g=new f.pn(l.I()),E=0;E<l.I();E++)g.write(E,0);for(E=0;E<l.I();E++)if(l.D(E,D),w.contains(D)){if(v.K(D.x,D.y,D.x,D.y),I!=null&&(I.Xi(v,h),I.next()==-1)){J=!0;continue}M.Xi(v,h);for(var V=!1,te=M.next();te!=-1;te=M.next())if(m.Vb(A.ja(te)),(te=m.ha()).hc(te.fe(D,!1),k),f.h.yc(D,k)<=Y){g.write(E,1),V=B=!0;break}V||(J=!0)}else J=!0;if(!B||!J)return!1;for(o=o.mg(),m=new f.de,v=new f.h,E=0;E<l.I();E++)g.read(E)!=0&&(l.D(E,v),m.Bu(v.x,v.y));return!this.Mw(o,m,h)},c.zV=function(o,l,h){var m=new f.l,g=new f.l;return o.A(m),l.A(g),!(!c.zc(m,g,h)||c.qc(o,l,!1)==4||!c.VG(o,l,h,!0))&&(o=o.mg(),!c.gI(o,l,h))},c.HV=function(o,l,h){var m=new f.l,g=new f.l;return o.A(m),l.A(g),!(g.ca()>h&&g.R()>h)&&c.ek(m,g,h)},c.DV=function(o,l,h){var m=new f.l,g=new f.l;return o.A(m),l.A(g),!c.zc(g,m,h)&&!c.TG(o,g,h)},c.OV=function(o,l,h){var m=new f.l,g=new f.l;if(o.A(m),l.A(g),g.ca()<=h&&g.R()<=h)return g=l.Ip(),c.Zz(o,g,h);if(g.ca()<=h||g.R()<=h)return g=new f.Ta,m=new f.Sa,l.Hf(0,m),g.nf(m),l.Hf(2,m),g.lineTo(m),c.NI(o,g,h);o=o.Ga(),l=new f.l,m=new f.l,l.K(g),m.K(g),l.W(-h,-h),m.W(h,h),g=!1;for(var v=new f.l,w=new f.l;o.$a();)for(;o.Ha();){if(o.ha().A(v),w.K(l),w.Ea(v),!w.B()&&(w.ca()>h||w.R()>h))return!1;w.K(m),w.Ea(v),w.B()||(g=!0)}return g},c.LV=function(o,l,h){var m=new f.l,g=new f.l;return o.A(m),l.A(g),!(c.zc(m,g,h)||c.zc(g,m,h)||c.zc(g,m,h)||g.ca()>h&&g.R()>h||g.ca()<=h&&g.R()<=h)&&(m=new f.Ta,g=new f.Sa,l.Hf(0,g),m.nf(g),l.Hf(2,g),m.lineTo(g),c.WG(o,m,h))},c.RV=function(o,l,h){var m=new f.l,g=new f.l;if(o.A(m),l.A(g),!c.zc(g,m,h)||g.ca()<=h&&g.R()<=h)return!1;if(g.ca()<=h||g.R()<=h)return c.zc(g,m,h);o=o.Ga(),(l=new f.l).K(g),l.W(-h,-h),g=!1,m=new f.l;for(var v=new f.l;o.$a();)for(;o.Ha();)o.ha().A(m),l.hm(m)?g=!0:(v.K(l),v.Ea(m),!v.B()&&(v.ca()>h||v.R()>h)&&(g=!0));return g},c.yV=function(o,l,h){var m=new f.l,g=new f.l;return l.A(g),o.A(m),!(!c.zc(m,g,h)||g.ca()>h&&g.R()>h)&&(g.ca()<=h&&g.R()<=h?(l=l.Ip(),c.SG(o,l,h)):(m=new f.Ta,g=new f.Sa,l.Hf(0,g),m.nf(g),l.Hf(2,g),m.lineTo(g),c.ym(m,o,h,!1)))},c.BV=function(o,l,h){var m=new f.l,g=new f.l;if(o.A(m),l.A(g),c.zc(g,m,h)||g.ca()<=h&&g.R()<=h)return!1;if(g.ca()<=h||g.R()<=h)return m=new f.Ta,g=new f.Sa,l.Hf(0,g),m.nf(g),l.Hf(2,g),m.lineTo(g),c.LI(o,m,h);o=o.Ga(),l=new f.l,(m=new f.l).K(g),l.K(g),m.W(-h,-h),l.W(h,h);for(var v=g=!1,w=new f.l,E=new f.l;o.$a();)for(;o.Ha();)if(o.ha().A(w),v||l.contains(w)||(v=!0),g||(E.K(m),E.Ea(w),!E.B()&&(E.ca()>h||E.R()>h)&&(g=!0)),g&&v)return!0;return!1},c.iU=function(o,l,h){var m=new f.l,g=new f.l;return o.A(m),l.A(g),!!c.ek(m,g,h)&&(!!c.jU(o,l,h)||c.YA(o,l,h,!1,!0,!1))},c.gU=function(o,l,h){return!c.gI(o,l,h)},c.oU=function(o,l,h){return c.YA(o,l,h,!1,!1,!0)},c.eI=function(o,l,h){var m=new f.l,g=new f.l;return o.A(m),l.A(g),!!c.zc(m,g,h)&&c.YA(l,o,h,!0,!1,!1)},c.Mw=function(o,l,h){h*=h;for(var m=new f.h,g=new f.h,v=0;v<l.I();v++){l.D(v,g);for(var w=!1,E=0;E<o.I();E++)if(o.D(E,m),f.h.yc(m,g)<=h){w=!0;break}if(!w)return!1}return!0},c.Nw=function(o,l,h){var m=new f.l,g=new f.l;return o.A(m),l.A(g),c.ek(m,g,h)},c.fI=function(o,l,h){return l=l.D(),c.kt(o,l,h)},c.sU=function(o,l,h){return c.Nw(o,l,h)},c.dU=function(o,l,h){return!c.fI(o,l,h)},c.hU=function(o,l,h){var m=new f.l,g=new f.l;return o.A(m),l.A(g),!(g.ca()>h||g.R()>h)&&c.ek(m,g,h)},c.fU=function(o,l,h){var m=new f.l,g=new f.l;if(o.A(m),l.A(g),c.zc(g,m,h))return!1;for((l=new f.l).K(g),l.W(h,h),h=new f.h,g=0;g<o.I();g++)if(o.D(g,h),l.contains(h))return!1;return!0},c.qU=function(o,l,h){var m=new f.l,g=new f.l,v=new f.l;if(l.A(m),m.ca()<=h&&m.R()<=h)return!1;if(m.ca()<=h||m.R()<=h){l=new f.h;var w=!1;g.K(m),v.K(m),g.W(h,h),m.ca()>h?v.W(0,-h):v.W(-h,0);for(var E=0;E<o.I();E++)if(o.D(E,l),g.contains(l)){if(m.ca()>h){if(l.y>v.G&&l.y<v.H)return!1}else if(l.x>v.v&&l.x<v.C)return!1;w=!0}return w}for(g.K(m),v.K(m),g.W(h,h),v.W(-h,-h),l=new f.h,w=!1,E=0;E<o.I();E++)if(o.D(E,l),g.contains(l)){if(v.hm(l))return!1;w=!0}return w},c.rU=function(o,l,h){var m=new f.l,g=new f.l;if(o.A(m),l.A(g),!c.zc(g,m,h))return!1;if(g.ca()<=h&&g.R()<=h)return c.ek(m,g,h);if(g.ca()<=h||g.R()<=h){l=!1,m=new f.l;var v=new f.l;m.K(g),v.K(g),g.ca()>h?m.W(0,-h):m.W(-h,0),v.W(h,h);for(var w=new f.h,E=0;E<o.I();E++){if(o.D(E,w),!v.contains(w))return!1;g.ca()>h?w.y>m.G&&w.y<m.H&&(l=!0):w.x>m.v&&w.x<m.C&&(l=!0)}return l}for(l=!1,m=new f.l,v=new f.l,m.K(g),v.K(g),m.W(-h,-h),v.W(h,h),w=new f.h,E=0;E<o.I();E++){if(o.D(E,w),!v.contains(w))return!1;m.hm(w)&&(l=!0)}return l},c.cU=function(o,l,h){var m=new f.l,g=new f.l;return o.A(m),l.A(g),!(!c.zc(m,g,h)||g.ca()>h||g.R()>h)&&(l=l.Ip(),!c.kt(o,l,h))},c.eU=function(o,l,h){var m=new f.l,g=new f.l;if(o.A(m),l.A(g),c.zc(g,m,h)||g.ca()<=h&&g.R()<=h)return!1;if(g.ca()<=h||g.R()<=h){l=new f.l,m=new f.l,l.K(g),g.ca()>h?l.W(0,-h):l.W(-h,0),m.K(g),m.W(h,h);for(var v=new f.h,w=!1,E=!1,A=0;A<o.I();A++)if(o.D(A,v),w||(g.ca()>h?v.y>l.G&&v.y<l.H&&(w=!0):v.x>l.v&&v.x<l.C&&(w=!0)),E||m.contains(v)||(E=!0),w&&E)return!0;return!1}for(l=new f.l,m=new f.l,l.K(g),l.W(-h,-h),m.K(g),m.W(h,h),v=new f.h,E=w=!1,A=0;A<o.I();A++)if(o.D(A,v),!w&&l.hm(v)&&(w=!0),E||m.contains(v)||(E=!0),w&&E)return!0;return!1},c.wI=function(o,l,h){return f.h.yc(o,l)<=h*h},c.SU=function(o,l,h){return f.h.yc(o,l)>h*h},c.uI=function(o,l,h){return c.wI(o,l,h)},c.vI=function(o,l,h){var m=new f.l;return m.K(o),c.ek(m,l,h)},c.Rw=function(o,l,h){var m=new f.l;return m.K(l),m.W(h,h),!m.contains(o)},c.dB=function(o,l,h){if(l.ca()<=h&&l.R()<=h)return!1;var m=new f.l,g=new f.l;if(m.K(l),m.W(h,h),!m.contains(o))return!1;if(l.ca()<=h||l.R()<=h){if(g.K(l),l.ca()>h?g.W(0,-h):g.W(-h,0),l.ca()>h){if(o.y>g.G&&o.y<g.H)return!1}else if(o.x>g.v&&o.x<g.C)return!1;return!0}return g.K(l),g.W(-h,-h),!g.hm(o)},c.eB=function(o,l,h){if(l.ca()<=h&&l.R()<=h)return!0;if(l.ca()<=h||l.R()<=h){var m=new f.l;m.K(l),l.ca()>h?m.W(0,-h):m.W(-h,0);var g=!1;return l.ca()>h?o.y>m.G&&o.y<m.H&&(g=!0):o.x>m.v&&o.x<m.C&&(g=!0),g}return(m=new f.l).K(l),m.W(-h,-h),m.hm(o)},c.RU=function(o,l,h){return c.vI(o,l,h)},c.ek=function(o,l,h){return c.zc(o,l,h)&&c.zc(l,o,h)},c.dk=function(o,l,h){var m=new f.l;return m.K(l),m.W(h,h),!o.isIntersecting(m)},c.cQ=function(o,l,h){if(o.ca()<=h&&o.R()<=h){var m=o.sf();return c.dB(m,l,h)}if(l.ca()<=h&&l.R()<=h)return m=l.sf(),c.dB(m,o,h);if(o.ca()>h&&o.R()>h&&(l.ca()<=h||l.R()<=h)?m=l:(m=o,o=l),m.ca()<=h||m.R()<=h){if(o.ca()<=h||o.R()<=h){l=new f.yb;var g=new f.yb,v=[0,0],w=[0,0],E=new f.h;return m.dn(E),l.Dc(E),m.en(E),l.Qc(E),o.dn(E),g.Dc(E),o.en(E),g.Qc(E),l.Ea(g,null,v,w,h),l.Ea(g,null,null,null,h)==1&&(v[0]==0||v[1]==1||w[0]==0||w[1]==1)}return l=new f.l,g=new f.l,l.K(o),l.W(-h,-h),g.K(l),g.Ea(m),!(!g.B()&&(g.ca()>h||g.R()>h))}return o.W(h,h),(g=new f.l).K(m),g.Ea(o),!(g.B()||!g.B()&&g.ca()>h&&g.R()>h)},c.bQ=function(o,l,h){if(c.zc(o,l,h)||c.zc(l,o,h)||o.ca()<=h&&o.R()<=h||l.ca()<=h&&l.R()<=h)return!1;if(o.ca()<=h||o.R()<=h){if(l.ca()>h&&l.R()>h)return!1;var m=new f.yb,g=new f.yb,v=[0,0],w=[0,0],E=new f.h;return o.dn(E),m.Dc(E),o.en(E),m.Qc(E),l.dn(E),g.Dc(E),l.en(E),g.Qc(E),m.Ea(g,null,v,w,h),m.Ea(g,null,null,null,h)==2&&(0<v[0]||1>v[1])&&(0<w[0]||1>w[1])}return!(l.ca()<=h||l.R()<=h)&&((m=new f.l).K(o),m.Ea(l),!(m.B()||m.ca()<=h||m.R()<=h))},c.jF=function(o,l,h){if(!c.zc(o,l,h))return!1;if(o.ca()<=h&&o.R()<=h)return o=o.sf(),c.eB(o,l,h);if(l.ca()<=h&&l.R()<=h)return l=l.sf(),c.eB(l,o,h);if(o.ca()<=h||o.R()<=h)return c.zc(o,l,h);if(l.ca()<=h||l.R()<=h){var m=new f.l;return m.K(o),m.W(-h,-h),m.hm(l)?!0:((o=new f.l).K(m),o.Ea(l),!(o.B()||o.ca()<=h&&o.R()<=h))}return c.zc(o,l,h)},c.aQ=function(o,l,h){if(c.zc(o,l,h)||c.zc(l,o,h)||o.ca()<=h&&o.R()<=h||l.ca()<=h&&l.R()<=h||l.ca()>h&&l.R()>h&&o.ca()>h&&o.R()>h)return!1;if(o.ca()>h&&o.R()>h)var m=l;else m=o,o=l;if(o.ca()>h&&o.R()>h){l=new f.l;var g=new f.l;return g.K(o),g.W(-h,-h),l.K(g),l.Ea(m),!(l.B()||l.ca()<=h&&l.R()<=h)}l=new f.yb,g=new f.yb;var v=[0,0],w=[0,0],E=new f.h;return m.dn(E),l.Dc(E),m.en(E),l.Qc(E),o.dn(E),g.Dc(E),o.en(E),g.Qc(E),l.Ea(g,null,v,w,h),l.Ea(g,null,null,null,h)==1&&0<v[0]&&1>v[1]&&0<w[0]&&1>w[1]},c.EI=function(o,l,h){var m=new f.l,g=new f.l,v=new f.Zl(o,l,h,!0);if(!v.next())return!0;if(this.UG(o,l,h))return!1;var w=o,E=null;l.getType()==1736&&(E=l);var A=!1,M=!1;do{var I=v.nl(),D=v.hl();if(D=l.Na(l.Ba(D)),m.K(v.uz()),m.W(h,h),m.contains(D)&&(D=f.hd.Yd(w,D,0))!=0||l.getType()==1736&&(I=o.Na(o.Ba(I)),g.K(v.az()),g.W(h,h),g.contains(I)&&(D=f.hd.Yd(E,I,0))!=0))return!1;A||(!f.Dg.Ml(o,l.da()-1)||o.Bb!=null&&o.Bb.Fb!=null?w=o:(w=new f.Da,o.copyTo(w),w.fj(1)),A=!0),l.getType()!=1736||M||(M=l,!f.Dg.Ml(M,o.da()-1)||l.Bb!=null&&l.Bb.Fb!=null?E=l:(E=new f.Da,M.copyTo(E),E.fj(1)),M=!0)}while(v.next());return!0},c.zc=function(o,l,h){var m=new f.l;return m.K(o),m.W(h,h),m.contains(l)},c.ls=function(o,l,h){var m=new f.l;return m.K(l),m.W(h,h),l=new f.h,o.dn(l),!m.contains(l)||(o.$I(l),!m.contains(l)||(o.cJ(l),!m.contains(l)||(o.en(l),!m.contains(l))))},c.dI=function(o,l,h){if(o.da()!=l.da()||o.I()!=l.I())return!1;var m=new f.h,g=new f.h,v=!0;h*=h;for(var w=0;w<o.da();w++){if(o.Vc(w)!=l.Vc(w)){v=!1;break}for(var E=o.Ba(w);E<l.Vc(w);E++)if(o.D(E,m),l.D(E,g),f.h.yc(m,g)>h){v=!1;break}if(!v)break}return!!v},c.jU=function(o,l,h){if(o.I()!=l.I())return!1;var m=new f.h,g=new f.h,v=!0;h*=h;for(var w=0;w<o.I();w++)if(o.D(w,m),l.D(w,g),f.h.yc(m,g)>h){v=!1;break}return!!v},c.YA=function(o,l,h,m,g,v){var w=!1;if(o.I()>l.I()){m&&(m=!1,w=!0);var E=l}else E=o,o=l;if(l=null,g||v||w){l=new f.pn(o.I());for(var A=0;A<o.I();A++)l.write(A,0)}A=new f.l;var M=new f.l,I=new f.l;E.A(A),o.A(M),A.W(h,h),M.W(h,h),I.K(A),I.Ea(M),M=new f.h;for(var D=new f.h,k=!0,B=f.ta.oE(o,I),J=B.getIterator(),Y=h*h,V=0;V<E.I();V++)if(E.D(V,M),I.contains(M)){var te=!1;A.K(M.x,M.y,M.x,M.y),J.Xi(A,h);for(var he=J.next();he!=-1&&(he=B.ja(he),o.D(he,D),!(f.h.yc(M,D)<=Y&&((g||v||w)&&l.write(he,1),te=!0,m)));he=J.next());if(!te&&(k=!1,g||m))return!1}else{if(g||m)return!1;k=!1}if(v&&k)return!1;if(m)return!0;for(A=0;A<o.I();A++)if(l.read(A)==1){if(v)return!0}else if(g||w)return!1;return!v},c.gI=function(o,l,h){if(o.I()>l.I())var m=l;else m=o,o=l;l=new f.l;var g=new f.l,v=new f.l;m.A(l),o.A(g),l.W(h,h),g.W(h,h),v.K(l),v.Ea(g),g=new f.h;for(var w=new f.h,E=h*h,A=f.ta.oE(o,v),M=A.getIterator(),I=0;I<m.I();I++)if(m.D(I,g),v.contains(g)){l.K(g.x,g.y,g.x,g.y),M.Xi(l,h);for(var D=M.next();D!=-1;D=M.next())if(o.D(A.ja(D),w),f.h.yc(g,w)<=E)return!0}return!1},c.Wz=function(o,l,h,m){return c.ym(o,l,h,m)&&c.ym(l,o,h,m)},c.ym=function(o,l,h,m){function g(xt,it){return D.QE(xt,it)}var v,w=!0,E=[0,0],A=[0,0],M=0,I=new f.ia(0),D=new c,k=new f.l,B=new f.l,J=new f.l;o.A(k),l.A(B),k.W(h,h),B.W(h,h),J.K(k),J.Ea(B),o=o.Ga(),B=l.Ga();var Y=null,V=Y=null,te=l.Bb;for(te!=null?(Y=te.Fb,V=te.zo,Y==null&&(Y=f.ta.jj(l,J))):Y=f.ta.jj(l,J),l=Y.getIterator(),te=null,V!=null&&(te=V.getIterator());o.$a();)for(;o.Ha();){var he=!1,ue=o.ha();if(ue.A(k),!k.isIntersecting(J)||te!=null&&(te.Xi(k,h),te.next()==-1))return!1;for(V=ue.Qb(),l.Uo(ue,h),v=l.next();v!=-1;v=l.next()){B.Vb(Y.ja(v)),v=B.ha();var xe=ue.Ea(v,null,E,A,h);if(xe==2&&(!m||A[0]<=A[1])){xe=E[0];var be=E[1],Le=A[0],Xe=A[1];if(xe*V<=h&&(1-be)*V<=h){he=!0,M=0,I.resize(0),D.rh.length=0;var qe=o.wb();for(Le=!0;Le;){if(o.Ha()){if(V=(ue=o.ha()).Qb(),(xe=ue.Ea(v,null,E,A,h))==2&&(!m||A[0]<=A[1])&&(xe=E[0],be=E[1],xe*V<=h&&(1-be)*V<=h)){qe=o.wb();continue}if(B.Ha()&&(v=B.ha(),(xe=ue.Ea(v,null,E,A,h))==2&&(!m||A[0]<=A[1])&&(xe=E[0],be=E[1],xe*V<=h&&(1-be)*V<=h))){qe=o.wb();continue}}Le=!1}qe!=o.wb()&&(o.Vb(qe),o.ha());break}qe=o.wb(),v=x.construct(qe,o.gb,xe,be,B.wb(),B.gb,Le,Xe),D.rh.push(v),I.add(I.size)}}if(!he){if(M==D.rh.length)return!1;for(1<I.size-M&&I.Vd(M,I.size,g),he=0;M<D.rh.length;M++)if(!((v=D.rh[I.get(M)]).Kj<he&&v.Si<he)){if(V*(v.Kj-he)>h)return!1;if(V*(1-(he=v.Si))<=h||he==1)break}if(V*(1-he)>h)return!1;M=0,I.resize(0),D.rh.length=0}}return w},c.WG=function(o,l,h){if(1>c.Xz(o,l,h,null))return!1;var m=new f.l,g=new f.l;o.A(m),l.A(g);var v=c.ls(m,g,h);return m=c.ls(g,m,h),!(!v||!m)||(v&&!m?!c.ym(l,o,h,!1):m&&!v?!c.ym(o,l,h,!1):!c.ym(o,l,h,!1)&&!c.ym(l,o,h,!1))},c.Xz=function(o,l,h,m){function g(yt,Or){return k.QE(yt,Or)}if(o.yz()>l.yz())var v=l,w=o;else v=o,w=l;o=v.Ga(),l=w.Ga();var E=[0,0],A=[0,0],M=-1,I=0,D=new f.ia(0),k=new c,B=new f.l,J=new f.l,Y=new f.l;v.A(B),w.A(J),B.W(h,h),J.W(h,h),Y.K(B),Y.Ea(J),v=null,m!=null&&(v=new f.h);var V=J=J=null,te=w.Bb;for(te!=null?(J=te.Fb,V=te.zo,J==null&&(J=f.ta.jj(w,Y))):J=f.ta.jj(w,Y),w=J.getIterator(),te=null,V!=null&&(te=V.getIterator());o.$a();)for(V=0;o.Ha();){var he=o.ha();if(he.A(B),B.isIntersecting(Y)){if(te!=null&&(te.Xi(B,h),te.next()==-1))continue;var ue=he.Qb();w.Uo(he,h);for(var xe=w.next();xe!=-1;xe=w.next()){var be=J.ja(xe);l.Vb(be);var Le=l.ha(),Xe=Le.Qb(),qe=he.Ea(Le,null,E,A,h);if(0<qe){xe=E[0],M=A[0];var xt=qe==2?E[1]:NaN,it=qe==2?A[1]:NaN;if(qe==2){if(ue*(xt-xe)>h)return 1;var hi=ue*(xt-xe);if(l.Ha()){if(Le=l.ha(),(qe=he.Ea(Le,null,E,null,h))==2){qe=E[0];var ai=E[1];if(hi+(qe=ue*(ai-qe))>h)return 1}l.Vb(be),l.ha()}if(!l.vm()){if(l.li(),Le=l.li(),(qe=he.Ea(Le,null,E,null,h))==2&&(qe=E[0],hi+(qe=ue*((ai=E[1])-qe))>h))return 1;l.Vb(be),l.ha()}if(o.Ha()){if(be=o.wb(),(qe=(he=o.ha()).Ea(Le,null,E,null,h))==2&&(qe=E[0],hi+(qe=ue*((ai=E[1])-qe))>h))return 1;o.Vb(be),o.ha()}if(!o.vm()){if(be=o.wb(),o.li(),(qe=(he=o.li()).Ea(Le,null,E,null,h))==2&&(qe=E[0],hi+(qe=Xe*((ai=E[1])-qe))>h))return 1;o.Vb(be),o.ha()}Le=x.construct(o.wb(),o.gb,xe,xt,l.wb(),l.gb,M,it),k.rh.push(Le),D.add(D.size)}M=0,m!=null&&(he.hc(xe,v),m.add(v.x),m.add(v.y))}}if(I<k.rh.length){for(D.Vd(I,D.size,g),he=0,xe=k.rh[D.get(I)].Mm;I<k.rh.length;I++)if(!((Le=k.rh[D.get(I)]).Kj<he&&Le.Si<he))if(ue*(Le.Kj-he)>h)V=ue*(Le.Si-Le.Kj),he=Le.Si,xe=Le.Mm;else{if(Le.Mm!=xe?(V=ue*(Le.Si-Le.Kj),xe=Le.Mm):V+=ue*(Le.Si-Le.Kj),V>h)return 1;if((he=Le.Si)==1)break}ue*(1-he)>h&&(V=0),I=0,D.resize(0),k.rh.length=0}}}return M},c.UG=function(o,l,h){var m=o.Ga(),g=l.Ga();for(o=new f.Zl(o,l,h,!1);o.next();){l=o.nl();var v=o.hl();if(m.Vb(l),g.Vb(v),l=m.ha(),0<g.ha().Ea(l,null,null,null,h))return!0}return!1},c.VG=function(o,l,h,m){var g=o.Ga(),v=new f.l,w=new f.l,E=new f.l;o.A(v),l.A(w),v.W(h,h),v.contains(w),w.W(h,h),E.K(v),E.Ea(w),(v=o.Bb)!=null?(v=v.Fb)==null&&(v=f.ta.jj(o,E)):v=f.ta.jj(o,E),o=v.getIterator();for(var A=new f.h,M=new f.h,I=h*h,D=0;D<l.I();D++)if(l.D(D,A),E.contains(A)){w.K(A.x,A.y,A.x,A.y),o.Xi(w,h);for(var k=!1,B=o.next();B!=-1;B=o.next())if(g.Vb(v.ja(B)),(B=g.ha()).hc(B.fe(A,!1),M),f.h.yc(M,A)<=I){k=!0;break}if(m){if(!k)return!1}else if(k)return!0}return!!m},c.Yz=function(o,l,h){var m=new f.h,g=h*h,v=o.Ga();if((o=o.Bb)!=null&&(o=o.Fb)!=null){var w=new f.l;for(w.K(l),w=(h=o.MF(w,h)).next();w!=-1;w=h.next())if(v.Vb(o.ja(w)),v.Ha()){var E=(w=v.ha()).fe(l,!1);if(w.hc(E,m),f.h.yc(l,m)<=g)return!0}return!1}for(o=new f.l;v.$a();)for(;v.Ha();)if((w=v.ha()).A(o),o.W(h,h),o.contains(l)&&(E=w.fe(l,!1),w.hc(E,m),f.h.yc(l,m)<=g))return!0;return!1},c.SG=function(o,l,h){return c.Yz(o,l,h)&&!c.Zz(o,l,h)},c.Zz=function(o,l,h){return o=o.mg(),!c.kt(o,l,h)},c.TG=function(o,l,h){if(o.tm()){var m=new f.yb(l.v,l.G,l.v,l.H),g=new f.yb(l.v,l.H,l.C,l.H),v=new f.yb(l.C,l.H,l.C,l.G);for(l=new f.yb(l.C,l.G,l.v,l.G),o=o.Ga();o.$a();)for(;o.Ha();){var w=o.ha();if(w.isIntersecting(m,h)||w.isIntersecting(g,h)||w.isIntersecting(v,h)||w.isIntersecting(l,h))return!0}}else{(m=new f.l).K(l),m.W(h,h),h=o.ub(0),g=new f.h,v=new f.h,l=new f.h,w=new f.h;for(var E=0,A=o.da();E<A;E++)for(var M=!0,I=o.Ba(E),D=o.Vc(E);I<D;I++)if(M)h.tc(2*I,v),M=!1;else{if(h.tc(2*I,g),l.L(v),w.L(g),m.zy(l,w)!=0)return!0;v.L(g)}}return!1},c.qc=function(o,l,h){var m=o.getType(),g=l.getType();if(f.aa.xj(m)){var v=o.Bb;if(v!=null&&(v=v.Fk)!=null)if(g==33){var w=l.D();if((w=v.So(w.x,w.y))==1)return 1;if(w==0)return 4}else{if(w=new f.l,l.A(w),(w=v.Ro(w))==1)return 1;if(w==0)return 4;if(h&&f.aa.xj(g)&&c.HE(l,v))return 1073741824}}if(f.aa.xj(g)&&(v=l.Bb)!=null&&(v=v.Fk)!=null)if(m==33){if(o=o.D(),(w=v.So(o.x,o.y))==1)return 2;if(w==0)return 4}else{if(l=new f.l,o.A(l),(w=v.Ro(l))==1)return 2;if(w==0)return 4;if(h&&f.aa.xj(m)&&c.HE(o,v))return 1073741824}return 0},c.HE=function(o,l){for(var h=o.I(),m=new f.h,g=0;g<h;g++)if(o.D(g,m),l.So(m.x,m.y)==1)return!0;return!1},c.II=function(o,l,h,m){for(var g=1<=o.om(0)&&1<=l.om(0),v=o.Ga(),w=l.Ga(),E=[0,0],A=[0,0],M=new f.Zl(o,l,h,!1),I=!1;M.next();){var D=M.nl(),k=M.hl();if(v.Vb(D),w.Vb(k),D=v.ha(),(k=w.ha().Ea(D,null,A,E,h))==2){if(I=E[0],k=E[1],D=D.Qb(),g&&(k-I)*D>h)return!1;I=!0}else if(k!=0){if(I=E[0],D=A[0],0<I&&1>I&&0<D&&1>D)return!1;I=!0}}return!!I&&(v=new f.l,w=new f.l,g=new f.l,o.A(v),l.A(w),v.W(1e3*h,1e3*h),w.W(1e3*h,1e3*h),g.K(v),g.Ea(w),!(10<o.I()&&(o=f.Ud.clip(o,g,h,0),o.B())||10<l.I()&&(l=f.Ud.clip(l,g,h,0),l.B()))&&f.am.rt(o,l,h,"F********",m))},c.FI=function(o,l,h,m){var g=1<=o.om(0)&&1<=l.om(0),v=new f.l,w=new f.l,E=new f.l;o.A(v),l.A(w);for(var A=!1,M=c.ls(v,w,h),I=c.ls(w,v,h),D=o.Ga(),k=l.Ga(),B=[0,0],J=[0,0],Y=new f.Zl(o,l,h,!1);Y.next();){var V=Y.nl(),te=Y.hl();if(D.Vb(V),k.Vb(te),te=D.ha(),(V=k.ha().Ea(te,null,J,B,h))==2){V=B[0];var he=B[1];if(te=te.Qb(),g&&(he-V)*te>h&&(A=!0,M&&I))return!0}else if(V!=0&&(V=B[0],te=J[0],0<V&&1>V&&0<te&&1>te))return!0}if(g=new f.l,D=new f.l,g.K(v),g.W(1e3*h,1e3*h),D.K(w),D.W(1e3*h,1e3*h),E.K(g),E.Ea(D),v="",v=A?v+"**":v+"T*",M){if(10<l.I()&&(l=f.Ud.clip(l,E,h,0)).B())return!1;v+="****"}else v+="T***";if(I){if(10<o.I()&&(o=f.Ud.clip(o,E,h,0)).B())return!1;v+="***"}else v+="T**";return f.am.rt(o,l,h,v.toString(),m)},c.BI=function(o,l,h,m){var g=[!1],v=c.zI(o,l,h,g);return g[0]?v:(g=new f.l,l.A(g),g.W(1e3*h,1e3*h),!(10<o.I()&&(o=f.Ud.clip(o,g,h,0),o.B()))&&f.am.Sw(o,l,h,m))},c.zI=function(o,l,h,m){m[0]=!1;for(var g=o.Ga(),v=l.Ga(),w=[0,0],E=[0,0],A=new f.Zl(o,l,h,!1),M=!1;A.next();){var I=A.nl(),D=A.hl();if(g.Vb(I,-1),v.Vb(D,-1),I=g.ha(),(I=v.ha().Ea(I,null,E,w,h))!=0&&(M=!0,I==1&&(I=w[0],D=E[0],0<I&&1>I&&0<D&&1>D)))return m[0]=!0,!1}if(!M){for(m[0]=!0,w=new f.l,o.A(w),w.W(h,h),A=o,M=!1,E=new f.l,m=0,g=l.da();m<g;m++)if(0<l.Ja(m)){if(l.Rj(m,E),!w.isIntersecting(E)||(v=l.Na(l.Ba(m)),(v=f.Dg.wm(A,v,0))==0))return!1;M||(!f.Dg.Ml(o,l.da()-1)||o.Bb!=null&&o.Bb.Fb!=null?A=o:(v=new f.Da,o.copyTo(v),v.fj(1),A=v),M=!0)}if(o.da()==1||l.getType()==1607)return!0;for(w=new f.l,l.A(w),w.W(h,h),E=l,A=!1,h=new f.l,m=0,g=o.da();m<g;m++)if(0<o.Ja(m)){if(o.Rj(m,h),w.isIntersecting(h)&&(v=o.Na(o.Ba(m)),(v=f.Dg.wm(E,v,0))==1))return!1;A||(!f.Dg.Ml(l,o.da()-1)||l.Bb!=null&&l.Bb.Fb!=null?E=l:(v=new f.Da,l.copyTo(v),v.fj(1),E=v),A=!0)}return!0}return!1},c.JI=function(o,l,h,m){for(var g=o.Ga(),v=l.Ga(),w=[0,0],E=[0,0],A=new f.Zl(o,l,h,!1),M=!1;A.next();){var I=A.nl(),D=A.hl();if(g.Vb(I),v.Vb(D),I=g.ha(),(I=v.ha().Ea(I,null,E,w,h))==2)M=!0;else if(I!=0){if(M=w[0],I=E[0],0<M&&1>M&&0<I&&1>I)return!1;M=!0}}return!!M&&(v=new f.l,w=new f.l,g=new f.l,o.A(v),l.A(w),v.W(1e3*h,1e3*h),w.W(1e3*h,1e3*h),g.K(v),g.Ea(w),!(10<o.I()&&(o=f.Ud.clip(o,g,h,0),o.B())||10<l.I()&&(l=f.Ud.clip(l,g,h,0),l.B()))&&f.am.$m(o,l,h,"F********",m))},c.DI=function(o,l,h,m){for(var g=o.Ga(),v=l.Ga(),w=[0,0],E=[0,0],A=new f.Zl(o,l,h,!1),M=!1;A.next();){var I=A.nl(),D=A.hl();if(g.Vb(I),v.Vb(D),I=g.ha(),(I=v.ha().Ea(I,null,E,w,h))==2)M=!0;else if(I!=0){if(M=w[0],I=E[0],0<M&&1>M&&0<I&&1>I)return!0;M=!0}}return!!M&&(v=new f.l,w=new f.l,E=new f.l,A=new f.l,g=new f.l,o.A(v),l.A(w),c.ls(w,v,h)?(E.K(v),E.W(1e3*h,1e3*h),A.K(w),A.W(1e3*h,1e3*h),g.K(E),g.Ea(A),!(10<o.I()&&(o=f.Ud.clip(o,g,h,0),o.B())||10<l.I()&&(l=f.Ud.clip(l,g,h,0),l.B()))&&(h=f.am.$m(o,l,h,"T********",m))):h=f.am.$m(o,l,h,"T*****T**",m))},c.CI=function(o,l,h,m){var g=[!1],v=c.zI(o,l,h,g);return g[0]?v:(g=new f.l,l.A(g),g.W(1e3*h,1e3*h),!(10<o.I()&&(o=f.Ud.clip(o,g,h,0),o.B()))&&f.am.fB(o,l,h,m))},c.AI=function(o,l,h){return f.hd.Yd(o,l,h)==1},c.HI=function(o,l,h){return f.hd.Yd(o,l,h)==2},c.kt=function(o,l,h){var m=new f.h;h*=h;for(var g=0;g<o.I();g++)if(o.D(g,m),f.h.yc(m,l)<=h)return!1;return!0},c.prototype.QE=function(o,l){return o=this.rh[o],l=this.rh[l],o.Mm<l.Mm||o.Mm==l.Mm&&(o.pw<l.pw||o.pw==l.pw&&(o.Kj<l.Kj||o.Kj==l.Kj&&(o.Si<l.Si||o.Si==l.Si&&o.BH<l.BH)))?-1:1},c}();f.ud=d}(Q||(Q={})),function(f){var L,x,d;(x=L||(L={}))[x.InteriorInterior=0]="InteriorInterior",x[x.InteriorBoundary=1]="InteriorBoundary",x[x.InteriorExterior=2]="InteriorExterior",x[x.BoundaryInterior=3]="BoundaryInterior",x[x.BoundaryBoundary=4]="BoundaryBoundary",x[x.BoundaryExterior=5]="BoundaryExterior",x[x.ExteriorInterior=6]="ExteriorInterior",x[x.ExteriorBoundary=7]="ExteriorBoundary",x[x.ExteriorExterior=8]="ExteriorExterior",function(c){c[c.AreaAreaPredicates=0]="AreaAreaPredicates",c[c.AreaLinePredicates=1]="AreaLinePredicates",c[c.LineLinePredicates=2]="LineLinePredicates",c[c.AreaPointPredicates=3]="AreaPointPredicates",c[c.LinePointPredicates=4]="LinePointPredicates",c[c.PointPointPredicates=5]="PointPointPredicates"}(d||(d={})),L=function(){function c(){this.le=0,this.j=new f.iu,this.J=[0,0,0,0,0,0,0,0,0],this.Za=[0,0,0,0,0,0,0,0,0],this.ea=[!1,!1,!1,!1,!1,!1,!1,!1,!1],this.Sm=this.vw=-1}return c.yB=function(o,l,h,m,g){if(m.length!=9)throw f.i.fa("relation string length has to be 9 characters");for(var v=0;9>v;v++){var w=m.charAt(v);if(w!="*"&&w!="T"&&w!="F"&&w!="0"&&w!="1"&&w!="2")throw f.i.fa("relation string")}if((v=this.MR(m,o.Db(),l.Db()))!=0)return f.ud.zB(o,l,h,v,g);v=new f.l,o.A(v),w=new f.l,l.A(w);var E=new f.l;if(E.K(v),E.Zb(w),h=f.ta.Wd(h,E,!1),o=this.WE(o,h),l=this.WE(l,h),o.B()||l.B())return this.uW(o,l,m);switch(v=o.getType(),w=l.getType(),E=!1,v){case 1736:switch(w){case 1736:E=this.rt(o,l,h,m,g);break;case 1607:E=this.$m(o,l,h,m,g);break;case 33:E=this.qt(o,l,h,m);break;case 550:E=this.pt(o,l,h,m,g)}break;case 1607:switch(w){case 1736:E=this.$m(l,o,h,this.Zp(m),g);break;case 1607:E=this.gB(o,l,h,m,g);break;case 33:E=this.tt(o,l,h,m,g);break;case 550:E=this.st(o,l,h,m,g)}break;case 33:switch(w){case 1736:E=this.qt(l,o,h,this.Zp(m));break;case 1607:E=this.tt(l,o,h,this.Zp(m),g);break;case 33:E=this.$U(o,l,h,m);break;case 550:E=this.lt(l,o,h,this.Zp(m))}break;case 550:switch(w){case 1736:E=this.pt(l,o,h,this.Zp(m),g);break;case 1607:E=this.st(l,o,h,this.Zp(m),g);break;case 550:E=this.ZA(o,l,h,m,g);break;case 33:E=this.lt(o,l,h,m)}break;default:E=!1}return E},c.rt=function(o,l,h,m,g){var v=new c;v.Yi(),v.bj(m),v.xJ();var w=new f.l,E=new f.l;return o.A(w),l.A(E),m=!1,f.ud.dk(w,E,h)&&(v.Cu(o,l),m=!0),m||((w=f.ud.qc(o,l,!1))==4?(v.Cu(o,l),m=!0):w==1?(v.ly(l),m=!0):w==2&&(v.ZD(o),m=!0)),m||(o=(m=new f.gd).Ib(o),l=m.Ib(l),v.Wo(m,h,g),v.Bp(o,l),v.j.Ug()),c.fg(v.J,v.Xc)},c.Sw=function(o,l,h,m){var g=new c;g.Yi(),g.bj("T*****F**"),g.xJ();var v=new f.l,w=new f.l;o.A(v),l.A(w);var E=!1;return f.ud.dk(v,w,h)&&(g.Cu(o,l),E=!0),E||((v=f.ud.qc(o,l,!1))==4?(g.Cu(o,l),E=!0):v==1?(g.ly(l),E=!0):v==2&&(g.ZD(o),E=!0)),E?this.fg(g.J,g.Xc):(o=(E=new f.gd).Ib(o),v=E.Ib(l),f.Tk.V(E,h,m,!1),h=E.Ne(v).mg(),E.Gp(0,!0,!0),f.rn.V(E,o,-1,!1,m),E.I(o)!=0&&(f.rn.V(E,v,-1,!1,m),g.er(E,m),(l=E.I(v)==0)||(g.Bp(o,v),g.j.Ug(),v=this.fg(g.J,g.Xc))?(o=E.Ne(o),o=(E=new f.gd).Ib(o),v=E.Ib(h),g.er(E,m),g.le=0,g.Yi(),g.bj(l?"T*****F**":"******F**"),g.IB(),g.Bp(o,v),g.j.Ug(),this.fg(g.J,g.Xc)):v))},c.$m=function(o,l,h,m,g){var v=new c;v.Yi(),v.bj(m),v.IB();var w=new f.l,E=new f.l;return o.A(w),l.A(E),m=!1,f.ud.dk(w,E,h)&&(v.Du(o,l),m=!0),m||((w=f.ud.qc(o,l,!1))==4?(v.Du(o,l),m=!0):w==1&&(v.$D(l),m=!0)),m||(o=(m=new f.gd).Ib(o),l=m.Ib(l),v.Wo(m,h,g),v.kh=v.j.Dp(),c.Jw(l,v.j,v.kh),v.Bp(o,l),v.j.Ep(v.kh),v.j.Ug()),c.fg(v.J,v.Xc)},c.fB=function(o,l,h,m){var g=new c;g.Yi(),g.bj("T*****F**"),g.IB();var v=new f.l,w=new f.l;o.A(v),l.A(w);var E=!1;return f.ud.dk(v,w,h)&&(g.Du(o,l),E=!0),E||((v=f.ud.qc(o,l,!1))==4?(g.Du(o,l),E=!0):v==1&&(g.$D(l),E=!0)),E?this.fg(g.J,g.Xc):(o=(E=new f.gd).Ib(o),l=E.Ib(l),g.Wo(E,h,m),E.I(o)!=0&&(g.Bp(o,l),g.j.Ug(),this.fg(g.J,g.Xc)))},c.pt=function(o,l,h,m,g){var v=new c;v.Yi(),v.bj(m),v.yJ();var w=new f.l,E=new f.l;return o.A(w),l.A(E),m=!1,f.ud.dk(w,E,h)&&(v.Eu(o),m=!0),m||((w=f.ud.qc(o,l,!1))==4?(v.Eu(o),m=!0):w==1&&(v.zN(),m=!0)),m||(o=(m=new f.gd).Ib(o),l=m.Ib(l),v.Wo(m,h,g),v.Gy(o,l),v.j.Ug()),c.fg(v.J,v.Xc)},c.gB=function(o,l,h,m,g){var v=new c;v.Yi(),v.bj(m),v.eX(),m=new f.l;var w=new f.l;o.A(m),l.A(w);var E=!1;return f.ud.dk(m,w,h)&&(v.PG(o,l),E=!0),E||f.ud.qc(o,l,!1)!=4||(v.PG(o,l),E=!0),E||(o=(m=new f.gd).Ib(o),l=m.Ib(l),v.Wo(m,h,g),v.Yh=v.j.Dp(),v.kh=v.j.Dp(),c.Jw(o,v.j,v.Yh),c.Jw(l,v.j,v.kh),v.Bp(o,l),v.j.Ep(v.Yh),v.j.Ep(v.kh),v.j.Ug()),c.fg(v.J,v.Xc)},c.st=function(o,l,h,m,g){var v=new c;v.Yi(),v.bj(m),v.MJ(),m=new f.l;var w=new f.l;o.A(m),l.A(w);var E=!1;return f.ud.dk(m,w,h)&&(v.Vz(o),E=!0),E||f.ud.qc(o,l,!1)!=4||(v.Vz(o),E=!0),E||(o=(m=new f.gd).Ib(o),l=m.Ib(l),v.Wo(m,h,g),v.Yh=v.j.Dp(),c.Jw(o,v.j,v.Yh),v.Gy(o,l),v.j.Ep(v.Yh),v.j.Ug()),c.fg(v.J,v.Xc)},c.ZA=function(o,l,h,m,g){var v=new c;v.Yi(),v.bj(m),v.RJ(),m=new f.l;var w=new f.l;o.A(m),l.A(w);var E=!1;return f.ud.dk(m,w,h)&&(v.yI(),E=!0),E||(o=(m=new f.gd).Ib(o),l=m.Ib(l),v.Wo(m,h,g),v.Gy(o,l),v.j.Ug()),c.fg(v.J,v.Xc)},c.qt=function(o,l,h,m){var g=new c;g.Yi(),g.bj(m),g.yJ();var v=new f.l;o.A(v),l=l.D();var w=!1;return f.ud.Rw(l,v,h)&&(g.Eu(o),w=!0),w||((h=f.hd.Yd(o,l,h))==1?(g.J[0]=0,g.J[2]=2,g.J[3]=-1,g.J[5]=1,g.J[6]=-1):h==2?(g.J[6]=-1,o.Ke()!=0?(g.J[0]=-1,g.J[3]=0,g.J[2]=2,g.J[5]=1):(g.J[0]=0,g.J[3]=-1,g.J[5]=-1,h=new f.l,o.A(h),g.J[2]=h.ca()==0&&h.R()==0?-1:1)):g.Eu(o)),this.fg(g.J,m)},c.tt=function(o,l,h,m,g){var v=new c;v.Yi(),v.bj(m),v.MJ();var w=new f.l;o.A(w),m=l.D();var E=!1;if(f.ud.Rw(m,w,h)&&(v.Vz(o),E=!0),!E){w=null;var A=E=!1;(v.ea[0]||v.ea[6])&&(f.ud.Yz(o,m,h)?(v.ea[0]&&(w=f.pi.gm(o,g),A=!f.ud.kt(w,m,h),E=!0,v.J[0]=A?-1:0),v.J[6]=-1):(v.J[0]=-1,v.J[6]=0)),v.ea[3]&&(w!=null&&w.B()?v.J[3]=-1:(E||(w==null&&(w=f.pi.gm(o,g)),A=!f.ud.kt(w,m,h),E=!0),v.J[3]=A?0:-1)),v.ea[5]&&(w!=null&&w.B()?v.J[5]=-1:E&&!A?v.J[5]=0:(w==null&&(w=f.pi.gm(o,g)),g=f.ud.Nw(w,l,h),v.J[5]=g?-1:0)),v.ea[2]&&(o.Qb()!=0?v.J[2]=1:((g=new f.de(o.description)).Fd(o,0,o.I()),o=f.ud.Nw(g,l,h),v.J[2]=o?-1:0))}return this.fg(v.J,v.Xc)},c.lt=function(o,l,h,m){var g=new c;g.Yi(),g.bj(m),g.RJ();var v=new f.l;o.A(v),l=l.D();var w=!1;if(f.ud.Rw(l,v,h)&&(g.yI(),w=!0),!w){v=!1,w=!0,h*=h;for(var E=0;E<o.I();E++){var A=o.Na(E);if(f.h.yc(A,l)<=h?v=!0:w=!1,v&&!w)break}v?(g.J[0]=0,g.J[2]=w?-1:0,g.J[6]=-1):(g.J[0]=-1,g.J[2]=0,g.J[6]=0)}return c.fg(g.J,m)},c.$U=function(o,l,h,m){o=o.D(),l=l.D();for(var g=[],v=0;9>v;v++)g[v]=-1;return f.h.yc(o,l)<=h*h?g[0]=0:(g[2]=0,g[6]=0),g[8]=2,c.fg(g,m)},c.fg=function(o,l){for(var h=0;9>h;h++)switch(l.charAt(h)){case"T":if(o[h]==-1)return!1;break;case"F":if(o[h]!=-1)return!1;break;case"0":if(o[h]!=0)return!1;break;case"1":if(o[h]!=1)return!1;break;case"2":if(o[h]!=2)return!1}return!0},c.uW=function(o,l,h){var m=[-1,-1,-1,-1,-1,-1,-1,-1,-1];if(o.B()&&l.B()){for(var g=0;9>g;g++)m[g]=-1;return this.fg(m,h)}return g=!1,o.B()&&(o=l,g=!0),m[0]=-1,m[1]=-1,m[3]=-1,m[4]=-1,m[6]=-1,m[7]=-1,m[8]=2,l=o.getType(),f.aa.Hc(l)?l==1736?o.Ke()!=0?(m[2]=2,m[5]=1):(m[5]=-1,l=new f.l,o.A(l),m[2]=l.ca()==0&&l.R()==0?0:1):(l=o.Qb()!=0,m[2]=l?1:0,m[5]=f.pi.aq(o)?0:-1):(m[2]=0,m[5]=-1),g&&this.vK(m),this.fg(m,h)},c.MR=function(o,l,h){return c.dQ(o)?3:c.UP(o)?4:c.cY(o,l,h)?8:c.CP(o,l,h)?16:c.eP(o)?1:c.EU(o,l,h)?32:0},c.dQ=function(o){return o.charAt(0)=="T"&&o.charAt(1)=="*"&&o.charAt(2)=="F"&&o.charAt(3)=="*"&&o.charAt(4)=="*"&&o.charAt(5)=="F"&&o.charAt(6)=="F"&&o.charAt(7)=="F"&&o.charAt(8)=="*"},c.UP=function(o){return o.charAt(0)=="F"&&o.charAt(1)=="F"&&o.charAt(2)=="*"&&o.charAt(3)=="F"&&o.charAt(4)=="F"&&o.charAt(5)=="*"&&o.charAt(6)=="*"&&o.charAt(7)=="*"&&o.charAt(8)=="*"},c.cY=function(o,l,h){return(l!=0||h!=0)&&((l!=2||h!=2)&&(o.charAt(0)=="F"&&o.charAt(1)=="*"&&o.charAt(2)=="*"&&o.charAt(3)=="T"&&o.charAt(4)=="*"&&o.charAt(5)=="*"&&o.charAt(6)=="*"&&o.charAt(7)=="*"&&o.charAt(8)=="*"||l==1&&h==1&&o.charAt(0)=="F"&&o.charAt(1)=="T"&&o.charAt(2)=="*"&&o.charAt(3)=="*"&&o.charAt(4)=="*"&&o.charAt(5)=="*"&&o.charAt(6)=="*"&&o.charAt(7)=="*"&&o.charAt(8)=="*")||h!=0&&o.charAt(0)=="F"&&o.charAt(1)=="*"&&o.charAt(2)=="*"&&o.charAt(3)=="*"&&o.charAt(4)=="T"&&o.charAt(5)=="*"&&o.charAt(6)=="*"&&o.charAt(7)=="*"&&o.charAt(8)=="*")},c.CP=function(o,l,h){return l>h?o.charAt(0)=="T"&&o.charAt(1)=="*"&&o.charAt(2)=="*"&&o.charAt(3)=="*"&&o.charAt(4)=="*"&&o.charAt(5)=="*"&&o.charAt(6)=="T"&&o.charAt(7)=="*"&&o.charAt(8)=="*":l==1&&h==1&&o.charAt(0)=="0"&&o.charAt(1)=="*"&&o.charAt(2)=="*"&&o.charAt(3)=="*"&&o.charAt(4)=="*"&&o.charAt(5)=="*"&&o.charAt(6)=="*"&&o.charAt(7)=="*"&&o.charAt(8)=="*"},c.eP=function(o){return o.charAt(0)=="T"&&o.charAt(1)=="*"&&o.charAt(2)=="*"&&o.charAt(3)=="*"&&o.charAt(4)=="*"&&o.charAt(5)=="*"&&o.charAt(6)=="F"&&o.charAt(7)=="F"&&o.charAt(8)=="*"},c.EU=function(o,l,h){if(l==h){if(l!=1)return o.charAt(0)=="T"&&o.charAt(1)=="*"&&o.charAt(2)=="T"&&o.charAt(3)=="*"&&o.charAt(4)=="*"&&o.charAt(5)=="*"&&o.charAt(6)=="T"&&o.charAt(7)=="*"&&o.charAt(8)=="*";if(o.charAt(0)=="1"&&o.charAt(1)=="*"&&o.charAt(2)=="T"&&o.charAt(3)=="*"&&o.charAt(4)=="*"&&o.charAt(5)=="*"&&o.charAt(6)=="T"&&o.charAt(7)=="*"&&o.charAt(8)=="*")return!0}return!1},c.Jw=function(o,l,h){o=l.La(o);for(var m=l.Re;m!=-1;m=l.Rf(m))if(l.xd(m)&o){var g=l.Me(m);if(g==-1)l.nn(m,h,0);else{var v=g,w=0;do l.dh(v)&o&&w++,v=l.jc(l.xa(v));while(v!=g);l.nn(m,h,w)}}},c.Zp=function(o){var l=""+o.charAt(0);return l+=o.charAt(3),l+=o.charAt(6),l+=o.charAt(1),l+=o.charAt(4),l+=o.charAt(7),l+=o.charAt(2),(l+=o.charAt(5))+o.charAt(8)},c.prototype.Yi=function(){for(var o=0;9>o;o++)this.J[o]=-2,this.Za[o]=-2},c.vK=function(o){var l=o[1],h=o[2],m=o[5];o[1]=o[3],o[2]=o[6],o[5]=o[7],o[3]=l,o[6]=h,o[7]=m},c.prototype.bj=function(o){for(this.Xc=o,o=0;9>o;o++)this.Xc.charAt(o)!="*"?(this.ea[o]=!0,this.le++):this.ea[o]=!1},c.prototype.UJ=function(){for(var o=0;9>o;o++)this.ea[o]&&this.J[o]==-2&&(this.J[o]=-1,this.ea[o]=!1)},c.prototype.pc=function(o){return this.J[o]!=-2&&(this.J[o]==-1?(this.ea[o]=!1,this.le--,!0):this.Xc.charAt(o)!="T"&&this.Xc.charAt(o)!="F"?!(this.J[o]<this.Za[o])&&(this.ea[o]=!1,this.le--,!0):(this.ea[o]=!1,this.le--,!0))},c.prototype.xJ=function(){this.vw=0,this.Za[0]=2,this.Za[1]=1,this.Za[2]=2,this.Za[3]=1,this.Za[4]=1,this.Za[5]=1,this.Za[6]=2,this.Za[7]=1,this.Za[8]=2,this.ea[8]&&(this.J[8]=2,this.ea[8]=!1,this.le--)},c.prototype.IB=function(){this.vw=1,this.Sm=3,this.Za[0]=1,this.Za[1]=0,this.Za[2]=2,this.Za[3]=1,this.Za[4]=0,this.Za[5]=1,this.Za[6]=1,this.Za[7]=0,this.Za[8]=2,this.ea[8]&&(this.J[8]=2,this.ea[8]=!1,this.le--)},c.prototype.eX=function(){this.vw=2,this.Sm=4,this.Za[0]=1,this.Za[1]=0,this.Za[2]=1,this.Za[3]=0,this.Za[4]=0,this.Za[5]=0,this.Za[6]=1,this.Za[7]=0,this.Za[8]=2,this.ea[8]&&(this.J[8]=2,this.ea[8]=!1,this.le--)},c.prototype.yJ=function(){this.Sm=3,this.Za[0]=0,this.Za[1]=-1,this.Za[2]=2,this.Za[3]=0,this.Za[4]=-1,this.Za[5]=1,this.Za[6]=0,this.Za[7]=-1,this.Za[8]=2,this.ea[1]&&(this.J[1]=-1,this.ea[1]=!1,this.le--),this.ea[4]&&(this.J[4]=-1,this.ea[4]=!1,this.le--),this.ea[7]&&(this.J[7]=-1,this.ea[7]=!1,this.le--),this.ea[8]&&(this.J[8]=2,this.ea[8]=!1,this.le--)},c.prototype.MJ=function(){this.Sm=4,this.Za[0]=0,this.Za[1]=-1,this.Za[2]=1,this.Za[3]=0,this.Za[4]=-1,this.Za[5]=0,this.Za[6]=0,this.Za[7]=-1,this.Za[8]=2,this.ea[1]&&(this.J[1]=-1,this.ea[1]=!1,this.le--),this.ea[4]&&(this.J[4]=-1,this.ea[4]=!1,this.le--),this.ea[7]&&(this.J[7]=-1,this.ea[7]=!1,this.le--),this.ea[8]&&(this.J[8]=2,this.ea[8]=!1,this.le--)},c.prototype.RJ=function(){this.Sm=5,this.Za[0]=0,this.Za[1]=-1,this.Za[2]=0,this.Za[3]=-1,this.Za[4]=-1,this.Za[5]=-1,this.Za[6]=0,this.Za[7]=-1,this.Za[8]=2,this.ea[1]&&(this.J[1]=-1,this.ea[1]=!1,this.le--),this.ea[3]&&(this.J[3]=-1,this.ea[3]=!1,this.le--),this.ea[4]&&(this.J[4]=-1,this.ea[4]=!1,this.le--),this.ea[5]&&(this.J[5]=-1,this.ea[5]=!1,this.le--),this.ea[7]&&(this.J[7]=-1,this.ea[7]=!1,this.le--),this.ea[8]&&(this.J[8]=2,this.ea[8]=!1,this.le--)},c.prototype.xN=function(o,l,h){var m=!0;return this.ea[0]&&(this.CS(o,l,h),m=m&&this.pc(0)),this.ea[1]&&(this.sG(o,l,1),m=m&&this.pc(1)),this.ea[2]&&(this.tG(o,l,h,2),m=m&&this.pc(2)),this.ea[3]&&(this.sG(o,h,3),m=m&&this.pc(3)),this.ea[4]&&(this.BN(o,l,h),m=m&&this.pc(4)),this.ea[5]&&(this.eE(o,h,5),m=m&&this.pc(5)),this.ea[6]&&(this.tG(o,h,l,6),m=m&&this.pc(6)),this.ea[7]&&(this.eE(o,l,7),m=m&&this.pc(7)),m},c.prototype.Cu=function(o,l){this.J[0]=-1,this.J[1]=-1,this.J[3]=-1,this.J[4]=-1,this.Fr(o,this.ea[2]?2:-1,this.Xc.charAt(2),this.ea[5]?5:-1,this.Xc.charAt(5)),this.Fr(l,this.ea[6]?6:-1,this.Xc.charAt(6),this.ea[7]?7:-1,this.Xc.charAt(7))},c.prototype.Fr=function(o,l,h,m,g){l==-1&&m==-1||((h!="T"&&h!="F"&&l!=-1||g!="T"&&g!="F"&&m!=-1)&&o.Ke()==0?(m!=-1&&(this.J[m]=-1),l!=-1&&(h=new f.l,o.A(h),this.J[l]=h.ca()==0&&h.R()==0?0:1)):(l!=-1&&(this.J[l]=2),m!=-1&&(this.J[m]=1)))},c.prototype.ly=function(o){this.J[2]=2,this.J[3]=-1,this.J[4]=-1,this.J[5]=1,this.J[6]=-1,this.J[7]=-1,this.Fr(o,this.ea[0]?0:-1,this.Xc.charAt(0),this.ea[1]?1:-1,this.Xc.charAt(1))},c.prototype.ZD=function(o){this.ly(o),c.vK(this.J)},c.prototype.Du=function(o,l){if(this.J[0]=-1,this.J[1]=-1,this.J[3]=-1,this.J[4]=-1,this.ea[6]){var h=this.Xc.charAt(6);h=h=="T"||h=="F"||l.Qb()!=0,this.J[6]=h?1:0}this.ea[7]&&(l=f.pi.aq(l),this.J[7]=l?0:-1),this.Fr(o,this.ea[2]?2:-1,this.Xc.charAt(2),this.ea[5]?5:-1,this.Xc.charAt(5))},c.prototype.$D=function(o){if(this.ea[0]){var l=this.Xc.charAt(0);l=l=="T"||l=="F"||o.Qb()!=0,this.J[0]=l?1:0}this.ea[1]&&(o=f.pi.aq(o),this.J[1]=o?0:-1),this.J[2]=2,this.J[3]=-1,this.J[4]=-1,this.J[5]=1,this.J[6]=-1,this.J[7]=-1},c.prototype.Eu=function(o){this.J[0]=-1,this.J[3]=-1,this.J[6]=0,this.Fr(o,this.ea[2]?2:-1,this.Xc.charAt(2),this.ea[5]?5:-1,this.Xc.charAt(5))},c.prototype.zN=function(){this.J[0]=0,this.J[2]=2,this.J[3]=-1,this.J[5]=1,this.J[6]=-1},c.prototype.PG=function(o,l){if(this.J[0]=-1,this.J[1]=-1,this.J[3]=-1,this.J[4]=-1,this.ea[2]){var h=this.Xc.charAt(2);h=h=="T"||h=="F"||o.Qb()!=0,this.J[2]=h?1:0}this.ea[5]&&(o=f.pi.aq(o),this.J[5]=o?0:-1),this.ea[6]&&(h=(h=this.Xc.charAt(6))=="T"||h=="F"||l.Qb()!=0,this.J[6]=h?1:0),this.ea[7]&&(l=f.pi.aq(l),this.J[7]=l?0:-1)},c.prototype.Vz=function(o){if(this.J[0]=-1,this.J[3]=-1,this.ea[2]){var l=this.Xc.charAt(2);l=l=="T"||l=="F"||o.Qb()!=0,this.J[2]=l?1:0}this.ea[5]&&(o=f.pi.aq(o),this.J[5]=o?0:-1),this.J[6]=0},c.prototype.yI=function(){this.J[0]=-1,this.J[2]=0,this.J[6]=0},c.prototype.yN=function(o,l,h){var m=!0;return this.ea[0]&&(this.DS(o,l),m=m&&this.pc(0)),this.ea[1]&&(this.zS(o,l,h,this.kh),m=m&&this.pc(1)),this.ea[2]&&(this.AS(o,l),m=m&&this.pc(2)),this.ea[3]&&(this.FN(o,l,h,this.kh),m=m&&this.pc(3)),this.ea[4]&&(this.CN(o,l,h,this.kh),m=m&&this.pc(4)),this.ea[5]&&(this.DN(o,l,h),m=m&&this.pc(5)),this.ea[6]&&(this.lQ(o,l),m=m&&this.pc(6)),this.ea[7]&&(this.kQ(o,l,h,this.kh),m=m&&this.pc(7)),m},c.prototype.mT=function(o,l,h){var m=!0;return this.ea[0]&&(this.GS(o,l,h,this.Yh,this.kh),m=m&&this.pc(0)),this.ea[1]&&(this.uG(o,l,h,this.Yh,this.kh,1),m=m&&this.pc(1)),this.ea[2]&&(this.vG(o,l,h,2),m=m&&this.pc(2)),this.ea[3]&&(this.uG(o,h,l,this.kh,this.Yh,3),m=m&&this.pc(3)),this.ea[4]&&(this.HN(o,l,h,this.Yh,this.kh),m=m&&this.pc(4)),this.ea[5]&&(this.fE(o,h,this.Yh,5),m=m&&this.pc(5)),this.ea[6]&&(this.vG(o,h,l,6),m=m&&this.pc(6)),this.ea[7]&&(this.fE(o,l,this.kh,7),m=m&&this.pc(7)),m},c.prototype.aE=function(o,l,h){var m=!0;return this.ea[0]&&(this.ES(o,l),m=m&&this.pc(0)),this.ea[2]&&(this.BS(o,l),m=m&&this.pc(2)),this.ea[3]&&(this.GN(o,l,h),m=m&&this.pc(3)),this.ea[5]&&(this.EN(o,l),m=m&&this.pc(5)),this.ea[6]&&(this.mQ(o,l),m=m&&this.pc(6)),m},c.prototype.QG=function(o,l,h){var m=!0;return this.ea[0]&&(this.HS(o,l,h,this.Yh),m=m&&this.pc(0)),this.ea[2]&&(this.FS(o,h),m=m&&this.pc(2)),this.ea[3]&&(this.JN(o,l,h,this.Yh),m=m&&this.pc(3)),this.ea[5]&&(this.IN(o,l,h,this.Yh),m=m&&this.pc(5)),this.ea[6]&&(this.nQ(o,l,h),m=m&&this.pc(6)),m},c.prototype.ZU=function(o,l,h){var m=!0;return this.ea[0]&&(this.IS(o,l,h),m=m&&this.pc(0)),this.ea[2]&&(this.wG(o,l,h,2),m=m&&this.pc(2)),this.ea[6]&&(this.wG(o,h,l,6),m=m&&this.pc(6)),m},c.prototype.CS=function(o,l,h){this.J[0]!=2&&(o=this.j.af(o))&l&&o&h&&(this.J[0]=2)},c.prototype.sG=function(o,l,h){if(this.J[h]!=1){var m=this.j.af(this.j.xa(o));this.j.af(o)&l&&m&l&&(this.J[h]=1)}},c.prototype.tG=function(o,l,h,m){this.J[m]!=2&&(o=this.j.af(o))&l&&!(o&h)&&(this.J[m]=2)},c.prototype.BN=function(o,l,h){if(this.J[4]!=1){var m=this.j.dh(o);m&l&&m&h?this.J[4]=1:this.J[4]!=0&&this.j.Ab(this.j.te(this.j.xa(o)),this.Ui)!=1&&(o=this.j.xd(this.j.uf(o)))&l&&o&h&&(this.J[4]=0)}},c.prototype.eE=function(o,l,h){if(this.J[h]!=1){var m=this.j.af(this.j.xa(o));!(this.j.af(o)&l)&&!(m&l)&&(this.J[h]=1)}},c.prototype.DS=function(o,l){if(this.J[0]!=1){var h=this.j.af(this.j.xa(o));this.j.af(o)&l&&h&l&&(this.J[0]=1)}},c.prototype.zS=function(o,l,h,m){if(this.J[1]!=0&&this.j.Ab(this.j.te(this.j.xa(o)),this.Ui)!=1){var g=this.j.uf(o),v=this.j.xd(g);!(v&l)&&this.j.af(o)&l&&(o=this.j.ng(g,m),v&h&&o%2!=0&&(this.J[1]=0))}},c.prototype.AS=function(o,l){this.J[2]!=2&&this.j.dh(o)&l&&(this.J[2]=2)},c.prototype.FN=function(o,l,h,m){if(this.J[3]!=1){var g=this.j.dh(o);g&l&&g&h?this.J[3]=1:this.J[3]!=0&&this.j.Ab(this.j.te(this.j.xa(o)),this.Ui)!=1&&(g=this.j.uf(o),(o=this.j.xd(g))&l&&(l=this.j.ng(g,m),o&h&&l%2==0&&(this.J[3]=0)))}},c.prototype.CN=function(o,l,h,m){if(this.J[4]!=0&&this.j.Ab(this.j.te(this.j.xa(o)),this.Ui)!=1){var g=this.j.uf(o);(o=this.j.xd(g))&l&&(l=this.j.ng(g,m),o&h&&l%2!=0&&(this.J[4]=0))}},c.prototype.DN=function(o,l,h){this.J[5]!=1&&(o=this.j.dh(o))&l&&!(o&h)&&(this.J[5]=1)},c.prototype.lQ=function(o,l){if(this.J[6]!=1){var h=this.j.af(this.j.xa(o));!(this.j.af(o)&l)&&!(h&l)&&(this.J[6]=1)}},c.prototype.kQ=function(o,l,h,m){if(this.J[7]!=0&&this.j.Ab(this.j.te(this.j.xa(o)),this.Ui)!=1){var g=this.j.uf(o),v=this.j.xd(g);!(v&l)&&!(this.j.af(o)&l)&&(o=this.j.ng(g,m),v&h&&o%2!=0&&(this.J[7]=0))}},c.prototype.GS=function(o,l,h,m,g){if(this.J[0]!=1){var v=this.j.dh(o);v&l&&v&h?this.J[0]=1:this.J[0]!=0&&this.j.Ab(this.j.te(this.j.xa(o)),this.Ui)!=1&&(o=this.j.uf(o),(v=this.j.xd(o))&l&&v&h&&(l=this.j.ng(o,m),g=this.j.ng(o,g),l%2==0&&g%2==0&&(this.J[0]=0)))}},c.prototype.uG=function(o,l,h,m,g,v){if(this.J[v]!=0&&this.j.Ab(this.j.te(this.j.xa(o)),this.Ui)!=1){o=this.j.uf(o);var w=this.j.xd(o);w&l&&w&h&&(l=this.j.ng(o,m),g=this.j.ng(o,g),l%2==0&&g%2!=0&&(this.J[v]=0))}},c.prototype.vG=function(o,l,h,m){this.J[m]!=1&&(o=this.j.dh(o))&l&&!(o&h)&&(this.J[m]=1)},c.prototype.HN=function(o,l,h,m,g){if(this.J[4]!=0&&this.j.Ab(this.j.te(this.j.xa(o)),this.Ui)!=1){o=this.j.uf(o);var v=this.j.xd(o);v&l&&v&h&&(l=this.j.ng(o,m),g=this.j.ng(o,g),l%2!=0&&g%2!=0&&(this.J[4]=0))}},c.prototype.fE=function(o,l,h,m){this.J[m]!=0&&this.j.Ab(this.j.te(this.j.xa(o)),this.Ui)!=1&&(o=this.j.uf(o),!(this.j.xd(o)&l)&&this.j.ng(o,h)%2!=0&&(this.J[m]=0))},c.prototype.ES=function(o,l){this.J[0]!=0&&!(this.j.xd(o)&l)&&this.j.hk(this.j.cz(o))&l&&(this.J[0]=0)},c.prototype.BS=function(o,l){this.J[2]!=2&&this.j.xd(o)&l&&(this.J[2]=2)},c.prototype.GN=function(o,l,h){this.J[3]!=0&&(o=this.j.xd(o))&l&&o&h&&(this.J[3]=0)},c.prototype.EN=function(o,l){this.J[5]!=1&&this.j.xd(o)&l&&(this.J[5]=1)},c.prototype.mQ=function(o,l){this.J[6]!=0&&!(this.j.xd(o)&l)&&!(this.j.hk(this.j.cz(o))&l)&&(this.J[6]=0)},c.prototype.HS=function(o,l,h,m){if(this.J[0]!=0){var g=this.j.xd(o);g&l&&g&h&&this.j.ng(o,m)%2==0&&(this.J[0]=0)}},c.prototype.FS=function(o,l){this.J[2]!=1&&(this.j.Me(o)!=-1?this.J[2]=1:this.J[2]!=0&&!(this.j.xd(o)&l)&&(this.J[2]=0))},c.prototype.JN=function(o,l,h,m){if(this.J[3]!=0){var g=this.j.xd(o);g&l&&g&h&&this.j.ng(o,m)%2!=0&&(this.J[3]=0)}},c.prototype.IN=function(o,l,h,m){if(this.J[5]!=0){var g=this.j.xd(o);g&l&&!(g&h)&&this.j.ng(o,m)%2!=0&&(this.J[5]=0)}},c.prototype.nQ=function(o,l,h){this.J[6]!=0&&!((o=this.j.xd(o))&l)&&o&h&&(this.J[6]=0)},c.prototype.IS=function(o,l,h){this.J[0]!=0&&(o=this.j.xd(o))&l&&o&h&&(this.J[0]=0)},c.prototype.wG=function(o,l,h,m){this.J[m]!=0&&(o=this.j.xd(o))&l&&!(o&h)&&(this.J[m]=0)},c.prototype.Bp=function(o,l){var h=!1;o=this.j.La(o),l=this.j.La(l),this.Ui=this.j.$g();for(var m=this.j.Re;m!=-1;m=this.j.Rf(m)){var g=this.j.Me(m);if(g==-1){if(this.Sm!=-1)switch(this.Sm){case 3:h=this.aE(m,o,l);break;case 4:h=this.QG(m,o,l);break;default:throw f.i.fa("internal error")}}else{var v=g;do{var w=v;if(this.j.Ab(w,this.Ui)!=1)do{switch(this.vw){case 0:h=this.xN(w,o,l);break;case 1:h=this.yN(w,o,l);break;case 2:h=this.mT(w,o,l);break;default:throw f.i.fa("internal error")}if(h)break;this.j.Kb(w,this.Ui,1),w=this.j.jc(w)}while(w!=v&&!h);if(h)break;v=this.j.jc(this.j.xa(w))}while(v!=g);if(h)break}}h||this.UJ(),this.j.Jg(this.Ui)},c.prototype.Gy=function(o,l){var h=!1;o=this.j.La(o),l=this.j.La(l);for(var m=this.j.Re;m!=-1;m=this.j.Rf(m)){switch(this.Sm){case 3:h=this.aE(m,o,l);break;case 4:h=this.QG(m,o,l);break;case 5:h=this.ZU(m,o,l);break;default:throw f.i.Qa()}if(h)break}h||this.UJ()},c.prototype.er=function(o,l){this.j.dr(o,l)},c.prototype.Wo=function(o,l,h){this.YP(o,l,h),this.er(o,h)},c.prototype.YP=function(o,l,h){for(f.Tk.V(o,l,h,!1),o.Gp(0,!0,!0),l=o.ld;l!=-1;l=o.ue(l))o.ic(l)==1736&&f.rn.V(o,l,-1,!1,h)},c.WE=function(o,l){var h=o.getType();return f.aa.yd(h)?((l=new f.Ta(o.description)).oc(o,!0),l):h==197?(h=new f.l,o.A(h),h.ca()<=l&&h.R()<=l?(l=new f.Sa(o.description),o.sf(l),l):h.ca()<=l||h.R()<=l?(l=new f.Ta(o.description),h=new f.Sa,o.Hf(0,h),l.nf(h),o.Hf(2,h),l.lineTo(h),l):((l=new f.Da(o.description)).ad(o,!1),l)):o},c}(),f.am=L}(Q||(Q={})),function(f){var L=function(){function c(o){this.Em=new f.ia(0),this.dw=new f.ia(0),this.wt=new f.h,this.xt=new f.h,this.g=o,this.Hs=-1}return c.prototype.bc=function(o){return this.g.bc(this.zz(o))},c.prototype.Bv=function(o){var l=this.iz(o);if(o=this.HF(o),this.g.Ma(l)==o){var h=l;l=o,o=h}return this.g.Gc(l,this.wt),this.g.Gc(o,this.xt),this.wt.y<this.xt.y},c.prototype.zz=function(o){var l=this.iz(o);return o=this.HF(o),this.g.U(l)==o?l:o},c.prototype.iz=function(o){return this.Em.get(o)},c.prototype.HF=function(o){return this.dw.get(o)},c.prototype.rF=function(o){this.Em.set(o,this.Hs),this.Hs=o},c.prototype.nI=function(o){if(this.Hs!=-1){var l=this.Hs;return this.Hs=this.Em.get(l),this.Em.set(l,o),this.dw.set(l,this.g.U(o)),l}return this.Em==null&&(this.Em=new f.ia(0),this.dw=new f.ia(0)),l=this.Em.size,this.Em.add(o),this.dw.add(this.g.U(o)),l},c.prototype.rz=function(o){return this.g.bd(this.iz(o))},c}();f.yY=L;var x=function(){function c(o){this.Be=o,this.ie=new f.yb,this.Nm=new f.yb,this.CH=0,this.Ao=null,this.yA=-1}return c.prototype.compare=function(o,l,h){h=o.ja(h);var m=this.Be.hb;if(this.yA==l)var g=this.CH;else this.Ao=m.bc(l),this.Ao==null?((o=m.g).ed(m.zz(l),this.ie),this.Ao=this.ie,g=this.ie.Pe(this.Be.yh,0)):g=this.Ao.Pe(this.Be.yh,0),this.CH=g,this.yA=l;if((o=m.bc(h))==null){(o=m.g).ed(m.zz(h),this.Nm),o=this.Nm;var v=this.Nm.Pe(this.Be.yh,0)}else v=o.Pe(this.Be.yh,0);return g==v&&(l=m.Bv(l),h=m.Bv(h),(l=.5*((h=Math.min(l?this.Ao.la:this.Ao.na,h?o.la:o.na))+this.Be.yh))==this.Be.yh&&(l=h),g=this.Ao.Pe(l,0),v=o.Pe(l,0)),g<v?-1:g>v?1:0},c.prototype.reset=function(){this.yA=-1},c}(),d=function(){function c(){this.Wm=this.Gl=null,this.fb=new f.Yj,this.fb.RP(),this.$d=new x(this),this.fb.Vo(this.$d)}return c.prototype.HQ=function(){var o=!1;if(this.fw&&(o=this.IQ()),this.g.da(this.X)==1){var l=this.g.Ob(this.X);return o=this.g.wz(l),this.g.PB(l,!0),0>o&&(o=this.g.Xa(l),this.g.pJ(o),this.g.Wg(l,this.g.Ma(o)),!0)}for(this.El=this.g.Ky(),this.wo=this.g.Ky(),l=this.g.Ob(this.X);l!=-1;l=this.g.Rb(l))this.g.gr(l,this.El,0),this.g.gr(l,this.wo,-1);l=new f.ia(0),this.yh=NaN;var h=new f.h;this.et=this.g.da(this.X),this.ro=this.g.Gd(),this.Rs=this.g.Gd();for(var m=this.Gl.rc(this.Gl.je);m!=-1;m=this.Gl.lb(m)){var g=this.Gl.getData(m);if(this.g.Gc(g,h),h.y!=this.yh&&l.size!=0&&(o=this.ut(l)||o,this.$d.reset(),l.clear(!1)),l.add(g),this.yh=h.y,this.et==0)break}for(0<this.et&&(o=this.ut(l)||o,l.clear(!1)),this.g.Td(this.ro),this.g.Td(this.Rs),l=this.g.Ob(this.X);l!=-1;)if(this.g.sj(l,this.El)==3){for(this.g.PB(l,!0),h=l,l=this.g.sj(l,this.wo);l!=-1;)m=this.g.sj(l,this.wo),this.g.ZT(this.X,this.g.Rb(h),l),h=l,l=m;l=this.g.Rb(h)}else this.g.PB(l,!1),l=this.g.Rb(l);return this.g.CB(this.El),this.g.CB(this.wo),o},c.prototype.ut=function(o){return this.$V(o)},c.prototype.$V=function(o){var l=!1;this.hb==null&&(this.hb=new L(this.g)),this.Wm==null?(this.Wm=new f.ia(0),this.Wm.Jb(16)):this.Wm.clear(!1),this.ZV(o);for(var h=0,m=o.size;h<m;h++){var g=o.get(h);g!=-1&&this.oG(g,-1)}for(h=0;h<this.Wm.size&&0<this.et;h++)if(o=this.Wm.get(h),g=this.hb.rz(this.fb.ja(o)),m=-1,this.g.sj(g,this.El)==0){g=this.fb.we(o);for(var v,w=o;g!=-1;){var E=this.fb.ja(g),A=this.hb.rz(E),M=this.g.sj(A,this.El);if(M!=0){m=A;break}w=g,g=this.fb.we(g)}g==-1?(v=!0,g=w):(E=this.fb.ja(g),v=this.hb.Bv(E),g=this.fb.lb(g),v=!v);do{if(E=this.fb.ja(g),A=this.hb.rz(E),(M=this.g.sj(A,this.El))==0&&(v!=this.hb.Bv(E)&&(l=this.g.Xa(A),this.g.pJ(l),this.g.Wg(A,this.g.Ma(l)),l=!0),this.g.gr(A,this.El,v?3:2),v||(w=this.g.sj(m,this.wo),this.g.gr(m,this.wo,A),this.g.gr(A,this.wo,w)),this.et--,this.et==0))return l;m=A,w=g,g=this.fb.lb(g),v=!v}while(w!=o)}return l},c.prototype.ZV=function(o){for(var l=0,h=o.size;l<h;l++){var m=o.get(l),g=this.g.Pa(m,this.ro),v=this.g.Pa(m,this.Rs);if(g!=-1){var w=this.fb.ja(g);this.hb.rF(w),this.g.Ra(m,this.ro,-1)}v!=-1&&(w=this.fb.ja(v),this.hb.rF(w),this.g.Ra(m,this.Rs,-1)),w=-1,g!=-1&&v!=-1?(this.fb.vd(g,-1),this.fb.vd(v,-1),o.set(l,-1)):w=g!=-1?g:v,w!=-1&&(this.oG(m,w)||this.fb.vd(w,-1),o.set(l,-1))}},c.prototype.oG=function(o,l){var h=new f.h,m=new f.h;this.g.Gc(o,h);var g=this.g.U(o);this.g.Gc(g,m);var v=!1;if(h.y<m.y){v=!0;var w=this.hb.nI(o);if(l==-1)var E=this.fb.addElement(w,-1);else E=l,this.fb.Sj(E,w);(w=this.g.Pa(g,this.ro))==-1?this.g.Ra(g,this.ro,E):this.g.Ra(g,this.Rs,E),g=this.g.bd(o),this.g.sj(g,this.El)==0&&this.Wm.add(E)}return g=this.g.Ma(o),this.g.Gc(g,m),h.y<m.y&&(v=!0,w=this.hb.nI(g),l==-1?E=this.fb.addElement(w,-1):(E=l,this.fb.Sj(E,w)),(w=this.g.Pa(g,this.ro))==-1?this.g.Ra(g,this.ro,E):this.g.Ra(g,this.Rs,E),g=this.g.bd(o),this.g.sj(g,this.El)==0&&this.Wm.add(E)),v},c.V=function(o,l,h,m){var g=new c;return g.g=o,g.X=l,g.Gl=h,g.fw=m,g.HQ()},c.prototype.IQ=function(){var o=new f.ia(0),l=new f.ia(0),h=-1,m=-1,g=new f.h;g.Rc();for(var v=-1,w=-1,E=-1,A=new f.h,M=this.Gl.rc(this.Gl.je);M!=-1;M=this.Gl.lb(M)){var I=this.Gl.getData(M);this.g.Gc(I,A);var D=this.g.bd(I);g.qb(A)&&w==D?(m==-1&&(h=this.g.Ky(),m=this.g.Gd()),E==-1&&(E=l.size,this.g.Ra(v,m,E),l.add(1),this.g.sj(D,h)==-1&&(this.g.gr(D,h,v),o.add(D))),this.g.Ra(I,m,E),l.bX(l.Fc()+1)):(E=-1,g.L(A)),v=I,w=D}if(o.size==0)return!1;for(g=new f.ia(0),v=new f.ia(0),w=0,E=o.size;w<E;w++){D=o.get(w);var k=this.g.sj(D,h);for(I=this.g.Pa(k,m),g.clear(!1),v.clear(!1),g.add(k),v.add(I),I=this.g.U(k);I!=k;I=this.g.U(I)){var B=I;if((A=this.g.Pa(B,m))!=-1)if(v.size==0)v.add(A),g.add(B);else if(v.Fc()==A){M=g.Fc();var J=this.g.U(M);k=this.g.U(B),this.g.Bc(M,k),this.g.Cc(k,M),this.g.Bc(B,J),this.g.Cc(J,B),B=[!1],J=this.g.nG(this.X,J,this.g.Xa(D),B),this.g.Ra(I,m,-1),B[0]&&this.g.Jf(D,k),I=this.g.Ja(D),I-=k=this.g.Ja(J),this.g.Vj(D,I),l.set(A,l.get(A)-1),l.get(A)==1&&(l.set(A,0),v.If(),g.If()),I=k=M}else g.add(I),v.add(A)}}return this.g.CB(h),this.g.Td(m),!0},c}();f.WL=d}(Q||(Q={})),function(f){var L=function(){function x(){}return x.prototype.ig=function(){this.PA=this.sb=null},x.prototype.get=function(){return this.PA},x.prototype.set=function(d){if(this.PA=d,d!=null)throw d.getType()==322&&(this.sb=d),f.i.Qa()},x.prototype.create=function(d){if(d!=322)throw f.i.fa("Not Implemented");this.Or()},x.prototype.Or=function(){this.sb==null&&(this.sb=new f.yb),this.PA=this.sb},x}();f.ig=L}(Q||(Q={})),function(f){(f=f.XL||(f.XL={}))[f.enumLineSeg=1]="enumLineSeg",f[f.enumBezierSeg=2]="enumBezierSeg",f[f.enumArcSeg=4]="enumArcSeg",f[f.enumNonlinearSegmentMask=6]="enumNonlinearSegmentMask",f[f.enumSegmentMask=7]="enumSegmentMask",f[f.enumDensified=8]="enumDensified"}(Q||(Q={})),function(f){var L=function(d){this.$i=d,this.qC=this.rC=1,this.sB=this.rB=this.tB=0},x=function(){function d(){this.Fq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.Bk=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.Bf=new f.Sa,this.qa=this.Cw=0,this.mo=[],this.$s=[],this.yw=[],this.Iq=[],this.MA=[]}return d.prototype.wB=function(c){if(c!=null){for(var o=0,l=c.length;o<l;o++)this.rW(c[o]);c.length=0}},d.prototype.rW=function(c){c.$i=null,this.Iq.push(c)},d.prototype.Ow=function(c){if(this.Iq.length===0)var o=new L(c);else(o=this.Iq[this.Iq.length-1]).$i=c,--this.Iq.length;return o},d.prototype.SR=function(c,o){return c==0?this.$s[o]:this.yw[o]},d.prototype.aB=function(){this.Cw>=this.MA.length&&this.MA.push(new f.ig);var c=this.MA[this.Cw];return this.Cw++,c},d.prototype.clear=function(){this.wB(this.mo),this.wB(this.$s),this.wB(this.yw),this.Cw=0},d.prototype.Oo=function(c){this.mo.push(this.Ow(c))},d.prototype.ol=function(c){return c==0?this.$s.length:this.yw.length},d.prototype.Vp=function(c,o){return this.SR(c,o).$i},d.prototype.Ea=function(c,o){if(this.mo.length!=2)throw f.i.Qa();this.qa=c;var l=f.lc.ox(.01*c),h=!1,m=this.mo[0],g=this.mo[1];if(o||5&m.$i.zr(g.$i,c,!0)){if(m.$i.getType()==322){var v=m.$i;if(g.$i.getType()==322){o=g.$i;var w=f.yb.Zx(v,o,null,this.Fq,this.Bk,c);if(w==0)throw f.yb.Zx(v,o,null,this.Fq,this.Bk,c),f.i.Qa();c=Array(9),f.O.$u(c,null);for(var E=0;E<w;E++){var A=this.Fq[E],M=this.Bk[E],I=m.sB,D=1;A==0?(I=m.tB,D=m.rC):A==1&&(I=m.rB,D=m.qC);var k=g.sB,B=1;M==0?(k=g.tB,B=g.rC):M==1&&(k=g.rB,B=g.qC);var J=new f.h;I==k?(I=new f.h,v.hc(A,I),A=new f.h,o.hc(M,A),B/=M=D+B,f.lc.OG(I,A,B,J),f.h.yc(J,I)+f.h.yc(J,A)>l&&(h=!0)):I>k?(v.hc(A,J),A=new f.h,o.hc(M,A),f.h.yc(J,A)>l&&(h=!0)):(o.hc(M,J),I=new f.h,v.hc(A,I),f.h.yc(J,I)>l&&(h=!0)),c[E]=J}for(m=0,g=-1,E=0;E<=w;E++)(B=E<w?this.Fq[E]:1)!=m&&(l=this.aB(),v.ah(m,B,l),g!=-1&&l.get().Dc(c[g]),E!=w&&l.get().Qc(c[E]),m=B,this.$s.push(this.Ow(l.get()))),g=E;for(v=[0,0,0,0,0,0,0,0,0],E=0;E<w;E++)v[E]=E;for(1<w&&this.Bk[0]>this.Bk[1]&&(B=this.Bk[0],this.Bk[0]=this.Bk[1],this.Bk[1]=B,E=v[0],v[0]=v[1],v[1]=E),m=0,g=-1,E=0;E<=w;E++)(B=E<w?this.Bk[E]:1)!=m&&(l=this.aB(),o.ah(m,B,l),g!=-1&&(m=v[g],l.get().Dc(c[m])),E!=w&&(m=v[E],l.get().Qc(c[m])),m=B,this.yw.push(this.Ow(l.get()))),g=E;return h}}throw f.i.Qa()}return!1},d.prototype.Kz=function(c,o,l){if(o.copyTo(this.Bf),this.mo.length!=1)throw f.i.Qa();this.qa=c;var h=this.mo[0];if(l||h.$i.ru(o.D(),c,!0)){if(h.$i.getType()!=322)throw f.i.Qa();var m=(c=h.$i).fe(o.D(),!1);this.Fq[0]=m;var g=h.sB;for(l=1,m==0?(g=h.tB,l=h.rC):m==1&&(g=h.rB,l=h.qC),h=new f.h,g==0?(g=new f.h,c.hc(m,g),o=o.D(),f.lc.OG(g,o,1/(l+1),h)):0<g?(h=new f.h,c.hc(m,h)):h=o.D(),l=0,m=-1,g=0;1>=g;g++){if((o=1>g?this.Fq[g]:1)!=l){var v=this.aB();c.ah(l,o,v),m!=-1&&v.get().Dc(h),g!=1&&v.get().Qc(h),l=o,this.$s.push(this.Ow(v.get()))}m=g}this.Bf.Cb(h)}},d}();f.TC=x}(Q||(Q={})),function(f){var L=function(){function x(d){this.Ds=this.rk=this.sb=null,this.ag=0,this.zm=!1,this.zf=-1,this.Cl=this.Jd=0,this.gb=-1,this.ib=d,this.ag=this.Wx(this.Cl),this.zm=!1,this.rk=null,this.Ds=new f.h}return x.prototype.BW=function(d){if(this.ib!=d.ib)throw f.i.Hb();this.zf=d.zf,this.Jd=d.Jd,this.gb=d.gb,this.Cl=d.Cl,this.ag=d.ag,this.zm=d.zm,this.rk=null},x.prototype.ha=function(){if(this.zf!=this.Jd&&this.BD(),this.zm)this.Jd=(this.Jd+1)%this.ag;else{if(this.Jd==this.ag)throw f.i.ce();this.Jd++}return this.rk},x.prototype.li=function(){if(this.zm)this.Jd=(this.ag+this.Jd-1)%this.ag;else{if(this.Jd==0)throw f.i.ce();this.Jd--}return this.Jd!=this.zf&&this.BD(),this.rk},x.prototype.DW=function(){this.zf=-1,this.Jd=0},x.prototype.EW=function(){this.Jd=this.ag,this.zf=-1},x.prototype.Vb=function(d,c){if(c===void 0&&(c=-1),0<=this.gb&&this.gb<this.ib.da()){var o=this.IM();if(d>=o&&d<this.ib.Vc(this.gb))return this.zf=-1,void(this.Jd=d-o)}c=0<=c&&c<this.ib.da()&&d>=this.ib.Ba(c)&&d<this.ib.Vc(c)?c:this.ib.sz(d),this.Cl=c+1,this.gb=c,this.zf=-1,this.Jd=d-this.ib.Ba(c),this.ag=this.Wx(c),this.ib.Ba(this.gb),this.ib.dc(this.gb)},x.prototype.$a=function(){return this.gb=this.Cl,!(this.gb>=this.ib.da())&&(this.zf=-1,this.Jd=0,this.ag=this.Wx(this.gb),this.ib.Ba(this.gb),this.ib.dc(this.gb),this.Cl++,!0)},x.prototype.Zi=function(){this.ag=this.Jd=this.zf=-1,this.Cl=0,this.gb=-1},x.prototype.Wx=function(d){if(this.ib.Ac())return 0;var c=1;return this.ib.dc(d)&&(c=0),this.ib.Ja(d)-c},x.prototype.On=function(){return this.zf==this.ag-1&&this.ib.dc(this.gb)},x.prototype.JB=function(){this.zm=!0},x.prototype.wb=function(){return this.ib.nb.o[this.gb]+this.zf},x.prototype.IM=function(){return this.ib.Ba(this.gb)},x.prototype.ik=function(){return this.On()?this.ib.Ba(this.gb):this.wb()+1},x.prototype.vm=function(){return this.zf==0},x.prototype.Qn=function(){return this.zf==this.ag-1},x.prototype.Ha=function(){return this.Jd<this.ag},x.prototype.Ez=function(){return 0<this.Jd},x.prototype.Of=function(){var d=new x(this.ib);return d.zf=this.zf,d.Jd=this.Jd,d.ag=this.ag,d.gb=this.gb,d.Cl=this.Cl,d.ib=this.ib,d.zm=this.zm,d},x.prototype.BD=function(){if(0>this.Jd||this.Jd>=this.ag)throw f.i.ce();this.zf=this.Jd;var d=this.wb();this.ib.mc();var c=this.ib.Ve,o=1;switch(c!=null&&(o=7&c.read(d)),c=this.ib.description,o){case 1:this.sb==null&&(this.sb=new f.yb),this.rk=this.sb;break;case 2:throw f.i.fa("internal error");default:throw f.i.Qa()}this.rk.Nf(c),o=this.ik(),this.ib.Gc(d,this.Ds),this.rk.Dc(this.Ds),this.ib.Gc(o,this.Ds),this.rk.Qc(this.Ds);for(var l=1,h=c.Aa;l<h;l++)for(var m=c.kd(l),g=f.ra.Va(m),v=0;v<g;v++){var w=this.ib.Uc(m,d,v);this.rk.YB(m,v,w),w=this.ib.Uc(m,o,v),this.rk.OB(m,v,w)}},x.prototype.$S=function(){return this.gb==this.ib.da()-1},x.prototype.Pn=function(){var d=this.ib.VR();return d!=null&&(7&d.read(this.zf))!=1},x}();f.YL=L}(Q||(Q={})),function(f){var L=function(){function x(d){d instanceof f.aa?(this.xH=d,this.ya=-1,this.Ei=1):(this.vT=d.slice(0),this.ya=-1,this.Ei=d.length)}return x.prototype.La=function(){return this.ya},x.prototype.next=function(){return this.ya<this.Ei-1?(this.ya++,this.xH!=null?this.xH:this.vT[this.ya]):null},x.prototype.qe=function(){},x}();f.Zc=L}(Q||(Q={})),function(f){var L=function(){this.next=null},x=function(){function d(){this.Tq=this.Kw=this.Lw=0,this.kF=!1,this.gK=0,this.gn=this.Kf=this.Wl=this.Jh=null,this.Ol=0,this.vy=null,this.pl=this.oi=-1}return d.prototype.AX=function(c,o,l){this.oi=c,this.pl=o,this.Jh=this.Wl=null,this.Tq=0,this.vy=l,this.gn==null&&(this.gn=f.O.lg(384,0)),this.nK()},d.prototype.R=function(){return this.oi},d.prototype.ca=function(){return this.pl},d.prototype.flush=function(){0<this.Ol&&(this.vy.gF(this.gn,this.Ol),this.Ol=0)},d.prototype.nK=function(){if(0<this.Tq){for(var c=0;c<this.pl;c++){for(var o=this.Wl[c];o!=null;){var l=o;o=o.next,l.next=null}this.Wl[c]=null}this.Jh=null}this.Lw=this.pl,this.Kw=-1,this.Tq=0},d.prototype.iJ=function(c){for(this.kF=c==d.Cx,c=this.Lw;c<=this.Kw;c++)this.sN(),this.lN(c),this.ZP();this.nK()},d.prototype.jy=function(c,o,l,h){if(o!=h){var m=1;if(o>h&&(m=c,c=l,l=m,m=o,o=h,h=m,m=-1),!(0>h||o>=this.pl)){0>c&&0>l?l=c=-1:c>=this.oi&&l>=this.oi&&(l=c=this.oi);var g=(l-c)/(h-o);h>this.pl&&(l=g*((h=this.pl)-o)+c),0>o&&(c=g*(0-o)+c,o=0);var v=Math.max(this.oi+1,8388607);-8388607>c?(o=(0-c)/g+o,c=0):c>v&&(o=(this.oi-c)/g+o,c=this.oi),-8388607>l?h=(0-c)/g+o:l>v&&(h=(this.oi-c)/g+o),(o=f.O.truncate(o))!=(h=f.O.truncate(h))&&((l=new L).x=f.O.truncate(4294967296*c),l.y=o,l.H=h,l.WP=f.O.truncate(4294967296*g),l.dir=m,this.Wl==null&&(this.Wl=f.O.lg(this.pl,null)),l.next=this.Wl[l.y],this.Wl[l.y]=l,l.y<this.Lw&&(this.Lw=l.y),l.H>this.Kw&&(this.Kw=l.H),this.Tq++)}}},d.prototype.sN=function(){if(this.Jh!=null){for(var c=!1,o=null,l=this.Jh;l!=null;)if(l.y++,l.y==l.H){var h=l;l=l.next,o!=null?o.next=l:this.Jh=l,h.next=null}else l.x+=l.WP,o!=null&&o.x>l.x&&(c=!0),o=l,l=l.next;c&&(this.Jh=this.fK(this.Jh))}},d.prototype.lN=function(c){if(!(c>=this.pl)){var o=this.Wl[c];if(o!=null){this.Wl[c]=null,o=this.fK(o),this.Tq-=this.gK,c=this.Jh;for(var l=!0,h=o,m=null;c!=null&&h!=null;)c.x>h.x?(l&&(this.Jh=h),l=h.next,h.next=c,m!=null&&(m.next=h),m=h,h=l):(l=c.next,c.next=h,m!=null&&(m.next=c),m=c,c=l),l=!1;this.Jh==null&&(this.Jh=o)}}},d.eK=function(c,o){return 0>c?0:c>o?o:c},d.prototype.ZP=function(){if(this.Jh!=null){for(var c=0,o=this.Jh,l=f.O.truncate(f.O.XG(o.x)),h=o.next;h!=null;h=h.next)if(c=this.kF?1^c:c+h.dir,h.x>o.x){var m=f.O.truncate(f.O.XG(h.x));c!=0&&(o=d.eK(l,this.oi),(l=d.eK(m,this.oi))>o&&o<this.oi&&(this.gn[this.Ol++]=o,this.gn[this.Ol++]=l,this.gn[this.Ol++]=h.y,this.Ol==this.gn.length&&(this.vy.gF(this.gn,this.Ol),this.Ol=0))),o=h,l=m}}},d.prototype.fK=function(c){for(var o=0,l=c;l!=null;l=l.next)o++;if(this.gK=o,o==1)return c;this.Kf==null?this.Kf=f.O.lg(Math.max(o,16),null):this.Kf.length<o&&(this.Kf=f.O.lg(Math.max(o,2*this.Kf.length),null));var h=0;for(l=c;l!=null;l=l.next)this.Kf[h++]=l;for(o==2?this.Kf[0].x>this.Kf[1].x&&(c=this.Kf[0],this.Kf[0]=this.Kf[1],this.Kf[1]=c):d.AN(this.Kf,o,function(m,g){return m==g?0:m.x<g.x?-1:m.x>g.x?1:0}),c=this.Kf[0],this.Kf[0]=null,l=c,h=1;h<o;h++)l.next=this.Kf[h],l=this.Kf[h],this.Kf[h]=null;return l.next=null,c},d.AN=function(c,o,l){if(o==c.length)c.sort(l);else{var h=c.slice(0,0),m=c.slice(o);o=c.slice(0,o).sort(l),c.length=0,c.push.apply(c,h.concat(o).concat(m))}},d.Cx=0,d}();f.Px=x}(Q||(Q={})),function(f){var L=function(){function x(){}return x.prototype.ui=function(d,c){var o=this.g.Pa(d,this.Pq);if(this.Dl==o&&(this.Dl=this.oe.lb(this.Dl)),this.ho==o&&(this.ho=this.oe.lb(this.ho)),this.oe.jd(this.RA,o),this.bk(d),c&&(c=this.g.bd(d))!=-1&&this.g.Xa(c)==d){var l=this.g.U(d);if(l!=d){if((o=this.g.bd(l))==c)return void this.g.Jf(c,l);if((l=this.g.Ma(d))!=d&&(o=this.g.bd(l))==c)return void this.g.Jf(c,l)}this.g.Jf(c,-1),this.g.Wg(c,-1)}},x.prototype.pD=function(){for(var d=!1,c=new f.h;;){this.Wh==null?(this.Wh=new f.ia(0),this.zs=new f.ia(0),this.xe=new f.ia(0)):(this.Wh.clear(!1),this.zs.clear(!1),this.xe.clear(!1));for(var o=this.ho,l=0,h=!0;o!=this.Dl;){var m=this.oe.getData(o),g=new f.h;this.g.Gc(m,g),h&&(this.g.Gc(m,c),h=!1),g=this.g.Ma(m);var v=this.g.U(m);this.g.Pa(g,this.zg)!=-559038737&&(this.Wh.add(g),this.g.Ra(g,this.zg,-559038737),this.zs.add(m),this.xe.add(l++)),this.g.Pa(v,this.zg)!=-559038737&&(this.Wh.add(v),this.g.Ra(v,this.zg,-559038737),this.zs.add(m),this.xe.add(l++)),o=this.oe.lb(o)}if(2>this.Wh.size)break;var w=this;for(this.xe.Vd(0,this.xe.size,function(E,A){return w.pM(E,A)}),o=0,l=this.xe.size;o<l;o++)h=this.xe.get(o),h=this.Wh.get(h),this.g.Ra(h,this.zg,o),g=new f.h,this.g.Gc(h,g);for(g=this.TM(c),o=0,l=this.xe.size;o<l;o++)(h=this.xe.get(o))!=-1&&(h=this.Wh.get(h),this.g.Ra(h,this.zg,-1));if(!g)break;d=!0}return d},x.prototype.TM=function(d){for(var c=!1,o=!0;o;){o=!1;var l=0;this.xe.get(l)==-1&&(l=this.cm(l));for(var h=this.cm(l),m=0,g=this.xe.size;m<g&&l!=-1&&h!=-1&&l!=h;m++){var v=this.xe.get(l);h=this.xe.get(h),v=this.Wh.get(v),h=this.Wh.get(h);var w=this.g.U(v);this.g.Dv(w,d)||(w=this.g.Ma(v));var E=this.g.U(h);this.g.Dv(E,d)||(E=this.g.Ma(h));var A=this.pu(w,v),M=this.pu(E,h),I=A?this.g.Ma(w):this.g.U(w),D=M?this.g.Ma(E):this.g.U(E),k=!1;(this.sp(w)||this.sp(E)||this.sp(v)||this.sp(h)||this.sp(I)||this.sp(D))&&(k=!0),!k&&this.g.fq(v,h)&&(k=!0,this.tD(A,M,w,v,E,h)),!k&&this.g.fq(I,D)&&(k=!0,this.tD(!A,!M,w,I,E,D)),k&&(c=!0),o=o||k,l=this.cm(l),h=this.cm(l)}}if(!c)for(l=0,this.xe.get(l)==-1&&(l=this.cm(l)),h=this.cm(l),m=0,g=this.xe.size;m<g&&l!=-1&&h!=-1&&l!=h;m++)v=this.xe.get(l),h=this.xe.get(h),v=this.Wh.get(v),h=this.Wh.get(h),w=this.g.U(v),this.g.Dv(w,d)||(w=this.g.Ma(v)),E=this.g.U(h),this.g.Dv(E,d)||(E=this.g.Ma(h)),A=this.pu(w,v),M=this.pu(E,h),I=A?this.g.Ma(w):this.g.U(w),D=M?this.g.Ma(E):this.g.U(E),this.DM(A,M,v,w,I,h,E,D)&&(c=!0),l=this.cm(l),h=this.cm(l);return c},x.prototype.XM=function(){this.g.ic(this.X)==1736&&this.g.In(this.X)==1&&new f.Fg().MU(this.fw,this.g,this.X,this.nd);var d=!1,c=!0;this.zg=this.Pq=-1;var o=this.g.I(this.X),l=new f.ia(0);l.Jb(o);for(var h=this.g.Ob(this.X);h!=-1;h=this.g.Rb(h))for(var m=this.g.Xa(h),g=0,v=this.g.Ja(h);g<v;g++)l.add(m),m=this.g.U(m);var w=this.g.td.o,E=this.g.td.stride;this.g.vb.mc();var A=this.g.vb.za[0].o;for(l.Vd(0,o,function(I,D){var k=w[E*I],B=w[E*D],J=A[2*k];k=A[2*k+1];var Y=A[2*B];return(J=k<(B=A[2*B+1])?-1:k>B?1:J<Y?-1:J>Y?1:0)==0&&(J=(I=w[E*I+3])<(D=w[E*D+3])?-1:I==D?0:1),J}),this.Pq=this.g.Gd(),this.oe=new f.jp,this.RA=this.oe.Ph(0),this.oe.fn(o),h=0;h<o;h++)m=l.get(h),g=this.oe.addElement(this.RA,m),this.g.Ra(m,this.Pq,g);for(this.zg=this.g.Gd(),this.Dl=-1,this.cD()&&(d=!0);c;){c=!1,o=0,l=!1;do{l=!1,this.ho=-1,v=0,h=new f.h,g=new f.h;for(var M=this.oe.rc(this.RA);M!=-1;)m=this.oe.getData(M),this.ho!=-1?(this.g.Gc(m,g),h.qb(g)?v++:(h.L(g),this.Dl=M,0<v&&(m=this.pD())&&(l=!0,this.Dl!=-1&&(m=this.oe.getData(this.Dl),this.g.Gc(m,h))),this.ho=M=this.Dl,v=0)):(this.ho=M,this.g.Gc(this.oe.getData(M),h),v=0),M!=-1&&(M=this.oe.lb(M));if(this.Dl=-1,0<v&&(m=this.pD())&&(l=!0),10<o++)throw f.i.Qa();l&&this.GM(),this.cD()&&(l=!0),c=c||l&&!1,d=d||l}while(l)}return this.g.Td(this.Pq),this.g.Td(this.zg),f.WL.V(this.g,this.X,this.oe,this.fw)||d},x.prototype.pu=function(d,c){return this.g.U(c)!=d},x.prototype.DM=function(d,c,o,l,h,m,g,v){if(l==g)return this.bk(o),this.bk(m),!1;var w=this.g.Pa(o,this.zg),E=this.g.Pa(h,this.zg),A=this.g.Pa(m,this.zg),M=this.g.Pa(v,this.zg),I=[0,0,0,0];for((o=[0,0,0,0,0,0,0,0])[0]=0,I[0]=w,o[1]=0,I[1]=E,o[2]=1,I[2]=A,o[3]=1,I[3]=M,w=1;4>w;w++){for(E=I[w],A=o[w],M=w-1;0<=M&&I[M]>E;)I[M+1]=I[M],o[M+1]=o[M],M--;I[M+1]=E,o[M+1]=A}return I=0,o[0]!=0&&(I|=1),o[1]!=0&&(I|=2),o[2]!=0&&(I|=4),o[3]!=0&&(I|=8),(I==5||I==10)&&(d==c?d?(this.g.Bc(v,l),this.g.Cc(l,v),this.g.Bc(h,g),this.g.Cc(g,h)):(this.g.Cc(v,l),this.g.Bc(l,v),this.g.Cc(h,g),this.g.Bc(g,h)):d?(this.g.Cc(l,m),this.g.Bc(m,l),this.g.Cc(g,h),this.g.Bc(h,g)):(this.g.Bc(l,m),this.g.Cc(m,l),this.g.Bc(g,h),this.g.Cc(h,g)),!0)},x.prototype.tD=function(d,c,o,l,h,m){this.MY?this.VM():this.UM(d,c,o,l,h,m)},x.prototype.VM=function(){throw f.i.fa("not implemented.")},x.prototype.UM=function(d,c,o,l,h,m){if(d!=c)d?(this.g.Bc(o,h),this.g.Cc(h,o),this.g.Bc(m,l),this.g.Cc(l,m),this.vn(h,o),this.ui(h,!0),this.g.mi(h,!0),this.bk(o),this.vn(m,l),this.ui(m,!0),this.g.mi(m,!1)):(this.g.Bc(h,o),this.g.Cc(o,h),this.g.Bc(l,m),this.g.Cc(m,l),this.vn(h,o),this.ui(h,!0),this.g.mi(h,!1),this.bk(o),this.vn(m,l),this.ui(m,!0),this.g.mi(m,!0)),this.bk(l);else{var g=d?o:l,v=c?h:m;for(d=d?l:o,c=c?m:h,h=!1,this.g.Bc(g,v),this.g.Bc(v,g),this.g.Cc(d,c),this.g.Cc(c,d),m=c;m!=v;)o=this.g.Ma(m),l=this.g.U(m),this.g.Cc(m,l),this.g.Bc(m,o),h=h||m==g,m=l;h||(o=this.g.Ma(v),l=this.g.U(v),this.g.Cc(v,l),this.g.Bc(v,o)),this.vn(v,g),this.ui(v,!0),this.g.mi(v,!1),this.bk(g),this.vn(c,d),this.ui(c,!0),this.g.mi(c,!1),this.bk(d)}},x.prototype.cD=function(){for(var d=!1,c=this.g.Ob(this.X);c!=-1;){for(var o=this.g.Xa(c),l=0,h=this.g.Ja(c);l<h&&1<h;){var m=this.g.Ma(o),g=this.g.U(o);this.g.fq(m,g)?(d=!0,this.ui(o,!1),this.g.pd(o,!0),this.ui(g,!1),this.g.pd(g,!0),o=m,l=0,h=this.g.Ja(c)):(o=g,l++)}if(2>this.g.Ja(c)){for(d=this.g.Xa(c),l=0,h=this.g.Ja(c);l<h;l++)this.ui(d,!1),d=this.g.U(d);c=this.g.Zq(c),d=!0}else c=this.g.Rb(c)}return d},x.prototype.sp=function(d){for(var c=!1;;){var o=this.g.U(d),l=this.g.Ma(d);if(o==d)return this.ui(d,!0),this.g.mi(d,!1),!0;if(!this.g.fq(o,l)||(c=!0,this.bk(l),this.bk(o),this.ui(d,!0),this.g.mi(d,!1),this.vn(o,l),this.ui(o,!0),this.g.mi(o,!0),o==l))break;d=l}return c},x.prototype.GM=function(){for(var d=0,c=this.oe.rc(this.oe.je);c!=-1;c=this.oe.lb(c)){var o=this.oe.getData(c);this.g.aj(o,-1)}for(var l=0,h=this.g.Ob(this.X);h!=-1;)if((c=this.g.Xa(h))==-1||this.g.bd(c)!=-1)o=h,h=this.g.Rb(h),this.g.$q(o);else{this.g.aj(c,h);var m=1;for(o=this.g.U(c);o!=c;o=this.g.U(o))this.g.aj(o,h),m++;this.g.cp(h,!1),this.g.Vj(h,m),this.g.Wg(h,this.g.Ma(c)),l+=m,d++,h=this.g.Rb(h)}for(c=this.oe.rc(this.oe.je);c!=-1;c=this.oe.lb(c))o=this.oe.getData(c),this.g.bd(o)==-1&&(h=this.g.nG(this.X,o,o,null),l+=this.g.Ja(h),d++);for(this.g.Rl(this.X,d),this.g.Tj(this.X,l),d=0,l=this.g.ld;l!=-1;l=this.g.ue(l))d+=this.g.I(l);this.g.bC(d)},x.prototype.cm=function(d){for(var c=0,o=this.xe.size-1;c<o;c++)if(d=(d+1)%this.xe.size,this.xe.get(d)!=-1)return d;return-1},x.prototype.vn=function(d,c){var o=this.g.Pa(c,this.Pq),l=this.g.Pa(c,this.zg);this.g.lC(d,c),this.g.Ra(c,this.Pq,o),this.g.Ra(c,this.zg,l)},x.prototype.bk=function(d){var c=this.g.Pa(d,this.zg);c!=-1&&(this.xe.set(c,-1),this.g.Ra(d,this.zg,-1))},x.V=function(d,c,o,l,h){var m=new x;return m.g=d,m.X=c,m.xA=o,m.fw=l,m.nd=h,m.XM()},x.prototype.pM=function(d,c){var o=this.Wh.get(d),l=new f.h;this.g.Gc(o,l),o=new f.h;var h=this.Wh.get(c);return this.g.Gc(h,o),l.qb(o)?0:(h=this.zs.get(d),d=new f.h,this.g.Gc(h,d),h=this.zs.get(c),c=new f.h,this.g.Gc(h,c),(h=new f.h).uc(l,d),(l=new f.h).uc(o,c),f.h.nu(h,l))},x}();f.rn=L}(Q||(Q={})),function(f){var L;(L=f.$L||(f.$L={}))[L.Local=0]="Local",L[L.Geographic=1]="Geographic",L[L.Projected=2]="Projected",L[L.Image=3]="Image",L[L.Unknown=4]="Unknown",function(d){d[d.Integer32=0]="Integer32",d[d.Integer64=1]="Integer64",d[d.FloatingPoint=2]="FloatingPoint"}(f.TL||(f.TL={}));var x=function(){function d(){this.mA=null,this.pp="",this.su=null,this.dg=0,this.ZH=this.Ho=-1,this.wh=null}return d.prototype.Ec=function(){return this.dg},d.prototype.VF=function(){return 1},d.prototype.VW=function(c){this.mA=c},d.prototype.Xd=function(){if(this.mA!==null)return this.mA;var c=.001;return this.dg!=0?c=f.wr.CQ(this.dg):this.wh!=null&&(c=f.XC.DQ(this.wh)),c},d.prototype.Bz=function(){return this.wh},d.prototype.Hd=function(){return this.dg!=0?f.Tc.Zg(f.wr.Sy(this.dg)):this.wh!=null?f.XC.EQ(this.wh):void 0},d.Sb=function(c){if(c.dg!=0){if(f.wr.ZS(c.dg)===!0)return 1;if(f.wr.aT(c.dg)===!0)return 2}return 4},d.prototype.$r=function(){var c=this.Ec();return this.Ho!=-1?this.Ho:(this.Ho=f.wr.FK(c),this.Ho!=-1?this.Ho:c)},d.create=function(c){if(0>=c)throw f.i.N("Invalid or unsupported wkid: "+c);var o=new d;return o.dg=c,o},d.qP=function(c){if(c==null||c.length==0)throw f.i.N("Cannot create SpatialReference from null or empty text.");var o=new d;return o.wh=c,o},d.prototype.Nb=function(c){return this==c||c!=null&&this.constructor==c.constructor&&this.dg==c.dg&&(this.dg!=0||this.wh===c.wh)},d.prototype.toString=function(){return"[ tol: "+this.Kn()+"; wkid: "+this.Ec()+"; wkt: "+this.Bz()+"]"},d.prototype.cc=function(){if(this.pp!=="")return this.pp;var c=this.toString();if(Array.prototype.reduce)return this.pp="S"+c.split("").reduce(function(h,m){return(h=(h<<5)-h+m.charCodeAt(0))&h},0);var o=0;if(c.length===0)return"";for(var l=0;l<c.length;l++)o=(o<<5)-o+c.charCodeAt(l),o&=o;return this.pp="S"+o},d.prototype.Kn=function(){return this.Xd(0)},d.prototype.fh=function(){return this.su!==null?this.su:this.su=f.gu.yP(this)},d.ZN=2147483645,d.$N=9007199254740990,d}();f.Eg=x}(Q||(Q={})),function(f){var L=function(x){function d(){var c=x!==null&&x.apply(this,arguments)||this;return c.Ji=null,c.ST=null,c.Hq=new f.ZL,c.Eo=null,c.jw=null,c}return bt(d,x),d.yP=function(c){var o=new d;if(o.dg=c.dg,o.Ho=c.Ho,o.ZH=c.ZH,o.wh=c.wh,o.wh!==""&&o.wh!==null){c=d.kM(o.wh);var l=d.iM(o.wh);o.Hq.Xx(c,l,f.hu.Integer64),o.by(c),o.gy(l),o.dg=c.$r()}else c=d.jM(o.dg),o.by(c),o.gy(null),o.Hq.Xx(c,null,f.hu.Integer64);return o},d.prototype.Xd=function(c){return this.Hq.Kn(c)},d.iM=function(c){if(0>=c.length)throw f.i.N();var o=null;try{o=f.NC.fromString(c)}catch{o=null}return o==null?null:d.bD(o,!0)},d.prototype.by=function(c){this.Kd=c,this.Eo=this.Kd.Hd()},d.prototype.gy=function(c){this.KH=c,this.ST=this.KH!=null?this.KH.Eo:null},d.prototype.Wc=function(){return this.Sb()!=0&&this.Sb()!=3&&this.Kd.Wc()},d.prototype.IG=function(){return this.Sb()!=0&&(this.Sb()==3?this.Ji.fk().Wc():this.Kd.Wc())},d.prototype.eh=function(){return this.Kd!=null?this.Kd.Ue:null},d.prototype.pm=function(){return this.Kd.pm()},d.prototype.bf=function(){return this.Kd.bf()},d.prototype.hh=function(){return this.Kd!=null?this.Kd.sw:NaN},d.prototype.Up=function(){return this.Kd.Up()},d.prototype.Wr=function(){return this.Kd.Wr()},d.prototype.kk=function(){return this.Kd.kk()},d.prototype.kS=function(c){return f.OC.Py(this.Kd,c.Kd)},d.prototype.ml=function(){return this.Kd.ml()},d.prototype.Vr=function(){return this.Kd.Vr()},d.prototype.zi=function(){return this.Sb()==3?this.Ji.fk().zi():this.Kd.zi()},d.prototype.gh=function(){if(!this.Wc())throw f.i.N("!isPannable()");var c=new f.l;return this.Kd.gh(c),c},d.prototype.Oe=function(){if(!this.Wc())throw f.i.N("!isPannable()");return this.Kd.so},d.prototype.HR=function(){if(!this.Wc())throw f.i.N("!isPannable()");var c=new f.l;return this.Kd.GR(c),c},d.prototype.pv=function(){if(!this.Wc())throw f.i.N("!isPannable()");return this.Kd.pv()},d.prototype.ov=function(){if(!this.Wc())throw f.i.N("!isPannable()");return this.Kd.ov()},d.prototype.Xr=function(){return this.Ji!=null?this.Ji.fk().Xr():this.Kd.Xr()},d.prototype.PQ=function(){return this.Kd.hv()},d.prototype.Qp=function(){return this.Eo.getUnitFactor()},d.prototype.vz=function(c){return this.Hq.vz(c)},d.prototype.sc=function(){var c=this.Sb();if(c==1)return this;if(c==3)return this.Ji.fk().sc();if(c==0||c===4)throw f.i.fa("invalid call");if(this.jw!==null)return this.jw;if((c=this.eh().getGeogcs())==null)throw f.i.Qa();return this.jw=d.bF(c,this.Hq.VF())},d.bF=function(c,o){if(c==null)throw f.i.N("null pointer.");var l=new d;return c=d.mu(c,!0),l.Hq.Xx(c,null,o),l.by(c),l.gy(null),l.dg=c.$r(),l},d.prototype.Sb=function(){var c=this.eh();if(c!=null)switch(c.getType()){case f.Sc.PE_TYPE_GEOGCS:return 1;case f.Sc.PE_TYPE_PROJCS:return 2}return 4},d.prototype.hv=function(){return this.Kd.hv()},d.mu=function(c,o){var l=c.getCode();if(0>=l&&0<(l=f.pf.getCode(c))){if((c=f.pf.coordsys(l))==null)throw f.i.N("Text to wkid mapping had failed: "+l);return d.mu(c,o)}if(o&&0<l&&(o=d.qx[l]))return o;o=f.zb.xv(c,l,!1);var h=d.lK[o];return h||(c=0>=l?c:f.pf.coordsys(l),c=new f.OC(c),d.lK[o]=c,0<l&&(d.qx[l]=c),c)},d.jM=function(c){if(0>=c)throw f.i.N("Invalid or unsupported wkid: "+c);var o=d.qx[c];if(o!=null)return o;if((o=f.pf.coordsys(c))==null)throw f.i.N("Invalid or unsupported wkid: "+c);return(o=d.mu(o,!1)).$r()!=c&&(d.qx[c]=o),o},d.kM=function(c){if(c==null||c===void 0||c.length==0)throw f.i.N("Cannot create SpatialReference from null or empty text.");var o=null;try{o=f.pf.fromString(f.Sc.PE_TYPE_COORDSYS,c)}catch(l){throw f.i.N("Cannot create SpatialReference from text. "+l.message)}if(o===null)throw f.i.N("Cannot create SpatialReference from text. ");return d.mu(o,!0)},d.bD=function(c,o){var l,h=c.getCode();if(0>=h&&0<(h=f.pf.getCode(c))){if((h=f.pf.vertcs(h))===null)throw f.i.N();return d.bD(h,o)}if(o&&0<h&&(o=d.kK[h])||(c=f.zb.xv(c,h,!1),o=d.mK[c]))return o;if(0>=h||(l=f.pf.vertcs(h)),l===null)throw f.i.N();return l=new f.PL(l),d.mK[c]=l,0<h&&(d.kK[h]=l),l},d.sI=function(c,o){if(o===null||o.B())return null;var l=new f.l;if(o!==null&&c.Sb()!=1){var h=c.sc(),m=h.eh();c=f.vr.Nr(c,h,null,null),(o=f.Hx.local().V(o,c,null)).A(l)}else m=c.eh(),o.A(l);return o=m.getPrimem().getLongitude(),m=m.getUnit().getUnitFactor(),new f.LC(l.v,l.G,l.C,l.H,o,m)},d.lD=function(c){var o={name:"",steps:[],_pt:null,_entry:null},l=0;for(c=c.getEntries();l<c.length;l++){var h=c[l],m={LY:!1,ZY:"",YY:-1,geogtran:null};h.getDirection()===0?m.isInverse=!1:m.isInverse=!0;var g=h.getGeogtran().getCode();-1<g?m.wkid=g:m.wkt=h.getGeogtran().toString(),o.steps.push(m)}return o},d.XR=function(c,o,l,h){return l===void 0&&(l=null),l=d.sI(h,l),c=f.lp.getGTlist(c.eh(),o.eh(),2,f.lp.PE_GTLIST_OPTS_COMMON,l,1),o=null,c&&0<c.length&&(o=this.lD(c[0]),f.Mx.destroy(c)),l!==null&&l.destroy(),o},d.YR=function(c,o,l,h){var m;if(l===void 0&&(l=null),h===void 0&&(h=null),m===void 0&&(m=30),l=d.sI(h,l),c=f.lp.getGTlist(c.eh(),o.eh(),2,f.lp.PE_GTLIST_OPTS_COMMON,l,m),o=[],c&&0<c.length){for(m=0;m<c.length;m++)o.push(this.lD(c[m]));f.Mx.destroy(c)}return l!==null&&l.destroy(),o},d.qx={},d.lK={},d.kK={},d.mK={},d}(f.Eg);f.gu=L}(Q||(Q={})),function(f){var L,x;(x=L=f.hu||(f.hu={}))[x.Integer32=0]="Integer32",x[x.Integer64=1]="Integer64",x[x.FloatingPoint=2]="FloatingPoint";var d=function(){function c(){this.qp()}return c.prototype.assign=function(o){this.Fm=o.Fm,this.Gm=o.Gm,this.Pj=o.Pj,this.sA=o.sA,this.Fo=o.Fo,this.rA=o.rA,this.Ik=o.Ik,this.Mq=o.Mq,this.Lq=o.Lq,this.Rm=o.Rm},c.prototype.VF=function(){return this.Rm},c.prototype.qp=function(){this.Gm=this.Fm=0,this.Pj=1,this.sA=0,this.Fo=1,this.rA=0,this.Lq=this.Mq=this.Ik=2220446049250313e-29,this.Rm=L.FloatingPoint},c.prototype.Xx=function(o,l,h){if(this.qp(),this.Rm=h,h!=L.FloatingPoint){var m=new f.l;o.hR(m),this.Fm=m.v,this.Gm=m.G}else this.Gm=this.Fm=-17976931348623157e292;(m=o.Ue.getType())==f.Sc.PE_TYPE_GEOGCS?(m=(h==L.Integer64?1e-9:1/18e5)*o.bf(),this.Pj=1/m):m==f.Sc.PE_TYPE_PROJCS&&(m=(h==L.Integer64?1e-4:.001)*o.pm(),this.Pj=1/m),l!=null?(m=(h==L.Integer32?.001:1e-4)*l.IH,this.Fo=1/m):this.Fo=1e4,this.YM(),this.Ik=o.sw,this.Mq=l!=null?.001*l.IH:.001,this.Lq=2220446049250313e-29},c.prototype.YM=function(){if(this.Rm!=L.FloatingPoint){var o=this.Rm==L.Integer64?f.Eg.$N:f.Eg.ZN,l=o/this.Pj,h=this.Fm+l,m=f.O.truncate((h-this.Fm)*this.Pj);m>o&&(this.Pj=o/(h-this.Fm)),l=this.Gm+l,(m=f.O.truncate((l-this.Gm)*this.Pj))>o&&(this.Pj=o/(l-this.Gm))}},c.prototype.aC=function(o){switch(o){case 0:this.Ik=void 0;case 1:this.Mq=void 0;case 2:this.Lq=void 0}},c.prototype.Kn=function(o){switch(o){case 0:return this.Ik;case 1:return this.Mq;case 2:return this.Lq}return 0},c.prototype.vz=function(o){if(this.Rm==L.FloatingPoint)return 0;switch(o){case 0:return 1/this.Pj;case 1:case 2:return 1/this.Fo;default:return 0}},c.prototype.toString=function(){var o="SRPD [m_toleranceXY: "+this.Ik.toString();return(o=(o=(o=(o=(o=(o=(o=(o=(o=o+";m_falseX: "+this.Fm.toString())+";m_falseY: "+this.Gm.toString())+";m_unitsXY: "+this.Pj.toString())+";m_falseZ: "+this.sA.toString())+";m_unitsZ: "+this.Fo.toString())+";m_falseM: "+this.rA.toString())+";m_toleranceZ: "+this.Mq.toString())+";m_toleranceM: "+this.Lq.toString())+";m_precision: "+this.Rm.toString())+"] "},c}();f.ZL=d}(Q||(Q={})),function(f){function L(h,m){return 89.99999<m?m=89.99999:-89.99999>m&&(m=-89.99999),m*=.017453292519943,[111319.49079327169*h,31890685e-1*Math.log((1+Math.sin(m))/(1-Math.sin(m)))]}function x(h,m,g){return h=h/6378137*57.29577951308232,g?[h,57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*m/6378137)))]:[h-360*Math.floor((h+180)/360),57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*m/6378137)))]}function d(h,m,g){var v=h.Of();if(h.getType()===33)m=m(v.Lg(),v.ih()),v.Cb(m[0],m[1]);else if(h.getType()===197){var w=m(h.es(),h.gs(),g);m=m(h.ds(),h.fs(),g),v.K(w[0],w[1],m[0],m[1])}else for(w=new f.h,h=0;h<v.I();h++){v.D(h,w);var E=m(w.x,w.y,g);w.ma(E[0],E[1]),v.Cb(h,w)}return v}function c(h){return d(h,x,!0)}function o(h){return d(h,L,!0)}var l=Math.PI/180;f.UK=function(){function h(){}return h.vu=function(m){var g=Math.sqrt(.006694379990197414),v=Math.sin(m.y*l);return f.h.construct(6378137*m.x*l,3.1677196636462314e6*(v/(1-.006694379990197414*v*v)-1/(2*g)*Math.log((1-g*v)/(1+g*v))))},h.Vx=function(m,g,v,w){var E=.0033528106647474805,A=Math.sin(v);v=Math.cos(v);var M=(1-E)*Math.tan(m),I=M*(m=1/Math.sqrt(1+M*M)),D=Math.atan2(M,v),k=(M=m*A)*M,B=1-k,J=27233160610754688e-5*B/4040829998466145e-2,Y=1+J/16384*(4096+J*(J*(320-175*J)-768)),V=J/1024*(256+J*(J*(74-47*J)-128));J=w/(635675231424518e-8*Y);for(var te,he,ue,xe=2*Math.PI;1e-12<Math.abs(J-xe);)ue=Math.cos(2*D+J),xe=J,J=w/(635675231424518e-8*Y)+V*(te=Math.sin(J))*(ue+V/4*((he=Math.cos(J))*(2*ue*ue-1)-V/6*ue*(4*te*te-3)*(4*ue*ue-3)));return w=I*te-m*he*v,B=E/16*B*(4+E*(4-3*B)),f.h.construct((g+(Math.atan2(te*A,m*he-I*te*v)-(1-B)*E*M*(J+B*te*(ue+B*he*(2*ue*ue-1)))))/l,Math.atan2(I*he+m*te*v,(1-E)*Math.sqrt(k+w*w))/l)},h.MM=function(m,g,v,w){var E=.0033528106647474805,A=w-g,M=Math.atan((1-E)*Math.tan(m)),I=Math.atan((1-E)*Math.tan(v)),D=Math.sin(M);M=Math.cos(M);var k=Math.sin(I);I=Math.cos(I);var B=A,J=1e3;do{var Y=Math.sin(B),V=Math.cos(B),te=Math.sqrt(I*Y*I*Y+(M*k-D*I*V)*(M*k-D*I*V));if(te===0)return 0;V=D*k+M*I*V;var he=Math.atan2(te,V),ue=M*I*Y/te,xe=1-ue*ue;Y=V-2*D*k/xe,isNaN(Y)&&(Y=0);var be=E/16*xe*(4+E*(4-3*xe)),Le=B;B=A+(1-be)*E*ue*(he+be*te*(Y+be*V*(2*Y*Y-1)))}while(1e-12<Math.abs(B-Le)&&0<--J);return J===0?(D=w-g,{azimuth:Math.atan2(Math.sin(D)*Math.cos(v),Math.cos(m)*Math.sin(v)-Math.sin(m)*Math.cos(v)*Math.cos(D)),geodesicDistance:6371008771415059e-9*Math.acos(Math.sin(m)*Math.sin(v)+Math.cos(m)*Math.cos(v)*Math.cos(w-g))}):(g=(m=27233160610754688e-5*xe/4040829998466145e-2)/1024*(256+m*(m*(74-47*m)-128)),{azimuth:Math.atan2(I*Math.sin(B),M*k-D*I*Math.cos(B)),YQ:635675231424518e-8*(1+m/16384*(4096+m*(m*(320-175*m)-768)))*(he-g*te*(Y+g/4*(V*(2*Y*Y-1)-g/6*Y*(4*te*te-3)*(4*Y*Y-3)))),XY:Math.atan2(M*Math.sin(B),M*k*Math.cos(B)-D*I)})},h.jQ=function(m){var g=m.hasAttribute(1),v=m.hasAttribute(2),w=[],E=m.da(),A=null,M=null;g&&(A=m.ub(1)),v&&(M=m.ub(2));for(var I=new f.h,D=0;D<E;D++){for(var k=m.Ba(D),B=m.Ja(D),J=0,Y=0,V=NaN,te=NaN,he=NaN,ue=NaN,xe=m.dc(D),be=[],Le=k;Le<k+B;Le++){m.D(Le,I),ue=he=NaN;var Xe=[I.x,I.y];g&&(he=A.get(Le),Xe.push(he)),v&&(E=M.get(Le),Xe.push(ue)),Le==k&&xe&&(J=I.x,Y=I.y,V=he,te=ue),be.push(Xe)}!xe||J==I.x&&Y==I.y&&(!g||isNaN(V)&&isNaN(he)||V==he)&&(!v||isNaN(te)&&isNaN(ue)||te==ue)||be.push(be[0].slice(0)),w.push(be)}return w},h.Wy=function(m,g){m=h.jQ(m),637.100877141506>g&&(g=637.100877141506);for(var v,w=[],E=0;E<m.length;E++){var A,M,I=m[E];w.push(v=[]),v.push([I[0][0],I[0][1]]);var D=I[0][0]*l,k=I[0][1]*l;for(A=0;A<I.length-1;A++){var B=I[A+1][0]*l,J=I[A+1][1]*l;if(D!==B||k!==J){B=(J=h.MM(k,D,J,B)).azimuth;var Y=(J=J.YQ)/g;if(1<Y){for(M=1;M<=Y-1;M++){var V=h.Vx(k,D,B,M*g);v.push([V.x,V.y])}M=h.Vx(k,D,B,(J+Math.floor(Y-1)*g)/2),v.push([M.x,M.y])}k=h.Vx(k,D,B,J),v.push([k.x,k.y]),D=k.x*l,k=k.y*l}}}return{qJ:w}},h.XQ=function(m){for(var g=[],v=0;v<m.length;v++){var w=m[v];w=h.Wy(w,1e4),g.push(w)}m=[];for(var E=0;E<g.length;E++){w=g[E];var A=0;for(v=0;v<w.qJ.length;v++){var M,I=w.qJ[v],D=h.vu(f.h.construct(I[0][0],I[0][1])),k=h.vu(f.h.construct(I[I.length-1][0],I[I.length-1][1])),B=k.x*D.y-D.x*k.y;for(M=0;M<I.length-1;M++)D=h.vu(f.h.construct(I[M+1][0],I[M+1][1])),B+=(k=h.vu(f.h.construct(I[M][0],I[M][1]))).x*D.y-D.x*k.y;A+=B}A/=1,m.push(A/-2)}return m},h}(),f.cb=function(){function h(){}return h.xB=function(m,g,v,w,E,A,M){h.gD[m.cc()]=g,isNaN(v)==0&&(h.mD[m.cc()]=v),isNaN(w)==0&&(h.zD[m.cc()]=w),isNaN(E)==0&&(h.aD[m.cc()]=E),h.nD[m.cc()]=A,M!==null&&(h.oD[m.cc()]=M)},h.Ww=function(m,g,v){h.sD[m.cc()+"-"+g.cc()]=v},h.sc=function(m){if((m=h.gD[m.cc()])==null)throw f.i.Ie();return m},h.bf=function(m){if((m=h.mD[m.cc()])==null)throw f.i.Ie();return m},h.vv=function(m){if((m=h.zD[m.cc()])==null)throw f.i.Ie();return m},h.ev=function(m){if((m=h.aD[m.cc()])==null)throw f.i.Ie();return m},h.gh=function(m){if((m=h.oD[m.cc()])==null)throw f.i.Ie();return f.l.construct(m[0],m[1],m[2],m[3])},h.Wc=function(m){if((m=h.nD[m.cc()])==null)throw f.i.Ie();return m},h.zh=function(m,g,v){if(g.Nb(v))return m;var w=h.sD[g.cc()+"-"+v.cc()];if(w!==void 0)return w(m,g,v);throw f.i.Ie()},h.vt=function(){throw f.i.Ie()},h.bR=function(){throw f.i.Ie()},h.dW=function(){throw f.i.Ie()},h.ml=function(){throw f.i.Ie()},h.sW=function(){var m=f.Eg.create(102100),g=f.Eg.create(3857),v=f.Eg.create(4326);f.cb.xB(m,v,NaN,NaN,NaN,!1,null),f.cb.xB(v,v,1,.0033528106647474805,6378137,!0,[-180,-90,180,90]),f.cb.xB(g,v,NaN,NaN,NaN,!1,null),f.cb.Ww(m,v,c),f.cb.Ww(v,m,o),f.cb.Ww(g,v,c),f.cb.Ww(v,g,o)},h.gD=[],h.mD=[],h.zD=[],h.aD=[],h.nD=[],h.oD=[],h.sD=[],h}()}(Q||(Q={})),Q.cb.sW(),function(f){var L=function(){function x(d){this.o=new Int32Array(0),this.io=-1,this.Hg=this.size=this.Bl=0,this.stride=d}return x.prototype.jd=function(d){d<this.Bl?(this.o[d*this.stride]=this.io,this.io=d):this.Bl--,this.size--},x.prototype.T=function(d,c){return this.o[d*this.stride+c]},x.prototype.S=function(d,c,o){this.o[d*this.stride+c]=o},x.prototype.Ce=function(){var d=this.io;if(d==-1){if(this.Bl==this.Hg){if(2147483647<(d=this.Hg!=0?f.O.truncate(3*(this.Hg+1)/2):1)&&(d=2147483647),d==this.Hg)throw f.i.ce();this.Dz(d)}d=this.Bl,this.Bl++}else this.io=this.o[d*this.stride];this.size++;for(var c=d*this.stride;c<d*this.stride+this.stride;c++)this.o[c]=-1;return d},x.prototype.Ll=function(d){var c=this.io;if(c==-1){if(this.Bl==this.Hg){if(2147483647<(c=this.Hg!=0?f.O.truncate(3*(this.Hg+1)/2):1)&&(c=2147483647),c==this.Hg)throw f.i.ce();this.Dz(c)}c=this.Bl,this.Bl++}else this.io=this.o[c*this.stride];this.size++;for(var o=c*this.stride,l=0;l<d.length;l++)this.o[o+l]=d[l];return c},x.prototype.mj=function(d){this.io=-1,this.size=this.Bl=0,d&&(this.o=null,this.Hg=0)},x.prototype.De=function(d){d>this.Hg&&this.Dz(d)},x.prototype.tx=function(d,c){d*=this.stride,c*=this.stride;for(var o=0;o<this.stride;o++){var l=this.o[c+o];this.o[c+o]=this.o[d+o],this.o[d+o]=l}},x.prototype.gC=function(d,c,o){var l=this.o[this.stride*c+o];this.o[this.stride*c+o]=this.o[this.stride*d+o],this.o[this.stride*d+o]=l},x.LG=function(d){return 0<=d},x.prototype.Dz=function(d){this.o==null&&(this.o=new Int32Array(0));var c=new Int32Array(this.stride*d);c.set(this.o,0),this.o=c,this.Hg=d},x}();f.$c=L}(Q||(Q={})),function(f){var L,x;(x=L||(L={}))[x.enumInputModeBuildGraph=0]="enumInputModeBuildGraph",x[x.enumInputModeSimplifyAlternate=4]="enumInputModeSimplifyAlternate",x[x.enumInputModeSimplifyWinding=5]="enumInputModeSimplifyWinding",x[x.enumInputModeIsSimplePolygon=7]="enumInputModeIsSimplePolygon";var d=function(){function o(l){this.Be=l,this.yh=NaN,this.eH=new f.ig,this.fH=new f.ig,this.ms=new f.Nc,this.ns=new f.Nc}return o.prototype.compare=function(l,h,m){if(l=l.ja(m),this.Be.pB(h,this.eH),this.Be.pB(l,this.fH),h=this.eH.get(),l=this.fH.get(),this.ms.K(h.sa,h.pa),this.ns.K(l.sa,l.pa),this.ms.va<this.ns.oa)return-1;if(this.ms.oa>this.ns.va)return 1;m=h.na==h.la;var g=l.na==l.la;if(m||g){if(m&&g)return 0;if(h.na==l.na&&h.sa==l.sa)return m?1:-1;if(h.la==l.la&&h.pa==l.pa)return m?-1:1}return(m=h.Pe(this.yh,this.ms.oa))==(g=l.Pe(this.yh,this.ns.oa))&&((g=.5*((m=Math.min(h.la,l.la))+this.yh))==this.yh&&(g=m),m=h.Pe(g,this.ms.oa),g=l.Pe(g,this.ns.oa)),m<g?-1:m>g?1:0},o.prototype.aK=function(l){this.yh=l},o}(),c=function(){function o(l){this.ib=l,this.WH=new f.ig,this.Bf=new f.h,this.wA=new f.Nc}return o.prototype.kX=function(l){this.Bf.L(l)},o.prototype.compare=function(l,h){return this.ib.pB(l.ja(h),this.WH),l=this.WH.get(),this.wA.K(l.sa,l.pa),this.Bf.x<this.wA.oa?-1:this.Bf.x>this.wA.va?1:(l=l.Pe(this.Bf.y,this.Bf.x),this.Bf.x<l?-1:this.Bf.x>l?1:0)},o}();L=function(){function o(){this.hH=this.Di=this.Gi=this.kA=this.Yn=this.ye=this.Kc=this.jh=this.ge=null,this.Go=this.xg=-1,this.gH=!0,this.pA=!1,this.lA=NaN,this.Ni=new f.Md,this.bO=2147483647,this.aO=f.O.truncate(-2147483648),this.cg=this.ae=this.Hl=this.Cq=this.Cm=this.Bq=this.Os=this.Re=-1,this.wa=0}return o.prototype.yy=function(l){this.lA=l},o.prototype.Ym=function(){this.ge==null&&(this.ge=new f.$c(8));var l=this.ge.Ce();return this.ge.S(l,1,0),l},o.prototype.vU=function(){this.Kc==null&&(this.Kc=new f.$c(8));var l=this.Kc.Ce();this.Kc.S(l,2,0),this.Kc.S(l,3,0);var h=this.Kc.Ce();return this.Kc.S(h,2,0),this.Kc.S(h,3,0),this.JJ(l,h),this.JJ(h,l),l},o.prototype.mI=function(){this.ye==null&&(this.ye=new f.$c(8));var l=this.ye.Ce();return this.ye.S(l,2,0),l},o.prototype.TW=function(l,h){this.ge.S(l,7,h)},o.prototype.mn=function(l,h){this.ge.S(l,2,h)},o.prototype.SW=function(l,h){this.ge.S(l,1,h)},o.prototype.lX=function(l,h){this.ge.S(l,3,h)},o.prototype.iX=function(l,h){this.ge.S(l,4,h)},o.prototype.cr=function(l,h){this.ge.S(l,5,h)},o.prototype.eR=function(l){return this.ge.T(l,5)},o.prototype.RW=function(l,h){this.ge.S(l,6,h)},o.prototype.cN=function(l,h){this.RW(h,l)},o.prototype.IJ=function(l,h){this.Kc.S(l,1,h)},o.prototype.JJ=function(l,h){this.Kc.S(l,4,h)},o.prototype.Tl=function(l,h){this.Kc.S(l,5,h)},o.prototype.Sl=function(l,h){this.Kc.S(l,6,h)},o.prototype.$W=function(l,h){this.Kc.S(l,2,h)},o.prototype.$w=function(l,h){this.Kc.S(l,3,h)},o.prototype.LF=function(l){return this.Kc.T(l,3)},o.prototype.Gt=function(l,h){this.Kc.S(l,7,h)},o.prototype.EK=function(l,h){if(this.mm(l)!=-1)for(h=h?-1:l,l=this.mm(l);l!=-1;l=this.js(l))this.g.Ra(this.tj(l),this.Cq,h)},o.prototype.yx=function(l,h){l!=-1&&(this.EK(l,h),this.EK(this.xa(l),h))},o.prototype.Dt=function(l,h){this.ye.S(l,1,h)},o.prototype.Vg=function(l,h){this.ye.S(l,2,h)},o.prototype.jn=function(l,h){this.ye.S(l,3,h),this.NW(l,this.dR(h)),this.MW(h,l)},o.prototype.MW=function(l,h){this.ye.S(l,4,h)},o.prototype.NW=function(l,h){this.ye.S(l,5,h)},o.prototype.DJ=function(l,h){this.ye.S(l,6,h)},o.prototype.BJ=function(l,h){this.ye.S(l,7,h)},o.prototype.AJ=function(l,h){this.Yn.write(l,h)},o.prototype.CJ=function(l,h){this.kA.write(l,h)},o.prototype.kY=function(l){var h=0,m=0,g=this.AF(l),v=new f.h,w=new f.h,E=new f.h;this.Yr(g,v),w.L(v);var A=g;do this.lm(A,E),m+=f.h.tb(w,E),this.$e(this.xa(A))!=l&&(h+=(E.x-v.x-(w.x-v.x))*(E.y-v.y+(w.y-v.y))*.5),w.L(E),A=this.jc(A);while(A!=g);this.Yn.write(l,h),this.kA.write(l,m)},o.prototype.PU=function(l,h){var m=new d(this),g=new f.Yj;g.De(f.O.truncate(this.wa/2)),g.Vo(m);for(var v=new f.ia(0),w=this.$g(),E=null,A=0,M=new f.h,I=this.Re;I!=-1;I=this.Rf(I)){if(!(255&++A)&&h!=null&&!h.progress(-1,-1))throw f.i.WC();var D=this.Me(I);if(D!=-1){if(v.Bh(0),!this.gY(g,w,v,D)){this.D(I,M),m.aK(M.y);var k=D;do{var B=this.Ab(k,w);B!=-1&&(g.vd(B,-1),this.Kb(k,w,-2)),k=this.jc(this.xa(k))}while(D!=k);k=D;do(B=this.Ab(k,w))==-1&&(B=g.addElement(k,-1),v.add(B)),k=this.jc(this.xa(k));while(D!=k)}for(D=v.size-1;0<=D;D--)B=v.get(D),k=g.ja(B),this.Kb(this.xa(k),w,B),this.OU(g,B,l)}else this.cz(I)==-1&&(E==null&&(E=new c(this)),this.D(I,M),E.kX(M),k=g.IW(E),D=this.Hl,k!=-1&&(B=g.ja(k),this.$e(B)==this.$e(this.xa(B))&&(B=this.OF(g,k)),B!=-1&&(D=this.$e(B))),this.cN(D,I))}this.Jg(w)},o.prototype.OU=function(l,h,m){var g=l.ja(h),v=this.$e(g);if(this.Gn(v)==-1){var w=this.OF(l,h),E=this.xa(g),A=this.$e(E);this.Kp(v),this.Kp(A);var M=this.Gn(v),I=this.Gn(A);if(w==-1&&M==-1&&(A==v?(this.jn(A,this.Hl),M=I=this.Hl):(I==-1&&(this.jn(A,this.Hl),I=this.Hl),this.jn(v,A),M=A)),w!=-1){var D=this.$e(w);I==-1&&(0>=this.Kp(D)?(I=this.Gn(D),this.jn(A,I)):(this.jn(A,D),I=D),A==v&&(M=I))}M==-1&&this.hY(v,A),m==0?this.jW(l,h,g,w,v,A):m==5?this.kW(l,h,g,E,v,A):m==4&&this.iW(g,w,v,A)}},o.prototype.jW=function(l,h,m,g,v,w){var E=this.hk(v);if(g!=-1){var A=this.hk(w),M=this.hk(this.$e(g));g=E&A&M,M^=M&this.dh(m),(M|=g)!=0&&(this.Vg(w,A|M),this.Vg(v,M|E),E=E||M)}for(h=l.lb(h);h!=-1&&(g=l.ja(h),m=this.$e(this.xa(g)),v=this.hk(m),w=this.dh(g),A=this.$e(g),g=v&(M=this.hk(A))&E,E^=E&w,(E|=g)!=0);h=l.lb(h))this.Vg(m,v|E),this.Vg(A,M|E)},o.prototype.kW=function(l,h,m,g,v,w){if(v!=w){m=this.Ab(m,this.cg),m+=this.Ab(g,this.cg),g=0;var E=new f.ia(0),A=new f.ia(0);A.add(0);for(var M=l.rc(-1);M!=h;M=l.lb(M)){var I=l.ja(M),D=this.xa(I),k=this.$e(I),B=this.$e(D);if(k!=B){if(I=this.Ab(I,this.cg),g+=I+=this.Ab(D,this.cg),D=!1,E.size!=0&&E.Fc()==B&&(A.If(),E.If(),D=!0),this.Gn(B)==-1)throw f.i.Qa();D&&this.Gn(B)==k||(A.add(g),E.add(k))}}g+=m,E.size!=0&&E.Fc()==w&&(A.If(),E.If()),g!=0?A.Fc()==0&&(l=this.g.ld,l=this.La(l),this.Vg(v,l)):A.Fc()!=0&&(l=this.g.ld,l=this.La(l),this.Vg(v,l))}},o.prototype.iW=function(l,h,m,g){var v=this.La(this.g.ld);if(h==-1)this.Vg(g,this.Go),1&(l=this.Ab(l,this.xg))?this.Vg(m,v):this.Vg(m,this.Go);else{var w=this.hk(g);w==0?(w=this.hk(this.$e(h)),this.Vg(g,w),1&(l=this.Ab(l,this.xg))?this.Vg(m,w==v?this.Go:v):this.Vg(m,w)):1&(l=this.Ab(l,this.xg))?this.Vg(m,w==v?this.Go:v):this.Vg(m,w)}},o.prototype.gY=function(l,h,m,g){var v=g,w=-1,E=-1,A=0;do{if(A==2)return!1;var M=this.Ab(v,h);if(M!=-1){if(w!=-1)return!1;w=M}else{if(E!=-1)return!1;E=v}A++,v=this.jc(this.xa(v))}while(g!=v);return E!=-1&&w!=-1&&(this.Kb(l.ja(w),h,-2),l.Sj(w,E),m.add(w),!0)},o.prototype.hY=function(l,h){var m=this.Kp(l);if(m!=0){var g=this.Kp(h);0<m&&0>g||0>m&&0<g?this.jn(l,h):(h=this.Gn(h))!=-1&&this.jn(l,h)}},o.prototype.vP=function(l,h){this.Cq=this.g.Gd();for(var m=0,g=h.size;m<g;m++){var v=h.get(m),w=this.g.Pa(v,this.Cm),E=this.g.Qf(this.g.bd(v)),A=this.g.ic(E);if(f.aa.Hc(A)){var M=this.g.U(v);if(M!=-1){var I=this.g.Pa(M,this.Cm);if(w!=I){var D=this.vU(),k=this.xa(D),B=this.jh.Ce();this.jh.S(B,0,v),this.jh.S(B,1,-1),this.Gt(D,B),this.IJ(D,w),(B=this.Me(w))==-1?(this.mn(w,D),this.Tl(D,k),this.Sl(k,D)):(w=this.te(B),this.Tl(B,k),this.Sl(k,B),this.Sl(w,D),this.Tl(D,w)),this.IJ(k,I),(w=this.Me(I))==-1?(this.mn(I,k),this.Sl(D,k),this.Tl(k,D)):(I=this.te(w),this.Tl(w,D),this.Sl(D,w),this.Sl(I,k),this.Tl(k,I)),E=this.La(E),l==0?(this.Kb(k,this.ae,0),this.Kb(D,this.ae,A==1736?E:0)):l==5?(I=new f.h,this.g.D(v,I),v=new f.h,this.g.D(M,v),w=M=0,0>I.compare(v)?M=1:w=-1,this.Kb(k,this.ae,0),this.Kb(D,this.ae,0),this.Kb(D,this.cg,M),this.Kb(k,this.cg,w)):l==7?(this.Kb(k,this.ae,this.Go),this.Kb(D,this.ae,A==1736?E:0)):l==4&&(this.Kb(k,this.ae,0),this.Kb(D,this.ae,0),this.Kb(D,this.xg,1),this.Kb(k,this.xg,1)),A=A==1736?this.aO:0,this.$w(D,E|A),this.$w(k,E|A)}}}}},o.prototype.VT=function(l,h){var m=this.mm(h);if(m!=-1){var g=this.mm(l);this.jh.S(m,1,g),this.Gt(l,m),this.Gt(h,-1)}l=this.xa(l),h=this.xa(h),(m=this.mm(h))!=-1&&(g=this.mm(l),this.jh.S(m,1,g),this.Gt(l,m),this.Gt(h,-1))},o.prototype.IX=function(l){function h(he,ue){return g.HO(he,ue)}var m=new f.ia(0);m.Jb(10);for(var g=this,v=this.Re;v!=-1;v=this.Rf(v)){m.clear(!1);var w=this.Me(v);if(w!=-1){var E=w;do m.add(E),E=this.jc(this.xa(E));while(E!=w);if(1<m.size){if(E=!0,2<m.size)m.Vd(0,m.size,h),m.add(m.get(0));else if(0<this.GO(m.get(0),m.get(1))){var A=m.get(0);m.set(0,m.get(1)),m.set(1,A)}else E=!1;for(var M=A=m.get(0),I=this.uf(M),D=this.xa(M),k=-1,B=1,J=m.size;B<J;B++){var Y=m.get(B),V=this.xa(Y),te=this.jk(V);if(te==I&&Y!=M){if(l==0)k=this.LF(M)|this.LF(Y),this.$w(M,k),this.$w(D,k),this.Kb(M,this.ae,this.Ab(M,this.ae)|this.Ab(Y,this.ae)),this.Kb(D,this.ae,this.Ab(D,this.ae)|this.Ab(V,this.ae));else if(this.cg!=-1)k=this.Ab(M,this.cg)+this.Ab(Y,this.cg),V=this.Ab(D,this.cg)+this.Ab(V,this.cg),this.Kb(M,this.cg,k),this.Kb(D,this.cg,V);else{if(l==7)return void(this.Ni=new f.Md(5,v,-1));this.xg!=-1&&(k=this.Ab(M,this.xg)+this.Ab(Y,this.xg),V=this.Ab(D,this.xg)+this.Ab(V,this.xg),this.Kb(M,this.xg,k),this.Kb(D,this.xg,V))}this.VT(M,Y),this.Ly(Y),k=M,m.set(B,-1),Y==A&&(m.set(0,-1),A=-1)}else this.yx(k,!1),k=-1,M=Y,I=te,D=V}if(this.yx(k,!1),k=-1,E){for(A=-1,B=0,J=m.size;B<J;B++)if((Y=m.get(B))!=-1){if(A==-1)M=A=Y,I=this.uf(M),D=this.xa(M);else if(Y!=M&&(V=this.xa(Y),te=this.jk(V),this.Sl(D,Y),this.Tl(Y,D),M=Y,I=te,D=V,l==7&&(this.Ab(Y,this.ae)|this.Ab(this.te(Y),this.ae))==(1|this.Go)))return void(this.Ni=new f.Md(5,v,-1))}this.mn(v,A)}else{for(A=-1,B=0,J=m.size;B<J;B++)if((Y=m.get(B))!=-1){A=Y;break}w!=A&&this.mn(v,A)}}}}},o.prototype.WN=function(){for(var l=-1,h=this.$g(),m=this.Re;m!=-1;m=this.Rf(m)){var g=this.Me(m);if(g!=-1){var v=g;do{if(this.Ab(v,h)!=1){var w=this.mI();this.Dt(w,v),this.BJ(w,l),l!=-1&&this.DJ(l,w),l=w;var E=0,A=v;do E|=this.Ab(A,this.ae),this.$W(A,w),this.Kb(A,h,1),A=this.jc(A);while(A!=v);this.Vg(w,E)}v=this.jc(this.xa(v))}while(v!=g)}}w=this.mI(),this.Dt(w,-1),this.BJ(w,l),l!=-1&&this.DJ(l,w),this.Hl=w,this.Yn=f.be.qf(this.ye.size,NaN),this.kA=f.be.qf(this.ye.size,NaN),this.AJ(this.Hl,1/0),this.CJ(this.Hl,1/0),this.Jg(h)},o.prototype.sR=function(l,h,m){if((h=h!=-1?h:this.Me(l))==-1)return-1;for(l=h;;){if(this.Ab(h,m)!=1)return h;if((h=this.jc(this.xa(h)))==l)return-1}},o.prototype.yW=function(){for(var l=this.$g(),h=this.Re;h!=-1;h=this.Rf(h))for(var m=-1;;){var g=this.sR(h,m,l);if(g==-1)break;m=this.jc(this.xa(g));for(var v=g;;){var w=this.jc(v),E=this.te(v),A=this.xa(v);if(E==A){if(this.IP(v),m!=v&&m!=A||(m=-1),v==g||E==g){if(v==(g=w)||E==g)break;v=w;continue}}else this.Kb(v,l,1);if((v=w)==g)break}}this.Jg(l)},o.prototype.MB=function(l,h,m,g,v){this.Ug(),this.gH=v,this.g=l,this.Bq=this.g.aF(),(l=new f.ia(0)).Jb(m!=null?this.g.I(m.get(0)):this.g.fd);var w=0,E=1,A=m!=null?m.get(0):this.g.ld;for(v=1;A!=-1;){this.g.HJ(A,this.Bq,E),E<<=1;for(var M=this.g.Ob(A);M!=-1;M=this.g.Rb(M))for(var I=this.g.Xa(M),D=0,k=this.g.Ja(M);D<k;D++)l.add(I),I=this.g.U(I);f.aa.Rn(this.g.ic(A))||(w+=this.g.da(A)),m!=null?(A=v<m.size?m.get(v):-1,v++):A=this.g.ue(A)}for(this.Go=E,this.wa=l.size,this.g.nx(l,this.wa),this.jh==null&&(this.jh=new f.$c(2),this.ge=new f.$c(8),this.Kc=new f.$c(8),this.ye=new f.$c(8)),this.jh.De(this.wa),f.mp.zp(g),this.ge.De(this.wa+10),this.Kc.De(2*this.wa+32),this.ye.De(Math.max(32,w)),this.Cm=this.g.Gd(),m=new f.h,v=0,w=new f.h,m.Rc(),E=0;E<=this.wa;E++)if(E<this.wa?(I=l.get(E),this.g.D(I,w)):w.Rc(),!m.qb(w)){if(v<E){for(I=this.Ym(),k=D=-1;v<E;v++)k=l.get(v),this.g.Ra(k,this.Cm,I),A=this.jh.Ce(),this.jh.S(A,0,k),this.jh.S(A,1,D),D=A,M=this.g.bd(k),A=this.g.Qf(M),A=this.La(A),this.SW(I,this.xd(I)|A);this.TW(I,D),this.cr(I,this.g.Ua(k)),this.Os!=-1&&this.iX(this.Os,I),this.lX(I,this.Os),this.Os=I,this.Re==-1&&(this.Re=I)}v=E,m.L(w)}f.mp.zp(g),this.ae=this.$g(),h==5&&(this.cg=this.$g()),h==4&&(this.xg=this.$g()),this.vP(h,l),this.Ni.Jj==0&&(this.IX(h),this.Ni.Jj==0&&(isNaN(this.lA)||this.xO()?(this.WN(),this.Ni.Jj==0&&(this.Jg(this.ae),this.ae=-1,this.gH&&this.PU(h,g))):this.pA=!0))},o.prototype.Ly=function(l){var h=this.jc(l),m=this.te(l),g=this.xa(l),v=this.jc(g),w=this.te(g);h!=g&&(this.Sl(w,h),this.Tl(h,w)),m!=g&&(this.Sl(m,v),this.Tl(v,m)),m=this.jk(l),this.Me(m)==l&&(v!=l?this.mn(m,v):this.mn(m,-1)),v=this.jk(g),this.Me(v)==g&&(h!=g?this.mn(v,h):this.mn(v,-1)),this.Kc.jd(l),this.Kc.jd(g)},o.prototype.OF=function(l,h){for(;;){if((h=l.we(h))==-1)return-1;var m=l.ja(h);if(this.$e(m)!=this.$e(this.xa(m)))return m}},o.prototype.dr=function(l,h){var m;m===void 0&&(m=!0),this.MB(l,0,null,h,m)},o.prototype.vJ=function(l,h,m){var g=new f.ia(0);g.add(h),this.MB(l,4,g,m,l.ic(h)==1736)},o.prototype.wJ=function(l,h,m){var g=new f.ia(0);g.add(h),this.MB(l,5,g,m,!0)},o.prototype.Ug=function(){this.g!=null&&(this.Bq!=-1&&(this.g.xW(this.Bq),this.Bq=-1),this.Cm!=-1&&(this.g.Td(this.Cm),this.Cm=-1),this.Cq!=-1&&(this.g.Td(this.Cq),this.Cq=-1),this.ae!=-1&&(this.Jg(this.ae),this.ae=-1),this.cg!=-1&&(this.Jg(this.cg),this.cg=-1),this.xg!=-1&&(this.Jg(this.xg),this.xg=-1),this.g=null,this.ge.mj(!0),this.jh.mj(!0),this.Os=this.Re=-1,this.Kc!=null&&this.Kc.mj(!0),this.Gi!=null&&(this.Gi.length=0),this.Di!=null&&(this.Di.length=0),this.hH!=null&&(this.hH.length=0),this.ye!=null&&this.ye.mj(!0),this.Hl=-1,this.Yn=null)},o.prototype.Me=function(l){return this.ge.T(l,2)},o.prototype.D=function(l,h){this.g.dG(this.eR(l),h)},o.prototype.xd=function(l){return this.ge.T(l,1)},o.prototype.Rf=function(l){return this.ge.T(l,4)},o.prototype.cz=function(l){return this.ge.T(l,6)},o.prototype.km=function(l){return this.ge.T(l,7)},o.prototype.js=function(l){return this.jh.T(l,1)},o.prototype.tj=function(l){return this.jh.T(l,0)},o.prototype.ng=function(l,h){return(h=this.Di[h]).size<=l?-1:h.read(l)},o.prototype.nn=function(l,h,m){(h=this.Di[h]).size<=l&&h.resize(this.ge.size,-1),h.write(l,m)},o.prototype.Dp=function(){this.Di==null&&(this.Di=[]);for(var l=f.ia.qf(this.ge.Hg,-1),h=0,m=this.Di.length;h<m;h++)if(this.Di[h]==null)return this.Di[h]=l,h;return this.Di.push(l),this.Di.length-1},o.prototype.Ep=function(l){this.Di[l]=null},o.prototype.jk=function(l){return this.Kc.T(l,1)},o.prototype.uf=function(l){return this.jk(this.xa(l))},o.prototype.xa=function(l){return this.Kc.T(l,4)},o.prototype.te=function(l){return this.Kc.T(l,5)},o.prototype.jc=function(l){return this.Kc.T(l,6)},o.prototype.$e=function(l){return this.Kc.T(l,2)},o.prototype.af=function(l){return this.hk(this.Kc.T(l,2))},o.prototype.mm=function(l){return this.Kc.T(l,7)},o.prototype.Yr=function(l,h){this.D(this.jk(l),h)},o.prototype.lm=function(l,h){this.D(this.uf(l),h)},o.prototype.dh=function(l){return this.Kc.T(l,3)&this.bO},o.prototype.Ab=function(l,h){return(h=this.Gi[h]).size<=l?-1:h.read(l)},o.prototype.Kb=function(l,h,m){(h=this.Gi[h]).size<=l&&h.resize(this.Kc.size,-1),h.write(l,m)},o.prototype.$g=function(){this.Gi==null&&(this.Gi=[]);for(var l=f.ia.qf(this.Kc.Hg,-1),h=0,m=this.Gi.length;h<m;h++)if(this.Gi[h]==null)return this.Gi[h]=l,h;return this.Gi.push(l),this.Gi.length-1},o.prototype.Jg=function(l){this.Gi[l]=null},o.prototype.IP=function(l){var h=this.$e(l),m=this.xa(l),g=this.jc(l);g==m&&(g=this.jc(g))==l&&(g=-1);var v=this.AF(h);v!==l&&v!=m||this.Dt(h,g),m=this.Yn.read(h),isNaN(m)||(this.AJ(h,NaN),this.CJ(h,NaN)),this.yx(l,!0),this.Ly(l)},o.prototype.JP=function(l){for(var h=0,m=l.size;h<m;h++){var g=l.get(h),v=this.$e(this.xa(g));this.Dt(this.$e(g),-1),this.Dt(v,-1),this.yx(g,!0),this.Ly(g)}},o.prototype.AF=function(l){return this.ye.T(l,1)},o.prototype.hk=function(l){return this.ye.T(l,2)},o.prototype.Gn=function(l){return this.ye.T(l,3)},o.prototype.dR=function(l){return this.ye.T(l,4)},o.prototype.Kp=function(l){var h=this.Yn.read(l);return isNaN(h)&&(this.kY(l),h=this.Yn.read(l)),h},o.prototype.La=function(l){return this.g.KF(l,this.Bq)},o.prototype.Le=function(l){return this.g.Pa(l,this.Cm)},o.prototype.uR=function(l){return this.g.Pa(l,this.Cq)},o.prototype.tR=function(l,h){var m=this.Me(l);if(m==-1)return-1;var g=m,v=-1,w=-1;do{if(this.uf(g)==h)return g;if(v==-1){if((v=this.Me(h))==-1)break;w=v}if(this.uf(w)==l)return this.xa(w);g=this.jc(this.xa(g)),w=this.jc(this.xa(w))}while(g!=m&&w!=v);return-1},o.prototype.pB=function(l,h){h.Or(),h=h.get();var m=new f.h;this.Yr(l,m),h.Dc(m),this.lm(l,m),h.Qc(m)},o.prototype.HO=function(l,h){if(l==h)return 0;var m=new f.h;this.lm(l,m);var g=new f.h;return this.lm(h,g),m.qb(g)?0:(h=new f.h,this.Yr(l,h),(l=new f.h).uc(m,h),(m=new f.h).uc(g,h),f.h.nu(l,m))},o.prototype.GO=function(l,h){if(l==h)return 0;var m=new f.h;this.lm(l,m);var g=new f.h;return this.lm(h,g),m.qb(g)?0:(h=new f.h,this.Yr(l,h),(l=new f.h).uc(m,h),(m=new f.h).uc(g,h),0<=m.y&&0<l.y?f.h.nu(l,m):0)},o.prototype.xO=function(){for(var l=f.lc.ox(this.lA),h=new f.h,m=new f.h,g=new f.h,v=new f.h,w=new f.h,E=this.Re;E!=-1;E=this.Rf(E)){var A=this.Me(E);if(A!=-1){var M=A;this.Yr(M,h),this.lm(M,m),w.uc(m,h);var I=w.Sk();do{var D=M;if((M=this.jc(this.xa(M)))!=D){this.lm(M,g),v.uc(g,h),D=v.Sk();var k=v.wi(w);if(k*k/(D*I)*Math.min(D,I)<=l)return!1;w.L(v),I=D,m.L(g)}}while(M!=A)}}return!0},o}(),f.iu=L}(Q||(Q={})),function(f){var L=function(){function x(){this.j=null,this.oH=new f.h,this.pH=new f.h,this.Gj=null,this.Mv=!1,this.tl=-1}return x.prototype.cf=function(d){return d<this.Gj.length&&this.Gj[d]},x.prototype.dl=function(d,c,o,l){var h=f.aa.tf(this.j.g.ic(o));if(f.aa.tf(this.j.g.ic(c))!=2||h!=1)throw f.i.Qa();this.FP(d,c,o,l)},x.prototype.dr=function(d,c){this.j==null&&(this.j=new f.iu),this.j.dr(d,c)},x.prototype.Ft=function(d,c,o){for(f.Tk.V(d,c,o,!0),c=d.ld;c!=-1;c=d.ue(c))d.ic(c)==1736&&f.rn.V(d,c,-1,this.Mv,o);this.dr(d,o)},x.prototype.ME=function(d,c,o,l,h){var m=this.j.g;if(m.ic(d)==1736)for(d=m.Ob(d);d!=-1;d=m.Rb(d)){var g=m.Xa(d);this.j.Le(g),this.j.Le(m.U(g));var v=this.j.uR(g);if(v!=-1){var w=this.j.Ab(v,o);if(w!=1&&w!=2)if(this.cf(this.j.af(v))){this.j.Kb(v,o,1),w=m.vf(c,-1);var E=v,A=this.j.Le(g),M=1;do{var I=this.sm(g,h);m.ij(w,I),l!=-1&&this.j.nn(A,l,1),this.j.Kb(E,o,1),E=this.j.jc(E);do var D=(I=M==1?m.U(g):m.Ma(g))!=-1?this.j.Le(I):-1;while(D==A);var k=this.j.jk(E);if(k!=D){do D=(I=M==1?m.Ma(g):m.U(g))!=-1?this.j.Le(I):-1;while(D==A);k!=D?(D=k,I=this.j.tj(this.j.km(D))):M=-M}A=D,g=I}while(E!=v);m.kn(w,!0)}else this.j.Kb(v,o,2)}}},x.prototype.eF=function(){for(var d=this.j.$g(),c=new f.ia(0),o=this.j.Re;o!=-1;o=this.j.Rf(o)){var l=this.j.Me(o),h=l;if(l!=-1)do{if(this.j.Ab(h,d)!=1){var m=this.j.xa(h);this.j.Kb(m,d,1),this.j.Kb(h,d,1),this.cf(this.j.af(h))&&this.cf(this.j.af(m))&&c.add(h)}h=this.j.jc(this.j.xa(h))}while(h!=l)}this.j.Jg(d),this.j.JP(c)},x.prototype.sm=function(d,c){return c==-1?d:this.aS(d,c)},x.prototype.aS=function(d,c){var o=this.j.g,l=this.j.km(this.j.Le(d));do{var h=this.j.tj(l);if(o.Qf(o.bd(h))==c)return h;l=this.j.js(l)}while(l!=-1);return d},x.prototype.Ot=function(d,c,o){this.eF();var l=this.j.g,h=l.Ig(1736),m=this.j.$g();return this.uK(d,c,h,o,m,-1),this.j.Jg(m),f.rn.V(l,h,1,this.Mv,null),h},x.prototype.uK=function(d,c,o,l,h,m){for(this.ME(d,o,h,m,l),c!=-1&&this.ME(c,o,h,m,l),d=this.j.g,c=this.j.Re;c!=-1;c=this.j.Rf(c)){var g=this.j.Me(c);if(g!=-1){var v=g;do{var w=this.j.Ab(v,h);if(w!=1&&w!=2)if(this.cf(this.j.af(v))){w=d.vf(o,-1);var E=v;do{var A=this.j.mm(E);A!=-1?A=this.j.tj(A):(A=this.j.tj(this.j.mm(this.j.xa(E))),A=this.j.g.U(A)),A=this.sm(A,l),d.ij(w,A),this.j.Kb(E,h,1),m!=-1&&(A=this.j.Le(A),this.j.nn(A,m,1)),E=this.j.jc(E)}while(E!=v);d.kn(w,!0)}else this.j.Kb(v,h,2);v=this.j.jc(this.j.xa(v))}while(v!=g)}}},x.prototype.aY=function(d,c,o){var l=this.j.g,h=l.Ig(1736),m=l.Ig(1607),g=l.Ig(550);this.eF();var v=-1,w=this.j.$g(),E=this.j.Dp();for(this.uK(d,c,h,o,w,E),d=this.j.Re;d!=-1;d=this.j.Rf(d))if((c=this.j.Me(d))!=-1){var A=c;do{var M=this.j.Ab(A,w),I=this.j.Ab(this.j.xa(A),w);if((M|=I)==2)if(M=this.j.dh(A),this.cf(M)){var D=l.vf(m,-1),k=A;M=this.Yw(d,l),M=this.sm(M,o),l.ij(D,M),this.j.nn(d,E,1);do{if(M=this.j.uf(k),I=this.Yw(M,l),I=this.sm(I,o),l.ij(D,I),this.j.Kb(k,w,1),this.j.Kb(this.j.xa(k),w,1),this.j.nn(M,E,1),k=this.j.jc(k),M=this.j.Ab(k,w),(M|=I=this.j.Ab(this.j.xa(k),w))!=2)break;if(M=this.j.dh(k),!this.cf(M)){this.j.Kb(k,w,1),this.j.Kb(this.j.xa(k),w,1);break}}while(k!=A)}else this.j.Kb(A,w,1),this.j.Kb(this.j.xa(A),w,1);A=this.j.jc(this.j.xa(A))}while(A!=c)}for(d=this.j.Re;d!=-1;d=this.j.Rf(d))(M=this.j.ng(d,E))!=1&&(M=this.j.xd(d),this.cf(M)&&(v==-1&&(v=l.vf(g,-1)),(c=this.j.km(d))!=-1&&(c=this.j.tj(c),M=this.sm(c,o),l.ij(v,M))));return this.j.Ep(E),this.j.Jg(w),f.rn.V(l,h,1,this.Mv,null),(o=[])[0]=g,o[1]=m,o[2]=h,o},x.prototype.Yw=function(d,c){var o=-1;for(d=this.j.km(d);d!=-1;d=this.j.js(d)){var l=this.j.tj(d);o==-1&&(o=l);var h=this.j.La(c.Qf(c.bd(l)));if(this.cf(h)){o=l;break}}return o},x.prototype.lB=function(d,c){for(var o=this.jl(c),l=this.j.jk(c),h=this.j.uf(c),m=0,g=0,v=this.j.km(l);v!=-1;v=this.j.js(v)){var w=this.j.tj(v),E=d.bd(w),A=this.j.La(d.Qf(E));E=d.Xa(E),(A=(A&o)!=0)&&E==w&&(this.tl=c);var M=d.U(w);M!=-1&&this.j.Le(M)==h?(m++,A&&(this.tl===-1&&E==M&&(w=this.j.jc(c),this.cf(this.jl(w))&&(this.tl=w)),g++)):(w=d.Ma(w))!=-1&&this.j.Le(w)==h&&(m--,A&&(this.tl===-1&&E===w&&(w=this.j.jc(c),this.cf(this.jl(w))&&(this.tl=w)),g--))}return this.j.D(l,this.oH),this.j.D(h,this.pH),(g!=0?g:m)*(d=f.h.tb(this.oH,this.pH))},x.prototype.jl=function(d){return this.j.dh(d)|this.j.af(d)|this.j.af(this.j.xa(d))},x.prototype.xK=function(d){for(var c=this.j.xa(this.j.te(d)),o=-1;c!=d;){if(this.cf(this.jl(c))){if(o!=-1)return-1;o=c}c=this.j.xa(this.j.te(c))}return o!=-1?this.j.xa(o):-1},x.prototype.yK=function(d){for(var c=this.j.xa(this.j.jc(d)),o=-1;c!=d;){if(this.cf(this.jl(c))){if(o!=-1)return-1;o=c}c=this.j.xa(this.j.jc(c))}return o!=-1?this.j.xa(o):-1},x.prototype.mJ=function(d,c,o,l,h){var m=this.j.g,g=d,v=this.j.xa(g);this.j.Kb(g,o,1),this.j.Kb(v,o,1),this.tl=-1;for(var w=this.lB(m,g),E=g,A=-1,M=!1,I=1;;){var D=this.j.te(g);if(D==v)break;if(v=this.j.jc(v),this.j.xa(D)!=v){if((g=this.xK(g))==-1){M=!0;break}v=this.j.xa(g)}else g=D;if(g==d){A=d;break}if(D=this.jl(g),!this.cf(D))break;this.j.Kb(g,o,1),this.j.Kb(v,o,1),E=g,w+=this.lB(m,g),I++}if(A==-1)for(g=d,v=this.j.xa(g),A=g;(d=this.j.jc(g))!=v;){if(v=this.j.te(v),this.j.xa(d)!=v){if((g=this.yK(g))==-1){M=!0;break}v=this.j.xa(g)}else g=d;if(D=this.jl(g),!this.cf(D))break;this.j.Kb(g,o,1),this.j.Kb(v,o,1),A=g,w+=this.lB(m,g),I++}else if(this.tl!=-1&&(E=this.tl,A=this.j.te(this.tl),this.j.xa(A)!=this.j.jc(this.j.xa(E))&&(A=this.xK(E))==-1))throw f.i.Qa();for(0<=w||(g=A,A=this.j.xa(E),E=this.j.xa(g)),o=m.vf(c,-1),g=E,E=this.j.jk(E),M=this.j.uf(A)==E&&M,w=this.Yw(E,m),w=this.sm(w,h),m.ij(o,w),l!=-1&&this.j.nn(E,l,1),E=0,I=M?f.O.truncate((I+1)/2):-1;d=this.j.uf(g),w=this.Yw(d,m),w=this.sm(w,h),m.ij(o,w),E++,l!=-1&&this.j.nn(d,l,1),M&&E==I&&(o=m.vf(c,-1),m.ij(o,w)),g!=A;)if(d=this.j.jc(g),this.j.te(this.j.xa(g))!=this.j.xa(d)){if((g=this.yK(g))==-1)throw f.i.Qa()}else g=d},x.prototype.Pt=function(d){for(var c=this.j.g.Ig(1607),o=this.j.$g(),l=this.j.Re;l!=-1;l=this.j.Rf(l)){var h=this.j.Me(l),m=h;do this.j.Ab(m,o)!=1&&this.cf(this.jl(m))&&this.mJ(m,c,o,-1,d),m=this.j.jc(this.j.xa(m));while(m!=h)}return this.j.Jg(o),c},x.prototype.bY=function(d){for(var c=this.j.g,o=c.Ig(1607),l=c.Ig(550),h=this.j.$g(),m=this.j.Dp(),g=-1,v=this.j.Re;v!=-1;v=this.j.Rf(v)){var w=this.j.Me(v),E=w;do{var A=this.j.Ab(E,h);A!=1&&(A=this.jl(E),this.cf(A)&&this.mJ(E,o,h,m,d)),E=this.j.jc(this.j.xa(E))}while(E!=w)}for(v=this.j.Re;v!=-1;v=this.j.Rf(v))(A=this.j.ng(v,m))!=1&&(A=this.j.xd(v),this.cf(A)&&(g==-1&&(g=c.vf(l,-1)),(w=this.j.km(v))!=-1&&(w=this.j.tj(w),w=this.sm(w,d),c.ij(g,w))));return this.j.Jg(h),this.j.Ep(m),(d=[])[0]=l,d[1]=o,d},x.prototype.mr=function(){for(var d=this.j.g,c=d.Ig(550),o=d.vf(c,-1),l=this.j.Re;l!=-1;l=this.j.Rf(l))if(this.cf(this.j.xd(l))){for(var h=-1,m=this.j.km(l);m!=-1;m=this.j.js(m)){var g=this.j.tj(m);h==-1&&(h=g);var v=this.j.La(d.Qf(d.bd(g)));if(this.cf(v)){h=g;break}}d.ij(o,h)}return c},x.prototype.bq=function(d){this.Gj=[];for(var c=0;c<d;c++)this.Gj[c]=!1},x.aW=function(d,c,o){var l=d.Ia(),h=Array(1e3);f.O.$u(h,null);var m=f.O.lg(1e3,0),g=d.I(),v=!0,w=c.Db()==2;if(c.Db()!=1&&c.Db()!=2)throw f.i.Qa();for(var E=0;E<g;){var A=f.O.truncate(d.lW(h,E)-E);w?f.hd.sK(c,h,A,o,m):f.hd.tK(c,h,A,o,m);for(var M=0,I=0;I<A;I++)m[I]==0&&(v&&(v=!1,l.Fd(d,0,E)),M!=I&&l.Fd(d,E+M,E+I),M=I+1);v||M==A||l.Fd(d,E+M,E+A),E+=A}return v?d:l},x.zG=function(d,c,o){return d instanceof f.de?x.aW(d,c,o):c instanceof f.Sa?d.B()||c.B()?d.Ia():f.Tk.zU(o,d,c)?f.Tk.CO(d,c):d.Ia():x.bW(d,c,o)},x.Av=function(d,c,o,l){var h=new f.l;d.A(h);var m=new f.l;c.A(m);var g=new f.l;if(g.K(h),g.Zb(m),o=f.ta.Wd(o,g,!0),(g=new f.l).K(m),m=f.ta.Er(o),g.W(m,m),!h.isIntersecting(g)){if(d.Db()<=c.Db())return x.ki(x.Xe(d.Ia()),d,"&");if(d.Db()>c.Db())return x.ki(x.Xe(c.Ia()),d,"&")}return m=new x,g=(h=new f.gd).Ib(x.Xe(d)),c=h.Ib(x.Xe(c)),m.Ft(h,o,l),l=m.Av(g,c),d=x.ki(h.Ne(l),d,"&"),f.aa.Hc(d.getType())&&(d.Ch(2,o),d.getType()==1736&&d.fm()),d},x.bW=function(d,c,o){if(d.B()||c.B())return d.Ia();var l=[null],h=[0],m=c.Db()==2;if(c.Db()!=1&&c.Db()!=2)throw f.i.Qa();return l[0]=d.D(),m?f.hd.sK(c,l,1,o,h):f.hd.tK(c,l,1,o,h),h[0]==0?d.Ia():d},x.prototype.LU=function(d,c,o,l,h){if(d.B())return d;var m=new f.gd;return d=m.Ib(d),this.Mk(m,d,c,o,l,h)},x.prototype.NU=function(d,c,o,l,h,m){if(h&&d.ic(c)!=550){var g=new f.RC;g.TX(d,o),g.Ng?(f.Tk.V(d,o,m,!0),h=!1):this.j.yy(o)}else f.Tk.V(d,o,m,!0),h=!1;if(l&&d.ic(c)!=550?this.j.wJ(d,c,m):this.j.vJ(d,c,m),this.j.pA)return this.j.Ug(),this.j=null,this.Mk(d,c,o,l,!1,m);if(this.j.yy(NaN),m=this.j.La(c),this.bq(m+1),this.Gj[m]=!0,d.ic(c)==1736||l&&d.ic(c)!=550)return d.Yo(c,0),c=this.Ot(c,-1,-1),(d=d.Ne(c)).Yo(0),h?d.Ch(1,0):(d.Ch(2,o),d.fm()),d;if(d.ic(c)==1607)return c=this.Pt(-1),d=d.Ne(c),h||d.Ch(2,o),d;if(d.ic(c)==550)return c=this.mr(),d=d.Ne(c),h||d.Ch(2,o),d;throw f.i.Qa()},x.prototype.Mk=function(d,c,o,l,h,m){this.j=new f.iu;try{return this.NU(d,c,o,l,h,m)}finally{this.j.Ug()}},x.Mk=function(d,c,o,l,h){return new x().LU(d,c,o,l,h)},x.prototype.MU=function(d,c,o,l){this.Mv=d,this.j=new f.iu,d=c.In(o);var h=c.ic(o);if(d!=1||h==550?this.j.vJ(c,o,l):this.j.wJ(c,o,l),!this.j.pA)if(this.j.yy(NaN),l=this.j.La(o),this.bq(l+1),this.Gj[l]=!0,c.ic(o)==1736||d==1&&c.ic(o)!=550)c.Yo(o,0),l=this.Ot(o,-1,-1),c.hC(l,o),c.BB(l);else if(c.ic(o)==1607)l=this.Pt(-1),c.hC(l,o),c.BB(l);else{if(c.ic(o)!=550)throw f.i.fa("internal error");l=this.mr(),c.hC(l,o),c.BB(l)}},x.prototype.im=function(d,c){var o=f.aa.tf(this.j.g.ic(d)),l=f.aa.tf(this.j.g.ic(c));if(o>l)return d;var h=this.j.La(d),m=this.j.La(c);if(this.bq(1+(h|m)),this.Gj[this.j.La(d)]=!0,o==2&&l==2)return this.Ot(d,c,-1);if(o==1&&l==2||o==1&&l==1)return this.Pt(-1);if(o==0)return this.mr();throw f.i.Qa()},x.prototype.Av=function(d,c){var o=f.aa.tf(this.j.g.ic(d)),l=f.aa.tf(this.j.g.ic(c)),h=this.j.La(d),m=this.j.La(c);if(this.bq(1+(h|m)),this.Gj[this.j.La(d)|this.j.La(c)]=!0,h=-1,1<this.j.g.ht.Aa&&(h=d),o==2&&l==2)return this.Ot(d,c,h);if(o==1&&0<l||l==1&&0<o)return this.Pt(h);if(o==0||l==0)return this.mr();throw f.i.Qa()},x.prototype.Pz=function(d,c){var o=f.aa.tf(this.j.g.ic(d)),l=f.aa.tf(this.j.g.ic(c)),h=this.j.La(d),m=this.j.La(c);if(this.bq(1+(h|m)),this.Gj[this.j.La(d)|this.j.La(c)]=!0,h=-1,1<this.j.g.ht.Aa&&(h=d),o==2&&l==2)return this.aY(d,c,h);if(o==1&&0<l||l==1&&0<o)return this.bY(h);if(o==0||l==0)return(d=[])[0]=this.mr(),d;throw f.i.Qa()},x.prototype.ep=function(d,c){var o=f.aa.tf(this.j.g.ic(d)),l=f.aa.tf(this.j.g.ic(c)),h=this.j.La(d),m=this.j.La(c);if(this.bq(1+(h|m)),this.Gj[this.j.La(d)]=!0,this.Gj[this.j.La(c)]=!0,o==2&&l==2)return this.Ot(d,c,-1);if(o==1&&l==1)return this.Pt(-1);if(o==0&&l==0)return this.mr();throw f.i.Qa()},x.Xe=function(d){var c=d.getType();return c==197?(c=new f.Da(d.description),d.B()||c.ad(d,!1),c):c==33?(c=new f.de(d.description),d.B()||c.add(d),c):c==322?(c=new f.Ta(d.description),d.B()||c.oc(d,!0),c):d},x.ki=function(d,c,o){var l=d.getType();return l==197?(c=new f.Da(d.description),d.B()||c.ad(d,!1),c):l!=33||o!="|"&&o!="^"?l==322?(c=new f.Ta(d.description),d.B()||c.oc(d,!0),c):l==33&&o=="-"&&c.getType()==33||l==550&&o=="&"&&c.getType()==33?(c=new f.Sa(d.description),d.B()||d.ve(0,c),c):d:(c=new f.de(d.description),d.B()||c.add(d),c)},x.im=function(d,c,o,l){if(d.B()||c.B()||d.Db()>c.Db())return x.ki(x.Xe(d),d,"-");var h=new f.l;d.A(h);var m=new f.l;if(c.A(m),!h.isIntersecting(m))return x.ki(x.Xe(d),d,"-");var g=new f.l;return g.K(h),g.Zb(m),o=f.ta.Wd(o,g,!0),m=new x,g=(h=new f.gd).Ib(x.Xe(d)),c=h.Ib(x.Xe(c)),m.Ft(h,o,l),l=m.im(g,c),l=h.Ne(l),d=x.ki(l,d,"-"),f.aa.Hc(d.getType())&&(d.Ch(2,o),d.getType()==1736&&d.fm()),d},x.VP=function(d,c,o){if(2>d.length)throw f.i.N("not enough geometries to dissolve");for(var l=0,h=0,m=d.length;h<m;h++)l=Math.max(d[h].Db(),l);var g=new f.l;g.Oa();var v=new f.gd,w=-1,E=0,A=-1;for(h=0,m=d.length;h<m;h++)if(d[h].Db()==l)if(d[h].B())A==-1&&(A=h);else{A=h,w==-1?w=v.Ib(x.Xe(d[h])):v.uN(w,x.Xe(d[h]));var M=new f.l;d[h].xc(M),g.Zb(M),E++}return 2>E?x.Xe(d[A]):(d=l==2,c=f.ta.Wd(l==0?c:null,g,!0),new x().Mk(v,w,c,d,!0,o))},x.Pz=function(d,c,o,l){var h=[null,null,null],m=new f.l;d.A(m);var g=new f.l;c.A(g);var v=new f.l;if(v.K(m),v.Zb(g),o=f.ta.Wd(o,v,!0),(v=new f.l).K(g),g=f.ta.Er(o),v.W(g,g),!m.isIntersecting(v)){if(d.Db()<=c.Db())return h[(d=x.ki(x.Xe(d.Ia()),d,"&")).Db()]=d,h;if(d.Db()>c.Db())return h[(d=x.ki(x.Xe(c.Ia()),d,"&")).Db()]=d,h}for(g=new x,v=(m=new f.gd).Ib(x.Xe(d)),c=m.Ib(x.Xe(c)),g.Ft(m,o,l),l=g.Pz(v,c),c=0;c<l.length;c++)g=x.ki(m.Ne(l[c]),d,"&"),f.aa.Hc(g.getType())&&(g.Ch(2,o),g.getType()==1736&&g.fm()),h[g.Db()]=g;return h},x.ep=function(d,c,o,l){if(d.Db()>c.Db())return x.ki(x.Xe(d),d,"^");if(d.Db()<c.Db()||d.B())return x.ki(x.Xe(c),d,"^");if(c.B())return x.ki(x.Xe(d),d,"^");var h=new f.l;d.A(h);var m=new f.l;c.A(m);var g=new f.l;return g.K(h),g.Zb(m),o=f.ta.Wd(o,g,!0),m=new x,g=(h=new f.gd).Ib(x.Xe(d)),c=h.Ib(x.Xe(c)),m.Ft(h,o,l),l=m.ep(g,c),d=x.ki(h.Ne(l),d,"^"),f.aa.Hc(d.getType())&&(d.Ch(2,o),d.getType()==1736&&d.fm()),d},x.prototype.LQ=function(d,c){var o=this.j.g;d=o.vf(d,-1);for(var l=c.size,h=0;h<l;h++){var m=c.get(h);o.ij(d,m)}o.kn(d,!0)},x.prototype.aX=function(d,c){for(var o=this.j.g,l=o.ld;l!=-1;l=o.ue(l))if(l==c)for(var h=o.Ob(l);h!=-1;h=o.Rb(h)){var m=o.Xa(h);if(m!=-1)for(var g=o.U(m);g!=-1;){m=this.j.Le(m);var v=this.j.Le(g);(m=this.j.tR(m,v))!=-1&&(v=this.j.xa(m),this.j.Kb(m,d,1),this.j.Kb(v,d,2)),m=g,g=o.U(m)}}},x.prototype.cW=function(d,c,o,l){o=this.j.La(o),l=this.j.La(l);var h=new f.ia(0);h.Jb(256);for(var m=this.j.g,g=this.j.$g(),v=this.j.Re;v!=-1;v=this.j.Rf(v)){var w=this.j.Me(v);if(w!=-1){var E=w;do{if(this.j.Ab(E,g)!=1){var A=E,M=E,I=!1,D=0;do{if(this.j.Kb(A,g,1),!I){var k=this.j.dh(A);k&l&&this.j.af(A)&o&&(M=A,I=!0)}I&&(h.add(this.j.tj(this.j.km(this.j.jk(A)))),d!=-1&&(k=this.j.dh(A))&l&&(D|=k=this.j.Ab(A,d))),A=this.j.jc(A)}while(A!=M);I&&0<this.j.Kp(this.j.$e(M))&&(A=m.Ig(1736),this.LQ(A,h),c!=-1&&m.HJ(A,c,D)),h.clear(!1)}E=this.j.jc(this.j.xa(E))}while(E!=w)}}this.j.Jg(g)},x.prototype.FP=function(d,c,o,l){this.j.yW();var h=-1;d!=-1&&(h=this.j.$g(),this.aX(h,o)),this.cW(h,d,c,o),h!=-1&&(this.j.Jg(h),h=-1);var m=this.j.g;for(d=0,h=m.ld;h!=-1;h=m.ue(h))h!=c&&h!=o&&(l.add(h),d++);l.Vd(0,d,function(g,v){return(g=m.wz(m.Ob(g)))<(v=m.wz(m.Ob(v)))?-1:g==v?0:1})},x.prototype.Ug=function(){this.j!=null&&(this.j.Ug(),this.j=null)},x}();f.Fg=L}(Q||(Q={})),function(f){var L=function(){function x(d){d!==void 0?this.setScale(d):this.RB()}return x.prototype.lx=function(){this.Lb=this.Gb=this.jb=this.eb=this.ab=this.bb=0},x.prototype.Nb=function(d){return this==d||d instanceof x&&this.bb==d.bb&&this.eb==d.eb&&this.Gb==d.Gb&&this.jb==d.jb&&this.ab==d.ab&&this.Lb==d.Lb},x.prototype.cc=function(){return f.O.uj(),f.O.uj(),f.O.uj(),f.O.uj(),f.O.uj(),f.O.uj()},x.prototype.Eh=function(d,c){var o=this.jb*d.x+this.ab*d.y+this.Lb;c.x=this.bb*d.x+this.eb*d.y+this.Gb,c.y=o},x.prototype.eY=function(d,c,o){for(var l=0;l<c;l++){var h=d[l].x,m=d[l].y,g=this.bb*h+this.eb*m+this.Gb;h=this.jb*h+this.ab*m+this.Lb,o[l]!=null?o[l].ma(g,h):o[l]=f.h.construct(g,h)}},x.prototype.multiply=function(d){x.multiply(this,d,this)},x.multiply=function(d,c,o){var l=d.bb*c.bb+d.jb*c.eb,h=d.eb*c.bb+d.ab*c.eb,m=d.Gb*c.bb+d.Lb*c.eb+c.Gb,g=d.bb*c.jb+d.jb*c.ab,v=d.eb*c.jb+d.ab*c.ab;d=d.Gb*c.jb+d.Lb*c.ab+c.Lb,o.bb=l,o.eb=h,o.Gb=m,o.jb=g,o.ab=v,o.Lb=d},x.prototype.Of=function(){var d=new x;return d.bb=this.bb,d.eb=this.eb,d.Gb=this.Gb,d.jb=this.jb,d.ab=this.ab,d.Lb=this.Lb,d},x.prototype.mC=function(d){if(!d.B()){for(var c=[],o=0;4>o;o++)c[o]=new f.h;d.nB(c),this.fY(c,c),d.Zw(c,4)}},x.prototype.fY=function(d,c){for(var o=0;o<d.length;o++){var l=new f.h,h=d[o];l.x=this.bb*h.x+this.eb*h.y+this.Gb,l.y=this.jb*h.x+this.ab*h.y+this.Lb,c[o]=l}},x.prototype.pS=function(d,c){d.B()||c.B()||d.R()==0||d.ca()==0?this.lx():(this.eb=this.jb=0,this.bb=c.R()/d.R(),this.ab=c.ca()/d.ca(),this.Gb=c.v-d.v*this.bb,this.Lb=c.G-d.G*this.ab)},x.prototype.dY=function(d){var c=new f.h,o=new f.h;c.ma(this.bb,this.jb),o.ma(this.eb,this.ab),c.sub(c);var l=.5*c.Sk();return c.ma(this.bb,this.jb),o.ma(this.eb,this.ab),c.add(o),d*(l>(c=.5*c.Sk())?Math.sqrt(l):Math.sqrt(c))},x.prototype.RB=function(){this.bb=1,this.jb=this.Gb=this.eb=0,this.ab=1,this.Lb=0},x.prototype.isIdentity=function(d){if(d!==void 0){var c=f.h.construct(0,1);return this.Eh(c,c),c.sub(f.h.construct(0,1)),c.Sk()>d*d?!1:(c.ma(0,0),this.Eh(c,c),!(c.Sk()>d*d)&&(c.ma(1,0),this.Eh(c,c),c.sub(f.h.construct(1,0)),c.Sk()<=d*d))}return this.bb==1&&this.ab==1&&this.eb==0&&this.Gb==0&&this.jb==0&&this.Lb==0},x.prototype.Bi=function(d){return Math.abs(this.bb*this.ab-this.jb*this.eb)<=2*d*(Math.abs(this.bb*this.ab)+Math.abs(this.jb*this.eb))},x.prototype.gg=function(d,c){this.bb=1,this.eb=0,this.Gb=d,this.jb=0,this.ab=1,this.Lb=c},x.prototype.setScale=function(d,c){c!==void 0?(this.bb=d,this.jb=this.Gb=this.eb=0,this.ab=c,this.Lb=0):this.setScale(d,d)},x.prototype.$B=function(){this.bb=0,this.eb=1,this.Gb=0,this.jb=1,this.Lb=this.ab=0},x.prototype.setRotate=function(d){this.pX(Math.cos(d),Math.sin(d))},x.prototype.pX=function(d,c){this.bb=d,this.eb=-c,this.Gb=0,this.jb=c,this.ab=d,this.Lb=0},x.prototype.shift=function(d,c){this.Gb+=d,this.Lb+=c},x.prototype.scale=function(d,c){this.bb*=d,this.eb*=d,this.Gb*=d,this.jb*=c,this.ab*=c,this.Lb*=c},x.prototype.flipX=function(d,c){this.bb=-this.bb,this.eb=-this.eb,this.Gb=d+c-this.Gb},x.prototype.flipY=function(d,c){this.jb=-this.jb,this.ab=-this.ab,this.Lb=d+c-this.Lb},x.prototype.rotate=function(d){var c=new x;c.setRotate(d),this.multiply(c)},x.prototype.inverse=function(d){if(d!==void 0){var c=this.bb*this.ab-this.eb*this.jb;c==0?d.lx():(c=1/c,d.Gb=(this.eb*this.Lb-this.Gb*this.ab)*c,d.Lb=(this.Gb*this.jb-this.bb*this.Lb)*c,d.bb=this.ab*c,d.eb=-this.eb*c,d.jb=-this.jb*c,d.ab=this.bb*c)}else this.inverse(this)},x}();f.Dd=L}(Q||(Q={})),function(f){var L=function(){function x(){}return x.prototype.lx=function(){this.hg=this.Lb=this.Gb=this.He=this.Fe=this.Ee=this.Ge=this.ab=this.eb=this.Ze=this.jb=this.bb=0},x.prototype.setScale=function(d,c,o){this.bb=d,this.eb=this.Ze=this.jb=0,this.ab=c,this.Fe=this.Ee=this.Ge=0,this.He=o,this.hg=this.Lb=this.Gb=0},x.prototype.setTranslate=function(d,c,o){this.bb=1,this.eb=this.Ze=this.jb=0,this.ab=1,this.Fe=this.Ee=this.Ge=0,this.He=1,this.Gb=d,this.Lb=c,this.hg=o},x.prototype.translate=function(d,c,o){this.Gb+=d,this.Lb+=c,this.hg+=o},x.prototype.mC=function(d){if(!d.B()){for(var c=new f.Nd[8],o=0;8>o;o++)c[o]=new f.Nd;d.nB(c),this.transform(c,8,c),d.Zw(c)}},x.prototype.transform=function(d,c,o){for(var l=0;l<c;l++){var h=new f.Nd,m=d[l];h.x=this.bb*m.x+this.eb*m.y+this.Ee*m.z+this.Gb,h.y=this.jb*m.x+this.ab*m.y+this.Fe*m.z+this.Lb,h.z=this.Ze*m.x+this.Ge*m.y+this.He*m.z+this.hg,o[l]=h}},x.prototype.fp=function(d){var c=new f.Nd;return c.x=this.bb*d.x+this.eb*d.y+this.Ee*d.z+this.Gb,c.y=this.jb*d.x+this.ab*d.y+this.Fe*d.z+this.Lb,c.z=this.Ze*d.x+this.Ge*d.y+this.He*d.z+this.hg,c},x.prototype.Ag=function(d){x.multiply(this,d,this)},x.multiply=function(d,c,o){var l=d.bb*c.bb+d.jb*c.eb+d.Ze*c.Ee,h=d.bb*c.jb+d.jb*c.ab+d.Ze*c.Fe,m=d.bb*c.Ze+d.jb*c.Ge+d.Ze*c.He,g=d.eb*c.bb+d.ab*c.eb+d.Ge*c.Ee,v=d.eb*c.jb+d.ab*c.ab+d.Ge*c.Fe,w=d.eb*c.Ze+d.ab*c.Ge+d.Ge*c.He,E=d.Ee*c.bb+d.Fe*c.eb+d.He*c.Ee,A=d.Ee*c.jb+d.Fe*c.ab+d.He*c.Fe,M=d.Ee*c.Ze+d.Fe*c.Ge+d.He*c.He,I=d.Gb*c.bb+d.Lb*c.eb+d.hg*c.Ee+c.Gb,D=d.Gb*c.jb+d.Lb*c.ab+d.hg*c.Fe+c.Lb;d=d.Gb*c.Ze+d.Lb*c.Ge+d.hg*c.He+c.hg,o.bb=l,o.jb=h,o.Ze=m,o.eb=g,o.ab=v,o.Ge=w,o.Ee=E,o.Fe=A,o.He=M,o.Gb=I,o.Lb=D,o.hg=d},x.inverse=function(d,c){var o=d.bb*(d.ab*d.He-d.Ge*d.Fe)-d.jb*(d.eb*d.He-d.Ge*d.Ee)+d.Ze*(d.eb*d.Fe-d.ab*d.Ee);if(o==0)throw f.i.fa("math singularity");var l=1/o;o=(d.ab*d.He-d.Ge*d.Fe)*l;var h=-(d.eb*d.He-d.Ge*d.Ee)*l,m=(d.eb*d.Fe-d.ab*d.Ee)*l,g=-(d.jb*d.He-d.Fe*d.Ze)*l,v=(d.bb*d.He-d.Ze*d.Ee)*l,w=-(d.bb*d.Fe-d.jb*d.Ee)*l,E=(d.jb*d.Ge-d.Ze*d.ab)*l,A=-(d.bb*d.Ge-d.Ze*d.eb)*l;l*=d.bb*d.ab-d.jb*d.eb;var M=-(d.Gb*o+d.Lb*h+d.hg*m),I=-(d.Gb*g+d.Lb*v+d.hg*w);d=-(d.Gb*E+d.Lb*A+d.hg*l),c.bb=o,c.jb=g,c.Ze=E,c.eb=h,c.ab=v,c.Ge=A,c.Ee=m,c.Fe=w,c.He=l,c.Gb=M,c.Lb=I,c.hg=d},x.prototype.Of=function(){var d=new x;return d.bb=this.bb,d.jb=this.jb,d.Ze=this.Ze,d.eb=this.eb,d.ab=this.ab,d.Ge=this.Ge,d.Ee=this.Ee,d.Fe=this.Fe,d.He=this.He,d.Gb=this.Gb,d.Lb=this.Lb,d.hg=this.hg,d},x}();f.JY=L}(Q||(Q={})),function(f){var L=function(d){function c(o){if(o!==void 0)o=d.call(this,o.cc(),o)||this;else{(o=d.call(this)||this).bg=[],o.bg[0]=0,o.Aa=1,o.uh=[];for(var l=0;10>l;l++)o.uh[l]=-1;o.uh[o.bg[0]]=0}return o.jq=!0,o}return bt(c,d),c.prototype.re=function(o){this.hasAttribute(o)||(this.uh[o]=0,this.jD())},c.prototype.removeAttribute=function(o){if(o==0)throw f.i.N("Position attribue cannot be removed");this.hasAttribute(o)&&(this.uh[o]=-1,this.jD())},c.prototype.reset=function(){this.bg[0]=0,this.Aa=1;for(var o=0;o<this.uh.length;o++)this.uh[o]=-1;this.uh[this.bg[0]]=0,this.jq=!0},c.prototype.EF=function(){return x.kz().add(this)},c.og=function(){return x.kz().$R()},c.prototype.tM=function(){var o=this.cc();return new f.ra(o,this)},c.prototype.jD=function(){for(var o=this.Aa=0,l=0;10>o;o++)0<=this.uh[o]&&(this.bg[l]=o,this.uh[o]=l,l++,this.Aa++);this.jq=!0},c.prototype.cc=function(){return this.jq&&(this.wl=this.An(),this.jq=!1),this.wl},c.prototype.Nb=function(o){if(o==null)return!1;if(o==this)return!0;if(!(o instanceof c)||o.Aa!=this.Aa)return!1;for(var l=0;l<this.Aa;l++)if(this.bg[l]!=o.bg[l])return!1;return this.jq==o.jq},c.prototype.GG=function(o){if(o.Aa!=this.Aa)return!1;for(var l=0;l<this.Aa;l++)if(this.bg[l]!=o.bg[l])return!1;return!0},c.Iw=function(o,l){for(var h=[],m=0;m<o.Aa;m++)h[m]=-1;m=0;for(var g=o.Aa;m<g;m++)h[m]=l.Pf(o.kd(m));return h},c.BR=function(o,l){return(o=new c(o)).re(l),o.EF()},c.CR=function(o,l){for(var h=null,m=0;10>m;m++)!o.hasAttribute(m)&&l.hasAttribute(m)&&(h==null&&(h=new c(o)),h.re(m));return h!=null?h.EF():o},c}(f.ra);f.ee=L;var x=function(){function d(){this.map=[];var c=new L;this.add(c),(c=new L).re(1),this.add(c)}return d.kz=function(){return d.bL},d.prototype.$R=function(){return d.ft},d.prototype.add=function(c){var o=c.cc();if(d.ft!=null&&d.ft.cc()==o&&c.GG(d.ft))return d.ft;if(d.Dw!=null&&d.Dw.cc()==o&&c.GG(d.Dw))return d.Dw;var l=null;return this.map[o]!==void 0&&(l=this.map[o]),l==null&&((l=c.tM()).Aa==1?d.ft=l:l.Aa==2&&l.kd(1)==1?d.Dw=l:this.map[o]=l),l},d.bL=new d,d}()}(Q||(Q={}));var Ti={feet:9002,kilometers:9036,meters:9001,miles:9093,"nautical-miles":9030,yards:9096},Dr={acres:109402,ares:109463,hectares:109401,"square-feet":109405,"square-kilometers":109414,"square-meters":109404,"square-miles":109439,"square-yards":109442},tr=new(function(){function f(){this.RM=50,this.np=new Map,this.gj=[]}return f.prototype.clear=function(){this.gj.length=0,this.np.clear()},f.prototype.delete=function(L){return!!this.np.delete(L)&&(this.gj.splice(this.gj.indexOf(L),1),!0)},f.prototype.get=function(L){var x=this.np.get(L);if(x!==void 0)return this.gj[0]!==L&&(this.gj.splice(this.gj.indexOf(L),1),this.gj.unshift(L)),x},f.prototype.has=function(L){return this.np.has(L)},f.prototype.set=function(L,x){return this.get(L)!==void 0&&this.delete(L),this.gj.unshift(L),this.np.set(L,x),this.oM(),this},f.prototype.oM=function(){for(;this.gj.length&&this.gj.length>this.RM;){var L=this.gj.pop();this.np.delete(L)}},f}()),je=((Tt={}).convertJSONToGeometry=function(f){return Q.$b.fP(f)},Tt.hasM=function(f){return f.hasAttribute(Q.Ih.M)},Tt.hasZ=function(f){return f.hasAttribute(Q.Ih.Z)},Tt.getPointX=function(f){return f.Lg()},Tt.getPointY=function(f){return f.ih()},Tt.getPointZ=function(f){return f.bS()},Tt.getPointM=function(f){return f.zR()},Tt.getXMin=function(f){return f.es()},Tt.getYMin=function(f){return f.gs()},Tt.getXMax=function(f){return f.ds()},Tt.getYMax=function(f){return f.fs()},Tt.getZExtent=function(f){return f.Tg(Q.Ih.Z,0)},Tt.getMExtent=function(f){return f.Tg(Q.Ih.M,0)},Tt.exportPaths=function(f){var L=[],x=f.da(),d=null,c=null,o=f.hasAttribute(Q.Ih.Z),l=f.hasAttribute(Q.Ih.M);o&&(d=f.ub(Q.Ih.Z)),l&&(c=f.ub(Q.Ih.M));for(var h=new Q.h,m=0;m<x;m++){for(var g=f.Ba(m),v=f.Ja(m),w=0,E=0,A=NaN,M=NaN,I=NaN,D=NaN,k=f.dc(m),B=[],J=g;J<g+v;J++){f.D(J,h),D=I=NaN;var Y=[h.x,h.y];o&&(I=d.get(J),Y.push(I)),l&&(D=c.get(J),Y.push(D)),J==g&&k&&(w=h.x,E=h.y,A=I,M=D),B.push(Y)}!k||w==h.x&&E==h.y&&(!o||isNaN(A)&&isNaN(I)||A==I)&&(!l||isNaN(M)&&isNaN(D)||M==D)||B.push(B[0].slice(0)),L.push(B)}return L},Tt.exportPathsFlat=function(){},Tt.exportPoints=function(f){var L=f.hasAttribute(Q.Ih.Z),x=f.hasAttribute(Q.Ih.M),d=null,c=null;L&&(d=f.ub(Q.Ih.Z)),x&&(c=f.ub(Q.Ih.M));for(var o=new Q.h,l=f.I(),h=[],m=0;m<l;m++){f.D(m,o);var g=[o.x,o.y];L&&g.push(d.get(m)),x&&g.push(c.get(m)),h.push(g)}return h},Tt.exportPointsFlat=function(){},Tt),Bi=new Map;return function(){function f(){}return f.buffer=Se,f.clip=C,f.contains=P,f.convexHull=le,f.crosses=$,f.cut=O,f.densify=Oe,f.difference=me,f.disjoint=q,f.distance=N,f.equals=z,f.extendedSpatialReferenceInfo=S,f.generalize=Ae,f.geodesicArea=ti,f.geodesicBuffer=ee,f.geodesicDensify=Ve,f.geodesicLength=Vt,f.intersect=pe,f.intersects=U,f.isSimple=se,f.nearestCoordinate=fe,f.nearestVertex=ye,f.nearestVertices=we,f.offset=ve,f.overlaps=W,f.planarArea=at,f.planarLength=Xt,f.relate=K,f.simplify=ae,f.symmetricDifference=ne,f.touches=j,f.union=ge,f.within=G,f.rotate=Q.Ex.rotate,f.flipHorizontal=Q.Ex.JQ,f.flipVertical=Q.Ex.KQ,f.intersectLinesToPoints=Jt,f.ExtendedParams=Q.yC,f.clearDefaultSpatialReferenceTolerance=Nt,f.changeDefaultSpatialReferenceTolerance=gt,f._enableProjection=Qt,f._project=ni,f._getTransformation=St,f._getTransformationBySuitability=ze,f}()}var r=i();r!==void 0&&(t.exports=r)})(aMe);var lMe=aMe.exports;const mr=CE(lMe),GSt=VSt({__proto__:null,default:mr},[lMe]),HSt=Object.freeze(Object.defineProperty({__proto__:null,G:mr,g:GSt},Symbol.toStringTag,{value:"Module"})),Jr={convertToGEGeometry:qSt,exportPoint:WSt,exportPolygon:XSt,exportPolyline:JSt,exportMultipoint:YSt,exportExtent:ZSt};function qSt(t,e){if(e==null)return null;let i="cache"in e?e.cache._geVersion:void 0;return i==null&&(i=t.convertJSONToGeometry(e),"cache"in e&&(e.cache._geVersion=i)),i}function WSt(t,e,i){const r=t.hasZ(e),n=t.hasM(e),s=new Wt({x:t.getPointX(e),y:t.getPointY(e),spatialReference:i});return r&&(s.z=t.getPointZ(e)),n&&(s.m=t.getPointM(e)),s.cache._geVersion=e,s}function XSt(t,e,i){const r=new nd({rings:t.exportPaths(e),hasZ:t.hasZ(e),hasM:t.hasM(e),spatialReference:i});return r.cache._geVersion=e,r}function JSt(t,e,i){const r=new Vh({paths:t.exportPaths(e),hasZ:t.hasZ(e),hasM:t.hasM(e),spatialReference:i});return r.cache._geVersion=e,r}function YSt(t,e,i){const r=new vw({hasZ:t.hasZ(e),hasM:t.hasM(e),points:t.exportPoints(e),spatialReference:i});return r.cache._geVersion=e,r}function ZSt(t,e,i){const r=t.hasZ(e),n=t.hasM(e),s=new rr({xmin:t.getXMin(e),ymin:t.getYMin(e),xmax:t.getXMax(e),ymax:t.getYMax(e),spatialReference:i});if(r){const a=t.getZExtent(e);s.zmin=a.vmin,s.zmax=a.vmax}if(n){const a=t.getMExtent(e);s.mmin=a.vmin,s.mmax=a.vmax}return s.cache._geVersion=e,s}const KSt=Object.freeze(Object.defineProperty({__proto__:null,hydratedAdapter:Jr},Symbol.toStringTag,{value:"Module"}));function on(t){return Array.isArray(t)?t[0].spatialReference:t&&t.spatialReference}function QSt(t){return mr.extendedSpatialReferenceInfo(t)}function eEt(t,e){return mr.clip(Jr,on(t),t,e)}function tEt(t,e){return mr.cut(Jr,on(t),t,e)}function iEt(t,e){return mr.contains(Jr,on(t),t,e)}function rEt(t,e){return mr.crosses(Jr,on(t),t,e)}function cMe(t,e,i){return mr.distance(Jr,on(t),t,e,i)}function nEt(t,e){return mr.equals(Jr,on(t),t,e)}function sEt(t,e){return mr.intersects(Jr,on(t),t,e)}function oEt(t,e){return mr.touches(Jr,on(t),t,e)}function aEt(t,e){return mr.within(Jr,on(t),t,e)}function lEt(t,e){return mr.disjoint(Jr,on(t),t,e)}function cEt(t,e){return mr.overlaps(Jr,on(t),t,e)}function uEt(t,e,i){return mr.relate(Jr,on(t),t,e,i)}function hEt(t){return mr.isSimple(Jr,on(t),t)}function dEt(t){return mr.simplify(Jr,on(t),t)}function pEt(t,e=!1){return mr.convexHull(Jr,on(t),t,e)}function fEt(t,e){return mr.difference(Jr,on(t),t,e)}function mEt(t,e){return mr.symmetricDifference(Jr,on(t),t,e)}function gEt(t,e){return mr.intersect(Jr,on(t),t,e)}function yEt(t,e=null){return mr.union(Jr,on(t),t,e)}function vEt(t,e,i,r,n,s){return mr.offset(Jr,on(t),t,e,i,r,n,s)}function _Et(t,e,i,r=!1){return mr.buffer(Jr,on(t),t,e,i,r)}function bEt(t,e,i,r,n,s){return mr.geodesicBuffer(Jr,on(t),t,e,i,r,n,s)}function wEt(t,e,i=!0){return mr.nearestCoordinate(Jr,on(t),t,e,i)}function xEt(t,e){return mr.nearestVertex(Jr,on(t),t,e)}function TEt(t,e,i,r){return mr.nearestVertices(Jr,on(t),t,e,i,r)}function Jee(t){return"xmin"in t?"center"in t?t.center:null:"x"in t?t:"extent"in t?t.extent?.center??null:null}function SEt(t,e,i){if(t==null)throw new tE;const r=t.spatialReference;if((i=i??Jee(t))==null)throw new tE;const n=t.constructor.fromJSON(mr.rotate(t,e,i));return n.spatialReference=r,n}function EEt(t,e){if(t==null)throw new tE;const i=t.spatialReference;if((e=e??Jee(t))==null)throw new tE;const r=t.constructor.fromJSON(mr.flipHorizontal(t,e));return r.spatialReference=i,r}function CEt(t,e){if(t==null)throw new tE;const i=t.spatialReference;if((e=e??Jee(t))==null)throw new tE;const r=t.constructor.fromJSON(mr.flipVertical(t,e));return r.spatialReference=i,r}function AEt(t,e,i,r){return mr.generalize(Jr,on(t),t,e,i,r)}function OEt(t,e,i){return mr.densify(Jr,on(t),t,e,i)}function REt(t,e,i,r=0){return mr.geodesicDensify(Jr,on(t),t,e,i,r)}function MEt(t,e){return mr.planarArea(Jr,on(t),t,e)}function PEt(t,e){return mr.planarLength(Jr,on(t),t,e)}function IEt(t,e,i){return mr.geodesicArea(Jr,on(t),t,e,i)}function $Et(t,e,i){return mr.geodesicLength(Jr,on(t),t,e,i)}function LEt(t,e){return mr.intersectLinesToPoints(Jr,on(t),t,e)}function DEt(t,e){mr.changeDefaultSpatialReferenceTolerance(t,e)}function NEt(t){mr.clearDefaultSpatialReferenceTolerance(t)}let tE=class extends Error{constructor(){super("Illegal Argument Exception")}};const wGt=Object.freeze(Object.defineProperty({__proto__:null,buffer:_Et,changeDefaultSpatialReferenceTolerance:DEt,clearDefaultSpatialReferenceTolerance:NEt,clip:eEt,contains:iEt,convexHull:pEt,crosses:rEt,cut:tEt,densify:OEt,difference:fEt,disjoint:lEt,distance:cMe,equals:nEt,extendedSpatialReferenceInfo:QSt,flipHorizontal:EEt,flipVertical:CEt,generalize:AEt,geodesicArea:IEt,geodesicBuffer:bEt,geodesicDensify:REt,geodesicLength:$Et,intersect:gEt,intersectLinesToPoints:LEt,intersects:sEt,isSimple:hEt,nearestCoordinate:wEt,nearestVertex:xEt,nearestVertices:TEt,offset:vEt,overlaps:cEt,planarArea:MEt,planarLength:PEt,relate:uEt,rotate:SEt,simplify:dEt,symmetricDifference:mEt,touches:oEt,union:yEt,within:aEt},Symbol.toStringTag,{value:"Module"}));var OW;let hA=OW=class extends Ne{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new OW({minValue:this.minValue,maxValue:this.maxValue})}};_([T({type:Number,json:{write:!0}})],hA.prototype,"minValue",void 0),_([T({type:Number,json:{write:!0}})],hA.prototype,"maxValue",void 0),hA=OW=_([Z("esri.renderer.support.AuthoringInfoClassBreakInfo")],hA);var RW;let xy=RW=class extends Ne{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new RW({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:Ce(this.classBreakInfos)})}};_([T({type:String,json:{write:!0}})],xy.prototype,"field",void 0),_([T({type:String,json:{write:!0}})],xy.prototype,"normalizationField",void 0),_([T({type:String,json:{write:!0}})],xy.prototype,"label",void 0),_([T({type:[hA],json:{write:!0}})],xy.prototype,"classBreakInfos",void 0),xy=RW=_([Z("esri.renderers.support.AuthoringInfoFieldInfo")],xy);var MW;const G9=new br({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),H9=new br({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),Gpe={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},Hpe=["high-to-low","above-and-below","centered-on","extremes"],qpe=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],Wpe=["seconds","minutes","hours","days","months","years"];let mc=MW=class extends Ne{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new MW({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};_([T({types:Gpe,json:{write:!0}})],mc.prototype,"endTime",void 0),_([Fi("endTime")],mc.prototype,"castEndTime",null),_([T({type:String,json:{write:!0}})],mc.prototype,"field",void 0),_([T({type:Number,json:{write:!0}})],mc.prototype,"maxSliderValue",void 0),_([T({type:Number,json:{write:!0}})],mc.prototype,"minSliderValue",void 0),_([T({types:Gpe,json:{write:!0}})],mc.prototype,"startTime",void 0),_([Fi("startTime")],mc.prototype,"castStartTime",null),_([T({type:G9.apiValues,value:null,json:{type:G9.jsonValues,read:G9.read,write:G9.write}})],mc.prototype,"style",null),_([T({type:qpe,value:null,json:{type:qpe,origins:{"web-scene":{type:Hpe,write:{writer:(t,e)=>{Hpe.includes(t)&&(e.theme=t)}}}},write:!0}})],mc.prototype,"theme",null),_([T({type:H9.apiValues,json:{type:H9.jsonValues,read:H9.read,write:H9.write}})],mc.prototype,"type",void 0),_([T({type:Wpe,json:{type:Wpe,write:!0}})],mc.prototype,"units",void 0),mc=MW=_([Z("esri.renderers.support.AuthoringInfoVisualVariable")],mc);const FEt=mc;let r6=class extends Ne{constructor(e){super(e),this.type=null}};_([T({readOnly:!0,json:{read:!1,write:!0}})],r6.prototype,"type",void 0),r6=_([Z("esri.rest.support.ColorRamp")],r6);const Yee=r6;var PW;let xb=PW=class extends Yee{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new PW({fromColor:Ce(this.fromColor),toColor:Ce(this.toColor),algorithm:this.algorithm})}};_([Bt({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],xb.prototype,"algorithm",void 0),_([T({type:mt,json:{type:[Wr],write:!0}})],xb.prototype,"fromColor",void 0),_([T({type:mt,json:{type:[Wr],write:!0}})],xb.prototype,"toColor",void 0),_([T({type:["algorithmic"]})],xb.prototype,"type",void 0),xb=PW=_([Z("esri.rest.support.AlgorithmicColorRamp")],xb);const Zee=xb;var IW;let dA=IW=class extends Yee{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new IW({colorRamps:Ce(this.colorRamps)})}};_([T({type:[Zee],json:{write:!0}})],dA.prototype,"colorRamps",void 0),_([T({type:["multipart"]})],dA.prototype,"type",void 0),dA=IW=_([Z("esri.rest.support.MultipartColorRamp")],dA);const uMe=dA,kEt={key:"type",base:Yee,typeMap:{algorithmic:Zee,multipart:uMe}};function zEt(t){return t?.type?t.type==="algorithmic"?Zee.fromJSON(t):t.type==="multipart"?uMe.fromJSON(t):null:null}var $W;const M_=new br({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),q9=new br({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Xpe=new br({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Jpe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],UEt=["high-to-low","above-and-below","above","below","90-10"],jEt=["flow-line","wave-front"],BEt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let As=$W=class extends Ne{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?zEt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new $W({classificationMethod:this.classificationMethod,colorRamp:Ce(this.colorRamp),fadeRatio:Ce(this.fadeRatio),fields:this.fields?.slice(0),field1:Ce(this.field1),field2:Ce(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};_([T({type:M_.apiValues,value:null,json:{type:M_.jsonValues,read:M_.read,write:M_.write,origins:{"web-document":{default:"manual",type:M_.jsonValues,read:M_.read,write:M_.write}}}})],As.prototype,"classificationMethod",null),_([T({types:kEt,json:{write:!0}})],As.prototype,"colorRamp",void 0),_([rt("colorRamp")],As.prototype,"readColorRamp",null),_([T({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],As.prototype,"fadeRatio",void 0),_([T({type:[String],value:null,json:{write:!0}})],As.prototype,"fields",null),_([T({type:xy,value:null,json:{write:!0}})],As.prototype,"field1",null),_([T({type:xy,value:null,json:{write:!0}})],As.prototype,"field2",null),_([T({type:jEt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],As.prototype,"flowTheme",null),_([T({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],As.prototype,"focus",null),_([T({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],As.prototype,"isAutoGenerated",void 0),_([T({type:Number,value:null,json:{type:Wr,write:!0}})],As.prototype,"numClasses",null),_([T({type:Jpe,json:{type:Jpe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],As.prototype,"lengthUnit",void 0),_([T({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],As.prototype,"maxSliderValue",void 0),_([T({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],As.prototype,"minSliderValue",void 0),_([T({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],As.prototype,"statistics",null),_([T({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],As.prototype,"standardDeviationInterval",null),_([T({type:q9.apiValues,value:null,json:{type:q9.jsonValues,read:q9.read,write:q9.write,origins:{"web-scene":{type:Xpe.jsonValues,write:{writer:Xpe.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],As.prototype,"type",null),_([T({type:[FEt],json:{write:!0}})],As.prototype,"visualVariables",void 0),_([T({type:BEt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],As.prototype,"univariateSymbolStyle",null),_([T({type:UEt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],As.prototype,"univariateTheme",null),As=$W=_([Z("esri.renderers.support.AuthoringInfo")],As);const Kee=As,HU=new br({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let pA=class extends Ne{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const i=new Set;return await this.collectRequiredFields(i,e),Array.from(i).sort()}getSymbol(e,i){}async getSymbolAsync(e,i){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};_([T({type:Kee,json:{write:!0}})],pA.prototype,"authoringInfo",void 0),_([T({type:HU.apiValues,readOnly:!0,json:{type:HU.jsonValues,read:!1,write:{writer:HU.write,ignoreOrigin:!0}}})],pA.prototype,"type",void 0),pA=_([Z("esri.renderers.Renderer")],pA);const Zg=pA;function VEt(t){return t.match(GEt)?.[1]?.replace(/\\'/g,"'")??null}const GEt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var LW;let eS=LW=class extends Ne{constructor(){super(...arguments),this.title=null}clone(){return new LW({title:this.title})}};_([T({type:String,json:{write:!0}})],eS.prototype,"title",void 0),eS=LW=_([Z("esri.renderers.support.LegendOptions")],eS);var DW;let n6=DW=class extends eS{constructor(){super(...arguments),this.showLegend=null}clone(){return new DW({title:this.title,showLegend:this.showLegend})}};_([T({type:Boolean,json:{write:!0}})],n6.prototype,"showLegend",void 0),n6=DW=_([Z("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],n6);const hMe=n6,qU=new br({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let Jd=class extends Ne{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(Ee.getLogger(this).error(".field: field must be a string value"),null):UO(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};_([T()],Jd.prototype,"index",void 0),_([T({type:qU.apiValues,readOnly:!0,json:{read:qU.read,write:qU.write}})],Jd.prototype,"type",void 0),_([T({type:String,json:{write:!0}})],Jd.prototype,"field",void 0),_([Fi("field")],Jd.prototype,"castField",null),_([T({type:String,json:{write:!0}})],Jd.prototype,"valueExpression",void 0),_([T({type:String,json:{write:!0}})],Jd.prototype,"valueExpressionTitle",void 0),_([T({readOnly:!0})],Jd.prototype,"arcadeRequired",null),_([T({type:hMe,json:{write:!0}})],Jd.prototype,"legendOptions",void 0),Jd=_([Z("esri.renderers.visualVariables.VisualVariable")],Jd);const jR=Jd;var NW;let Tb=NW=class extends Ne{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,i){e[i]=t??0}clone(){return new NW({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};_([T({type:mt,json:{type:[Wr],write:!0}})],Tb.prototype,"color",void 0),_([T({type:String,json:{write:!0}})],Tb.prototype,"label",void 0),_([T({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],Tb.prototype,"value",void 0),_([ot("value")],Tb.prototype,"writeValue",null),Tb=NW=_([Z("esri.renderers.visualVariables.support.ColorStop")],Tb);const HEt=Tb;var FW;let Sb=FW=class extends jR{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new FW({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};_([T({readOnly:!0})],Sb.prototype,"cache",null),_([T({type:["color"],json:{type:["colorInfo"]}})],Sb.prototype,"type",void 0),_([T({type:String,json:{write:!0}})],Sb.prototype,"normalizationField",void 0),_([T({type:[HEt],json:{write:!0}})],Sb.prototype,"stops",null),Sb=FW=_([Z("esri.renderers.visualVariables.ColorVariable")],Sb);const dMe=Sb;var kW;let ly=kW=class extends Ne{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return hS(e.transparency)}writeOpacity(t,e,i){e[i]=XO(t)}clone(){return new kW({label:this.label,opacity:this.opacity,value:this.value})}};_([T({type:String,json:{write:!0}})],ly.prototype,"label",void 0),_([T({type:Number,json:{type:Wr,write:{target:"transparency"}}})],ly.prototype,"opacity",void 0),_([rt("opacity",["transparency"])],ly.prototype,"readOpacity",null),_([ot("opacity")],ly.prototype,"writeOpacity",null),_([T({type:Number,json:{write:!0}})],ly.prototype,"value",void 0),ly=kW=_([Z("esri.renderers.visualVariables.support.OpacityStop")],ly);const qEt=ly;var zW;let Eb=zW=class extends jR{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new zW({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};_([T({readOnly:!0})],Eb.prototype,"cache",null),_([T({type:["opacity"],json:{type:["transparencyInfo"]}})],Eb.prototype,"type",void 0),_([T({type:String,json:{write:!0}})],Eb.prototype,"normalizationField",void 0),_([T({type:[qEt],json:{write:!0}})],Eb.prototype,"stops",null),Eb=zW=_([Z("esri.renderers.visualVariables.OpacityVariable")],Eb);const pMe=Eb;var UW;let $m=UW=class extends jR{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,i,r){if(r?.messages){const n=`visualVariables[${this.index}]`;r.messages.push(new de("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpressionTitle",context:r}))}}clone(){return new UW({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions?.clone()})}};_([T({readOnly:!0})],$m.prototype,"cache",null),_([T({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],$m.prototype,"axis",void 0),_([T({type:["rotation"],json:{type:["rotationInfo"]}})],$m.prototype,"type",void 0),_([T({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],$m.prototype,"rotationType",void 0),_([T({type:String,json:{write:!0}})],$m.prototype,"valueExpressionTitle",void 0),_([ot("web-scene","valueExpressionTitle")],$m.prototype,"writeValueExpressionTitleWebScene",null),$m=UW=_([Z("esri.renderers.visualVariables.RotationVariable")],$m);const fMe=$m;var jW;let qx=jW=class extends Ne{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new jW({label:this.label,size:this.size,value:this.value})}};_([T({type:String,json:{write:!0}})],qx.prototype,"label",void 0),_([T({type:Number,cast:Br,json:{write:!0}})],qx.prototype,"size",void 0),_([T({type:Number,json:{write:!0}})],qx.prototype,"value",void 0),qx=jW=_([Z("esri.renderers.visualVariables.support.SizeStop")],qx);const Wx=qx;var BW;let s6=BW=class extends hMe{constructor(){super(...arguments),this.customValues=null}clone(){return new BW({title:this.title,showLegend:this.showLegend,customValues:this.customValues?.slice(0)})}};_([T({type:[Number],json:{write:!0}})],s6.prototype,"customValues",void 0),s6=BW=_([Z("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],s6);const WEt=s6;var VW;const W9=new br({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),GW=new br({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function Ype(t){if(t!=null)return typeof t=="string"||typeof t=="number"?Br(t):t.type==="size"?Gy(t)?t:(delete(t={...t}).type,new Zr(t)):void 0}function Zpe(t,e,i){if(typeof t!="object")return t;const r=new Zr;return r.read(t,i),r}let Zr=VW=class extends jR{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&REe.test(this.valueExpression)}}set expression(t){Ee.getLogger(this).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){Gy(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),Gy(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return OEe(this)}set maxDataValue(t){t&&this.stops&&(Ee.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(Ee.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return Ype(t)}readMaxSize(t,e,i){return Zpe(t,e,i)}set minDataValue(t){t&&this.stops&&(Ee.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(Ee.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return Ype(t)}readMinSize(t,e,i){return Zpe(t,e,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value):t&&(Ee.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return Hst(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,i,r){if(t==="$view.scale"){if(r?.messages){const n=this.index,s=typeof n=="string"?n:`visualVariables[${n}]`;r.messages.push(new de("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpression",context:r}))}}else e[i]=t}readValueUnit(t){return t?GW.read(t):null}clone(){return new VW({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Gy(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Gy(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone()})}flipSizes(){if(this.transformationType===Ho.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===Ho.Stops){const t=this.stops;if(!t)return this;const e=t.map(r=>r.size).reverse(),i=t.length;for(let r=0;r<i;r++)t[r].size=e[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops?.map(t=>t.value||0)}};_([T({readOnly:!0})],Zr.prototype,"cache",null),_([T({type:W9.apiValues,json:{type:W9.jsonValues,origins:{"web-map":{read:!1}},read:W9.read,write:W9.write}})],Zr.prototype,"axis",void 0),_([T({type:String,value:null,json:{read:!1}})],Zr.prototype,"expression",null),_([T()],Zr.prototype,"index",null),_([T({type:String,readOnly:!0})],Zr.prototype,"inputValueType",null),_([T({type:WEt,json:{write:!0}})],Zr.prototype,"legendOptions",void 0),_([T({type:Number,value:null,json:{write:!0}})],Zr.prototype,"maxDataValue",null),_([T({type:Number,value:null,json:{write:!0}})],Zr.prototype,"maxSize",null),_([Fi("maxSize")],Zr.prototype,"castMaxSize",null),_([rt("maxSize")],Zr.prototype,"readMaxSize",null),_([T({type:Number,value:null,json:{write:!0}})],Zr.prototype,"minDataValue",null),_([T({type:Number,value:null,json:{write:!0}})],Zr.prototype,"minSize",null),_([Fi("minSize")],Zr.prototype,"castMinSize",null),_([rt("minSize")],Zr.prototype,"readMinSize",null),_([T({type:String,json:{write:!0}})],Zr.prototype,"normalizationField",void 0),_([T({readOnly:!0})],Zr.prototype,"arcadeRequired",null),_([T({type:String})],Zr.prototype,"scaleBy",void 0),_([T({type:[Wx],value:null,json:{write:!0}})],Zr.prototype,"stops",null),_([T({type:["outline"],json:{write:!0}})],Zr.prototype,"target",void 0),_([T({type:String,readOnly:!0})],Zr.prototype,"transformationType",null),_([T({type:["size"],json:{type:["sizeInfo"]}})],Zr.prototype,"type",void 0),_([T({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Zr.prototype,"useSymbolValue",void 0),_([T({type:String,json:{write:!0}})],Zr.prototype,"valueExpression",void 0),_([rt("valueExpression",["valueExpression","expression"])],Zr.prototype,"readValueExpression",null),_([ot("web-scene","valueExpression")],Zr.prototype,"writeValueExpressionWebScene",null),_([T({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Zr.prototype,"valueRepresentation",void 0),_([T({type:GW.apiValues,json:{write:GW.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],Zr.prototype,"valueUnit",void 0),_([rt("valueUnit")],Zr.prototype,"readValueUnit",null),Zr=VW=_([Z("esri.renderers.visualVariables.SizeVariable")],Zr);const jN=Zr,XEt={color:dMe,size:jN,opacity:pMe,rotation:fMe},JEt=new br({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),YEt=/^\[([^\]]+)\]$/i;let o6=class extends Ke{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e&&e.filter(i=>!!i),e?.length){for(const i of e)switch(i.type){case"color":this.colorVariables.push(i);break;case"opacity":this.opacityVariables.push(i);break;case"rotation":this.rotationVariables.push(i);break;case"size":this.sizeVariables.push(i)}this.sizeVariables.length&&this.sizeVariables.some(i=>!!i.target)&&e.sort((i,r)=>{let n=null;return n=i.target===r.target?0:i.target?1:-1,n});for(let i=0;i<e.length;i++)e[i].index=i;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,i,r){const{rotationExpression:n,rotationType:s}=i,a=n?.match(YEt),u=a?.[1];if(u&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:u})),e)return e.map(p=>{const y=JEt.read(p.type),b=XEt[y];b||(Ee.getLogger(this).warn(`Unknown variable type: ${y}`),r?.messages&&r.messages.push(new T0("visual-variable:unsupported",`visualVariable of type '${y}' is not supported`,{definition:p,context:r})));const S=new b;return S.read(p,r),S})}writeVariables(e,i){const r=[];for(const n of e){const s=n.toJSON(i);s&&r.push(s)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};_([T()],o6.prototype,"visualVariables",null),o6=_([Z("esri.renderers.visualVariables.VisualVariableFactory")],o6);const ZEt=o6,KEt={base:jR,key:"type",typeMap:{opacity:pMe,color:dMe,rotation:fMe,size:jN}},$E=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new ZEt}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,n){return this._vvFactory.readVariables(i,r,n)}writeVisualVariables(i,r,n,s){r[n]=this._vvFactory.writeVariables(i,s)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const n=this.visualVariables;return n?n.filter(s=>s.type===i&&(typeof r=="string"?s.target===r:r!==!1||!s.target)):[]}async collectVVRequiredFields(i,r){let n=[];this.visualVariables&&(n=n.concat(this.visualVariables));for(const s of n)s&&(s.field&&Gu(i,r,s.field),s.normalizationField&&Gu(i,r,s.normalizationField),s.valueExpression&&(QEt(s.valueExpression,i,r)||await tc(i,r,s.valueExpression)))}};return _([T({types:[KEt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),_([rt("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),_([ot("visualVariables")],e.prototype,"writeVisualVariables",null),e=_([Z("esri.renderers.mixins.VisualVariablesMixin")],e),e};function QEt(t,e,i){const r=VEt(t);return r!=null&&(Gu(e,i,r),!0)}const BN={types:x_e,json:{write:{writer:A8},origins:{"web-scene":{types:jre,write:{writer:A8},read:{reader:aE({types:jre})}}}}},Qee=cJ({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},BN),mMe={types:{base:Zc,key:"type",typeMap:{"simple-fill":b2.typeMap["simple-fill"],"picture-fill":b2.typeMap["picture-fill"],"polygon-3d":b2.typeMap["polygon-3d"]}},json:{write:{writer:A8},origins:{"web-scene":{type:oR,write:{writer:A8}}}}},a6={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t?.toString()}}}};var HW;let cy=HW=class extends Ne{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new HW({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};_([T({type:String,json:{write:!0}})],cy.prototype,"description",void 0),_([T({type:String,json:{write:!0}})],cy.prototype,"label",void 0),_([T({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],cy.prototype,"minValue",void 0),_([T({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],cy.prototype,"maxValue",void 0),_([T(Qee)],cy.prototype,"symbol",void 0),cy=HW=_([Z("esri.renderers.support.ClassBreakInfo")],cy);const aD=cy;var qW;const gMe="log",l6="percent-of-total",c6="field",X9=new br({esriNormalizeByLog:gMe,esriNormalizeByPercentOfTotal:l6,esriNormalizeByField:c6}),eCt=os(aD);let vo=qW=class extends $E(Zg){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,i){if(!Array.isArray(t))return;let r=e.minValue;return t.map(n=>{const s=new aD;return s.read(n,i),s.minValue==null&&(s.minValue=r),s.maxValue==null&&(s.maxValue=s.minValue),r=s.maxValue,s})}writeClassBreakInfos(t,e,i,r){const n=t.map(s=>s.write({},r));this._areClassBreaksConsecutive()&&n.forEach(s=>delete s.classMinValue),e[i]=n}castField(t){return t==null?t:typeof t=="function"?(Ee.getLogger(this).error(".field: field must be a string value"),null):UO(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,i=this.normalizationTotal!=null;return e||i?(t=e&&c6||i&&l6||null,e&&i&&Ee.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==c6&&t!==l6||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,i){let r=null;r=typeof t=="number"?new aD({minValue:t,maxValue:e,symbol:T_e(i)}):eCt(Ce(t)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const n=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(n[0]===t&&n[1]===e){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(t,e){return this.valueExpression&&e?.arcade==null&&Ee.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let i=e;this.valueExpression&&e?.arcade==null&&(i={...i,arcade:await fv()});const r=this.getBreakIndex(t,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(t,e){if(this.valueExpression&&e?.arcade==null)return void Ee.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(t,e);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&e?.arcade==null){const n=await fv(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),i={...i,arcade:n}}const r=this.getBreakIndex(t,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((r,n)=>r+n.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new qW({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol?.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol?.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:Ce(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:Ce(this.visualVariables),legendOptions:Ce(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),tc(t,e,this.valueExpression)];Gu(t,e,this.field),Gu(t,e,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:n,arcade:s,timeZone:a}=e??{},{valueExpression:u}=this;let p=this._compiledValueExpression.valueExpression===u?this._compiledValueExpression.compiledFunction:null;const y=s.arcadeUtils;if(!p){const S=y.createSyntaxTree(u);p=y.createFunction(S),this._compiledValueExpression.compiledFunction=p}this._compiledValueExpression.valueExpression=u;const b=y.executeFunction(p,y.createExecContext(t,y.getViewInfo({viewingMode:i,scale:r,spatialReference:n}),a));return this._getBreakIndexfromInfos(b)}_getBreakIndexForField(t){const e=this.field,i=t.attributes,r=this.normalizationType;let n=parseFloat(i[e]);if(r){const s=this.normalizationTotal,a=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if(r===gMe)n=Math.log(n)*Math.LOG10E;else if(r!==l6||s==null||isNaN(s)){if(r===c6&&!isNaN(a)){if(isNaN(n)||isNaN(a))return-1;n/=a}}else n=n/s*100}return this._getBreakIndexfromInfos(n)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=t&&(e?t<=r[1]:t<r[1]))return i}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let i=1;i<e;i++)if(t[i-1].maxValue!==t[i].minValue)return!1;return!0}};_([T(mMe)],vo.prototype,"backgroundFillSymbol",void 0),_([T({type:[aD]})],vo.prototype,"classBreakInfos",void 0),_([rt("classBreakInfos")],vo.prototype,"readClassBreakInfos",null),_([ot("classBreakInfos")],vo.prototype,"writeClassBreakInfos",null),_([T({type:String,json:{write:!0}})],vo.prototype,"defaultLabel",void 0),_([T(BN)],vo.prototype,"defaultSymbol",void 0),_([T({type:String,json:{write:!0}})],vo.prototype,"field",void 0),_([Fi("field")],vo.prototype,"castField",null),_([T({type:Boolean})],vo.prototype,"isMaxInclusive",void 0),_([T({type:eS,json:{write:!0}})],vo.prototype,"legendOptions",void 0),_([T({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],vo.prototype,"minValue",null),_([T({type:String,json:{write:!0}})],vo.prototype,"normalizationField",void 0),_([T({type:Number,cast:t=>$h(t),json:{write:!0}})],vo.prototype,"normalizationTotal",void 0),_([T({type:X9.apiValues,value:null,json:{type:X9.jsonValues,read:X9.read,write:X9.write}})],vo.prototype,"normalizationType",null),_([Bt({classBreaks:"class-breaks"})],vo.prototype,"type",void 0),_([T({type:String,json:{write:!0}})],vo.prototype,"valueExpression",void 0),_([T({type:String,json:{write:!0}})],vo.prototype,"valueExpressionTitle",void 0),vo=qW=_([Z("esri.renderers.ClassBreaksRenderer")],vo);const yMe=vo;function tCt(t){return"timeZone"in t}function iCt(t){return"timeZone"in t}function rCt(t){return"dateFieldsTimeZone"in t}let vMe=class u6{static fromJSON(e){return new u6(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new u6(e.fields??[],Qpe(e))}static fromLayerJSON(e){return new u6(e.fields??[],Qpe(e))}constructor(e=[],i){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const r=[];for(const n of this.fields){const s=n?.name,a=Kpe(s);if(s&&a){const u=Zb(s);this._fieldsMap.set(s,n),this._fieldsMap.set(u,n),this._normalizedFieldsMap.set(a,n),r.push(`${u}:${n.type}:${this._timeZoneByFieldName?.get(s)}`),Ive(n)?(this.dateFields.push(n),this._dateFieldsSet.add(n)):BY(n)&&(this._numericFieldsSet.add(n),this.numericFields.push(n)),Lre(n)||Dre(n)||(n.editable=n.editable==null||!!n.editable,n.nullable=n.nullable==null||!!n.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)Lre(e)||Dre(e)||e.nullable||Hze(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(Zb(e))??this._normalizedFieldsMap.get(Kpe(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(e){const i=this.get(e&&typeof e!="string"?e.name:e);return i?this._timeZoneByFieldName?this._timeZoneByFieldName.get(i.name):i.type==="date"||i.type==="esriFieldTypeDate"?(Ee.getLogger("esri.layers.support.FieldsIndex").error(new de("getTimeZone:no-timezone-information",`no time zone information for field '${i.name}'`)),W2):_Me.has(i.type)?ES:null:null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return nUe(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map(e=>z6(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}};function Zb(t){return t.trim().toLowerCase()}function Kpe(t){return Rze(t)?.toLowerCase()??""}const _Me=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function Qpe(t){const e=new Map;if(!t.fields)return e;const i=t.datesInUnknownTimezone===!0,{timeInfo:r,editFieldsInfo:n}=t,s=(r?"startField"in r?r.startField:r.startTimeField:"")??"",a=(r?"endField"in r?r.endField:r.endTimeField:"")??"",u=rCt(t)?t.dateFieldsTimeZone??null:t.dateFieldsTimeReference?PI(t.dateFieldsTimeReference):null,p=n?tCt(n)?n.timeZone??u:n.dateFieldsTimeReference?PI(n.dateFieldsTimeReference):u??W2:null,y=r?iCt(r)?r.timeZone??u:r.timeReference?PI(r.timeReference):u:null,b=new Map([[Zb(n?.creationDateField??""),p],[Zb(n?.editDateField??""),p],[Zb(s),y],[Zb(a),y]]);for(const{name:S,type:C}of t.fields)if(_Me.has(C))e.set(S,ES);else if(C!=="date"&&C!=="esriFieldTypeDate")e.set(S,null);else if(i)e.set(S,ES);else{const O=b.get(Zb(S??""))??u;e.set(S,O)}return e}const efe="esri.renderers.support.DictionaryLoader",nCt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let ete=class{constructor(e,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new LCe(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(P){if(qn(P))return this._dictionaryPromise=null,null}const n=this._dictionaryVersion&&this._dictionaryVersion.since(4,0),s={};if(this.fieldMap)for(const P of this._symbolFields){const $=this._getFieldName(this.fieldMap[P]);if($){const N=e.attributes[$];s[P]=n?N:N!=null?""+e.attributes[$]:""}else s[P]=""}let a=null;try{a=r?.(s,i)}catch{return null}if(!a||typeof a!="string")return null;const u=uJ(a).toString(),p=this._symbolCache.get(u);if(p)return p.catch(()=>{this._symbolCache.pop(u)}),p;const y=a.split(";"),b=[],S=[];for(const P of y)if(P)if(P.includes("po:")){const $=P.substr(3).split("|");if($.length===3){const N=$[0],z=$[1];let U=$[2];if(z==="DashTemplate")U=U.split(" ").map(j=>Number(j));else if(z==="Color"){const j=new mt(U).toRgba();U=[j[0],j[1],j[2],255*j[3]]}else U=Number(U);S.push({primitiveName:N,propertyName:z,value:U})}}else if(P.includes("|")){for(const $ of P.split("|"))if(this._itemNames.has($)){b.push($);break}}else this._itemNames.has(P)&&b.push(P);const C=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point",O=this._cimPartsToCIMSymbol(b,S,C,i);return this._symbolCache.put(u,O,1),O}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void Ee.getLogger(efe).error("no valid URL!");const i=ir(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:r}]=await Promise.all([i,fv()]);if(!r)throw this._dictionaryPromise=null,new de("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:n,dictionary_version:s,expression:a,itemsNames:u}=r,p=a;let y=!1;s&&(this._dictionaryVersion=dv.parse(s),y=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(u),this._symbolFields=n.symbol;const b={};if(this.config){const O=this.config;for(const P in O)b[P]=O[P]}if(n.configuration)for(const O of n.configuration)b.hasOwnProperty(O.name)||(b[O.name]=O.value);const S=[];if(e?.fields&&this.fieldMap)for(const O of this._symbolFields){const P=this.fieldMap[O],$=e.fields.filter(N=>N.name.toLowerCase()===P?.toLowerCase());$.length>0&&S.push({...$[0],type:y?$[0].type:"esriFieldTypeString"})}S.length>0&&(this._fieldIndex=new vMe(S));const C=Cze(p,e!=null?e.spatialReference:null,S,b).then(O=>{const P={scale:0};return($,N)=>{if(O==null)return null;const z=O.repurposeFeature({geometry:null,attributes:$});return P.scale=N!=null?N.scale??void 0:void 0,O.evaluate({$feature:z,$view:P},O.services)}}).catch(O=>(Ee.getLogger(efe).error("Creating dictinoary expression failed:",O),null));return this._dictionaryPromise=C,C}async _cimPartsToCIMSymbol(e,i,r,n){const s=new Array(e.length);for(let p=0;p<e.length;p++)s[p]=this._getSymbolPart(e[p],n);const a=await Promise.all(s),u=this.fieldMap;if(u)for(const p of a)bMe(p,u);return new gE({data:this._combineSymbolParts(a,i,r)})}async _getSymbolPart(e,i){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(s=>s.data);const r=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),n=ir(r,{responseType:"json",query:{f:"json"},...i});this._ongoingRequests.set(e,n);try{return(await n).data}catch(s){throw this._ongoingRequests.delete(e),s}}_combineSymbolParts(e,i,r){if(!e||e.length===0)return null;const n={...e[0]};if(e.length>1){n.symbolLayers=[];for(const s of e){const a=s;n.symbolLayers.unshift(...a.symbolLayers)}}return r&&(n.callout=nCt),{type:"CIMSymbolReference",symbol:n,primitiveOverrides:i}}_getFieldName(e){if(this._fieldIndex!==null){const i=this._fieldIndex.get(e);return i?i.name:e}return e}};function bMe(t,e){if(!t)return;const i=t.symbolLayers;if(!i)return;let r=i.length;for(;r--;){const n=i[r];n&&n.enable!==!1&&n.type==="CIMVectorMarker"&&sCt(n,e)}}function sCt(t,e){const i=t.markerGraphics;if(i)for(const r of i){if(!r)continue;const n=r.symbol;if(n)switch(n.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":bMe(n,e);break;case"CIMTextSymbol":n.fieldMap=e}}}const AGt=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:ete},Symbol.toStringTag,{value:"Module"}));var WW;let Yd=WW=class extends $E(Zg){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new ete(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,i,r){r?.origin||super.writeVisualVariables(t,e,i,r)}clone(){return new WW({config:Ce(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:Ce(this.fieldMap),url:Ce(this.url),visualVariables:Ce(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await tc(t,e,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];e.has(r)&&t.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};_([T({type:ete})],Yd.prototype,"_loader",null),_([T({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],Yd.prototype,"config",void 0),_([T({type:Object,json:{write:!0}})],Yd.prototype,"fieldMap",void 0),_([T({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],Yd.prototype,"scaleExpression",void 0),_([ot("scaleExpression")],Yd.prototype,"writeData",null),_([T({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],Yd.prototype,"scaleExpressionTitle",void 0),_([T({type:String,json:{write:!0}})],Yd.prototype,"url",void 0),_([ot("visualVariables")],Yd.prototype,"writeVisualVariables",null),Yd=WW=_([Z("esri.renderers.DictionaryRenderer")],Yd);const oCt=Yd;var XW;let Lm=XW=class extends Ne{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(Ee.getLogger(this).error(".field: field must be a string value"),null):UO(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new XW({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};_([T({type:mt,json:{type:[Number],write:!0}})],Lm.prototype,"color",void 0),_([T({type:String,json:{write:!0}})],Lm.prototype,"field",void 0),_([Fi("field")],Lm.prototype,"castField",null),_([T({type:String,json:{write:!0}})],Lm.prototype,"label",void 0),_([T({type:String,json:{write:!0}})],Lm.prototype,"valueExpression",void 0),_([T({type:String,json:{write:!0}})],Lm.prototype,"valueExpressionTitle",void 0),Lm=XW=_([Z("esri.renderers.support.AttributeColorInfo")],Lm);const wMe=Lm;var JW;let h6=JW=class extends Ne{constructor(){super(...arguments),this.unit=null}clone(){return new JW({unit:this.unit})}};_([T({type:String,json:{write:!0}})],h6.prototype,"unit",void 0),h6=JW=_([Z("esri.renderers.support.DotDensityLegendOptions")],h6);const aCt=h6;var YW;let gc=YW=class extends $E(Zg){constructor(t){super(t),this.attributes=null,this.backgroundColor=new mt([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new dd,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new Sw({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new YW({attributes:Ce(this.attributes),backgroundColor:Ce(this.backgroundColor),dotBlendingEnabled:Ce(this.dotBlendingEnabled),dotShape:Ce(this.dotShape),dotSize:Ce(this.dotSize),dotValue:Ce(this.dotValue),legendOptions:Ce(this.legendOptions),outline:Ce(this.outline),referenceScale:Ce(this.referenceScale),visualVariables:Ce(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes?.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const i of this.attributes??[])i.valueExpression&&await tc(t,e,i.valueExpression),i.field&&t.add(i.field)}};_([T({type:[wMe],json:{write:!0}})],gc.prototype,"attributes",void 0),_([T({type:mt,json:{write:!0}})],gc.prototype,"backgroundColor",void 0),_([T({type:Boolean,json:{write:!0}})],gc.prototype,"dotBlendingEnabled",void 0),_([T({type:String,json:{write:!1}})],gc.prototype,"dotShape",void 0),_([T({type:Number,json:{write:!0}})],gc.prototype,"dotSize",void 0),_([T({type:aCt,json:{write:!0}})],gc.prototype,"legendOptions",void 0),_([T({type:dd,json:{default:null,write:!0}})],gc.prototype,"outline",void 0),_([T({type:Number,json:{write:!0}})],gc.prototype,"dotValue",void 0),_([T({type:Number,json:{write:!0}})],gc.prototype,"referenceScale",void 0),_([T({type:Number,json:{write:!0}})],gc.prototype,"seed",void 0),_([Bt({dotDensity:"dot-density"})],gc.prototype,"type",void 0),gc=YW=_([Z("esri.renderers.DotDensityRenderer")],gc);const lCt=gc;var ZW;let fA=ZW=class extends Ne{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new ZW({color:this.color,ratio:this.ratio})}};_([T({type:mt,json:{type:[Wr],default:null,write:!0}})],fA.prototype,"color",void 0),_([T({type:Number,json:{write:!0}})],fA.prototype,"ratio",void 0),fA=ZW=_([Z("esri.renderers.support.HeatmapColorStop")],fA);const d6=fA;let Xx=class extends sn(Ne){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};_([T({type:String,json:{write:!0}})],Xx.prototype,"minLabel",void 0),_([T({type:String,json:{write:!0}})],Xx.prototype,"maxLabel",void 0),_([T({type:String,json:{write:!0}})],Xx.prototype,"title",void 0),Xx=_([Z("esri.renderers.support.HeatmapLegendOptions")],Xx);const tte=2.4;function cCt(t){return ed(t*tte)}function uCt(t){return Xo(t)/tte}function hCt(t,e,i,r){let{color:n,ratio:s}=e,{color:a,ratio:u}=i;u===s&&(u===1?s-=1e-6:u+=1e-6);const p=Je((r-s)/(u-s),0,1);DD(t,n.toArray(),a.toArray(),p)}function RGt(t){const i=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:u})=>u>=0&&u<=1).sort((u,p)=>u.ratio-p.ratio).map(({color:u,ratio:p})=>({color:u,ratio:Math.max(p,.001)})),t.length<1)return i;let r=t[0],n=t[0],s=1;const a=ji();for(let u=0;u<512;u++){const p=(u+.5)/512;for(;p>n.ratio&&s<t.length;)r=n,n=t[s++];hCt(a,r,n,p),i.set(a,4*u)}return i}function MGt(t,e,i,r){const{radius:n,fieldOffset:s,field:a}=e,u=Math.round(Xo(n)),p=new Float64Array(i*r);let y,b=Number.NEGATIVE_INFINITY;const S=pCt(a,s),C=new Set;for(const O of t){const P=O.getCursor();for(;P.next();){const $=P.getObjectId();if(C.has($))continue;C.add($);const N=P.readLegacyPointGeometry(),z=128;if(N.x<-z||N.x>=i+z||N.y<-z||N.y>r+z)continue;const U=+S(P),j=Math.max(0,Math.round(N.x)-u),G=Math.max(0,Math.round(N.y)-u),q=Math.min(r,Math.round(N.y)+u),W=Math.min(i,Math.round(N.x)+u);for(let K=G;K<q;K++)for(let se=j;se<W;se++){const ae=K*i+se,le=dCt(N.x-se,N.y-K,u);y=p[ae]+=le*U,y>b&&(b=y)}}}return{matrix:p.buffer,max:b}}function dCt(t,e,i){const r=Math.sqrt(t**2+e**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function PGt(t,e){return typeof t=="function"?t:t?typeof e=="string"?i=>-1*+i[t]:i=>+i[t]+e:()=>1}function pCt(t,e){return t!=null?typeof e=="string"?i=>-1*+i.readAttribute(t):i=>+i.readAttribute(t)+e:i=>1}var KW;const xMe="esri.renderers.HeatmapRenderer",fCt=Ee.getLogger(xMe);function tfe(t){if(t!=null){const{maxDensity:e,minDensity:i,radius:r}=t;if(e!=null||i!=null||r!=null){const{blurRadius:n,maxPixelIntensity:s,minPixelIntensity:a,...u}=t;return u}}return t}let Uo=KW=class extends Zg{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new d6({ratio:0,color:new mt("rgba(255, 140, 0, 0)")}),new d6({ratio:.75,color:new mt("rgba(255, 140, 0, 1)")}),new d6({ratio:.9,color:new mt("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return tfe(t)}get blurRadius(){return uCt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",cCt(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(tte**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||Ql(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,yw(()=>{fp(fCt,t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=tfe(t),super.read(t,e)}getSymbol(){return new Nv}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&Gu(t,e,i),r&&typeof r=="string"&&await tc(t,e,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new KW({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:Ce(this.colorStops),field:this.field,legendOptions:Ce(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};_([T({type:Kee,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Uo.prototype,"authoringInfo",void 0),_([T({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Uo.prototype,"blurRadius",null),_([T({type:[d6],json:{write:!0}})],Uo.prototype,"colorStops",void 0),_([T({type:String,json:{write:!0}})],Uo.prototype,"field",void 0),_([T({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:i==null})},origins:{"web-scene":{write:!1}}}})],Uo.prototype,"fieldOffset",void 0),_([T({type:Xx,json:{write:!0}})],Uo.prototype,"legendOptions",void 0),_([T({type:Number,json:{write:!0}})],Uo.prototype,"maxDensity",void 0),_([T({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Uo.prototype,"maxPixelIntensity",null),_([T({type:Number,json:{write:!0}})],Uo.prototype,"minDensity",void 0),_([T({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Uo.prototype,"minPixelIntensity",null),_([T({type:Number,cast:Br,json:{write:!0}})],Uo.prototype,"radius",void 0),_([T({type:Number,range:{min:0},json:{default:0,write:!0}})],Uo.prototype,"referenceScale",void 0),_([Bt({heatmap:"heatmap"})],Uo.prototype,"type",void 0),_([T({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Uo.prototype,"valueExpression",void 0),_([T({type:String})],Uo.prototype,"valueExpressionTitle",void 0),_([T({readOnly:!0})],Uo.prototype,"_pixelIntensityToDensity",null),Uo=KW=_([Z(xMe)],Uo);const TMe=Uo;let Kb=class extends sn(Ne){constructor(){super(...arguments),this.color=new mt([0,0,0,0]),this.label=null,this.threshold=0}};_([T({type:mt,json:{write:!0}})],Kb.prototype,"color",void 0),_([T({type:String,json:{write:!0}})],Kb.prototype,"label",void 0),_([T({type:Number,range:{min:0,max:1},json:{write:!0}})],Kb.prototype,"threshold",void 0),Kb=_([Z("esri.renderers.support.OthersCategory")],Kb);let p6=class extends sn(Ne){constructor(){super(...arguments),this.title=null}};_([T({type:String,json:{write:!0}})],p6.prototype,"title",void 0),p6=_([Z("esri.renderers.support.PieChartLegendOptions")],p6);let gu=class extends $E(sn(Zg)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new mt([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new Kb,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){return new Nv({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(gw)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,i)=>e+i.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,i)=>e+JSON.stringify(i),"")}async collectRequiredFields(e,i){await this.collectVVRequiredFields(e,i);for(const r of this.attributes)r.valueExpression&&await tc(e,i,r.valueExpression),r.field&&e.add(r.field)}};_([T({type:[wMe],json:{write:!0}})],gu.prototype,"attributes",void 0),_([T({type:Sw,json:{default:null,write:!0}})],gu.prototype,"backgroundFillSymbol",void 0),_([T({type:mt,json:{write:!0}})],gu.prototype,"defaultColor",void 0),_([T({type:String,json:{write:!0}})],gu.prototype,"defaultLabel",void 0),_([T({type:Number,range:{min:0,max:1},json:{write:!0}})],gu.prototype,"holePercentage",void 0),_([T({type:Kb,json:{write:!0}})],gu.prototype,"othersCategory",void 0),_([T({type:p6,json:{write:!0}})],gu.prototype,"legendOptions",void 0),_([T({type:dd,json:{default:null,write:!0}})],gu.prototype,"outline",void 0),_([T({type:Number,cast:Br,json:{write:!0}})],gu.prototype,"size",void 0),_([Bt({pieChart:"pie-chart"})],gu.prototype,"type",void 0),gu=_([Z("esri.renderers.PieChartRenderer")],gu);const mCt=gu;var QW;let Cb=QW=class extends $E(Zg){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new QW({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:Ce(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};_([T({type:String,json:{write:!0}})],Cb.prototype,"description",void 0),_([T({type:String,json:{write:!0}})],Cb.prototype,"label",void 0),_([T(Qee)],Cb.prototype,"symbol",void 0),_([Bt({simple:"simple"})],Cb.prototype,"type",void 0),Cb=QW=_([Z("esri.renderers.SimpleRenderer")],Cb);const VN=Cb,gCt=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function eX(t){return t instanceof Ke}function ife(t){return t instanceof Dt?Object.keys(t.items):eX(t)?Ql(t).keys():t?Object.keys(t):[]}function J9(t,e){return t instanceof Dt?t.items[e]:t[e]}function yCt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function S4(t){return t?t.declaredClass:null}function SMe(t,e){const i=t.diff;if(i&&typeof i=="function")return i(t,e);const r=ife(t),n=ife(e);if(r.length===0&&n.length===0)return;if(!r.length||!n.length||yCt(t,e))return{type:"complete",oldValue:t,newValue:e};const s=n.filter(S=>!r.includes(S)),a=r.filter(S=>!n.includes(S)),u=r.filter(S=>n.includes(S)&&J9(t,S)!==J9(e,S)).concat(s,a).sort(),p=S4(t);if(p&&gCt.has(p)&&u.length)return{type:"complete",oldValue:t,newValue:e};let y;const b=eX(t)&&eX(e);for(const S of u){const C=J9(t,S),O=J9(e,S);let P;if((b||typeof C!="function"&&typeof O!="function")&&C!==O&&(C!=null||O!=null)){if(i&&i[S]&&typeof i[S]=="function")P=i[S]?.(C,O);else if(C instanceof Date&&O instanceof Date){if(C.getTime()===O.getTime())continue;P={type:"complete",oldValue:C,newValue:O}}else P=typeof C=="object"&&typeof O=="object"&&S4(C)===S4(O)?SMe(C,O):{type:"complete",oldValue:C,newValue:O};P!=null&&(y!=null?y.diff[S]=P:y={type:"partial",diff:{[S]:P}})}}return y}function vCt(t,e){if(t==null)return!1;const i=e.split(".");let r=t;for(const n of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const s=r.diff[n];if(!s)return!1;r=s}}return!0}function DGt(t,e){for(const i of e)if(vCt(t,i))return!0;return!1}function _Ct(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&S4(t)!==S4(e)?{type:"complete",oldValue:t,newValue:e}:SMe(t,e)}function Y9(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const i of e.added)if(!Y9(i))return!1;for(const i of e.removed)if(!Y9(i))return!1;for(const i of e.changed)if(!Y9(i))return!1;return!0}case"partial":for(const e in t.diff)if(!Y9(t.diff[e]))return!1;return!0}}let Jx=class extends sn(Ne){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};_([T(a6)],Jx.prototype,"value",void 0),_([T(a6)],Jx.prototype,"value2",void 0),_([T(a6)],Jx.prototype,"value3",void 0),Jx=_([Z("esri.renderers.support.UniqueValue")],Jx);const tS=Jx;let uy=class extends sn(Ne){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const i=typeof(e=Array.isArray(e)?e:[e])[0];return i==="string"||i==="number"?e.map(r=>new tS({value:r})):i==="object"?e[0]instanceof tS?e:e.map(r=>new tS(r)):null}};_([T({type:String,json:{write:!0}})],uy.prototype,"description",void 0),_([T({type:String,json:{write:!0}})],uy.prototype,"label",void 0),_([T(BN)],uy.prototype,"symbol",void 0),_([T({type:[tS],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new tS({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const i=[];for(const r of t){const n=[r.value,r.value2,r.value3].filter(gw).map(s=>s.toString());i.push(n)}e.values=i}}}})],uy.prototype,"values",void 0),_([Fi("values")],uy.prototype,"castValues",null),uy=_([Z("esri.renderers.support.UniqueValueClass")],uy);const EMe=uy;let mA=class extends sn(Ne){constructor(e){super(e),this.heading=null,this.classes=null}};_([T({type:String,json:{write:!0}})],mA.prototype,"heading",void 0),_([T({type:[EMe],json:{write:!0}})],mA.prototype,"classes",void 0),mA=_([Z("esri.renderers.support.UniqueValueGroup")],mA);const tX=mA;var iX;let Ab=iX=class extends Ne{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new iX({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${t}`}};_([T({type:String,json:{write:!0}})],Ab.prototype,"description",void 0),_([T({type:String,json:{write:!0}})],Ab.prototype,"label",void 0),_([T(Qee)],Ab.prototype,"symbol",void 0),_([T(a6)],Ab.prototype,"value",void 0),Ab=iX=_([Z("esri.renderers.support.UniqueValueInfo")],Ab);const E4=Ab;var gA;const CMe="esri.renderers.UniqueValueRenderer",N1=Ee.getLogger(CMe),rfe="uvInfos-watcher",nfe="uvGroups-watcher",bCt=",",wCt=os(E4);function xCt(t){const{field1:e,field2:i,field3:r,fieldDelimiter:n,uniqueValueInfos:s,valueExpression:a}=t,u=!(!e||!i);return[{classes:(s??[]).map(p=>{const{symbol:y,label:b,value:S,description:C}=p,[O,P,$]=u?S?.toString()?.split(n||"")||[]:[S],N=[];return(e||a)&&N.push(O),i&&N.push(P),r&&N.push($),{symbol:y,label:b,values:[N],description:C}})}]}let ds=gA=class extends $E(Zg){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,i){if(!e&&!i)return;if(!e||!i)return{type:"complete",oldValue:e,newValue:i};let r=!1;const n={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let s=0;s<i.length;s++){const a=e.find(u=>u.value===i[s].value);a?_Ct(a,i[s])?(n.changed.push({type:"complete",oldValue:a,newValue:i[s]}),r=!0):n.unchanged.push({oldValue:a,newValue:i[s]}):(n.added.push(i[s]),r=!0)}for(let s=0;s<e.length;s++)i.find(a=>a.value===e[s].value)||(n.removed.push(e[s]),r=!0);return r?n:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:UO(t)}writeField(t,e,i,r){typeof t=="string"?e[i]=t:r?.messages?r.messages.push(new de("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):N1.error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,i){return i.portal||Zs.getDefault()}readStyleOrigin(t,e,i){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const r=hv(e.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(t,e,i,r){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=H2(t.styleUrl,r))}set uniqueValueGroups(t){this.styleOrigin?N1.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?N1.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){if(this.styleOrigin)return void N1.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof t=="object"?wCt(t):new E4({value:t,symbol:T_e(e)}),this.uniqueValueInfos?.push(i),this._valueInfoMap[i.value]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void N1.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e)for(let i=0;i<e.length;i++){const r=e[i];if(String(r.value)===String(t)){delete this._valueInfoMap[t],e.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let i=e;return this.valueExpression&&e?.arcade==null&&(i={...i,arcade:await fv()}),this._getUniqueValueInfo(t,i)}getSymbol(t,e){return this.valueExpression&&e?.arcade==null?void N1.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used"):this._getUniqueValueInfo(t,e)?.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&i?.arcade==null){const n=await fv(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),i={...i,arcade:n}}return this._getUniqueValueInfo(t,i)?.symbol||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=this.uniqueValueInfos?.reduce((r,n)=>r+n.getMeshHash(),"");return`${t}.${e}.${i}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new gA({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:Ce(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:Ce(this.visualVariables),legendOptions:Ce(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:Ce(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=Ce(this.uniqueValueInfos),i=Ce(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(Ce(this.styleOrigin))),Object.freeze(e),Object.freeze(i)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",i),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),tc(t,e,this.valueExpression)];Gu(t,e,this.field),Gu(t,e,this.field2),Gu(t,e,this.field3),await Promise.all(i)}populateFromStyle(){return ZQ(this.styleOrigin,{portal:this.portal}).then(t=>{const e=[];return this._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(i=>{const r=new Ew({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==t.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const n=new E4({value:i.name,symbol:r});e.push(n),this._valueInfoMap[i.name]=n}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",bCt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(rfe);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const i of t)e.push(Fe(()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description}),(r,n)=>{r!==n&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,rfe)}}_watchUniqueValueGroups(){this.removeHandles(nfe);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const i of t){e.push(Fe(()=>({classes:i.classes}),(r,n)=>{r!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const r of i.classes??[])e.push(Fe(()=>({symbol:r.symbol,values:r.values,label:r.label,description:r.description}),(n,s)=>{n!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,nfe)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:i,field3:r,fieldDelimiter:n,uniqueValueGroups:s,valueExpression:a}=this;if(!e&&!a)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const u=!(!e||!i);for(const p of s)for(const y of p.classes??[]){const{symbol:b,label:S,values:C,description:O}=y;for(const P of C??[]){const{value:$,value2:N,value3:z}=P,U=[$];i&&U.push(N),r&&U.push(z);const j=u?U.join(n||""):U[0];t.push(new E4({symbol:b,label:S,value:j,description:O}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:i,valueExpression:r,fieldDelimiter:n,uniqueValueInfos:s}=this;if(!e&&!r||!s.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const a=!(!e||!i),u=s.map(y=>{const{symbol:b,label:S,value:C,description:O}=y,[P,$,N]=a?C?.toString()?.split(n||"")||[]:[C];return new EMe({symbol:b,label:S,description:O,values:[new tS({value:P,value2:$,value3:N})]})}),p=[new tX({classes:u})];t&&Object.freeze(p),this._set("uniqueValueGroups",p),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:n,arcade:s,timeZone:a}=e??{};let u=this._cache.compiledFunc;const p=s.arcadeUtils;if(!u){const b=p.createSyntaxTree(this.valueExpression);u=p.createFunction(b),this._cache.compiledFunc=u}const y=p.executeFunction(u,p.createExecContext(t,p.getViewInfo({viewingMode:i,scale:r,spatialReference:n}),a));return this._valueInfoMap[y+""]}_getUnqiueValueInfoForFields(t){const e=this.field,i=t.attributes;let r;if(typeof e!="function"&&this.field2){const n=this.field2,s=this.field3,a=[];e&&a.push(i[e]),n&&a.push(i[n]),s&&a.push(i[s]),r=a.join(this.fieldDelimiter||"")}else typeof e=="function"?r=e(t):e&&(r=i[e]);return this._valueInfoMap[r+""]}static fromPortalStyle(t,e){const i=new gA(e?.properties);i._set("styleOrigin",Object.freeze({styleName:t})),i._set("portal",e?.portal||Zs.getDefault());const r=i.populateFromStyle();return r.catch(n=>{N1.error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",n)}),r}static fromStyleUrl(t,e){const i=new gA(e?.properties);i._set("styleOrigin",Object.freeze({styleUrl:t}));const r=i.populateFromStyle();return r.catch(n=>{N1.error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",n)}),r}};_([T({readOnly:!0})],ds.prototype,"_cache",null),_([Bt({uniqueValue:"unique-value"})],ds.prototype,"type",void 0),_([T(mMe)],ds.prototype,"backgroundFillSymbol",void 0),_([T({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],ds.prototype,"field",null),_([Fi("field")],ds.prototype,"castField",null),_([ot("field")],ds.prototype,"writeField",null),_([T({type:String,value:null,json:{write:!0}})],ds.prototype,"field2",null),_([T({type:String,value:null,json:{write:!0}})],ds.prototype,"field3",null),_([T({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],ds.prototype,"orderByClassesEnabled",void 0),_([T({type:String,value:null,json:{write:!0}})],ds.prototype,"valueExpression",null),_([T({type:String,json:{write:!0}})],ds.prototype,"valueExpressionTitle",void 0),_([T({type:eS,json:{write:!0}})],ds.prototype,"legendOptions",void 0),_([T({type:String,json:{write:!0}})],ds.prototype,"defaultLabel",void 0),_([T(cJ({...BN},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],ds.prototype,"defaultSymbol",null),_([T({type:String,value:null,json:{write:!0}})],ds.prototype,"fieldDelimiter",null),_([T({type:Zs,readOnly:!0})],ds.prototype,"portal",void 0),_([rt("portal",["styleName"])],ds.prototype,"readPortal",null),_([T({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],ds.prototype,"styleOrigin",void 0),_([rt("styleOrigin",["styleName","styleUrl"])],ds.prototype,"readStyleOrigin",null),_([ot("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],ds.prototype,"writeStyleOrigin",null),_([T({type:[tX],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,i)=>(e.uniqueValueGroups||xCt(e)).map(r=>tX.fromJSON(r,i))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],ds.prototype,"uniqueValueGroups",null),_([T({type:[E4],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],ds.prototype,"uniqueValueInfos",null),ds=gA=_([Z(CMe)],ds);const ite=ds,BR={key:"type",base:Zg,typeMap:{heatmap:TMe,simple:VN,"unique-value":ite,"class-breaks":yMe,"dot-density":lCt,dictionary:oCt,"pie-chart":mCt},errorContext:"renderer"},AMe={key:"type",base:Zg,typeMap:{simple:VN,"unique-value":ite,"class-breaks":yMe,heatmap:TMe},errorContext:"renderer",validate:TCt};function TCt(t){switch(t.type){case"simple":return SCt(t);case"unique-value":return ECt(t);case"class-breaks":return CCt(t);case"heatmap":return t}}function SCt(t){if(t.symbol)return t;Ee.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function ECt(t){const e=t.uniqueValueInfos,i=e?.filter(({symbol:r,label:n},s)=>(r||Ee.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${s}] ${n}) without a symbol from web scene.`),!!r));return i?.length!==e?.length&&(t.uniqueValueInfos=i),t}function CCt(t){const e=t.classBreakInfos,i=e?.filter(({symbol:r,label:n},s)=>(r||Ee.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${s}] ${n}) without a symbol from web scene.`),!!r));return i?.length!==e?.length&&(t.classBreakInfos=i),t}function zGt(t,e){return iE(t,null,e)}const ACt=aE({types:BR});function iE(t,e,i){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(i?.messages&&i.messages.push(new T0("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:i})),null):ACt(t,e,i):null}var rX;let Ob=rX=class extends Ne{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new rX({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};_([T({type:String,json:{write:!0}})],Ob.prototype,"expression",void 0),_([T({type:String,json:{write:!0}})],Ob.prototype,"name",void 0),_([T({type:["boolean","date","number","string"],json:{write:!0}})],Ob.prototype,"returnType",void 0),_([T({type:String,json:{write:!0}})],Ob.prototype,"title",void 0),Ob=rX=_([Z("esri.form.ExpressionInfo")],Ob);const OCt=Ob;let Rb=class extends Ne{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};_([T({type:String,json:{write:!0}})],Rb.prototype,"description",void 0),_([T({type:String,json:{write:!0}})],Rb.prototype,"label",void 0),_([T()],Rb.prototype,"type",void 0),_([T({type:String,json:{write:!0}})],Rb.prototype,"visibilityExpression",void 0),Rb=_([Z("esri.form.elements.Element")],Rb);const rE=Rb;var nX;let f6=nX=class extends Ne{constructor(t){super(t),this.type=null}clone(){return new nX({type:this.type})}};_([T({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],f6.prototype,"type",void 0),f6=nX=_([Z("esri.form.elements.inputs.AttachmentInput")],f6);const RCt=f6;var sX;let Mb=sX=class extends rE{constructor(t){super(t),this.attachmentKeyword=null,this.editableExpression=null,this.input=null,this.type="attachment"}clone(){return new sX({attachmentKeyword:this.attachmentKeyword,description:this.description,editableExpression:this.editableExpression,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};_([T({type:String,json:{write:!0}})],Mb.prototype,"attachmentKeyword",void 0),_([T({type:String,json:{write:!0}})],Mb.prototype,"editableExpression",void 0),_([T({type:RCt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Mb.prototype,"input",void 0),_([T({type:["attachment"],json:{read:!1,write:!0}})],Mb.prototype,"type",void 0),Mb=sX=_([Z("esri.form.elements.AttachmentElement")],Mb);const sfe=Mb;let m6=class extends Ne{constructor(e){super(e),this.type=null}};_([T()],m6.prototype,"type",void 0),m6=_([Z("esri.form.elements.inputs.Input")],m6);const Kg=m6;let yA=class extends Kg{constructor(e){super(e),this.maxLength=null,this.minLength=0}};_([T({type:Number,json:{write:!0}})],yA.prototype,"maxLength",void 0),_([T({type:Number,json:{write:!0}})],yA.prototype,"minLength",void 0),yA=_([Z("esri.form.elements.inputs.TextInput")],yA);const rte=yA;var oX;let g6=oX=class extends rte{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new oX({maxLength:this.maxLength,minLength:this.minLength})}};_([T({type:["barcode-scanner"],json:{read:!1,write:!0}})],g6.prototype,"type",void 0),g6=oX=_([Z("esri.form.elements.inputs.BarcodeScannerInput")],g6);const MCt=g6;var aX;let Yx=aX=class extends Kg{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new aX({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};_([T({type:String,json:{write:!0}})],Yx.prototype,"noValueOptionLabel",void 0),_([T({type:Boolean,json:{write:!0}})],Yx.prototype,"showNoValueOption",void 0),_([T({type:["combo-box"],json:{read:!1,write:!0}})],Yx.prototype,"type",void 0),Yx=aX=_([Z("esri.form.elements.inputs.ComboBoxInput")],Yx);const PCt=Yx;var lX;function ofe(t){return t??null}function afe(t){return t??null}let Hf=lX=class extends Kg{constructor(t){super(t),this.max=null,this.min=null,this.type="date-picker"}readMax(t,e){return ofe(e.max)}writeMax(t,e){e.max=afe(t)}readMin(t,e){return ofe(e.min)}writeMin(t,e){e.min=afe(t)}clone(){return new lX({max:this.max,min:this.min})}};_([T({type:String,json:{type:String,write:!0}})],Hf.prototype,"max",void 0),_([rt("max")],Hf.prototype,"readMax",null),_([ot("max")],Hf.prototype,"writeMax",null),_([T({type:String,json:{type:String,write:!0}})],Hf.prototype,"min",void 0),_([rt("min")],Hf.prototype,"readMin",null),_([ot("min")],Hf.prototype,"writeMin",null),_([T({type:["date-picker"],json:{read:!1,write:!0}})],Hf.prototype,"type",void 0),Hf=lX=_([Z("esri.form.elements.inputs.DatePickerInput")],Hf);const ICt=Hf;var cX;function WU(t){return t??null}function XU(t){return t??null}let yc=cX=class extends Kg{constructor(t){super(t),this.includeTimeOffset=!0,this.max=null,this.min=null,this.timeResolution="minutes",this.type="datetimeoffset-picker"}readMax(t,e){return WU(e.max)}writeMax(t,e){e.max=XU(t)}readMin(t,e){return WU(e.min)}writeMin(t,e){e.min=XU(t)}readTimeResolution(t,e){return WU(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=XU(t)}clone(){return new cX({includeTimeOffset:this.includeTimeOffset,max:this.max,min:this.min,timeResolution:this.timeResolution})}};_([T({type:Boolean,json:{write:!0}})],yc.prototype,"includeTimeOffset",void 0),_([T({type:String,json:{type:String,write:!0}})],yc.prototype,"max",void 0),_([rt("max")],yc.prototype,"readMax",null),_([ot("max")],yc.prototype,"writeMax",null),_([T({type:String,json:{type:String,write:!0}})],yc.prototype,"min",void 0),_([rt("min")],yc.prototype,"readMin",null),_([ot("min")],yc.prototype,"writeMin",null),_([T({type:String,json:{type:String,write:!0}})],yc.prototype,"timeResolution",void 0),_([rt("timeResolution")],yc.prototype,"readTimeResolution",null),_([ot("timeResolution")],yc.prototype,"writeTimeResolution",null),_([T({type:["datetimeoffset-picker"],json:{read:!1,write:!0}})],yc.prototype,"type",void 0),yc=cX=_([Z("esri.form.elements.inputs.DateTimeOffsetPickerInput")],yc);const $Ct=yc;var uX;function lfe(t){return t!=null?new Date(t):null}function cfe(t){return t?t.getTime():null}let Zd=uX=class extends Kg{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return lfe(e.max)}writeMax(t,e){e.max=cfe(t)}readMin(t,e){return lfe(e.min)}writeMin(t,e){e.min=cfe(t)}clone(){return new uX({includeTime:this.includeTime,max:this.max,min:this.min})}};_([T({type:Boolean,json:{write:!0}})],Zd.prototype,"includeTime",void 0),_([T({type:Date,json:{type:Number,write:!0}})],Zd.prototype,"max",void 0),_([rt("max")],Zd.prototype,"readMax",null),_([ot("max")],Zd.prototype,"writeMax",null),_([T({type:Date,json:{type:Number,write:!0}})],Zd.prototype,"min",void 0),_([rt("min")],Zd.prototype,"readMin",null),_([ot("min")],Zd.prototype,"writeMin",null),_([T({type:["datetime-picker"],json:{read:!1,write:!0}})],Zd.prototype,"type",void 0),Zd=uX=_([Z("esri.form.elements.inputs.DateTimePickerInput")],Zd);const LCt=Zd;var hX;let Zx=hX=class extends Kg{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new hX({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};_([T({type:String,json:{write:!0}})],Zx.prototype,"noValueOptionLabel",void 0),_([T({type:Boolean,json:{write:!0}})],Zx.prototype,"showNoValueOption",void 0),_([T({type:["radio-buttons"],json:{read:!1,write:!0}})],Zx.prototype,"type",void 0),Zx=hX=_([Z("esri.form.elements.inputs.RadioButtonsInput")],Zx);const DCt=Zx;var dX;let Kx=dX=class extends Kg{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new dX({offValue:this.offValue,onValue:this.onValue})}};_([T({type:[String,Number],json:{write:!0}})],Kx.prototype,"offValue",void 0),_([T({type:[String,Number],json:{write:!0}})],Kx.prototype,"onValue",void 0),_([T({type:["switch"],json:{read:!1,write:!0}})],Kx.prototype,"type",void 0),Kx=dX=_([Z("esri.form.elements.inputs.SwitchInput")],Kx);const NCt=Kx;var pX;let y6=pX=class extends rte{constructor(t){super(t),this.type="text-area"}clone(){return new pX({maxLength:this.maxLength,minLength:this.minLength})}};_([T({type:["text-area"],json:{read:!1,write:!0}})],y6.prototype,"type",void 0),y6=pX=_([Z("esri.form.elements.inputs.TextAreaInput")],y6);const FCt=y6;var fX;let v6=fX=class extends rte{constructor(t){super(t),this.type="text-box"}clone(){return new fX({maxLength:this.maxLength,minLength:this.minLength})}};_([T({type:["text-box"],json:{read:!1,write:!0}})],v6.prototype,"type",void 0),v6=fX=_([Z("esri.form.elements.inputs.TextBoxInput")],v6);const kCt=v6;var mX;function JU(t){return t??null}function YU(t){return t??null}let yu=mX=class extends Kg{constructor(t){super(t),this.max=null,this.min=null,this.timeResolution="minutes",this.type="time-picker"}readMax(t,e){return JU(e.max)}writeMax(t,e){e.max=YU(t)}readMin(t,e){return JU(e.min)}writeMin(t,e){e.min=YU(t)}readTimeResolution(t,e){return JU(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=YU(t)}clone(){return new mX({max:this.max,min:this.min,timeResolution:this.timeResolution})}};_([T({type:String,json:{type:String,write:!0}})],yu.prototype,"max",void 0),_([rt("max")],yu.prototype,"readMax",null),_([ot("max")],yu.prototype,"writeMax",null),_([T({type:String,json:{type:String,write:!0}})],yu.prototype,"min",void 0),_([rt("min")],yu.prototype,"readMin",null),_([ot("min")],yu.prototype,"writeMin",null),_([T({type:String,json:{type:String,write:!0}})],yu.prototype,"timeResolution",void 0),_([rt("timeResolution")],yu.prototype,"readTimeResolution",null),_([ot("timeResolution")],yu.prototype,"writeTimeResolution",null),_([T({type:["time-picker"],json:{read:!1,write:!0}})],yu.prototype,"type",void 0),yu=mX=_([Z("esri.form.elements.inputs.TimePickerInput")],yu);const zCt=yu,UCt={base:Kg,key:"type",typeMap:{"barcode-scanner":MCt,"combo-box":PCt,"date-picker":ICt,"datetime-picker":LCt,"datetimeoffset-picker":$Ct,"radio-buttons":DCt,switch:NCt,"text-area":FCt,"text-box":kCt,"time-picker":zCt}};var gX;const OMe="esri.form.elements.FieldElement",ufe=Ee.getLogger(OMe);let Th=gX=class extends rE{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return fp(ufe,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._get("editable")??!0}set editable(t){fp(ufe,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._set("editable",t)}clone(){return new gX({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};_([T({types:fEe,json:{read:{reader:dN},write:!0}})],Th.prototype,"domain",void 0),_([T({type:Boolean,json:{write:!0}})],Th.prototype,"editable",null),_([T({type:String,json:{write:!0}})],Th.prototype,"editableExpression",void 0),_([T({type:String,json:{write:!0}})],Th.prototype,"fieldName",void 0),_([T({type:String,json:{write:!0}})],Th.prototype,"hint",void 0),_([T({types:UCt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Th.prototype,"input",void 0),_([T({type:String,json:{write:!0}})],Th.prototype,"requiredExpression",void 0),_([T({type:String,json:{read:!1,write:!0}})],Th.prototype,"type",void 0),_([T({type:String,json:{write:!0}})],Th.prototype,"valueExpression",void 0),Th=gX=_([Z(OMe)],Th);const hfe=Th;var yX;let Dm=yX=class extends rE{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new yX({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:Ce(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};_([T({type:Number,json:{write:!0}})],Dm.prototype,"displayCount",void 0),_([T({type:["list"],json:{write:!0}})],Dm.prototype,"displayType",void 0),_([T({type:String,json:{write:!0}})],Dm.prototype,"editableExpression",void 0),_([T({type:[qY],json:{write:!0}})],Dm.prototype,"orderByFields",void 0),_([T({type:Number,json:{write:!0}})],Dm.prototype,"relationshipId",void 0),_([T({type:["relationship"],json:{read:!1,write:!0}})],Dm.prototype,"type",void 0),Dm=yX=_([Z("esri.form.elements.RelationshipElement")],Dm);const dfe=Dm;function RMe(t){return{typesWithGroup:{base:rE,key:"type",typeMap:{attachment:sfe,field:hfe,group:t,relationship:dfe}},typesWithoutGroup:{base:rE,key:"type",typeMap:{attachment:sfe,field:hfe,relationship:dfe}}}}function MMe(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(n=>r[n.type]).map(n=>r[n.type].fromJSON(n))}function PMe(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(n=>r[n.type]).map(n=>n.toJSON())}function IMe(t,e,i=!0){return t?t.map(r=>Pp(i?e.typesWithGroup:e.typesWithoutGroup,r)):null}var vX;let Jf=vX=class extends rE{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return IMe(t,ZU,!1)}readElements(t,e){return MMe(e.formElements,ZU,!1)}writeElements(t,e){e.formElements=PMe(t,ZU,!1)}clone(){return new vX({description:this.description,elements:Ce(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};_([T({json:{write:!0}})],Jf.prototype,"elements",void 0),_([Fi("elements")],Jf.prototype,"castElements",null),_([rt("elements",["formElements"])],Jf.prototype,"readElements",null),_([ot("elements")],Jf.prototype,"writeElements",null),_([T({type:["collapsed","expanded"],json:{write:!0}})],Jf.prototype,"initialState",void 0),_([T({type:String,json:{read:!1,write:!0}})],Jf.prototype,"type",void 0),Jf=vX=_([Z("esri.form.elements.GroupElement")],Jf);const ZU=RMe(Jf),jCt=Jf;var _X;const KU=RMe(jCt);let Kd=_X=class extends Ne{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return IMe(t,KU)}readElements(t,e){return MMe(e.formElements,KU)}writeElements(t,e){e.formElements=PMe(t,KU)}clone(){return new _X({description:this.description,expressionInfos:Ce(this.expressionInfos),elements:Ce(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};_([T({type:String,json:{write:!0}})],Kd.prototype,"description",void 0),_([T({json:{write:!0}})],Kd.prototype,"elements",void 0),_([Fi("elements")],Kd.prototype,"castElements",null),_([rt("elements",["formElements"])],Kd.prototype,"readElements",null),_([ot("elements")],Kd.prototype,"writeElements",null),_([T({type:[OCt],json:{write:!0}})],Kd.prototype,"expressionInfos",void 0),_([T({type:Boolean,json:{default:!1,write:!0}})],Kd.prototype,"preserveFieldValuesWhenHidden",void 0),_([T({type:String,json:{write:!0}})],Kd.prototype,"title",void 0),Kd=_X=_([Z("esri.form.FormTemplate")],Kd);const BCt=Kd;function pfe(t,e,i){if(t.hasM==null||t.hasZ)for(const r of e)for(const n of r)n.length>2&&(n[2]*=i)}function VCt(t,e,i){if(!t&&!e||!i)return;const r=aS(i);ffe(t,i,r),ffe(e,i,r)}function ffe(t,e,i){if(t)for(const r of t)GCt(r.geometry,e,i)}function GCt(t,e,i){if(!t?.spatialReference||Wn(t.spatialReference,e))return;const r=aS(t.spatialReference)/i;if(r!==1){if("x"in t)t.z!=null&&(t.z*=r);else if("rings"in t)pfe(t,t.rings,r);else if("paths"in t)pfe(t,t.paths,r);else if("points"in t&&(t.hasM==null||t.hasZ))for(const n of t.points)n.length>2&&(n[2]*=r)}}function mfe(t,e,i){if(!i?.features||!i.hasZ)return;const r=L1e(i.geometryType,e,t.outSpatialReference);if(r!=null)for(const n of i.features)r(n.geometry)}var bX;const wX=new br({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let sa=bX=class extends Ne{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){const i=dt.fromJSON(e.spatialReference),r=[];for(let n=0;n<t.length;n++){const s=t[n],a=Fp.fromJSON(s),u=s.geometry?.spatialReference;a.geometry==null||u||(a.geometry.spatialReference=i);const p=s.aggregateGeometries,y=a.aggregateGeometries;if(p&&y!=null)for(const b in y){const S=y[b],C=p[b],O=C?.spatialReference;S==null||O||(S.spatialReference=i)}r.push(a)}return r}writeGeometryType(t,e,i,r){if(t)return void wX.write(t,e,i,r);const{features:n}=this;if(n){for(const s of n)if(s?.geometry!=null)return void wX.write(s.geometry.type,e,i,r)}}readQueryGeometry(t,e){if(!t)return null;const i=!!t.spatialReference,r=E0(t);return r&&!i&&e.spatialReference&&(r.spatialReference=dt.fromJSON(e.spatialReference)),r}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&r.geometry!=null&&r.geometry.spatialReference)return void(e.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new bX(this.cloneProperties())}cloneProperties(){return Ce({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let i=0;i<e.features.length;i++){const r=e.features[i];if(r.geometry){const n=t?.[i];r.geometry=n?.toJSON()||r.geometry}}return e}quantize(t){const{scale:[e,i],translate:[r,n]}=t,s=y=>Math.round((y-r)/e),a=y=>Math.round((n-y)/i),u=this.features,p=this._getQuantizationFunction(this.geometryType,s,a);for(let y=0,b=u.length;y<b;y++)p?.(u[y].geometry)||(u.splice(y,1),y--,b--);return this.transform=t,this}unquantize(){const{geometryType:t,features:e,transform:i}=this;if(!i)return this;const{translate:[r,n],scale:[s,a]}=i,u=C=>C*s+r,p=C=>n-C*a;let y=null,b=null;if(this.hasZ&&i?.scale?.[2]!=null){const{translate:[,,C],scale:[,,O]}=i;y=P=>P*O+C}if(this.hasM&&i?.scale?.[3]!=null){const{translate:[,,,C],scale:[,,,O]}=i;b=P=>P==null?P:P*O+C}const S=this._getHydrationFunction(t,u,p,y,b);for(const{geometry:C}of e)C!=null&&S&&S(C);return this.transform=null,this}_quantizePoints(t,e,i){let r,n;const s=[];for(let a=0,u=t.length;a<u;a++){const p=t[a];if(a>0){const y=e(p[0]),b=i(p[1]);y===r&&b===n||(s.push([y-r,b-n]),r=y,n=b)}else r=e(p[0]),n=i(p[1]),s.push([r,n])}return s.length>0?s:null}_getQuantizationFunction(t,e,i){return t==="point"?r=>(r.x=e(r.x),r.y=i(r.y),r):t==="polyline"||t==="polygon"?r=>{const n=m2(r)?r.rings:r.paths,s=[];for(let a=0,u=n.length;a<u;a++){const p=n[a],y=this._quantizePoints(p,e,i);y&&s.push(y)}return s.length>0?(m2(r)?r.rings=s:r.paths=s,r):null}:t==="multipoint"?r=>{const n=this._quantizePoints(r.points,e,i);return n&&n.length>0?(r.points=n,r):null}:t==="extent"?r=>r:null}_getHydrationFunction(t,e,i,r,n){return t==="point"?s=>{s.x=e(s.x),s.y=i(s.y),r&&(s.z=r(s.z))}:t==="polyline"||t==="polygon"?s=>{const a=m2(s)?s.rings:s.paths;let u,p;for(let y=0,b=a.length;y<b;y++){const S=a[y];for(let C=0,O=S.length;C<O;C++){const P=S[C];C>0?(u+=P[0],p+=P[1]):(u=P[0],p=P[1]),P[0]=e(u),P[1]=i(p)}}if(r&&n)for(let y=0,b=a.length;y<b;y++){const S=a[y];for(let C=0,O=S.length;C<O;C++){const P=S[C];P[2]=r(P[2]),P[3]=n(P[3])}}else if(r)for(let y=0,b=a.length;y<b;y++){const S=a[y];for(let C=0,O=S.length;C<O;C++){const P=S[C];P[2]=r(P[2])}}else if(n)for(let y=0,b=a.length;y<b;y++){const S=a[y];for(let C=0,O=S.length;C<O;C++){const P=S[C];P[2]=n(P[2])}}}:t==="extent"?s=>{s.xmin=e(s.xmin),s.ymin=i(s.ymin),s.xmax=e(s.xmax),s.ymax=i(s.ymax),r&&s.zmax!=null&&s.zmin!=null&&(s.zmax=r(s.zmax),s.zmin=r(s.zmin)),n&&s.mmax!=null&&s.mmin!=null&&(s.mmax=n(s.mmax),s.mmin=n(s.mmin))}:t==="multipoint"?s=>{const a=s.points;let u,p;for(let y=0,b=a.length;y<b;y++){const S=a[y];y>0?(u+=S[0],p+=S[1]):(u=S[0],p=S[1]),S[0]=e(u),S[1]=i(p)}if(r&&n)for(let y=0,b=a.length;y<b;y++){const S=a[y];S[2]=r(S[2]),S[3]=n(S[3])}else if(r)for(let y=0,b=a.length;y<b;y++){const S=a[y];S[2]=r(S[2])}else if(n)for(let y=0,b=a.length;y<b;y++){const S=a[y];S[2]=n(S[2])}}:null}};_([T({type:String,json:{write:!0}})],sa.prototype,"displayFieldName",void 0),_([T({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],sa.prototype,"exceededTransferLimit",void 0),_([T({type:[Fp],json:{write:!0}})],sa.prototype,"features",void 0),_([rt("features")],sa.prototype,"readFeatures",null),_([T({type:[OR],json:{write:!0}})],sa.prototype,"fields",void 0),_([T({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:wX.read}}})],sa.prototype,"geometryType",void 0),_([ot("geometryType")],sa.prototype,"writeGeometryType",null),_([T({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],sa.prototype,"hasM",void 0),_([T({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],sa.prototype,"hasZ",void 0),_([T({types:_w,json:{write:!0}})],sa.prototype,"queryGeometry",void 0),_([rt("queryGeometry")],sa.prototype,"readQueryGeometry",null),_([T({type:dt,json:{write:!0}})],sa.prototype,"spatialReference",void 0),_([ot("spatialReference")],sa.prototype,"writeSpatialReference",null),_([T({json:{write:!0}})],sa.prototype,"transform",void 0),sa=bX=_([Z("esri.rest.support.FeatureSet")],sa),sa.prototype.toJSON.isDefaultToJSON=!0;const nte=sa;let HCt=0,Xm=class extends Ip.LoadableMixin(GO(Dt)){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const i=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(i)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}get _workerGeometryType(){const e=this.layer?.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,i={}){await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);mfe(e,this.layer.spatialReference,r);const n=nte.fromJSON(r);if(!this._requiresClientGraphicMapping())return n;const s=this.layer.objectIdField;for(const a of n.features){const u=a.attributes[s],p=this._idToClientGraphic.get(u);p&&(a.geometry=p.geometry)}return n.geometryType=this.layer.geometryType,n}async queryFeaturesJSON(e,i={}){if(this._requiresClientGraphicMapping())throw new de("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);return mfe(e,this.layer.spatialReference,r),r}queryFeatureCount(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,i))}queryObjectIds(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,i))}queryExtent(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,i)).then(r=>({count:r.count,extent:rr.fromJSON(r.extent)}))}querySnapping(e,i={}){return this.load(i).then(()=>this._connection.invoke("querySnapping",e,i))}async _applyEdits(e){if(!this._connection)throw new de("feature-layer-source:edit-failure","Memory source not loaded");const i=this.layer.objectIdField;let r=null;const n=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const a=b=>"objectId"in b&&b.objectId!=null?b.objectId:"attributes"in b&&b.attributes[i]!=null?b.attributes[i]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const b of e.deleteFeatures){const S=a(b);S!=null&&n.push(S)}const u=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const b of e.updateFeatures)if(s.push(this._serializeFeature(b)),u){const S=a(b);S!=null&&u.set(S,b)}}VCt(r?r.features:null,s,this.layer.spatialReference);const{fullExtent:p,featureEditResults:y}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:s,deletes:n});return this.fullExtent=p,r&&r.finish(y.uidToObjectId),this._updateClientGraphicIds(u,y),this._createEditsResult(y)}async _prepareClientMapping(e,i){if(this._layerOrSourceGeometryType!=="mesh"||e==null)return;const r=[];for(const{geometry:n}of e)n==null||n.type!=="mesh"||n.hasExtent||n.loaded||r.push(n.load({signal:i}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,i){if(this._idToClientGraphic){if(e)for(const r of i.updateResults){if(!r.success)continue;const n=e.get(r.objectId);n!=null&&this._addIdToClientGraphic(n)}for(const r of i.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const i=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:i?new de("feature-layer-source:edit-failure",i.description,{code:i.code}):null}}_prepareAddFeatures(e){const i=new Map,r=new Array(e.length);let n=null;for(let a=0;a<e.length;a++){const u=e[a],p=this._serializeFeature(u);n||u.geometry==null||(n=u.geometry.type),r[a]=p,i.set(`${p.uid}`,u)}const s=this;return{features:r,inferredGeometryType:n,finish(a){const u=s.sourceJSON.objectIdField;for(const p in a){const y=a[p],b=i.get(p);b&&(b.attributes||(b.attributes={}),y===-1?delete b.attributes[u]:b.attributes[u]=y,s._addIdToClientGraphic(b))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const i=this.sourceJSON.objectIdField,r=e.attributes?.[i];r!=null&&this._idToClientGraphic.set(r,e)}get _layerOrSourceGeometryType(){return this.layer?.geometryType??this.sourceJSON?.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:i}=e,r=this._geometryForSerialization(e),n=(HCt++).toString();return r?{uid:n,geometry:r.toJSON(),attributes:i}:{uid:n,attributes:i}}_geometryForSerialization(e){const{geometry:i}=e;return i==null?null:this._geometryRequiresClientGraphicMapping(i)?i.extent?nd.fromExtent(i.extent):null:i}async _startWorker(e){this._connection=await oZ("MemorySourceWorker",{strategy:Me("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{fields:i,spatialReference:r,objectIdField:n,hasM:s,hasZ:a,timeInfo:u,dateFieldsTimeZone:p}=this.layer,y=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const b=this._prepareAddFeatures(this.items);this.addHandles(this.on("before-changes",P=>{Ee.getLogger(this).error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),P.preventDefault()}));const S={features:b.features,fields:i?.map(P=>P.toJSON()),geometryType:Oie.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&s,hasZ:this._layerOrSourceGeometryType==="mesh"||a,objectIdField:n,spatialReference:y?null:r&&r.toJSON(),timeInfo:u?.toJSON()??null,dateFieldsTimeZone:p},C=await this._connection.invoke("load",S,{signal:e});for(const P of C.warnings)Ee.getLogger(this.layer).warn("#load()",`${P.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:P});C.featureErrors.length&&Ee.getLogger(this.layer).warn("#load()",`Encountered ${C.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:C.featureErrors});const O=C.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(b.inferredGeometryType)&&(O.geometryType=Oie.toJSON(b.inferredGeometryType)),this.sourceJSON=O,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),b.finish(C.assignedObjectIds)}};_([RJ({Type:Fp,ensureType:os(Fp)})],Xm.prototype,"itemType",void 0),_([T()],Xm.prototype,"type",void 0),_([T({constructOnly:!0})],Xm.prototype,"layer",void 0),_([T({readOnly:!0})],Xm.prototype,"_workerGeometryType",null),_([T()],Xm.prototype,"sourceJSON",void 0),Xm=_([Z("esri.layers.graphics.sources.MemorySource")],Xm);function qCt(t){return"portalItem"in t}const WCt=t=>{let e=class extends t{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):qCt(this)?this.portalItem?.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return _([T({type:String})],e.prototype,"apiKey",null),e=_([Z("esri.layers.mixins.APIKeyMixin")],e),e},$Me=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=uE(this.url);if(i!=null&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",k7e(i,Ee.getLogger(this)))}};return _([T()],e.prototype,"title",null),_([T({type:String})],e.prototype,"url",null),e=_([Z("esri.layers.mixins.ArcGISService")],e),e},gfe={read:{reader:VQ},write:{allowNull:!0,writer:GQ}},LMe=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return _([T({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),_([T({json:{read:!1,write:!1,origins:{"web-map":gfe,"portal-item":gfe}}})],e.prototype,"effect",void 0),e=_([Z("esri.layers.mixins.BlendLayer")],e),e},DMe=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return _([T({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],e.prototype,"customParameters",void 0),e=_([Z("esri.layers.mixins.CustomParametersMixin")],e),e},XCt=sNe(),JCt=new Map,NMe=new Map;async function GGt(t,e,i=!1){if(!t||!e)return!0;const r=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),n=NMe.get(r)?.entries();if(n){for(const[s,a]of n)if(a.name===e){const u=!a.stack?.hasForwardEdits();if(!u&&i){const[{deleteForwardEdits:p},{default:y}]=await Promise.all([ke(()=>import("./deleteForwardEdits-174f652e.js"),[],import.meta.url),ke(()=>import("./DeleteForwardEditsParameters-b883656b.js"),[],import.meta.url)]);return p(r,s,new y({sessionId:XCt,moment:a.moment}))}return u}}return!0}function YCt(t,e){if(!t)return!1;const i=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),r=NMe.get(i)?.entries();if(r){for(const[n,s]of r)if(s.name===e)return s.lockType==="edit"}return!1}const ste=new Xn.EventEmitter;function ZCt(t){return ste.on("apply-edits",new WeakRef(t))}function KCt(t){return ste.on("update-moment",new WeakRef(t))}function HGt(t,e,i=null,r=!1){const n=Ys();return r=e==null||r,ste.emit("apply-edits",{serviceUrl:t,layerId:e,gdbVersion:i,mayReceiveServiceEdits:r,result:n.promise}),n}const FMe="esri.layers.mixins.EditBusLayer",kMe=Symbol(FMe);function qGt(t){return t!=null&&typeof t=="object"&&kMe in t}function zC(t){return t!=null&&typeof t=="object"&&"gdbVersion"in t}function QU(t,e,i){const r=new URL(t).host,n=JCt.get(r),s=a=>!a||a===n;return s(e)&&s(i)||e===i}const QCt=t=>{var e;let i=class extends t{constructor(...r){super(...r),this[e]=!0,this._applyEditsHandler=n=>{const{serviceUrl:s,layerId:a,gdbVersion:u,mayReceiveServiceEdits:p,result:y}=n,b=s===this.url,S=a!=null&&this.layerId!=null&&a===this.layerId,C=zC(this),O=zC(this)&&QU(s,u,this.gdbVersion);if(!b||C&&!O||!S&&!p)return;const P=y.then($=>{if(S&&($.addedFeatures.length||$.updatedFeatures.length||$.deletedFeatures.length||$.addedAttachments.length||$.updatedAttachments.length||$.deletedAttachments.length))return this.emit("edits",Ce($)),$;const N=$.editedFeatures?.find(({layerId:z})=>z===this.layerId);if(N){const{adds:z,updates:U,deletes:j}=N.editedFeatures,G={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:z?z.map(({attributes:q})=>({objectId:this.objectIdField&&q[this.objectIdField],globalId:this.globalIdField&&q[this.globalIdField]})):[],deletedFeatures:j?j.map(({attributes:q})=>({objectId:this.objectIdField&&q[this.objectIdField],globalId:this.globalIdField&&q[this.globalIdField]})):[],updatedFeatures:U?U.map(({current:{attributes:q}})=>({objectId:this.objectIdField&&q[this.objectIdField],globalId:this.globalIdField&&q[this.globalIdField]})):[],editedFeatures:Ce($.editedFeatures),exceededTransferLimit:!1,historicMoment:Ce($.historicMoment)};return this.emit("edits",G),G}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:Ce($.editedFeatures),exceededTransferLimit:!1,historicMoment:Ce($.historicMoment)}}).then($=>("historicMoment"in this&&this.historicMoment!==$.historicMoment&&YCt(s,u)&&(this.historicMoment=$.historicMoment),$));this.emit("apply-edits",{result:P})},this._updateMomentHandler=n=>{const{serviceUrl:s,gdbVersion:a,moment:u}=n,p=s===this.url,y=zC(this),b=zC(this)&&QU(s,a,this.gdbVersion),S=zC(this)&&!QU(s,this.gdbVersion,null);p&&y&&b&&S&&"historicMoment"in this&&this.historicMoment!==u&&(this.historicMoment=u)},this.when().then(()=>{this.addHandles(ZCt(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(KCt(this._updateMomentHandler))},()=>{})}};return e=kMe,i=_([Z(FMe)],i),i};var xX;let Qx=xX=class extends Ne{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new xX({mapLayerId:t,gdbVersion:e})}};_([Bt({mapLayer:"map-layer"})],Qx.prototype,"type",void 0),_([T({type:Wr,json:{write:!0}})],Qx.prototype,"mapLayerId",void 0),_([T({type:String,json:{write:!0}})],Qx.prototype,"gdbVersion",void 0),Qx=xX=_([Z("esri.layers.support.source.MapLayerSource")],Qx);var TX;let Nm=TX=class extends Ne{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:i,spatialReference:r,geometryType:n}=this,s={workspaceId:t,query:e,oidFields:i,spatialReference:r?.clone()??void 0,geometryType:n};return new TX(s)}};_([Bt({queryTable:"query-table"})],Nm.prototype,"type",void 0),_([T({type:String,json:{write:!0}})],Nm.prototype,"workspaceId",void 0),_([T({type:String,json:{write:!0}})],Nm.prototype,"query",void 0),_([T({type:String,json:{write:!0}})],Nm.prototype,"oidFields",void 0),_([T({type:dt,json:{write:!0}})],Nm.prototype,"spatialReference",void 0),_([Bt(k4)],Nm.prototype,"geometryType",void 0),Nm=TX=_([Z("esri.layers.support.source.QueryTableDataSource")],Nm);var SX;let eT=SX=class extends Ne{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new SX({workspaceId:t,dataSourceName:e})}};_([Bt({raster:"raster"})],eT.prototype,"type",void 0),_([T({type:String,json:{write:!0}})],eT.prototype,"dataSourceName",void 0),_([T({type:String,json:{write:!0}})],eT.prototype,"workspaceId",void 0),eT=SX=_([Z("esri.layers.support.source.RasterDataSource")],eT);var EX;let Pb=EX=class extends Ne{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:i}=this;return new EX({workspaceId:t,gdbVersion:e,dataSourceName:i})}};_([Bt({table:"table"})],Pb.prototype,"type",void 0),_([T({type:String,json:{write:!0}})],Pb.prototype,"workspaceId",void 0),_([T({type:String,json:{write:!0}})],Pb.prototype,"gdbVersion",void 0),_([T({type:String,json:{write:!0}})],Pb.prototype,"dataSourceName",void 0),Pb=EX=_([Z("esri.layers.support.source.TableDataSource")],Pb);var CX,AX;const e5t=Tl()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let vu=CX=class extends Ne{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,i){return yfe()(t,e,i)}castLeftTableSource(t){return Pp(OX(),t)}readRightTableSource(t,e,i){return yfe()(t,e,i)}castRightTableSource(t){return Pp(OX(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:i,rightTableSource:r,joinType:n}=this,s={leftTableKey:t,rightTableKey:e,leftTableSource:i?.clone()??void 0,rightTableSource:r?.clone()??void 0,joinType:n};return new CX(s)}};_([Bt({joinTable:"join-table"})],vu.prototype,"type",void 0),_([T({type:String,json:{write:!0}})],vu.prototype,"leftTableKey",void 0),_([T({type:String,json:{write:!0}})],vu.prototype,"rightTableKey",void 0),_([T({json:{write:!0}})],vu.prototype,"leftTableSource",void 0),_([rt("leftTableSource")],vu.prototype,"readLeftTableSource",null),_([Fi("leftTableSource")],vu.prototype,"castLeftTableSource",null),_([T({json:{write:!0}})],vu.prototype,"rightTableSource",void 0),_([rt("rightTableSource")],vu.prototype,"readRightTableSource",null),_([Fi("rightTableSource")],vu.prototype,"castRightTableSource",null),_([Bt(e5t)],vu.prototype,"joinType",void 0),vu=CX=_([Z("esri.layers.support.source.JoinTableDataSource")],vu);let ej=null;function yfe(){return ej||(ej=aE({types:OX()})),ej}let tj=null;function OX(){return tj||(tj={key:"type",base:null,typeMap:{"data-layer":lp,"map-layer":Qx}}),tj}const t5t={key:"type",base:null,typeMap:{"join-table":vu,"query-table":Nm,raster:eT,table:Pb}};let lp=AX=class extends Ne{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new AX({fields:t,dataSource:e})}};_([Bt({dataLayer:"data-layer"})],lp.prototype,"type",void 0),_([T({type:[OR],json:{write:!0}})],lp.prototype,"fields",void 0),_([T({types:t5t,json:{write:!0}})],lp.prototype,"dataSource",void 0),lp=AX=_([Z("esri.layers.support.source.DataLayerSource")],lp),lp.from=os(lp);let Ib=class extends sn(Ne){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};_([T({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],Ib.prototype,"onFields",void 0),_([T({type:String,json:{write:!0}})],Ib.prototype,"operator",void 0),_([T({type:String,json:{write:!0}})],Ib.prototype,"searchTerm",void 0),_([T({type:String,json:{write:!0}})],Ib.prototype,"searchType",void 0),Ib=_([Z("esri.rest.support.FullTextSearch")],Ib);const i5t=Ib;var RX;const vfe=new br({upperLeft:"upper-left",lowerLeft:"lower-left"});let $b=RX=class extends Ne{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new RX(Ce({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};_([T({type:rr,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],$b.prototype,"extent",void 0),_([T({type:["view","edit"],json:{write:!0}})],$b.prototype,"mode",void 0),_([T({type:String,json:{read:vfe.read,write:vfe.write}})],$b.prototype,"originPosition",void 0),_([T({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],$b.prototype,"tolerance",void 0),$b=RX=_([Z("esri.rest.support.QuantizationParameters")],$b);const r5t=$b;var MX;const _fe=new br({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Qd=MX=class extends Ne{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=Ce(t))}clone(){return new MX({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:Ce(this.statisticParameters)})}};_([T({type:Number,json:{write:!0}})],Qd.prototype,"maxPointCount",void 0),_([T({type:Number,json:{write:!0}})],Qd.prototype,"maxRecordCount",void 0),_([T({type:Number,json:{write:!0}})],Qd.prototype,"maxVertexCount",void 0),_([T({type:String,json:{write:!0}})],Qd.prototype,"onStatisticField",void 0),_([T({type:String,json:{write:!0}})],Qd.prototype,"outStatisticFieldName",void 0),_([T({type:String,json:{read:{source:"statisticType",reader:_fe.read},write:{target:"statisticType",writer:_fe.write}}})],Qd.prototype,"statisticType",void 0),_([T({type:Object})],Qd.prototype,"statisticParameters",void 0),_([ot("statisticParameters")],Qd.prototype,"writeStatisticParameters",null),Qd=MX=_([Z("esri.rest.support.StatisticDefinition")],Qd);const n5t=Qd;var _6;const s5t=new br({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),o5t=new br({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let fi=_6=class extends Ne{static from(t){return L2(_6,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const i={};for(const r in t){const n=t[r];Array.isArray(n)?i[r]=n.map(s=>s instanceof Date?s.getTime():s):n instanceof Date?i[r]=n.getTime():i[r]=n}e.parameterValues=i}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new _6(Ce({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};fi.MAX_MAX_RECORD_COUNT_FACTOR=5,_([T({json:{write:!0}})],fi.prototype,"aggregateIds",void 0),_([T({type:Boolean,json:{write:!0}})],fi.prototype,"cacheHint",void 0),_([T({type:Boolean,json:{default:!1,write:!0}})],fi.prototype,"compactGeometryEnabled",void 0),_([T({json:{write:!0}})],fi.prototype,"datumTransformation",void 0),_([Fi("datumTransformation")],fi.prototype,"castDatumTransformation",null),_([T({type:Boolean,json:{default:!1,write:!0}})],fi.prototype,"defaultSpatialReferenceEnabled",void 0),_([T({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],fi.prototype,"distance",void 0),_([T({type:lp,json:{write:!0}})],fi.prototype,"dynamicDataSource",void 0),_([T({type:String,json:{write:!0}})],fi.prototype,"formatOf3DObjects",void 0),_([T({type:[i5t],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],fi.prototype,"fullText",void 0),_([T({type:String,json:{write:!0}})],fi.prototype,"gdbVersion",void 0),_([T({types:_w,json:{read:E0,write:!0}})],fi.prototype,"geometry",void 0),_([T({type:Number,json:{write:!0}})],fi.prototype,"geometryPrecision",void 0),_([T({type:[String],json:{write:!0}})],fi.prototype,"groupByFieldsForStatistics",void 0),_([T({type:String,json:{write:!0}})],fi.prototype,"having",void 0),_([T({type:Date})],fi.prototype,"historicMoment",void 0),_([ot("historicMoment")],fi.prototype,"writeHistoricMoment",null),_([T({type:Number,json:{write:!0}})],fi.prototype,"maxAllowableOffset",void 0),_([T({type:Number,cast:t=>t<1?1:t>fi.MAX_MAX_RECORD_COUNT_FACTOR?fi.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],fi.prototype,"maxRecordCountFactor",void 0),_([T({type:["xyFootprint"],json:{write:!0}})],fi.prototype,"multipatchOption",void 0),_([T({type:Number,json:{read:{source:"resultRecordCount"}}})],fi.prototype,"num",void 0),_([T({json:{write:!0}})],fi.prototype,"objectIds",void 0),_([T({type:[String],json:{write:!0}})],fi.prototype,"orderByFields",void 0),_([T({type:[String],json:{write:!0}})],fi.prototype,"outFields",void 0),_([T({type:dt,json:{name:"outSR",write:!0}})],fi.prototype,"outSpatialReference",void 0),_([T({type:[n5t],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],fi.prototype,"outStatistics",void 0),_([T({json:{write:!0}})],fi.prototype,"parameterValues",void 0),_([ot("parameterValues")],fi.prototype,"writeParameterValues",null),_([T({type:Wt,json:{write:!0}})],fi.prototype,"pixelSize",void 0),_([T({type:r5t,json:{write:!0}})],fi.prototype,"quantizationParameters",void 0),_([T({type:[Object],json:{write:!0}})],fi.prototype,"rangeValues",void 0),_([T({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],fi.prototype,"relationParameter",void 0),_([T({type:String,json:{write:!0}})],fi.prototype,"resultType",void 0),_([T({type:Boolean,json:{default:!1,write:!0}})],fi.prototype,"returnCentroid",void 0),_([T({type:Boolean,json:{default:!1,write:!0}})],fi.prototype,"returnDistinctValues",void 0),_([T({type:Boolean,json:{default:!0,write:!0}})],fi.prototype,"returnExceededLimitFeatures",void 0),_([T({type:Boolean,json:{write:!0}})],fi.prototype,"returnGeometry",void 0),_([T({type:Boolean,json:{default:!1,write:!0}})],fi.prototype,"returnQueryGeometry",void 0),_([T({type:Boolean,json:{default:!1,write:!0}})],fi.prototype,"returnM",void 0),_([T({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],fi.prototype,"returnZ",void 0),_([T({type:dt,json:{write:!0}})],fi.prototype,"sourceSpatialReference",void 0),_([Bt(s5t,{ignoreUnknown:!1,name:"spatialRel"})],fi.prototype,"spatialRelationship",void 0),_([T({type:Number,json:{read:{source:"resultOffset"}}})],fi.prototype,"start",void 0),_([ot("start"),ot("num")],fi.prototype,"writeStart",null),_([T({type:String,json:{write:!0}})],fi.prototype,"sqlFormat",void 0),_([T({type:String,json:{write:!0}})],fi.prototype,"text",void 0),_([T({type:z0,json:{write:!0}})],fi.prototype,"timeExtent",void 0),_([T({type:Boolean,json:{default:!1,write:!0}})],fi.prototype,"timeReferenceUnknownClient",void 0),_([Bt(o5t,{ignoreUnknown:!1}),T({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],fi.prototype,"units",void 0),_([T({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],fi.prototype,"where",void 0),_([ot("where")],fi.prototype,"writeWhere",null),fi=_6=_([Z("esri.rest.support.Query")],fi);const qh=fi;var PX;const ij=new br({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),rj=new br({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let qf=PX=class extends Ne{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:i,spatialRelationship:r,timeExtent:n,objectIds:s,units:a,distance:u}=this;return new qh({geometry:Ce(i),objectIds:Ce(s),spatialRelationship:r,timeExtent:Ce(n),where:e,units:a,distance:u,...t})}clone(){const{where:t,geometry:e,spatialRelationship:i,timeExtent:r,objectIds:n,units:s,distance:a}=this;return new PX({geometry:Ce(e),objectIds:Ce(n),spatialRelationship:i,timeExtent:Ce(r),where:t,units:s,distance:a})}};_([T({type:String,json:{write:!0}})],qf.prototype,"where",void 0),_([T({types:_w,json:{write:!0}})],qf.prototype,"geometry",void 0),_([T({type:ij.apiValues,json:{name:"spatialRel",read:{reader:ij.read},write:{allowNull:!1,writer:ij.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],qf.prototype,"spatialRelationship",void 0),_([T({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],qf.prototype,"distance",void 0),_([T({type:[Number],json:{write:!0}})],qf.prototype,"objectIds",void 0),_([T({type:rj.apiValues,json:{read:rj.read,write:{writer:rj.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],qf.prototype,"units",void 0),_([T({type:z0,json:{write:!0}})],qf.prototype,"timeExtent",void 0),qf=PX=_([Z("esri.layers.support.FeatureFilter")],qf);const a5t=qf;var IX;const bfe={read:{reader:VQ},write:{writer:GQ,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},wfe={read:{reader:VQ},write:{writer:GQ,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},xfe={name:"showExcludedLabels",default:!0};let Lb=IX=class extends Ne{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){const i=super.write(t,e);if(e?.origin){if(i.filter){const r=Object.keys(i.filter);if(r.length>1||r[0]!=="where")return e.messages?.push(new de("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in i)return e.messages?.push(new de("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return i}clone(){return new IX({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};_([T({type:a5t,json:{write:{allowNull:!0,writer(t,e,i,r){const n=t?.write({},r);n&&Object.keys(n).length!==0?bl(i,n,e):bl(i,null,e)}}}})],Lb.prototype,"filter",void 0),_([T({json:{write:!0,origins:{"web-map":bfe,"portal-item":bfe}}})],Lb.prototype,"includedEffect",void 0),_([T({json:{write:!0,origins:{"web-map":wfe,"portal-item":wfe}}})],Lb.prototype,"excludedEffect",void 0),_([T({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":xfe,"portal-item":xfe}}})],Lb.prototype,"excludedLabelsVisible",void 0),Lb=IX=_([Z("esri.layers.support.FeatureEffect")],Lb);const l5t=Lb,Tfe={write:{allowNull:!0}},zMe=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return _([T({type:l5t,json:{origins:{"web-map":Tfe,"portal-item":Tfe}}})],e.prototype,"featureEffect",void 0),e=_([Z("esri.layers.mixins.FeatureEffectLayer")],e),e};function c5t(t){if(!t)return t;const{start:e,end:i}=t;return new z0({start:e!=null?T2(e,-e.getTimezoneOffset(),"minutes"):e,end:i!=null?T2(i,-i.getTimezoneOffset(),"minutes"):i})}function u5t(t){if(!t)return t;const{start:e,end:i}=t;return new z0({start:e!=null?T2(e,e.getTimezoneOffset(),"minutes"):e,end:i!=null?T2(i,i.getTimezoneOffset(),"minutes"):i})}var $X;let vA=$X=class extends Ne{constructor(t){super(t)}async collectRequiredFields(t,e){return tc(t,e,this.expression)}clone(){return new $X({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};_([T({type:String,json:{write:!0}})],vA.prototype,"expression",void 0),_([T({type:String,json:{write:!0}})],vA.prototype,"title",void 0),vA=$X=_([Z("esri.layers.support.FeatureExpressionInfo")],vA);const Sfe=vA;var LX;const Z9=Tl()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Efe=new br({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let Fm=LX=class extends Ne{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,i,r){e[i]=t.write({},r),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new LX({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&c9e(this.featureExpressionInfo,t.featureExpressionInfo)}};_([T({type:Sfe,json:{write:!0}})],Fm.prototype,"featureExpressionInfo",void 0),_([rt("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],Fm.prototype,"readFeatureExpressionInfo",null),_([ot("featureExpressionInfo",{featureExpressionInfo:{type:Sfe},"featureExpression.value":{type:[0]}})],Fm.prototype,"writeFeatureExpressionInfo",null),_([T({type:Z9.apiValues,nonNullable:!0,json:{type:Z9.jsonValues,read:Z9.read,write:{writer:Z9.write,isRequired:!0}}})],Fm.prototype,"mode",null),_([T({type:Number,json:{write:!0}})],Fm.prototype,"offset",void 0),_([T({type:Srt,json:{type:String,read:Efe.read,write:Efe.write}})],Fm.prototype,"unit",null),Fm=LX=_([Z("esri.layers.support.ElevationInfo")],Fm);const UMe=Fm,jMe={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:xl}}},GN={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,i){e[i]=!t}}}},HN={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:xl}}},BMe={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Eg}}},VMe={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:xl}}},h5t={value:null,type:UMe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:xl}}};function XGt(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const GMe={write:{enabled:!0,layerContainerTypes:xl},read:!0},DX={type:Number,json:{origins:{"web-document":GMe,"portal-item":{write:!0}}}},d5t={...DX,json:{...DX.json,origins:{"web-document":{...GMe,write:{enabled:!0,layerContainerTypes:xl,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,i)=>i&&i.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition?.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?hS(e.layerDefinition.drawingInfo.transparency):void 0:hS(e.drawingInfo.transparency)}}},JGt={type:z0,readOnly:!0,get(){if(!this.layer?.timeInfo)return null;const{datesInUnknownTimezone:t,timeOffset:e,useViewTime:i}=this.layer,r=this.view?.timeExtent;let n=this.layer.timeExtent;t&&(n=u5t(n));let s=i?r&&n?r.intersection(n):r||n:n;if(!s||s.isEmpty||s.isAllTime)return s;e&&(s=s.offset(-e.value,e.unit)),t&&(s=c5t(s));const a=this._get("timeExtent");return s.equals(a)?a:s}},YGt={type:rr,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const i=rr.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(i.spatialReference=dt.fromJSON(e.spatialReference)),i}}}},read:!1}},p5t={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},HMe={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:xl}}},name:"layerDefinition.minScale",write:!0}},qMe={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:xl}}},name:"layerDefinition.maxScale",write:!0}},WMe={json:{write:{ignoreOrigin:!0,layerContainerTypes:xl},origins:{"web-map":{read:!1,write:!1}}}};let km=class extends sn(Ne){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};_([T()],km.prototype,"creatorField",void 0),_([T()],km.prototype,"creationDateField",void 0),_([T()],km.prototype,"editorField",void 0),_([T()],km.prototype,"editDateField",void 0),_([T()],km.prototype,"realm",void 0),_([T(yL("dateFieldsTimeReference",!0))],km.prototype,"timeZone",void 0),km=_([Z("esri.layers.support.EditFieldsInfo")],km);const f5t=km;let Yf=class extends sn(Ne){constructor(e){super(e)}};_([T({constructOnly:!0,json:{write:!0}})],Yf.prototype,"name",void 0),_([T({constructOnly:!0,json:{write:!0}})],Yf.prototype,"fields",void 0),_([T({constructOnly:!0,json:{write:!0}})],Yf.prototype,"isAscending",void 0),_([T({constructOnly:!0,json:{write:!0}})],Yf.prototype,"indexType",void 0),_([T({constructOnly:!0,json:{write:!0}})],Yf.prototype,"isUnique",void 0),_([T({constructOnly:!0,json:{write:!0}})],Yf.prototype,"description",void 0),Yf=_([Z("esri.layers.support.FeatureIndex")],Yf);async function m5t(t,e,i){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=XMe(t));const r=g5t(t),n=t.capabilities.query.supportsPagination;e.start=0,e.num=r;let s=null;for(;;){const a=await t.source.queryFeaturesJSON(e,i);if(s==null?s=a:s.features=s.features.concat(a.features),s.exceededTransferLimit=a.exceededTransferLimit,!n||!a.exceededTransferLimit)break;e.start+=r}return s}function g5t(t){return XMe(t)*y5t(t)}function y5t(t){return t.capabilities.query.maxRecordCount||2e3}function XMe(t){return t.capabilities.query.supportsMaxRecordCountFactor?qh.MAX_MAX_RECORD_COUNT_FACTOR:1}var NX;let oa=NX=class extends Ne{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new NX(Ce({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};_([T({type:[String],json:{write:!0}})],oa.prototype,"attachmentTypes",void 0),_([T({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],oa.prototype,"attachmentsWhere",void 0),_([T({type:Boolean,json:{write:!0}})],oa.prototype,"cacheHint",void 0),_([T({type:[String],json:{write:!0}})],oa.prototype,"keywords",void 0),_([T({type:[Number],json:{write:!0}})],oa.prototype,"globalIds",void 0),_([T({json:{write:!0}})],oa.prototype,"name",void 0),_([T({type:Number,json:{read:{source:"resultRecordCount"}}})],oa.prototype,"num",void 0),_([T({type:[Number],json:{write:!0}})],oa.prototype,"objectIds",void 0),_([T({type:Boolean,json:{default:!1,write:!0}})],oa.prototype,"returnMetadata",void 0),_([T({type:[Number],json:{write:!0}})],oa.prototype,"size",void 0),_([T({type:Number,json:{read:{source:"resultOffset"}}})],oa.prototype,"start",void 0),_([ot("start"),ot("num")],oa.prototype,"writeStart",null),_([T({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],oa.prototype,"where",void 0),oa=NX=_([Z("esri.rest.support.AttachmentQuery")],oa),oa.from=os(oa);const v5t=oa;var FX;let xs=FX=class extends Ne{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new FX(Ce({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};_([T({type:Boolean,json:{write:!0}})],xs.prototype,"cacheHint",void 0),_([T({type:lp,json:{write:!0}})],xs.prototype,"dynamicDataSource",void 0),_([T({type:String,json:{write:!0}})],xs.prototype,"gdbVersion",void 0),_([T({type:Number,json:{write:!0}})],xs.prototype,"geometryPrecision",void 0),_([T({type:Date})],xs.prototype,"historicMoment",void 0),_([ot("historicMoment")],xs.prototype,"_writeHistoricMoment",null),_([T({type:Number,json:{write:!0}})],xs.prototype,"maxAllowableOffset",void 0),_([T({type:[Number],json:{write:!0}})],xs.prototype,"objectIds",void 0),_([T({type:[String],json:{write:!0}})],xs.prototype,"orderByFields",void 0),_([T({type:[String],json:{write:!0}})],xs.prototype,"outFields",void 0),_([T({type:dt,json:{read:{source:"outSR"},write:{target:"outSR"}}})],xs.prototype,"outSpatialReference",void 0),_([T({json:{write:!0}})],xs.prototype,"relationshipId",void 0),_([T({type:Number,json:{read:{source:"resultOffset"}}})],xs.prototype,"start",void 0),_([ot("start"),ot("num")],xs.prototype,"writeStart",null),_([T({type:Number,json:{read:{source:"resultRecordCount"}}})],xs.prototype,"num",void 0),_([T({json:{write:!0}})],xs.prototype,"returnGeometry",void 0),_([T({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],xs.prototype,"returnM",void 0),_([T({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],xs.prototype,"returnZ",void 0),_([T({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],xs.prototype,"where",void 0),xs=FX=_([Z("esri.rest.support.RelationshipQuery")],xs),xs.from=os(xs);const ote=xs,QGt=Object.freeze(Object.defineProperty({__proto__:null,default:ote},Symbol.toStringTag,{value:"Module"})),kX=new br({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function _5t(t,e,i,r){const n=await Hv(t);if(await ate(t,e,r),!n.addAttachment)throw new de(r,"Layer source does not support addAttachment capability");return n.addAttachment(e,i)}function ate(t,e,i){const{attributes:r}=e,{objectIdField:n}=t;return t.capabilities?.data?.supportsAttachment?e?r?n&&r[n]?Promise.resolve():Promise.reject(new de(i,`feature is missing the identifying attribute ${n}`)):Promise.reject(new de(i,"'attributes' are required on a feature to query attachments")):Promise.reject(new de(i,"A feature is required to add/delete/update attachments")):Promise.reject(new de(i,"this layer doesn't support attachments"))}async function b5t(t,e,i,r,n){const s=await Hv(t);if(await ate(t,e,n),!s.updateAttachment)throw new de(n,"Layer source does not support updateAttachment capability");return s.updateAttachment(e,i,r)}async function w5t(t,e,i){const{applyEdits:r}=await ke(()=>import("./editingSupport-6cb765eb.js"),[],import.meta.url),n=await t.load(),{source:s,globalIdField:a}=n;let u=i;return n.type==="feature"&&n.infoFor3D&&e.deleteFeatures!=null&&a!=null&&(u={...u,globalIdToObjectId:await k5t(t,e.deleteFeatures,a)}),r(n,s,e,i)}async function x5t(t,e,i){const{uploadAssets:r}=await ke(()=>import("./editingSupport-6cb765eb.js"),[],import.meta.url),n=await t.load();return r(n,n.source,e,i)}async function T5t(t,e,i,r){const n=await Hv(t);if(await ate(t,e,r),!n.deleteAttachments)throw new de(r,"Layer source does not support deleteAttachments capability");return n.deleteAttachments(e,i)}async function S5t(t,e,i){const r=(await t.load({signal:e?.signal})).source;if(!r.fetchRecomputedExtents)throw new de(i,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function E5t(t,e,i,r){e=v5t.from(e),await t.load();const n=t.source,s=t.capabilities;if(!s?.data?.supportsAttachment)throw new de(r,"this layer doesn't support attachments");const{attachmentTypes:a,objectIds:u,globalIds:p,num:y,size:b,start:S,where:C}=e;if(!s?.operations?.supportsQueryAttachments&&(a?.length>0||p?.length>0||b?.length>0||y||S||C))throw new de(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(u?.length||p?.length||C))throw new de(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!n.queryAttachments)throw new de(r,"Layer source does not support queryAttachments capability",e);return n.queryAttachments(e)}async function C5t(t,e,i,r){const n=await Hv(t);if(!n.queryObjectIds)throw new de(r,"Layer source does not support queryObjectIds capability");return n.queryObjectIds(qh.from(e)??t.createQuery(),i)}async function A5t(t,e,i,r){const n=await Hv(t);if(!n.queryFeatureCount)throw new de(r,"Layer source does not support queryFeatureCount capability");return n.queryFeatureCount(qh.from(e)??t.createQuery(),i)}async function O5t(t,e,i,r){const n=await Hv(t);if(!n.queryExtent)throw new de(r,"Layer source does not support queryExtent capability");return n.queryExtent(qh.from(e)??t.createQuery(),i)}async function R5t(t,e,i,r){const n=await Hv(t);if(!n.queryRelatedFeatures)throw new de(r,"Layer source does not support queryRelatedFeatures capability");return n.queryRelatedFeatures(ote.from(e),i)}async function M5t(t,e,i,r){const n=await Hv(t);if(!n.queryRelatedFeaturesCount)throw new de(r,"Layer source does not support queryRelatedFeaturesCount capability");return n.queryRelatedFeaturesCount(ote.from(e),i)}async function P5t(t){const e=t.source;if(e?.refresh)try{const{dataChanged:i,updates:r}=await e.refresh();if(r!=null&&(t.sourceJSON={...t.sourceJSON,...r},t.read(r,{origin:"service",url:t.parsedUrl})),i)return!0}catch{}if(t.definitionExpression)try{return(await MY(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function I5t(t){const e=new qh,i=t.capabilities?.data,r=t.capabilities?.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),i&&(i.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),i.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:n,timeExtent:s}=t;return e.timeExtent=n!=null&&s!=null?s.offset(-n.value,n.unit):s||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function JMe(t){const{globalIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeGlobalID")return r.name}}function YMe(t){const{objectIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeOID")return r.name}}function $5t(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}async function Hv(t){return(await t.load()).source}async function L5t(t,e){if(!Ii||Ii.findCredential(t))return;let i;try{const r=await ege(t,e);r&&(i=await Ii.checkSignInStatus(`${r}/sharing`))}catch{}if(i)try{const r=e!=null?e.signal:null;await Ii.getCredential(t,{signal:r})}catch{}}async function D5t(t,e,i){const r=t.parsedUrl?.path;r&&t.authenticationTriggerEvent===e&&await L5t(r,i)}function N5t(t){return!t.sourceJSON?.isMultiServicesView&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const nj=aE({types:x_e});function qN(t,e){if(t.defaultSymbol)return t.types?.length?new ite({defaultSymbol:nj(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(i=>({id:i.id,symbol:nj(i.symbol,i,e)}))}):new VN({symbol:nj(t.defaultSymbol,t,e)})}function F5t(t){let e=t.sourceJSON?.cacheMaxAge;if(!e)return!1;const i=t.editingInfo?.lastEditDate?.getTime();return i==null||(e*=1e3,Date.now()-i<e)}async function k5t(t,e,i){if(e==null)return null;const r=[],{objectIdField:n}=t;if(e.forEach(y=>{let b=null;if("attributes"in y){const{attributes:S}=y;b={globalId:S[i],objectId:S[n]!=null&&S[n]!==-1?S[n]:null}}else b={globalId:y.globalId,objectId:y.objectId!=null&&y.objectId!==-1?y.objectId:null};b.globalId!=null&&(b.objectId!=null&&b.objectId!==-1||r.push(b.globalId))}),r.length===0)return null;const s=t.createQuery();s.where=r.map(y=>`${i}='${y}'`).join(" OR "),s.returnGeometry=!1,s.outFields=[n,i],s.cacheHint=!1;const a=await t6e(m5t(t,s));if(!a.ok)return null;const u=new Map,p=a.value.features;for(const y of p){const b=y.attributes[i],S=y.attributes[n];b!=null&&S!=null&&S!==-1&&u.set(b,S)}return u}let tT=class extends sn(Ne){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};_([T({type:String,json:{read:{source:"shapeAreaFieldName"}}})],tT.prototype,"shapeAreaField",void 0),_([T({type:String,json:{read:{source:"shapeLengthFieldName"}}})],tT.prototype,"shapeLengthField",void 0),_([T({type:String,json:{read:t=>$6e.read(t)||L6e.read(t)}})],tT.prototype,"units",void 0),tT=_([Z("esri.layers.support.GeometryFieldsInfo")],tT);const z5t=tT;var zX;let iT=zX=class extends Ne{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new Dt}clone(){return new zX({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};_([T({type:String,json:{write:!0}})],iT.prototype,"floorField",void 0),_([T({json:{read:!1,write:!1}})],iT.prototype,"viewAllMode",void 0),_([T({json:{read:!1,write:!1}})],iT.prototype,"viewAllLevelIds",void 0),iT=zX=_([Z("esri.layers.support.LayerFloorInfo")],iT);const U5t=iT,Cfe=new br({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Afe=new br({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Sh=class extends sn(Ne){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};_([T({json:{read:Cfe.read,write:Cfe.write}})],Sh.prototype,"cardinality",void 0),_([T({json:{read:!0,write:!0}})],Sh.prototype,"composite",void 0),_([T({json:{read:!0,write:!0}})],Sh.prototype,"id",void 0),_([T({json:{read:!0,write:!0}})],Sh.prototype,"keyField",void 0),_([T({json:{read:!0,write:!0}})],Sh.prototype,"keyFieldInRelationshipTable",void 0),_([T({json:{read:!0,write:!0}})],Sh.prototype,"name",void 0),_([T({json:{read:!0,write:!0}})],Sh.prototype,"relatedTableId",void 0),_([T({json:{read:!0,write:!0}})],Sh.prototype,"relationshipTableId",void 0),_([T({json:{read:Afe.read,write:Afe.write}})],Sh.prototype,"role",void 0),Sh=_([Z("esri.layers.support.Relationship")],Sh);const j5t=Sh;function wi(t,e,i){return!!ZMe(t,e,i)}function _A(t,e,i){return ZMe(t,e,i)}function ZMe(t,e,i){return t&&t.hasOwnProperty(e)?t[e]:i}const B5t={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function V5t(t){const e=t?.supportedSpatialAggregationStatistics?.map(i=>i.toLowerCase());return{envelope:!!e?.includes("envelopeaggregate"),centroid:!!e?.includes("centroidaggregate"),convexHull:!!e?.includes("convexhullaggregate")}}function VR(t,e){return!!t?.supportedOperationsWithCacheHint?.map(r=>r.toLowerCase())?.includes(e.toLowerCase())}function KMe(t,e){return{analytics:G5t(t),attachment:H5t(t),data:q5t(t),metadata:W5t(t),operations:X5t(t.capabilities,t,e),query:J5t(t,e),queryRelated:Y5t(t),queryTopFeatures:Z5t(t),editing:K5t(t)}}function G5t(t){return{supportsCacheHint:VR(t.advancedQueryCapabilities,"queryAnalytics")}}function H5t(t){const e=t.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:VR(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:wi(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(r=>{const n=B5t[r.name];n&&(i[n]=!!r.isEnabled)}),i}function q5t(t){return{isVersioned:wi(t,"isDataVersioned",!1),supportsAttachment:wi(t,"hasAttachments",!1),supportsM:wi(t,"hasM",!1),supportsZ:wi(t,"hasZ",!1)}}function W5t(t){return{supportsAdvancedFieldProperties:wi(t,"supportsFieldDescriptionProperty",!1)}}function X5t(t,e,i){const r=t?t.toLowerCase().split(",").map(C=>C.trim()):[],n=i?uE(i):null,s=r.includes(n!=null&&n.serverType==="MapServer"?"data":"query"),a=r.includes("editing")&&!e.datesInUnknownTimezone;let u=a&&r.includes("create"),p=a&&r.includes("delete"),y=a&&r.includes("update");const b=r.includes("changetracking"),S=e.advancedQueryCapabilities;return a&&!(u||p||y)&&(u=p=y=!0),{supportsCalculate:wi(e,"supportsCalculate",!1),supportsTruncate:wi(e,"supportsTruncate",!1),supportsValidateSql:wi(e,"supportsValidateSql",!1),supportsAdd:u,supportsDelete:p,supportsEditing:a,supportsChangeTracking:b,supportsQuery:s,supportsQueryAnalytics:wi(S,"supportsQueryAnalytic",!1),supportsQueryAttachments:wi(S,"supportsQueryAttachments",!1),supportsQueryTopFeatures:wi(S,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:wi(e,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:y,supportsExceedsLimitStatistics:wi(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:wi(e,"supportsAsyncConvert3D",!1)}}function J5t(t,e){const i=t.advancedQueryCapabilities,r=t.ownershipBasedAccessControlForFeatures,n=t.archivingInfo,s=t.currentVersion,a=e?.includes("MapServer"),u=!a||s>=Me("mapserver-pbf-version-support"),p=J1e(e),y=new Set((t.supportedQueryFormats??"").split(",").map(b=>b.toLowerCase().trim()));return{supportsStatistics:wi(i,"supportsStatistics",t.supportsStatistics),supportsPercentileStatistics:wi(i,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:wi(i,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:V5t(i),supportsCentroid:wi(i,"supportsReturningGeometryCentroid",!1),supportsDistance:wi(i,"supportsQueryWithDistance",!1),supportsDistinct:wi(i,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:wi(i,"supportsReturningQueryExtent",!1),supportsGeometryProperties:wi(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:wi(i,"supportsHavingClause",!1),supportsOrderBy:wi(i,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:wi(i,"supportsPagination",!1),supportsQuantization:wi(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:wi(t,"supportsQuantizationEditMode",!1),supportsQueryGeometry:wi(t,"supportsReturningQueryGeometry",!1),supportsResultType:wi(i,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:wi(i,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:wi(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:wi(t,"useStandardizedQueries",!1),supportsTopFeaturesQuery:wi(i,"supportsTopFeaturesQuery",!1),supportsQueryByAnonymous:wi(r,"allowAnonymousToQuery",!0),supportsQueryByOthers:wi(r,"allowOthersToQuery",!0),supportsHistoricMoment:wi(n,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:u&&y.has("pbf"),supportsDisjointSpatialRelationship:wi(i,"supportsDisjointSpatialRel",!1),supportsCacheHint:wi(i,"supportsQueryWithCacheHint",!1)||VR(i,"query"),supportsDefaultSpatialReference:wi(i,"supportsDefaultSR",!1),supportsCompactGeometry:p,supportsFullTextSearch:wi(i,"supportsFullTextSearch",!1),maxRecordCountFactor:_A(t,"maxRecordCountFactor",void 0),maxRecordCount:_A(t,"maxRecordCount",void 0),standardMaxRecordCount:_A(t,"standardMaxRecordCount",void 0),tileMaxRecordCount:_A(t,"tileMaxRecordCount",void 0)}}function Y5t(t){const e=t.advancedQueryCapabilities,i=wi(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:wi(e,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:VR(e,"queryRelated")}}function Z5t(t){return{supportsCacheHint:VR(t.advancedQueryCapabilities,"queryTopFilter")}}function K5t(t){const e=t.ownershipBasedAccessControlForFeatures,i=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:wi(t,"allowGeometryUpdates",!0),supportsGlobalId:wi(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:wi(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:wi(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:wi(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:wi(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:wi(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:wi(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:wi(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:wi(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:wi(i,"supportsAsyncApplyEdits",!1),zDefault:_A(t,"zDefault",void 0)}}let zm=class extends sn(Ne){constructor(e){super(e),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(e){if(!e)return null;const i={};for(const r of Object.keys(e))i[r]=dN(e[r]);return i}writeDomains(e,i){if(!e)return;const r={};for(const n of Object.keys(e))e[n]&&(r[n]=e[n]?.toJSON());i.domains=r}};_([T({type:Number,json:{write:!0}})],zm.prototype,"code",void 0),_([T({type:Object,json:{write:!0}})],zm.prototype,"defaultValues",void 0),_([T({json:{write:!0}})],zm.prototype,"domains",void 0),_([rt("domains")],zm.prototype,"readDomains",null),_([ot("domains")],zm.prototype,"writeDomains",null),_([T({type:String,json:{write:!0}})],zm.prototype,"name",void 0),zm=_([Z("esri.layers.support.Subtype")],zm);const Q5t=zm,eAt=t=>{let e=class extends t{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(Dt.ofType(Yf)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=dt.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.version=void 0}get authenticationTriggerEvent(){if(!this.url)return null;const{capabilities:i}=this;if(i){const{query:r,operations:n,editing:s}=i;if(!r.supportsQueryByOthers||!r.supportsQueryByAnonymous||n.supportsEditing&&!(s.supportsUpdateByOthers&&s.supportsUpdateByAnonymous&&s.supportsDeleteByOthers&&s.supportsDeleteByAnonymous))return"load"}return this.userHasUpdateItemPrivileges?F5t(this)?"load":this.hasUpdateItemRestrictions?i.operations.supportsQuery?"editing":"load":null:this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions?"editing":null}readCapabilitiesFromService(i,r){return KMe(r,this.url)}readEditingInfo(i,r){const{editingInfo:n}=r;return n?{lastEditDate:n.lastEditDate!=null?new Date(n.lastEditDate):null}:null}get effectiveCapabilities(){const i=this.capabilities;if(!i)return null;const r=Ce(i),{operations:n,editing:s}=r;return this.sourceJSON?.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(n.supportsQuery=!0),r):this.userHasUpdateItemPrivileges?(n.supportsAdd=n.supportsDelete=n.supportsEditing=n.supportsQuery=n.supportsUpdate=s.supportsDeleteByOthers=s.supportsGeometryUpdate=s.supportsUpdateByOthers=!0,r):(this.userHasFullEditingPrivileges&&n.supportsEditing&&(n.supportsAdd=n.supportsDelete=n.supportsUpdate=s.supportsGeometryUpdate=!0),r)}readGlobalIdFieldFromService(i,r){return JMe(r)}get hasFullEditingRestrictions(){const i=this.capabilities;if(!i||this.sourceJSON?.isMultiServicesView)return!1;const{operations:r,editing:n}=i;return r.supportsEditing&&!(r.supportsAdd&&r.supportsDelete&&r.supportsUpdate&&n.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const i=this.capabilities;if(!i)return!1;const{operations:r,editing:n}=i;return this.sourceJSON?.isMultiServicesView?!r.supportsQuery:!(r.supportsAdd&&r.supportsDelete&&r.supportsEditing&&r.supportsQuery&&r.supportsUpdate&&n.supportsDeleteByOthers&&n.supportsGeometryUpdate&&n.supportsUpdateByOthers)}readIsTableFromService(i,r){return r.type==="Table"}readMaxScale(i,r){return r.effectiveMaxScale||i||0}readMinScale(i,r){return r.effectiveMinScale||i||0}readObjectIdFieldFromService(i,r){return YMe(r)}readServiceDefinitionExpression(i,r){return r.definitionQuery||r.definitionExpression}set url(i){const r=z7e({layer:this,url:i,nonStandardUrlAllowed:!0,logger:Ee.getLogger(this)});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,n,s){U7e(this,i,null,r,s)}readVersion(i,r){return $5t(r)}};return _([T({readOnly:!0})],e.prototype,"authenticationTriggerEvent",null),_([T({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),_([T({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),_([rt("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),_([T(yL("dateFieldsTimeReference"))],e.prototype,"dateFieldsTimeZone",void 0),_([T({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),_([T({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),_([T({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),_([T({readOnly:!0,type:f5t})],e.prototype,"editFieldsInfo",void 0),_([T({readOnly:!0})],e.prototype,"editingInfo",void 0),_([rt("editingInfo")],e.prototype,"readEditingInfo",null),_([T({readOnly:!0})],e.prototype,"effectiveCapabilities",null),_([T((()=>{const i=Ce(h5t),r=i.json.origins;return r["web-map"]={read:!1,write:!1},r["portal-item"]={read:!1,write:!1},i})())],e.prototype,"elevationInfo",void 0),_([T({type:U5t,json:{name:"layerDefinition.floorInfo",write:!0,origins:{"web-scene":{name:"layerDefinition.floorInfo",write:{enabled:!0,layerContainerTypes:xl}}}}})],e.prototype,"floorInfo",void 0),_([T({type:rr,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),_([T()],e.prototype,"gdbVersion",void 0),_([T({readOnly:!0,type:z5t,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),_([T({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:kX.read}}}})],e.prototype,"geometryType",void 0),_([T({type:String})],e.prototype,"globalIdField",void 0),_([rt("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),_([T({readOnly:!0})],e.prototype,"hasFullEditingRestrictions",null),_([T({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),_([T({readOnly:!0})],e.prototype,"hasUpdateItemRestrictions",null),_([T({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),_([T({readOnly:!0,type:$v})],e.prototype,"heightModelInfo",void 0),_([T({type:Date})],e.prototype,"historicMoment",void 0),_([T({type:Dt.ofType(Yf),readOnly:!0})],e.prototype,"indexes",void 0),_([T({readOnly:!0})],e.prototype,"isTable",void 0),_([rt("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),_([T({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),_([T(qMe)],e.prototype,"maxScale",void 0),_([rt("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),_([T(HMe)],e.prototype,"minScale",void 0),_([rt("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),_([T({type:String})],e.prototype,"objectIdField",void 0),_([rt("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),_([T(yL("preferredTimeReference"))],e.prototype,"preferredTimeZone",void 0),_([T({type:[j5t],readOnly:!0})],e.prototype,"relationships",void 0),_([T({type:Boolean})],e.prototype,"returnM",void 0),_([T({type:Boolean})],e.prototype,"returnZ",void 0),_([T({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),_([T({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),_([rt("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),_([T({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),_([T()],e.prototype,"sourceJSON",void 0),_([T({type:dt,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),_([T({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),_([T({type:[Q5t],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"subtypes",void 0),_([T({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),_([T(BMe)],e.prototype,"url",null),_([ot("url")],e.prototype,"writeUrl",null),_([T({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),_([rt("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=_([Z("esri.layers.mixins.FeatureLayerBase")],e),e};let rT=class extends sn(Ne){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};_([T({type:String,json:{write:!0}})],rT.prototype,"expression",void 0),_([T({type:String,json:{write:!0}})],rT.prototype,"title",void 0),_([T({type:String,json:{write:!0}})],rT.prototype,"returnType",void 0),rT=_([Z("esri.layers.support.ExpressionInfo")],rT);const lte=rT;var UX;let Um=UX=class extends Ne{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new UX({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:Ce(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};_([T({type:Boolean,json:{write:!0}})],Um.prototype,"isAutoGenerated",void 0),_([T({type:String,json:{write:!0}})],Um.prototype,"name",void 0),_([T({type:String,json:{write:!0}})],Um.prototype,"alias",void 0),_([T({type:String,json:{write:!0}})],Um.prototype,"onStatisticField",void 0),_([T({type:lte,json:{write:!0}})],Um.prototype,"onStatisticExpression",void 0),_([T({type:String,json:{write:!0}})],Um.prototype,"statisticType",void 0),Um=UX=_([Z("esri.layers.support.AggregateField")],Um);const pw=Um;let iv=class extends Ne{constructor(){super(...arguments),this.type=null}};_([T({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],iv.prototype,"type",void 0),iv=_([Z("esri.layers.support.FeatureReduction")],iv);var jX;let hy=jX=class extends Ne{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?hq(e.value):t}writeExpression(t,e,i){this.value!=null&&(t=hq(this.value)),t!=null&&(e[i]=t)}clone(){return new jX({expression:this.expression,title:this.title,value:this.value})}};_([T({type:String,json:{write:{writerEnsuresNonNull:!0}}})],hy.prototype,"expression",void 0),_([rt("expression",["expression","value"])],hy.prototype,"readExpression",null),_([ot("expression")],hy.prototype,"writeExpression",null),_([T({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],hy.prototype,"title",void 0),_([T({json:{read:!1,write:!1}})],hy.prototype,"value",void 0),hy=jX=_([Z("esri.layers.support.LabelExpressionInfo")],hy);const QMe=hy,ePe=[252,146,31,255],sHt=[153,153,153,255],tPe={type:"esriSMS",style:"esriSMSCircle",size:6,color:ePe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},iPe={type:"esriSLS",style:"esriSLSSolid",width:.75,color:ePe},rPe={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},tAt={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},iAt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},rAt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},nAt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},oHt=Nv.fromJSON(tPe),aHt=dd.fromJSON(iPe),lHt=Sw.fromJSON(rPe),sAt=vE.fromJSON(tAt);Nv.fromJSON(iAt);dd.fromJSON(rAt);Sw.fromJSON(nAt);var BX;const K9=new br({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function Q9(t,e,i){return{enabled:!Qme(i?.layer)}}function nPe(t){return!t||t.origin!=="service"&&t.layer?.type!=="map-image"}function oAt(t){return t?.type==="map-image"}function sPe(t){return!!oAt(t)&&!!t.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}function aAt(t){return nPe(t)||sPe(t?.layer)}let ks=BX=class extends Ne{static evaluateWhere(t,e){const i=(r,n,s)=>{switch(n){case"=":return r==s;case"<>":return r!=s;case">":return r>s;case">=":return r>=s;case"<":return r<s;case"<=":return r<=s}return!1};try{if(t==null)return!0;const r=t.split(" ");if(r.length===3)return i(e[r[0]],r[1],r[2]);if(r.length===7){const n=i(e[r[0]],r[1],r[2]),s=r[3],a=i(e[r[4]],r[5],r[6]);switch(s){case"AND":return n&&a;case"OR":return n||a}}return!1}catch{console.log("Error.: can't parse = "+t)}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=sAt,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const i=e.labelExpressionInfo;if(!i||!i.value&&!i.expression)return t}writeLabelExpression(t,e,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=Jit(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=tQ(this.labelExpressionInfo.expression);r&&(t="["+r+"]")}}t!=null&&(e[i]=t)}writeLabelExpressionInfo(t,e,i,r){if(t==null&&this.labelExpression!=null&&nPe(r))t=new QMe({expression:this.getLabelExpressionArcade()});else if(!t)return;const n=t.toJSON(r);n.expression&&(e[i]=n)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return nN(this)}getLabelExpressionArcade(){return Yit(this)}getLabelExpressionSingleField(){return Zit(this)}hash(){return JSON.stringify(this)}clone(){return new BX({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:Ce(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:Ce(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};_([T({type:String,json:{write:!0}})],ks.prototype,"name",void 0),_([T({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:Q9}}}}})],ks.prototype,"allowOverrun",void 0),_([T({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:Q9}}}}})],ks.prototype,"deconflictionStrategy",void 0),_([T({type:String,json:{write:{overridePolicy(t,e,i){return this.labelExpressionInfo&&i?.origin==="service"&&sPe(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],ks.prototype,"labelExpression",void 0),_([rt("labelExpression")],ks.prototype,"readLabelExpression",null),_([ot("labelExpression")],ks.prototype,"writeLabelExpression",null),_([T({type:QMe,json:{write:{overridePolicy:(t,e,i)=>aAt(i)?{allowNull:!0}:{enabled:!1}}}})],ks.prototype,"labelExpressionInfo",void 0),_([ot("labelExpressionInfo")],ks.prototype,"writeLabelExpressionInfo",null),_([T({type:K9.apiValues,json:{type:K9.jsonValues,read:K9.read,write:K9.write}})],ks.prototype,"labelPlacement",void 0),_([T({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],ks.prototype,"labelPosition",void 0),_([T({type:Number})],ks.prototype,"maxScale",void 0),_([ot("maxScale")],ks.prototype,"writeMaxScale",null),_([T({type:Number})],ks.prototype,"minScale",void 0),_([ot("minScale")],ks.prototype,"writeMinScale",null),_([T({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:Q9}}}}})],ks.prototype,"repeatLabel",void 0),_([T({type:Number,cast:Br,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:Q9}}}}})],ks.prototype,"repeatLabelDistance",void 0),_([T({types:vje,json:{origins:{"web-scene":{types:_je,write:pce,default:null}},write:pce,default:null}})],ks.prototype,"symbol",void 0),_([T({type:Boolean,json:{write:!0}})],ks.prototype,"useCodedValues",void 0),_([T({type:String,json:{write:!0}})],ks.prototype,"where",void 0),ks=BX=_([Z("esri.layers.support.LabelClass")],ks);const GR=ks;var VX;const lAt="esri.layers.support.FeatureReductionBinning";let Ul=VX=class extends iv{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(t,e,i){const r=t.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());bl(i,r,e)}readRenderer(t,e,i){const r=e.drawingInfo?.renderer;return r?iE(r,e,i)??void 0:qN(e,i)}clone(){return new VX({fields:Ce(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:Ce(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:Ce(this.popupTemplate),renderer:Ce(this.renderer)})}};_([Bt({binning:"binning"})],Ul.prototype,"type",void 0),_([Bt({geohash:"geohash"})],Ul.prototype,"binType",void 0),_([T({type:Number,range:{min:1,max:9},json:{write:!0}})],Ul.prototype,"fixedBinLevel",void 0),_([T({type:[GR],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Ul.prototype,"labelingInfo",void 0),_([T(HN)],Ul.prototype,"labelsVisible",void 0),_([T({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Ul.prototype,"maxScale",void 0),_([T(GN)],Ul.prototype,"popupEnabled",void 0),_([T({type:mE,json:{name:"popupInfo",write:!0}})],Ul.prototype,"popupTemplate",void 0),_([T({type:[pw],json:{write:!0}})],Ul.prototype,"fields",void 0),_([ot("fields")],Ul.prototype,"writeFields",null),_([T({types:BR,json:{write:{target:"drawingInfo.renderer"}}})],Ul.prototype,"renderer",void 0),_([rt("renderer",["drawingInfo.renderer"])],Ul.prototype,"readRenderer",null),Ul=VX=_([Z(lAt)],Ul);const oPe=Ul;var GX;const cAt="esri.layers.support.FeatureReductionCluster";function Ofe(t){return t.type==="simple"&&!t.visualVariables?.length}let _o=GX=class extends Ne{constructor(t){super(t),this.type="cluster",this.clusterRadius=Br("80px"),this.clusterMinSize=Br("12px"),this.clusterMaxSize=Br("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(t,e,i){const r=e.drawingInfo?.renderer;return r?.authoringInfo?.isAutoGenerated?null:r?Ofe(r)?null:iE(r,e,i)??void 0:qN(e,i)}readSymbol(t,e,i){const r=e.drawingInfo?.renderer;return r?.authoringInfo?.isAutoGenerated?null:r&&Ofe(r)?iE(r,e,i)?.symbol:null}writeSymbol(t,e,i,r){const n=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||n){const s=new VN({symbol:t});e.drawingInfo={renderer:s.write({},r)}}}writeFields(t,e,i){const r=t.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());bl(i,r,e)}readFields(t,e,i){return t.filter(r=>!r.isAutoGenerated).map(r=>pw.fromJSON(r))}clone(){return new GX({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:Ce(this.labelingInfo),labelsVisible:this.labelsVisible,fields:Ce(this.fields),maxScale:this.maxScale,renderer:Ce(this.renderer),symbol:Ce(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:Ce(this.popupTemplate)})}};_([T({type:["cluster"],readOnly:!0,json:{write:!0}})],_o.prototype,"type",void 0),_([T({type:Number,cast:t=>t==="auto"?t:Br(t),json:{write:!0}})],_o.prototype,"clusterRadius",void 0),_([T({type:Number,cast:Br,json:{write:!0}})],_o.prototype,"clusterMinSize",void 0),_([T({type:Number,cast:Br,json:{write:!0}})],_o.prototype,"clusterMaxSize",void 0),_([T({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],_o.prototype,"maxScale",void 0),_([T(GN)],_o.prototype,"popupEnabled",void 0),_([T({type:mE,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],_o.prototype,"popupTemplate",void 0),_([T({types:BR,json:{write:{target:"drawingInfo.renderer"}}})],_o.prototype,"renderer",void 0),_([rt("renderer",["drawingInfo.renderer"])],_o.prototype,"readRenderer",null),_([T({types:gje})],_o.prototype,"symbol",void 0),_([rt("symbol",["drawingInfo.renderer"])],_o.prototype,"readSymbol",null),_([ot("symbol")],_o.prototype,"writeSymbol",null),_([T({type:[GR],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],_o.prototype,"labelingInfo",void 0),_([T(HN)],_o.prototype,"labelsVisible",void 0),_([T({type:[pw],json:{write:!0}})],_o.prototype,"fields",void 0),_([ot("fields")],_o.prototype,"writeFields",null),_([rt("fields")],_o.prototype,"readFields",null),_o=GX=_([Z(cAt)],_o);const aPe=_o;var HX;let b6=HX=class extends iv{constructor(t){super(t),this.type="selection"}clone(){return new HX}};_([T({type:["selection"]})],b6.prototype,"type",void 0),b6=HX=_([Z("esri.layers.support.FeatureReductionSelection")],b6);const Rfe=b6,Mfe={key:"type",base:iv,typeMap:{cluster:aPe,binning:oPe}},uAt={types:{key:"type",base:iv,typeMap:{selection:Rfe,cluster:aPe,binning:oPe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:Mfe},"portal-item":{types:Mfe},"web-scene":{types:{key:"type",base:iv,typeMap:{selection:Rfe}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:xl}}}}},tx={Base64:0,Hex:1,String:2,Raw:3},iS=8,lPe=(1<<iS)-1;function Wy(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function hAt(t){const e=[];for(let i=0,r=t.length*iS;i<r;i+=iS)e[i>>5]|=(t.charCodeAt(i/iS)&lPe)<<i%32;return e}function dAt(t){const e=[];for(let i=0,r=32*t.length;i<r;i+=iS)e.push(String.fromCharCode(t[i>>5]>>>i%32&lPe));return e.join("")}function pAt(t){const e="0123456789abcdef",i=[];for(let r=0,n=4*t.length;r<n;r++)i.push(e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15));return i.join("")}function fAt(t){const e="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(let n=0,s=4*t.length;n<s;n+=3){const a=(t[n>>2]>>n%4*8&255)<<16|(t[n+1>>2]>>(n+1)%4*8&255)<<8|t[n+2>>2]>>(n+2)%4*8&255;for(let u=0;u<4;u++)8*n+6*u>32*t.length?r.push(e):r.push(i.charAt(a>>6*(3-u)&63))}return r.join("")}function mAt(t,e){return t<<e|t>>>32-e}function WN(t,e,i,r,n,s){return Wy(mAt(Wy(Wy(e,t),Wy(r,s)),n),i)}function Ya(t,e,i,r,n,s,a){return WN(e&i|~e&r,t,e,n,s,a)}function Za(t,e,i,r,n,s,a){return WN(e&r|i&~r,t,e,n,s,a)}function Ka(t,e,i,r,n,s,a){return WN(e^i^r,t,e,n,s,a)}function Qa(t,e,i,r,n,s,a){return WN(i^(e|~r),t,e,n,s,a)}function gAt(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let i=1732584193,r=-271733879,n=-1732584194,s=271733878;for(let a=0;a<t.length;a+=16){const u=i,p=r,y=n,b=s;i=Ya(i,r,n,s,t[a],7,-680876936),s=Ya(s,i,r,n,t[a+1],12,-389564586),n=Ya(n,s,i,r,t[a+2],17,606105819),r=Ya(r,n,s,i,t[a+3],22,-1044525330),i=Ya(i,r,n,s,t[a+4],7,-176418897),s=Ya(s,i,r,n,t[a+5],12,1200080426),n=Ya(n,s,i,r,t[a+6],17,-1473231341),r=Ya(r,n,s,i,t[a+7],22,-45705983),i=Ya(i,r,n,s,t[a+8],7,1770035416),s=Ya(s,i,r,n,t[a+9],12,-1958414417),n=Ya(n,s,i,r,t[a+10],17,-42063),r=Ya(r,n,s,i,t[a+11],22,-1990404162),i=Ya(i,r,n,s,t[a+12],7,1804603682),s=Ya(s,i,r,n,t[a+13],12,-40341101),n=Ya(n,s,i,r,t[a+14],17,-1502002290),r=Ya(r,n,s,i,t[a+15],22,1236535329),i=Za(i,r,n,s,t[a+1],5,-165796510),s=Za(s,i,r,n,t[a+6],9,-1069501632),n=Za(n,s,i,r,t[a+11],14,643717713),r=Za(r,n,s,i,t[a],20,-373897302),i=Za(i,r,n,s,t[a+5],5,-701558691),s=Za(s,i,r,n,t[a+10],9,38016083),n=Za(n,s,i,r,t[a+15],14,-660478335),r=Za(r,n,s,i,t[a+4],20,-405537848),i=Za(i,r,n,s,t[a+9],5,568446438),s=Za(s,i,r,n,t[a+14],9,-1019803690),n=Za(n,s,i,r,t[a+3],14,-187363961),r=Za(r,n,s,i,t[a+8],20,1163531501),i=Za(i,r,n,s,t[a+13],5,-1444681467),s=Za(s,i,r,n,t[a+2],9,-51403784),n=Za(n,s,i,r,t[a+7],14,1735328473),r=Za(r,n,s,i,t[a+12],20,-1926607734),i=Ka(i,r,n,s,t[a+5],4,-378558),s=Ka(s,i,r,n,t[a+8],11,-2022574463),n=Ka(n,s,i,r,t[a+11],16,1839030562),r=Ka(r,n,s,i,t[a+14],23,-35309556),i=Ka(i,r,n,s,t[a+1],4,-1530992060),s=Ka(s,i,r,n,t[a+4],11,1272893353),n=Ka(n,s,i,r,t[a+7],16,-155497632),r=Ka(r,n,s,i,t[a+10],23,-1094730640),i=Ka(i,r,n,s,t[a+13],4,681279174),s=Ka(s,i,r,n,t[a],11,-358537222),n=Ka(n,s,i,r,t[a+3],16,-722521979),r=Ka(r,n,s,i,t[a+6],23,76029189),i=Ka(i,r,n,s,t[a+9],4,-640364487),s=Ka(s,i,r,n,t[a+12],11,-421815835),n=Ka(n,s,i,r,t[a+15],16,530742520),r=Ka(r,n,s,i,t[a+2],23,-995338651),i=Qa(i,r,n,s,t[a],6,-198630844),s=Qa(s,i,r,n,t[a+7],10,1126891415),n=Qa(n,s,i,r,t[a+14],15,-1416354905),r=Qa(r,n,s,i,t[a+5],21,-57434055),i=Qa(i,r,n,s,t[a+12],6,1700485571),s=Qa(s,i,r,n,t[a+3],10,-1894986606),n=Qa(n,s,i,r,t[a+10],15,-1051523),r=Qa(r,n,s,i,t[a+1],21,-2054922799),i=Qa(i,r,n,s,t[a+8],6,1873313359),s=Qa(s,i,r,n,t[a+15],10,-30611744),n=Qa(n,s,i,r,t[a+6],15,-1560198380),r=Qa(r,n,s,i,t[a+13],21,1309151649),i=Qa(i,r,n,s,t[a+4],6,-145523070),s=Qa(s,i,r,n,t[a+11],10,-1120210379),n=Qa(n,s,i,r,t[a+2],15,718787259),r=Qa(r,n,s,i,t[a+9],21,-343485551),i=Wy(i,u),r=Wy(r,p),n=Wy(n,y),s=Wy(s,b)}return[i,r,n,s]}function cPe(t,e=tx.Hex){const i=e||tx.Base64,r=gAt(hAt(t),t.length*iS);switch(i){case tx.Raw:return r;case tx.Hex:return pAt(r);case tx.String:return dAt(r);case tx.Base64:return fAt(r)}}var qX;let bA=qX=class extends jN{writeLevels(t,e,i){for(const r in t){const n=this.levels[r];return void(e.stops=n)}}clone(){return new qX({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Gy(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Gy(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone(),levels:Ce(this.levels)})}};_([T()],bA.prototype,"levels",void 0),_([ot("levels")],bA.prototype,"writeLevels",null),bA=qX=_([Z("esri.views.2d.engine.LevelDependentSizeVariable")],bA);const yAt=Ee.getLogger("esri.views.2d.layers.support.clusterUtils");Me.add("esri-cluster-arcade-enabled",!0);const vAt=Me("esri-cluster-arcade-enabled"),_At=(t,e,i,r,n)=>{const s=e.clone();if(!TAt(s))return s;if(s.authoringInfo||(s.authoringInfo=new Kee),s.authoringInfo.isAutoGenerated=!0,"visualVariables"in s){const a=(s.visualVariables||[]).filter(p=>p.valueExpression!=="$view.scale"),u=bAt(a);a.forEach(p=>{p.type==="rotation"?p.field?p.field=P_(t,p.field,"avg_angle","number"):p.valueExpression&&(p.field=UC(t,p.valueExpression,"avg_angle","number"),p.valueExpression=null):p.normalizationField?(p.field=P_(t,p.field,"avg_norm","number",p.normalizationField),p.normalizationField=null):p.field?p.field=P_(t,p.field,"avg","number"):p.valueExpression&&(p.field=UC(t,p.valueExpression,"avg","number"),p.valueExpression=null)}),u==null&&!wAt(a)&&n&&(a.push(xAt(i,r)),s.dynamicClusterSize=!0),s.visualVariables=a}switch(s.type){case"simple":break;case"pie-chart":for(const a of s.attributes)a.field?a.field=P_(t,a.field,"sum","number"):a.valueExpression&&(a.field=UC(t,a.valueExpression,"sum","number"),a.valueExpression=null);break;case"unique-value":s.field?s.field=P_(t,s.field,"mode","string"):s.valueExpression&&(s.field=UC(t,s.valueExpression,"mode","string"),s.valueExpression=null);break;case"class-breaks":s.normalizationField?(s.field=P_(t,s.field,"avg_norm","number",s.normalizationField),s.normalizationField=null):s.field?s.field=P_(t,s.field,"avg","number"):s.valueExpression&&(s.field=UC(t,s.valueExpression,"avg","number"),s.valueExpression=null)}return s},bAt=t=>{for(const e of t)if(e.type==="size")return e;return null},wAt=t=>{for(const e of t)if(e.field==="cluster_count")return!0;return!1},xAt=(t,e)=>{const i=[new Wx({value:0,size:0}),new Wx({value:1})];if(e==null)return new jN({field:"cluster_count",stops:[...i,new Wx({value:2,size:0})]});const r=Object.keys(e).reduce((n,s)=>({...n,[s]:[...i,new Wx({value:Math.max(2,e[s].minValue),size:t.clusterMinSize}),new Wx({value:Math.max(3,e[s].maxValue),size:t.clusterMaxSize})]}),{});return new bA({field:"cluster_count",levels:r})},TAt=t=>{const e=i=>yAt.error(new de("Unsupported-renderer",i,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const i=t.normalizationType;if(i!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${i}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!vAt){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(i=>!(!("valueExpression"in i)||!i.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function SAt(t,e,i){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const r=i,n="field",s=e.toLowerCase()+",norm:"+n+","+r.toLowerCase();return"cluster_avg_"+cPe(s)}}}function UC(t,e,i,r){const n=cPe(e),s=i==="mode"?`cluster_type_${n}`:i==="sum"?`cluster_sum_${n}`:`cluster_avg_${n}`;return t.some(a=>a.name===s)||t.push(new pw({name:s,isAutoGenerated:!0,onStatisticExpression:new lte({expression:e,returnType:r}),statisticType:i})),s}function P_(t,e,i,r,n){if(e==="cluster_count"||t.some(a=>a.name===e))return e;const s=SAt(i,e,n);return t.some(a=>a.name===s)||(i==="avg_norm"?t.push(new pw({name:s,isAutoGenerated:!0,onStatisticExpression:new lte({expression:`$feature.${e} / $feature.${n}`,returnType:r}),statisticType:"avg"})):t.push(new pw({name:s,isAutoGenerated:!0,onStatisticField:e,statisticType:i}))),s}const uPe=t=>{let e=class extends t{constructor(...i){super(...i),this.addHandles(Fe(()=>this.renderer,()=>{if(this.featureReduction){const r=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",r)}},$r))}set featureReduction(i){const r=this._normalizeFeatureReduction(i);this._set("featureReduction",r)}set renderer(i){}_normalizeFeatureReduction(i){if(i?.type!=="cluster")return i;const r=i.clone(),n=[new pw({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],s=(r.fields??[]).filter(u=>!u.isAutoGenerated);if(i.renderer&&!i.renderer.authoringInfo?.isAutoGenerated)return r.fields=[...n,...s],r;if(i.symbol)return r.fields=[...n,...s],r.renderer=null,r;if(!this.renderer)return i;const a=_At(n,this.renderer,i,null,!1);return r.fields=[...n,...s],r.renderer=a,r}};return _([T(uAt)],e.prototype,"featureReduction",null),e=_([Z("esri.layers.mixins.FeatureReductionLayer")],e),e},Pfe={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},Ife={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},$fe={ArcGISFeatureLayer:!0},EAt={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":Pfe,"web-map/basemap":Ife,"web-map/tables":$fe,"link-chart/operational-layers":{...Pfe,LinkChartLayer:!0},"link-chart/basemap":Ife,"link-chart/tables":$fe,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISImageServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0}},hPe=t=>{let e=class extends t{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(i,r,n){return n?.portalItem?.type==="Group Layer"?void 0:i}writeListMode(i,r,n,s){(s&&s.layerContainerType==="ground"||i&&XIe(this,n,{},s))&&(r[n]=i)}writeOperationalLayerType(i,r,n,s){i&&s?.layerContainerType!=="tables"&&(r.layerType=i)}writeTitle(i,r){r.title=i??"Layer"}read(i,r){r&&(r.layer=this),lme(this,i,n=>super.read(i,n),r)}write(i,r){if(!this.persistenceEnabled)return null;if(r?.origin){const a=`${r.origin}/${r.layerContainerType||"operational-layers"}`;let p=!!EAt[a]?.[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&a==="web-scene/operational-layers"&&(p=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&a==="web-map/operational-layers"&&(p=!1),!p)return r.messages?.push(new de("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${a}'`,{layer:this})),null}const n=super.write(i,{...r,layer:this}),s=!!r&&!!r.messages&&!!r.messages.filter(a=>a instanceof de&&a.name==="web-document-write:property-required").length;return sS(n?.url)?(r?.messages?.push(new de("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&s?null:n}beforeSave(){}};return _([T({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),_([rt("id",["id"])],e.prototype,"readId",null),_([T(WMe)],e.prototype,"listMode",void 0),_([ot("listMode")],e.prototype,"writeListMode",null),_([T({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:xl}}}}})],e.prototype,"operationalLayerType",void 0),_([ot("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),_([T(DX)],e.prototype,"opacity",void 0),_([T({type:Boolean,readOnly:!1})],e.prototype,"persistenceEnabled",void 0),_([T({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),_([ot("title"),ot(["web-scene"],"title")],e.prototype,"writeTitle",null),_([T({type:Boolean,json:{origins:{"web-scene":{name:"visibility",write:{enabled:!0,layerContainerTypes:xl}}},name:"visibility",write:!0}})],e.prototype,"visible",void 0),e=_([Z("esri.layers.mixins.OperationalLayer")],e),e};var WX;const sj=new br({asc:"ascending",desc:"descending"});let nT=WX=class extends Ne{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new WX({field:this.field,valueExpression:this.valueExpression,order:this.order})}};_([T({type:String,json:{write:!0}})],nT.prototype,"field",void 0),_([T({type:String,json:{write:!0}})],nT.prototype,"valueExpression",void 0),_([T({type:sj.apiValues,json:{read:sj.read,write:sj.write}})],nT.prototype,"order",void 0),nT=WX=_([Z("esri.layers.support.OrderByInfo")],nT);const dPe=nT;function CAt(t,e,i){if(!t)return null;const r=t.find(s=>!!s.field);if(!r)return null;const n=new dPe;return n.read(r,i),[n]}function AAt(t,e,i,r){const n=t.find(s=>!!s.field);n&&bl(i,[n.toJSON()],e)}const OAt=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return _([T({type:[dPe],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:CAt},write:{target:"layerDefinition.orderBy",writer:AAt}}})],e.prototype,"orderBy",void 0),e=_([Z("esri.layers.mixins.OrderedLayer")],e),e},pPe=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=ct(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,n){if(r.itemId)return new p2({id:r.itemId,portal:n?.portal})}writePortalItem(i,r){i?.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem?.id)try{const{load:n}=await ke(()=>import("./layersLoader-bc86531e.js"),["./layersLoader-bc86531e.js","./fetchService-af1bc981.js","./requestPresets-5652178e.js","./portalLayers-7555fcdb.js","./associatedFeatureServiceUtils-c90a3355.js","./layersCreator-38f71b2f.js","./jsonContext-ecb82249.js"],import.meta.url);return oi(r),await n({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData,layerModuleTypeMap:i.layerModuleTypeMap},r)}catch(n){throw qn(n)||Ee.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${n}`),n}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>($a(r),!0)))}async setUserPrivileges(i,r){if(!vr.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(r);if(this.url)try{const{features:{edit:n,fullEdit:s},content:{updateItem:a}}=await this._fetchUserPrivileges(i,r);this._set("userHasEditingPrivileges",n),this._set("userHasFullEditingPrivileges",s),this._set("userHasUpdateItemPrivileges",a)}catch(n){$a(n)}}async _fetchUserPrivileges(i,r){let n=this.portalItem;if(!i||!n||!n.loaded||n.sourceUrl)return this._fetchFallbackUserPrivileges(r);const s=i===n.id;if(s&&n.portal.user)return kie(n);let a,u;if(s)a=n.portal.url;else try{a=await ege(this.url,r)}catch(S){$a(S)}if(!a||!h$e(a,n.portal.url))return this._fetchFallbackUserPrivileges(r);try{const S=r!=null?r.signal:null;u=await Ii?.getCredential(`${a}/sharing`,{prompt:!1,signal:S})}catch(S){$a(S)}const p=!0,y=!1,b=!1;if(!u)return{features:{edit:p,fullEdit:y},content:{updateItem:b}};try{if(s?await n.reload():(n=new p2({id:i,portal:{url:a}}),await n.load(r)),n.portal.user)return kie(n)}catch(S){$a(S)}return{features:{edit:p,fullEdit:y},content:{updateItem:b}}}async _fetchFallbackUserPrivileges(i){let r=!0;try{r=await this._fetchUserHasEditingPrivileges(i)}catch(n){$a(n)}return{features:{edit:r,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(i){const r=this.url?Ii?.findCredential(this.url):null;if(!r)return!0;const n=eI.credential===r?eI.user:await this._fetchEditingUser(i);return eI.credential=r,eI.user=n,n?.privileges==null||n.privileges.includes("features:user:edit")}async _fetchEditingUser(i){const r=this.portalItem?.portal?.user;if(r)return r;const n=Ii.findServerInfo(this.url??"");if(!n?.owningSystemUrl)return null;const s=`${n.owningSystemUrl}/sharing/rest`,a=Zs.getDefault();if(a&&a.loaded&&Uu(a.restUrl)===Uu(s))return a.user;const u=`${s}/community/self`,p=i!=null?i.signal:null,y=await Gc(ir(u,{authMode:"no-prompt",query:{f:"json"},signal:p}));return y.ok?GJ.fromJSON(y.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const n=r?.portal,s=this.portalItem?.id&&(this.portalItem.portal||Zs.getDefault());return n&&s&&!gme(s.restUrl,n.restUrl)?(r.messages&&r.messages.push(new de("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,{...r,layer:this})}};return _([T({type:p2})],e.prototype,"portalItem",null),_([rt("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),_([ot("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),_([T({clonable:!1})],e.prototype,"resourceReferences",void 0),_([T({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),_([T({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),_([T({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=_([Z("esri.layers.mixins.PortalLayer")],e),e},eI={credential:null,user:null};let wA=class extends Ke{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};_([T()],wA.prototype,"updating",void 0),_([T()],wA.prototype,"status",void 0),wA=_([Z("esri.layers.support.PublishingInfo")],wA);const RAt=wA,fPe="esri.layers.mixins.PublishableLayer",MAt=Symbol(fPe),PAt=t=>{var e;let i=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const r=this._get("publishingInfo");if(r)return r;const n=new RAt;return this._checkPublishingStatus(n),n}_checkPublishingStatus(r){let a=0;const u=async y=>{let b;r.updating=!0;try{b=await this.fetchPublishingStatus()}catch{b="unavailable"}b!=="published"&&b!=="unavailable"||(r.status==="publishing"&&this.refresh(),p.remove()),r.status=b,r.updating=!1,p.removed||(a=setTimeout(u,y,y+125))},p={removed:!1,remove(){this.removed=!0,clearTimeout(a)}};this.when().catch(()=>p.remove()),u(250),this.addHandles(p)}};return e=MAt,_([T({readOnly:!0,clonable:!1})],i.prototype,"publishingInfo",null),i=_([Z(fPe)],i),i},mPe=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&IAt(i,r.effectiveScaleRange);const n=this._get("effectiveScaleRange");return n&&n.minScale===i.minScale&&n.maxScale===i.maxScale?n:i}};return _([T({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),_([T({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),_([T({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=_([Z("esri.layers.mixins.ScaleRangeLayer")],e),e};function IAt(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}const gPe=Tl()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let xA=class extends sn(Ne){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return Qqe(this.value,this.unit,"milliseconds")}};_([Bt(gPe,{nonNullable:!0})],xA.prototype,"unit",void 0),_([T({type:Number,json:{write:!0},nonNullable:!0})],xA.prototype,"value",void 0),xA=_([Z("esri.TimeInterval")],xA);const lD=xA;function Lfe(t,e){return lD.fromJSON({value:t,unit:e})}let sl=class extends sn(Ne){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,i){if(!i.timeExtent||!Array.isArray(i.timeExtent)||i.timeExtent.length!==2)return null;const r=new Date(i.timeExtent[0]),n=new Date(i.timeExtent[1]);return new z0({start:r,end:n})}writeFullTimeExtent(e,i){e?.start!=null&&e.end!=null?i.timeExtent=[e.start.getTime(),e.end.getTime()]:i.timeExtent=null}readInterval(e,i){return i.timeInterval&&i.timeIntervalUnits?Lfe(i.timeInterval,i.timeIntervalUnits):i.defaultTimeInterval&&i.defaultTimeIntervalUnits?Lfe(i.defaultTimeInterval,i.defaultTimeIntervalUnits):null}writeInterval(e,i){i.timeInterval=e?.toJSON().value??null,i.timeIntervalUnits=e?.toJSON().unit??null}};_([T({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],sl.prototype,"cumulative",void 0),_([T({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],sl.prototype,"endField",void 0),_([T({type:z0,json:{write:{enabled:!0,allowNull:!0}}})],sl.prototype,"fullTimeExtent",void 0),_([rt("fullTimeExtent",["timeExtent"])],sl.prototype,"readFullTimeExtent",null),_([ot("fullTimeExtent")],sl.prototype,"writeFullTimeExtent",null),_([T({type:Boolean,json:{write:!0}})],sl.prototype,"hasLiveData",void 0),_([T({type:lD,json:{write:{enabled:!0,allowNull:!0}}})],sl.prototype,"interval",void 0),_([rt("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],sl.prototype,"readInterval",null),_([ot("interval")],sl.prototype,"writeInterval",null),_([T({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],sl.prototype,"startField",void 0),_([T(yL("timeReference",!0))],sl.prototype,"timeZone",void 0),_([T({type:String,json:{write:{enabled:!0,allowNull:!0}}})],sl.prototype,"trackIdField",void 0),_([T({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],sl.prototype,"useTime",void 0),sl=_([Z("esri.layers.support.TimeInfo")],sl);const yPe=sl,vPe=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const n=r.timeInfo.exportOptions;if(!n)return null;const s=n.timeOffset,a=gPe.fromJSON(n.timeOffsetUnits);return s&&a?new lD({value:s,unit:a}):null}set timeInfo(i){UY(i,this.fieldsIndex),this._set("timeInfo",i)}};return _([T({type:z0,json:{write:!1}})],e.prototype,"timeExtent",void 0),_([T({type:lD})],e.prototype,"timeOffset",void 0),_([rt("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),_([T({value:null,type:yPe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),_([T({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"useViewTime",void 0),e=_([Z("esri.layers.mixins.TemporalLayer")],e),e},Dfe=new br({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let dy=class extends sn(Ne){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};_([T({json:{write:!0}})],dy.prototype,"name",void 0),_([T({json:{write:!0}})],dy.prototype,"description",void 0),_([T({json:{read:Dfe.read,write:Dfe.write}})],dy.prototype,"drawingTool",void 0),_([T({json:{write:!0}})],dy.prototype,"prototype",void 0),_([T({json:{write:!0}})],dy.prototype,"thumbnail",void 0),dy=_([Z("esri.layers.support.FeatureTemplate")],dy);const cte=dy;let jm=class extends sn(Ne){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const i={};for(const r of Object.keys(e))i[r]=dN(e[r]);return i}writeDomains(e,i){const r={};for(const n of Object.keys(e))e[n]&&(r[n]=e[n]?.toJSON());i.domains=r}};_([T({json:{write:!0}})],jm.prototype,"id",void 0),_([T({json:{write:!0}})],jm.prototype,"name",void 0),_([T({json:{write:!0}})],jm.prototype,"domains",void 0),_([rt("domains")],jm.prototype,"readDomains",null),_([ot("domains")],jm.prototype,"writeDomains",null),_([T({type:[cte],json:{write:!0}})],jm.prototype,"templates",void 0),jm=_([Z("esri.layers.support.FeatureType")],jm);const _Pe=jm;function bPe(){return{fields:{type:[OR],value:null,set:function(t){if(t&&Me("big-integer-warning-enabled")){const e=t.filter(i=>i.type==="big-integer"||i.type==="oid"&&(i.length||0)>=8);if(e.length){const i=e.map(r=>`'${r.name}'`).join(", ");Ee.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${i}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",t)}},fieldsIndex:{readOnly:!0,get(){return vMe.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){const t=this._userOutFields;if(!t?.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const e of t)this.fieldsIndex?.has(e)||Ee.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${e} found in outFields`,{layer:this,outFields:t});return jY(this.fieldsIndex,t)}}}}const oj=Ee.getLogger("esri.layers.support.labelingInfo"),$At=/\[([^\[\]]+)\]/gi;function w6(t,e,i){return t?t.map(r=>{const n=new GR;if(n.read(r,i),n.labelExpression){const s=e.fields||e.layerDefinition?.fields||this.fields;n.labelExpression=n.labelExpression.replaceAll($At,(a,u)=>`[${LAt(u,s)}]`)}return n}):null}function LAt(t,e){if(!e)return t;const i=t.toLowerCase();for(let r=0;r<e.length;r++){const n=e[r].name;if(n.toLowerCase()===i)return n}return t}const DAt={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function fHt(t,e){const i=Ce(t);return i.some(r=>NAt(r,e))?[]:i}function NAt(t,e){const i=t.labelPlacement,r=DAt[e];if(!t.symbol)return oj.warn("No ILabelClass symbol specified."),!0;if(!r)return oj.error(new de("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),!0;if(!r.includes(i)){const n=r[0];i&&oj.warn(`Found invalid label placement type ${i} for ${e}. Defaulting to ${n}`),t.labelPlacement=n}return!1}const Bm=[];function FAt(t,e){if(J1e(t.url??""))return!0;const{wkid:i}=e;for(const r of Bm){if((t.version??0)>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}Bm.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=23301;e<=23333;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102934;e<=102955;e++)t.add(e);return t}]),Bm.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),Bm.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),Bm.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),Bm.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]),Bm.push([10.7,()=>{const t=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let e=8065;e<=8068;e++)t.add(e);for(let e=8082;e<=8083;e++)t.add(e);for(let e=8379;e<=8385;e++)t.add(e);for(let e=8836;e<=8840;e++)t.add(e);for(let e=8857;e<=8860;e++)t.add(e);for(let e=53035;e<=53037;e++)t.add(e);for(let e=54090;e<=54091;e++)t.add(e);for(let e=102498;e<=102499;e++)t.add(e);return t}]),Bm.push([10.61,()=>new Set([102497])]),Bm.push([10.6,()=>{const t=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let e=7755;e<=7787;e++)t.add(e);for(let e=7791;e<=7795;e++)t.add(e);for(let e=7799;e<=7801;e++)t.add(e);for(let e=7825;e<=7831;e++)t.add(e);for(let e=7877;e<=7878;e++)t.add(e);for(let e=7882;e<=7883;e++)t.add(e);for(let e=7991;e<=7992;e++)t.add(e);for(let e=8042;e<=8043;e++)t.add(e);for(let e=8058;e<=8059;e++)t.add(e);for(let e=8311;e<=8348;e++)t.add(e);for(let e=9060;e<=9067;e++)t.add(e);for(let e=102562;e<=102568;e++)t.add(e);for(let e=102799;e<=102900;e++)t.add(e);return t}]);async function wPe(t,e,i){const r=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const n=await Gc(r.populateFromStyle());if(oi(i),n.ok===!1){const s=n.error;e?.messages&&e.messages.push(new T0("renderer:style-reference",`Failed to create unique value renderer from style reference: ${s.message}`,{error:s,context:e})),t.clear("renderer",e?.origin)}}}var XX;let sT=XX=class extends Ne{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new XX({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};_([T({type:[String],json:{write:!0}})],sT.prototype,"groupByFields",void 0),_([T({type:Number,json:{write:!0}})],sT.prototype,"topCount",void 0),_([T({type:[String],json:{write:!0}})],sT.prototype,"orderByFields",void 0),sT=XX=_([Z("esri.rest.support.TopFilter")],sT);const kAt=sT;var JX;const Nfe=new br({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Ffe=new br({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Zn=JX=class extends Ne{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new JX(Ce({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};_([T({type:Boolean,json:{write:!0}})],Zn.prototype,"cacheHint",void 0),_([T({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],Zn.prototype,"distance",void 0),_([T({types:_w,json:{read:E0,write:!0}})],Zn.prototype,"geometry",void 0),_([T({type:Number,json:{write:!0}})],Zn.prototype,"geometryPrecision",void 0),_([T({type:Number,json:{write:!0}})],Zn.prototype,"maxAllowableOffset",void 0),_([T({type:Number,json:{read:{source:"resultRecordCount"}}})],Zn.prototype,"num",void 0),_([T({json:{write:!0}})],Zn.prototype,"objectIds",void 0),_([T({type:[String],json:{write:!0}})],Zn.prototype,"orderByFields",void 0),_([T({type:[String],json:{write:!0}})],Zn.prototype,"outFields",void 0),_([T({type:dt,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Zn.prototype,"outSpatialReference",void 0),_([T({type:String,json:{write:!0}})],Zn.prototype,"resultType",void 0),_([T({json:{write:!0}})],Zn.prototype,"returnGeometry",void 0),_([T({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Zn.prototype,"returnM",void 0),_([T({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Zn.prototype,"returnZ",void 0),_([T({type:Number,json:{read:{source:"resultOffset"}}})],Zn.prototype,"start",void 0),_([ot("start"),ot("num")],Zn.prototype,"writeStart",null),_([T({type:String,json:{read:{source:"spatialRel",reader:Nfe.read},write:{target:"spatialRel",writer:Nfe.write}}})],Zn.prototype,"spatialRelationship",void 0),_([T({type:z0,json:{write:!0}})],Zn.prototype,"timeExtent",void 0),_([T({type:kAt,json:{write:!0}})],Zn.prototype,"topFilter",void 0),_([T({type:String,json:{read:Ffe.read,write:{writer:Ffe.write,overridePolicy(t){return{enabled:t!=null&&this.distance!=null&&this.distance>0}}}}})],Zn.prototype,"units",void 0),_([T({type:String,json:{write:!0}})],Zn.prototype,"where",void 0),Zn=JX=_([Z("esri.rest.support.TopFeaturesQuery")],Zn),Zn.from=os(Zn);const tI=Zn;function xPe({displayField:t,editFieldsInfo:e,fields:i,objectIdField:r,title:n},s){if(!i)return null;const a=BAt({editFieldsInfo:e,fields:i,objectIdField:r},s);if(!a.length)return null;const u=HAt({titleBase:n,fields:i,displayField:t}),p=GAt();return new mE({title:u,content:p,fieldInfos:a})}const zAt=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):Vze(t,e);function UAt(t,e){const i=t;return e&&(t=t.filter(r=>!e.includes(r.type))),t===i&&(t=t.slice()),t.sort(jAt),t}function jAt(t,e){return t.type==="oid"?-1:e.type==="oid"?1:kfe(t)?-1:kfe(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function BAt(t,e){const i=e?.visibleFieldNames;return UAt(t.fields??[],e?.ignoreFieldTypes||qAt).map(r=>new GY({fieldName:r.name,isEditable:Bze(r,t),label:r.alias,format:VAt(r),visible:zAt(r,{...t,visibleFieldNames:i})}))}function VAt(t){switch(t.type){case"small-integer":case"integer":case"single":return new LI({digitSeparator:!0,places:0});case"double":return new LI({digitSeparator:!0,places:2});case"string":return pUe(t.name)?new LI({digitSeparator:!0,places:0}):null;default:return null}}function GAt(){return[new q4,new H4]}function HAt(t){const e=Ize(t),{titleBase:i}=t;return e?`${i}: {${e.trim()}}`:i??""}function kfe(t){return(t.name&&t.name.toLowerCase())==="name"?!0:(t.alias&&t.alias.toLowerCase())==="name"}const qAt=["geometry","blob","raster","guid","xml"],$l="FeatureLayer",TPe="esri.layers.FeatureLayer",WAt=Ee.getLogger(TPe);function iI(t,e){return new de("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function zfe(t){return t&&t instanceof Dt}const aj=bPe();function lj(t,e,i){const r=!!i?.writeLayerSchema;return{enabled:r,ignoreOrigin:r}}let Yt=class extends eAt(uPe(zMe(PAt(QCt(LMe(OAt(vPe(mPe(AAe($Me(hPe(pPe(qD(DMe(WCt(sn(HD))))))))))))))))){constructor(...t){super(...t),this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.resourceInfo=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=dt.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0,this._debouncedSaveOperations=oE(async(e,i,r)=>{const{save:n,saveAs:s}=await ke(()=>import("./featureLayerUtils-b857983f.js"),["./featureLayerUtils-b857983f.js","./utils-a4281b92.js","./jsonContext-ecb82249.js","./fetchService-af1bc981.js","./requestPresets-5652178e.js"],import.meta.url);switch(e){case Nc.SAVE:return n(this,i);case Nc.SAVE_AS:return s(this,r,i)}})}destroy(){this.source?.destroy()}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}load(t){const e=t!=null?t.signal:null;if(this.portalItem?.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(e).then(r=>this.initLayerProperties(r))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},t).catch($a).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const r=await this._fetchFirstValidLayerId(e);r!=null&&(this.layerId=r)}if(!this.url&&!this._hasMemorySource())throw new de("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(e))}).then(()=>D5t(this,"load",t));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(t,e){return e=e.layerDefinition||e,KMe(e,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities?.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}readEditingEnabled(t,e){return this._readEditingEnabled(e,!1)}readEditingEnabledFromWebMap(t,e,i){return this._readEditingEnabled(e,!0,i)}writeEditingEnabled(t,e){this._writeEditingEnabled(t,e,!1)}writeEditingEnabledToWebMap(t,e,i,r){this._writeEditingEnabled(t,e,!0,r)}get effectiveEditingEnabled(){return N5t(this)}readIsTable(t,e){return(e=e?.layerDefinition??e).type==="Table"||!e.geometryType}writeIsTable(t,e,i,r){r?.writeLayerSchema&&bl(i,t?"Table":"Feature Layer",e)}readGlobalIdField(t,e){return JMe(e.layerDefinition||e)}readObjectIdField(t,e){return YMe(e.layerDefinition||e)}get parsedUrl(){const t=Nn(this.url);return t!=null&&(this.dynamicDataSource!=null?t.path=Kh(t.path,"dynamicLayer"):this.layerId!=null&&(t.path=Kh(t.path,this.layerId.toString()))),t}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(t){vL(t,this.fieldsIndex),this._set("renderer",t)}readRenderer(t,e,i){e=e.layerDefinition||e;const r=e.drawingInfo?.renderer;if(r){const n=iE(r,e,i)??void 0;return n||WAt.error("Failed to create renderer",{rendererDefinition:e.drawingInfo.renderer,layer:this,context:i}),n}return qN(e,i)}set source(t){const e=this._get("source");e!==t&&(zfe(e)&&this._resetMemorySource(e),zfe(t)&&this._initMemorySource(t),this._set("source",t))}castSource(t){return t?Array.isArray(t)||t instanceof Dt?new Xm({layer:this,items:t}):t:null}readSource(t,e){const i=nte.fromJSON(e.featureSet);return new Xm({layer:this,items:i?.features??[]})}readTemplates(t,e){const i=e.editFieldsInfo,r=i?.creatorField,n=i?.editorField;return t=t?.map(s=>cte.fromJSON(s)),this._fixTemplates(t,r),this._fixTemplates(t,n),t}readTitle(t,e){const i=e.layerDefinition?.name??e.name,r=e.title||e.layerDefinition?.title;if(i){const n=this.portalItem?.title;if(this.sublayerTitleMode==="item-title")return this.url?F7e(this.url,i):i;let s=i;if(!s&&this.url){const a=uE(this.url);a!=null&&(s=a.title)}return s?(this.sublayerTitleMode==="item-title-and-service-name"&&n&&n!==s&&(s=n+" - "+s),SY(s)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(t,e){return e.title||e.layerDefinition?.name}readTypeIdField(t,e){let i=(e=e.layerDefinition||e).typeIdField;if(i&&e.fields){i=i.toLowerCase();const r=e.fields.find(n=>n.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(t,e){t=(e=e.layerDefinition||e).types;const i=e.editFieldsInfo,r=i?.creatorField,n=i?.editorField;return t?.map(s=>(s=_Pe.fromJSON(s),this._fixTemplates(s.templates,r),this._fixTemplates(s.templates,n),s))}readVisible(t,e){return e.layerDefinition?.defaultVisibility!=null?!!e.layerDefinition.defaultVisibility:e.visibility!=null?!!e.visibility:void 0}async addAttachment(t,e){return _5t(this,t,e,$l)}async updateAttachment(t,e,i){return b5t(this,t,e,i,$l)}async applyEdits(t,e){return w5t(this,t,e)}async uploadAssets(t,e){return x5t(this,t,e)}on(t,e){return super.on(t,e)}createPopupTemplate(t){return xPe(this,t)}async createGraphicsSource(t){if(this._hasMemorySource()&&this.source)return this.source.load({signal:t});const{default:e}=await R0e(ke(()=>import("./FeatureLayerSource-b181aa45.js"),["./FeatureLayerSource-b181aa45.js","./External-27723e17.js","./editingSupport-6cb765eb.js","./QueryTask-82d13375.js","./executeForIds-2fabdd1f.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js","./executeQueryJSON-b46d6877.js","./executeQueryPBF-226ff4ca.js"],import.meta.url),t);return new e({layer:this}).load({signal:t})}createQuery(){const t=I5t(this);t.dynamicDataSource=this.dynamicDataSource;const e=this.subtypeCode!=null?`${this.subtypeField} = ${this.subtypeCode}`:null,i=KNe(this.definitionExpression,e);return t.where=i||"1=1",t}async deleteAttachments(t,e){return T5t(this,t,e,$l)}async fetchRecomputedExtents(t){return S5t(this,t,$l)}getFeatureType(t){const{typeIdField:e,types:i}=this;if(!e||!t)return null;const r=t.attributes?t.attributes[e]:void 0;if(r==null)return null;let n=null;return i?.some(s=>{const{id:a}=s;return a!=null&&(a.toString()===r.toString()&&(n=s),!!n)}),n}getFieldDomain(t,e){const i=e?.feature,r=this.getFeatureType(i);if(r){const n=r.domains&&r.domains[t];if(n&&n.type!=="inherited")return n}return this._getLayerDomain(t)}getField(t){return this.fieldsIndex.get(t)}async queryAttachments(t,e){return E5t(this,t,e,$l)}async queryFeatures(t,e){const i=await this.load(),r=await i.source.queryFeatures(qh.from(t)??i.createQuery(),e);if(r?.features)for(const n of r.features)n.layer=n.sourceLayer=i;return r}async queryObjectIds(t,e){return C5t(this,t,e,$l)}async queryFeatureCount(t,e){return A5t(this,t,e,$l)}async queryExtent(t,e){return O5t(this,t,e,$l)}async queryRelatedFeatures(t,e){return R5t(this,t,e,$l)}async queryRelatedFeaturesCount(t,e){return M5t(this,t,e,$l)}async queryTopFeatures(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopFeatures||!r?.query?.supportsTopFeaturesQuery)throw new de($l,"Layer source does not support queryTopFeatures capability");const n=await i.queryTopFeatures(tI.from(t),e);if(n?.features)for(const s of n.features)s.layer=s.sourceLayer=this;return n}async queryTopObjectIds(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopObjectIds||!r?.query.supportsTopFeaturesQuery)throw new de($l,"Layer source does not support queryTopObjectIds capability");return i.queryTopObjectIds(tI.from(t),e)}async queryTopFeaturesExtent(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopExtents||!r?.query?.supportsTopFeaturesQuery)throw new de($l,"Layer source does not support queryTopExtents capability");return i.queryTopExtents(tI.from(t),e)}async queryTopFeatureCount(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopCount||!r?.query?.supportsTopFeaturesQuery)throw new de($l,"Layer source does not support queryFeatureCount capability");return i.queryTopCount(tI.from(t),e)}read(t,e){const i=t.featureCollection;if(i){this.resourceInfo=t;const r=i.layers;r&&r.length===1&&(super.read(r[0],e),i.showLegend!=null&&super.read({showLegend:i.showLegend},e))}super.read(t,e),e&&e.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo","dateFieldsTimeZone"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(t,e){e={...e,origin:e?.origin??void 0,writeLayerSchema:e?.writeLayerSchema??this._hasMemorySource()};const{origin:i,layerContainerType:r,messages:n}=e;if(this.dynamicDataSource)return n?.push(iI(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if((i==="web-map"||i==="web-scene")&&r!=="tables")return n?.push(iI(this,`a table source can only be written to tables, not ${r}`)),null;if(this._hasMemorySource())return n?.push(iI(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&(i==="web-map"||i==="web-scene")&&r==="tables")return n?.push(iI(this,"using a non-table source cannot be written to tables in web maps or web scenes")),null;return super.write(t,e)}clone(){if(this._hasMemorySource())throw new de($l,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(t){return!!this.loaded&&(this.source?.type==="memory"||FAt(this,t))}async save(t){return this._debouncedSaveOperations(Nc.SAVE,t)}async saveAs(t,e){return this._debouncedSaveOperations(Nc.SAVE_AS,e,t)}_readEditingEnabled(t,e,i){let r=t.layerDefinition?.capabilities;return r?this._hasEditingCapability(r):(r=t.capabilities,e&&i?.origin==="web-map"&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(t){return t.toLowerCase().split(",").map(e=>e.trim()).includes("editing")}_writeEditingEnabled(t,e,i,r){if(!t){const n=this.capabilities?.operations?.supportsSync?"Query,Sync":"Query";bl("layerDefinition.capabilities",n,e),i&&!r?.writeLayerSchema&&(e.capabilities=n)}}_getLayerDomain(t){const e=this.fieldsIndex.get(t);return e?e.domain:null}_fetchFirstValidLayerId(t){return ir(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:t}).then(e=>{const i=e.data;if(i)return this.findFirstValidLayerId(i)})}async initLayerProperties(t){return this._set("source",t),t.sourceJSON&&(this.sourceJSON=t.sourceJSON,this.read(t.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),vL(this.renderer,this.fieldsIndex),UY(this.timeInfo,this.fieldsIndex),wPe(this,{origin:"service"})}async hasDataChanged(){return P5t(this)}async fetchPublishingStatus(){const t=this.source;return t?.fetchPublishingStatus?t.fetchPublishingStatus():"unavailable"}_verifyFields(){const t=this.parsedUrl?.path??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+t+")"),this.isTable||this._hasMemorySource()||t.search(/\/FeatureServer\//i)!==-1||this.fields?.some(e=>e.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+t+")")}_fixTemplates(t,e){t&&t.forEach(i=>{const r=i.prototype?.attributes;r&&e&&delete r[e]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new de("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new de("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(t){t.forEach(e=>{e.layer=this,e.sourceLayer=this}),this.addHandles([t.on("after-add",e=>{e.item.layer=this,e.item.sourceLayer=this}),t.on("after-remove",e=>{e.item.layer=null,e.item.sourceLayer=null})],"fl-source")}_resetMemorySource(t){t.forEach(e=>{e.layer=null,e.sourceLayer=null}),this.removeHandles("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}findFirstValidLayerId(t){return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}};_([rt("service","capabilities")],Yt.prototype,"readCapabilities",null),_([T({json:{origins:{"web-scene":{write:!1}},write:!0}})],Yt.prototype,"charts",void 0),_([T({readOnly:!0})],Yt.prototype,"createQueryVersion",null),_([T({json:{read:{source:"layerDefinition.copyrightText"}}})],Yt.prototype,"copyright",void 0),_([T({json:{read:{source:"layerDefinition.displayField"}}})],Yt.prototype,"displayField",void 0),_([T({types:b2,readOnly:!0})],Yt.prototype,"defaultSymbol",void 0),_([T({type:lp})],Yt.prototype,"dynamicDataSource",void 0),_([T({type:Boolean})],Yt.prototype,"editingEnabled",null),_([rt(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Yt.prototype,"readEditingEnabled",null),_([rt("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Yt.prototype,"readEditingEnabledFromWebMap",null),_([ot(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Yt.prototype,"writeEditingEnabled",null),_([ot("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Yt.prototype,"writeEditingEnabledToWebMap",null),_([T({readOnly:!0})],Yt.prototype,"effectiveEditingEnabled",null),_([T({...aj.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:lj}}}}})],Yt.prototype,"fields",void 0),_([T(aj.fieldsIndex)],Yt.prototype,"fieldsIndex",void 0),_([T({type:BCt,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Yt.prototype,"formTemplate",void 0),_([T({json:{read:{source:"layerDefinition.extent"}}})],Yt.prototype,"fullExtent",void 0),_([T({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:lj,writer(t,e,i){const r=t?kX.toJSON(t):null;r&&bl(i,r,e)}}}},read:{source:"layerDefinition.geometryType",reader:kX.read}}})],Yt.prototype,"geometryType",void 0),_([T({json:{read:{source:"layerDefinition.hasM"}}})],Yt.prototype,"hasM",void 0),_([T({json:{read:{source:"layerDefinition.hasZ"}}})],Yt.prototype,"hasZ",void 0),_([T(p5t)],Yt.prototype,"id",void 0),_([T({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Yt.prototype,"infoFor3D",void 0),_([T({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Yt.prototype,"isTable",void 0),_([rt("service","isTable",["type","geometryType"]),rt("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Yt.prototype,"readIsTable",null),_([ot("web-map","isTable")],Yt.prototype,"writeIsTable",null),_([T(HN)],Yt.prototype,"labelsVisible",void 0),_([T({type:[GR],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:w6,write:!1},"web-scene":{name:"layerDefinition.drawingInfo.labelingInfo",read:w6,write:{enabled:!0,layerContainerTypes:xl}}},name:"layerDefinition.drawingInfo.labelingInfo",read:w6,write:!0}})],Yt.prototype,"labelingInfo",void 0),_([T((()=>{const t=Ce(d5t);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,i,r){bl(r,XO(e),i)}}},t})())],Yt.prototype,"opacity",void 0),_([T(VMe)],Yt.prototype,"legendEnabled",void 0),_([T({type:["show","hide"],json:(()=>{const t=Ce(WMe.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],Yt.prototype,"listMode",void 0),_([rt("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],Yt.prototype,"readGlobalIdField",null),_([T({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:lj}}}}})],Yt.prototype,"objectIdField",void 0),_([rt("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],Yt.prototype,"readObjectIdField",null),_([T({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Yt.prototype,"operationalLayerType",void 0),_([T(aj.outFields)],Yt.prototype,"outFields",void 0),_([T({readOnly:!0})],Yt.prototype,"parsedUrl",null),_([T({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Yt.prototype,"path",void 0),_([T(GN)],Yt.prototype,"popupEnabled",void 0),_([T({type:mE,json:{name:"popupInfo",write:!0}})],Yt.prototype,"popupTemplate",void 0),_([T({readOnly:!0})],Yt.prototype,"defaultPopupTemplate",null),_([T({types:BR,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:AMe,name:"layerDefinition.drawingInfo.renderer",write:{layerContainerTypes:xl,overridePolicy:(t,e,i)=>({ignoreOrigin:i?.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,i)=>({ignoreOrigin:i?.writeLayerSchema})}}})],Yt.prototype,"renderer",null),_([rt("service","renderer",["drawingInfo.renderer","defaultSymbol"]),rt("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Yt.prototype,"readRenderer",null),_([T()],Yt.prototype,"resourceInfo",void 0),_([T((()=>{const t=Ce(jMe);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],Yt.prototype,"screenSizePerspectiveEnabled",void 0),_([T({clonable:!1})],Yt.prototype,"source",null),_([Fi("source")],Yt.prototype,"castSource",null),_([rt("portal-item","source",["featureSet"]),rt("web-map","source",["featureSet"])],Yt.prototype,"readSource",null),_([T({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],Yt.prototype,"spatialReference",void 0),_([T({type:Number})],Yt.prototype,"subtypeCode",void 0),_([T({type:[cte]})],Yt.prototype,"templates",void 0),_([rt("templates",["editFieldsInfo","creatorField","editorField","templates"])],Yt.prototype,"readTemplates",null),_([T({type:yPe})],Yt.prototype,"timeInfo",void 0),_([T()],Yt.prototype,"title",void 0),_([rt("service","title",["name"]),rt("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Yt.prototype,"readTitle",null),_([rt("web-map","title",["layerDefinition.name","title"])],Yt.prototype,"readTitleFromWebMap",null),_([T({type:String})],Yt.prototype,"sublayerTitleMode",void 0),_([T({json:{read:!1}})],Yt.prototype,"type",void 0),_([T({type:String})],Yt.prototype,"typeIdField",void 0),_([rt("service","typeIdField"),rt("typeIdField",["layerDefinition.typeIdField"])],Yt.prototype,"readTypeIdField",null),_([T({type:[_Pe]})],Yt.prototype,"types",void 0),_([rt("service","types",["types"]),rt("types",["layerDefinition.types"])],Yt.prototype,"readTypes",null),_([T({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Yt.prototype,"visible",void 0),_([rt("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Yt.prototype,"readVisible",null),Yt=_([Z(TPe)],Yt);const ute=Yt,mHt=Object.freeze(Object.defineProperty({__proto__:null,default:ute},Symbol.toStringTag,{value:"Module"}));let Zf=class extends Ip{constructor(e){super(e),this.type="csv",this.refresh=oE(async i=>{await this.load();const{extent:r,timeExtent:n}=await this._connection.invoke("refresh",i);return r&&(this.sourceJSON.extent=r),n&&(this.sourceJSON.timeInfo.timeExtent=[n.start,n.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}})}load(e){const i=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(i)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}async openPorts(){return await this.load(),this._connection.openPorts()}async queryFeatures(e,i={}){await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);return nte.fromJSON(r)}async queryFeaturesJSON(e,i={}){return await this.load(i),this._connection.invoke("queryFeatures",e?e.toJSON():null,i)}async queryFeatureCount(e,i={}){return await this.load(i),this._connection.invoke("queryFeatureCount",e?e.toJSON():null,i)}async queryObjectIds(e,i={}){return await this.load(i),this._connection.invoke("queryObjectIds",e?e.toJSON():null,i)}async queryExtent(e,i={}){await this.load(i);const r=await this._connection.invoke("queryExtent",e?e.toJSON():null,i);return{count:r.count,extent:rr.fromJSON(r.extent)}}async querySnapping(e,i={}){return await this.load(i),this._connection.invoke("querySnapping",e,i)}async _startWorker(e){this._connection=await oZ("CSVSourceWorker",{strategy:Me("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{url:i,delimiter:r,fields:n,latitudeField:s,longitudeField:a,spatialReference:u,timeInfo:p}=this.loadOptions,y=await this._connection.invoke("load",{url:i,customParameters:this.customParameters,parsingOptions:{delimiter:r,fields:n?.map(b=>b.toJSON()),latitudeField:s,longitudeField:a,spatialReference:u?.toJSON(),timeInfo:p?.toJSON()}},{signal:e});this.locationInfo=y.locationInfo,this.sourceJSON=y.layerDefinition,this.delimiter=y.delimiter}};_([T()],Zf.prototype,"type",void 0),_([T()],Zf.prototype,"loadOptions",void 0),_([T()],Zf.prototype,"customParameters",void 0),_([T()],Zf.prototype,"locationInfo",void 0),_([T()],Zf.prototype,"sourceJSON",void 0),_([T()],Zf.prototype,"delimiter",void 0),Zf=_([Z("esri.layers.graphics.sources.CSVSource")],Zf);const XAt={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0};function yHt(t){return{renderer:{type:"simple",symbol:t==="esriGeometryPoint"||t==="esriGeometryMultipoint"?tPe:t==="esriGeometryPolyline"?iPe:rPe}}}const JAt=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let YAt=1;function vHt(t,e){if(Me("esri-csp-restrictions"))return()=>({[e]:null,...t});try{let i=`this.${e} = null;`;for(const n in t)i+=`this${JAt.test(n)?`.${n}`:`["${n}"]`} = ${JSON.stringify(t[n])};`;const r=new Function(`
      return class AttributesClass$${YAt++} {
        constructor() {
          ${i};
        }
      }
    `)();return()=>new r}catch{return()=>({[e]:null,...t})}}function _Ht(t={}){return[{name:"New Feature",description:"",prototype:{attributes:Ce(t)}}]}function ZAt(t,e){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:t},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:e,supportsDelete:e,supportsEditing:e,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:e,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:XAt,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:e,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}function Ufe(t,e){throw new de(e,`CSVLayer (title: ${t.title}, id: ${t.id}) cannot be saved to a portal item`)}let jo=class extends ute{constructor(...t){super(...t),this.geometryType="point",this.capabilities=ZAt(!1,!1),this.delimiter=null,this.editingEnabled=!1,this.fields=null,this.latitudeField=null,this.locationType="coordinates",this.longitudeField=null,this.operationalLayerType="CSV",this.outFields=["*"],this.path=null,this.spatialReference=dt.WGS84,this.source=null,this.type="csv"}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}load(t){const e=t!=null?t.signal:null,i=this.loadFromPortal({supportedTypes:["CSV"],supportsData:!1},t).catch($a).then(async()=>this.initLayerProperties(await this.createGraphicsSource(e)));return this.addResolvingPromise(i),Promise.resolve(this)}get isTable(){return this.loaded&&this.geometryType==null}readWebMapLabelsVisible(t,e){return e.showLabels!=null?e.showLabels:!!e.layerDefinition?.drawingInfo?.labelingInfo}set url(t){if(!t)return void this._set("url",t);const e=Nn(t);this._set("url",e.path),e.query&&(this.customParameters={...this.customParameters,...e.query})}async createGraphicsSource(t){const e=new Zf({loadOptions:{delimiter:this.delimiter,fields:this.fields,latitudeField:this.latitudeField??void 0,longitudeField:this.longitudeField??void 0,spatialReference:this.spatialReference??void 0,timeInfo:this.timeInfo??void 0,url:this.url},customParameters:this.customParameters??void 0});return this._set("source",e),await e.load({signal:t}),this.read({locationInfo:e.locationInfo,columnDelimiter:e.delimiter},{origin:"service",url:this.parsedUrl}),e}queryFeatures(t,e){return this.load().then(()=>this.source.queryFeatures(qh.from(t)||this.createQuery())).then(i=>{if(i?.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i})}queryObjectIds(t,e){return this.load().then(()=>this.source.queryObjectIds(qh.from(t)||this.createQuery()))}queryFeatureCount(t,e){return this.load().then(()=>this.source.queryFeatureCount(qh.from(t)||this.createQuery()))}queryExtent(t,e){return this.load().then(()=>this.source.queryExtent(qh.from(t)||this.createQuery()))}read(t,e){super.read(t,e),e&&e.origin==="service"&&this.revert(["latitudeField","longitudeField"],"service")}write(t,e){return super.write(t,{...e,writeLayerSchema:!0})}clone(){throw new de("csv-layer:clone",`CSVLayer (title: ${this.title}, id: ${this.id}) cannot be cloned`)}async save(t){return Ufe(this,"csv-layer:save")}async saveAs(t,e){return Ufe(this,"csv-layer:save-as")}async hasDataChanged(){try{const{dataChanged:t,updates:e}=await this.source.refresh(this.customParameters);return e!=null&&this.read(e,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),t}catch{}return!1}_verifyFields(){}_verifySource(){}_hasMemorySource(){return!1}};_([T({readOnly:!0,json:{read:!1,write:!1}})],jo.prototype,"capabilities",void 0),_([T({type:[","," ",";","|","	"],json:{read:{source:"columnDelimiter"},write:{target:"columnDelimiter",ignoreOrigin:!0}}})],jo.prototype,"delimiter",void 0),_([T({readOnly:!0,type:Boolean,json:{origins:{"web-scene":{read:!1,write:!1}}}})],jo.prototype,"editingEnabled",void 0),_([T({json:{read:{source:"layerDefinition.fields"},write:{target:"layerDefinition.fields"}}})],jo.prototype,"fields",void 0),_([T({type:Boolean,readOnly:!0})],jo.prototype,"isTable",null),_([rt("web-map","labelsVisible",["layerDefinition.drawingInfo.labelingInfo","showLabels"])],jo.prototype,"readWebMapLabelsVisible",null),_([T({type:String,json:{read:{source:"locationInfo.latitudeFieldName"},write:{target:"locationInfo.latitudeFieldName",ignoreOrigin:!0}}})],jo.prototype,"latitudeField",void 0),_([T({type:["show","hide"]})],jo.prototype,"listMode",void 0),_([T({type:["coordinates"],json:{read:{source:"locationInfo.locationType"},write:{target:"locationInfo.locationType",ignoreOrigin:!0,isRequired:!0}}})],jo.prototype,"locationType",void 0),_([T({type:String,json:{read:{source:"locationInfo.longitudeFieldName"},write:{target:"locationInfo.longitudeFieldName",ignoreOrigin:!0}}})],jo.prototype,"longitudeField",void 0),_([T({type:["CSV"]})],jo.prototype,"operationalLayerType",void 0),_([T()],jo.prototype,"outFields",void 0),_([T({type:String,json:{origins:{"web-scene":{read:!1,write:!1}},read:!1,write:!1}})],jo.prototype,"path",void 0),_([T({json:{read:!1},cast:null,type:Zf,readOnly:!0})],jo.prototype,"source",void 0),_([T({json:{read:!1},value:"csv",readOnly:!0})],jo.prototype,"type",void 0),_([T({json:{read:XD,write:{isRequired:!0,ignoreOrigin:!0,writer:Eg}}})],jo.prototype,"url",null),jo=_([Z("esri.layers.CSVLayer")],jo);const SPe=jo,bHt=Object.freeze(Object.defineProperty({__proto__:null,default:SPe},Symbol.toStringTag,{value:"Module"}));var YX;let Db=YX=class extends Ne{constructor(){super(...arguments),this.age=null,this.ageReceived=null,this.displayCount=null,this.maxObservations=1}clone(){return new YX({age:this.age,ageReceived:this.ageReceived,displayCount:this.displayCount,maxObservations:this.maxObservations})}};_([T({type:Number,json:{write:!0}})],Db.prototype,"age",void 0),_([T({type:Number,json:{write:!0}})],Db.prototype,"ageReceived",void 0),_([T({type:Number,json:{write:!0}})],Db.prototype,"displayCount",void 0),_([T({type:Number,json:{write:!0}})],Db.prototype,"maxObservations",void 0),Db=YX=_([Z("esri.layers.support.PurgeOptions")],Db);const EPe=Db,jfe=bPe();function Bfe(t,e){return new de("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}let Cr=class extends uPe(zMe(LMe(vPe(mPe(AAe($Me(hPe(pPe(qD(DMe(sn(HD)))))))))))){constructor(...t){super(...t),this.copyright=null,this.definitionExpression=null,this.displayField=null,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.geometryDefinition=null,this.geometryType=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.maxReconnectionAttempts=0,this.maxReconnectionInterval=20,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.operationalLayerType="ArcGISStreamLayer",this.outFields=["*"],this.popupEnabled=!0,this.popupTemplate=null,this.purgeOptions=new EPe,this.refreshInterval=0,this.screenSizePerspectiveEnabled=!0,this.sourceJSON=null,this.spatialReference=dt.WGS84,this.type="stream",this.url=null,this.updateInterval=300,this.useViewTime=!0,this.webSocketUrl=null,this._debouncedSaveOperations=oE(async(e,i,r)=>{const{save:n,saveAs:s}=await ke(()=>import("./streamLayerUtils-e5517567.js"),["./streamLayerUtils-e5517567.js","./utils-a4281b92.js","./jsonContext-ecb82249.js"],import.meta.url);switch(e){case Nc.SAVE:return n(this,i);case Nc.SAVE_AS:return s(this,r,i)}})}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}load(t){if(!("WebSocket"in globalThis))return this.addResolvingPromise(Promise.reject(new de("stream-layer:websocket-unsupported","WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."))),Promise.resolve(this);const e=t!=null?t.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Stream Service","Feed"]},t).catch($a).then(()=>this._fetchService(e))),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(t){const e=this._normalizeFeatureReduction(t);this._set("featureReduction",e)}set renderer(t){vL(t,this.fieldsIndex),this._set("renderer",t)}readRenderer(t,e,i){e=e.layerDefinition||e;const r=e.drawingInfo?.renderer;if(r){const n=iE(r,e,i)||void 0;return n||Ee.getLogger(this).error("Failed to create renderer",{rendererDefinition:e.drawingInfo.renderer,layer:this,context:i}),n}return qN(e,i)}async connect(t){const[{createConnection:e}]=await Promise.all([ke(()=>import("./createConnection-03bdf9dc.js"),["./createConnection-03bdf9dc.js","./query-51127c95.js","./pbfQueryUtils-51148051.js","./pbf-334ee1bd.js"],import.meta.url),this.load()]),i=this.geometryType?k4.toJSON(this.geometryType):null,{customParameters:r=null,definitionExpression:n=null,geometryDefinition:s=null,maxReconnectionAttempts:a=0,maxReconnectionInterval:u=20,spatialReference:p=this.spatialReference}=t||this.createConnectionParameters(),y=e(this.parsedUrl,this.spatialReference,p,i,{geometry:s,where:n},a,u,r??void 0),b=nv([this.on("send-message-to-socket",S=>y.sendMessageToSocket(S)),this.on("send-message-to-client",S=>y.sendMessageToClient(S))]);return y.once("destroy",b.remove),y}createConnectionParameters(){return{spatialReference:this.spatialReference,customParameters:this.customParameters,definitionExpression:this.definitionExpression,geometryDefinition:this.geometryDefinition,maxReconnectionAttempts:this.maxReconnectionAttempts,maxReconnectionInterval:this.maxReconnectionInterval}}createPopupTemplate(t){return xPe(this,t)}createQuery(){const t=new qh;return t.returnGeometry=!0,t.outFields=["*"],t.where=this.definitionExpression||"1=1",t}getFieldDomain(t,e){if(!this.fields)return null;let i=null;return this.fields.some(r=>(r.name===t&&(i=r.domain),!!i)),i}getField(t){return this.fieldsIndex.get(t)}serviceSupportsSpatialReference(t){return!0}sendMessageToSocket(t){this.emit("send-message-to-socket",t)}sendMessageToClient(t){this.emit("send-message-to-client",t)}async save(t){return this._debouncedSaveOperations(Nc.SAVE,t)}async saveAs(t,e){return this._debouncedSaveOperations(Nc.SAVE_AS,e,t)}write(t,e){const i=e?.messages;return this.webSocketUrl?(i?.push(Bfe(this,"using a custom websocket connection cannot be written to web scenes and web maps")),null):this.parsedUrl?super.write(t,e):(i?.push(Bfe(this,"using a client-side only connection without a url cannot be written to web scenes and web maps")),null)}async _fetchService(t){if(!this.webSocketUrl&&this.parsedUrl){if(!this.sourceJSON){const{data:e}=await ir(this.parsedUrl.path,{query:{f:"json",...this.customParameters,...this.parsedUrl.query},responseType:"json",signal:t});this.sourceJSON=e}}else{if(!this.timeInfo?.trackIdField)throw new de("stream-layer:missing-metadata","The stream layer trackIdField must be specified.");if(!this.objectIdField){const e=this.fields.find(i=>i.type==="oid")?.name;if(!e)throw new de("stream-layer:missing-metadata","The stream layer objectIdField must be specified.");this.objectIdField=e}if(!this.fields)throw new de("stream-layer:missing-metadata","The stream layer fields must be specified.");if(this.fields.some(e=>e.name===this.objectIdField)||this.fields.push(new OR({name:this.objectIdField,alias:this.objectIdField,type:"oid"})),!this.geometryType)throw new de("stream-layer:missing-metadata","The stream layer geometryType must be specified.");this.webSocketUrl&&(this.url=this.webSocketUrl)}return this.read(this.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}),vL(this.renderer,this.fieldsIndex),UY(this.timeInfo,this.fieldsIndex),this.objectIdField||(this.objectIdField="__esri_stream_id__"),wPe(this,{origin:"service"})}};_([T({type:String})],Cr.prototype,"copyright",void 0),_([T({readOnly:!0})],Cr.prototype,"defaultPopupTemplate",null),_([T({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Cr.prototype,"definitionExpression",void 0),_([T({type:String})],Cr.prototype,"displayField",void 0),_([T({type:UMe})],Cr.prototype,"elevationInfo",void 0),_([T({json:{origins:{"web-map":{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-scene":{read:!1,write:!1}}}})],Cr.prototype,"featureReduction",null),_([T(jfe.fields)],Cr.prototype,"fields",void 0),_([T(jfe.fieldsIndex)],Cr.prototype,"fieldsIndex",void 0),_([T({type:rr,json:{name:"layerDefinition.definitionGeometry",write:!0}})],Cr.prototype,"geometryDefinition",void 0),_([T({type:k4.apiValues,json:{read:{reader:k4.read}}})],Cr.prototype,"geometryType",void 0),_([T(HN)],Cr.prototype,"labelsVisible",void 0),_([T({type:[GR],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:w6},write:!0}})],Cr.prototype,"labelingInfo",void 0),_([T(VMe)],Cr.prototype,"legendEnabled",void 0),_([T({type:["show","hide"],json:{origins:{"portal-item":{read:!1,write:!1}}}})],Cr.prototype,"listMode",void 0),_([T({type:Wr})],Cr.prototype,"maxReconnectionAttempts",void 0),_([T({type:Wr})],Cr.prototype,"maxReconnectionInterval",void 0),_([T(qMe)],Cr.prototype,"maxScale",void 0),_([T(HMe)],Cr.prototype,"minScale",void 0),_([T({type:String})],Cr.prototype,"objectIdField",void 0),_([T({value:"ArcGISStreamLayer",type:["ArcGISStreamLayer"]})],Cr.prototype,"operationalLayerType",void 0),_([T({readOnly:!0})],Cr.prototype,"outFields",void 0),_([T(GN)],Cr.prototype,"popupEnabled",void 0),_([T({type:mE,json:{name:"popupInfo",write:!0}})],Cr.prototype,"popupTemplate",void 0),_([T({type:EPe})],Cr.prototype,"purgeOptions",void 0),_([T({json:{read:!1,write:!1}})],Cr.prototype,"refreshInterval",void 0),_([T({types:BR,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{name:"layerDefinition.drawingInfo.renderer",types:AMe,write:!0}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],Cr.prototype,"renderer",null),_([rt("service","renderer",["drawingInfo.renderer","defaultSymbol"]),rt("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Cr.prototype,"readRenderer",null),_([T((()=>{const t=Ce(jMe);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],Cr.prototype,"screenSizePerspectiveEnabled",void 0),_([T()],Cr.prototype,"sourceJSON",void 0),_([T({type:dt,json:{origins:{service:{read:{source:"spatialReference"}}}}})],Cr.prototype,"spatialReference",void 0),_([T({json:{read:!1}})],Cr.prototype,"type",void 0),_([T(BMe)],Cr.prototype,"url",void 0),_([T({type:Number})],Cr.prototype,"updateInterval",void 0),_([T({json:{read:!1,write:!1}})],Cr.prototype,"useViewTime",void 0),_([T({type:String})],Cr.prototype,"webSocketUrl",void 0),Cr=_([Z("esri.layers.StreamLayer")],Cr);const hte=Cr,wHt=Object.freeze(Object.defineProperty({__proto__:null,default:hte},Symbol.toStringTag,{value:"Module"})),KAt=new SPe({spatialReference:dt.WebMercator,url:"./Zurich_ETH_Lee_EM_active_pts_WM.csv",longitudeField:"POINT_X",latitudeField:"POINT_Y"});new hte({url:"https://us-iot.arcgis.com/bc1qjuyagnrebxvh/bc1qjuyagnrebxvh/streams/arcgis/rest/services/Zurich__ETH_Lee_EM_activefeed_WM/StreamServer"});async function CPe(t,e=[]){const i=t.createQuery();i.returnGeometry=!0,i.orderByFields=e,i.returnZ=!0;const{features:r}=await t.queryFeatures(i);return r}function QAt(t){const e=t.geometryType;if(e==="mesh"||e==="multipatch")throw new Error("Mesh and multipatch not supported");return new hte({objectIdField:t.objectIdField,fields:[{name:"TRACKID",alias:"TrackId",type:"long"},...t.fields],timeInfo:{trackIdField:"TRACKID"},geometryType:e,updateInterval:100,renderer:t.renderer})}function e4t(t,e){const i=t.geometryType;if(i==="mesh"||i==="multipatch")throw new Error("Mesh and multipatch not supported");return new ute({title:`${t.title} (client-side)`,fields:t.fields,objectIdField:t.objectIdField,elevationInfo:t.elevationInfo,hasZ:t.hasZ,spatialReference:t.spatialReference,geometryType:i,popupTemplate:t.popupTemplate,source:e,renderer:t.renderer,definitionExpression:"0 < people"})}var t4t=Object.defineProperty,i4t=Object.getOwnPropertyDescriptor,LE=(t,e,i,r)=>{for(var n=r>1?void 0:r?i4t(e,i):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(n=(r?a(e,i,n):a(n))||n);return r&&n&&t4t(e,i,n),n};const r4t=7.5;let Mv=class extends Ke{constructor(t){super(t),this.timeoutId=null}get running(){return this.timeoutId!==null}start(){this.stop();let t=0;const e=Date.now();let i=null;const r=()=>{if(t<this.features.length){const n=this.features[t],s=n.getAttribute(this.timeField);i||(i=s);const a=(s-i)/r4t,p=Date.now()-e,y=a-p;if(y<0){const b=this.receptor;b&&b.sendMessageToClient({type:"features",features:[n]});const S=n.getObjectId();console.log(`[${t}] event`,a,{next:n,objectId:S}),t++,this.timeoutId=setTimeout(r)}else console.log(`[${t}] idle for ${y/1e3}s`),this.timeoutId=setTimeout(r,y)}};this.timeoutId=setTimeout(r)}stop(){const t=this.timeoutId;t&&clearTimeout(t),this.timeoutId=null}destroy(){console.log("Destroyed...")}};LE([T({constructOnly:!0})],Mv.prototype,"timeField",2);LE([T({constructOnly:!0})],Mv.prototype,"features",2);LE([T()],Mv.prototype,"receptor",2);LE([T()],Mv.prototype,"running",1);LE([T()],Mv.prototype,"timeoutId",2);Mv=LE([Z()],Mv);const rI="esri-identity-form",uu={base:rI,group:`${rI}__group`,label:`${rI}__label`,footer:`${rI}__footer`,esriInput:"esri-input",esriButton:"esri-button",esriButtonSecondary:"esri-button--secondary"},n4t="ArcGIS Online";let Vm=class extends Yg{constructor(e,i){super(e,i),this._usernameInputNode=null,this._passwordInputNode=null,this.signingIn=!1,this.server=null,this.resource=null,this.error=null,this.oAuthPrompt=!1}render(){const{error:e,server:i,resource:r,signingIn:n,oAuthPrompt:s,messages:a}=this,u=Li("div",{class:uu.group},cze(s?a.oAuthInfo:a.info,{server:i&&/\.arcgis\.com/i.test(i)?n4t:i,resource:`(${r||a.lblItem})`})),p=s?null:Li("div",{class:uu.group,key:"username"},Li("label",{class:uu.label},a.lblUser,Li("input",{afterCreate:pne,autocomplete:"off",bind:this,class:uu.esriInput,"data-node-ref":"_usernameInputNode",required:!0,spellcheck:!1,type:"text",value:""}))),y=s?null:Li("div",{class:uu.group,key:"password"},Li("label",{class:uu.label},a.lblPwd,Li("input",{afterCreate:pne,bind:this,class:uu.esriInput,"data-node-ref":"_passwordInputNode",required:!0,type:"password",value:""}))),b=Li("div",{class:this.classes(uu.group,uu.footer)},Li("input",{class:uu.esriButton,disabled:!!n,type:"submit",value:n?a.lblSigning:a.lblOk}),Li("input",{bind:this,class:this.classes(uu.esriButton,uu.esriButtonSecondary),onclick:this._cancel,type:"button",value:a.lblCancel})),S=e?Li("div",null,e.details?.httpStatus?a.invalidUser:a.noAuthService):null;return Li("form",{bind:this,class:uu.base,onsubmit:this._submit},u,S,p,y,b)}_cancel(){this._set("signingIn",!1),this._usernameInputNode&&(this._usernameInputNode.value=""),this._passwordInputNode&&(this._passwordInputNode.value=""),this.emit("cancel")}_submit(e){e.preventDefault(),this._set("signingIn",!0);const i=this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value};this.emit("submit",i)}};_([T(),kw("esri/identity/t9n/identity")],Vm.prototype,"messages",void 0),_([T()],Vm.prototype,"signingIn",void 0),_([T()],Vm.prototype,"server",void 0),_([T()],Vm.prototype,"resource",void 0),_([T()],Vm.prototype,"error",void 0),_([T()],Vm.prototype,"oAuthPrompt",void 0),Vm=_([Z("esri.identity.IdentityForm")],Vm);const s4t=Vm;/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var APe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],cD=APe.join(","),OPe=typeof Element>"u",fw=OPe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,uD=!OPe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},hD=function t(e,i){var r;i===void 0&&(i=!0);var n=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),s=n===""||n==="true",a=s||i&&e&&t(e.parentNode);return a},o4t=function(e){var i,r=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return r===""||r==="true"},RPe=function(e,i,r){if(hD(e))return[];var n=Array.prototype.slice.apply(e.querySelectorAll(cD));return i&&fw.call(e,cD)&&n.unshift(e),n=n.filter(r),n},MPe=function t(e,i,r){for(var n=[],s=Array.from(e);s.length;){var a=s.shift();if(!hD(a,!1))if(a.tagName==="SLOT"){var u=a.assignedElements(),p=u.length?u:a.children,y=t(p,!0,r);r.flatten?n.push.apply(n,y):n.push({scopeParent:a,candidates:y})}else{var b=fw.call(a,cD);b&&r.filter(a)&&(i||!e.includes(a))&&n.push(a);var S=a.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(a),C=!hD(S,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(a));if(S&&C){var O=t(S===!0?a.children:S.children,!0,r);r.flatten?n.push.apply(n,O):n.push({scopeParent:a,candidates:O})}else s.unshift.apply(s,a.children)}}return n},PPe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},Qb=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||o4t(e))&&!PPe(e)?0:e.tabIndex},a4t=function(e,i){var r=Qb(e);return r<0&&i&&!PPe(e)?0:r},l4t=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},IPe=function(e){return e.tagName==="INPUT"},c4t=function(e){return IPe(e)&&e.type==="hidden"},u4t=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},h4t=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},d4t=function(e){if(!e.name)return!0;var i=e.form||uD(e),r=function(u){return i.querySelectorAll('input[type="radio"][name="'+u+'"]')},n;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")n=r(window.CSS.escape(e.name));else try{n=r(e.name)}catch(a){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",a.message),!1}var s=h4t(n,e.form);return!s||s===e},p4t=function(e){return IPe(e)&&e.type==="radio"},f4t=function(e){return p4t(e)&&!d4t(e)},m4t=function(e){var i,r=e&&uD(e),n=(i=r)===null||i===void 0?void 0:i.host,s=!1;if(r&&r!==e){var a,u,p;for(s=!!((a=n)!==null&&a!==void 0&&(u=a.ownerDocument)!==null&&u!==void 0&&u.contains(n)||e!=null&&(p=e.ownerDocument)!==null&&p!==void 0&&p.contains(e));!s&&n;){var y,b,S;r=uD(n),n=(y=r)===null||y===void 0?void 0:y.host,s=!!((b=n)!==null&&b!==void 0&&(S=b.ownerDocument)!==null&&S!==void 0&&S.contains(n))}}return s},Vfe=function(e){var i=e.getBoundingClientRect(),r=i.width,n=i.height;return r===0&&n===0},g4t=function(e,i){var r=i.displayCheck,n=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=fw.call(e,"details>summary:first-of-type"),a=s?e.parentElement:e;if(fw.call(a,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof n=="function"){for(var u=e;e;){var p=e.parentElement,y=uD(e);if(p&&!p.shadowRoot&&n(p)===!0)return Vfe(e);e.assignedSlot?e=e.assignedSlot:!p&&y!==e.ownerDocument?e=y.host:e=p}e=u}if(m4t(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return Vfe(e);return!1},y4t=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var n=i.children.item(r);if(n.tagName==="LEGEND")return fw.call(i,"fieldset[disabled] *")?!0:!n.contains(e)}return!0}i=i.parentElement}return!1},dD=function(e,i){return!(i.disabled||hD(i)||c4t(i)||g4t(i,e)||u4t(i)||y4t(i))},ZX=function(e,i){return!(f4t(i)||Qb(i)<0||!dD(e,i))},v4t=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},_4t=function t(e){var i=[],r=[];return e.forEach(function(n,s){var a=!!n.scopeParent,u=a?n.scopeParent:n,p=a4t(u,a),y=a?t(n.candidates):u;p===0?a?i.push.apply(i,y):i.push(u):r.push({documentOrder:s,tabIndex:p,item:n,isScope:a,content:y})}),r.sort(l4t).reduce(function(n,s){return s.isScope?n.push.apply(n,s.content):n.push(s.content),n},[]).concat(i)},b4t=function(e,i){i=i||{};var r;return i.getShadowRoot?r=MPe([e],i.includeContainer,{filter:ZX.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:v4t}):r=RPe(e,i.includeContainer,ZX.bind(null,i)),_4t(r)},w4t=function(e,i){i=i||{};var r;return i.getShadowRoot?r=MPe([e],i.includeContainer,{filter:dD.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=RPe(e,i.includeContainer,dD.bind(null,i)),r},ix=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return fw.call(e,cD)===!1?!1:ZX(i,e)},x4t=APe.concat("iframe").join(","),cj=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return fw.call(e,x4t)===!1?!1:dD(i,e)};/*!
* focus-trap 7.5.4
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function Gfe(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),i.push.apply(i,r)}return i}function Hfe(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Gfe(Object(i),!0).forEach(function(r){T4t(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Gfe(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function T4t(t,e,i){return e=E4t(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function S4t(t,e){if(typeof t!="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var r=i.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function E4t(t){var e=S4t(t,"string");return typeof e=="symbol"?e:String(e)}var qfe={activateTrap:function(e,i){if(e.length>0){var r=e[e.length-1];r!==i&&r.pause()}var n=e.indexOf(i);n===-1||e.splice(n,1),e.push(i)},deactivateTrap:function(e,i){var r=e.indexOf(i);r!==-1&&e.splice(r,1),e.length>0&&e[e.length-1].unpause()}},C4t=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},A4t=function(e){return e?.key==="Escape"||e?.key==="Esc"||e?.keyCode===27},C4=function(e){return e?.key==="Tab"||e?.keyCode===9},O4t=function(e){return C4(e)&&!e.shiftKey},R4t=function(e){return C4(e)&&e.shiftKey},Wfe=function(e){return setTimeout(e,0)},Xfe=function(e,i){var r=-1;return e.every(function(n,s){return i(n)?(r=s,!1):!0}),r},jC=function(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];return typeof e=="function"?e.apply(void 0,r):e},nI=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},M4t=[],P4t=function(e,i){var r=i?.document||document,n=i?.trapStack||M4t,s=Hfe({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:O4t,isKeyBackward:R4t},i),a={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},u,p=function(ne,pe,ge){return ne&&ne[pe]!==void 0?ne[pe]:s[ge||pe]},y=function(ne,pe){var ge=typeof pe?.composedPath=="function"?pe.composedPath():void 0;return a.containerGroups.findIndex(function(ve){var Se=ve.container,ee=ve.tabbableNodes;return Se.contains(ne)||ge?.includes(Se)||ee.find(function(re){return re===ne})})},b=function(ne){var pe=s[ne];if(typeof pe=="function"){for(var ge=arguments.length,ve=new Array(ge>1?ge-1:0),Se=1;Se<ge;Se++)ve[Se-1]=arguments[Se];pe=pe.apply(void 0,ve)}if(pe===!0&&(pe=void 0),!pe){if(pe===void 0||pe===!1)return pe;throw new Error("`".concat(ne,"` was specified but was not a node, or did not return a node"))}var ee=pe;if(typeof pe=="string"&&(ee=r.querySelector(pe),!ee))throw new Error("`".concat(ne,"` as selector refers to no known node"));return ee},S=function(){var ne=b("initialFocus");if(ne===!1)return!1;if(ne===void 0||!cj(ne,s.tabbableOptions))if(y(r.activeElement)>=0)ne=r.activeElement;else{var pe=a.tabbableGroups[0],ge=pe&&pe.firstTabbableNode;ne=ge||b("fallbackFocus")}if(!ne)throw new Error("Your focus-trap needs to have at least one focusable element");return ne},C=function(){if(a.containerGroups=a.containers.map(function(ne){var pe=b4t(ne,s.tabbableOptions),ge=w4t(ne,s.tabbableOptions),ve=pe.length>0?pe[0]:void 0,Se=pe.length>0?pe[pe.length-1]:void 0,ee=ge.find(function(ye){return ix(ye)}),re=ge.slice().reverse().find(function(ye){return ix(ye)}),fe=!!pe.find(function(ye){return Qb(ye)>0});return{container:ne,tabbableNodes:pe,focusableNodes:ge,posTabIndexesFound:fe,firstTabbableNode:ve,lastTabbableNode:Se,firstDomTabbableNode:ee,lastDomTabbableNode:re,nextTabbableNode:function(we){var Ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,Oe=pe.indexOf(we);return Oe<0?Ae?ge.slice(ge.indexOf(we)+1).find(function(Ve){return ix(Ve)}):ge.slice(0,ge.indexOf(we)).reverse().find(function(Ve){return ix(Ve)}):pe[Oe+(Ae?1:-1)]}}}),a.tabbableGroups=a.containerGroups.filter(function(ne){return ne.tabbableNodes.length>0}),a.tabbableGroups.length<=0&&!b("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(a.containerGroups.find(function(ne){return ne.posTabIndexesFound})&&a.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},O=function me(ne){var pe=ne.activeElement;if(pe)return pe.shadowRoot&&pe.shadowRoot.activeElement!==null?me(pe.shadowRoot):pe},P=function me(ne){if(ne!==!1&&ne!==O(document)){if(!ne||!ne.focus){me(S());return}ne.focus({preventScroll:!!s.preventScroll}),a.mostRecentlyFocusedNode=ne,C4t(ne)&&ne.select()}},$=function(ne){var pe=b("setReturnFocus",ne);return pe||(pe===!1?!1:ne)},N=function(ne){var pe=ne.target,ge=ne.event,ve=ne.isBackward,Se=ve===void 0?!1:ve;pe=pe||nI(ge),C();var ee=null;if(a.tabbableGroups.length>0){var re=y(pe,ge),fe=re>=0?a.containerGroups[re]:void 0;if(re<0)Se?ee=a.tabbableGroups[a.tabbableGroups.length-1].lastTabbableNode:ee=a.tabbableGroups[0].firstTabbableNode;else if(Se){var ye=Xfe(a.tabbableGroups,function(Xt){var ti=Xt.firstTabbableNode;return pe===ti});if(ye<0&&(fe.container===pe||cj(pe,s.tabbableOptions)&&!ix(pe,s.tabbableOptions)&&!fe.nextTabbableNode(pe,!1))&&(ye=re),ye>=0){var we=ye===0?a.tabbableGroups.length-1:ye-1,Ae=a.tabbableGroups[we];ee=Qb(pe)>=0?Ae.lastTabbableNode:Ae.lastDomTabbableNode}else C4(ge)||(ee=fe.nextTabbableNode(pe,!1))}else{var Oe=Xfe(a.tabbableGroups,function(Xt){var ti=Xt.lastTabbableNode;return pe===ti});if(Oe<0&&(fe.container===pe||cj(pe,s.tabbableOptions)&&!ix(pe,s.tabbableOptions)&&!fe.nextTabbableNode(pe))&&(Oe=re),Oe>=0){var Ve=Oe===a.tabbableGroups.length-1?0:Oe+1,at=a.tabbableGroups[Ve];ee=Qb(pe)>=0?at.firstTabbableNode:at.firstDomTabbableNode}else C4(ge)||(ee=fe.nextTabbableNode(pe))}}else ee=b("fallbackFocus");return ee},z=function(ne){var pe=nI(ne);if(!(y(pe,ne)>=0)){if(jC(s.clickOutsideDeactivates,ne)){u.deactivate({returnFocus:s.returnFocusOnDeactivate});return}jC(s.allowOutsideClick,ne)||ne.preventDefault()}},U=function(ne){var pe=nI(ne),ge=y(pe,ne)>=0;if(ge||pe instanceof Document)ge&&(a.mostRecentlyFocusedNode=pe);else{ne.stopImmediatePropagation();var ve,Se=!0;if(a.mostRecentlyFocusedNode)if(Qb(a.mostRecentlyFocusedNode)>0){var ee=y(a.mostRecentlyFocusedNode),re=a.containerGroups[ee].tabbableNodes;if(re.length>0){var fe=re.findIndex(function(ye){return ye===a.mostRecentlyFocusedNode});fe>=0&&(s.isKeyForward(a.recentNavEvent)?fe+1<re.length&&(ve=re[fe+1],Se=!1):fe-1>=0&&(ve=re[fe-1],Se=!1))}}else a.containerGroups.some(function(ye){return ye.tabbableNodes.some(function(we){return Qb(we)>0})})||(Se=!1);else Se=!1;Se&&(ve=N({target:a.mostRecentlyFocusedNode,isBackward:s.isKeyBackward(a.recentNavEvent)})),P(ve||a.mostRecentlyFocusedNode||S())}a.recentNavEvent=void 0},j=function(ne){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;a.recentNavEvent=ne;var ge=N({event:ne,isBackward:pe});ge&&(C4(ne)&&ne.preventDefault(),P(ge))},G=function(ne){if(A4t(ne)&&jC(s.escapeDeactivates,ne)!==!1){ne.preventDefault(),u.deactivate();return}(s.isKeyForward(ne)||s.isKeyBackward(ne))&&j(ne,s.isKeyBackward(ne))},q=function(ne){var pe=nI(ne);y(pe,ne)>=0||jC(s.clickOutsideDeactivates,ne)||jC(s.allowOutsideClick,ne)||(ne.preventDefault(),ne.stopImmediatePropagation())},W=function(){if(a.active)return qfe.activateTrap(n,u),a.delayInitialFocusTimer=s.delayInitialFocus?Wfe(function(){P(S())}):P(S()),r.addEventListener("focusin",U,!0),r.addEventListener("mousedown",z,{capture:!0,passive:!1}),r.addEventListener("touchstart",z,{capture:!0,passive:!1}),r.addEventListener("click",q,{capture:!0,passive:!1}),r.addEventListener("keydown",G,{capture:!0,passive:!1}),u},K=function(){if(a.active)return r.removeEventListener("focusin",U,!0),r.removeEventListener("mousedown",z,!0),r.removeEventListener("touchstart",z,!0),r.removeEventListener("click",q,!0),r.removeEventListener("keydown",G,!0),u},se=function(ne){var pe=ne.some(function(ge){var ve=Array.from(ge.removedNodes);return ve.some(function(Se){return Se===a.mostRecentlyFocusedNode})});pe&&P(S())},ae=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(se):void 0,le=function(){ae&&(ae.disconnect(),a.active&&!a.paused&&a.containers.map(function(ne){ae.observe(ne,{subtree:!0,childList:!0})}))};return u={get active(){return a.active},get paused(){return a.paused},activate:function(ne){if(a.active)return this;var pe=p(ne,"onActivate"),ge=p(ne,"onPostActivate"),ve=p(ne,"checkCanFocusTrap");ve||C(),a.active=!0,a.paused=!1,a.nodeFocusedBeforeActivation=r.activeElement,pe?.();var Se=function(){ve&&C(),W(),le(),ge?.()};return ve?(ve(a.containers.concat()).then(Se,Se),this):(Se(),this)},deactivate:function(ne){if(!a.active)return this;var pe=Hfe({onDeactivate:s.onDeactivate,onPostDeactivate:s.onPostDeactivate,checkCanReturnFocus:s.checkCanReturnFocus},ne);clearTimeout(a.delayInitialFocusTimer),a.delayInitialFocusTimer=void 0,K(),a.active=!1,a.paused=!1,le(),qfe.deactivateTrap(n,u);var ge=p(pe,"onDeactivate"),ve=p(pe,"onPostDeactivate"),Se=p(pe,"checkCanReturnFocus"),ee=p(pe,"returnFocus","returnFocusOnDeactivate");ge?.();var re=function(){Wfe(function(){ee&&P($(a.nodeFocusedBeforeActivation)),ve?.()})};return ee&&Se?(Se($(a.nodeFocusedBeforeActivation)).then(re,re),this):(re(),this)},pause:function(ne){if(a.paused||!a.active)return this;var pe=p(ne,"onPause"),ge=p(ne,"onPostPause");return a.paused=!0,pe?.(),K(),le(),ge?.(),this},unpause:function(ne){if(!a.paused||!a.active)return this;var pe=p(ne,"onUnpause"),ge=p(ne,"onPostUnpause");return a.paused=!1,pe?.(),C(),W(),le(),ge?.(),this},updateContainerElements:function(ne){var pe=[].concat(ne).filter(Boolean);return a.containers=pe.map(function(ge){return typeof ge=="string"?r.querySelector(ge):ge}),a.active&&C(),le(),this}},u.updateContainerElements(e),u};const I_="esri-identity-modal",vf={base:I_,open:`${I_}--open`,closed:`${I_}--closed`,title:`${I_}__title`,dialog:`${I_}__dialog`,content:`${I_}__content`,closeButton:`${I_}__close-button`,iconClose:"esri-icon-close"};let py=class extends Yg{constructor(t,e){super(t,e),this.container=document.createElement("div"),this.content=null,this.open=!1,this._focusTrap=null,this._close=()=>{this.open=!1},document.body.appendChild(this.container),this.addHandles(Fe(()=>this.open,()=>this._toggleFocusTrap()))}destroy(){this._destroyFocusTrap()}get title(){return this.messages?.auth.signIn}render(){const t=this.id,{open:e,content:i,title:r,messages:n}=this,s=e&&!!i,a={[vf.open]:s,[vf.closed]:!s},u=Li("button",{"aria-label":n.close,bind:this,class:vf.closeButton,onclick:this._close,title:n.close,type:"button"},Li("span",{"aria-hidden":"true",class:vf.iconClose})),p=`${t}_title`,y=`${t}_content`,b=r?Li("h1",{class:vf.title,id:p},r):null,S=s?Li("div",{afterCreate:this._createFocusTrap,"aria-describedby":y,"aria-labelledby":p,bind:this,class:vf.dialog,role:"dialog"},u,b,this._renderContent(y)):null;return Li("div",{class:this.classes(vf.base,a),tabIndex:-1},S)}_destroyFocusTrap(){this._focusTrap?.deactivate({onDeactivate:()=>{}}),this._focusTrap=null}_toggleFocusTrap(){const{_focusTrap:t,open:e}=this;t&&(e?t.activate():t.deactivate())}_createFocusTrap(t){this._destroyFocusTrap();const e=requestAnimationFrame(()=>{this._focusTrap=P4t(t,{initialFocus:"input",onDeactivate:this._close}),this._toggleFocusTrap()});this.addHandles(Sr(()=>cancelAnimationFrame(e)))}_renderContent(t){const e=this.content;return typeof e=="string"?Li("div",{class:vf.content,id:t,innerHTML:e}):lTt(e)?Li("div",{class:vf.content,id:t},e.render()):e instanceof HTMLElement?Li("div",{afterCreate:this._attachToNode,bind:e,class:vf.content,id:t}):null}_attachToNode(t){const e=this;t.appendChild(e)}};_([T({readOnly:!0})],py.prototype,"container",void 0),_([T()],py.prototype,"content",void 0),_([T()],py.prototype,"open",void 0),_([T(),kw("esri/t9n/common")],py.prototype,"messages",void 0),_([T()],py.prototype,"title",null),py=_([Z("esri.identity.IdentityModal")],py);const Jfe=py,uj="esriJSAPIOAuth";class KX{constructor(e,i){this.oAuthInfo=null,this.storage=null,this.appId=null,this.codeVerifier=null,this.expires=null,this.refreshToken=null,this.ssl=null,this.stateUID=null,this.token=null,this.userId=null,this.oAuthInfo=e,this.storage=i,this._init()}isValid(){let e=!1;if(this.oAuthInfo&&this.userId&&(this.refreshToken||this.token)){if(this.expires==null&&this.refreshToken)e=!0;else if(this.expires){const i=Date.now();this.expires>i&&(this.expires-i)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(e=!0)}}return e}save(){if(!this.storage)return!1;const e=this._load(),i=this.oAuthInfo;if(i&&i.authNamespace&&i.portalUrl){let r=e[i.authNamespace];r||(r=e[i.authNamespace]={}),this.appId||(this.appId=i.appId),r[i.portalUrl]={appId:this.appId,codeVerifier:this.codeVerifier,expires:this.expires,refreshToken:this.refreshToken,ssl:this.ssl,stateUID:this.stateUID,token:this.token,userId:this.userId};try{this.storage.setItem(uj,JSON.stringify(e))}catch(n){return console.warn(n),!1}return!0}return!1}destroy(){const e=this._load(),i=this.oAuthInfo;if(i?.appId&&i?.portalUrl&&(this.expires==null||this.expires>Date.now())&&(this.refreshToken||this.token)){const r=i.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",n=new FormData;if(n.append("f","json"),n.append("auth_token",this.refreshToken||this.token),n.append("client_id",i.appId),n.append("token_type_hint",this.refreshToken?"refresh_token":"access_token"),typeof navigator.sendBeacon=="function")navigator.sendBeacon(r,n);else{const s=new XMLHttpRequest;s.open("POST",r),s.send(n)}}if(i&&i.authNamespace&&i.portalUrl&&this.storage){const r=e[i.authNamespace];if(r){delete r[i.portalUrl];try{this.storage.setItem(uj,JSON.stringify(e))}catch(n){console.log(n)}}}i&&(i._oAuthCred=null,this.oAuthInfo=null)}_init(){const e=this._load(),i=this.oAuthInfo;if(i&&i.authNamespace&&i.portalUrl){let r=e[i.authNamespace];r&&(r=r[i.portalUrl],r&&(this.appId=r.appId,this.codeVerifier=r.codeVerifier,this.expires=r.expires,this.refreshToken=r.refreshToken,this.ssl=r.ssl,this.stateUID=r.stateUID,this.token=r.token,this.userId=r.userId))}}_load(){let e={};if(this.storage){const i=this.storage.getItem(uj);if(i)try{e=JSON.parse(i)}catch(r){console.warn(r)}}return e}}KX.prototype.declaredClass="esri.identity.OAuthCredential";var QX;let Ca=QX=class extends Ne{constructor(t){super(t),this._oAuthCred=null,this.appId=null,this.authNamespace="/",this.expiration=20160,this.flowType="auto",this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl="oauth-callback.html",this.popupWindowFeatures="height=490,width=800,resizable,scrollbars,status",this.portalUrl="https://www.arcgis.com",this.preserveUrlHash=!1,this.userId=null}clone(){return QX.fromJSON(this.toJSON())}};_([T({json:{write:!0}})],Ca.prototype,"appId",void 0),_([T({json:{write:!0}})],Ca.prototype,"authNamespace",void 0),_([T({json:{write:!0}})],Ca.prototype,"expiration",void 0),_([T({json:{write:!0}})],Ca.prototype,"flowType",void 0),_([T({json:{write:!0}})],Ca.prototype,"forceLogin",void 0),_([T({json:{write:!0}})],Ca.prototype,"forceUserId",void 0),_([T({json:{write:!0}})],Ca.prototype,"locale",void 0),_([T({json:{write:!0}})],Ca.prototype,"minTimeUntilExpiration",void 0),_([T({json:{write:!0}})],Ca.prototype,"popup",void 0),_([T({json:{write:!0}})],Ca.prototype,"popupCallbackUrl",void 0),_([T({json:{write:!0}})],Ca.prototype,"popupWindowFeatures",void 0),_([T({json:{write:!0}})],Ca.prototype,"portalUrl",void 0),_([T({json:{write:!0}})],Ca.prototype,"preserveUrlHash",void 0),_([T({json:{write:!0}})],Ca.prototype,"userId",void 0),Ca=QX=_([Z("esri.identity.OAuthInfo")],Ca);const eJ=Ca;let _u=class extends Ne{constructor(e){super(e),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};_([T({json:{write:!0}})],_u.prototype,"adminTokenServiceUrl",void 0),_([T({json:{write:!0}})],_u.prototype,"currentVersion",void 0),_([T({json:{write:!0}})],_u.prototype,"hasPortal",void 0),_([T({json:{write:!0}})],_u.prototype,"hasServer",void 0),_([T({json:{write:!0}})],_u.prototype,"owningSystemUrl",void 0),_([T({json:{write:!0}})],_u.prototype,"owningTenant",void 0),_([T({json:{write:!0}})],_u.prototype,"server",void 0),_([T({json:{write:!0}})],_u.prototype,"shortLivedTokenValidity",void 0),_([T({json:{write:!0}})],_u.prototype,"tokenServiceUrl",void 0),_([T({json:{write:!0}})],_u.prototype,"webTierAuth",void 0),_u=_([Z("esri.identity.ServerInfo")],_u);const hj=_u,x6={},$Pe=t=>{const e=new Pc(t.owningSystemUrl).host,i=new Pc(t.server).host,r=/.+\.arcgis\.com$/i;return r.test(e)&&r.test(i)},tJ=(t,e)=>!!($Pe(t)&&e&&e.some(i=>i.test(t.server)));let T6=null,S6=null;try{T6=window.localStorage,S6=window.sessionStorage}catch{}class LPe extends Xn{constructor(){super(),this._portalConfig=globalThis.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this._defaultOAuthInfo=null,this._defaultTokenValidity=60,this.dialog=null,this.formConstructor=s4t,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin=window.origin!=="null"?window.origin:window.location.origin,this._appUrlObj=Nn(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthLocationParams=null,this._gwTokenUrl="/sharing/rest/generateToken",this._agsRest="/rest/services",this._agsPortal=/\/sharing(\/|$)/i,this._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i,this._adminSvcs=/\/rest\/admin\/services(\/|$)/i,this._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}],this._legacyFed=[],this._regexSDirUrl=/http.+\/rest\/services\/?/gi,this._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|KnowledgeGraphServer|MapServer|MissionServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer|VideoServer)).*/gi,this._gwUser=/http.+\/users\/([^\/]+)\/?.*/i,this._gwItem=/http.+\/items\/([^\/]+)\/?.*/i,this._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i,this._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getOAuthLocationParams(),window.addEventListener("pageshow",e=>{this._pageShowHandler(e)})}registerServers(e){const i=this.serverInfos;i?(e=e.filter(r=>!this.findServerInfo(r.server)),this.serverInfos=i.concat(e)):this.serverInfos=e,e.forEach(r=>{r.owningSystemUrl&&this._portals.push(r.owningSystemUrl),r.hasPortal&&this._portals.push(r.server)})}registerOAuthInfos(e){const i=this.oAuthInfos;if(i){for(const r of e){const n=this.findOAuthInfo(r.portalUrl);n&&i.splice(i.indexOf(n),1)}this.oAuthInfos=i.concat(e)}else this.oAuthInfos=e}registerToken(e){e={...e};const i=this._sanitizeUrl(e.server),r=this._isServerRsrc(i);let n,s=this.findServerInfo(i),a=!0;s||(s=new hj,s.server=this._getServerInstanceRoot(i),r?s.hasServer=!0:(s.tokenServiceUrl=this._getTokenSvcUrl(i),s.hasPortal=!0),this.registerServers([s])),n=this._findCredential(i),n?(delete e.server,Object.assign(n,e),a=!1):(n=new ps({userId:e.userId,server:s.server,token:e.token,expires:e.expires,ssl:e.ssl,scope:r?"server":"portal"}),n.resources=[i],this.credentials.push(n)),n.emitTokenChange(!1),a||n.refreshServerTokens()}toJSON(){return yD({serverInfos:this.serverInfos.map(e=>e.toJSON()),oAuthInfos:this.oAuthInfos.map(e=>e.toJSON()),credentials:this.credentials.map(e=>e.toJSON())})}initialize(e){if(!e)return;typeof e=="string"&&(e=JSON.parse(e));const i=e.serverInfos,r=e.oAuthInfos,n=e.credentials;if(i){const s=[];i.forEach(a=>{a.server&&a.tokenServiceUrl&&s.push(a.declaredClass?a:new hj(a))}),s.length&&this.registerServers(s)}if(r){const s=[];r.forEach(a=>{a.appId&&s.push(a.declaredClass?a:new eJ(a))}),s.length&&this.registerOAuthInfos(s)}n&&n.forEach(s=>{s.server&&s.token&&s.expires&&s.expires>Date.now()&&((s=s.declaredClass?s:new ps(s)).emitTokenChange(),this.credentials.push(s))})}findServerInfo(e){let i;e=this._sanitizeUrl(e);for(const r of this.serverInfos)if(this._hasSameServerInstance(r.server,e)){i=r;break}return i}findOAuthInfo(e){let i;e=this._sanitizeUrl(e);for(const r of this.oAuthInfos)if(this._hasSameServerInstance(r.portalUrl,e)){i=r;break}return i}findCredential(e,i){if(!e)return;let r;e=this._sanitizeUrl(e);const n=this._isServerRsrc(e)?"server":"portal";if(i){for(const s of this.credentials)if(this._hasSameServerInstance(s.server,e)&&i===s.userId&&s.scope===n){r=s;break}}else for(const s of this.credentials)if(this._hasSameServerInstance(s.server,e)&&this._getIdenticalSvcIdx(e,s)!==-1&&s.scope===n){r=s;break}return r}getCredential(e,i){let r,n,s=!0;i&&(r=!!i.token,n=i.error,s=i.prompt!==!1),i={...i},e=this._sanitizeUrl(e);const a=new AbortController,u=Ys();if(i.signal&&qs(i.signal,()=>{a.abort()}),qs(a,()=>{u.reject(new de("identity-manager:user-aborted","ABORTED"))}),Ms(a))return u.promise;i.signal=a.signal;const p=this._isAdminResource(e),y=r?this.findCredential(e):null;let b;if(y&&n&&n.details&&n.details.httpStatus===498)y.destroy();else if(y)return b=new de("identity-manager:not-authorized","You are currently signed in as: '"+y.userId+"'. You do not have access to this resource: "+e,{error:n}),u.reject(b),u.promise;const S=this._findCredential(e,i);if(S)return u.resolve(S),u.promise;let C=this.findServerInfo(e);if(C)!C.hasPortal&&C.server&&C.owningSystemUrl&&this._hasSameServerInstance(C.server,C.owningSystemUrl)&&(C.hasPortal=!0),!C.hasServer&&this._isServerRsrc(e)&&(C._restInfoPms=this._getTokenSvcUrl(e),C.hasServer=!0);else{const O=this._getTokenSvcUrl(e);if(!O)return b=new de("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),u.reject(b),u.promise;C=new hj,C.server=this._getServerInstanceRoot(e),typeof O=="string"?(C.tokenServiceUrl=O,C.hasPortal=!0):(C._restInfoPms=O,C.hasServer=!0),this.registerServers([C])}return C.hasPortal&&C._selfReq===void 0&&(s||Tc(C.tokenServiceUrl,this._appOrigin)||this._gwDomains.some(O=>O.tokenServiceUrl===C.tokenServiceUrl))&&(C._selfReq={owningTenant:i?.owningTenant,selfDfd:this._getPortalSelf(C.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),e)}),this._enqueue(e,C,i,u,p)}getResourceName(e){return this._isRESTService(e)?e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(e)&&e.replace(this._gwUser,"$1")||this._gwItem.test(e)&&e.replace(this._gwItem,"$1")||this._gwGroup.test(e)&&e.replace(this._gwGroup,"$1")||""}generateToken(e,i,r){const n=this._rePortalTokenSvc.test(e.tokenServiceUrl),s=new Pc(this._appOrigin),a=e.shortLivedTokenValidity;let u,p,y,b,S,C,O,P;i&&(P=this.tokenValidity||a||this._defaultTokenValidity,P>a&&a>0&&(P=a)),r&&(u=r.isAdmin,p=r.serverUrl,y=r.token,C=r.signal,O=r.ssl,e.customParameters=r.customParameters),u?b=e.adminTokenServiceUrl:(b=e.tokenServiceUrl,S=new Pc(b.toLowerCase()),e.webTierAuth&&r?.serverUrl&&!O&&s.scheme==="http"&&(Tc(s.uri,b,!0)||S.scheme==="https"&&s.host===S.host&&s.port==="7080"&&S.port==="7443")&&(b=b.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));const $={query:{request:"getToken",username:i?.username,password:i?.password,serverUrl:p,token:y,expiration:P,referer:u||n?this._appOrigin:null,client:u?"referer":null,f:"json",...e.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(e,r),signal:C,...r?.ioArgs};return n||($.withCredentials=!1),ir(b,$).then(N=>{const z=N.data;if(!z?.token)return new de("identity-manager:authentication-failed","Unable to generate token");const U=e.server;return x6[U]||(x6[U]={}),i&&(x6[U][i.username]=i.password),z.validity=P,z})}isBusy(){return!!this._busy}checkSignInStatus(e){return this.checkAppAccess(e,"").then(i=>i.credential)}checkAppAccess(e,i,r){let n=!1;return this.getCredential(e,{prompt:!1}).then(s=>{let a;const u={f:"json"};if(s.scope==="portal")if(i&&(this._doPortalSignIn(e)||r?.force))a=s.server+"/sharing/rest/oauth2/validateAppAccess",u.client_id=i;else{if(!s.token)return{credential:s};a=s.server+"/sharing/rest"}else{if(!s.token)return{credential:s};a=s.server+"/rest/services"}return s.token&&(u.token=s.token),ir(a,{query:u,authMode:"anonymous"}).then(p=>{if(p.data.valid===!1)throw new de("identity-manager:not-authorized",`You are currently signed in as: '${s.userId}'.`,p.data);return n=!!p.data.viewOnlyUserTypeApp,{credential:s}}).catch(p=>{if(p.name==="identity-manager:not-authorized")throw p;const y=p.details?.httpStatus;if(y===498)throw s.destroy(),new de("identity-manager:not-authenticated","User is not signed in.");if(y===400)throw new de("identity-manager:invalid-request");return{credential:s}})}).then(s=>({credential:s.credential,viewOnly:n}))}setOAuthResponseHash(e){e&&(e.charAt(0)==="#"&&(e=e.substring(1)),this._processOAuthPopupParams(e2(e)))}setOAuthRedirectionHandler(e){this._oAuthRedirectFunc=e}setProtocolErrorHandler(e){this._protocolFunc=e}signIn(e,i,r={}){const n=Ys(),s=()=>{p?.remove(),y?.remove(),b?.remove(),u?.destroy(),this.dialog?.destroy(),this.dialog=u=p=y=b=null},a=()=>{s(),this._oAuthDfd=null,n.reject(new de("identity-manager:user-aborted","ABORTED"))};r.signal&&qs(r.signal,()=>{a()});let u=new this.formConstructor;u.resource=this.getResourceName(e),u.server=i.server,this.dialog=new Jfe,this.dialog.content=u,this.dialog.open=!0,this.emit("dialog-create");let p=u.on("cancel",a),y=Fe(()=>this.dialog.open,a),b=u.on("submit",S=>{this.generateToken(i,S,{isAdmin:r.isAdmin,signal:r.signal}).then(C=>{s();const O=new ps({userId:S.username,server:i.server,token:C.token,expires:C.expires!=null?Number(C.expires):null,ssl:!!C.ssl,isAdmin:r.isAdmin,validity:C.validity});n.resolve(O)}).catch(C=>{u.error=C,u.signingIn=!1})});return n.promise}oAuthSignIn(e,i,r,n){this._oAuthDfd=Ys();const s=this._oAuthDfd;let a;n?.signal&&qs(n.signal,()=>{const P=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;P&&!P.closed?P.close():this.dialog&&C()}),s.resUrl_=e,s.sinfo_=i,s.oinfo_=r;const u=r._oAuthCred;if(u.storage&&(r.flowType==="authorization-code"||r.flowType==="auto"&&i.currentVersion>=8.4)){let P=crypto.getRandomValues(new Uint8Array(32));a=QN(P),u.codeVerifier=a,P=crypto.getRandomValues(new Uint8Array(32)),u.stateUID=QN(P),u.save()||(u.codeVerifier=a=null)}else u.codeVerifier=null;let p,y,b,S;this._getCodeChallenge(a).then(P=>{const $=!n||n.oAuthPopupConfirmation!==!1;r.popup&&$?(p=new this.formConstructor,p.oAuthPrompt=!0,p.server=i.server,this.dialog=new Jfe,this.dialog.content=p,this.dialog.open=!0,this.emit("dialog-create"),y=p.on("cancel",C),b=Fe(()=>this.dialog.open,C),S=p.on("submit",()=>{O(),this._doOAuthSignIn(e,i,r,P)})):this._doOAuthSignIn(e,i,r,P)});const C=()=>{O(),this._oAuthDfd=null,s.reject(new de("identity-manager:user-aborted","ABORTED"))},O=()=>{y?.remove(),b?.remove(),S?.remove(),p?.destroy(),this.dialog?.destroy(),this.dialog=null};return s.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach(e=>{e.destroy()}),this.emit("credentials-destroy")}enablePostMessageAuth(e="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=lg(window,"message",i=>{if((i.origin===this._appOrigin||i.origin.endsWith(".arcgis.com"))&&i.data?.type==="arcgis:auth:requestCredential"){const r=i.source;this.getCredential(e).then(n=>{r.postMessage({type:"arcgis:auth:credential",credential:{expires:n.expires,server:n.server,ssl:n.ssl,token:n.token,userId:n.userId}},i.origin)}).catch(n=>{r.postMessage({type:"arcgis:auth:error",error:{name:n.name,message:n.message}},i.origin)})}})}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthLocationParams(){let e=window.location.hash;if(e){e.charAt(0)==="#"&&(e=e.substring(1));const r=e2(e);let n=!1;if(r.access_token&&r.expires_in&&r.state&&r.hasOwnProperty("username"))try{r.state=JSON.parse(r.state),r.state.portalUrl&&(this._oAuthLocationParams=r,n=!0)}catch{}else if(r.error&&r.error_description&&(console.log("IdentityManager OAuth Error: ",r.error," - ",r.error_description),r.error==="access_denied"&&(n=!0,r.state)))try{r.state=JSON.parse(r.state)}catch{}n&&(window.location.hash=r.state?.hash||"")}let i=window.location.search;if(i){i.charAt(0)==="?"&&(i=i.substring(1));const r=e2(i);let n=!1;if(r.code&&r.state)try{r.state=JSON.parse(r.state),r.state.portalUrl&&r.state.uid&&(this._oAuthLocationParams=r,n=!0)}catch{}else if(r.error&&r.error_description&&(console.log("IdentityManager OAuth Error: ",r.error," - ",r.error_description),r.error==="access_denied"&&(n=!0,r.state)))try{r.state=JSON.parse(r.state)}catch{}if(n){const s={...r};["code","error","error_description","message_code","persist","state"].forEach(p=>{delete s[p]});const a=D2(s),u=window.location.pathname+(a?`?${a}`:"")+(r.state?.hash||"");window.history.replaceState(window.history.state,"",u)}}}_getOAuthToken(e,i,r,n,s){return e=e.replace(/^http:/i,"https:"),ir(`${e}/sharing/rest/oauth2/token`,{authMode:"anonymous",method:"post",query:n&&s?{grant_type:"authorization_code",code:i,redirect_uri:n,client_id:r,code_verifier:s}:{grant_type:"refresh_token",refresh_token:i,client_id:r}}).then(a=>a.data)}_getCodeChallenge(e){if(e&&globalThis.isSecureContext){const i=new TextEncoder().encode(e);return crypto.subtle.digest("SHA-256",i).then(r=>QN(new Uint8Array(r)))}return Promise.resolve(null)}_pageShowHandler(e){if(e.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const i=new de("identity-manager:user-aborted","ABORTED");this._errbackFunc(i)}}_findCredential(e,i){let r,n,s,a,u=-1;const p=i?.token,y=i?.resource,b=this._isServerRsrc(e)?"server":"portal",S=this.credentials.filter(C=>this._hasSameServerInstance(C.server,e)&&C.scope===b);if(e=y||e,S.length)if(S.length===1){if(r=S[0],s=this.findServerInfo(r.server),n=s?.owningSystemUrl,a=n?this.findCredential(n,r.userId):void 0,u=this._getIdenticalSvcIdx(e,r),!p)return u===-1&&r.resources.push(e),this._addResource(e,a),r;u!==-1&&(r.resources.splice(u,1),this._removeResource(e,a))}else{let C,O;if(S.some(P=>(O=this._getIdenticalSvcIdx(e,P),O!==-1&&(C=P,s=this.findServerInfo(C.server),n=s?.owningSystemUrl,a=n?this.findCredential(n,C.userId):void 0,u=O,!0))),p)C&&(C.resources.splice(u,1),this._removeResource(e,a));else if(C)return this._addResource(e,a),C}}_findOAuthInfo(e){let i=this.findOAuthInfo(e);if(!i){for(const r of this.oAuthInfos)if(this._isIdProvider(r.portalUrl,e)){i=r;break}}return i}_addResource(e,i){i&&this._getIdenticalSvcIdx(e,i)===-1&&i.resources.push(e)}_removeResource(e,i){let r=-1;i&&(r=this._getIdenticalSvcIdx(e,i),r>-1&&i.resources.splice(r,1))}_useProxy(e,i){return i?.isAdmin&&!Tc(e.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(e.tokenServiceUrl)&&String(e.currentVersion)==="10.1"&&!Tc(e.tokenServiceUrl,this._appOrigin)}_getOrigin(e){const i=new Pc(e);return i.scheme+"://"+i.host+(i.port!=null?":"+i.port:"")}_getServerInstanceRoot(e){const i=e.toLowerCase();let r=i.indexOf(this._agsRest);return r===-1&&this._isAdminResource(e)&&(r=this._agsAdmin.test(e)?e.replace(this._agsAdmin,"$1").length:e.search(this._adminSvcs)),r!==-1||hme(i)||(r=i.indexOf("/sharing")),r===-1&&i.substr(-1)==="/"&&(r=i.length-1),r>-1?e.substring(0,r):e}_hasSameServerInstance(e,i){return e.substr(-1)==="/"&&(e=e.slice(0,-1)),e=e.toLowerCase(),i=this._getServerInstanceRoot(i).toLowerCase(),e=this._normalizeAGOLorgDomain(e),i=this._normalizeAGOLorgDomain(i),(e=e.substr(e.indexOf(":")))===(i=i.substr(i.indexOf(":")))}_normalizeAGOLorgDomain(e){const i=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,r=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,n=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return i.test(e)?e=e.replace(i,"https://www.arcgis.com"):r.test(e)?e=e.replace(r,"https://devext.arcgis.com"):n.test(e)&&(e=e.replace(n,"https://qaext.arcgis.com")),e}_sanitizeUrl(e){const i=(vr.request.proxyUrl||"").toLowerCase(),r=i?e.toLowerCase().indexOf(i+"?"):-1;return r!==-1&&(e=e.substring(r+i.length+1)),e=Uu(e),Nn(e).path}_isRESTService(e){return e.includes(this._agsRest)}_isAdminResource(e){return this._agsAdmin.test(e)||this._adminSvcs.test(e)}_isServerRsrc(e){return this._isRESTService(e)||this._isAdminResource(e)}_isIdenticalService(e,i){let r=!1;if(this._isRESTService(e)&&this._isRESTService(i)){const n=this._getSuffix(e).toLowerCase(),s=this._getSuffix(i).toLowerCase();if(r=n===s,!r){const a=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;r=n.replaceAll(a,"$1")===s.replaceAll(a,"$1")}}else this._isAdminResource(e)&&this._isAdminResource(i)?r=!0:this._isServerRsrc(e)||this._isServerRsrc(i)||!this._isPortalDomain(e)||(r=!0);return r}_isPortalDomain(e){const i=new Pc(e.toLowerCase()),r=this._portalConfig;let n=this._gwDomains.some(s=>s.regex.test(i.uri));return!n&&r&&(n=this._hasSameServerInstance(this._getServerInstanceRoot(r.restBaseUrl),i.uri)),n||vr.portalUrl&&(n=Tc(i,vr.portalUrl,!0)),n||(n=this._portals.some(s=>this._hasSameServerInstance(s,i.uri))),n=n||this._agsPortal.test(i.path),n}_isIdProvider(e,i){let r=-1,n=-1;this._gwDomains.forEach((a,u)=>{r===-1&&a.regex.test(e)&&(r=u),n===-1&&a.regex.test(i)&&(n=u)});let s=!1;if(r>-1&&n>-1&&(r===0||r===4?n!==0&&n!==4||(s=!0):r===1?n!==1&&n!==2||(s=!0):r===2?n===2&&(s=!0):r===3&&n===3&&(s=!0)),!s){const a=this.findServerInfo(i),u=a?.owningSystemUrl;u&&$Pe(a)&&this._isPortalDomain(u)&&this._isIdProvider(e,u)&&(s=!0)}return s}_getIdenticalSvcIdx(e,i){let r=-1;for(let n=0;n<i.resources.length;n++){const s=i.resources[n];if(this._isIdenticalService(e,s)){r=n;break}}return r}_getSuffix(e){return e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")}_getTokenSvcUrl(e){let i,r,n;if(this._isRESTService(e)||this._isAdminResource(e)){const s=this._getServerInstanceRoot(e);return i=s+"/admin/generateToken",r=ir(e=s+"/rest/info",{query:{f:"json"}}).then(a=>a.data),{adminUrl:i,promise:r}}if(this._isPortalDomain(e)){let s="";if(this._gwDomains.some(a=>(a.regex.test(e)&&(s=a.tokenServiceUrl),!!s)),s||this._portals.some(a=>(this._hasSameServerInstance(a,e)&&(s=a+this._gwTokenUrl),!!s)),s||(n=e.toLowerCase().indexOf("/sharing"),n!==-1&&(s=e.substring(0,n)+this._gwTokenUrl)),s||(s=this._getOrigin(e)+this._gwTokenUrl),s){const a=new Pc(e).port;/^http:\/\//i.test(e)&&a==="7080"&&(s=s.replace(/:7080/i,":7443")),s=s.replace(/http:/i,"https:")}return s}if(e.toLowerCase().includes("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"}_processOAuthResponseParams(e,i,r){const n=i._oAuthCred;if(e.code){const a=n.codeVerifier;return n.codeVerifier=null,n.stateUID=null,n.save(),this._getOAuthToken(r.server,e.code,i.appId,this._getRedirectURI(i,!0),a).then(u=>{const p=new ps({userId:u.username,server:r.server,token:u.access_token,expires:Date.now()+1e3*u.expires_in,ssl:u.ssl,oAuthState:e.state,_oAuthCred:n});return i.userId=p.userId,n.storage=u.persist?T6:S6,n.refreshToken=u.refresh_token,n.token=null,n.expires=u.refresh_token_expires_in?Date.now()+1e3*u.refresh_token_expires_in:null,n.userId=p.userId,n.ssl=p.ssl,n.save(),p})}const s=new ps({userId:e.username,server:r.server,token:e.access_token,expires:Date.now()+1e3*Number(e.expires_in),ssl:e.ssl==="true",oAuthState:e.state,_oAuthCred:n});return i.userId=s.userId,n.storage=e.persist?T6:S6,n.refreshToken=null,n.token=s.token,n.expires=s.expires,n.userId=s.userId,n.ssl=s.ssl,n.save(),Promise.resolve(s)}_processOAuthPopupParams(e){const i=this._oAuthDfd;if(this._oAuthDfd=null,i)if(clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle?.remove(),e.error){const r=e.error==="access_denied",n=new de(r?"identity-manager:user-aborted":"identity-manager:authentication-failed",r?"ABORTED":"OAuth: "+e.error+" - "+e.error_description);i.reject(n)}else this._processOAuthResponseParams(e,i.oinfo_,i.sinfo_).then(r=>{i.resolve(r)}).catch(r=>{i.reject(r)})}_setOAuthResponseQueryString(e){e&&(e.charAt(0)==="?"&&(e=e.substring(1)),this._processOAuthPopupParams(e2(e)))}_exchangeToken(e,i,r){return ir(`${e}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:i,token:r}}).then(n=>n.data.token)}_getPlatformSelf(e,i){return e=e.replace(/^http:/i,"https:"),ir(`${e}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":i,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json",expiration:30},withCredentials:!0}).then(r=>r.data)}_getPortalSelf(e,i){let r;return this._gwDomains.some(n=>(n.regex.test(e)&&(r=n.customBaseUrl),!!r)),r?Promise.resolve({allSSL:!0,currentVersion:"8.4",customBaseUrl:r,portalMode:"multitenant",supportsOAuth:!0}):(this._appOrigin.startsWith("https:")?e=e.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(i)&&(e=e.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),ir(e,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(n=>n.data))}_doPortalSignIn(e){const i=this._portalConfig,r=window.location.href,n=this.findServerInfo(e);return!(!i&&!this._isPortalDomain(r)||!(n?n.hasPortal||n.owningSystemUrl&&this._isPortalDomain(n.owningSystemUrl):this._isPortalDomain(e))||!(this._isIdProvider(r,e)||i&&(this._hasSameServerInstance(this._getServerInstanceRoot(i.restBaseUrl),e)||this._isIdProvider(i.restBaseUrl,e))||Tc(r,e,!0)))}_checkProtocol(e,i,r,n){let s=!0;const a=n?i.adminTokenServiceUrl:i.tokenServiceUrl;return a.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&BO(a)&&(s=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:e,serverInfo:i}),!s)&&r(new de("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection.")),s}_enqueue(e,i,r,n,s,a){return n||(n=Ys()),n.resUrl_=e,n.sinfo_=i,n.options_=r,n.admin_=s,n.refresh_=a,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(e),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(n)):this._xoReqs.push(n):this._doSignIn(n),n.promise}_doSignIn(e){this._busy=e,this._rejectOnPersistedPageShow=!1;const i=y=>{const b=e.options_?.resource,S=e.resUrl_,C=e.refresh_;let O=!1;this.credentials.includes(y)||(C&&this.credentials.includes(C)?(C.userId=y.userId,C.token=y.token,C.expires=y.expires,C.validity=y.validity,C.ssl=y.ssl,C.creationTime=y.creationTime,O=!0,y=C):this.credentials.push(y)),y.resources||(y.resources=[]),y.resources.includes(b||S)||y.resources.push(b||S),y.scope=this._isServerRsrc(S)?"server":"portal",y.emitTokenChange();const P=this._soReqs,$={};this._soReqs=[],P.forEach(N=>{if(!this._isIdenticalService(S,N.resUrl_)){const z=this._getSuffix(N.resUrl_);$[z]||($[z]=!0,y.resources.push(N.resUrl_))}}),e.resolve(y),P.forEach(N=>{this._hasSameServerInstance(this._getServerInstanceRoot(S),N.resUrl_)?N.resolve(y):this._soReqs.push(N)}),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,O||this.emit("credential-create",{credential:y}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},r=y=>{e.reject(y),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},n=(y,b,S,C)=>{const O=e.sinfo_,P=!e.options_||e.options_.prompt!==!1,$=O.hasPortal&&this._findOAuthInfo(e.resUrl_);let N,z;if(y)i(new ps({userId:y,server:O.server,token:S||null,expires:C!=null?Number(C):null,ssl:!!b}));else if(window!==window.parent&&this._appUrlObj.query?.["arcgis-auth-origin"]&&this._appUrlObj.query?.["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),e.resUrl_)){window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const U=lg(window,"message",j=>{j.source===window.parent&&j.data&&(j.data.type==="arcgis:auth:credential"?(U.remove(),j.data.credential.expires<Date.now()?r(new de("identity-manager:credential-request-failed","Parent application's token has expired.")):i(new ps(j.data.credential))):j.data.type==="arcgis:auth:error"&&(U.remove(),j.data.error.name==="tokenExpiredError"?r(new de("identity-manager:credential-request-failed","Parent application's token has expired.")):r(de.fromJSON(j.data.error))))});qs(e.options_?.signal,()=>{U.remove()})}else if($){let U=$._oAuthCred;if(!U){const j=new KX($,T6),G=new KX($,S6);j.isValid()&&G.isValid()?j.expires>G.expires?(U=j,G.destroy()):(U=G,j.destroy()):U=j.isValid()?j:G,$._oAuthCred=U}if(U.isValid()){N=new ps({userId:U.userId,server:O.server,token:U.token,expires:U.expires,ssl:U.ssl,_oAuthCred:U});const j=$.appId!==U.appId&&this._doPortalSignIn(e.resUrl_);j||U.refreshToken?(e._pendingDfd=U.refreshToken?this._getOAuthToken(O.server,U.refreshToken,U.appId).then(G=>(N.expires=Date.now()+1e3*G.expires_in,N.token=G.access_token,N)):Promise.resolve(N),e._pendingDfd.then(G=>j?this._exchangeToken(G.server,$.appId,G.token).then(q=>(G.token=q,G)).catch(()=>G):G).then(G=>{i(G)}).catch(()=>{U?.destroy(),n()})):i(N)}else if(this._oAuthLocationParams&&this._hasSameServerInstance($.portalUrl,this._oAuthLocationParams.state.portalUrl)&&(this._oAuthLocationParams.access_token||this._oAuthLocationParams.code&&this._oAuthLocationParams.state.uid===U.stateUID&&U.codeVerifier)){const j=this._oAuthLocationParams;this._oAuthLocationParams=null,e._pendingDfd=this._processOAuthResponseParams(j,$,O).then(G=>{i(G)}).catch(r)}else{const j=()=>{P?e._pendingDfd=this.oAuthSignIn(e.resUrl_,O,$,e.options_).then(i,r):(z=new de("identity-manager:not-authenticated","User is not signed in."),r(z))};this._doPortalSignIn(e.resUrl_)?e._pendingDfd=this._getPlatformSelf(O.server,$.appId).then(G=>{Tc(G.portalUrl,this._appOrigin,!0)?(N=new ps({userId:G.username,server:O.server,expires:Date.now()+1e3*G.expires_in,token:G.token}),i(N)):j()}).catch(j):j()}}else if(P){if(this._checkProtocol(e.resUrl_,O,r,e.admin_)){let U=e.options_;e.admin_&&(U=U||{},U.isAdmin=!0),e._pendingDfd=this.signIn(e.resUrl_,O,U).then(i,r)}}else z=new de("identity-manager:not-authenticated","User is not signed in."),r(z)},s=()=>{const y=e.sinfo_,b=y.owningSystemUrl,S=e.options_;let C,O,P,$;if(S&&(C=S.token,O=S.error,P=S.prompt),$=this._findCredential(b,{token:C,resource:e.resUrl_}),!$){for(const N of this.credentials)if(this._isIdProvider(b,N.server)){$=N;break}}if($){const N=this.findCredential(e.resUrl_,$.userId);if(N)i(N);else if(tJ(y,this._legacyFed)){const z=$.toJSON();z.server=y.server,z.resources=null,i(new ps(z))}else(e._pendingDfd=this.generateToken(this.findServerInfo($.server),null,{serverUrl:e.resUrl_,token:$.token,signal:e.options_.signal,ssl:$.ssl})).then(z=>{i(new ps({userId:$?.userId,server:y.server,token:z.token,expires:z.expires!=null?Number(z.expires):null,ssl:!!z.ssl,isAdmin:e.admin_,validity:z.validity}))},r)}else this._busy=null,C&&(e.options_.token=null),(e._pendingDfd=this.getCredential(b.replace(/\/?$/,"/sharing"),{resource:e.resUrl_,owningTenant:y.owningTenant,signal:e.options_.signal,token:C,error:O,prompt:P})).then(()=>{this._enqueue(e.resUrl_,e.sinfo_,e.options_,e,e.admin_)},N=>{e.resUrl_=e.sinfo_=e.refresh_=null,e.reject(N)})};this._errbackFunc=r;const a=e.sinfo_.owningSystemUrl,u=this._isServerRsrc(e.resUrl_),p=e.sinfo_._restInfoPms;p?p.promise.then(y=>{const b=e.sinfo_;if(b._restInfoPms){b.adminTokenServiceUrl=b._restInfoPms.adminUrl,b._restInfoPms=null,b.tokenServiceUrl=(tg("authInfo.tokenServicesUrl",y)||tg("authInfo.tokenServiceUrl",y)||tg("tokenServiceUrl",y))??null,b.shortLivedTokenValidity=tg("authInfo.shortLivedTokenValidity",y)??null,b.currentVersion=y.currentVersion,b.owningTenant=y.owningTenant;const S=b.owningSystemUrl=y.owningSystemUrl;S&&this._portals.push(S)}u&&b.owningSystemUrl?s():n()},()=>{e.sinfo_._restInfoPms=null;const y=new de("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");r(y)}):u&&a?s():e.sinfo_._selfReq?e.sinfo_._selfReq.selfDfd.then(y=>{const b={};let S,C,O,P;return y&&(S=y.user?.username,b.username=S,b.allSSL=y.allSSL,C=y.supportsOAuth,P=parseFloat(y.currentVersion),y.portalMode==="multitenant"&&(O=y.customBaseUrl),e.sinfo_.currentVersion=P),e.sinfo_.webTierAuth=!!S,S&&this.normalizeWebTierAuth?this.generateToken(e.sinfo_,null,{ssl:b.allSSL}).catch(()=>null).then($=>(b.portalToken=$&&$.token,b.tokenExpiration=$&&$.expires,b)):!S&&C&&P>=4.4&&!this._findOAuthInfo(e.resUrl_)?this._generateOAuthInfo({portalUrl:e.sinfo_.server,customBaseUrl:O,owningTenant:e.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>b):b}).catch(()=>null).then(y=>{e.sinfo_._selfReq=null,y?n(y.username,y.allSSL,y.portalToken,y.tokenExpiration):n()}):n()}_generateOAuthInfo(e){let i,r=null,n=e.portalUrl;const s=e.customBaseUrl,a=e.owningTenant,u=!this._defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(u){r=window.location.href;let p=r.indexOf("?");p>-1&&(r=r.slice(0,p)),p=r.search(/\/(apps|home)\//),r=p>-1?r.slice(0,p):null}return u&&r?(this._hasTestedIfAppIsOnPortal=!0,i=ir(r+"/sharing/rest",{query:{f:"json"}}).then(()=>{this._defaultOAuthInfo=new eJ({appId:"arcgisonline",popupCallbackUrl:r+"/home/oauth-callback.html"})})):i=Promise.resolve(),i.then(()=>{if(this._defaultOAuthInfo)return n=n.replace(/^http:/i,"https:"),ir(n+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:a,client_id:this._defaultOAuthInfo.appId,redirect_uri:fl(this._defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(p=>{if(p.data.valid){const y=this._defaultOAuthInfo.clone();p.data.urlKey&&s?y.portalUrl="https://"+p.data.urlKey.toLowerCase()+"."+s:y.portalUrl=n,y.popup=window!==window.top||!(Tc(n,this._appOrigin)||this._gwDomains.some(b=>b.regex.test(n)&&b.regex.test(this._appOrigin))),this.oAuthInfos.push(y)}})})}_doOAuthSignIn(e,i,r,n){const s=r._oAuthCred,a={portalUrl:r.portalUrl};!r.popup&&r.preserveUrlHash&&window.location.hash&&(a.hash=window.location.hash),s.stateUID&&(a.uid=s.stateUID);const u={client_id:r.appId,response_type:s.codeVerifier?"code":"token",state:JSON.stringify(a),expiration:r.expiration,locale:r.locale,redirect_uri:this._getRedirectURI(r,!!s.codeVerifier)};r.forceLogin&&(u.force_login=!0),r.forceUserId&&r.userId&&(u.prepopulatedusername=r.userId),!r.popup&&this._doPortalSignIn(e)&&(u.redirectToUserOrgUrl=!0),s.codeVerifier&&(u.code_challenge=n||s.codeVerifier,u.code_challenge_method=n?"S256":"plain");const p=r.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",y=p+"?"+D2(u);if(r.popup){const b=window.open(y,"esriJSAPIOAuth",r.popupWindowFeatures);if(b)b.focus(),this._oAuthDfd.oAuthWin_=b,this._oAuthIntervalId=setInterval(()=>{if(b.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle.remove();const S=this._oAuthDfd;if(S){const C=new de("identity-manager:user-aborted","ABORTED");S.reject(C)}}},500),this._oAuthOnPopupHandle=lg(window,["arcgis:auth:hash","arcgis:auth:location:search"],S=>{S.type==="arcgis:auth:hash"?this.setOAuthResponseHash(S.detail):this._setOAuthResponseQueryString(S.detail)});else{const S=new de("identity-manager:popup-blocked","ABORTED");this._oAuthDfd.reject(S)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:u,authorizeUrl:p,resourceUrl:e,serverInfo:i,oAuthInfo:r}):window.location.href=y}_getRedirectURI(e,i){const r=window.location.href.replace(/#.*$/,"");if(e.popup)return fl(e.popupCallbackUrl);if(i){const n=Nn(r);return n.query&&["code","error","error_description","message_code","persist","state"].forEach(s=>{delete n.query[s]}),uI(n.path,n.query)}return r}}LPe.prototype.declaredClass="esri.identity.IdentityManagerBase";let ps=class extends Xn.EventedAccessor{constructor(t){super(t),this._oAuthCred=null,this.tokenRefreshBuffer=2,t?._oAuthCred&&(this._oAuthCred=t._oAuthCred)}initialize(){this.resources=this.resources||[],this.creationTime==null&&(this.creationTime=Date.now())}refreshToken(){const t=Ii.findServerInfo(this.server),e=t?.owningSystemUrl,i=!!e&&this.scope==="server",r=i&&tJ(t,Ii._legacyFed),n=t.webTierAuth,s=n&&Ii.normalizeWebTierAuth,a=x6[this.server],u=a?.[this.userId];let p,y=this.resources&&this.resources[0],b=i?Ii.findServerInfo(e):null,S={username:this.userId,password:u};if(n&&!s)return;i&&!b&&Ii.serverInfos.some(O=>(Ii._isIdProvider(e,O.server)&&(b=O),!!b));const C=b?Ii.findCredential(b.server,this.userId):null;if(!i||C){if(!r){if(i)p={serverUrl:y,token:C?.token,ssl:C&&C.ssl};else if(s)S=null,p={ssl:this.ssl};else{if(!u){let O;return y&&(y=Ii._sanitizeUrl(y),this._enqueued=1,O=Ii._enqueue(y,t,null,null,this.isAdmin,this),O.then(()=>{this._enqueued=0,this.refreshServerTokens()}).catch(()=>{this._enqueued=0})),O}this.isAdmin&&(p={isAdmin:!0})}return Ii.generateToken(i?b:t,i?null:S,p).then(O=>{this.token=O.token,this.expires=O.expires!=null?Number(O.expires):null,this.creationTime=Date.now(),this.validity=O.validity,this.emitTokenChange(),this.refreshServerTokens()}).catch(()=>{})}C?.refreshToken()}}refreshServerTokens(){this.scope==="portal"&&Ii.credentials.forEach(t=>{const e=Ii.findServerInfo(t.server),i=e?.owningSystemUrl;t!==this&&t.userId===this.userId&&i&&t.scope==="server"&&(Ii._hasSameServerInstance(this.server,i)||Ii._isIdProvider(i,this.server))&&(tJ(e,Ii._legacyFed)?(t.token=this.token,t.expires=this.expires,t.creationTime=this.creationTime,t.validity=this.validity,t.emitTokenChange()):t.refreshToken())})}emitTokenChange(t){clearTimeout(this._refreshTimer);const e=this.server?Ii.findServerInfo(this.server):null,i=e?.owningSystemUrl,r=i?Ii.findServerInfo(i):null;t===!1||i&&this.scope!=="portal"&&(!r?.webTierAuth||Ii.normalizeWebTierAuth)||this.expires==null&&this.validity==null||this._startRefreshTimer(),this.emit("token-change")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const t=Ii.credentials.indexOf(this);t>-1&&Ii.credentials.splice(t,1),this.emitTokenChange(),this.emit("destroy")}toJSON(){const t=yD({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),e=this.resources;return e&&e.length>0&&(t.resources=e.slice()),t}_startRefreshTimer(){clearTimeout(this._refreshTimer);const t=6e4*this.tokenRefreshBuffer,e=2**31-1;let i=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();i<0?i=0:i>e&&(i=e),this._refreshTimer=setTimeout(this.refreshToken.bind(this),i>t?i-t:i)}};_([T()],ps.prototype,"creationTime",void 0),_([T()],ps.prototype,"expires",void 0),_([T()],ps.prototype,"isAdmin",void 0),_([T()],ps.prototype,"oAuthState",void 0),_([T()],ps.prototype,"resources",void 0),_([T()],ps.prototype,"scope",void 0),_([T()],ps.prototype,"server",void 0),_([T()],ps.prototype,"ssl",void 0),_([T()],ps.prototype,"token",void 0),_([T()],ps.prototype,"tokenRefreshBuffer",void 0),_([T()],ps.prototype,"userId",void 0),_([T()],ps.prototype,"validity",void 0),ps=_([Z("esri.identity.Credential")],ps);class DPe extends LPe{}DPe.prototype.declaredClass="esri.identity.IdentityManager";const P2=new DPe;C$e(P2);const I4t=Object.freeze(Object.defineProperty({__proto__:null,default:P2},Symbol.toStringTag,{value:"Module"}));var $4t=Object.defineProperty,L4t=Object.getOwnPropertyDescriptor,dte=(t,e,i,r)=>{for(var n=r>1?void 0:r?L4t(e,i):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(n=(r?a(e,i,n):a(n))||n);return r&&n&&$4t(e,i,n),n};const NPe=new eJ({appId:"KojZjH6glligLidj",popup:!0,popupCallbackUrl:`${document.location.origin}${document.location.pathname}oauth-callback-api.html`});P2.registerOAuthInfos([NPe]);window.setOAuthResponseHash=t=>{P2.setOAuthResponseHash(t)};let LO=class extends Ke{constructor(){super(),P2.on("credential-create",t=>{const e=new Zs;e.authMode="immediate",e.load().then(()=>{this.user=e.user})})}get authenticated(){return!!this.user}signIn(){P2.getCredential(NPe.portalUrl+"/sharing",{oAuthPopupConfirmation:!1})}signOut(){P2.destroyCredentials(),this.user=null}};dte([T()],LO.prototype,"authenticated",1);dte([T()],LO.prototype,"user",2);LO=dte([Z("arcgis-core-template.UserStore")],LO);const D4t=LO;var N4t=Object.defineProperty,F4t=Object.getOwnPropertyDescriptor,HR=(t,e,i,r)=>{for(var n=r>1?void 0:r?F4t(e,i):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(n=(r?a(e,i,n):a(n))||n);return r&&n&&N4t(e,i,n),n};async function k4t(t){const e=await CPe(KAt,["start_time"]),i=new Mv({timeField:"start_time",features:e});return i.receptor=QAt(t),i}let mw=class extends Ke{constructor(t){super(t),this.userStore=new D4t,this.fires=[],this.updateFires=()=>{this.fires.forEach((i,r)=>{const n=this.view.toScreen(i.point);if(n){const u=cMe(this.view.camera.position,i.point),p=Math.min(100,6e3/u);i.element.style.height=`${p}px`,i.element.style.width=`${p}px`,i.element.style.top=`${n.y-p+65}px`,i.element.style.left=`${n.x-p/2}px`}const s=-this.view.camera.heading-90*(r%2),a=-(this.view.camera.tilt-90);i.element.style.transform=`rotateX(${a}deg) rotateY(${s}deg)`})};const e=t.view;e.when(async()=>{await this.map.loadAll();const i=this.map.presentation.slides;i.length&&i.getItemAt(0).applyTo(e,{animate:!1});const r=this.map.allLayers.find(({title:a})=>a==="Lee building - occupancy"),n=await k4t(r);n.start(),this.player=n;const s=n.receptor;this.map.add(s),this.view.whenLayerView(s).then(a=>this.addStream(a))}),e.addHandles(Fe(()=>e.camera,()=>{this.updateFires()}))}async addStream(t){const e=this.map.allLayers.find(({title:u})=>u==="Lee building - occupancy"),i=await CPe(e),r=e4t(e,i),n=new Map;i.forEach(u=>{n.set(u.attributes.NAME,u)}),e.visible=!1,t.layer.visible=!1,this.map.add(r),t.on("data-received",async u=>{const p=u.attributes.NAME,y=n.get(p);y?(y.attributes={...y.attributes,...u.attributes},await r.applyEdits({updateFeatures:[y]})):console.log("No room found for "+p)});const s=this.map.presentation.slides;let a=!1;window.onkeydown=u=>{if(u.key==="Shift")a=!0,this.view.popupEnabled=!1;else{const p=Number.parseInt(u.key);if(0<p&&p<=s.length){const y=s.getItemAt(p-1);this.view.goTo(y.viewpoint,{})}}},window.onkeyup=u=>{u.key==="Shift"&&(a=!1,this.view.popupEnabled=!0)},this.view.on("immediate-click",async u=>{if(a){const p=await this.view.hitTest(u),y=p.results.find(b=>b.type==="graphic");y?this.addFires(y.mapPoint):p.ground.mapPoint&&this.addFires(p.ground.mapPoint)}})}addFires(t){this.addFire(t),this.addFire(t),this.updateFires()}addFire(t){const e=document.createElement("div");e.classList.add("fire"),this.fires.push({element:e,point:t}),document.body.appendChild(e)}};HR([T({aliasOf:"view.map"})],mw.prototype,"map",2);HR([T({constructOnly:!0})],mw.prototype,"view",2);HR([T({constructOnly:!0})],mw.prototype,"userStore",2);HR([T()],mw.prototype,"player",2);mw=HR([Z("arcgis-core-template.AppStore")],mw);const z4t=mw;console.log(`Using ArcGIS Maps SDK for JavaScript v${ED}`);const U4t=new URLSearchParams(document.location.search.slice(1)),j4t=U4t.get("webscene")||"c43ea7331abe4c91a0e36646b39c1ceb",B4t=new ZNe({portalItem:{id:j4t}}),FPe=new aTt({container:"viewDiv",map:B4t});window.view=FPe;const V4t=new z4t({view:FPe});new BSt({container:"app",store:V4t});export{mbt as $,H4e as A,E_t as B,r3e as C,c8 as D,WJe as E,nit as F,Ont as G,Tnt as H,Jvt as I,Hgt as J,Ggt as K,AN as L,qgt as M,Lat as N,b8 as O,Q_t as P,Q4e as Q,ibt as R,bXe as S,J4e as T,Y4e as U,Z_t as V,Xf as W,Iee as X,abt as Y,pbt as Z,GAe as _,Uwe as a,nv as a$,ybt as a0,Krt as a1,ant as a2,cQ as a3,PN as a4,Rbt as a5,llt as a6,dOe as a7,Ibt as a8,Qbt as a9,ke as aA,oi as aB,rt as aC,$v as aD,BMe as aE,HD as aF,$p as aG,Qu as aH,ev as aI,MJ as aJ,Dt as aK,Fe as aL,$r as aM,xg as aN,Tq as aO,Fp as aP,fgt as aQ,Ur as aR,Pv as aS,Vc as aT,Ms as aU,n4 as aV,oE as aW,Sr as aX,ga as aY,BD as aZ,Sn as a_,mut as aa,uht as ab,Jpt as ac,fft as ad,lft as ae,Cp as af,jr as ag,_ as ah,T as ai,nd as aj,Z as ak,pY as al,ct as am,Rie as an,Ke as ao,$Me as ap,hPe as aq,pPe as ar,qD as as,rgt as at,Gi as au,de as av,$a as aw,ir as ax,igt as ay,D2 as az,PJe as b,IMt as b$,g0e as b0,Yc as b1,Is as b2,X as b3,Et as b4,JS as b5,Gs as b6,FQ as b7,Nw as b8,Ai as b9,a5t as bA,VO as bB,di as bC,MFt as bD,SLe as bE,kMt as bF,dUe as bG,Sw as bH,mt as bI,Uy as bJ,nZ as bK,l_e as bL,hje as bM,Tw as bN,vE as bO,si as bP,VMt as bQ,jY as bR,xi as bS,dj as bT,Yfe as bU,CE as bV,o$ as bW,Ite as bX,Ive as bY,qMt as bZ,WMt as b_,Pn as ba,Wn as bb,K6t as bc,hO as bd,Q6t as be,cn as bf,va as bg,dt as bh,Np as bi,qt as bj,We as bk,$e as bl,Ee as bm,H as bn,F4 as bo,_Ct as bp,qn as bq,d7t as br,p7t as bs,Uit as bt,Pg as bu,qh as bv,I8t as bw,ZNt as bx,IFt as by,Zt as bz,e3e as c,Sp as c$,oze as c0,pv as c1,DMt as c2,LMt as c3,W2 as c4,$Mt as c5,nte as c6,_Ae as c7,Me as c8,Ua as c9,Py as cA,ju as cB,I7e as cC,sS as cD,$7e as cE,cPe as cF,EY as cG,Kh as cH,LOt as cI,S$e as cJ,uMt as cK,bg as cL,R8e as cM,Tge as cN,Sge as cO,Hr as cP,lI as cQ,xrt as cR,eo as cS,gw as cT,fPt as cU,n7t as cV,Di as cW,rd as cX,JGt as cY,KNe as cZ,JPt as c_,G7e as ca,gS as cb,pMt as cc,sUt as cd,hee as ce,GO as cf,Xn as cg,rr as ch,Va as ci,cr as cj,HO as ck,F0t as cl,T0 as cm,i6e as cn,Bt as co,Ne as cp,ot as cq,R7e as cr,Ce as cs,tbe as ct,q0e as cu,bD as cv,XD as cw,H2 as cx,j4 as cy,o7e as cz,C3e as d,Zjt as d$,z6 as d0,N2 as d1,E9 as d2,hY as d3,uY as d4,g1e as d5,m2 as d6,dY as d7,VRt as d8,b4e as d9,EB as dA,Fie as dB,gRt as dC,W7e as dD,p2 as dE,Zs as dF,Uie as dG,Nn as dH,qGt as dI,HGt as dJ,Ys as dK,CLe as dL,sv as dM,sNe as dN,Ryt as dO,XMt as dP,N7e as dQ,FOt as dR,mRt as dS,mr as dT,Bu as dU,Y4t as dV,d_t as dW,p_t as dX,s_t as dY,BBt as dZ,z8 as d_,LRt as da,h2 as db,KO as dc,bS as dd,F0 as de,Wt as df,kj as dg,fs as dh,Fj as di,Uj as dj,X6 as dk,N1e as dl,yRt as dm,yO as dn,xLe as dp,lSt as dq,cSt as dr,VTt as ds,Vw as dt,Iie as du,BPe as dv,ute as dw,uE as dx,mMt as dy,X7e as dz,_Ze as e,VMe as e$,m_t as e0,a5e as e1,h6e as e2,vMe as e3,OY as e4,Hze as e5,HMt as e6,yHt as e7,_Ht as e8,vHt as e9,lL as eA,eOt as eB,m$e as eC,Tc as eD,SJ as eE,l9e as eF,TY as eG,OR as eH,k4 as eI,hMt as eJ,wPe as eK,tye as eL,dOt as eM,$0t as eN,L0t as eO,L2 as eP,F6t as eQ,LCe as eR,gM as eS,ZUe as eT,jO as eU,sn as eV,LMe as eW,AAe as eX,mPe as eY,vr as eZ,p5t as e_,Pst as ea,Ist as eb,ZO as ec,EEe as ed,KDt as ee,ZDt as ef,$4 as eg,Rze as eh,BY as ei,sw as ej,Av as ek,sUe as el,YMt as em,rUe as en,JMt as eo,Fa as ep,S8e as eq,QDt as er,mst as es,BC as et,Mn as eu,kr as ev,Y2 as ew,f0 as ex,pd as ey,ts as ez,RZe as f,zOt as f$,Zc as f0,dd as f1,l7 as f2,Nv as f3,e7e as f4,QDe as f5,SDe as f6,pie as f7,bMt as f8,$J as f9,DN as fA,zN as fB,NN as fC,UN as fD,Uw as fE,FN as fF,jw as fG,_t as fH,UR as fI,zVt as fJ,qVt as fK,_W as fL,NRe as fM,IRe as fN,FRe as fO,Jg as fP,HTt as fQ,G4t as fR,J8e as fS,Ie as fT,wt as fU,Ze as fV,R0e as fW,Pte as fX,JNt as fY,A4 as fZ,$Ot as f_,Nc as fa,Ql as fb,Q7e as fc,vPe as fd,WCt as fe,DMe as ff,XPt as fg,J6 as fh,z0 as fi,FAt as fj,yL as fk,Wr as fl,cp as fm,J1e as fn,fl as fo,Fi as fp,yw as fq,XTt as fr,Gee as fs,eE as ft,HOe as fu,W0 as fv,X0 as fw,jf as fx,kN as fy,Bw as fz,uK as g,zrt as g$,tI as g0,mfe as g1,MGt as g2,Iv as g3,E0 as g4,oZ as g5,dNe as g6,ZQ as g7,Ddt as g8,KQ as g9,Xr as gA,qs as gB,Sg as gC,Gc as gD,Ss as gE,IVt as gF,cB as gG,jc as gH,Mr as gI,Urt as gJ,NZ as gK,oJ as gL,aJ as gM,qPe as gN,H4t as gO,wE as gP,NJ as gQ,LZ as gR,MZ as gS,u9t as gT,y9t as gU,$Z as gV,Ao as gW,Pe as gX,Ue as gY,Wrt as gZ,Xs as g_,O5e as ga,QQ as gb,hv as gc,R5e as gd,Aht as ge,kq as gf,or as gg,Ii as gh,Gj as gi,Go as gj,EL as gk,V4 as gl,vD as gm,w6e as gn,x6e as go,T6e as gp,S6e as gq,Je as gr,Na as gs,Jl as gt,_6t as gu,GD as gv,Ro as gw,Fn as gx,f2 as gy,CD as gz,TYe as h,Xl as h$,cR as h0,Ps as h1,sY as h2,XGt as h3,gB as h4,Ip as h5,xPe as h6,UMe as h7,AMe as h8,GN as h9,r1t as hA,Gwt as hB,mY as hC,$h as hD,Mie as hE,mgt as hF,M9t as hG,_D as hH,Pqe as hI,vw as hJ,Vh as hK,Cie as hL,lp as hM,L1e as hN,Uae as hO,oT as hP,xB as hQ,kDt as hR,xRt as hS,DDt as hT,zu as hU,IRt as hV,GRt as hW,UDe as hX,NRt as hY,$Rt as hZ,Wj as h_,mE as ha,br as hb,bPe as hc,u6e as hd,$Dt as he,Vne as hf,nUe as hg,fv as hh,Xo as hi,PGt as hj,dCt as hk,kv as hl,F8t as hm,N8t as hn,IL as ho,Sv as hp,h8 as hq,TR as hr,Lc as hs,od as ht,Yi as hu,IS as hv,NGe as hw,CZ as hx,t1e as hy,T7e as hz,Wnt as i,b5t as i$,un as i0,as as i1,hBe as i2,bp as i3,Gp as i4,w2 as i5,$Pt as i6,_Be as i7,An as i8,Kr as i9,HA as iA,hG as iB,Yy as iC,hB as iD,bl as iE,Oie as iF,Pc as iG,b$e as iH,S0 as iI,Uu as iJ,aE as iK,VN as iL,I5t as iM,BCt as iN,HMe as iO,qMe as iP,Zg as iQ,ite as iR,yMe as iS,lHt as iT,aHt as iU,oHt as iV,eAt as iW,QCt as iX,D5t as iY,N5t as iZ,_5t as i_,Kq as ia,Qq as ib,F7e as ic,SY as id,z7e as ie,U7e as ig,pNe as ih,ZAt as ii,OAt as ij,uPe as ik,zMe as il,vL as im,UY as io,h5t as ip,HN as iq,GR as ir,w6 as is,DX as it,BR as iu,jMe as iv,cte as iw,_Pe as ix,X2 as iy,hPt as iz,kEe as j,P0 as j$,w5t as j0,T5t as j1,S5t as j2,E5t as j3,C5t as j4,A5t as j5,O5t as j6,R5t as j7,M5t as j8,P5t as j9,qDt as jA,lr as jB,Uc as jC,Zl as jD,F as jE,ss as jF,Jc as jG,kt as jH,lt as jI,oe as jJ,l8 as jK,G0 as jL,Ut as jM,pr as jN,Xc as jO,et as jP,ce as jQ,rn as jR,wr as jS,fr as jT,mi as jU,Wg as jV,P7 as jW,Vv as jX,ic as jY,eN as jZ,Oi as j_,yPe as ja,zO as jb,d5t as jc,aRe as jd,jee as je,VVt as jf,e6 as jg,qOe as jh,HVt as ji,GVt as jj,ote as jk,MY as jl,Eme as jm,OAe as jn,Iu as jo,PRt as jp,H3e as jq,V6e as jr,lS as js,jDt as jt,rv as ju,pVe as jv,Yu as jw,q4t as jx,yOt as jy,aS as jz,g1t as k,HRt as k$,Cv as k0,Gv as k1,rN as k2,_l as k3,$Q as k4,tN as k5,De as k6,rlt as k7,rK as k8,ME as k9,Tr as kA,_p as kB,Rn as kC,Lt as kD,en as kE,V0t as kF,ht as kG,lVe as kH,Ay as kI,Os as kJ,Jo as kK,FZ as kL,EVt as kM,cFt as kN,Pft as kO,MNt as kP,VNt as kQ,RNt as kR,ANt as kS,hT as kT,gct as kU,ONt as kV,Br as kW,ed as kX,D1e as kY,uI as kZ,kre as k_,zt as ka,D7 as kb,y8t as kc,RTe as kd,JK as ke,Nut as kf,kut as kg,f6t as kh,Vp as ki,mN as kj,c9e as kk,YO as kl,Bp as km,Hj as kn,kOt as ko,VCt as kp,GGt as kq,YCt as kr,XCt as ks,R4 as kt,ARt as ku,U0e as kv,uJ as kw,$w as kx,En as ky,Ji as kz,Cot as l,zp as l$,AS as l0,mPt as l1,os as l2,Z4t as l3,dv as l4,fMt as l5,KMe as l6,pJ as l7,J2 as l8,Qx as l9,vt as lA,JO as lB,k5t as lC,iv as lD,Rfe as lE,hS as lF,zse as lG,_5e as lH,w5e as lI,Hut as lJ,uh as lK,u4 as lL,d4 as lM,ZCe as lN,ldt as lO,Dut as lP,Ust as lQ,Rg as lR,AEe as lS,wRt as lT,Bst as lU,Nht as lV,Mht as lW,Pht as lX,kht as lY,$ht as lZ,Lht as l_,v5t as la,fHt as lb,U5t as lc,A6 as ld,dMt as le,XIe as lf,nn as lg,s2t as lh,RD as li,nY as lj,cF as lk,ur as ll,ZY as lm,m8 as ln,Gn as lo,VEe as lp,Xg as lq,vn as lr,vi as ls,mp as lt,Be as lu,Nce as lv,xT as lw,pa as lx,Mo as ly,w6t as lz,xCe as m,J4t as m$,Iht as m0,ja as m1,Fht as m2,fR as m3,k7 as m4,lo as m5,jst as m6,Dht as m7,U7 as m8,st as m9,DJ as mA,sMt as mB,nMt as mC,i0 as mD,iO as mE,fa as mF,U4 as mG,a0 as mH,bs as mI,aR as mJ,rFt as mK,$q as mL,oo as mM,pp as mN,MRt as mO,MPt as mP,IK as mQ,Cw as mR,ad as mS,Ey as mT,Dn as mU,ie as mV,KOt as mW,tg as mX,M0e as mY,pOt as mZ,CRt as m_,ud as ma,Pw as mb,XT as mc,wl as md,I3 as me,t6e as mf,m5t as mg,TD as mh,wg as mi,GMt as mj,jMt as mk,Mte as ml,Dp as mm,eR as mn,Ui as mo,yl as mp,UDt as mq,l5t as mr,zMt as ms,UMt as mt,BMt as mu,G4 as mv,Gu as mw,ZMt as mx,qTe as my,rMt as mz,vJe as n,er as n$,_w as n0,cVe as n1,J9e as n2,bOt as n3,_Ot as n4,t7t as n5,e7t as n6,wOt as n7,vOt as n8,Qfe as n9,_Gt as nA,URe as nB,zg as nC,hbe as nD,UBe as nE,ji as nF,PVt as nG,Ra as nH,fRt as nI,O4 as nJ,zNe as nK,nRt as nL,td as nM,Dg as nN,rp as nO,Ic as nP,XZ as nQ,WZ as nR,Oge as nS,Ir as nT,zPt as nU,TBe as nV,Wc as nW,$Et as nX,SWe as nY,YBe as nZ,WPt as n_,KPe as na,zRt as nb,dRe as nc,_xt as nd,BVt as ne,yxt as nf,UVt as ng,jVt as nh,sRe as ni,ZOe as nj,uRe as nk,dGt as nl,WVt as nm,xW as nn,YTt as no,gGt as np,Bee as nq,pGt as nr,fGt as ns,mGt as nt,ZRe as nu,yGt as nv,iSt as nw,vGt as nx,pn as ny,rSt as nz,Tlt as o,Yo as o$,ar as o0,Xu as o1,Hi as o2,wn as o3,jv as o4,zv as o5,TIt as o6,tO as o7,EIt as o8,wIt as o9,IOt as oA,Xy as oB,d6e as oC,rjt as oD,Vte as oE,H1e as oF,He as oG,c9t as oH,d9t as oI,dPt as oJ,GUe as oK,tb as oL,WL as oM,Vr as oN,gPt as oO,v8t as oP,w3e as oQ,Rr as oR,On as oS,MSe as oT,Lr as oU,Wu as oV,rB as oW,ew as oX,L7 as oY,fd as oZ,Bv as o_,FG as oa,xIt as ob,lFt as oc,BJ as od,vRt as oe,HJ as of,Us as og,gi as oh,bUe as oi,qje as oj,Rw as ok,YWe as ol,Fh as om,Ct as on,Xi as oo,_Rt as op,PD as oq,WRt as or,$0 as os,DOt as ot,O0e as ou,Z6e as ov,n0e as ow,lw as ox,_me as oy,EJ as oz,uw as p,e5e as p$,Ft as p0,sxe as p1,gr as p2,Qe as p3,ka as p4,_n as p5,Jve as p6,p9t as p7,f9t as p8,g9t as p9,ec as pA,Kc as pB,rc as pC,Ga as pD,Nu as pE,LPt as pF,lR as pG,I7 as pH,ixe as pI,IPt as pJ,Xtt as pK,ZJe as pL,eh as pM,k$t as pN,N$t as pO,F$t as pP,iBe as pQ,IT as pR,xat as pS,Tat as pT,HS as pU,Fu as pV,lrt as pW,zH as pX,RQ as pY,l5e as pZ,fFt as p_,YY as pa,ha as pb,Y_e as pc,r7 as pd,jt as pe,Wp as pf,xr as pg,dr as ph,wVt as pi,kNe as pj,Wkt as pk,o0 as pl,h7 as pm,i1e as pn,hEe as po,G5 as pp,abe as pq,$Vt as pr,XG as ps,Tl as pt,eS as pu,HEt as pv,b2 as pw,ld as px,cN as py,_i as pz,B1t as q,Pf as q$,Fq as q0,qQ as q1,wJ as q2,sd as q3,jut as q4,t5e as q5,n5e as q6,But as q7,Uut as q8,Vut as q9,id as qA,kp as qB,kS as qC,Wo as qD,iN as qE,yTe as qF,Qtt as qG,YK as qH,yp as qI,pPt as qJ,uZ as qK,SIt as qL,eO as qM,j2 as qN,NPt as qO,IN as qP,AL as qQ,Kat as qR,AVt as qS,HDt as qT,TS as qU,RVt as qV,OVt as qW,WO as qX,URt as qY,v6t as qZ,qne as q_,Bg as qa,zut as qb,Ase as qc,b$t as qd,Zu as qe,WG as qf,Fut as qg,_$t as qh,m7t as qi,ERt as qj,SRt as qk,Kt as ql,Xne as qm,Vit as qn,M8t as qo,hZ as qp,ORt as qq,ao as qr,DPt as qs,kL as qt,F1e as qu,jRt as qv,Wne as qw,N0 as qx,bY as qy,Fxe as qz,Mee as r,XPe as r$,Ma as r0,Uve as r1,YGt as r2,gHe as r3,Xje as r4,I_e as r5,rg as r6,Cn as r7,o5e as r8,qut as r9,WXe as rA,ml as rB,UPt as rC,TWe as rD,IEt as rE,WS as rF,uv as rG,$n as rH,FPt as rI,kPt as rJ,gv as rK,v0 as rL,Bse as rM,Zo as rN,$s as rO,nL as rP,iRt as rQ,tRt as rR,tx as rS,n5t as rT,z4 as rU,$1e as rV,g7e as rW,Te as rX,Die as rY,Kve as rZ,c0e as r_,rJ as ra,oHe as rb,NOt as rc,r7t as rd,zae as re,s7t as rf,JDt as rg,wEe as rh,TEe as ri,_Ee as rj,AA as rk,CA as rl,Hae as rm,Gst as rn,IDt as ro,f1e as rp,qRt as rq,RDe as rr,DRt as rs,X6e as rt,tLe as ru,SEe as rv,jJ as rw,aRt as rx,Iwe as ry,XAt as rz,w_t as s,Rd as s$,bRt as s0,$2 as s1,BHe as s2,TVt as s3,l9 as s4,JEe as s5,jvt as s6,Wje as s7,h9t as s8,oMt as s9,hg as sA,lN as sB,zr as sC,kjt as sD,WOt as sE,kO as sF,hOt as sG,nO as sH,D8t as sI,l3e as sJ,i2e as sK,m9t as sL,By as sM,cBe as sN,zie as sO,Eie as sP,H0t as sQ,lue as sR,g5t as sS,Kfe as sT,nJ as sU,UOt as sV,bIt as sW,qZ as sX,_It as sY,bue as sZ,eW as s_,Mne as sa,YT as sb,m6t as sc,OS as sd,vs as se,uAe as sf,yE as sg,Pi as sh,MEe as si,PEe as sj,$8t as sk,I1e as sl,m7e as sm,gn as sn,lT as so,yS as sp,wSe as sq,lQ as sr,gJe as ss,d5e as st,Cme as su,ebe as sv,XA as sw,PFt as sx,RS as sy,bBe as sz,B4e as t,Ew as t$,N8 as t0,Y4 as t1,mZ as t2,pS as t3,RRt as t4,$Qe as t5,gZ as t6,Mge as t7,dS as t8,K_e as t9,oR as tA,a7 as tB,nR as tC,ePe as tD,IUe as tE,sHt as tF,e0t as tG,ist as tH,est as tI,lXe as tJ,bDt as tK,_Dt as tL,Mg as tM,l7t as tN,Co as tO,da as tP,Qkt as tQ,PQ as tR,ya as tS,EOt as tT,Ru as tU,Y9 as tV,GDt as tW,Nie as tX,FDt as tY,Rrt as tZ,s7 as t_,GBe as ta,Ag as tb,y7 as tc,vHe as td,PPt as te,Gse as tf,b6t as tg,FO as th,Aw as ti,Y6t as tj,qr as tk,GPt as tl,V8e as tm,qu as tn,tUt as to,F8 as tp,Oc as tq,Rc as tr,rW as ts,tW as tt,nW as tu,iW as tv,wue as tw,Ndt as tx,EC as ty,o7 as tz,v3e as u,K4 as u$,t0t as u0,iQ as u1,_s as u2,g0t as u3,L_e as u4,fwe as u5,DD as u6,lZ as u7,V2 as u8,hwe as u9,yi as uA,tn as uB,dg as uC,R0 as uD,Si as uE,ei as uF,Mt as uG,RGt as uH,YDt as uI,Iw as uJ,$E as uK,Kee as uL,kEt as uM,zEt as uN,jN as uO,fMe as uP,WNt as uQ,tot as uR,XNt as uS,IEe as uT,aD as uU,AOt as uV,fp as uW,uMe as uX,E4 as uY,xp as uZ,iE as u_,GWe as ua,Ng as ub,d7 as uc,VA as ud,m7 as ue,lbe as uf,jPt as ug,QWe as uh,k7e as ui,ZOt as uj,BDt as uk,BRt as ul,X4t as um,xUt as un,kRt as uo,r5t as up,VDt as uq,Mc as ur,uOt as us,VEt as ut,Yrt as uu,bu as uv,Ar as uw,qp as ux,V0 as uy,Qs as uz,PYe as v,lhe as v$,VLe as v0,eL as v1,ID as v2,L6e as v3,$6e as v4,sRt as v5,bIe as v6,Wzt as v7,iUt as v8,NSe as v9,Y1t as vA,tz as vB,iz as vC,WDt as vD,Yq as vE,mv as vF,zGt as vG,v4e as vH,iyt as vI,m4e as vJ,gyt as vK,ry as vL,wee as vM,bee as vN,Gue as vO,Q1t as vP,que as vQ,lct as vR,iAt as vS,rAt as vT,nAt as vU,$ct as vV,yI as vW,gme as vX,dhe as vY,ahe as vZ,ADe as v_,Jb as va,xue as vb,qzt as vc,Jzt as vd,Xb as ve,Gzt as vf,eU as vg,M$ as vh,za as vi,cd as vj,HSe as vk,kh as vl,Emt as vm,Cmt as vn,vIt as vo,TA as vp,vCt as vq,Eze as vr,O0 as vs,ES as vt,HUe as vu,o7t as vv,i7t as vw,Pje as vx,DGt as vy,z9e as vz,Qwe as w,t3t as w$,She as w0,che as w1,mhe as w2,Ihe as w3,$he as w4,Lhe as w5,Dhe as w6,FRt as w7,yPt as w8,PNt as w9,hct as wA,$Nt as wB,LNt as wC,PCe as wD,INt as wE,$ft as wF,dct as wG,zY as wH,pUe as wI,NMt as wJ,kw as wK,Yg as wL,$xt as wM,Li as wN,vl as wO,pne as wP,KPt as wQ,dGe as wR,zc as wS,hGe as wT,lTt as wU,GY as wV,d6 as wW,HNt as wX,fD as wY,gUe as wZ,cze as w_,BNt as wa,The as wb,Ahe as wc,kNt as wd,FNt as we,Rft as wf,zNt as wg,UNt as wh,zle as wi,jle as wj,Ule as wk,DNt as wl,NNt as wm,rhe as wn,Xue as wo,Jue as wp,Yue as wq,ghe as wr,Vhe as ws,qhe as wt,nhe as wu,Ghe as wv,n7 as ww,ICe as wx,jNt as wy,uct as wz,GJe as x,k9e as x0,mUe as x1,wL as x2,TL as x3,q4 as x4,K4t as x5,tTt as x6,cGt as x7,YVt as x8,vne as x9,XJ as xA,La as xB,aBe as xC,dZ as xD,pRt as xE,iMt as xF,Ko as xG,nS as xH,lJ as xI,eIt as xJ,yut as xK,ow as xL,aMt as xM,cMt as xN,P8t as xO,h7t as xP,mFt as xQ,RFt as xR,wGt as xS,AGt as xT,QGt as xU,mHt as xV,bHt as xW,wHt as xX,YNt as xa,qNt as xb,WY as xc,TUe as xd,SUe as xe,Zxt as xf,MVt as xg,rRt as xh,eRt as xi,QOt as xj,LD as xk,s7e as xl,Pat as xm,H9t as xn,Zy as xo,KTe as xp,VPt as xq,Cg as xr,tXe as xs,E5 as xt,Jy as xu,eB as xv,HPt as xw,BPt as xx,IBe as xy,fBe as xz,WA as y,T_t as z};
